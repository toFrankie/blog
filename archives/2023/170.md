---
title: CSS å˜é‡ä½¿ç”¨è¯¦è§£
number: '#170'
link: 'https://github.com/toFrankie/blog/issues/170'
created_at: '2023-02-26 15:47:19'
updated_at: '2023-04-26 22:47:32'
labels:
  - CSS
  - å°šæœªå®Œç»“
  - '2022'
---
![é…å›¾æºè‡ª Freepik](https://upload-images.jianshu.io/upload_images/5128488-ec3461bf9c25d6c4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™ç¯‡æ–‡ç« ä½ å°†å­¦åˆ°ä»¥ä¸‹å†…å®¹ï¼š

* CSS å˜é‡
* CSS å¸¸ç”¨å‡½æ•°
* iPhone X ç³»åˆ—æœºå‹é€‚é…
* CSS At-rules å’Œåª’ä½“æŸ¥è¯¢
* æ·±è‰²æ¨¡å¼é€‚é…


## ä¸€ã€ç®€è¿°

CSS å˜é‡ï¼ˆCSS Variablesï¼‰ï¼Œä¹Ÿç§°ä½œ CSS è‡ªå®šä¹‰å±æ€§ï¼ˆCSS Custom Propertiesï¼‰ï¼Œå®ƒæ˜¯å¸¦æœ‰å‰ç¼€ `--` å±æ€§åï¼Œä¸”å¸¦æœ‰å€¼çš„è‡ªå®šä¹‰å±æ€§ã€‚ç„¶åé€šè¿‡ `var` å‡½æ•°åœ¨å…¨æ–‡èŒƒå›´å¤ç”¨ã€‚

> è‡³äºä¸ºä»€ä¹ˆé‡‡ç”¨ `--`ï¼Œå¤§æ¦‚æ˜¯å› ä¸º `@` è¢« [Less](https://lesscss.org/) å ç”¨äº†ï¼Œ`$` è¢« [Sass](https://sass-lang.com/) å ç”¨äº†å§ã€‚

#### 1.1 è¯­æ³•

å®šä¹‰ CSS å˜é‡çš„è¯­æ³•éå¸¸ç®€å•ï¼Œåœ¨å˜é‡åç§°ä¹‹å‰æ·»åŠ ä¸¤ä¸ªçŸ­æ¨ªçº¿ `--`ï¼š

```css
--<custom-property-name>: <declaration-value>
```
å…¶ä¸­ `<custom-property-name>` è¡¨ç¤ºå˜é‡åç§°ï¼Œ`<declaration-value>` è¡¨ç¤ºå˜é‡å€¼ï¼Œå½¢å¦‚ï¼š`--*`ã€‚è¿™ç±»è‡ªå®šä¹‰ CSS å±æ€§ä¸ `color`ã€`font-size`ã€`background-image` ç­‰å±æ€§å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œåªæ˜¯å®ƒæ²¡æœ‰é»˜è®¤å«ä¹‰ç½¢äº†ï¼Œå®ƒå¿…é¡»é€šè¿‡ `var()` å‡½æ•°å¤ç”¨ä¹‹åï¼Œæ‰ä¼šäº§ç”Ÿæ„ä¹‰ã€‚

å…¶ä¸­ã€Œå˜é‡åç§°ã€å‘½åçº¦æŸæ˜¯æ¯”è¾ƒå®½æ¾çš„ï¼Œå¯ä»¥æ˜¯æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ `_`ã€çŸ­æ¨ªçº¿ `-` çš„ç»„åˆï¼Œä½†ä¸èƒ½åŒ…å« `$`ã€`[`ã€`^`ã€`(`ã€`%` ç­‰å­—ç¬¦ã€‚æ¯”å¦‚ï¼š

```css
--some-keyword: left;
--some-color: #f00;
--some-complex-value: 3px 6px rgb(20, 32, 54);
```

ç”šè‡³å¯ä»¥æ˜¯ä»¥æ•°å­—å¼€å¤´ã€ä¹Ÿå¯ä»¥æ˜¯ä¸­æ–‡ã€éŸ©æ–‡ç­‰ã€‚

 ```css
:root {
  --çº¢è‰²: #f00; /* æœ‰æ•ˆ */
  --1: 1px; /* æœ‰æ•ˆ */
}

body {
  background-color: var(--çº¢è‰²);
  height: var(--1);
}
```

å½“ç„¶ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œåƒä¸‡åˆ«ä»¥è¿™ç§èŠ±é‡Œèƒ¡å“¨ã€å¥‡å¥‡æ€ªæ€ªçš„ç»„åˆæ¥å‘½åå˜é‡åç§°ï¼Œä¸»è¦æ˜¯é¿å…è¢«æ‰“ã€‚å»ºè®®ä½¿ç”¨ `kebab-case` æ–¹å¼è¿›è¡Œå‘½åï¼Œæ¯”å¦‚ `--theme-primary` ç­‰ã€‚

> è¯·æ³¨æ„ï¼ŒCSS å˜é‡åç§°æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œ`--foo` å’Œ `--Foo` æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ã€‚è¿™ä¸€ç‚¹ä¸ CSS å±æ€§å¤§å°å†™ä¸æ•æ„Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚

#### 1.2 ä½œç”¨åŸŸ

åŒä¸€ä¸ª CSS å˜é‡ï¼Œå¯ä»¥åœ¨å¤šä¸ªé€‰æ‹©å™¨å†…å£°æ˜ï¼Œè¯»å–é¡ºåºä¸ CSS åŒ¹é…è§„åˆ™ä¸€è‡´ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„ç”Ÿæ•ˆã€‚è¯·æ³¨æ„ï¼ŒCSS å˜é‡å¹¶æ²¡æœ‰ `!important` ç”¨æ³•ï¼Œå˜é‡çš„è¦†ç›–è§„åˆ™ç”± CSS é€‰æ‹©å™¨æƒé‡å†³å®šã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¨å±€æ€§å˜é‡æ”¾åœ¨ `:root` å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»æ„å…ƒç´ ä¸­å£°æ˜ CSS å˜é‡ï¼Œè§†å®é™…æƒ…å†µè€Œå®šå³å¯ã€‚å¦‚æœæ˜¯å°ç¨‹åºï¼Œåˆ™åœ¨å…¨å±€æ ·å¼ `app.wxss` çš„ `page` å†…å£°æ˜ã€‚

> `:root`Â è¿™ä¸ª CSSÂ [ä¼ªç±»](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-classes)åŒ¹é…æ–‡æ¡£æ ‘çš„æ ¹å…ƒç´ ã€‚å¯¹äº HTML æ¥è¯´ï¼Œ**`:root`**Â è¡¨ç¤ºÂ [`<html>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/html)Â å…ƒç´ ï¼Œé™¤äº†[ä¼˜å…ˆçº§](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Specificity)æ›´é«˜ä¹‹å¤–ï¼Œä¸Â `html`Â é€‰æ‹©å™¨ç›¸åŒã€‚


```css
:root {
  --theme-primary: #f00; /* å…¨å±€å¯å¤ç”¨ */
}

header {
  --theme-primary: #0f0; /* ä»… header èŒƒå›´å†…å¯å¤ç”¨ */
}

section {
  --theme-primary: #00f; /* ä»… section èŒƒå›´å†…å¯å¤ç”¨ */
}
```

æ¯”å¦‚ `<section>` å†…ä½¿ç”¨ `color: var(--theme-primary)`ï¼Œç”Ÿæ•ˆçš„å°†ä¼šæ˜¯ `color: #00f`ã€‚å†è€…ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåœ¨ `<div id="error"></div>` ä¸­å¼•ç”¨ `--color` å˜é‡ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯ ID é€‰æ‹©å™¨çš„å˜é‡å€¼ã€‚

```css
:root {
  --color: #f00;
}

div {
  --color: #0f0;
}

#id {
  --color: #00f;
}
```

æ€»çš„æ¥è®²ï¼ŒCSS å˜é‡æ˜¯æœ‰ä½œç”¨åŸŸæ¦‚å¿µçš„ï¼Œå®ƒåªèƒ½ä½œç”¨äºè‡ªèº«æˆ–åä»£å…ƒç´ ï¼Œè€Œå…„å¼Ÿå…ƒç´ ã€ç¥–å…ˆå…ƒç´ éƒ½æ˜¯ä¸ç”¨äº«ç”¨çš„ã€‚

å¯ä»¥è¯•ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼š[css-variable-scope-demo](https://codesandbox.io/s/css-variable-scope-demo-7p5rio)ã€‚

#### 1.3 å…¼å®¹æ€§

å…¼å®¹æ€§å¦‚ä¸‹ï¼Œè¿˜æ˜¯æŒºä¸é”™çš„ï¼ˆå¦‚æœå¿½ç•¥ IE çš„è¯ï¼‰ï¼Œæ›´å¤šè¯·çœ‹ [Can I use](https://caniuse.com/css-variables)ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-bc4e198b24a69ca4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¾ˆæ£’ ğŸ™„ï¼ŒIE å…¨ç³»ä¸æ”¯æŒï¼Œéª‚éª‚å’§å’§åœ°è¯´ï¼šè¿˜æ˜¯ç”¨ SCSS æˆ– LESS å§ã€‚å¯ä»¥å‚è€ƒä¸‹è¿™ä¸ªé¡¹ç›®ï¼š[css-vars-ponyfill](https://github.com/jhildenbiddle/css-vars-ponyfill)ã€‚

å¯¹äºä¸æ”¯æŒ CSS å˜é‡çš„æµè§ˆå™¨ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼å…¼å®¹å¤„ç†ï¼š

```
:root {
  --color-primary: #00f;
}

a {
  color: #00f;
  color: var(--color-primary);
}
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ `@supports` è§„åˆ™ï¼Œç„¶è€Œå®ƒä¹Ÿä¸å…¼å®¹ IE æµè§ˆå™¨ã€‚

```css
@supports (--foo: 0) {
  /* supported */
}

@supports (not (--foo: 0)) {
  /* unsupported */
}
```

## äºŒã€JavaScript æ“ä½œ

åˆ©ç”¨ `CSS.supports()` æ–¹æ³•å³å¯åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ CSS å˜é‡ï¼Œå¦‚ä¸‹ï¼š

```js
const isSupported = window.CSS.supports('--foo', 0)
```

ç”±äº CSS å˜é‡å°±æ˜¯è‡ªå®šä¹‰çš„ CSS å±æ€§å˜›ï¼Œå› æ­¤æŒ‰ç…§å¹³å¸¸è®¾ç½® CSS å±æ€§çš„æ–¹å¼å»æ“ä½œå³å¯ï¼Œå¦‚ä¸‹ï¼š

```js
const element = document.querySelector('selectors')

// å®šä¹‰ CSS å˜é‡
element.style.setProperty('--color', '#f00')

// è¯»å– CSS å˜é‡
element.style.getPropertyValue('--color', '#f00')

// åˆ é™¤ CSS å˜é‡
element.style.removeProperty('--color')
```

å¦å¤–æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç”¨æ³•ï¼ˆæ¥è‡ª [EXAMPLE 7](https://drafts.csswg.org/css-variables/#syntax)ï¼‰ï¼Œå¦‚ä¸‹ï¼š

```css
:root {
  --foo: if(x > 5) this.width = 10;
}
```

å°½ç®¡è¿™ä¸ªå±æ€§å€¼æ˜¯ã€Œæ— ç”¨ã€çš„ï¼Œä¸ä¼šä½¿å¾—ä»»æ„ CSS å±æ€§äº§ç”Ÿå®é™…æ•ˆæœï¼Œä½†æ˜¯è¿™ä¸ª CSS å˜é‡å®šä¹‰æ˜¯ã€Œæœ‰æ•ˆã€çš„ã€‚å®ƒå¯ä»¥è¢« JavaScript è¯»å–ï¼Œè‡³äºæœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ã€‚

## äºŒã€CSS å‡½æ•°

#### 2.1 var å‡½æ•°

`var()` å‡½æ•°ç”¨äºè¯»å– CSS å˜é‡ï¼Œå®ƒå¯ä»¥æ›¿ä»£å…ƒç´ ä¸­ã€Œä»»ä½•å±æ€§ã€ä¸­çš„ã€Œå€¼çš„ä»»ä½•éƒ¨åˆ†ã€ï¼Œä¸èƒ½ä½œä¸ºå±æ€§åã€é€‰æ‹©å™¨æˆ–å…¶ä»–å¤„ç†å±æ€§å€¼ä¹‹å¤–çš„å€¼ã€‚

è¯­æ³•å¦‚ä¸‹ï¼š

```css
var(<custom-property-name>[, <declaration-value>])
```

* `<custom-property-name>` è¡¨ç¤ºè‡ªå®šä¹‰å±æ€§å
* `<declaration-value>`ï¼ˆå¯é€‰ï¼‰è¡¨ç¤ºå£°æ˜å€¼ï¼ˆåå¤‡å€¼ï¼‰ï¼Œ**ä»…è‡ªå®šä¹‰å±æ€§æ²¡æœ‰å®šä¹‰æ—¶ï¼Œå®ƒæ‰ä¼šæœ‰æ•ˆ**ï¼ˆç±»ä¼¼ ES6 ä¸­çš„å‡½æ•°å‚æ•°è®¾å®šé»˜è®¤å€¼ï¼‰ã€‚

**2.1.1 CSS å˜é‡ä¸åˆæ³•çš„ç¼ºçœç‰¹æ€§**

çœ‹çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼Œå˜é‡ `--color` çš„å€¼ä¸º `20px`ï¼Œæ˜¾ç„¶å®ƒä½œä¸º `background-color` å€¼çš„è¯æ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆ `<body>` ä¼šæ˜¾ç¤ºä»€ä¹ˆèƒŒæ™¯é¢œè‰²å‘¢ï¼Ÿçº¢è‰²ï¼Ÿç»¿è‰²ï¼Ÿè¿˜æ˜¯...

```css
body {
  --color: 20px;
  background-color: #f00;
  background-color: var(--color, #0f0); /* æ­£ç¡®è¯­æ³•ï¼Œä¸ background-color: 20px æœ‰ç€æœ¬è´¨ä¸Šçš„åŒºåˆ« */
}
```

![](https://upload-images.jianshu.io/upload_images/5128488-9f4eb1f8d9923384.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å®ƒæœ€ç»ˆç”Ÿæ•ˆçš„å±æ€§å€¼ä¸º `transparent`ï¼Œå³ `background-color` çš„é»˜è®¤å€¼ï¼Œå› æ­¤ç›¸å½“äºï¼š

```css
body {
  --color: 20px;
  background-color: #f00;
  background-color: transparent;
}
```

ğŸ‘† å¯çœ‹ [EXAMPLE 13](https://drafts.csswg.org/css-variables/#using-variables)ã€‚

ä½†è¯·æ³¨æ„ï¼Œä»¥ä¸‹ç¤ºä¾‹ç”Ÿæ•ˆçš„æ˜¯ `background-color: #f00`ï¼Œå°±æ€•æœ‰äººçœ‹åˆ°ä¸Šé¢ç¤ºä¾‹ä¹‹åï¼Œå¯¹åŸæ¥çš„è®¤çŸ¥äº§ç”Ÿæ€€ç–‘ï¼Œç‰¹æ„è¯´æ˜ä¸‹ã€‚

```css
body {
  background-color: #f00; /* æœ‰æ•ˆ */
  background-color: 20px; /* è¯­æ³•é”™è¯¯ï¼Œè¿™æ¡è§„åˆ™å£°æ˜è¢«ä¸¢å¼ƒï¼Œå› æ­¤ä¸Šä¸€æ¡è§„åˆ™ç”Ÿæ•ˆ */
}
```

> å› æ­¤ï¼Œå½“ CSS å˜é‡å€¼ä¸åˆæ³•æ—¶ï¼Œç”Ÿæ•ˆçš„æ˜¯ CSS å±æ€§çš„â€œé»˜è®¤å€¼â€ã€‚
>
> ä½†æ³¨æ„ï¼ŒCSS å˜é‡å€¼ä¸åˆæ³•å¹¶ä¸èƒ½ä½¿å¾— `<declaration-value>` å£°æ˜å€¼ç”Ÿæ•ˆï¼Œå®ƒä»…é™äº CSS å˜é‡æ²¡æœ‰å®šä¹‰æ‰ä¼šç”Ÿæ•ˆï¼ˆç±»ä¼¼å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ä»…å®å‚ä¸º `undefined` æ‰ä¼šç”Ÿæ•ˆï¼Œå³ä¾¿æ˜¯ `null` ç­‰ falsy å®å‚ä¹Ÿä¸ä¼šä½¿å…¶ç”Ÿæ•ˆä¸€æ ·ï¼‰ã€‚

ä¸ºä»€ä¹ˆè¿™é‡Œé»˜è®¤å€¼è¦æ‰“åŒå¼•å·å‘¢ï¼ŒåŸå› æ˜¯æ ‡å‡† [EXAMPLE 13](https://drafts.csswg.org/css-variables/#using-variables) éƒ¨åˆ†æ˜ç¡®è¯´æ˜äº†ï¼š

> If the property was one thatâ€™s inherited by default, such asÂ [color](https://drafts.csswg.org/css-color-4/#propdef-color), it would compute to the inherited value rather than the initial value.

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ª CSS å±æ€§æ˜¯å¯ç»§æ‰¿çš„ï¼Œé‚£ä¸ªå½“å®ƒåº”ç”¨äº†ä¸€ä¸ªä¸åˆæ³•çš„ CSS å˜é‡å€¼ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯å…¶ç»§æ‰¿å€¼ï¼Œè€Œä¸æ˜¯é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼š

```html
<style>
  :root {
    --not-a-color: 20px;
  }

  body {
    color: #f00;
  }

  p {
    color: var(--not-a-color);
  }
</style>
<body>
  <p>å­—ä½“ä¼šæ˜¯ä»€ä¹ˆé¢œè‰²å‘¢ï¼Ÿ</p>
</body>
```
![](https://upload-images.jianshu.io/upload_images/5128488-2792ace894e4b6d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä½ çœ‹æœ€ç»ˆ `<p>` ç”Ÿæ•ˆçš„ `color` æ˜¯å…¶ä» `<body>` ä¸­ç»§æ‰¿è¿‡æ¥çš„ `#f00` çº¢è‰²ï¼Œè€Œä¸æ˜¯ `color` çš„é»˜è®¤é¢œè‰² [canvastext](https://developer.mozilla.org/en-US/docs/Web/CSS/color#formal_definition)ã€‚

æ’ä¸ªè¯é¢˜ï¼Œæˆ‘å¾ˆå¥½å¥‡ `canvastext` é¢œè‰²æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Œä¸€èˆ¬æ¥è¯´å®ƒä¼šæ˜¯é»‘è‰² `rgb(0, 0, 0)`ï¼Œç„¶åæˆ‘å°è¯•å°†ç³»ç»Ÿè°ƒè‡³æ·±è‰²æ¨¡å¼ï¼Œç„¶è€Œå®ƒå¹¶ä¸ä¼šé»˜è®¤å˜ä¸ºç™½è‰²ï¼Œå“ˆå“ˆã€‚ç„¶åæˆ‘ç¿»æŸ¥äº†ä¸‹æ ‡å‡†ï¼Œå‘ç°å®ƒè·Ÿ <system-color> æœ‰å…³ï¼Œå®ƒä¸€èˆ¬ç”±æµè§ˆå™¨æ¥å®šä¹‰ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œå¯çœ‹ [6.2 System Color](https://drafts.csswg.org/css-color-4/#css-system-colors) ç« èŠ‚ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-517c8504fb4797c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> å› æ­¤ï¼Œæ¯”è¾ƒä¸¥è°¨çš„è¯´æ³•æ˜¯ï¼šå½“ CSS å˜é‡å€¼ä¸åˆæ³•æ—¶ï¼Œç”Ÿæ•ˆçš„æ˜¯ CSS å±æ€§çš„ç»§æ‰¿å€¼æˆ–åˆå§‹å€¼ã€‚

**2.1.2 var å‡½æ•°çš„å°¾éšç©ºæ ¼**

```html
<style>
  body {
    --size: 20;
    font-size: var(--size)px;
  }
</style>
<body>
  <p>å­—å·æ˜¯å¤šå¤§å‘¢ï¼Ÿ</p>
</body>
```
çŒœä¸€ä¸‹ `font-size` ä¼šæ˜¯é¢„æœŸçš„ `20px` å—ï¼Ÿå®ƒä¸æ˜¯ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-b44033e8423f2558.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¯·æ³¨æ„ï¼Œæµè§ˆå™¨æœ€ç»ˆè§£æå‡ºæ¥çš„è§„åˆ™æ˜¯ï¼š`font-size: var(--size) px;`ï¼Œå®ƒåœ¨ `var(--size)` å’Œ `px` ä¹‹é—´å¤šäº†ä¸€ä¸ªã€Œç©ºæ ¼ã€ï¼Œå› æ­¤è¿™æ¡è§„åˆ™æ˜¯æ— æ•ˆçš„ï¼ˆæ³¨æ„å¹¶ä¸æ˜¯å¼•ç”¨ CSS å˜é‡æ— æ•ˆï¼‰ï¼Œæ‰€ä»¥å­—å·æ˜¯æµè§ˆå™¨é»˜è®¤å­—ä½“å¤§å° `16px`ã€‚

å¦‚æœä½ ä½¿ç”¨è¯¸å¦‚ VS Code ç­‰ç¼–è¾‘å™¨ï¼Œå®ƒä¸€èˆ¬ä¼šæœ‰ `semi-colon expected` é”™è¯¯æé†’çš„ï¼Œå¦‚æœä¿å­˜è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œå®ƒå°†ä¼šè¢«ä¿å­˜ä¸ºï¼š`font-size: var(--size) px;`ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-8b6f5de892b940e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


è¿™ç§æƒ…å†µå¯ç»“åˆ `calc()` å‡½æ•°å¤„ç†ï¼Œæ¯”å¦‚ï¼š

```css
body {
  --size: 20;
  font-size: calc(var(--size) * 1px); /* è¿™æ ·å°±èƒ½æ­£å¸¸è®¡ç®—å¾—å‡º 20px äº† */
}
```
ä½†ä¸ªäººæ›´æ¨èè¿™æ ·ç”¨ï¼šå¯¹äºä¸€äº›é•¿åº¦ã€å¤§å°ç­‰ CSS å±æ€§å€¼ï¼Œåœ¨å®šä¹‰ CSS å˜é‡æ—¶ï¼Œåº”å¸¦ä¸Šå•ä½ï¼š

```css
body {
  --size: 20px;
  font-size: var(--size);
}
```

> è¯·æ³¨æ„ï¼Œå¦‚æœå˜é‡å€¼åŒ…å«å•ä½ï¼Œå°±ä¸èƒ½å†™æˆå­—ç¬¦ä¸²å½¢å¼ã€‚

```css
body {
  --size: '20px';
  font-size: var(--size); /* æ³¨æ„ï¼ŒCSS å˜é‡å¼•ç”¨çš„è¯­æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ç» CSS è§£æå™¨è®¡ç®—ä¹‹åï¼Œå…¶å€¼å¹¶ä¸ç¬¦åˆ font-size å±æ€§å€¼çš„è¦æ±‚ï¼Œå› æ­¤è¢«åˆ¤å®šä¸ºè¯­æ³•é”™è¯¯ï¼Œè§„åˆ™ä¼šè¢«ä¸¢å¼ƒã€‚ */
}
```

ç›¸å½“äº `font-size: '20px';` è¯­æ³•é”™è¯¯ï¼Œè§„åˆ™ä¼šè¢«ä¸¢å¼ƒï¼Œå› æ­¤å–å…¶ç»§æ‰¿å€¼æˆ–é»˜è®¤å€¼ã€‚

**2.1.3 CSS å˜é‡çš„ç›¸äº’ä¼ é€’æ€§**

æˆ‘ä»¬åœ¨æŸä¸ªé€‰æ‹©å™¨ä¸­å®šä¹‰äº†ä¸€ä¸ª CSS å˜é‡ï¼Œå®ƒé™¤äº†åœ¨å­å…ƒç´ ä¸­è¢«å¤ç”¨ï¼Œå®ƒæœ¬èº«ä½œç”¨åŸŸå†…ä¹Ÿå¯ä»¥å¤ç”¨ï¼Œè€Œä¸”ä¸ç¼–å†™é¡ºåºæ— å…³ã€‚æ¯”å¦‚ï¼š

```css
body {
  --size: 20px;
  font-size: var(--size);
}
```

```
body {
  font-size: var(--size);
  --size: 20px;
}
```

ä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹ï¼Œå‡æ˜¯æœ‰æ•ˆçš„ã€‚åè€…å¹¶ä¸ä¼šå› ä¸º `--size: 20px;` å®šä¹‰åœ¨åï¼Œå°±ä¸ä¼šç”Ÿæ•ˆã€‚è¿™æ ·è§„åˆ™ï¼Œå¯¹äºæˆ‘ä»¬é€šè¿‡ JavaScript åŠ¨æ€è®¾ç½® CSS å˜é‡æœ‰ç€éå¸¸é‡è¦çš„æ„ä¹‰ã€‚

#### 2.2 calc å‡½æ•°

`calc()` è¯­æ³•éå¸¸åœ°ç®€å•ï¼Œå¦‚ä¸‹ï¼š

```
property: calc(expression)
```

è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå®ƒçš„å‚æ•°ï¼Œè¡¨è¾¾å¼çš„è¿”å›å€¼ä½œä¸º `calc()` å‡½æ•°çš„å€¼ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯ `+`ã€`-`ã€`*`ã€`/` çš„ç»„åˆï¼Œè€Œä¸”å¯ä»¥æ··ç”¨ä¸åŒå•ä½è¿›è¡Œè¿ç®—ã€‚

å®ƒåŒæ ·æ”¯æŒ CSS å˜é‡ï¼Œä¾‹å¦‚ï¼š

```css
.foo {
  --height: 30px;
  width: calc(100% - 30px);
  height: calc(100vh - var(--height))
}
```

æ³¨æ„ç‚¹ï¼š

* å¯¹äº `+` å’Œ `-` è¿ç®—ï¼Œè¿ç®—ç¬¦ä¸¤è¾¹å¿…é¡»è¦æœ‰ã€Œç©ºæ ¼ã€ï¼Œè€Œ `*` å’Œ `/` è¿ç®—åˆ™æ²¡æœ‰è¦æ±‚ï¼Œå› æ­¤å»ºè®®éƒ½åŠ ä¸Šç©ºç™½ç¬¦ã€‚
* å¯¹äº `*` è¿ç®—ï¼Œå‚ä¸è¿ç®—çš„è‡³å°‘æœ‰ä¸€ä¸ªæ•°å€¼ï¼ˆ[<number>](https://developer.mozilla.org/zh-CN/docs/Web/CSS/number)ï¼‰ï¼Œä¸”ä¸èƒ½ä¸º `0`ã€‚
* å¯¹äº `/` è¿ç®—ï¼Œè¿ç®—ç¬¦ `/` å³ä¾§å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å€¼ï¼ˆ[<number>](https://developer.mozilla.org/zh-CN/docs/Web/CSS/number)ï¼‰ã€‚
* `calc()` å‡½æ•°æ”¯æŒåµŒå¥—å†™æ³•ï¼Œä½†å…¶å®è¢«åµŒå¥—çš„ `calc()` å‡½æ•°åªä¼šè¢«å½“åšæ™®é€šçš„æ‹¬å·ï¼Œå› æ­¤å‡½æ•°å†…ç›´æ¥ä½¿ç”¨æ‹¬å·å°±å¥½äº†ã€‚

é‚£ä¹ˆåµŒå¥—è¯­æ³•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œæ¯”å¦‚ï¼š

```css
.foo {
  --widthA: 100px;
  --widthB: calc(var(--widthA) / 2);
  --widthC: calc(var(--widthB) / 2);
  width: var(--widthC);
}
```

é‚£ä¹ˆï¼Œä»¥ä¸Š `--widthC` çš„å€¼å°±ä¼šå˜æˆ `calc(calc(100px / 2) / 2)`ï¼Œå³ `25px`ã€‚

Web å‰ç«¯æ€»æ˜¯ç»•ä¸å¼€å…¼å®¹æ€§ï¼Œé‚£ä¹ˆçœ‹ä¸‹ `calc()` å‡½æ•°çš„å…¼å®¹æ€§å¦‚ä½•ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-f64dd288d7edc1b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç»¿æ‚ æ‚ çš„ä¸€ç‰‡ï¼Œç”šå¥½ï¼å¯ä»¥çœ‹åˆ° IE9 ä»¥ä¸Šéƒ½æ”¯æŒï¼Œå¯ IE æµè§ˆå™¨ä¸æ”¯æŒåµŒå¥—å†™æ³•ï¼Œç”±äº IE æµè§ˆå™¨éƒ½ä¸æ”¯æŒ CSS å˜é‡ï¼Œå› æ­¤è¿™ä¸ªæ— ä¼¤å¤§é›…ã€‚

#### 2.3 env å’Œ constant å‡½æ•°

<!--

å¾€ä¸‹ä¹‹å‰ï¼Œäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼ˆ[æ›´å¤šè¯·çœ‹](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Viewport_concepts)ï¼‰ï¼š

> * è§†å£ï¼ˆViewportï¼‰ï¼šåœ¨ Web æµè§ˆå™¨ä¸­ï¼Œé€šå¸¸ä¸æµè§ˆå™¨çª—å£ç›¸åŒï¼Œä½†ä¸åŒ…æ‹¬æµè§ˆå™¨åº”ç”¨æœ¬èº«çš„ UIã€åœ°å€æ ã€ä¹¦ç­¾æ ç­‰ï¼Œå³æŒ‡ä½ æ­£åœ¨æµè§ˆçš„æ–‡æ¡£çš„é‚£ä¸€éƒ¨åˆ†ã€‚
> * å¯è§†è§†å£ï¼ˆVisual Viewportï¼‰ï¼šè¡¨ç¤ºè§†å£å½“å‰å¯è§çš„éƒ¨åˆ†ã€‚
> * å¸ƒå±€è§†å£ (layout viewport) 
> * å¯è§†è§†å£å¯èƒ½ä¼šæ¯”å¸ƒå±€è§†å£ï¼ˆlayout viewport ï¼‰æ›´å°ï¼Œå› ä¸ºå½“ç”¨æˆ·ç¼©å°æµè§ˆå™¨ç¼©æ”¾æ¯”ä¾‹æ—¶ï¼Œå¸ƒå±€è§†å£ä¸å˜ï¼Œè€Œå¯è§†è§†å£å˜å°äº†ã€‚

-->

2017 å¹´ Apple å…¬å¸å‘å¸ƒäº† iPhone X å’Œ iOS 11ï¼Œå¼€å¯äº†ã€Œåˆ˜æµ·å±ã€å’Œåº•éƒ¨å°æ¨ªæ¡ä¹‹è·¯ã€‚

äºæ˜¯å°±æœ‰äº†ã€Œå®‰å…¨åŒº Safe Areaã€ä¹‹è¯´ï¼ˆ[è¯¦è§](https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/#Layout%20Guides%20and%20Safe%20Area)ï¼‰ï¼š

> A safe area defines the area within a view that isnâ€™t covered by a navigation bar, tab bar, toolbar, or other views a view controller might provide.

ç®€å•æ¥è®²ï¼Œä»¥ iPhone X ä¸ºä¾‹ï¼Œå…¶å®‰å…¨åŒºæ˜¯æŒ‡ä¸å—åˆ˜æµ·ï¼ˆSensor Housingï¼‰ã€åº•éƒ¨å°æ¨ªæ¡ï¼ˆHome Indicatorï¼‰ã€è®¾å¤‡åœ†è§’ï¼ˆCornersï¼‰å½±å“çš„åŒºåŸŸï¼Œå¦‚ä¸‹å›¾çš„æµ…è“è‰²åŒºåŸŸæ‰€ç¤ºï¼Œå…¶ä¸­ç²‰è‰²éƒ¨åˆ†æ˜¯æŒ‡æµè§ˆå™¨é»˜è®¤çš„ Margin å€¼ï¼Œé€šå¸¸ä¸ºäº†æŠ¹å¹³å„æµè§ˆå™¨ä¸åŒçš„å¤–è¾¹è·ï¼Œéƒ½ä¼šè®¾ç½® `* { margin: 0 }`ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-d59d12b5798c6372.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


æˆ‘ä»¬çŸ¥é“ï¼ŒViewport æ˜¯è§„åˆ™çš„çŸ©å½¢ï¼Œå¦‚æœæ˜¾ç¤ºè®¾å¤‡çš„å±å¹•æ˜¯ä¸è§„åˆ™ï¼ˆæ¯”å¦‚åœ†å½¢ï¼‰çš„è¯ï¼Œé¡µé¢ä¸­çš„æŸäº›éƒ¨åˆ†å°±ä¼šè¢«è£å‰ªã€‚é‚£ä¹ˆ `viewport-fit` å¯ä»¥é€šè¿‡è®¾ç½®å¯è§† Viewport å¤§å°æ¥æ§åˆ¶è£å‰ªåŒºåŸŸã€‚

å…¶ä¸­ `viewport-fit` æä¾›äº† `auto`ï¼ˆé»˜è®¤ï¼‰ã€`contain`ã€`cover` ä¸‰ç§å±æ€§å€¼ï¼ˆ[è¯¦è§](https://www.w3.org/TR/css-round-display-1/#extending-viewport-rule)ï¼‰ï¼š

```html
<meta name="viewport" content="viewport-fit=auto|contain|cover" />
```

| å±æ€§å€¼ | æè¿° |
| --- | --- |
| `auto` | é»˜è®¤å€¼ï¼Œè¡¨ç°ä¸ `contain` ä¸€è‡´ï¼ŒViewport ä¼šæ˜¾ç¤ºåœ¨ã€Œå®‰å…¨åŒºã€ä¹‹å†…ï¼Œç›¸å½“äº `viewport-fit: contain`ã€‚ |
| `contain` | å°†å¯è§† Viewport è®¾ç½®ä¸ºé¡µé¢æ‰€æœ‰å†…å®¹å‡å¯è§çš„æœ€å¤§çŸ©å½¢ã€‚ |
| `cover` | å°†å¯è§† Viewport å¤§å°è®¾ç½®ä¸ºæ˜¾ç¤ºè®¾å¤‡å±å¹•çš„å¤–æ¥çŸ©å½¢ã€‚  |

ä»¥åœ†å½¢å±å¹•ä¸ºä¾‹ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-40f1dd5f01108829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Apple å…¬å¸ä¸ºäº†é€‚é…æ——ä¸‹çš„å…¨é¢å±è®¾å¤‡ï¼Œï¼ˆiOS 11 èµ·ï¼‰WebKit å†…æ ¸çš„æµè§ˆå™¨ä¸­å®šä¹‰äº† `safe-area-inset-*` å››ä¸ªç¯å¢ƒå˜é‡ã€‚

* `safe-area-inset-top`
* `safe-area-inset-right`
* `safe-area-inset-bottom`
* `safe-area-inset-left`

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç«–å±å’Œæ¨ªå±çŠ¶æ€ä¸‹ï¼Œ`safe-area-inset-*` å€¼æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ï¼Œç«–å±çŠ¶æ€ä¸‹ç¯å¢ƒå˜é‡ `safe-area-inset-left` å’Œ `safe-area-inset-right` çš„å€¼ä¸º `0`ï¼Œæ¨ªå±çŠ¶æ€ä¸‹ç¯å¢ƒå˜é‡ `safe-area-inset-top` çš„å€¼ä¸º `0`ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-217dc9c3b5c7eac7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¸Šå›¾æºè‡ª [Deng's Blog](https://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/)ã€‚

é€šè¿‡ `env()` æˆ– `constant()` å‡½æ•°å°±èƒ½å¼•ç”¨ä»¥ä¸Šå‡ ä¸ªç¯å¢ƒå˜é‡ï¼Œå¯¹äºä¸æ”¯æŒ `env()` æˆ– `constant()` çš„æµè§ˆå™¨ï¼ŒåŒ…å«å®ƒçš„æ ·å¼è§„åˆ™å°†è¢«å¿½ç•¥ã€‚

> è‡ª Safari Technology Preview 41 å’Œ iOS 11.2 beta èµ·ï¼Œ`constant()` å‡½æ•°å·²è¢«ç§»é™¤ï¼Œå¹¶ç”¨ `env()` å‡½æ•°æ›¿æ¢ï¼ˆ[è¯¦è§](https://webkit.org/blog/7929/designing-websites-for-iphone-x/)ï¼‰ã€‚å¯ä¸ºäº†å…¼å®¹æ€§ï¼Œä¸€èˆ¬ä¸¤ä¸ªéƒ½ä¼šå†™ã€‚

> å¦å¤–ï¼Œè‹¥è¦ç¯å¢ƒå˜é‡ `safe-area-inset-*` ç”Ÿæ•ˆï¼Œéœ€å°†é¡µé¢è®¾ç½®ä¸º `viewport-fit: cover`ã€‚


æ¥ä¸‹æ¥ï¼Œä¼šä»‹ç»å¦‚ä½•é€‚é… iPhone X ç³»åˆ—åˆ˜æµ·å±æ‰‹æœºï¼Œæœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      body {
        width: 100%;
        background-color: darkorange;
      }

      .container {
        height: 100%;
        min-height: 200vh;
        background-color: forestgreen;
      }
    </style>
  </head>
  <body>
    <div class="container"></div>
  </body>
</html>
```

å½“æˆ‘ä»¬ä¸åšä»»ä½•å¤„ç†ï¼Œä»¥ä¸Šç¤ºä¾‹åœ¨ iPhone X ç³»åˆ—æ‰‹æœºæ¨ªå±çŠ¶æ€ä¸‹ï¼Œå·¦å³è¾¹æ¡†ä¼šç©ºå‡ºä¸€éƒ¨åˆ†ï¼Œç©¶å…¶åŸå› å°±æ˜¯ Safari æµè§ˆå™¨ä¼šå°†ç½‘é¡µå†…å®¹ç½®äºã€Œå®‰å…¨åŒºä¹‹å†…ã€ï¼Œç›¸å½“äº `viewport-fit: contain`ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-91a5299ed7acf9a9.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å½“æˆ‘ä»¬å°† `<meta>` æ ‡ç­¾å†…çš„ `viewport-fit` æ”¹ä¸º `cover` ä¹‹åï¼Œå¹¶åœ¨é¡µé¢ä¸­æ·»åŠ ä¸€é¦–è¯—ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-3e7f2a8f3cadec8a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™æ ·ï¼ŒViewport å°±å æ»¡äº†æ˜¾ç¤ºè®¾å¤‡æœ€å¤§çš„çŸ©å½¢ï¼Œä½†å› ä¸ºè®¾å¤‡çš„åˆ˜æµ·ã€åœ†è§’ç­‰å› ç´ ï¼Œä¼šå¯¼è‡´é¡µé¢ä¸­çš„éƒ¨åˆ†å†…å®¹æ— æ³•å®Œå…¨æ˜¾ç¤ºã€‚

ç„¶åï¼Œæˆ‘ä»¬è¯•ç€åœ¨ `container` å†…æ·»åŠ å·¦å³å¤–è¾¹è·ï¼Œå…¶å€¼åˆ†åˆ«å– `safe-area-inset-left`ã€`safe-area-inset-right` ç¯å¢ƒå˜é‡ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      body {
        width: 100%;
        background-color: darkorange;
      }

      .container {
        height: 100%;
        min-height: 200vh;
        background-color: forestgreen;

        /* æ–°å¢ */
        margin-left: env(safe-area-inset-left);
        margin-right: env(safe-area-inset-left);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <article>
        <h1>è’¹è‘­</h1>
        <p>è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚</p>
        <p>è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚</p>
        <p>è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚</p>
        <p></p>
      </article>
    </div>
  </body>
</html>
```

æ¨ªå±ã€ç«–å±æ˜¾ç¤ºå¦‚ä¸‹ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-5c60fdf041d3b477.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è€ƒè™‘ `env()` å’Œ `constant()` å‡½æ•°å…¼å®¹æ€§çš„å†™æ³•å¦‚ä¸‹ï¼š

```css
@supports (bottom: constant(safe-area-inset-bottom)) or (bottom: env(safe-area-inset-bottom)) {
  .container {
    /* è¯·æ³¨æ„ï¼Œconstant å’Œ env å…ˆåé¡ºåºå¦‚ä¸‹ */
    margin-left: constant(safe-area-inset-left); /* å…¼å®¹ iOS < 11.2 */
    margin-left: env(safe-area-inset-left); /* å…¼å®¹ iOS >= 11.2 */

    margin-right: constant(safe-area-inset-right);
    margin-right: env(safe-area-inset-right);
  }
}
```

#### 2.4 max å’Œ min å‡½æ•°


ä»æ–‡ç« æ’ç‰ˆæ¥çœ‹ï¼Œè¿™æ˜¯æä¸ç¾è§‚çš„ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å·¦å³ä¸¤è¾¹å†åŠ ç‚¹å†…è¾¹è·ã€‚PSï¼šä¸Šè¿°å›¾ç‰‡ä¸ºäº†æ›´æ–¹ä¾¿å¯¹æ¯”ï¼Œé‡‡ç”¨äº†å¤–è¾¹è·ï¼ˆMarginï¼‰ï¼Œæ¥ä¸‹æ¥ä¼šå°†å…¶ä¿®æ”¹ä¸ºå†…è¾¹è·ï¼ˆPaddingï¼‰ã€‚

```css
.container {
  /* è¿™é‡Œå°†åŸå…ˆçš„ margin ä¿®æ”¹ä¸º padding */
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-left);
}
```

> ä½†æœ‰ä¸ªå°å°çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªå¸Œæœ›ç«–å±çŠ¶æ€ä¸‹ï¼Œæ·»åŠ  `10px` çš„å·¦å³å†…è¾¹è·ï¼Œè€Œæ¨ªå±çŠ¶æ€ä¸‹å– `safe-area-inset-*` çš„å€¼å°±å¥½ã€‚

å®ƒä»¬æä¾›äº†ä¸¤ä¸ª CSS å‡½æ•°ï¼š`min()` å’Œ `max()`ï¼Œåˆ©ç”¨å®ƒä»¬å°±èƒ½å®ç°è¿™éœ€æ±‚ã€‚

```css
.container {
  /* è¿™é‡Œä½¿ç”¨åˆ° max() å‡½æ•°ï¼Œè¡¨ç¤ºå–äºŒè€…æœ€å¤§å€¼ã€‚ */
  padding-left: max(10px, env(safe-area-inset-left));
  padding-right: max(10px, env(safe-area-inset-left));
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-9f4a3eacd37279d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¦‚æœè€ƒè™‘å…¼å®¹æ€§çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ `@supports` è¯­æ³•æ¥å¤„ç†ï¼š

```css
@supports (padding: max(0px)) {
  .container {
    padding-left: max(10px, env(safe-area-inset-left));
    padding-right: max(10px, env(safe-area-inset-left));
  }
}
```

å¯¹äº `max()` å’Œ `min()` çš„è¯­æ³•å’Œä½¿ç”¨éå¸¸åœ°ç®€å•ï¼Œåˆ†åˆ«è¡¨ç¤ºå–æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚

ä¸¤è€…è¯­æ³•æ˜¯ä¸€è‡´çš„ï¼Œä»¥ `max` ä¸ºä¾‹ï¼š

```css
property: max(expression [, expression])
```

å®ƒæ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œè‹¥æœ‰å¤šä¸ªå€¼åˆ™é‡‡ç”¨é€—å· `,` åˆ†éš”ï¼Œé€‰æ‹©æœ€å¤§çš„å€¼ä½œä¸º CSS å±æ€§çš„å€¼ã€‚æ¯ä¸ªå€¼é™¤äº†å¯ä»¥æ˜¯ç›´æ¥æ•°å€¼ï¼Œè¿˜å¯ä»¥æ˜¯æ•°å­¦è¿ç®—ï¼ˆå¦‚ `calc()`ï¼‰ã€å…¶ä»–è¡¨è¾¾å¼ï¼ˆå¦‚ `attr()`ï¼‰ã€‚

è¿˜æ”¯æŒåµŒå¥— `max()` å’Œ `min()` å‡½æ•°ï¼Œéœ€è¦æ—¶å¯ä»¥ä½¿ç”¨å°æ‹¬å· `()` æ¥è®¾å®šè¿ç®—é¡ºåºã€‚

å…¼å®¹æ€§å¦‚ä¸‹ï¼Œä¸€å¦‚æ—¢å¾€ IE å…¨ç³»ä¸æ”¯æŒï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-07a568a13c56b1e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


> è‡³æ­¤ï¼Œç›¸ä¿¡ä½ å¯¹ iPhone X ç­‰æœºå‹çš„é€‚é…æœ‰æ›´æ·±åˆ»çš„äº†è§£ï¼Œé€‚é…èµ·æ¥å°±å®Œå…¨æ²¡æœ‰å‹åŠ›äº†ã€‚

## ä¸‰ã€CSS At-rules

ä¸€ä¸ª at-rule æ˜¯ä¸€ä¸ª CSS è¯­å¥ï¼Œå®ƒä»¥ `@` ç¬¦å·å¼€å¤´ï¼Œåæ¥ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶åŒ…æ‹¬ç›´åˆ°ä¸‹ä¸€ä¸ªåˆ†å· `;` çš„æ‰€æœ‰å†…å®¹æˆ–ä¸‹ä¸€ä¸ª CSS å—ï¼Œä»¥å…ˆåˆ°è€…ä¸ºå‡†ã€‚

ä¸»è¦å¯åˆ†ä¸ºä¸å¯åµŒå¥—ã€å¯åµŒå¥—ä¸¤ç±»ï¼š

**ä¸å¯åµŒå¥— at-ruleï¼š**

* `@charset`ï¼šæŒ‡å®šæ ·å¼è¡¨ä¸­ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ã€‚
* `@import`ï¼šå¯¼å…¥å…¶ä»–å¤–éƒ¨æ ·å¼è¡¨ã€‚
* `@namespace`ï¼šæŒ‡ç¤º  CSS å¼•æ“å¿…é¡»è€ƒè™‘XMLå‘½åç©ºé—´ã€‚

**å¯åµŒå¥— at-ruleï¼š**

* `@media`ï¼šç”¨äºåŸºäºä¸€ä¸ªæˆ–å¤šä¸ªåª’ä½“æŸ¥è¯¢çš„ç»“æœæ¥åº”ç”¨æ ·å¼è¡¨ä¸­çš„ä¸€éƒ¨åˆ†ã€‚
* `@font-face`ï¼šæŒ‡å®šä¸€ä¸ªç”¨äºæ˜¾ç¤ºæ–‡æœ¬çš„è‡ªå®šä¹‰å­—ä½“ã€‚
* `@keyframs`ï¼šé€šè¿‡åœ¨åŠ¨ç”»åºåˆ—ä¸­å®šä¹‰å…³é”®å¸§çš„æ ·å¼æ¥æ§åˆ¶ CSS åŠ¨ç”»åºåˆ—ä¸­çš„ä¸­é—´æ­¥éª¤ã€‚
* `@supports`ï¼šæŒ‡å®šä¾èµ–äºæµè§ˆå™¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„ CSS åŠŸèƒ½çš„æ”¯æŒå£°æ˜ã€‚
* `@document`ï¼šæ ¹æ®æ–‡æ¡£çš„ URL é™åˆ¶å…¶ä¸­åŒ…å«çš„æ ·å¼è§„åˆ™çš„ä½œç”¨èŒƒå›´ï¼ˆå®éªŒç‰¹æ€§ï¼‰ã€‚
* `@page`ï¼šç”¨äºåœ¨æ‰“å°æ–‡æ¡£æ—¶ä¿®æ”¹æŸäº› CSS å±æ€§ã€‚

æ¯ä¸ª at-rule è§„åˆ™éƒ½æœ‰ä¸åŒçš„è¯­æ³•ï¼Œæœ‰ä¸€éƒ¨åˆ† at-rule å¯ä»¥å½’ä¸ºä¸€ç±»ï¼š**æ¡ä»¶è§„åˆ™ç»„**ã€‚

> è¿™äº›è§„åˆ™ç»„æ‰€æŒ‡çš„æ¡ä»¶æ€»ç­‰æ•ˆäº `true` æˆ– `false`ï¼Œå¦‚æœä¸º `true` é‚£ä¹ˆå®ƒé‡Œé¢çš„ CSS è¯­å¥ç”Ÿæ•ˆã€‚

æœ¬æ–‡ä»…ä»‹ç» `@supports` å’Œ `@media`ï¼Œå…¶ä»–è§„åˆ™è¯·çœ‹ [CSS At-rules](https://developer.mozilla.org/zh-CN/docs/Web/CSS/At-rule)ã€‚

#### 3.1 @supports

`@supports` å¸¸ç”¨äº CSS å…¼å®¹æ€§åˆ¤æ–­ã€‚

å®ƒç”±ä¸€ç»„æ”¯æŒæ¡ä»¶å’Œä¸€ç»„æ ·å¼å£°æ˜ç»„æˆã€‚æ”¯æŒæ¡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä½¿ç”¨é€»è¾‘ä¸ `and`ã€é€»è¾‘æˆ– `or`ã€é€»è¾‘é `not` ç»„åˆè€Œæˆã€‚

* å•ä¸€æ¡ä»¶ï¼šç”±ä¸€ä¸ª CSS å±æ€§å’Œå±æ€§å€¼ç»„æˆï¼Œä¸­é—´ç”¨åˆ†å· `;` éš”å¼€ã€‚

```css
@supports (transform-origin: 5% 5%) {
  /* æ ·å¼å£°æ˜ */
}
```
å½“ `transform-origin` çš„å®ç°è¯­æ³•è®¤ä¸º `5% 5%` æ˜¯æœ‰æ•ˆçš„å€¼ï¼Œè¡¨è¾¾å¼ä¼šè¿”å› `true`ï¼Œæ­¤æ—¶è§„åˆ™å†…å£°æ˜çš„æ ·å¼å°±ä¼šç”Ÿæ•ˆã€‚


* å¤šä¸ªæ¡ä»¶ï¼šä½¿ç”¨ `not`ã€`and`ã€`or` æ“ä½œç¬¦ç»„åˆã€‚

> ç›¸å½“äº JavaScript ä¸­çš„ `!`ã€`&&`ã€`||` æ“ä½œç¬¦å•¦ï¼Œéœ€è®¾å®šè¿ç®—é¡ºåºï¼Œåˆ™ä½¿ç”¨æ‹¬å·åŒ…è£¹ã€‚

```css
/* å½“ transform-origin: 10em 10em 10em æ— æ•ˆæ—¶ï¼Œè¡¨è¾¾å¼è¿”å› true */
@supports not (transform-origin: 10em 10em 10em) {
  /* æ ·å¼å£°æ˜ */
}
```

```css
/* å½“æ‰€æœ‰æ¡ä»¶åŒæ—¶ä¸ºçœŸæ—¶ï¼Œè¡¨è¾¾å¼æ‰è¿”å› true */
@supports (display: table-cell) and (display: list-item) {
  /* æ ·å¼å£°æ˜ */
}
```

```css
/* å½“æ¡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªä¸ºçœŸæ—¶ï¼Œè¡¨è¾¾å¼æ‰è¿”å› true */
@supports (transform-style: preserve) or (-moz-transform-style: preserve) {
  /* æ ·å¼å£°æ˜ */
}
```

è¿˜æœ‰ä¸€ä¸ªå®éªŒæ€§çš„è¯­æ³•ï¼š`selector()`ï¼Œæœ‰å…´è¶£è¯·çœ‹[è¿™é‡Œ](https://developer.mozilla.org/en-US/docs/Web/CSS/@supports#function_syntax)ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-98c0f9a484a65ee0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å…¼å®¹æ€§ä»ç„¶æ˜¯ IE å…¨ç³»ä¸æ”¯æŒï¼Œå‘µå‘µ~

#### 3.2 @media ä»‹ç»

[åª’ä½“æŸ¥è¯¢](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Media_Queries/Using_media_queries)ï¼ˆMedia Queriesï¼‰ï¼Œåœ¨ç½‘é¡µå¼€å‘ä¸­æ˜¯éå¸¸å¸¸ç”¨çš„ã€‚æµè§ˆå™¨ç»™ Web æä¾›äº†ä¸€äº›åª’ä½“ç‰¹æ€§ï¼ˆMedia Featuresï¼‰ï¼Œå®ƒæè¿°äº† [User Agent](https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent)ã€è¾“å‡ºè®¾å¤‡ã€æµè§ˆå™¨ç¯å¢ƒçš„å…·ä½“ç‰¹å¾ã€‚ç½‘é¡µå¼€å‘è€…å¯æ ¹æ®è¿™äº›ç‰¹æ€§ï¼Œæ¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

æ¯”å¦‚ï¼š

```css
@import 'common.css' screen, projection;

@media screen and (min-width: 480px) {
    /* ... */
}
```

```html
<link rel="stylesheet" src="styles.css" media="screen" />
<link rel="stylesheet" href="mobile.css" media="(max-width: 480px)" />
```

```js
// å¦‚æœå‚æ•°æ˜¯ CSS å£°æ˜ï¼ˆä¹Ÿå°±æ˜¯å‡ºç°äº†å†’å·ï¼‰ï¼Œå¤–é¢éœ€è¦æœ‰ä¸ªæ‹¬å·ï¼Œå¦åˆ™è¯­æ³•ä¸æ­£ç¡®ã€‚
if (window.matchMedia('(max-width: 480px)').matches) {
    // ...
}
```

ä½¿ç”¨åª’ä½“æŸ¥è¯¢æœ€å¸¸è§çš„æ˜¯ `@media` æ–¹å¼ï¼Œä½†æ˜¯åœ¨ HTML å’Œ JavaScript åŒæ ·æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œåè€…ç”¨å¾—è¾ƒå°‘ã€‚

åª’ä½“æŸ¥è¯¢å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

> * åœ¨ CSS ä¸­ä½¿ç”¨ `@media` æ¥è£…é¥°æ ·å¼ã€‚
> * åœ¨ HTML ä¸­å°† `media` å±æ€§ä½œç”¨äº [`<style>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/style#attr-media)ã€[`<link>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/link#attr-media)ã€[`<source>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/source#attr-media) ç­‰å…ƒç´ æŒ‡å®šç‰¹å®šçš„åª’ä½“ç±»å‹ã€‚
> * åœ¨ JavaScript ä¸­ä½¿ç”¨ [`Window.matchMedia()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia)Â å’Œ[`MediaQueryList.addListener()`](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList/addListener)Â æ–¹æ³•æ¥[æµ‹è¯•å’Œç›‘æ§åª’ä½“çŠ¶æ€](https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Testing_media_queries)ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åª’ä½“æŸ¥è¯¢ä½œç”¨äº `<link>` å…ƒç´ æ—¶ï¼Œå³ä½¿åª’ä½“æŸ¥è¯¢ç»“æœä¸º `false`ï¼Œè¯¥æ ·å¼è¡¨ä»ä¼šè¢«ä¸‹è½½ï¼Œåªæ˜¯æ ·å¼å†…å®¹ä¸è¢«ä½œç”¨è€Œå·²ã€‚

**3.2.1 åª’ä½“æŸ¥è¯¢è¯­æ³•**

æ¯æ¡åª’ä½“æŸ¥è¯¢è¯­å¥ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç”±ä¸€ä¸ªå¯é€‰çš„ã€Œåª’ä½“ç±»å‹ã€å’Œä»»æ„æ•°é‡çš„ã€Œåª’ä½“ç‰¹å¾ã€è¡¨è¾¾å¼æ„æˆã€‚åŒæ—¶å¯ä½¿ç”¨å¤šç§ã€Œé€»è¾‘æ“ä½œç¬¦ã€åˆå¹¶å¤šæ¡åª’ä½“æŸ¥è¯¢è¯­å¥ã€‚

å½“åª’ä½“æŸ¥è¯¢è¯­å¥ä¸­æŒ‡å®šçš„åª’ä½“ç±»å‹ä¸è®¾å¤‡åŒ¹é…æ—¶ï¼Œè¿™æ¡åª’ä½“æŸ¥è¯¢ç»“æœè¿”å› `true`ã€‚è‹¥æ˜¯å¤šæ¡åª’ä½“æŸ¥è¯¢è¯­å¥ç»„åˆï¼Œéœ€æ¯ä¸ªæ¡ä»¶å‡ä¸º `true`ï¼Œé‚£ä¹ˆåª’ä½“æŸ¥è¯¢ç»“æœæ‰ä¸º `true`ã€‚

**3.2.2 åª’ä½“ç±»å‹ï¼ˆMedia Typesï¼‰**

åœ¨åª’ä½“æŸ¥è¯¢ä¸­ï¼Œåª’ä½“ç±»å‹ï¼ˆMedia Typesï¼‰æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤æ˜¯ `all` ç±»å‹ã€‚ä¸€èˆ¬æ˜¯ä½¿ç”¨äº† `not` æˆ– `only` é€»è¾‘æ“ä½œç¬¦ï¼Œæ‰éœ€è¦æ˜¾å¼æŒ‡å®šã€‚æœ‰ä»¥ä¸‹è¿™äº›ï¼š

| åª’ä½“ç±»å‹ | æè¿° |
| --- | --- |
| `all` | é»˜è®¤å€¼ï¼Œé€‚ç”¨äºæ‰€æœ‰è®¾å¤‡ |
| `screen` | é€‚ç”¨äºå±å¹•ã€‚|
| `print` | é€‚ç”¨äºåœ¨æ‰“å°é¢„è§ˆæ¨¡å¼ä¸‹çš„å±å¹•ä¸ŠæŸ¥å¿«é€’åˆ†é¡µææ–™å’Œæ–‡æ¡£ã€‚ |
| `speech` | é€‚ç”¨äºè¯­éŸ³åˆæˆå™¨ã€‚|

ä¸€éƒ¨åˆ†åª’ä½“ç±»å‹åœ¨ Media Queries Level 4 ä¸­å·²è¢«å¼ƒç”¨ï¼Œå¯çœ‹[è¿™é‡Œ](https://developer.mozilla.org/en-US/docs/Web/CSS/@media#media_types)ã€‚

ç®€å•ç¤ºä¾‹ï¼š

```css
@media print {
  /* é’ˆå¯¹æ‰“å°è®¾å¤‡ */
}

@media screen, print {
  /* é’ˆå¯¹å¤šç§è®¾å¤‡ */
}
```

**3.2.3 åª’ä½“ç‰¹æ€§ï¼ˆMedia Featuresï¼‰**

åª’ä½“ç‰¹æ€§æè¿°äº†Â User Agentã€è¾“å‡ºè®¾å¤‡ï¼Œæˆ–æ˜¯æµè§ˆç¯å¢ƒçš„å…·ä½“ç‰¹å¾ï¼Œæ›´å¤šè¯·çœ‹ [MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/@media#media_features)ã€‚

> å»ºè®®ï¼šä½¿ç”¨å‰å…ˆå¼„æ¸…æ¥š[å…¼å®¹æƒ…å†µ](https://developer.mozilla.org/en-US/docs/Web/CSS/@media#browser_compatibility)ã€‚

å¸¸è§çš„åª’ä½“ç‰¹æ€§ï¼š

| åª’ä½“ç‰¹æ€§ | æè¿° |
| --- | --- |
| `aspect-ratio` | è§†å£ï¼ˆViewportï¼‰çš„å®½é«˜æ¯”ã€‚|
| `width` | è¾“å‡ºè®¾å¤‡æ›´æ–°å†…å®¹çš„æ¸²æŸ“ç»“æœçš„é¢‘ç‡ã€‚|
| `height` | è§†å£ï¼ˆViewportï¼‰çš„é«˜åº¦ |
| `hover` | ä¸»è¦è¾“å…¥æ¨¡å¼æ˜¯å¦å…è®¸ç”¨æˆ·åœ¨å…ƒç´ ä¸Šæ‚¬åœã€‚ |
| `orientation` | è§†å£ï¼ˆViewportï¼‰çš„æ—‹è½¬æ–¹å‘ã€‚ |
| `prefers-color-scheme` | æ¢æµ‹ç”¨æˆ·å€¾å‘äºé€‰æ‹©äº®è‰²è¿˜æ˜¯æš—è‰²çš„é…è‰²æ–¹æ¡ˆã€‚ |
| `resolution` | è¾“å‡ºè®¾å¤‡çš„åƒç´ å¯†åº¦ï¼ˆåˆ†è¾¨ç‡ï¼‰ã€‚|
| `scripting` | æ¢æµ‹è„šæœ¬ï¼ˆä¾‹å¦‚ JavaScriptï¼‰æ˜¯å¦å¯ç”¨ï¼Ÿ|

å®é™…åœºæ™¯ä¸­ç”¨å¾—è¾ƒå°‘çš„åª’ä½“ç‰¹æ€§ï¼š

| åª’ä½“ç‰¹æ€§ | æè¿° |
| --- | --- |
| `any-hover` | æ˜¯å¦æœ‰ä»»ä½•å¯ç”¨çš„è¾“å…¥æœºåˆ¶å…è®¸ç”¨æˆ·ï¼ˆå°†é¼ æ ‡ç­‰ï¼‰æ‚¬åœåœ¨å…ƒç´ ä¸Šï¼Ÿ |
| `any-pointer` | å¯ç”¨çš„è¾“å…¥æœºåˆ¶ä¸­æ˜¯å¦æœ‰ä»»ä½•æŒ‡é’ˆè®¾å¤‡ï¼Œå¦‚æœæœ‰ï¼Œå®ƒçš„ç²¾åº¦å¦‚ä½•ï¼Ÿ |
| `pointer` | ä¸»è¦è¾“å…¥æœºåˆ¶æ˜¯ä¸€ä¸ªæŒ‡é’ˆè®¾å¤‡å—ï¼Ÿå¦‚æœæ˜¯ï¼Œå®ƒçš„ç²¾åº¦å¦‚ä½•ï¼Ÿ |
| `color` | è¾“å‡ºè®¾å¤‡æ¯ä¸ªåƒç´ çš„æ¯”ç‰¹å€¼ï¼Œå¸¸è§çš„æœ‰ 8ã€16ã€32 ä½ã€‚å¦‚æœè®¾å¤‡ä¸æ”¯æŒè¾“å‡ºå½©è‰²ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚|
| `color-gamut` | ç”¨æˆ·ä»£ç†å’Œè¾“å‡ºè®¾å¤‡å¤§è‡´ç¨‹åº¦ä¸Šæ”¯æŒçš„è‰²åŸŸã€‚ |
| `color-index` | è¾“å‡ºè®¾å¤‡çš„é¢œè‰²æŸ¥è¯¢è¡¨ï¼ˆcolor lookup tableï¼‰ä¸­çš„æ¡ç›®æ•°é‡ï¼Œå¦‚æœè®¾å¤‡ä¸ä½¿ç”¨é¢œè‰²æŸ¥è¯¢è¡¨ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚ |
| `display-mode` | åº”ç”¨ç¨‹åºçš„æ˜¾ç¤ºæ¨¡å¼ï¼Œæ¯”å¦‚ Web App ä¸­çš„ manifest ä¸­çš„ display æˆå‘˜æ‰€æŒ‡å®šã€‚
| `forced-color` | æ£€æµ‹ User Agent æ˜¯å¦é™åˆ¶è°ƒè‰²æ¿ã€‚ |
| `grid` | è¾“å‡ºè®¾å¤‡ä½¿ç”¨ç½‘æ ¼å±å¹•è¿˜æ˜¯ç‚¹é˜µå±å¹•ï¼Ÿ |
| `inverted-colors` | User Agent æˆ–è€…åº•å±‚æ“ä½œç³»ç»Ÿæ˜¯å¦åè½¬äº†é¢œè‰²ã€‚|
| `light-height` | ç¯å¢ƒå…‰äº®åº¦ã€‚|
| `monochrome` | è¾“å‡ºè®¾å¤‡å•è‰²å¸§ç¼“å†²åŒºä¸­æ¯ä¸ªåƒç´ çš„ä½æ·±åº¦ã€‚å¦‚æœè®¾å¤‡å¹¶éé»‘ç™½å±å¹•ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚|
| `overflow-block` | è¾“å‡ºè®¾å¤‡å¦‚ä½•å¤„ç†æ²¿å—è½´æº¢å‡ºè§†çª—(viewport)çš„å†…å®¹ |
| `overflow-inline` | æ²¿å†…è”è½´æº¢å‡ºè§†å£ï¼ˆViewportï¼‰çš„å†…å®¹æ˜¯å¦å¯ä»¥æ»šåŠ¨ï¼Ÿ|
| `prefers-contrast` | æ¢æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å‘ç³»ç»Ÿè¦æ±‚æé«˜æˆ–é™ä½ç›¸è¿‘é¢œè‰²ä¹‹é—´çš„å¯¹æ¯”åº¦ã€‚ |
| `prefers-reduced-motion` | ç”¨æˆ·æ˜¯å¦å¸Œæœ›é¡µé¢ä¸Šå‡ºç°æ›´å°‘çš„åŠ¨æ€æ•ˆæœã€‚|
| `update` | è¾“å‡ºè®¾å¤‡æ›´æ–°å†…å®¹çš„æ¸²æŸ“ç»“æœçš„é¢‘ç‡ã€‚ |


åœ¨ Media Queries Level 4 å·²è¢«å¼ƒç”¨çš„åª’ä½“ç‰¹æ€§ï¼š

| åª’ä½“ç‰¹æ€§ | æè¿° |
| --- | --- |
| `device-aspect-ratio` | è¾“å‡ºè®¾å¤‡çš„å®½é«˜æ¯”ã€‚|
| `device-width` | è¾“å‡ºè®¾å¤‡æ¸²æŸ“è¡¨é¢ï¼ˆå¦‚å±å¹•ï¼‰çš„å®½åº¦ã€‚|
| `device-height` | è¾“å‡ºè®¾å¤‡æ¸²æŸ“è¡¨é¢ï¼ˆå¦‚å±å¹•ï¼‰çš„é«˜åº¦ã€‚|

å¯¹äº Media Queries Level å„çº§ä¸­æ–°å¢æˆ–å¼ƒç”¨çš„åª’ä½“ç‰¹æ€§ï¼Œå¯çœ‹[è¿™é‡Œ](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media#è§„èŒƒ)ã€‚

å¯¹äºè¡¨ç¤ºã€ŒèŒƒå›´ã€çš„çš„åª’ä½“ç‰¹æ€§ï¼ˆæ¯”å¦‚ `width`ã€`height` ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ `min-*`ã€`max-*` è¡¨ç¤ºæŸ¥è¯¢æœ€å°å€¼ã€æœ€å¤§å€¼ã€‚æ¯”å¦‚ï¼š

```css
@media (width: 480px) {
  /* å½“ Viewport å®½åº¦ç­‰äº 480px æ—¶è¢«åº”ç”¨ */
}

@media (min-width: 720px) {
  /* å½“ Viewport æœ€å°å®½åº¦å¤§äºç­‰äº 720px æ—¶è¢«åº”ç”¨ */
}

@media (max-width: 960px) {
  /* å½“ Viewport æœ€å¤§å®½åº¦ä¸è¶…è¿‡ 960px æ—¶è¢«åº”ç”¨ */
}
```

ä»¥ä¸Šè¿™ç§å†™æ³•ï¼Œåœ¨ Media Queries Level 4 ä¸­æ”¯æŒä»¥ä¸‹[èŒƒå›´è¯­æ³•](https://drafts.csswg.org/mediaqueries-4/#mq-min-max)ï¼Œä½†ç›®å‰[å…¼å®¹æ€§](https://caniuse.com/?search=media%20queries%204)éå¸¸çš„å·®ï¼Œäº†è§£ä¸‹å°±è¡Œäº†ï¼š

```css
@media (min-width: 720px) and (max-width: 960px) {}

/* ç­‰ä»·äº */
@media ( 720px <= width <= 960px) {}
```

**3.2.4 device-width ä¸ width çš„åŒºåˆ«**

å…¶ä¸­ `device-width` è¡¨ç¤ºè®¾å¤‡çš„å®½åº¦ï¼Œ`width` è¡¨ç¤ºè§†å£ Viewport å®½åº¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ PC ä¸­æ‰“å¼€äº†ä¸€ä¸ªã€Œéå…¨å±ã€çš„æµè§ˆå™¨çª—å£ï¼Œé‚£ä¹ˆ `device-with` æ˜¯æ˜¾ç¤ºå™¨çš„å®½åº¦ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚è€Œ `width` åˆ™æ˜¯æµè§ˆå™¨å†…é¡µé¢çš„ Viewport å®½åº¦ï¼ˆæ³¨æ„ï¼Œä¸èƒ½å•çº¯åœ°è®¤ä¸ºæµè§ˆå™¨çª—å£çš„å®½åº¦ï¼‰ï¼Œé€šè¿‡æ‹–æ‹½æµè§ˆå™¨çª—å£ç­‰è¡Œä¸ºæ˜¯å¯ä½¿å…¶å‘ç”Ÿå˜åŒ–çš„ã€‚

ä½†è¯·æ³¨æ„ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸­ï¼Œæ¨ªå±ä¸ç«–å±çš„åˆ‡æ¢ï¼Œ`device-width` ä¼šç›¸åº”è·Ÿç€æ”¹å˜çš„ã€‚åº”å¯¹è¿™ç§è¡Œä¸ºï¼Œå¯ç»“åˆ `orientation` è¿™ä¸ªåª’ä½“ç‰¹æ€§ä½¿ç”¨ã€‚

> `device-height` ä¸ `height` åŒç†ã€‚

**3.2.5 é€»è¾‘æ“ä½œç¬¦ï¼ˆLogical Operatorsï¼‰**

é€šè¿‡é€»è¾‘æ“ä½œç¬¦ï¼ˆ`and`ã€`not`ã€`only`ï¼‰ï¼Œå¯ä»¥åˆ›å»ºå¤æ‚ã€å¤šæ¡ä»¶çš„åª’ä½“æŸ¥è¯¢ã€‚å…¶ä¸­ `and`ã€`not`ã€`only` åˆ†åˆ«è¡¨ç¤ºä¸ã€éã€å”¯ä¸€çš„æ„æ€ã€‚

æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `,`ï¼ˆé€—å·ï¼‰å°†å¤šä¸ªåª’ä½“æŸ¥è¯¢åˆå¹¶ï¼Œåªè¦ä»»ä¸€æŸ¥è¯¢ç»“æœä¸º `true`ï¼Œæ•´ä¸ªæŸ¥è¯¢è¯­å¥å°±è¿”å› `true`ï¼ˆè·Ÿé€»è¾‘æˆ– `or` è¡Œä¸ºç±»ä¼¼ï¼‰ã€‚



éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

> * `not` æ“ä½œç¬¦ä¸èƒ½ç”¨äºå¦å®šå•ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåªèƒ½ç”¨äºå¦å®šæ•´ä¸ªåª’ä½“æŸ¥è¯¢ã€‚
> * ä½¿ç”¨ `not`ã€`only` æ“ä½œç¬¦ï¼Œå¿…é¡»æŒ‡å®šã€Œåª’ä½“ç±»å‹ã€ã€‚
> * `and` æ“ä½œç¬¦å¯ä»¥å°†åª’ä½“ç±»å‹ã€åª’ä½“ç‰¹æ€§æˆ–å…¶ä»–åª’ä½“åŠŸèƒ½ç»„åˆåœ¨ä¸€èµ·ã€‚
> * `only` æ“ä½œç¬¦ï¼Œä¸€èˆ¬ç”¨äºå¤„ç†ä¸æ”¯æŒã€Œåª’ä½“ç‰¹æ€§ã€æŸ¥è¯¢çš„è¯­å¥æ—§ç‰ˆæœ¬æµè§ˆå™¨ã€‚

ä¸‹é¢çœ‹ä¸€äº›ç¤ºä¾‹ï¼š

```css
/* not ä½œç”¨äºæ•´ä¸ªåª’ä½“æŸ¥è¯¢ */
@media not all and (monochrome) {}

/* ç­‰ä»·äº */
@media not (all and (monochrome)) {}

/* è€Œä¸æ˜¯ */
@media (not all) and (monochrome) {}
```
å†çœ‹ï¼š

```css
@media not screen and (color), print and (color) {}

/* ç­‰ä»·äº */
@media (not (screen and (color))), print and (color) {}
```

å†çœ‹ï¼š

```css
/* é€šè¿‡ and å¯ç»„åˆå¤šä¸ªæ¡ä»¶ */
@media screen and (min-width: 30em) and (orientation: landscape) {}
```

å†çœ‹ï¼š

```css
/*
  ç”¨æˆ·è®¾å¤‡çš„æœ€å°é«˜åº¦ä¸º 680px æˆ–ä¸ºç«–å±æ¨¡å¼çš„å±å¹•è®¾å¤‡ï¼Œéƒ½ä¼šè¢«åº”ç”¨æ­¤æ ·å¼ã€‚
*/
@media (min-height: 680px), screen and (orientation: portrait) {}
```

å†çœ‹è¿™ä¸ªç¤ºä¾‹ï¼Œå¦‚æœæ˜¯ä¸æ”¯æŒã€Œåª’ä½“ç‰¹æ€§ã€æŸ¥è¯¢çš„æ—§æµè§ˆå™¨ï¼Œé‚£ä¹ˆä»¥ä¸‹æ ·å¼å°†ä¸ä¼šè¢«åº”ç”¨ï¼Œåœ¨è¿™äº›æµè§ˆå™¨çœ‹æ¥ï¼Œå®ƒå°† `only` è¯†åˆ«ä¸ºã€Œåª’ä½“ç±»å‹ã€äº†ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰è¿™æ ·çš„åª’ä½“ç±»å‹ï¼Œå› è€Œå°†ä¸ä¼šè¢«åº”ç”¨ã€‚è€Œåœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œå°±æ²¡æœ‰ä»»ä½•å½±å“ã€‚

```css
@media only screen and (color) {}

/* åœ¨æ—§ç‰ˆæµè§ˆå™¨ï¼Œç›¸å½“äºè¿™æ · */
@media only {}

/* åœ¨ç°ä»£æµè§ˆå™¨ï¼Œç›¸å½“äºè¿™æ · */
@media screen and (color) {}
```

#### 3.3 @media åº”ç”¨åœºæ™¯

1. æµ…è‰²æ¨¡å¼ä¸æ·±è‰²æ¨¡å¼

å¯ä»¥ä½¿ç”¨åª’ä½“ç‰¹æ€§ `prefers-color-scheme` æ¥åˆ¤æ–­æ˜¯å¦åœ¨ç³»ç»Ÿå±‚é¢è®¾ç½®äº†æ·±è‰²æ¨¡å¼ã€‚å®ƒæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š

* `light` - è¡¨ç¤ºç”¨æˆ·åœ¨ç³»ç»Ÿå±‚é¢ä½¿ç”¨äº†â€œæµ…è‰²æ¨¡å¼â€ã€‚
* `dark` - è¡¨ç¤ºç”¨æˆ·åœ¨ç³»ç»Ÿå±‚é¢ä½¿ç”¨äº†â€œæ·±è‰²æ¨¡å¼â€ã€‚
* `no-preference` - ç†è§£ä¸ºæµè§ˆå™¨ä¸æ”¯æŒè®¾ç½®ä¸»é¢˜è‰²ï¼Œæˆ–è€…æµè§ˆå™¨æ”¯æŒè®¾ç½®ä¸»é¢˜è‰²ï¼Œä½†é»˜è®¤è¢«è®¾ä¸ºâ€œæœªè®¾ç½®â€ã€â€œæ— åå¥½â€ç­‰ï¼ˆä¹Ÿå¯ç®€å•ç†è§£ä¸ºæ— é»˜è®¤å€¼ï¼‰ã€‚


```css
/* æ·±â¾Šæ¨¡å¼ */
@media (prefers-color-scheme: dark) {}

/* æµ…â¾Šæ¨¡å¼ */
@media (prefers-color-scheme: light) {}
``` 

é€šè¿‡ DOM API æä¾›çš„ [matchMedia](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia) æ¥å£ï¼Œå¯ä»¥åšä¸€äº›åˆ¤æ–­ï¼š

```js
if (window.matchMedia('(prefers-color-scheme)').media !== 'not all') {
  console.log('ğŸ‰ Dark mode is supported')
}

if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  console.log('Dark mode is on.')
}

if (window.matchMedia('(prefers-color-scheme: light)').matches) {
  console.log('Light mode is on.')
}
```

æƒ³è¦ç›‘å¬æµ…è‰²/æ·±è‰²æ¨¡å¼çš„åˆ‡æ¢ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```js
const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
const lightModeMediaQuery = window.matchMedia('(prefers-color-scheme: light)')

darkModeMediaQuery.addListener(e => {
  const darkModeStatus = e.matches
  console.log(`Dark mode is ${darkModeStatus ? 'on' : 'off'}.`)
})

lightModeMediaQuery.addListener(e => {
  const lightModeStatus = e.matches
  console.log(`Light mode is ${lightModeStatus ? 'on' : 'off'}.`)
})
```
ç»“åˆ CSS å˜é‡å°±å¯ä»¥å¾ˆå¥½åœ°å»é€‚é…ç½‘ç«™çš„æ·±è‰²æ¨¡å¼äº†ã€‚ä¸¾ä¸ªç®€å•ç¤ºä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="theme.css" />
  </head>
  <body>
    <div class="container">
      <article>
        <h1>è’¹è‘­</h1>
        <p>è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚</p>
        <p>è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚</p>
        <p>è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚</p>
        <p></p>
      </article>
    </div>
  </body>
</html>
```

```css
/* theme.css */
:root {
  --theme-bg: #fff;
  --theme-color: #000;
}

@media screen and (prefers-color-scheme: dark) {
  :root {
    --theme-bg: #000;
    --theme-color: #fff;
  }
}

body {
  color: var(--theme-color);
  background: var(--theme-bg);
}
```

ä»¥ä¸Šç¤ºä¾‹ä¼šè‡ªé€‚åº”ç³»ç»Ÿä¸»é¢˜è‰²ï¼Œå¦‚æœä½ æƒ³äº¤ç”±ç”¨æˆ·å†³å®šï¼Œå»æ‰ç¤ºä¾‹ä¸­çš„åª’ä½“æŸ¥è¯¢ï¼Œç„¶åé€šè¿‡ JavaScript å»åŠ¨æ€è®¾ç½® CSS å˜é‡å³å¯ã€‚å¦å¤–ï¼Œå¯ä»¥çœ‹ä¸‹å¼ é‘«æ—­å¤§ä½¬è¿™ç¯‡æ–‡ç« ï¼š[å‡ è¡ŒCSSè®©æ•´ç«™æ”¯æŒæ·±è‰²æ¨¡å¼çš„æ¢ç´¢ä¸æ‹“å±•](https://www.zhangxinxu.com/wordpress/2020/11/css-mix-blend-mode-filter-dark-theme/)ã€‚

[å…¼å®¹æ€§](https://caniuse.com/prefers-color-scheme)å¦‚ä¸‹ï¼Œçœ‹ç€è¿˜ä¸é”™ï¼š

![](https://upload-images.jianshu.io/upload_images/5128488-526f05195a8c2b18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç§è®¤ä¸ºæ·±è‰²æ¨¡å¼çš„é€‚é…éš¾ç‚¹å¹¶ä¸åœ¨å®ç°ä¸Šï¼Œé€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œå¯ä»¥è¯´æ˜¯æ²¡æœ‰éš¾åº¦å¯¹å§ï¼Œéš¾ç‚¹åº”è¯¥åœ¨äºè®¾è®¡å¸ˆè¦è€ƒè™‘å…¨ç«™çš„äº¤äº’æ ·å¼ï¼Œå¹¶åˆ¶å®šå‡ºæ·±æµ…æ¨¡å¼ä¸‹çš„å„çº§è‰²è°ƒç­‰ã€‚

> æ¨èçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š[prefers-color-scheme: Hello darkness, my old friend](https://web.dev/prefers-color-scheme/)

æœªå®Œå¾…ç»­...

<!--



https://webkit.org/blog/7929/designing-websites-for-iphone-x/
https://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/

## TODO

1. ä¸Šä¼ è¿›åº¦æ¡ï¼š[CSSå˜é‡å±€éƒ¨ç‰¹æ€§ç”¨é€”](https://www.zhangxinxu.com/wordpress/2019/01/css-var-å˜é‡-å±€éƒ¨/)
2. @mediaã€@supports

3. 1px é€‚é…ï¼Œä»¥åŠ[-webkit-device-pixel-ratio](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/-webkit-device-pixel-ratio)

## References

* [MDN è‡ªå®šä¹‰å±æ€§ (--*)ï¼šCSSå˜é‡](https://developer.mozilla.org/zh-CN/docs/Web/CSS/--*)
* [äº†è§£ CSS å˜é‡ var](https://www.zhangxinxu.com/wordpress/2016/11/css-css3-variables-var/)
* [CSS å˜é‡æ•™ç¨‹](https://www.ruanyifeng.com/blog/2017/05/css-variables.html)
* [Everything you need to know about CSS Variables](https://www.freecodecamp.org/news/everything-you-need-to-know-about-css-variables-c74d922ea855/)
* [Understanding the Difference Between CSS Resolution and Device Resolution](https://elad.medium.com/understanding-the-difference-between-css-resolution-and-device-resolution-28acae23da0b)

-->
