---
title: requestAnimationFrame ä½¿ç”¨
number: '#289'
link: 'https://github.com/toFrankie/blog/issues/289'
created_at: '2023-02-26 21:02:48'
updated_at: '2023-04-26 22:31:39'
labels:
  - å‰ç«¯
  - å°šæœªå®Œç»“
  - JS
  - '2022'
---
![é…å›¾æºè‡ª Freepik](https://upload-images.jianshu.io/upload_images/5128488-b190e36b0b8ca357.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


## ä¸€ã€requestAnimationFrame

ä» [MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame) ä»‹ç»å¯çŸ¥ï¼š
> è°ƒç”¨ `window.requestAnimationFrame()` æ–¹æ³•å‘ŠçŸ¥æµè§ˆå™¨ï¼Œå¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚

ä»è¿™å¥è¯å¯ä»¥çœ‹å‡ºï¼Œå®ƒç›¸æ¯” `setTimeout` ç­‰ API çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å‡å°‘ DOM é‡ç»˜çš„æ¬¡æ•°ã€‚


è¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼š

```js
window.requestAnimationFrame(callback)
```

å®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå³ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»å¸§æ‰€è°ƒç”¨çš„å‡½æ•°ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªéé›¶ä¸”å”¯ä¸€çš„ `requestId`ï¼ˆå¯ä»¥ä¼ ç»™ `window.cancelAnimationFrame()` ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ï¼‰ã€‚

å›è°ƒå‡½æ•°å°†ä¼šè¢«ä¼ å…¥ä¸€ä¸ª [`DOMHighResTimeStamp`](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp) å‚æ•°ï¼Œè¡¨ç¤º `requestAnimationFrame()` å¼€å§‹å»æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚

çœ‹ä¸€ä¸‹ MDN ç»™å‡ºçš„ä¸€ä¸ªç¤ºä¾‹ï¼š
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      #foo {
        width: 100px;
        height: 100px;
        background-color: rebeccapurple;
      }
    </style>
  </head>
  <body>
    <div id="foo"></div>
    <script>
      let start
      const element = document.getElementById('foo')

      function step(timestamp) {
        if (start === undefined) start = timestamp
        const elapsed = timestamp - start

        // è¿™é‡Œä½¿ç”¨ `Math.min()` ç¡®ä¿å…ƒç´ åˆšå¥½åœåœ¨ 200px çš„ä½ç½®ã€‚
        element.style.transform = `translateX(${Math.min(0.1 * elapsed, 200)}px)`

        if (elapsed < 2000) {
          // åœ¨ä¸¤ç§’ååœæ­¢åŠ¨ç”»
          window.requestAnimationFrame(step)
        }
      }

      window.requestAnimationFrame(step)
    </script>
  </body>
</html>
```

æ•ˆæœå¯çœ‹ä¸‹ ğŸ‘‰ [CodeSandbox](https://codesandbox.io/s/request-animation-frame-demo-280e0p?file=/index.html)ã€‚

å¸§åŠ¨ç”»å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°å–å†³äºã€Œå±å¹•åˆ·æ–°ç‡ã€ï¼Œä»¥ 60Hzï¼ˆè¡¨ç¤ºæ¯ç§’é’Ÿå›¾åƒåˆ·æ–°çš„æ¬¡æ•°ï¼‰çš„å±å¹•æ¥è¯´ï¼Œçº¦ 16.7ms ä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ `requestAnimationFrame()` çš„å›è°ƒå‡½æ•°çº¦ 16.7ms å°±ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚

è€Œä¸”ï¼Œåœ¨å¤šæ•°æµè§ˆå™¨ä¸­ï¼Œå½“ `requestAnimationFrame()` å¤„äºåå°æ ‡ç­¾é¡µæˆ–è€…è¢«éšè—çš„ `<iframe>` å…ƒç´ é‡Œï¼Œå®ƒä¼šè¢«æš‚åœè°ƒç”¨ä»¥æå‡æ€§èƒ½å’Œç”µæ± å¯¿å‘½ã€‚

æœªå®Œå¾…ç»­...


<!--

## References

* [2022 å¹´äº†,çœŸçš„æ‡‚ requestAnimationFrame ä¹ˆï¼Ÿ](https://juejin.cn/post/7062178363800027173)
* [æ·±å…¥å­¦ä¹ å®šæ—¶å™¨](http://www.alloyteam.com/2021/03/15389/)
-->
