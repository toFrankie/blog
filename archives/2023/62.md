---
title: ä»Žé›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¹ï¼‰
number: '#62'
link: 'https://github.com/toFrankie/blog/issues/62'
created_at: '2023-02-25 19:41:51'
updated_at: '2023-04-26 21:49:09'
labels:
  - React
  - '2020'
---
è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•è§‚å¯Ÿ store çš„å˜åŒ–ï¼Œä¸Šæ–‡æˆ‘è¯´äº†å¯ä»¥é€šè¿‡ redux-logger æˆ–è€… Redux DevTools æ¥è§£å†³è¿™ä¸ªæˆ‘ä»¬çš„éœ€æ±‚ã€‚

### ä¸€ã€Redux-Logger
å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”Ÿæˆæ—¥å¿—çš„ä¸­é—´ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æŽ§åˆ¶å°çœ‹åˆ° Action æ“ä½œï¼ŒåŒ…æ‹¬ actionã€prev stateã€next state çŠ¶æ€ã€‚

æŽ¥å…¥ redux-logger çš„æ–¹æ³•éžå¸¸çš„ç®€å•ã€‚

1. å®‰è£… redux-logger
```shell
$ yarn add redux-logger@3.0.6
```
2. åœ¨ `createStore` æ–¹æ³•ä¼ å…¥

æ­¤å‰[æ–‡ç« ](https://www.jianshu.com/p/13ea372cdd45)æˆ‘ä»¬ä»‹ç»äº† `redux` çš„ `createStore` æ–¹æ³•æŽ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š`createStore(reducer, [preloadedState], enhancer)`ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ°ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚

æˆ‘ä»¬å°† `redux-logger` æ”¾åœ¨ `redux` æä¾›çš„ `applyMiddleware` ä¸­ï¼Œå†ä¼ å…¥ `createStore` å°±èƒ½å®Œæˆ `store.dispatch()` åŠŸèƒ½çš„å¢žå¼ºã€‚
```jsx
// store/index.js
// æ³¨æ„ï¼šä¸ºäº†ç¼©å‡æ–‡ç« ç¯‡å¹…ï¼Œè¿™é‡Œçœç•¥äº†éƒ¨åˆ†ä»£ç ã€‚
import { createStore, applyMiddleware } from 'redux'
import logger from 'redux-logger'

// some statements...

// å¦‚æžœè¿™é‡Œä¸ä¼  preloadedState å‚æ•°ï¼Œé‚£ä¹ˆ applyMiddleware å°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°äº†
const store = createStore(reducer, initialState, applyMiddleware(logger))

export default store
```

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸­é—´ä»¶çš„æ¬¡åºæ˜¯æœ‰è¦æ±‚çš„ï¼Œä½¿ç”¨ä¹‹å‰ï¼Œè¯·æŸ¥ä¸€ä¸‹ç›¸å…³æ–‡æ¡£ã€‚æ¯”å¦‚ redux-logger å°±ä¸€å®šè¦æ”¾åœ¨æœ€åŽï¼Œå¦åˆ™è¾“å‡ºç»“æžœä¼šä¸æ­£ç¡®ã€‚

3. å®Œæˆäº†ï¼Œçœ‹æ•ˆæžœï¼š

![ðŸŽ‰](https://upload-images.jianshu.io/upload_images/5128488-47ced48f46f1bd9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


### äºŒã€Redux DevTools

æˆ‘æ›´åå‘äºŽä½¿ç”¨æ’ä»¶ï¼Œä¸€ä¸ªæ˜¯æˆ‘æœ¬èº«å¼ºè¿«ç—‡ä½¿ç„¶ï¼ŒäºŒæ˜¯é¡¹ç›®å¯èƒ½ä¼šéœ€è¦æ‰“å°å…¶ä»–ä¿¡æ¯ï¼Œå¦‚æžœæ¯æ¬¡ Redux å¤„ç† Action éƒ½æ‰“å°çš„è¯ï¼Œå‡å¦‚é¢‘ç¹æ“ä½œçš„è¯ï¼Œæˆ‘å¯èƒ½æ²¡åŠžæ³•å¾ˆå¿«æ‰¾åˆ°æˆ‘æƒ³è¦çš„ä¿¡æ¯ï¼Œçœ‹åˆ°æ»¡å±çš„ log æˆ‘ä¼šç–¯æŽ‰ï¼Œå“ˆå“ˆã€‚

*æ’ä»¶å®‰è£…ï¼Œè‡ªè¡Œè§£å†³ï¼Œä¸å†èµ˜è¿°ã€‚

> åœ¨è¿™é‡Œæˆ‘ä¼šè¿™æ ·å¤„ç†ï¼Œåœ¨å«æœ‰ Redux DevTools æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨ redux-loggerã€‚è‹¥ä¸å«æ’ä»¶ï¼ˆå¦‚ Safari æµè§ˆå™¨ï¼‰ï¼Œæˆ‘å°±ä¼šå¯ç”¨ redux-loggerã€‚

**Redux DevTools ä½¿ç”¨æ–‡æ¡£ï¼Œåœ¨[è¿™é‡Œ](https://github.com/zalmoxisus/redux-devtools-extension#usage)ã€‚ä½¿ç”¨æ–¹æ³•å…¶å®žå¾ˆå¤šç§ï¼Œè¯¦æƒ…ç‚¹å‡»äº†è§£ã€‚**

æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬é¡¹ç›®é™¤äº† `redux-logger`ï¼Œæš‚æ—¶æœªä½¿ç”¨åˆ°å…¶ä»–ä¸­é—´ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦åšä»¥ä¸‹è°ƒæ•´å°±èƒ½ä½¿ç”¨äº†ã€‚
```jsx
// store/index.js
// çœç•¥çš„ä»£ç æ— éœ€æ”¹åŠ¨ï¼Œæˆ‘ä»¬åªéœ€åŠ ä¸€ä¸ªåˆ¤æ–­å³å¯ã€‚

// åˆ¤æ–­æ˜¯å¦å«æœ‰ Redux DevTools æ’ä»¶
const enhancers = window.__REDUX_DEVTOOLS_EXTENSION__ ? __REDUX_DEVTOOLS_EXTENSION__() : applyMiddleware(logger)

const store = createStore(reducer, initialState, enhancers)
```
æˆ‘ä»¬å°† Chrome DevTool çš„ Tab åˆ‡æ¢è‡³ Redux æ ï¼Œå³å¯çœ‹åˆ°æ•ˆæžœå¦‚ä¸‹ï¼š
![å«æœ‰æ’ä»¶çš„ Chrome æµè§ˆå™¨](https://upload-images.jianshu.io/upload_images/5128488-66c23393281b164a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![ä¸å«æ’ä»¶çš„ Safari æµè§ˆå™¨](https://upload-images.jianshu.io/upload_images/5128488-3514a431b085fa72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### ä¸‰ã€ä½ ä»¥ä¸ºå®Œäº†å—ï¼Ÿ

ä¸ä¸ä¸ï¼ŒRedux DevTools çš„ä½¿ç”¨ä¸ä»…å¦‚æ­¤ï¼Œä¸Šé¢åªæ˜¯æœ€åŸºç¡€çš„çŽ©æ³•ï¼Œæ›´å¤šè¯·çœ‹[æ–‡æ¡£](https://github.com/zalmoxisus/redux-devtools-extension#usage)ã€‚

ä¸‹é¢æˆ‘ä»‹ç»ä¸€ç§ Advanced Store Setup è¿›ä»·é…ç½®ã€‚

è¿™é‡Œæˆ‘çŽ‡å…ˆå¼•å…¥ `redux-saga` ä¸­é—´ä»¶ï¼Œå®ƒæ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„ï¼Œæœ¬æ–‡åªæ˜¯ä¸ºäº†ç»“åˆ Redux DevTools çš„ä½¿ç”¨è€Œæå‰å¼•å…¥ï¼Œå¯¹å®ƒæš‚ä¸åšè¯¦è§£ï¼ŒåŽç»­æ–‡ç« ä¼šæœ‰ã€‚

```shell
$ yarn add redux-saga@1.1.3
```
å› ä¸ºçŽ°åœ¨é¡¹ç›®å¼•å…¥çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬å¯¹é¡¹ç›®ç»“æž„ä½œä¸€äº›ç®€å•è°ƒæ•´ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¼šæ›´æ¸…æ™°ã€‚

1. æˆ‘ä»¬å…ˆæŠŠåŽŸå…ˆåœ¨ `/scr/js/store/index.js` çš„ reducer å¤„ç†å‡½æ•°åˆ†ç¦»åˆ° `/scr/js/reducers/index.js` æ–‡ä»¶ä¸‹ï¼Œå…¶ä¸­å¤„ç†é€»è¾‘ä¸å˜ã€‚
```jsx
// reducers/index.js
const reducer = (prevState, action) => {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      // ä¸€å®šè¦ä¸èƒ½ä¿®æ”¹ stateï¼Œè€Œæ˜¯è¿”å›žä¸€ä¸ªæ–°çš„å‰¯æœ¬
      // å€˜è‹¥ state æ˜¯å¼•ç”¨æ•°æ®ç±»åž‹ï¼Œä¸€å®šè¦å€ŸåŠ© Object.assignã€å¯¹è±¡å±•å¼€è¿ç®—ç¬¦(...)ã€å…¶ä»–åº“çš„æ‹·è´æ–¹æ³•æˆ–è€…è‡ªå·±å®žçŽ°æ·±æ‹·è´æ–¹æ³•ï¼Œè¿”å›žä¸€ä¸ªæ–°å‰¯æœ¬
      return { ...prevState, count: prevState.count + payload }
    case 'SUB':
      return { ...prevState, count: prevState.count - payload }
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›žæ—§çš„ state
      return prevState
  }
}

export default reducer
```
2. åˆ›å»º `redux-saga` æœ€ç®€å•çš„ä¾‹å­ã€‚æˆ‘ä»¬åœ¨ `src/js` ç›®å½•ä¸‹æ–°å»º `sagas/index.js` æ–‡ä»¶ã€‚
```jsx
// sagas/index.js
import { all, fork } from 'redux-saga/effects'

function* helloSaga() {
    console.log('Hello Saga!')
}

function* rootSaga() {
    yield all([fork(helloSaga)])
}

export default rootSaga
```
3. å¯åŠ¨ saga

è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨ `redux` çš„å¦ä¸€ä¸ªé«˜é˜¶å‡½æ•° `compose`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„åˆå‡½æ•°ï¼Œä¸Ž Redux æœ¬èº«æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚å®ƒè¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠ `var a = fn1(fn2(fn3(fn4(x))))` è¿™ç§åµŒå¥—çš„è°ƒç”¨æ–¹å¼æ”¹æˆ `var a = compose(fn1, fn2, fn3, fn4)(x)` çš„æ–¹å¼è°ƒç”¨ã€‚å®ƒé‡Œé¢ä½¿ç”¨äº†æ•°ç»„çš„ `Array.prototype.reduce` æ–¹æ³•ã€‚

è¿™é‡Œä¸å±•å¼€è®²è¿°äº†ï¼Œæœ‰å…´è¶£çš„è‡ªè¡Œæœç´¢æˆ–è€…æŸ¥çœ‹ redux æºç ï¼Œæ–‡ç« ç»“å°¾è€ƒè™‘è´´ä¸€ä¸ª `compose` çš„æºç ã€‚

å›žåˆ°æ­£é¢˜ï¼š
```jsx
// store/index.js
import { createStore, applyMiddleware, compose } from 'redux'
import createSagaMiddleware from 'redux-saga'
import logger from 'redux-logger'
import rootSaga from '../sagas'
import reducers from '../reducers'

// åˆå§‹å€¼
const initialState = { count: 0 }

// åˆ›å»º saga middleware
const sagaMiddleware = createSagaMiddleware()

// å½“ä½¿ç”¨ middleware æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ä½œåˆ¤æ–­äº†
const composeEnhancers = (typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose

// åˆ¤æ–­æ˜¯å¦å«æœ‰ Redux DevTools æ’ä»¶
const middlewares = typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__ ? applyMiddleware(sagaMiddleware) : applyMiddleware(sagaMiddleware, logger)

// åˆ›å»º Storeï¼ˆä¹Ÿå¯ä»¥ä¸ä¼ å…¥ initialState å‚æ•°ï¼Œè€Œå°† reducer ä¸­çš„ state è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼‰
const store = createStore(reducers, initialState, composeEnhancers(middlewares))

// å¯åŠ¨ saga
sagaMiddleware.run(rootSaga)

// ç›‘å¬ state å˜åŒ–
// const unsubscribe = store.subscribe(() => {
//   console.log('ç›‘å¬ state å˜åŒ–', store.getState())
// })

// è§£é™¤ç›‘å¬
// unsubscribe()

export default store
```
å¤§åŠŸå‘Šæˆï¼Œå¦‚å›¾ï¼š
![ðŸŽ‰](https://upload-images.jianshu.io/upload_images/5128488-1b9955ea65be2655.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

åˆ°æ­¤ä¸ºæ­¢ï¼Œ`redux-saga` å¹¶æ²¡æœ‰è§£å†³ä»€ä¹ˆå®žé™…é—®é¢˜ï¼Œæœ¬æ–‡åªæ˜¯å•çº¯çš„ä¸ºäº†å¼•å…¥è€Œå¼•å…¥çš„ï¼ŒåŽç»­å°†ä¼šè®²è§£ã€‚


### é¢˜å¤–è¯
è´´ä¸Š Redux çš„ `compose` æ–¹æ³•çš„[æºç ](https://github.com/reduxjs/redux/blob/4.x/src/compose.js)ï¼Œå¾ˆç²¾é«“ï¼Œå“ˆå“ˆï¼
```jsx
export default function compose(...funcs) {
  if (funcs.length === 0) {
    return arg => arg
  }

  if (funcs.length === 1) {
    return funcs[0]
  }

  return funcs.reduce((a, b) => (...args) => a(b(...args)))
}
```
