---
title: ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰
number: '#123'
link: 'https://github.com/toFrankie/blog/issues/123'
created_at: '2023-02-25 21:14:56'
updated_at: '2024-03-17 16:48:49'
labels:
  - ç¼–ç è§„èŒƒ
  - å°ç¨‹åº
  - éƒ¨åˆ†åºŸå¼ƒ
  - '2020'
---
## å†™åœ¨å‰é¢

æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ [ESLint](http://eslint.cn/)ã€[Prettier](https://prettier.io/) çš„ä»£ç æ£€æŸ¥æˆ–è€…æ ¼å¼çº¦æŸç­‰å·¥å…·ã€‚

ç›®å‰éƒ¨é—¨ä»…å‰©æˆ‘ä¸€äººç»´æŠ¤è¿™åå‡ ä¸ªå°ç¨‹åºã€H5 å‰ç«¯é¡¹ç›®ã€‚ç°åœ¨åªè¦æ¥è§¦ä»¥å‰æ²¡æœ‰ç»æ‰‹çš„é¡¹ç›®ï¼Œå°±å¤´ç–¼ä¸æƒ³æ”¹ï¼Œå¾ˆæ— å¥ˆï¼Œè°è®©æˆ‘æ˜¯ä¸€ä¸ªæ‰“å·¥äººå‘¢ï¼

æœ¬æ–‡å°†ä¼šç»“åˆ ESLintã€Prettierã€huskyã€lint-stage å±•å¼€ä»‹ç»ï¼Œæ—¨åœ¨åœ¨ä»£ç æ ¼å¼åŒ–ã€ä»£ç æ£€æŸ¥ä¸Šå‡å°‘æ—¶é—´æµªè´¹ã€‚

å®Œæ•´ç¤ºä¾‹ï¼š[wechat_applet_demo](https://github.com/toFrankie/wechat_applet_demo.git)

å…±ä¸‰ç¯‡ï¼š

- [ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰](https://github.com/toFrankie/blog/issues/123)
- [ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸‹é›†ï¼‰](https://github.com/toFrankie/blog/issues/124)
- [ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆç»“å±€ç¯‡ï¼‰](https://github.com/toFrankie/blog/issues/125)

æ‰©å±•ç¯‡ï¼š

- [Git Commit è§„èŒƒ](https://github.com/toFrankie/blog/issues/101)


## ç¼–è¾‘å™¨æ’ä»¶

ä½¿ç”¨åˆ° VS Code æ’ä»¶ï¼š

- [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
- [Prettier](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode)

ç›¸å…³é…ç½®ä»¥ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š

```json5
{
  "files.associations": {
    "*.wxss": "css",
    "*.wxs": "javascript",
    "*.acss": "css",
    "*.axml": "html",
    "*.wxml": "html",
    "*.swan": "html"
  },
  "files.trimTrailingWhitespace": true,
  "eslint.workingDirectories": [{ "mode": "auto" }],
  "eslint.enable": true, // æ˜¯å¦å¼€å¯ vscode çš„ eslint
  "eslint.options": {
    // æŒ‡å®š vscode çš„ eslint æ‰€å¤„ç†çš„æ–‡ä»¶çš„åç¼€
    "extensions": [".js", ".ts", ".tsx"]
  },
  "eslint.validate": ["javascript"],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "git.ignoreLimitWarning": true
}
```


## å¼€å§‹

### å®‰è£… ESLintã€Prettier ç›¸å…³ä¾èµ–

é¿å…é‡å¤é€ è½®å­ï¼Œç¤¾åŒºä¸Šå·²æœ‰æœ€ä½³å®è·µï¼Œé€‰æ‹©å®ƒä»¬å³å¯ï¼Œæ¯”å¦‚ airbnbã€standardã€prettier ç­‰ã€‚å¦‚æœå›¢é˜Ÿæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè‡ªå®šä¹‰ä¸€äº›è§„åˆ™å³å¯ã€‚

è¿™é‡Œé€‰æ‹©çš„æ˜¯å›½å†…è…¾è®¯ AlloyTeam å›¢é˜Ÿå‡ºå“çš„ [eslint-config-alloy](https://alloyteam.github.io/eslint-config-alloy/?language=zh-CN)ã€‚


å…¶å®ä»–ä»¬å›¢é˜Ÿæœ€å¼€å§‹ä½¿ç”¨ Airbnb è§„åˆ™ï¼Œä½†æ˜¯ç”±äºå®ƒè¿‡äºä¸¥æ ¼ï¼Œéƒ¨åˆ†è§„åˆ™è¿˜æ˜¯éœ€è¦ä¸ªæ€§åŒ–ï¼Œå¯¼è‡´åæ¥è¶Šæ”¹è¶Šå¤šï¼Œæœ€åå†³å®šé‡æ–°ç»´æŠ¤ä¸€å¥—ã€‚ç»è¿‡ä¸¤å¹´å¤šçš„æ‰“ç£¨ï¼Œç°åœ¨ eslint-config-alloy å·²ç»éå¸¸æˆç†Ÿäº†ã€‚

æˆ‘é€‰æ‹©å®ƒçš„å‡ ç‚¹åŸå› ï¼š

* é€‚ç”¨äº React/Vue/Typescript é¡¹ç›®
* æ ·å¼ç›¸å…³è§„åˆ™ç”± Prettier ç®¡ç†
* æœ‰[ä¸­æ–‡æ–‡æ¡£](https://github.com/AlloyTeam/eslint-config-alloy/blob/master/README.zh-CN.md)å’Œç½‘ç«™[ç¤ºä¾‹](https://alloyteam.github.io/eslint-config-alloy/?language=zh-CN&rule=base)
* æ›´æ–°å¿«ï¼Œä¸”æ‹¥æœ‰å®˜æ–¹ç»´æŠ¤çš„ vueã€typescriptã€react+typescript è§„åˆ™

```shell
$ yarn add --dev babel-eslint@10.0.3
$ yarn add --dev eslint@6.7.1
$ yarn add --dev eslint-config-alloy@3.7.1
$ yarn add --dev eslint-config-prettier@6.10.0
$ yarn add --dev eslint-plugin-prettier@3.1.4
$ yarn add --dev prettier@2.0.5
$ yarn add --dev prettier-eslint-cli@5.0.0
```

### ESLintã€Prettier é…ç½®æ–‡ä»¶

> æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚

`.eslintrc.js` ğŸ‘‡

```js
module.exports = {
  root: true,
  parser: 'babel-eslint',
  env: {
    browser: true,
    es6: true,
    node: true,
    commonjs: true
  },
  extends: ['alloy'],
  plugins: ['prettier'],
  globals: {
    Atomics: 'readonly',
    SharedArrayBuffer: 'readonly',
    __DEV__: true,
    __WECHAT__: true,
    __ALIPAY__: true,
    App: true,
    Page: true,
    Component: true,
    Behavior: true,
    wx: true,
    my: true,
    swan: true,
    getApp: true,
    getCurrentPages: true
  },
  parserOptions: {
    ecmaVersion: 2018,
    sourceType: 'module'
  },
  rules: {
    'no-debugger': 2,
    'no-unused-vars': 1,
    'no-var': 0,
    'no-param-reassign': 0,
    'no-irregular-whitespace': 0,
    'no-useless-catch': 1,
    'max-params': ['error', 3],
    'array-callback-return': 1,
    eqeqeq: 0,
    indent: ['error', 2, { SwitchCase: 1 }]
  }
}
```

`.prettierrc.js` ğŸ‘‡

```js
module.exports = {
  printWidth: 120,
  tabWidth: 2,
  useTabs: false,
  semi: false,
  singleQuote: true,

  // å¯¹è±¡çš„ key ä»…åœ¨å¿…è¦æ—¶ç”¨å¼•å·
  quoteProps: 'as-needed',

  // jsx ä¸ä½¿ç”¨å•å¼•å·ï¼Œè€Œä½¿ç”¨åŒå¼•å·
  jsxSingleQuote: false,

  // æœ«å°¾ä¸éœ€è¦é€—å·
  trailingComma: 'none',

  // å¤§æ‹¬å·å†…çš„é¦–å°¾éœ€è¦ç©ºæ ¼
  bracketSpacing: true,

  // jsx æ ‡ç­¾çš„åå°–æ‹¬å·éœ€è¦æ¢è¡Œ
  jsxBracketSameLine: false,

  // ç®­å¤´å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæ— éœ€æ‹¬å·
  arrowParens: 'avoid',

  // æ¯ä¸ªæ–‡ä»¶æ ¼å¼åŒ–çš„èŒƒå›´æ˜¯æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
  rangeStart: 0,

  rangeEnd: Infinity,

  // ä¸éœ€è¦å†™æ–‡ä»¶å¼€å¤´çš„ @prettier
  requirePragma: false,

  // ä¸éœ€è¦è‡ªåŠ¨åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥ @prettier
  insertPragma: false,

  // ä½¿ç”¨é»˜è®¤çš„æŠ˜è¡Œæ ‡å‡†
  proseWrap: 'preserve',

  // æ ¹æ®æ˜¾ç¤ºæ ·å¼å†³å®š html è¦ä¸è¦æŠ˜è¡Œ
  htmlWhitespaceSensitivity: 'css',

  // æ¢è¡Œç¬¦ä½¿ç”¨ lf
  endOfLine: 'lf'
}
```

### é…ç½® ESLintã€Prettier å¿½ç•¥æ–‡ä»¶

> æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚

`.eslintignore` ğŸ‘‡

```.gitignore
# .eslintignore

*.min.js
typings
node_modules
```

`.prettierignore` ğŸ‘‡

```.gitignore
*.min.js
/node_modules
/dist
# OS
.DS_Store
.idea
.editorconfig
.npmrc
package-lock.json
# Ignored suffix
*.log
*.md
*.svg
*.png
*ignore
## Built-files
.cache
dist
```
### EditorConfig é…ç½®æ–‡ä»¶

å®ƒæ˜¯ç”¨æ¥æŠ¹å¹³ä¸åŒç¼–è¾‘å™¨ä¹‹é—´çš„å·®å¼‚çš„ã€‚åŒæ ·æ”¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚

> æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚

`.editorconfig` ğŸ‘‡

```ini
# .editorconfig
# http://editorconfig.org
# https://github.com/editorconfig/editorconfig/wiki/EditorConfig-Properties


# æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘å™¨ä¼šç”±å½“å‰ç›®å½•å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ° `roor = true` çš„æ–‡ä»¶ï¼Œåˆ™ä¸å†æŸ¥æ‰¾
root = true

# åŒ¹é…æ‰€æœ‰çš„æ–‡ä»¶
[*]
# ç¼©è¿›é£æ ¼ï¼šspace
indent_style = space
# ç¼©è¿›å¤§å° 2
indent_size = 2
# æ¢è¡Œç¬¦ lf
end_of_line = lf
# å­—ç¬¦é›† utf-8
charset = utf-8
# ä¸ä¿ç•™è¡Œæœ«çš„ç©ºæ ¼
trim_trailing_whitespace = true
# æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€ä¸ªç©ºè¡Œ
insert_final_newline = true
# è¿ç®—ç¬¦ä¸¤ééƒ½æœ‰ç©ºæ ¼
spaces_around_operators = true

# å¯¹æ‰€æœ‰çš„ js æ–‡ä»¶ç”Ÿæ•ˆ
[*.js]
# å­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·
quote_type = single

[*.md]
trim_trailing_whitespace = false
```

### æ·»åŠ  NPM Scripts 

æ·»åŠ ä¸‰æ¡è„šæœ¬æŒ‡ä»¤ï¼š

```json
{
  "scripts": {
    "eslint": "eslint ./ --ext .js",
    "eslint:fix": "eslint --fix ./ --ext .js",
    "prettier:fix": "prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'"
  }
}
```


è¿™æ ·å°±å¯ä»¥ä¸€é”®æ ¼å¼åŒ–å’Œä¿®å¤äº†ï¼Œæ³¨æ„ ESLint ä½¿ç”¨ `--fix` åªèƒ½ä¿®å¤ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œéƒ¨åˆ†éœ€æ‰‹åŠ¨è§£å†³ã€‚

```json
{
  "name": "wechat_applet_demo",
  "version": "1.0.0",
  "description": "å¾®ä¿¡å°ç¨‹åº Demo",
  "main": "app.js",
  "repository": "git@github.com:toFrankie/wechat_applet_demo.git",
  "author": "Frankie <1426203851@qq.com>",
  "license": "MIT",
  "private": true,
  "scripts": {
    "eslint": "eslint ./ --ext .js",
    "eslint:fix": "eslint --fix ./ --ext .js",
    "prettier:fix": "prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'"
  },
  "devDependencies": {
    "babel-eslint": "10.0.3",
    "eslint": "6.7.1",
    "eslint-config-alloy": "3.7.1",
    "eslint-config-prettier": "6.10.0",
    "eslint-plugin-prettier": "3.1.4",
    "prettier": "2.0.5",
    "prettier-eslint-cli": "5.0.0"
  }
}
```

## è¿˜æ²¡å®Œ

æ¥ä¸‹æ¥æ¶‰åŠ Gulp.js å†…å®¹ï¼Œæ˜¯ä¸ºäº†è®© Prettier å¤„ç† Gulp.js è½¬æ¢å‡ºæ¥çš„ `css`ï¼Œä»¥è¾¾åˆ°æœ€ç»ˆ Prettier æ ¼å¼åŒ–å¤„ç† `wxss` çš„ç›®çš„ã€‚


> ä¸Šè¿°æ–¹å¼èµ°äº†ä¸€äº›å¼¯è·¯ï¼Œå…¶å®é€šè¿‡ [Overrides](https://prettier.io/docs/en/configuration.html) é…ç½®æ˜¯å¯ä»¥æŒ‡å®š `.wxss` æ–‡ä»¶ä½¿ç”¨æŒ‡å®šçš„è§£æå™¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç† `.wxss` æ–‡ä»¶æ—¶ä½¿ç”¨ CSS è§£æå™¨å»å¤„ç†å®ƒå°±å¥½äº†ï¼Œå…·ä½“çœ‹[ç»“å±€ç¯‡](https://github.com/toFrankie/blog/issues/125)ã€‚


æœ¬æ–‡æœ€æƒ³åˆ†äº«çš„æ˜¯ä¸‹é¢çš„å†…å®¹ï¼Œå‰é¢å¾ˆç®€å•ã€‚

Prettier æ”¯æŒçš„ JavaScriptã€JSXã€Angularã€Vueã€Flowã€TypeScriptã€CSSã€Lessã€Scssã€HTMLã€JSONã€GraphQLã€Markdownï¼ˆGFMã€MDXï¼‰ã€YAML çš„ä»£ç æ ¼å¼åŒ–ã€‚

ä½†å…¶å®æ˜¯ä¸èƒ½è¯†åˆ« `wxss`ã€`acss` ç­‰å°ç¨‹åºç‰¹æœ‰çš„å±‚å æ ·å¼ï¼Œå°½ç®¡å®ƒä»¬è§„åˆ™ä¸ CSS æ— å¼‚ï¼Œä½†æ˜¯ Prettier å¹¶æ²¡æœ‰è§£æå™¨å»è§£æå®ƒä»¬ã€‚

æˆ‘ä»¬è¯•å›¾å»è°ƒæ•´è„šæœ¬å‘½ä»¤ä¸ºï¼ˆæ·»åŠ  `*.wxss` æ‰©å±•åçš„æ–‡ä»¶ï¼‰ï¼š
```json
{
  "scripts": {
    "prettier:fix": "prettier --config .prettierrc.js --write './**/*.wxss'",
  }
}
```
ç„¶åå»æ‰§è¡Œçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š
> [error] No parser could be inferred for file: app.wxss

æ—¢ç„¶è¿™æ ·èµ°ä¸é€šçš„è¯ï¼Œæ€»ä¸èƒ½åˆ©ç”¨ VS Code çš„ Prettier æ’ä»¶ä¸€ä¸ªä¸€ä¸ªåœ°å»æ ¼å¼åŒ– `*.wxss` çš„æ–‡ä»¶å§ï¼Œé‚£æ ·å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä¸ç¬¦åˆæˆ‘ä»¬â€œå·æ‡’â€çš„åšæ³•ã€‚ä¸‹é¢ä½¿ç”¨ [Gulp](https://www.gulpjs.com.cn/) æ¥å¤„ç†ã€‚

## Gulp

ç®€å•è¯´ä¸‹ Gulp çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ Node.js ä¸­çš„ `stream`ï¼ˆæµï¼‰ï¼Œé¦–å…ˆè·å–åˆ°éœ€è¦çš„ `stream`ï¼Œç„¶åé€šè¿‡ `stream` çš„ `pipe()` æ–¹æ³•æŠŠæµå¯¼å…¥åˆ°ä½ æƒ³è¦çš„åœ°æ–¹ã€‚æ¯”å¦‚ Gulp æ’ä»¶ä¸­ï¼Œç»è¿‡æ’ä»¶å¤„ç†åçš„æµåˆå¯ä»¥å¯¼å…¥åˆ°å…¶ä»–æ’ä»¶æ±‡æ€»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠæµå†™å…¥æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ Gulp æ˜¯ä»¥ `stream` ä¸ºåª’ä»‹çš„ï¼Œå®ƒä¸éœ€è¦é¢‘ç¹çš„ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ Gulp çš„é€Ÿåº¦æ¯” [Grunt](https://www.gruntjs.net/) å¿«çš„ä¸€ä¸ªåŸå› ã€‚

>æˆ‘åˆšå¼€å§‹æ—¶çš„æƒ³æ³•æ˜¯ï¼šé¦–å…ˆå°† `wxss`ï¼ˆ`acss`ï¼‰è½¬æ¢å¹¶å¯¼å‡ºä¸º `css`ï¼Œæ¥ç€åˆ é™¤  `wxss`ï¼ˆ`acss`ï¼‰æ–‡ä»¶ï¼Œå†è€…ä½¿ç”¨ Prettier å¯¹ `css` æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œè½¬å›  `wxss`ï¼ˆ`acss`ï¼‰ä¹‹åï¼Œå†åˆ é™¤æ‰ `css` æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šé¢‘ç¹çš„ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œæ€è·¯æ˜¯æœ‰ç‚¹åƒ Gruntã€‚
>
> ä½†æ˜¯äº†è§£äº† Gulp çš„æ€æƒ³åï¼Œå…¶å®å®ƒå¸®æˆ‘ä»¬çœæ‰äº†é¢‘ç¹å¢åˆ æ–‡ä»¶çš„ç¯èŠ‚ï¼Œå…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­æ“ä½œï¼Œä¹Ÿä¼šæ›´å¿«ä¸€äº›ï¼Œæ‰€ä»¥æ­¤å‰çš„æ–¹æ¡ˆè¢«æˆ‘å¦æ‰äº†ã€‚

ä¸‹é¢æˆ‘ä»¬åªç”¨åˆ° Gulp çš„å…¶ä¸­ä¸¤ä¸ª APIï¼Œ [`gulp.src()`](https://www.gulpjs.com.cn/docs/api/src/) å’Œ [`gulp.dest()`](https://www.gulpjs.com.cn/docs/api/dest/)ã€‚

### gulp.src()

è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è·å–æµçš„ï¼Œä½†è¦æ³¨æ„è¿™ä¸ªæµé‡Œé¢çš„å†…å®¹ä¸æ˜¯åŸå§‹çš„æ–‡ä»¶æµï¼Œè€Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡æµï¼ˆ[Vinyl files](https://www.gulpjs.com.cn/docs/api/vinyl/)ï¼‰ï¼Œè¿™ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡ä¸­å­˜å‚¨ç€åŸå§‹æ–‡ä»¶çš„è·¯å¾„ã€æ–‡ä»¶åã€å†…å®¹ç­‰ä¿¡æ¯ã€‚ï¼ˆè¿™é‡Œä¸æ·±å…¥ï¼Œç‚¹åˆ°ä¸ºæ­¢ï¼Œæœ‰å…´è¶£è‡ªè¡Œäº†è§£ï¼‰

> è¯­æ³•ï¼šgulp.src(globs[, options])

* **globs**ï¼šæ˜¯æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼Œç”¨æ¥åŒ¹é…æ–‡ä»¶è·¯å¾„ï¼ˆåŒ…æ‹¬æ–‡ä»¶åï¼‰
* **options**ï¼šä¸ºå¯é€‰å‚æ•°ï¼Œé€šå¸¸æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦ç”¨åˆ°

*å…³äºå‚æ•°è¯¦ç»†è¯´æ˜ï¼Œè¯·çœ‹[æ–‡æ¡£](https://www.gulpjs.com.cn/docs/api/src/)ã€‚

### gulp.dest()

è¯¥æ–¹æ³•æ˜¯ç”¨æ¥å†™æ–‡ä»¶çš„

> gulp.dest(path[, options])

* **path**ï¼šæ˜¯å†™å…¥æ–‡ä»¶çš„è·¯å¾„
* **options**ï¼šä¸ºå¯é€‰å‚æ•°ï¼Œé€šå¸¸æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦ç”¨åˆ°

è¦æƒ³ä½¿ç”¨å¥½ `gulp.dest()` è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¦ç†è§£ç»™å®ƒä¼ å…¥çš„è·¯å¾„å‚æ•°ä¸æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶çš„å…³ç³»ã€‚

Gulp çš„ä½¿ç”¨æµç¨‹ä¸€èˆ¬æ˜¯ï¼šé¦–å…ˆé€šè¿‡ `gulp.src()` æ–¹æ³•è·å–åˆ°æˆ‘ä»¬æƒ³è¦å¤„ç†çš„æ–‡ä»¶æµï¼Œç„¶åæŠŠæ–‡ä»¶æµé€šè¿‡ `pipe()` æ–¹æ³•å¯¼å…¥åˆ° Gulp çš„æ’ä»¶ä¸­ï¼Œæœ€åæŠŠç»è¿‡æ’ä»¶å¤„ç†åçš„æµå†é€šè¿‡ `pipe()` æ–¹æ³•å¯¼å…¥åˆ° `gulp.dest()` ä¸­ï¼Œ`gulp.dest()` æ–¹æ³•åˆ™æŠŠæµä¸­çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

è¿™é‡Œéœ€è¦å¼„æ¸…æ¥šçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ç»™ `gulp.dest()` ä¼ å…¥çš„è·¯å¾„å‚æ•°ï¼Œåªèƒ½ç”¨æ¥æŒ‡å®šè¦ç”Ÿæˆçš„æ–‡ä»¶çš„ç›®å½•ï¼Œè€Œä¸èƒ½æŒ‡å®šç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå®ƒç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶åä½¿ç”¨çš„æ˜¯å¯¼å…¥åˆ°å®ƒçš„æ–‡ä»¶æµè‡ªèº«çš„æ–‡ä»¶åï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ–‡ä»¶åæ˜¯ç”±å¯¼å…¥åˆ°å®ƒçš„æ–‡ä»¶æµå†³å®šçš„ï¼Œå³ä½¿æˆ‘ä»¬ç»™å®ƒä¼ å…¥ä¸€ä¸ªå¸¦æœ‰æ–‡ä»¶åçš„è·¯å¾„å‚æ•°ï¼Œç„¶åå®ƒä¹Ÿä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åå½“åšæ˜¯ç›®å½•åï¼Œä¾‹å¦‚ï¼š
```js
const gulp = require('gulp')
gulp.src('script/jquery.js').pipe(gulp.dest('dist/foo.js'))

// æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„ä¸º dist/foo.js/jquery.jsï¼Œè€Œä¸æ˜¯ dist/foo.js
```

è‹¥éœ€è¦ä¿®æ”¹æ–‡ä»¶åï¼Œéœ€è¦ä½¿ç”¨æ’ä»¶ [gulp-rename](https://www.npmjs.com/package/gulp-rename)ã€‚
* å…³äºä¸Šè¿° Gulp çš„ API ä¸æ–¹æ³•è¯´æ˜ï¼Œä¸»è¦å‚è€ƒè‡ª[å®˜æ–¹æ–‡æ¡£](https://www.gulpjs.com.cn/)ä¸æ— åŒçš„ä¸€ç¯‡[æ–‡ç« ](https://www.cnblogs.com/2050/p/4198792.html)ã€‚


## Gulp é…ç½®

é¦–å…ˆï¼Œå®‰è£… Gulp ç›¸å…³ä¾èµ–åŒ…ã€‚

```shell
$ yarn add --dev gulp@4.0.2
$ yarn add --dev gulp-clean@0.4.0
$ yarn add --dev gulp-debug@4.0.0
$ yarn add --dev gulp-prettier@3.0.0
$ yarn add --dev gulp-rename@2.0.0
```

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `gulpfile.js` æ–‡ä»¶ã€‚æ€è·¯å¦‚ä¸‹ï¼š

> ä½¿ç”¨ `gulp.src()` è·å–æµï¼Œç„¶åä½¿ç”¨ Gulp æ’ä»¶å¯¹æµåˆ†åˆ«ä½œé‡å‘½åï¼ˆgulp-renameï¼‰ã€æ ¼å¼åŒ–ï¼ˆ`gulp-prettier`ï¼‰ã€å†é‡å‘½åå›æ¥ï¼ˆ`gulp-rename`ï¼‰ã€æœ€åå¯¼å‡ºï¼ˆ`gulp.dest()`ï¼‰ã€‚è¿‡ç¨‹ä¸­æœ‰åˆ©ç”¨ `gulp-debug` æ’ä»¶æ¥æŸ¥çœ‹ä¸€äº›ä¿¡æ¯ã€‚

è¿™é‡Œæˆ‘å¯¹å¾®ä¿¡å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºçš„å±‚å æ ·å¼éƒ½å¤„ç†äº†ã€‚

```js
// gulpfile.js
const { series, parallel, src, dest } = require('gulp')
const rename = require('gulp-rename')
const debug = require('gulp-debug')
const clean = require('gulp-clean')
const prettier = require('gulp-prettier')
const config = require('./.prettierrc')

// wxss ä¸€é”®æ ¼å¼åŒ–
const wxssPrettier = () => {
  return src('./**/*.wxss')
    .pipe(
      // å¯ä»¥åˆ©ç”¨æ’ä»¶ï¼ŒæŸ¥çœ‹ä¸€äº› debug ä¿¡æ¯
      debug()
    )
    .pipe(
      // é‡å†™æ‰©å±•åä¸º cssï¼Œæ‰èƒ½è¢« Prettier è¯†åˆ«è§£æ
      rename({
        extname: '.css'
      })
    )
    .pipe(
      // Prettier æ ¼å¼åŒ–
      prettier(config)
    )
    .pipe(
      // é‡æ–°å°†æ‰©å±•åæ”¹ä¸º wxss
      rename({
        extname: '.wxss'
      })
    )
    .pipe(
      // å¯¼å‡ºæ–‡ä»¶
      dest(__dirname)
    )
}

// acss ä¸€é”®æ ¼å¼åŒ–
const acssPrettier = () => {
  return src('./**/*.acss')
    .pipe(debug())
    .pipe(
      rename({
        extname: '.css'
      })
    )
    .pipe(prettier(config))
    .pipe(
      rename({
        extname: '.acss'
      })
    )
    .pipe(dest(__dirname))
}

// è¿™é‡Œå¯¼å‡ºå¤šä¸ª taskï¼Œé€šè¿‡ gulp xxx å°±èƒ½æ¥è°ƒç”¨äº†ï¼Œå¦‚ gulp all
// å…³äº seriesã€parallel API åˆ†åˆ«æ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼ˆåŒæ­¥ï¼‰ã€åŒæ—¶æ‰§è¡Œï¼ˆå¹¶è¡Œï¼‰
module.exports = {
  all: parallel(wxssPrettier, acssPrettier),
  wxss: wxssPrettier,
  acss: acssPrettier
}
```

åœ¨é…ç½®ä¸‹ NPM Scriptï¼š

```json5
{
  "scripts": {
    "prettier:wxss": "gulp wxss",
    "prettier:accs": "gulp acss",
    "prettier:wxss:acss": "gulp all"
  }
}
```

ç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚

![](https://upload-images.jianshu.io/upload_images/5128488-7412e44f142f43d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## Git-Hooks

ä¸Šé¢å·²ç»å®ç°äº†å¯¹ `wxss`ã€`acss` æ‰©å±•åçš„æ–‡ä»¶è¿›è¡Œä¸€é”®æ ¼å¼åŒ–äº†ã€‚

è¿˜å¯ä»¥â€œæ›´æ‡’â€ä¸€äº›ï¼Œåˆ©ç”¨ [git-hooks](https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90) æˆ‘ä»¬å¯å®ç°åœ¨ `commit` ä¹‹å‰ï¼Œå¯¹é¡¹ç›®è¿›è¡Œ ESLintã€Prettier æ£€æµ‹å’Œæ ¼å¼åŒ–ï¼Œä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œå°†åœæ­¢ `commit` æ“ä½œã€‚

æœ¬æ–‡ç¯‡å¹…è¿‡é•¿ï¼Œæ”¾åˆ°[ä¸‹ç¯‡](https://github.com/toFrankie/blog/issues/124)æ¥ç€...


## æ’ä¸ªé¢˜å¤–è¯

ç”±äºæœ¬é¡¹ç›®çš„ npm åŒ…ä»…ç”¨äºä»£ç æ£€æŸ¥ä¸æ ¼å¼åŒ–ï¼Œå¹¶æœªå‚ä¸é¡µé¢ä»£ç é€»è¾‘ä¸­ã€‚æ‰€ä»¥æˆ‘åœ¨å°ç¨‹åºæœ¬åœ°é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸Š[æ‰“åŒ…é…ç½®é€‰é¡¹](https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html)ã€‚

> packOptions ç”¨ä»¥é…ç½®é¡¹ç›®åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­çš„é€‰é¡¹ã€‚æ‰“åŒ…æ˜¯é¢„è§ˆã€ä¸Šä¼ æ—¶å¯¹é¡¹ç›®è¿›è¡Œçš„å¿…é¡»æ­¥éª¤ã€‚
>
>ç›®å‰å¯ä»¥æŒ‡å®š `packOptions.ignore` å­—æ®µï¼Œç”¨ä»¥é…ç½®æ‰“åŒ…æ—¶å¯¹ç¬¦åˆæŒ‡å®šè§„åˆ™çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œå¿½ç•¥ï¼Œä»¥è·³è¿‡æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œè¿™äº›æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å°†ä¸ä¼šå‡ºç°åœ¨é¢„è§ˆæˆ–ä¸Šä¼ çš„ç»“æœå†…ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯æ”¯ä»˜å®å°ç¨‹åºï¼Œåœ¨ç¼–å†™æœ¬æ–‡æ—¶è¿˜æœªæ”¯æŒç±»ä¼¼ `ignore` é€‰é¡¹ã€‚

```json5
// project.config.json
{
  "packOptions": {
    "ignore": [
      {
        "type": "regexp",
        "test": "\\.md$"
      },
      {
        "type": "folder",
        "test": "node_modules"
      }
    ]
  }
}
```
