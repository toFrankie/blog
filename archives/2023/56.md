---
title: ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¸‰ï¼‰
number: '#56'
link: 'https://github.com/toFrankie/blog/issues/56'
created_at: '2023-02-25 19:28:53'
updated_at: '2023-04-26 21:49:06'
labels:
  - React
  - '2020'
---
æ¥ç€ç»§ç»­ä»‹ç» webpack é…ç½®

ä» webpack 4.0 å¼€å§‹ï¼Œwebpack å¯ä»¥é›¶é…ç½®å³å¯è¿›è¡Œæ‰“åŒ…ï¼Œé—¨æ§›è¿›ä¸€æ­¥é™ä½ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå¦‚æœç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæ‰§è¡Œ `yarn run build` å‘½ä»¤ï¼Œä¼šæœ‰ä¸€æ¡ `WRANING` ä¿¡æ¯ã€‚
> WARNING in configuration
The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
You can also set it to 'none' to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/

å¤§æ¦‚æ„æ€ï¼Œ`mode` é€‰é¡¹æ²¡æœ‰é…ç½®ï¼Œ`webpack` ä¼šæŠŠ `production` æœ€ä¸ºé»˜è®¤é…ç½®ã€‚

æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ `package.json`ï¼Œç»™å®ƒæŒ‡å®šäº† `mode` é€‰é¡¹ï¼Œ`WARNING` å°±æ²¡æœ‰äº†ã€‚
```json5
// package.json
{
  "scripts": {
    "build": "webpack --progress --colors --mode=production"
  }
}
```

é‚£ä¹ˆè¿™ `mode` æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé™¤äº†è¿™ä¸ªï¼Œè¿˜æœ‰ä»€ä¹ˆé…ç½®é€‰é¡¹å‘¢ï¼Ÿ

### ä¸€ã€å…ˆäº†è§£ webpack ä¸€äº›æ ¸å¿ƒé…ç½®
è¿™é‡Œæˆ‘ä¸å†è®²è¿°ï¼Œé‡Œé¢æœ‰é“¾æ¥ï¼Œå¯ä»¥ç‚¹å‡»å»äº†è§£ã€‚åç»­æ–‡ç« ï¼Œå¯¹è¿™äº›é…ç½®ä¹Ÿä¼šæœ‰æ›´è¯¦ç»†çš„ä»‹ç»ã€‚

* **[å…¥å£ï¼ˆentryï¼‰](https://webpack.docschina.org/concepts/#entry)**
* **[è¾“å‡ºï¼ˆoutputï¼‰](https://webpack.docschina.org/concepts/#output)**
* **[åŠ è½½å™¨ï¼ˆloaderï¼‰](https://webpack.docschina.org/concepts/#loaders)**
* **[æ’ä»¶ï¼ˆpluginï¼‰](https://webpack.docschina.org/concepts/#plugins)**
* **[æ¨¡å¼ï¼ˆmodeï¼‰](https://webpack.docschina.org/concepts/#mode)**

### äºŒã€å¼€å§‹å†™é¡µé¢äº†
æœ€æœ€æœ€ç®€å•çš„ webpack æ‰“åŒ…å·²ç»å­¦ä¼šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›è¡Œå¼€å‘å‘¢ï¼Ÿ

æŒ‰ç…§æˆ‘ä»¬ä¼ ç»Ÿå†™å‰ç«¯çš„æ–¹å¼ï¼Œå®ƒåº”è¯¥è¦æœ‰ä¸€ä¸ª `HTML` æ–‡ä»¶ï¼Œç„¶åå°† JSã€CSSã€å›¾ç‰‡ç­‰ç­‰å¼•å…¥åˆ°å…¶ä¸­ï¼Œè¿™å°±æ„æˆäº†æˆ‘ä»¬çš„å‰ç«¯é¡µé¢ã€‚

ä½†å…¶å®ï¼Œ`webpack` åªèƒ½è¯»å– `JavaScript` å’Œ `JSON` æ–‡ä»¶ï¼Œè¿™æ˜¯å¼€ç®±å¯ç”¨çš„è‡ªå¸¦èƒ½åŠ›ã€‚é‚£ä¹ˆé‡åˆ° CSSã€Imageã€HTML æ–‡ä»¶ webpack å¦‚ä½•å¤„ç†å‘¢ï¼Ÿé‚£ä¹ˆå®ƒå°±éœ€è¦ `loader` åŠ è½½å™¨å»å¤„ç†å®ƒä»¬ã€‚

è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ª `html-webpack-plugin` æ¥ç”Ÿæˆæˆ‘ä»¬çš„ HTML æ–‡ä»¶ã€‚

```shell
# å®‰è£… html-webpack-plugin
$ yarn add --dev html-webpack-plugin@3.2.0
```
æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ ä¸€ä¸ª `webpack.config.js` çš„æ–‡ä»¶ã€‚
```js
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin()
  ]
}

module.exports = config
```
ç„¶åæˆ‘ä»¬é‡æ–°æ‰“åŒ…ï¼Œçœ‹ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
```shell
$ yarn run build
```
![](https://upload-images.jianshu.io/upload_images/5128488-d78a920da2e34834.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å®ƒç»™æˆ‘ä»¬ç”Ÿæˆäº† `index.html` æ–‡ä»¶ï¼Œå¹¶å°†æˆ‘ä»¬æ‰“åŒ…åçš„ `main.js` å¼•å…¥å…¶ä¸­äº†ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ index.html æ–‡ä»¶å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº† `Hello Webpack!`ã€‚

åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ€æœ€æœ€ç®€å•çš„éœ€æ±‚å·²ç»å®Œæˆäº†ã€‚ä½¿ç”¨ webpack æ‰“åŒ…äº†ä¸€ä¸ªå‰ç«¯é¡µé¢ã€‚

### ä¸‰ã€ä¼˜åŒ–æˆ‘ä»¬è¾“å‡ºçš„ HTML æ–‡ä»¶

å…¶å®å•Šï¼Œ`html-webpack-plugin` ä¹Ÿå¯ä»¥æ ¹æ®æä¾›çš„æ¨¡æ¿HTMLæ¥ç”Ÿæˆçš„ç¬¦å·æˆ‘ä»¬è¦æ±‚çš„æ ·å­ã€‚

> ç»™è‡ªå·±æä¸ªéœ€æ±‚ï¼Œåœ¨ index.html è¦æœ‰ä¸€ä¸ªç«‹å³å‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼ŒImmediately Invoked Function Expressionï¼‰å»æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚ï¼ˆå…·ä½“ä»€ä¹ˆä¸é‡è¦ï¼‰

å†å€ŸåŠ©ä¸Šè¿°çš„æ–¹æ³•æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ

1. åœ¨ `/src` ä¸‹æ–°å»ºä¸€ä¸ª `index.html` æ–‡ä»¶
```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title><%= htmlWebpackPlugin.options.title %></title>
	</head>
	<script>
		!(function() {
			console.log('ç»™è‡ªå·±åŠ éœ€æ±‚ï¼Œä»€ä¹ˆäººå•Šï¼æ€•ä¸æ˜¯è„‘å­æœ‰æ¯›ç—…å§')
		})()
	</script>
	<body>
		<div id="app">This is app.</div>
	</body>
</html>
```
2. ä¿®æ”¹ `webpack.config.js` é…ç½®ã€‚
```js
const HtmlWebpackPlugin = require('html-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin({
      title: 'Hi', // æ¨¡æ¿è¦ä½¿ç”¨ <title><%= htmlWebpackPlugin.options.title %></title> é…ç½®æ‰ç”Ÿæ•ˆ
      template: './src/index.html', // æ¨¡æ¿è·¯å¾„
      filename: 'index.html', // è¾“å‡º HTML æ–‡ä»¶åç§°
      inject: 'body', // æ’å…¥çš„ script æ ‡ç­¾ä½äº body åº•éƒ¨ï¼Œtrue åŒç†
      hash: true, // åŠ ä¸Š hash å€¼
      favicon: './src/favicon.ico'
    })
  ]
}

module.exports = config
```
ç®€å•ä»‹ç»ä¸€ä¸‹ `html-webpack-plugin` çš„é…ç½®ï¼š
* **title**ï¼šç”Ÿæˆ HTML æ–‡ä»¶çš„æ ‡é¢˜ï¼Œéœ€é…åˆ `<%= htmlWebpackPlugin.options.title %>` ä½¿ç”¨ã€‚
* **template**ï¼šæ¨¡æ¿æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„ï¼Œå®ƒå¯ä»¥æ˜¯ htmlã€jadeã€ejsã€hbs ç­‰ã€‚ä½†æ˜¯éœ€è¦å®‰è£…å¯¹åº”çš„ loaderï¼Œå¦åˆ™ webpack å°†ä¸èƒ½è§£æã€‚
* **filename**ï¼šè¾“å‡º HTML æ–‡ä»¶åç§°ã€‚
* **inject**ï¼šæ³¨å…¥é€‰é¡¹ï¼Œå¯é€‰å€¼ï¼š`true`ã€`body`ã€`head`ã€`false`ã€‚
1ï¼‰trueï¼šé»˜è®¤å€¼ï¼Œscript æ ‡ç­¾ä½äº HTML æ–‡ä»¶çš„ body åº•éƒ¨ï¼›
2ï¼‰bodyï¼šåŒ trueï¼›
3ï¼‰headï¼šscript æ ‡ç­¾ä½äº head æ ‡ç­¾å†…ï¼›
4ï¼‰falseï¼šä¸æ’å…¥ç”Ÿæˆçš„ js æ–‡ä»¶ï¼Œåªæ˜¯å•çº¯çš„ç”Ÿæˆä¸€ä¸ª HTML æ–‡ä»¶ã€‚
* **favicon**ï¼šç½‘ç«™çš„ favicon å›¾æ ‡ã€‚
* **hash**ï¼šé»˜è®¤å€¼ falseã€‚ç»™ç”Ÿæˆçš„ js æ–‡ä»¶ä¸€ä¸ªç‹¬ç‰¹çš„ hash å€¼ï¼Œè¯¥ hash å€¼æ˜¯æœ¬æ¬¡ webpack ç¼–è¯‘çš„ hash å€¼ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚
* **minifyã€cacheã€chunks...**ï¼šè¿™äº›é€‰æ‹©å°±ä¸ä»‹ç»äº†ï¼Œæœ‰å…´è¶£è‡ªè¡Œæœç´¢æŸ¥æ‰¾ã€‚

3. æ‰“åŒ…ç»“æœï¼š
![ğŸ‰](https://upload-images.jianshu.io/upload_images/5128488-ab0708942a9b7850.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### å››ã€é™¤æ­¤ä¹‹å¤–
åˆ©ç”¨ `clean-webpack-plugin` æ¥æ¸…é™¤ output è¾“å‡ºæ–‡ä»¶ã€‚

ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ

å‡å¦‚æˆ‘ä»¬è¾“å‡º HTML çš„ `filename` æ˜¯å˜åŒ–çš„ï¼Œé‚£ä¹ˆæ¯æ‰“åŒ…ä¸€æ¬¡è¾“å‡ºçš„ `dist` ç›®å½•ï¼Œå°±ä¼šä¸æ–­åœ°ç§¯ç´¯å„ç§æ—§ç‰ˆæœ¬çš„è¾“å‡ºæ–‡ä»¶ï¼Œæ˜¾ç„¶è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ï¼ˆå¯è‡ªè¡Œä½“éªŒä¸€ä¸‹ï¼‰

é…ç½® `clean-webpack-plugin` ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š
```shell
$ yarn add --dev clean-webpack-plugin@3.0.0
```
```js
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin({
      title: 'Hi', // æ¨¡æ¿è¦ä½¿ç”¨ <title><%= htmlWebpackPlugin.options.title %></title> é…ç½®æ‰ç”Ÿæ•ˆ
      template: './src/index.html', // æ¨¡æ¿è·¯å¾„
      filename: 'index.html', // è¾“å‡º HTML æ–‡ä»¶åç§°
      inject: 'body', // æ’å…¥çš„ script æ ‡ç­¾ä½äº body åº•éƒ¨ï¼Œtrue åŒç†
      hash: true, // åŠ ä¸Š hash å€¼
      favicon: './src/favicon.ico'
    }),
    // æ–°ç‰ˆæ— éœ€å†æŒ‡å®šåˆ é™¤ç›®å½•ï¼Œé»˜è®¤åˆ é™¤ output ç›®å½•
    new CleanWebpackPlugin()
  ]
}

module.exports = config
```

æœ€åé™„ä¸Šï¼š
```json5
// package.json
{
	"name": "webpack4_demo",
	"version": "1.0.0",
	"description": "ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®",
	"main": "src/index.js",
	"repository": "git@github.com:toFrankie/webpack4_demo.git",
	"author": "Frankie <1426203851@qq.com>",
	"license": "MIT",
	"private": true,
	"scripts": {
		"build": "webpack --progress --colors --mode=production"
	},
	"dependencies": {
		"webpack": "4.41.2",
		"webpack-cli": "3.3.10"
	},
	"devDependencies": {
		"clean-webpack-plugin": "3.0.0",
		"html-webpack-plugin": "3.2.0"
	}
}
```

æœªå®Œå¾…ç»­ï¼Œä¸‹ä¸€ç¯‡ç»§ç»­å•Š~
