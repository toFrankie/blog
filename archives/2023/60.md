---
title: ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¸ƒï¼‰
number: '#60'
link: 'https://github.com/toFrankie/blog/issues/60'
created_at: '2023-02-25 19:38:17'
updated_at: '2023-04-26 21:49:08'
labels:
  - React
  - '2020'
---
ä¸Šä¸€ç¯‡ä»‹ç»äº† react-routerï¼Œä»Šå¤©ä»‹ç» reduxã€‚

### ä»€ä¹ˆæ˜¯ Reduxï¼Ÿ
ç°å¦‚ä»Šï¼Œæˆ‘ä»¬çš„é¡¹ç›®éƒ½æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„æ¨¡å—ç»„æˆçš„ï¼Œç»„ä»¶åŒ–çš„æ€æƒ³æ›´é€‚åˆå¤§ä¸”å¤æ‚çš„é¡¹ç›®ã€‚

åœ¨æ­¤ä¹‹å‰ï¼ŒReact å¹¶ä¸é€‚åˆå†™å¤§å‹åº”ç”¨ï¼Œå› ä¸ºå®ƒå½“æ—¶è¿˜æ²¡æœ‰å¾ˆå¥½åœ°è§£å†³**ç»„ä»¶ä¹‹é—´çš„é€šä¿¡**é—®é¢˜ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2014 å¹´ Facebook æå‡ºäº† [Flux](http://www.ruanyifeng.com/blog/2016/01/flux.html) æ¶æ„çš„æ¦‚å¿µï¼Œå¼•å‘äº†å¾ˆå¤šçš„å®ç°ã€‚2015 å¹´ï¼Œ[Redux](https://github.com/reduxjs/redux) å‡ºç°ï¼Œå°† Flux ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆåœ¨ä¸€èµ·ï¼Œå¾ˆçŸ­æ—¶é—´å†…å°±æˆä¸ºäº†æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶ã€‚

### ä»€ä¹ˆæ—¶å€™éœ€è¦ Reduxï¼Ÿ

æœ‰äººè¯´è¿‡ï¼ŒæŒºæœ‰é“ç†çš„å“ˆã€‚
```
å¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦ Reduxï¼Œé‚£å°±æ˜¯ä¸éœ€è¦å®ƒã€‚
```
åœ¨ä»¥ä¸‹åœºæ™¯ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å®ƒï¼š

* ç»„ä»¶é—´éœ€è¦å…±äº«çŠ¶æ€
* çŠ¶æ€éœ€è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½æ‹¿åˆ°
* ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€
* ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å…¨å±€çŠ¶æ€

*ä»¥ä¸Šå†…å®¹å¼•è‡ªé˜®ä¸€å³°è€å¸ˆçš„[åšå®¢](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html)ï¼Œæœ¬æ•™ç¨‹æ˜¯ä¸ºäº†æ¥å…¥è€Œæ¥å…¥ï¼Œå“ˆå“ˆã€‚

### Redux è®¾è®¡æ€æƒ³
* **Web åº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼ŒView ä¸ State æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚**
* **æ‰€æœ‰çš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚**

### åŸºæœ¬æ¦‚å¿µå’Œ API
å…ˆäº†è§£ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µå§
* **Store**ï¼šä¿å­˜æ•°æ®çš„å®¹å™¨ã€‚ç”± `Redux` æä¾›çš„ `createStore` å‡½æ•°æ¥ç”Ÿæˆå”¯ä¸€çš„ `Store` å¯¹è±¡ã€‚

* **State**ï¼š`Store` å¯¹è±¡åŒ…å«çš„æ•°æ®ã€‚å½“å‰çš„çŠ¶æ€ï¼Œå¯é€šè¿‡ `store.getState()` è·å–ã€‚Redux è§„å®šä¸€ä¸ª `State` å¯¹åº”ä¸€ä¸ª `View`ã€‚
* **Action**ï¼š`View` å‘å‡ºçš„åŠ¨ä½œï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»é¼ æ ‡ç­‰è¡Œä¸ºï¼‰é€šçŸ¥ `State` è¦å‘ç”Ÿæ”¹å˜ã€‚`Action` æ˜¯æ”¹å˜ `State` çš„å”¯ä¸€åŠæ³•ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ `type` å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè¡¨ç¤º `Action` çš„åç§°ï¼Œå…¶ä»–å±æ€§å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œå…¶ç¤¾åŒºæœ‰ä¸€ä¸ª[è§„èŒƒ](https://github.com/redux-utilities/flux-standard-action)å¯ä»¥å‚è€ƒã€‚å¦‚ `const action = { type: 'SOMETHING_TODO', payload: 'SOME DATA' }`ã€‚
* **Action Creator**ï¼šç”Ÿæˆ `Action` çš„å‡½æ•°ã€‚å½“æœ‰è‹¥å¹² `Action` æ—¶ï¼Œå…¨éƒ¨æ‰‹å†™å¯èƒ½ç•¥æ˜¾éº»çƒ¦ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ `Action`ï¼Œè¿™ç§å‡½æ•°å«åš `Action Creator`ã€‚
* **store.dispatch()**ï¼šæ˜¯ `View` å‘å‡º `Action` çš„å”¯ä¸€æ–¹å¼ã€‚
* **Reducer**ï¼šå½“ `Store` æ”¶åˆ° `Action` ä¹‹åï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ `State`ï¼Œè¿™æ · `View` æ‰ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ç§ `State`çš„è®¡ç®—è¿‡ç¨‹å«åš `Reducer`ã€‚å®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚
* **Pure Function**ï¼šå³çº¯å‡½æ•°ï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡ºï¼Œä¸”æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨
* **store.subscribe()**ï¼šç›‘å¬ `State` çš„å˜åŒ–ï¼Œä¸€æ—¦ `State` å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œè¯¥è¿”å›å‡½æ•°å°±è§£é™¤ç›‘å¬ã€‚

### å®ç°æœ€ç®€å•çš„ Store æ¡ˆä¾‹
å…ˆå®‰è£… `redux` ä¾èµ–ã€‚
```shell
$ yarn add redux@4.0.4
```
åœ¨ `src/js/store` ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `index.js` æ–‡ä»¶ã€‚
```jsx
// store/index.js
import { createStore } from 'redux'

// Reducer å¤„ç†å‡½æ•°
const reducer = (prevState, action) => {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      // ä¸€å®šè¦ä¸èƒ½ä¿®æ”¹ stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‰¯æœ¬
      // å€˜è‹¥ state æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸€å®šè¦å€ŸåŠ© Object.assignã€å¯¹è±¡å±•å¼€è¿ç®—ç¬¦(...)ã€å…¶ä»–åº“çš„æ‹·è´æ–¹æ³•æˆ–è€…è‡ªå·±å®ç°æ·±æ‹·è´æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°å‰¯æœ¬
      return prevState + payload
    case 'SUB':
      return prevState - payload
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›æ—§çš„ state
      return prevState
  }
}

// åˆå§‹å€¼
const initialState = 0

// åˆ›å»º Storeï¼ˆä¹Ÿå¯ä»¥ä¸ä¼ å…¥ initialState å‚æ•°ï¼Œè€Œå°† reducer ä¸­çš„ state è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼‰
const store = createStore(reducer, initialState)

// ç›‘å¬ state å˜åŒ–
// const unsubscribe = store.subscribe(() => {
//   console.log('ç›‘å¬ state å˜åŒ–', store.getState())
// })

// è§£é™¤ç›‘å¬
// unsubscribe()

export default store
```
æˆ‘ä»¬åœ¨ Home ç»„ä»¶å¼•å…¥ Storeï¼Œå¹¶ä¿®æ”¹æˆï¼š
```jsx
// pages/home/index.js
import React, { Component } from 'react'
import store from '../../store'

class Home extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  // Action Creator å‡½æ•°
  actionCreator(type, payload) {
    return { type, payload }
  }

  handle(type, val) {
    // åˆ›å»º Action
    const action = this.actionCreator(type, val)
    // æ´¾å‘ Action
    store.dispatch(action)
    // è·å– State å¿«ç…§
    console.log(`å½“å‰æ“ä½œæ˜¯ ${type}ï¼ŒState ä¸ºï¼š${store.getState()}`)
  }

  render() {
    return (
      <div>
        <h3>Home Component!</h3>
        <button onClick={this.handle.bind(this, 'ADD', 1)}>åŠ ä¸€</button>
        <button onClick={this.handle.bind(this, 'SUB', 1)}>å‡ä¸€</button>
      </div>
    )
  }
}

export default Home
```
ä¸Šé¢æ¡ˆä¾‹ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªå¾ˆç®€å•çš„åŠ å‡æ“ä½œã€‚

é€šè¿‡ `redux` æä¾›çš„ `createStore` å‡½æ•°åˆ›å»ºäº†å”¯ä¸€çš„ä¸€ä¸ª `store` å¯¹è±¡ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•° `createStore(reducer, [preloadedState], enhancer)` ï¼Œå…¶ä¸­ç¬¬ä¸€ç¬¬äºŒä¸ªåˆ†åˆ«æ˜¯ `reducer` å‡½æ•°å’Œåˆå§‹å€¼ï¼Œç¬¬ä¸‰ä¸ªä¸€èˆ¬æ˜¯ä½¿ç”¨ä¸­é—´ä»¶æ—¶ç”¨åˆ°ï¼Œæˆ‘ä»¬åé¢ä¼šç”¨åˆ°ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€æ¢è®¨ã€‚ï¼ˆç‚¹[è¿™é‡Œ](https://redux.js.org/api/createstore)äº†è§£æ›´å¤šï¼‰

`Reducer` å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•° `reducer(state, action)`ï¼Œåˆ†åˆ«æ˜¯ **previousStateï¼ˆæ—§çŠ¶æ€ï¼‰** å’Œ **Action**ã€‚åœ¨é¦–æ¬¡æ‰§è¡Œ `state` ä¸º `undefined`ï¼Œå¯ä»¥ä¸ºå®ƒè®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œæˆ–è€…åœ¨ `createStore` ä¸­ä¼ å…¥ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼ [Array.prototype.reduce()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)ã€‚

å€ŸåŠ©æˆ‘ä»¬åœ¨ `Home` ç»„ä»¶ä¸‹å¼•å…¥ `store`ï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªæŒ‰é’®ï¼Œå¯¹ `store` çš„ `state` åšåŠ å‡æ“ä½œã€‚
![ğŸ‰](https://upload-images.jianshu.io/upload_images/5128488-f0a44fb96c31ed6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### è‡³æ­¤
æˆ‘ä»¬æœ€ç®€å• redux æ¡ˆä¾‹å®ç°äº†ï¼Œä½†æ˜¯è¿™ä¸ªè·ç¦»æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜ä¸å¤Ÿå“¦ã€‚

åœ¨æ­¤æŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š
* å¦‚ä½•æ¥å…¥æˆ‘ä»¬çš„ Component äº†ï¼Œå½“ state å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿å…¶è‡ªåŠ¨æ›´æ–° Viewï¼Ÿ
* ç»„ä»¶å¦‚ä½•å…±äº« Storeï¼Ÿ
* å¦‚ä½•æŸ¥çœ‹ State çš„å˜åŒ–ï¼Ÿ

ä¸‹æ–‡ç»§ç»­ï¼Œæœªå®Œå¾…ç»­â€¦
