---
title: Taro è‡ªå®šä¹‰ TabBar for H5 ç¤ºä¾‹
number: '#331'
link: 'https://github.com/toFrankie/blog/issues/331'
created_at: '2024-03-16 01:14:07'
updated_at: '2024-03-16 15:47:47'
labels:
  - '2023'
  - React
  - å‰ç«¯
---
## èƒŒæ™¯

æœ€è¿‘åœ¨åš Taro é¡¹ç›®ï¼Œæœ‰å¾®ä¿¡å°ç¨‹åºå’Œ H5 ä¸¤ç«¯ï¼Œå› å¯¼èˆªæ æ ·å¼æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œéœ€å®žçŽ°è‡ªå®šä¹‰ TabBarã€‚

ç›®å‰ Taro for H5 æœªé»˜è®¤æ”¯æŒè‡ªå®šä¹‰ TabBarï¼Œè¯¦è§ [#10049](https://github.com/NervJS/taro/issues/10049)ã€‚

## å¼€å§‹ä¹‹å‰

ç›¸å…³é“¾æŽ¥ï¼š

- [å¾®ä¿¡å°ç¨‹åºè‡ªå®šä¹‰ tabBar](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html)
- [å¾®ä¿¡å°ç¨‹åºè‡ªå®šä¹‰ Tabbarï¼ˆTaroï¼‰](https://taro-docs.jd.com/docs/custom-tabbar)

æ³¨æ„äº‹é¡¹ï¼š

- æ–‡ä»¶åä¸º `custom-tab-bar`ï¼Œä¸”æ”¾åœ¨ `src` ç›®å½•ä¸‹ã€‚
- å®Œæ•´é…ç½® `tabBar` å­—æ®µï¼Œä¸€æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼ŒäºŒæ˜¯ä¸é…ç½®çš„æƒ…å†µä¸‹ H5 ç«¯åˆ‡æ¢é¡µé¢çš„ä½“éªŒå¾ˆå·®ã€‚åŽè€…ä¸ç¡®å®šæ˜¯å¦å› ä¸º Taro ä¸æ”¯æŒæ‰€ä»¥æ²¡åšå…¼å®¹ã€‚
- ç”±äºŽ H5 ç«¯æœªå¾—åˆ°å®˜æ–¹æ”¯æŒï¼Œå› æ­¤é…ç½® `custom: true` ç¼–è¯‘ä¸º H5 æ—¶æ˜¯æ— æ•ˆçš„ã€‚

å®žçŽ°æ€è·¯ï¼š

å¯¹äºŽå¾®ä¿¡å°ç¨‹åºæ¥è¯´ï¼ŒTaro å·²ç»æ”¯æŒäº†ï¼Œè¿™ä¸ªä¸å¤šè¯´ï¼ŒæŒ‰è¦æ±‚å†™å°±èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚è€Œ H5 åˆ™åœ¨ TabBar é¡µé¢ä¸­å¼•å…¥ `custom-tab-bar` å³å¯ã€‚æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯å†…ç½®çš„ TabBar ä»ç„¶å­˜åœ¨ï¼Œé€šè¿‡æ ·å¼å°†å…¶å±è”½æŽ‰ã€‚äºŒæ˜¯ï¼Œåœ¨ TabBar é¡µé¢åˆ‡æ¢æ—¶ï¼Œç”±äºŽç»„ä»¶ä¸ä¼šé‡æ–°æŒ‚è½½ï¼Œå¯èƒ½ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œä¸ºé¿å… Tab çš„é«˜äº®çŠ¶æ€ä¸æ­£ç¡®ï¼Œéœ€åœ¨ `onShow` æ—¶æœºè¿›è¡Œè®¾ç½®ã€‚

å¼•å…¥ `custom-tab-bar` é¡µé¢çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨æ¯ä¸ª TabBar é¡µé¢ä¸­æ‰‹åŠ¨å¼•å…¥ï¼ˆä¸€èˆ¬ä¸ä¼šå¾ˆå¤šï¼‰ï¼ŒäºŒæ˜¯é€šè¿‡æ’ä»¶ï¼ˆæ¯”å¦‚ [taro-inject-component-loader](https://github.com/xdoer/taro-inject-component-loader)ï¼‰è‡ªåŠ¨æ’å…¥åˆ°æ¯ä¸ªé¡µé¢ã€‚åŽè€…ï¼Œè¿˜éœ€è¦åœ¨ç»„ä»¶å†…è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œè‹¥æ˜¯ TabBar çš„è·¯ç”±åˆ™æ˜¾ç¤ºè‡ªå®šä¹‰ TabBar çš„å†…å®¹ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚

> ä¸‹æ–‡ä»¥ React ä¸ºä¾‹ï¼Œå¹¶é€‰æ‹©ç¬¬äºŒç§æ–¹å¼å¯¼å…¥è‡ªå®šä¹‰ TabBarã€‚


## å®žçŽ°


å°ç¨‹åºé…ç½® `app.config.js`ï¼Œè®°å¾—å®Œæ•´é…ç½® `tabBar`ã€‚

```diff
export default defineAppConfig({
  tabBar: {
+   custom: true,
    // ...
  },
})
```

å®‰è£… `taro-inject-component-loader`ï¼Œå¦‚æžœæ‰‹åŠ¨å¼•å…¥ `custom-tab-bar` å¯ä»¥å¿½ç•¥ã€‚

```shell
$ pnpm add taro-inject-component-loader -D
```

ç¼–è¯‘é…ç½® `config/index.js` å¦‚ä¸‹ï¼š

```diff
import path from 'path'

export default {
  // ...
  alias: {
+   '@': path.resolve('./src'),
  },
  h5: {
    // ...
    webpackChain(chain) {
      chain.merge({
        module: {
          rule: {
            injectBaseComponentLoader: {
              test: /\.jsx$/,
              use: [
                {
+                 loader: 'taro-inject-component-loader',
+                 options: {
+                   importPath: '@/custom-tab-bar',
+                 },
                },
              ],
            },
          },
        },
      })
    },
  },
}
```

ç¼–å†™ `custom-tab-bar` ç»„ä»¶ï¼Œå‡ ä¸ªæ³¨æ„ç‚¹ï¼š

- éž TabBar é¡µé¢ï¼Œä¸æ˜¾ç¤º `custom-tab-bar` ç»„ä»¶å†…å®¹ã€‚
- ä¸ºé¿å…éž TabBar é¡µé¢è¿”å›ž TabBar é¡µé¢æ—¶ï¼Œåœ¨åˆ‡æ¢çš„é—´éš™ï¼Œå¯èƒ½ä¼šå‡ºçŽ° `custom-tab-bar` éšè— â†’ æ˜¾ç¤º â†’ éšè—çš„è¿‡ç¨‹ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œè¦ä½¿ç”¨ä¸€å®šçš„ç¼“å­˜å¤„ç†ã€‚
- ç”±äºŽ TabBar é¡µé¢ä¹‹é—´åˆ‡æ¢ä¸ä¸€å®šèƒ½è§¦å‘ rerenderï¼Œå› æ­¤è¦åœ¨ `onShow` ç”Ÿå‘½å‘¨æœŸè®¾ç½® Tab çš„é«˜äº®çŠ¶æ€ï¼Œä»¥ç¡®ä¿ Tab æ­£ç¡®æ˜¾ç¤ºã€‚
- ç”±äºŽåªæœ‰åœ¨é¡µé¢çº§åˆ«çš„ç»„ä»¶å†…æ‰ä¼šè§¦å‘ `onShow` ç”Ÿå‘½å‘¨æœŸï¼ˆ[è¯¦è§](https://taro-docs.jd.com/docs/react-page#componentdidshow-)ï¼‰ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ [`Taro.eventCenter`](https://taro-docs.jd.com/docs/apis/about/events) æ¥ç›‘å¬é¡µé¢ç»„ä»¶çš„ `onShow` ç”Ÿå‘½å‘¨æœŸã€‚
- å…³äºŽå›¾ç‰‡èµ„æºå¼•ç”¨é—®é¢˜ï¼Œå°ç¨‹åºç«¯å¯ä»¥ä¸ç”¨ `import` å¯¼å…¥çš„æ–¹å¼ï¼ŒTaro ä¼šè‡ªåŠ¨æ ¹æ® TabBar é…ç½®å¤„ç†ï¼ˆ[è¯¦è§](https://taro-docs.jd.com/docs/custom-tabbar#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8)ï¼‰ã€‚è€Œ H5 ç”±äºŽå®˜æ–¹æœªæ”¯æŒï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ `import` å¯¼å…¥ã€‚
- å®˜æ–¹æä¾›äº†ä¸€ä¸ª React çš„[ç¤ºä¾‹](https://github.com/NervJS/taro/blob/898fbc70f1916f4ab7152633b4c8a14ce9814db8/examples/custom-tabbar-react/src/custom-tab-bar/index.tsx#L7)ï¼Œä½¿ç”¨çš„æ˜¯ Class Componentï¼Œå®ƒå¯ä»¥é€šè¿‡ `Taro.getTabBar()` èŽ·å–ç»„ä»¶å®žä¾‹ï¼Œè¿›è€Œæ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚ä½†åœ¨ H5 ç«¯å¹¶æœªæä¾› `Taro.getTabBar()` æ–¹æ³•ï¼Œå› æ­¤å®ƒæ— æ³•å…¼å®¹å°ç¨‹åºå’Œ H5 ä¸¤ç«¯ã€‚å› æ­¤ä¸‹é¢æˆ‘ä¼šç”¨ Functional Componentï¼Œå¹¶ç»Ÿä¸€ç”¨ Taro çš„æ¶ˆæ¯æœºåˆ¶æ¥æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚

`src/constants/index.js` ðŸ‘‡ 

```js
export const IS_H5 = process.env.TARO_ENV === 'h5'

export const ROUTE = {
  INDEX: '/pages/index/index',
  MINE: '/pages/mine/index',
}

export const TAB_BAR_ROUTES = [ROUTE.INDEX, ROUTE.MINE]

export const EVENT_NAME = {
  TAB_BAR_PAGE_VISIBLE: 'tab_bar_page_visible',
}
```


`src/custom-tab-bar/index.jsx` ðŸ‘‡

```jsx
import { useMemo, useState } from 'react'
import { View, Image } from '@tarojs/components'
import Taro, { eventCenter } from '@tarojs/taro'

import { IS_H5, EVENT_NAME, TAB_BAR_ROUTES } from '@/constants'

import indexIcon from '@/images/icon-index.png'
import indexIconActive from '@/images/icon-index-active.png'
import mineIcon from '@/images/icon-mine.png'
import mineIconActive from '@/images/icon-mine-active.png'

import './index.scss'

const tabBarConfig = {
  color: '#7A7E83',
  selectedColor: '#3CC51F',
  backgroundColor: '#F7F7F7',
  borderStyle: 'black',
  list: [
    {
      iconPath: IS_H5 ? indexIcon : '../images/icon-index.png',
      selectedIconPath: IS_H5 ? indexIconActive : '../images/icon-index-active.png',
      pagePath: '/pages/index/index',
      text: 'é¦–é¡µ',
    },
    {
      iconPath: IS_H5 ? mineIcon : '../images/icon-mine.png',
      selectedIconPath: IS_H5 ? mineIconActive : '../images/icon-mine-active.png',
      pagePath: '/pages/mine/index',
      text: 'æˆ‘çš„',
    },
  ],
}

export default function CustomTabBar() {
  const [selected, setSelected] = useState(-1)

  const onChange = (index, url) => {
    setSelected(index)
    Taro.switchTab({ url })
  }

  const currentRoute = useMemo(() => {
    const pages = Taro.getCurrentPages()
    const currentPage = pages[pages.length - 1]
    return currentPage.route?.split('?')[0]
  }, [])

  const isTabBarPage = useMemo(() => {
    return tabBarConfig.list.some(item => {
      // å¦‚æœ‰åšè·¯ç”±æ˜ å°„ï¼Œæ­¤å¤„å¯èƒ½è¦è°ƒæ•´åˆ¤æ–­æ¡ä»¶
      const matched = TAB_BAR_ROUTES.find(route => route === currentRoute)
      return matched && item.pagePath === matched
    })
  }, [currentRoute])

  // ä»¥é¿å…å¤šä½™çš„ç›‘å¬ï¼Œç‰¹åˆ«æ˜¯ rerender æ—¶
  useState(() => {
    if (!isTabBarPage) return
    eventCenter.on(EVENT_NAME.TAB_BAR_PAGE_VISIBLE, index => setSelected(index))
  })

  const element = useMemo(() => {
    if (IS_H5 && !isTabBarPage) return null

    return (
      <View className="tab-bar">
        {tabBarConfig.list.map((item, index) => (
          <View
            key={item.pagePath}
            className="tab-bar-item"
            onClick={() => onChange(index, item.pagePath)}
          >
            <Image
              className="tab-bar-icon"
              src={selected === index ? item.selectedIconPath : item.iconPath}
            />
            <View
              className="tab-bar-text"
              style={{color: selected === index ? tabBarConfig.selectedColor : tabBarConfig.color}}
            >
              {item.text}
            </View>
          </View>
        ))}
      </View>
    )
  }, [selected, isTabBarPage])

  return element
}
```





æœªå®Œå¾…ç»­...
