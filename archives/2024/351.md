---
title: å°ç¨‹åºå›¾æ ‡å˜è‰²
number: '#351'
link: 'https://github.com/toFrankie/blog/issues/351'
created_at: '2024-11-19 17:11:27'
updated_at: '2024-11-19 22:01:40'
labels:
  - å°ç¨‹åº
  - CSS
  - å‰ç«¯
  - '2024'
---

å›¾æ ‡å˜è‰²æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·å¿ƒæƒ…è‡ªåŠ¨åˆ‡æ¢çš®è‚¤ã€‚ğŸ¶

ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ã€‚

## ä½¿ç”¨ svg æ ‡ç­¾

ç¬¬ä¸€ååº”æ˜¯ç”¨ svg + currentColorã€‚æ¯”å¦‚ï¼š

```html
<div class="box">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 15.7715 20.4004" width="15.7715" height="20.4004" >
    <path
      d="M11.3965 4.66797C9.94141 4.66797 8.75 5.55664 7.98828 5.55664C7.17773 5.55664 6.12305 4.66797 4.85352 4.66797C2.44141 4.66797 0 6.71875 0 10.4688C0 12.8125 0.898438 15.2832 2.02148 16.875C2.97852 18.2227 3.81836 19.3066 5.0293 19.3066C6.2207 19.3066 6.74805 18.5352 8.23242 18.5352C9.73633 18.5352 10.0781 19.3066 11.3965 19.3066C12.7051 19.3066 13.5742 18.1055 14.4043 16.9238C15.3223 15.5664 15.7129 14.248 15.7227 14.1797C15.6445 14.1602 13.1445 13.1348 13.1445 10.2734C13.1445 7.79297 15.1074 6.67969 15.2246 6.5918C13.9258 4.72656 11.9434 4.66797 11.3965 4.66797ZM10.7129 3.08594C11.3086 2.36328 11.7285 1.37695 11.7285 0.380859C11.7285 0.244141 11.7188 0.107422 11.6992 0C10.7227 0.0390625 9.55078 0.644531 8.85742 1.46484C8.30078 2.08984 7.79297 3.08594 7.79297 4.08203C7.79297 4.23828 7.82227 4.38477 7.83203 4.43359C7.89062 4.44336 7.98828 4.46289 8.0957 4.46289C8.96484 4.46289 10.0586 3.87695 10.7129 3.08594Z"
    />
  </svg>
</div>
```

```css
.box {
  color: #0066cc;
}

.box svg {
  fill: currentColor;
}
```

[CodePen](https://codepen.io/tofrankie/pen/rNXgpvK)

åŠ¨æ€ä¿®æ”¹çˆ¶å…ƒç´ çš„é¢œè‰²å°±èƒ½å˜è‰²ã€‚

**ç„¶è€Œï¼Œå¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒ `<svg />` æ ‡ç­¾ï¼Œç»æ€äº†ã€‚**

## ä½¿ç”¨ image æ ‡ç­¾

å°ç¨‹åº `<image />` æ˜¯æ”¯æŒ svg æ ¼å¼å›¾ç‰‡çš„ï¼ˆ[ä¸€äº›é™åˆ¶](https://developers.weixin.qq.com/miniprogram/dev/component/image.html#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0)ï¼‰ã€‚

ä½†æ³¨æ„ï¼Œå°† `fill="currentColor"` çš„ svg å›¾ç‰‡æ”¾åˆ° image æ ‡ç­¾ï¼Œè¯¥å›¾ç‰‡æ˜¯æ— æ³•è¯»å–å…¶æœ¬èº«æˆ–çˆ¶çº§é¢œè‰²çš„ï¼Œå› æ­¤å‘ˆç°çš„æ˜¯é»˜è®¤é»‘è‰²ã€‚

å› æ­¤è¦åšä¸€äº›è½¬æ¢å¤„ç†ï¼Œæ­¥éª¤ï¼š

1. ä¸‹è½½ svg å›¾ç‰‡
2. è¯»å– svg å›¾ç‰‡æ–‡ä»¶æºç 
3. æ›¿æ¢ svg fill å±æ€§ä¸ºæŒ‡å®šé¢œè‰²
4. å°†æ›¿æ¢åçš„ svg æ–‡ä»¶è½¬åŒ–ä¸º base64



```js
function genColorfulSvg(url, color) {
  const localFilePath = await downloadSvgFile(url)
  const svgSourceStr = await readSvgFile(localFilePath)
  const colorfulSvgSourceStr = replaceSvgFillColor(svgSourceStr, color)
  const colorfulSvgBase64 = genSvgBase64(colorfulSvgSourceStr)
  return colorfulSvgBase64
}
```

æ‹†åˆ†ä¸‹ï¼š

```js
// ä¸‹è½½å›¾ç‰‡
async function downloadSvgFile(url) {
  return new Promise((resolve, reject) => {
    wx.downloadFile({
      url,
      success: res => {
        if (res.statusCode === 200) return resolve(res.tempFilePath)
        reject(new Error('download file fail'))
      },
      fail: err => reject(err),
    })
  })
}
```

```js
// è¯»å– svg æ–‡ä»¶
async function readSvgFile(localFilePath) {
  return new Promise((resolve, reject) => {
    const fs = wx.getFileSystemManager()
    fs.readFile({
      filePath: localFilePath,
      encoding: 'utf-8',
      position: 0,
      success: res => {
        const sourceFile = res.data
        resolve(sourceFile)
      },
      fail: err => reject(err),
    })
  })
}
```

```js
// æ›¿æ¢ fill å±æ€§
function replaceSvgFillColor(svgSourceStr, newFillColor) {
  // åŒ¹é… fill="..." ä¸­çš„é none å€¼ï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰
  return svgSourceStr.replace(/fill="(?!none)[^"]*"/g, `fill="${newFillColor}"`)
}
```

```js
// ç”Ÿæˆ base64
function genSvgBase64(svgSourceStr) {
  return `data:image/svg+xml;base64,${base64Encode(svgSourceStr)}`
}
```

> ç¤ºä¾‹ä¸­ `base64Encode()` æ¥è‡ªæ˜é‡‘ç¤¾åŒºï¼ˆ[åŸæ–‡](https://juejin.cn/post/7229512717135527991)ï¼‰ï¼Œæ‰¾å…¶ä»–ä¹Ÿè¡Œã€‚

æœªå®Œå¾…ç»­...
