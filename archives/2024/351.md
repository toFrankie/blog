---
title: å°ç¨‹åºå›¾æ ‡å˜è‰²
number: '#351'
link: 'https://github.com/toFrankie/blog/issues/351'
created_at: '2024-11-19 17:11:27'
updated_at: '2024-12-10 11:31:30'
labels:
  - å°ç¨‹åº
  - CSS
  - å‰ç«¯
  - '2024'
---


![é…å›¾æºè‡ª Freepik](https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732448028116.jpg)

å›¾æ ‡å˜è‰²æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·å¿ƒæƒ…è‡ªåŠ¨åˆ‡æ¢çš®è‚¤ã€‚ğŸ¶

æœ¬æ–‡ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ã€‚

## ä½¿ç”¨ svg æ ‡ç­¾

ç¬¬ä¸€ååº”æ˜¯ç”¨ svg + currentColorã€‚æ¯”å¦‚ï¼š

```html
<div class="box">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 15.7715 20.4004" width="15.7715" height="20.4004" >
    <path
      d="M11.3965 4.66797C9.94141 4.66797 8.75 5.55664 7.98828 5.55664C7.17773 5.55664 6.12305 4.66797 4.85352 4.66797C2.44141 4.66797 0 6.71875 0 10.4688C0 12.8125 0.898438 15.2832 2.02148 16.875C2.97852 18.2227 3.81836 19.3066 5.0293 19.3066C6.2207 19.3066 6.74805 18.5352 8.23242 18.5352C9.73633 18.5352 10.0781 19.3066 11.3965 19.3066C12.7051 19.3066 13.5742 18.1055 14.4043 16.9238C15.3223 15.5664 15.7129 14.248 15.7227 14.1797C15.6445 14.1602 13.1445 13.1348 13.1445 10.2734C13.1445 7.79297 15.1074 6.67969 15.2246 6.5918C13.9258 4.72656 11.9434 4.66797 11.3965 4.66797ZM10.7129 3.08594C11.3086 2.36328 11.7285 1.37695 11.7285 0.380859C11.7285 0.244141 11.7188 0.107422 11.6992 0C10.7227 0.0390625 9.55078 0.644531 8.85742 1.46484C8.30078 2.08984 7.79297 3.08594 7.79297 4.08203C7.79297 4.23828 7.82227 4.38477 7.83203 4.43359C7.89062 4.44336 7.98828 4.46289 8.0957 4.46289C8.96484 4.46289 10.0586 3.87695 10.7129 3.08594Z"
    />
  </svg>
</div>
```

```css
.box {
  color: #0066cc;
}

.box svg {
  fill: currentColor;
}
```

[CodePen](https://codepen.io/tofrankie/pen/rNXgpvK)

åŠ¨æ€ä¿®æ”¹çˆ¶å…ƒç´ çš„é¢œè‰²å°±èƒ½å˜è‰²ã€‚

**ç„¶ï¼Œå¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒ `<svg />` æ ‡ç­¾ã€‚**

## ä½¿ç”¨ image æ ‡ç­¾ + base64

å°ç¨‹åº image æ ‡ç­¾æ˜¯æ”¯æŒ svg æ ¼å¼å›¾ç‰‡çš„ï¼ˆ[ä¸€äº›é™åˆ¶](https://developers.weixin.qq.com/miniprogram/dev/component/image.html#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0)ï¼‰ã€‚

æ³¨æ„ï¼Œå°† `fill="currentColor"` çš„ svg å›¾ç‰‡æ”¾åˆ° image æ ‡ç­¾ï¼Œè¯¥å›¾ç‰‡æ˜¯æ— æ³•è¯»å–å…¶æœ¬èº«æˆ–çˆ¶çº§é¢œè‰²çš„ï¼Œå› æ­¤å‘ˆç°ä¼šé»˜è®¤çš„é»‘è‰²ã€‚

è¦åšä¸€äº›è½¬æ¢å¤„ç†ï¼š

1. ä¸‹è½½ svg å›¾ç‰‡
2. è¯»å– svg å›¾ç‰‡æ–‡ä»¶æºç 
3. æ›¿æ¢ svg fill å±æ€§ä¸ºæŒ‡å®šé¢œè‰²
4. å°†æ›¿æ¢åçš„ svg æ–‡ä»¶è½¬åŒ–ä¸º base64



```js
function genColorfulSvg(url, color) {
  const localFilePath = await downloadSvgFile(url)
  const svgSourceStr = await readSvgFile(localFilePath)
  const colorfulSvgSourceStr = replaceSvgFillColor(svgSourceStr, color)
  const colorfulSvgBase64 = genSvgBase64(colorfulSvgSourceStr)
  return colorfulSvgBase64
}
```

```js
// ä¸‹è½½å›¾ç‰‡
async function downloadSvgFile(url) {
  return new Promise((resolve, reject) => {
    wx.downloadFile({
      url,
      success: res => {
        if (res.statusCode === 200) return resolve(res.tempFilePath)
        reject(new Error('download file fail'))
      },
      fail: err => reject(err),
    })
  })
}
```

```js
// è¯»å– svg æ–‡ä»¶
async function readSvgFile(localFilePath) {
  return new Promise((resolve, reject) => {
    const fs = wx.getFileSystemManager()
    fs.readFile({
      filePath: localFilePath,
      encoding: 'utf-8',
      position: 0,
      success: res => {
        const sourceFile = res.data
        resolve(sourceFile)
      },
      fail: err => reject(err),
    })
  })
}
```

```js
// æ›¿æ¢ fill å±æ€§
function replaceSvgFillColor(svgSourceStr, newFillColor) {
  // åŒ¹é… fill="..." ä¸­çš„é none å€¼ï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰
  return svgSourceStr.replace(/fill="(?!none)[^"]*"/g, `fill="${newFillColor}"`)
}
```

```js
// ç”Ÿæˆ base64
function genSvgBase64(svgSourceStr) {
  return `data:image/svg+xml;base64,${base64Encode(svgSourceStr)}`
}
```

> ç¤ºä¾‹ä¸­ `base64Encode()` æ¥è‡ªæ˜é‡‘ç¤¾åŒºï¼ˆ[åŸæ–‡](https://juejin.cn/post/7229512717135527991)ï¼‰ï¼Œæ‰¾å…¶ä»–ä¹Ÿè¡Œã€‚

å°†ä»¥ä¸Šå°è£…æˆä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œæ¯”å¦‚ï¼š

```html
<colorful-image color="xxx" src="xxx" />
```

å¯ä»¥åœ¨ Component çš„ `lifetimes.attached()` æ—¶æœºæ‰§è¡Œï¼Œä¸ºäº†é¿å…é‡å¤ä¸‹è½½è½¬æ¢ï¼Œå¯ä»¥ç”¨ Map å°† base64 å­˜èµ·æ¥ã€‚

ï¼ˆå…·ä½“å®ç°å°±ä¸å†™äº†ï¼‰

è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯è¦é¢å¤–çš„è¯»å–ã€æ›¿æ¢ã€è½¬æ¢ï¼Œæ€§èƒ½ä¸å¤ªå¥½ã€‚

## ä½¿ç”¨ image æ ‡ç­¾ + CSS Filter

è¿™ç§æ–¹æ¡ˆä½¿ç”¨ CSS Filter å‡½æ•° [drop-shadow](https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter-function/drop-shadow)ï¼Œå®ƒé€šå¸¸ç”¨äºç”Ÿæˆé˜´å½±æ•ˆæœã€‚

å¸¸è§„é˜´å½±æ˜¯ä½äºå›¾ç‰‡ä¸‹æ–¹çš„ï¼Œå€ŸåŠ© transform è¿›è¡Œä¸€äº›ä½ç§»æ“ä½œï¼Œæ€è·¯å¦‚ä¸‹ï¼š

1. éšè—åŸå›¾ï¼š
    1. å°†å›¾ç‰‡æ°´å¹³æ–¹å‘ä½ç§»è¶³å¤Ÿå¤§çš„è·ç¦»
    2. å°†å›¾ç‰‡çˆ¶çº§è®¾ç½®ä¸º overflow: hidden
2. è®©é˜´å½±æ˜¾ç¤ºåœ¨åŸå›¾æœ¬æ¥çš„ä½ç½®
    1. å°† filter: drop-shadow æ°´å¹³ç›¸åæ–¹å‘ä½ç§»åŒæ ·çš„è·ç¦»

è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›å‘ï¼Œå…ˆä»¥ Web ä¸ºä¾‹ï¼š

```html
<img class="icon" src="../../images/star.svg" />
```

```css
.icon {
  width: 100rpx;
  height: 100rpx;
  filter: drop-shadow(200rpx 0 0 #1f883d);
  transform: translateX(-200rpx);
}
```

![](https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732028600098.png)

â–² é»„è‰²ä¸ºåŸå›¾ï¼Œç»¿è‰²ä¸ºæŠ•å½±

æ¥ç€ï¼Œæ·»åŠ ä¸€ä¸ªçˆ¶çº§å…ƒç´ ï¼Œå¹¶è®¾ä¸º `overflow: hidden`ã€‚

ä½†æ˜¯ drop-shadow æœ‰ä¸€ä¸ªè¡¨ç°ç‰¹æ€§ï¼š

> åœ¨ Chrome æµè§ˆå™¨ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ çš„ä¸»ä½“éƒ¨åˆ†ï¼Œæ— è®ºä»¥ä½•ç§æ–¹å¼ï¼Œåªè¦åœ¨é¡µé¢ä¸­ä¸å¯è§ï¼Œå…¶ drop-shadow æ˜¯ä¸å¯è§çš„ï¼›å®ä½“éƒ¨åˆ†å“ªæ€•æœ‰ 1px å¯è§ï¼Œåˆ™ drop-shadow å®Œå…¨å¯è§ã€‚(æºè‡ª[å¼ é‘«æ—­å¤§ä½¬çš„åšå®¢](https://www.zhangxinxu.com/wordpress/2016/06/png-icon-change-color-by-css/))

äº²æµ‹ Safari 18.1 ä¹Ÿæœ‰ç›¸åŒè¡¨ç°ï¼Œä¸æ˜¾ç¤ºé˜´å½±ï¼Œè€Œ Firefox 132 æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚

æ–‡ç« é‡Œæåˆ°ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ç”¨é€æ˜è¾¹æ¡†ï¼Œä½¿å…ƒç´ æ€»åœ¨å±å¹•å¯è§†åŒºåŸŸå†…ã€‚

è°ƒæ•´ä¸‹ä»£ç ï¼š

```diff
+ <view class="icon-box">
    <img class="icon" src="../../images/star.svg" />
+  </view>
```

```diff
+ .icon-box {
+   width: 100rpx;
+   height: 100rpx;
+   overflow: hidden;
+ }

  .icon {
    width: 100rpx;
    height: 100rpx;
    filter: drop-shadow(200rpx 0 0 #1f883d);
    transform: translateX(-200rpx);
+   border-right: 1000px solid transparent;
  }
```

è¿™æ ·çš„è¯ï¼Œåœ¨ Chrome ä¸‹æ˜¯ç¬¦åˆé¢„æœŸäº†ï¼ˆé»„è‰²éšè—ï¼Œç»¿è‰²æ˜¾ç¤ºï¼‰ï¼Œç„¶è€Œ Safari ä¸‹é˜´å½±å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚

çœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼è¿™ä¸ªã€Š[æ·±ç©¶ Safari ä¸‹ border-radius & overflow ä¸ç”Ÿæ•ˆçš„é—®é¢˜](https://github.com/toFrankie/blog/issues/178)ã€‹ï¼Œç»™ icon æ·»åŠ  `transform: translateZ(0)` æˆ– `will-change: transform` ç­‰è§£å†³ï¼Œä½† Chrome åˆä¸èƒ½åŠ ï¼Œå¯ç”¨ CSS Media Query åŒºåˆ†ï¼ˆå°ç¨‹åºäº²æµ‹æœ‰ç”¨ï¼‰ã€‚

> å¦‚æœä½¿ç”¨ `wx.getSystemInfo().platform` æ¥åŒºåˆ†è®¾å¤‡ï¼Œè¦æ³¨æ„å¼€å‘å·¥å…·ã€PC ç«¯ã€Android ç«¯ä¸ Chrome è¡¨ç°ä¸€è‡´ï¼Œä¸èƒ½åŠ  `will-change: transform` ç­‰å¤„ç†ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚

æ¯”å¦‚ï¼š

```css
@supports (-webkit-hyphens: none) {
  /* Safari for macOS or iOS browsers */
  .icon {
    will-change: transform;
  }
}
```

æµ‹è¯•ç»“æœï¼ŒChromeã€Safariã€Firefox å’Œ iOS æµè§ˆå™¨éƒ½ç¬¦åˆé¢„æœŸäº†ã€‚

> âš ï¸ æ³¨æ„ï¼Œæœ¬æ‰“ç®—ç»™ `border-right` ç»™ä¸€ä¸ªè¶³å¤Ÿå¤§çš„è¾¹æ¡†å®½åº¦ï¼Œä»¥å…¼å®¹å„ç§å°ºå¯¸çš„å›¾æ ‡ï¼Œä½†å‘ç°è¿‡å¤§æ—¶åœ¨ Safari ä¸‹ä¸ä¼šå‘ˆç°é˜´å½±ï¼Œæš‚æœªå‘ç°æœ‰å•¥è§„å¾‹ã€‚ä½†é€šå¸¸å›¾æ ‡ä¸ä¼šå¾ˆå¤§ï¼Œå¦‚å°ç¨‹åºç«¯å¯ä»¥è®¾ç½®ä¸€å±å¤§å° 750rpx çš„è¾¹æ¡†å®½åº¦ã€‚

å°ç¨‹åºç»„ä»¶ï¼š

```html
<colorful-image image-class="xxx" color="xxx" src="xxx" />
```

- image-class ç”¨äºæŒ‡å®šå›¾ç‰‡å®½é«˜ç­‰
- color é¢œè‰²
- src å›¾ç‰‡é“¾æ¥ï¼ˆæ³¨æ„ï¼Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äº colorful-image ç»„ä»¶æ‰€åœ¨çš„ç›®å½•ï¼‰

```js
Component({
  externalClasses: ['image-class'],

  properties: {
    // Required
    src: {
      type: String,
      value: '',
    },

    color: {
      type: String,
      value: 'transparent',
    },
  },
})
```

```json
{
  "component": true,
  "usingComponents": {}
}
```

```html
<view class="image-class inner-image-box">
  <image class="inner-image" style="filter: drop-shadow(760rpx 0 0 {{ color }})" src="{{ src }}" />
</view>
```

```js
.inner-image-box {
  overflow: hidden;
}

.inner-image {
  box-sizing: content-box;
  display: block;
  width: 100%;
  height: 100%;
  border-right: 100000px solid transparent;
  transform: translateX(-760rpx);
}

@supports (-webkit-hyphens: none) {
  .inner-image {
    will-change: transform;
  }
}
```

[å°ç¨‹åºä»£ç ç‰‡æ®µ](https://developers.weixin.qq.com/s/BgQvqWmK7rVu)

æ³¨æ„ï¼šSkyline æ¸²æŸ“æ¨¡å¼æš‚ä¸æ”¯æŒã€‚
