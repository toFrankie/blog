<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Frankie's Blog</title>
        <link>https://github.com/toFrankie/blog</link>
        <description>ç§ä¸€æ£µæ ‘ï¼Œæœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ã€‚å…¶æ¬¡ï¼Œæ˜¯ç°åœ¨ã€‚</description>
        <lastBuildDate>Fri, 05 Sep 2025 01:38:38 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-CN</language>
        <copyright>All rights reserved 2025</copyright>
        <item>
            <title><![CDATA[TypeScript ä¸­ Objectã€objectã€{} ä¹‹é—´çš„åŒºåˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/369</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/369</guid>
            <pubDate>Thu, 04 Sep 2025 10:12:25 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/9/1756980702601.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>åœ¨ JS ä¸­ï¼Œæ„é€ å‡½æ•° <code>Object<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/9/1756980702601.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>åœ¨ JS ä¸­ï¼Œæ„é€ å‡½æ•° <code>Object</code>ã€ç©ºå¯¹è±¡å­—é¢é‡ <code>{}</code> å¯ä»¥ä½œä¸ºå€¼ä½¿ç”¨ï¼Œå› æ­¤å®ƒä¿©åœ¨ TS ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºå€¼ä½¿ç”¨ã€‚</p>
<p>åœ¨ TS ä¸­ï¼Œ<code>Object</code>ã€<code>object</code>ã€<code>{}</code> è¿˜å¯ä»¥ä½œä¸ºç±»å‹ä½¿ç”¨ã€‚æ³¨æ„ <code>Object</code> å’Œ <code>object</code> æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ã€‚è¿˜æœ‰ <code>object</code> æ˜¯ TS ç‰¹æœ‰çš„ç±»å‹ï¼Œåªèƒ½ç”¨äºç±»å‹ï¼Œä¸èƒ½ä½œä¸ºå€¼ã€‚</p>
<h2>è¿·ä¹‹å†™æ³• ğŸ¤¯</h2>
<p>è¯·é—®è¿™å‡ ç§å†™æ³•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿå®ƒä»¬å¯ä»¥æ¥æ”¶å“ªäº›å€¼ï¼Ÿ</p>
<pre><code class="language-ts">// 1ï¸âƒ£
const obj = {}

// 2ï¸âƒ£
const obj: {} = {}

// 3ï¸âƒ£
const obj: {}

// 4ï¸âƒ£
const obj: Object

// 5ï¸âƒ£
const obj: object
</code></pre>
<h2>objectï¼ˆå° oï¼‰</h2>
<p>å›é¡¾ä¸€ä¸‹ï¼Œåœ¨ JS ä¸­æœ‰ã€ŒåŸºæœ¬æ•°æ®ç±»å‹ã€å’Œã€Œå¼•ç”¨æ•°æ®ç±»å‹ã€ä¸¤ç§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹
<ul>
<li>Number</li>
<li>String</li>
<li>Boolean</li>
<li>Symbol</li>
<li>BigInt</li>
<li>Undefined</li>
<li>Null</li>
</ul>
</li>
<li>å¼•ç”¨æ•°æ®ç±»å‹
<ul>
<li>Objectï¼ˆåŒ…æ‹¬å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ã€Mapã€Setã€Date ç­‰ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œä»¥ä¸Šç”¨å¤§å†™å­—æ¯å¼€å¤´çš„è¡¨è¿°å½¢å¼ä¸ TS æ— å…³ï¼ŒæŠŠå®ƒæ¢æˆä¸­æ–‡ï¼ˆå¦‚å­—ç¬¦ä¸²ç±»å‹ï¼‰ä¹Ÿè¡Œï¼Œåˆ«æ··æ·†äº†ã€‚</p>
</blockquote>
<p>è¿™äº›æ•°æ®ç±»å‹å¯¹åº”çš„ TS ç±»å‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹ï¼š
<ul>
<li><code>number</code></li>
<li><code>string</code></li>
<li><code>boolean</code></li>
<li><code>symbol</code></li>
<li><code>bigint</code></li>
<li><code>undefined</code></li>
<li><code>null</code></li>
</ul>
</li>
<li>å¼•ç”¨æ•°æ®ç±»å‹
<ul>
<li><code>object</code></li>
</ul>
</li>
</ul>
<p>åˆ°è¿™é‡Œåº”è¯¥ç†è§£äº†ï¼Œ<code>object</code> è¡¨ç¤ºä¸€ä¸ªå¼•ç”¨å€¼çš„ç±»å‹ã€‚</p>
<pre><code class="language-ts">// æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„ç±»å‹
type Primitive = number | string | boolean | symbol | bigint | null | undefined

// æ‰€æœ‰å¼•ç”¨æ•°æ®ç±»å‹çš„ç±»å‹
type NonPrimitive = object // ç›¸å½“äº Exclude&lt;unknown, Primitive&gt;
</code></pre>
<p>ç¤ºä¾‹ï¼šåªè¦å€¼æ˜¯å¼•ç”¨å€¼ä¾¿å¯ä»¥èµ‹å€¼ç»™ <code>object</code> ç±»å‹çš„å˜é‡ã€‚</p>
<pre><code class="language-ts">let obj: object

obj = 1 // âŒ Type 'number' is not assignable to type 'object'.
obj = 'abc' // âŒ Type 'string' is not assignable to type 'object'.
obj = true // âŒ Type 'boolean' is not assignable to type 'object'.
obj = Symbol('abc') // âŒ Type 'symbol' is not assignable to type 'object'.
obj = 1n // âŒ Type 'bigint' is not assignable to type 'object'.
obj = null // âŒ Type 'null' is not assignable to type 'object'.
obj = undefined // âŒ Type 'undefined' is not assignable to type 'object'.

obj = {} // âœ…
obj = Object // âœ…
obj = { foo: 123 } // âœ…
obj = [1, 2] // âœ…
obj = (a: number, b: number) =&gt; a + b // âœ…
</code></pre>
<p>è™½è¯´å¯ä»¥æŠŠä»»æ„çš„å¼•ç”¨å€¼èµ‹å€¼ç»™ <code>obj</code> å˜é‡ï¼Œä½†æ˜¯å…¶è®¿é—®å±æ€§æ—¶ï¼ŒTS ä¸ºäº†ç¡®ä¿å®‰å…¨è®¿é—®ï¼Œåªèƒ½è®¿é—®å…¶åŒ…å«çš„ç±»å‹ä¸­éƒ½å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™è¦åšç±»å‹æ”¶çª„ã€‚</p>
<pre><code class="language-ts">let a: object

a = [] // âœ…
a = {} // âœ…

a.join(',') // âŒ åƒæ™®é€šå¯¹è±¡å°±æ²¡æœ‰ join å±æ€§ï¼Œå› æ­¤æŠ›å‡ºé”™è¯¯ Property 'join' does not exist on type 'object'.
a.toString() // âœ… å…±æœ‰å±æ€§

if (Array.isArray(a)) {
  a.join(',') // âœ… æ•°ç»„ç‹¬æœ‰çš„æ–¹æ³•
}
</code></pre>
<h2>Objectï¼ˆå¤§ Oï¼‰</h2>
<p>å…ˆä» JS è®²èµ·ã€‚æˆ‘ä»¬çŸ¥é“ JS çš„åŸå§‹å€¼æ˜¯æ²¡æœ‰ä»»ä½•å±æ€§å’Œæ–¹æ³•çš„ã€‚</p>
<pre><code class="language-js">const foo = 'abc'
foo.length // 3
</code></pre>
<p>é‚£ä¸ºä»€ä¹ˆ <code>foo.length</code> ä¸æŠ¥é”™å‘¢ï¼ŸåŸå› æ˜¯å†…éƒ¨ç›¸å½“äºè¿™æ ·ï¼Œé¦–å…ˆå°†å…¶è½¬ä¸ºå¼•ç”¨ç±»å‹ï¼Œå®é™…è¯»å–çš„æ˜¯ String å®ä¾‹å¯¹è±¡çš„ <code>length</code> å±æ€§ã€‚</p>
<pre><code class="language-js">const foo = 'abc'
Object(3).length // 3
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/9/1756975794364.png" alt=""></p>
<p>ä½† <code>undefined</code>ã€<code>null</code> è¿™ä¸¤ä¸ªå®¶ä¼™æ— æ³•è½¬ä¸ºå¼•ç”¨ç±»å‹ï¼Œå› æ­¤ç±»ä¼¼ <code>undefined.length</code> è¿™ç§ä¼šæŠ›å‡º TypeErrorã€‚</p>
<p>å‰é¢é“ºå«å®Œä¹‹åï¼Œå†çœ‹çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-ts">let obj: Object

obj = 1 // âœ…
obj = 1n // âœ…
obj = 'abc' // âœ…
obj = true // âœ…
obj = null // âŒ Type 'null' is not assignable to type 'Object'.
obj = undefined // âŒ Type 'undefined' is not assignable to type 'Object'.
obj = Symbol('abc') // âœ…

obj = {} // âœ…
obj = Object // âœ…
obj = { foo: 123 } // âœ…
obj = [1, 2] // âœ…
obj = (a: number, b: number) =&gt; a + b // âœ…
</code></pre>
<p>ä»»æ„é <code>undefined</code>ã€<code>null</code> çš„å€¼ï¼Œéƒ½å¯ä»¥èµ‹å€¼ç»™ <code>Object</code> ç±»å‹ï¼ˆæŒ‡ TS ç±»å‹ï¼‰çš„å˜é‡ã€‚</p>
<p><code>Object</code> è¡¨ç¤ºçš„ç±»å‹èŒƒå›´å¤ªå®½äº†ï¼Œå®é™…ä¸­åº”è¯¥å°‘ç”¨ã€‚</p>
<h2>ç©ºå¯¹è±¡ {}</h2>
<p>åœ¨ TS ä¸­ï¼Œç©ºå¯¹è±¡ <code>{}</code> æ—¢æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ã€‚</p>
<p>ä»¥ä¸‹ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p>
<pre><code class="language-ts">const obj = {}
const obj: {} = {}
</code></pre>
<blockquote>
<p>TS è‡ªåŠ¨æ¨å¯¼å‡º <code>obj</code> çš„ç±»å‹æ˜¯ <code>{}</code>ï¼Œå³ <code>Object</code>ï¼Œ</p>
</blockquote>
<p>ä»¥ä¸‹ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p>
<pre><code class="language-ts">const obj: {}
const obj: Object
</code></pre>
<p>æ‰€ä»¥ä½¿ç”¨ <code>{}</code> ä½œä¸ºç±»å‹æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯ <code>Object</code> ç±»å‹çš„ç®€å†™å½¢å¼ã€‚</p>
<p>è¦æ³¨æ„ä¸‹ï¼Œè™½ç„¶ä¸¤è€…å½¢å¼ä¸Šæœ‰ç‚¹åƒï¼Œç¬¬ä¸€ä¸ªæœ¬è´¨ä¸Šæ˜¯ <code>Object</code> ç±»å‹ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè§¦å‘å¯¹è±¡çš„ä¸¥æ ¼å­—é¢é‡æ£€æŸ¥ã€‚</p>
<pre><code class="language-ts">let obj: {} = { a: 1 } // âœ…

let obj2: { x: number } = { x: 1, y: 2 } // âŒ Object literal may only specify known properties, and 'y' does not exist in type '{ x: number; }'.
</code></pre>
<h2>æ€»ç»“</h2>
<ul>
<li><code>object</code> ç±»å‹çš„å˜é‡ä»…æ¥å—ä»»æ„å¼•ç”¨å€¼ã€‚</li>
<li><code>Object</code> ç±»å‹çš„å˜é‡æ¥å—é™¤ <code>undefined</code> å’Œ <code>null</code> ä¹‹å¤–çš„ä»»æ„å€¼ã€‚</li>
<li>å°† <code>{}</code> ä½œä¸ºç±»å‹æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯ <code>Object</code> ç±»å‹çš„ç®€å†™ã€‚å³ <code>const obj: {}</code> ç­‰ä»·äº <code>const obj: Object</code>ã€‚</li>
</ul>
<p>å›åˆ°æ–‡ç« å¼€å¤´ä»¤äººæŠ“ç‹‚çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-ts">// 1ï¸âƒ£
const obj = {}

// 2ï¸âƒ£
const obj: {}

// 3ï¸âƒ£
const obj: {} = {}

// 4ï¸âƒ£
const obj: Object

// 5ï¸âƒ£
const obj: object
</code></pre>
<p>1ï¸âƒ£ã€2ï¸âƒ£ã€3ï¸âƒ£ã€4ï¸âƒ£ ä¸ºåŒä¸€ç±»ï¼Œéƒ½æ˜¯ <code>Object</code> ç±»å‹ï¼Œ5ï¸âƒ£ åˆ™æ˜¯ <code>object</code> ç±»å‹ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TypeScript ç±»å‹å…³ç³»å›¾]]></title>
            <link>https://github.com/toFrankie/blog/issues/368</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/368</guid>
            <pubDate>Wed, 03 Sep 2025 16:32:11 GMT</pubDate>
            <description><![CDATA[<h2>ç±»å‹åˆ†ç±»</h2>
<pre><code class="language-mermaid">flowchart TD
    TypeScript[TypeScript ç±»å‹ç³»ç»Ÿ]
    
    TypeScript --&gt; PrimitiveTypes[åŸºæœ¬ç±»å‹]
    TypeScript --]]></description>
            <content:encoded><![CDATA[<h2>ç±»å‹åˆ†ç±»</h2>
<pre><code class="language-mermaid">flowchart TD
    TypeScript[TypeScript ç±»å‹ç³»ç»Ÿ]
    
    TypeScript --&gt; PrimitiveTypes[åŸºæœ¬ç±»å‹]
    TypeScript --&gt; ObjectTypes[å¯¹è±¡ç±»å‹]
    TypeScript --&gt; SpecialTypes[ç‰¹æ®Šç±»å‹]
    TypeScript --&gt; CompoundTypes[å¤åˆç±»å‹]
</code></pre>
<h3>åŸºæœ¬ç±»å‹</h3>
<pre><code class="language-mermaid">flowchart TD
    PrimitiveTypes[åŸºæœ¬ç±»å‹] --&gt; String[string]
    PrimitiveTypes --&gt; Number[number]
    PrimitiveTypes --&gt; Boolean[boolean]
    PrimitiveTypes --&gt; BigInt[bigint]
    PrimitiveTypes --&gt; Symbol[symbol]
    PrimitiveTypes --&gt; Null[null]
    PrimitiveTypes --&gt; Undefined[undefined]
</code></pre>
<h3>å¯¹è±¡ç±»å‹</h3>
<pre><code class="language-mermaid">flowchart TD
    ObjectTypes[å¯¹è±¡ç±»å‹] --&gt; Object[Object]
    ObjectTypes --&gt; Function[Function]
    ObjectTypes --&gt; Array[Array]
    ObjectTypes --&gt; Promise[Promise]
    ObjectTypes --&gt; Date[Date]
    ObjectTypes --&gt; RegExp[RegExp]
    ObjectTypes --&gt; Error[Error]
    ObjectTypes --&gt; Map[Map]
    ObjectTypes --&gt; Set[Set]
    ObjectTypes --&gt; WeakMap[WeakMap]
    ObjectTypes --&gt; WeakSet[WeakSet]
    ObjectTypes --&gt; Iterator[Iterator]
    ObjectTypes --&gt; Generator[Generator]
    
    Function --&gt; Object
    Array --&gt; Object
    Promise --&gt; Object
    Date --&gt; Object
    RegExp --&gt; Object
    Error --&gt; Object
    Map --&gt; Object
    Set --&gt; Object
    WeakMap --&gt; Object
    WeakSet --&gt; Object
    Iterator --&gt; Object
    Generator --&gt; Object
</code></pre>
<h3>ç‰¹æ®Šç±»å‹</h3>
<pre><code class="language-mermaid">flowchart TD
    SpecialTypes[ç‰¹æ®Šç±»å‹] --&gt; Never[never]
    SpecialTypes --&gt; Unknown[unknown]
    SpecialTypes --&gt; Any[any]
    SpecialTypes --&gt; Void[void]
</code></pre>
<h3>å¤åˆç±»å‹</h3>
<pre><code class="language-mermaid">flowchart TD
    CompoundTypes[å¤åˆç±»å‹] --&gt; UnionType[è”åˆç±»å‹]
    CompoundTypes --&gt; IntersectionType[äº¤å‰ç±»å‹]
    CompoundTypes --&gt; TupleType[å…ƒç»„ç±»å‹]
    CompoundTypes --&gt; LiteralType[å­—é¢é‡ç±»å‹]
</code></pre>
<h3>æ‰€æœ‰ç±»å‹</h3>
<pre><code class="language-mermaid">flowchart TD
    TypeScript[TypeScript ç±»å‹ç³»ç»Ÿ]
    
    TypeScript --&gt; PrimitiveTypes[åŸºæœ¬ç±»å‹]
    TypeScript --&gt; ObjectTypes[å¯¹è±¡ç±»å‹]
    TypeScript --&gt; SpecialTypes[ç‰¹æ®Šç±»å‹]
    TypeScript --&gt; CompoundTypes[å¤åˆç±»å‹]
    
    PrimitiveTypes --&gt; String[string]
    PrimitiveTypes --&gt; Number[number]
    PrimitiveTypes --&gt; Boolean[boolean]
    PrimitiveTypes --&gt; BigInt[bigint]
    PrimitiveTypes --&gt; Symbol[symbol]
    PrimitiveTypes --&gt; Null[null]
    PrimitiveTypes --&gt; Undefined[undefined]
    
    ObjectTypes --&gt; Object[Object]
    ObjectTypes --&gt; Function[Function]
    ObjectTypes --&gt; Array[Array]
    ObjectTypes --&gt; Promise[Promise]
    ObjectTypes --&gt; Date[Date]
    ObjectTypes --&gt; RegExp[RegExp]
    ObjectTypes --&gt; Error[Error]
    ObjectTypes --&gt; Map[Map]
    ObjectTypes --&gt; Set[Set]
    ObjectTypes --&gt; WeakMap[WeakMap]
    ObjectTypes --&gt; WeakSet[WeakSet]
    ObjectTypes --&gt; Iterator[Iterator]
    ObjectTypes --&gt; Generator[Generator]
    
    SpecialTypes --&gt; Never[never]
    SpecialTypes --&gt; Unknown[unknown]
    SpecialTypes --&gt; Any[any]
    SpecialTypes --&gt; Void[void]
    
    CompoundTypes --&gt; UnionType[è”åˆç±»å‹]
    CompoundTypes --&gt; IntersectionType[äº¤å‰ç±»å‹]
    CompoundTypes --&gt; TupleType[å…ƒç»„ç±»å‹]
    CompoundTypes --&gt; LiteralType[å­—é¢é‡ç±»å‹]
    
    Function --&gt; Object
    Array --&gt; Object
    Promise --&gt; Object
    Date --&gt; Object
    RegExp --&gt; Object
    Error --&gt; Object
    Map --&gt; Object
    Set --&gt; Object
    WeakMap --&gt; Object
    WeakSet --&gt; Object
    Iterator --&gt; Object
    Generator --&gt; Object
</code></pre>
<h2>ç±»å‹èµ‹å€¼å…³ç³»</h2>
<h3>ä¸¥æ ¼æ¨¡å¼</h3>
<pre><code class="language-mermaid">flowchart TD
    %% åº•å±‚ç±»å‹
    Never[never - åº•å±‚ç±»å‹]
    
    %% ç¬¬å››å±‚ - ç‰¹æ®Šå€¼ç±»å‹
    Null[null]
    Undefined[undefined]
    Void[void]
    
    %% ç¬¬ä¸‰å±‚ - åŸºæœ¬ç±»å‹
    String[string]
    Number[number]
    Boolean[boolean]
    BigInt[bigint]
    Symbol[symbol]
    
    %% ç¬¬äºŒå±‚ - å¯¹è±¡ç±»å‹
    Object[Object - å¯¹è±¡åŸºç±»]
    
    %% é¡¶å±‚ç±»å‹
    Any[any - é¡¶å±‚ç±»å‹]
    Unknown[unknown - ç±»å‹å®‰å…¨é¡¶å±‚]
    
    %% æ­£ç¡®çš„èµ‹å€¼å…³ç³»
    Never --&gt; Any
    Never --&gt; Unknown
    Never --&gt; Object
    Never --&gt; String
    Never --&gt; Number
    Never --&gt; Boolean
    Never --&gt; BigInt
    Never --&gt; Symbol
    Never --&gt; Null
    Never --&gt; Undefined
    Never --&gt; Void
    
    %% åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹å¯ä»¥èµ‹å€¼ç»™ unknown å’Œ any
    String --&gt; Any
    String --&gt; Unknown
    Number --&gt; Any
    Number --&gt; Unknown
    Boolean --&gt; Any
    Boolean --&gt; Unknown
    BigInt --&gt; Any
    BigInt --&gt; Unknown
    Symbol --&gt; Any
    Symbol --&gt; Unknown
    
    Object --&gt; Any
    Object --&gt; Unknown
    
    %% ç‰¹æ®Šå€¼ç±»å‹åªèƒ½èµ‹å€¼ç»™ unknown å’Œ any
    Null --&gt; Any
    Null --&gt; Unknown
    Undefined --&gt; Any
    Undefined --&gt; Unknown
    Void --&gt; Any
    Void --&gt; Unknown
    
    %% unknown å¯ä»¥èµ‹å€¼ç»™ any
    Unknown --&gt; Any
    
    %% åˆ†ç»„
    subgraph BottomLevel[åº•å±‚ç±»å‹å±‚]
        Never
    end
    
    subgraph SpecialLevel[ç‰¹æ®Šå€¼ç±»å‹å±‚]
        Null
        Undefined
        Void
    end
    
    subgraph PrimitiveLevel[åŸºæœ¬ç±»å‹å±‚]
        String
        Number
        Boolean
        BigInt
        Symbol
    end
    
    subgraph ObjectLevel[å¯¹è±¡ç±»å‹å±‚]
        Object
    end
    
    subgraph TopLevel[é¡¶å±‚ç±»å‹å±‚]
        Any
        Unknown
    end
</code></pre>
<h3>éä¸¥æ ¼æ¨¡å¼</h3>
<pre><code class="language-mermaid">flowchart TD
    %% åº•å±‚ç±»å‹
    Never[never - åº•å±‚ç±»å‹]
    
    %% ç¬¬å››å±‚ - ç‰¹æ®Šå€¼ç±»å‹
    Null[null]
    Undefined[undefined]
    Void[void]
    
    %% ç¬¬ä¸‰å±‚ - åŸºæœ¬ç±»å‹
    String[string]
    Number[number]
    Boolean[boolean]
    BigInt[bigint]
    Symbol[symbol]
    
    %% ç¬¬äºŒå±‚ - å¯¹è±¡ç±»å‹
    Object[Object - å¯¹è±¡åŸºç±»]
    
    %% é¡¶å±‚ç±»å‹
    Any[any - é¡¶å±‚ç±»å‹]
    Unknown[unknown - ç±»å‹å®‰å…¨é¡¶å±‚]
    
    %% æ­£ç¡®çš„èµ‹å€¼å…³ç³»
    Never --&gt; Any
    Never --&gt; Unknown
    Never --&gt; Object
    Never --&gt; String
    Never --&gt; Number
    Never --&gt; Boolean
    Never --&gt; BigInt
    Never --&gt; Symbol
    Never --&gt; Null
    Never --&gt; Undefined
    Never --&gt; Void
    
    %% åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹å¯ä»¥èµ‹å€¼ç»™ unknown å’Œ any
    String --&gt; Any
    String --&gt; Unknown
    Number --&gt; Any
    Number --&gt; Unknown
    Boolean --&gt; Any
    Boolean --&gt; Unknown
    BigInt --&gt; Any
    BigInt --&gt; Unknown
    Symbol --&gt; Any
    Symbol --&gt; Unknown
    
    Object --&gt; Any
    Object --&gt; Unknown
    
    %% éä¸¥æ ¼æ¨¡å¼ä¸‹çš„é¢å¤–èµ‹å€¼å…³ç³» - åªæœ‰ null å’Œ undefined
    Null --&gt; Any
    Null --&gt; Unknown
    Null --&gt; String
    Null --&gt; Number
    Null --&gt; Boolean
    Null --&gt; BigInt
    Null --&gt; Symbol
    
    Undefined --&gt; Any
    Undefined --&gt; Unknown
    Undefined --&gt; String
    Undefined --&gt; Number
    Undefined --&gt; Boolean
    Undefined --&gt; BigInt
    Undefined --&gt; Symbol
    
    %% void ç±»å‹å§‹ç»ˆåªèƒ½èµ‹å€¼ç»™ unknown å’Œ any
    Void --&gt; Any
    Void --&gt; Unknown
    
    %% unknown å¯ä»¥èµ‹å€¼ç»™ any
    Unknown --&gt; Any
    
    %% åˆ†ç»„
    subgraph BottomLevel[åº•å±‚ç±»å‹å±‚]
        Never
    end
    
    subgraph SpecialLevel[ç‰¹æ®Šå€¼ç±»å‹å±‚]
        Null
        Undefined
        Void
    end
    
    subgraph PrimitiveLevel[åŸºæœ¬ç±»å‹å±‚]
        String
        Number
        Boolean
        BigInt
        Symbol
    end
    
    subgraph ObjectLevel[å¯¹è±¡ç±»å‹å±‚]
        Object
    end
    
    subgraph TopLevel[é¡¶å±‚ç±»å‹å±‚]
        Any
        Unknown
    end
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸œé£ 5C æ‰“å‡»èŒƒå›´è¦†ç›–å…¨çƒ]]></title>
            <link>https://github.com/toFrankie/blog/issues/367</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/367</guid>
            <pubDate>Wed, 03 Sep 2025 15:32:49 GMT</pubDate>
            <description><![CDATA[<h2>ä¸­åäººæ°‘å…±å’Œå›½ä¸‡å²</h2>
<p>äººæ°‘æœ‰ä¿¡ä»°ï¼Œå›½å®¶æœ‰åŠ›é‡ï¼Œæ°‘æ—æœ‰å¸Œæœ›</p>
<blockquote>
<p><a href="http://s.weibo.com/weibo?q=%23%E6%96%B0%E5%8D%8E%E7%A4%BE%E5%87%BA%E5%9B%BE%23">æ–°åç¤¾å‡ºå›¾</a></]]></description>
            <content:encoded><![CDATA[<h2>ä¸­åäººæ°‘å…±å’Œå›½ä¸‡å²</h2>
<p>äººæ°‘æœ‰ä¿¡ä»°ï¼Œå›½å®¶æœ‰åŠ›é‡ï¼Œæ°‘æ—æœ‰å¸Œæœ›</p>
<blockquote>
<p><a href="http://s.weibo.com/weibo?q=%23%E6%96%B0%E5%8D%8E%E7%A4%BE%E5%87%BA%E5%9B%BE%23">æ–°åç¤¾å‡ºå›¾</a></p>
</blockquote>
<p><img src="https://github.com/user-attachments/assets/6f619359-d0e9-4f7a-a8ba-3d53218d4739" alt=""></p>
<p><img src="https://github.com/user-attachments/assets/5e8fae5c-60da-41a4-ba4a-cd7df8c3034c" alt=""></p>
<p><img src="https://github.com/user-attachments/assets/0ad7e86c-e25d-4fd2-8fba-99c40c65939f" alt=""></p>
<p><img src="https://github.com/user-attachments/assets/9cbc1276-06ef-47ec-b65a-df141195505e" alt=""></p>
<p><img src="https://github.com/user-attachments/assets/3ddb1712-3d19-4034-ab3b-cd81ae179820" alt=""></p>
<p><img src="https://github.com/user-attachments/assets/cc1f1861-3645-4045-8ed2-6549d380f034" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è”åˆç±»å‹ä¸äº¤å‰ç±»å‹çš„åç›´è§‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/366</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/366</guid>
            <pubDate>Fri, 29 Aug 2025 04:01:27 GMT</pubDate>
            <description><![CDATA[<h2>å‰è¨€</h2>
<ul>
<li>è”åˆç±»å‹ï¼šè¦ä¹ˆ Aï¼Œè¦ä¹ˆ Bï¼ˆåªè¦æ»¡è¶³ä»»æ„ä¸€ä¸ªåˆ†æ”¯ï¼‰</li>
<li>äº¤å‰ç±»å‹ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³ A å’Œ Bï¼ˆå¿…é¡»æ»¡è¶³æ‰€æœ‰åˆ†æ”¯ï¼‰</li>
</ul>
<pre><code class="language-ts">type Union = A | B

type Intersec]]></description>
            <content:encoded><![CDATA[<h2>å‰è¨€</h2>
<ul>
<li>è”åˆç±»å‹ï¼šè¦ä¹ˆ Aï¼Œè¦ä¹ˆ Bï¼ˆåªè¦æ»¡è¶³ä»»æ„ä¸€ä¸ªåˆ†æ”¯ï¼‰</li>
<li>äº¤å‰ç±»å‹ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³ A å’Œ Bï¼ˆå¿…é¡»æ»¡è¶³æ‰€æœ‰åˆ†æ”¯ï¼‰</li>
</ul>
<pre><code class="language-ts">type Union = A | B

type Intersection = A &amp; B
</code></pre>
<p>çœ‹èµ·æ¥ï¼Œè”åˆç±»å‹åƒæ•°å­¦ä¸Šçš„â€œå¹¶é›†â€ï¼Œäº¤å‰ç±»å‹åƒâ€œäº¤é›†â€ã€‚</p>
<h2>ç¬¦åˆç›´è§‰</h2>
<p>â–¼ è¦ä¹ˆæ˜¯å­—ç¬¦ä¸²ï¼Œè¦ä¹ˆæ˜¯æ•°å­—ï¼Œè¿™æ˜¯ç¬¦åˆç›´è§‰çš„ã€‚</p>
<pre><code class="language-ts">type DataUnion = string | number

let data: DataUnion

data = 'abc' // âœ…
data = 123 // âœ…
</code></pre>
<p>â–¼ ç”±äºä¸å¯èƒ½å­˜åœ¨åŒæ—¶æ»¡è¶³æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯æ•°å­—çš„å€¼ï¼Œå› æ­¤ <code>DataIntersection</code> ç±»å‹æ˜¯ <code>never</code>ã€‚è¿™ä¹Ÿæ˜¯ç¬¦åˆç›´è§‰çš„ã€‚</p>
<pre><code class="language-ts">type DataIntersection = string &amp; number

let data: DataIntersection

data = 'abc' // âŒ Type '&quot;abc&quot;' is not assignable to type 'never'.
data = 123 // âŒ Type '123' is not assignable to type 'never'.
</code></pre>
<p>â–¼ ä»¥ä¸‹ä¸ºå¯¹è±¡ç±»å‹ï¼ŒShape åº”è¯¥ä¿æŒä¸€è‡´ï¼Œæ˜¯ç¬¦åˆç›´è§‰çš„ã€‚</p>
<pre><code class="language-ts">type Point = { x: number }

let p: Point

p = { x: 1 } // âœ…
p = { y: 2 } // âŒ Object literal may only specify known properties, and 'y' does not exist in type 'Point'.
p = { x: 1, y: 2 } // âŒ Object literal may only specify known properties, and 'y' does not exist in type 'Point'.
</code></pre>
<p>â–¼ ä»¥ä¸‹ä¸ºå¯¹è±¡çš„äº¤å‰ç±»å‹ï¼Œè¦ç¬¦åˆã€Œå¿…é¡»åŒæ—¶æ»¡è¶³ A å’Œ Bã€ç»“è®ºï¼Œå…¶ç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªåŒ…å« <code>x</code> å’Œ <code>y</code> å±æ€§æ–°å¯¹è±¡ç±»å‹ï¼Œæ˜¯ç¬¦åˆç›´è§‰çš„ã€‚</p>
<pre><code class="language-ts">type PointIntersection = { x: number } &amp; { y: number }

let p: PointIntersection

p = { x: 1 } // âŒ Property 'y' is missing in type '{ x: number; }' but required in type '{ y: number; }'.
p = { y: 2 } // âŒ Property 'x' is missing in type '{ y: number; }' but required in type '{ x: number; }'.
p = { x: 1, y: 2 } // âœ…
p = { x: 1, y: 2, z: 3 } // âŒ Object literal may only specify known properties, and 'z' does not exist in type 'PointIntersection'.
</code></pre>
<p>â–¼ ä»¥ä¸‹ç¤ºä¾‹è®¿é—®å±æ€§ <code>point.x</code>ã€<code>point.y</code> æŠ¥é”™æ˜¯ç¬¦åˆç›´è§‰çš„ï¼Œä¸€ä¸ªæ²¡æœ‰ <code>x</code>ã€ä¸€ä¸ªæ²¡æœ‰ <code>y</code>ã€‚TypeScript ä¼šè¦æ±‚æ‰€æœ‰æˆå‘˜ç±»å‹é‡Œéƒ½ä¿è¯å­˜åœ¨çš„å±æ€§ï¼Œæ‰å…è®¸å®‰å…¨è®¿é—®ã€‚è¯¥æ–¹æ³•çš„ä¿®æ­£æ–¹å¼æ˜¯åšç±»å‹æ”¶çª„ã€‚</p>
<pre><code class="language-ts">type PointUnion = { x: number } | { y: number }

function showPoint(point: PointUnion) {
  const x = point.x ?? 0 // âŒ Property 'x' does not exist on type '{ y: number; }'.
  const y = point.y ?? 0 // âŒ Property 'y' does not exist on type '{ x: number; }'.
  return `(${x}, ${y})`
}
</code></pre>
<h2>åç›´è§‰</h2>
<p>â–¼ ä»¥ä¸‹ç¤ºä¾‹ï¼ŒæŒ‰ç† <code>p = obj</code> æŠ¥é”™æ‰æ˜¯ç¬¦åˆç›´è§‰çš„ã€‚</p>
<pre><code class="language-ts">type Point = { x: number }

let p: Point

let obj = { x: 1, y: 2 }

p = { x: 1, y: 2 } // âŒ Object literal may only specify known properties, and 'y' does not exist in type 'Point'.
p = obj // âœ…
</code></pre>
<p>åŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœèµ‹å€¼è¯­å¥ç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªå­—é¢é‡ï¼Œä¼šè§¦å‘å¯¹è±¡çš„ä¸¥æ ¼å­—é¢é‡æ£€æŸ¥ï¼ˆstrict object literal checkingï¼‰ã€‚å› æ­¤å¤šäº†æœªå®šä¹‰çš„å±æ€§ <code>y</code> ä¼šæŠ¥é”™ã€‚</li>
<li>å¦‚æœèµ‹å€¼è¯­å¥ç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™ä¸ä¼šè§¦å‘å¯¹è±¡çš„ä¸¥æ ¼å­—é¢é‡æ£€æŸ¥ï¼Œæ‰€ä»¥å¤šäº†å±æ€§æ²¡æŠ¥é”™ï¼ˆä½†ä¸èƒ½å°‘ï¼‰ã€‚å°½ç®¡èµ‹å€¼çš„ <code>obj</code> æ˜¯åŒ…å« <code>y</code> å±æ€§çš„ï¼Œä½†é€šè¿‡ <code>p.y</code> è®¿é—®å±æ€§ä»ç„¶ä¼šæŠ¥é”™ï¼Œå› ä¸º <code>p</code> çš„ç±»å‹ <code>Point</code> å¹¶ä¸åŒ…å« <code>y</code> å±æ€§ã€‚</li>
</ol>
<blockquote>
<p>å¯¹äº <code>p = obj</code> è¿™ç±»ä¸è§¦å‘ä¸¥æ ¼å­—é¢é‡æ£€æŸ¥ï¼Œæ˜¯æœ‰å®é™…æ„ä¹‰çš„ã€‚æ¯”å¦‚æ¥å£çš„è¿”å›æ•°æ®æœ‰ N å¤šå­—æ®µï¼Œä½†ä¸šåŠ¡ä¸Šå®é™…ç”¨åˆ°å¯èƒ½åªæœ‰å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œè¿™ç§æƒ…å†µä¸‹åªéœ€å£°æ˜ç”¨åˆ°çš„å­—æ®µå³å¯ã€‚</p>
</blockquote>
<p>â–¼ ä»¥ä¸‹ç¤ºä¾‹ï¼Œä¸ºä»€ä¹ˆ <code>p = { x: 1, y: 2 }</code> åˆä¸æŠ¥é”™ï¼Ÿ</p>
<pre><code class="language-ts">type PointUnion = { x: number } | { y: number }

let p: PointUnion

p = { x: 1 } // âœ…
p = { y: 2 } // âœ…
p = { x: 1, y: 2 } // âœ… æ˜æ˜æ˜¯å­—é¢é‡ï¼Œåˆä¸æŠ¥é”™äº†ï¼Ÿï¼Ÿï¼Ÿ
</code></pre>
<p>åŸå› æ˜¯è§¦å‘å¯¹è±¡çš„ä¸¥æ ¼å­—é¢é‡æ£€æŸ¥ï¼Œæœ‰ä¸¤ä¸ªè¦æ±‚ï¼š</p>
<ol>
<li>èµ‹å€¼è¯­å¥ç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªå­—é¢é‡</li>
<li>è¢«èµ‹å€¼å¯¹è±¡çš„ç±»å‹æ˜¯å•ä¸€çš„å¯¹è±¡ç±»å‹ï¼ˆéè”åˆã€éç´¢å¼•ç­¾åï¼‰</li>
</ol>
<p>â–¼ å†çœ‹ç¤ºä¾‹ï¼ŒåŸå› è·Ÿå‰é¢ä¸€æ ·ï¼Œå°±æ˜¯çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªã€‚</p>
<pre><code>type PointUnion = { x: number } | { y: number }
type PointIntersection = { x: number } &amp; { y: number }

let point1: PointUnion
let point2: PointIntersection

point1 = { x: 1, y: 2 } // âœ…
point2 = { x: 1, y: 2 } // âœ…
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å…¬ä¼—å·æ˜¯å¦‚ä½•åŠ è½½ã€å¤„ç†å›¾ç‰‡çš„ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/365</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/365</guid>
            <pubDate>Fri, 11 Jul 2025 09:55:19 GMT</pubDate>
            <description><![CDATA[<p>ä½œä¸ªè®°å½•ã€‚</p>
<p>ä¸‹è½½ç½‘é¡µ</p>
<pre><code class="language-shell">$ wget -r -np -k -L -p https://mp.weixin.qq.com/s/Ks8LG7bjmmCpfKp-jkANrg
</code></pre>
<blockquote>
<]]></description>
            <content:encoded><![CDATA[<p>ä½œä¸ªè®°å½•ã€‚</p>
<p>ä¸‹è½½ç½‘é¡µ</p>
<pre><code class="language-shell">$ wget -r -np -k -L -p https://mp.weixin.qq.com/s/Ks8LG7bjmmCpfKp-jkANrg
</code></pre>
<blockquote>
<p>ä¼¼ä¹ä¸å¤ªè¡Œçš„æ ·å­</p>
</blockquote>
<h2>å¼€å§‹æ—¶</h2>
<ol>
<li>æŸ¥æ‰¾æ‰€æœ‰åŒ…å«èƒŒæ™¯çš„å…ƒç´  <code>dom.querySelectorAll('[style*=&quot;background-image&quot;]')</code>ã€‚</li>
<li>å°†èƒŒæ™¯å›¾æ›¿æ¢ä¸ºæœ¬åœ°å ä½å›¾ bgPlaceholderï¼ˆ1 åƒç´ çš„ base64 å›¾ç‰‡ï¼‰ã€‚</li>
<li>å°†åŸæ¥çš„èƒŒæ™¯å›¾æ·»åŠ åˆ° data-lazy-bgimg å±æ€§ä¸Šã€‚</li>
</ol>
<pre><code class="language-js">if (!window.__second_open__ &amp;&amp; !isCareMode &amp;&amp; !isCartoonCopyright) {
  containers.forEach(function (dom) {
    var containsBackground = dom.querySelectorAll('[style*=&quot;background-image&quot;]')
    _toConsumableArray(containsBackground).forEach(function (node) {
      if (
        node &amp;&amp;
        node.style &amp;&amp;
        typeof node.getAttribute === 'function' &amp;&amp;
        !node.getAttribute('data-lazy-bgimg') &amp;&amp;
        !window.__lazyload_detected
      ) {
        var bgImg = node.style.backgroundImage
        var bgImgUrl = bgImg &amp;&amp; bgImg.match(/url\(['&quot;]?(.*?)['&quot;]?\)/)
        if (bgImgUrl &amp;&amp; bgImgUrl[1]) {
          node.style.backgroundImage = bgImg.replace(/url\(['&quot;]?.*?['&quot;]?\)/, bgPlaceholder)
          node.setAttribute('data-lazy-bgimg', bgImgUrl[1])
          node.classList.add('wx_imgbc_placeholder')
        }
      }
    })
  })
}
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•å¼€å‘ä¸€ä¸ª Raycast æ‰©å±•ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/364</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/364</guid>
            <pubDate>Mon, 07 Jul 2025 13:29:52 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752379227556.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>æ˜¯çš„ï¼Œæˆ‘å·²ç»å°† <a href="https://ww]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752379227556.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>æ˜¯çš„ï¼Œæˆ‘å·²ç»å°† <a href="https://www.alfredapp.com/">Alfred</a> æ¢ä¸º <a href="https://www.raycast.com/">Raycast</a> äº†ï¼Œåè€…çš„å…è´¹åŠŸèƒ½è¶³å¤Ÿå¥½ç”¨ã€‚</p>
<p>ä½†ä¹Ÿæ²¡æœ‰å®Œå…¨ä¸¢æ‰ Alfredï¼Œè¿˜åœ¨ç”¨å®ƒçš„å‰ªè´´æ¿å†å²åŠŸèƒ½ã€‚</p>
<p>æ­¤å‰çœ‹åˆ°ä¸€ä¸ªå¸–å­è¯´ï¼šAlfred ç”¨æˆ·ä¸€å®šè¦è¯•è¯• Raycastã€‚å½“æ—¶æˆ‘ä¸ä»¥ä¸ºæ„ã€‚</p>
<p>ç”¨äº†ä¸ƒã€å…«å¹´çš„ Alfred å‡ ä¹æ²¡æ€ä¹ˆâ€œå˜è¿‡â€ï¼Œæœ‰ç§ä¸æ€è¿›å–çš„æ„Ÿè§‰ã€‚ç‰¹åˆ«æ˜¯è¿‘å‡ å¹´ AI çš„å‘å±•ï¼Œå®ƒå¥½åƒè¿˜æ²¡ååº”è¿‡æ¥ä¸€æ ·ã€‚</p>
<h2>å¯¹æ¯”</h2>
<p>åœ¨ä½¿ç”¨ Alfred æ—¶ï¼Œç”¨å¾—æœ€å¤šçš„åŠŸèƒ½æ˜¯ï¼š</p>
<ul>
<li>Web Search - å¿«é€Ÿè·³è½¬ï¼Œé€šå¸¸ç”¨äºæœç´¢æ–‡æ¡£ç­‰ã€‚</li>
<li>Clipboard History - å‰ªè´´æ¿å†å²ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨è¿‡éƒ½è¯´å¥½ç”¨ã€‚</li>
<li>Workflow - å·¥ä½œæµï¼Œæ¯”å¦‚ç¿»è¯‘ã€æ‰“å¼€é¡¹ç›®ç­‰ï¼Œå†™è¿‡ä¸€ä¸¤ä¸ªæ’ä»¶ï¼Œå¼€å‘ä½“éªŒä¸å¥½ï¼Œèƒ½åšçš„æœ‰é™ã€‚</li>
</ul>
<p>è¿™äº›åœ¨ Raycast éƒ½æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Œç”šè‡³æ›´å¥½ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRaycast çš„ç•Œé¢æ›´ç°ä»£ä¸€äº›ï¼Œè·Ÿæœ€æ–°çš„ macOS é£æ ¼æ›´åŠ å¥‘åˆã€‚å¹¶ä¸”å¯ä»¥å®Œå…¨é€šè¿‡é”®ç›˜å®Œæˆä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼ŒRaycast Extension çš„å¼€å‘ä½“éªŒæ¯” Alfred å¥½å¤ªå¤šäº†ã€‚å®˜æ–¹æœ‰æä¾›å¾ˆå¤šäº† APIï¼Œç»Ÿä¸€çš„ UI é£æ ¼ï¼Œæœ‰ç»Ÿä¸€çš„åˆ†å‘ <a href="https://www.raycast.com/store">Store</a>ï¼Œä¸ç”¨ç½‘ä¸Šåˆ°å¤„æœç´¢ã€‚<a href="https://github.com/raycast/extensions/pulse">æ´»è·ƒåº¦</a>å¾ˆé«˜ï¼Œç›®å‰æ‰©å±•æ•°é‡ <a href="https://github.com/raycast/extensions/blob/cffac925444c27172ccf9538a15bad35a97a0adf/.github/CODEOWNERS">2200+</a>ã€‚</p>
<p>æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ï¼Œåœ¨ Raycast å‘å¸ƒæ‰©å±•ï¼Œéœ€è¦ç»è¿‡å®˜æ–¹å®¡æ ¸ï¼Œé€šè¿‡åæ‰ä¼šä¸Šä¼ åˆ° Storeï¼Œå®¡æ ¸å‘¨æœŸè¾ƒæ…¢ã€‚å¥½å¤„æ˜¯èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸ŠæŠŠæ§æ•´ä½“çš„é£æ ¼ï¼Œé¿å…å„æ‰©å±•ä¹‹é—´å¤–è§‚ä¸Šå‚å·®ä¸é½ï¼Œèƒ½ä»å®˜æ–¹è§’åº¦æä¸€äº›æ›´å¥½çš„äº¤äº’å»ºè®®ã€‚</p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<h3>æŠ€æœ¯æ ˆ</h3>
<p>Node.js + TypeScript + React</p>
<p>è™½ç„¶ä½¿ç”¨ React æ„å»ºï¼Œä½†åªèƒ½ä½¿ç”¨å®˜æ–¹æä¾›çš„ä¸€äº› API æˆ–å†…ç½®ç»„ä»¶ï¼Œä¸èƒ½è¿‡å¤šåœ°è‡ªå®šä¹‰ï¼ˆå¯èƒ½æ˜¯ React to macOS Native çš„ç¼˜æ•…å§ï¼‰ï¼Œå¥½å¤„æ˜¯ UI é£æ ¼è¾ƒä¸ºç»Ÿä¸€ã€‚</p>
<h3>å®‰è£…æ‰©å±•</h3>
<ul>
<li>é”®å…¥ Store æœç´¢å®‰è£…</li>
<li>é”®å…¥ Import Extension åœ¨æœ¬åœ°å¯¼å…¥</li>
</ul>
<blockquote>
<p>é”®å…¥ Manage Extensions å¯ä»¥ç®¡ç†æœ¬åœ°æ‰©å±•ã€‚</p>
</blockquote>
<h3>å¸è½½æ‰©å±•</h3>
<ul>
<li>é”®å…¥å…³é”®è¯ï¼Œé€‰ä¸­è¦å¸è½½çš„æ‰©å±•ï¼Œåœ¨ Action Panel é€‰æ‹© Uninstall Extension æ“ä½œå³å¯ï¼Œå¿«æ·é”®ã€ŒâŒƒ + Xã€ã€‚</li>
<li>é”®å…¥ Manage Extension å¯ç®¡ç†æœ¬åœ°æ‰©å±•ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ Raycast ä¸­å¸è½½æœ¬åœ°æ‰©å±•ï¼ˆå³éé€šè¿‡ Store å®‰è£…çš„æ‰©å±•ï¼‰æ—¶ï¼Œæœ¬åœ°æ‰©å±•æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚</p>
</blockquote>
<blockquote>
<p>æ‰©å±•è·¯å¾„ <code>~/Library/Application Support/com.raycast.macos/extensions</code>ã€‚</p>
</blockquote>
<h3>åˆ›å»ºæ‰©å±•</h3>
<p>é”®å…¥ Create Extension å›è½¦è¾“å…¥å¿…è¦ä¿¡æ¯ï¼Œä¾¿åˆ›å»ºå¥½äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1751903805052.png" alt=""></p>
<blockquote>
<p>å®˜æ–¹æä¾›äº†å¤šä¸ªæ¨¡æ¿ï¼Œå¯ä»¥é€‰æ‹©ç®€å•çš„ Show Detail æ¨¡æ¿ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼š</p>
<pre><code class="language-shell">$ cd &lt;your-extension-path&gt;
$ npm install
$ npm run dev
</code></pre>
<h3>è°ƒè¯•æ‰©å±•</h3>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>npm run dev</code>ï¼ˆå³ <code>ray develop</code>ï¼‰æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å®‰è£…æ‰©å±•ï¼Œå¹¶ä»¥å¼€å‘æ¨¡å¼å¯åŠ¨ Raycast åº”ç”¨ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œåœ¨ Preferences - Advanced - Developer Tools ä¸‹å‹¾é€‰å‡ ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>Auto-reload on Save</li>
<li>Open Raycast in development mode</li>
<li>Keep window always visible during development</li>
</ul>
<p>è¿™å¯¹å¼€å‘ä½“éªŒå°¤ä¸ºé‡è¦ã€‚ä¸€æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æ–‡ä»¶ä¿®æ”¹å¯ä»¥è‡ªåŠ¨é‡è½½ï¼ŒäºŒæ˜¯ä½¿ Raycast å§‹ç»ˆæ˜¾ç¤ºï¼Œä»¥é¿å…åˆ‡æ¢å…¶ä»–åº”ç”¨æ—¶çª—å£å…³é—­ã€‚</p>
<p>åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ <code>console.log()</code> å¯ä»¥åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºæ‰“å°ä¿¡æ¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752164474489.png" alt=""></p>
<p>å¦‚æœæ²¡æœ‰æ­£ç¡®ä½¿ç”¨ APIã€ç»„ä»¶æˆ–å¿«æ·é”®å†²çªï¼Œæ­¤å¤„ä¹Ÿä¼šæœ‰ Warning æ˜¾ç¤ºã€‚</p>
<h3>å‘å¸ƒæ‰©å±•</h3>
<p>å¦‚æœæƒ³è¦å°†ä½ çš„æ‰©å±•å‘å¸ƒåˆ° Store ä¸Šï¼Œæ˜¯éœ€è¦å®˜æ–¹å®¡æ ¸çš„ã€‚</p>
<p>ä¸ºé¿å…å®¡æ ¸ä¸é€šè¿‡ï¼Œä½ çš„æ‰©å±•åº”æ»¡è¶³ <a href="https://developers.raycast.com/basics/prepare-an-extension-for-store">Prepare an Extension for Store</a> è¦æ±‚ã€‚</p>
<p>äºŒé€‰ä¸€ï¼š</p>
<ul>
<li>Fork å®˜æ–¹<a href="https://github.com/raycast/extensions">ä»“åº“</a>ï¼Œå°†ä½ çš„æ‰©å±•æ”¾åœ¨ä»“åº“ <code>extensions</code> ç›®å½•ä¸‹ï¼Œæäº¤ PRã€‚</li>
<li>åˆ›å»ºç‹¬ç«‹ä»“åº“ï¼Œç„¶åé€šè¿‡ ray publish æäº¤ã€‚</li>
</ul>
<p>æäº¤ PR æ—¶ï¼Œå»ºè®®é™„ä¸Šè§†é¢‘ï¼Œæˆ–è®¸å¯ä»¥æ›´å¿«åœ°å®¡æ ¸ã€‚æˆ‘ä¹‹å‰å†™äº†ä¸€ä¸ªå¾®ä¿¡å¼€å‘å·¥å…·çš„<a href="https://github.com/toFrankie/raycast-wechat-devtool">æ‰©å±•</a>ï¼Œç”±äºä»–ä»¬æ²¡æœ‰å°ç¨‹åºé¡¹ç›®ï¼Œæµç¨‹ä¸Šå®ƒä»¬è·‘ä¸é€šï¼Œå¯èƒ½ä¼šè¦æ±‚é™„ä¸Šè§†é¢‘è¾…åŠ©å®¡æ ¸ï¼Œä¾‹å¦‚<a href="https://github.com/raycast/extensions/pull/20222#pullrequestreview-3003917464">è¿™ä¸ª</a>ã€‚</p>
<blockquote>
<p>If you add a new extension or command, include a screencast (or screenshot for straightforward changes). A good screencast will make the review much faster - especially if your extension requires registration in other services.</p>
</blockquote>
<p>æäº¤ PR ä¹‹åï¼Œæœºå™¨äºº greptile-apps å¯èƒ½ä¼šæä¸€äº› Review æ„è§ï¼ŒæŒ‰éœ€è°ƒæ•´å³å¯ã€‚</p>
<p>æƒ³è¦åæ§½çš„æ˜¯ï¼Œå®¡æ ¸å¾ˆæ…¢ï¼Œçœ‹ commit è®°å½•ä¸€å¤©åªå¤„ç†å‡ ä¸ªã€‚</p>
<h2>å¼€å‘</h2>
<blockquote>
<p><a href="https://developers.raycast.com/">Raycast Extension å®˜æ–¹å¼€å‘æ–‡æ¡£</a></p>
</blockquote>
<h3>å‘½åè§„èŒƒ</h3>
<p>éµå¾ª Apple Style Guideï¼Œè¯¦è§<a href="https://developers.raycast.com/basics/prepare-an-extension-for-store#extensions-and-commands-naming">è¿™é‡Œ</a>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>æ‰©å±•æ ‡é¢˜ï¼šå°½é‡ä½¿ç”¨åè¯ï¼Œè€Œä¸æ˜¯åŠ¨è¯ï¼Œæ¯”å¦‚ WeChat DevToolã€‚</li>
<li>æ‰©å±•æè¿°ï¼šä¸€å¥è¯å‡†ç¡®ã€ç®€æ´åœ°æè¿°æ‰©å±•ç¨‹åºçš„åŠŸèƒ½ã€‚</li>
<li>å‘½ä»¤æ ‡é¢˜ï¼šåŠ¨åè¯ç»„åˆï¼Œå°½å¯èƒ½å…·ä½“åœ°æè¿°å‘½ä»¤çš„ä½œç”¨ï¼Œæ¯”å¦‚ Open Projectã€‚</li>
<li>å‘½ä»¤å‰¯æ ‡é¢˜ï¼šä¸ºæ ‡é¢˜æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¦‚æœå‰¯æ ‡é¢˜å‡ ä¹ä¸å‘½ä»¤æ ‡é¢˜é‡å¤ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦å®ƒã€‚ä¸æŒ‡å®šæ—¶ï¼Œè¯¥ä½ç½®ä¼šæ˜¾ç¤ºæ‰©å±•æ ‡é¢˜ã€‚
<ul>
<li>ç¤ºä¾‹ï¼šå‘½ä»¤æ ‡é¢˜ Search Packageï¼Œå‘½ä»¤å‰¯æ ‡é¢˜ NPMï¼Œ</li>
<li>ç¤ºä¾‹ï¼šå‘½ä»¤æ ‡é¢˜ Search NPM Packageï¼Œæ— å‘½åå‰¯æ ‡é¢˜ã€‚</li>
<li>ä»¥ä¸Šç¤ºä¾‹ï¼Œå¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œéƒ½æ˜¯éå¸¸æ¸…æ™°æ˜ç¡®çš„ã€‚</li>
</ul>
</li>
<li>å‘½ä»¤æè¿°ï¼šä¸€å¥è¯å‡†ç¡®ã€ç®€æ´åœ°æè¿°å‘½ä»¤çš„åŠŸèƒ½ã€‚</li>
</ul>
<h3>æœ¬åœ°åŒ–</h3>
<p>å¾ˆé—æ†¾ï¼Œç›®å‰ Raycast æ‰©å±•ä»…æ”¯æŒç¾å¼è‹±æ–‡ï¼Œä¸æ”¯æŒæœ¬åœ°åŒ–è¯­è¨€ï¼Œæ›´å¤šè¯·çœ‹<a href="https://developers.raycast.com/basics/prepare-an-extension-for-store#localization-language">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p>ä¸ä¸Šä¼ åˆ° Store å¯å¿½ç•¥ã€‚</p>
</blockquote>
<h3>æ‰©å±•ä¿¡æ¯</h3>
<p>åŸºæœ¬ä¸Šéƒ½åœ¨ <code>package.json</code> å£°æ˜ï¼Œåˆ—ä¸¾ä¸€äº›åŸºæœ¬å­—æ®µ:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;wechat-devtool&quot;, // åŒ…å
  &quot;title&quot;: &quot;WeChat DevTool&quot;, // æ‰©å±•æ ‡é¢˜
  &quot;description&quot;: &quot;Quickly open WeChat Mini Program projects via official CLI.&quot;, // æ‰©å±•æè¿°
  &quot;icon&quot;: &quot;icon.png&quot;, // æ‰©å±•å›¾æ ‡ 512 Ã— 512 çš„ PNG å›¾ç‰‡
  &quot;author&quot;: &quot;tofrankie&quot;, // Raycast è´¦æˆ·ç”¨æˆ·å
  &quot;contributors&quot;: [&quot;someone&quot;], // è´¡çŒ®è€… Raycast ç”¨æˆ·å
  &quot;license&quot;: &quot;MIT&quot;, // åè®®
  &quot;categories&quot;: [&quot;Developer Tools&quot;], // æ‰©å±•åˆ†ç±»
  &quot;commands&quot;: [ // å‘½ä»¤åˆ—è¡¨
    {
      &quot;name&quot;: &quot;open-project&quot;, // åç§°ï¼Œè·Ÿå…¥å£æ–‡ä»¶åŒå
      &quot;title&quot;: &quot;Open Project&quot;, // æ ‡é¢˜
      &quot;description&quot;: &quot;Open Mini Program projects via WeChat DevTool.&quot;, // æè¿°
      &quot;mode&quot;: &quot;view&quot; // æ¨¡å¼
    },
    {
      &quot;name&quot;: &quot;configure-projects&quot;,
      &quot;title&quot;: &quot;Configure Projects&quot;,
      &quot;description&quot;: &quot;Configure Mini Program projects.&quot;,
      &quot;mode&quot;: &quot;view&quot;
    }
  ],
  &quot;preferences&quot;: [ // æ‰©å±•åå¥½è®¾ç½®
    {
      &quot;name&quot;: &quot;wechat-devtool-path&quot;, // åç§°
      &quot;type&quot;: &quot;textfield&quot;, // ç±»å‹
      &quot;title&quot;: &quot;WeChat DevTool Path&quot;, // æ ‡é¢˜
      &quot;description&quot;: &quot;The path to the WeChat DevTool executable.&quot;, // æè¿°
      &quot;required&quot;: false // æ˜¯å¦å¿…éœ€
    }
  ],
  &quot;keywords&quot;: [ // å…³é”®è¯ï¼Œå¯ä¾› Store æœç´¢ä½¿ç”¨
    &quot;Developer Tools&quot;,
    &quot;WeChat&quot;,
    &quot;WeChat DevTool&quot;,
    &quot;WeChat Mini Program&quot;
  ],
  // ...
}
</code></pre>
<p>ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="language-txt">.
â”œâ”€â”€ assets                      # é™æ€èµ„æºç›®å½•
â”‚   â””â”€â”€ icon.png
â”œâ”€â”€ CHANGELOG.md                # å˜æ›´æ—¥å¿—
â”œâ”€â”€ metadata                    # æ‰©å±•æˆªå›¾
â”‚   â”œâ”€â”€ wechat-devtool-1.png
â”‚   â””â”€â”€ wechat-devtool-2.png
â”œâ”€â”€ package.json                # æ‰©å±•ä¿¡æ¯ç­‰
â”œâ”€â”€ README.md                   # About This Extension ä¼šæ˜¾ç¤ºè¿™ä¸ª
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ configure-projects.tsx  # å…¥å£æ–‡ä»¶ï¼ˆè·Ÿ commands name åŒåï¼‰
â”‚   â””â”€â”€ open-project.tsx        # å…¥å£æ–‡ä»¶
â””â”€â”€ tsconfig.json
</code></pre>
<p>ä¸€äº›æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li><strong>name</strong>ï¼šä¸èƒ½ä¸ Store å·²æœ‰æ‰©å±•é‡å¤ï¼Œå¯ä»¥åœ¨<a href="https://github.com/raycast/extensions/blob/main/.github/extensionName2Folder.json">è¿™é‡Œ</a>æœç´¢ä¸€ä¸‹ã€‚å°†ç”¨äºå‘å¸ƒåçš„æ‰©å±•é“¾æ¥ï¼Œæ¯”å¦‚ï¼š <code>https://www.raycast.com/tofrankie/wechat-devtool</code>ã€‚</li>
<li><strong>icon</strong>ï¼šå›¾æ ‡æ”¾åœ¨ <code>/assets</code> ç›®å½•ã€‚å…¶ä»–éœ€è¦è·Ÿæ‰©å±•ä¸€åŒæ‰“åŒ…çš„é™æ€èµ„æºéƒ½è¦æ”¾åœ¨æ­¤ç›®å½•ä¸‹ã€‚</li>
<li><strong>author</strong>ï¼šæ˜¯ Raycast ç”¨æˆ·åï¼Œä¸æ˜¯ GitHub ç”¨æˆ·åã€‚</li>
<li><strong>license</strong>ï¼šè‹¥è¦å‘å¸ƒåˆ° Storeï¼Œåªèƒ½æ˜¯ MIT åè®®ã€‚</li>
<li><strong>categories</strong>ï¼šè‡³å°‘é€‰æ‹©ä¸€ä¸ªï¼Œå¯é€‰åˆ†ç±»çœ‹<a href="https://developers.raycast.com/basics/prepare-an-extension-for-store#all-categories">è¿™é‡Œ</a>ã€‚</li>
<li><strong>commands</strong>ï¼š
<ul>
<li><strong>mode</strong>ï¼šå¯é€‰å€¼ <code>view</code>ã€<code>no-view</code>ã€<code>menu-bar</code>ã€‚æ¯”å¦‚ï¼Œæ‰“å¼€é“¾æ¥ç­‰ä¸éœ€è¦ç•Œé¢çš„å‘½ä»¤æ“ä½œï¼Œå¯ä»¥é€‰æ‹© <code>no-view</code>ã€‚</li>
</ul>
</li>
<li><strong>preferences</strong>ï¼šåå¥½è®¾ç½®æ—¶å¯ä»¥åŒæ­¥çš„ã€‚
<ul>
<li><strong>required</strong>ï¼šå½“è®¾ä¸º <code>true</code> æ—¶ï¼Œç”¨æˆ·è®¾ç½®åæ‰èƒ½ä½¿ç”¨å…¶ä»–å‘½ä»¤ã€‚</li>
</ul>
</li>
</ul>
<p>æ›´å¤šè¯·çœ‹ <a href="https://developers.raycast.com/information/manifest#extension-properties">Extension Properties</a> æˆ– <a href="https://www.raycast.com/schemas/extension.json">Extension Schemas</a>ã€‚</p>
<h3>å‘½ä»¤å…¥å£æ–‡ä»¶</h3>
<p>å…¥å£æ–‡ä»¶æ”¾åœ¨ <code>/src</code> ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åè¦ä¸ <code>commands[].name</code> ä¿æŒä¸€è‡´ã€‚</p>
<p>å‘½ä»¤ä¸º view æ¨¡å¼ï¼Œå¯ä»¥ç”¨å®˜æ–¹æä¾›çš„ç»„ä»¶æ¥æ„å»ºç•Œé¢ï¼Œè¯¦è§ <a href="https://developers.raycast.com/api-reference/user-interface">User Interface</a>ã€‚</p>
<ul>
<li>List åˆ—è¡¨ç±»å‹</li>
<li>Grid ç½‘æ ¼ç±»å‹</li>
<li>Detail æ¸²æŸ“ Markdown å†…å®¹ã€å±•ç¤ºå›¾ç‰‡</li>
<li>Form è¡¨å•ç±»å‹</li>
</ul>
<p>è™½ç„¶æ˜¯ç”¨ React ç¼–å†™çš„ç•Œé¢ï¼Œä½†ä¸èƒ½è‡ªç”±ä½¿ç”¨ç±»ä¼¼ <code>div</code> æˆ–ç¬¬ä¸‰æ–¹ç»„ä»¶åº“æ¥æ„å»ºå¤æ‚ç•Œé¢ã€‚</p>
<h3>Action Panel</h3>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ Listã€Detailã€Form ç­‰æ„å»ºå‘½ä»¤ç•Œé¢æ—¶ï¼Œé€šå¸¸éœ€è¦å£°æ˜ Action Panel æ¥æä¾›æ›´å¤šé€‰é¡¹ã€‚</p>
<pre><code class="language-jsx">&lt;List.Item
  // others...
  actions={
    &lt;ActionPanel&gt;
      &lt;Action
        title=&quot;Open Project&quot;
        icon={Icon.Terminal}
        onAction={() =&gt; {
          // do something...
        }}
      /&gt;
      &lt;Action.Push
        title=&quot;Go to Configuration&quot;
        icon={Icon.Gear}
        target={&lt;ConfigureProjects /&gt;}
      /&gt;
      &lt;Action.CopyToClipboard
        title=&quot;Copy Project Path&quot;
        content={project.path}
        shortcut={{ modifiers: [&quot;cmd&quot;, &quot;shift&quot;], key: &quot;,&quot; }}
      /&gt;
      &lt;Action
        title=&quot;Delete Project&quot;
        icon={Icon.Trash}
        style={Action.Style.Destructive}
        onAction={() =&gt; {
          // do something...
        }}
      /&gt;
    &lt;/ActionPanel&gt;
  }
/&gt;
</code></pre>
<p>Raycast æä¾›äº† <code>Action.Open</code>ã€ <code>Action.Push</code>ã€<code>Action.CopyToClipboard</code>ã€<code>Action.OpenInBrowser</code> ç­‰ä¸€ç³»åˆ—å†…ç½®å‘½ä»¤ä»¥è½»æ¾å®Œæˆå¸¸ç”¨æ“ä½œï¼Œæ›´å¤šè¯·çœ‹<a href="https://developers.raycast.com/api-reference/user-interface/actions">è¿™é‡Œ</a>ã€‚</p>
<p>å¯¹äºå±é™©æ“ä½œï¼Œå¯ä»¥å£°æ˜ä¸º <a href="https://developers.raycast.com/api-reference/user-interface/actions#action.style">Action.Style.Destructive</a> ä»¥é«˜äº®æ˜¾ç¤ºï¼Œå¯ä»¥é…åˆ <a href="https://developers.raycast.com/api-reference/feedback/alert">confirmAlert</a> äºŒæ¬¡ç¡®è®¤ã€‚</p>
<h3>Action å¿«æ·é”®</h3>
<p>åœ¨ Action Panel ä¸­ï¼Œå°†ç¬¬ä¸€ã€ç¬¬äºŒä¸ªæ“ä½œä½œä¸º Primary Action å’Œ Secondary Actionï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨åˆ†é…å¿«æ·é”®ã€‚</p>
<ul>
<li>åœ¨ Listã€Gridã€Detail é¡µé¢åˆ†åˆ« Enterã€âŒ˜ + Enter</li>
<li>åœ¨ Form é¡µé¢åˆ†åˆ«æ˜¯ âŒ˜ + Enterã€âŒ˜ + â‡§ + Enter</li>
</ul>
<p>è®¾å®š Action å¿«æ·é”®æ—¶ï¼Œå¯ä»¥å‚è€ƒ Raycast å®˜æ–¹æ¨èçš„å¸¸ç”¨å¿«æ·é”®ï¼Œä»¥ä¾¿ä½¿ç”¨å„æ’ä»¶æœ‰ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒï¼Œæ›´å¤šè¯·çœ‹<a href="https://developers.raycast.com/api-reference/keyboard">è¿™é‡Œ</a>ã€‚</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>macOS</th>
<th>Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td>Copy</td>
<td>âŒ˜ + â‡§ + C</td>
<td><code>ctrl</code> + <code>shift</code> + C</td>
</tr>
<tr>
<td>CopyDeeplink</td>
<td>âŒ˜ + â‡§ + C</td>
<td><code>ctrl</code> + <code>shift</code> + C</td>
</tr>
<tr>
<td>CopyName</td>
<td>âŒ˜ + â‡§ + .</td>
<td><code>ctrl</code> + <code>alt</code> + C</td>
</tr>
<tr>
<td>CopyPath</td>
<td>âŒ˜ + â‡§ + ,</td>
<td><code>alt</code> + <code>shift</code> + C</td>
</tr>
<tr>
<td>Save</td>
<td>âŒ˜ + S</td>
<td><code>ctrl</code> + S</td>
</tr>
<tr>
<td>Duplicate</td>
<td>âŒ˜ + D</td>
<td><code>ctrl</code> + <code>shift</code> + S</td>
</tr>
<tr>
<td>Edit</td>
<td>âŒ˜ + E</td>
<td><code>ctrl</code> + E</td>
</tr>
<tr>
<td>MoveDown</td>
<td>âŒ˜ + â‡§ + â†“</td>
<td><code>ctrl</code> + <code>shift</code> + â†“</td>
</tr>
<tr>
<td>MoveUp</td>
<td>âŒ˜ + â‡§ + â†‘</td>
<td><code>ctrl</code> + <code>shift</code> + â†‘</td>
</tr>
<tr>
<td>New</td>
<td>âŒ˜ + N</td>
<td><code>ctrl</code> + N</td>
</tr>
<tr>
<td>Open</td>
<td>âŒ˜ + O</td>
<td><code>ctrl</code> + O</td>
</tr>
<tr>
<td>OpenWith</td>
<td>âŒ˜ + â‡§ + O</td>
<td><code>ctrl</code> + <code>shift</code> + O</td>
</tr>
<tr>
<td>Pin</td>
<td>âŒ˜ + â‡§ + P</td>
<td><code>ctrl</code> + .</td>
</tr>
<tr>
<td>Refresh</td>
<td>âŒ˜ + R</td>
<td><code>ctrl</code> + R</td>
</tr>
<tr>
<td>Remove</td>
<td>âŒƒ + X</td>
<td><code>ctrl</code> + D</td>
</tr>
<tr>
<td>RemoveAll</td>
<td>âŒƒ + â‡§ + X</td>
<td><code>ctrl</code> + <code>shift</code> + D</td>
</tr>
<tr>
<td>ToggleQuickLook</td>
<td>âŒ˜ + Y</td>
<td><code>ctrl</code> + Y</td>
</tr>
</tbody>
</table>
<h3>å›¾æ ‡ã€å›¾ç‰‡</h3>
<p>å¼€å‘æ‰©å±•å…ä¸äº†ä½¿ç”¨å›¾ç‰‡ï¼ŒRaycast å·²ç»å†…ç½®äº†å¾ˆå¤šå›¾æ ‡å¯ç›´æ¥ä½¿ç”¨ï¼Œè¯¦è§<a href="https://developers.raycast.com/api-reference/user-interface/icons-and-images#icon">è¿™é‡Œ</a>ã€‚</p>
<p>è¿˜å¯ä»¥æŒ‡å®šè¿œç¨‹å›¾ç‰‡ã€æœ¬åœ°æ–‡ä»¶ç­‰ã€‚</p>
<pre><code class="language-ts">type ImageLike = URL | Asset | Icon | FileIcon | Image

type ImageSource = URL | Asset | Icon | { light: URL | Asset; dark: URL | Asset }
</code></pre>
<ul>
<li><strong>URL</strong>ï¼šå¦‚ HTTP é“¾æ¥</li>
<li><strong>Asset</strong>ï¼š<code>assets</code> ç›®å½•çš„å›¾ç‰‡æ–‡ä»¶</li>
<li><strong>Icon</strong>ï¼šRaycast å†…ç½®çš„å›¾æ ‡</li>
<li><strong>FileIcon</strong>ï¼šè¯¥æ–‡ä»¶/ç›®å½•åœ¨ Finder æ‰€æ˜¾ç¤ºçš„å›¾æ ‡</li>
<li><strong>Image</strong>ï¼šç±»å‹å¦‚ ImageSourceï¼Œè¿˜å¯ä»¥æŒ‡å®šæµ…è‰²ã€æ·±è‰²ä¸»é¢˜çš„å›¾ç‰‡ï¼Œå‘½åå½¢å¼ <code>icon.png</code> å’Œ <code>icon@dark.png</code>ã€‚</li>
</ul>
<p>å›¾ç‰‡ç€è‰²ï¼š</p>
<pre><code class="language-tsx">import { Color, Icon, List } from &quot;@raycast/api&quot;

const tintedIcon = { source: Icon.RaycastLogoPos, tintColor: Color.Blue }

export default function Example() {
  return (
    &lt;List&gt;
      &lt;List.Item title=&quot;Blue&quot; icon={tintedIcon} /&gt;
    &lt;/List&gt;
  )
}
</code></pre>
<p>æœ¬åœ° svg å›¾ç‰‡åŒæ ·ä¹Ÿæ˜¯å¯ä»¥ç€è‰²çš„ã€‚</p>
<h3>å¯¼èˆª</h3>
<ul>
<li>åœ¨ Action Panel å¯ä»¥ç”¨ <code>Action.Push</code> è·³è½¬ç›®æ ‡é¡µ</li>
<li>åœ¨é¡µé¢å¯ä»¥ä½¿ç”¨ <code>const { push, pop } = useNavigation()</code> è·³è½¬ä¸‹ä¸€é¡µæˆ–è¿”å›ä¸Šä¸€é¡µ</li>
<li>ä½¿ç”¨ <code>popToRoot()</code> å¯ä»¥è¿”å› Raycast æ ¹ç•Œé¢</li>
<li>ä½¿ç”¨ <code>closeMainWindow()</code> å¯ä»¥ä¸»åŠ¨å…³é—­ Raycast çª—å£</li>
</ul>
<h3>æœç´¢</h3>
<p>ä½¿ç”¨ List æ„å»ºçš„é¡µé¢å¸¦æœ‰ä¸€ä¸ªæœç´¢æ ç”¨äºç­›é€‰ï¼Œæ¥æºæ˜¯ List.Item çš„ <code>title</code> å’Œ <code>keywords</code> å­—æ®µã€‚</p>
<p>æˆ‘å‘ç°ï¼Œå®ƒæ²¡æœ‰æ ¹é¡µé¢è¾“å…¥æ¡†é‚£ä¹ˆæ™ºèƒ½ï¼Œå¯¹ç­›é€‰ä¸­æ–‡æˆ–æ‹¼éŸ³ä¸å¤ªçµå…‰çš„æ ·å­ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰æœç´¢è§„åˆ™ï¼šsearchText + onSearchTextChange</li>
<li>ä¸°å¯Œ keywords å†…å®¹</li>
</ul>
<blockquote>
<p><a href="https://developers.raycast.com/api-reference/user-interface/list#props">List Props</a></p>
</blockquote>
<p>å·²åè€…ä¸ºä¾‹ï¼Œå¯ä»¥å°†é¡¹ç›®åç§°ã€é¡¹ç›®è·¯å¾„ã€é¡¹ç›®åç§°æ‹¼éŸ³ï¼ˆè‹¥æœ‰ä¸­æ–‡ï¼‰æ·»åŠ åˆ° keywords å­—æ®µï¼Œå‚è€ƒ <a href="https://github.com/toFrankie/raycast-wechat-devtool/blob/2be07dadbc747826def1a1c5373bb0040d4d004b/src/utils/pinyin.ts">pinyin.ts</a>ã€‚</p>
<h3>å›¾ç‰‡å±•ç¤º</h3>
<p>è‹¥è¦å±•ç¤ºä¸€å¼ å›¾ç‰‡ï¼Œä¼¼ä¹åªæœ‰ Detail + Markdown çš„æ–¹å¼äº†ã€‚</p>
<pre><code class="language-tsx">export default function ImageView({ url }: { url: string }) {
  // å¯é€šè¿‡ example.png?raycast-width=250&amp;raycast-height=250 æŒ‡å®šå®½é«˜
  const markdown = `![](${url})`;
  return &lt;Detail markdown={markdown} /&gt;;
}
</code></pre>
<h3>è¡¨å•</h3>
<p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ–‡æ¡£å¾ˆè¯¦å°½äº†ï¼Œè¯·çœ‹<a href="https://developers.raycast.com/api-reference/user-interface/form">è¿™é‡Œ</a>ã€‚</p>
<h3>Toastã€Loadingã€Alert</h3>
<p>æä¾›çš„ API æœ‰ï¼š</p>
<ul>
<li><a href="https://developers.raycast.com/api-reference/feedback/toast"><strong>showToast</strong></a> æœ‰ Successã€Failureã€Animated ä¸‰ç§ï¼Œåè€…ä¸º Loading åœˆåœˆã€‚å¦‚æœ Raycast çª—å£å…³é—­äº†ï¼Œä¼šå›é€€åˆ° showHUD</li>
<li><a href="https://developers.raycast.com/utilities/functions/showfailuretoast"><strong>showFailureToast</strong></a> æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä¼˜å…ˆé€‰æ‹©è¿™ä¸ª</li>
<li><a href="https://developers.raycast.com/api-reference/feedback/hud#showhud"><strong>showHUD</strong></a> Raycast çª—å£æ—¶åœ¨å±å¹•ä¸‹æ–¹æ˜¾ç¤ºä¸€æ¡ä¿¡æ¯</li>
<li><a href="https://developers.raycast.com/api-reference/feedback/alert"><strong>confirmAlert</strong></a> ç”¨äºå±é™©æ“ä½œçš„äºŒæ¬¡ç¡®è®¤å¼¹çª—</li>
</ul>
<h3>ç¯å¢ƒä¿¡æ¯</h3>
<p>å¯ä»¥åœ¨ <a href="https://developers.raycast.com/api-reference/environment">environment</a> è·å–ï¼š</p>
<pre><code class="language-js">import { useNavigation, showToast, Toast, showHUD, environment } from &quot;@raycast/api&quot;;

environment.raycastVersion // 1.102.5
environment.ownerOrAuthorName // tofrankie
environment.extensionName // wechat-devtool
environment.commandName // open-project
environment.commandMode // view
environment.assetsPath // /Users/frankie/.config/raycast/extensions/wechat-devtool/assets
environment.supportPath // /Users/frankie/Library/Application Support/com.raycast.macos/extensions/wechat-devtool
environment.isDevelopment // true
environment.appearance // light
environment.textSize // medium
environment.launchType // userInitiated
</code></pre>
<h3>æ‰©å±•ç›¸å…³æ–‡ä»¶</h3>
<ul>
<li>assetsPath æ‰©å±•å®‰è£…åˆ° Raycast çš„äº§ç‰©è·¯å¾„</li>
<li>supportPath æ‰©å±•ç›¸å…³æ–‡ä»¶ï¼Œæ¯”å¦‚æ‰©å±•è®°å½•ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åœ¨è¯¥ç›®å½•ä¸‹</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRaycast ä¸ä¼šåŒæ­¥ <code>supportPath</code> ç›®å½•çš„æ–‡ä»¶ã€‚</p>
<p>ä¹‹å‰æˆ‘æƒ³ç€æŠŠä¸€äº›é…ç½®å†™å…¥ supportPath çš„æ–‡ä»¶ï¼Œä½¿å…¶åœ¨ Raycast ä¸­è¿›è¡ŒåŒæ­¥ã€‚ä½†è¿™æ˜¯ä¸è¡Œçš„ï¼Œå¯¹æ‰©å±•æ¥è¯´ï¼ŒåªåŒæ­¥ <a href="https://developers.raycast.com/api-reference/preferences">preferences</a> çš„é…ç½®ï¼Œè€Œ preferences åˆæ²¡åŠæ³•åŠ¨æ€æ›´æ–°ã€‚</p>
<h3>Shell ç¯å¢ƒ</h3>
<p>æœ‰æ—¶æˆ‘ä»¬è¦åœ¨ Raycast æ‰©å±•ä¸­æ‰§è¡Œä¸€äº› Shell å‘½ä»¤ã€‚</p>
<p>ä¸‹é¢æ˜¯é»˜è®¤æƒ…å†µä¸‹çš„ä¸€äº›å˜é‡å€¼ã€‚</p>
<pre><code class="language-shell">$ echo $SHELL
/bin/zsh
</code></pre>
<pre><code class="language-shell">$ echo $PATH
/usr/gnu/bin:/usr/local/bin:/bin:/usr/bin:.
</code></pre>
<pre><code class="language-shell">$ printenv
SUPPORT_PATH=/Users/frankie/Library/Application Support/com.raycast.macos/extensions/wechat-devtool
TMPDIR=/var/folders/z4/nxcp1z415jgff4rwrrf8v3y00000gn/T
ASSETS_PATH=/Users/frankie/.config/raycast/extensions/wechat-devtool/assets
LC_ALL=en_CN-u-hc-h23-u-ca-gregory-u-nu-latn
__CF_USER_TEXT_ENCODING=0x1F5:0x19:0x34
EXTENSION_NAME=wechat-devtool
RAYCAST_VERSION=1.102.5
PWD=/
FAVICON_PROVIDER=legacy
NODE_PATH=/Applications/Raycast.app/Contents/Resources/RaycastNodeExtensions_RaycastNodeExtensions.bundle/Contents/Resources/api/node_modules
NODE_ENV=development
SHLVL=1
HOME=/Users/frankie
COMMAND_NAME=open-project
RAYCAST_BUNDLE_ID=com.raycast.macos
_=/usr/bin/printenv
</code></pre>
<p>é€šå¸¸æˆ‘ä»¬ä¼šåœ¨ <code>~/.zshrc</code> ä¸­é…ç½® <code>export PATH=&quot;/opt/homebrew/bin:/opt/homebrew/sbin:$PATH&quot;</code> ä»¥ä½¿ç”¨ Homebrew å®‰è£…çš„å‘½ä»¤ï¼Œä½† Raycast æ‰©å±•æ‰§è¡Œ Shell ä¸ä¼šåŠ è½½ <code>~/.zshrc</code> å› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨é‡Œé¢çš„å‘½ä»¤ã€‚</p>
<p>å¯ä»¥è¿™æ ·å¤„ç†ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<pre><code class="language-ts">import { exec } from &quot;child_process&quot;;
import { promisify } from &quot;util&quot;;

const execAsync = promisify(exec);

function execCommand(command: string, cwd?: sting) {
  const env = getEnv();
  await execAsync(command, { cwd, env });
  // do something...
}

function getEnv() {
  return { ...process.env, PATH: joinHomebrewPath() };
}

function joinHomebrewPath() {
  return [process.env.PATH, &quot;/opt/homebrew/bin&quot;, &quot;/opt/homebrew/sbin&quot;].filter(Boolean).join(&quot;:&quot;);
}
</code></pre>
<h3>Change Log</h3>
<p>å¼€å‘å®Œæˆåï¼Œéœ€è¦åœ¨ <a href="http://CHANGELOG.md">CHANGELOG.md</a> è¡¥å……ä¸€æ¡å˜æ›´è®°å½•ã€‚</p>
<p>éµå¾ª <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a> å†™æ³•ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ ¼å¼å¿…é¡»æ˜¯ <code>## [xxx] - {PR_MERGE_DATE}</code></li>
<li><code>[]</code> å†…çš„ä¸ºæœ¬æ¬¡å˜æ›´çš„æ ‡é¢˜</li>
<li><code>{PR_MERGE_DATE}</code> ä¸ºåˆå¹¶æ—¥æœŸã€‚å› ä¸ºä»æäº¤ PR åˆ°å®¡æ ¸é€šè¿‡å¯èƒ½è¦å¥½å‡ å¤©ï¼Œè¢«åˆå¹¶æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢</li>
</ul>
<blockquote>
<p>æ›´å¤šè¯·çœ‹<a href="https://developers.raycast.com/basics/prepare-an-extension-for-store#version-history">è¿™é‡Œ</a></p>
</blockquote>
<pre><code class="language-text"># WeChat DevTool Changelog

## [New Version] - {PR_MERGE_DATE}

- Add something
- Improve something
- Fix something

## [First Release] - 2025-07-11

- **Open Project** - Open configured mini program project via WeChat DevTool CLI.
- **Graphical Configuration** - Complete graphical interface for dynamic project management.
</code></pre>
<h3>æˆªå›¾</h3>
<p>å­˜æ”¾åœ¨ <code>metadata</code> ç›®å½•ä¸‹ï¼Œå¯æä¾› 1 ~ 6 å¼ æˆªå›¾ã€‚</p>
<p>Raycast å†…ç½®æä¾›äº†æˆªå±åŠŸèƒ½ï¼Œåœ¨ Raycast Settings - Advanced - Window Capture ä¸­è®¾ç½®å¿«æ·é”®ï¼ˆå¦‚ âŒ¥ + â‡§ + âŒ˜ + Mï¼‰ã€‚</p>
<p>åœ¨ <code>npm run dev</code> æ¨¡å¼ä¸‹å¯åŠ¨æ‰©å±•ï¼ŒæŒ‰ä¸‹å¿«æ·é”®ï¼Œä¾¿å¯è°ƒå‡ºæˆªå±çª—å£ï¼Œå¹¶å‹¾é€‰ä¸Šã€ŒSave to Metadataã€ï¼Œå°±ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ‰©å±•çš„ <code>metadata</code> ç›®å½•ï¼Œæ›´å¤šè¯·çœ‹<a href="https://developers.raycast.com/basics/prepare-an-extension-for-store#screenshots">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p>Raycast æä¾›äº†ä¸€äº›é«˜æ¸…å£çº¸ï¼Œè¯·çœ‹<a href="https://www.raycast.com/wallpapers">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h2>è´¡çŒ®</h2>
<p>å¦‚æœæƒ³å¯¹å·²å‘å¸ƒçš„æ‰©å±•ä½œå‡ºè´¡çŒ®ï¼š</p>
<ol>
<li>fork <a href="https://github.com/raycast/extensions">raycast/extensions</a></li>
<li>åŠŸèƒ½è°ƒæ•´...</li>
<li>å°†ä½ çš„ Raycast ç”¨æˆ·åæ·»åŠ åˆ° package.json çš„ <code>contributors</code> å­—æ®µ</li>
<li>æäº¤ PRï¼Œç­‰å¾…å®¡æ ¸å‘å¸ƒ</li>
</ol>
<p>ç”±äºå®¡æ ¸è¾ƒæ…¢ï¼Œå¦‚æœåŒæ—¶å¤šä¸ªæ‰©å±•åšå‡ºè´¡çŒ®ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„åˆ†æ”¯å»å¤„ç†ï¼Œå¦‚ ext/extension-aã€ext/extension-bã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ¯•ä¸šå¿«ä¹ ğŸ“]]></title>
            <link>https://github.com/toFrankie/blog/issues/363</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/363</guid>
            <pubDate>Sun, 22 Jun 2025 15:54:53 GMT</pubDate>
            <description><![CDATA[<p>æœªå®Œå¾…ç»­...</p>
]]></description>
            <content:encoded><![CDATA[<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS ä¸­ displayã€opacity ã€visibility çš„åŒºåˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/362</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/362</guid>
            <pubDate>Sat, 14 Jun 2025 06:12:51 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750006164441.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç”¨ CSS ä½¿å…ƒç´ åœ¨è§†è§‰ä¸Šä¸å¯è§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæƒ³åˆ°ä»¥ä¸‹å‡ ç§å±æ€§ï¼š</p>
<ul]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750006164441.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç”¨ CSS ä½¿å…ƒç´ åœ¨è§†è§‰ä¸Šä¸å¯è§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæƒ³åˆ°ä»¥ä¸‹å‡ ç§å±æ€§ï¼š</p>
<ul>
<li><code>display: none</code></li>
<li><code>opacity: 0</code></li>
<li><code>visibility: hidden</code></li>
</ul>
<p>å°½ç®¡è¿™äº›å±æ€§éƒ½èƒ½ä½¿å…ƒç´ ä¸å¯è§ï¼Œä½†å®ƒä»¬ä¹‹é—´ä»å­˜åœ¨æ˜æ˜¾å·®å¼‚ï¼</p>
<h2>åŸºæœ¬æ¦‚å¿µ</h2>
<ul>
<li><code>display: none</code>ï¼šå…ƒç´ å®Œå…¨ä»æ–‡æ¡£æµä¸­ç§»é™¤ï¼Œä¸å æ®ä»»ä½•ç©ºé—´ï¼Œä¸å¯è§ä¸”ä¸å“åº”äº‹ä»¶ã€‚</li>
<li><code>opacity: 0</code>ï¼šå…ƒç´ åœ¨è§†è§‰ä¸Šä¸å¯è§ï¼Œä½†ä»å æ®åŸæœ‰ç©ºé—´ï¼Œå¯ä»¥å“åº”äº‹ä»¶ã€‚</li>
<li><code>visibility: hidden</code>ï¼šå…ƒç´ åœ¨è§†è§‰ä¸Šä¸å¯è§ï¼Œå æ®åŸæœ‰ç©ºé—´ï¼Œä½†ä¸å“åº”äº‹ä»¶ã€‚</li>
</ul>
<h2>ç›´è§‚å¯¹æ¯”</h2>
<h3>æ˜¯å¦å æ®å¸ƒå±€ç©ºé—´</h3>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>å æ®ç©ºé—´</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td>âŒ</td>
<td>å…ƒç´ ä»æ–‡æ¡£æµä¸­å®Œå…¨ç§»é™¤</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td>âœ…</td>
<td>å…ƒç´ ä»å æ®åŸæœ‰ä½ç½®å’Œå°ºå¯¸</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td>âœ…</td>
<td>å…ƒç´ ä»å æ®åŸæœ‰ä½ç½®å’Œå°ºå¯¸</td>
</tr>
</tbody>
</table>
<h3>æ˜¯å¦å“åº”äº‹ä»¶</h3>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>å…ƒç´ æœ¬èº«</th>
<th>å­å…ƒç´ </th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td>âŒ</td>
<td>âŒ</td>
<td>å…ƒç´ åŠå…¶åä»£å‡ä¸å“åº”äº‹ä»¶</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td>âœ…</td>
<td>âœ…</td>
<td>æ— è®ºæ˜¯å¦å¯è§ï¼Œå‡å¯å“åº”äº‹ä»¶</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td>âŒ</td>
<td>å–å†³äºå­å…ƒç´ è®¾ç½®</td>
<td>å­å…ƒç´ å¯è®¾ç½®ä¸º <code>visible</code> æ¥å“åº”äº‹ä»¶</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://codepen.io/tofrankie/pen/bNVmyby">CodePen ç¤ºä¾‹</a>ï¼ˆå…ƒç´ æœ¬èº«ï¼‰</p>
</blockquote>
<blockquote>
<p><a href="https://codepen.io/tofrankie/pen/qEOJGOV">CodePen ç¤ºä¾‹</a>ï¼ˆå­å…ƒç´ ï¼‰</p>
</blockquote>
<h3>æ˜¯å¦æ”¯æŒè¿‡æ¸¡åŠ¨ç”»</h3>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æ”¯æŒè¿‡æ¸¡åŠ¨ç”»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display</code></td>
<td>âŒ</td>
<td>æ— æ³•åœ¨ <code>none</code> å’Œ <code>block</code> ä¹‹é—´å¹³æ»‘è¿‡æ¸¡</td>
</tr>
<tr>
<td><code>opacity</code></td>
<td>âœ…</td>
<td>å¯ä»¥åœ¨ 0 ~ 1 ä¹‹é—´å¹³æ»‘è¿‡æ¸¡</td>
</tr>
<tr>
<td><code>visibility</code></td>
<td>âŒ</td>
<td>æ— æ³•åœ¨ <code>visible</code> å’Œ <code>hidden</code> ä¹‹é—´å¹³æ»‘è¿‡æ¸¡</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://codepen.io/tofrankie/pen/gbaZaOV">CodePen ç¤ºä¾‹</a></p>
</blockquote>
<h3>å¤–è®¾è®¿é—®æ€§</h3>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>å±å¹•é˜…è¯»å™¨</th>
<th>é”®ç›˜å¯¼èˆª</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td>âŒ</td>
<td>âŒ</td>
<td>å…ƒç´ å®Œå…¨ä»å¯è®¿é—®æ€§æ ‘ä¸­ç§»é™¤</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td>âœ…</td>
<td>âœ…</td>
<td>å…ƒç´ ä»å­˜åœ¨äºå¯è®¿é—®æ€§æ ‘ä¸­</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td>âœ…</td>
<td>âœ…</td>
<td>å…ƒç´ ä»å­˜åœ¨äºå¯è®¿é—®æ€§æ ‘ä¸­</td>
</tr>
</tbody>
</table>
<h2>åŸå› åˆ†æ</h2>
<p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å·®å¼‚ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æµè§ˆå™¨çš„æ¸²æŸ“æµç¨‹ã€‚</p>
<h3>é¡µé¢ç”Ÿæˆè¿‡ç¨‹</h3>
<ol>
<li>è§£æ HTML æ„å»º DOM Tree</li>
<li>è§£æ CSS æ„å»º CSSOM Tree</li>
<li>å°† DOM å’Œ CSSOM åˆå¹¶ç”Ÿæˆæ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰</li>
<li>Layout é˜¶æ®µï¼Œæ ¹æ®æ¸²æŸ“æ ‘è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®å’Œå°ºå¯¸</li>
<li>Painting é˜¶æ®µï¼Œå°†å„ä¸ªèŠ‚ç‚¹ç»˜åˆ¶åˆ°å±å¹•ä¸Š</li>
</ol>
<h3>æ¸²æŸ“æ ‘ç”Ÿæˆè¿‡ç¨‹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750002005031.png" alt=""></p>
<ol>
<li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œéå†æ¯ä¸ªå¯è§èŠ‚ç‚¹ã€‚
<ol>
<li>æŸäº›ä¸å¯è§èŠ‚ç‚¹ï¼ˆå¦‚ headã€scriptã€linkã€meta ç­‰æ ‡ç­¾ï¼‰ï¼Œå®ƒä»¬ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>ä¸€äº›ä½¿ç”¨ CSS å±æ€§éšè—ï¼ˆ<code>display: none</code>ï¼‰çš„èŠ‚ç‚¹ï¼Œä¹Ÿä¼šè¢«å¿½ç•¥ã€‚</li>
</ol>
</li>
<li>å¯¹äºæ¯ä¸ªå¯è§èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å…¶åŒ¹é…çš„ CSSOM è§„åˆ™å¹¶åº”ç”¨ã€‚</li>
<li>æœ€ç»ˆå½¢æˆå¸¦æœ‰å†…å®¹åŠè®¡ç®—æ ·å¼çš„å¯è§èŠ‚ç‚¹ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼Œè™½ç„¶ <code>display: none</code> çš„å…ƒç´ ä¸ä¼šè¿›å…¥æ¸²æŸ“æ ‘ï¼Œä½†ä»ç„¶å¯ä»¥ä½¿ç”¨ JS æ“ä½œè¯¥å…ƒç´ ã€‚åŸå› æ˜¯ JS æ“ä½œçš„æ˜¯ DOM æ ‘ï¼Œè€Œä¸æ˜¯æ¸²æŸ“æ ‘ã€‚</p>
</blockquote>
<p>å…³é”®å·®å¼‚ï¼š</p>
<ul>
<li><code>display: none</code> çš„å…ƒç´ ä¸ä¼šè¿›å…¥æ¸²æŸ“æ ‘ï¼Œå› æ­¤ä¸å‚ä¸åç»­çš„å¸ƒå±€å’Œç»˜åˆ¶</li>
<li><code>opacity: 0</code> å’Œ <code>visibility: hidden</code> çš„å…ƒç´ ä¼šè¿›å…¥æ¸²æŸ“æ ‘ï¼Œå‚ä¸å¸ƒå±€è®¡ç®—</li>
</ul>
<h3>Layout å’Œ Painting é˜¶æ®µ</h3>
<ul>
<li>Layout é˜¶æ®µï¼šè®¡ç®—å…ƒç´ çš„ç¡®åˆ‡ä½ç½®å’Œå¤§å°ï¼Œå›æµå‘ç”Ÿåœ¨æ­¤é˜¶æ®µã€‚</li>
<li>Painting é˜¶æ®µï¼šå°†å…ƒç´ è½¬æ¢ä¸ºå±å¹•åƒç´ ï¼Œé‡ç»˜å‘ç”Ÿåœ¨æ­¤é˜¶æ®µã€‚</li>
</ul>
<h3>å›æµä¸é‡ç»˜çš„å…³ç³»</h3>
<ul>
<li>æœ‰å›æµä¸€å®šä¼´éšç€é‡ç»˜</li>
<li>å‘ç”Ÿé‡ç»˜ä¸ä¸€å®šä¼´éšç€å›æµ</li>
</ul>
<h3>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¸åŒè¡¨ç°ï¼Ÿ</h3>
<p>åŸºäºæ¸²æŸ“æµç¨‹ï¼š</p>
<ol>
<li><strong><code>display: none</code> äº§ç”Ÿå›æµçš„åŸå› ï¼š</strong> å…ƒç´ ä¸è¿›å…¥æ¸²æŸ“æ ‘ï¼Œå¯¼è‡´å…¶ä»–å…ƒç´ é‡æ–°è®¡ç®—ä½ç½®å’Œå°ºå¯¸</li>
<li><strong><code>opacity: 0</code> å’Œ <code>visibility: hidden</code> ä¸äº§ç”Ÿå›æµçš„åŸå› ï¼š</strong> å…ƒç´ ä»å æ®åŸæœ‰ç©ºé—´ï¼Œä¸å½±å“å…¶ä»–å…ƒç´ çš„å¸ƒå±€</li>
</ol>
<h2>ç»§æ‰¿æ€§ä¸å­å…ƒç´ è¡¨ç°</h2>
<h3>CSS ç»§æ‰¿æ€§</h3>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æ˜¯å¦ä¸ºç»§æ‰¿å±æ€§</th>
<th>åˆå§‹å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>display</strong></td>
<td>âŒ</td>
<td><code>inline</code> æˆ– <code>block</code></td>
<td>å–å†³äºå…ƒç´ ç±»å‹</td>
</tr>
<tr>
<td><strong>opacity</strong></td>
<td>âŒ</td>
<td><code>1</code></td>
<td>å­å…ƒç´ é»˜è®¤ä¸é€æ˜</td>
</tr>
<tr>
<td><strong>visibility</strong></td>
<td>âœ…</td>
<td><code>visible</code></td>
<td>å­å…ƒç´ é»˜è®¤ç»§æ‰¿çˆ¶å…ƒç´ çš„å€¼</td>
</tr>
</tbody>
</table>
<h3>å­å…ƒç´ å¯è§æ€§åˆ†æ</h3>
<p>å½“çˆ¶å…ƒç´ è®¾ç½®ä¸åŒå±æ€§æ—¶ï¼Œå­å…ƒç´ çš„è¡¨ç°ï¼š</p>
<p>æƒ…å†µä¸€ï¼šå­å…ƒç´ ä½¿ç”¨é»˜è®¤å€¼</p>
<table>
<thead>
<tr>
<th>çˆ¶å…ƒç´ è®¾ç½®</th>
<th>å­å…ƒç´ é»˜è®¤å€¼</th>
<th>å­å…ƒç´ æœ€ç»ˆè¡¨ç°</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td><code>display: block</code></td>
<td><code>display: block</code></td>
<td>âŒ çˆ¶å…ƒç´ ä¸åœ¨æ¸²æŸ“æ ‘ä¸­ï¼Œå‡ä¸å¯è§</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td><code>opacity: 1</code></td>
<td><code>opacity: 1</code></td>
<td>âŒ å—çˆ¶å…ƒç´ å½±å“ï¼Œå‡ä¸å¯è§</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td><code>visibility: hidden</code></td>
<td><code>visibility: hidden</code></td>
<td>âŒ å—çˆ¶å…ƒç´ å½±å“ï¼Œå‡ä¸å¯è§</td>
</tr>
</tbody>
</table>
<p>æƒ…å†µäºŒï¼šå­å…ƒç´ ä¸»åŠ¨è®¾ç½®</p>
<table>
<thead>
<tr>
<th>çˆ¶å…ƒç´ è®¾ç½®</th>
<th>å­å…ƒç´ è®¾ç½®</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td><code>display: block</code></td>
<td>âŒ çˆ¶å…ƒç´ ä¸åœ¨æ¸²æŸ“æ ‘ä¸­ï¼Œå‡ä¸å¯è§</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td><code>opacity: 1</code></td>
<td>âŒ å—çˆ¶å…ƒç´ å½±å“ï¼Œå‡ä¸å¯è§</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td><code>visibility: visible</code></td>
<td>âœ… ä¸å—çˆ¶å…ƒç´ å½±å“ï¼Œçˆ¶å…ƒç´ ä¸å¯è§ï¼Œå­å…ƒç´ å¯è§</td>
</tr>
</tbody>
</table>
<blockquote>
<p>visibility çš„ç‰¹æ®Šæ€§ï¼šå­å…ƒç´ å¯ä»¥è®¾ç½®ä¸º <code>visibility: visible</code> æ¥æ‘†è„±çˆ¶å…ƒç´ çš„å½±å“ã€‚</p>
</blockquote>
<h3>å­å…ƒç´ äº‹ä»¶å“åº”åˆ†æ</h3>
<table>
<thead>
<tr>
<th>çˆ¶å…ƒç´ è®¾ç½®</th>
<th>å­å…ƒç´ è®¾ç½®</th>
<th>å­å…ƒç´ å¯è§æ€§</th>
<th>å­å…ƒç´ äº‹ä»¶å“åº”</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display: none</code></td>
<td>ä»»ä½•å€¼</td>
<td>âŒ</td>
<td>âŒ</td>
<td>çˆ¶å…ƒç´ ä¸åœ¨æ¸²æŸ“æ ‘ä¸­</td>
</tr>
<tr>
<td><code>opacity: 0</code></td>
<td>ä»»ä½•å€¼</td>
<td>âŒ</td>
<td>âœ…</td>
<td>ä»…è§†è§‰ä¸Šä¸å¯è§</td>
</tr>
<tr>
<td><code>visibility: hidden</code></td>
<td><code>visibility: visible</code></td>
<td>âœ…</td>
<td>âœ…</td>
<td>å­å…ƒç´ æ‘†è„±çˆ¶å…ƒç´ å½±å“</td>
</tr>
</tbody>
</table>
<h2>å®é™…åº”ç”¨å»ºè®®</h2>
<h3>ä½•æ—¶ä½¿ç”¨ display: none</h3>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦å®Œå…¨ç§»é™¤å…ƒç´ ï¼Œä¸å ç”¨ä»»ä½•ç©ºé—´</li>
<li>å…ƒç´ åŠå…¶åä»£éƒ½ä¸éœ€è¦å“åº”äº‹ä»¶</li>
<li>ä¸éœ€è¦è€ƒè™‘å¯è®¿é—®æ€§</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ä¼šäº§ç”Ÿå›æµï¼Œå½±å“æ€§èƒ½</li>
<li>æ— æ³•é€šè¿‡è¿‡æ¸¡åŠ¨ç”»å®ç°å¹³æ»‘æ•ˆæœ</li>
</ul>
<h3>ä½•æ—¶ä½¿ç”¨ opacity: 0</h3>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦å¹³æ»‘çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœ</li>
<li>å…ƒç´ éœ€è¦å“åº”äº‹ä»¶ï¼ˆå¦‚æ‚¬åœæ•ˆæœï¼‰</li>
<li>éœ€è¦ä¿æŒå¸ƒå±€ç¨³å®š</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>å…ƒç´ ä»å æ®ç©ºé—´</li>
<li>å­å…ƒç´ ä¹Ÿä¼šä¸å¯è§</li>
</ul>
<h3>ä½•æ—¶ä½¿ç”¨ visibility: hidden</h3>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦ä¿æŒå¸ƒå±€ç¨³å®š</li>
<li>å­å…ƒç´ éœ€è¦å¯è§æˆ–å“åº”äº‹ä»¶</li>
<li>éœ€è¦è‰¯å¥½çš„å¯è®¿é—®æ€§æ”¯æŒ</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>å…ƒç´ ä»å æ®ç©ºé—´</li>
<li>ä¸æ”¯æŒè¿‡æ¸¡åŠ¨ç”»</li>
<li>å­å…ƒç´ å¯ä»¥é€šè¿‡è®¾ç½® <code>visibility: visible</code> æ¥æ‘†è„±å½±å“</li>
</ul>
<h3>é€‰æ‹©æŒ‡å—æ€»ç»“</h3>
<table>
<thead>
<tr>
<th>éœ€æ±‚</th>
<th>æ¨èå±æ€§</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody>
<tr>
<td>å®Œå…¨éšè—å…ƒç´ ï¼Œä¸å ç©ºé—´</td>
<td><code>display: none</code></td>
<td>å…ƒç´ ä¸è¿›å…¥æ¸²æŸ“æ ‘ï¼Œä¸å‚ä¸å¸ƒå±€è®¡ç®—</td>
</tr>
<tr>
<td>å¹³æ»‘çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœ</td>
<td><code>opacity: 0</code></td>
<td>æ”¯æŒè¿‡æ¸¡åŠ¨ç”»</td>
</tr>
<tr>
<td>ä¿æŒå¸ƒå±€ï¼Œå­å…ƒç´ å¯è§</td>
<td><code>visibility: hidden</code></td>
<td>å­å…ƒç´ å¯è®¾ç½®ä¸º <code>visible</code></td>
</tr>
<tr>
<td>éšè—ä½†ä¿æŒäº‹ä»¶å“åº”</td>
<td><code>opacity: 0</code></td>
<td>å…ƒç´ ä»å­˜åœ¨äº DOM ä¸­</td>
</tr>
<tr>
<td>æ€§èƒ½ä¼˜å…ˆï¼Œé¿å…å›æµ</td>
<td><code>opacity: 0</code> æˆ– <code>visibility: hidden</code></td>
<td>ä¸äº§ç”Ÿå›æµ</td>
</tr>
</tbody>
</table>
<h2>æ€»ç»“</h2>
<p>å¯¹æ¯”ä¹‹ä¸‹ï¼š</p>
<ol>
<li><strong><code>display: none</code></strong> é€‚åˆå®Œå…¨ç§»é™¤å…ƒç´ çš„åœºæ™¯ï¼Œä½†ä¼šäº§ç”Ÿå›æµ</li>
<li><strong><code>opacity: 0</code></strong> é€‚åˆéœ€è¦å¹³æ»‘åŠ¨ç”»å’Œäº‹ä»¶å“åº”çš„åœºæ™¯</li>
<li><strong><code>visibility: hidden</code></strong> é€‚åˆéœ€è¦ä¿æŒå¸ƒå±€å’Œçµæ´»æ§åˆ¶å­å…ƒç´ çš„åœºæ™¯</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç”Ÿæ—¥å¿«ä¹]]></title>
            <link>https://github.com/toFrankie/blog/issues/361</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/361</guid>
            <pubDate>Fri, 13 Jun 2025 15:58:30 GMT</pubDate>
            <description><![CDATA[<p>å¬è¯´ï¼Œå°åª›åŒå­¦ä»Šå¹´æœ‰ä¸‰ä¸ªç”Ÿæ—¥ã€‚</p>
<p>ä»Šå¤©æ˜¯ç¬¬ä¸€ä¸ªï¼Œç”Ÿæ—¥å¿«ä¹å‘€~ ğŸ‚</p>
<p>å¦å¤–ï¼Œå‘ç°äº†ä¸€ä¸ªæ¬¾å¼éå¸¸éå¸¸å¥½çœ‹çš„è›‹ç³•ï¼ˆæ©™è·¯è›‹ç³•ï¼‰ğŸ‘‡</p>
<blockquote>
<p>ã€å†°å²›å°å±‹ã€‘ä¸–äººçš†å­¤å²›ï¼Œå‡­çˆ±æ„ä¸°é¥¶</p>
</blockquote>
<p><img src="https://githu]]></description>
            <content:encoded><![CDATA[<p>å¬è¯´ï¼Œå°åª›åŒå­¦ä»Šå¹´æœ‰ä¸‰ä¸ªç”Ÿæ—¥ã€‚</p>
<p>ä»Šå¤©æ˜¯ç¬¬ä¸€ä¸ªï¼Œç”Ÿæ—¥å¿«ä¹å‘€~ ğŸ‚</p>
<p>å¦å¤–ï¼Œå‘ç°äº†ä¸€ä¸ªæ¬¾å¼éå¸¸éå¸¸å¥½çœ‹çš„è›‹ç³•ï¼ˆæ©™è·¯è›‹ç³•ï¼‰ğŸ‘‡</p>
<blockquote>
<p>ã€å†°å²›å°å±‹ã€‘ä¸–äººçš†å­¤å²›ï¼Œå‡­çˆ±æ„ä¸°é¥¶</p>
</blockquote>
<p><img src="https://github.com/user-attachments/assets/fbfea94f-9e63-4c89-9511-d633e4999832" alt=""></p>
<h2>07.06</h2>
<p>ä»Šå¤©æ˜¯è·Ÿå°åª›åŒå­¦è¿‡çš„ç¬¬äºŒä¸ªç”Ÿæ—¥ï¼Œè¿˜æœ‰å¼Ÿå¼Ÿã€å¦¹å¦¹ä¸€èµ·ï¼Œé€›é€›åƒåƒ...</p>
<blockquote>
<p>è¿˜æœ‰å‡¯çªå°æœ‹å‹å¾ˆå¸…å“¦</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Folo Verification]]></title>
            <link>https://github.com/toFrankie/blog/issues/360</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/360</guid>
            <pubDate>Fri, 06 Jun 2025 16:57:49 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1749232666730.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½¿ç”¨ <a href="https://docs.rsshub.app/rou]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1749232666730.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½¿ç”¨ <a href="https://docs.rsshub.app/routes/programming#repo-issues">RSSHub</a> å¯ä»¥ä¸º GitHub Issues å¿«é€Ÿåˆ›å»ºè®¢é˜…æºã€‚</p>
<pre><code>/github/issue/:user/:repo/:state?/:labels?
</code></pre>
<p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹è®¤è¯ä¿¡æ¯çš„ Issueï¼ˆå³é”®è®¤è¯å¤„å¯å¤åˆ¶ï¼‰ï¼Œç”¨äºè¯æ˜ä½ æ˜¯æ­¤è®¢é˜…æºçš„æ‰€æœ‰è€…ã€‚</p>
<blockquote>
<p>This message is used to verify that this feed (feedId:154574662305076224) belongs to me (userId:150343881723676672). Join me in enjoying the next generation information browser <a href="https://follow.is">https://follow.is</a>.</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å°ç¨‹åºå¼€å‘è®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/359</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/359</guid>
            <pubDate>Wed, 14 May 2025 03:45:14 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1747194248182.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ä¼—æ‰€å‘¨çŸ¥ï¼Œå¾®ä¿¡çš„æ–‡æ¡£å†™å¾—å¾ˆçƒ‚...<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1747194248182.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ä¼—æ‰€å‘¨çŸ¥ï¼Œå¾®ä¿¡çš„æ–‡æ¡£å†™å¾—å¾ˆçƒ‚...</p>
</blockquote>
<h2>å…³äºè·³è½¬è·¯å¾„</h2>
<p>è€æ˜¯å¿˜è®°è·¯å¾„æ˜¯å¦éœ€è¦å‰å¯¼ <code>/</code>ï¼Œä½œä¸ªè®°å½•å§ã€‚ğŸ˜‘</p>
<ul>
<li><code>page/index/index</code></li>
<li><code>/page/index/index</code></li>
</ul>
<p>åœºæ™¯ï¼š</p>
<ul>
<li><strong>å°ç¨‹åºå†…çš„é¡µé¢è·³è½¬</strong>ï¼šwx.navigateTo è¿™ç±» API çš„ <code>url</code> å‚æ•°ã€Œ<strong>å¿…é¡»</strong>ã€è¦æœ‰å‰å¯¼ <code>/</code>ã€‚</li>
<li><strong>å°ç¨‹åºä¹‹é—´è·³è½¬</strong>ï¼šwx.navigateToMiniProgram çš„ <code>path</code> å‚æ•°å‰å¯¼ <code>/</code> æ˜¯ã€Œ<strong>å¯é€‰</strong>ã€çš„ã€‚</li>
<li><strong>åˆ†äº«/è½¬å‘</strong>ï¼šonShareAppMessage çš„ <code>path</code> å‚æ•°ã€Œ<strong>å¿…é¡»</strong>ã€è¦æœ‰å‰å¯¼ <code>/</code>ã€‚</li>
<li><strong>è®¢é˜…æ¶ˆæ¯</strong>ï¼šè®¢é˜…æ¶ˆæ¯çš„ <code>page</code> å‚æ•°å‰å¯¼ <code>/</code> æ˜¯ã€Œ<strong>å¯é€‰</strong>ã€çš„ï¼ˆäº²æµ‹å‡å¯æ­£å¸¸è·³è½¬ï¼‰ã€‚</li>
</ul>
<p>ç»“è®ºï¼š<strong>å»ºè®®</strong>éƒ½å¸¦ä¸Šå‰å¯¼ <code>/</code>ï¼ˆå¯ä»¥å°‘ç”¨ç‚¹è„‘å­ï¼‰ã€‚</p>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html">è·¯ç”±</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object">onShareAppMessage</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-message-management/subscribe-message/sendMessage.html">å‘é€è®¢é˜…æ¶ˆæ¯</a></li>
<li><a href="https://doc.minapp.com/cloud-function/node-sdk/subscribe-message/wechat/subscribe-message.html">çŸ¥æ™“äº‘å‘é€å¾®ä¿¡è®¢é˜…æ¶ˆæ¯</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è®°äº”æœˆï¼šæ±•å¤´ - æ½®å·ä¸¤æ—¥]]></title>
            <link>https://github.com/toFrankie/blog/issues/358</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/358</guid>
            <pubDate>Wed, 07 May 2025 01:19:40 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1746580753549.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>æå‰æ”»ç•¥</h2>
<p>å‡æœŸä¸å¯é¿å…çš„ï¼Œä¸€æ˜¯äººä»ä¼—ï¼ŒäºŒæ˜¯è½¦ç¥¨éš¾æŠ¢ ğŸ˜¶</]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1746580753549.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>æå‰æ”»ç•¥</h2>
<p>å‡æœŸä¸å¯é¿å…çš„ï¼Œä¸€æ˜¯äººä»ä¼—ï¼ŒäºŒæ˜¯è½¦ç¥¨éš¾æŠ¢ ğŸ˜¶</p>
<p>ç”±äºå¹³æ—¶æ²¡æœ‰é•¿å‡æœŸï¼Œäºæ˜¯å†³å®šä½“éªŒä¸€ç•ªäººæŒ¤äººå§ã€‚</p>
<p>æ¸…æ˜è¿‡åï¼Œå°±å¼€å§‹æ‰“ç®—äº”ä¸€è®¡åˆ’äº†ï¼Œå¥ˆä½•æ—¶é—´è¿‡å¾—å¤ªå¿«å¤ªå¿«äº†...</p>
<p>æ¥åˆ°å‡æœŸå‰ä¸¤å‘¨ï¼Œå¥½åƒå¹¿ä¸œæˆ–å‘¨è¾¹éƒ½æ˜¾ç¤ºäº”ä¸€è¦ä¸‹é›¨ ğŸŒ§</p>
<p>ç²—ç•¥æ‰«äº†ä¸€éè´µå·ã€ç¦å»ºã€ä¸¤æ¹–ï¼Œç”±äºé«˜é“ ğŸš„ ä¹°ä¸ç€ï¼Œé£æœº âœˆï¸ åè´µï¼Œä¸”è¦å¾€è¿”ï¼ŒåŠ ä¹‹å¤©æ°”ä¹Ÿæ²¡ç‰¹åˆ«å¥½ï¼Œå°±æ”¾å¼ƒå®ƒä»¬äº†ã€‚</p>
<p>åˆçœ‹äº†ä¸€å‘¨ï¼Œä¸€ç•ªçº ç»“ä¸‹åŸºæœ¬é”å®šäº†ï¼š</p>
<ul>
<li><strong>ç æµ·</strong>ï¼šä¼¶ä»ƒå²›ã€æƒ…äººè·¯ã€æ—¥æœˆè´ã€æµ·æ»©ã€é•¿éš†ã€‚</li>
<li><strong>æ½®æ±•</strong>ï¼šä¸€ä¸ªå­—â€œåƒâ€ï¼Œè¿˜æœ‰å—æ¾³å²›ã€‚</li>
</ul>
<p>å®ƒä»¬ç¦»å¹¿å·ä¸ç®—å¤ªè¿œï¼Œç© 2 ~ 3 å¤©è¶³çŸ£ã€‚è¿™æ ·ä¾¿å¯ä»¥åœ¨å¹¿å·ä¼‘æ¯ä¸€å¤©ï¼ŒåŒæ—¶é¿å¼€å‡æœŸç¬¬ä¸€å¤©é«˜å³°ã€‚æ°å¥½ 5 æœˆ 2 æ—¥é«˜é“ä¹Ÿè¿˜æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå…œåº•è¿˜æœ‰å¤§å·´ã€æ‰“è½¦ç­‰é€‰æ‹©ï¼Œå›ç¨‹ä¹Ÿæ˜¯ã€‚</p>
<h2>å‡ºå‘ä¹‹å‰</h2>
<p>å‡æœŸç¬¬ä¸€å¤©ï¼Œå»åƒäº†é¡¿ä¹³é¸½ï¼ˆç™¾åˆ©é¸½ç‹èšé¾™åº—ï¼‰ï¼Œè¿™å®¶åº—æ˜¯å°åª›åŒå­¦å¼ºçƒˆæ¨èã€‚åƒå®Œï¼Œæˆ‘çš„è¯„ä»·æ˜¯ï¼š</p>
<blockquote>
<p>æ²¡æœ‰æƒ³è±¡å¥½åƒï¼Œä¸å¦‚å¤§é¸½é¥­ï¼ˆä½“è‚²è¥¿åº—ï¼‰ã€‚ç›ç„—ä¹³é¸½ç•¥å’¸~</p>
</blockquote>
<blockquote>
<p>åƒå®Œç¦»å¼€è¿˜è½ä¸‹äº†é»„çš®å†°èŒ¶ï¼ˆå¥½å–ï¼‰ï¼Œå¯æƒœï¼Œæµªè´¹äº† ğŸ˜­</p>
</blockquote>
<p>ä¸€é¡¿æ”¶æ‹¾ï¼Œå‡†å¤‡äº†ä¸€äº›ä¸œè¥¿ï¼š</p>
<ul>
<li><strong>è¯ä»¶ç±»</strong>ï¼šèº«ä»½è¯ã€å­¦ç”Ÿè¯</li>
<li><strong>æ´—æŠ¤ç±»</strong>ï¼šæ¯›å·¾ã€ç‰™åˆ·ã€é˜²æ™’ã€æ´é¢ã€æŠ¤å‘ã€æŠ¤è‚¤ç­‰åŒ–å¦†ç‰©å“ ğŸ’…</li>
<li><strong>è¡£ç‰©ç±»</strong>ï¼šé‚£äº›å¥½çœ‹è¡£æœï¼Œæ¢æ´—è¢œå­ ğŸ§¦ ç­‰</li>
<li><strong>è¯å“ç±»</strong>ï¼šæ„Ÿå†’ã€å‘çƒ§ã€è‚ èƒƒã€åˆ›å¯è´´ ğŸ©¹ ç­‰åŸºç¡€è¯å“ï¼Œä»¥é˜²ä¸‡ä¸€</li>
<li><strong>å…¶ä»–</strong>ï¼šä¼ã€å……ç”µå®ã€å°‘é‡ç°é‡‘ ğŸ’µ ç­‰</li>
</ul>
<blockquote>
<p>å¯¹äº†ï¼Œæˆ‘ä¸æ˜¯å­¦ç”Ÿäº†ï¼Œå¦‚æœä½ å‡ºè¡Œï¼Œå¯ä»¥å¸¦ä¸Šå“¦~</p>
</blockquote>
<p>è¡Œç¨‹å®‰æ’ï¼š</p>
<ul>
<li>Day1 æ±•å¤´</li>
<li>Day2 æ½®å·</li>
<li>Day3 å›å¹¿</li>
</ul>
<p>å‡ºå‘äº†...</p>
<h2>Day1</h2>
<p>æ¬¡æ—¥ï¼Œæ—©æ—©èµ·æ¥èµ¶é«˜é“ï¼šæ–°å¡˜ç«™ â†’ æ±•å¤´ç«™ï¼Œæ—¶é•¿ 3h 17minï¼Œç•¥é•¿~</p>
<blockquote>
<p>å‡ºå‘å‰çš„æ”»ç•¥è·¯çº¿æ˜¯ï¼šæ±•å¤´å°å…¬å›­ â†’ æ±•å¤´æ—…ç¤¾ â†’ è¥¿å ¤å…¬å›­ â†’ å¹¿åœºè½®æ¸¡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åˆ°è¾¾æ±•å¤´å·²ç»æ˜¯ä¸‹åˆ 1 ç‚¹äº†ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‰è¿™ä¸ªè·¯çº¿å»é€›ï¼Œæ¥æ±•å¤´ä¸»è¦ä»»åŠ¡æ˜¯â€œåƒâ€ï¼Œä¹Ÿå°±æ²¡æœ‰å¤ªå¤§å…³ç³»äº†ï¼Œä¹Ÿæ·±çŸ¥è¿™äº›æ™¯ç‚¹éƒ½æ˜¯åƒç¯‡ä¸€å¾‹ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æå‰è®¢äº†é è¿‘æ±•å¤´ç«™çš„ä¸€ä¸ªå…¬å¯“ï¼Œç¯å¢ƒå¾ˆä¸€èˆ¬...</p>
<p>åŠç†å…¥ä½ï¼Œæ”¾ä¸‹è¡Œæï¼Œé©¬ä¸Šèµ¶å¾€æ±•å¤´å°å…¬å›­ï¼Œè‚šå­ä¹Ÿæœ‰ç‚¹å°é¥¿äº†...</p>
<p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯åƒåƒåƒ...</p>
<blockquote>
<p>æˆ‘æ˜¯æå…¶æŒ‘åƒçš„ï¼Œå°åª›åŒå­¦åˆ™ç›¸åï¼Œé™¤äº†èŒ¼è’¿éƒ½å¯ä»¥çˆ±åƒã€‚åœ¨è¿™æ–¹é¢æ€»æ˜¯ä½ è¿å°±æˆ‘ï¼Œå¤ªå§”å±ˆä½ äº†ã€‚</p>
</blockquote>
<p>æ²¡æœ‰ç‰¹åˆ«è¯´éè¦åƒå“ªå®¶ç½‘çº¢åº—ã€å¿…æ‰“å¡ä¹‹ç±»çš„ï¼Œå°±æ²¿é€”é‡åˆ°çˆ±åƒã€æƒ³è¯•çš„å°±å°å°ã€‚</p>
<ul>
<li>é»„çš®æŸ æª¬èŒ¶ï¼ˆåå­—å¿˜äº†ï¼‰ï¼šæ²¡æœ‰å¹¿å·èŒ¶æ•‘æ˜Ÿçƒçš„é»„çš®å†°èŒ¶å¥½å–ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŸ æª¬å‘³...</li>
<li>ç¢—ç¿…ï¼šå°åª›çˆ±åƒï¼Œæˆ‘å˜›å–äº†ä¸€å£æ±¤å°±åƒä¸ä¸‹å»äº†...</li>
<li>ç»¿è±†é¥¼ï¼šä¸­è§„ä¸­çŸ©</li>
<li>å†°ç³–è‰è“ï¼šğŸ“ é¢—ç²’å¤§ï¼Œåˆ’ç®—~</li>
<li>è…ä¹³é¸¡ç¿…ï¼šå°åª›åŒå­¦å¼ºçƒˆæ¨èï¼Œå°±æ˜¯å¯èƒ½åƒå¤šäº†å®¹æ˜“ä¸Šç«</li>
<li>åæ²™èŠ‹å¤´ï¼šæˆ‘åªèƒ½è¯´â€œåæ²™ xxxâ€éƒ½ä¸å»ºè®®ä¹°...</li>
<li>ç»¿è±†è²å­ï¼šå™¢ï¼Œè¿™ç³–æ°´å¥½å–</li>
<li>ä¸‰å§å¦¹è‚ ç²‰ï¼šæ’é•¿é¾™ï¼Œä»½é‡è¶³ï¼Œä»·æ ¼ä¾¿å®œï¼ˆç›¸æ¯”å¹¿å·æ¥è¯´ï¼Œä¸æ¸…æ¥šå½“åœ°ç‰©ä»·ï¼‰ã€‚æˆ‘çš„è¯„ä»·æ˜¯ï¼šä¸å¤ªå¥½åƒã€‚</li>
<li>ç”˜è‰æ°´æœï¼šæ»¡è¡—éƒ½æ˜¯ï¼Œæ°´æœåˆºå®¢ï¼Œä¸å¥½åƒ</li>
<li>ç™¼ç™¼ç‰›ç‰›è‚‰ç«é”…ï¼šä»·æ ¼å®æƒ ã€å¥½åƒï¼Œæ¨è~ï¼ˆä¸»è¦è·Ÿæ½®å·é˜¿å½¬ç‰›è‚‰ç«é”…å¯¹æ¯”å¾—å‡ºçš„ç»“è®ºï¼‰</li>
</ul>
<h2>Day2</h2>
<p>ç¬¬ä¸‰å¤©ï¼Œé«˜é“ï¼šæ±•å¤´ç«™ â†’ æ½®æ±•ç«™ï¼Œæ—¶é•¿ 23minã€‚</p>
<p>åˆ°è¾¾æ½®å·ï¼Œé«˜é“ç«™å°±æœ‰å¤åŸä¸“çº¿å¤§å·´åˆ°è¾¾å¤åŸï¼Œåœ¨å—æ¡¥å¸‚åœºç«™ä¸‹è½¦ã€‚</p>
<p>ä¸‹è½¦ç‚¹åˆ°ä½å®¿ç‚¹ï¼Œæœ‰å‡ ç™¾ç±³è·ç¦»ï¼Œå› ä¸ºæœ‰ç‚¹çƒ­ï¼ŒåŠ ä¸Šè¡Œæç®±ææ‰‹æ–­äº†ï¼Œæ„Ÿè§‰å¥½è¿œå¥½è¿œã€‚</p>
<p>åœ¨ç¾å›¢ä¸Šè®¢äº†ã€Œæ„è¾¾é›…å±…ã€ï¼Œå°±åœ¨æ½®å·äºŒå­—æ‰“å¡ç‚¹å¯¹é¢ï¼Œè·ç¦»å¹¿æµæ¡¥å¾ˆè¿‘ï¼Œçº¦ 3 ~ 5min çš„è·ç¦»ã€‚</p>
<blockquote>
<p>ç”±äºäº”ä¸€å‡æœŸçš„åŸå› ï¼Œå„å¤§å¹³å°ï¼Œä½å®¿åŸºæœ¬ç¿»å€ï¼Œä½†å‚è€ƒæ±•å¤´ç«™çš„ä½å®¿æ¡ä»¶ï¼Œè¿™ä¸ªçœŸçš„å¾ˆå¥½å¾ˆå¥½äº†ï¼Œæˆ¿é—´å¾ˆå¹²å‡€ï¼Œéš”éŸ³ä¸é”™å¾ˆå®‰é™ã€‚å¤åŸå•†é“ºä¼šæ‰“çƒŠï¼Œæ‰€ä»¥ä¸ç”¨å¤ªæ‹…å¿ƒä¼šåµã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åˆ°è¾¾æ—¶ï¼Œç”±äºæˆ¿é—´è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå¯„å­˜è¡Œæåï¼Œæˆ‘ä»¬å‡ºå»é€›äº†é€›ï¼Œåœ¨æˆå·èŒ¶åº—ç‚¹äº†æ¯æ˜¥æ±Ÿæ°´æš–ï¼ˆæ²¡å•¥ç‰¹åˆ«ï¼Œä¹Ÿä¸ç®—å¥½å–ï¼‰ï¼Œä¹°äº†ä¸€é¡¶å¸½å­ã€‚å°±è¿‘åœ¨ã€Œé˜¿å½¬ç«é”…åº—ã€åƒäº†ä¸€é¡¿ç‰›è‚‰ç«é”…ï¼Œé¥­ååƒæ„Ÿæ˜¯è´µä¸”æ²¡é‚£ä¹ˆå¥½åƒï¼ˆå¯¹æ¯”æ±•å¤´çš„ç™¼ç™¼ç‰›ç‰›è‚‰ç«é”…ï¼‰ã€‚</p>
<p>åŠç†å…¥ä½...</p>
<p>æ½®å·çš„æ™¯ç‚¹è¾ƒä¸ºé›†ä¸­ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1751816662395.png" alt=""></p>
<p>â–² å›¾ç‰‡æºè‡ª<a href="https://www.xiaohongshu.com/discovery/item/67ac47ca000000001701e41b?source=webshare&amp;xhsshare=pc_web&amp;xsec_token=ABmU5F0z6M5xcP3GKtL_znhwOIgoW9CVgNG3xboNspOgE=&amp;xsec_source=pc_share">å°çº¢ä¹¦</a></p>
<h3>å¹¿æµæ¡¥</h3>
<p>å‡†å¤‡å‰å¾€å¹¿æµæ¡¥ï¼Œç¡®å®å¾ˆè¿‘ï¼Œä½†å¤åŸåˆ°å¤„éƒ½æ˜¯äººä»ä¼—...</p>
<p>åœ¨å¤åŸåŸæ¥¼ä¸€é¡¿æ‹ï¼Œç„¶åè¿‡é©¬è·¯å»å¹¿æµæ¡¥ï¼Œæ²¡æƒ³åˆ°è¦æ’é˜Ÿä¸Šæ¡¥ï¼ˆäººä¹Ÿå¾ˆå¤šï¼‰ï¼Œåœ¨æ¹–è¾¹çœ‹è¿‡å»ï¼Œå¥½åƒæ²¡æœ‰å¾ˆå¤§çš„æ¬²æœ›ä¸Šæ¡¥ï¼Œå°±è‰è‰ç¦»å¼€äº†ã€‚</p>
<blockquote>
<p>ä¸»è¦æ˜¯å¤©æ°”ä¸å¤ªå¥½ã€‚</p>
</blockquote>
<h3>æ½®å·è¥¿æ¹–</h3>
<p>åæ¥ï¼Œå«äº†ä¸ªæ‘©æ‰˜è½¦å‰å¾€æ¹–å·è¥¿æ¹–ï¼ˆå¯ä»¥è®²ä¸ªä»·ï¼Œå¸æœºå¾ˆå¤šï¼Œé€‰æ‹©å¾ˆå¤šï¼Œæœ€åæ‰¾äº†ä¸ª 18R çš„æˆäº¤ï¼‰ã€‚</p>
<blockquote>
<p>å¸æœºå¤§å”äººæŒºå¥½ï¼Œè·¯ä¸Šè¿˜ä¸å¿˜ç»™æˆ‘ä»¬åšä»‹ç»ï¼ŒæŠŠäº”ä¸€å‡æœŸä¸€å¤©æ‹‰äº†å¤šå°‘å®¢éƒ½å’Œç›˜æ‰˜å‡ºï¼Œå“ˆå“ˆã€‚</p>
</blockquote>
<p>åˆ°è¾¾åï¼Œåœ¨æ¹–é‡Œåˆ’èˆ¹ ğŸš£ğŸ»ï¼Œåˆ’ 30minï¼Œæ‰‹åŠ¨æŒ¡ï¼ˆè„šè¸ç‰ˆæœ¬ï¼Œå“ˆå“ˆï¼‰ï¼Œèˆ¹ä¸å¤ªå¥½æ§åˆ¶æ–¹å‘ï¼Œæœ‰ç‚¹è€æ—§å§ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Jira ä½¿ç”¨è®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/357</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/357</guid>
            <pubDate>Wed, 30 Apr 2025 08:58:47 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1746003443752.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿‡æ»¤å™¨ï¼ˆç­›é€‰å™¨ï¼‰æ˜¯ Jira æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°å¾ˆå¤šçš„éœ€æ±‚ã€‚</p>]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1746003443752.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿‡æ»¤å™¨ï¼ˆç­›é€‰å™¨ï¼‰æ˜¯ Jira æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°å¾ˆå¤šçš„éœ€æ±‚ã€‚</p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>ä½œä¸€äº›ç®€å•çš„äº†è§£ã€‚</p>
<blockquote>
<p>JQLï¼šJira Query Language</p>
</blockquote>
<h3>JQL Functions</h3>
<p>ä¸€äº›åŸºæœ¬å‡½æ•°ï¼Œæ›´å¤šè¯·çœ‹<a href="https://support.atlassian.com/jira-service-management-cloud/docs/jql-functions/">è¿™é‡Œ</a>ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">å‡½æ•°</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">currentUser()</td>
<td style="text-align:left">å½“å‰ç™»å½•ç”¨æˆ·</td>
</tr>
<tr>
<td style="text-align:left">startOfWeek()</td>
<td style="text-align:left">æœ¬å‘¨å¼€å§‹</td>
</tr>
<tr>
<td style="text-align:left">endOfWeek()</td>
<td style="text-align:left">æœ¬å‘¨ç»“æŸ</td>
</tr>
<tr>
<td style="text-align:left">startOfMonth()</td>
<td style="text-align:left">æœ¬æœˆå¼€å§‹</td>
</tr>
<tr>
<td style="text-align:left">endOfMonth()</td>
<td style="text-align:left">æœ¬æœˆç»“æŸ</td>
</tr>
<tr>
<td style="text-align:left">...</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3>JQL Keywords</h3>
<p>åˆ©ç”¨ ANDã€ORã€NOT ç­‰å°†å¤šä¸ªæ¡ä»¶è¿æ¥åœ¨ä¸€èµ·ï¼Œå®ç°æ›´å¤šå¤æ‚çš„æŸ¥è¯¢ï¼Œæ›´å¤šè¯·çœ‹<a href="https://support.atlassian.com/jira-service-management-cloud/docs/jql-keywords/">è¿™é‡Œ</a>ã€‚</p>
<h2>æŸ¥è¯¢</h2>
<p>åˆ©ç”¨å‡½æ•°å¯ä»¥å¿«é€Ÿåšä¸€äº›ç­›é€‰ã€‚</p>
<p>æœ¬å‘¨å·¥ä½œï¼š</p>
<pre><code>worklogAuthor = currentUser() AND worklogDate &gt;= startOfWeek() AND worklogDate &lt; endOfWeek()
</code></pre>
<p>æœ¬æœˆå·¥ä½œï¼š</p>
<pre><code>worklogAuthor = currentUser() AND worklogDate &gt;= startOfMonth() AND worklogDate &lt; endOfMonth()
</code></pre>
<p>æŒ‡å®šæ—¶é—´èŒƒå›´ï¼š</p>
<pre><code>worklogAuthor = currentUser() AND worklogDate &gt;= &quot;2025/04/21&quot; AND worklogDate &lt;= &quot;2025/04/25&quot;
</code></pre>
<h2>å‘¨æŠ¥/æœˆæŠ¥</h2>
<p><strong>è¯·æ³¨æ„ï¼Œå‡½æ•°æ˜¯åŠ¨æ€çš„</strong>ã€‚</p>
<p>å¦‚æœå°†ä¸Šè¿°æŸ¥è¯¢æ¡ä»¶ç›´æ¥åº”ç”¨åœ¨æ±‡æŠ¥é‡Œé¢æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<ol>
<li><code>worklogAuthor = currentUser()</code> è°ç™»å½•äº†å°±æ˜¯è°çš„ã€‚</li>
<li><code>startOfWeek()</code> æ˜¯åŠ¨æ€çš„ï¼Œå¦‚æœè¿™å‘¨è®¿é—®äº†ä¸Šå‘¨çš„å‘¨æŠ¥ï¼Œä¼šæ˜¾ç¤ºè¿™å‘¨çš„å†…å®¹ã€‚</li>
</ol>
<p>ä½ æƒ³ä¸€ä¸‹ï¼Œå¦‚æœé¢†å¯¼è®¿é—®ä½ çš„å‘¨æŠ¥ï¼Œä½†ä»–çœ‹åˆ°äº†è‡ªå·±æœ¬å‘¨çš„ä»»åŠ¡ï¼ŒæƒŠå‘†äº†ï¼ğŸ˜²</p>
<p>æˆ‘æ˜¯è¿™æ ·åšçš„ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<ol>
<li>æŒ‡å®šæ—¶é—´èŒƒå›´</li>
<li>è·Ÿæˆ‘æœ‰å…³çš„
<ul>
<li>æœ‰è®°å½•å·¥æ—¶çš„ä»»åŠ¡</li>
<li>æŒ‡æ´¾ç»™æˆ‘ï¼Œä½†æœªè®°å½•å·¥æ—¶ã€‚æ¯”å¦‚åƒ WON'T FIX çš„ä»»åŠ¡</li>
</ul>
</li>
</ol>
<p>ç»„åˆæŸ¥è¯¢å¦‚ä¸‹ï¼š</p>
<pre><code>(worklogAuthor = &quot;frankie&quot; AND worklogDate &gt;= &quot;2025/04/21&quot; AND worklogDate &lt;= &quot;2025/04/25&quot;)
OR
(assignee = &quot;frankie&quot; AND worklogAuthor is EMPTY AND created &gt;= &quot;2025/04/21&quot; AND created &lt;= &quot;2025/04/25&quot;)
</code></pre>
<p>ä¹Ÿå¯ä»¥åœ¨ <code>.zshrc</code> ä¸­æ”¾å…¥è¿™ä¸ªå°è„šæœ¬è‡ªåŠ¨ç”Ÿæˆã€‚</p>
<pre><code class="language-shell">function genReportJQL() {
  local username=&quot;your_jira_username&quot; # TODO: ä½ çš„ç”¨æˆ·å
  local mode=${1:-weekly} # é»˜è®¤ weekly

  local start end

  if [[ &quot;$mode&quot; == &quot;monthly&quot; ]]; then
    start=$(date '+%Y/%m/01')
    end=$(date -v+1m -v1d -v-1d '+%Y/%m/%d')
  else
    local dow=$(date +%u)
    start=$(date -v -&quot;$(($dow - 1))&quot;d '+%Y/%m/%d')
    end=$(date -v +&quot;$((5 - $dow))&quot;d '+%Y/%m/%d')
  fi

  local jql=&quot;(worklogAuthor = \&quot;$username\&quot; AND worklogDate &gt;= \&quot;$start\&quot; AND worklogDate &lt;= \&quot;$end\&quot;) OR (assignee = \&quot;$username\&quot; AND worklogAuthor is EMPTY AND created &gt;= \&quot;$start\&quot; AND created &lt;= \&quot;$end\&quot;)&quot;

  printf &quot;%s&quot; &quot;$jql&quot; | pbcopy
  echo &quot;$jql&quot;
  echo &quot;âœ… Copied to clipboard&quot;
}
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://support.atlassian.com/jira-service-management-cloud/docs/use-advanced-search-with-jira-query-language-jql/">Use advanced search with Jira Query Language (JQL)</a></li>
<li><a href="https://support.atlassian.com/jira-service-management-cloud/docs/jql-operators/">JQL operators</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸é£Ÿç‰©çš„æœ‰é™äº¤é›†]]></title>
            <link>https://github.com/toFrankie/blog/issues/356</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/356</guid>
            <pubDate>Tue, 08 Apr 2025 15:47:08 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1744127669713.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ğŸ“ <strong>åæ ‡å¹¿å·</strong></p>
<p>è®°å½•ä¸€äº›åƒè¿‡çš„]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1744127669713.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ğŸ“ <strong>åæ ‡å¹¿å·</strong></p>
<p>è®°å½•ä¸€äº›åƒè¿‡çš„åº—ï½</p>
<p>å¯¹åƒçš„æ²¡æœ‰ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œå±äºã€Œå¾ˆæŒ‘ä¹Ÿä¸æŒ‘ã€çš„é‚£ç§ç±»å‹ ğŸ¤·â€â™€ï¸</p>
<p>çº¯ç²¹ä»¥ä¸ªäººå£å‘³åšä¸ªå¤‡å¿˜ ğŸ“</p>
<p>è¸©è¿‡çš„å‘ã€ç•™æ‹çš„å‘³é“ã€æ–°å¥‡çš„ç»„åˆï¼Œä¸€èµ·è®°ä¸‹æ¥ âœ…</p>
<p>æœ‰æ—¶å€™åŒä¸€ä¸ªå“ç‰Œï¼Œä¸åŒåˆ†åº—çš„å£å‘³ä¹Ÿèƒ½å¤©å·®åœ°åˆ«ï¼ŒçœŸçš„æ— è¯­äº† ğŸ™ƒ</p>
<h2>ğŸŒ‡ å¤©æ²³åŒº</h2>
<h3>ğŸ› ç¾æ—å¤©åœ°</h3>
<h4>ğŸ’¡ æ–°å¥‡æ¦œ</h4>
<ul>
<li>
<p><strong>è±†æµ†æ±¤åœ†</strong> ğŸ«˜ğŸ¡<br>
æ²¡æƒ³åˆ°è±†æµ†è·Ÿç”œæ±¤åœ†è¿™ä¹ˆé…ï¼æ„å¤–å¥½å–ï¼Œæ¨èå°è¯• ğŸ‰</p>
</li>
<li>
<p><strong>é»„çš®å†°èŒ¶</strong> ğŸ‹ğŸ§Š<br>
èŒ¶æ•‘æ˜Ÿçƒå®¶çš„é»„çš®ç³»åˆ—ï¼Œå‘³é“å¾ˆæƒŠè‰³ï¼Œè®°å¾—é€‰ã€Œå’¸ã€çš„ç‰ˆæœ¬ï¼</p>
</li>
</ul>
<h4>ğŸ¥¢ å¥½åƒæ¦œ</h4>
<ul>
<li>
<p><strong>é±¼ç²‰ç‹</strong> ğŸŸğŸœ<br>
å·²æ­‡ä¸šäº†ï¼ŒçœŸçš„å¤ªå¯æƒœ ğŸ˜¢<br>
å½“æ¯å¤©çº ç»“åƒä»€ä¹ˆçš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
</li>
<li>
<p><strong>æ¢é±¼</strong> ğŸ”¥ğŸ <br>
å¶å°”æƒ³åƒçƒ¤é±¼çš„æ—¶å€™ï¼Œæ¢é±¼æ˜¯ä¸ªç¨³å®šé€‰é¡¹ï¼Œå‘³é“åœ¨çº¿ï¼</p>
</li>
<li>
<p><strong>ä¹æ¯›ä¹</strong> ğŸ¥©ğŸš<br>
è¥¿åŒ—èœé‡Œæ¯”è¾ƒå–œæ¬¢çš„ä¸€å®¶ï¼Œ<strong>é…±éª¨æ¶</strong>åšå¾—ä¸é”™ï¼Œç±³é¥­ä¹Ÿå¥½åƒã€‚</p>
</li>
<li>
<p><strong>é¾™äº•æ¹–</strong> ğŸ¥¢ğŸ<br>
å®¶å¸¸å‘³é“è›®å¯¹æˆ‘å£å‘³ï¼Œç¯å¢ƒä¹ŸæŒºèˆ’æœçš„ï¼Œé€‚åˆå®‰é™åƒé¥­ã€‚</p>
</li>
</ul>
<h4>ğŸ™…â€â™€ï¸ ä¸å¥½åƒæ¦œ</h4>
<ul>
<li>
<p><strong>å…°å· xxx é¦†</strong> ğŸœğŸš«<br>
å¿˜äº†åå­—ï¼Œæ€»ä¹‹åƒå®Œæ²¡æœ‰ä»»ä½•å›å¤´æ¬²æœ›ã€‚</p>
</li>
<li>
<p><strong>å…‹èŒ—å†°å®¤</strong> ğŸ§ŠğŸ¥ª<br>
åƒçš„æ˜¯ä¸€ç§ã€Œä¸ºå•¥ä¼šå¼€åœ¨è¿™å„¿ã€çš„å›°æƒ‘æ„Ÿ ğŸ˜¬</p>
</li>
<li>
<p><strong>å¸ˆçƒ¤</strong> ğŸ¢ğŸ’¸<br>
å‘³é“æ™®é€šã€ä»·æ ¼è·Ÿæ¢é±¼å·®ä¸å¤šã€‚</p>
</li>
</ul>
<h4>ğŸ“¦ å¤–å–æ¦œ</h4>
<ul>
<li>
<p><strong>é‡‘ç‰Œç­’éª¨ç²‰</strong> ğŸ¦´ğŸ²<br>
è‚‰ç»™å¾—å®åœ¨ï¼Œæ±¤æµ“å‘³æ­£ï¼Œå†¬å¤©åƒç‰¹åˆ«èˆ’æœ â„ï¸</p>
</li>
<li>
<p><strong>é‡‘ç‰Œçƒ§é¹…ï¼ˆä¸œåœƒé›…æ€¡åº—ï¼‰</strong> ğŸ—ğŸš<br>
åŒ…è£…è®²ç©¶ï¼Œé¹…è‚‰ä¸æŸ´ï¼Œé…é¥­ä¸€ç»ï¼Œå›è´­è¿‡å‡ æ¬¡ âœ…</p>
</li>
<li>
<p><strong>ç›Šç¦¾å ‚ï¼ˆç æ‘åº—ï¼‰</strong> ğŸ¹ğŸ§‹<br>
èŒ¶å‘³å¤Ÿï¼Œç”œåº¦å¥½è°ƒï¼Œå±äºèŒ¶é¥®é‡Œä¸ä¼šå‡ºé”™çš„ç‰Œå­ã€‚</p>
</li>
</ul>
<h2>ğŸ™ è¶Šç§€åŒº</h2>
<h3>ğŸ§­ åŒ—äº¬è·¯åŒºåŸŸ</h3>
<ul>
<li>
<p><strong>è¾¾æ‰¬åŸå‘³ç‚–å“</strong> ğŸ²ğŸ”<br>
ç‚¹äº†ç‚–ç«¹ä¸é¸¡ï¼ˆæ‹›ç‰Œï¼‰ï¼Œæ±¤å‘³æµ“éƒï¼Œå¤©å†·æ¥ä¸€ç¢—å¾ˆç–—æ„ˆ ğŸ§£</p>
</li>
<li>
<p><strong>ç™¾èŠ±ç”œå“åº—</strong> ğŸ§ğŸŒ¸<br>
åæ°”æŒºå¤§ï¼Œä½†å®è¯è¯´æ„Ÿè§‰ä¸€èˆ¬ï¼Œå¯èƒ½æ˜¯æˆ‘å£å‘³ä¸å¤ªå¯¹ ğŸ§</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é‚£äº›çº ç»“è¿‡çš„è‹±æ–‡è¯æ±‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/355</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/355</guid>
            <pubDate>Tue, 18 Feb 2025 09:43:35 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/2/1740291122815.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å®æ—¶</h2>
<p>å‚èµ›é€‰æ‰‹ï¼š</p>
<ul>
<li>realtime]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/2/1740291122815.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å®æ—¶</h2>
<p>å‚èµ›é€‰æ‰‹ï¼š</p>
<ul>
<li>realtime</li>
<li>real-time</li>
<li>real time</li>
</ul>
<h2>æ›´æ–°/å‡çº§</h2>
<p>å‚èµ›é€‰æ‰‹ï¼š</p>
<ul>
<li>update</li>
<li>upgrade</li>
</ul>
<h2>æ¸…ç©º</h2>
<p>å‚èµ›é€‰æ‰‹ï¼š</p>
<ul>
<li>clean</li>
<li>clear</li>
</ul>
<h1>æ€§åˆ«</h1>
<p>å‚èµ›é€‰æ‰‹ï¼š</p>
<ul>
<li><strong>gender</strong> - æŒ‡ç¤¾ä¼šå»ºæ„çš„ã€ç”±å¥³å­©ã€å¥³äººã€ç”·å­©ã€ç”·äººä»¥åŠæ€§åˆ«å¤šå…ƒåŒ–äººç¾¤çš„è§’è‰²ã€è¡Œä¸ºã€è¡¨è¾¾å’Œèº«ä»½ã€‚å®ƒå½±å“ç€äººä»¬å¦‚ä½•çœ‹å¾…è‡ªå·±å’Œä»–äººï¼Œå¦‚ä½•è¡ŒåŠ¨å’Œäº’åŠ¨ï¼Œä»¥åŠç¤¾ä¼šä¸­æƒåŠ›å’Œèµ„æºçš„åˆ†é…ã€‚æ€§åˆ«è®¤åŒå¹¶éå±€é™äºäºŒå…ƒå¯¹ç«‹ï¼ˆå¥³å­©/å¥³äººï¼Œç”·å­©/ç”·äººï¼‰ï¼Œä¹Ÿå¹¶éä¸€æˆä¸å˜ï¼›å®ƒæ˜¯ä¸€ä¸ªè¿ç»­ä½“ï¼Œä¼šéšç€æ—¶é—´è€Œå˜åŒ–ã€‚ä¸ªäººå’Œç¾¤ä½“å¯¹æ€§åˆ«çš„ç†è§£ã€ä½“éªŒå’Œè¡¨è¾¾æ–¹å¼å­˜åœ¨ç€ç›¸å½“å¤§çš„å¤šæ ·æ€§ï¼Œè¿™ä½“ç°åœ¨ä»–ä»¬æ‰€æ‰¿æ‹…çš„è§’è‰²ã€å¯¹ä»–ä»¬çš„æœŸæœ›ã€ä¸ä»–äººçš„å…³ç³»ä»¥åŠæ€§åˆ«åœ¨ç¤¾ä¼šä¸­åˆ¶åº¦åŒ–çš„å¤æ‚æ–¹å¼ä¸Šã€‚</li>
<li><strong>sex</strong> - æŒ‡äººç±»å’ŒåŠ¨ç‰©çš„ä¸€ç»„ç”Ÿç‰©å­¦å±æ€§ã€‚å®ƒä¸»è¦ä¸ç”Ÿç†ç‰¹å¾ç›¸å…³ï¼ŒåŒ…æ‹¬æŸ“è‰²ä½“ã€åŸºå› è¡¨è¾¾ã€æ¿€ç´ æ°´å¹³å’ŒåŠŸèƒ½ä»¥åŠç”Ÿæ®–/æ€§è§£å‰–ç»“æ„ã€‚æ€§åˆ«é€šå¸¸åˆ†ä¸ºå¥³æ€§å’Œç”·æ€§ï¼Œä½†æ„æˆæ€§åˆ«çš„ç”Ÿç‰©å­¦å±æ€§åŠå…¶è¡¨è¾¾æ–¹å¼å­˜åœ¨å·®å¼‚ã€‚</li>
</ul>
<blockquote>
<p><a href="https://cihr-irsc.gc.ca/e/48642.html">What is gender? What is sex?</a></p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äºè¿›åˆ¶]]></title>
            <link>https://github.com/toFrankie/blog/issues/354</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/354</guid>
            <pubDate>Sun, 22 Dec 2024 13:54:48 GMT</pubDate>
            <description><![CDATA[<h2>ç®€ä»‹</h2>
<p><strong>è¿›åˆ¶</strong>ï¼ˆè¿›ä½åˆ¶ï¼‰æ˜¯ä¸€ç§è®°æ•°æ–¹å¼ï¼Œå¯ä»¥ç”¨æœ‰é™çš„â€œæ•°å­—ç¬¦å·â€è¡¨ç¤ºæ‰€æœ‰çš„æ•°å€¼ã€‚</p>
<p><strong>è¿›ä½</strong>è¡¨ç¤ºåœ¨ä¸€ä¸ªä½å€¼çš„æ•°å­—è¾¾åˆ°åŸºæ•°åï¼Œå°†å…¶é‡ç½®ä¸ºé›¶å¹¶ä½¿é«˜ä¸€ä½çš„æ•°å­—åŠ ä¸€ã€‚</p>
<p>æ¯”å¦‚ï¼Œåè¿›åˆ¶åªæœ‰ 0 ~ 9 è¿™åä¸ªæ•°å­—ç¬¦å·ï¼Œè¡¨ç¤º]]></description>
            <content:encoded><![CDATA[<h2>ç®€ä»‹</h2>
<p><strong>è¿›åˆ¶</strong>ï¼ˆè¿›ä½åˆ¶ï¼‰æ˜¯ä¸€ç§è®°æ•°æ–¹å¼ï¼Œå¯ä»¥ç”¨æœ‰é™çš„â€œæ•°å­—ç¬¦å·â€è¡¨ç¤ºæ‰€æœ‰çš„æ•°å€¼ã€‚</p>
<p><strong>è¿›ä½</strong>è¡¨ç¤ºåœ¨ä¸€ä¸ªä½å€¼çš„æ•°å­—è¾¾åˆ°åŸºæ•°åï¼Œå°†å…¶é‡ç½®ä¸ºé›¶å¹¶ä½¿é«˜ä¸€ä½çš„æ•°å­—åŠ ä¸€ã€‚</p>
<p>æ¯”å¦‚ï¼Œåè¿›åˆ¶åªæœ‰ 0 ~ 9 è¿™åä¸ªæ•°å­—ç¬¦å·ï¼Œè¡¨ç¤ºç¬¬åä¸€ä¸ªæ•°ï¼ˆä» 0 èµ·ï¼‰ï¼Œå°±è¦è¿›ä¸€ä½ï¼Œå˜æˆ 10ã€‚å…¶ä»–è¿›åˆ¶åŒç†ã€‚</p>
<h2>è¿›åˆ¶æ•°è½¬æ¢</h2>
<p>ä»¥ 35 ä¸ºä¾‹ï¼š</p>
<ul>
<li>äºŒè¿›åˆ¶ï¼š<code>100011</code></li>
<li>å…«è¿›åˆ¶ï¼š<code>43</code></li>
<li>åè¿›åˆ¶ï¼š<code>35</code></li>
<li>åå…­è¿›åˆ¶ï¼š<code>23</code></li>
</ul>
<h3>åè¿›åˆ¶ â†’ äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶</h3>
<p>æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†çš„è½¬æ¢è§„åˆ™ä¸å¤ªä¸€æ ·ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼šæ•´æ•°éƒ¨åˆ†å–ä½™é€†åºï¼Œå°æ•°éƒ¨åˆ†ä¹˜æ³•å–æ•´æ­£åºã€‚</p>
<p>ä»¥ 35.125 ä¸ºä¾‹ã€‚</p>
<p><strong>æ•´æ•°éƒ¨åˆ†è½¬äºŒè¿›åˆ¶ï¼š</strong></p>
<ul>
<li>35 / 2ï¼šå•† 17ï¼Œä½™æ•° 1</li>
<li>17 / 2ï¼šå•† 8ï¼Œä½™æ•° 1</li>
<li>8 / 2ï¼šå•† 4ï¼Œä½™æ•° 0</li>
<li>4 / 2ï¼šå•† 2ï¼Œä½™æ•° 0</li>
<li>2 / 2ï¼šå•† 1ï¼Œä½™æ•° 0</li>
<li>1 / 2ï¼šå•† 0ï¼Œä½™æ•° 1</li>
</ul>
<p>ä¸æ–­é™¤ä»¥ 2ï¼Œç›´è‡³å•†ä¸º 0ã€‚ä»æœ€åä¸€ä¸ªä½™æ•°è¯»èµ·ï¼ˆé€†åºï¼‰ï¼Œä¾¿æ˜¯å…¶äºŒè¿›åˆ¶æ•° <code>100011</code>ã€‚å…¶ä»–è¿›åˆ¶åŒç†ï¼Œé™¤ä»¥ 8ã€16ã€‚</p>
<p><strong>å°æ•°éƒ¨åˆ†è½¬äºŒè¿›åˆ¶ï¼š</strong></p>
<ul>
<li>0.125 * 2ï¼šç§¯ 0.25ï¼Œå–æ•´æ•°éƒ¨åˆ† 0ï¼Œå‰© 0.25</li>
<li>0.25 * 2ï¼šç§¯ 0.5ï¼Œå–æ•´æ•°éƒ¨åˆ† 0ï¼Œå‰© 0.5</li>
<li>0.5 * 2ï¼šç§¯ 1ï¼Œå–æ•´æ•°éƒ¨åˆ† 1ï¼Œå‰© 0</li>
</ul>
<p>ä¸æ–­ä¹˜ä»¥ 2ï¼Œå–å‡ºç»“æœçš„æ•´æ•°éƒ¨åˆ†ï¼Œå†ä½™ä¸‹çš„å°æ•°éƒ¨åˆ†é‡å¤è®¡ç®—ï¼Œç›´åˆ°ç§¯çš„å°æ•°éƒ¨åˆ†ä¸º 0ã€‚ä»ç¬¬ä¸€ä¸ªç§¯è¯»èµ·ï¼ˆæ­£åºï¼‰å–å…¶æ•´æ•°éƒ¨åˆ†ï¼Œä¾¿æ˜¯å…¶äºŒè¿›åˆ¶æ•° <code>001</code>ã€‚å…¶ä»–è¿›åˆ¶åŒç†ï¼Œä¹˜ä»¥ 8ã€16ã€‚</p>
<p>æœ€åï¼Œå°†æ•´æ•°å’Œå°æ•°åˆèµ·æ¥ï¼Œåè¿›åˆ¶æ•° <code>35.125</code> å¯¹åº”çš„äºŒè¿›åˆ¶æ•°ä¸º <code>100011.001</code>ã€‚</p>
<p><strong>å°æ•°éƒ¨åˆ†çš„è¯¯å·®ï¼š</strong></p>
<p>æœ‰æ—¶ï¼Œä¸æ–­ä¹˜ä»¥ 2 å¾—åˆ°çš„ç§¯çš„å°æ•°éƒ¨åˆ†æ°¸è¿œä¸ä¸º 0ï¼Œä½†ç²¾åº¦è¦æ±‚ï¼Œå› æ­¤ä¹Ÿä¼šæœ‰èˆå…¥çš„æ“ä½œã€‚</p>
<p>ä»¥ 0.8 ä¸ºä¾‹ï¼š</p>
<ul>
<li>0.8 * 2ï¼šç§¯ 1.6ï¼Œå–æ•´æ•°éƒ¨åˆ† 1ï¼Œå‰© 0.6</li>
<li>0.6 * 2ï¼šç§¯ 1.2ï¼Œå–æ•´æ•°éƒ¨åˆ† 1ï¼Œå‰© 0.2</li>
<li>0.2 * 2ï¼šç§¯ 0.4ï¼Œå–æ•´æ•°éƒ¨åˆ† 0ï¼Œå‰© 0.4</li>
<li>0.4 * 2ï¼šç§¯ 0.8ï¼Œå–æ•´æ•°éƒ¨åˆ† 0ï¼Œå‰© 0.8</li>
<li>0.8 * 2ï¼šç§¯ 1.6ï¼Œå–æ•´æ•°éƒ¨åˆ† 1ï¼Œå‰© 0.6</li>
<li>æ— é™å¾ªç¯...</li>
</ul>
<p>å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º <code>1100 1100 1100 1100...</code></p>
<h3>äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ â†’ åè¿›åˆ¶</h3>
<p>35 ç”¨åè¿›åˆ¶çš„è¡¨ç¤ºæ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-math">35 = 3 * 10^1 + 5 * 10^0
</code></pre>
<blockquote>
<p>ä»¥ä»å·¦åˆ°å³çš„ä¹¦å†™ä¹ æƒ¯ä¸ºä¾‹ï¼Œå·¦ä¾§ä¸ºé«˜ä½ï¼Œå³ä¾§ä¸ºä½ä½ã€‚</p>
</blockquote>
<blockquote>
<p>å…¶ä¸­ 3ã€5 ä¸ºä½å€¼ï¼Œ10^1ã€10^0 ä¸ºæƒå€¼ã€‚</p>
</blockquote>
<p>ä»ä½ä½èµ·ï¼ˆä»å³å¾€å·¦ï¼‰ï¼Œå…¶æƒå€¼åˆ†åˆ«ä¸º 10^0ã€10^1ã€...ã€10^n-1ï¼ˆ10 è¡¨ç¤ºä¸ºå¯¹åº”è¿›åˆ¶ï¼Œn è¡¨ç¤ºä½æ•°ï¼‰ã€‚</p>
<p>å°†æ¯ä½çš„ä½å€¼ä¹˜ä»¥æƒå€¼ï¼Œå†æ±‚å’Œå°±æ˜¯å¯¹åº”çš„åè¿›åˆ¶å€¼ã€‚</p>
<p>äºŒè¿›åˆ¶ <code>100011</code></p>
<pre><code class="language-math">35 = 1 * 2^5 + 0 * 2^4 + 0 * 2^3 + 0 * 2^2 + 1 * 2^1 + 1 * 2^0
</code></pre>
<p>å…«è¿›åˆ¶ <code>43</code></p>
<pre><code class="language-math">35 = 4 * 8^1 + 3 * 8^0
</code></pre>
<p>åå…­è¿›åˆ¶ <code>23</code></p>
<pre><code class="language-math">35 = 2 * 16^1 + 3 * 16^0
</code></pre>
<h3>äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶äº’è½¬</h3>
<p>ä¸€ä½å…«è¿›åˆ¶ç”¨ä¸‰ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œä¸€ä½åå…­è¿›åˆ¶ç”¨å››ä½äºŒè¿›åˆ¶è¡¨ç¤ºã€‚ä½æ•°ä¸å¤Ÿï¼Œé«˜ä½è¡¥é›¶ã€‚</p>
<ul>
<li>äºŒè¿›åˆ¶ <code>100011</code></li>
<li>å…«è¿›åˆ¶ <code>100 011</code> â†’ <code>43</code></li>
<li>åå…­è¿›åˆ¶ <code>0010 0011</code> â†’ <code>23</code></li>
</ul>
<p>åå…­è¿›åˆ¶è½¬å…«è¿›åˆ¶ï¼Œå¯ä»¥å…ˆè½¬ä¸ºäºŒè¿›åˆ¶ï¼Œå†è½¬ä¸ºå…«è¿›åˆ¶ã€‚</p>
<h2>ä½è¿ç®—</h2>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[uni-app å¼€å‘è®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/353</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/353</guid>
            <pubDate>Tue, 10 Dec 2024 01:52:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733795779961.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ‰äº›ä¸œè¥¿éš”ä¸€æ®µæ—¶é—´ä¸ç”¨å°±å®¹æ˜“å¿˜è®°ï¼Œåœ¨æ­¤ä½œä¸‹è®°å½•ã€‚</p>
<h2>è‡ªå®šä¹‰ç»„ä»¶]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733795779961.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ‰äº›ä¸œè¥¿éš”ä¸€æ®µæ—¶é—´ä¸ç”¨å°±å®¹æ˜“å¿˜è®°ï¼Œåœ¨æ­¤ä½œä¸‹è®°å½•ã€‚</p>
<h2>è‡ªå®šä¹‰ç»„ä»¶é€‰é¡¹é…ç½®</h2>
<p>è¯¸å¦‚ styleIsolationã€virtualHost ç­‰è‡ªå®šä¹‰ç»„ä»¶<a href="https://uniapp.dcloud.net.cn/tutorial/vue3-api.html#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE">é…ç½®</a>ï¼Œå£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p>â–¼ Composition API</p>
<p>è‹¥æ˜¯ Vue3.3+ï¼Œå¯ä½¿ç”¨ <a href="https://vuejs.org/api/sfc-script-setup.html#defineoptions">defineOptions()</a>ã€‚</p>
<pre><code class="language-html">&lt;script setup&gt;
  defineOptions({
    options: {
      virtualHost: false,
      styleIsolation: 'shared',
    },
  })

  // your code...
&lt;/script&gt;
</code></pre>
<p>è‹¥æ˜¯ Vue3.3 ä»¥ä¸‹ï¼Œéœ€è¦ç‹¬ç«‹çš„ <code>&lt;script&gt;</code> å—ã€‚</p>
<pre><code class="language-html">&lt;script setup&gt;
  // your code...
&lt;/script&gt;

&lt;script&gt;
  export default {
    options: {
      virtualHost: false,
      styleIsolation: 'shared',
    },
  }
&lt;/script&gt;
</code></pre>
<p>â–¼ Options API</p>
<pre><code class="language-html">&lt;script&gt;
  export default {
    options: {
      virtualHost: false,
      styleIsolation: 'shared',
    },
  }
&lt;/script&gt;
</code></pre>
<h2>åˆ¤æ–­æ˜¯å¦å®‰è£…å¾®ä¿¡</h2>
<p>åˆ©ç”¨ HTML5 Plus APIï¼š</p>
<pre><code class="language-js">function checkWechatInstalled() {
  return plus.runtime.isApplicationExist({pname: 'com.tencent.mm', action: 'weixin://'})
}
</code></pre>
<ul>
<li>Android å¹³å°é€šè¿‡ pname å±æ€§ï¼ˆåŒ…åï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚</li>
<li>iOS å¹³å°é€šè¿‡ action å±æ€§ï¼ˆSchemeï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚iOS9 ä»¥åéœ€è¦æ·»åŠ ç™½åå•æ‰å¯æŸ¥è¯¢ï¼Œåœ¨ manifest.json é…ç½® <code>urlschemewhitelist: [&quot;weixin&quot;]</code>ï¼ˆ<a href="https://uniapp.dcloud.net.cn/tutorial/app-ios-schemewhitelist.html">å‚è€ƒ</a>ï¼‰ã€‚å…¶ä»– App åŒç†ã€‚</li>
</ul>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.isApplicationExist">HTML5+ API Reference</a></li>
<li><a href="https://uniapp.dcloud.net.cn/tutorial/app-ios-schemewhitelist.html">è®¾ç½®åº”ç”¨è®¿é—®ç™½åå•åˆ—è¡¨</a></li>
</ul>
<h2>App çƒ­æ›´æ–°</h2>
<p>æˆ‘ä»¬è¦çŸ¥é“ï¼Œåº”ç”¨å¹³å°å¯¹ App æä¾›çƒ­æ›´æ–°æœåŠ¡å…¶å®æ˜¯æŒæ’æ–¥æ€åº¦çš„ï¼Œé€å®¡æœŸé—´æœ€å¥½ä¸è¦å¼¹å‡ºçƒ­æ›´æ–°å¼¹çª—ã€‚</p>
<p>å‰ç«¯éƒ¨åˆ†ï¼š</p>
<ol>
<li>é€šè¿‡ <code>plus.runtime.getProperty()</code> è·å–å½“å‰ wgt åŒ…çš„ç‰ˆæœ¬åç§°å’Œç‰ˆæœ¬å·</li>
<li>è¯·æ±‚æœåŠ¡ç«¯æ£€æŸ¥æ˜¯æœ‰æ›´æ–°çš„ wgt åŒ…</li>
<li>é€šè¿‡ <code>uni.downloadFile()</code> ä¸‹è½½ wgt åŒ…</li>
<li>é€šè¿‡ <code>plus.runtime.install()</code> å®‰è£… wgt åŒ…</li>
<li>é€šè¿‡ <code>plus.runtime.restart()</code> é‡å¯</li>
</ol>
<blockquote>
<p>å®Œæ•´æµç¨‹å‚è€ƒ<a href="https://ask.dcloud.net.cn/article/35667">ç¤ºä¾‹</a></p>
</blockquote>
<p>æ‰“åŒ…éƒ¨åˆ†ï¼š</p>
<ol>
<li>æ‰“åŒ…æ–°ç‰ˆ wgt æ—¶è¦æ›´æ–° <code>versionName</code> å’Œ <code>versionCode</code>ï¼Œä¸” <code>versionCode</code> è¦æ¯”ä¸Šä¸€æ¬¡å¤§ï¼Œå¦åˆ™å®‰è£…å®Œæ–°åŒ…åé€€å‡ºï¼Œå†·å¯åŠ¨åº”ç”¨å¯èƒ½ä¼šé‡æ–°åŠ è½½æ—§åŒ…ã€‚
<ul>
<li>versionName åº”ç”¨ç‰ˆæœ¬åç§°ï¼Œå¦‚ 1.2.3</li>
<li>versionCode åº”ç”¨ç‰ˆæœ¬å·ï¼Œå¿…é¡»æ˜¯æ•´æ•°ï¼Œå–å€¼èŒƒå›´ 1~2147483647ï¼Œå‡çº§æ—¶å¿…é¡»é«˜äºä¸Šä¸€æ¬¡è®¾ç½®çš„å€¼ã€‚</li>
</ul>
</li>
</ol>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://ask.dcloud.net.cn/article/35667">uni-app èµ„æºåœ¨çº¿å‡çº§/çƒ­æ›´æ–°</a></li>
<li><a href="https://doc.dcloud.net.cn/uni-app-x/collocation/manifest.html#%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%88%97%E8%A1%A8">manifest.json é…ç½®é¡¹</a></li>
<li><a href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.getProperty">plus.runtime.getProperty</a></li>
<li><a href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.install">plus.runtime.install</a></li>
<li><a href="https://www.html5plus.org/doc/zh_cn/runtime.html#plus.runtime.restart">plus.runtime.restart</a></li>
</ul>
<h2>å„ç«¯å·®å¼‚</h2>
<blockquote>
<p>ä¸»è¦è®¨è®ºå¾®ä¿¡å°ç¨‹åºç«¯ä¸ Appã€H5 ç­‰éå°ç¨‹åºç«¯çš„å·®å¼‚ã€‚</p>
</blockquote>
<h3>åä»£é€‰æ‹©å™¨</h3>
<p>æ¯”å¦‚ï¼Œåœ¨çˆ¶ç»„ä»¶æŸ¥è¯¢å­ç»„ä»¶å†…çš„æŸä¸ªå…ƒç´ ã€‚</p>
<p>åœ¨å¾®ä¿¡å°ç¨‹åºç«¯æœ‰ä¸¤ç§åšæ³•ï¼š</p>
<ol>
<li>æ‹¿åˆ°å­ç»„ä»¶å®ä¾‹ï¼Œç„¶åå†çˆ¶ç»„ä»¶å†…ä½¿ç”¨ <code>uni.createSelectorQuery.in(subComponentInstance).select('.descendant')</code> è·å–å…ƒç´ ã€‚</li>
<li>ä½¿ç”¨ <a href="https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.select.html#selector-%E8%AF%AD%E6%B3%95">&gt;&gt;&gt;</a>ï¼ˆè·¨è‡ªå®šä¹‰ç»„ä»¶çš„åä»£é€‰æ‹©å™¨ï¼‰ï¼Œåœ¨çˆ¶å…ƒç´ å†…ä½¿ç”¨ <code>uni.createSelectorQuery().select('.ancestor &gt;&gt;&gt; .descendant')</code> è·å–å…¶å­ï¼ˆå­å­...ï¼‰ç»„ä»¶å†…çš„å…ƒç´ ã€‚</li>
</ol>
<p>è€Œ App ç«¯ï¼Œç¼–è¯‘åçš„ HTML ç»“æ„è·Ÿå°ç¨‹åºä¸ä¸€æ ·ï¼Œå°ç¨‹åºå¸¦æœ‰ä¸€ä¸ª ShadowRoot èŠ‚ç‚¹éš”ç¦»ï¼Œè€Œ App ç«¯ä¸ä¼šã€‚å› æ­¤ä½¿ç”¨ <code>uni.createSelectorQuery().select('.ancestor .descendant')</code> ç›´æ¥æŸ¥è¯¢åˆ°åä»£çš„å…ƒç´ ã€‚è€Œä¸” <a href="https://uniapp.dcloud.net.cn/api/ui/nodes-info.html#selectorquery-select">App ç«¯ä¸æ”¯æŒ &gt;&gt;&gt; è¯­æ³•</a>ï¼Œå®ƒæ˜¯å°ç¨‹åºç‰¹æœ‰çš„ã€‚</p>
<h3>å¸ƒå°” dataset</h3>
<p>åœ¨ HTML ä¸­æœ‰ä¸€ç§<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute">å¸ƒå°”ç±»å‹çš„å±æ€§</a>ã€‚</p>
<pre><code class="language-html">&lt;!-- attr is true --&gt;
&lt;div attr&gt;&lt;/div&gt;
&lt;div attr=&quot;&quot;&gt;&lt;/div&gt;
&lt;div attr=&quot;false&quot;&gt;&lt;/div&gt;
&lt;div attr=&quot;any value&quot;&gt;&lt;/div&gt;

&lt;!-- attr is false --&gt;
&lt;div&gt;&lt;/div&gt;
</code></pre>
<p>å¦‚æœè¦å°†æŸä¸ªå±æ€§å˜ä¸º falseï¼Œåªèƒ½ <code>removeAttribute('attr')</code>ã€‚å¯¹äº <code>setAttribute('attr', undefined)</code> ç­‰å‡æ˜¯æ— æ•ˆçš„ï¼Œå†…éƒ¨ä¼šæœ‰ toString() çš„å¤„ç†ï¼Œå› ä¸º HTML çš„å±æ€§å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚<code>data-*</code> åŒç†ã€‚</p>
<p>ä½†ä½¿ç”¨ uniapp æ—¶ï¼Œä¸åŒç«¯è¡¨ç°ä¸ä¸€æ ·ã€‚</p>
<pre><code class="language-html">&lt;view data-attr&gt;&lt;/div&gt;
</code></pre>
<p>å¯¹äº <code>dataset.attr</code> å¾®ä¿¡å°ç¨‹åºæ˜¯å¸ƒå°”å€¼ <code>true</code>ï¼Œè€Œ App ç«¯åˆ™æ˜¯å­—ç¬¦ä¸² <code>''</code>ï¼Œåè€…è¡¨ç°æ˜¯ç¬¦åˆ HTML è§„èŒƒçš„ã€‚çŒœæµ‹æ˜¯å¾®ä¿¡å°ç¨‹åºå†…éƒ¨åšäº† <code>dataset.attr !== undefined</code> çš„å¤„ç†ã€‚å¦‚æœè¦ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œè¦æ³¨æ„å„ç«¯å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¸¸ç”¨ CSS Media Query è®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/352</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/352</guid>
            <pubDate>Sun, 24 Nov 2024 16:56:17 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732467411537.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<ul>
<li><code>@media</code> ç”¨äºåŸºäºä¸€ä¸ªæˆ–å¤šä¸ªåª’ä½“æŸ¥]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732467411537.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<ul>
<li><code>@media</code> ç”¨äºåŸºäºä¸€ä¸ªæˆ–å¤šä¸ªåª’ä½“æŸ¥è¯¢çš„ç»“æœæ¥åº”ç”¨æ ·å¼è¡¨ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><code>@supports</code> æŒ‡å®šä¾èµ–äºæµè§ˆå™¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„ CSS åŠŸèƒ½çš„æ”¯æŒå£°æ˜ã€‚</li>
</ul>
<h2>æ·±è‰²æ¨¡å¼</h2>
<pre><code class="language-css">@media (prefers-color-scheme: dark) {
  /* some rules */
}
</code></pre>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme">prefers-color-scheme</a></p>
<h2>Safari</h2>
<p>Safari for Mac å’Œ Safari for Mobileï¼ˆåŒ…æ‹¬ iOS ç«¯çš„ Chrome ç­‰ä½¿ç”¨ Webkit å†…æ ¸çš„æµè§ˆå™¨ï¼‰ã€‚</p>
<pre><code class="language-css">@supports (-webkit-hyphens: none) {
  /* some rules */
}
</code></pre>
<p><a href="https://gist.github.com/jbutko/6718701?permalink_comment_id=4975072#gistcomment-4975072">-webkit-hyphens</a></p>
<h2>Safari for Mobile</h2>
<p>ç§»åŠ¨ç«¯ Safari æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ iOS ç«¯çš„ Chrome ç­‰ä½¿ç”¨ Webkit å†…æ ¸çš„æµè§ˆå™¨ï¼‰ï¼Œä½†ä¸åŒ…æ‹¬ Safari for Macã€‚</p>
<pre><code class="language-css">@supports (-webkit-touch-callout: none) {
  /* some rules */
}
</code></pre>
<p><a href="https://caniuse.com/?search=-webkit-touch-callout">-webkit-touch-callout</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åºå›¾æ ‡å˜è‰²]]></title>
            <link>https://github.com/toFrankie/blog/issues/351</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/351</guid>
            <pubDate>Tue, 19 Nov 2024 09:11:27 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732448028116.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å›¾æ ‡å˜è‰²æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·å¿ƒæƒ…è‡ªåŠ¨åˆ‡æ¢çš®è‚¤ã€‚ğŸ¶</p>
<p>æœ¬]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732448028116.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å›¾æ ‡å˜è‰²æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·å¿ƒæƒ…è‡ªåŠ¨åˆ‡æ¢çš®è‚¤ã€‚ğŸ¶</p>
<p>æœ¬æ–‡ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ã€‚</p>
<h2>ä½¿ç”¨ svg æ ‡ç­¾</h2>
<p>ç¬¬ä¸€ååº”æ˜¯ç”¨ svg + currentColorã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;box&quot;&gt;
  &lt;svg version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; viewBox=&quot;0 0 15.7715 20.4004&quot; width=&quot;15.7715&quot; height=&quot;20.4004&quot; &gt;
    &lt;path
      d=&quot;M11.3965 4.66797C9.94141 4.66797 8.75 5.55664 7.98828 5.55664C7.17773 5.55664 6.12305 4.66797 4.85352 4.66797C2.44141 4.66797 0 6.71875 0 10.4688C0 12.8125 0.898438 15.2832 2.02148 16.875C2.97852 18.2227 3.81836 19.3066 5.0293 19.3066C6.2207 19.3066 6.74805 18.5352 8.23242 18.5352C9.73633 18.5352 10.0781 19.3066 11.3965 19.3066C12.7051 19.3066 13.5742 18.1055 14.4043 16.9238C15.3223 15.5664 15.7129 14.248 15.7227 14.1797C15.6445 14.1602 13.1445 13.1348 13.1445 10.2734C13.1445 7.79297 15.1074 6.67969 15.2246 6.5918C13.9258 4.72656 11.9434 4.66797 11.3965 4.66797ZM10.7129 3.08594C11.3086 2.36328 11.7285 1.37695 11.7285 0.380859C11.7285 0.244141 11.7188 0.107422 11.6992 0C10.7227 0.0390625 9.55078 0.644531 8.85742 1.46484C8.30078 2.08984 7.79297 3.08594 7.79297 4.08203C7.79297 4.23828 7.82227 4.38477 7.83203 4.43359C7.89062 4.44336 7.98828 4.46289 8.0957 4.46289C8.96484 4.46289 10.0586 3.87695 10.7129 3.08594Z&quot;
    /&gt;
  &lt;/svg&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.box {
  color: #0066cc;
}

.box svg {
  fill: currentColor;
}
</code></pre>
<p><a href="https://codepen.io/tofrankie/pen/rNXgpvK">CodePen</a></p>
<p>åŠ¨æ€ä¿®æ”¹çˆ¶å…ƒç´ çš„é¢œè‰²å°±èƒ½å˜è‰²ã€‚</p>
<p><strong>ç„¶ï¼Œå¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒ <code>&lt;svg /&gt;</code> æ ‡ç­¾ã€‚</strong></p>
<h2>ä½¿ç”¨ image æ ‡ç­¾ + base64</h2>
<p>å°ç¨‹åº image æ ‡ç­¾æ˜¯æ”¯æŒ svg æ ¼å¼å›¾ç‰‡çš„ï¼ˆ<a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0">ä¸€äº›é™åˆ¶</a>ï¼‰ã€‚</p>
<p>æ³¨æ„ï¼Œå°† <code>fill=&quot;currentColor&quot;</code> çš„ svg å›¾ç‰‡æ”¾åˆ° image æ ‡ç­¾ï¼Œè¯¥å›¾ç‰‡æ˜¯æ— æ³•è¯»å–å…¶æœ¬èº«æˆ–çˆ¶çº§é¢œè‰²çš„ï¼Œå› æ­¤å‘ˆç°ä¼šé»˜è®¤çš„é»‘è‰²ã€‚</p>
<p>è¦åšä¸€äº›è½¬æ¢å¤„ç†ï¼š</p>
<ol>
<li>ä¸‹è½½ svg å›¾ç‰‡</li>
<li>è¯»å– svg å›¾ç‰‡æ–‡ä»¶æºç </li>
<li>æ›¿æ¢ svg fill å±æ€§ä¸ºæŒ‡å®šé¢œè‰²</li>
<li>å°†æ›¿æ¢åçš„ svg æ–‡ä»¶è½¬åŒ–ä¸º base64</li>
</ol>
<pre><code class="language-js">function genColorfulSvg(url, color) {
  const localFilePath = await downloadSvgFile(url)
  const svgSourceStr = await readSvgFile(localFilePath)
  const colorfulSvgSourceStr = replaceSvgFillColor(svgSourceStr, color)
  const colorfulSvgBase64 = genSvgBase64(colorfulSvgSourceStr)
  return colorfulSvgBase64
}
</code></pre>
<pre><code class="language-js">// ä¸‹è½½å›¾ç‰‡
async function downloadSvgFile(url) {
  return new Promise((resolve, reject) =&gt; {
    wx.downloadFile({
      url,
      success: res =&gt; {
        if (res.statusCode === 200) return resolve(res.tempFilePath)
        reject(new Error('download file fail'))
      },
      fail: err =&gt; reject(err),
    })
  })
}
</code></pre>
<pre><code class="language-js">// è¯»å– svg æ–‡ä»¶
async function readSvgFile(localFilePath) {
  return new Promise((resolve, reject) =&gt; {
    const fs = wx.getFileSystemManager()
    fs.readFile({
      filePath: localFilePath,
      encoding: 'utf-8',
      position: 0,
      success: res =&gt; {
        const sourceFile = res.data
        resolve(sourceFile)
      },
      fail: err =&gt; reject(err),
    })
  })
}
</code></pre>
<pre><code class="language-js">// æ›¿æ¢ fill å±æ€§
function replaceSvgFillColor(svgSourceStr, newFillColor) {
  // åŒ¹é… fill=&quot;...&quot; ä¸­çš„é none å€¼ï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰
  return svgSourceStr.replace(/fill=&quot;(?!none)[^&quot;]*&quot;/g, `fill=&quot;${newFillColor}&quot;`)
}
</code></pre>
<pre><code class="language-js">// ç”Ÿæˆ base64
function genSvgBase64(svgSourceStr) {
  return `data:image/svg+xml;base64,${base64Encode(svgSourceStr)}`
}
</code></pre>
<blockquote>
<p>ç¤ºä¾‹ä¸­ <code>base64Encode()</code> æ¥è‡ªæ˜é‡‘ç¤¾åŒºï¼ˆ<a href="https://juejin.cn/post/7229512717135527991">åŸæ–‡</a>ï¼‰ï¼Œæ‰¾å…¶ä»–ä¹Ÿè¡Œã€‚</p>
</blockquote>
<p>å°†ä»¥ä¸Šå°è£…æˆä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;colorful-image color=&quot;xxx&quot; src=&quot;xxx&quot; /&gt;
</code></pre>
<p>å¯ä»¥åœ¨ Component çš„ <code>lifetimes.attached()</code> æ—¶æœºæ‰§è¡Œï¼Œä¸ºäº†é¿å…é‡å¤ä¸‹è½½è½¬æ¢ï¼Œå¯ä»¥ç”¨ Map å°† base64 å­˜èµ·æ¥ã€‚</p>
<p>ï¼ˆå…·ä½“å®ç°å°±ä¸å†™äº†ï¼‰</p>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯è¦é¢å¤–çš„è¯»å–ã€æ›¿æ¢ã€è½¬æ¢ï¼Œæ€§èƒ½ä¸å¤ªå¥½ã€‚</p>
<h2>ä½¿ç”¨ image æ ‡ç­¾ + CSS Filter</h2>
<p>è¿™ç§æ–¹æ¡ˆä½¿ç”¨ CSS Filter å‡½æ•° <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter-function/drop-shadow">drop-shadow</a>ï¼Œå®ƒé€šå¸¸ç”¨äºç”Ÿæˆé˜´å½±æ•ˆæœã€‚</p>
<p>å¸¸è§„é˜´å½±æ˜¯ä½äºå›¾ç‰‡ä¸‹æ–¹çš„ï¼Œå€ŸåŠ© transform è¿›è¡Œä¸€äº›ä½ç§»æ“ä½œï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>éšè—åŸå›¾ï¼š
<ol>
<li>å°†å›¾ç‰‡æ°´å¹³æ–¹å‘ä½ç§»è¶³å¤Ÿå¤§çš„è·ç¦»</li>
<li>å°†å›¾ç‰‡çˆ¶çº§è®¾ç½®ä¸º overflow: hidden</li>
</ol>
</li>
<li>è®©é˜´å½±æ˜¾ç¤ºåœ¨åŸå›¾æœ¬æ¥çš„ä½ç½®
<ol>
<li>å°† filter: drop-shadow æ°´å¹³ç›¸åæ–¹å‘ä½ç§»åŒæ ·çš„è·ç¦»</li>
</ol>
</li>
</ol>
<p>è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›å‘ï¼Œå…ˆä»¥ Web ä¸ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;img class=&quot;icon&quot; src=&quot;../../images/star.svg&quot; /&gt;
</code></pre>
<pre><code class="language-css">.icon {
  width: 100rpx;
  height: 100rpx;
  filter: drop-shadow(200rpx 0 0 #1f883d);
  transform: translateX(-200rpx);
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/11/1732028600098.png" alt=""></p>
<p>â–² é»„è‰²ä¸ºåŸå›¾ï¼Œç»¿è‰²ä¸ºæŠ•å½±</p>
<p>æ¥ç€ï¼Œæ·»åŠ ä¸€ä¸ªçˆ¶çº§å…ƒç´ ï¼Œå¹¶è®¾ä¸º <code>overflow: hidden</code>ã€‚</p>
<p>ä½†æ˜¯ drop-shadow æœ‰ä¸€ä¸ªè¡¨ç°ç‰¹æ€§ï¼š</p>
<blockquote>
<p>åœ¨ Chrome æµè§ˆå™¨ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ çš„ä¸»ä½“éƒ¨åˆ†ï¼Œæ— è®ºä»¥ä½•ç§æ–¹å¼ï¼Œåªè¦åœ¨é¡µé¢ä¸­ä¸å¯è§ï¼Œå…¶ drop-shadow æ˜¯ä¸å¯è§çš„ï¼›å®ä½“éƒ¨åˆ†å“ªæ€•æœ‰ 1px å¯è§ï¼Œåˆ™ drop-shadow å®Œå…¨å¯è§ã€‚(æºè‡ª<a href="https://www.zhangxinxu.com/wordpress/2016/06/png-icon-change-color-by-css/">å¼ é‘«æ—­å¤§ä½¬çš„åšå®¢</a>)</p>
</blockquote>
<p>äº²æµ‹ Safari 18.1 ä¹Ÿæœ‰ç›¸åŒè¡¨ç°ï¼Œä¸æ˜¾ç¤ºé˜´å½±ï¼Œè€Œ Firefox 132 æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚</p>
<p>æ–‡ç« é‡Œæåˆ°ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ç”¨é€æ˜è¾¹æ¡†ï¼Œä½¿å…ƒç´ æ€»åœ¨å±å¹•å¯è§†åŒºåŸŸå†…ã€‚</p>
<p>è°ƒæ•´ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-diff">+ &lt;view class=&quot;icon-box&quot;&gt;
    &lt;img class=&quot;icon&quot; src=&quot;../../images/star.svg&quot; /&gt;
+  &lt;/view&gt;
</code></pre>
<pre><code class="language-diff">+ .icon-box {
+   width: 100rpx;
+   height: 100rpx;
+   overflow: hidden;
+ }

  .icon {
    width: 100rpx;
    height: 100rpx;
    filter: drop-shadow(200rpx 0 0 #1f883d);
    transform: translateX(-200rpx);
+   border-right: 1000px solid transparent;
  }
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œåœ¨ Chrome ä¸‹æ˜¯ç¬¦åˆé¢„æœŸäº†ï¼ˆé»„è‰²éšè—ï¼Œç»¿è‰²æ˜¾ç¤ºï¼‰ï¼Œç„¶è€Œ Safari ä¸‹é˜´å½±å¹¶æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>çœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼è¿™ä¸ªã€Š<a href="https://github.com/toFrankie/blog/issues/178">æ·±ç©¶ Safari ä¸‹ border-radius &amp; overflow ä¸ç”Ÿæ•ˆçš„é—®é¢˜</a>ã€‹ï¼Œç»™ icon æ·»åŠ  <code>transform: translateZ(0)</code> æˆ– <code>will-change: transform</code> ç­‰è§£å†³ï¼Œä½† Chrome åˆä¸èƒ½åŠ ï¼Œå¯ç”¨ CSS Media Query åŒºåˆ†ï¼ˆå°ç¨‹åºäº²æµ‹æœ‰ç”¨ï¼‰ã€‚</p>
<blockquote>
<p>å¦‚æœä½¿ç”¨ <code>wx.getSystemInfo().platform</code> æ¥åŒºåˆ†è®¾å¤‡ï¼Œè¦æ³¨æ„å¼€å‘å·¥å…·ã€PC ç«¯ã€Android ç«¯ä¸ Chrome è¡¨ç°ä¸€è‡´ï¼Œä¸èƒ½åŠ  <code>will-change: transform</code> ç­‰å¤„ç†ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">@supports (-webkit-hyphens: none) {
  /* Safari for macOS or iOS browsers */
  .icon {
    will-change: transform;
  }
}
</code></pre>
<p>æµ‹è¯•ç»“æœï¼ŒChromeã€Safariã€Firefox å’Œ iOS æµè§ˆå™¨éƒ½ç¬¦åˆé¢„æœŸäº†ã€‚</p>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼Œæœ¬æ‰“ç®—ç»™ <code>border-right</code> ç»™ä¸€ä¸ªè¶³å¤Ÿå¤§çš„è¾¹æ¡†å®½åº¦ï¼Œä»¥å…¼å®¹å„ç§å°ºå¯¸çš„å›¾æ ‡ï¼Œä½†å‘ç°è¿‡å¤§æ—¶åœ¨ Safari ä¸‹ä¸ä¼šå‘ˆç°é˜´å½±ï¼Œæš‚æœªå‘ç°æœ‰å•¥è§„å¾‹ã€‚ä½†é€šå¸¸å›¾æ ‡ä¸ä¼šå¾ˆå¤§ï¼Œå¦‚å°ç¨‹åºç«¯å¯ä»¥è®¾ç½®ä¸€å±å¤§å° 750rpx çš„è¾¹æ¡†å®½åº¦ã€‚</p>
</blockquote>
<p>å°ç¨‹åºç»„ä»¶ï¼š</p>
<pre><code class="language-html">&lt;colorful-image image-class=&quot;xxx&quot; color=&quot;xxx&quot; src=&quot;xxx&quot; /&gt;
</code></pre>
<ul>
<li>image-class ç”¨äºæŒ‡å®šå›¾ç‰‡å®½é«˜ç­‰</li>
<li>color é¢œè‰²</li>
<li>src å›¾ç‰‡é“¾æ¥ï¼ˆæ³¨æ„ï¼Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äº colorful-image ç»„ä»¶æ‰€åœ¨çš„ç›®å½•ï¼‰</li>
</ul>
<pre><code class="language-js">Component({
  externalClasses: ['image-class'],

  properties: {
    // Required
    src: {
      type: String,
      value: '',
    },

    color: {
      type: String,
      value: 'transparent',
    },
  },
})
</code></pre>
<pre><code class="language-json">{
  &quot;component&quot;: true,
  &quot;usingComponents&quot;: {}
}
</code></pre>
<pre><code class="language-html">&lt;view class=&quot;image-class inner-image-box&quot;&gt;
  &lt;image class=&quot;inner-image&quot; style=&quot;filter: drop-shadow(760rpx 0 0 {{ color }})&quot; src=&quot;{{ src }}&quot; /&gt;
&lt;/view&gt;
</code></pre>
<pre><code class="language-js">.inner-image-box {
  overflow: hidden;
}

.inner-image {
  box-sizing: content-box;
  display: block;
  width: 100%;
  height: 100%;
  border-right: 100000px solid transparent;
  transform: translateX(-760rpx);
}

@supports (-webkit-hyphens: none) {
  .inner-image {
    will-change: transform;
  }
}
</code></pre>
<p><a href="https://developers.weixin.qq.com/s/BgQvqWmK7rVu">å°ç¨‹åºä»£ç ç‰‡æ®µ</a></p>
<p>æ³¨æ„ï¼šSkyline æ¸²æŸ“æ¨¡å¼æš‚ä¸æ”¯æŒã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åºè¿·æƒ‘è¡Œä¸ºå¤§èµ]]></title>
            <link>https://github.com/toFrankie/blog/issues/350</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/350</guid>
            <pubDate>Tue, 19 Nov 2024 07:15:12 GMT</pubDate>
            <description><![CDATA[<p>ä½ å¼€å‘å°ç¨‹åºæœ‰é‡åˆ°è¿‡å“ªäº›å¥‡è‘©è¡¨ç°ï¼Ÿ</p>
<h2>è‡ªå®šä¹‰ç»„ä»¶é»˜è®¤æ˜¯å—çº§å…ƒç´ è¿˜æ˜¯è¡Œå†…å…ƒç´ ï¼Ÿ</h2>
<blockquote>
<p>2024.11.19</p>
</blockquote>
<p>èµ·å› ï¼Œç»™ä¸¤ä¸ªç›¸é‚»çš„è‡ªå®šä¹‰ç»„ä»¶è®¾ç½® margin å€¼ï¼Œå‘ç°æ²¡æœ‰ margin collapsing æ•ˆæœã€‚</p>
<]]></description>
            <content:encoded><![CDATA[<p>ä½ å¼€å‘å°ç¨‹åºæœ‰é‡åˆ°è¿‡å“ªäº›å¥‡è‘©è¡¨ç°ï¼Ÿ</p>
<h2>è‡ªå®šä¹‰ç»„ä»¶é»˜è®¤æ˜¯å—çº§å…ƒç´ è¿˜æ˜¯è¡Œå†…å…ƒç´ ï¼Ÿ</h2>
<blockquote>
<p>2024.11.19</p>
</blockquote>
<p>èµ·å› ï¼Œç»™ä¸¤ä¸ªç›¸é‚»çš„è‡ªå®šä¹‰ç»„ä»¶è®¾ç½® margin å€¼ï¼Œå‘ç°æ²¡æœ‰ margin collapsing æ•ˆæœã€‚</p>
<p>ç”±äºè‡ªå®šä¹‰ç»„ä»¶ä¸€ç›´è¡¨ç°ä¸ºã€Œæ¢è¡Œã€ç‰¹æ€§ï¼Œè®©æˆ‘ä»¥ä¸ºé»˜è®¤æ˜¯å—çº§å…ƒç´ ï¼Œç„¶è€Œå¼€å‘å·¥å…· Computed æ˜¾ç¤ºä¸º <code>display: inline</code>ã€‚ğŸ˜®</p>
<p>æœ‰ç½‘å‹å‘ç°ï¼Œå®ƒå¯èƒ½æ˜¯â€œéšæœºâ€çš„ï¼Œæœ‰ blockã€æœ‰ inlineï¼Œä¹Ÿæœ‰ flex çš„ã€‚ğŸ™„</p>
<p>Related link:</p>
<ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E8%99%9A%E6%8B%9F%E5%8C%96%E7%BB%84%E4%BB%B6%E8%8A%82%E7%82%B9">è™šæ‹ŸåŒ–ç»„ä»¶èŠ‚ç‚¹</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/0006447668c058b1f85bbb6b15ec00">è‡ªå®šä¹‰ç»„ä»¶çš„é»˜è®¤ display åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/0004a893598f20017d2d6793d5d000">è‡ªå®šä¹‰ç»„ä»¶çš„å£³å­æ˜¯ display: inline çš„ï¼Œä½†è¡¨ç°å‡ºæ¥å´æ˜¯æ¢è¡Œçš„</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[GitHub Blogger + GitHub Action]]></title>
            <link>https://github.com/toFrankie/blog/issues/349</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/349</guid>
            <pubDate>Mon, 12 Aug 2024 15:47:51 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723874278827.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>å»å¹´äºŒæœˆï¼Œæˆ‘å°†ç®€ä¹¦æ‰€æœ‰æ–‡ç« æ¬åˆ° GitHub ä¸Šï¼Œç»ˆäº]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723874278827.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>å»å¹´äºŒæœˆï¼Œæˆ‘å°†ç®€ä¹¦æ‰€æœ‰æ–‡ç« æ¬åˆ° GitHub ä¸Šï¼Œç»ˆäºä¸ç”¨è¢«å®¡æ ¸äº†ï¼</p>
<ul>
<li>README ä¸ºä¸»é¡µ</li>
<li>Issues ä¸ºæ–‡ç« åˆ—è¡¨</li>
</ul>
<p>ğŸ“¢ è¿™æ˜¯æˆ‘çš„<a href="https://github.com/toFrankie/blog">åšå®¢</a>ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•ç”¨ <a href="https://github.com/toFrankie/github-blogger">Github Blogger</a> å†™ä¸€ä¸ªå±äºè‡ªå·±çš„ã€‚</p>
<h2>å…¥é—¨é€Ÿçœ‹</h2>
<ul>
<li><a href="https://docs.github.com/zh/actions/writing-workflows/quickstart">GitHub Action å¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://docs.github.com/zh/rest/guides/scripting-with-the-rest-api-and-javascript?apiVersion=2022-11-28">ä½¿ç”¨ REST API å’Œ JavaScript ç¼–å†™è„šæœ¬</a></li>
</ul>
<h2>å¤‡ä»½</h2>
<p>æ•°æ®åœ¨æ‰‹æ‰æœ€è®©äººå®‰å¿ƒçš„ã€‚</p>
<p>å¦‚æœä½ æ˜¯ç”¨ <a href="https://github.com/toFrankie/github-blogger">Github Blogger</a> æ¥ç®¡ç†æ–‡ç« ï¼ˆIssueï¼‰ï¼Œæ–‡ç« ã€é…å›¾ä¼šè‡ªåŠ¨å­˜æ¡£åˆ° <code>archives</code>ã€<code>images</code> ç›®å½•ã€‚</p>
<p>å¦‚æœä½ æœªä½¿ç”¨ GitHub Blogger æˆ–åœ¨æ­¤ä¹‹å‰æœ‰ä¸€äº›å†å² Issueï¼Œå¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨è„šæœ¬è°ƒç”¨ <a href="https://docs.github.com/zh/rest/issues/issues?apiVersion=2022-11-28#list-repository-issues">GitHub API</a> æ‹‰å–æ‰€æœ‰ issueï¼Œç„¶åé‡æ–°æ¨åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<blockquote>
<p>å¯å‚è€ƒ <a href="https://github.com/toFrankie/blog/blob/main/scripts/fetch-all-issues.ts">fetch-all-issues.ts</a></p>
</blockquote>
<p>æ­¤å‰è¯•è¿‡ç”¨ <a href="https://github.com/Yikun/hub-mirror-action">hub-mirror-action</a> è¿›è¡ŒåŒæ­¥åˆ° Giteeï¼Œä½†é‡åˆ°äº›<a href="https://github.com/Yikun/hub-mirror-action/issues/188">é—®é¢˜</a>æ²¡è§£å†³ã€‚åæ¥å‘ç°å®˜æ–¹å°±æœ‰æä¾›ï¼Œå‚è€ƒã€Š<a href="https://gitee.com/help/articles/4336#article-header3">Gitee ä»“åº“é•œåƒç®¡ç†</a>ã€‹ã€‚</p>
<h2>è®¿é—®ç»Ÿè®¡</h2>
<p>åœ¨ä»“åº“ Insights - Traffic å¤„å¯ä»¥çœ‹åˆ°è¿‘ä¸¤å‘¨çš„æ•°æ®ã€‚ç”±äº GitHub åªæä¾›è¿‘ 14 å¤©çš„æ•°æ®ï¼Œå¯ä»¥åˆ›å»ºå®šæ—¶ä»»åŠ¡ Workflow å°†æ•°æ®ä¿å­˜åˆ°ä»“åº“ï¼Œç”¨äºç»Ÿè®¡æ€»é‡ã€‚</p>
<blockquote>
<p>å¯å‚è€ƒ <a href="https://github.com/toFrankie/blog/blob/main/scripts/update-traffic-data.ts">update-traffic-data.ts</a></p>
</blockquote>
<p>å¦‚æœæƒ³å°†è®¿é—®é‡å±•ç¤ºåˆ° READMEï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ•°æ®ç”Ÿæˆä¸€ä¸ª SVG å›¾ç‰‡ï¼Œå¹¶å¼•ç”¨è¯¥å›¾ç‰‡å³å¯ã€‚</p>
<blockquote>
<p>å¯å‚è€ƒ <a href="https://github.com/toFrankie/blog/blob/main/scripts/update-traffic-views.ts">update-traffic-views.ts</a></p>
</blockquote>
<blockquote>
<p>æˆ‘è¿˜çœ‹è¿‡å¦ä¸€ä¸ªæ–¹æ¡ˆ <a href="https://github.com/88250/hits">Hints</a>ï¼Œå½“åœ¨ README å¼•å…¥å…¶å›¾ç‰‡åï¼Œæ¯è®¿é—® README ä¸€æ¬¡ï¼ˆä¹Ÿå°±æ˜¯ Get ä¸€æ¬¡å›¾ç‰‡ï¼‰ï¼Œè®¿é—®é‡ +1ã€‚ç¼ºç‚¹ä¹Ÿæ˜æ˜¾ï¼Œåªæœ‰è®¿é—® README æ‰ä¼šè¢«ç»Ÿè®¡ï¼Œè®¿é—® issue ç­‰æµé‡æ— æ³•ç»Ÿè®¡ï¼Œä¹Ÿæ— æ³•å»é‡ã€‚</p>
</blockquote>
<h2>RSS</h2>
<p>ä½¿ç”¨ GitHub Issue ä½œä¸ºåšå®¢ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆæ¥åˆ›å»º RSSï¼š</p>
<ul>
<li><a href="https://docs.rsshub.app/routes/programming#repo-issues">RSSHub</a></li>
<li>ä½¿ç”¨ GitHub Action ç”Ÿæˆ RSS</li>
</ul>
<blockquote>
<p>å¦‚æœä½¿ç”¨ Folo è®¢é˜…ï¼Œéƒ½å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/360">æ–‡ç« </a>è®¤é¢†ä½ çš„ RSSã€‚</p>
</blockquote>
<p>å¦‚æœæ˜¯ç¬¬äºŒç§æ–¹å¼ï¼Œå¯å‚è€ƒ <a href="https://github.com/toFrankie/blog/blob/main/scripts/generate-rss.ts">generate-rss.ts</a>ï¼Œå¹¶åœ¨ README ä¸­å¼•å…¥ Badgeï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-md">[![RSS](https://img.shields.io/badge/rss-subscribe-orange?logo=rss&amp;style=flat)](https://raw.githubusercontent.com/toFrankie/blog/refs/heads/main/rss.xml)
</code></pre>
<h2>æ–‡ç« ç»Ÿè®¡</h2>
<p>å¯ä»¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>å­—æ•°ç»Ÿè®¡</li>
<li>æ¯å¹´æ–‡ç« æ•°</li>
<li>è¿‘æœŸçƒ­é—¨æ–‡ç« </li>
<li>è¿‘æœŸåˆ›å»º/æ›´æ–°çš„æ–‡ç« </li>
</ul>
<p>å­—æ•°ç»Ÿè®¡æˆ‘æš‚æ—¶æ²¡åšï¼Œæ€è·¯å¾ˆç®€å•ï¼Œè·å–æ‰€æœ‰ issuesï¼Œç»Ÿè®¡ issue.body æ¸²æŸ“æˆ Markdown æ ¼å¼åçš„å­—æ•°ï¼Œæ‰“ç®—å‚è€ƒ <a href="https://github.com/bytedance/bytemd/blob/9f2212203c780f2d9775e3c2243171cdeea2e81d/packages/bytemd/src/status.svelte#L15">ByteMd</a>ã€‚</p>
<p>æ¯å¹´æ–‡ç« æ•°ï¼Œéå†æ‰€æœ‰ issuesï¼Œæ ¹æ® issue.created_at åˆ¤æ–­å¹´ä»½ï¼Œå¯å¾—å‡ºæ•°æ®ã€‚æˆ‘ä¸ªäººçš„è¯ï¼Œæ›´å–œæ¬¢æ·»åŠ ä¸€ä¸ªå¹´ä»½ Labelï¼Œå¹¶åˆ©ç”¨ GitHub Issue ç­›é€‰åŠŸèƒ½ï¼Œä»¥ä¾¿äºå¿«é€ŸæŸ¥çœ‹æ¯å¹´æ‰€å†™æ–‡ç« ï¼Œè€Œä¸”æˆ‘æœ‰ä¸€äº›å¾€å¹´åœ¨ç®€ä¹¦å†™çš„æ–‡ç« ï¼Œä¹Ÿæ˜¯ä»å»å¹´ä»è¿åˆ° GitHub ä¸Šï¼Œæ‰€ä»¥åˆ›å»ºæ—¶é—´ä¹Ÿå¯¹ä¸ä¸Šã€‚</p>
<p>è¿‘æœŸçƒ­é—¨æ–‡ç« ï¼Œå…¶å®è·Ÿä¸Šä¸€ç« èŠ‚ Traffic æ˜¯ç›¸å…³çš„ï¼Œå®ƒå¯ä»¥è·å–è¿‘ä¸¤å‘¨æ’åå‰ 10 çš„å†…å®¹ï¼Œä½†ä¸å•æŒ‡ issue å†…å®¹ï¼Œè¿˜æœ‰å…¶ä»–çš„ã€‚åªèƒ½æ ¹æ®è¿”å›çš„ path è¿‡æ»¤å¾—åˆ°å¯¹åº”çš„ issueã€‚</p>
<p>è¿‘æœŸåˆ›å»º/æ›´æ–°çš„æ–‡ç« ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ª Workflowï¼Œæ¯å½“ issue è¢«åˆ›å»ºæˆ–ç¼–è¾‘æ—¶è§¦å‘ï¼Œç„¶åä¹Ÿæ˜¯é€šè¿‡ <a href="https://docs.github.com/zh/rest/issues/issues?apiVersion=2022-11-28#list-repository-issues">List repository issues</a> æ¥å£è·å–è¿‘ 10 ç¯‡ï¼ŒåŠ ä¸ªæ’åº sort = updated å³å¯ã€‚å¯å‚è€ƒ<a href="https://github.com/toFrankie/blog/blob/44c4a3e77a8bad26ecfd4b655fa7fe5ea1f997f8/scripts/common.ts#L74">æˆ‘çš„</a>ã€‚</p>
<h2>é…ç½® issue æ¨¡æ¿</h2>
<p>å¯¹äºåšå®¢å‹ä»“åº“ï¼Œæ¯ä¸ª Issue è¡¨ç¤ºä¸€ç¯‡æ–‡ç« ã€‚</p>
<p>é€šå¸¸ä¸å¸Œæœ›ä»–äººåˆ›å»º Issueï¼Œå¯ä»¥å¯¹æ­¤ä½œå‡ºä¸€äº›é™åˆ¶ï¼Œåˆ›å»º <code>.github/ISSUE_TEMPLATE/config.yml</code> æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-yml">blank_issues_enabled: true
contact_links:
  - name: â—ï¸ è¯·å‹¿æ–°å¼€ Issue
    url: https://github.com/toFrankie/blog/discussions/342
    about: é˜…è¯»æ–‡ç« æ—¶ï¼Œå¦‚æœ‰ä»»ä½•æƒ³æ³•ã€å»ºè®®ï¼Œæ¬¢è¿åº•ä¸‹è¯„è®ºï¼ˆæˆ–åœ¨ Discussions å‘èµ·è®¨è®ºï¼‰ï¼Œè€Œä¸æ˜¯æ–°å¼€ Issueã€‚
</code></pre>
<p>å½“ä»–äºº New Issue æ—¶ï¼Œä¼šæç¤ºï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723868949932.png" alt=""></p>
<blockquote>
<p>å¦‚æœæƒ³è¦å½»åº•å…³æ‰ï¼Œå¯å°† <code>blank_issues_enabled</code> è®¾ä¸º <code>false</code>ï¼Œæ›´å¤šè¯·çœ‹<a href="https://docs.github.com/zh/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository#configuring-the-template-chooser">é…ç½®æ¨¡æ¿é€‰æ‹©å™¨</a>ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é€šè¿‡ä¸¤ä¸ªä¾‹å­å†æ¢ Event Loop]]></title>
            <link>https://github.com/toFrankie/blog/issues/348</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/348</guid>
            <pubDate>Sun, 11 Aug 2024 08:42:16 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723914079530.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>æé—®</h2>
<p>â–¼ è¯·é—®ç‚¹å‡»å“ªä¸ªæŒ‰é’®ä¼šå¯¼è‡´é¡µé¢å¡æ­»ï¼Ÿ</p>
<pre]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723914079530.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>æé—®</h2>
<p>â–¼ è¯·é—®ç‚¹å‡»å“ªä¸ªæŒ‰é’®ä¼šå¯¼è‡´é¡µé¢å¡æ­»ï¼Ÿ</p>
<pre><code class="language-html">&lt;article&gt;
  &lt;h1&gt;è’¹è‘­&lt;/h1&gt;
  &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚&lt;/p&gt;
  &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚&lt;/p&gt;
  &lt;p&gt;è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚&lt;/p&gt;
  &lt;p&gt;&lt;/p&gt;
&lt;/article&gt;

&lt;button onclick=&quot;whileLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;
&lt;button onclick=&quot;timerLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;
&lt;button onclick=&quot;promiseLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;

&lt;script&gt;
  function whileLoop() {
    while (true) {}
  }

  function timerLoop() {
    setTimeout(timerLoop, 0)
  }
  
  function promiseLoop() {
    Promise.resolve().then(promiseLoop)
  }
&lt;/script&gt;
</code></pre>
<p>â–¼ è¯·é—®ç‚¹å‡»æŒ‰é’®çº¢è‰² div ä¼šé—ªå—ï¼Ÿ</p>
<pre><code class="language-html">&lt;div id=&quot;box&quot; style=&quot;width: 100px; height: 100px; background: red&quot;&gt;&lt;/div&gt;
&lt;button onclick=&quot;clickme&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;

&lt;script&gt;
  const box = document.getElementById('box')

  function clickme() {
    box.style.display = 'none'
    box.style.display = 'block'
    box.style.display = 'none'
    box.style.display = 'block'
    box.style.display = 'none'
    box.style.display = 'block'
  })
&lt;/script&gt;
</code></pre>
<p>é¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æœ‰ç­”æ¡ˆäº†ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹ã€‚</p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>å¯¹äº Event Loopï¼Œç›¸ä¿¡å¤§å®¶éƒ½æœ‰è¿™æ ·ä¸€å¼ å›¾ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733794120351.png" alt=""></p>
<p>æ¥ä¸‹æ¥ï¼Œå°†ä¼šæ›´æ·±å…¥åœ°äº†è§£ Event Loopï¼ŒçœŸçš„å¦‚ä¸Šå›¾æ‰€ç¤ºå—ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œæˆ‘ä¹Ÿæ˜¯ä»ä»¥ä¸‹é“¾æ¥å—ç›Šï¼Œå¹¶ç»“åˆè‡ªå·±çš„ç†è§£ï¼Œå°†å…¶å†™ä¸‹æ¥è€Œå·²ã€‚</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">Philip Roberts: What the heck is the event loop anyway?</a></li>
<li><a href="https://www.youtube.com/watch?v=u1kqx6AenYw">Erin Zimmer: Further Adventures of the Event Loop</a></li>
<li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0">Jake Archibald: In The Loop</a></li>
</ul>
<h2>ä¸ºä»€ä¹ˆ JavaScript è®¾è®¡æˆå•çº¿ç¨‹ï¼Ÿ</h2>
<p>æœ€åˆ JavaScript æ˜¯ä¸ºæµè§ˆå™¨è€Œè®¾è®¡çš„ï¼Œæ—¨åœ¨å¢å¼ºå¯äº¤äº’æ€§ã€‚</p>
<p>å•çº¿ç¨‹ï¼Œæ„å‘³ç€åŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä½œç”¨äºæŸä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæ˜¯ä¿®æ”¹æ ·å¼ï¼Œå¦ä¸€ä¸ªæ˜¯åˆ é™¤å…ƒç´ ï¼Œå¦‚ä½•å“åº”å‘¢ï¼Ÿå¼•å…¥é”æœºåˆ¶ï¼Ÿ</p>
<p>å½“æ—¶ç½‘é¡µä¸å¦‚ç°åœ¨å¤æ‚ï¼Œé€‰æ‹©å•çº¿ç¨‹æ˜¯æ˜æ™ºã€åˆç†ã€å¤Ÿç”¨çš„ï¼Œæ“ä½œå˜å¾—æœ‰åºå¯æ§ï¼Œä¸”å¤§å¤§é™ä½å¤æ‚åº¦ã€‚</p>
<p>éšç€æ—¶ä»£çš„å‘å±•ï¼Œè®¡ç®—è¶Šæ¥è¶Šå¤æ‚ï¼Œå•çº¿ç¨‹æœ‰ç‚¹æ‰è¥Ÿè§è‚˜ï¼Œåæ¥ HTML5 æä¾›äº† Web Worker ç­‰ API å¯ä¸»åŠ¨åˆ›å»ºæ–°çš„çº¿ç¨‹è¿è¡Œä¸€äº›å¤æ‚çš„è¿ç®—ã€‚</p>
<h2>ä»€ä¹ˆæ˜¯ Event Loop?</h2>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">è§„èŒƒ</a>æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<blockquote>
<p>To coordinate events, user interaction, scripts, rendering, networking, and so forth.
åè°ƒäº‹ä»¶ã€ç”¨æˆ·äº¤äº’ã€è„šæœ¬ã€æ¸²æŸ“ã€ç½‘ç»œç­‰ã€‚</p>
</blockquote>
<p>ä¸ªäººç†è§£ï¼šå®ƒæ˜¯è®©å„ç§ä»»åŠ¡æœ‰åºå¯æ§çš„ä¸€ç§æœºåˆ¶ã€‚</p>
<p>ç”¨ä¼ªä»£ç è¡¨ç¤ºï¼š</p>
<pre><code class="language-js">while (true) {
  task = taskQueue.pop()
  execute(task)
}
</code></pre>
<blockquote>
<p>å½“ç„¶ï¼Œå®é™…æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯ä»ç®€å•è¯´èµ·ï¼Œè¯·ç»§ç»­å¾€ä¸‹ã€‚</p>
</blockquote>
<p>å®ƒæ˜¯æ— é™å¾ªç¯çš„ï¼Œ7 Ã— 24h éšæ—¶å¾…å‘½ï¼Œç›´è‡³æµè§ˆå™¨ Tab è¢«å…³é—­ã€‚</p>
<p>åªè¦æœ‰ä»»åŠ¡ï¼Œå®ƒå°±ä¼šä¸åœåœ°ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</p>
<blockquote>
<p>åœ¨æµè§ˆå™¨ä¸­ï¼ŒEvent Loop æœ‰ Window Event Loopã€Worker Event Loopã€Worklet Event Loop ä¸‰ç§ï¼Œç¬¬ä¸€ç§æ˜¯æœ¬æ–‡ä¸»è¦è®¨è®ºçš„å¯¹è±¡ã€‚å½“ç„¶ Node.js ä¹Ÿæœ‰ Event Loop æœºåˆ¶ï¼Œä½†ä¸å¤ªä¸€æ ·ã€‚</p>
</blockquote>
<h2>ä»€ä¹ˆæ˜¯ Taskï¼Ÿ</h2>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">è§„èŒƒ</a>æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<blockquote>
<p>Formally, a task is a <a href="https://infra.spec.whatwg.org/#struct">struct</a> which has: <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-steps">steps</a>, a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-source">source</a>, a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-document">document</a>, a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a>.
å½¢å¼ä¸Šï¼Œä»»åŠ¡æ˜¯ä¸€ç§ struct ç»“æ„ä½“ï¼ŒåŒ…å« Stepsã€Sourceã€Documentã€Script evaluation environment settings object setã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œä»»åŠ¡å°±æ˜¯ä¸€ä¸ªåŒ…å« steps ç­‰å±æ€§çš„å¯¹è±¡ï¼Œé‡Œé¢è®°å½•äº†ä»»åŠ¡çš„æ¥æºã€æ‰€å± Document å¯¹è±¡ã€ä¸Šä¸‹æ–‡ç­‰ï¼Œä»¥ä¾›åç»­è°ƒåº¦ã€‚</p>
<p>å¸¸è§çš„ä»»åŠ¡æœ‰ï¼š</p>
<ul>
<li>ä¸ç”¨æˆ·å‘ç”Ÿäº¤äº’è€Œäº§ç”Ÿçš„æ‰€æœ‰äº‹ä»¶å›è°ƒï¼ˆæ¯”å¦‚å•å‡»ã€æ–‡æœ¬é€‰æ‹©ã€é¡µé¢æ»šåŠ¨ã€é”®ç›˜è¾“å…¥ç­‰ï¼‰</li>
<li>setTimeoutã€setInterval</li>
<li>æ‰§è¡Œ script å—</li>
<li>I/O æ“ä½œ</li>
</ul>
<h2>ä»€ä¹ˆæ˜¯ Task Queueï¼Ÿ</h2>
<h3>å¸¸è§„æ„ä¹‰çš„é˜Ÿåˆ—</h3>
<p>é˜Ÿåˆ—ï¼ˆ<a href="https://www.wikiwand.com/en/articles/Queue_(data_structure)">Queue</a>ï¼‰æ˜¯ä¸€ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First In First Outï¼‰çš„åŸåˆ™ã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œæœ€å…ˆæ’å…¥çš„å…ƒç´ æœ€å…ˆè¢«ç§»é™¤ï¼Œç±»ä¼¼äºæ’é˜Ÿç­‰å€™çš„åœºæ™¯ã€‚</p>
<ul>
<li>å…¥é˜Ÿï¼ˆEnqueueï¼‰ï¼šå°†ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</li>
<li>å‡ºé˜Ÿï¼ˆDequeueï¼‰ï¼šä»é˜Ÿåˆ—çš„å¤´éƒ¨ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚</li>
</ul>
<h3>Event Loop ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</h3>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">è§„èŒƒ</a>ä¸­æåˆ°ï¼š</p>
<blockquote>
<p>An event loop has one or more <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">task queues</a>.
äº‹ä»¶å¾ªç¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚</p>
</blockquote>
<blockquote>
<p>Task queues are <a href="https://infra.spec.whatwg.org/#ordered-set">sets</a>, not <a href="https://infra.spec.whatwg.org/#queue">queues</a>, because the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">event loop processing model</a> grabs the first <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task-runnable">runnable task</a> from the chosen queue, instead of <a href="https://infra.spec.whatwg.org/#queue-dequeue">dequeuing</a> the first task.'
ä»»åŠ¡é˜Ÿåˆ—æ˜¯é›†åˆï¼Œè€Œä¸æ˜¯é˜Ÿåˆ—ï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯å¤„ç†æ¨¡å‹ä»æ‰€é€‰é˜Ÿåˆ—ä¸­è·å–ç¬¬ä¸€ä¸ªå¯è¿è¡Œçš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä½¿ç¬¬ä¸€ä¸ªä»»åŠ¡å‡ºé˜Ÿã€‚</p>
</blockquote>
<blockquote>
<p>The <a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask-queue">microtask queue</a> is not a task queue.
å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸æ˜¯ä»»åŠ¡é˜Ÿåˆ—ã€‚</p>
</blockquote>
<p>å‰é¢æåˆ°ï¼Œtask æ˜¯æœ‰ source çš„ï¼Œæ¯”å¦‚æ¥è‡ªé¼ æ ‡ç‚¹å‡»ç­‰ã€‚<a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">æ’é˜Ÿ</a>æ—¶ï¼ŒåŒ source çš„ task ä¼šè¢«æ”¾å…¥ä¸è¯¥ source ç›¸å…³çš„ task queue é‡Œã€‚å‡è®¾é¼ æ ‡äº‹ä»¶çš„ä»»åŠ¡è¦ä¼˜äºå…¶ä»–ä»»åŠ¡ï¼ŒEvent Loop å°±å¯ä»¥åœ¨å¯¹åº” source çš„ task queue ä¸­å–å‡ºä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚è§„èŒƒé‡Œ Event Loop æ‰§è¡Œ<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">æ­¥éª¤</a>å¹¶æ²¡æœ‰æ˜ç¡®å®šä¹‰â€œå‡ºé˜Ÿâ€çš„è§„åˆ™ï¼Œå®ƒå–å†³äºæµè§ˆå™¨çš„å®ç°ã€‚</p>
<blockquote>
<p>Let taskQueue be one such task queue, chosen in an implementation-defined manner.</p>
</blockquote>
<p>ç°åœ¨ Event Loop ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (true) {
  queue = getNextQueue()
  task = queue.getFirstRunnableTask()
  execute(task)
}
</code></pre>
<blockquote>
<p>ğŸ˜² åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘çš„è®¤çŸ¥æ˜¯ï¼šä¸€ä¸ª Event Loop é‡Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸”å®ƒæ˜¯ä¸€ä¸ªå¸¸è§„æ„ä¹‰çš„é˜Ÿåˆ—ã€‚è™½è¯´å¦‚æ­¤ï¼Œå¦‚æœåªæƒ³äº†è§£ Event Loop ä¸»è¦æ‰§è¡Œé¡ºåºï¼Œä¸æ·±å…¥æµè§ˆå™¨ç©¶ç«Ÿç»´æŠ¤äº†å¤šå°‘ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€æµè§ˆå™¨å¦‚ä½•å†³å®šä¸‹ä¸€ä»»åŠ¡ï¼ŒæŒ‰åŸæ¥çš„ç†è§£ä¹Ÿé—®é¢˜ä¸å¤§ã€‚</p>
</blockquote>
<h2>ä»€ä¹ˆæ—¶å€™é‡ç»˜é¡µé¢ï¼Ÿ</h2>
<p>æ€»ä¸èƒ½åªæ‰§è¡Œä»»åŠ¡ï¼Œä¸æ›´æ–° DOM å§ã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œç½‘é¡µå°±æ˜¯ç»™äººçœ‹çš„ï¼Œä¸äººäº¤äº’çš„ï¼Œæ‰€ä»¥ç”¨æˆ·ä½“éªŒéå¸¸é‡è¦ã€‚å‡è®¾ä»»åŠ¡é˜Ÿåˆ—æœ‰æºæºä¸æ–­çš„ä»»åŠ¡äº§ç”Ÿï¼Œå¦‚æœ Event Loop åªä¼šä¸€ç›´å¾ªç¯æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œè€Œä¸å»æ›´æ–°é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒæ˜¯éå¸¸ç³Ÿç³•çš„ã€‚</p>
<p>è¯·é—®æµè§ˆå™¨ä»€ä¹ˆæ—¶å€™ä¼šæ›´æ–°é¡µé¢ï¼Ÿ</p>
<p>æµè§ˆå™¨æ˜¯éå¸¸èªæ˜çš„ï¼Œæ²¡å¿…è¦çš„å·¥ä½œå®ƒä¸ä¼šåšã€‚ä»¥ 60Hz å±å¹•ä¸ºä¾‹ï¼Œæ¯ç§’åˆ·æ–° 60 æ¬¡ï¼Œçº¦ 16.7ms åˆ·æ–°ä¸€æ¬¡ã€‚åªè¦æ»¡è¶³è¯¥åˆ·æ–°é¢‘ç‡çš„ï¼Œæ˜¾ç¤ºå°±ç®—æ˜¯æµç•…çš„ï¼Œå› ä¸ºå†å¿«çš„åˆ·æ–°é¢‘ç‡å¯¹è‚‰çœ¼æ¥è¯´ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾çš„æ„ŸçŸ¥ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ 16.7ms å¯è·å¾—ä¸€æ¬¡æ¸²æŸ“æœºä¼šï¼ˆ<a href="https://html.spec.whatwg.org/multipage/webappapis.html#rendering-opportunity">rendering opportunity</a>ï¼‰ï¼Œè¿™æ ·æµè§ˆå™¨å°±çŸ¥é“è¦æ›´æ–° DOM äº†ã€‚</p>
<blockquote>
<p>å‡è®¾ä¸€ä¸ªä»»åŠ¡è€—æ—¶ 3 ~ 5msï¼Œè¿œæ²¡åˆ° 16.7msï¼Œå¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæ­¤æ—¶æ›´æ–° DOM æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œå› æ­¤ä¹Ÿä¸ä¼šè·å¾—ä¸€ä¸ªæ¸²æŸ“æœºä¼šã€‚ç›¸ååœ°ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè¶…è¿‡ 16.7msï¼Œå‘ˆç°å‡ºæ¥çš„æ•ˆæœæœ‰å¯èƒ½æ˜¯å¡é¡¿çš„ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼Œè§„èŒƒä¸­ä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ä»»ä½•ç‰¹å®šæ¨¡å‹æ¥é€‰æ‹©æ¸²æŸ“æœºä¼šã€‚ä½†ä¾‹å¦‚ï¼Œå¦‚æœæµè§ˆå™¨å°è¯•å®ç° 60Hz åˆ·æ–°ç‡ï¼Œåˆ™æ¸²æŸ“æœºä¼šæœ€å¤šæ¯ 60 ç§’å‡ºç°ä¸€æ¬¡ï¼ˆçº¦ 16.7msï¼‰ã€‚å¦‚æœæµè§ˆå™¨å‘ç° <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#navigables">navigable</a> æ— æ³•ç»´æŒæ­¤é€Ÿç‡ï¼Œåˆ™è¯¥ navigable å¯èƒ½ä¼šä¸‹é™åˆ°æ›´å¯æŒç»­çš„æ¯ç§’ 30 ä¸ªæ¸²æŸ“æœºä¼šï¼Œè€Œä¸æ˜¯å¶å°”ä¸¢å¸§ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœ navigable ä¸å¯è§ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå†³å®šå°†è¯¥é¡µé¢é™ä½åˆ°æ¯ç§’ 4 ä¸ªæ¸²æŸ“æœºä¼šï¼Œç”šè‡³æ›´å°‘ã€‚</p>
</blockquote>
<blockquote>
<p>React 16 å¯ä¸­æ–­çš„è°ƒåº¦æœºåˆ¶ï¼Œå°±æ˜¯ä¸ºäº†å¯ä»¥æ‰§è¡Œä¼˜å…ˆçº§æ›´é«˜çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚æ›´æ–° DOMï¼‰ï¼Œä»¥è§£å†³æŸäº›åœºæ™¯ä¸‹é¡µé¢å¡é¡¿çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œå¦‚æœæœ‰æ¸²æŸ“æœºä¼šå…ˆæ›´æ–° DOMï¼Œæ¥ç€æ‰æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>ç°åœ¨ Event Loop ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (true) {
  queue = getNextQueue()
  task = queue.getFirstRunnableTask()
  execute(task)
  
  if (hasRendringOpportunity()) repaint()
}
</code></pre>
<h2>ä»€ä¹ˆæ˜¯ Microtaskï¼Ÿ</h2>
<p>è¿˜æ²¡å®Œï¼Œè¿˜æ²¡å®Œ...</p>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask-queue">è§„èŒƒ</a>ä¸­æåˆ°ï¼š</p>
<blockquote>
<p>Each event loop has a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask-queue">microtask queue</a>, which is a <a href="https://infra.spec.whatwg.org/#queue">queue</a> of microtasks, initially empty.</p>
</blockquote>
<blockquote>
<p>A <a href="https://html.spec.whatwg.org/multipage/webappapis.html#microtask">microtask</a> is a colloquial way of referring to a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">task</a> that was created via the <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask">queue a microtask</a> algorithm.</p>
</blockquote>
<blockquote>
<p>The microtask queue is not a <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">task queue</a>.</p>
</blockquote>
<p>å¥½ï¼Œæˆ‘ä»¬é‡æ–°æ‹ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ª Event Loop æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª task queueã€‚</li>
<li>ä¸€ä¸ª Event Loop æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª microtask queueã€‚</li>
<li>task æ˜¯ä¸€ä¸ªç”±ç‰¹å®šå±æ€§çš„å¯¹è±¡ï¼ˆè§„èŒƒä¸­ç§°ä¸º <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">struct</a>ï¼‰ã€‚</li>
<li>microtask åªæ˜¯ä¸€ç§é€šä¿—çš„è¯´æ³•ï¼Œå®ƒæ˜¯é€šè¿‡<a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask">ç‰¹å®šç®—æ³•</a>åˆ›å»ºçš„ taskã€‚</li>
<li>task queue æ˜¯ä¸€ç»„ task çš„<a href="https://infra.spec.whatwg.org/#ordered-set">é›†åˆ</a>ï¼Œå¹¶ä¸æ˜¯<a href="https://infra.spec.whatwg.org/#queue">é˜Ÿåˆ—</a>ã€‚</li>
<li>microtask æ˜¯å¸¸è§„æ„ä¹‰çš„é˜Ÿåˆ—ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºã€‚</li>
<li>microtask queue ä¸æ˜¯ task queueï¼Œå‰è€…æ˜¯é˜Ÿåˆ—ï¼Œåè€…æ˜¯é›†åˆã€‚</li>
</ul>
<p>ä¸ºä¾¿äºåŒºåˆ†ç†è§£ï¼Œæœ¬æ–‡æš‚ä¸”å°†ä»¥ä¸‹è§„èŒƒæœ¯è¯­å£è¯­åŒ–ï¼ˆ<strong>ä½†æ³¨æ„ï¼Œè¿™ç§è¯´æ³•ä¸ä¸€å®šå‡†ç¡®</strong>ï¼‰ã€‚</p>
<ul>
<li>taskï¼šï¼ˆå®ï¼‰ä»»åŠ¡</li>
<li>task queueï¼šï¼ˆå®ï¼‰ä»»åŠ¡é˜Ÿåˆ—</li>
<li>microtaskï¼šå¾®ä»»åŠ¡</li>
<li>microtask queueï¼šå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
</ul>
<h3>æœ‰å“ªäº›å¾®ä»»åŠ¡ï¼Ÿ</h3>
<p>åœ¨ JavaScript é‡Œä¼šäº§ç”Ÿå¾®ä»»åŠ¡çš„å¤§æ¦‚æœ‰ï¼š</p>
<ul>
<li>queueMicrotaskï¼ˆWindow æˆ– Web Workerï¼‰</li>
<li>Promise å›è°ƒ</li>
<li>MutationObserver å›è°ƒ</li>
<li>Object.observeï¼ˆDeprecatedï¼‰</li>
</ul>
<h3>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¾®ä»»åŠ¡ï¼Ÿ</h3>
<p>ä»è§„èŒƒï¼ˆ<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">Processing model</a>ï¼‰å¯çŸ¥ï¼Œåªè¦ Event Loop å­˜åœ¨ï¼Œå°±å¿…é¡»ä¸æ–­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ä»ï¼ˆå®ï¼‰ä»»åŠ¡é˜Ÿåˆ—å–å‡ºä¸€ä¸ª task</li>
<li>æ‰§è¡Œè¯¥ task</li>
<li>æ‰§è¡Œå¾®ä»»åŠ¡æ£€æŸ¥ç‚¹ï¼ˆ<a href="https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint">microtask checkpoint</a>ï¼‰
<ol>
<li>å¦‚æœæ£€æŸ¥ç‚¹æ ‡å¿—ä¸ºçœŸï¼ˆåˆå§‹å€¼ä¸º falseï¼‰ï¼Œåˆ™è¿”å›ï¼ˆè·³å‡ºå¾®ä»»åŠ¡æ‰§è¡Œï¼‰ã€‚</li>
<li>å°†æ£€æŸ¥ç‚¹æ ‡å¿—è®¾ä¸º true</li>
<li>å¦‚æœå½“å‰ Event Loop é‡Œçš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå°†ä¸€ç›´å¾ªç¯ç›´è‡³å¾®é˜Ÿåˆ—ä¸ºç©ºï¼š
<ol>
<li>åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œå–å‡ºçš„ç¬¬ä¸€ä¸ªå¾®ä»»åŠ¡</li>
<li>æ‰§è¡Œå¾®ä»»åŠ¡</li>
</ol>
</li>
<li>å°†æ£€æŸ¥ç‚¹æ ‡å¿—è®¾ä¸º false</li>
</ol>
</li>
<li>é‡å¤ä¸Šè¿°æ­¥éª¤</li>
</ol>
<blockquote>
<p>ä»¥ä¸Šä¸ºç®€åŒ–åçš„æ­¥éª¤ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œæ–‡ç« å¼€å¤´çš„æé—®ä¹‹ä¸€å°±æœ‰ç­”æ¡ˆã€‚ç”±äºå®ƒåœ¨æ‰§è¡Œå¾®ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ä¸åœåœ°äº§ç”Ÿæ–°çš„å¾®ä»»åŠ¡ï¼Œå› æ­¤å°†ä¼šåœ¨ 3.iii é™·å…¥æ­»å¾ªç¯ï¼Œè‡ªç„¶é¡µé¢å°±â€œå¡æ­»â€äº†ã€‚</p>
<h3>è·Ÿ task çš„ä¸€äº›åŒºåˆ«</h3>
<p>è¯·æ³¨æ„ï¼Œæ— è®ºæ˜¯ï¼ˆå®ï¼‰ä»»åŠ¡ï¼Œè¿˜æ˜¯å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½å¯èƒ½äº§ç”Ÿâ€œæ–°â€çš„ï¼ˆå®ï¼‰ä»»åŠ¡æˆ–å¾®ä»»åŠ¡ã€‚å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯æœ‰åŒºåˆ«çš„ï¼š</p>
<ul>
<li>ï¼ˆå®ï¼‰ä»»åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ–°çš„ï¼ˆå®ï¼‰ä»»åŠ¡ï¼Œåœ¨ä¸‹ä¸€è½®æˆ–ä»¥åæ‰§è¡Œã€‚</li>
<li>ï¼ˆå®ï¼‰ä»»åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ–°çš„å¾®ä»»åŠ¡ï¼Œåœ¨å½“å‰ï¼ˆå®ï¼‰ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åã€æ›´æ–° DOM æˆ–ä¸‹ä¸€è½®ï¼ˆå®ï¼‰ä»»åŠ¡ä¹‹å‰æ‰§è¡Œã€‚</li>
<li>å¾®ä»»åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ–°çš„ï¼ˆå®ï¼‰ä»»åŠ¡ï¼Œåœ¨ä¸‹ä¸€è½®æˆ–ä»¥åæ‰§è¡Œã€‚</li>
<li>å¾®ä»»åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ–°çš„å¾®ä»»åŠ¡ï¼Œé©¬ä¸Šæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç›´åˆ°æ‰€æœ‰å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œï¼Œæ‰åˆ°æ›´æ–° DOM æˆ–æ‰§è¡Œä¸‹ä¸€è½®ï¼ˆå®ï¼‰ä»»åŠ¡ã€‚</li>
</ul>
<p>ç°åœ¨ Event Loop ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (true) {
  queue = getNextQueue()
  task = queue.getFirstRunnableTask()
  execute(task)
  
  while (microtaskQueue.hasTask() {
    microtask = microtaskQueue.pop()
    excute(microtask)
  }
  
  if (hasRendringOpportunity()) repaint()
}
</code></pre>
<h2>ä»€ä¹ˆæ˜¯ requestAnimationFrameï¼Ÿ</h2>
<p>å™¢ï¼Œè¿˜æ²¡å®Œï¼Œè¿˜æœ‰ä¸€ä¸ª requestAnimationFrameï¼Œå…¶å›è°ƒå‡½æ•°ä¼šåœ¨é¡µé¢é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚</p>
<p>å½“æµè§ˆå™¨æ£€æµ‹åˆ°æœ‰æ¸²æŸ“æœºä¼šï¼Œä¼šæ›´æ–° DOMï¼Œå…·ä½“æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰§è¡Œ requestAnimationFrame å›è°ƒ</li>
<li>åˆæˆï¼šè®¡ç®—æ ·å¼ï¼Œå°† DOM Tree å’Œ CSSOM Tree åˆæˆä¸€ä¸ª Render Treeï¼ˆAttachmentï¼‰</li>
<li>é‡æ’ï¼šä»¥ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹æ‰€å ç©ºé—´ã€æ‰€åœ¨ä½ç½®ç­‰ï¼ˆLayoutï¼‰</li>
<li>é‡ç»˜ï¼šä»¥è®¾ç½®é¢œè‰²ç­‰ï¼ˆPaintï¼‰</li>
</ol>
<blockquote>
<p>æ¯”è¾ƒå‘çš„æ˜¯ï¼ŒEdge å’Œ Safari å°† requestAnimationFrame å›è°ƒæ”¾åˆ° Paint åé¢æ‰§è¡Œï¼Œè¿™æ˜¯éæ ‡å‡†åšæ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå›è°ƒä¸­æ¶‰åŠæ ·å¼ï¼Œç”¨æˆ·è¦åœ¨ä¸‹ä¸€å¸§æ‰èƒ½çœ‹åˆ°å˜åŒ–ã€‚</p>
</blockquote>
<blockquote>
<p>Safari æ˜¯å¦å·²ä¿®å¤ï¼Œå¾…éªŒè¯ã€‚</p>
</blockquote>
<p>é™¤äº†æœ‰ task queueï¼ˆé›†åˆï¼‰ã€microtask queueï¼ˆé˜Ÿåˆ—ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ª animation frame callbacksï¼Œå®ƒæ˜¯ä¸€ä¸ª ordered mapï¼ˆ<a href="https://infra.spec.whatwg.org/#ordered-map">æ˜ å°„</a>ï¼‰ã€‚</p>
<blockquote>
<p>å°† animation frame callbacks ç®€å•ç†è§£ä¸ºâ€œé˜Ÿåˆ—â€ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œå› ä¸ºæ ¹æ® <a href="https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#run-the-animation-frame-callbacks">run the animation frame callbacks</a> å¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿæ˜¯ä»ç¬¬ä¸€ä¸ªå¼€å§‹éå†æ‰§è¡Œã€‚</p>
</blockquote>
<p>åŒæ ·åœ°ï¼Œæ‰§è¡Œ callbacks çš„è¿‡ç¨‹ä¸­äº§ç”Ÿæ–°çš„ callbackï¼Œå®ƒä»¬ä¼šæ”¾åˆ°ä¸‹ä¸€æ¬¡ Loop æ‰§è¡Œï¼Œè¿™ç‚¹è·Ÿå¾®ä»»åŠ¡æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>ç°åœ¨ Event Loop ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (true) {
  queue = getNextQueue()
  task = queue.getFirstRunnableTask()
  execute(task)
  
  while (microtaskQueue.hasTask() {
    microtask = microtaskQueue.pop()
    excute(microtask)
  }
  
  if (hasRendringOpportunity()) {
    callbacks = animationFrameCallbacks.spliceAll()
    for (callback in callbacks) {
      execute(callback)
    }
    
    repaint()
  }
}
</code></pre>
<h2>Node.js Event Loop æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</h2>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒNode.js é‡Œæ²¡æœ‰ä»¥ä¸‹è¿™äº›ï¼š</p>
<ul>
<li>æ²¡æœ‰ &lt;script&gt; è§£æ</li>
<li>æ²¡æœ‰ç”¨æˆ·äº¤äº’</li>
<li>æ²¡æœ‰ DOM</li>
<li>æ²¡æœ‰ requestAnimationFrame</li>
</ul>
<p>Node.js ç‰¹æœ‰çš„æ˜¯ï¼š</p>
<ul>
<li>setImmediate</li>
<li>process.nextTick</li>
</ul>
<p>Node.js çš„ Event Loop ç”± libuv å®ç°ï¼ŒåŒ…å«ä»¥ä¸‹é˜¶æ®µï¼š</p>
<pre><code>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€&gt;â”‚           timers          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚
â”‚  â”‚           poll            â”‚&lt;â”€â”€â”€â”€â”€â”¤  connections, â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚           check           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤      close callbacks      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p><a href="https://nodejs.org/en/learn/asynchronous-work/event-loop-timers-and-nexttick">The Node.js Event Loop</a></p>
</blockquote>
<ul>
<li>timersï¼šæ‰§è¡Œ setTimeoutã€setInterval çš„å›è°ƒã€‚</li>
<li>pending callbacksï¼šæ‰§è¡Œä¸€äº›ç³»ç»Ÿæ“ä½œçš„å›è°ƒï¼Œæ¯”å¦‚ TCP é”™è¯¯ç­‰ã€‚</li>
<li>idle, prepareï¼šä»…åœ¨å†…éƒ¨ä½¿ç”¨ã€‚</li>
<li>pollï¼šå‡ ä¹æ‰€æœ‰å¼‚æ­¥å›è°ƒéƒ½åœ¨è¿™ä¸ªé˜¶æ®µæ‰§è¡Œï¼Œé™¤ setTimeoutã€setInterval å’Œ setImmediate ä¹‹å¤–ã€‚</li>
<li>checkï¼šæ‰§è¡Œ setImmediate çš„å›è°ƒã€‚</li>
<li>close callbacksï¼šæ‰§è¡Œå…³é—­äº‹ä»¶ï¼Œæ¯”å¦‚ socket æˆ– handle çªç„¶å…³é—­ï¼Œä¼šå‘å‡º close äº‹ä»¶ã€‚</li>
</ul>
<p>åœ¨ Node.js ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ <code>process.nextTick()</code> æ–¹æ³•ã€‚æŠ€æœ¯ä¸Šï¼Œå®ƒä¸å±äºäº‹ä»¶å¾ªç¯çš„ä¸€éƒ¨åˆ†ã€‚å½“ä½ åœ¨æŸä¸ªé˜¶æ®µè°ƒç”¨æ—¶ï¼Œä¼ é€’ç»™å®ƒçš„æ‰€æœ‰å›è°ƒå°†åœ¨å½“å‰é˜¶æ®µæ‰§è¡Œå®Œä¹‹åï¼Œä¸‹ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚å¦‚æœé€’å½’è°ƒç”¨å®ƒï¼Œæ˜¯ä¼šé€ æˆæ­»å¾ªç¯çš„ã€‚</p>
<p>ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (tasksAreWaiting()) {
  queue = getNextQueue()
  
  while (queue.hasTask()) {
    task = queue.pop()
    execute(task)
    
    while (nextTickQueue.hasTask()) {
      callback = nextTickQueue.pop()
      excute(callback)
    }
    
    while (promiseQueue.hasTask() {
      promise = promiseQueue.pop()
      excute(promise)
    }
  }
}
</code></pre>
<h2>Worker Event Loop åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</h2>
<p>å®ƒæ›´ç®€å•ï¼š</p>
<ul>
<li>æ²¡æœ‰ &lt;script&gt; è§£æ</li>
<li>æ²¡æœ‰ç”¨æˆ·äº¤äº’</li>
<li>æ²¡æœ‰ DOMï¼ˆWorker ä¸èƒ½ç›´æ¥æ“ä½œ DOMï¼‰</li>
<li>æ²¡æœ‰ requestAnimationFrame</li>
<li>æ²¡æœ‰ process.nextTick</li>
<li>æ²¡æœ‰ setImmediate</li>
</ul>
<p>ä¸”çº¿ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ Event Loopï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<p>ç°åœ¨ Event Loop ç”¨ä¼ªä»£ç è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">while (true) {
  task = taskQueue.pop()
  execute(task)
  
  while (microtaskQueue.hasTask() {
    microtask = microtaskQueue.pop()
    excute(microtask)
  }
}
</code></pre>
<p>ä½†æ³¨æ„ï¼Œå¦‚æœåœ¨ Web Worker çš„çº¿ç¨‹å‘ä¸»çº¿ç¨‹ä¼ é€’æ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯å¯¹äº Window Event Loop æ¥è¯´å±äºä¸€ä¸ª taskï¼Œå®ƒä»å—ä¸»çº¿ç¨‹çš„ Event Loop æ§åˆ¶ï¼Œè¯¥æ’é˜Ÿè¿˜å¾—æ’é˜Ÿã€‚</p>
<h2>æ€è€ƒé¢˜</h2>
<p>å…ˆå›åˆ°æ–‡ç« å¼€å¤´çš„é¢˜ç›®ã€‚</p>
<h3>ç‚¹å‡»å“ªä¸ªæŒ‰é’®ä¼šå¯¼è‡´é¡µé¢å¡æ­»ï¼Ÿ</h3>
<pre><code class="language-html">&lt;article&gt;
  &lt;h1&gt;è’¹è‘­&lt;/h1&gt;
  &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚&lt;/p&gt;
  &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚&lt;/p&gt;
  &lt;p&gt;è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚&lt;/p&gt;
  &lt;p&gt;&lt;/p&gt;
&lt;/article&gt;

&lt;button onclick=&quot;whileLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;
&lt;button onclick=&quot;timerLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;
&lt;button onclick=&quot;promiseLoop()&quot;&gt;ç‚¹æˆ‘&lt;/button&gt;

&lt;script&gt;
  function whileLoop() {
    while (true) {}
  }

  function timerLoop() {
    setTimeout(timerLoop, 0)
  }
  
  function promiseLoop() {
    Promise.resolve().then(promiseLoop)
  }
&lt;/script&gt;
</code></pre>
<p>ç­”æ¡ˆï¼šwhileLoopã€promiseLoop ä¼šå¯¼è‡´é¡µé¢å¡æ­»ï¼ŒtimerLoop åˆ™ä¸ä¼šã€‚</p>
<p>whileLoop åˆ†æï¼šç‚¹å‡»æŒ‰é’®ï¼Œäº§ç”Ÿä¸€ä¸ª taskï¼Œè¿›å…¥ task queue æ’é˜Ÿã€‚è½®åˆ°å®ƒçš„æ—¶å€™ï¼Œæ‰§è¡Œ whileLoop() æ–¹æ³•ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªæ— çº¿å¾ªç¯çš„ while è¯­å¥ï¼Œå› æ­¤è¿™ä¸ª task ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œä¸”è‡´ä½¿åé¢çš„ taskã€æ›´æ–° DOM ç­‰æ°¸è¿œæ— æ³•æ‰§è¡Œã€‚é¡µé¢å°±å¡æ­»äº†ã€‚</p>
<p>timerLoop åˆ†æï¼šç‚¹å‡»æŒ‰é’®ï¼Œäº§ç”Ÿä¸€ä¸ª taskï¼Œè¿›å…¥ task queue æ’é˜Ÿã€‚è½®åˆ°å®ƒçš„æ—¶å€™ï¼Œæ‰§è¡Œ timerLoop() æ–¹æ³•ï¼Œåˆäº§ç”Ÿä¸€ä¸ª task å¹¶æ”¾å…¥ task queueã€‚æ‰§è¡Œå®Œä¹‹åï¼Œå¦‚æœæœ‰ rendering opportunity ä¼šå…ˆæ›´æ–° DOMï¼Œå®Œäº†æ‰§è¡Œè¿›è¡Œä¸‹ä¸€è½®ã€‚å°½ç®¡ timerLoop é‡Œä¸åœåœ°äº§ç”Ÿæ–°çš„ taskï¼Œä½†ç”¨æˆ·ä»ç„¶é€šè¿‡æ–‡æœ¬é€‰æ‹©ã€é¡µé¢æ»šåŠ¨ç­‰äº§ç”Ÿå…¶ä»– task è¿›å…¥åˆ° task queue è¿›è¡Œæ’é˜Ÿã€‚å› æ­¤é¡µé¢æ˜¯ä¸ä¼šå‘ˆç°å¡æ­»çŠ¶æ€çš„ã€‚</p>
<p>promiseLoop åˆ†æï¼šç‚¹å‡»æŒ‰é’®ï¼Œäº§ç”Ÿä¸€ä¸ª taskï¼Œè¿›å…¥ task queue æ’é˜Ÿã€‚è½®åˆ°å®ƒçš„æ—¶å€™ï¼Œæ‰§è¡Œ promiseLoop() æ–¹æ³•ï¼Œå…¶ä¸­ Promise.resolve() äº§ç”Ÿä¸€ä¸ª microtask å¹¶æ”¾å…¥ microtask queueã€‚å½“ task æ‰§è¡Œå®Œï¼Œæ¥ç€ä» microtask queue é‡Œå–å‡º microtask æ‰§è¡Œï¼Œå³æ‰§è¡Œ then(promiseLoop)ï¼Œå®ƒæœ‰åˆäº§ç”Ÿæ–°çš„ microtaskï¼Œæ‰€ä»¥ microtask queue å°±ä¸€ç›´æœ‰ä»»åŠ¡å­˜åœ¨ï¼Œå› æ­¤ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œè‡´ä½¿åé¢çš„ taskã€æ›´æ–° DOM ç­‰æ°¸è¿œæ— æ³•æ‰§è¡Œã€‚</p>
<h3>å®ƒä»¬ä¼šé—ªçƒå—ï¼Ÿ</h3>
<p>ä½ æœ‰æ²¡æœ‰æ‹…å¿ƒè¿‡è¿™äº›ä»£ç ä¼šâ€œé—ªâ€ä¸€ä¸‹ï¼Ÿ</p>
<pre><code class="language-js">document.body.appendChild(element)
element.style.display = 'none'
</code></pre>
<blockquote>
<p>å½“ç„¶ï¼Œå®é™…ä¸­æ›´å¤šæ˜¯å…ˆè®¾ç½®æ ·å¼å† appendChildï¼Œä½†æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
</blockquote>
<p>è¯·é—®ç‚¹å‡»æŒ‰é’®çº¢è‰²å—ä¼šé—ªçƒå—ï¼Ÿ</p>
<pre><code class="language-html">&lt;div id=&quot;box&quot; style=&quot;width: 100px; height: 100px; background: red&quot;&gt;&lt;/div&gt;
&lt;button id=&quot;btn&quot;&gt;Click me&lt;/button&gt;

&lt;script&gt;
  const btn = document.getElementById('btn')
  const box = document.getElementById('box')

  btn.addEventListener('click', () =&gt; {
    box.style.display = 'none'
    box.style.display = 'block'
    box.style.display = 'none'
    box.style.display = 'block'
    box.style.display = 'none'
    box.style.display = 'block'
    // ...
  })
&lt;/script&gt;
</code></pre>
<p><a href="https://codepen.io/tofrankie/pen/vYqdGKK">CodePen</a></p>
<blockquote>
<p>ç­”æ¡ˆï¼šéƒ½ä¸ä¼šã€‚</p>
</blockquote>
<p>åˆ†æï¼šä¸Šè¿°ç‚¹å‡»äº‹ä»¶äº§ç”Ÿä¸€ä¸ª taskï¼ˆäº‹ä»¶å›è°ƒï¼‰ï¼Œåªæœ‰æ‰§è¡Œå®Œ task é‡Œé¢çš„ä»£ç ï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å¾®ä»»åŠ¡æˆ–æ›´æ–° DOMã€‚ä¹Ÿå°±æ˜¯è¯´æ¸²æŸ“ä¹‹å‰ï¼Œå®é™…åªæœ‰æœ€åä¸€è¡Œçš„æ ·å¼è®¾ç½®æ˜¯èµ·ä½œç”¨çš„ï¼Œä¸ç®¡ä¸­é—´è®¾äº†å¤šå°‘éï¼Œæµè§ˆå™¨åªå…³å¿ƒæœ€åçš„æ ·å¼å¦‚ä½•ã€‚</p>
<h3>å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼Ÿ</h3>
<p>ä»¥ä¸‹ç¤ºä¾‹ï¼Œä¸€ä¸ªæŒ‰é’®ç»‘å®šäº†ä¸¤ä¸ª click äº‹ä»¶ï¼š</p>
<pre><code class="language-js">&lt;button id=&quot;btn&quot;&gt;Click me&lt;/button&gt;

&lt;script&gt;
  const btn = document.getElementById('btn')

  btn.addEventListener('click', () =&gt; {
    Promise.resolve().then(() =&gt; console.log('microtask 1'))
    console.log('listener 1')
  })

  btn.addEventListener('click', () =&gt; {
    Promise.resolve().then(() =&gt; console.log('microtask 2'))
    console.log('listener 2')
  })
  
  // btn.click()
&lt;/script&gt;
</code></pre>
<p>ç°è§¦å‘ click äº‹ä»¶çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ä¸ªæ˜¯é€šè¿‡é¼ æ ‡ç‚¹å‡»è§¦å‘ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡ <code>btn.click()</code> è§¦å‘ã€‚è¿™ä¸¤ç§æ–¹å¼çš„æ‰§è¡Œé¡ºåºä¸€æ ·å—ï¼Ÿ</p>
<p>é€šè¿‡é¼ æ ‡ç‚¹å‡»çš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="language-txt">listener 1
microtask 1
listener 2
microtask 2
</code></pre>
<p>é€šè¿‡ <code>btn.click()</code> çš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="language-txt">listener 1
listener 2
microtask 1
microtask 2
</code></pre>
<p>åŸå› åˆ†æï¼šé€šè¿‡ä¸ç”¨æˆ·äº¤äº’è€Œè§¦å‘çš„äº‹ä»¶ï¼Œå…¶ç›‘å¬å™¨æ˜¯å¼‚æ­¥è°ƒç”¨çš„ï¼Œè€Œé€šè¿‡ <code>btn.click()</code> è§¦å‘ï¼Œä¼šåŒæ­¥æ´¾å‘äº‹ä»¶ï¼Œå¹¶ä»¥åˆé€‚çš„é¡ºåºåŒæ­¥åœ°è°ƒç”¨ç›‘å¬å™¨ã€‚</p>
<p>å¯¹äºâ€œé¼ æ ‡â€ç‚¹å‡»ï¼šç”±äº btn æ³¨å†Œäº†ä¸¤ä¸ª click ç›‘å¬å™¨ï¼Œé¼ æ ‡ç‚¹å‡»ä¸€æ¬¡ï¼Œäº§ç”Ÿä¸¤ä¸ª task è¿›å…¥ task queueï¼Œå…ˆåæ‰§è¡Œï¼Œå› æ­¤å¾—åˆ°å‰é¢çš„ç»“æœã€‚</p>
<p>å¯¹äº <code>btn.click()</code> æ¨¡æ‹Ÿç‚¹å‡»ï¼šå½“æ‰§è¡Œåˆ° <code>btn.click()</code> æ—¶ï¼ŒæŒ‰é¡ºåºåŒæ­¥æ‰§è¡Œä¸¤ä¸ªç›‘å¬å™¨ã€‚</p>
<blockquote>
<p>The <code>dispatchEvent()</code> method of the EventTarget sends an Event to the object, (synchronously) invoking the affected event listeners in the appropriate order. The normal event processing rules (including the capturing and optional bubbling phase) also apply to events dispatched manually with <code>dispatchEvent()</code>.</p>
</blockquote>
<ol>
<li>æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªç›‘å¬å™¨ Promise.resolve() æ—¶äº§ç”Ÿä¸€ä¸ª microtask å…¥é˜Ÿåˆ° microtask queueã€‚</li>
<li>æ¥ç€æ‰“å° listener 1ã€‚</li>
<li>æ³¨æ„ï¼Œæ­¤æ—¶è°ƒç”¨æ ˆé‡Œè¿˜æ²¡æ‰§è¡Œå®Œï¼Œæ‰€ä»¥æ¥ç€å¹¶ä¸æ˜¯ç«‹é©¬æ‰§è¡Œ microtask queue é‡Œçš„ä»»åŠ¡ã€‚è€Œæ˜¯æ¥ç€æ‰§è¡Œç¬¬äºŒä¸ªç›‘å¬å™¨ã€‚åŒæ ·åœ°ï¼Œå®ƒåˆäº§ç”Ÿä¸€ä¸ª microtask å…¥é˜Ÿåˆ° microtask queueã€‚</li>
<li>æ¥ç€æ‰“å° listener 2ã€‚</li>
<li>æ­¤æ—¶è°ƒç”¨æ ˆç©ºäº†ï¼Œæ¥ç€ä» microtask queue å–å‡ºä»»åŠ¡ï¼Œé€ä¸ªæ‰§è¡Œï¼Œå› æ­¤å…ˆåæ‰“å° microtask 1ã€microtask 2ã€‚</li>
</ol>
<blockquote>
<p>å¯ä»¥é€šè¿‡ <code>event.isTrusted</code> æ¥åŒºåˆ†ä¸¤ç§è§¦å‘æ–¹å¼ï¼Œç”¨æˆ·ä¸æµè§ˆå™¨äº¤äº’è€Œäº§ç”Ÿçš„äº‹ä»¶ <code>isTrusted</code> ä¸º <code>true</code>ï¼Œä½¿ç”¨ JavaScript æ¥æ¨¡æ‹Ÿç‚¹å‡»ç­‰äº‹ä»¶è§¦å‘çš„ <code>isTrusted</code> ä¸º <code>false</code>ã€‚</p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">Event Loop Standard</a></li>
<li><a href="https://nodejs.org/en/learn/asynchronous-work/event-loop-timers-and-nexttick">The Node.js Event Loop</a></li>
<li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">Philip Roberts: What the heck is the event loop anyway?</a></li>
<li><a href="https://www.youtube.com/watch?v=u1kqx6AenYw">Erin Zimmer: Further Adventures of the Event Loop</a></li>
<li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0">Jake Archibald: In The Loop</a></li>
<li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">Tasks, microtasks, queues and schedules</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Photoshop æ“ä½œè®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/347</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/347</guid>
            <pubDate>Sat, 10 Aug 2024 04:43:33 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723273263737.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¥½é•¿æ—¶é—´æ²¡ç”¨ Photoshop äº†ï¼Œæœ‰äº›æ“ä½œå¿˜å¾—å¾ˆå¿«ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723273263737.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¥½é•¿æ—¶é—´æ²¡ç”¨ Photoshop äº†ï¼Œæœ‰äº›æ“ä½œå¿˜å¾—å¾ˆå¿«ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>
<h2>å°† PNG éé€æ˜éƒ¨åˆ†å¡«å……ä¸ºå‰æ™¯è‰²</h2>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>æ‰“å¼€ PNG å›¾ç‰‡</li>
<li>æ–°å»ºå›¾å±‚</li>
<li>å°†æ–°å»ºçš„å›¾å±‚å¡«å……ä¸ºå‰æ™¯è‰²ï¼ˆâŒ¥ + âŒ«ï¼‰</li>
<li>é€‰æ‹©æ–°å¥çš„å›¾å±‚åˆ›å»ºå‰ªè´´è’™ç‰ˆï¼ˆâŒ¥ + âŒ˜ + Gï¼‰</li>
<li>é€‰æ‹©æ‰€æœ‰å›¾å±‚ï¼Œåˆå¹¶å¯è§å›¾å±‚ï¼ˆâ‡§ + âŒ˜ + Eï¼‰</li>
<li>ä¿å­˜ã€‚</li>
</ol>
<blockquote>
<p>å¿«æ·é”®ï¼šå¡«å……å‰æ™¯è‰²ä¸º âŒ¥ + âŒ«ï¼Œå¡«å……èƒŒæ™¯è‰²ä¸º âŒ˜ + âŒ«ã€‚</p>
</blockquote>
<p>æ‰¹å¤„ç†ï¼š</p>
<ol>
<li>æ‰“å¼€ã€Œçª—å£ - åŠ¨ä½œ - åˆ›å»ºæ–°åŠ¨ä½œã€ï¼Œå°†ä¸Šè¿°æ­¥éª¤å½•ä¸€éã€‚</li>
<li>æ‰“å¼€ã€Œæ–‡ä»¶ - è‡ªåŠ¨ - æ‰¹å¤„ç†ã€ï¼Œé€‰æ‹©ä¸Šä¸€æ­¥çš„åŠ¨ä½œå’Œè¦å¤„ç†çš„å›¾ç‰‡ç›®å½•ï¼Œç‚¹å‡»ç¡®å®šå³å¯ã€‚</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è€æ˜¯è®°ä¸ä½ isEmpty]]></title>
            <link>https://github.com/toFrankie/blog/issues/346</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/346</guid>
            <pubDate>Wed, 07 Aug 2024 08:48:22 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723020355023.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>ç»å¸¸éœ€è¦åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºâ€œç©ºâ€ï¼ŒåŒ…æ‹¬ç©ºå¯¹è±¡ã€ç©ºæ•°ç»„ã€ç©º]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1723020355023.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>ç»å¸¸éœ€è¦åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºâ€œç©ºâ€ï¼ŒåŒ…æ‹¬ç©ºå¯¹è±¡ã€ç©ºæ•°ç»„ã€ç©ºå­—ç¬¦ä¸²ã€nullã€undefined ç­‰ã€‚</p>
<p>ç”¨åˆ°è¾ƒå¤šçš„åº“æ˜¯ licia æˆ– lodashï¼Œå®ƒä»¬éƒ½æä¾›äº†ä¸€ä¸ª <code>isEmpty()</code> æ–¹æ³•ï¼Œä½†æœ‰ä¸€ç‚¹åŒºåˆ«ã€‚</p>
<ul>
<li><a href="https://licia.liriliri.io/zh/document.html#isempty">licia - isEmpty</a></li>
<li><a href="https://lodash.com/docs/4.17.15#isEmpty">lodash - isEmpty</a></li>
</ul>
<p>çº ç»“ isEmpty çš„ä¸»è¦åŸå› æ˜¯ï¼šæ²¡å®Œå…¨åŒºåˆ†å¥½ä»€ä¹ˆå€¼ç®—ä½œâ€œç©ºâ€ï¼Ÿ</p>
<p>æœ‰æ—¶å€™ï¼Œä¸ç¡®å®šæŸä¸ªå€¼ç®—ä¸ç®—ç©ºï¼Œä¸ºé¿å…é¡¹ç›®å‡ºé”™å¯èƒ½è¦è·‘ Playground ç¡®è®¤ã€‚</p>
<blockquote>
<p>æ¯”å¦‚ <code>isEmpty(1)</code> ç»“æœæ˜¯ true è¿˜æ˜¯ falseï¼Ÿ</p>
</blockquote>
<p>èµ·åˆæˆ‘ä»¥ä¸º <code>isEmpty(0)</code> ç»“æœä¸º falseï¼Œ <code>isEmpty(1)</code> ç»“æœä¸º trueã€‚å‡ºç°è¿™ç§ç›´è§‰æ€§çš„é”™è¯¯ï¼Œæ˜¯å› ä¸ºåœ¨ JavaScript ä¸­ 1 å±äºçœŸå€¼ï¼ˆTruth Valueï¼‰ï¼Œ0 å±äºè™šå€¼ï¼ˆFalsy Valueï¼‰ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶äº†...</p>
<p>ç„¶ï¼Œå®é™…æµ‹è¯•ç»“æœï¼šå¯¹äº Number ç±»å‹çš„å€¼ï¼ŒisEmpty å‡è¿”å› trueã€‚</p>
<p>äºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå½»åº•æ‰«æ¸…çº ç»“ã€‚</p>
<h2>å“ªäº›å€¼ç®—ä½œâ€œç©ºâ€ï¼Ÿ</h2>
<p>åœ¨ licia å’Œ lodash ä¸­ï¼Œä»¥ä¸‹å€¼éƒ½è§†ä¸ºç©ºï¼š</p>
<ul>
<li>ç©ºå¯¹è±¡ï¼šæœ¬èº«å¯æšä¸¾çš„ key length ä¸º 0 çš„å¯¹è±¡ï¼ˆä¸å«åŸå‹ä¸Šçš„ï¼‰</li>
<li>ç©ºæ•°ç»„ï¼šé•¿åº¦ä¸º 0 çš„æ•°ç»„ï¼ˆç±»æ•°ç»„åŒç†ï¼‰</li>
<li>å­—ç¬¦ä¸²ï¼šé•¿åº¦ä¸º 0 çš„å­—ç¬¦ä¸²</li>
<li>æ•°å€¼ï¼šå‡è§†ä¸ºç©º</li>
<li>å¸ƒå°”å€¼ï¼šå‡è§†ä¸ºç©º</li>
<li>undefined</li>
<li>null</li>
</ul>
<p>å¯¹äº Map/Set ç±»å‹ï¼Œlicia å’Œ lodash ä¼šæœ‰å·®å¼‚ï¼š</p>
<ul>
<li>åœ¨ licia ä¸­ä¸æ”¯æŒè¿™ä¸¤ç§ç±»å‹ï¼Œæ— è®º size æ˜¯å¤šå°‘ï¼Œå‡è§†ä¸ºç©ºã€‚</li>
<li>åœ¨ lodash ä¸­ï¼Œå½“ size ä¸º 0 çš„ Map/Set å¯¹è±¡è§†ä¸ºç©ºã€‚</li>
</ul>
<p>å…¶å®åƒæ•°ç»„ã€å­—ç¬¦ä¸²è¿™äº›ç±»å‹ï¼Œå¯¹â€œç©ºâ€çš„å®šä¹‰æ˜¯æ¯«æ— ç–‘é—®çš„ï¼Œé•¿åº¦ä¸º 0 å°±æ˜¯ç©ºã€‚ä¸»è¦æ˜¯æ•°å€¼ã€å¸ƒå°”å€¼è¿™ç±»ï¼Œåˆšå¼€å§‹ä¸æ¸…æ¥šã€‚</p>
<h2>ç¤ºä¾‹</h2>
<p>è™šå€¼ï¼š</p>
<pre><code class="language-js">// licia.isEmpty() ä¸ lodash.isEmpty() ç»“æœä¸€è‡´

isEmpty(null) // true
isEmpty(undefined) // true
isEmpty(false) // true
isEmpty('') // true
isEmpty(0) // true
isEmpty(0n) // true
isEmpty(NaN) // true
</code></pre>
<p>éƒ¨åˆ†çœŸå€¼ï¼š</p>
<pre><code class="language-js">// licia.isEmpty() ä¸ lodash.isEmpty() ç»“æœä¸€è‡´

isEmpty(1) // true
isEmpty(1n) // true
isEmpty(true) // true
</code></pre>
<blockquote>
<p>å¯¹äº Numberã€Booleanã€BigInt ç±»å‹çš„åŸå§‹å€¼ï¼ŒisEmpty() å‡è¿”å› trueã€‚</p>
</blockquote>
<p>Map/Setï¼š</p>
<pre><code class="language-js">const licia = require('licia')
const lodash = require('lodash')

const map = new Map([[1, 'one']])
const set = new Set([1])

licia.isEmpty(map) // true
licia.isEmpty(set) // true

lodash.isEmpty(map) // false
lodash.isEmpty(set) // false
</code></pre>
<h2>æºç </h2>
<pre><code class="language-js">// https://github.com/liriliri/licia/blob/master/src/isEmpty.js

_('isArrLike isArr isStr isArgs keys');

exports = function(val) {
    if (val == null) return true;

    if (isArrLike(val) &amp;&amp; (isArr(val) || isStr(val) || isArgs(val))) {
        return val.length === 0;
    }

    return keys(val).length === 0;
};
</code></pre>
<pre><code class="language-js">// https://github.com/liriliri/licia/blob/master/src/keys.js

_('has');

if (Object.keys &amp;&amp; !LICIA_TEST) {
    exports = Object.keys;
} else {
    exports = function(obj) {
        const ret = [];

        for (const key in obj) {
            if (has(obj, key)) ret.push(key);
        }

        return ret;
    };
}
</code></pre>
<pre><code class="language-js">// https://github.com/liriliri/licia/blob/master/src/has.js

const hasOwnProp = Object.prototype.hasOwnProperty;

exports = function(obj, key) {
    return hasOwnProp.call(obj, key);
};
</code></pre>
<p>éå¸¸ç®€å•ï¼š</p>
<ol>
<li>åˆ¤æ–­ nullã€undefined</li>
<li>åˆ¤æ–­æ•°ç»„ã€ç±»æ•°ç»„</li>
<li>ä½¿ç”¨ in æ“ä½œç¬¦ï¼Œè·å–å…¶è‡ªèº«å¯æšä¸¾çš„å±æ€§ï¼Œå†åˆ¤æ–­ key length</li>
</ol>
<blockquote>
<p>å¯¹äºåŸå§‹å€¼ï¼Œin æ“ä½œä¼šéšå¼è½¬æ¢ä¸ºåŒ…è£…å¯¹è±¡ <code>Object(val)</code>ï¼Œç”±äºå®ƒæœ¬èº«æ²¡æœ‰å¯æšä¸¾å±æ€§ï¼Œæ‰€ä»¥ Numberã€Booleanã€BigInt ç­‰ç±»å‹çš„å€¼ isEmpty() ä¼šè¿”å› trueã€‚</p>
</blockquote>
<p>lodash å·®ä¸å¤šï¼Œå…¶æ”¯æŒçš„ç±»å‹æ›´ä¸°å¯Œä¸€ä¸‹ï¼Œæ¯”å¦‚ ArrayBufferã€TypedArrayï¼Œä½†é¡¹ç›®ä¸€èˆ¬å¾ˆå°‘åˆ¤æ–­è¿™ç±»çš„ï¼Œä¸å¤šè¯´äº†ã€‚<a href="https://github.com/lodash/lodash/blob/4.17.15/lodash.js#L11479">https://github.com/lodash/lodash/blob/4.17.15/lodash.js#L11479</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[iCloud äº‘ç›˜åŒæ­¥å¡ä½çš„è§£å†³æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/345</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/345</guid>
            <pubDate>Sat, 03 Aug 2024 08:56:44 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1722679502852.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¥è¯´ï¼ŒApple ç”Ÿæ€ç¡®å®åšå¾—å¾ˆä¸é”™ã€‚</p>
<p>ä½†æ˜¯ iCl]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1722679502852.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¥è¯´ï¼ŒApple ç”Ÿæ€ç¡®å®åšå¾—å¾ˆä¸é”™ã€‚</p>
<p>ä½†æ˜¯ iCloud Drive å°±æ˜¯ä¸€å¨å±ï¼Œç»å¸¸æ€§åŒæ­¥å¡æ­»...</p>
<p>æ¯”å¦‚è¿™æ ·ï¼Œå®ƒå¯ä»¥å¡åˆ°å¤©è’åœ°è€... :anger:</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/8/1722672907055.png" alt=""></p>
<p>ä¸€æœï¼Œå…¨æ˜¯è¿™ç±»é—®é¢˜ï¼š</p>
<ul>
<li><a href="https://apple.stackexchange.com/questions/264915/icloud-drive-is-stuck-uploading-items-and-no-longer-syncs">iCloud Drive is stuck uploading items and no longer syncs</a></li>
<li><a href="https://apple.stackexchange.com/questions/434190/icloud-stuck-on-uploading-x-items-y-of-y-monterey-12-1">iCloud stuck on &quot;uploading X items (Y of Y)&quot; - Monterey 12.1</a></li>
<li><a href="https://apple.stackexchange.com/questions/313716/icloud-drive-wont-sync-on-mac">iCloud Drive Won't Sync on Mac</a></li>
<li><a href="https://developer.apple.com/forums/thread/651829">iCloud for Mac is stuck on &quot;waiting to upload&quot;</a></li>
<li>...</li>
</ul>
<p>å…ˆåˆ° Apple å®˜ç½‘ï¼ˆ<a href="https://www.apple.com.cn/cn/support/systemstatus/">æˆ³æˆ‘</a>ï¼‰ï¼Œç¡®è®¤ iCloud äº‘ç›˜æœåŠ¡æœ‰æ²¡å´©ã€‚</p>
<p>ç„¶åå®˜æ–¹å®¢æœå¯èƒ½ä¼šè®©ä½ å…³æ‰ iCloud äº‘ç›˜åŒæ­¥ï¼Œé‡æ–°æ‰“å¼€ï¼Œä½†å¦‚æœæ˜¯ iCloud äº‘ç›˜é‡åº¦ç”¨æˆ·ï¼Œæ–‡ä»¶å®¹é‡ç‰¹åˆ«å¤šçš„è¯ï¼Œä½ å¾—æƒ³æƒ³é‡æ–°ä¸‹è½½çš„ç—›è‹¦ï¼Œè€Œä¸” iCloud ä¸‹è½½çš„é€Ÿåº¦è¿˜...</p>
<blockquote>
<p>[!NOTE]
ä»¥ä¸‹æä¾›ä¸€äº›ã€Œå¯èƒ½ã€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå®é™…å…¨å‡­å¤©æ„ã€‚</p>
</blockquote>
<h2>æ€æ‰è¿›ç¨‹</h2>
<p>ç»ˆç«¯ä¸‹å…ˆåæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åé‡æ–°æ‰“å¼€ Finderã€‚</p>
<pre><code class="language-shell">$ killall bird
$ killall cloudd
</code></pre>
<p><code>bird</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-shell">$ man bird
BIRD(8)                                       System Manager's Manual                                       BIRD(8)

NAME
     bird â€“ Documents in the Cloud

SYNOPSIS
     bird

DESCRIPTION
     bird is one of the system daemons backing the Documents in the Cloud feature.

     There are no configuration options to bird, and users should not run bird manually.

SEE ALSO
     brctl(1)

Mac OS X                                              22/04/14
</code></pre>
<h2>è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§</h2>
<ol>
<li>æ‰§è¡Œ <code>ps aux | grep bird</code>ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºã€‚å…¶ä¸­ <code>4137</code> ä¸ºè¿›ç¨‹ IDï¼ˆPIDï¼‰ã€‚</li>
</ol>
<pre><code class="language-shell">$ ps aux | grep bird
frankie           4137   0.0  0.1 33705140  10160   ??  S     4:01ä¸‹åˆ   0:06.68 /System/Library/PrivateFrameworks/CloudDocsDaemon.framework/Versions/A/Support/bird
</code></pre>
<ol start="2">
<li>æ‰§è¡Œ <code>ps -fl -C &lt;PID&gt;</code> æŸ¥çœ‹æŸè¿›ç¨‹ä¼˜å…ˆçº§ã€‚å…¶ä¸­ <code>NI</code> æ˜¯æŒ‡ nice å€¼ï¼Œè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚</li>
</ol>
<pre><code class="language-shell">$ ps -fl -C 4137
  UID   PID  PPID   C STIME   TTY           TIME CMD                     F PRI NI       SZ    RSS WCHAN     S             ADDR
  501  4137     1   0  4:01ä¸‹åˆ ??         0:06.68 /System/Library/  1004004  31  0 33704616  10244 -      S                   0
</code></pre>
<ol start="3">
<li>æ‰§è¡Œ <code>sudo renice -n -10 -p &lt;PID&gt;</code> è°ƒæ•´æŸä¸ªè¿›ç¨‹ä¼˜å…ˆçº§ã€‚</li>
</ol>
<pre><code class="language-shell">$ sudo renice -n -10 -p 4137
</code></pre>
<blockquote>
<p>è´Ÿæ•°ä¼˜å…ˆçº§æ›´é«˜ï¼Œæ®è¯´ <code>-20</code> æœ€é«˜ï¼Œä½†ä¸å»ºè®®ï¼Œè¿™é‡Œä½¿ç”¨ <code>-10</code>ï¼ˆå‚è€ƒ<a href="https://stackoverflow.com/a/72534456/14569218">è¿™é‡Œ</a>ï¼‰ã€‚</p>
</blockquote>
<p>æ ¹æ®ä»¥ä¸Šè‡ªå®šä¹‰ä¸¤ä¸ª aliasï¼Œå¯æ·»åŠ åˆ° <code>.bash_profile</code> æˆ– <code>.zshrc</code> é‡Œã€‚</p>
<pre><code class="language-bash">alias renice_bird_process='BIRDPID=$(ps aux | grep -i bird | awk '\''{print $2}'\'' | head -1); sudo renice -n -10 -p $BIRDPID'

alias show_bird_process_priority='BIRDPID=$(ps aux | grep -i bird | grep -v grep | awk '\''{print $2}'\'' | head -1); ps -o pid,ni -p $BIRDPID'
</code></pre>
<h2>åˆ é™¤ CloudDocsï¼ˆæ…é‡ï¼‰</h2>
<blockquote>
<p>è¿™ä¸ªæˆ‘æœªäº²æµ‹ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<pre><code class="language-shell">$ killall bird

$ rm -rf ~/Library/Application\ Support/CloudDocs
</code></pre>
<p>åˆ æ‰ <code>CloudDocs</code> ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œç›¸å½“äºæŠŠ iCloud äº‘ç›˜çš„æ•°æ®åº“æ¸…ç©ºï¼Œç„¶åå®ƒä¼šè‡ªåŠ¨é‡å¯ iCloud ä»»åŠ¡ï¼Œé‡æ–°ä¸Šä¼ æˆ–ä¸‹è½½ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è®°ä¸ƒæœˆï¼šç¦å·å¹³æ½­ & æ—å¥•åŒ¡]]></title>
            <link>https://github.com/toFrankie/blog/issues/344</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/344</guid>
            <pubDate>Sat, 27 Jul 2024 05:27:16 GMT</pubDate>
            <description><![CDATA[<p>æ—¶é—´è¿‡å¾—é£å¿«ï¼Œé©¬ä¸Šä¸ƒæœˆå°±è¦ç»“æŸäº†ã€‚</p>
<p>ä¸Šä¸ªæœˆæƒ³ç€ï¼Œæ²¡é‚£ä¹ˆå¿™äº†å°±å‡ºå»ç©å‡ å¤©ï¼Œæ— å¥ˆå…­æœˆéƒ½åœ¨ä¸‹é›¨ï¼Œå°±æ¨åˆ°äº†ä¸ƒæœˆã€‚</p>
<p>æ°å¥½å®¶é‡Œé‚£å‡ ä½å°‘çˆ·ä¹Ÿæ”¾æš‘å‡ï¼ˆå¥½å§ï¼Œå®¶é‡Œåªæœ‰æˆ‘æ²¡å¯’æš‘å‡äº†ï¼Œå®åç¾¡æ…•ï¼‰ã€‚</p>
<p>æ¥ç€ï¼Œç®€å•åšä¸‹æ”»ç•¥ï¼Œè®¢å¥½æ°‘å®¿ã€å¾€è¿”è½¦ç¥¨ï¼Œå°±å‡ºå‘äº†...</p>
<h2>å¹³æ½­</h2>
<p>ï¿½]]></description>
            <content:encoded><![CDATA[<p>æ—¶é—´è¿‡å¾—é£å¿«ï¼Œé©¬ä¸Šä¸ƒæœˆå°±è¦ç»“æŸäº†ã€‚</p>
<p>ä¸Šä¸ªæœˆæƒ³ç€ï¼Œæ²¡é‚£ä¹ˆå¿™äº†å°±å‡ºå»ç©å‡ å¤©ï¼Œæ— å¥ˆå…­æœˆéƒ½åœ¨ä¸‹é›¨ï¼Œå°±æ¨åˆ°äº†ä¸ƒæœˆã€‚</p>
<p>æ°å¥½å®¶é‡Œé‚£å‡ ä½å°‘çˆ·ä¹Ÿæ”¾æš‘å‡ï¼ˆå¥½å§ï¼Œå®¶é‡Œåªæœ‰æˆ‘æ²¡å¯’æš‘å‡äº†ï¼Œå®åç¾¡æ…•ï¼‰ã€‚</p>
<p>æ¥ç€ï¼Œç®€å•åšä¸‹æ”»ç•¥ï¼Œè®¢å¥½æ°‘å®¿ã€å¾€è¿”è½¦ç¥¨ï¼Œå°±å‡ºå‘äº†...</p>
<h2>å¹³æ½­</h2>
<p>ğŸ—ºï¸ <a href="https://map.baidu.com/search/%E5%B9%B3%E6%BD%AD%E5%8E%BF/@13321495.643414633,2918621.435,10.7z?querytype=s&amp;da_src=shareurl&amp;wd=%E5%B9%B3%E6%BD%AD%E5%8E%BF&amp;c=257&amp;src=0&amp;wd2=%E7%A6%8F%E5%B7%9E%E5%B8%82%E5%B9%B3%E6%BD%AD%E5%8E%BF&amp;pn=0&amp;sug=1&amp;l=13&amp;b=(12596475,2612157;12670459,2649469)&amp;from=webmap&amp;biz_forward=%7B%22scaler%22:2,%22styles%22:%22pl%22%7D&amp;sug_forward=e520bbe3e517aeb949fc8dee&amp;device_ratio=2">ç¦å·å¹³æ½­</a></p>
<p><img src="https://github.com/user-attachments/assets/646d287a-7f90-4726-826b-c53093e4f4b1" alt="">
â–² åŒ—æ¸¯æ‘é™„è¿‘çš„æµ·è¾¹å°è·¯</p>
<p><img src="https://github.com/user-attachments/assets/6d0b8539-3984-4b96-89f7-163eb91f9366" alt="">
â–² å°†å†›å±±</p>
<p><img src="https://github.com/user-attachments/assets/c43d46c1-e3d2-4add-acf6-8afcfec7fe39" alt="">
â–² é¾™ç‹å¤´æ²™æ»©ï¼ˆæˆ‘å“¥å’Œæˆ‘çš„å°å¼Ÿä»¬ï¼‰</p>
<h3>å‡ºå‘å‰çš„å‡†å¤‡</h3>
<ul>
<li>é˜²æ™’ï¼šç‰©ç†é˜²æ™’ + åŒ–å­¦é˜²æ™’ï¼Œæ¯”å¦‚é˜²æ™’è¡£ã€é˜²æ™’æ‰‹å¥—ã€é˜²æ™’éœœã€é˜²æ™’å–·é›¾ã€å†°è¢–ã€å¸½å­...</li>
<li>å­¦ç”Ÿè¯ï¼šå¹³æ½­æ”¶è´¹æ™¯åŒºä¸å¤šï¼Œå¦‚æœæœ‰è¿˜æ˜¯å¸¦ä¸Šã€‚</li>
<li>èº«ä»½è¯ï¼šè¿™ä¸ªä¸ç”¨è¯´äº†ã€‚</li>
<li>å¤©æ°”ï¼šå¹³æ½­ä¸€å®šæ˜¯æ™´å¤©æ‰å¥½çœ‹ã€‚</li>
</ul>
<p>åƒä¸‡åƒä¸‡åƒä¸‡ä¸è¦å°çœ‹å¹³æ½­çš„ç´«å¤–çº¿ï¼Œå¯ä»¥å»å°çº¢ä¹¦æœä¸€ä¸‹ï¼Œçœ‹åˆ°é‚£äº›æ™’å‡ºä¸ªå›´è„–ã€æ‰‹å¥—ã€è¢œå­çš„ï¼Œè¿˜æœ‰ä¸€å¹´è¿˜æ²¡å®Œå…¨ç™½å›æ¥çš„å¸–å­ï¼Œç¬‘æ­»ã€‚</p>
<blockquote>
<p>éª‘å°ç”µé©´çš„ä¸è¦å¿½ç•¥æ‰‹ï¼Œç‰¹æ„æåˆ°ã€Œé˜²æ™’æ‰‹å¥—ã€ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸æ€•æ™’ä¼¤ã€æ™’åˆ°èœ•çš®ã€æ™’é»‘çš„ï¼Œå¯å¿½ç•¥ã€‚</p>
</blockquote>
<h3>è¡Œç¨‹</h3>
<ul>
<li>ç¦å·ä¸€å¤©</li>
<li>å¹³æ½­ä¸¤å¤©</li>
</ul>
<p>13 æ—¥ï¼Œé«˜é“å¹¿å·å— â†’ ç¦å·å—ã€‚</p>
<p>14 æ—¥ï¼Œä¸‹åˆé«˜é“ç¦å·å— â†’ å¹³æ½­ã€‚</p>
<p>15 æ—¥ï¼Œæ—©æ™¨æ—¥å‡º + å¹³æ½­åŒ—çº¿ã€‚</p>
<p>16 æ—¥ï¼Œå¹³æ½­å—çº¿ã€‚</p>
<p>17 æ—¥ï¼Œè‡ªç„¶é†’ï¼Œä¸‹åˆçš„é«˜é“å›å¹¿å·ã€‚</p>
<blockquote>
<p>13 æ—¥åˆ°ç¦å·å—å·²æ˜¯ 15:30ï¼Œåœ¨ç¦å·å‘†äº†ä¸€æ™šã€‚é€›äº†ä¸‹ä¸‰åŠä¸ƒå··ï¼Œé‚£å•¥é±¼ç‡•çœŸä¸å–œæ¬¢åƒï¼Œå‡ ä½å°‘çˆ·ä»¬èµ°ä¸€ä¸‹å°±å–Šç´¯ï¼Œä¸€è¡Œå‡ äººå¯¹åƒçš„ä¸å¤§æ„Ÿå†’ï¼Œä¸‹æ¬¡ä¸€å®šä¸å¸¦ä½ ä»¬å»ä»€ä¹ˆæ­¥è¡Œè¡—ã€ç¾é£Ÿè¡—äº†ã€‚</p>
</blockquote>
<blockquote>
<p>ç¦å· â†’ å¹³æ½­ï¼Œé™¤äº†é«˜é“ï¼Œä¹Ÿå¯ä»¥åœ¨é—½è¿æ˜“è¡Œå°ç¨‹åºä¸Šé¢æå‰è®¢ç¥¨ï¼ˆæ‰¾çº¦å·´ï¼‰ï¼Œå¬è¯´æŒºå®æƒ çš„ã€‚</p>
</blockquote>
<blockquote>
<p>å¤å¤©æ—¥å‡ºæ—¶é—´ 05:00 å·¦å³ã€‚15 æ—¥æ—©ä¸Šå¤©æ°”ä¸å¥½ï¼Œè¢«ä¸€æœµäº‘æŒ¡ä½äº†ï¼Œçœ‹äº†ä¸ªå¯‚å¯ã€‚</p>
</blockquote>
<h3>ä½å®¿</h3>
<ul>
<li>ç¦å·ï¼šç¦å·å—ç«™é™„è¿‘ï¼Œè¯´å®è¯å¾ˆå·®ã€‚</li>
<li>å¹³æ½­ï¼šè·ç¦»é¾™ç‹å¤´çº¦ 2kmï¼Œä¸‰å®¤ä¸€å…ï¼Œå¯ä½ 6 äººï¼Œçº¦ 260 ä¸€æ™šï¼Œä½å®¿æ¡ä»¶å¾ˆå¥½ã€‚</li>
</ul>
<blockquote>
<p>å¹³æ½­æ°‘å®¿æ˜¯ç«ç‘°å°åŒºæ‰£å­å®¢æ ˆï¼ˆæ­¥æ¢¯ä¸ƒæ¥¼ï¼‰ï¼Œç»™è€æ¿æ‰“ä¸ªå¹¿å‘Šï¼Œè™½ç„¶å¯èƒ½æ²¡ä»€ä¹ˆç”¨ï¼Œå“ˆå“ˆã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœè¦èµ°å—åŒ—ä¸¤æ¡çº¿çš„ï¼Œæ¨èä½å¹³æ½­å¿åŸï¼Œé¾™ç‹å¤´é™„è¿‘ã€‚</p>
</blockquote>
<h3>ç§Ÿè½¦</h3>
<ul>
<li>ç”µåŠ¨è½¦ï¼šä¼˜ç‚¹éšåœéšæ‹ï¼Œä¸ç”¨æ‹…å¿ƒåœè½¦é—®é¢˜ï¼Œç¼ºç‚¹æ™’ã€‚</li>
<li>å°è½¦ï¼šè·Ÿç”µåŠ¨è½¦ç›¸åï¼Œç‰¹åˆ«æ˜¯å‘¨æœ«ã€èŠ‚å‡æ—¥å µè½¦åœè½¦é—®é¢˜å°¤ä¸ºæ˜æ˜¾ã€‚</li>
</ul>
<p>æ ¹æ®è¡Œç¨‹å®‰æ’é€‰æ‹©ï¼Œæ¯”å¦‚ä¸€å¤©èµ°å®Œå—åŒ—çº¿ï¼Œé‚£è‚¯å®šé€‰å°è½¦ã€‚</p>
<p>å¦‚æœæ—¶é—´å……è¶³ï¼Œä¸ªäººæ›´æ¨èç”µåŠ¨è½¦ã€‚æ¯”å¦‚ï¼ŒåŒ—çº¿å¾ˆå¤šæµ·è¾¹å°è·¯ï¼Œé£æ™¯è¿œæ¯”å¤§è·¯å¥½ï¼Œè¿™æ˜¯å°è½¦ä¸èƒ½å¸¦æ¥çš„å¿«ä¹ã€‚</p>
<blockquote>
<p>ç§Ÿè½¦æå‰è®¢ï¼Œç¾å›¢ã€å°çº¢ä¹¦ã€æŠ–éŸ³éƒ½å¯ä»¥ï¼Œæ‰¾ä¸€ä¸ªä¸‹æ¦»é™„è¿‘çš„ï¼Œå¼€è½¦å»å“ªéƒ½æ–¹ä¾¿ã€‚</p>
</blockquote>
<blockquote>
<p>ç”µåŠ¨è½¦ï¼Œä»¥ 24h ä¸ºä¾‹ï¼Œä»·æ ¼ 30 ~ 60 ä¸ç­‰ã€‚æŒ‘ä¸ªè½¦å†µå¥½çš„ï¼Œæœ‰æ²¡ç”µå…è´¹æ•‘æ´æœåŠ¡çš„ï¼Œæˆ‘ä»¬ç§Ÿäº†ä¸¤å¤©ï¼Œè·‘æ»¡å—åŒ—çº¿å®Œå…¨æ²¡é—®é¢˜ï¼Œè¿˜å˜å˜å¿«ï¼Œä½†è¦æ³¨æ„å®‰å…¨ï¼Œå…¨å²›éƒ½æ˜¯ç”µåŠ¨è½¦ã€‚</p>
</blockquote>
<blockquote>
<p>[!NOTE]
å…³äºå‚æ™šéª‘å°ç”µé©´è¿”å›å¿åŸï¼Œå¯¼èˆªè¯·é€‰æ‹©ã€Œé©¾è½¦çº¿è·¯ã€ï¼Œé¿å…èµ°ååƒ»ã€æ¼†é»‘çš„é“è·¯ã€‚</p>
</blockquote>
<blockquote>
<p>[!IMPORTANT]
å¼€è½¦ä¸€å®šè¦éµå®ˆäº¤é€šè§„åˆ™ï¼Œå®‰å…¨ç¬¬ä¸€ï¼Œç”Ÿå‘½è‡³ä¸Šã€‚<strong>æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œåœ¨å“ªï¼Œå¼€ä»€ä¹ˆè½¦ï¼Œå®å¯ç­‰ä¸€åˆ†é’Ÿï¼Œä¹Ÿä¸æŠ¢ä¸€ç§’</strong>ã€‚</p>
</blockquote>
<blockquote>
<p>[!CAUTION]
è¿”ç¨‹é‚£å¤©åˆ·åˆ°ä¸€ä¸ªç”µåŠ¨è½¦äº‹æ•…çš„è§†é¢‘ï¼Œä¸€è¾†ç”µåŠ¨è½¦æ’ä¸Šäº†ç¯å«è½¦ï¼Œå¥½åƒå…¶ä¸­ä¸€ä¸ªå¥³ç”Ÿä¸å¹¸......æ‰€ä»¥ä¸€å®šä¸€å®šä¸€å®šè¦æ³¨æ„å®‰å…¨ã€‚è¿˜å¬è¯´æœ€è¿‘å¹³æ½­ä¸¥æŠ“ç”µåŠ¨è½¦ï¼Œæˆ‘çŒœè·Ÿè¿™èµ·äº‹æ•…å¤šå°‘æœ‰ç‚¹å…³ç³»ã€‚</p>
</blockquote>
<h3>ç¾é£Ÿ</h3>
<p>ä¸ªäººéå¸¸éå¸¸éå¸¸æŒ‘é£Ÿï¼Œæ— è®ºå»åˆ°å“ªï¼Œå¯¹ï¼ˆå½“åœ°ç‰¹è‰²ï¼‰ç¾é£ŸåŸºæœ¬ä¸Šæä¸èµ·å…´è¶£ï¼Œå°±ä¸è¯´äº†ã€‚</p>
<h3>æ™¯ç‚¹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1722067146764.png" alt=""></p>
<p>â–² æºè‡ª<a href="https://www.xiaohongshu.com/explore/65f44036000000001203ca3c">å°çº¢ä¹¦</a></p>
<p>å¤§è‡´æœ‰è¿™äº›ï¼Œæˆ‘æ²¡åšä»€ä¹ˆæ”»ç•¥ï¼Œäº†è§£è·¯çº¿ä¹‹åï¼Œéª‘ä¸Šå°ç”µé©´å°±å‡ºå‘ï¼Œä¹Ÿæ²¡æœ‰ä¸¥æ ¼æŒ‰æ™¯ç‚¹èµ°ã€‚</p>
<p>åŒ—çº¿ï¼š</p>
<ul>
<li>ä»™äººäº•ï¼Œéå¸¸ä¸€èˆ¬å§ï¼Œé—¨ç¥¨ 42 ä¸€äººï¼Œå­¦ç”Ÿç¥¨åŠç¥¨ã€‚</li>
<li>é•œæ²™æ²¡å»ï¼Œé•¿æ±Ÿæ¾³å…¨æ˜¯äººï¼Œæ„Ÿè§‰ä¸€ç‚¹ä¹Ÿä¸å¥½ï¼Œä¸çŸ¥é“æ—¥è½ä¼šæ€æ ·ã€‚</li>
<li>åŒ—éƒ¨æ¹¾ï¼Œé‚£å¤©ä¸‹åˆå¿« 6 ç‚¹æ‰èµ¶åˆ°ï¼Œå¤©æ°”ä¸å¥½ï¼Œå®Œå…¨æ„Ÿå—ä¸åˆ°æœ€ç¾é£æ™¯ï¼Œæœ‰ç‚¹å¤±æœ›ã€‚</li>
<li>åŒ—çº¿ï¼Œåè€Œæ˜¯æµ·è¾¹å°è·¯é£æ™¯æ‰å¥½çœ‹ï¼Œç‰¹åˆ«æ˜¯åŒ—æ¸¯æ‘ ~ æœ€ç¾ç¯å²›è·¯è¿™ä¸€å¸¦çš„ã€‚</li>
</ul>
<p>å—çº¿ï¼š</p>
<ul>
<li>çŒ´ç ”å²›ï¼šé—¨ç¥¨ 38 ä¸€äººï¼Œèµ¶ä¸Šå¤§ä¸­åˆäº†ç‰¹åˆ«æ™’ï¼Œæ²¡å•¥æ„Ÿè§‰ã€‚</li>
<li>æµ·å›å¤åŸï¼šæ²¡å»ï¼Œå¬è¯´å°±ä¸€ä¸ªçº¯å•†ä¸šè¡—ã€‚</li>
<li>å›å—æ¹¾ï¼šæœ‰ä¸‰ä¸ªæ²™æ»©ï¼šå´æ²™æ¾³ã€ç”°ç¾æ¾³ã€è¿œå½“æ¾³ï¼Œæˆ‘ä»¬åªå»äº†ä¸€ä¸ªï¼Œéå¸¸éå¸¸éå¸¸æ™®é€šã€‚æ²™æ»©ä¸Šçš„æ‡’äººæ²™å‘éƒ½æ˜¯æ”¶è´¹çš„ã€‚</li>
<li>å°†å†›å±±ï¼šé—¨ç¥¨ 20 ä¸€äººï¼Œåè€Œè§‰å¾—å—çº¿æœ€å€¼å¾—å»çš„åœ°æ–¹ï¼Œé£æ™¯çœ‹èµ·æ¥æœ€ç¾ï¼Œä½†æ™¯åŒºéƒ¨åˆ†æœªå¼€æ”¾ï¼Œåœ¨ç»´ä¿®ï¼Ÿ</li>
<li>è±¡é¼»æ¹¾ï¼šå»åˆ°æ‰å‘ç°æ²¡å¼€ï¼Œé‚£ä¸ªæ¸¸å®¢å¤§å…éƒ½é•¿è‰ï¼Œè’åºŸä¸€æ®µæ—¶é—´äº†ï¼Œæˆ‘çš„å¤©ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œè¿˜ç®—æ»¡æ„ã€‚</p>
<p>å°±æ˜¯å°‘çˆ·ä»¬éª‘è½¦å¤ªå¿«äº†ï¼Œå°±åƒä¸ºäº†èµ¶è·¯ï¼Œåƒé•œæ²™å…¶å®æ˜¯é”™è¿‡çš„ï¼Œè™½ç„¶æˆ‘ç½‘ä¸Šçœ‹äº†å¹¶ä¸è§‰å¾—å¥½çœ‹ã€‚é‚£ã€Œæ‡’æƒ°ä¸‰äººç»„ã€æ›´æ˜¯...å·®ä¸å¤šæ˜¯æ¢ä¸ªåœ°æ–¹ç©æ‰‹æœºçš„æ„Ÿè§‰ï¼Œä¸€é€®åˆ°æœºä¼šå°±çœ‹æ‰‹æœºï¼Œæœäº†ã€‚</p>
<p>æ”¾ä¸ªã€Œ<a href="https://www.douyin.com/video/7394663938685668635">æš‘å‡å¸¦å¨ƒæœ‰å¤šè¾›è‹¦</a>ã€çš„è§†é¢‘é“¾æ¥ï¼Œè™½ç„¶å°‘çˆ·ä»¬ä¸æ˜¯å¨ƒäº†ï¼Œä½†é‚£æ„Ÿè§‰æ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p>è·Ÿæ‰«å…´çš„äººå‡ºå»ç©ï¼ŒçœŸçš„å¾ˆæ‰«å…´ã€‚</p>
</blockquote>
<h2>æ—å¥•åŒ¡</h2>
<p>å¹³æ½­ä¹‹è¡Œç»“æŸä¹‹åï¼Œå°‘çˆ·ä»¬å›å®¶è¿‡æš‘å‡ï¼Œç¤¾ç•œçš„æˆ‘ç»§ç»­ä¸Šç­...</p>
<p>7 æœˆ 20 æ—¥å‘¨å…­ï¼Œå»äº† <a href="https://www.xiaohongshu.com/search_result?keyword=%25E6%259E%2597%25E5%25A5%2595%25E5%258C%25A1%25E9%25AB%2598%25E5%25B1%25B1%25E4%25BD%258E%25E8%25B0%25B7%25E5%258D%2581%25E5%2591%25A8%25E5%25B9%25B4&amp;source=web_note_detail_r10">#æ—å¥•åŒ¡é«˜å±±ä½è°·åå‘¨å¹´æ¼”å”±ä¼š</a>ï¼ˆå¹¿å·ç«™ï¼‰ï¼Œè¿™æ˜¯æˆ‘ä¸ºæ•°ä¸å¤šæƒ³å»çœ‹çš„æ¼”å”±ä¼šä¹‹ä¸€ï¼Œå¥½æ­£ï¼ˆç²¤è¯­éŸ³ï¼‰ï¼Œä¸‹æ¬¡è¿˜å»...</p>
<p><img src="https://github.com/user-attachments/assets/cf36e733-0160-4e82-9e1b-3a4d7e7a953d" alt="">
<img src="https://github.com/user-attachments/assets/eff59dae-334f-4545-8917-d26927deff9e" alt="">
<img src="https://github.com/user-attachments/assets/fb7aaf28-883d-4099-aeed-cac8b7405c8b" alt=""></p>
<ul>
<li>é«˜å±±ä½è°·</li>
<li>éš¾å¾—ä¸€é‡</li>
<li>æœ‰äººå…±é¸£</li>
<li>æŸ¥æ— æ­¤å­—</li>
<li>ä¸€ä¸–åŒå­¦</li>
<li>...</li>
</ul>
<blockquote>
<p>æˆ–è®¸åªå¾—ä½ å…±é¸£ï¼Œå¯æ­Œå¯æ³£çš„æ„Ÿæ€§...</p>
</blockquote>
<p>å¯æƒœï¼Œæ²¡æœ‰å”±ã€Œ<a href="https://music.apple.com/cn/album/%E7%8C%AE%E4%B8%91/1708384411?i=1708384422">çŒ®ä¸‘</a>ã€ï¼Œç­‰äº†ä¸€æ™šï¼Œä¸‹æ¬¡ä¸€å®š <a href="https://www.instagram.com/saxyphil/">@æ—å¥•åŒ¡</a>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ macOS ç…§ç‰‡ä¸åŒæ­¥é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/343</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/343</guid>
            <pubDate>Sat, 20 Jul 2024 05:12:48 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721452343453.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ‰æ—¶ï¼ŒmacOS ä¸‹ã€Œç…§ç‰‡ã€App ä¸ä¼šåŒæ­¥æœ€æ–°çš„å›¾ç‰‡ï¼ŒåŸå› ä¸è¯¦ã€‚</p>
<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721452343453.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ‰æ—¶ï¼ŒmacOS ä¸‹ã€Œç…§ç‰‡ã€App ä¸ä¼šåŒæ­¥æœ€æ–°çš„å›¾ç‰‡ï¼ŒåŸå› ä¸è¯¦ã€‚</p>
<p>é‡å¯ Appã€é‡å¯ç”µè„‘éƒ½è¯•è¿‡äº†ï¼Œæ²¡ç”¨ï¼Œåˆä¸æƒ³ç™»å‡º iCloud å¸å·ï¼Œç°æä¾›å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<p>æŒ‰ä¸‹ âŒ˜ + âŒ¥ é”®ï¼Œç„¶åç‚¹å‡»æ‰“å¼€ç…§ç‰‡ Appï¼Œä¼šå‡ºç°å¦‚ä¸‹ä¿®å¤æç¤ºï¼Œç‚¹å‡»ä¿®å¤ï¼Œç­‰å¾…å®Œæˆå³å¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721451749739.png" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è¯•å›¾ä¸¢æ‰é¼ æ ‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/341</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/341</guid>
            <pubDate>Thu, 20 Jun 2024 15:15:11 GMT</pubDate>
            <description><![CDATA[<p>æŒ‡æ³•ç»ƒä¹ ï¼š<a href="https://www.typingclub.com/">TypingClud</a>
Vim æ¸¸æˆï¼š<a href="https://vim-adventures.com/">VIM Adventures</a></p>
<h2>åŸºç¡€</h2>
<h3>ä¸‰ç§æ¨¡å¼</h3>
<ul>
]]></description>
            <content:encoded><![CDATA[<p>æŒ‡æ³•ç»ƒä¹ ï¼š<a href="https://www.typingclub.com/">TypingClud</a>
Vim æ¸¸æˆï¼š<a href="https://vim-adventures.com/">VIM Adventures</a></p>
<h2>åŸºç¡€</h2>
<h3>ä¸‰ç§æ¨¡å¼</h3>
<ul>
<li>æ™®é€šæ¨¡å¼ï¼šæ‰§è¡Œå‘½ä»¤</li>
<li>æ’å…¥æ¨¡å¼ï¼šç¼–è¾‘æ–‡æœ¬</li>
<li>è§†å›¾æ¨¡å¼ï¼šé«˜äº®æ–‡æœ¬ç­‰</li>
</ul>
<pre><code>i    # è¿›å…¥æ’å…¥æ¨¡å¼
v    # è¿›å…¥è§†å›¾æ¨¡å¼
esc  # ä»å…¶ä»–æ¨¡å¼è¿”å›æ™®é€šæ¨¡å¼
</code></pre>
<h3>å…‰æ ‡ç§»åŠ¨</h3>
<p>åŸºç¡€ï¼š</p>
<pre><code>h    # å·¦
j    # ä¸‹
k    # ä¸Š
l    # å³
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<p>References</p>
<ul>
<li><a href="https://github.com/iggredible/Learn-Vim">Learn-Vim</a>ï¼ˆ<a href="https://gitlab.com/wsdjeg/Learn-Vim_zh_cn">ä¸­æ–‡ç‰ˆ</a>ï¼‰</li>
<li><a href="https://github.com/takac/vim-hardtime">vim-hardtime</a></li>
<li><a href="http://vimcasts.org/blog/2013/02/habit-breaking-habit-making/">Habit breaking, habit making</a></li>
<li><a href="https://youtu.be/wlR5gYd6um0">Mastering the Vim Language</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¼€å‘ä¸€ä¸ªç®€å•çš„ Chrome Extension]]></title>
            <link>https://github.com/toFrankie/blog/issues/340</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/340</guid>
            <pubDate>Sun, 16 Jun 2024 06:32:09 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1718543919632.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>åœ¨æ­¤ä½œä¸€ä¸ªè®°å½•ï¼Œç¬¬ä¸€æ¬¡å¼€å‘ Chrome Exten]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1718543919632.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>åœ¨æ­¤ä½œä¸€ä¸ªè®°å½•ï¼Œç¬¬ä¸€æ¬¡å¼€å‘ Chrome Extension çš„åŒå­¦ä¹Ÿå¯ä»¥çœ‹çœ‹ã€‚</p>
</blockquote>
<h2>èƒŒæ™¯</h2>
<p>æˆ‘ç°åœ¨ä½¿ç”¨ <a href="https://github.com/toFrankie/github-blogger">GitHub Blogger</a> ä½œä¸ºä¸ªäººåšå®¢å·¥å…·ï¼Œåœ¨ç¿»é˜…æ–‡ç« æ—¶ï¼Œæœ‰ä¸ªä½“éªŒç—›ç‚¹ï¼šæ— æ³•å¿«é€Ÿå®šä½åˆ°æŸä¸ªç« èŠ‚ã€‚</p>
<p>æ¯”å¦‚ï¼Œè¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/317">æ–‡ç« </a>æ¶‰åŠçš„äºŒçº§ã€ä¸‰çº§æ ‡é¢˜å¤šè¾¾ 25+ï¼Œç¯‡å¹…ä¹Ÿå¾ˆé•¿ã€‚</p>
<p>ç›®å‰ GitHub åªæœ‰ä»“åº“ Markdown æ–‡ä»¶æ”¯æŒç›®å½•èƒ½åŠ›ï¼Œä½†æ˜¯ Issue è¿˜ä¸æ”¯æŒï¼Œæ‰€ä»¥å¼€å‘ä¸€ä¸ª Chrome æ‰©å±•ç¨‹åºæ¥è§£å†³ã€‚</p>
<blockquote>
<p><a href="https://github.com/toFrankie/github-issue-toc">github-issue-toc</a></p>
</blockquote>
<ul>
<li>æ”¯æŒ h1 ~ h6 æ ‡é¢˜ã€‚</li>
<li>æ”¯æŒæ»šåŠ¨é«˜äº®ã€‚</li>
<li>æ”¯æŒç²˜æ€§å¸ƒå±€ï¼Œæ»šåŠ¨æ—¶å§‹ç»ˆåœ¨å¯è§†åŒºåŸŸå†…ã€‚</li>
<li>æ ·å¼é£æ ¼ä¸ GitHub å¥‘åˆï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1718520988032.png" alt=""></p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>é¡¹ç›®æ²¡å¿…è¦ä¸€æ­¥ä¸€æ­¥å»æ­ï¼Œé€‰æ‹©ç¤¾åŒºæµè¡Œæ–¹æ¡ˆå³å¯ï¼Œæˆ‘é€‰ <a href="https://www.plasmo.com/">Plasmo</a>ï¼Œå¼€å‘ä½“éªŒè¿˜ä¸é”™ã€‚ç›®å½•æ ·å¼å‚è€ƒäº† <a href="https://github.blog/changelog/2021-04-13-table-of-contents-support-in-markdown-files/">Github</a>ã€<a href="https://github.com/bytedance/bytemd">ByteMD</a>ã€‚</p>
<p>å¯ç²—ç•¥çœ‹çœ‹ï¼Œäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼š</p>
<ul>
<li><a href="https://github.com/pekonchan/Blog/issues/8">ä¸€ç¯‡æ–‡ç« æ•™ä½ é¡ºåˆ©å…¥é—¨å’Œå¼€å‘ chrome æ‰©å±•ç¨‹åºï¼ˆæ’ä»¶ï¼‰</a></li>
<li><a href="https://segmentfault.com/a/1190000044555740">Chrome æµè§ˆå™¨æ’ä»¶ä» Manifest V2 å‡çº§åˆ° V3 ç‰ˆæœ¬æ‰€éœ€è¦ä¿®æ”¹çš„ç‚¹</a></li>
<li><a href="https://developer.chrome.com/docs/extensions/develop/migrate/checklist">Manifest V3 migration checklist </a></li>
<li><a href="https://developer.chrome.com/docs/extensions">Chrome Extensions</a></li>
<li><a href="https://docs.plasmo.com/">Plasmo Documentation</a></li>
</ul>
<blockquote>
<p>ç¬¬ä¸€ç¯‡ä½œè€…æ€»ç»“å¾—æŒºå¥½ï¼Œä½†é‡Œé¢ä¸€äº›ä¸œè¥¿åœ¨ Manifest V3 å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯ä»¥çœ‹çœ‹ç¬¬äºŒç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<h2>åŸºç¡€æ¦‚å¿µ</h2>
<ul>
<li><a href="https://developer.chrome.com/docs/extensions/reference/manifest?hl=zh-cn">manifest.json</a>ï¼ˆæ¸…å•æ–‡ä»¶ï¼‰</li>
<li><a href="https://developer.chrome.com/docs/extensions/develop/ui?hl=zh-cn#actions">Actions</a>ï¼ˆåŠ¨ä½œï¼‰</li>
<li><a href="https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts?hl=zh-cn">Content Scripts</a>ï¼ˆå†…å®¹è„šæœ¬ï¼‰</li>
<li><a href="https://developer.chrome.com/docs/extensions/develop/concepts/service-workers?hl=zh-cn">Extension Service Worker</a>ï¼ˆåŸ V2 çš„ Background Scriptsï¼‰</li>
</ul>
<p>æ¸…å•æ–‡ä»¶æ˜¯æ¯ä¸ªæ‰©å±•ç¨‹åºå¿…é¡»çš„ï¼Œå®ƒä¼šåˆ—å‡ºæ‰©å±•ç¨‹åºçš„ç»“æ„å’Œè¡Œä¸ºç­‰ä¿¡æ¯ã€‚</p>
<p>Actions æ˜¯ç‚¹å‡»æ‰©å±•ç¨‹åºå›¾æ ‡æ—¶å‘ç”Ÿçš„åŠ¨ä½œï¼Œå¯ä»¥æ˜¯æ‰“å¼€ä¸€ä¸ªå¼¹å‡ºå¼çª—å£ã€æ‰“å¼€ä¾§è¾¹æ é¢æ¿ã€å³é”®èœå•ç­‰ã€‚</p>
<p>å†…å®¹è„šæœ¬ä¸»è¦ç”¨äºä¿®æ”¹ç½‘é¡µå†…å®¹ã€‚</p>
<p>Extension Service Worker æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨é‡Œçš„åå°è„šæœ¬ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’ä¼ é€’æ¶ˆæ¯ï¼Œè¯¦è§<a href="https://developer.chrome.com/docs/extensions/develop/concepts/messaging?hl=zh-cn">æ¶ˆæ¯ä¼ é€’</a>ã€‚</p>
<h2>å¼€å‘</h2>
<p>åˆ›å»ºé¡¹ç›®ï¼š</p>
<pre><code class="language-shell">$ pnpm create plasmo --with-src --entry=contents/inline,popup,background
</code></pre>
<blockquote>
<p>ä¼¼ä¹ <a href="https://docs.plasmo.com/framework/workflows/new#with-specific-entry-files"><code>--entry</code></a> æŒ‡å®šå…¥å£ç›®å½•æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘åªç”¨åˆ°å¼¹å‡ºå¼çª—å£ã€å†…å®¹è„šæœ¬ä»¥åŠ Service Workerï¼Œä½†ç”Ÿæˆçš„æ¨¡æ¿åŒ…æ‹¬äº† <code>newtab</code>ï¼Œéœ€æ‰‹åŠ¨åˆ æ‰ã€‚</p>
</blockquote>
<h3>Content Scripts</h3>
<p>å‰é¢æåˆ°ï¼Œå†…å®¹è„šæœ¬æ˜¯ç”¨æ¥ä¿®æ”¹ç½‘é¡µå†…å®¹çš„ï¼Œä½†å®ƒè·Ÿç½‘é¡µçš„ JavaScript ç¯å¢ƒæ˜¯éš”ç¦»çš„ã€‚</p>
<h4>åˆ†ç±»</h4>
<p>åœ¨ Plasmo é‡Œï¼Œå†…å®¹è„šæœ¬åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>content.ts</li>
<li>content.tsx</li>
</ul>
<p><code>.ts</code> è¡¨ç¤ºæ²¡æœ‰ UI ç•Œé¢çš„çº¯è„šæœ¬ï¼Œåè€…åˆ™æ˜¯å¸¦ UI çš„ç»„ä»¶ï¼Œæ‰€ä»¥å®ƒè¦é»˜è®¤å¯¼å‡º Componentã€‚</p>
<blockquote>
<p>æ­¤å¤„ <code>.tsx</code> æ˜¯ä»¥ React ä¸ºä¾‹ï¼Œå…¶ä»–æ¡†æ¶åˆ™æ˜¯ <code>.vue</code>ã€<code>.svelte</code> æ‰©å±•åã€‚</p>
</blockquote>
<blockquote>
<p>ç”±äº Plasmo çš„ TypeScript é…ç½®å°†æ‰€æœ‰æ–‡ä»¶è§†ä¸ºæ¨¡å—ï¼Œå¦‚æœä½ çš„çº¯å†…å®¹è„šæœ¬æ²¡æœ‰ä»»ä½•å¯¼å‡ºï¼Œåˆ™å¿…é¡»è¦åŠ ä¸Š <code>export {}</code>ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœæœ‰å¤šä¸ªå†…å®¹è„šæœ¬ï¼Œåˆ™ç”¨ <code>contents</code> ç›®å½•ï¼Œæ¯”å¦‚ <code>contents/foo.tsx</code>ã€<code>contents/bar.tsx</code>ã€‚</p>
</blockquote>
<h4>å¯¼å‡ºé…ç½®</h4>
<p>ä¸»è¦ç”¨äºå®šä¹‰è„šæœ¬ä½œç”¨çš„ç½‘é¡µåœ°å€ã€æ‰§è¡Œæ—¶æœºç­‰ã€‚</p>
<pre><code class="language-tsx">// tos.tsx
import type { PlasmoCSConfig } from 'plasmo'

export const config: PlasmoCSConfig = {
  matches: ['https://github.com/*'],
  run_at: 'document_end'
}
</code></pre>
<blockquote>
<p>å…¶ä¸­é…ç½®é¡¹è¯¦è§ <a href="https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts#static-declarative">Inject with static declarations</a>ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœä½ çš„è„šæœ¬è¦ä¿®æ”¹ç½‘é¡µçš„ <code>window</code> å¯¹è±¡ï¼Œè¦æŒ‡å®š <code>world</code> é…ç½®é¡¹ä¸º <code>'MAIN'</code>ã€‚</p>
</blockquote>
<h4>æŒ‡å®šæ’å…¥é”šç‚¹</h4>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ UI è„šæœ¬è¦æŒ‚è½½åˆ°ç½‘é¡µçš„å“ªä¸ªåœ°æ–¹ã€‚</p>
<pre><code class="language-tsx">// tos.tsx
import type { PlasmoCSConfig, PlasmoGetInlineAnchor } from 'plasmo'

export const config: PlasmoCSConfig = {
  matches: ['https://github.com/*'],
  run_at: 'document_end'
}

// ğŸ†•
export const getInlineAnchor: PlasmoGetInlineAnchor = async () =&gt; ({
  element: document.querySelector('#partial-discussion-sidebar'),
  insertPosition: 'afterend'
})

export default function Toc() {
  return &lt;div className=&quot;toc&quot;&gt;Toc ç»„ä»¶&lt;/div&gt;
}
</code></pre>
<blockquote>
<p>å¦‚æœéœ€è¦æŒ‚è½½å¤šä¸ªï¼Œå¯¼å‡º <code>getInlineAnchorList</code>ï¼Œè¯¦è§ <a href="https://docs.plasmo.com/framework/content-scripts-ui/life-cycle#inline">Inline Anchor</a>ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1718531425354.png" alt=""></p>
<h4>å¼•å…¥æ ·å¼æ–‡ä»¶</h4>
<p>å‡è®¾å¼•å…¥ <code>toc.tsx</code> åŒçº§ç›®å½•ä¸‹çš„ <code>toc.css</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-css">/* toc.css */
.toc {
  color: #0969da;
}
</code></pre>
<pre><code class="language-tsx">// tos.tsx
import type { PlasmoCSConfig, PlasmoGetStyle } from 'plasmo'
import styleText from 'data-text:./toc.css'

// ğŸ†•
export const config: PlasmoCSConfig = {
  matches: ['https://github.com/*'],
  css: ['./toc.css'],
  run_at: 'document_end'
}

export const getStyle: PlasmoGetStyle = () =&gt; {
  const style = document.createElement('style')
  style.textContent = styleText
  return style
}

export default function Toc() {
  return &lt;div className=&quot;toc&quot;&gt;Toc ç»„ä»¶&lt;/div&gt;
}
</code></pre>
<p>å¯¼å‡ºä¸€ä¸ª <code>getStyle</code> æ–¹æ³•ï¼Œè¯»å–æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå¾€ç½‘é¡µæ’å…¥ä¸€ä¸ª <code>&lt;style&gt;</code> æ ‡ç­¾ã€‚</p>
<blockquote>
<p>å¯¹äº <code>data-text:./toc.css</code> çš„å†™æ³•ï¼Œè¯¦è§ <a href="https://docs.plasmo.com/framework/import#data-text">Import Resolution</a>ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1718532184534.png" alt=""></p>
<h4>è‡ªå®šä¹‰ Root Container</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPlasmo ä¼šåˆ›å»º Shadow DOMï¼Œå†æŒ‚è½½åˆ°é¡µé¢ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸å¤–éƒ¨éš”ç¦»ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç”¨åŸç½‘é¡µçš„æ ·å¼ï¼Œæ¯”å¦‚ CSS å˜é‡ç­‰ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œéœ€è¦å¯¼å‡ºä¸€ä¸ª <code>getRootContainer</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-tsx">// tos.tsx
import type { PlasmoCSConfig, PlasmoGetStyle, PlasmoGetInlineAnchor } from 'plasmo'
import styleText from 'data-text:./toc.css'

export const config: PlasmoCSConfig = {
  matches: ['https://github.com/*'],
  css: ['./toc.css'],
  run_at: 'document_end'
}

export const getStyle: PlasmoGetStyle = () =&gt; {
  const style = document.createElement('style')
  style.textContent = styleText
  return style
}

// ğŸ†• ç§»é™¤æ‰
// export const getInlineAnchor: PlasmoGetInlineAnchor = async () =&gt; ({
//   element: document.querySelector('#partial-discussion-sidebar'),
//   insertPosition: 'afterend'
// })

// ğŸ†•
export const getRootContainer = () =&gt; {
  return new Promise(resolve =&gt; {
    const timer = setInterval(() =&gt; {
      const rootContainer = document.querySelector('#plasmo-toc')
      if (rootContainer) {
        clearInterval(timer)
        resolve(rootContainer)
        return
      }

      const rootContainerParent = document.querySelector('.Layout-sidebar')
      if (rootContainerParent) {
        clearInterval(timer)

        const rootContainer = document.createElement('div')
        rootContainer.id = 'plasmo-toc'
        rootContainerParent.appendChild(rootContainer)

        resolve(rootContainer)
      }
    }, 200)
  })
}

export default function Toc() {
  return &lt;div className=&quot;toc&quot;&gt;Toc ç»„ä»¶&lt;/div&gt;
}
</code></pre>
<blockquote>
<p>è¿™é‡Œç”¨åˆ° <code>setInterval()</code> æ˜¯ä¸ºäº†ç¡®ä¿æŒ‚è½½ç‚¹çš„çˆ¶çº§å·²åŠ è½½å®Œæ¯•ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œæˆ‘åœ¨ <code>.Layout-sidebar</code> ä¸‹æ·»åŠ äº† <code>#plasmo-toc</code> å…ƒç´ ï¼Œå¹¶å°† Toc ç»„ä»¶æŒ‚è½½åˆ°ä¸Šé¢ï¼Œä»¥å®ç°ä¸Šè¿° <code>getInlineAnchor</code> çš„ <code>insertPosition: 'afterend'</code> çš„æ•ˆæœã€‚åŸå› æ˜¯ ReactDOM çš„ <code>createRoot()</code> ä¼šè¦†ç›–æŒ‚è½½å…ƒç´ çš„å†…å®¹ï¼Œå®ƒä¼šåæ‰ <code>.Layout-sidebar</code> çš„æ‰€æœ‰å†…å®¹ï¼Œè¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚</p>
<h4>è‡ªå®šä¹‰ render</h4>
<p>å‰é¢ <a href="https://developer.chrome.com/docs/extensions/reference/manifest/content-scripts?hl=zh-cn#world-timings"><code>run_at</code></a> æŒ‡å®šä¸º <code>document_end</code>ï¼Œè¿˜æœ‰å…¶ä»–å€¼ï¼š</p>
<ul>
<li>
<p><code>document_start</code>ï¼šåœ¨ css ä¸­çš„ä»»ä½•æ–‡ä»¶ä¹‹åã€æ„å»ºä»»ä½•å…¶ä»– DOM æˆ–è¿è¡Œä»»ä½•å…¶ä»–è„šæœ¬ä¹‹å‰æ³¨å…¥è„šæœ¬ã€‚</p>
</li>
<li>
<p><code>document_end</code>ï¼šåœ¨ DOM å®Œæˆä¹‹åï¼Œåœ¨å›¾ç‰‡å’Œæ¡†æ¶ç­‰å­èµ„æºåŠ è½½ä¹‹å‰ç«‹å³æ³¨å…¥è„šæœ¬ã€‚</p>
</li>
<li>
<p><code>document_idle</code>ï¼šæµè§ˆå™¨ä¼šé€‰æ‹©ä¸€ä¸ªæ—¶é—´ï¼Œåœ¨ <code>document_end</code> ä¹‹é—´ä»¥åŠ <code>window.onload</code> äº‹ä»¶è§¦å‘åç«‹å³æ³¨å…¥è„šæœ¬ã€‚æ³¨å…¥çš„ç¡®åˆ‡æ—¶åˆ»å–å†³äºæ–‡æ¡£çš„å¤æ‚ç¨‹åº¦å’ŒåŠ è½½ç”¨æ—¶ï¼Œå¹¶é’ˆå¯¹ç½‘é¡µåŠ è½½é€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨ <code>document_idle</code> è¿è¡Œçš„å†…å®¹è„šæœ¬ä¸éœ€è¦ç›‘å¬ <code>window.onload</code> äº‹ä»¶ï¼›å®ƒä»¬ä¸€å®šä¼šåœ¨ DOM å®Œæˆåè¿è¡Œã€‚å¦‚æœè„šæœ¬ç¡®å®éœ€è¦åœ¨ <code>window.onload</code> ä¹‹åè¿è¡Œï¼Œè¯¥æ‰©å±•ç¨‹åºå¯ä»¥ä½¿ç”¨ <code>document.readyState</code> å±æ€§æ£€æŸ¥ <code>onload</code> æ˜¯å¦å·²è§¦å‘ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚</p>
</li>
</ul>
<p>ä»¥ TOC ç»„ä»¶ä¸ºä¾‹ï¼Œå½“è¿›å…¥é¡µé¢åï¼Œé¡µé¢åŠ è½½å®Œæ¯•ï¼Œç„¶åç”Ÿæˆäº†ç›®å½•ã€‚å¦‚æœåç»­ Markdown å†…å®¹é€šè¿‡ Ajax æ–¹å¼æ›´æ–°äº†ï¼Œé‚£ç›®å½•æœ‰å¯èƒ½è·Ÿæœ€æ–°å†…å®¹å¯¹ä¸ä¸Šäº†ã€‚è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸€æ˜¯ï¼Œåœ¨ TOC ç»„ä»¶å†…ç›‘å¬å†…å®¹å˜åŒ–ï¼Œè¿›è€Œè§¦å‘ç»„ä»¶æ›´æ–°ã€‚</li>
<li>äºŒæ˜¯ï¼Œå½“å†…å®¹æ›´æ–°æ—¶ï¼Œå…ˆå¸è½½æ—§çš„ TOC ç»„ä»¶ï¼Œå†æŒ‚è½½æ–°çš„ TOC ç»„ä»¶ã€‚</li>
</ul>
<p>æŒ‰éœ€é€‰æ‹©ã€‚åœ¨ GitHub Issue TOC çš„åœºæ™¯ï¼Œè¦ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚åŸå› æ˜¯ï¼Œåœ¨ GitHub çš„é Issue é¡µé¢è·³è½¬åˆ° Issue é¡µé¢æ—¶ï¼Œåº”è¯¥æ˜¯ä½¿ç”¨äº† <code>history.pushState()</code> æ–¹å¼ï¼Œå®ƒä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ï¼Œå¯¼è‡´ç›®å½•å°±ä¸ä¼šç”Ÿæˆäº†ã€‚è¿™ç§æƒ…å†µé  <code>document_end</code> æ˜¯æ— æ³•è§£å†³çš„ã€‚</p>
<pre><code class="language-tsx">// tos.tsx
import type { PlasmoCSConfig, PlasmoGetStyle, PlasmoCSUIJSXContainer, PlasmoRender } from 'plasmo'
import styleText from 'data-text:./toc.css'

export const config: PlasmoCSConfig = {
  matches: ['https://github.com/*'],
  css: ['./toc.css'],
  run_at: 'document_end'
}

export const getStyle: PlasmoGetStyle = () =&gt; {
  const style = document.createElement('style')
  style.textContent = styleText
  return style
}

export const getRootContainer = () =&gt; {
  return new Promise(resolve =&gt; {
    const timer = setInterval(() =&gt; {
      const rootContainer = document.querySelector('#plasmo-toc')
      if (rootContainer) {
        clearInterval(timer)
        resolve(rootContainer)
        return
      }

      const rootContainerParent = document.querySelector('.Layout-sidebar')
      if (rootContainerParent) {
        clearInterval(timer)

        const rootContainer = document.createElement('div')
        rootContainer.id = 'plasmo-toc'
        rootContainerParent.appendChild(rootContainer)

        resolve(rootContainer)
      }
    }, 200)
  })
}

// ğŸ†•
export const render: PlasmoRender&lt;PlasmoCSUIJSXContainer&gt; = async ({ createRootContainer }) =&gt; {
  const url = document.location.href
  if (!isGitHubIssuePage(url)) return

  const rootContainer = await createRootContainer()
  const root = createRoot(rootContainer)
  window.__plasmoTocRoot = root
  root.render(&lt;Toc /&gt;)
}

export default function Toc() {
  return &lt;div className=&quot;toc&quot;&gt;Toc ç»„ä»¶&lt;/div&gt;
}
</code></pre>
<p>å…·ä½“é€»è¾‘ï¼ŒæŒ‰éœ€è°ƒæ•´ã€‚ç”±äºé‡æ–°æŒ‚è½½é¡µé¢æ—¶ï¼Œè¦å…ˆå°†æ—§çš„ React App å¸è½½ï¼Œæ‰€ä»¥è¿™é‡Œè®°å½•äº†<code>window.__plasmoTocRoot = root</code> ä¾›ä¸‹æ¬¡æŒ‚è½½ç”¨ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-tsx">async function recreateRoot() {
  const rootContainer = await getRootContainer()

  if (window.__plasmoTocRoot) {
    window.__plasmoTocRoot.unmount()
  }

  const root = createRoot(rootContainer as Element)
  window.__plasmoTocRoot = root
  root.render(&lt;Toc /&gt;)

  onIssueUpdate()
}
</code></pre>
<h3>Service Worker</h3>
<p>è¿™æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½ ç”¨ä¸åˆ° Service Worker å¯ä»¥åœ¨åˆ æ‰ <code>background.ts</code> æ–‡ä»¶ï¼Œæˆ–è€…å¯¼å‡ºä¸€ä¸ª <code>export {}</code>ï¼ŒåŸå› åŒ Content Scriptsã€‚</p>
<p>å‰é¢æåˆ°ï¼Œä» GitHub Repo è·³è½¬åˆ° GitHub Issue é¡µé¢çš„åœºæ™¯ï¼Œæ— æ³•ç”Ÿæˆç›®å½•ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘è¦å€ŸåŠ© Service Worker æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¤§è‡´æ€è·¯æ˜¯ï¼Œé€šè¿‡ <code>chrome.webNavigation</code> æ¥ç›‘å¬ç½‘é¡µ History å˜åŒ–ï¼Œå½“è·³è½¬åˆ° Issue é¡µé¢æ—¶ï¼Œå‘ Content Scripts ä¼ é€’æ¶ˆæ¯ï¼Œå‘Šè¯‰å®ƒè¯¥æŒ‚è½½ TOC ç»„ä»¶äº†ã€‚</p>
<blockquote>
<p>äº‹ä»¶é¡ºåºï¼šonBeforeNavigate â†’ onCommitted â†’ [onDOMContentLoaded] â†’ onCompleted</p>
</blockquote>
<pre><code class="language-ts">// background.ts
import { MESSAGE_TYPE } from '@/constants'
import { isGitHubIssuePage } from '@/utils'

chrome.webNavigation.onCompleted.addListener(() =&gt; {
  chrome.webNavigation.onHistoryStateUpdated.addListener(details =&gt; {
    const { url, tabId } = details
    if (!isGitHubIssuePage(url)) return
    sendMessageToContentScript(tabId, { type: MESSAGE_TYPE.PLASMO_TOC_MOUNT, payload: details })
  })
})

async function sendMessageToContentScript(tabId: number, message: any) {
  try {
    chrome.tabs.sendMessage(tabId, message)
  } catch (error) {
    console.error(`Failed to send message: ${error}`)
  }
}
</code></pre>
<blockquote>
<p>åœ¨ Service Worker å†…æ— æ³•è·å–ã€æ“ä½œ DOMã€‚</p>
</blockquote>
<p>ç”±äº Service Worker ç”¨åˆ° <a href="https://developer.chrome.com/docs/extensions/reference/api/webNavigation?hl=zh-cn"><code>webNavigation</code></a>ï¼Œéœ€è¦åœ¨æ¸…å•ä¸­å£°æ˜æƒé™ã€‚åœ¨ Plasmo æ¡†æ¶æ˜¯åœ¨ <code>package.json</code> é‡ŒæŒ‡å®šå³å¯ï¼Œæ„å»ºæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ° <code>manifest.json</code> çš„ã€‚</p>
<pre><code class="language-json">{
  &quot;manifest&quot;: {
    &quot;permissions&quot;: [
      &quot;webNavigation&quot;
    ]
  }
}
</code></pre>
<p>åŒæ—¶ï¼Œè¦åœ¨ Content Script é‡Œæ¥æ”¶ä¿¡æ¯ï¼š</p>
<pre><code class="language-tsx">// toc.tsx
import { MESSAGE_TYPE } from '@/constants'

chrome.runtime.onMessage.addListener(throttle(onBackgroundMessage, 500))

let plasmoTocMounting = false

function onBackgroundMessage(message: { type: string; payload: any }) {
  try {
    if (message.type !== MESSAGE_TYPE.PLASMO_TOC_MOUNT) return

    if (plasmoTocMounting) return
    plasmoTocMounting = true

    const rootContainer = document.querySelector('#plasmo-toc')
    if (rootContainer) return

    recreateRoot()
  } finally {
    plasmoTocMounting = false
  }
}
</code></pre>
<h3>Popup</h3>
<p>æˆ‘è¿™ä¸ªæ‰©å±•ï¼Œå…¶å® Popup çª—å£ï¼Œå…¶å®æ²¡ä»€ä¹ˆå†…å®¹ï¼Œå°±æ”¾äº†ä¸€ä¸ª Homepage å’Œ Report issue çš„é“¾æ¥ã€‚</p>
<pre><code class="language-tsx">// popup/index.tsx
import './index.css'

export default function Popup() {
  return (
    &lt;div className=&quot;popup&quot;&gt;
      &lt;div className=&quot;greeting&quot;&gt; Enjoy it. â¤ï¸&lt;/div&gt;
      &lt;div className=&quot;links&quot;&gt;
        &lt;a className=&quot;link&quot; href=&quot;https://github.com/toFrankie/github-issue-toc&quot; target=&quot;_blank&quot;&gt;
          Homepage
        &lt;/a&gt;
        &lt;span className=&quot;separator&quot;&gt;â€¢&lt;/span&gt;
        &lt;a
          className=&quot;link&quot;
          href=&quot;https://github.com/toFrankie/github-issue-toc/issues&quot;
          target=&quot;_blank&quot;&gt;
          Report issue
        &lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p>æä¸€ä¸‹ï¼Œå¯¼å…¥æ ·å¼ä¸ç”¨åƒ Content Script é‚£æ ·ç”¨ <code>data-text:./index.css</code> æ¥å¯¼å…¥ï¼Œä¹Ÿä¸ç”¨å¯¼å‡º <code>getStyle</code> æ–¹æ³•ã€‚</p>
<h2>è°ƒè¯•</h2>
<p>ä½¿ç”¨ <code>pnpm create plasmo</code> åˆ›å»ºçš„é¡¹ç›®ï¼ŒåŒ…å«äº†ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;plasmo dev&quot;,
    &quot;build&quot;: &quot;plasmo build&quot;,
    &quot;package&quot;: &quot;plasmo package&quot;
  }
}
</code></pre>
<p>å°±å­—é¢æ„æ€ï¼Œä¸å¤šè¯´äº†ã€‚</p>
<ul>
<li><code>pnpm dev</code> äº§å‡º <code>build/chrome-mv3-dev</code></li>
<li><code>pnpm build</code> äº§å‡º <code>build/chrome-mv3-prod</code></li>
<li><code>pnpm package</code> äº§å‡º <code>build/chrome-mv3-prod.zip</code></li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œdev å’Œ build çš„äº§ç‰©æ˜¯ä¸¤ä¸ªä¸åŒçš„æ‰©å±•ï¼Œå‰è€…åœ¨æ‰©å±•åç§°åŠ äº† <code>DEV | </code> å‰ç¼€ã€‚</p>
</blockquote>
<h3>å¯¼å…¥æœ¬åœ°æ‰©å±•ç¨‹åº</h3>
<ol>
<li>æµè§ˆå™¨æ‰“å¼€ chrome://extensions</li>
<li>å¼€å¯ã€Œå¼€å‘è€…æ¨¡å¼ã€</li>
<li>åœ¨ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€é€‰æ‹©å¯¹åº”çš„äº§ç‰©ç›®å½•ï¼Œå¹¶å¯ç”¨è¯¥æ‰©å±•ã€‚</li>
</ol>
<h3>è°ƒè¯• Content Scripts</h3>
<p>åœ¨å¼€å‘æ—¶ï¼Œæºä»£ç å˜æ›´ä¼šè‡ªåŠ¨æ›´æ–°æ‰©å±•ï¼Œç”šè‡³ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚æœ‰æ—¶å¯èƒ½ä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="language-txt">Error: Extension context invalidated.
</code></pre>
<p>æˆ–é¡µé¢ä¸Šå‡ºç° Plamso æç¤ºï¼š</p>
<pre><code class="language-txt">Context Invalidated, Press to Reload
</code></pre>
<p>åŸå› æ˜¯ Plasmo é‡æ–°åŠ è½½æ‰©å±•ï¼Œä¼šä½¿å¾—æ—§çš„æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆï¼Œæ•…è€ŒæŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯åˆ·æ–°é¡µé¢ã€‚</p>
<blockquote>
<p>åœ¨ DevTool çš„ Source - Content Scripts é¢æ¿ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ‰©å±•ç¨‹åºçš„è„šæœ¬ã€‚</p>
</blockquote>
<h3>è°ƒè¯• Service Worker</h3>
<p>åœ¨ chrome://extensions å¯¹åº”æ‰©å±•é‡Œï¼Œå¯ä»¥çœ‹åˆ° ã€Œæ£€æŸ¥è§†å›¾ Service Workerã€æˆ–ã€Œæ£€æŸ¥è§†å›¾ èƒŒæ™¯é¡µã€çš„å…¥å£ï¼Œç‚¹å‡»è¿›å…¥å¯è°ƒè¯•ã€‚</p>
<h3>è°ƒè¯• Popup</h3>
<p>å¼€å‘æ—¶ï¼Œå¯ä»¥å°†æ‰©å±•å›ºå®šåœ¨ Chrome å·¥å…·æ ï¼Œä»¥ä¾¿äºè°ƒè¯•ã€‚ç‚¹å‡»æ‰©å±•å›¾æ ‡ï¼Œæ‰“å¼€ Popup å¼¹çª—ï¼Œç„¶ååƒç½‘é¡µé‚£æ ·å³é”®æ£€æŸ¥å…ƒç´ å³å¯ã€‚</p>
<h2>æäº¤æ‰©å±•</h2>
<p>å‡†å¤‡å¥½ä»¥ä¸‹ä¸œè¥¿ï¼Œæ‰§è¡Œ <code>pnpm package</code> æ‰“åŒ…ï¼Œå‰å¾€<a href="https://chrome.google.com/webstore/devconsole/">å¼€å‘è€…ä¿¡æ¯ä¸­å¿ƒ</a>ä¸Šä¼ ï¼Œå¡«å¥½ç›¸å…³ä¿¡æ¯æäº¤å®¡æ ¸å³å¯ã€‚</p>
<h3>åŸºç¡€ä¿¡æ¯</h3>
<p>ä½¿ç”¨ Plasmo çš„è¯ï¼Œ<code>package.json</code> éƒ¨åˆ†å­—æ®µä¼šåœ¨æ„å»ºæ—¶ä¼ é€’åˆ° <code>manifest.json</code> é‡Œï¼ŒæŒ‰å®é™…æƒ…å†µå¡«å†™å°±å¥½ã€‚</p>
<ul>
<li><code>packageJson.version</code> â†’ <code>manifest.version</code></li>
<li><code>packageJson.displayName</code> â†’ <code>manifest.name</code></li>
<li><code>packageJson.description</code> â†’ <code>manifest.description</code></li>
<li><code>packageJson.author</code> â†’ <code>manifest.author</code></li>
<li><code>packageJson.homepage</code> â†’ <code>manifest.homepage_url</code></li>
</ul>
<p>å…¶ä½™ä» <code>packageJson.manifest</code> è¯»å–ã€‚</p>
<h3>å›¾æ ‡</h3>
<p>å»ºè®®æ ¼å¼ä¸º <code>.png</code>ï¼Œä¸æ”¯æŒ <code>.webp</code> å’Œ <code>.svg</code>ã€‚</p>
<p>æä¾› 16Ã—16ã€32Ã—32ã€48Ã—48ã€128Ã—128 å››ç§å°ºå¯¸çš„å›¾ç‰‡ï¼Œä»¥ <code>icon&lt;size&gt;.png</code> å½¢å¼å‘½åï¼Œç½®äº <code>assets</code> ç›®å½•å†…ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼ŒPlasmo é¡¹ç›®çš„ <code>assets</code> ç›®å½•ä½äºé¡¹ç›®æ ¹ç›®å½•ï¼Œä¸æ˜¯ <code>src</code> ç›®å½•å†…ï¼Œå³ä¾¿æ˜¯é€šè¿‡ <a href="https://docs.plasmo.com/framework/customization/src#--with-src"><code>--with-src</code></a> æ–¹å¼åˆ›å»ºçš„æ¨¡æ¿é¡¹ç›®ã€‚</p>
</blockquote>
<blockquote>
<p>å›¾æ ‡è§†è§‰è®¾è®¡ï¼Œå‚è€ƒå®˜æ–¹<a href="https://developer.chrome.com/docs/webstore/images?hl=zh-cn#icons">æŒ‡å—</a>ã€‚</p>
</blockquote>
<h3>Chrome Web Store å›¾ç‰‡èµ„æº</h3>
<ul>
<li>å•†åº—å›¾æ ‡ï¼š128Ã—128 çš„å›¾æ ‡</li>
<li>å±å¹•æˆªå›¾ï¼š1280Ã—800 æˆ– 640Ã—400ï¼Œ1 ~ 5 å¼ </li>
<li>å°å‹å®£ä¼ å›¾ï¼š440Ã—280 ç”»å¸ƒï¼ˆå¯é€‰ï¼‰</li>
<li>é¡¶éƒ¨å®£ä¼ å›¾ï¼š1400Ã—560 ç”»å¸ƒï¼ˆå¯é€‰ï¼‰</li>
</ul>
<h3>éšç§ç›¸å…³è¯´æ˜</h3>
<p>ä¸€æ˜¯ï¼Œè¦å‡†å¤‡æ‰©å±•ç¨‹åºçš„ç”¨é€”è¯´æ˜ã€‚
äºŒæ˜¯ï¼Œè¦å‡†å¤‡è¯·æ±‚æƒé™çš„ç†ç”±ï¼Œæ¯”å¦‚æˆ‘ç”¨åˆ°äº† <code>host_permissions</code> å’Œ <code>webNavigation</code> æƒé™ï¼Œéƒ½è¦åœ¨ä¸Šä¼ æ—¶è¯´æ˜æ¸…æ¥šã€‚</p>
<p>æ‰€ä»¥ï¼Œæ²¡ç”¨åˆ°çš„æƒé™å°±ä¸è¦åŠ ä¸Šå»äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•å®ç°ä¸€ä¸ªå‡†ç¡®çš„å€’è®¡æ—¶åŠŸèƒ½]]></title>
            <link>https://github.com/toFrankie/blog/issues/339</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/339</guid>
            <pubDate>Sun, 26 May 2024 05:08:30 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721452490274.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>å€’è®¡æ—¶ã€è®¡æ—¶å™¨æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚è¦æ±‚å¾ˆç®€å•ï¼Œä½†åš]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721452490274.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>å€’è®¡æ—¶ã€è®¡æ—¶å™¨æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚è¦æ±‚å¾ˆç®€å•ï¼Œä½†åšèµ·æ¥ä¹Ÿä¸å¤ªç®€å•ï¼š</p>
<ul>
<li>å‡†ç¡®æ€§é«˜</li>
<li>æ€§èƒ½å¥½</li>
</ul>
<p>å¦‚æœä½ å°†è¦å®ç°çš„è®¡æ—¶è¦ä½“ç°åœ¨ DOM ä¸Šï¼Œå®ƒæ°¸è¿œä¸å¯èƒ½ç™¾åˆ†ç™¾å‡†ç¡®ã€‚</p>
<p>JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼ˆæŒ‡ä¸»çº¿ç¨‹ï¼‰ï¼Œæ³¨å®šäº†æ— æ³•ä¸€è¾¹æ‰§è¡Œ JS ä»£ç ã€ä¸€è¾¹æ›´æ–° DOMã€‚å³ä¾¿æ˜¯ HTML5 æå‡ºçš„ Web Workerï¼Œå®ƒæ˜¯å¯ä»¥åœ¨ä¸»åŠ¨åˆ›å»ºä¸€äº›åå°æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¯å®ƒä¸èƒ½ç›´æ¥æ“ä½œ DOMï¼Œå®ƒä¼ é€’ä¿¡æ¯ç»™ä¸»çº¿ç¨‹ï¼Œä¹Ÿä¼šå—åˆ° Event Loop çš„å½±å“ï¼Œè¯¥æ’é˜Ÿè¿˜æ˜¯å¾—æ’é˜Ÿã€‚</p>
<p>ä½†å°±äººçœ¼æ¥è¯´ï¼Œå‡ æ¯«ç§’ã€å‡ åæ¯«ç±³çš„è¯¯å·®åŸºæœ¬æ˜¯æ— æ„Ÿçš„ï¼Œè¿™å°±å¯ä»¥ç®—æ˜¯ä¸€ä¸ªå‡†ç¡®ã€åˆæ ¼çš„å€’è®¡æ—¶ã€‚</p>
<p>é€šå¸¸è¦è€ƒè™‘çš„é—®é¢˜æœ‰ï¼š</p>
<ul>
<li>setTimeoutã€setInterval ä¸å‡†</li>
<li>requestAnimationFrame æ‰§è¡Œå¤ªé¢‘ç¹</li>
<li>Date å—æœ¬æœºç³»ç»Ÿæ—¶é’Ÿå½±å“</li>
</ul>
<h2>setTimeout å’Œ setInterval</h2>
<p>æˆ‘è®¤ä¸ºè¿˜æ˜¯è¦èŠä¸€èŠ setTimeout å’Œ setIntervalã€‚</p>
<p>çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">setTimeout(() =&gt; {
  console.log('Hi~')
}, 1000)
</code></pre>
<p>ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå®ƒ<strong>è‡³å°‘</strong> 1s ä¹‹åæ‰èƒ½æ‰“å° <code>Hi~</code>ã€‚</p>
<blockquote>
<p><code>setTimeout(fn, delay)</code> çš„ <code>delay</code> æ˜¯æœ€å°å¼€å§‹æ‰§è¡Œæ—¶é—´ï¼Œè€Œä¸”åªä¼šå¤šä¸ä¼šå°‘ã€‚</p>
</blockquote>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-js">setInterval(() =&gt; {
  console.log('Hi~')
}, 1000)
</code></pre>
<p>å®ƒè·Ÿ setTimeout ä¸€æ ·å— Event Loop å½±å“ï¼Œè‡ªç„¶ä¸å¯èƒ½å®Œç¾åœ°æ¯ç§’æ‰“å°ä¸€æ¬¡ <code>Hi~</code>ã€‚</p>
<p>ç”¨ setTimeout æ¨¡æ‹Ÿï¼š</p>
<pre><code class="language-js">setTimeout(function tick() {
  console.log('Hi~')
  setTimeout(tick, 1000)
}, 1000)
</code></pre>
<p>ğŸ™‹ æé—®ï¼šå®ƒè·Ÿ setInterval ç‰ˆæœ¬åŠŸèƒ½ä¸Šç­‰æ•ˆçš„å—ï¼Ÿ</p>
<blockquote>
<p>ç­”æ¡ˆæ˜¯ä¸ä¸€æ ·çš„ï¼ŒsetInterval ä¼šäº§ç”Ÿä¸€ç§â€œæ¼‚ç§»â€ï¼ˆdriftï¼‰ç°è±¡ã€‚</p>
</blockquote>
<p>åœ¨ Google ä¸Šæœç´¢ã€ŒsetInterval driftã€å…³é”®è¯ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šç›¸å…³çš„è®¨è®ºå¸–å­ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><a href="https://stackoverflow.com/questions/985670/will-setinterval-drift">Will setInterval drift?</a></li>
<li><a href="https://github.com/nodejs/node/issues/21822">setInterval keeps drifting over time</a></li>
<li><a href="https://github.com/whatwg/html/issues/3151">Should setInterval account for execution delays to prevent drift?</a></li>
</ul>
<p>æ€ä¹ˆç†è§£æ¼‚ç§»å‘¢ï¼Ÿ</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;body&gt;
    &lt;div id=&quot;time&quot;&gt;&lt;/div&gt;
    &lt;script&gt;
      window.onload = function () {
        const element = document.getElementById('time')
        const startTime = performance.now()
        let count = 0

        setInterval(() =&gt; {
          count++
          const currentTime = performance.now()
          const time = (currentTime - startTime) / 1000
          const rate = count / time
          element.innerHTML = `${count} call in ${time.toFixed(3)}s, or ${rate.toFixed(6)} calls per second.`
        }, 1000)
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p><a href="https://codepen.io/tofrankie/pen/RwmEqwR">CodePen Demo</a></p>
</blockquote>
<p>å®ƒåœ¨ Chrome 126 è¡¨ç°å¾ˆå¥½ï¼Œå‡ ä¹æ˜¯æ¯ä¸€ç§’æ›´æ–°ä¸€æ¬¡ã€‚</p>
<pre><code class="language-txt">34 call in 34.001s, or 0.999965 calls per second.
</code></pre>
<p>åœ¨ Firefox 127 ä¸Šï¼Œå½“æ‰§è¡Œäº†å¤§æ¦‚ 300 æ¬¡ä¹‹åï¼Œçº¦æ¼‚ç§»äº† 1s å·¦å³ã€‚Safari æ¼‚ç§»ä¹Ÿè¾ƒä¸ºæ˜æ˜¾ã€‚</p>
<pre><code class="language-txt">317 call in 318.242s, or 0.996097 calls per second.
</code></pre>
<p>æ®æŸ¥ï¼ŒChrome æœ‰åšâ€œè‡ªåŠ¨ä¿®æ­£â€çš„å¤„ç†ï¼ˆ<a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/WebKit/Source/platform/Timer.cpp;drc=e6d900fb6ed08dbd3a048899f38962ee75f4d8d0;l=162">æºç </a>ï¼‰ï¼Œå³ä¾¿æ˜¯æ‰§è¡Œäº† 300 å¤šæ¬¡ï¼Œç”šè‡³æ›´å¤šæ—¶ï¼Œå…¶æ¼‚ç§»ä¹Ÿå¾ˆä½ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ã€‚å°½ç®¡è¿™ç§ä¿®æ­£å¹¶ä¸æ˜¯è§„èŒƒæ‰€è¦æ±‚ï¼Œä½†åº”è¯¥æ˜¯å¼€å‘è€…æƒ³è¦çš„ç»“æœã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå½“é¡µé¢æŒ‚èµ·åå°ï¼Œä¸ºäº†çœç”µå’Œå‡å°‘ CPU å ç”¨ï¼Œä¸åŒæµè§ˆå™¨ä¼šé‡‡ç”¨ä¸€äº›<a href="https://developer.chrome.com/blog/timer-throttling-in-chrome-88">ç­–ç•¥</a>ï¼Œæš‚åœæˆ–å»¶é•¿å®šæ—¶å™¨çš„ Delay Timeã€‚</p>
<blockquote>
<p>æŒ‚èµ·åå°çš„æƒ…å†µåŒ…å«ä½†ä¸é™äºï¼šæœ‰å…¶ä»–å¤„äºæ´»è·ƒçŠ¶æ€çš„æ ‡ç­¾ã€çª—å£æœ€å°åŒ–ã€ç½‘é¡µå†…å®¹å®Œå…¨ä¸å¯è§ã€å±å¹•é”å®šã€ç§»åŠ¨è®¾å¤‡å›åˆ°æ¡Œé¢ç­‰ã€‚</p>
</blockquote>
<p>å°ç»“ï¼š</p>
<ul>
<li><code>setTimeout(fn, delay)</code> çš„ delay æ˜¯æœ€å°å¼€å§‹æ‰§è¡Œæ—¶é—´ï¼Œè€Œä¸”åªä¼šå¤šä¸ä¼šå°‘ã€‚</li>
<li><code>setInterval(fn, delay)</code> çš„ delay ä¼šå·¦å³â€œæ¼‚ç§»â€ï¼Œç´¯è®¡æ‰§è¡Œæ¬¡æ•°è¶Šå¤šï¼Œæ¼‚ç§»è¶Šæ˜æ˜¾ã€‚åœ¨ Chrome æµè§ˆå™¨ä¸‹æœ‰â€œä¿®æ­£â€å¤„ç†ï¼Œæ¯æ¬¡å®é™…æ‰§è¡Œçš„ delay ä¸ä¼ å…¥çš„å€¼å¾ˆæ¥è¿‘ï¼Œå¯ä»¥å½“ä½œæ²¡æœ‰è¯¯å·®ã€‚</li>
<li>åœ¨åå°æ—¶ï¼ŒsetTimeout å’Œ setInterval å›è°ƒä¼šé™ä½æ‰§è¡Œé¢‘ç‡ï¼Œç”šè‡³æš‚åœï¼Œè¿”å›å‰å°å†æ¢å¤ã€‚</li>
</ul>
<p>å…³äº Event Loop æ¨èä¸¤ä¸ªä¸é”™çš„è§†é¢‘ï¼š</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&amp;ab_channel=JSConf">In The Loop</a>ï¼ˆ<a href="https://www.bilibili.com/video/BV12K4y1f7js/?vd_source=7d9cc886b2d77a79704681f5e9759d23">ä¸­æ–‡ç‰ˆ</a>ï¼‰</li>
<li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ&amp;ab_channel=JSConf">What the heck is the event loop anyway?</a>ï¼ˆ<a href="https://www.bilibili.com/video/av456657611/?vd_source=7d9cc886b2d77a79704681f5e9759d23">ä¸­æ–‡ç‰ˆ</a>ï¼‰</li>
</ul>
<h2>ä¸é è°±ç‰ˆæœ¬</h2>
<p>å°½ç®¡ setTimeout å’Œ setInterval å¾ˆå¤šé—®é¢˜ï¼Œä½†è¿˜æ˜¯è¦ç”¨åˆ°å®ƒï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å°½å¯èƒ½å‡å°‘è¯¯å·®ã€‚</p>
<p>å‡è®¾æœ‰ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;countdown&quot;&gt;0 days, 0 hours, 0 minutes, 0 seconds&lt;/div&gt;
</code></pre>
<pre><code class="language-js">window.onload = function () {
  // å€’è®¡æ—¶æ—¶é•¿ï¼ˆç§’ï¼‰
  const seconds = 90
  countdown(seconds)
}

function countdown(seconds) {
  // TODO: å¾…å®ç°...
}

// å€’è®¡æ—¶å±•ç¤ºå½¢å¼
function renderCounter(timeLeft) {
  const secondInMillisecond = 1000
  const minuteInMillisecond = secondInMillisecond * 60
  const hourInMillisecond = minuteInMillisecond * 60
  const dayInMillisecond = hourInMillisecond * 24

  const dayLeft = Math.floor(timeLeft / dayInMillisecond)
  const hourLeft = Math.floor((timeLeft % dayInMillisecond) / hourInMillisecond)
  const minuteLeft = Math.floor((timeLeft % hourInMillisecond) / minuteInMillisecond)
  const secondLeft = Math.floor((timeLeft % minuteInMillisecond) / secondInMillisecond)

  const html = `${dayLeft} days, ${hourLeft} hours, ${minuteLeft} minutes, ${secondLeft} seconds`
  document.getElementById('countdown').innerHTML = html
}
</code></pre>
<p>å…¶ä¸­ <code>countdown()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‰©ä½™çš„ç§’æ•° <code>seconds</code>ã€‚</p>
<blockquote>
<p>æˆ‘ä¸å…³å¿ƒæ˜¯ç”¨æœ¬åœ°æ—¶é—´ï¼Œè¿˜æ˜¯æœåŠ¡å™¨æ—¶é—´ç®—å‡ºæ¥çš„ï¼Œä½ åªéœ€å‘Šè¯‰æˆ‘å‰©ä½™å¤šå°‘ç§’å°±è¡Œã€‚</p>
</blockquote>
<p>ç®€é™‹ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">function countdown(seconds) {
  const startTime = Date.now()
  const endTime = startTime + seconds * 1000

  let timeLeft = endTime - startTime

  const timer = setInterval(() =&gt; {
    timeLeft -= 1000

    if (timeLeft &lt;= 0) {
      clearInterval(timer)
      renderCounter(0)
      return
    }

    renderCounter(timeLeft)
  }, 1000)

  renderCounter(timeLeft)
  // ğŸ™‹
}
</code></pre>
<p>å‡è®¾åœ¨ ğŸ™‹ å¤„æœ‰ä¸€ä¸ªè€—æ—¶çš„åŒæ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">function longRunningTask() {
  for (let i = 0; i &lt; 1000000000; i++) {
    // do something...
  }
}
</code></pre>
<blockquote>
<p>å®é™…ä¸­ï¼Œè€—æ—¶ä»»åŠ¡ä¸åº”æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™é‡Œåªç”¨äºè¡¨è¾¾ä¸Šè¿°ä¾‹å­çš„ç¼ºç‚¹ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆ setInterval ç¬¬ä¸€æ¬¡å›è°ƒçš„æ‰§è¡Œå°±å¯èƒ½å‘ç”Ÿåœ¨ N ç§’ä¹‹åï¼Œè¿™æ ·é¡µé¢ä¸Šçš„å€’è®¡æ—¶å°±æ›´ä¸å‡†äº†ã€‚ä¼šå‡ºç°è¿‡äº† 5s ä¹‹åï¼Œå€’è®¡æ—¶å¯èƒ½åªå‡å» 1s çš„æƒ…å†µï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>å³ä¾¿æ²¡æœ‰è€—æ—¶ä»»åŠ¡ï¼Œå¦‚æœè¢«æŒ‚èµ·åå°ï¼Œæ‰§è¡Œé¢‘ç‡ä¼šå˜ä½ï¼Œç”šè‡³æš‚åœï¼Œé‡æ–°å›åˆ°å‰å°å‰©ä½™æ—¶é—´å°±ä¸å‡†äº†ã€‚</p>
<p>å› æ­¤ï¼ŒtimeLeftï¼ˆå‰©ä½™æ—¶é—´ï¼‰è¦åœ¨ setInterval å›è°ƒå‡½æ•°å†…é‡æ–°è®¡ç®—ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function countdown(seconds) {
  const startTime = Date.now()
  const endTime = startTime + seconds * 1000
  
  const timer = setInterval(() =&gt; {
    const now = Date.now()
    const timeLeft = endTime - now

    if (timeLeft &lt;= 0) {
      clearInterval(timer)
      renderCounter(0)
      return
    }

    renderCounter(timeLeft)
  }, 1000)
  
  renderCounter(endTime - startTime)
}
</code></pre>
<p>è¿™æ ·ï¼Œè‡³å°‘å¯ä»¥ç¡®ä¿ä¸‹ä¸€æ¬¡æ›´æ–°çš„æ—¶å€™ï¼Œå‰©ä½™çš„æ—¶é—´æ˜¯â€œå‡†ç¡®â€çš„ã€‚</p>
<p>å‡è®¾åœ¨ç›¸å¯¹ç†æƒ³çš„ç¯å¢ƒä¸­ï¼Œé¡µé¢ä¸Šåªå‰©ä¸‹è¿™ä¸ªå€’è®¡æ—¶äº†ï¼Œä¹Ÿæ²¡æœ‰é˜»å¡ä¸»çº¿ç¨‹çš„ï¼ˆåŒæ­¥ï¼‰ä»»åŠ¡ï¼Œå®ƒå‡ ä¹å¯ä»¥æ¯ç§’æ‰§è¡Œä¸€æ¬¡ renderCounterï¼Œæœ€èµ·ç äººçœ¼æ„ŸçŸ¥ä¸åˆ°å…¶ä¸­çš„è¯¯å·®ã€‚</p>
<p>ä½†ç°å®æ˜¯ï¼Œåœ¨ä¸åŒæµè§ˆä¸‹ï¼Œéšç€ setInterval ä¸åœåœ°æ‰§è¡Œï¼Œå…¶ Delay Time ä¼šäº§ç”Ÿåå·®ã€‚æ¯”å¦‚ Safari å’Œ Firefox å¯èƒ½ä¼šå¢åŠ å‡ æ¯«ç§’ï¼Œè€Œ Chrome ç”šè‡³ä¼šâ€œè‡ªåŠ¨ä¿®å¤â€è¿™ç§æ—¶é—´åå·®ï¼ˆè¿™åº”è¯¥æ˜¯å¼€å‘è€…æ‰€æœŸå¾…çš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ Delay Time ç”šè‡³ä¼šå‡å°‘ã€‚</p>
<p>æ‰€ä»¥ï¼Œé¡µé¢çœ‹åˆ°çš„æ•ˆæœæœ‰å¯èƒ½æ˜¯ï¼š</p>
<pre><code>0 days, 0 hours, 1 minutes, 30 seconds
â†“
0 days, 0 hours, 1 minutes, 28 seconds
â†“
...
</code></pre>
<p>åŸå› æ˜¯ï¼šå‡è®¾åˆšå¥½åœ¨å‰©ä½™ 1m 30s çš„æ—¶å€™ <code>renderCounter()</code>ï¼Œç”±äº Delay Time çš„åå·®ï¼ˆå‡è®¾å¤šäº† 10msï¼‰ï¼Œå¯¼è‡´ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶å¾—åˆ° 1m 28s &lt; timeLeft &lt; 1m 29s çš„ç»“æœï¼Œå¯¼è‡´é¡µé¢è·³è¿‡ 29s æ˜¾ç¤ºäº† 28sï¼ˆå‰é¢ä½¿ç”¨äº† <code>Math.floor()</code> æ¥æ¢ç®—ï¼‰çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å¦‚æœé¡µé¢æœ‰å…¶ä»–è€—æ—¶ä»»åŠ¡æˆ–è€…æŒ‚èµ·åå°æ—¶ï¼Œè¿™ç§åå·®åªä¼šæ›´æ˜æ˜¾ã€‚</p>
</blockquote>
<p>ç»¼ä¸Šï¼Œè¿™ä¸ªæ–¹æ¡ˆç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æŒ‚èµ·åå°æ—¶ï¼Œ<code>setInterval()</code> ä»åœ¨æ‰§è¡Œï¼Œå ç”¨ CPU èµ„æºã€‚</li>
<li>å¯èƒ½ä¼šå‡ºç°è·³ç§’çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå€’è®¡æ—¶ä¸æ˜¯ä¸€ç›´ <code>-1</code>ï¼Œå¶å°”ä¼š <code>-2</code>ã€‚</li>
<li><code>Date.now()</code> å—ç³»ç»Ÿæ—¶é’Ÿå½±å“ã€‚</li>
</ol>
<h2>æ”¹è¿›ç‰ˆæœ¬</h2>
<p>å½“é¡µé¢æŒ‚èµ·æ—¶ï¼Œå¦‚æœä¸æƒ³è®©å®šæ—¶å™¨ä¸€ç›´åœ¨åå°æ‰§è¡Œï¼Œå¯ä»¥å€ŸåŠ© <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/visibilitychange_event">visibilitychange</a> äº‹ä»¶æ¥å¤„ç†ã€‚</p>
<ul>
<li>é¡µé¢ä¸å¯è§æ—¶ï¼Œæ¸…é™¤å®šæ—¶å™¨</li>
<li>é¡µé¢å¯è§æ—¶ï¼Œåˆ›å»ºæ–°çš„å®šæ—¶å™¨ã€‚</li>
</ul>
<pre><code class="language-js">function countdown(seconds) {
  const startTime = Date.now()
  const endTime = startTime + seconds * 1000

  const paint = () =&gt; {
    const now = Date.now()
    const timeLeft = endTime - now

    if (timeLeft &lt;= 0) {
      clearInterval(timer)
      renderCounter(0)
      return
    }

    renderCounter(timeLeft)
  }

  let timer = setInterval(paint, 1000)
  
  handleVisibilityChange({
    hiddenFn: () =&gt; {
      clearInterval(timer)
    },
    visibleFn: () =&gt; {
      if (timer) clearInterval(timer)
      timer = setInterval(paint, 1000)
    },
  })
  
  renderCounter(endTime - startTime)
}

function handleVisibilityChange({ hiddenFn = () =&gt; {}, visibleFn = () =&gt; {} }) {
  document.addEventListener('visibilitychange', event =&gt; {
    if (document.visibilityState === 'hidden') {
      hiddenFn(event)
      return
    }
    visibleFn(event)
  })
}
</code></pre>
<p>è¯¥æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å¤„ç†åå°æ‰§è¡Œçš„æ–¹å¼è¿‡äºå¤æ‚ã€‚</li>
<li>æœªè§£å†³è·³ç§’é—®é¢˜ã€‚</li>
<li>æœªè§£å†³ <code>Date.now()</code> å—ç³»ç»Ÿæ—¶é’Ÿå½±å“çš„é—®é¢˜ã€‚</li>
</ol>
<h2>è¿›é˜¶ç‰ˆæœ¬</h2>
<p>å¯ä»¥è€ƒè™‘ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">requestAnimationFrame</a>ï¼Œå®ƒä¼šåœ¨é¡µé¢é‡ç»˜ä¹‹å‰æ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>å‡ºäºçœç”µå’Œæ€§èƒ½è€ƒè™‘ï¼Œå½“é¡µé¢æŒ‚èµ·æ—¶ï¼Œè¯¥ API ä¼šæš‚åœæ‰§è¡Œã€‚</p>
</blockquote>
<p>å®ƒæ‰§è¡Œé¢‘ç‡è·Ÿå±å¹•åˆ·æ–°ç‡æœ‰å…³ã€‚æ¯”å¦‚å±å¹•åˆ·æ–°ç‡ä¸º 60Hzï¼Œè¡¨ç¤ºæ¯ç§’åˆ·æ–° 60 æ¬¡ï¼Œå³æ¯ 16.67ms åˆ·æ–°ä¸€æ¬¡ä»¥ç¡®ä¿ç”»é¢ä¸å¡é¡¿ã€‚å…¶ä»–å¸¸è§çš„ 90Hzã€120Hzã€144Hz çš„åˆ·æ–°ç‡åŒç†ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">function countdown(seconds) {
  const startTime = Date.now()
  const endTime = startTime + seconds * 1000
  renderCounter(endTime - startTime)

  let rafId = requestAnimationFrame(function paint() {
    const now = Date.now()
    const timeLeft = endTime - now

    if (timeLeft &lt;= 0) {
      renderCounter(0)
      cancelAnimationFrame(rafId)
      return
    }

    renderCounter(timeLeft)
    rafId = requestAnimationFrame(paint)
  })
}
</code></pre>
<p>åœ¨åˆ·æ–°ç‡ä¸º 60Hz çš„æ˜¾ç¤ºå™¨ä¸‹ï¼Œæ¯ç§’æ‰§è¡Œ 60 æ¬¡ï¼Œå€’è®¡æ—¶æ˜¯è¶³å¤Ÿå‡†ç¡®äº†ã€‚ä½†æ‰§è¡Œå¤ªé¢‘ç¹äº†ï¼Œä¹Ÿä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜ä¸å¦‚ <code>setInterval(() =&gt; {}, 333)</code> å‘¢ã€‚</p>
<p>å¯ä»¥ç»“åˆ setTimeout è§£å†³é¢‘ç¹æ‰§è¡Œçš„é—®é¢˜ï¼Œç„¶åè¦è§£å†³çš„æ˜¯ï¼š<strong>å¦‚ä½•è·å–ä¸‹ä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ï¼Ÿ</strong></p>
<p>å¼•å…¥ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentTimeline">Document Timeline</a>ï¼Œæ­¤æ—¶é—´è½´å¯¹äºæ¯ä¸ªæ–‡æ¡£ï¼ˆdocumentï¼‰æ¥è¯´éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶åœ¨æ–‡æ¡£çš„ç”Ÿå‘½å‘¨æœŸä¸­æŒç»­å­˜åœ¨ã€‚å…¶æ—¶é—´åŸç‚¹ï¼ˆTime Originï¼‰å¯é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/timeOrigin"><code>performance.timeOrigin</code></a> è·å–ã€‚</p>
<p>è¦è·å–å½“å‰æ–‡æ¡£è‡ªåˆ›å»ºä»¥æ¥ï¼ˆå³ç›¸å¯¹äºæ—¶é—´åŸç‚¹ï¼‰æ‰€ç»è¿‡çš„æ—¶é—´ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AnimationTimeline/currentTime"><code>document.timeline.currentTime</code></a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now"><code>performance.now()</code></a></li>
</ul>
<p>å®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªç›¸å¯¹é«˜ç²¾åº¦çš„æ¯«ç§’æ•°ï¼Œä½†åˆæœ‰ç‚¹åŒºåˆ«ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šä»¥ 60Hz çš„å±å¹•ä¸ºä¾‹ï¼Œé¡µé¢æ¯ 16.67ms æ›´æ–°ä¸€æ¬¡ã€‚å‡è®¾ç¬¬ä¸‰æ¬¡æ›´æ–°å®Œï¼ˆå½“å‰æ—¶é—´è®°ä¸º 50msï¼‰ï¼Œæ¥ç€é©¬ä¸Šæ‰§è¡Œä¸‹ä¸€æ¬¡ Tickï¼Œè‹¥æ—¶é—´è¿‡äº† 5msï¼Œæ­¤æ—¶ <code>document.timeline.currentTime</code>ã€<code>performance.now()</code> åˆ†åˆ«ä¸º 50msã€55msã€‚ç­‰è¿™æ¬¡ Tick æ‰§è¡Œå®Œé‚£ä¸€åˆ»å®ƒä¿©çš„å€¼åˆå°†åŒæ­¥ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<code>document.timeline.currentTime</code> æ˜¯å½“å‰å¸§èµ·å§‹é‚£ä¸€åˆ»ç›¸å¯¹äºæ—¶é—´åŸç‚¹ç»è¿‡çš„æ¯«ç§’æ•°ã€‚è€Œ <code>performance.now()</code> æ˜¯â€œçœŸæ­£â€å½“å‰æ—¶é—´ç›¸å½“äºæ—¶é—´åŸç‚¹ç»è¿‡çš„æ¯«ç§’æ•°ã€‚æ‰€ä»¥ï¼Œå®é™…è¡¨ç°åè€…æ€»æ˜¯æ¯”å‰è€…å¤§ä¸€ç‚¹ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å°è¯•ä¿®æ”¹ä¸‹ï¼š</p>
<pre><code class="language-js">function countdown(seconds) {
  const startTime = document.timeline ? document.timeline.currentTime : performance.now()
  const endTime = startTime + seconds * 1000
  
  const paint = () =&gt; {
    const now = document.timeline ? document.timeline.currentTime : performance.now()
    const timeLeft = endTime - now

    if (timeLeft &lt;= 0) {
      renderCounter(0)
      return
    }

    const roundedTimeLeft = Math.round(timeLeft / 1000) * 1000
    renderCounter(roundedTimeLeft)

    const nextTime = startTime + (seconds * 1000 - roundedTimeLeft) + 1000
    const nextDelay = nextTime - performance.now()

    setTimeout(() =&gt; requestAnimationFrame(paint), nextDelay)
  }

  paint()
}
</code></pre>
<blockquote>
<p>è€ƒè™‘ <a href="https://caniuse.com/?search=document.timeline">Document API</a>ã€<a href="https://caniuse.com/?search=performance.now()">High Resolution Time API</a> å…¼å®¹æ€§ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹è¿™è¡Œå¤„ç†ï¼Œç›®çš„æ˜¯é¿å…è·³ç§’ç°è±¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å½“å‰ <code>timeLeft</code> ä¸º 2988msï¼Œç”±äº <code>renderCounter()</code> é‡Œç§’æ•°è½¬æ¢æ˜¯ä½¿ç”¨äº† <code>Math.floor()</code>ï¼Œå®ƒä¼šè¢«è½¬ä¸º 2sï¼Œä½†å®é™…ä¸Šå®ƒæ›´æ¥è¿‘ 3sï¼Œå› æ­¤åº”è¯¥ç”¨ <code>Math.round()</code> ä½œå–æ•´æ“ä½œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç§’æ•°å–æ•´ï¼Œè€Œä¸æ˜¯æ¯«ç§’æ•°å–æ•´ã€‚</p>
</blockquote>
<pre><code class="language-js">const roundedTimeLeft = Math.round(timeLeft / 1000) * 1000
</code></pre>
<p>åœ¨ <code>renderCounter()</code> ä¹‹å‰å¤„ç†ï¼Œä¹Ÿä¾¿äºå‡†ç¡®è®¡ç®—å‡ºä¸‹ä¸€ç§’çš„æ—¶é—´è½´æ—¶é—´ã€‚</p>
<pre><code class="language-js">const nextTime = startTime + (seconds * 1000 - roundedTimeLeft) + 1000
</code></pre>
<p>æœ€åï¼Œé€šè¿‡ä¸‹ä¸€ç§’çš„æ—¶é—´ç‚¹å‡å»å½“å‰æ—¶é—´ç‚¹ï¼Œå¾—å‡ºå»¶è¿Ÿæ—¶é—´ã€‚</p>
<pre><code class="language-js">const nextDelay = nextTime - performance.now()
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ—¶é—´æ›´å‡†ç¡®ï¼Œå¯ä»¥è§£å†³ç”¨æˆ·ä¿®æ”¹ç³»ç»Ÿæ—¶é’Ÿå¯¼è‡´è®¡æ—¶å¯èƒ½ä¸å‡†ç¡®çš„é—®é¢˜ã€‚
<ul>
<li>ä½¿ç”¨ Date ä¼šå—åˆ°æ—¶é’Ÿåå·®å’Œç³»ç»Ÿæ—¶é’Ÿè°ƒæ•´çš„å½±å“ã€‚</li>
<li>ä½¿ç”¨ <a href="https://www.w3.org/TR/hr-time-3/">High Resolution Time</a> ä¸å—ç³»ç»Ÿæ—¶é’Ÿå½±å“ã€‚</li>
</ul>
</li>
<li>å½“æµè§ˆå™¨æŒ‚èµ·æ—¶è‡ªåŠ¨æš‚åœï¼Œæ¢å¤å‰å°æ—¶ç»§ç»­ï¼Œä¸”å‡†ç¡®æ€§ä¸å—å½±å“ã€‚</li>
</ul>
<p>ç”±äºè¿™ç§æ–¹æ¡ˆè¿˜ç”¨åˆ°äº† <code>setTimeout()</code>ï¼Œè·³ç§’é—®é¢˜è¿˜å­˜åœ¨ã€‚å‡è®¾ä¸»çº¿ç¨‹å­˜åœ¨è€—æ—¶ä»»åŠ¡ï¼Œæ²¡åŠæ³•åŠæ—¶æ‰§è¡Œå…¶å›è°ƒå‡½æ•°ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°ç±»ä¼¼ 4s ç›´æ¥è·³åˆ° 6sã€7s çš„æƒ…å†µã€‚</p>
<p>æœ‰äº›æ–‡ç« ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API">Web Worker</a> æ¥å®ç°å€’è®¡æ—¶ï¼Œå› ä¸ºå®ƒæ˜¯ç‹¬ç«‹äºä¸»çº¿ç¨‹ï¼Œå¯ä»¥ä¸€ç›´åœ¨åå°çº¿ç¨‹è¿›è¡Œè®¡æ—¶ï¼Œè¿™æ ·è®¡æ—¶å€’æ˜¯å‡†ç¡®ã€‚å¦‚æœè®¡æ—¶è¦ä½“ç°åœ¨é¡µé¢ä¸Šï¼Œå¾—æ¯éš” 1s é€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–° UIï¼ˆWorker æ— æ³•ç›´æ¥æ“ä½œ DOMï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»çº¿ç¨‹è¢«è€—æ—¶ä»»åŠ¡å ç€ï¼Œå³ä¾¿ä¸»çº¿ç¨‹æ¥åˆ°é€šçŸ¥äº†ï¼Œä½†ä½ è¿˜æ˜¯è¦æ’é˜Ÿç­‰ä¸»çº¿ç¨‹ç©ºé—²ä¸‹æ¥ã€‚</p>
<p>å› æ­¤ï¼Œæ ¹æœ¬çš„è§£å†³åŠæ³•åº”è¯¥æ˜¯å°†è€—æ—¶ä»»åŠ¡æ”¾åœ¨ Worker æ‰§è¡Œï¼Œæˆ–è€…ä½¿ç”¨æ—¶é—´åˆ†ç‰‡ï¼ˆTime Slicingï¼‰æ–¹æ¡ˆå°†è€—æ—¶ä»»åŠ¡åˆ†æˆè‹¥å¹²å°ä»»åŠ¡ï¼Œä»¥è®©å‡ºç©ºéš™ç»™ä¸»çº¿ç¨‹æ›´æ–° UIï¼Œé¿å…é€ æˆé¡µé¢å‡æ­»ç°è±¡ã€‚</p>
<h2>å¾®ä¿¡å°ç¨‹åºç‰ˆæœ¬</h2>
<blockquote>
<p>å°ç¨‹åºæ¡†æ¶çš„é€»è¾‘å±‚å¹¶éè¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå› æ­¤ JavaScript åœ¨ web ä¸­ä¸€äº›èƒ½åŠ›éƒ½æ— æ³•ä½¿ç”¨ï¼Œå¦‚ windowï¼Œdocument ç­‰ã€‚</p>
</blockquote>
<p>åœ¨å°ç¨‹åºé‡Œï¼Œå®ƒä»¬éƒ½ä¸èƒ½ç”¨ï¼š</p>
<ul>
<li><code>document.timeline.currentTime</code></li>
<li><code>window.performance.now()</code></li>
<li><code>window.requestAnimationFrame()</code></li>
</ul>
<p>å°ç¨‹åºæœ‰ä¸ª <a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.getPerformance.html"><code>wx.getPerformance().now()</code></a> æ–¹æ³•ï¼ˆæ–‡æ¡£æœªæåˆ°ï¼‰ï¼Œå®ƒè¿”å›çš„æ˜¯è‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹å¼€å§‹ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œè°ƒè¯•å‘ç°å…¶å†…éƒ¨è¿”å›çš„å°±æ˜¯ <code>Date.now()</code>ï¼Œæ‰€ä»¥è¿™ç©æ„åœ¨è¿™é‡Œå‹æ ¹æ²¡ç”¨ã€‚ğŸ™„</p>
<ul>
<li><code>window.performance.now()</code> è¿”å›è‡ª <code>performance.timeOrigin</code> å¼€å§‹ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œä¸å—ç³»ç»Ÿæ—¶é’Ÿå½±å“ã€‚</li>
<li><code>wx.getPerformance().now()</code> è¿”å›è‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹å¼€å§‹ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œå—ç³»ç»Ÿæ—¶é’Ÿå½±å“ã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1721466409884.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/7/1722151057063.png" alt=""></p>
<p>æ—¢ç„¶å°ç¨‹åºé‡Œé¢è·å–ä¸åˆ°ä¸å—ç³»ç»Ÿæ—¶é’Ÿå½±å“çš„å½“å‰æ—¶é—´ï¼Œå”¯æœ‰ä½¿ç”¨ <code>Date.now()</code> äº†ï¼Œå¹¶åœ¨ <code>onShow()</code> æ—¶é‡æ–°æ ¡éªŒã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼ˆ<a href="https://developers.weixin.qq.com/s/CKP3e1mO7qTB">å°ç¨‹åºä»£ç ç‰‡æ®µ</a>ï¼‰ï¼š</p>
<pre><code class="language-js">import { getServerTime } from '../../utils/index'

// æˆªæ­¢æ—¶é—´ï¼š2024/07/28 23:59:59
const DEADLINE_TIME = new Date(2024, 6, 28, 23, 59, 59).getTime()

Page({
  data: {
    formattedCountdown: '',
  },

  async onShow() {
    // TIPS: å°ç¨‹åºéœ€é…ç½®è¯·æ±‚åŸŸåï¼Œè·å–æœåŠ¡å™¨æ—¶é—´æ ¹æ®å®é™…è°ƒæ•´ï¼Œæ¯”å¦‚å‘èµ· HEAD è¯·æ±‚è·å– header.date ç­‰æ–¹å¼ã€‚
    const now = await getServerTime()
    const secondsLeft = Math.floor((DEADLINE_TIME - now) / 1000)
    
    this.countdown(secondsLeft)
  },

  onUnload() {
    clearTimeout(this._countdown_timer)
  },

  countdown(seconds) {
    const startTime = Date.now()
    const endTime = startTime + seconds * 1000

    // é¿å… onShow åæœ‰å¤šä¸ªå®šæ—¶å™¨åœ¨è·‘
    clearTimeout(this._countdown_timer)

    const paint = () =&gt; {
      const now = Date.now()
      const timeLeft = endTime - now

      if (timeLeft &lt;= 0) {
        this.renderCounter(0)
        return
      }

      const roundedTimeLeft = Math.round(timeLeft / 1000) * 1000
      this.renderCounter(roundedTimeLeft)

      const nextTime = startTime + (seconds * 1000 - roundedTimeLeft) + 1000
      const nextDelay = nextTime - Date.now()

      this._countdown_timer = setTimeout(() =&gt; paint(), nextDelay)
    }

    paint()
  },

  renderCounter(timeLeft) {
    const secondInMillisecond = 1000
    const minuteInMillisecond = secondInMillisecond * 60
    const hourInMillisecond = minuteInMillisecond * 60
    const dayInMillisecond = hourInMillisecond * 24

    const dayLeft = Math.floor(timeLeft / dayInMillisecond)
    const hourLeft = Math.floor((timeLeft % dayInMillisecond) / hourInMillisecond)
    const minuteLeft = Math.floor((timeLeft % hourInMillisecond) / minuteInMillisecond)
    const secondLeft = Math.floor((timeLeft % minuteInMillisecond) / secondInMillisecond)

    const formattedStr = `${dayLeft} days, ${hourLeft} hours, ${minuteLeft} minutes, ${secondLeft} seconds`

    this.setData({ formattedCountdown: formattedStr })
  },
})
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers">WHATWG Standards - Timers</a></li>
<li><a href="https://www.smashingmagazine.com/2022/06/precise-timing-web-animations-api/">Precise Timing With Web Animations API</a></li>
<li><a href="https://stackoverflow.com/questions/29971898/how-to-create-an-accurate-timer-in-javascript">How to create an accurate timer in javascript?</a></li>
<li><a href="https://stackoverflow.com/questions/196027/is-there-a-more-accurate-way-to-create-a-javascript-timer-than-settimeout">Is there a more accurate way to create a Javascript timer than setTimeout?</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Node.js ç¯å¢ƒå˜é‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/338</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/338</guid>
            <pubDate>Wed, 01 May 2024 18:00:16 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/5/1716627489043.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>åœ¨ Node.js ä¸­é€šå¸¸ä¼šä½¿ç”¨ <code>proc]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/5/1716627489043.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>åœ¨ Node.js ä¸­é€šå¸¸ä¼šä½¿ç”¨ <code>process.env</code> æ¥è·å–ç¯å¢ƒå˜é‡ã€‚</p>
<blockquote>
<p><a href="https://nodejs.org/docs/v20.12.1/api/process.html#processenv">process.env</a></p>
</blockquote>
<p>å®ƒè¿”å›ä¸€ä¸ªåŒ…å«ç”¨æˆ·ç¯å¢ƒçš„å¯¹è±¡ã€‚è¿™é‡Œçš„ç”¨æˆ·ç¯å¢ƒæ˜¯ Shell è¿›ç¨‹ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†å½“å‰è¿›ç¨‹çš„å˜é‡ã€‚æ³¨æ„ï¼Œ<code>process.env</code> å¯¹è±¡å¯ä»¥è¢«ä¿®æ”¹ï¼Œä½†å…¶ä¿®æ”¹ä¸ä¼šå½±å“åˆ°æ­¤è¿›ç¨‹ä¹‹å¤–ã€‚</p>
<h2>Shell å˜é‡</h2>
<p>åˆ†ç±»ï¼š</p>
<ul>
<li>ç¯å¢ƒå˜é‡ï¼šé€šå¸¸æ˜¯æŒ‡ Shell å†…ç½®å˜é‡æˆ–è€… Shell é…ç½®æ–‡ä»¶ä¸­å£°æ˜çš„å˜é‡ã€‚</li>
<li>è‡ªå®šä¹‰å˜é‡ï¼šé€šå¸¸æ˜¯åœ¨ Shell è„šæœ¬æˆ–å‘½ä»¤è¡Œä¸­å£°æ˜çš„å˜é‡ã€‚</li>
</ul>
<p>ä½œç”¨åŸŸï¼š</p>
<ul>
<li>ç¯å¢ƒå˜é‡ï¼šåˆ›å»º Shell è¿›ç¨‹æ—¶ä¼šè‡ªåŠ¨åŠ è½½ï¼Œè¿™äº›å˜é‡å¯ä»¥è¢«å½“å‰è¿›ç¨‹ä»¥åŠå­è¿›ç¨‹è®¿é—®ã€‚</li>
<li>è‡ªå®šä¹‰å˜é‡ï¼š
<ul>
<li>å‡½æ•°ä½“å†…ï¼šåœ¨å‡½æ•°ä½“å†…ä½¿ç”¨ <code>local</code> æ˜¾å¼å£°æ˜çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸä»…åœ¨å‡½æ•°å†…ã€‚</li>
<li>å½“å‰è¿›ç¨‹ï¼šå½“å‰ Shell è¿›ç¨‹å†…å¯è®¿é—®ï¼Œä½†å­è¿›ç¨‹ä¸èƒ½è®¿é—®ã€‚é»˜è®¤ä½œç”¨åŸŸã€‚</li>
<li>å½“å‰è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ï¼šä½¿ç”¨ <code>export</code> æ˜¾å¼å£°æ˜çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸæ˜¯å½“å‰è¿›ç¨‹åŠå­è¿›ç¨‹ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>Shell ç¯å¢ƒæ˜¯å¤©ç„¶éš”ç¦»çš„ï¼Œåœ¨å½“å‰è¿›ç¨‹å†…è®¾ç½®æˆ–ä¿®æ”¹å˜é‡ï¼Œéƒ½ä¸ä¼šå½±å“åˆ°å…¶ä»–éå…³è”è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚</p>
</blockquote>
<pre><code class="language-shell">function fn() {
  foo=1         # ä½œç”¨åŸŸä¸ºå½“å‰è¿›ç¨‹
  local bar=2   # ä½œç”¨åŸŸä¸ºå½“å‰å‡½æ•°
  export baz=3  # ä½œç”¨åŸŸä¸ºå½“å‰è¿›ç¨‹åŠå­è¿›ç¨‹
}

fn

echo $foo    # 1
echo $bar    # ç©ºå­—ç¬¦ä¸²
echo $baz    # 3
</code></pre>
<blockquote>
<p>åœ¨ Shell ä¸­ï¼Œå¦‚æœå¼•ç”¨çš„å˜é‡ä¸å­˜åœ¨ï¼Œå®ƒä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è¾“å‡ºç©ºå­—ç¬¦ã€‚</p>
</blockquote>
<h2>NPM ç¯å¢ƒå˜é‡</h2>
<p>å‡è®¾æœ‰ä»¥ä¸‹åŒ…ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;node -e 'console.log(process.env)'&quot;
  }
}
</code></pre>
<p>æ‰§è¡Œ <code>npm run start</code> æ—¶ï¼Œä¼šå¾—åˆ°è¿™äº›å˜é‡ï¼š</p>
<pre><code class="language-js">{
  // Shell å†…ç½®å˜é‡
  SHELL: '/bin/zsh',
  USER: 'frankie',
  HOME: '/Users/frankie',
  // ...
  
  // zsh è‡ªå®šä¹‰ç¯å¢ƒå˜é‡
  NVM_DIR: '/Users/frankie/.nvm',
  // ...
  
  // npm config ç›¸å…³å˜é‡
  npm_config_sass_binary_site: 'https://npmmirror.com/mirrors/node-sass',
  npm_config_prefix: '/Users/frankie/.nvm/versions/node/v18.16.0',
  // ...
  
  // npm package ç›¸å…³å˜é‡
  npm_package_json: '/Users/frankie/Web/Git/html-demo/src/demo/node-env/package.json',
  npm_package_name: 'node-env',
  npm_package_version: '1.0.0',
  // ...
}
</code></pre>
<blockquote>
<p><code>process.env</code> çš„å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚å¦‚æœèµ‹å€¼æ—¶ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè¢«éšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ç±»ä¸ npm ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨æ‰§è¡Œ <code>npm run</code> å‘½ä»¤æ—¶è‡ªåŠ¨è½½å…¥ã€‚</p>
<ul>
<li><code>npm_config_</code></li>
<li><code>npm_package_</code></li>
</ul>
<p>å…¶ä¸­ <code>npm_config_</code> å¼€å¤´çš„ç¯å¢ƒå˜é‡æºè‡ª <code>.npmrc</code> é…ç½®æ–‡ä»¶ï¼Œä¼˜å…ˆçº§ä»ä¸Šåˆ°ä¸‹ï¼š</p>
<ul>
<li>é¡¹ç›®çº§åˆ« <code>.npmrc</code></li>
<li>ç”¨æˆ·çº§åˆ« <code>$HOME/.npmrc</code></li>
<li>å…¨å±€çº§åˆ« <code>$PREFIX/etc/npmrc</code>ï¼ˆå…¶ä¸­ <code>$PREFIX</code> ä¸º <code>npm config get prefix</code> çš„è·¯å¾„ï¼‰</li>
<li>npm å†…ç½®é…ç½®æ–‡ä»¶ <code>/path/to/npm/npmrc</code></li>
</ul>
<blockquote>
<p>å…¶ä¸­ key å¤§å°å†™ä¸æ•æ„Ÿï¼Œå®ƒä»¬éƒ½ä¼šè¢«è½¬æ¢ä¸ºå°å†™å½¢å¼ï¼Œ<code>-</code> ä¹Ÿä¼šè¢«è½¬ä¸º <code>_</code>ã€‚</p>
</blockquote>
<p>å…¶ä¸­ <code>npm_package_</code> åˆ™æºè‡ª <code>package.json</code>ã€‚æ¯”å¦‚ä½¿ç”¨ <code>process.env.npm_package_version</code> è·å–åŒ…ç‰ˆæœ¬å·ã€‚</p>
<h2>NPM Script è‡ªå®šä¹‰ç¯å¢ƒå˜é‡</h2>
<p>ä»¥ä¸Šæ˜¯ <code>npm run</code> å†…éƒ¨æ‰§è¡Œé€»è¾‘å¸¦å…¥çš„ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;NODE_ENV=development node -e 'console.log(process.env.NODE_ENV)'&quot;
  }
}
</code></pre>
<p>è¿™æ ·å°±èƒ½åœ¨ Node è„šæœ¬é‡Œè·å–åˆ°è¿™ä¸ª <code>NODE_ENV</code> å˜é‡å€¼äº†ã€‚</p>
<blockquote>
<p>åœ¨å‘½ä»¤å‰åŠ ä¸Šå˜é‡å£°æ˜ï¼Œå®ƒä¼šä¼ é€’ç»™å­è¿›ç¨‹ã€‚ç±»ä¼¼ <code>export</code> çš„æ•ˆæœï¼Œä½†ä¸å®Œå…¨ç›¸åŒï¼Œè¿™ç§æ–¹å¼ä¸ä¼šå½±å“å½“å‰è¿›ç¨‹çš„åŒåå˜é‡ã€‚<a href="https://www.gnu.org/software/bash/manual/bash.html#Simple-Command-Expansion">Simple Command Expansion</a></p>
</blockquote>
<p>ä½†å®ƒä»…æ”¯æŒ Unix-like æ“ä½œç³»ç»Ÿï¼Œåˆ° Windows å°±ä¸è¡Œäº†ã€‚åè€…éœ€è¦ä½¿ç”¨ <code>set</code> å‘½ä»¤ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;set NODE_ENV=development node -e 'console.log(process.env.NODE_ENV)'&quot;
  }
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼ŒWindows æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
</blockquote>
<p>åæ¥ï¼Œå‡ºç°äº†ä¸€äº›è·¨å¹³å°æ–¹æ¡ˆï¼Œæ¯”å¦‚ <a href="https://github.com/kentcdodds/cross-env">cross-env</a>ã€‚ç”¨æ³•å˜æˆäº†è¿™æ ·ï¼š</p>
<pre><code class="language-shell">$ npm i cross-env -D
</code></pre>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;cross-env NODE_ENV=development node -e 'console.log(process.env.NODE_ENV)'&quot;
  }
}
</code></pre>
<blockquote>
<p><a href="https://github.com/kentcdodds/cross-env/issues/257">cross-env is &quot;finished&quot; (now in maintenance mode)</a></p>
</blockquote>
<p>å¦‚æœé¡¹ç›®çš„ç¯å¢ƒå˜é‡å¾ˆå¤šï¼Œscript å°±ä¼šå¾ˆé•¿å¾ˆé•¿ï¼Œä¸å¥½çœ‹ä¹Ÿä¸å¥½ç»´æŠ¤ï¼Œåæ¥åˆä½¿ç”¨ <a href="https://www.dotenv.org/">dotenv</a> æ–¹æ¡ˆã€‚</p>
<p>æ¯”å¦‚ï¼Œé¡¹ç›®æ ¹ç›®å½•æœ‰ <code>.env</code>ã€<code>.env.development</code> æ–‡ä»¶ï¼š</p>
<blockquote>
<p>ç”±äº <code>.env</code> æ–‡ä»¶å¯èƒ½ä¼šåŒ…å«åƒå¯†é’¥è¿™ç±»æ•æ„Ÿä¿¡æ¯ï¼Œå®ƒä¸åœ¨ç‰ˆæœ¬æ§åˆ¶èŒƒå›´å†…ï¼Œåº”è¯¥æ·»åŠ åˆ° <code>.gitignore</code> é‡Œã€‚å¦‚æœæ˜¯å¤šäººåä½œçš„é¡¹ç›®ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ ç±»ä¼¼ <code>.env.example</code> æ¨¡æ¿åˆ°ä»“åº“é‡Œï¼Œä»¥ä¾¿å…¶ä»–æˆå‘˜æ¸…æ¥šäº†è§£ç”¨åˆ°å“ªäº›ç¯å¢ƒå˜é‡ã€‚</p>
</blockquote>
<pre><code class="language-ini"># .env
API_URL=https://example.com/api/
</code></pre>
<pre><code class="language-ini"># .env.development
API_URL=https://dev.example.com/api/
</code></pre>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;cross-env NODE_ENV=development node -e 'console.log(process.env.API_URL)'&quot;,
    &quot;build&quot;: &quot;cross-env NODE_ENV=production node -e 'console.log(process.env.API_URL)'&quot;
  }
}
</code></pre>
<p>è¿™æ ·æœ¬åœ°å¼€å‘å’Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå°±èƒ½æ ¹æ® <code>NODE_ENV</code> çš„å€¼ä»å¯¹åº”çš„ <code>.env</code> æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚</p>
<p>å½“ç„¶ï¼Œä»¥ä¸Šç¯å¢ƒå˜é‡ä»…å¯åœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆã€‚è¦åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨ï¼Œè¿˜å¾—å€ŸåŠ©ç±»ä¼¼ <code>webpack.DefinePlugin</code>ã€<code>webpack.EnvironmentPlugin</code> ç­‰æ’ä»¶å¤„ç†ï¼Œå®ƒä»¬å°†ä¼šåœ¨ç¼–è¯‘æ—¶è¢«æ›¿æ¢ä¸ºç›¸åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-shell">$ npm i dotenv
</code></pre>
<pre><code class="language-js">const webpack = require('webpack')
require('dotenv').config()

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.API_URL': JSON.stringify(process.env.API_URL),
    }),
  ],
}
</code></pre>
<blockquote>
<p>å¦‚æœå·²æœ‰åŒåç¯å¢ƒå˜é‡ï¼Œdotenv è§£ææ—¶å°†ä¼šå¿½ç•¥å®ƒã€‚æ¯”å¦‚å¼€å‘ç¯å¢ƒä¸­å…ˆååŠ è½½ <code>.env.development</code>ã€<code>.env</code>ï¼Œå…¶ä¸­è§£æå‰è€…æ—¶å·²è®¾ç½® <code>API_URL</code> å˜é‡ï¼Œå½“è§£æåˆ°åè€…æ—¶å°±ä¼šå¿½ç•¥ <code>API_URL</code>ã€‚</p>
</blockquote>
<blockquote>
<p>ä»¥ä¸Šä»…ä¸ºç¤ºä¾‹ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ webpack çš„è¯ï¼Œå¯ä»¥ç”¨ <a href="https://github.com/mrsteele/dotenv-webpack">dotenv-webpack</a>ã€‚</p>
</blockquote>
<blockquote>
<p>Node.js 20.6.0 åŸç”Ÿæ”¯æŒ <code>.env</code> æ–‡ä»¶ï¼Œå¤„äºå®éªŒæ€§é˜¶æ®µï¼Œå½“å‰è¿˜æœ‰å¾ˆå¤šåŠŸèƒ½ä¸Šçš„ç¼ºå¤±ï¼Œä¸èƒ½å®Œå…¨æ›¿ä»£ dotenvã€‚æ›´å¤šè¯·çœ‹ <a href="https://www.dotenv.org/blog/2023/10/28/node-20-6-0-includes-built-in-support-for-env-files.html">Node.js 20.6.0 includes built-in support for .env files</a></p>
</blockquote>
<p>æ³¨æ„ï¼Œå¾ˆå¤šæ„å»ºå·¥å…·åªæœ‰ã€Œç‰¹å®šå‰ç¼€å¼€å¤´ã€ä»¥åŠåƒ <code>NODE_ENV</code> è¿™ç§å¾ˆé€šç”¨çš„ç¯å¢ƒå˜é‡æ‰èƒ½åœ¨è¿è¡Œæ—¶ï¼ˆå³ä¸šåŠ¡ä»£ç ï¼‰å¯ç”¨ã€‚</p>
<ul>
<li>viteï¼š<code>VITE_</code></li>
<li>vue-cliï¼š<code>VUE_APP_</code></li>
<li>create-react-appï¼š<code>REACT_APP_</code></li>
<li>Taroï¼š<code>TARO_APP_</code></li>
<li>...</li>
</ul>
<blockquote>
<p>ä»»ä½•ä¸èƒ½å¯¹å¤–å…¬å¼€çš„ä¿¡æ¯ï¼Œéƒ½ä¸è¦åµŒå…¥æ„å»ºå½“ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½å¯ä»¥åœ¨æ„å»ºäº§ç‰©ä¸­æŸ¥åˆ°ã€‚</p>
</blockquote>
<h2>å…¶ä»–</h2>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›æ–¹å¼å¯ä»¥æä¾›ã€‚</p>
<h3>webpack</h3>
<p>å¯ä»¥é€šè¿‡ webpack-cli çš„ <code>--env</code> å‚æ•°ä¼ é€’ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ npm i webpack webpack-cli -D
</code></pre>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;node-env&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;webpack -w --env test&quot;,
    &quot;build&quot;: &quot;webpack --env prod&quot;,
    &quot;build:pre&quot;: &quot;webpack --env pre&quot;,
  }
}
</code></pre>
<p>æ‰§è¡Œ <code>npm run build:pre</code> æ—¶ï¼Œå¯ä»¥è¿™æ ·è·å–åˆ°å€¼ï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = function (env, argv) {
  console.log(env.pre) // true
  // å¯ä»¥ç»“åˆ webpack.DefinePlugin ä½¿ç”¨
  // ...
}
</code></pre>
<blockquote>
<p>è‹¥ä½¿ç”¨ <code>--env</code>ï¼Œwebpack é…ç½®éœ€å¯¼å‡ºä¸ºå‡½æ•°ã€‚</p>
</blockquote>
<blockquote>
<p>æ›´å¤šè¯·çœ‹ <a href="https://webpack.js.org/api/cli/#environment-options">Environment Options</a>ã€‚</p>
</blockquote>
<p>è¿˜æƒ³å¤šè¯´ä¸€ä¸‹ã€‚</p>
<p>ä»¥ webpack ä¸ºä¾‹ï¼Œå…¶æ¨¡å¼æœ‰ <code>development</code>ã€<code>production</code> å’Œ <code>none</code> ä¸‰ç§ã€‚å½“ã€Œæ˜¾å¼ã€å£°æ˜ <code>mode</code> ä¸ºå‰ä¸¤è€…æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è®¾ç½® <code>process.env.NODE_ENV</code> ä¸ºå¯¹åº”å€¼ï¼ˆ<a href="https://webpack.docschina.org/configuration/mode/">æ›´å¤š</a>ï¼‰ã€‚ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œ<code>process.env.NODE_ENV</code> é€šå¸¸ç”¨æ¥åŒºåˆ†å¼€å‘æ¨¡å¼ã€æ‰“åŒ…æ¨¡å¼ã€‚æ¯”å¦‚ï¼Œå¼€å‘æ¨¡å¼ä¸‹å¯ç”¨ sourcemapã€HMR ç­‰ä»¥ä¾¿äºå¼€å‘è°ƒè¯•ã€‚æ‰“åŒ…æ¨¡å¼ä¸‹å¯ç”¨ minimizerã€splitChunks ç­‰ä»¥å‡å°‘äº§ç‰©ä½“ç§¯ã€‚</p>
<p>ä½†å¥½åƒæœ‰äº›åŒå­¦ä¼šå°† <code>process.env.NODE_ENV</code> ç”¨äºåŒºåˆ†ã€Œé¡¹ç›®ã€çš„æµ‹è¯•ã€ç”Ÿæˆç¯å¢ƒï¼Œå…¶å®â€œä¸å¯¹â€çš„ã€‚å‡è®¾é¡¹ç›®æœ‰æµ‹è¯•ç¯å¢ƒã€é¢„ç”Ÿäº§ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå‘¢ï¼Œé‚£å®ƒå°±ä¸å¤Ÿç”¨äº†ã€‚è€Œä¸”ï¼Œå³ä½¿æ˜¯éƒ¨ç½²åˆ°éæ­£å¼ç¯å¢ƒï¼Œåœ¨æ‰“åŒ…æ—¶ä¹Ÿåº”è¯¥ä½¿ç”¨ <code>production</code> æ¨¡å¼ã€‚</p>
<p>å¯ä»¥åƒä¸Šé¢é‚£æ ·ä¸åŒé¡¹ç›®ç¯å¢ƒä¼ å…¥ä¸åŒçš„ <code>--env</code> å‚æ•°ï¼Œç„¶åç»“åˆ <code>webpack.DefinePlugin</code> æ¥å®šä¹‰ç‰¹å®šå˜é‡ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const webpack = require('webpack')

module.exports = function (env, argv) {
  return {
    // ...
    plugins: [
      new webpack.DefinePlugin({
        'process.env.TEST': env.test,
        'process.env.PRE': env.pre,
        'process.env.PROD': env.prod,
      }),
    ],
  }
}
</code></pre>
<pre><code class="language-js">// ä¸šåŠ¡
export const IS_TEST = process.env.TEST
export const IS_PRE = process.env.PRE
export const IS_PROD = process.env.PROD

export const API_URL = IS_TEST
  ? 'http://test.example.com/api/'
  : IS_PRE
  ? 'http://pre.example.com/api/'
  : 'http://example.com/api/'
</code></pre>
<blockquote>
<p>è¯´é‚£ä¹ˆå¤šï¼Œæ˜¯ä¸ºäº†ä¸è¦æ··æ·† <code>--env</code>ã€<code>--mode</code> ä¸ <code>process.env.NODE_ENV</code> çš„å…³ç³»ã€‚<code>process.env.NODE_ENV</code> åœ¨å„å¤§æ„å»ºå·¥å…·é¢‘ç¹å‡ºç°ï¼Œç®—æ˜¯ä¸€ä¸ªçº¦å®šä¿—æˆçš„å˜é‡äº†ï¼Œå®ƒä¸é¡¹ç›®ç¯å¢ƒæ˜¯ä¸åŒçš„æ¦‚å¿µã€‚</p>
</blockquote>
<!--

TODO:

- npm script ä¸­æ·»åŠ  -- --foo=bar å˜é‡çš„ä½œç”¨ï¼Ÿ
- node 22 åŸç”Ÿæ”¯æŒ dotenv?


## References

- [Using dotenv .env config file correctly](https://github.com/facebook/create-react-app/issues/865#issuecomment-252199527)
-->
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸é€æ˜åº¦ä¸åå…­è¿›åˆ¶å€¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/337</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/337</guid>
            <pubDate>Wed, 01 May 2024 05:22:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/5/1714544212377.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è½¬æ¢æ–¹æ³•ï¼š</p>
<pre><code class="language-js]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/5/1714544212377.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è½¬æ¢æ–¹æ³•ï¼š</p>
<pre><code class="language-js">function opacity2hex(opacity) {
  const hexValue = Math.round((opacity / 100) * 255)
  const hexString = hexValue.toString(16).padStart(2, '0')
  return hexString
}

</code></pre>
<pre><code class="language-js">function hex2opacity(hex) {
  const decimalValue = parseInt(hex, 16)
  const opacity = Math.round((decimalValue / 255) * 100)
  return opacity
}
</code></pre>
<p><strong>0% ~ 100%</strong></p>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>0%</td>
<td>00</td>
</tr>
<tr>
<td>10%</td>
<td>1A</td>
</tr>
<tr>
<td>20%</td>
<td>33</td>
</tr>
<tr>
<td>30%</td>
<td>4D</td>
</tr>
<tr>
<td>40%</td>
<td>66</td>
</tr>
<tr>
<td>50%</td>
<td>80</td>
</tr>
<tr>
<td>60%</td>
<td>99</td>
</tr>
<tr>
<td>70%</td>
<td>B3</td>
</tr>
<tr>
<td>80%</td>
<td>CC</td>
</tr>
<tr>
<td>90%</td>
<td>E6</td>
</tr>
<tr>
<td>100%</td>
<td>FF</td>
</tr>
</tbody>
</table>
<p><strong>0% ~ 10%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>0%</td>
<td>00</td>
</tr>
<tr>
<td>1%</td>
<td>03</td>
</tr>
<tr>
<td>2%</td>
<td>05</td>
</tr>
<tr>
<td>3%</td>
<td>08</td>
</tr>
<tr>
<td>4%</td>
<td>0A</td>
</tr>
<tr>
<td>5%</td>
<td>0D</td>
</tr>
<tr>
<td>6%</td>
<td>0F</td>
</tr>
<tr>
<td>7%</td>
<td>12</td>
</tr>
<tr>
<td>8%</td>
<td>14</td>
</tr>
<tr>
<td>9%</td>
<td>17</td>
</tr>
<tr>
<td>10%</td>
<td>1A</td>
</tr>
</tbody>
</table>
</details>
<p><strong>11% ~ 20%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>11%</td>
<td>1C</td>
</tr>
<tr>
<td>12%</td>
<td>1F</td>
</tr>
<tr>
<td>13%</td>
<td>21</td>
</tr>
<tr>
<td>14%</td>
<td>24</td>
</tr>
<tr>
<td>15%</td>
<td>26</td>
</tr>
<tr>
<td>16%</td>
<td>29</td>
</tr>
<tr>
<td>17%</td>
<td>2B</td>
</tr>
<tr>
<td>18%</td>
<td>2E</td>
</tr>
<tr>
<td>19%</td>
<td>30</td>
</tr>
<tr>
<td>20%</td>
<td>33</td>
</tr>
</tbody>
</table>
</details>
<p><strong>21% ~ 30%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>21%</td>
<td>36</td>
</tr>
<tr>
<td>22%</td>
<td>38</td>
</tr>
<tr>
<td>23%</td>
<td>3B</td>
</tr>
<tr>
<td>24%</td>
<td>3D</td>
</tr>
<tr>
<td>25%</td>
<td>40</td>
</tr>
<tr>
<td>26%</td>
<td>42</td>
</tr>
<tr>
<td>27%</td>
<td>45</td>
</tr>
<tr>
<td>28%</td>
<td>47</td>
</tr>
<tr>
<td>29%</td>
<td>4A</td>
</tr>
<tr>
<td>30%</td>
<td>4D</td>
</tr>
</tbody>
</table>
</details>
<p><strong>31% ~ 40%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>31%</td>
<td>4F</td>
</tr>
<tr>
<td>32%</td>
<td>52</td>
</tr>
<tr>
<td>33%</td>
<td>54</td>
</tr>
<tr>
<td>34%</td>
<td>57</td>
</tr>
<tr>
<td>35%</td>
<td>59</td>
</tr>
<tr>
<td>36%</td>
<td>5C</td>
</tr>
<tr>
<td>37%</td>
<td>5E</td>
</tr>
<tr>
<td>38%</td>
<td>61</td>
</tr>
<tr>
<td>39%</td>
<td>63</td>
</tr>
<tr>
<td>40%</td>
<td>66</td>
</tr>
</tbody>
</table>
</details>
<p><strong>41% ~ 50%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>41%</td>
<td>69</td>
</tr>
<tr>
<td>42%</td>
<td>6B</td>
</tr>
<tr>
<td>43%</td>
<td>6E</td>
</tr>
<tr>
<td>44%</td>
<td>70</td>
</tr>
<tr>
<td>45%</td>
<td>73</td>
</tr>
<tr>
<td>46%</td>
<td>75</td>
</tr>
<tr>
<td>47%</td>
<td>78</td>
</tr>
<tr>
<td>48%</td>
<td>7A</td>
</tr>
<tr>
<td>49%</td>
<td>7D</td>
</tr>
<tr>
<td>50%</td>
<td>80</td>
</tr>
</tbody>
</table>
</details>
<p><strong>51% ~ 60%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>51%</td>
<td>82</td>
</tr>
<tr>
<td>52%</td>
<td>85</td>
</tr>
<tr>
<td>53%</td>
<td>87</td>
</tr>
<tr>
<td>54%</td>
<td>8A</td>
</tr>
<tr>
<td>55%</td>
<td>8C</td>
</tr>
<tr>
<td>56%</td>
<td>8F</td>
</tr>
<tr>
<td>57%</td>
<td>91</td>
</tr>
<tr>
<td>58%</td>
<td>94</td>
</tr>
<tr>
<td>59%</td>
<td>96</td>
</tr>
<tr>
<td>60%</td>
<td>99</td>
</tr>
</tbody>
</table>
</details>
<p><strong>61% ~ 70%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>61%</td>
<td>9C</td>
</tr>
<tr>
<td>62%</td>
<td>9E</td>
</tr>
<tr>
<td>63%</td>
<td>A1</td>
</tr>
<tr>
<td>64%</td>
<td>A3</td>
</tr>
<tr>
<td>65%</td>
<td>A6</td>
</tr>
<tr>
<td>66%</td>
<td>A8</td>
</tr>
<tr>
<td>67%</td>
<td>AB</td>
</tr>
<tr>
<td>68%</td>
<td>AD</td>
</tr>
<tr>
<td>69%</td>
<td>B0</td>
</tr>
<tr>
<td>70%</td>
<td>B3</td>
</tr>
</tbody>
</table>
</details>
<p><strong>71% ~ 80%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>71%</td>
<td>B5</td>
</tr>
<tr>
<td>72%</td>
<td>B8</td>
</tr>
<tr>
<td>73%</td>
<td>BA</td>
</tr>
<tr>
<td>74%</td>
<td>BD</td>
</tr>
<tr>
<td>75%</td>
<td>BF</td>
</tr>
<tr>
<td>76%</td>
<td>C2</td>
</tr>
<tr>
<td>77%</td>
<td>C4</td>
</tr>
<tr>
<td>78%</td>
<td>C7</td>
</tr>
<tr>
<td>79%</td>
<td>C9</td>
</tr>
<tr>
<td>80%</td>
<td>CC</td>
</tr>
</tbody>
</table>
</details>
<p><strong>81% ~ 90%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>81%</td>
<td>CF</td>
</tr>
<tr>
<td>82%</td>
<td>D1</td>
</tr>
<tr>
<td>83%</td>
<td>D4</td>
</tr>
<tr>
<td>84%</td>
<td>D6</td>
</tr>
<tr>
<td>85%</td>
<td>D9</td>
</tr>
<tr>
<td>86%</td>
<td>DB</td>
</tr>
<tr>
<td>87%</td>
<td>DE</td>
</tr>
<tr>
<td>88%</td>
<td>E0</td>
</tr>
<tr>
<td>89%</td>
<td>E3</td>
</tr>
<tr>
<td>90%</td>
<td>E6</td>
</tr>
</tbody>
</table>
</details>
<p><strong>91% ~ 100%</strong></p>
<details>
<summary>å±•å¼€</summary>
<table>
<thead>
<tr>
<th>ç™¾åˆ†æ¯”ï¼ˆä¸é€æ˜åº¦ï¼‰</th>
<th>åå…­è¿›åˆ¶å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>91%</td>
<td>E8</td>
</tr>
<tr>
<td>92%</td>
<td>EB</td>
</tr>
<tr>
<td>93%</td>
<td>ED</td>
</tr>
<tr>
<td>94%</td>
<td>F0</td>
</tr>
<tr>
<td>95%</td>
<td>F2</td>
</tr>
<tr>
<td>96%</td>
<td>F5</td>
</tr>
<tr>
<td>97%</td>
<td>F7</td>
</tr>
<tr>
<td>98%</td>
<td>FA</td>
</tr>
<tr>
<td>99%</td>
<td>FC</td>
</tr>
<tr>
<td>100%</td>
<td>FF</td>
</tr>
</tbody>
</table>
</details>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸‹èµ›å­£è§]]></title>
            <link>https://github.com/toFrankie/blog/issues/336</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/336</guid>
            <pubDate>Sat, 20 Apr 2024 07:22:21 GMT</pubDate>
            <description><![CDATA[<p>åŒ—äº¬æ—¶é—´ 4 æœˆ 18 æ—¥ 2023-2024 èµ›å­£æ¬§å†  1/4 å†³èµ›æ¬¡å›åˆï¼Œæ›¼åŸåé•‡ä¼Šè’‚å“ˆå¾·ä¸»åœºè¿æˆ˜çš‡é©¬ã€‚</p>
<p>æœ¬åœºæ¯”èµ›å¾·å¸ƒåŠ³å†…ï¼Œæ²ƒå…‹æ‚‰æ•°å›å½’ï¼Œè€Œä¸”æœ¬åœºå‘æŒ¥å‡ºè‰²ï¼Œå…¨åœºæ•°æ®è¡¨ç°å ä¼˜ï¼Œä½†å¾ˆé—æ†¾æ²¡èƒ½åœ¨ 90 åˆ†é’Ÿå†…ç»ˆç»“æ¯”èµ›ï¼Œè€Œä¸”åœ¨ç‚¹çƒå¤§æˆ˜ä¸­ 3:4 ä¸æ•Œçš‡é©¬ï¼Œä¸¤å›åˆæ€»æ¯”åˆ† 7:8 é­æ·˜æ±°ã€‚</p>
<p>å…¶]]></description>
            <content:encoded><![CDATA[<p>åŒ—äº¬æ—¶é—´ 4 æœˆ 18 æ—¥ 2023-2024 èµ›å­£æ¬§å†  1/4 å†³èµ›æ¬¡å›åˆï¼Œæ›¼åŸåé•‡ä¼Šè’‚å“ˆå¾·ä¸»åœºè¿æˆ˜çš‡é©¬ã€‚</p>
<p>æœ¬åœºæ¯”èµ›å¾·å¸ƒåŠ³å†…ï¼Œæ²ƒå…‹æ‚‰æ•°å›å½’ï¼Œè€Œä¸”æœ¬åœºå‘æŒ¥å‡ºè‰²ï¼Œå…¨åœºæ•°æ®è¡¨ç°å ä¼˜ï¼Œä½†å¾ˆé—æ†¾æ²¡èƒ½åœ¨ 90 åˆ†é’Ÿå†…ç»ˆç»“æ¯”èµ›ï¼Œè€Œä¸”åœ¨ç‚¹çƒå¤§æˆ˜ä¸­ 3:4 ä¸æ•Œçš‡é©¬ï¼Œä¸¤å›åˆæ€»æ¯”åˆ† 7:8 é­æ·˜æ±°ã€‚</p>
<p>å…¶å®è¿™åœºæ¯”èµ›çœŸçš„çœŸçš„çœŸçš„è¸¢å¾—å¾ˆå¥½äº†ï¼Œä½†åœ¨ç‚¹çƒå¤§æˆ˜ä¸­æŠ˜æˆŸï¼ŒçœŸçš„å¾ˆæ— å¥ˆã€‚</p>
<p>è¿™ä¸¤å¤©å·²ç»æœ‰æ„å°‘åˆ·æ¯”èµ›è§†é¢‘å›æ”¾äº†ï¼ŒååŠ²å¤ªå¤§äº†ï¼Œæ¯” 2021-2022 èµ›å­£è¿˜æ„éš¾å¹³ï¼Œç°åœ¨è¿˜æ²¡ç¼“è¿‡æ¥...</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1713597535783.jpg" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•æŸ¥çœ‹è‡ªå·±åœ¨ Github ä¸­æåŠæˆ–å›å¤è¿‡çš„ Issue è®°å½•ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/335</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/335</guid>
            <pubDate>Sun, 14 Apr 2024 14:12:24 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1713108869593.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Github ä¸»é¡µå·¦ä¾§æœ‰ä¸ª Recent Activity çš„æ ]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1713108869593.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Github ä¸»é¡µå·¦ä¾§æœ‰ä¸ª Recent Activity çš„æ ç›®ï¼Œä½†å®ƒæœ€å¤šæ˜¾ç¤ºè¿‡å»ä¸¤å‘¨å†… 4 æ¬¡æœ€è¿‘çš„æ›´æ–°ï¼Œä½†è¦æ±‚çŠ¶æ€æ˜¯ <code>open</code> çš„ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾è‡ªå·±åˆ›å»ºçš„ã€è¯„è®ºè¿‡çš„ Issue æˆ– PR è®°å½•ï¼Œç„¶è€Œå®ƒå¯èƒ½å·²ç» <code>closed</code> äº†ã€‚</p>
<blockquote>
<p><a href="https://github.com/issues">https://github.com/issues</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1713103769217.png" alt=""></p>
<p>ä¸ªäººä¸»é¡µçš„ Issues å…¥å£é»˜è®¤çš„é™å®šæ¡ä»¶æ˜¯ï¼š<code>is:open is:issue archived:false author:xxx</code>ã€‚</p>
<p>ç¿»æŸ¥ Github æœç´¢æ–‡æ¡£å¯çŸ¥ï¼š</p>
<blockquote>
<p><a href="https://docs.github.com/zh/search-github/searching-on-github/searching-issues-and-pull-requests#search-by-a-user-thats-involved-in-an-issue-or-pull-request">æŒ‰è®®é¢˜æˆ–æ‹‰å–è¯·æ±‚ä¸­æ¶‰åŠçš„ç”¨æˆ·æœç´¢</a></p>
</blockquote>
<p>å¯æ ¹æ® <code>involves</code> é™å®šç¬¦æŸ¥æ‰¾ä»¥æŸç§æ–¹å¼æ¶‰åŠç‰¹å®šç”¨æˆ·çš„é—®é¢˜ï¼Œè¯¥é™å®šç¬¦æ˜¯ <code>author</code>ã€<code>assignee</code>ã€<code>mentions</code> å’Œ <code>commenter</code> çš„é€»è¾‘æˆ–å…³ç³»ã€‚é™å®šæ¡ä»¶ä¸º <code>involves@me</code> æˆ– <code>involves:&lt;your-username&gt;</code>ï¼ˆä½ çš„ Github ç”¨æˆ·åï¼‰ã€‚</p>
<p>ä¹Ÿå¯ç»„åˆæ›´å¤šçš„é™å®šæ¡ä»¶è¾¾åˆ°æ›´ç²¾ç»†çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚</p>
<ul>
<li><code>is:issue involves:toFrankie alfred</code>ï¼šä¸æˆ‘ç›¸å…³çš„ã€æ ‡é¢˜æˆ–æ­£æ–‡åŒ…å« alfred çš„ Issuesã€‚</li>
<li><code>is:issue in:title involves:toFrankie alfred</code>ï¼šä¸æˆ‘ç›¸å…³çš„ã€æ ‡é¢˜åŒ…å« alfred çš„ Issuesã€‚</li>
</ul>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä¼šç”¨ Alfred å®šä¹‰ä¸€ä¸ª <a href="https://www.alfredapp.com/help/features/web-search/">Web Search</a> æŒ‡ä»¤ã€‚ä½¿ç”¨æ—¶åªè¦ã€ŒâŒ¥ + Spaceã€å”¤èµ· Alfred å¹¶è¾“å…¥å…³é”®è¯å°±èƒ½å¿«é€Ÿæœç´¢ã€‚æ¯”å¦‚ï¼š</p>
<blockquote>
<p><code>https://github.com/issues?q=is%3Aissue+involves%3AtoFrankie {query}</code></p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://docs.github.com/zh/search-github">Search on Github</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Proxy ä¸ Reflect]]></title>
            <link>https://github.com/toFrankie/blog/issues/334</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/334</guid>
            <pubDate>Fri, 05 Apr 2024 11:07:10 GMT</pubDate>
            <description><![CDATA[<h2>å…ƒç¼–ç¨‹</h2>
<p>å…ƒç¼–ç¨‹ï¼ˆmeta-programmingï¼‰ä¸€èˆ¬åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€æ˜¯åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼ŒäºŒæ˜¯åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä»£ç è¡Œä¸ºã€‚</p>
<blockquote>
<p>Just like metadata is data about data, metaprogramming is writing progr]]></description>
            <content:encoded><![CDATA[<h2>å…ƒç¼–ç¨‹</h2>
<p>å…ƒç¼–ç¨‹ï¼ˆmeta-programmingï¼‰ä¸€èˆ¬åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€æ˜¯åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼ŒäºŒæ˜¯åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä»£ç è¡Œä¸ºã€‚</p>
<blockquote>
<p>Just like metadata is data about data, metaprogramming is writing programs that manipulate programs. It's a common perception that metaprograms are the programs that generate other programs. But the paradigm is even broader. All of the programs designed to read, analyze, transform, or modify themselves are examples of metaprogramming. <a href="https://developer.ibm.com/tutorials/ba-metaprogramming-python/">Metaprogramming in Python</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.zhihu.com/question/23856985">æ€ä¹ˆç†è§£å…ƒç¼–ç¨‹ï¼Ÿ</a></p>
</blockquote>
<h2>Proxy</h2>
<p>åœ¨ JavaScript ä¸­ï¼ŒProxy å±äºå…ƒç¼–ç¨‹çš„ä¸€ç§ã€‚</p>
<h3>ç®€ä»‹</h3>
<p>å¦‚æœä½ é—®æˆ‘å¤šå¤§ï¼Œé€šè¿‡ <code>person.age</code> è®¿é—®å¾—åˆ° <code>20</code>ã€‚</p>
<pre><code class="language-js">const person = {
 name: 'Frankie',
 age: 20,
}
</code></pre>
<p>ä½†è¿™å±Šå¹´è½»äººï¼Œæ€»æ˜¯è¯´ã€Œåˆ«é—®ï¼Œé—®å°±æ˜¯ 18ã€ï¼Œé‚£ä¹ˆæˆ‘ä¼šåˆ›å»ºä¸€ä¸ªæ›¿èº«ï¼š</p>
<pre><code class="language-js">const substitute = new Proxy(person, {
  get(target, property) {
    if (property === 'age') {
      return 18
    }
    return target[property]
  },
})
</code></pre>
<p>è¿™æ ·ï¼Œå†é—®æˆ‘å¹´é¾„æ—¶ï¼Œä½ é—®çš„å…¶å®æ˜¯ <code>substitute</code>ï¼Œæ­¤æ—¶ <code>substitute.age</code> æ˜¯ 18ã€‚å°½ç®¡æˆ‘çœŸå®å¹´é¾„ <code>person.age</code> æ˜¯ 20ã€‚</p>
<p>Proxy é€šå¸¸ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºã€‚æ¯”å¦‚ï¼Œåˆ«äººè®¿é—®æˆ‘çš„å¹´é¾„ï¼Œè®²é“ç†åº”è¯¥è¿”å›çœŸå®å¹´é¾„ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œä½†ç”±äºæŸäº›åŸå› ï¼ˆå¿ƒæƒ…ä¸çˆ½ï¼‰ï¼Œå°±å‘Šè¯‰ä½ æˆ‘ 18ã€‚</p>
<p><strong>Proxy å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚</strong></p>
<h3>åŸºç¡€è¯­æ³•</h3>
<pre><code class="language-js">const proxy = new Proxy(target, handler)
</code></pre>
<ul>
<li><code>target</code> - è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆä¸‹æ–‡ç§°ä¸ºæºå¯¹è±¡ï¼‰ã€‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚æ•°ç»„ã€å‡½æ•°ã€å¦ä¸€ä¸ªä»£ç†å¯¹è±¡ç­‰ã€‚</li>
<li><code>handler</code> - ä¸€ä¸ªå«æœ‰ç‰¹å®šæ–¹æ³•çš„å¯¹è±¡ã€‚</li>
</ul>
<p>å…¶ä¸­ <code>handler</code> æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><code>handler.get()</code></li>
<li><code>handler.set()</code></li>
<li><code>handler.has()</code></li>
<li><code>handler.apply()</code></li>
<li><code>handler.construct()</code></li>
<li><code>handler.defineProperty()</code></li>
<li><code>handler.deleteProperty()</code></li>
<li><code>handler.getOwnPropertyDescriptor()</code></li>
<li><code>handler.getPrototypeOf()</code></li>
<li><code>handler.setPrototypeOf()</code></li>
<li><code>handler.ownKeys()</code></li>
<li><code>handler.isExtensible()</code></li>
<li><code>handler.preventExtensions()</code></li>
</ul>
<blockquote>
<p>æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ã€‚å¦‚æœæŸä¸ªæ–¹æ³•æœªå®šä¹‰ï¼Œå°†ä¼šä¿ç•™æºå¯¹è±¡çš„é»˜è®¤è¡Œä¸ºã€‚</p>
</blockquote>
<p>ä¸€ä¸ªæ— æ“ä½œè½¬å‘ä»£ç†ï¼š</p>
<pre><code class="language-js">const person = {}
const proxy = new Proxy(person, {})

proxy.name = 'Frankie'

console.log(person.name) // 'Frankie'
</code></pre>
<h3>get/set æ–¹æ³•</h3>
<p>ç”¨äºæ‹¦æˆªå¯¹è±¡çš„è¯»å–ã€èµ‹å€¼ã€‚</p>
<pre><code class="language-js">const person = {
  name: 'Frankie',
  age: 20,
}

const handler = {
  get(target, property, receiver) {
    console.log(`Getting ${property}`)
    return Reflect.get(target, property, receiver)
  },
  
  set(target, property, value, receiver) {
    console.log(`Setting ${property}`)
    return Reflect.set(target, property, value, receiver)
  },
}

const proxy = new Proxy(person, handler)
</code></pre>
<p>å½“è¯»å– <code>proxy.name</code> æˆ–èµ‹å€¼ <code>proxy.name = 'foo'</code> å°±ä¼šå¯¹åº”è§¦å‘ <code>get</code>ã€<code>set</code> æ–¹æ³•ã€‚</p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><code>target</code> - æºå¯¹è±¡ã€‚</li>
<li><code>property</code> - è¢«è¯»å–/èµ‹å€¼çš„å±æ€§åã€‚</li>
<li><code>value</code> - å°†è¢«èµ‹å€¼çš„å€¼ï¼ˆä»… <code>set</code> æ–¹æ³•æœ‰ï¼‰ã€‚</li>
<li><code>receiver</code> - æœ€åˆæ¥æ”¶èµ‹å€¼çš„å¯¹è±¡ã€‚é€šå¸¸æ˜¯ä»£ç†å®ä¾‹æœ¬èº«ã€‚</li>
</ul>
<p>è¿”å›å€¼ï¼š</p>
<ul>
<li><code>get()</code> æ–¹æ³•å¯è¿”å›ä»»æ„å€¼ã€‚</li>
<li><code>set()</code> æ–¹æ³•è¿”å›å¸ƒå°”å€¼ï¼Œ<code>true</code> è¡¨ç¤ºå±æ€§è®¾ç½®æˆåŠŸã€‚</li>
</ul>
<p>çº¦æŸï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get#%E7%BA%A6%E6%9D%9F">get çº¦æŸ</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set#%E7%BA%A6%E6%9D%9F">set çº¦æŸ</a></li>
</ul>
<p><code>receiver</code> ä¸æ˜¯ä»£ç†å®ä¾‹æœ¬èº«çš„åä¾‹ï¼š</p>
<pre><code class="language-js">const empty = {}

const proxy = new Proxy(
  {},
  {
    get(target, property, receiver) {
      console.log(receiver === proxy) // ?
      console.log(receiver === empty) // ?
      return Reflect.get(target, property, receiver)
    },
  }
)

Object.setPrototypeOf(empty, proxy)

empty.foo
</code></pre>
<p>å½“è¯»å– <code>empty.foo</code> æ—¶ï¼Œå› æœ¬èº«æ²¡æœ‰ <code>foo</code> å±æ€§ï¼Œåˆ™ä»åŸå‹é“¾ <code>proxy</code> ä¸Šæ‰¾ï¼Œè§¦å‘ <code>get</code> æ–¹æ³•ï¼Œæ­¤æ—¶æ‰“å°ç»“æœåˆ†åˆ«æ˜¯ <code>false</code>ã€<code>true</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶çš„ <code>receiver</code> ä¸º <code>empty</code> å¯¹è±¡ï¼Œè€Œé <code>proxy</code> å®ä¾‹ã€‚</p>
<h3>å…¶ä»–æ–¹æ³•</h3>
<p>é™¤äº†æœ€å¸¸ç”¨çš„æ‹¦æˆªå±æ€§è¯»å†™æ“ä½œä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ‹¦æˆªä»¥ä¸‹æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th>handler æ–¹æ³•</th>
<th>æ‹¦æˆªæ“ä½œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get()</code></td>
<td>é’ˆå¯¹å±æ€§è¯»å–çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>set()</code></td>
<td>é’ˆå¯¹å±æ€§èµ‹å€¼çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>has()</code></td>
<td>é’ˆå¯¹ <code>in</code> æ“ä½œç¬¦çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>apply()</code></td>
<td>é’ˆå¯¹å‡½æ•°è°ƒç”¨çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>construct()</code></td>
<td>é’ˆå¯¹ <code>new</code> æ“ä½œç¬¦çš„æ„é€ å‡½æ•°è°ƒç”¨çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>defineProperty()</code></td>
<td>é’ˆå¯¹ <code>Object.defineProperty()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>deleteProperty()</code></td>
<td>é’ˆå¯¹ <code>delete</code> æ“ä½œç¬¦åˆ é™¤å±æ€§çš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>getOwnPropertyDescriptor()</code></td>
<td>é’ˆå¯¹ <code>Object.getOwnPropertyDescriptor()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>getPrototypeOf()</code></td>
<td>é’ˆå¯¹ <code>Object.getPrototypeOf()</code>ã€<code>Object.prototype.__proto__</code>ã€<code>Object.prototype.isPrototypeOf()</code>ã€<code>instanceof</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>setPrototypeOf()</code></td>
<td>é’ˆå¯¹ <code>Object.setPrototypeOf()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>ownKeys()</code></td>
<td>é’ˆå¯¹ <code>Reflect.ownKeys()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>isExtensible()</code></td>
<td>é’ˆå¯¹ <code>Object.isExtensible()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
<tr>
<td><code>preventExtensions()</code></td>
<td>é’ˆå¯¹ <code>Object.preventExtensions()</code> æ“ä½œçš„æ‹¦æˆªã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä»¥ä¸Š <code>handler</code> æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½ä¼šå¯¹åº”æ‹¦æˆª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect</a> çš„åŒåæ–¹æ³•ã€‚</p>
</blockquote>
<h3>åº”ç”¨åœºæ™¯</h3>
<p>é˜²æ­¢è®¿é—®ç§æœ‰å±æ€§ã€‚</p>
<pre><code class="language-js">const person = {
  name: 'Frankie',
  _phone: '12345678910',
}

const user = new Proxy(person, {
  get(target, property, receiver) {
    if (property.startsWith('_')) return undefined
    return Reflect.get(target, property, receiver)
  },
})

console.log(user._phone) // 'Frankie'
console.log(user._phone) // undefined
</code></pre>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ JavaScript ä¸­è®¿é—®ä¸€äº›ä¸å­˜åœ¨çš„å±æ€§ä¼šè¿”å› <code>undefined</code>ï¼Œé‚£ä¹ˆå€ŸåŠ© Proxy å¯ä»¥åœ¨è®¿é—®æœªçŸ¥/ä¸å­˜åœ¨çš„å±æ€§æ—¶æ·»åŠ ä¸€äº› Warningã€‚</p>
</blockquote>
<p>æ•°ç»„è´Ÿå€¼ç´¢å¼•ï¼š</p>
<blockquote>
<p><a href="https://h3manth.com/new/blog/2013/negative-array-index-in-javascript/">Negative Array Index in Javascript</a></p>
</blockquote>
<h3>ä¸ºä»€ä¹ˆ Vue ä½¿ç”¨ Proxy ä»£æ›¿ Object.definePropertyï¼Ÿ</h3>
<p>å…³äº <code>Object.defineProperty()</code> ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹äºå±æ€§ä¼—å¤šã€åµŒå¥—æ›´æ·±çš„å¯¹è±¡ï¼Œéœ€è¦éå†ã€æ·±å±‚ç›‘å¬ï¼Œå¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</li>
<li>æ— æ³•ç›‘å¬åˆ°å¯¹è±¡å±æ€§çš„æ–°å¢/åˆ é™¤ï¼Œéœ€è¦é¢å¤–æ·»åŠ æ–°çš„ API å®ç°ï¼Œæ¯”å¦‚ <code>set</code>ã€<code>delete</code>ã€‚</li>
<li>æ— æ³•ç›‘å¬æ•°ç»„ APIï¼ŒåŠ ä¹‹æ•°ç»„é•¿åº¦å¯èƒ½å¾ˆå¤§ï¼Œå¦‚æœä½¿ç”¨å¯¹è±¡é‚£ç§éå†ã€æ·±å±‚ç›‘å¬çš„æ–¹å¼ï¼Œæ€§èƒ½æ›´åŠ ç³Ÿç³•äº†ï¼Œæ‰€ä»¥é‡å†™äº† <code>push</code>ã€<code>pop</code> ç­‰æ–¹å¼ã€‚</li>
</ul>
<p>è¿™äº›é—®é¢˜åœ¨ Proxy ä¸Šéƒ½æœ‰è¾ƒå¥½ä¸”å®Œæ•´çš„æ”¯æŒã€‚</p>
<p>ä½† Proxy å…¼å®¹æ€§æ²¡é‚£ä¹ˆå¥½ã€‚å®ƒæ— æ³• polyfillã€‚</p>
<blockquote>
<p><a href="https://babeljs.io/docs/learn/#proxies">Due to the limitations of ES5, Proxies cannot be transpiled or polyfilled.</a></p>
</blockquote>
<p>æºç ï¼š</p>
<ul>
<li><a href="https://github.com/vuejs/core/blob/0dea7f9a260d93eb6c39aabac8c94c2c9b2042dd/packages/reactivity/src/reactive.ts#L242">vuejs/core/packages/reactivity/src/reactive.ts</a></li>
<li><a href="https://github.com/vuejs/vue/blob/bed04a77e575d6c4c1d903f60087dca874f7213e/src/core/observer/index.ts#L128">vuejs/vue/src/core/observer/index.ts</a></li>
</ul>
<h3>Proxy æ€§èƒ½</h3>
<ul>
<li><a href="https://www.cnblogs.com/zmj97/p/10954968.html">ES6 Proxy æ€§èƒ½ä¹‹æˆ‘è§</a></li>
</ul>
<h2>Reflect</h2>
<p>Reflect æ˜¯ä¸€ä¸ªå†…ç½®ã€Œå¯¹è±¡ã€ã€‚å®ƒä¸æ˜¯å‡½æ•°ï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½å½“ä½œæ™®é€šå‡½æ•°æˆ–ä½¿ç”¨ <code>new</code> å…³é”®å­—è°ƒç”¨ã€‚</p>
<pre><code class="language-js">Object.prototype.toString.call(Reflect) // '[object Reflect]'
</code></pre>
<p>å®ƒè·Ÿ Proxy çš„ handler æœ‰ç€åŒåçš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>Reflect.get()</code></li>
<li><code>Reflect.set()</code></li>
<li><code>Reflect.has()</code></li>
<li><code>Reflect.apply()</code></li>
<li><code>Reflect.construct()</code></li>
<li><code>Reflect.defineProperty()</code></li>
<li><code>Reflect.deleteProperty()</code></li>
<li><code>Reflect.getOwnPropertyDescriptor()</code></li>
<li><code>Reflect.getPrototypeOf()</code></li>
<li><code>Reflect.setPrototypeOf()</code></li>
<li><code>Reflect.ownKeys()</code></li>
<li><code>Reflect.isExtensible()</code></li>
<li><code>Reflect.preventExtensions()</code></li>
</ul>
<p>Proxy å¯ä»¥ä¸ Reflect æ­é…ä½¿ç”¨ï¼Œå‰è€…è´Ÿè´£æ‹¦æˆªå¯¹è±¡çš„æ“ä½œï¼Œåè€…è´Ÿè´£åŸæœ‰çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<p>è®¾è®¡ Reflect çš„ç›®çš„ï¼š</p>
<ul>
<li>æœªæ¥ JS æ–°è¯­æ³•å¯èƒ½åªéƒ¨ç½²åˆ° <code>Reflect</code> ä¸Šã€‚ç±»ä¼¼äºå¯è¿­ä»£çš„ <code>Map</code> ä¸€æ ·ï¼Œå‡è®¾æœªæ¥è¦æ–°å¢ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¹Ÿä¼šåŸºäºå¯è¿­ä»£çš„è¶‹åŠ¿å»è®¾è®¡ã€‚</li>
<li>ä¿®æ”¹æŸäº› <code>Object</code> æ–¹æ³•çš„è¿”å›ç»“æœï¼Œå˜å¾—æ›´åˆç†ã€‚æ¯”å¦‚ <code>Reflect.defineProperty()</code> å¦‚æœæ— æ³•å®šä¹‰å±æ€§ï¼Œå°±ä¼šè¿”å› <code>false</code>ï¼Œè€Œä¸åƒ <code>Object.defineProperty()</code> åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶æŠ›å‡ºé”™è¯¯ã€‚</li>
<li>ç»Ÿä¸€ä¸ºå‡½æ•°è¡Œä¸ºï¼Œæ¯”å¦‚åŸæ¥çš„ <code>delete obj[key]</code> åˆ é™¤å±æ€§ï¼Œç°åœ¨åˆ™æ˜¯ <code>Reflect.deleteProperty(obj, key)</code>ã€‚</li>
<li>è®¾è®¡ä¸ Proxy handler ä¸€è‡´ï¼Œéƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚</li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://2ality.com/2014/12/es6-proxies.html">Meta programming with ECMAScript 6 proxies</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect MDN</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS é€æ˜ç½‘æ ¼èƒŒæ™¯]]></title>
            <link>https://github.com/toFrankie/blog/issues/333</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/333</guid>
            <pubDate>Sat, 23 Mar 2024 12:23:06 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711204488088.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ— è®ºæ˜¯ Adobe è¿˜æ˜¯å…¶ä»–å›¾å½¢ç¼–è¾‘å™¨ï¼Œ]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711204488088.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ— è®ºæ˜¯ Adobe è¿˜æ˜¯å…¶ä»–å›¾å½¢ç¼–è¾‘å™¨ï¼Œéƒ½ä¼šä½¿ç”¨ç°ç™½ç›¸é—´çš„ç½‘æ ¼èƒŒæ™¯æ¥è¡¨è¾¾é€æ˜ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711197709091.png" alt=""></p>
<p>ç”¨ CSS å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<ul>
<li>ä½¿ç”¨ <code>background-image</code> + <code>background-size</code> + <code>background-repeat</code> ç»„åˆï¼Œå¦‚æœæƒ³è¦å›¾ç‰‡ä¸å¤±çœŸï¼Œå¯ä½¿ç”¨å››ä¸ªç½‘æ ¼ SVG å›¾ç‰‡é‡å¤ã€‚</li>
<li>å¦‚æœä¸æƒ³ç”¨å›¾ç‰‡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>background-image</code> + <code>linear-gradient</code>ï¼Œè®¾ç½®å¤šä¸ª <code>linear-gradient</code> ç„¶åè¿›è¡Œä¸€å®šçš„é”™ä½ï¼Œä½¿å…¶å½¢æˆæ ¼å­çŠ¶ã€‚</li>
</ul>
<p>ç¬¬ä¸€ç§æ–¹å¼ç¼ºç‚¹æ˜¯ä¸ä¾¿è°ƒæ•´å¤§å°ã€é¢œè‰²ã€‚ä¸‹æ–‡å°±ç¬¬äºŒç§æ–¹å¼å±•å¼€ä»‹ç»ã€‚</p>
<h2>å®ç°</h2>
<p>æå‰çŸ¥é“ï¼š</p>
<ul>
<li><code>background-image</code> å¯ä»¥è®¾ç½®ä¸€å¼ æˆ–å¤šå¼ å›¾ç‰‡ï¼Œå‰é¢çš„å›¾ç‰‡ä¼šæŒ¡ä½åé¢çš„å›¾ç‰‡ã€‚</li>
<li><code>background-position</code> å¯ä»¥æŒ‡å®šä¸€å¼ æˆ–å¤šå¼ å›¾ç‰‡çš„ä½ç½®ï¼Œ<code>background-size</code> ç­‰åŒç†ã€‚</li>
</ul>
<p>å…ˆå®šä¹‰ä¸€ä¸ªæ¸å˜ï¼š</p>
<pre><code class="language-css">.grid {
  background-image: linear-gradient(45deg, red 25%, green 25%, green 75%, red 75%);
  background-repeat: no-repeat;
  background-size: 50px 50px;
}
</code></pre>
<p>ä¸ºä»€ä¹ˆæ˜¯ 45Â°ã€25%ã€75%ï¼Ÿ</p>
<blockquote>
<p>ä¸ºäº†è®©ç»¿è‰²éƒ¨åˆ†å æ ¼å­å®½åº¦ä¸€åŠã€‚å°±æ˜¯ä¸€ä¸ªæ ¼å­åˆ†æˆäº†ä¸‰éƒ¨åˆ†çº¢è‰²ã€ç»¿è‰²ã€çº¢è‰²ï¼Œå®ƒä»¬æ‰€å æ¯”ä¾‹åˆ†åˆ«æ˜¯ 1:2:1ã€‚å½“æ—‹è½¬ 45Â° ä¹‹åï¼Œåœ¨å¯¹è§’çº¿çœ‹ä¹Ÿæ˜¯è¿™ä¸ªæ¯”ä¾‹ï¼Œä¹Ÿæ˜¯ä¸ºäº†åé¢çš„å †å ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711201062546.png" alt=""></p>
<p>æ¥ç€ï¼Œå†å®šä¹‰å¤šä¸€ä¸ªç›¸åŒçš„æ¸å˜ï¼Œå¹¶ç§»åŠ¨ç¬¬äºŒä¸ªæ¸å˜çš„ä½ç½®ï¼Œç§»åŠ¨è·ç¦»ä¸ºèƒŒæ™¯å›¾ç‰‡å¤§å°çš„ä¸€åŠã€‚</p>
<pre><code class="language-css">.grid {
  background-image: linear-gradient(
      45deg,
      rgba(255, 0, 0, 0.5) 25%,
      rgba(0, 255, 0, 0.5) 25%,
      rgba(0, 255, 0, 0.5) 75%,
      rgba(255, 0, 0, 0.5) 75%
    ),
    linear-gradient(
      45deg,
      rgba(255, 0, 0, 0.5) 25%,
      rgba(0, 255, 0, 0.5) 25%,
      rgba(0, 255, 0, 0.5) 75%,
      rgba(255, 0, 0, 0.5) 75%
    );
  background-repeat: no-repeat;
  background-position: 0 0, 25px 25px;
  background-size: 50px 50px;
}
</code></pre>
<blockquote>
<p>ä¸ºæ–¹ä¾¿æŸ¥çœ‹å †å æ•ˆæœï¼Œæ·»åŠ äº†é€æ˜åº¦ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711201488863.png" alt=""></p>
<p>åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æƒ³è±¡å¾—åˆ°æ­£æ–¹å½¢æ ¼å­çš„å½¢çŠ¶äº†ï¼Œæ¥ç€æˆ‘ä»¬æ”¹æˆ <code>background-repeat: repeat</code> å†çœ‹çœ‹ ğŸ‘‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711201624105.png" alt=""></p>
<p>è§‚å¯Ÿä¸Šå›¾ï¼Œåªè¦æŠŠç»¿è‰²éƒ¨åˆ†æ”¹æˆé€æ˜ï¼Œçº¢è‰²éƒ¨åˆ†æ”¹æˆç°è‰²ï¼Œå°±æ˜¯ç°ç™½ç›¸é—´çš„ç½‘æ ¼æ•ˆæœã€‚ä½†æ”¹æˆé€æ˜çš„è¯ï¼Œå¦‚æœæœ¬èº«åº•éƒ¨æ˜¯å«æœ‰èƒŒæ™¯çš„ï¼Œæ˜¾ç¤ºå°±æœ‰é—®é¢˜äº†ï¼Œå› æ­¤èƒŒæ™¯é¢œè‰²è¦æ”¹æˆç™½è‰²ã€‚</p>
<pre><code class="language-css">.grid {
  background-color: #fff;
  background-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%),
    linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%);
  background-position: 0 0, 25px 25px;
  background-size: 50px 50px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711202175343.png" alt=""></p>
<blockquote>
<p>å¦‚æ ¼å­å¤§å°ã€é¢œè‰²å¯æŒ‰éœ€è°ƒæ•´ã€‚å…¶ä¸­ç™½è‰²æ ¼å­è°ƒæ•´ <code>background-color</code>ã€ç°è‰²æ ¼å­è°ƒæ•´ <code>background-image</code> ä¸­çš„ <code>#eee</code> é¢œè‰²å€¼ã€‚ç›®å‰æ¯ä¸ªæ ¼å­å¤§å°æ˜¯ <code>25px</code>ï¼Œå¦‚è°ƒæ•´å¤§å°ï¼Œéœ€åŒæ—¶ä¿®æ”¹ <code>background-position</code>ï¼Œå®ƒå§‹ç»ˆæ˜¯ <code>background-size</code> çš„ä¸€åŠã€‚</p>
</blockquote>
<p>å¦å¤–ï¼ŒMDN æä¾›äº†å¦å¤–ä¸€ç§åšæ³•ï¼ˆ<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/conic-gradient#checkerboard">Checkerboard</a>ï¼‰ï¼Œå¯æ˜¯å…¼å®¹æ€§ä¸€èˆ¬ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è®°ä¸€æ¬¡ HTML å¯Œæ–‡æœ¬ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/332</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/332</guid>
            <pubDate>Sat, 16 Mar 2024 14:10:17 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1710603624284.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>æ­¤å‰æœ‰ä¸ªé¡¹ç›®é‡Œé¢ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šè¿è¥åå°è¿›è¡Œå¯Œæ–‡æœ¬é…ç½®ï¼Œç„¶]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1710603624284.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>æ­¤å‰æœ‰ä¸ªé¡¹ç›®é‡Œé¢ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šè¿è¥åå°è¿›è¡Œå¯Œæ–‡æœ¬é…ç½®ï¼Œç„¶ååœ¨æµè§ˆå™¨ã€å¾®ä¿¡å°ç¨‹åºå„ç«¯åšå±•ç¤ºã€‚</p>
<p>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æœ¬èº«æ˜¯å¯ä»¥è®¾ç½®å­—ä½“çš„ï¼Œå½“é¢„è®¾çš„å­—ä½“åç§°åŒ…å«ç©ºæ ¼ï¼ˆæ¯”å¦‚ <code>Microsoft Yahei</code>ï¼‰æ—¶ï¼Œå‡ºç°é—®é¢˜äº†ï¼Œåœ¨å°ç¨‹åºç«¯æ¸²æŸ“æ—¶å­—ä½“ä¸ç”Ÿæ•ˆã€‚</p>
<p>å½“æ—¶ä¸´æ—¶æ–¹æ¡ˆæ˜¯å°†å­—ä½“åç§°ç”¨è¿å­—ç¬¦æ›¿ä»£ç©ºæ ¼ï¼Œå› ä¸ºç¬¬äºŒå¤©è¦ä¸Šçº¿ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚é’ˆå¯¹ <code>Microsoft Yahei</code>ã€<code>PingFang SC</code>ã€<code>Helvetica Neue</code> è¿™ç±»ç³»ç»Ÿå†…ç½®çš„å­—ä½“ï¼Œä¸åº”å†™æˆ <code>Microsoft-Yahei</code>ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p>
<p>ä¸‹é¢å¼€å§‹æ‰¾æ‰¾æ ¹æœ¬åŸå› ã€‚</p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ CSS ä¸­è®¾ç½® <code>font-family</code> æ—¶ï¼Œå­—ä½“åç§°æ˜¯å¯ä»¥åŒ…å«ç©ºæ ¼çš„ï¼Œä½†æœ‰ç©ºæ ¼æ—¶ï¼Œåº”è¯¥è¦ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/font-family#family-name">MDN</a></p>
<blockquote>
<p>The name of a font family. For example, &quot;Times&quot; and &quot;Helvetica&quot; are font families. Font family names containing whitespace should be quoted. For example: &quot;Comic Sans MS&quot;.</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">.app {
  font-family: &quot;Helvetica Neue&quot;, &quot;Segoe UI&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;
}
</code></pre>
<blockquote>
<p>é‰´äºæµè§ˆå™¨çš„åŒ…å®¹æ€§å¾ˆå¼ºï¼Œå…¶å®ä¸å†™å¼•å·ï¼Œä¹Ÿèƒ½æ­£å¸¸è¯†åˆ«ã€‚</p>
</blockquote>
<h2>å¯»æ‰¾åŸå› </h2>
<p>ç»æ’æŸ¥å‘ç°ï¼Œå‰é¢é‡åˆ°çš„é—®é¢˜ï¼Œå…¶å®æ˜¯å°±æ˜¯å› ä¸ºå¯¹ HTML å®ä½“è½¬ä¹‰åï¼Œå¯¼è‡´ HTML ç»“æ„ä¸æ­£ç¡®å¯¼è‡´çš„ã€‚</p>
<p>åå°çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç”¨çš„æ˜¯ <a href="https://github.com/margox/braft-editor">Braft Editor</a>ï¼Œå®ƒè®¾ç½®å­—ä½“çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const fontFamilies = [
  {
    name: 'ST Song',
    family: '&quot;ST Song&quot;', // &quot;'ST Song'&quot; åœ¨ BraftEditor å†…ä¸ç”Ÿæ•ˆ
  },
]
</code></pre>
<pre><code class="language-jsx">&lt;BraftEditor fontFamilies={fontFamilies} /&gt;
</code></pre>
<p><strong>æ˜¯çš„ï¼Œåœ¨ Braft Editor é‡Œå­—ä½“åç§°åªèƒ½ç”¨ã€ŒåŒå¼•å·ã€åŒ…è£¹ï¼Œå•å¼•å·ä¸ç”Ÿæ•ˆã€‚</strong></p>
<p>å‡è®¾å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è¾“å‡ºçš„ HTML å¦‚ä¸‹ï¼ˆHello Worldï¼‰ï¼š</p>
<pre><code class="language-html">&lt;p&gt;&lt;span style=&quot;font-family:&amp;quot;ST Song&amp;quot;&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/span&gt;&lt;/p&gt;
</code></pre>
<p>åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿™æ®µå¯Œæ–‡æœ¬å†…å®¹ç›´æ¥é€šè¿‡ <code>Element.innerHTML</code> å»ä¿®æ”¹ DOMï¼Œæ˜¯å¯ä»¥å¾—åˆ°é¢„æœŸæ•ˆæœçš„ã€‚ä½†åœ¨å°ç¨‹åºé‡Œï¼Œéœ€è¦å¯¹ç±»ä¼¼ <code>&amp;quot;</code>ï¼ˆåŒå¼•å·ï¼‰ç­‰ HTML Entity è¿›è¡Œè½¬æ¢ï¼Œæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œå¦åˆ™å®ƒä¼šå°† <code>&amp;quot;</code> å½“ä½œäº”ä¸ªæ™®é€šå­—ç¬¦ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŒå¼•å·ã€‚</p>
<p>ä¹‹å‰æ˜¯é€šè¿‡ <a href="https://github.com/fb55/entities">entities</a> æ¥åšè½¬ä¹‰çš„ã€‚</p>
<pre><code class="language-js">import { decodeHTML } from 'entities'

const html = `&lt;p&gt;&lt;span style=&quot;font-family:&amp;quot;ST Song&amp;quot;&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/span&gt;&lt;/p&gt;`

const transformedHtml = decodeHTML(html)

console.log(transformedHtml)
</code></pre>
<p>å¾—åˆ°çš„è½¬ä¹‰ç»“æœæ˜¯ï¼š</p>
<pre><code class="language-html">&lt;p&gt;&lt;span style=&quot;font-family:&quot;ST Song&quot;&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;/p&gt;
</code></pre>
<p>å…¶å®è¿™å°±çœ‹å‡ºé—®é¢˜äº†ï¼Œ<code>style</code> å±æ€§åŒ…è£¹äº†ä¸¤ä¸ªåŒå¼•å·ï¼Œè‡ªç„¶è§£æä¸åˆ°é¢„æœŸç»“æœã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1710601910676.png" alt=""></p>
<h2>è§£å†³é—®é¢˜</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒCSS å­—ç¬¦ä¸²ç±»å‹çš„å±æ€§å€¼ï¼Œå¯ä»¥ç”¨å•å¼•å·æˆ–åŒå¼•å·ã€‚æˆ‘ä»¬å…ˆæŠŠ <code>style</code> é‡Œå¯èƒ½å‡ºç°çš„å¼•å·ï¼Œå…¨éƒ¨è½¬ä¸ºå•å¼•å·ï¼Œè¿™æ ·çš„è¯å°±èƒ½æ­£ç¡®è§£æäº†ã€‚</p>
<p>CSS å±æ€§å€¼ä½¿ç”¨åˆ°å¼•å·çš„ï¼ˆåªæƒ³èµ·äº†è¿™å‡ ä¸ªï¼‰ï¼š</p>
<ul>
<li><code>font-family</code></li>
<li><code>content</code></li>
<li><code>url()</code></li>
<li>...</li>
</ul>
<blockquote>
<p>Related Link: <a href="https://www.w3.org/TR/2011/REC-CSS2-20110607/syndata.html#values">https://www.w3.org/TR/2011/REC-CSS2-20110607/syndata.html#values</a></p>
</blockquote>
<p>è¿™æ ·çš„è¯ï¼Œç”¨è¡¨è¾¾å¼åšåŒ¹é…å‡º <code>style</code> çš„å±æ€§å€¼ï¼Œç„¶åå°†é‡Œé¢çš„å¼•å·æ›¿æ¢æ‰ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function transformHtmlInlineStyle(html) {
  return html.replace(/(\s+style=&quot;[^&quot;]*&quot;)/gi, match =&gt; {
    return match.replace(/&amp;quot;|&amp;apos;|&amp;#34;|&amp;#39;|&amp;#x22;|&amp;#x27;/gi, &quot;'&quot;)
  })
}
</code></pre>
<p>å› æ­¤ï¼Œä¸Šé¢çš„æµç¨‹åªè¦åŠ å¤šä¸€æ­¥å°±è¡Œï¼š</p>
<pre><code class="language-diff">  import { decodeHTML } from 'entities'

  const html = `&lt;p&gt;&lt;span style=&quot;font-family:&amp;quot;ST Song&amp;quot;&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/span&gt;&lt;/p&gt;`

+ let transformedHtml = transformHtmlInlineStyle(html)

  transformedHtml = decodeHTML(html)

  console.log(transformedHtml)
</code></pre>
<p>å¾—åˆ°çš„ç»“æœä¸ºï¼š</p>
<pre><code class="language-html">&lt;p&gt;&lt;span style=&quot;font-family:'ST Song'&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;/p&gt;
</code></pre>
<p>ç¤ºä¾‹ï¼š<a href="https://codesandbox.io/p/sandbox/braft-editor-demo-8ppx7t">CodeSandbox</a></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Taro è‡ªå®šä¹‰ TabBar for H5 ç¤ºä¾‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/331</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/331</guid>
            <pubDate>Fri, 15 Mar 2024 17:14:07 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1710604007675.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨åš Taro é¡¹ç›®ï¼Œæœ‰å¾®ä¿¡å°ç¨‹åºå’Œ H5 ä¸¤ç«¯ï¼Œ]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1710604007675.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨åš Taro é¡¹ç›®ï¼Œæœ‰å¾®ä¿¡å°ç¨‹åºå’Œ H5 ä¸¤ç«¯ï¼Œå› å¯¼èˆªæ æ ·å¼æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œéœ€å®ç°è‡ªå®šä¹‰ TabBarã€‚</p>
<p>ç›®å‰ Taro for H5 æœªé»˜è®¤æ”¯æŒè‡ªå®šä¹‰ TabBarï¼Œè¯¦è§ <a href="https://github.com/NervJS/taro/issues/10049">#10049</a>ã€‚</p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html">å¾®ä¿¡å°ç¨‹åºè‡ªå®šä¹‰ tabBar</a></li>
<li><a href="https://taro-docs.jd.com/docs/custom-tabbar">å¾®ä¿¡å°ç¨‹åºè‡ªå®šä¹‰ Tabbarï¼ˆTaroï¼‰</a></li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>æ–‡ä»¶åä¸º <code>custom-tab-bar</code>ï¼Œä¸”æ”¾åœ¨ <code>src</code> ç›®å½•ä¸‹ã€‚</li>
<li>å®Œæ•´é…ç½® <code>tabBar</code> å­—æ®µï¼Œä¸€æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼ŒäºŒæ˜¯ä¸é…ç½®çš„æƒ…å†µä¸‹ H5 ç«¯åˆ‡æ¢é¡µé¢çš„ä½“éªŒå¾ˆå·®ã€‚åè€…ä¸ç¡®å®šæ˜¯å¦å› ä¸º Taro ä¸æ”¯æŒæ‰€ä»¥æ²¡åšå…¼å®¹ã€‚</li>
<li>ç”±äº H5 ç«¯æœªå¾—åˆ°å®˜æ–¹æ”¯æŒï¼Œå› æ­¤é…ç½® <code>custom: true</code> ç¼–è¯‘ä¸º H5 æ—¶æ˜¯æ— æ•ˆçš„ã€‚</li>
</ul>
<p>å®ç°æ€è·¯ï¼š</p>
<p>å¯¹äºå¾®ä¿¡å°ç¨‹åºæ¥è¯´ï¼ŒTaro å·²ç»æ”¯æŒäº†ï¼Œè¿™ä¸ªä¸å¤šè¯´ï¼ŒæŒ‰è¦æ±‚å†™å°±èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚è€Œ H5 åˆ™åœ¨ TabBar é¡µé¢ä¸­å¼•å…¥ <code>custom-tab-bar</code> å³å¯ã€‚æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯å†…ç½®çš„ TabBar ä»ç„¶å­˜åœ¨ï¼Œé€šè¿‡æ ·å¼å°†å…¶å±è”½æ‰ã€‚äºŒæ˜¯ï¼Œåœ¨ TabBar é¡µé¢åˆ‡æ¢æ—¶ï¼Œç”±äºç»„ä»¶ä¸ä¼šé‡æ–°æŒ‚è½½ï¼Œå¯èƒ½ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œä¸ºé¿å… Tab çš„é«˜äº®çŠ¶æ€ä¸æ­£ç¡®ï¼Œéœ€åœ¨ <code>onShow</code> æ—¶æœºè¿›è¡Œè®¾ç½®ã€‚</p>
<p>å¼•å…¥ <code>custom-tab-bar</code> é¡µé¢çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åœ¨æ¯ä¸ª TabBar é¡µé¢ä¸­æ‰‹åŠ¨å¼•å…¥ï¼ˆä¸€èˆ¬ä¸ä¼šå¾ˆå¤šï¼‰ï¼ŒäºŒæ˜¯é€šè¿‡æ’ä»¶ï¼ˆæ¯”å¦‚ <a href="https://github.com/xdoer/taro-inject-component-loader">taro-inject-component-loader</a>ï¼‰è‡ªåŠ¨æ’å…¥åˆ°æ¯ä¸ªé¡µé¢ã€‚åè€…ï¼Œè¿˜éœ€è¦åœ¨ç»„ä»¶å†…è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œè‹¥æ˜¯ TabBar çš„è·¯ç”±åˆ™æ˜¾ç¤ºè‡ªå®šä¹‰ TabBar çš„å†…å®¹ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚</p>
<blockquote>
<p>ä¸‹æ–‡ä»¥ React ä¸ºä¾‹ï¼Œå¹¶é€‰æ‹©ç¬¬äºŒç§æ–¹å¼å¯¼å…¥è‡ªå®šä¹‰ TabBarã€‚</p>
</blockquote>
<h2>å®ç°</h2>
<p>å°ç¨‹åºé…ç½® <code>app.config.js</code>ï¼Œè®°å¾—å®Œæ•´é…ç½® <code>tabBar</code>ã€‚</p>
<pre><code class="language-diff">export default defineAppConfig({
  tabBar: {
+   custom: true,
    // ...
  },
})
</code></pre>
<p>å®‰è£… <code>taro-inject-component-loader</code>ï¼Œå¦‚æœæ‰‹åŠ¨å¼•å…¥ <code>custom-tab-bar</code> å¯ä»¥å¿½ç•¥ã€‚</p>
<pre><code class="language-shell">$ pnpm add taro-inject-component-loader -D
</code></pre>
<p>ç¼–è¯‘é…ç½® <code>config/index.js</code> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-diff">import path from 'path'

export default {
  // ...
  alias: {
+   '@': path.resolve('./src'),
  },
  h5: {
    // ...
    webpackChain(chain) {
      chain.merge({
        module: {
          rule: {
            injectBaseComponentLoader: {
              test: /\.jsx$/,
              use: [
                {
+                 loader: 'taro-inject-component-loader',
+                 options: {
+                   importPath: '@/custom-tab-bar',
+                 },
                },
              ],
            },
          },
        },
      })
    },
  },
}
</code></pre>
<blockquote>
<p>å¯å…³æ³¨ä¸‹ <code>taro-inject-component-loader</code> é‡Œ <code>isPage</code> çš„é»˜è®¤é…ç½®æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œç‰¹åˆ«æ˜¯æœ‰åˆ†åŒ…æ—¶ï¼Œå®ƒåªä¼šæ’å…¥åˆ°é¡µé¢ç»„ä»¶é‡Œï¼Œ<a href="https://github.com/xdoer/taro-inject-component-loader?tab=readme-ov-file#%E9%85%8D%E7%BD%AE%E9%A1%B9">è¯¦è§</a>ã€‚</p>
</blockquote>
<p>ç¼–å†™ <code>custom-tab-bar</code> ç»„ä»¶ï¼Œå‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>é TabBar é¡µé¢ï¼Œä¸æ˜¾ç¤º <code>custom-tab-bar</code> ç»„ä»¶å†…å®¹ã€‚è¿™ä¸ªå¯ä»¥åœ¨ <code>injectBaseComponentLoader.use[].options.isPage</code> é€šè¿‡è‡ªå®šä¹‰æ­£åˆ™é™åˆ¶åªåœ¨ TabBar é¡µæ³¨å…¥ç»„ä»¶ã€‚</li>
<li>ä¸ºé¿å…é TabBar é¡µé¢è¿”å› TabBar é¡µé¢æ—¶ï¼Œåœ¨åˆ‡æ¢çš„é—´éš™ï¼Œå¯èƒ½ä¼šå‡ºç° <code>custom-tab-bar</code> éšè— â†’ æ˜¾ç¤º â†’ éšè—çš„è¿‡ç¨‹ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œè¦ä½¿ç”¨ä¸€å®šçš„ç¼“å­˜å¤„ç†ã€‚</li>
<li>ç”±äº TabBar é¡µé¢ä¹‹é—´åˆ‡æ¢ä¸ä¸€å®šèƒ½è§¦å‘ rerenderï¼Œå› æ­¤è¦åœ¨ <code>onShow</code> ç”Ÿå‘½å‘¨æœŸè®¾ç½® Tab çš„é«˜äº®çŠ¶æ€ï¼Œä»¥ç¡®ä¿ Tab æ­£ç¡®æ˜¾ç¤ºã€‚</li>
<li>ç”±äºåªæœ‰åœ¨é¡µé¢çº§åˆ«çš„ç»„ä»¶å†…æ‰ä¼šè§¦å‘ <code>onShow</code> ç”Ÿå‘½å‘¨æœŸï¼ˆ<a href="https://taro-docs.jd.com/docs/react-page#componentdidshow-">è¯¦è§</a>ï¼‰ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ <a href="https://taro-docs.jd.com/docs/apis/about/events"><code>Taro.eventCenter</code></a> æ¥ç›‘å¬é¡µé¢ç»„ä»¶çš„ <code>onShow</code> ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>å…³äºå›¾ç‰‡èµ„æºå¼•ç”¨é—®é¢˜ï¼Œå°ç¨‹åºç«¯å¯ä»¥ä¸ç”¨ <code>import</code> å¯¼å…¥çš„æ–¹å¼ï¼ŒTaro ä¼šè‡ªåŠ¨æ ¹æ® TabBar é…ç½®å¤„ç†ï¼ˆ<a href="https://taro-docs.jd.com/docs/custom-tabbar#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8">è¯¦è§</a>ï¼‰ã€‚è€Œ H5 ç”±äºå®˜æ–¹æœªæ”¯æŒï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ <code>import</code> å¯¼å…¥ã€‚</li>
<li>å®˜æ–¹æä¾›äº†ä¸€ä¸ª React çš„<a href="https://github.com/NervJS/taro/blob/898fbc70f1916f4ab7152633b4c8a14ce9814db8/examples/custom-tabbar-react/src/custom-tab-bar/index.tsx#L7">ç¤ºä¾‹</a>ï¼Œä½¿ç”¨çš„æ˜¯ Class Componentï¼Œå®ƒå¯ä»¥é€šè¿‡ <code>Taro.getTabBar()</code> è·å–ç»„ä»¶å®ä¾‹ï¼Œè¿›è€Œæ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚ä½†åœ¨ H5 ç«¯å¹¶æœªæä¾› <code>Taro.getTabBar()</code> æ–¹æ³•ï¼Œå› æ­¤å®ƒæ— æ³•å…¼å®¹å°ç¨‹åºå’Œ H5 ä¸¤ç«¯ã€‚ä¸‹é¢æˆ‘ç”¨ Functional Component å¹¶ç»Ÿä¸€ç”¨ Taro çš„æ¶ˆæ¯æœºåˆ¶æ¥æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ã€‚</li>
</ul>
<p><code>src/constants/index.js</code> ğŸ‘‡</p>
<pre><code class="language-js">export const IS_H5 = process.env.TARO_ENV === 'h5'

export const ROUTE = {
  INDEX: '/pages/index/index',
  MINE: '/pages/mine/index',
}

export const TAB_BAR_ROUTES = [ROUTE.INDEX, ROUTE.MINE]

export const EVENT_NAME = {
  TAB_BAR_PAGE_VISIBLE: 'tab_bar_page_visible',
}
</code></pre>
<p><code>src/custom-tab-bar/index.jsx</code> ğŸ‘‡</p>
<details><summary>å±•å¼€</summary>
<pre><code class="language-jsx">import { useMemo, useState } from 'react'
import { View, Image } from '@tarojs/components'
import Taro, { eventCenter } from '@tarojs/taro'

import { IS_H5, EVENT_NAME, TAB_BAR_ROUTES } from '@/constants'

import indexIcon from '@/images/icon-index.png'
import indexIconActive from '@/images/icon-index-active.png'
import mineIcon from '@/images/icon-mine.png'
import mineIconActive from '@/images/icon-mine-active.png'

// æ ·å¼æ–‡ä»¶ç¢äºç¯‡å¹…åŸå› ï¼Œå°±ä¸è´´å‡ºæ¥äº†ï¼Œè¯·çœ‹æ–‡æœ«å®Œæ•´ç¤ºä¾‹
import './index.scss'

const tabBarConfig = {
  color: '#7A7E83',
  selectedColor: '#3CC51F',
  backgroundColor: '#F7F7F7',
  borderStyle: 'black',
  list: [
    {
      iconPath: IS_H5 ? indexIcon : '../images/icon-index.png',
      selectedIconPath: IS_H5 ? indexIconActive : '../images/icon-index-active.png',
      pagePath: '/pages/index/index',
      text: 'é¦–é¡µ',
    },
    {
      iconPath: IS_H5 ? mineIcon : '../images/icon-mine.png',
      selectedIconPath: IS_H5 ? mineIconActive : '../images/icon-mine-active.png',
      pagePath: '/pages/mine/index',
      text: 'æˆ‘çš„',
    },
  ],
}

export default function CustomTabBar() {
  const [selected, setSelected] = useState(-1)

  const onChange = (index, url) =&gt; {
    setSelected(index)
    Taro.switchTab({ url })
  }

  const currentRoute = useMemo(() =&gt; {
    const pages = Taro.getCurrentPages()
    const currentPage = pages[pages.length - 1]
    const route = currentPage.route?.split('?')[0]
    return IS_H5 ? route : `/${route}`
  }, [])

  const isTabBarPage = useMemo(() =&gt; {
    return tabBarConfig.list.some(item =&gt; {
      // å¦‚æœ‰åšè·¯ç”±æ˜ å°„ï¼Œæ­¤å¤„å¯èƒ½è¦è°ƒæ•´åˆ¤æ–­æ¡ä»¶
      const matched = TAB_BAR_ROUTES.find(route =&gt; route === currentRoute)
      return matched &amp;&amp; item.pagePath === matched
    })
  }, [currentRoute])

  // ä»¥é¿å…å¤šä½™çš„ç›‘å¬ï¼Œç‰¹åˆ«æ˜¯ rerender æ—¶
  useState(() =&gt; {
    if (!isTabBarPage) return
    eventCenter.on(EVENT_NAME.TAB_BAR_PAGE_VISIBLE, index =&gt; setSelected(index))
  })

  const element = useMemo(() =&gt; {
    if (IS_H5 &amp;&amp; !isTabBarPage) return null

    return (
      &lt;View className=&quot;tab-bar&quot;&gt;
        {tabBarConfig.list.map((item, index) =&gt; (
          &lt;View
            key={item.pagePath}
            className=&quot;tab-bar-item&quot;
            onClick={() =&gt; onChange(index, item.pagePath)}
          &gt;
            &lt;Image
              className=&quot;tab-bar-icon&quot;
              src={selected === index ? item.selectedIconPath : item.iconPath}
            /&gt;
            &lt;View
              className=&quot;tab-bar-text&quot;
              style={{color: selected === index ? tabBarConfig.selectedColor : tabBarConfig.color}}
            &gt;
              {item.text}
            &lt;/View&gt;
          &lt;/View&gt;
        ))}
      &lt;/View&gt;
    )
  }, [selected, isTabBarPage])

  return element
}
</code></pre>
</details>
<p>æŠ½æˆ Hook <code>src/hooks/use-tab-bar.js</code> ğŸ‘‡</p>
<pre><code class="language-js">import Taro, { useDidShow } from '@tarojs/taro'

import { EVENT_NAME } from '@/constants'

export default function useTabBar(selectedIndex) {
  useDidShow(() =&gt; {
    Taro.eventCenter.trigger(EVENT_NAME.TAB_BAR_PAGE_VISIBLE, selectedIndex)
  })
}
</code></pre>
<p>é¡µé¢ä½¿ç”¨ <code>src/pages/index/index.jsx</code> ğŸ‘‡</p>
<pre><code class="language-jsx">import { View, Text } from '@tarojs/components'
import useTabBar from '@/hooks/use-tab-bar'
import './index.scss'

export default function Index() {
  useTabBar(0)

  return (
    &lt;View className=&quot;index&quot;&gt;
      &lt;Text&gt;é¦–é¡µ&lt;/Text&gt;
    &lt;/View&gt;
  )
}
</code></pre>
<p>H5 ç«¯å†…ç½®çš„ TabBar ç»„ä»¶è¿˜æ˜¯ä¼šæ¸²æŸ“çš„ï¼Œè¦é€šè¿‡æ ·å¼æ¥éšè—ã€‚<code>src/app.scss</code> ğŸ‘‡</p>
<pre><code class="language-css">.taro-tabbar__tabbar {
  display: none !important;
}
</code></pre>
<h2>æœ€å</h2>
<p>å®Œæ•´ç¤ºä¾‹ ğŸ‘‰ <a href="https://github.com/toFrankie/taro-custom-tab-bar">taro-custom-tab-bar</a>ã€‚</p>
<p>æœ‰ä¸ªä½“éªŒä¸Šçš„é—®é¢˜ï¼Œè‡ªå®šä¹‰ TabBar åœ¨å„ä¸ª TabBar é¡µé¢åˆå§‹åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶å®ä¾‹å¯¼è‡´ï¼Œå¯¼è‡´åˆ‡æ¢ Tab æ—¶å›¾ç‰‡é—ªçƒï¼Œå¯ä»¥å…³æ³¨ <a href="https://github.com/NervJS/taro/issues/7302">#7302</a>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸€æ¬¡å¼„æ‡‚æ±½è½¦å†…å¾ªç¯ã€å¤–å¾ªç¯ã€A/Cã€é™¤é›¾]]></title>
            <link>https://github.com/toFrankie/blog/issues/330</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/330</guid>
            <pubDate>Sat, 10 Feb 2024 07:27:14 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1712215067979.png" alt=""></p>
<h2>å‰è¨€</h2>
<blockquote>
<p>é¦–å…ˆï¼Œæœ¬äººä¸æ˜¯è€å¸æœºï¼Œå¦‚æœ‰ä¸å¯¹ï¼Œè¯·æŒ‡æ­£ã€‚</p>
<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1712215067979.png" alt=""></p>
<h2>å‰è¨€</h2>
<blockquote>
<p>é¦–å…ˆï¼Œæœ¬äººä¸æ˜¯è€å¸æœºï¼Œå¦‚æœ‰ä¸å¯¹ï¼Œè¯·æŒ‡æ­£ã€‚</p>
</blockquote>
<p>ç”±äºæœ‰äº›ä¸œè¥¿è€æ˜¯è®°ä¸ä½ï¼Œè¿‡åå°±å¿˜ï¼Œäºæ˜¯å€Ÿç€æ•´ç†ä¸‹ï¼Œå°±ä»¥ä¸‹å‡ ä¸ªé—®é¢˜å±•å¼€ä»‹ç»ï¼š</p>
<ul>
<li>ä»€ä¹ˆæ˜¯å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</li>
<li>å¦‚ä½•æ‰“å¼€å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</li>
<li>å¦‚ä½•é€‰æ‹©å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</li>
<li>å†¬å¤©å¼€æš–é£æ—¶ï¼Œè¦ä¸è¦æŒ‰ä¸‹ A/C é”®ï¼Ÿ</li>
<li>å¦‚ä½•é™¤æ¹¿ã€é™¤é›¾ï¼Ÿ</li>
</ul>
<h2>ä»€ä¹ˆæ˜¯å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œã€Œå¾ªç¯ã€å°±æ˜¯ä½¿å¾—ç©ºæ°”æµåŠ¨èµ·æ¥ï¼Œè€Œã€Œå¤–å¾ªç¯ã€å’Œã€Œå†…å¾ªç¯ã€çš„åŒºåˆ«åœ¨äºç©ºæ°”çš„æ¥æºã€‚</p>
<ul>
<li>å¤–å¾ªç¯ - ç©ºæ°”æ¥è‡ªè½¦å¤–ã€‚</li>
<li>å†…å¾ªç¯ - ç©ºæ°”æ¥è‡ªè½¦å†…ã€‚</li>
</ul>
<h3>å¤–å¾ªç¯</h3>
<p>å¤–å¾ªç¯çš„ä½œç”¨æ˜¯å°†è½¦å¤–çš„ç©ºæ°”é€åˆ°è½¦å†…ã€‚å½“å¼€å¯å¤–å¾ªç¯åï¼Œæ„å‘³ç€æ‰“å¼€äº†è½¦å†…å¤–çš„æ°”æµé€šé“ï¼Œå¯ä»¥æœ‰æ•ˆä¿æŒè½¦å†…ç©ºæ°”æ¸…æ–°ã€‚å› æ­¤ï¼Œå¦‚æœè½¦å¤–ç©ºæ°”æ¡ä»¶ä¸ä½³ï¼ˆæ¯”å¦‚å¼‚å‘³ã€é›¾éœ¾ã€æ‰¬å°˜ã€é“è·¯æ‹¥å µè½¦è¾†å°¾æ°”ä¸¥é‡ï¼‰ï¼Œåº”è¯¥å…³é—­å¤–å¾ªç¯ï¼Œåˆ‡æ¢è‡³å†…å¾ªç¯ã€‚</p>
<h3>å†…å¾ªç¯</h3>
<p>å†…å¾ªç¯åˆ™ç›¸åã€‚å½“å¼€å¯å†…å¾ªç¯ï¼Œæ„å‘³ç€å…³é—­äº†è½¦å†…å¤–çš„æ°”æµé€šé“ï¼Œä¸å¼€é£æœºå°±æ²¡æœ‰æ°”æµå¾ªç¯ï¼Œå¼€é£æœºæ—¶å¸å…¥çš„æ°”æµä¹Ÿä»…æ¥è‡ªè½¦å†…ï¼Œå½¢æˆè½¦è¾†å†…éƒ¨çš„æ°”æµå¾ªç¯ã€‚ä½œç”¨æ˜¯åŠæ—¶æœ‰æ•ˆåœ°é˜»æ­¢å¤–éƒ¨çš„ç°å°˜å’Œæœ‰å®³æ°”ä½“è¿›å…¥è½¦å†…ã€‚</p>
<p>å¦‚æœç”¨äººç±»çš„å‘¼å¸æ¥æ¯”å–»ï¼Œå°±æ˜¯ï¼š</p>
<ul>
<li>å¤–å¾ªç¯ - æ­£å¸¸å¸æ°”ã€å‘¼æ°”ã€‚</li>
<li>å†…å¾ªç¯ - æ†‹æ°”æ—¶çš„å†…å‘¼å¸ã€‚</li>
</ul>
<p>å¤–å¾ªç¯å°±æ˜¯å‘¼å¸å¤–é¢çš„æ–°é²œç©ºæ°”ã€‚å½“æˆ‘ä»¬é‡åˆ°å¼‚å‘³æ—¶ï¼Œè‡ªç„¶åœ°å°±ä¼šå±ä½å‘¼å¸ï¼Œä½†æ†‹ä¹…äº†ä¼šä¸èˆ’æœï¼Œå› ä¸ºæ°§æ°”ä¸è¶³äº†ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¤–å¾ªç¯è¡¥å……ç©ºæ°”ã€‚åè½¦ä¹Ÿæ˜¯åŒç†çš„ï¼Œå†…å¾ªç¯å¼€ä¹…ä¹‹åï¼Œä¹˜è½¦äººå¸æ”¶æ°§æ°”ï¼Œå‘¼å‡ºäºŒæ°§åŒ–ç¢³ï¼Œå¯¼è‡´è½¦å†…æ°§æ°”ä¸è¶³ï¼Œè¿™æ—¶éœ€è¦å¼€å¯å¤–å¾ªç¯ï¼Œå°†è½¦å¤–çš„ç©ºæ°”å¾€è½¦å†…è¾“é€ï¼Œä»¥é¿å…å¸æœºã€ä¹˜è½¦äººæ„Ÿåˆ°ä¸é€‚ã€‚</p>
<p>ä¹Ÿå¯ä»¥æŠŠè½¦å†…ç¯å¢ƒå½“åšä¸€ä¸ªæˆ¿é—´ï¼Œæ‰“å¼€çª—å£ç›¸å½“äºå¤–å¾ªç¯ï¼Œå…³é—­çª—æˆ·å°±æ˜¯å†…å¾ªç¯ã€‚</p>
<h2>å¦‚ä½•æ‰“å¼€å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</h2>
<p>å†…å¾ªç¯ã€å¤–å¾ªç¯æ¨¡å¼åªèƒ½æ‰“å¼€å…¶ä¸€ï¼Œä¸å¯åŒæ—¶æ‰“å¼€ã€‚</p>
<p>å¦‚ä½•åˆ¤æ–­æ‰“å¼€äº†å“ªç§æ¨¡å¼ï¼š</p>
<ul>
<li>æœ‰äº›è½¦ï¼Œå†…å¾ªç¯å’Œå¤–å¾ªç¯éƒ½æœ‰ç‹¬ç«‹çš„æŒ‰é’®ï¼Œå“ªä¸ªç¯äº®è¡¨ç¤ºæ‰“å¼€å“ªä¸ªæ¨¡å¼ã€‚(ä¸‹å›¾ä¸€)</li>
<li>æœ‰äº›è½¦ï¼Œåªæœ‰ä¸€ä¸ªå†…å¾ªç¯æŒ‰é’®ï¼Œç¯äº®è¡¨ç¤ºä½¿ç”¨å†…å¾ªç¯æ¨¡å¼ï¼Œç¯ç­åˆ™è¡¨ç¤ºä½¿ç”¨å¤–å¾ªç¯æ¨¡å¼ã€‚ï¼ˆä¸‹å›¾äºŒï¼‰</li>
</ul>
<p>æ¯è¾†è½¦å¤–å¾ªç¯ã€å†…å¾ªç¯çš„æŒ‰é’®å¯èƒ½éƒ½é•¿å¾—ä¸å¤ªä¸€æ ·ï¼ˆä½†å½¢çŠ¶åº”è¯¥æ˜¯ç±»ä¼¼çš„ï¼‰ã€‚</p>
<ul>
<li>å¤–å¾ªåº - ç®­å¤´ä»è½¦å¤–è´¯ç©¿åˆ°è½¦å†…</li>
<li>å†…å¾ªç¯ - ç®­å¤´å§‹ç»ˆåœ¨è½¦å†… ğŸ”</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1707564830636.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1707564554073.png" alt=""></p>
<h2>å¦‚ä½•é€‰æ‹©å†…å¾ªç¯ã€å¤–å¾ªç¯ï¼Ÿ</h2>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¦–é€‰å¤–å¾ªç¯ã€‚è‹¥è¦ç”¨å†…å¾ªç¯ï¼ˆæ¯”å¦‚å¤å¤©åˆ¶å†·ï¼‰ï¼Œä¸èƒ½é•¿æ—¶é—´å•ä¸€ä½¿ç”¨å†…å¾ªç¯ï¼Œåº”ä¸å¤–å¾ªç¯äº¤æ›¿ä½¿ç”¨ï¼Œé¿å…è½¦å†…æ°§æ°”ä¸è¶³ï¼Œå¯¼è‡´ä¸€æ°§åŒ–ç¢³ä¸­æ¯’ç­‰æƒ…å†µã€‚</p>
<p>ä½¿ç”¨å¤–å¾ªç¯çš„åœºæ™¯ï¼š</p>
<ul>
<li><strong>åœ¨è½¦å†…ã€Œé•¿æ—¶é—´ä¼‘æ¯ã€æˆ–ã€Œç¡è§‰ã€ï¼Œä¸€å®šè¦ä½¿ç”¨å¤–å¾ªç¯ï¼Œé¿å…é€ æˆçª’æ¯ç­‰æƒ…å†µã€‚</strong></li>
<li><strong>é•¿æ—¶é—´ä½¿ç”¨å†…å¾ªç¯ï¼Œå¯¼è‡´è½¦å†…å¤ªé—·æˆ–æ°§æ°”ä¸è¶³ï¼Œåº”å†…å¤–å¾ªç¯äº¤æ›¿ä½¿ç”¨ã€‚</strong></li>
<li>æ–°è½¦æœ‰å¼‚å‘³ï¼Œå¯ä»¥ç¼“è§£è½¦å†…å¼‚å‘³ã€‚</li>
<li>è·‘é«˜é€Ÿæ¢æ°”ï¼Œä»£æ›¿å¼€çª—æ–¹å¼ï¼Œåè€…é£é˜»å¤§è€—æ²¹ã€‚</li>
</ul>
<p>ä½¿ç”¨å†…å¾ªç¯çš„åœºæ™¯ï¼ˆ<strong>æ³¨æ„ä¸å¤–å¾ªç¯äº¤æ›¿ä½¿ç”¨</strong>ï¼‰ï¼š</p>
<ul>
<li>è½¦å¤–ç©ºæ°”è´¨é‡ä¸ä½³ï¼Œæ¯”å¦‚é“è·¯æ‹¥å µæ±½è½¦å°¾æ°”ä¸¥é‡ã€é›¾éœ¾ã€å¼‚å‘³ã€æœ‰å®³æ°”ä½“ç­‰ã€‚</li>
<li>å¤å¤©åˆ¶å†·ï¼ˆä¼‘æ¯æˆ–ç¡è§‰åº”ä½¿ç”¨å¤–å¾ªç¯ï¼‰ã€‚å¤–å¾ªç¯ä¼šå¸¦å…¥è½¦å¤–é«˜æ¸©ç©ºæ°”ï¼Œåˆ¶å†·æ•ˆæœå¯èƒ½ä¼šå·®ä¸€äº›ï¼ŒåŒæ—¶ä¼šå¸¦æ¥æ›´å¤šèƒ½è€—ã€‚</li>
</ul>
<h2>å†¬å¤©å¼€æš–é£æ—¶ï¼Œè¦ä¸è¦æŒ‰ä¸‹ A/C é”®ï¼Ÿ</h2>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå¤§è‡´äº†è§£ä¸‹æ±½è½¦ç©ºè°ƒç³»ç»Ÿã€‚</p>
<p>æ±½è½¦ç©ºè°ƒç³»ç»Ÿï¼Œç”±åˆ¶å†·ç³»ç»Ÿã€ä¾›æš–ç³»ç»Ÿã€é€šé£ç³»ç»Ÿã€ç©ºæ°”å‡€åŒ–ç³»ç»Ÿä»¥åŠæ§åˆ¶ç³»ç»Ÿç»„æˆï¼Œå¯ä»¥è°ƒèŠ‚æ¸©åº¦ã€æ¹¿åº¦ã€æ°”æµç­‰ã€‚å®ƒçš„ä½œç”¨ä¸ä»…ä»…æ˜¯åˆ¶å†·ã€ä¾›æš–ã€‚</p>
<p>ä»¥ä¼ ç»Ÿç‡ƒæ²¹æ±½è½¦ä¸ºä¾‹ã€‚</p>
<h3>åˆ¶å†·ç³»ç»Ÿ</h3>
<p>åˆ¶å†·ç³»ç»Ÿï¼Œç”±ç©ºè°ƒå‹ç¼©æœºã€å†·å‡å™¨ã€å‚¨æ¶²å¹²ç‡¥å™¨ã€è†¨èƒ€é˜€ã€è’¸å‘å™¨ã€ç©ºè°ƒç®¡è·¯ä»¥åŠåˆ¶å†·å‰‚ç­‰ç»„æˆã€‚</p>
<p>åˆ¶å†·è¿‡ç¨‹ï¼š</p>
<ol>
<li>åŠ å‹è¿‡ç¨‹ï¼šå‹ç¼©æœºå°†ä½å‹ç«¯çš„æ°”æ€å†·åª’åŠ å‹ä½¿ä¹‹æˆä¸ºé«˜å‹æ°”æ€å†·åª’ã€‚</li>
<li>æ¶²åŒ–ï¼ˆæ”¾çƒ­ï¼‰ï¼šç»è¿‡å†·å‡å™¨å¯¹åŠ å‹åçš„æ°”æ€å†·åª’é€šè¿‡æ•£çƒ­é£æ‰‡è¿›è¡Œé™æ¸©ï¼ˆé™æ¸©è¿‡ç¨‹ï¼‰ä½¿ä¹‹æˆä¸ºä¸­æ¸©é«˜å‹æ¶²ä½“å†·åª’ã€‚</li>
<li>è¿‡æ»¤èŠ‚æµï¼šå†ç»ç®¡é“æµåˆ°å‚¨æ¶²å¹²ç‡¥å™¨å¯¹ä¸­æ¸©é«˜å‹æ¶²æ€å†·åª’è¿›è¡Œè¿‡æ»¤ï¼Œæ»¤å‡ºå…¶ä¸­çš„æ°´åˆ†ä¸æ‚è´¨ï¼Œé¡ºå¸¦å¯¹ä¸­æ¸©é«˜å‹æ¶²æ€å†·åª’è¿›è¡ŒèŠ‚æµï¼Œä½¿ä¹‹æˆä¸ºå¹²å‡€ç¨³å®šçš„æ¶²æ€å†·åª’ã€‚</li>
<li>æ±½åŒ–ï¼ˆå¸çƒ­ï¼‰ï¼šä¸­æ¸©é«˜å‹æ¶²æ€å†·åª’å†ç»ç®¡é“æµå‘è†¨èƒ€é˜€ï¼Œè†¨èƒ€é˜€å°±ç›¸å½“äºä¸€ä¸ªå–·å˜´ï¼ŒæŠŠä¸­æ¸©é«˜å‹æ¶²æ€å†·åª’å–·æˆéå¸¸ç»†å°çš„é›¾ç ï¼ˆä½æ¸©ä½å‹æ°”æ€å†·åª’ï¼‰ï¼ˆç±»ä¼¼äºæ±½è½¦å–·æ²¹å˜´ï¼‰å–·å…¥è’¸å‘å™¨ã€‚</li>
<li>è’¸å‘å™¨å†…çš„ä½å‹æ°”æ€å†·åª’åˆç»ä½å‹ç®¡é“å¸å…¥å‹ç¼©æœºï¼Œè¿›è¡Œä¸€ä¸ªä¸ªå¾ªç¯ã€‚</li>
</ol>
<p><strong>åˆ¶å†·è¿‡ç¨‹éœ€è¦å‹ç¼©æœºä¸€ç›´å·¥ä½œï¼Œå¤§éƒ¨åˆ†æ±½è½¦ç©ºè°ƒå‹ç¼©æœºæ˜¯ç”±å‘åŠ¨æœºé©±åŠ¨çš„ï¼Œå› æ­¤åˆ¶å†·æ˜¯ä¼šå¢åŠ è€—æ²¹çš„ã€‚å…¶ä¸­ A/C é”®ç”¨äºæ§åˆ¶å‹ç¼©æœºæ˜¯å¦å·¥ä½œï¼Œå› æ­¤åˆ¶å†·æ—¶ä¼šæ‰“å¼€å®ƒã€‚</strong></p>
<h3>ä¾›æš–ç³»ç»Ÿ</h3>
<p>ä¾›æš–ç³»ç»Ÿï¼Œç”±çƒ­äº¤æ¢å™¨ã€å†·å´æ¶²ç®¡è·¯åŠé¼“é£æœºã€å¯¼é£ç®¡ã€ä¸‹é£é“åŠæ§åˆ¶æœºæ„ç­‰ç»„æˆã€‚</p>
<p>ä»¥æ°´æš–å¼ä¾›æš–ä¸ºä¾‹ã€‚å‘åŠ¨æœºå·¥ä½œæ—¶ï¼Œè¢«å‘åŠ¨æœºæ°”ç¼¸ç‡ƒçƒ§é«˜æ¸©åŠ çƒ­çš„å†·å´æ¶²åœ¨å‘åŠ¨æœºå†·å´ç³»ç»Ÿæ°´æ³µçš„ä½œç”¨ä¸‹ï¼Œç»è¿›æ°´ç®¡è¿›å…¥çƒ­äº¤æ¢å™¨ï¼Œé€šè¿‡é¼“é£æœºå¹å‡ºçš„ç©ºæ°”å°†å†·å´æ¶²æ•£å‘å‡ºçš„çƒ­é‡é€åˆ°è½¦å¢å†…æˆ–é£çª—ç»ç’ƒï¼Œç”¨ä»¥æé«˜è½¦å¢å†…æ¸©åº¦å’Œé™¤éœœã€‚åœ¨çƒ­äº¤æ¢å™¨ä¸­è¿›è¡Œäº†æ•£çƒ­è¿‡ç¨‹çš„å†·å´æ¶²ç»å›æ°´ç®¡è¢«æ°´æ³µæŠ½å›ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œå®ç°æš–é£ä¾›çƒ­ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œä¾›æš–å°±æ˜¯åˆ©ç”¨äº†å‘åŠ¨æœºçš„å·¥ä½œæ—¶çš„äº§ç”Ÿçš„çƒ­é‡ï¼Œä¸è€—æ²¹ï¼ˆæˆ–è€…è¯´å…¶æ²¹è€—å¯ä»¥å¿½ç•¥ä¸è®¡ï¼‰ã€‚</p>
<p><strong>ä¾›æš–è¿‡ç¨‹ä¸éœ€è¦å‹ç¼©æœºå·¥ä½œï¼Œå› æ­¤å†¬å¤©åˆ¶æš–æ— éœ€æ‰“å¼€ A/C é”®ã€‚</strong></p>
<h3>A/C é”®</h3>
<p>A/C æ˜¯ Air Conditioning ç¼©å†™ï¼Œæ˜¯ç©ºæ°”è°ƒèŠ‚çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ç©ºè°ƒã€‚A/C é”®çš„ä½œç”¨æ˜¯æ§åˆ¶å‹ç¼©æœºå·¥ä½œï¼Œåœ¨åˆ¶å†·æ—¶æ‰“å¼€ã€‚</p>
<p>ç©ºè°ƒæœ‰åˆ¶å†·å’Œä¾›æš–é‡Œä¸¤ç§æ–¹å¼ï¼Œç”±äºä¾›æš–æ˜¯åˆ©ç”¨å‘åŠ¨æœºäº§ç”Ÿçš„çƒ­é‡ï¼Œä¸éœ€è¦å‹ç¼©æœºå·¥ä½œï¼Œæ‰€ä»¥ A/C é”®åªæœ‰ä¸€é¡¹åŠŸèƒ½ï¼Œç”¨äºåˆ¶å†·ã€‚</p>
<p>æŒ‰ä¸‹ A/C é”®ç¯äº®ï¼Œå‹ç¼©æœºå¼€å§‹å·¥ä½œï¼Œä¼šå¯¼è‡´æ²¹è€—å¢å¤§ã€å™ªéŸ³å˜å¤§ã€‚å½“ A/C ç¯ç­ï¼Œåªæ˜¯é€é£ï¼Œåªèƒ½åˆ©ç”¨å¤–ç•Œç©ºæ°”å’Œå‘åŠ¨æœºçƒ­é‡è°ƒè§£æ¸©åº¦ï¼Œä¹Ÿå°±æ˜¯åªèƒ½å‡æ¸©ä¸èƒ½é™æ¸©ã€‚æ¸©åº¦è¾ƒé«˜éœ€è¦é™æ¸©æ—¶ï¼Œåªæœ‰æ‰“å¼€ A/C æ‰èƒ½èµ·ä½œç”¨ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜èƒ½é™ä½ç©ºæ°”æ¹¿åº¦è¾¾åˆ°é™¤é›¾çš„æ•ˆæœã€‚</p>
<h2>å¦‚ä½•é™¤é›¾ï¼Ÿ</h2>
<h3>èµ·é›¾åŸå› </h3>
<p>ç©ºæ°”ä¸­çš„æ°´è’¸æ°”ï¼ˆç¯å¢ƒç©ºæ°”æ¹¿åº¦åˆ°è¾¾ä¸€å®šé¥±å’ŒçŠ¶æ€ï¼‰é‡åˆ°å†°å†·çš„æŒ¡é£ç»ç’ƒæ¶²åŒ–å½¢æˆå°æ°´ç é™„ç€åœ¨ç»ç’ƒä¸Šï¼Œè¿›è€Œå½±å“è§†é‡ã€‚</p>
<p>ä¸¤ä¸ªä¸»è¦å› ç´ ï¼š</p>
<ul>
<li>ç©ºæ°”æ¹¿åº¦å¤§</li>
<li>ç©ºæ°”ä¸ç»ç’ƒæ¸©å·®å¤§</li>
</ul>
<blockquote>
<p>ç©ºæ°”æ¹¿åº¦è·Ÿåœ°ç†ä½ç½®ä¹Ÿæœ‰å…³ç³»ï¼Œå—æ–¹æ¹¿åº¦è¾ƒå¤§ï¼ŒåŒ—æ–¹åˆ™æ¯”è¾ƒå¹²ç‡¥ã€‚åœ¨åŒ—æ–¹çš„å†¬å¤©ï¼Œå°±ç®—åŠ ä¸Šä¹˜è½¦äººå‘¼å¸å¸¦æ¥çš„æ¹¿åº¦å¢åŠ ä¹Ÿä¸ä¸€å®šèƒ½è¾¾åˆ°ä¸´ç•Œé¥±å’ŒçŠ¶æ€ï¼Œæ‰€ä»¥æ— æ³•å½¢æˆæ°´ç ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨å—æ–¹å¤å¤©è¡Œè½¦æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¼€å†·é£ï¼Œå³ä¾¿è½¦å†…æŒ¡é£ç»ç’ƒä¸è½¦å†…æ¸©å·®å¤§ï¼Œå¯ä¸ä¸€å®šå½¢æˆé›¾ã€‚å…¶åŸå› æ˜¯æŒ‰ä¸‹ A/C é”®åˆ¶å†·ï¼ˆå®ƒæœ‰ä¸€é¡¹åŠŸèƒ½æ˜¯å»æ¹¿ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¼šé™ä½è½¦å†…ç©ºæ°”æ¹¿åº¦ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹è¿™äº›éƒ½ä¼šå½±å“ç©ºæ°”æ¹¿åº¦ï¼š</p>
<ul>
<li>å¤å¤©ä¸‹é›¨å‰ï¼ˆå—æ–¹æ›´æ˜æ˜¾ï¼‰</li>
<li>å‘¼æ°”</li>
<li>åœ¨è½¦ä¸Šå–çƒ­æ°´ã€çƒ­é¥®ç­‰</li>
<li>...</li>
</ul>
<h3>èµ·é›¾ä½ç½®</h3>
<p>æ ¹æ®èµ·é›¾ä½ç½®åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>è½¦å¤–æŒ¡é£ç»ç’ƒèµ·é›¾</li>
<li>è½¦å†…æŒ¡é£ç»ç’ƒèµ·é›¾</li>
</ul>
<p>å¤–éƒ¨æŒ¡é£ç»ç’ƒèµ·é›¾çš„è¯ï¼Œä½¿ç”¨é›¨åˆ®å™¨å³å¯ã€‚é€šå¸¸æ˜¯å¤å¤©ä¸‹é›¨ä¹‹å‰ä¼šå‘ç”Ÿï¼Œä¸‹é›¨ä¹‹å‰ï¼Œè½¦å¤–ç©ºæ°”æ¹¿åº¦å¤§ï¼Œè½¦å†…ç©ºè°ƒå¼€å¾—ä½ï¼Œå¯¼è‡´è½¦å†…å¤–æ¸©å·®å¤§ï¼Œç©ºæ°”æ¥è§¦ç»ç’ƒæ¶²åŒ–å½¢æˆé›¾ã€‚</p>
<h3>è½¦å†…æŒ¡é£ç»ç’ƒé™¤é›¾</h3>
<p>è½¦å†…èµ·é›¾ä¸»è¦å‘ç”Ÿåœ¨å†¬å¤©ï¼Œä¸€æ˜¯ç¯å¢ƒç©ºæ°”æ¹¿åº¦æœ¬èº«å°±å¾ˆå¤§ï¼ŒäºŒæ˜¯ä¹˜è½¦äººå‘¼å¸ä½¿å¾—è½¦å†…æ¹¿åº¦å¢åŠ ï¼Œè¿™æ˜¯ä¸»è¦åŸå› ã€‚é™¤é›¾æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚</p>
<h4>æ‰‹åŠ¨æ“¦æ‹­ï¼ˆä¸æ¨èï¼‰</h4>
<p>æœ€ç®€å•çš„æ–¹æ³•ã€‚ä½†åªèƒ½åœ¨è¡Œè½¦å‰æ“¦æ‹­ï¼Œè¡Œè½¦è¿‡ç¨‹ä¸­æ— æ³•è¿›è¡Œï¼Œè€Œä¸”å½±å“é©¾é©¶ï¼Œå¾ˆå±é™©ï¼</p>
<h4>å–·é˜²é›¾å‰‚</h4>
<p>ç½‘ä¸Šå¾ˆå¤šã€‚åŸç†å¾ˆç®€å•ï¼Œé˜²é›¾å‰‚çš„æˆåˆ†å¤šæ˜¯æ´»æ€§å‰‚ï¼Œå¯ç ´åæ°´çš„è¡¨é¢å¼ åŠ›ï¼Œå½“ç©ºæ°”é‡åˆ°å†°å†·çš„æŒ¡é£ç»ç’ƒï¼Œä¼šå˜æˆä¸€å±‚è–„è–„çš„æ°´é™„ç€åœ¨ç»ç’ƒä¸Šï¼Œç”±äºæ°´åˆ†å¸ƒå‡åŒ€ï¼Œä¸ä¼šå¯¹è§†é‡äº§ç”Ÿå¤ªå¤§å½±å“ã€‚</p>
<blockquote>
<p>åœ¨æ¸©åº¦ä½çš„ç¯å¢ƒï¼Œè¿™å±‚è–„è–„çš„æ°´å®¹æ˜“ç»“å†°ã€‚</p>
</blockquote>
<blockquote>
<p>å¬è¯´ç”¨çº¯æ´—æ´ç²¾ï¼ˆä¸å…‘æ°´ï¼‰ä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼æ•ˆæœï¼Œæ²¡å°è¯•è¿‡ã€‚</p>
</blockquote>
<h4>å¼€æš–é£ + å¤–å¾ªç¯</h4>
<p>è¿™ç§æƒ…å†µé€‚åˆç¯å¢ƒç©ºæ°”æ¹¿åº¦å¾ˆä½ï¼Œå¾ˆå¹²ç‡¥çš„å¤©æ°”ä½¿ç”¨ï¼Œæ¯”å¦‚åŒ—æ–¹å¯’å†·è€Œå¹²ç‡¥çš„å†¬å¤©ã€‚</p>
<p>å¼€æš–é£çš„ç›®çš„ï¼š</p>
<ul>
<li>å¢åŠ ç©ºæ°”æµåŠ¨é€Ÿåº¦ï¼Œè®©æ°´åˆ†å¿«é€Ÿè’¸å‘ã€‚</li>
<li>æé«˜æ¸©åº¦åŠ é€Ÿæ°´åˆ†è’¸å‘ã€‚</li>
</ul>
<p>å¼€å¤–å¾ªç¯çš„ç›®çš„ï¼š</p>
<ul>
<li>å¼•å…¥è½¦å¤–æ¹¿åº¦è¾ƒä½çš„ç©ºæ°”ï¼ŒåŠ å¿«æ°´åˆ†è’¸å‘ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œç©ºæ°”æ¹¿åº¦è¶Šå°ã€è¶Šå¹²ç‡¥ï¼Œé™¤é›¾æ•ˆæœè¶Šå¥½ã€‚</p>
<h4>å¼€åˆ¶å†· + å¤–å¾ªç¯</h4>
<p>è¿™ç§æƒ…å†µé€‚åˆå¤æœ«ç§‹åˆçš„ä¸‹é›¨å¤©ï¼Œè¿™ç§å¤©æ°”ç©ºæ°”æ¹¿åº¦éå¸¸å¤§ï¼Œå¦‚æœå¼€æš–é£é™¤é›¾ï¼Œæ¹¿çƒ­çš„ç©ºæ°”è¢«æš–é£åŠ å…¥åå°±åƒå¯¹ç€æŒ¡é£ç»ç’ƒå“ˆæ°”ï¼Œä¸ä½†ä¸èƒ½é™¤é›¾ï¼Œåè€Œè®©æŒ¡é£ç»ç’ƒæ›´æ¨¡ç³Šã€‚</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯å¼€ç©ºè°ƒï¼Œå®ƒå¯ä»¥é™ä½ç©ºæ°”æ¹¿åº¦ï¼Œå½“å¹²ç‡¥çš„ç©ºæ°”å¹å‘æŒ¡é£ç»ç’ƒï¼Œå¯ä»¥åŠ é€Ÿæ°´åˆ†è’¸å‘ã€‚</p>
<h4>å¿«é€Ÿé™¤é›¾</h4>
<p>å¾ˆå¤šè½¦éƒ½å¸¦æœ‰é™¤é›¾åŠŸèƒ½ï¼Œæ‰‡å½¢ + ä¸‰æ¡æ³¢æµªçº¿çš„æ˜¯å‰æŒ¡é£ç»ç’ƒé™¤é›¾æ ‡å¿—ã€‚é•¿æ–¹å½¢ + ä¸‰æ¡æ³¢æµªçº¿çš„æ˜¯åæŒ¡é£ç»ç’ƒé™¤é›¾æ ‡å¿—ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/4/1712217204100.png" alt=""></p>
<!--

## other

æ±½è½¦é¼“é£æœºæ˜¯æ±½è½¦ç©ºè°ƒç³»ç»Ÿä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡é¼“é£æœºå°†ç©ºæ°”å¼•å…¥è½¦å†…ï¼Œå®ç°ç©ºæ°”å¾ªç¯å’Œæ¸©åº¦è°ƒèŠ‚ã€‚


## è§‚ç‚¹
æš–é£æŒ¡+æ‰“å¼€A/Cå¼€å…³çš„æ—¶å€™=å¹²ç‡¥çš„æš–é£ ç”¨å¤„ï¼šåˆšåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œå»ºè®®æ‰“å¼€A/Cå¼€å…³ï¼Œç›®çš„æ˜¯é€šè¿‡å‹ç¼©æœºæ¥ä¸ºè½¦å†…é™¤æ¹¿ï¼Œé™ä½æ¹¿åº¦ï¼Œä¸ºç»ç’ƒé™¤é›¾ï¼Œå¦‚æœç­‰è½¦å†…æ¸©åº¦æ’å®šä»¥åå°±å¯ä»¥å…³é—­A/Cã€‚ è€Œä¸”è¦è¯´æ˜çš„æ˜¯ï¼Œå³ä½¿æ‰“å¼€äº†A/Cå¼€å…³ï¼Œå¹¶ä¸æ˜¯ä»£è¡¨å‹ç¼©æœºä¸€å®šæ˜¯å¹å‡ºæ¥çš„æ˜¯å†·é£ï¼Œå¦‚æœæŠŠç©ºè°ƒè°ƒåˆ°æš–é£æŒ¡å¹å‡ºæ¥çš„å°±æ˜¯æš–é£ã€‚ ä½†æš–é£é™¤é›¾æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è½¦çª—ä¼šå…ˆç•¥å¾®èµ·é›¾ï¼Œç„¶åé›¾æ°”æ‰èƒ½æ•£å¼€ï¼Œæ‰€ä»¥åœ¨è½¦è¾†å¼€å§‹è¡Œé©¶å‰ä¸€å®šè¦é™¤é›¾å®Œæˆäº†å†é©¾é©¶ã€‚ å†…å¾ªç¯è¿˜æ˜¯å¤–å¾ªç¯ï¼Ÿ å…¶å®è¿™ä¸ªè·Ÿå†·é£æš–é£å…¶å®æ²¡æœ‰å…³ç³»çš„ï¼Œå¤§å®¶å¾€å¾€è§‰å¾—è½¦å¤–æ¸©åº¦ä½ï¼Œè½¦å†…æ¸©åº¦é«˜ï¼Œå¦‚æœæ‰“å¼€äº†å¤–å¾ªç¯æ˜¯ä¸æ˜¯å°±å¢åŠ èƒ½è€—äº†ï¼Ÿ å…¶å®ä¸æ˜¯çš„ï¼Œè½¦å†…çš„æš–é£ä¸åŒäºå†·é£æ¥è‡ªäºå‹ç¼©æœºï¼Œè€Œæš–é£åˆ™æ˜¯æ¥è‡ªäºè½¦å†…æ°´ç®±çš„æ¸©åº¦ï¼Œè¿™æ ·å°±æ˜¯ä¸ºä»€ä¹ˆè½¦è¾†åˆšåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œå³ä½¿æ‰“å¼€äº†æš–é£ï¼Œè½¦å†…æ¸©åº¦ä¹Ÿä¸Šä¸æ¥çš„åŸå› äº†ã€‚ç­‰åˆ°è½¦è¾†è¡Œé©¶å‡ åˆ†é’Ÿåï¼Œæ°´ç®±æ¸©åº¦è¾¾åˆ°äº†æ­£å¸¸æ°´æ¸©ï¼Œè½¦å†…ç©ºè°ƒçš„å‡ºé£å£å¹çš„å°±æ˜¯æš–é£äº†ã€‚ å› æ­¤ï¼Œå†…å¾ªç¯å’Œå¤–å¾ªç¯ä¸»è¦å–å†³äºå¤©æ°”ï¼Œå¦‚æœå¤©æ°”è´¨é‡è‰¯å¥½çš„æ—¶å€™ï¼Œå®Œå…¨å¯ä»¥æ‰“å¼€å¤–å¾ªç¯ï¼Œè¿™æ ·è®©æ–°é²œç©ºæ°”æµåŠ¨è¿›æ¥ï¼Œä¹Ÿé˜²æ­¢å¼€è½¦çš„æ—¶å€™æ‰“çŒç¡ï¼Œå¦‚æœç©ºæ°”è´¨é‡å·®ï¼Œå»ºè®®å°±è¦é€‰æ‹©å†…å¾ªç¯äº†ã€‚

ä½œè€…ï¼šæ‡‚è½¦å¤©å¤©ç­”
é“¾æ¥ï¼šhttps://www.zhihu.com/question/404338951/answer/2277806863
æ¥æºï¼šçŸ¥ä¹
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

## å¼€ç©ºè°ƒ

ç©ºè°ƒçš„æŒ‰é”®æœ‰å¥½å‡ ä¸ªï¼Œæƒ³è¦æ‰“å¼€ç©ºè°ƒï¼Œå¿…é¡»æ‰“å¼€é£é‡æ—‹é’®ï¼Œç„¶åæŒ‰ä¸‹ACå¼€å…³æ‰èƒ½åˆ¶å†·ã€‚

## å¤å¤©ç”¨é—´æ­‡ä½¿ç”¨â€œACâ€é”®

åœ¨å¤å­£ï¼Œé…·æš‘éš¾è€ï¼Œå¦‚æœä½ çœŸçš„æƒ³å¼€ç©ºè°ƒï¼Œé™ä½æ¸©åº¦ï¼Œç„¶åæŒ‰â€œACâ€é”®ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¼€å†·ç©ºè°ƒä¸€æ®µæ—¶é—´åï¼Œè½¦å†…æ¸©åº¦ä¼šå¾ˆå¿«é™ä¸‹æ¥ï¼Œç”šè‡³ä»–ä»¬æ— æ³•å¿å—å¯’å†·ã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çš„è®¸å¤šæœ‹å‹çš„åšæ³•æ˜¯é€‚å½“æé«˜æ¸©åº¦ã€‚

äº‹å®ä¸Šï¼Œæœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ï¼Œé‚£å°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ä¸ºâ€œACâ€é”®è¿”å›ï¼Œè®©é£æ¸©åº¦è‡ªç„¶æ¢å¤æ…¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç”±äºæœ€ä½æ¸©åº¦æ˜¯å…³é”®æœ¬èº«å°±æ˜¯çˆ½ï¼ŒåŠ ä¸Šå‰©ä¸‹çš„æ•ˆæœå†·å´çš„ï¼Œèƒ½æœ‰æ•ˆåœ°ä½¿è½¦è¾†å†…éƒ¨çš„æ¸©åº¦ç»´æŒåœ¨åˆé€‚çš„æ¸©åº¦ä¸‹ç›¸å½“é•¿çš„æ—¶é—´ã€‚å½“è½¦å†…æ¸©åº¦ä¸Šå‡è‡³è§‰å¾—æœ‰ç‚¹çƒ­ï¼Œç„¶åæŒ‰ä¸‹â€œACâ€é”®ï¼Œè½¦å†…æ¸©åº¦ä¸‹é™ã€‚
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[perspective æ»šåŠ¨è·ç¦»è®¡ç®—]]></title>
            <link>https://github.com/toFrankie/blog/issues/329</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/329</guid>
            <pubDate>Wed, 07 Feb 2024 09:41:01 GMT</pubDate>
            <description><![CDATA[<p>å‡è®¾æœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;section style=&quot;width: 100%; max-width: 100%; perspective: 100px; perspective-origin: top center; overf]]></description>
            <content:encoded><![CDATA[<p>å‡è®¾æœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;section style=&quot;width: 100%; max-width: 100%; perspective: 100px; perspective-origin: top center; overflow-x: scroll; overflow-y: hidden; -webkit-overflow-scrolling: touch; background: #eee&quot;&gt;
  &lt;section style=&quot;height: 0; transform: scale(1) translate3d(0, 0, 0)&quot;&gt;
    &lt;section style=&quot;display: flex; align-items: center; width: 400%; max-width: none !important&quot;&gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;flex: 1&quot;&gt;
        &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; stroke=&quot;#f00&quot; stroke-width=&quot;2&quot;&gt;&lt;/rect&gt;
      &lt;/svg&gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;flex: 1&quot;&gt;
        &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; stroke=&quot;#0f0&quot; stroke-width=&quot;2&quot;&gt;&lt;/rect&gt;
      &lt;/svg&gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;flex: 1&quot;&gt;
        &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; stroke=&quot;#00f&quot; stroke-width=&quot;2&quot;&gt;&lt;/rect&gt;
      &lt;/svg&gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;flex: 1&quot;&gt;
        &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; stroke=&quot;#0ff&quot; stroke-width=&quot;2&quot;&gt;&lt;/rect&gt;
      &lt;/svg&gt;
    &lt;/section&gt;
  &lt;/section&gt;

  &lt;section style=&quot;height: 0; transform: scale(0.8) translate3d(0, 0, 20px)&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 1400 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 400%; max-width: none !important&quot;&gt;
      &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;#f00&quot; style=&quot;opacity: 0.2&quot;&gt;&lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/section&gt;

  &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 1400 300&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 400%; max-width: none !important&quot;&gt;&lt;/svg&gt;
&lt;/section&gt;
</code></pre>
<p>ä» <a href="https://developer.chrome.com/blog/performant-parallaxing#adjusting_scale_for_perspective">Performant Parallaxing</a> å¯çŸ¥ï¼š</p>
<ul>
<li>ç¼©æ”¾æ¯”ä¾‹ = (perspective - translateZ) / perspective</li>
<li>æ»šåŠ¨é€Ÿç‡ = perspective / (perspective - translateZ)</li>
</ul>
<blockquote>
<p>å®ƒä»¬éƒ½ç›¸å¯¹çš„ï¼Œç›¸å¯¹äº translateZ ä¸º 0 çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è§†å·®æ•ˆæœã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€å±çš„æ¨ªå‘å®½åº¦ä¸º 350pxï¼Œçˆ¶çº§å…ƒç´ è®¾ç½® perspective ä¸º 100ï¼Œå…¶ä¸‹æœ‰ä¸¤ä¸ªå­å…ƒç´  A å’Œ Bï¼Œå…¶ä¸­ A è®¾ä¸º <code>transform: translateZ(0)</code>ï¼Œå…¶ä¸­ B è®¾ä¸º <code>transform: translateZ(20px)</code>ï¼Œæ­¤æ—¶ A å±äºæ­£å¸¸çš„å…ƒç´ ï¼Œè€Œ B ç”±äºæ›´é è¿‘è§†ç‚¹ä½ç½®ï¼ˆå³ perspective ä½ç½®ï¼‰ï¼Œå®ƒè¡¨ç°ä¸ºå˜å¤§ï¼Œè€Œæ»šåŠ¨é€Ÿç‡æ›´å¿«ã€‚</p>
<p>å‡è®¾ A çš„é€Ÿç‡ä¸º 1ï¼ˆæ­£å¸¸æ»šåŠ¨ï¼‰ï¼Œè€Œ B çš„é€Ÿç‡è®¡ç®—æ–¹å¼ä¸ºã€ŒA çš„é€Ÿç‡ Ã— (100 / (100 - 20))ã€ï¼Œç­‰äº 1.25ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ A æ»šåŠ¨ 350px æ—¶ï¼ŒB ä¼šæ»šåŠ¨ 437.5pxã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰¹é‡å›¾ç‰‡æ—‹è½¬è„šæœ¬]]></title>
            <link>https://github.com/toFrankie/blog/issues/328</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/328</guid>
            <pubDate>Wed, 07 Feb 2024 07:33:51 GMT</pubDate>
            <description><![CDATA[<p>ä¹‹å‰æœ‰ä¸€ä¸ªæ‰¹é‡æ—‹è½¬å›¾ç‰‡çš„åœºæ™¯ï¼Œå†™äº†ä¸ªè„šæœ¬å¤„ç†ã€‚</p>
<h2>ä½¿ç”¨</h2>
<pre><code>.
â”œâ”€â”€ source/  # æºæ–‡ä»¶ç›®å½•
â”œâ”€â”€ output/  # å¤„ç†åäº§å‡ºç›®å½•
â””â”€â”€ rotate   # å¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶
</code></pre>
<p>å…ˆå®‰è£… <a href="https:/]]></description>
            <content:encoded><![CDATA[<p>ä¹‹å‰æœ‰ä¸€ä¸ªæ‰¹é‡æ—‹è½¬å›¾ç‰‡çš„åœºæ™¯ï¼Œå†™äº†ä¸ªè„šæœ¬å¤„ç†ã€‚</p>
<h2>ä½¿ç”¨</h2>
<pre><code>.
â”œâ”€â”€ source/  # æºæ–‡ä»¶ç›®å½•
â”œâ”€â”€ output/  # å¤„ç†åäº§å‡ºç›®å½•
â””â”€â”€ rotate   # å¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶
</code></pre>
<p>å…ˆå®‰è£… <a href="https://imagemagick.org/script/command-line-processing.php">ImageMagick</a>ï¼Œæ¥ç€å°†è¦å¤„ç†çš„æ–‡ä»¶æ”¾ç½®äº <code>source</code> ç›®å½•ï¼ŒåŒå‡» <code>rotate</code> æ–‡ä»¶æ‰§è¡Œæ—‹è½¬æ“ä½œå®Œæˆåæ–‡ä»¶å­˜æ”¾äº <code>output</code> ç›®å½•ã€‚</p>
<pre><code class="language-shell">$ brew install imagemagick
</code></pre>
<h2>å®ç°</h2>
<p>ç»™ <code>rotate</code> æ·»åŠ æ‰§è¡Œæƒé™ï¼š</p>
<pre><code class="language-shell">$ chmod u+x rotate
</code></pre>
<blockquote>
<p>æ‰©å±•åä¸é‡è¦ï¼Œä½†ä¸ºäº†é¿å…åœ¨ Finder åŒå‡»æ‰“å¼€æ—¶ï¼Œè¢«å…¶ä»–è½¯ä»¶é»˜è®¤æ‰“å¼€ï¼Œè¿™é‡Œåˆ é™¤æ‰©å±•åã€‚</p>
</blockquote>
<p>è·å– <code>rotate</code> è„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼š</p>
<pre><code class="language-shell">$(dirname &quot;$(readlink -f &quot;$0&quot;)&quot;)
</code></pre>
<p>åˆ¤æ–­æ˜¯å¦å®‰è£…äº† ImageMagickï¼Œè¿™é‡Œç”¨åˆ°äº†å®ƒçš„ <code>convert</code> å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">if ! command -v convert &amp;&gt;/dev/null; then
  echo &quot;Error: 'convert' command not found. Please install ImageMagick.&quot;
  exit 1
fi
</code></pre>
<p>éå† <code>source</code> ç›®å½•ï¼Œå¹¶è·å–å›¾ç‰‡æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œæ—‹è½¬æ“ä½œï¼Œæ¯”å¦‚è¿™é‡Œé¡ºæ—¶é’ˆæ—‹è½¬ 90Â°ï¼š<code>convert &lt;source-file&gt; -rotate 90 &lt;output-file&gt;</code></p>
<p>å®Œæ•´è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">#!/bin/bash

# è·å–è„šæœ¬æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„
script_path=&quot;$(dirname &quot;$(readlink -f &quot;$0&quot;)&quot;)&quot;

# æ£€æŸ¥ convert å·¥å…·æ˜¯å¦å·²å®‰è£…
if ! command -v convert &amp;&gt;/dev/null; then
  echo &quot;Error: 'convert' command not found. Please install ImageMagick.&quot;
  exit 1
fi

# è®¾ç½®æºç›®å½•å’Œè¾“å‡ºç›®å½•
source_dir=&quot;$script_path/source&quot;
output_dir=&quot;$script_path/output&quot;

# æ¸…ç©ºè¾“å‡ºç›®å½•
if [ -d &quot;$output_dir&quot; ]; then
  rm -rf &quot;$output_dir&quot;
fi

# åˆ›å»ºè¾“å‡ºç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨
mkdir -p &quot;$output_dir&quot;

# éå†æºç›®å½•ä¸­çš„å›¾åƒæ–‡ä»¶
for file in &quot;$source_dir&quot;/*; do
  # if [ -e &quot;$file&quot; ]; then
  # æå–æ–‡ä»¶åå’Œæ‰©å±•å
  file_name=$(basename &quot;$file&quot;)
  base_name=&quot;${file_name%.*}&quot;
  extension=&quot;${file_name##*.}&quot;

  if [ -f &quot;$file&quot; ] &amp;&amp; [ -n &quot;$extension&quot; ] &amp;&amp; { [ &quot;$extension&quot; = &quot;png&quot; ] || [ &quot;$extension&quot; = &quot;jpg&quot; ] || [ &quot;$extension&quot; = &quot;jpeg&quot; ] || [ &quot;$extension&quot; = &quot;gif&quot; ]; }; then

    # ä½¿ç”¨ convert å·¥å…·æ—‹è½¬å›¾åƒå¹¶å¯¼å‡ºåˆ°è¾“å‡ºç›®å½•
    convert &quot;$file&quot; -rotate 90 &quot;$output_dir/$file_name&quot;

    echo &quot;å·²å¤„ç†æ–‡ä»¶: $file_name&quot;
  fi
done

echo &quot;å¤„ç†å®Œæˆï¼&quot;
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½¿ç”¨ VS Code + GitHub æ­å»ºä¸ªäººåšå®¢]]></title>
            <link>https://github.com/toFrankie/blog/issues/327</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/327</guid>
            <pubDate>Sat, 03 Feb 2024 08:26:03 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1706956091868.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ç›¸å…³è¯é¢˜</h2>
<ul>
<li><a href="https://ww]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1706956091868.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ç›¸å…³è¯é¢˜</h2>
<ul>
<li><a href="https://www.zhihu.com/question/624259381">ä¸ºä»€ä¹ˆç¨‹åºå‘˜å¿…é¡»åšæŒå†™æŠ€æœ¯åšå®¢ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/359954102">ç°åœ¨æ­å»ºä¸ªäººåšå®¢è¿˜æœ‰æ„ä¹‰å—ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/22795144">ä¸€èˆ¬æŠ€æœ¯å¤§ç‰›éƒ½åœ¨å“ªé‡Œå†™åšå®¢ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/656111884">ä¸ºä»€ä¹ˆç°åœ¨å¾ˆå¤šä¸ªäººåšå®¢ç½‘ç«™æ²¡æœ‰æ›´æ–°äº†å‘¢ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/652884046">ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå‘æŠ€æœ¯åšå®¢æ¨èä»€ä¹ˆå¹³å°ï¼Ÿåšå®¢å›­å€¼å¾—å†™å—ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/266571296">ç°åœ¨ä¸ªäººåšå®¢ä¸èƒ½å¤‡æ¡ˆäº†å—ï¼Ÿ</a></li>
</ul>
<h2>å€™é€‰æ–¹æ¡ˆ</h2>
<p>é€‰æ‹©å¾ˆå¤šï¼Œé—¨æ§›å¾ˆä½ã€‚</p>
<p>ç°æœ‰å¹³å°ï¼š</p>
<ul>
<li>æ˜é‡‘</li>
<li>è¯­é›€</li>
<li>çŸ¥ä¹</li>
<li>ç®€ä¹¦</li>
<li>åšå®¢å›­</li>
<li>å¾®ä¿¡å…¬ä¼—å·</li>
<li>SegmentFault</li>
<li>Medium</li>
<li>...</li>
</ul>
<p>è‡ªè¡Œæ­å»ºï¼š</p>
<ul>
<li>WordPress</li>
<li>Hexo</li>
<li>GitBook</li>
<li>VuePress</li>
<li>dumi</li>
<li>...</li>
</ul>
<h2>å¦‚ä½•é€‰æ‹©ï¼Ÿ</h2>
<p>æˆ‘ä»¬å†™ä¸ªäººåšå®¢çš„åˆè¡·ï¼Œå¤§è‡´ä¼šæœ‰è¿™äº›å§ï¼š</p>
<ul>
<li>è®°å½•è¸©è¿‡çš„å‘ã€è§£å†³è¿‡çš„éš¾é¢˜ã€ç”Ÿæ´»ç­‰</li>
<li>å»ºç«‹çŸ¥è¯†åº“ã€å½±å“åŠ›</li>
<li>æ€»ç»“å½’çº³ï¼Œæå‡å†™ä½œè¡¨è¾¾èƒ½åŠ›</li>
<li>å†…å®¹è¾“å‡ºã€è§‚ç‚¹åˆ†äº«ã€è®¨è®ºåŠæ”¹è¿›</li>
<li>...</li>
</ul>
<p>æˆ‘æƒ³è¦çš„ï¼š</p>
<ul>
<li>éšæ—¶éšåœ°ç¼–è¾‘å‘å¸ƒ</li>
<li>è‰¯å¥½çš„ Markdown è¯­æ³•æ”¯æŒï¼Œæœ‰å›¾åºŠ</li>
<li>æ— å†…å®¹å®¡æ ¸ï¼ˆå›½å†…å°¤ä¸ºæ˜æ˜¾ï¼Œæ¯”å¦‚æ–‡ä¸­æœ‰ç«å“å­—çœ¼æˆ– URL å®¹æ˜“é™æµ/å°ç¦ï¼‰</li>
<li>è‰¯å¥½çš„ SEOï¼ˆè¿˜æ˜¯å¸Œæœ›å†™çš„ä¸œè¥¿å¯ä»¥è®©æ›´å¤šäººçœ‹è§ï¼‰</li>
<li>å¯ä»¥ä¸“æ³¨äºå†…å®¹è¾“å‡º</li>
<li>...</li>
</ul>
<p>åœ¨å›½å†…çš„è¯ï¼Œå¯èƒ½æ˜¯æ˜é‡‘ã€è¯­é›€ã€åšå®¢å›­ä¼šå¥½ä¸€äº›ï¼Œç”¨æˆ·ç¾¤ä½“åŸºæœ¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼Œå¯ä»¥å¸¦æ¥æ›´å¤šè®¨è®ºã€‚çŸ¥ä¹ Markdown æ”¯æŒåº¦å¤ªå·®äº†ã€‚ç®€ä¹¦å†…å®¹å®¡æ ¸å¾ˆä¸¥æ ¼ä¸”å‚»é€¼ï¼Œæˆ‘åœ¨<a href="https://www.jianshu.com/u/f4dac74bd955">ç®€ä¹¦</a>å†™äº†å‡ å¹´ï¼Œåæ¥ç”±äºå®¡æ ¸æœºåˆ¶å¤ªå‚»é€¼ï¼Œæ”¹ä¸ªæ–‡å­—åŠ¨ä¸åŠ¨å°ç¦ï¼Œå¿æ— å¯å¿å°±æºœäº†ã€‚</p>
<p>è‡ªè¡Œå»ºç«™è¦è€ƒè™‘ SEOã€å›¾åºŠã€åŸŸåå¤‡æ¡ˆã€è¿ç»´è´¹ç”¨ç­‰ã€‚é€‰æ‹©å›½å†…å¹³å°ï¼Œæ— æ³•é¿å…çš„æ˜¯å†…å®¹å®¡æ ¸ï¼Œæ”¹ä¸ªå­—éƒ½å¾—å®¡æ ¸ä¸€ä¸‹ã€‚ğŸ™„</p>
<p><strong>æ€»ä¹‹ï¼Œå„æœ‰åˆ©å¼Šï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚è‡ªå·±çš„å°±è¡Œã€‚</strong></p>
<h2>æˆ‘çš„é€‰æ‹©</h2>
<blockquote>
<p>æˆ‘çš„åšå®¢ï¼š<a href="https://github.com/toFrankie/blog">ç§ä¸€æ£µæ ‘ï¼Œæœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ã€‚å…¶æ¬¡ï¼Œæ˜¯ç°åœ¨ã€‚</a></p>
</blockquote>
<ul>
<li>ä½¿ç”¨ <a href="https://marketplace.visualstudio.com/items?itemName=Frankie.github-blogger">GitHub Blogger</a> ä½œä¸ºç¼–è¾‘å™¨ï¼Œå¯ä»¥å¿«é€Ÿç¼–è¾‘ã€å‘å¸ƒï¼ˆVS Code WebView Extensionï¼‰ã€‚</li>
<li>ä½¿ç”¨ <a href="https://www.jsdelivr.com/?docs=gh">GitHub + jsDelivr</a> ä½œä¸ºå›¾åºŠï¼Œä¸”æ”¯æŒ CDN åŠ é€Ÿã€‚</li>
<li>ä½¿ç”¨ <a href="https://github.com/toFrankie/blog">GitHub Repository</a> è¿›è¡Œæ–‡ç« å­˜æ¡£ï¼Œæ¯æ¬¡ç¼–è¾‘éƒ½ä¼šè¢«è®°å½•ã€‚</li>
<li>ä½¿ç”¨ <a href="https://github.com/toFrankie/blog/issues">GitHub Issues</a> ä½œä¸ºåšæ–‡åˆ—è¡¨ã€‚</li>
<li>ä½¿ç”¨ <a href="https://github.com/toFrankie/blog/labels">GitHub Labels</a> å¯¹åšæ–‡è¿›è¡Œæ ‡ç­¾ã€åˆ†ç±»ã€‚</li>
<li>ä½¿ç”¨ <a href="https://www.alfredapp.com/help/features/web-search/">Alfred Web Search</a> å¿«é€Ÿæœç´¢æ–‡ç« ï¼Œæ¯”å¦‚æŒ‰æ ‡é¢˜æœç´¢ <code>https://github.com/toFrankie/blog/issues?q=in%3Atitle+{query}+</code>ï¼Œä»¥åå¯èƒ½è€ƒè™‘é›†æˆæ’ä»¶é‡Œã€‚</li>
</ul>
<h2>GitHub Blogger</h2>
<blockquote>
<p>Inspired by Aaronphy/Blogger.</p>
</blockquote>
<p>æ­¤å‰ç¦»å¼€ç®€ä¹¦ï¼Œè€ƒè™‘è¿‡åˆ°æ˜é‡‘ä¸Šç»­å†™ï¼Œä½†ç°åœ¨æ˜é‡‘çš„æ•´ä½“è´¨é‡ä¸å¦‚ä»¥å‰ï¼Œè€Œä¸”å……æ–¥ç€å„ç§æ ‡é¢˜å…šï¼Œè´©å–ç„¦è™‘çš„å‘³å¤ªæµ“äº†ã€‚åæ¥é‡åˆ°äº† <a href="https://github.com/Aaronphy/Blogger">Aaronphy/Blogger</a> å¯ä»¥é™é™åœ°å†™äº†ã€‚</p>
<p>ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œå‘ç°æœ‰äº›åœ°æ–¹ä¸å¤ªé¡ºæ‰‹ã€æœ‰ä¸€äº› Bugï¼Œä½œè€…ä¹Ÿå¾ˆä¹…æ²¡æ›´æ–°äº†ã€‚ç„¶åå°±äºŒæ¬¡å¼€å‘äº†ï¼Œä¿®äº†ä¸€äº› Bugï¼ŒåŠ äº†ä¸€äº›æ–°åŠŸèƒ½ï¼Œäºæ˜¯ <a href="https://github.com/toFrankie/github-blogger">GitHub Blogger</a> è¯ç”Ÿäº†ã€‚</p>
<p>åŸä½œè€…çš„è®¾è®¡æ€è·¯å¦‚ä¸‹å›¾ï¼Œæºè‡ªã€Š<a href="https://zhuanlan.zhihu.com/p/358347337">åœ¨ VSCODE ä¸­å†™åšå®¢å§</a>ã€‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1706953309265.png" alt=""></p>
<p>åœ¨åŸæœ‰åŸºç¡€ä¸Šè°ƒæ•´äº†ä¸€äº›åœ°æ–¹ï¼š</p>
<ul>
<li>è°ƒæ•´ UI ä¸»é¢˜</li>
<li>è°ƒæ•´ Markdown ä¸»é¢˜è¡¨ç°ï¼Œä¿æŒä¸ GitHub ä¸€è‡´</li>
<li>æ”¯æŒ Markdown æ›´å¤šæ ¼å¼ï¼Œæ¯”å¦‚æ•°å­¦å…¬å¼ã€å›¾è¡¨ç­‰</li>
<li>æ”¯æŒæ ‡é¢˜ã€å¤šæ ‡ç­¾æœç´¢</li>
<li>æ”¯æŒæœç´¢é¢æ¿</li>
<li>æ”¯æŒåœ¨ GitHub ä¸­æ‰“å¼€æ–‡ç« </li>
<li>æ”¯æŒæ–‡ç« å¤‡ä»½ï¼Œæ¯æ¬¡ç¼–è¾‘ä¿å­˜éƒ½ä¼šè®°å½•åˆ°ä½ çš„åšå®¢ä»“åº“ä¸­</li>
<li>ä¿®å¤æŒ‰æ ‡ç­¾æœç´¢æ— æ³•ç¿»é¡µçš„é—®é¢˜</li>
<li>ä¿®å¤æ–°å»ºæ–‡ç« é€‰æ‹©æ ‡ç­¾æ— æ³•åˆ›å»ºçš„é—®é¢˜</li>
<li>ä¿®å¤ Labels åªèƒ½æ˜¾ç¤ºå‰ 20 ä¸ªçš„é—®é¢˜</li>
</ul>
<p>2025 å¹´ä¸­ï¼Œå®Œå…¨é‡æ„äº†ï¼Œäº¤äº’ä½“éªŒè·ŸåŸç”Ÿ GitHub ä¸€è‡´ã€‚ç°åœ¨é•¿è¿™æ · ğŸ‘‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752828389666.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752828391479.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1752828393398.png" alt=""></p>
<p>å¦‚æœåˆšå¥½ä½ ä¹Ÿå–œæ¬¢ï¼Œæ¬¢è¿æ¥<a href="https://github.com/toFrankie/github-blogger">è¯•è¯•</a>~ ğŸ‘‹</p>
<h2>å¦‚ä½•ä½¿ç”¨ GitHub Bloggerï¼Ÿ</h2>
<blockquote>
<p>ç”±äº GitHub Blogger å†…éƒ¨ä½¿ç”¨ <a href="https://www.jsdelivr.com/?docs=gh">jsDelivr</a> çš„å›¾åºŠæ–¹æ¡ˆï¼Œåè€…ä¸æ”¯æŒç§æœ‰ä»“åº“ï¼ˆ<a href="https://github.com/jsdelivr/jsdelivr/issues/18243#issuecomment-857512289">æ›´å¤š</a>ï¼‰ï¼Œå› æ­¤<strong>ä½ çš„åšå®¢ä»“åº“å¿…é¡»æ˜¯å…¬å¼€çš„</strong>ï¼Œå¦åˆ™å›¾ç‰‡æ— æ³•æ˜¾ç¤ºã€‚</p>
</blockquote>
<p>å¾ˆç®€å•ï¼š</p>
<ol>
<li>ä½ éœ€è¦æ³¨å†Œä¸€ä¸ª GitHub è´¦å·ï¼ˆå·²æœ‰å¿½ç•¥ï¼‰</li>
<li>ä½ éœ€è¦å®‰è£… VS Codeã€Cursor ç­‰ç¼–è¾‘å™¨ï¼ˆç†è®ºä¸ŠåŸºäº VSCodium çš„ç¼–è¾‘å™¨éƒ½æ”¯æŒï¼‰</li>
<li>åœ¨ç¼–è¾‘å™¨ä¸Šå®‰è£… <a href="https://marketplace.visualstudio.com/items?itemName=Frankie.github-blogger">GitHub Blogger</a> æ‰©å±•ï¼Œäº¦å¯åœ¨æ‰©å±•å¤„æœç´¢ <code>Frankie.github-blogger</code></li>
<li>å‡†å¤‡å¥½ä½ çš„ <a href="https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens">GitHub Personal Access Token</a>ï¼ˆè°ƒç”¨ GitHub API éœ€è¦ç”¨åˆ°ï¼‰</li>
<li>ä½¿ç”¨ Command + Shift + P æˆ– Ctrl + Shift + P å¿«æ·é”®å”¤èµ·å‘½ä»¤é¢æ¿ï¼š
<ol>
<li>é”®å…¥ Configure GitHub Blogger å®Œæˆåˆå§‹é…ç½®ï¼ˆä»“åº“å¯ä»¥é€‰æ‹©å·²æœ‰çš„å…¬å¼€ä»“åº“ï¼‰</li>
<li>é”®å…¥ Open GitHub Blogger æ‰“å¼€ç¼–è¾‘ç•Œé¢ï¼Œå°±å¯ä»¥å¼€å§‹äº†ã€‚</li>
</ol>
</li>
</ol>
<p>æ‰©å±•é…ç½®ï¼š</p>
<pre><code class="language-js">{
  &quot;github-blogger.token&quot;: &quot;xxx&quot;, // Your GitHub Personal Access Token
  &quot;github-blogger.user&quot;: &quot;xxx&quot;, // Your GitHub Username
  &quot;github-blogger.repo&quot;: &quot;xxx&quot;, // Your GitHub Repository Name
  &quot;github-blogger.branch&quot;: &quot;main&quot; // Your GitHub Repository Branch Name
}
</code></pre>
<p>å…¶ä¸­ <code>branch</code> é»˜è®¤æ˜¯ <code>main</code> åˆ†æ”¯ï¼Œå®ƒå†³å®šå›¾ç‰‡ã€æ–‡ç« å­˜æ¡£æäº¤åˆ°å“ªä¸ªåˆ†æ”¯ã€‚é€šå¸¸åšå®¢ä»“åº“ä¸åƒå®é™…é¡¹ç›®æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œä¸€èˆ¬æ— éœ€ç‰¹åˆ«è®¾ç½®ï¼Œæ˜¯ä»“åº“ä¸»åˆ†æ”¯å°±è¡Œã€‚</p>
<blockquote>
<p>å¯é…åˆ <a href="https://github.com/toFrankie/github-issue-toc">github-issue-toc</a> é£Ÿç”¨ï¼Œå®ƒå¯ä»¥åœ¨ GitHub Issue é¡µé¢å³ä¾§ç”Ÿæˆç›®å½•ã€‚</p>
</blockquote>
<blockquote>
<p>GitHub Flavored Markdownï¼ˆGFMï¼‰é™¤äº†æ”¯æŒæ ‡å‡†çš„ CommonMarkdown è¯­æ³•ä¹‹å¤–ï¼Œè¿˜æ›´å¤šç‰¹æœ‰æ ¼å¼ï¼Œè¯¦è§<a href="https://docs.github.com/zh/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/about-writing-and-formatting-on-github">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åœ¨ CSS ä¸­å°è¯•è¶…æ¤­åœ†åœ†è§’]]></title>
            <link>https://github.com/toFrankie/blog/issues/326</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/326</guid>
            <pubDate>Tue, 26 Dec 2023 13:31:30 GMT</pubDate>
            <description><![CDATA[<h2>å¼€å§‹</h2>
<p>è¯´åˆ°ã€Œè¶…æ¤­åœ† Superellipseã€å¯èƒ½å¾ˆå¤šäººä¸äº†è§£ï¼Œä½†å°ç±³äº 2021 å¹´ 3 æœˆ 30 æ—¥å‘å¸ƒçš„å…¨æ–° LOGO å¾ˆå¤šäººä¸é™Œç”Ÿã€‚æ²¡é”™ï¼Œå®ƒå°±æ˜¯è¶…æ¤­åœ†çš„ä¸€ä¸ªä¾‹å­ï¼Œé•¿è¿™æ · ğŸ‘‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/b]]></description>
            <content:encoded><![CDATA[<h2>å¼€å§‹</h2>
<p>è¯´åˆ°ã€Œè¶…æ¤­åœ† Superellipseã€å¯èƒ½å¾ˆå¤šäººä¸äº†è§£ï¼Œä½†å°ç±³äº 2021 å¹´ 3 æœˆ 30 æ—¥å‘å¸ƒçš„å…¨æ–° LOGO å¾ˆå¤šäººä¸é™Œç”Ÿã€‚æ²¡é”™ï¼Œå®ƒå°±æ˜¯è¶…æ¤­åœ†çš„ä¸€ä¸ªä¾‹å­ï¼Œé•¿è¿™æ · ğŸ‘‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1703599211309.png" alt=""></p>
<p>å½“æ—¶é›·æ€»åˆšå¼€å®Œå‘å¸ƒä¼šï¼Œå°ç±³æ——ä¸‹çš„ç½‘ç«™è¿˜æ²¡æ¥å¾—åŠæ›´æ¢å…¨æ–°çš„ LOGOï¼Œç„¶åå¼€å‘åŒå­¦ç›´æ¥æ‹‰äº†ä¸ª <code>border-radius</code> ä¸º <code>19px</code> çš„åœ†è§’ï¼ˆæ²¡è®°é”™çš„è¯ï¼‰è¿˜è¢«å„å¤§ç½‘å‹è°ƒä¾ƒï¼Œå“ˆå“ˆã€‚ç°åœ¨å·²ç»æ¢ä¸Šäº†ä¸€ä¸ª SVG å›¾å½¢ã€‚</p>
<pre><code class="language-html">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;50&quot; viewBox=&quot;0 0 808 808&quot;&gt;
  &lt;g&gt;
    &lt;path fill=&quot;#ff6900&quot; d=&quot;M723.79,84.42C647.55,8.48,537.94,0,404,0,269.89,0,160.12,8.58,83.92,84.72S0,270.43,0,404.39,7.74,648,84,724.14,269.9,808,404,808s243.85-7.71,320-83.86,84-185.78,84-319.75C808,270.25,800.16,160.54,723.79,84.42Z&quot;&gt;&lt;/path&gt;
    &lt;path fill=&quot;#fff&quot; d=&quot;M374.26,553.72a5,5,0,0,1-5.06,5H300.3a5.05,5.05,0,0,1-5.12-5V373.53a5.05,5.05,0,0,1,5.12-5h68.9a5,5,0,0,1,5.06,5Z&quot;&gt;&lt;/path&gt;
    &lt;path fill=&quot;#fff&quot; d=&quot;M509.18,553.72a5.05,5.05,0,0,1-5.09,5H438.5a5,5,0,0,1-5.1-5V398.26c-.07-27.15-1.62-55-15.64-69.06-12-12.09-34.51-14.86-57.88-15.44H241a5,5,0,0,0-5.07,5v235a5.07,5.07,0,0,1-5.12,5H165.16a5,5,0,0,1-5.06-5V254.31a5,5,0,0,1,5.06-5H354.52c49.49,0,101.22,2.26,126.74,27.81s27.92,77.3,27.92,126.85Z&quot;&gt;&lt;/path&gt;
    &lt;path fill=&quot;#fff&quot; d=&quot;M644.29,553.72a5.06,5.06,0,0,1-5.09,5H573.57a5,5,0,0,1-5.08-5V254.31a5,5,0,0,1,5.08-5H639.2a5.06,5.06,0,0,1,5.09,5Z&quot;&gt;&lt;/path&gt;
  &lt;/g&gt;
&lt;/svg&gt;
</code></pre>
<p><a href="https://codepen.io/tofrankie/pen/PoLwaYv">CodePen</a></p>
<p>åœ¨å¤§å­¦æ—¶æœŸï¼Œé‚£ä¼šåšå°ç±³ä¸»é¢˜æ¥è§¦åˆ°è¶…æ¤­åœ†ï¼Œç„¶åå°±è¿·ä¸Šäº†ã€‚åœ¨ä»¥å‰ï¼ŒiOS çš„åº”ç”¨å›¾æ ‡æ€»æ˜¯è¦æ¯” Android å¥½çœ‹ä¸€äº›ï¼ŒåŸå› å°±åœ¨å®ƒåœ†è§’ä¸Šã€‚å½“ç„¶ï¼Œç°åœ¨çœ‹å›½å†…å‡ å®¶ç³»ç»Ÿéƒ½å·²ç»ç”¨ä¸Šäº†ï¼Œçˆ½ï¼</p>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå®ƒæ¯”æ™®é€šåœ†è§’ï¼Œçœ‹èµ·æ¥æ›´èˆ’æœã€æ›´è‡ªç„¶ã€‚</p>
</blockquote>
<h2>è¶…æ¤­åœ†</h2>
<p>è¶…æ¤­åœ†ï¼ˆSuperellipseï¼‰ä¹Ÿç§°ä¸ºæ‹‰æ¢…æ›²çº¿ï¼ˆLamÃ© curveï¼‰ï¼Œæ˜¯åœ¨ç¬›å¡å„¿åæ ‡ç³»ä¸‹æ»¡è¶³ä»¥ä¸‹æ–¹ç¨‹å¼çš„ç‚¹çš„é›†åˆï¼š</p>
<p>$|\frac{x}a|^{n} + |\frac{y}b|^{n} = 1$</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¹…è¿çš„åˆ·æœºä½“éªŒ]]></title>
            <link>https://github.com/toFrankie/blog/issues/325</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/325</guid>
            <pubDate>Sat, 23 Dec 2023 16:56:40 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1703359011825.png" alt=""></p>
<p>è¶ç€å‘¨æœ«ï¼ŒæŠŠæ‰‹ä¸Šçš„å°ç±³ 6X åˆ·äº†ä¸ªç§»æ¤ç‰ˆçš„ MIUI 14ï¼Œå¯èƒ½æ˜¯å› ä¸ºåŠ äº† 2GB çš„æ‰©å±•å†…å­˜ï¼Œä¸]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1703359011825.png" alt=""></p>
<p>è¶ç€å‘¨æœ«ï¼ŒæŠŠæ‰‹ä¸Šçš„å°ç±³ 6X åˆ·äº†ä¸ªç§»æ¤ç‰ˆçš„ MIUI 14ï¼Œå¯èƒ½æ˜¯å› ä¸ºåŠ äº† 2GB çš„æ‰©å±•å†…å­˜ï¼Œä¸æ»‘äº†è®¸å¤š...</p>
<ul>
<li>2011 ~ 2012 å¹´å¼€å§‹å…³æ³¨ MIUI</li>
<li>2013 å¹´ä¹°äº†å°ç±³ 2</li>
<li>2015 å¹´ä¹°äº†å°ç±³ Note Pro</li>
<li>2018 å¹´ä¹°äº†å°ç±³ 6X</li>
</ul>
<blockquote>
<p>è¿˜è®°å¾—ï¼Œé«˜ä¸€ä¹°çš„ç¬¬ä¸€å°å®‰å“æœºæ˜¯è”æƒ³ A500ï¼Œå®ƒæ²¡æ³•åˆ· MIUIï¼Œå½“æ—¶å¾ˆåæ‚”æ²¡ä¹°è´¼èƒ½åˆ·çš„ä¸­å…´ V880ã€‚</p>
</blockquote>
<blockquote>
<p>2016 ä¸‹åŠå¹´ä¸»åŠ›è½¬å‘ iPhoneã€‚ç»†èŠ‚æ§çš„ iOS çœŸçš„æ²»æ„ˆäº†æˆ‘çš„å¼ºè¿«ç—‡ï¼ˆåšå°ç±³ä¸»é¢˜å…»æˆçš„ï¼‰ã€‚</p>
</blockquote>
<p>å¤§å­¦æ¯•ä¸šåï¼Œå› å·¥ä½œçš„å…³ç³»ï¼Œä¹Ÿæ²¡ç©ºåšå°ç±³ä¸»é¢˜äº†ï¼Œç”¨å°ç±³è‡ªç„¶å°±å°‘äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½åœ¨ç”¨è‹¹æœçš„ç”Ÿæ€ã€‚è¿™äº›å¹´åƒå°ç±³ç”µè§†ç­‰ç”Ÿæ€äº§å“ä¹°äº†ä¸å°‘ï¼Œæ˜å¹´æ”¶æ¥¼è€ƒè™‘ç±³å®¶çš„å…¨å±‹æ™ºèƒ½æ–¹æ¡ˆï¼Œç»§ç»­ä¸€å¦‚æ—¢å¾€åœ°æ”¯æŒå°ç±³ã€‚</p>
<p>è¿‘å‡ å¹´ï¼Œã€Œåˆ·æœºã€è¿™ä¸ªè¯å·²ç»å¾ˆå°‘äººæèµ·äº†ï¼ŒåŸå› æ˜¯å„å®¶çš„å®šåˆ¶ç³»ç»Ÿå·²ç»åšå¾—è¶³å¤Ÿå¥½äº†ï¼Œå·²ç»ä¸éœ€è¦åˆ·åˆ«å®¶ç³»ç»Ÿæ¥å¼¥è¡¥è‡ªå®¶ä½“éªŒçš„ä¸è¶³ã€‚ä½ è¿˜è®°å¾—é­”è¶£ã€ä¹è›™ç­‰ç¬¬ä¸‰æ–¹ ROM åŒ…å—ï¼Ÿä»Šå¹´ 10 æœˆé›·æ€»å®£å¸ƒå°ç±³å¯ç”¨å…¨æ–°çš„æ“ä½œç³»ç»Ÿã€Œå°ç±³æ¾æ¹ƒ OSã€ï¼ŒMIUI å°†æˆä¸ºå†å²ã€‚</p>
<ul>
<li><a href="https://home.miui.com/">MIUI å®˜ç½‘</a></li>
<li><a href="https://hyperos.mi.com/">HyperOS å®˜ç½‘</a></li>
</ul>
<blockquote>
<p><s>ä¸çŸ¥åç»­å°ç±³ 6X æœ‰æ—  HyperOS ç‰ˆæœ¬çš„åŒ…ï¼Œåç­‰...</s>ï¼ˆå·²æ›´æ–°ï¼‰</p>
</blockquote>
<h2>å°ç±³ 6X åˆ·å…¥ HyperOS</h2>
<p>æœ€è¿‘é…·å®‰çš„å¤§ä½¬æ”¾å‡ºäº† HyperOS for å°ç±³ 6X çš„åŒ…ï¼ˆ<a href="https://www.123pan.com/s/e235Vv-TrCx">é“¾æ¥</a>ï¼‰ï¼Œå¯ä»¥å¼€åˆ·äº†ã€‚</p>
<p>ä¹‹å‰ç³»ç»Ÿæ˜¯ MIUI 14ï¼Œè¿™æ¬¡è¦æ¸…é™¤ data åˆ†åŒºæ‰èƒ½åˆ·å…¥ HyperOSã€‚</p>
<h3>åˆ·å…¥ TWRP</h3>
<ol>
<li>ä¸‹è½½ç¬¬ä¸‰æ–¹ Recovery å’Œ android-platform-tools
<ul>
<li>æŒ‰æœºå‹ä» <a href="https://twrp.me/Devices/">TWRP</a> ä¸‹è½½åˆ°æœ¬åœ°</li>
<li>ä½¿ç”¨ <code>brew install android-platform-tools</code> å®‰è£…ï¼ŒåŒ…å«äº† <code>adb</code> å’Œ <code>fastboot</code>ã€‚</li>
</ul>
</li>
<li>å°†æ‰‹æœºè¿æ¥åˆ°ç”µè„‘ï¼Œç”¨ <code>adb devices</code> æµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸã€‚</li>
</ol>
<pre><code class="language-shell">$ adb devices
* daemon not running; starting now at tcp:5037
* daemon started successfully
List of devices attached
de5edad9	device
</code></pre>
<ol start="3">
<li>è¿æ¥æˆåŠŸåï¼Œä½¿ç”¨ <code>fastboot</code> å‘½ä»¤åˆ·å…¥ TWRPï¼š</li>
</ol>
<pre><code class="language-shell"># TWRP è·¯å¾„æ ¹æ®å®é™…å­˜æ”¾è·¯å¾„è°ƒæ•´
$ fastboot flash recovery /path/to/your-twrp.img
&lt;waiting for any device&gt;
</code></pre>
<ol start="4">
<li>é‡å¯ï¼ŒæŒ‰ä½ã€ŒéŸ³é‡å‡ã€å’Œã€Œç”µæºé”®ã€è¿›å…¥ FASTBOOT æ¨¡å¼ã€‚</li>
</ol>
<pre><code class="language-shell">fastboot flash recovery /path/to/your-twrp.img
&lt; waiting for any device &gt;
Sending 'recovery' (41104 KB)                      OKAY [  0.884s]
Writing 'recovery'                                 OKAY [  0.286s]
Finished. Total time: 1.214s
</code></pre>
<ol start="5">
<li>åˆ·å®Œä¹‹åï¼Œæ‰§è¡Œ <code>fastboot reboot</code> é‡å¯ã€‚ä¸ºé˜²æ­¢é‡å¯æ‰‹æœº MIUI è‡ªåŠ¨æ›¿æ¢å›å®˜æ–¹ Recoveryï¼ŒæŒ‰ä½ã€ŒéŸ³é‡åŠ ã€ï¼Œç›´è‡³è¿›å…¥ TWRP ç•Œé¢ã€‚</li>
</ol>
<h3>æ ¼å¼åŒ– Data åˆ†åŒº</h3>
<p>è¿›å…¥ TWRP åï¼Œä¼šè¯¢é—®ã€Œæ˜¯å¦ä¿æŒç³»ç»Ÿåˆ†åŒºä¸ºåªè¯»ã€ã€‚ä¸ºäº†ç¦æ­¢ MIUI æ›¿æ¢å›å®˜æ–¹ Recoveryï¼Œæ»‘åŠ¨æŒ‰é’®ä»¥å…è®¸ä¿®æ”¹å³å¯ã€‚</p>
<p>é€‰æ‹©ã€Œæ¸…é™¤ â†’ æ ¼å¼åŒ– Data åˆ†åŒº â†’ è¾“å…¥ yes ç¡®è®¤ â†’ é‡å¯ç³»ç»Ÿã€</p>
<h3>å¡åœ¨ TWRP ç•Œé¢</h3>
<p>åˆ·å®Œ TWRP ä»¥åŠæ ¼å¼åŒ–åˆ†åŒºåï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ç›´å¡åœ¨ TWRP ç•Œé¢ï¼Œæ— æ³•è¿›å…¥ç³»ç»Ÿçš„æƒ…å†µã€‚</p>
<p>å®é™…åœ¨ã€Œå®‰è£…ã€é€‰æ‹©å¡åˆ·åŒ…åˆ·å…¥ç³»ç»Ÿå°±å¯ä»¥äº†ã€‚ä½†æ ¼å¼åŒ–åˆ†åŒºåï¼Œé‡Œé¢å°±ä¸å­˜åœ¨å¡åˆ·åŒ…äº†ï¼ˆå³ä½¿ä¹‹å‰å·²ä¸‹è½½ï¼‰ã€‚æœ‰å‡ ç§è§£å†³æ–¹å¼ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨å†…å­˜å¡ï¼ˆæå‰å°†å¡åˆ·åŒ…æ‹·è¿›å»ï¼‰ï¼Œä½†å‰ææ˜¯æ‰‹æœºæ”¯æŒ...</p>
</li>
<li>
<p>ä½¿ç”¨ OTG æ–¹å¼ï¼Œä½†å‰ææ˜¯å¾—æœ‰ OTG çº¿...</p>
</li>
</ul>
<p>ä¸Šé¢è¿™ä¸¤ç§æ–¹å¼éƒ½å¯èƒ½ä¸€æ—¶é—´è§£å†³ä¸äº†ï¼Œå¾ˆå¤šæ‰‹æœºä¸æ”¯æŒå†…å­˜å¡äº†ï¼Œæ‰‹ä¸Šæœ‰ OTG çº¿çš„å°‘ä¹‹åˆå°‘ã€‚</p>
<p>æˆ‘çš„æ‰‹æœºä¸æ”¯æŒå†…å­˜å¡ï¼ŒTWRP ä¸Šåˆæ— æ³•æŒ‚è½½ USB-OTG çš„å†…å®¹ï¼ŒåŠ ä¸Šæ‰‹æœºé‡ç½®äº†ï¼Œä¹Ÿæ— æ³•è¿æ¥ä¸Šç”µè„‘ï¼Œå› ä¸º USB è°ƒè¯•æ²¡å¼€...</p>
<p>æœ€ç»ˆå€ŸåŠ©äº† ADB Sideload æ¥è§£å†³ï¼Œä¸€ç§æ— éœ€è¿›å…¥æ­£å¸¸è¿›å…¥ç³»ç»Ÿä¹Ÿèƒ½å®‰è£…è½¯ä»¶çš„æ–¹å¼ï¼ˆå¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€ï¼‰ã€‚</p>
<p>åœ¨æ‰‹æœºç«¯ TWRP ç•Œé¢çš„ã€Œé«˜çº§ â†’ ADB Sideload â†’ æ»‘åŠ¨æŒ‰é’®å¼€å§‹ Sideloadã€ï¼Œè¿™æ—¶å€™æ‰‹æœºç»ˆç«¯æ§åˆ¶å°åº”è¯¥èƒ½çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">starting adb sideload feature...
</code></pre>
<p>æ¥ç€ï¼Œåœ¨ç”µè„‘ç«¯æ‰§è¡Œ <code>adb devices</code> åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸäº†ã€‚</p>
<pre><code class="language-shell">$ adb devices
List of devices attached
de5edad9	sideload
</code></pre>
<p>å†æ¥ç€ï¼Œç”µè„‘ç«¯æ‰§è¡Œ <code>adb sideload</code> å‘½ä»¤å°†å¡åˆ·åŒ…åˆ·å…¥ï¼Œè€å¿ƒç­‰å¾…å®Œæˆï¼ˆå¦‚ä¸‹ï¼‰ï¼Œè¿‡ç¨‹ä¸­ä¸è¦é‡å¯æ‰‹æœºã€‚</p>
<pre><code class="language-shell">$ adb sideload /path/to/your-å¡åˆ·åŒ….zip
Total xfer: 1.00x
</code></pre>
<blockquote>
<p>æˆ‘é‡åˆ°äº† <code>Total xfer: 0.00x</code> çš„æƒ…å†µï¼Œå±äºæœªåˆ·æˆåŠŸï¼Œå…·ä½“åŸå› æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæˆ‘åé¢æ¢äº†ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å¡åˆ·åŒ…å°±å¥½äº†ï¼Œç„¶åå†é€šè¿‡å¡åˆ·æœ€æ–°çš„åŒ…æ¥è§£å†³çš„ã€‚</p>
</blockquote>
<p>ä¸Šé¢å®Œæˆä¹‹åï¼Œåœ¨æ‰‹æœºç«¯ä¼šæç¤ºé‡å¯ç³»ç»Ÿï¼Œé‡å¯å°±èƒ½ä½“éªŒæ–°é²œçš„ HyperOS äº†ã€‚</p>
<h2>æ±‡æ€»é“¾æ¥</h2>
<ul>
<li>
<p>åˆ·æœºå…¥é—¨ï¼š</p>
<ul>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=42491267&amp;app_version=dev.20051">Bootloader è§£é”æ•™ç¨‹</a></li>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=32681233&amp;app_version=dev.20051">åˆ·æœºæ³¨æ„äº‹é¡¹</a></li>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=18869159&amp;app_version=dev.20051">çº¿åˆ·</a></li>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=18858262&amp;app_version=dev.20051">å¡åˆ·</a></li>
<li><a href="https://miuiver.com/recovery-rom-installation/">å°ç±³æ‰‹æœºå¡åˆ·æ–¹å¼åˆ·æœºæŒ‡å—</a></li>
<li><a href="https://miuiver.com/install-miui-developer-rom/">ä½¿ç”¨ TWRP åˆ· MIUI å¼€å‘ç‰ˆæ–¹æ³•</a></li>
</ul>
</li>
<li>
<p>åˆ·æœºå·¥å…·ï¼š</p>
<ul>
<li><a href="https://www.miui.com/unlock/download.html">è§£é”å·¥å…·</a></li>
<li><a href="https://miuiver.com/miflash/">çº¿åˆ·å·¥å…·</a></li>
<li><a href="https://miuiver.com/mi-phone-assistant/">å°ç±³æ‰‹æœºåŠ©æ‰‹</a></li>
</ul>
</li>
<li>
<p>åˆ·æœºåŒ…ï¼š</p>
<ul>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=37093637">æ­£å¼ç‰ˆåˆ·æœºåŒ…æ±‡æ€»</a></li>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=5896315&amp;app_version=dev.20220427&amp;ref=share&amp;channel=Share">Xiaomi å…¨ç³»åˆ—æœºå‹ ROM åŒ…ä¸‹è½½ç«™æ±‡æ€»</a></li>
<li><a href="https://web.vip.miui.com/page/info/mio/mio/detail?postId=18111066&amp;app_version=dev.20051&amp;ref=share&amp;channel=Share">Redmi å…¨ç³»åˆ—æœºå‹ ROM åŒ…ä¸‹è½½ç«™æ±‡æ€»</a></li>
<li><a href="https://miuiver.com/">MIUI å†å²ç‰ˆæœ¬ï¼ˆè€æœºå‹ï¼‰</a></li>
</ul>
</li>
<li>
<p>å…¶ä»–ï¼š</p>
<ul>
<li><a href="https://miuiver.com/add-fastboot-and-adb-environment-variables/">Windows é…ç½® fastboot å’Œ adb å‘½ä»¤ç¯å¢ƒå˜é‡</a></li>
<li><a href="https://blog.csdn.net/pk_sir/article/details/112609052">Macï¼šå°ç±³æ‰‹æœºåˆ·æœº</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>ä»¥ä¸Šå·¥å…·åŸºæœ¬ä¸Šè¦å€ŸåŠ© Windows ç¯å¢ƒï¼Œæ¯”å¦‚è§£ BL é”çš„å·¥å…·å°±åªæœ‰ Windows ç‰ˆæœ¬ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Chrome 2023 å…¨æ–°å¤–è§‚ä¸‘ï¼Ÿæƒ³æ¢å›ç»å…¸å¤–è§‚ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/324</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/324</guid>
            <pubDate>Sat, 16 Dec 2023 06:31:32 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702708486482.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ€è¿‘ Chrome 120 æ¨é€æ›´æ–°ï¼Œé»˜è®¤å¯ç”¨äº† Chrome 2023 çš„]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702708486482.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ€è¿‘ Chrome 120 æ¨é€æ›´æ–°ï¼Œé»˜è®¤å¯ç”¨äº† Chrome 2023 çš„å…¨æ–°å¤–è§‚ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702705498766.png" alt=""></p>
<blockquote>
<p><a href="https://www.google.com/intl/en_us/chrome/whats-new/m117/">Whatâ€™s New in Chrome</a></p>
</blockquote>
<p>ä¸€ç›´ä½¿ç”¨ Google Chrome çš„åŸå› æœ‰äºŒï¼Œä¸€æ˜¯æœ¬èº«ä»äº‹ Web å‰ç«¯å¼€å‘ï¼ŒäºŒæ˜¯å®ƒçš„ã€Œé¢œå€¼ã€ã€‚ä½†ä½œä¸ºå¼ºè¿«ç—‡æœ«æœŸæ‚£è€…ï¼Œå®åœ¨å¯¹æ–°å¤–è§‚æä¸èµ·å…´è¶£ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ä¸»é¡µæŒ‰é’®ï¼ˆä¸‘ï¼‰</li>
<li>ä¹¦ç­¾å›¾æ ‡ä¸å­—ä½“ä¸åè°ƒï¼ˆå‰å¤©é‚£ä¸ªç‰ˆæœ¬æ›´ä¸‘ï¼‰</li>
<li>ä¹¦ç­¾å­—ä½“é¢œè‰²è¿‡é‡ï¼Œæœ‰ç‚¹å¤±å»ä¸»æ¬¡äº†</li>
<li>...</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œæ˜¯æˆ‘ä¸å¤ªå–œæ¬¢ Material You è®¾è®¡è¯­è¨€ã€‚ä»¥å‰ Material Design çš„ï¼ˆé»‘ç™½ç°ï¼‰å›¾æ ‡è¿˜æŒºå–œæ¬¢çš„ï¼Œä½†é…è‰²æ˜¯ä¸€ç›´æ²¡æœ‰å‘½ä¸­æˆ‘çš„å–œå¥½ï¼Œè¿‡äºé²œè‰³ã€‚å½“ç„¶ï¼Œä¸ªäººå–œå¥½è€Œå·²ï¼Œé‚£ä½ è§‰å¾—å¥½çœ‹å—ï¼Ÿ</p>
<ul>
<li><a href="https://m1.material.io/">Material Design 1</a></li>
<li><a href="https://m2.material.io/">Material Design 2</a></li>
<li><a href="https://m3.material.io/">Material Design 3</a></li>
<li><a href="https://fonts.google.com/icons">Google Fonts Icons</a></li>
</ul>
<p>åƒåæ‚”çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿”å›ç»å…¸å¤–è§‚ã€‚</p>
<p>åœ°å€æ è¾“å…¥æ‰“å¼€ï¼š</p>
<pre><code>chrome://flags/
</code></pre>
<p>æœç´¢ <code>Chrome Refresh 2023</code>ï¼Œå°†ç›¸å…³ flag æŒ‰éœ€ Disable æ‰å°±è¡Œã€‚æ¯”å¦‚ï¼Œç®€å•å°† Chrome Refresh 2023 è®¾ä¸º Disable é‡å¯å°±èƒ½åˆ‡æ¢ä¸ºç»å…¸å¤–è§‚ã€‚</p>
<p>å¦‚æœè¦æ›´ç²¾ç»†åœ°æ§åˆ¶ï¼Œå¯ä»¥è°ƒæ•´ä»¥ä¸‹é€‰é¡¹ï¼š</p>
<ul>
<li>Chrome Refresh 2023</li>
<li>Chrome WebUI Refresh 2023</li>
<li>Chrome Refresh 2023 New Tab Button</li>
<li>Chrome Refresh 2023 Top Chrome Font Style</li>
<li>Realbox Chrome Refresh 2023</li>
<li>Customize Chrome Side Panel</li>
<li>Omnibox CR 2023 Action Chips</li>
<li>Omnibox CR 2023 Action Chips Icons</li>
</ul>
<p>ä½†ï¼Œè¿™äº›åªæ˜¯è¿‡æ¸¡ç”¨ï¼Œæœªæ¥çš„æŸä¸€ä¸ªç‰ˆæœ¬è‚¯å®šä¼šè¢«ç§»é™¤çš„ï¼Œå¤§å®¶éƒ½å¾—ç”¨æ–°å¤–è§‚...</p>
<p><strong>2024.03.22 æ›´æ–°</strong></p>
<blockquote>
<p>å‰ä¸¤å¤©å‘å¸ƒçš„ Chrome 123 (arm64) ä»¥ä¸Šè®¾ç½®å·²å¤±æ•ˆã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[GitHub GraphQL API åˆ†é¡µæŸ¥è¯¢]]></title>
            <link>https://github.com/toFrankie/blog/issues/323</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/323</guid>
            <pubDate>Sun, 03 Dec 2023 13:42:13 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1701619319197.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>å‰ä¸ä¹…åš <a href="https://gith]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1701619319197.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>å‰ä¸ä¹…åš <a href="https://github.com/toFrankie/github-blogger">Github Blogger</a> æ’ä»¶å¼€å‘æ—¶ï¼Œé‡åˆ°åˆ†é¡µæŸ¥è¯¢çš„åœºæ™¯ï¼Œæ˜¯ç”¨äºæŸ¥è¯¢ Issue çš„ã€‚</p>
<p>ä½¿ç”¨ Github REST API çš„è¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ†é¡µæŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const {Octokit} = require('@octokit/core')

const octokit = new Octokit({
  auth: 'TOKEN',
})

await octokit.request('GET /repos/{owner}/{repo}/issues', {
  owner: 'OWNER',
  repo: 'REPO',
  per_page: 20,
  page: 1,
})
</code></pre>
<blockquote>
<p>Related Link: <a href="https://docs.github.com/en/rest/issues/issues?apiVersion=2022-11-28#list-repository-issues">List repository issues</a></p>
</blockquote>
<p>ç”±äºå®ƒå¹¶æ²¡æœ‰æä¾› <code>in:title</code> ç­‰æ›´åŠ å¤æ‚çš„æœç´¢æ–¹å¼ï¼Œåªèƒ½ç”¨ GitHub GraphQL API å®ç°è¯¥éœ€æ±‚ã€‚</p>
<h2>ç®€ä»‹</h2>
<p>æˆ‘çš„éœ€æ±‚æ˜¯æ ¹æ® <code>title</code>ã€<code>label</code> æ¥ç­›é€‰ Issuesï¼Œå¹¶æ”¯æŒåˆ†é¡µæŸ¥è¯¢ã€‚ä½¿ç”¨åˆ°çš„ API æ˜¯ä¸‹é¢è¿™ä¸ªï¼ˆ<a href="https://docs.github.com/en/graphql/reference/queries#search">Queries search</a>ï¼‰ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1701612821593.png" alt=""></p>
<p>å€ŸåŠ© <code>after</code>ã€<code>first</code>ã€<code>query</code> å°±èƒ½å®ç°ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-graphql">query Issues {
  search(
    type: ISSUE
    query: &quot;user:toFrankie repo:blog state:open label:2023&quot;
    first: 5
    after: null
  ) {
    issueCount
    pageInfo {
      startCursor
      endCursor
      hasNextPage
      hasPreviousPage
    }
    edges {
      node {
        ... on Issue {
          title
        }
      }
    }
  }
}
</code></pre>
<p>å¦‚æœå¯¹ Github Graph API ä¸ç†Ÿçš„è¯ï¼Œå¯ä»¥å€ŸåŠ© Github æä¾›çš„ <a href="https://docs.github.com/en/graphql/overview/explorer">Explorer</a> è¿›è¡ŒéªŒè¯ï¼Œä¸æ‡‚å¯çœ‹ <a href="https://docs.github.com/en/graphql/guides/using-the-explorer">Using the Explorer</a>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1701614411624.png" alt=""></p>
<p>å…¶å®ä»è¿™é‡Œå°±çœ‹å¾—å‡ºå¤§æ¦‚äº†ï¼Œç»“æœä¸­çš„ <a href="https://docs.github.com/en/graphql/reference/objects#pageinfo">pageInfo</a> ç»“æ„å¦‚ä¸‹</p>
<ul>
<li><strong>startCursor</strong> å½“å‰åˆ†é¡µçš„èµ·å§‹é”šç‚¹</li>
<li><strong>endCursor</strong> å½“å‰åˆ†é¡µç»“æœçš„ç»“å°¾é”šç‚¹</li>
<li><strong>hasPreviousPage</strong> å‘å‰ç¿»é¡µï¼Œæ˜¯å¦æœ‰æ›´å¤šé¡¹ç›®</li>
<li><strong>hasNextPage</strong> å‘åç¿»é¡µï¼Œæ˜¯å¦æœ‰æ›´å¤šé¡¹ç›®</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå·²çŸ¥ <code>startCursor</code> å’Œ <code>endCursor</code> å°±èƒ½ä»£å…¥ Search çš„ <code>after</code> å’Œ <code>before</code> å‚æ•°å®ç°ç¿»é¡µçš„éœ€æ±‚ã€‚</p>
<p>å¦‚æœæ˜¯æŒ‰é¡ºåºä»ç¬¬ä¸€é¡µã€ç¬¬äºŒé¡µ......è¿›è¡Œç¿»é¡µçš„è¯ï¼Œä»æœ¬é¡µçš„ pageInfo ä¸­å–å‡º <code>endCursor</code> ä»£å…¥ä¸‹ä¸€ä¸ªæŸ¥è¯¢çš„ <code>after</code> ä¸­å°±è¡Œã€‚<strong>å¦‚æœæˆ‘è¦ä»ç¬¬ 1 é¡µè°ƒåˆ°ç¬¬ 5 é¡µå‘¢ï¼Ÿ</strong></p>
<p>æˆ‘è¯•å›¾å»å¯»æ‰¾ Cursor çš„è§„å¾‹ï¼Œä» <a href="https://docs.github.com/en/graphql/guides/introduction-to-graphql#edge">Introduction to GraphQL</a> å¯çŸ¥ï¼ŒGithub é‡‡ç”¨ GraphQL çš„ <a href="https://graphql.org/learn/pagination/#pagination-and-edges">cursor-based pagination</a> æ–¹å¼ä»¥å®ç°ç¿»é¡µã€‚</p>
<p>åŸæ¥ Cursor æ˜¯ç”¨ Base64 ç¼–ç åçš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-text">Y3Vyc29yOjU=
</code></pre>
<pre><code class="language-text">cursor:5
</code></pre>
<p>è§£ç åå¯çŸ¥æ˜¯ <code>cursor:offset</code> çš„å½¢å¼ï¼Œæ‰€ä»¥ï¼Œå®ç°è·³é¡µåªè¦å°†å…¶ç¼–ç ä¸º Base64 å†ä¼ å…¥ <code>after</code> å³å¯ã€‚å¦‚æœæ˜¯é¦–é¡µï¼Œå¯ä»¥ä¸ä¼ å…¥ <code>after</code> å‚æ•°æˆ–è®¾ä¸º <code>null</code>ã€‚</p>
<h2>ç¤ºä¾‹</h2>
<p>å…¶ä¸­ <code>TOKEN</code>ã€<code>USER</code>ã€<code>REPO</code>ã€<code>LABEL</code> ä»¥åŠ <code>query</code> ç­‰æŒ‰éœ€è°ƒæ•´ã€‚</p>
<pre><code class="language-js">const {Octokit} = require('@octokit/core')
const {encode} = require('js-base64')

const octokit = new Octokit({
  auth: 'TOKEN',
})

const page = 2
const perPage = 5
const offset = (page - 1) * perPage
const pageCursor = offset &gt; 0 ? encode(`cursor:${offset}`) : null

await octokit.graphql(`
  {
    search(
      type: ISSUE
      query: &quot;user:USER repo:REPO state:open label:LABEL&quot;
      first: ${perPage}
      after: ${pageCursor ? `&quot;${pageCursor}&quot;` : null}
    ) {
      issueCount
      pageInfo {
        startCursor
        endCursor
        hasNextPage
        hasPreviousPage
      }
      edges {
        node {
          ... on Issue {
            title
          }
        }
      }
    }
  }
`)
</code></pre>
<blockquote>
<p><a href="https://runkit.com/embed/x6xyzx9i858x">RunKit Demo</a></p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://docs.github.com/en/rest?apiVersion=2022-11-28">Github REST API</a></li>
<li><a href="https://docs.github.com/en/graphql">GitHub GraphQL API</a></li>
<li><a href="https://docs.github.com/en/graphql/overview/explorer">GitHub GraphQL Explorer</a></li>
<li><a href="https://octokit.rest/GET/repos/%7Bowner%7D/%7Brepo%7D/issues">Octokit Rest Online</a></li>
<li><a href="https://docs.github.com/en/search-github/searching-on-github/searching-issues-and-pull-requests">Searching issues and pull requests</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å›¾ç‰‡æ“ä½œè®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/322</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/322</guid>
            <pubDate>Fri, 10 Nov 2023 08:24:41 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1699607759532.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><a href="https://f]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1699607759532.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¸¸ç”¨å·¥å…·</h2>
<ul>
<li><a href="https://ffmpeg.org/ffmpeg.html">FFmpeg</a></li>
<li><a href="https://www.lcdf.org/gifsicle/man.html">Gifsicle</a></li>
<li><a href="https://gif.ski/">Gifski</a></li>
<li><a href="https://imagemagick.org/script/command-line-processing.php">ImageMagick</a></li>
<li><a href="http://www.graphicsmagick.org/index.html">GraphicsMagick</a></li>
</ul>
<blockquote>
<p>å®ƒä»¬çš„å‘½ä»¤è¡Œå·¥å…·å‡å¯é€šè¿‡ <a href="https://github.com/toFrankie/blog/issues/9">Homebrew</a> å®‰è£…ï¼Œéƒ¨åˆ†æœ‰æ¡Œé¢å®¢æˆ·ç«¯åº”ç”¨ã€‚</p>
</blockquote>
<h2>æŸ¥çœ‹ GIF ä¿¡æ¯</h2>
<h3>Gifsicle</h3>
<pre><code class="language-shell"># æŸ¥çœ‹æ‰€æœ‰å¸§ä¿¡æ¯
$ gifsicle --info source.gif
 
# æŸ¥çœ‹æŸå¸§ä¿¡æ¯
$ gifsicle --info &quot;#0&quot; &quot;#3&quot; &lt; source.gif
 
# æŸ¥çœ‹è¯¦ç»†é¢œè‰²è¡¨
$ gifsicle --cinfo source.gif
</code></pre>
<h3>æ”¯æŒç½‘ç»œå›¾ç‰‡</h3>
<p>è¯¦è§ <a href="https://gist.github.com/toFrankie/39268cb232e2b7ee3f4f74af24938d8e">get_info.sh</a>ï¼Œå®ƒå†…éƒ¨ä¾èµ– ImageMagickã€‚</p>
<pre><code class="language-shell">$ gifinfo [-n number_of_frames] &lt;filename&gt;
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>filename</code> æ”¯æŒç½‘ç»œå›¾ç‰‡ã€‚</p>
</blockquote>
<h3>é€å¸§ä¿¡æ¯è¯»å–</h3>
<p><a href="https://github.com/toFrankie/gif">https://github.com/toFrankie/gif</a></p>
<h2>GIF è½¬æ¢ä¸º PNG</h2>
<p>ä½¿ç”¨ ImageMagick</p>
<pre><code class="language-shell"># é€å¸§å¯¼å‡º
$ convert source.gif target.png
</code></pre>
<blockquote>
<p>WARNING: The convert command is deprecated in IMv7, use &quot;magick&quot; instead of &quot;convert&quot; or &quot;magick convert&quot;</p>
</blockquote>
<p>å¦‚æœ GIF å·²ç»è¿‡é€æ˜åº¦å¤„ç†ï¼ˆå³ç¬¬ä¸€å¸§ä¿¡æ¯å®Œæ•´ä¿ç•™ï¼Œåç»­å¸§ä»…ä¿ç•™å˜åŒ–çš„éƒ¨åˆ†ï¼Œæœªå˜çš„ç©ºé—´å‡ä¸ºé€æ˜ï¼‰ï¼Œå¯é€šè¿‡ Gifsicle è¿˜åŸï¼Œå†ä½¿ç”¨ ImageMagick å¤„ç†ã€‚</p>
<pre><code class="language-shell"># è¿˜åŸ
$ gifsicle --unoptimize source.gif &gt; tmp.gif

# é€å¸§å¯¼å‡º
$ convert tmp.gif target.png
</code></pre>
<p>å¯¼å‡ºæŸå¸§</p>
<pre><code class="language-shell">$ convert 'source.gif[0]' target.png
</code></pre>
<blockquote>
<p>å¯¼å‡ºå¤šå¸§ï¼Œå¯ä»¥è¿™æ ·æŒ‡å®šï¼š<code>source.gif[0-3]</code>ã€<code>source.gif[3,2,4]</code>ï¼ˆéè¿ç»­å¸§ï¼‰ã€‚</p>
</blockquote>
<h2>GIF å¸§æ“ä½œ</h2>
<h3>ç®€å•æŠ½å¸§</h3>
<p>ä½¿ç”¨ macOS å†…ç½®çš„ã€Œé¢„è§ˆã€åº”ç”¨ï¼Œå¯ä»¥å¿«é€Ÿæ’å…¥/åˆ é™¤å¸§ã€‚æ‰“å¼€ GIF å¹¶åœ¨ã€Œèœå•æ  - æ˜¾ç¤ºã€åˆ‡æ¢ä¸ºã€Œç¼©ç•¥æ¸…å•ã€ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1699606830228.png" alt=""></p>
<ul>
<li>åˆ é™¤å¸§ï¼šé€‰ä¸­å¸§åï¼Œä½¿ç”¨ã€ŒâŒ˜ + deleteã€å¿«æ·é”®åˆ é™¤ã€‚</li>
<li>æ·»åŠ å¸§ï¼šæ‰“å¼€ä¸¤ç»„ GIFï¼ˆå¿…éœ€éƒ½æ˜¯ GIFï¼‰ï¼Œé€‰ä¸­æŸå¸§ï¼Œæ‹–æ‹½è‡³å¦ä¸€ä¸ª GIF å¯¹åº”å¸§çš„ä½ç½®ã€‚æ¯”å¦‚ï¼Œä» A ä¸­æ‹–æ‹½ä¸€å¸§åˆ° Bï¼ŒA å¸§æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼ŒB åˆ™ä¼šå¢åŠ ä¸€å¸§ã€‚</li>
</ul>
<h3>åˆ é™¤æŒ‡å®šå¸§</h3>
<pre><code class="language-shell">$ gifsicle source.gif --delete '#1-5' &gt; output.gif
</code></pre>
<blockquote>
<p>å¸§ç´¢å¼•ä» 0 å¼€å§‹ã€‚</p>
<p>å¸§æ•°æ”¯æŒè´Ÿæ•°ï¼Œæ¯”å¦‚ <code>#-1</code> è¡¨ç¤ºå€’æ•°ç¬¬ä¸€å¸§ï¼Œ<code>#0--2</code> è¡¨ç¤ºå‰ N - 2 å¸§ã€‚</p>
</blockquote>
<h3>ä¿®æ”¹å¸§ä¸å¸§ä¹‹é—´çš„ Delay Time</h3>
<pre><code class="language-shell">$ gifsicle source.gif -d100 '#0-5' &gt; output.gif
</code></pre>
<p>TODO: ç›®å‰ä¿®æ”¹ä¼¼ä¹æœ‰é—®é¢˜ï¼Œåªå¯¼å‡ºäº†ä¿®æ”¹åçš„å¸§ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œå•ä½æ˜¯ 1/100 ç§’ï¼Œ<code>-d100</code> è¡¨ç¤ºå»¶è¿Ÿæ—¶é—´ä¸º 1sã€‚</p>
<p>åœ¨çº¿å·¥å…· <a href="https://ezgif.com/maker">Ezgif GIF Maker</a>ã€‚</p>
<p><a href="https://www.robinstewart.com/blog/2018/10/adding-a-delay-to-the-end-of-an-animated-gif/">Adding a delay to the end of an animated gif</a></p>
</blockquote>
<h2>MP4 è½¬ GIF</h2>
<p>ä½¿ç”¨ FFmpeg</p>
<pre><code class="language-shell">$ ffmpeg -vf &quot;fps=10&quot; -loop 0 target.gif -i source.mp4
</code></pre>
<h2>HEIC è½¬ PNG</h2>
<p>ä½¿ç”¨ ImageMagick</p>
<pre><code class="language-shell">$ magick source.heic target.png
</code></pre>
<h2>å›¾ç‰‡æ—‹è½¬</h2>
<p>ä½¿ç”¨ ImageMagick</p>
<pre><code class="language-shell">$ convert source.png -rotate 90 target.png
</code></pre>
<p>æƒ³èµ·å†ç»§ç»­è¡¥å……...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å…¬ä¼—å·å›¾ç‰‡ä¸Šä¼ å‹ç¼©è§„åˆ™]]></title>
            <link>https://github.com/toFrankie/blog/issues/321</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/321</guid>
            <pubDate>Wed, 01 Nov 2023 09:31:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1699607726108.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ç”±äºå¾®ä¿¡æ‰‹æ¡â€œç”Ÿæ€å¤§æƒâ€ï¼Œä¸€æ—¦è§„åˆ™]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1699607726108.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ç”±äºå¾®ä¿¡æ‰‹æ¡â€œç”Ÿæ€å¤§æƒâ€ï¼Œä¸€æ—¦è§„åˆ™æœ‰å˜ï¼Œæœ¬æ–‡å†…å®¹ä¹Ÿå¯èƒ½éšä¹‹å¤±æ•ˆï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<h2>èƒŒæ™¯</h2>
<p>å…¬ä¼—å·å›¾ç‰‡ä¸Šä¼ åï¼Œå›¾ç‰‡ä¼šæœ‰ä¸åŒç¨‹åº¦çš„å‹ç¼©ï¼Œæœ¬æ–‡è®¨è®ºçš„å°±æ˜¯é€šè¿‡ä¸€å®šçš„æŠ€å·§æ¥å‡å°‘æŸè€—ï¼Œå†…å®¹æ”¶é›†è‡ªç½‘ç»œæˆ–å®è·µæ€»ç»“æ‰€å¾—ã€‚</p>
<h2>æ ¼å¼</h2>
<ul>
<li>PNGï¼šä¸€ç§æœ‰æŸå‹ç¼©çš„å›¾ç‰‡æ ¼å¼ï¼Œä¼˜ç‚¹æ˜¯ä½“ç§¯å°ï¼Œå¯å‹ç¼©ç©ºé—´å¤§ï¼ˆè´¨é‡æŸè€—å¤§ï¼‰ã€‚ä½†è´¨é‡ä¸å¦‚ PNGï¼Œä¸”ä¸æ”¯æŒé€æ˜èƒŒæ™¯ã€‚</li>
<li>JPGï¼šä¸€ç§æœ‰æŸå‹ç¼©çš„å›¾ç‰‡æ ¼å¼ï¼Œå›¾ç‰‡è´¨é‡é«˜ï¼Œä¸”æ”¯æŒé€æ˜èƒŒæ™¯ã€‚ä½†å¯å‹ç¼©ç©ºé—´å°‘ã€‚</li>
<li>GIFï¼šä¸€ç§æœ€å¤šå¯æ”¯æŒ 256 ç§é¢œè‰²çš„å›¾ç‰‡æ ¼å¼ï¼Œè‰²å½©ä¸°å¯Œåº¦è¿œä¸å¦‚ JPGã€PNGã€‚å®ƒåœ¨å¾®ä¿¡å…¬ä¼—å· SVG äº¤äº’æ’ç‰ˆä¸­æ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ã€‚</li>
</ul>
<h2>å‰æ</h2>
<p>è¶…è¿‡ä»¥ä¸‹ä¸Šé™å°†æ— æ³•åœ¨å…¬ä¼—å·åå°ä¿å­˜ã€‚</p>
<ul>
<li>~å›¾ç‰‡ä¸èƒ½è¶…è¿‡ 5M~ï¼ˆ2023 å¹´æŸæ¬¡æ›´æ–°åï¼Œæå‡è‡³ 10M äº†ï¼‰</li>
<li>å›¾ç‰‡ä¸èƒ½è¶…è¿‡ 10M</li>
<li>GIF ä¸èƒ½è¶…è¿‡ 300 å¸§</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œå°½ç®¡æ§åˆ¶åœ¨ä¸Šé™èŒƒå›´å†…ï¼Œä¸Šä¼ åå¯èƒ½ä¼šæœ‰ä¸åŒç¨‹åº¦çš„å‹ç¼©ã€‚</p>
</blockquote>
<h2>ç»“è®º</h2>
<ul>
<li>å›¾ç‰‡å®½åº¦ä¸è¦è¶…è¿‡ 1080pxï¼Œè¶…è¿‡ä¼šè¢«å‹ç¼©ä¸º 1080pxã€‚</li>
<li>å¯¹äºé™å¸§å›¾ç‰‡ï¼Œè¦è¿½æ±‚è´¨é‡çš„è¯ï¼Œä¼˜å…ˆé€‰ PNGï¼Œå…¶å‹ç¼©ç©ºé—´å°ã€‚</li>
</ul>
<details>
    <summary>å¾…éªŒè¯</summary>
<ul>
<li>GIF å¸§æ•°å¤§äº 60 å¸§ï¼Œä¸è¢«å‹ç¼©</li>
<li>GIF å¸§æ•°å°äº 60 å¸§ï¼š
<ul>
<li>å®½åº¦å°äºç­‰äº 640pxï¼Œä¸è¢«å‹ç¼©</li>
<li>å®½åº¦å¤§äº 640pxï¼Œè¢«å‹ç¼©ä¸º 640px</li>
</ul>
</li>
<li>å›¾ç‰‡åƒç´ æ€»æ•°ï¼ˆå®½ Ã— é«˜ï¼‰ä¸è¶…è¿‡ 600w</li>
</ul>
</details>
<h3>Q&amp;A</h3>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯ 1080pxï¼Ÿ</strong></p>
<p>ä¼—æ‰€å‘¨çŸ¥ 1280 å®½æ˜¯å…¬ä¼—å·åå°ç´ æåº“é™æ€å›¾ç‰‡å®½åº¦çš„ä¸Šé™ï¼Œé‚£ä¸ºå•¥è¾“å‡ºè®¾ç½®çš„æ˜¯ 1080pxï¼Œè€Œä¸æ˜¯ 1280pxï¼Ÿâ€”â€”ç¬¬ä¸€æ˜¯å› ä¸ºå¥½è®°ï¼Œç¬¬äºŒæ˜¯å› ä¸º 1280 å®½åº¦çš„å›¾ç‰‡åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä¹Ÿä¼šå¶å°”è¢«ç„å­¦å‹ç¼©ï¼Œå› æ­¤å†ç¼©å°ä¸€ç‚¹ç¡®ä¿ä¸ä¼šè¢«å‹ç¼©ã€‚ä½¿ç”¨è¿™ä¸ªæ ¼å¼çš„å›¾ç‰‡è´¨é‡å·²ç»æ˜¯é‡çº§é£è·ƒäº†ï¼Œ200 åƒç´ å·®è·ä¸å¤§ï¼Œå¯¹è®¾è®¡æºæ–‡ä»¶è¾“å‡ºçš„ç”µè„‘è¦æ±‚ä¹Ÿè¾ƒä½ï¼Œå¯ä»¥å¯¼å‡ºæ›´é•¿çš„ 10M å†…æ–‡ä»¶ã€‚ï¼ˆ<a href="https://mp.weixin.qq.com/s/NnCfLDIkz_z-LeZy-P3lmg">æºè‡ª</a>ï¼‰</p>
</blockquote>
<h2>å‹ç¼©å·¥å…·</h2>
<ul>
<li><a href="https://www.iloveimg.com/compress-image">iLoveIMG</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/37782158">å¾®ä¿¡å…¬ä¼—å·å›¾ç‰‡å‹ç¼©è§„åˆ™ [2023å¹´8æœˆ]</a></li>
<li><a href="https://mp.weixin.qq.com/s/NnCfLDIkz_z-LeZy-P3lmg">å…¬ä¼—å·å›¾ç‰‡æ¨¡ç³Šï¼Ÿã€Œæ— æŸã€ä¸Šä¼ ç§˜è¯€åœ¨æ­¤ã€‚</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ Mac App Store ä¸æ˜¾ç¤ºå¯ç”¨æ›´æ–°çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/320</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/320</guid>
            <pubDate>Sat, 23 Sep 2023 04:49:44 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/9/1695444781383.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç›¸ä¿¡ä¸å°‘äººé‡åˆ°è¿‡ Mac App Store æœ‰æ›´æ–°æç¤ºï¼Œä½†è¿›å…¥åº”ç”¨å•†åº—çš„ã€Œæ›´]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/9/1695444781383.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç›¸ä¿¡ä¸å°‘äººé‡åˆ°è¿‡ Mac App Store æœ‰æ›´æ–°æç¤ºï¼Œä½†è¿›å…¥åº”ç”¨å•†åº—çš„ã€Œæ›´æ–°ã€ä¸€æ ä¸ä¼šæ˜¾ç¤ºå¯ç”¨æ›´æ–°çš„è½¯ä»¶åˆ—è¡¨ã€‚åªæœ‰è¿›å…¥å¯¹åº”è½¯ä»¶è¯¦æƒ…é¡µæ‰ä¼šæ˜¾ç¤ºå¯æ›´æ–°ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å¿«æ·é”®ã€ŒâŒ˜ + Rã€æ¥åˆ·æ–°é¡µé¢ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/9/1695444299144.png" alt=""></p>
<p>Related Link: <a href="https://culturedcode.com/things/support/articles/4522602/">Troubleshooting App Store Issues</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Mapã€Set]]></title>
            <link>https://github.com/toFrankie/blog/issues/319</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/319</guid>
            <pubDate>Sun, 23 Jul 2023 13:35:55 GMT</pubDate>
            <description><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½¿ç”¨ <code>Map</code>ã€<code>Set</code> çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</p>
<h2>Map</h2>
<h3>ç®€ä»‹</h3>
<p><code>Map</code> æ˜¯ ES6 ä¸­æ–°å¢çš„ä¸€ç§å¼•ç”¨æ•°æ®ç±»å‹ã€‚</p>
<pre><code class="language-js">O]]></description>
            <content:encoded><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½¿ç”¨ <code>Map</code>ã€<code>Set</code> çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</p>
<h2>Map</h2>
<h3>ç®€ä»‹</h3>
<p><code>Map</code> æ˜¯ ES6 ä¸­æ–°å¢çš„ä¸€ç§å¼•ç”¨æ•°æ®ç±»å‹ã€‚</p>
<pre><code class="language-js">Object.prototype.toString.call(new Map()) // &quot;[object Map]&quot;
</code></pre>
<p>å¸¸ä¸ <code>Object</code> ä½œæ¯”è¾ƒï¼Œä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">Map</th>
<th style="text-align:left">Object</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>é»˜è®¤é”®</strong></td>
<td style="text-align:left">æ— ã€‚</td>
<td style="text-align:left">é™¤ <code>Object.create(null)</code> åˆ›å»ºçš„å¯¹è±¡ä¹‹å¤–ï¼Œä¸€èˆ¬éƒ½æœ‰é»˜è®¤é”®ï¼Œæ¯”å¦‚ <code>__proto__</code> ç­‰ä¸åŸå‹ç›¸å…³çš„é”®ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>é”®çš„ç±»å‹</strong></td>
<td style="text-align:left">å¯ä»¥æ˜¯<strong>ä»»æ„</strong>æ•°æ®ç±»å‹çš„å€¼ã€‚</td>
<td style="text-align:left">åªèƒ½æ˜¯ <code>String</code> æˆ– <code>Symbol</code> ç±»å‹çš„å€¼ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>é”®çš„é¡ºåº</strong></td>
<td style="text-align:left">æœ‰åºï¼ˆæŒ‰æ’å…¥é¡ºåºï¼‰ã€‚</td>
<td style="text-align:left">æ— åºã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>æ˜¯å¦å¯è¿­ä»£</strong></td>
<td style="text-align:left">æ”¯æŒï¼Œå…¶å®ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</td>
<td style="text-align:left">ä¸æ”¯æŒã€‚</td>
</tr>
</tbody>
</table>
<p>æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œè‡ªç„¶å°±å¾ˆæ–¹ä¾¿åœ°è¢«è§£æ„ã€æ‰©å±•è¿ç®—ç¬¦ã€<code>for...of</code>ã€<code>Array.from()</code> ç­‰æ¶ˆè´¹ã€‚</p>
<pre><code class="language-js">new Map()[Symbol.iterator] // Æ’ entries() { [native code] }
</code></pre>
<h3>æ„é€ å‡½æ•°</h3>
<p>å…¶æ„é€ å‡½æ•°å¯æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¯é€‰ã€‚</p>
<pre><code class="language-js">new Map([iterable])
</code></pre>
<p>é€šå¸¸æ˜¯ <code>[[key, value], ...]</code> å½¢å¼ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const map = new Map([
  [1, 'one'],
  [2, 'two'],
  [3, 'three'],
])
</code></pre>
<p>ä¹Ÿå¯ä½¿ç”¨é“¾å¼å½¢å¼æ’å…¥é”®å€¼ã€‚</p>
<pre><code class="language-js">const map = new Map()
  .set(1, 'one')
  .set(2, 'two')
  .set(3, 'three')
</code></pre>
<h3>å®ä¾‹å±æ€§ã€æ–¹æ³•</h3>
<p>å®ƒåªæä¾›äº†ä¸¤ä¸ªå®ä¾‹å±æ€§ã€‚</p>
<pre><code class="language-js">Map.prototype.size
</code></pre>
<blockquote>
<p>åªè¯»ï¼Œè¿”å›å®ä¾‹å¯¹è±¡çš„é”®å€¼å¯¹æ•°é‡ã€‚å¯¹æ¯” <code>Object</code> çš„ <code>Object.keys(obj).length</code>ï¼Œå®ƒæ–¹ä¾¿å¤ªå¤šäº†ã€‚</p>
</blockquote>
<blockquote>
<p>å¦ä¸€ä¸ª <code>@@species</code> å±æ€§å¤ªå¤ªå¤ªå°‘è§äº†ï¼Œæœ‰å…´è¶£è‡ªè¡Œç¿»é˜…ã€‚</p>
</blockquote>
<p>å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„å®ä¾‹æ–¹æ³•ï¼Œä¾¿äºå¯¹å…¶è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</p>
<pre><code class="language-js">Map.prototype.get()
Map.prototype.set()
Map.prototype.has()
Map.prototype.delete()
Map.prototype.clear()
</code></pre>
<blockquote>
<ul>
<li>é™¤ <code>clear()</code> ä¹‹å¤–ï¼Œä»¥ä¸Šå…¶ä»–æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•° <code>key</code>ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ï¼ˆåŸå§‹å€¼æˆ–å¼•ç”¨å€¼ï¼‰ã€‚</li>
<li><code>get(key)</code> ç”¨äºè·å–æŒ‡å®šå¥çš„å€¼ï¼Œè‹¥ <code>key</code> ä¸å­˜åœ¨äºå®ä¾‹å¯¹è±¡ï¼Œåˆ™è¿”å› <code>undefined</code>ã€‚</li>
<li><code>set(key)</code> ç”¨äºæ·»åŠ æˆ–æ›´æ–°æŒ‡å®šå¥ï¼Œå¹¶è¿”å›å®ä¾‹å¯¹è±¡ï¼Œå› è€Œå¯ä»¥é“¾å¼è°ƒç”¨ã€‚</li>
<li><code>has(key)</code> ç”¨äºåˆ¤æ–­æŒ‡å®šå¥æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚</li>
<li><code>delete(key)</code> ç”¨äºåˆ é™¤æŒ‡å®šå¥ï¼Œè‹¥å¥<strong>å­˜åœ¨</strong>ä¸”å·²è¢«åˆ é™¤ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li><code>clear()</code> ç”¨äºæ¸…ç©ºå®ä¾‹å¯¹è±¡ä¸­æ‰€æœ‰å…ƒç´ ã€‚</li>
</ul>
</blockquote>
<pre><code class="language-js">Map.prototype.keys()
Map.prototype.values()
Map.prototype.entries()
</code></pre>
<blockquote>
<ul>
<li>ä½œç”¨ä¸ <code>Object.keys()</code>ã€<code>Object.values()</code>ã€<code>Object.entries()</code> ç±»ä¼¼ï¼Œä½†ä¸åŒã€‚</li>
<li>å®ƒä»¬ä¸‰ä¸ªéƒ½è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼ˆ<strong>ä¸æ˜¯ <code>Map</code> å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯æ•°ç»„</strong>ï¼‰ï¼Œå…¶é¡ºåºåŒåŸå§‹ <code>Map</code> å¯¹è±¡å…ƒç´ æ’å…¥çš„é¡ºåºã€‚</li>
</ul>
</blockquote>
<pre><code class="language-js">Map.prototype.forEach()
</code></pre>
<blockquote>
<p>æœ‰ä¸”ä»…æœ‰è¿™ä¸€ä¸ªç”¨äºéå†çš„å®ä¾‹æ–¹æ³•ã€‚åˆ«ä¸€ä¸Šæ¥å°±è”æƒ³åˆ° <code>Array.prototype.forEach()</code>ï¼Œè™½ç„¶éƒ½æ˜¯éå†ï¼Œä½†ä¸åŒï¼Œå®ƒæ²¡æœ‰ <code>map()</code>ã€<code>filter()</code> ç­‰æ–¹æ³•ã€‚</p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£æ„èµ‹å€¼è¢«æ»¥ç”¨ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/318</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/318</guid>
            <pubDate>Sat, 22 Jul 2023 05:45:38 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1690014631503.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¼€å§‹</h2>
<p>æŸå¤©çœ‹åˆ°è¿™æ ·ä¸€ä¸ª<a href="https://tw]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1690014631503.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¼€å§‹</h2>
<p>æŸå¤©çœ‹åˆ°è¿™æ ·ä¸€ä¸ª<a href="https://twitter.com/WickyNilliams/status/798497274653503488">è€å¸–å­</a>è°ƒä¾ƒé“ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1690013919412.png" alt=""></p>
<pre><code class="language-js">// let inputClass = manager.options.inputClass
let { options: { inputClass } } = manager
</code></pre>
<p>ä¸å¯å¦è®¤ï¼ŒES6 çš„è§£æ„èµ‹å€¼ï¼ˆ<a href="https://tc39.es/ecma262/multipage/ecmascript-language-expressions.html#sec-destructuring-assignment">Destructuring Assignment</a>ï¼‰è¯­æ³•åœ¨æ—¥å¸¸å¼€å‘ä¸­å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ã€‚ä½†æ˜¯...</p>
<h2>çœ‹èµ·æ¥ä¸é”™</h2>
<p>æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œ</p>
<pre><code class="language-js">var store = {
  name: 'Apple Store Parc Central',
  national_code: '86',
  phone: '4006139742'
}
</code></pre>
<p>è‹¥è¦å°†å…¶å±æ€§å€¼èµ‹äºˆæ–°å˜é‡ï¼Œåœ¨ ES5 åŠä»¥å‰ï¼Œ</p>
<pre><code class="language-js">var name = store.name
var phone = store.phone
</code></pre>
<p>åœ¨ ES6 åŠä»¥åï¼Œ</p>
<pre><code class="language-js">const { name, phone } = store
const { national_code: nationalCode } = store
</code></pre>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œçœ‹èµ·æ¥å¾ˆä¸é”™ã€‚</p>
<h2>çœ‹èµ·æ¥è¿˜è¡Œ</h2>
<p>è‹¥æ˜¯ä¸€ä¸ªåµŒå¥—ç±»å‹çš„å¯¹è±¡ï¼Œ</p>
<pre><code class="language-js">const store = {
  name: 'Apple Store Parc Central',
  national_code: '86',
  phone: '4006139742',
  address: {
    province: 'Guangdong',
    city: 'Guangzhou',
    county: 'Tianhe',
    street: 'No. 218, Tianhe Road',
  }
}
</code></pre>
<p>ä¸€éƒ¨åˆ†åŒå­¦å¯èƒ½ä¼šè¿™æ ·ç”¨ï¼Œ</p>
<pre><code class="language-js">const { address: { province, city } } = store
</code></pre>
<p>è€Œæˆ‘ä¸ªäººæ›´åå‘äºï¼Œ</p>
<pre><code class="language-js">const { province, city } = store.address
</code></pre>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å‡è®¾æ•°æ®æº <code>store</code> æ¥è‡ªäºåˆ«å¤„ï¼Œå…¶ä¸­ <code>store.address</code> å¯èƒ½æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§ï¼Œä¸ºé¿å…è§£æ„å‡ºé”™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¸ºå…¶è®¾ç½®é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const { address: { province, city } = {} } = store

const { province, city } = store.address || {}
</code></pre>
<blockquote>
<p>ä¸ªäººè®¤ä¸ºåè€…æ›´ç›´è§‚ä¸€äº›ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹©å®ƒçš„åŸå› ä¹‹ä¸€ã€‚</p>
</blockquote>
<blockquote>
<p>å‰è€…è¿˜æœ‰ä¸ªé™·è¿›ï¼Œå¦‚æœ <code>store.address</code> ä¸º <code>null</code>ï¼Œé»˜è®¤å€¼å°±ä¸ç”Ÿæ•ˆï¼Œè‡ªç„¶è§£æ„ä¹Ÿä¼šå‡ºé”™ã€‚</p>
</blockquote>
<p>ä½†å¦‚æœè¦è·å–ä¸åŒå±‚çº§çš„å±æ€§æ—¶ï¼Œä¹Ÿä¼šåƒå‰é¢é‚£æ ·ç”¨ï¼Œ</p>
<pre><code class="language-js">const { name, address: { province, city } } = store
</code></pre>
<h2>çœ‹èµ·æ¥ä¸å¥½ï¼</h2>
<p>è‹¥å¯¹è±¡æ—¶ä¸€ä¸ªåµŒå¥—å¤šå±‚çš„å¯¹è±¡ï¼Œ</p>
<pre><code class="language-js">const store = {
  name: 'Apple Store Parc Central',
  national_code: '86',
  phone: '4006139742',
  address: {
    province: 'Guangdong',
    city: 'Guangzhou',
    county: 'Tianhe',
    street: 'No. 218, Tianhe Road',
  },
  activity: {
    today: {
      name: 'å…‰å½±æŠ€å·§ï¼šç”¨ iPhone æ‹æ‘„ç…§ç‰‡',
      description: 'ç”¨ iPhone æ‹å‡ºæ›´æ£’çš„ç…§ç‰‡å’Œè§†é¢‘ã€‚',
      start_at: '1690090200',
      end_at: '1690093800',
    },
  },
}
</code></pre>
<p>å°±å¯èƒ½ä¼šå‡ºç°è¿™ç§ä»¤äººæŠ“ç‹‚çš„å†™æ³•ï¼Œ</p>
<pre><code class="language-js">const {
  activity: {
    today: { start_at: startAt },
  },
} = store

// or
const { activity: { today: { start_at: startAt } = {} } = {} } = store
</code></pre>
<blockquote>
<p>ç»™äººçš„æ„Ÿè§‰æ˜¯ã€Œä¸ºäº†ç”¨è€Œç”¨ã€ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆä¸ç”¨æœ€åŸå§‹çš„æ–¹å¼ï¼Ÿå¿˜æœ¬äº†ï¼Ÿ</p>
<pre><code class="language-js">const startAt = store.activity.today.start_at
</code></pre>
<p>å³ä½¿è¿™æ ·ï¼Œå¯è¯»æ€§ä¹Ÿæ¯”å‰é¢çš„å¥½å§ï¼Œ</p>
<pre><code class="language-js">const { start_at: startAt } = store.activity.today
</code></pre>
<p>æ–°è¯­æ³•å›ºç„¶æ˜¯ä¸ºäº†è§£å†³æŸç§åœºæ™¯è€Œç”Ÿçš„ï¼Œä½†å…¶å¹¶éé€‚ç”¨äºæ‰€æœ‰åœºæ™¯çš„å•Šã€‚æœ‰å¥è¯æ€ä¹ˆè¯´æ¥ç€ï¼šã€Œå› åœ°åˆ¶å®œã€ã€‚</p>
<h2>é‚£åº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</h2>
<p>è§£æ„èµ‹å€¼è¯­æ³•å…è®¸æŒ‡å®šé»˜è®¤å€¼ã€‚ä½†å½“å±æ€§å€¼ä¸º <code>null</code> æ—¶ï¼Œå¹¶ä¸ä¼šèµ‹äºˆé»˜è®¤å€¼ã€‚å‡è®¾ä»¥ä¸‹ <code>store.activity</code> ä¸º <code>null</code> æ—¶ï¼Œè§£æ„ä¼šå‡ºé”™ï¼Œ</p>
<pre><code class="language-js">const { activity: { today: { start_at: startAt } = {} } = {} } = store
</code></pre>
<p>æˆ‘ä»¬å¯èƒ½è¿˜æ˜¯è¦è¿™æ ·å†™ï¼Œ</p>
<pre><code class="language-js">const startAt = store &amp;&amp; store.activity &amp;&amp; store.activity.today ? store.activity.today.start_at : undefined
</code></pre>
<p>åœ¨è¿™ç¯‡<a href="https://crunchtech.medium.com/object-destructuring-best-practice-in-javascript-9c8794699a0d">æ–‡ç« </a>æœ‰ä¸€ç§å†™æ³•ï¼Œ</p>
<pre><code class="language-js">const getPropValue = (obj, key) =&gt; {
  return key.split('.').reduce((o, x) =&gt; (o == undefined ? o : o[x]), obj)
}

const startAt = getPropValue(store, 'activity.today.start_at') // &quot;1690090200&quot;
</code></pre>
<p>å¯¹äºè·å–æ·±å±‚å±æ€§çš„æƒ…å†µï¼Œå¾ˆå¤šå·¥å…·åº“éƒ½æœ‰æä¾›ç°æˆçš„æ–¹æ³•ï¼Œæ„Ÿå…´è¶£å¯çœ‹ä¸‹å®ç°ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><a href="https://lodash.com/docs/4.17.15#get">Lodash - get</a></li>
<li><a href="https://licia.liriliri.io/docs.html#safeget">Licia - safeGet</a></li>
</ul>
<p>åæ¥ï¼ŒES2020 å¢åŠ äº†å¯é€‰é“¾ï¼ˆ<a href="https://tc39.es/ecma262/multipage/ecmascript-language-expressions.html#sec-optional-chains">Optional Chains</a>ï¼‰è¯­æ³• <code>?.</code>ï¼Œå°±å¯ä»¥è¿™æ ·å»å†™äº†ï¼š</p>
<pre><code class="language-js">const { province, city } = store?.address || {}

const startAt = store?.activity?.today?.start_at
</code></pre>
<blockquote>
<p>å½“æŸä¸ªå±æ€§å€¼ä¸ºç©ºå€¼ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Nullish">nullish</a>ï¼Œ<code>undefined</code> or <code>null</code>ï¼‰ï¼Œåˆ™çŸ­è·¯è¿”å› <code>undefined</code>ã€‚</p>
</blockquote>
<h2>æœ€å</h2>
<p>è§£æ„èµ‹å€¼è™½å¥½ï¼Œä½†ä¸è¦è´ªæ¯å“¦ï¼</p>
<!--

## References

- [Object destructuring best practice in Javascript](https://crunchtech.medium.com/object-destructuring-best-practice-in-javascript-9c8794699a0d)
- [Write Clean Code Using JavaScript Object Destructuring](https://betterprogramming.pub/write-clean-code-using-javascript-object-destructuring-3551302130e7)

-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç”¨å¥½ VS Code å¿«æ·é”®]]></title>
            <link>https://github.com/toFrankie/blog/issues/317</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/317</guid>
            <pubDate>Wed, 12 Jul 2023 06:37:01 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689503231616.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œç”¨å¥½å¿«æ·é”®ä¸€å®šç¨‹åº¦ä¸Šå¯æé«˜ç¼–ç æ•ˆç‡ã€‚</p>
<blo]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689503231616.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œç”¨å¥½å¿«æ·é”®ä¸€å®šç¨‹åº¦ä¸Šå¯æé«˜ç¼–ç æ•ˆç‡ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä»¥ macOS ä¸ºä¾‹ï¼Œéƒ¨åˆ†å¿«æ·é”®ç»„åˆæ–¹å¼ä¸ Windowsã€Linux å¹³å°å¯èƒ½ç•¥æœ‰<a href="https://code.visualstudio.com/docs/getstarted/keybindings#_keyboard-shortcuts-reference">å·®å¼‚</a>ã€‚</p>
</blockquote>
<blockquote>
<p>å¿«æ·é”®æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œä½†æ¯ä¸ªäººå¸¸ç”¨çš„ä¹Ÿå°±é‚£äº›ï¼Œæ— éœ€å¼ºè¿«è‡ªå·±ä¸€æ¬¡æ€§è®°ä½ï¼Œå¤šç”¨å°±ä¼šå½¢æˆè‚Œè‚‰è®°å¿†ã€‚</p>
</blockquote>
<details><summary>å±•å¼€/æ”¶èµ·ç›®å½•ï¼š</summary>
<ul>
<li>å¼€å§‹ä¹‹å‰</li>
<li>ç®¡ç†çª—å£</li>
<li>åˆ‡æ¢é¢æ¿</li>
<li>åˆ‡æ¢ä¾§æ </li>
<li>æœç´¢ä¸æ›¿æ¢
<ul>
<li>æœç´¢å†…å®¹</li>
<li>æ›¿æ¢å†…å®¹</li>
<li>æœç´¢æ–‡ä»¶</li>
</ul>
</li>
<li>ç¼–è¾‘åŒº
<ul>
<li>ç§»åŠ¨å…‰æ ‡</li>
<li>é€‰æ‹©æ–‡æœ¬</li>
<li>ç§»åŠ¨è¡Œ</li>
<li>æ’å…¥è¡Œ</li>
<li>æ“ä½œè¡Œ</li>
<li>åˆ é™¤</li>
<li>æ³¨é‡Š</li>
<li>æ ¼å¼åŒ–</li>
<li>æŠ˜å ä¸å±•å¼€ä»£ç </li>
<li>ä¿å­˜</li>
<li>æ’¤é”€ä¸æ¢å¤</li>
</ul>
</li>
<li>å‘½ä»¤é¢æ¿
<ul>
<li>å¸¸ç”¨å‘½ä»¤</li>
<li>é…ç½®å‘½ä»¤</li>
<li>æŸ¥çœ‹æ’ä»¶å‘½ä»¤</li>
</ul>
</li>
<li>é«˜é˜¶ç”¨æ³•
<ul>
<li>åœºæ™¯ä¸€</li>
<li>åœºæ™¯äºŒ</li>
</ul>
</li>
<li>References</li>
</ul>
</details>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå¼„æ¸…æ¥šå¿«æ·é”®çš„å¢åˆ æ”¹æŸ¥ï¼Œä»å·¦ä¸‹è§’çš„ã€Œç®¡ç† - é”®ç›˜å¿«æ·æ–¹å¼ã€æ‰“å¼€é¢æ¿ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689501877849.png" alt=""></p>
<p>å°†é¼ æ ‡ç§»è‡³å¯¹åº”å‘½ä»¤ï¼Œç„¶åå³é”®å¯å¯¹å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€é‡ç½®å¯¹åº”çš„é”®ç»‘å®šã€‚ç‚¹å‡»å·¦ä¾§ ICON ä¹Ÿå¯ä»¥å¢åŠ æˆ–ä¿®æ”¹ã€‚æŸ¥è¯¢åˆ™æœ‰ä»¥ä¸‹æ–¹å¼ä»»å›é€‰æ‹©ï¼š</p>
<ul>
<li><strong>æŒ‰å…³é”®è¯</strong>ï¼šè¾“å…¥å…³é”®è¯å¯ä»¥æœç´¢å‘½ä»¤ã€é”®ç»‘å®šã€å½“çš„å†…å®¹ï¼Œæ¯”å¦‚ <code>æŸ¥æ‰¾</code>ã€<code>find</code>ã€<code>cmd f</code> ç­‰ï¼ˆä¸­æ–‡æŸ¥æ‰¾éœ€å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼‰ã€‚</li>
<li><strong>æŒ‰æºåˆ†ç±»</strong>ï¼šåˆ†ä¸ºç”¨æˆ· <code>@source:user</code>ã€ç³»ç»Ÿ <code>@source:system</code>ã€æ’ä»¶ <code>@source:extension</code>ã€é»˜è®¤ <code>@source:default</code> å››ç±»ã€‚</li>
<li><strong>æŒ‰å½•åˆ¶é”®ç›˜</strong>ï¼šå…ˆç‚¹å‡»è¾“å…¥æ¡†å³ä¾§ç±»ä¼¼é”®ç›˜çš„ ICONï¼Œå†æŒ‰ä¸‹å¿«æ·é”®ï¼Œå¯å¿«é€Ÿæ£€ç´¢å¯¹åº”ç»‘å®šé”®ã€‚</li>
</ul>
<blockquote>
<p>é™¤äº†ä¿®æ”¹é”®ç»‘å®šä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¿®æ”¹ <code>When</code> æ¡ä»¶ã€‚</p>
</blockquote>
<p>éƒ¨åˆ†æ§åˆ¶é”®ä¸ç¬¦å·æ˜ å°„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">Keys</th>
<th style="text-align:left">Symbols</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Commad</td>
<td style="text-align:left">âŒ˜</td>
</tr>
<tr>
<td style="text-align:left">Control</td>
<td style="text-align:left">âŒƒ</td>
</tr>
<tr>
<td style="text-align:left">Shift</td>
<td style="text-align:left">â‡§</td>
</tr>
<tr>
<td style="text-align:left">Option</td>
<td style="text-align:left">âŒ¥</td>
</tr>
</tbody>
</table>
<p>ä¸€äº›ä¼šé‡‡ç”¨ä¸¤ç»„é”®ç»„åˆçš„æ–¹å¼ï¼šå…ˆç”¨ã€ŒâŒ˜ + Kã€è®°å½•ç¬¬ä¸€ç»„ç»„åˆé”®ï¼Œç„¶åå†æŒ‰ä¸‹å…¶ä»–é”®æˆ–ç»„åˆé”®ä»¥è®°å½•ç¬¬äºŒç»„ã€‚è¿™ç§ä¹ æƒ¯ä¼¼ä¹æºè‡ª <a href="https://opensource.com/resources/what-emacs">Emacs</a>ã€‚æ¯”å¦‚ã€ŒâŒ˜ + Kã€å’Œã€ŒâŒ˜ + Sã€ä¸¤ç»„ç»„åˆé”®æ¥æ‰“å¼€å¿«æ·é”®é¢æ¿ã€‚</p>
<h2>ç®¡ç†çª—å£</h2>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + ,</td>
<td style="text-align:left">æ‰“å¼€è®¾ç½®</td>
<td style="text-align:left">åœ¨ macOS é‡Œå‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½æ˜¯ä½¿ç”¨è¯¥å¿«æ·é”®æ‰“å¼€åå¥½è®¾ç½®çš„ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + R</td>
<td style="text-align:left">æ‰“å¼€æœ€è¿‘çš„æ–‡ä»¶</td>
<td style="text-align:left">ç”¨äºå¿«é€Ÿåˆ‡æ¢é¡¹ç›®ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + N</td>
<td style="text-align:left">æ–°å»ºçª—å£</td>
<td style="text-align:left">ä½¿ç”¨ âŒ˜ + R ä¼šè¦†ç›–å½“å‰çª—å£ï¼Œå¦‚æœä¸å¸Œæœ›è¦†ç›–å¯ç”¨è¿™ä¸ªã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + P</td>
<td style="text-align:left">æ˜¾ç¤ºå‘½ä»¤é¢æ¿</td>
<td style="text-align:left">æ‰€æœ‰çš„å‘½ä»¤åœ¨è¿™é‡Œéƒ½èƒ½æ‰¾åˆ°ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ âŒ˜ + W</td>
<td style="text-align:left">å…³é—­æ‰€æœ‰ç¼–è¾‘å™¨</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¯¹äºåœ¨æ–°çª—å£æ‰“å¼€é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>code /path/to/project</code> æ¥æ›¿ä»£ã€ŒâŒ˜ + â‡§ + Nã€å’Œã€ŒâŒ˜ + Rã€çš„ç»„åˆæ“ä½œã€‚ä½†è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œä¸ºæ­¤ç‰¹åœ°åšäº†ä¸€ä¸ª Alfred æ’ä»¶ï¼ˆ<a href="https://github.com/toFrankie/alfred-open-with-vscode">alfred-open-with-vscode</a>ï¼‰ï¼Œæ”¯æŒåœ¨æŒ‡å®šç›®å½•èŒƒå›´å†…æ£€ç´¢å¹¶æ‰“å¼€é¡¹ç›®ï¼Œè¿˜èƒ½å±•ç¤º VS Code æœ€è¿‘æ‰“å¼€è¿‡çš„é¡¹ç›®ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹äºé‡æ–°åŠ è½½çª—å£ï¼Œå¯ä»¥å…ˆã€ŒâŒ˜ + â‡§ + Pã€å”¤èµ·å‘½ä»¤é¢æ¿ï¼Œç„¶åè¾“å…¥å…³é”®è¯ã€ŒReload Windowã€ï¼Œå†ã€ŒReturnã€ç¡®è®¤å³å¯ã€‚ç±»ä¼¼æ’ä»¶æ›´æ–°ã€Lint è§„åˆ™è°ƒæ•´åæ²¡ç”Ÿæ•ˆç­‰åœºæ™¯ï¼Œå¯é€šè¿‡é‡æ–°åŠ è½½è§£å†³ã€‚</p>
</blockquote>
<h2>åˆ‡æ¢é¢æ¿</h2>
<p>ä¸»è¦ç”¨äºæ§åˆ¶ä¾§è¾¹é¢æ¿ã€åº•éƒ¨é¢æ¿çš„æ˜¾ç¤ºä¸éšè—ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + B</td>
<td style="text-align:left">æ˜¾ç¤º/éšè—ä¾§æ </td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + J</td>
<td style="text-align:left">æ˜¾ç¤º/éšè—åº•éƒ¨é¢æ¿</td>
<td style="text-align:left">å¯å¿«é€Ÿæ‰“å¼€å†…ç½®ç»ˆç«¯ã€è°ƒè¯•æ§åˆ¶å°ç­‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒƒ + `</td>
<td style="text-align:left">æ˜¾ç¤º/éšè—å†…ç½®ç»ˆç«¯</td>
<td style="text-align:left">ä¸ã€ŒâŒ˜+ Jã€ç±»ä¼¼ï¼Œå®ƒä¼šå®šä½è‡³ç»ˆç«¯é€‰é¡¹å¡ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¦‚æœæ˜¯ 108 é”®é”®ç›˜ï¼Œä¸ªäººæ›´å¤šç”¨ã€ŒâŒƒ + `ã€ã€‚è€Œ 87 é”®çš„è¿˜è¦é¢å¤–ç»„åˆã€Œfnã€é”®æ‰èƒ½å”¤èµ·å†…ç½®ç»ˆç«¯ï¼Œæ­¤æ—¶æ›´å¤šç”¨ã€ŒâŒ˜ + Jã€ã€‚</p>
</blockquote>
<h2>åˆ‡æ¢ä¾§æ </h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¾§æ æœ‰èµ„æºç®¡ç†å™¨ã€æœç´¢ã€æºä»£ç ç®¡ç†ã€è¿è¡Œå’Œè°ƒè¯•ã€æ‰©å±•ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + F</td>
<td style="text-align:left">åˆ‡æ¢è‡³æœç´¢</td>
<td style="text-align:left">ç”¨äºå…¨å±€æœç´¢ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + X</td>
<td style="text-align:left">åˆ‡æ¢è‡³æ’ä»¶</td>
<td style="text-align:left">æŸ¥çœ‹æ’ä»¶ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + E</td>
<td style="text-align:left">åˆ‡æ¢è‡³èµ„æºç®¡ç†å™¨</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + D</td>
<td style="text-align:left">åˆ‡æ¢è‡³è¿è¡Œå’Œè°ƒè¯•</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒƒ + â‡§ + G</td>
<td style="text-align:left">åˆ‡æ¢è‡³æºä»£ç ç®¡ç†</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>æœ‰ä¸€äº›ä¸ªäººç”¨å¾—ä¸ç®—å¤šã€‚æ¯”å¦‚ï¼Œåˆ‡æ¢è‡³èµ„æºç®¡ç†å™¨æŸ¥æ‰¾æ–‡ä»¶åœºæ™¯ï¼Œæˆ‘æ›´å¤šç”¨çš„æ˜¯ã€ŒâŒ˜ + Pã€æ›´å¿«åœ°åˆ‡æ¢æ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p>å…³äº ã€ŒâŒ˜ + â‡§ + Eã€æœ‰å¯èƒ½ä¼šä¸æœç‹—è¾“å…¥æ³•å†²çªï¼Œåè€…ä¼˜å…ˆçº§æ›´é«˜ï¼Œå¯åœ¨ã€Œæœç‹—è¾“å…¥æ³• - åå¥½è®¾ç½® - æŒ‰é”® - å¿«æ·åŠŸèƒ½ - è‹±æ–‡è¾“å…¥æ³•ã€å¤„ç¦ç”¨ã€‚</p>
</blockquote>
<h2>æœç´¢ä¸æ›¿æ¢</h2>
<p>åŒ…æ‹¬æœç´¢æ–‡ä»¶ï¼ˆå†…å®¹ï¼‰ã€æ›¿æ¢å†…å®¹ç­‰ã€‚</p>
<h3>æœç´¢å†…å®¹</h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + F</td>
<td style="text-align:left">åˆ‡æ¢è‡³æœç´¢</td>
<td style="text-align:left">å…¨å±€æœç´¢ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + F</td>
<td style="text-align:left">æ–‡ä»¶å†…æœç´¢</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h3>æ›¿æ¢å†…å®¹</h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + H</td>
<td style="text-align:left">åˆ‡æ¢è‡³æœç´¢æ å¹¶å±•å¼€æ›¿æ¢</td>
<td style="text-align:left">å…¨å±€æ›¿æ¢ã€‚ç›¸æ¯”ã€ŒâŒ˜ + â‡§ + Fã€ï¼Œå®ƒä¼šè‡ªåŠ¨å±•ç¤ºæ›¿æ¢è¾“å…¥æ¡†ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + L</td>
<td style="text-align:left">é€‰æ‹©æ‰€æœ‰åŒ¹é…é¡¹</td>
<td style="text-align:left">å½“å‰æ–‡ä»¶èŒƒå›´ã€‚æ˜¯ã€ŒâŒ˜ + Fã€åŠ ä¸ŠåŒºåˆ†å¤§å°å†™å’Œå…¨å­—åŒ¹é…ï¼Œç„¶åæ›¿æ¢çš„ä¸€ç§æ›´å¿«çš„æ–¹æ¡ˆã€‚</td>
</tr>
<tr>
<td style="text-align:left">F2</td>
<td style="text-align:left">é‡å‘½åç¬¦åˆ</td>
<td style="text-align:left">å¯ä»¥å¯¹å®šä¹‰å¤„ã€å¼•ç”¨å¤„çš„å±æ€§/æ–¹æ³•è¿›è¡ŒåŒæ­¥ä¿®æ”¹ï¼Œè´¼æ–¹ä¾¿ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å‡è®¾å½“å‰æ–‡ä»¶æœ‰ <code>setStorage</code>ã€ <code>setStorageSync</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†ä¸å°å¿ƒæŠŠ <code>setStorage</code> é”™å†™ä¸º <code>setStroage</code> äº†ï¼Œæ­¤æ—¶å¯ä»¥å°†å…‰æ ‡ç§»è‡³ <code>setStroage</code> ä¸­é—´ï¼ŒæŒ‰ä¸‹ã€ŒâŒ˜ + â‡§ + Lã€å¿«é€Ÿé€‰ä¸­å½“å‰æ–‡ä»¶æ‰€æœ‰åŒ¹é…çš„æ–‡æœ¬ï¼Œå¯ä»¥è¿›è¡Œæ‰¹é‡ä¿®æ­£ã€‚</p>
</blockquote>
<blockquote>
<p>å‡è®¾ä¸Šè¿°æ–‡ä»¶ <code>setStroage</code> æ˜¯å¼•ç”¨è‡ªå…¶ä»–æ–‡ä»¶ï¼Œæ›´å¥½çš„æ“ä½œå¯èƒ½æ˜¯å³é”®é€‰æ‹©ã€Œé‡å‘½åç¬¦å· F2ã€çš„æ–¹å¼è¿›è¡Œä¿®æ­£ï¼Œå®ƒå¯ä»¥å¯¹å®šä¹‰å¤„çš„æ–¹æ³•åç§°è¿›è¡ŒåŒæ­¥ä¿®æ”¹ã€‚</p>
</blockquote>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œé‡å‘½åç¬¦åˆä¸ä½œç”¨åŸŸæœ‰å…³ï¼Œè¿™ç‚¹ä¸ã€ŒâŒ˜ + â‡§ + Lã€æ˜¯æœ‰åŒºåˆ«çš„ã€‚å‡è®¾å‡½æ•°å†…å¤–å„å®šä¹‰äº†ä¸€ä¸ª <code>setStroage</code> æ–¹æ³•ï¼Œå¦‚æœå¯¹å‡½æ•°å†…çš„è¿›è¡Œé‡å‘½åï¼Œå®ƒåªä¼šä¿®æ”¹å‡½æ•°å†…çš„ï¼Œè€Œå‡½æ•°å¤–çš„åˆ™ä¸ä¼šä¿®æ”¹ã€‚</p>
</blockquote>
<h3>æœç´¢æ–‡ä»¶</h3>
<p>å¯¹äºæ–‡ä»¶æ•°å¤šã€ç›®å½•å±‚çº§æ·±çš„é¡¹ç›®ï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªåœ°åœ¨èµ„æºç®¡ç†å™¨é¢æ¿ä¸­å±•å¼€æŸ¥æ‰¾ï¼Œæ˜¾å¾—æœ‰ç‚¹æ…¢ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + P</td>
<td style="text-align:left">è½¬åˆ°æ–‡ä»¶</td>
<td style="text-align:left">ç”¨äºå¿«é€Ÿæ‰“å¼€æŸæ–‡ä»¶ã€‚</td>
</tr>
</tbody>
</table>
<h2>ç¼–è¾‘åŒº</h2>
<p>å¹³å¸¸å¼€å‘ä¸­ï¼Œä¸»è¦éƒ½èšç„¦åœ¨æ–‡ä»¶ç¼–è¾‘åŒºä¸­ï¼ŒæŒæ¡ä¸€äº›å¸¸ç”¨çš„å¿«æ·é”®å¾ˆæœ‰å¿…è¦ã€‚</p>
<h3>ç§»åŠ¨å…‰æ ‡</h3>
<p>åˆ—ä¸¾ä¸€äº›å¸¸è§çš„ç§»åŠ¨å…‰æ ‡åœºæ™¯ï¼š</p>
<ul>
<li>ä»¥å•è¯ä¸ºå•ä½è¿›è¡Œå·¦ç§»ã€å³ç§»</li>
<li>ç§»åŠ¨è‡³è¡Œé¦–ã€è¡Œå°¾</li>
<li>ç§»åŠ¨è‡³æ–‡ä»¶å¼€å¤´ã€æœ«å°¾</li>
<li>ç§»åŠ¨è‡³ä»£ç å—èµ·å§‹ã€ç»“æŸ</li>
<li>ç§»åŠ¨è‡³æŒ‡å®šè¡Œã€åˆ—</li>
<li>è¿”å›è‡³ä¸Šä¸€ä¸ªä½ç½®ã€å‰è¿›è‡³ä¸‹ä¸€ä¸ªä½ç½®</li>
<li>......</li>
</ul>
<h4>å¸¸è§„</h4>
<p>å¦‚æœç”¨æ–¹å‘é”®ä¸€ä¸ªä¸€ä¸ªåœ°ç§»åŠ¨ï¼Œå¯¹äºä¸€äº›è¾ƒé•¿çš„å˜é‡åã€å±æ€§ã€æ–¹æ³•ç­‰ï¼Œæ˜¾ç„¶å¾ˆä¸å‹å¥½ã€‚å¦‚æœç”¨é¼ æ ‡ï¼Œè¦ç»å†ç¦»å¼€é”®ç›˜ â†’ æ»‘åŠ¨é¼ æ ‡ â†’ å›åˆ°é”®ç›˜çš„è¿‡ç¨‹ï¼Œä¹Ÿçƒ¦ã€‚<strong>ä»…ç”¨ã€Œå·¦/å³æ–¹å‘é”®ã€æ¥ç§»åŠ¨å…‰æ ‡ï¼Œæ˜¯ä»¥ã€Œå•ä¸ªå­—ç¬¦ã€ä¸ºé¢—ç²’åº¦è¿›è¡Œç§»åŠ¨çš„ã€‚å¦‚æœä»¥ã€ŒOption + å·¦/å³æ–¹å‘é”®ã€ç»„åˆçš„è¯ï¼Œå…¶é¢—ç²’åº¦å˜ä¸ºã€Œå•è¯ã€ï¼Œä»¥å®ç°å¿«é€Ÿç§»åŠ¨çš„ç›®çš„ã€‚</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ¥ + â†</td>
<td style="text-align:left">ä»¥ã€Œå•è¯ã€ä¸ºé¢—ç²’åº¦å‘å·¦ç§»åŠ¨</td>
<td style="text-align:left">å¯¹äºå˜é‡ã€å±æ€§ã€æ–¹æ³•åç§°è¿‡é•¿çš„æƒ…å†µï¼Œç‰¹æ–¹ä¾¿ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â†’</td>
<td style="text-align:left">ä»¥ã€Œå•è¯ã€ä¸ºé¢—ç²’åº¦å‘å³ç§»åŠ¨</td>
<td style="text-align:left">åŒä¸Šã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â†</td>
<td style="text-align:left">ç§»åŠ¨è‡³è¡Œé¦–</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â†’</td>
<td style="text-align:left">ç§»åŠ¨è‡³è¡Œå°¾</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â†‘</td>
<td style="text-align:left">ç§»åŠ¨è‡³æ–‡ä»¶å¼€å¤´</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â†“</td>
<td style="text-align:left">ç§»åŠ¨è‡³æ–‡ä»¶æœ«å°¾</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">PageUp</td>
<td style="text-align:left">å‘ä¸Šç¿»é¡µ</td>
<td style="text-align:left">ä¸€æ¬¡ç§»åŠ¨çº¦ 25 è¡Œã€‚</td>
</tr>
<tr>
<td style="text-align:left">PageDown</td>
<td style="text-align:left">å‘ä¸‹ç¿»é¡µ</td>
<td style="text-align:left">åŒä¸Šã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¦‚æœè·³åˆ°è¡Œé¦–/è¡Œå°¾ï¼Œç„¶å Return ä»¥åœ¨ä¸Šæ–¹/ä¸‹æ–¹æ’å…¥ç©ºè¡Œï¼Œé‚£ä¹ˆç”¨ã€ŒâŒ˜ + Returnã€å’Œã€ŒâŒ˜ + â‡§ + Returnã€æˆ–è®¸æ›´å¿«å“¦ï¼</p>
</blockquote>
<blockquote>
<p>å¯¹äºç§»åŠ¨è‡³è¡Œé¦–/è¡Œå°¾ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ã€ŒHomeã€æˆ–ã€ŒEndã€é”®ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœæœ‰äº›é”®ç›˜æ²¡æœ‰ PageUp/PageDownï¼Œå¯ä»¥å°è¯•ç”¨ã€Œfn + â†‘ã€å’Œã€Œfn + â†“ã€è¿›è¡Œç¿»é¡µã€‚</p>
</blockquote>
<h4>ä»£ç å—ç›¸å…³</h4>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿåˆ‡æ¢è‡³ä»£ç å—çš„èµ·å§‹ã€ç»“æŸä½ç½®ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + \</td>
<td style="text-align:left">è½¬åˆ°æ‹¬å·</td>
<td style="text-align:left">æ”¯æŒ <code>{}</code>ã€<code>()</code> ä¸¤ç±»æ‹¬å·ï¼Œå¯å¿«é€Ÿåˆ‡æ¢è‡³å°±è¿‘æ‹¬å·çš„å¼€å¤´/ç»“å°¾ä½ç½®ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ”¯æŒå¤šç§è¯­è¨€ï¼Œæ¯”å¦‚ï¼ŒJavaScript çš„å‡½æ•°ã€æ¡ä»¶è¯­å¥ï¼ŒCSS çš„é€‰æ‹©å™¨ç­‰ã€‚</p>
</blockquote>
<h4>è·³è½¬ç›¸å…³</h4>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒƒ + G</td>
<td style="text-align:left">è½¬åˆ°è¡Œã€åˆ—</td>
<td style="text-align:left">ç”¨äºè°ƒè¯•æ’é”™ç­‰åœºæ™¯ï¼Œå¯ä»¥æ ¹æ® Error å †æ ˆä¿¡æ¯ä¸­çš„è¡Œåˆ—å¿«é€Ÿé”å®šæºæ–‡ä»¶ä½ç½®ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒƒ + -</td>
<td style="text-align:left">è¿”å›</td>
<td style="text-align:left">æ¯”å¦‚ï¼Œä½¿ç”¨ã€ŒâŒ˜ + Clickã€æˆ– ã€ŒF12ã€è·³è½¬è‡³æŸä¸ªå‡½æ•°å®šä¹‰çš„åœ°æ–¹ï¼Œå†è¿”å›æ—¶å°±ç‰¹åˆ«æ–¹ä¾¿ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒƒ + â‡§ + -</td>
<td style="text-align:left">å‰è¿›</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>è·³è½¬è‡³æŒ‡å®šè¡Œåˆ—ï¼Œå…¶å½¢å¼å¦‚ <code>137:15</code>ï¼Œè¡¨ç¤ºè·³è½¬è‡³ç¬¬ 137 è¡Œã€ç¬¬ 15 åˆ—ã€‚è‹¥ä¸éœ€è¦æŒ‡å®šåˆ—ï¼Œå¯çœç•¥åˆ—ã€‚</p>
</blockquote>
<blockquote>
<p>è¿”å›/å‰è¿›æ”¯æŒè·¨æ–‡ä»¶ä¹‹é—´åˆ‡æ¢ã€‚æ¯”å¦‚ï¼ŒJavaScript ä¸­ A.js ä½¿ç”¨äº† B.js æ–‡ä»¶ä¸­çš„ <code>updateUserInfo()</code> æ–¹æ³•ï¼Œå‡è®¾è¦çœ‹è¯¥å‡½æ•°å…·ä½“å®ç°è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ä½ âŒ˜ é”®ç‚¹å‡»è·³è½¬è‡³å‡½æ•°å®šä¹‰çš„ä½ç½®ï¼Œçœ‹å®Œåè¦åŸè·¯è¿”å›çš„è¯ï¼Œåªéœ€è¦ã€ŒâŒƒ + -ã€å°±èƒ½è¿”å› A.js å¼•ç”¨çš„ä½ç½®ã€‚</p>
</blockquote>
<h4>å¤šå…‰æ ‡ç›¸å…³</h4>
<p>åˆ›å»ºå¤šå…‰æ ‡çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>æŒ‰ä½ã€ŒâŒ¥ã€é”®ï¼Œç„¶åé¼ æ ‡åœ¨å¯¹åº”ä½ç½®ç‚¹å‡»ã€‚</li>
<li>ä½¿ç”¨å¿«æ·é”®ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + âŒ¥ + â†‘</td>
<td style="text-align:left">åœ¨ä¸Šæ–¹æ·»åŠ å…‰æ ‡</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + âŒ¥ + â†“</td>
<td style="text-align:left">åœ¨ä¸‹æ–¹æ·»åŠ å…‰æ ‡</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + I</td>
<td style="text-align:left">åœ¨è¡Œå°¾æ·»åŠ å…‰æ ‡</td>
<td style="text-align:left">å‰ææ˜¯è¦é€‰ä¸­å¤šè¡Œã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ’¤é”€å…‰æ ‡ï¼Œå¯ä»¥ä½¿ç”¨ã€ŒâŒ˜ + Uã€ï¼Œä¹Ÿå¯æŒ‰ä½ã€ŒâŒ¥ã€åœ¨å¯¹åº”ä½ç½®ç‚¹å‡»ä»¥å–æ¶ˆã€‚</p>
</blockquote>
<blockquote>
<p>å…¶å®å¤šå…‰æ ‡æœ€ç»ˆç›®çš„æ˜¯æ‰¹é‡æ“ä½œï¼Œåº”ä¼˜å…ˆè€ƒè™‘æ‰¹é‡é€‰æ‹©æ–‡æœ¬çš„å¿«æ·æ–¹å¼ã€‚è‹¥ä¸æ»¡è¶³ï¼Œå†ä½¿ç”¨å¤šå…‰æ ‡ã€‚</p>
</blockquote>
<blockquote>
<p>æˆ‘æ˜¯è§‰å¾—ã€ŒâŒ¥ + â‡§ + Iã€ç¨å¾®æœ‰ç‚¹é¸¡è‚‹çš„ã€‚å°±æ˜¯é€‰ä¸­å¤šè¡Œæ—¶ï¼Œæœ€åä¸€è¡Œé€‰ä¸­çš„æ–‡æœ¬ä¸€å®šè¦æ˜¯è¡Œå°¾ï¼Œå¦åˆ™äº§ç”Ÿçš„å¤šå…‰æ ‡ä¸­çš„æœ€åä¸€ä¸ªä¸ä¼šåœ¨è¡Œå°¾ã€‚ä½†ä¸€èˆ¬ç”¨é¼ æ ‡æ‹–åŠ¨ä»¥é€‰ä¸­å¤šè¡Œæ—¶ï¼Œä¼šä»æœ«å°¾å¤„å¼€å§‹æˆ–ç»“æŸï¼Œä¹Ÿé—®é¢˜ä¸å¤§ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è¦å°† <code>data</code> æ‰¹é‡ä¿®æ”¹ä¸º <code>prize</code>ã€‚</p>
<p>ä½¿ç”¨é¼ æ ‡æ˜¯è¿™æ ·å­çš„ ğŸ‘‡ï¼Œè¿˜è¦å°å¿ƒç¿¼ç¿¼åœ°ï¼Œç”Ÿæ€•ç‚¹é”™ä½ç½®ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689482299653.gif" alt=""></p>
<blockquote>
<p>å¦‚æœåˆ—å¯¹é½ï¼Œä½¿ç”¨ã€ŒâŒ˜ + âŒ¥ + â†“ã€ä¼šå¥½ä¸€äº›ã€‚ä½†ä¸å¯¹é½ä¹Ÿèƒ½ç”¨ï¼Œæ¯”å¦‚å…ˆã€ŒâŒ˜ + âŒ¥ + â†“ã€åˆ›å»º 4 ä¸ªå…‰æ ‡ï¼Œç„¶åä½¿ç”¨ã€ŒâŒ˜ + â†’ã€å°†æ‰€æœ‰å…‰æ ‡æ‰¹é‡ç§»è‡³è¡Œå°¾ï¼Œå†æ“ä½œã€‚è¿™äº›éƒ½æ˜¯å¯ä»¥è‡ªç”±ç»„åˆçš„ï¼ŒæŒ‰éœ€ä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨å½•å±æˆ–å±å¹•å…±äº«æ—¶ï¼Œå¯ä»¥åˆ‡æ¢è‡³ã€Œå±å¹•æ¨¡å¼ã€ä»¥å±•ç¤ºå½“å‰æŒ‰ä¸‹çš„å¿«æ·é”®ï¼Œæ–¹æ³•æ˜¯ï¼šå…ˆã€ŒâŒ˜ + â‡§ + Pã€ï¼Œå†è¾“å…¥ã€ŒToggle Screencast Modeã€ï¼Œå…³é—­åŒç†ã€‚</p>
</blockquote>
<p>åˆ©ç”¨ã€ŒâŒ˜ + Dã€æ˜¯è¿™æ ·çš„ ğŸ‘‡ï¼Œå¯¹äºç¤ºä¾‹ä¸­ï¼Œåˆ—ä¸å¯¹é½çš„åœºæ™¯æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689482839225.gif" alt=""></p>
<p>åˆ©ç”¨ã€ŒâŒ˜ + â‡§ + Lã€æ˜¯è¿™æ ·çš„ ğŸ‘‡ï¼Œæ›´å¿«ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689483179738.gif" alt=""></p>
<blockquote>
<p>å…³äºã€ŒâŒ˜ + Dã€çš„ä»‹ç»åœ¨é€‰æ‹©æ–‡æœ¬ç« èŠ‚ï¼Œä¹Ÿå¯å…ˆè·³è¿‡å†å›æ¥çœ‹ã€‚</p>
</blockquote>
<h3>é€‰æ‹©æ–‡æœ¬</h3>
<p>å‰é¢ä»‹ç»äº†å…‰æ ‡ç§»åŠ¨ï¼Œé€šå¸¸æ˜¯ã€ŒâŒ˜/âŒ¥ + æ–¹å‘é”®ã€çš„å½¢å¼ã€‚åªè¦å†åŠ ä¸Šã€ŒShiftã€é”®å°±èƒ½å¿«é€Ÿé€‰æ‹©ã€Œå…‰æ ‡èµ·å§‹ä½ç½®åˆ°ä¸‹ä¸€ä¸ªä½ç½®çš„æ–‡æœ¬ã€ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + â†</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³å·¦ä¾§å•è¯è¾¹ç•Œä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + â†’</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³å³ä¾§å•è¯è¾¹ç•Œä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + â†</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³è¡Œé¦–ä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + â†’</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³è¡Œé¦–ä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + â†‘</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³æ–‡ä»¶å¼€å¤´ä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + â†“</td>
<td style="text-align:left">é€‰æ‹©èµ·å§‹ä½ç½®è‡³æ–‡ä»¶å¼€å¤´ä¹‹é—´çš„æ–‡æœ¬</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + D</td>
<td style="text-align:left">å°†ä¸‹ä¸€ä¸ªæŸ¥æ‰¾åŒ¹é…é¡¹æ·»åŠ åˆ°é€‰æ‹©</td>
<td style="text-align:left">å¤šæ¬¡ç‚¹å‡»å¯ä»¥é€‰æ‹©å¤šä¸ªåŒ¹é…é¡¹ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¯¹äºã€ŒâŒ¥ + â‡§ + â†ã€æˆ–ã€ŒâŒ¥ + â‡§ + â†’ã€ï¼Œå¯è¿ç»­å¤šæ¬¡ä»¥é€‰æ‹©æ›´å¤šçš„æ–‡æœ¬ã€‚</p>
</blockquote>
<p>å‡è®¾å…‰æ ‡åœåœ¨ <code>updateUserInfo</code> çš„ <code>eU</code> ä¸­é—´ï¼Œå¦‚ä½•å¿«é€Ÿé€‰æ‹© <code>updateUserInfo</code> æ–‡æœ¬ï¼Ÿ</p>
<pre><code class="language-js">async function doSomething() {
  await updateUserInfo(data)
  // ...
}
</code></pre>
<p>æ–¹æ³•å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å…ˆã€ŒâŒ¥ + â†’ã€ç§»åŠ¨è‡³æ–‡æœ¬å³ä¾§ï¼Œç„¶åã€ŒâŒ¥ + â‡§ + â†ã€é€‰ä¸­æ•´ä¸ªæ–‡æœ¬ã€‚</li>
<li>å…ˆã€ŒâŒ¥ + â‡§ + â†’ã€é€‰ä¸­å…‰æ ‡å³ä¾§æ–‡æœ¬ï¼Œç„¶åã€ŒâŒ¥ + â‡§ + â†ã€é€‰ä¸­æ•´ä¸ªæ–‡æœ¬ã€‚</li>
<li>ç›´æ¥ã€ŒâŒ˜ + Dã€é€‰ä¸­ã€‚</li>
<li>ç›´æ¥ã€ŒâŒƒ + â‡§ + â†’ã€é€‰ä¸­ã€‚</li>
<li>......</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒƒ + â‡§ + â†</td>
<td style="text-align:left">æ”¶èµ·é€‰æ‹©</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒƒ + â‡§ + â†’</td>
<td style="text-align:left">å±•å¼€é€‰æ‹©</td>
<td style="text-align:left">ç”¨æ¥é€‰æ‹© URL ç‰¹æ–¹ä¾¿ã€‚</td>
</tr>
</tbody>
</table>
<p>å¯ç”¨æ¥å¿«é€Ÿæ”¶ç¼©/æ‰©å±•é€‰ä¸­æ–‡æœ¬ï¼Œä¹Ÿæ˜¯ä»¥å•è¯ä¸ºé¢—ç²’åº¦çš„ï¼Œçœ‹å›¾æ„Ÿå—ä¸€ä¸‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689427565251.gif" alt=""></p>
<blockquote>
<p>å¦‚æœå•çº¯æƒ³è¦æ‹·è´å½“å‰è¡Œï¼Œæ— éœ€é€‰ä¸­ï¼Œç›´æ¥ã€ŒâŒ˜ + Cã€å³å¯ã€‚ä½†ä¸çˆ½çš„æ˜¯ï¼Œæ‹·è´çš„æ–‡æœ¬ä¸­åŒ…å«å‰å¯¼ç¼©è¿›ç©ºæ ¼å’Œå°¾éšæ¢è¡Œç¬¦ã€‚</p>
</blockquote>
<h3>ç§»åŠ¨è¡Œ</h3>
<p>ç§»åŠ¨è¡Œè¿˜æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ¯”å¦‚ç”¨æ¥å¯¹è°ƒä¸¤è¡Œä¹‹é—´çš„ä½ç½®ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ¥ + â†‘</td>
<td style="text-align:left">å‘ä¸Šç§»åŠ¨è¡Œ</td>
<td style="text-align:left">é™¤äº†å•è¡Œï¼Œè¿˜æ”¯æŒé€‰ä¸­å¤šè¡Œè¿›è¡Œç§»åŠ¨ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â†“</td>
<td style="text-align:left">å‘ä¸Šç§»åŠ¨è¡Œ</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + [</td>
<td style="text-align:left">å‘å·¦è¡Œç¼©è¿›</td>
<td style="text-align:left">å½“å…‰æ ‡ä¸åœ¨è¡Œé¦–æ—¶ï¼Œå¥½ç”¨ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + ]</td>
<td style="text-align:left">å‘å³è¡Œç¼©è¿›</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¯¹äºå‘å·¦/å‘å³è¡Œç¼©è¿›ï¼Œå®é™…ä¸­æ›´å¤šçš„æ˜¯å¼€å¯ <code>&quot;editor.formatOnSave&quot;: true</code> åœ¨ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ã€‚</p>
</blockquote>
<h3>æ’å…¥è¡Œ</h3>
<p>ä½ æ·»åŠ æ–°è¡Œçš„æ–¹å¼ï¼Œè¿˜æ˜¯å…ˆç§»åŠ¨å…‰æ ‡è‡³è¡Œå°¾å—ï¼Ÿ</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + Return</td>
<td style="text-align:left">åœ¨ä¸‹æ–¹æ’å…¥è¡Œ</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + Return</td>
<td style="text-align:left">åœ¨ä¸Šæ–¹æ’å…¥è¡Œ</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>éƒ¨åˆ†é”®ç›˜åˆç§°ä¸ºã€ŒEnterã€é”®ã€‚</p>
</blockquote>
<h3>æ“ä½œè¡Œ</h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒƒ + J</td>
<td style="text-align:left">åˆå¹¶è¡Œ</td>
<td style="text-align:left">æ¯”å¦‚é“¾å¼è°ƒç”¨æ—¶ï¼Œå¯ä»¥é€‰ä¸­å¤šè¡Œç„¶åå¿«æ·é”®åˆå¹¶ä¸ºä¸€è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + â†“</td>
<td style="text-align:left">å‘ä¸‹å¤åˆ¶è¡Œ</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + â†‘</td>
<td style="text-align:left">å‘ä¸Šå¤åˆ¶è¡Œ</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å‘ä¸Š/ä¸‹å¤åˆ¶è¡Œï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºæœ€ç»ˆå…‰æ ‡åœç•™åœ¨å“ªè€Œå·²ã€‚</p>
</blockquote>
<h3>åˆ é™¤</h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + K</td>
<td style="text-align:left">åˆ é™¤æ‰€åœ¨è¡Œ</td>
<td style="text-align:left">æ”¯æŒé€‰ä¸­å¤šè¡Œåˆ é™¤ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + Delete</td>
<td style="text-align:left">åˆ é™¤å…‰æ ‡å·¦ä¾§å†…å®¹</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + fn + Delete</td>
<td style="text-align:left">åˆ é™¤å…‰æ ‡å³ä¾§å†…å®¹</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…¶ä¸­ã€ŒâŒ˜ + fn + Deleteã€å®è´¨ä¸Šæ˜¯ã€ŒâŒ˜ + Backspaceã€ã€‚</p>
</blockquote>
<h3>æ³¨é‡Š</h3>
<p>å…¶å®è¿™ä¸ªåº”è¯¥ä¸ç”¨å¤šè¯´ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + /</td>
<td style="text-align:left">è¡Œæ³¨é‡Š</td>
<td style="text-align:left">æ”¯æŒé€‰ä¸­å¤šè¡Œæ“ä½œã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + A</td>
<td style="text-align:left">å—æ³¨é‡Š</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å—æ³¨é‡Šä¸ªäººç”¨å¾—ä¸å¤šã€‚</p>
</blockquote>
<h3>æŠ˜å ä¸å±•å¼€ä»£ç </h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + âŒ¥ + [</td>
<td style="text-align:left">æŠ˜å æ‰€åœ¨åŒºåŸŸçš„ä»£ç å—</td>
<td style="text-align:left">å¤šæ¬¡å¯å‘ä¸Šä¸€çº§æŠ˜å ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + âŒ¥ + ]</td>
<td style="text-align:left">å±•å¼€æ‰€åœ¨åŒºåŸŸçš„ä»£ç å—</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ âŒ˜ + -</td>
<td style="text-align:left">æŠ˜å é™¤æ‰€åœ¨åŒºåŸŸä¹‹å¤–çš„æ‰€æœ‰åŒºåŸŸ</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ âŒ˜ + J</td>
<td style="text-align:left">å…¨éƒ¨å±•å¼€</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ âŒ˜ + 0</td>
<td style="text-align:left">å…¨éƒ¨æŠ˜å </td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…¨éƒ¨æŠ˜å å…¶å®ä¸å¤ªå¥½ç”¨ã€‚</p>
</blockquote>
<h3>æ ¼å¼åŒ–</h3>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ¥ + â‡§ + F</td>
<td style="text-align:left">æ ¼å¼åŒ–æ–‡æ¡£</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ âŒ˜ + F</td>
<td style="text-align:left">æ ¼å¼åŒ–é€‰ä¸­å†…å®¹</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>æœ¬äººå‡ ä¹ä¸ç”¨ï¼Œä¼šå¼€å¯ <code>&quot;editor.formatOnSave&quot;: true</code> åœ¨ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ã€‚</p>
</blockquote>
<h3>ä¿å­˜</h3>
<p>è‡³äºã€ŒâŒ˜ + Sã€å°±ä¸è¯´äº†ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + âŒ¥ + S</td>
<td style="text-align:left">ä¿å­˜æ‰€æœ‰</td>
<td style="text-align:left">æœ‰æ—¶å€™åšå°ç¨‹åºå¼€å‘æ—¶ï¼Œå‡å°‘é‡æ–°ç¼–è¯‘æ¬¡æ•°ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + K å’Œ S</td>
<td style="text-align:left">ä¿å­˜ä½†ä¸æ ¼å¼åŒ–</td>
<td style="text-align:left">æœ‰æ—¶å€™ä¿®æ”¹æŸäº›æ–‡ä»¶ï¼Œä½†åˆä¸å¸Œæœ›åœ¨ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œç‰¹åˆ«å¥½ç”¨ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¯¹äºã€Œä¿å­˜ä½†ä¸æ ¼å¼åŒ–ã€ï¼Œä¸ªäººæ›´å–œæ¬¢åœ¨å‘½ä»¤é¢æ¿é”®å…¥ã€ŒSave without Formattingã€æ¥å¤„ç†ï¼Œå› ä¸ºå‘½ä»¤é¢æ¿ä¼šè®°å½•æœ€è¿‘ä½¿ç”¨çš„å‘½ä»¤ã€‚</p>
</blockquote>
<h3>æ’¤é”€ä¸æ¢å¤</h3>
<p>å…¶å®è¿™ä¸ªä¹Ÿä¸ç”¨è¯´çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»‘å®šé”®</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">ä½¿ç”¨åœºæ™¯/è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">âŒ˜ + Z</td>
<td style="text-align:left">æ’¤é”€</td>
<td style="text-align:left">ä¹Ÿæ”¯æŒå…¨å±€æ›¿æ¢æ“ä½œçš„æ’¤é”€ã€‚</td>
</tr>
<tr>
<td style="text-align:left">âŒ˜ + â‡§ + Z</td>
<td style="text-align:left">æ¢å¤</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>ä»¥ä¸Šå°±æ˜¯ç¼–è¾‘åŒºä¸­å¸¸è§çš„å¿«æ·é”®ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥è‡ªç”±ç»„åˆçš„ï¼Œå¯å®ç°å¾ˆå¤šå¿«æ·æ“ä½œã€‚</p>
<h2>å‘½ä»¤é¢æ¿</h2>
<blockquote>
<p>å…¶å®å‘½ä»¤é¢æ¿æ˜¯éå¸¸å¥½ç”¨çš„ï¼Œé™¤äº†é”®å…¥æ—¶è‡ªåŠ¨è”æƒ³å¤–ï¼Œå®ƒä¼šè®°å½•æœ€è¿‘ä½¿ç”¨çš„å‘½ä»¤ï¼Œä½¿ç”¨æ•ˆç‡å¾ˆé«˜ã€‚</p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨ã€ŒâŒ˜ + â‡§ + Pã€æˆ–ã€ŒâŒ˜ + Pã€å¯å”¤èµ·å‘½ä»¤é¢æ¿ã€‚åè€…åœ¨è¾“å…¥æ¡†å†…é”®å…¥ <code>&gt;</code> å°±èƒ½åˆ‡æ¢è‡³å‘½ä»¤æ¨¡å¼ã€‚åŒç†ï¼Œå‰è€…åœ¨è¾“å…¥æ¡†å»æ‰å‰å¯¼çš„ <code>&gt;</code> å¯åˆ‡æ¢è‡³æ–‡ä»¶æœç´¢æ¨¡å¼ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹ä»‹ç»ä¸€äº›æœ¬äººå¸¸ç”¨çš„æ’ä»¶åŠå‘½ä»¤ã€‚</p>
<h4>å¸¸ç”¨å‘½ä»¤</h4>
<table>
<thead>
<tr>
<th style="text-align:left">Command Title</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">System/Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Reload Window</td>
<td style="text-align:left">é‡æ–°åŠ è½½çª—å£</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Close All Editors</td>
<td style="text-align:left">å…³é—­æ‰€æœ‰ç¼–è¾‘å™¨</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Save without Formatting...</td>
<td style="text-align:left">ä¿å­˜ä½†ä¸æ ¼å¼åŒ–</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Open User Settings (JSON)</td>
<td style="text-align:left">æ‰“å¼€ç”¨æˆ·è®¾ç½®ï¼ˆJSONï¼‰</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Change Case upper/low/camel/snake/...</td>
<td style="text-align:left">æ›´æ”¹å‘½åæ–¹å¼</td>
<td style="text-align:left"><a href="https://marketplace.visualstudio.com/items?itemName=wmaurer.change-case">change-case</a></td>
</tr>
<tr>
<td style="text-align:left">Open/Config Github Blogger</td>
<td style="text-align:left">å†™åšå®¢</td>
<td style="text-align:left"><a href="https://marketplace.visualstudio.com/items?itemName=Frankie.github-blogger">Github Blogger</a></td>
</tr>
<tr>
<td style="text-align:left">Toggle Screencast Mode</td>
<td style="text-align:left">åˆ‡æ¢å±å¹•æ¨¡å¼</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Configure Display Language</td>
<td style="text-align:left">é…ç½®æ˜¾ç¤ºè¯­è¨€</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Install/Uninstall 'code' command in PATH</td>
<td style="text-align:left">å®‰è£…/å¸è½½ <code>code</code> å‘½ä»¤</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">Format Document...</td>
<td style="text-align:left">ä½¿ç”¨...æ ¼å¼åŒ–æ–‡æ¡£</td>
<td style="text-align:left">å†…ç½®</td>
</tr>
<tr>
<td style="text-align:left">......</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h4>é…ç½®å‘½ä»¤</h4>
<p>æˆ‘ä»¬å¯ä»¥ç»™è¿™äº›å‘½ä»¤æ·»åŠ ã€ä¿®æ”¹ã€ç§»é™¤æˆ–é‡ç½®å¿«æ·é”®ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689494575947.gif" alt=""></p>
<h4>æŸ¥çœ‹æ’ä»¶å‘½ä»¤</h4>
<p>ç¬¬ä¸‰æ–¹æ’ä»¶æ‰€å®šä¹‰çš„æ’ä»¶ï¼Œå¯åœ¨æ’ä»¶é¡µé¢ä¸­æŸ¥çœ‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/10/1700909866085.png" alt=""></p>
<h2>é«˜é˜¶ç”¨æ³•</h2>
<p>æˆ‘ä»¬ä»å®é™…åœºæ™¯å‡ºå‘ã€‚</p>
<h3>åœºæ™¯ä¸€</h3>
<p>å‡è®¾æˆ‘ä»¬è¦åœ¨æœ¬åœ°è°ƒè¯•ï¼Œæƒ³åœ¨ <code>condition1</code> æ¡ä»¶ä¸­è¿”å› <code>STATUS_TEST</code>ã€‚</p>
<pre><code class="language-js">// From
function getStatus() {
  if (condition1) return STATUS_FIRST
  if (condition2) return STATUS_SECOND
  if (condition3) return STATUS_THIRD
  return STATUS_DEFAULT
}

// To
function getStatus() {
  // if (condition1) return STATUS_FIRST
  if (condition1) return STATUS_TEST
  if (condition2) return STATUS_SECOND
  if (condition3) return STATUS_THIRD
  return STATUS_DEFAULT
}
</code></pre>
<p>å¯èƒ½éœ€è¦ç»è¿‡ä»¥ä¸‹å‡ æ­¥æ“ä½œï¼š</p>
<ol>
<li>ä½¿ç”¨ã€ŒâŒ¥ + â‡§ + â†“ã€å‘ä¸‹å¤åˆ¶è¡Œï¼›</li>
<li>ç§»åŠ¨å…‰æ ‡è‡³ä¸Šä¸€è¡Œï¼›</li>
<li>ä½¿ç”¨ã€ŒâŒ˜ + /ã€æ³¨é‡ŠåŸå§‹è¡Œï¼›</li>
<li>ç§»åŠ¨å…‰æ ‡è‡³ä¸‹ä¸€è¡Œï¼›</li>
<li>ç„¶åè¿›è¡Œå¯¹åº”ä¿®æ”¹ã€‚</li>
</ol>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¿™ç§åœºæ™¯å®šåˆ¶ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ï¼š</p>
<pre><code class="language-json">{
  &quot;key&quot;: &quot;ctrl+alt+c&quot;,
  &quot;command&quot;: &quot;runCommands&quot;,
  &quot;args&quot;: {
    &quot;commands&quot;: [
      &quot;editor.action.copyLinesDownAction&quot;,
      &quot;cursorUp&quot;,
      &quot;editor.action.addCommentLine&quot;,
      &quot;cursorDown&quot;
    ]
  }
}
</code></pre>
<p>ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªã€ŒâŒƒ + âŒ¥ + Cã€çš„å¿«æ·é”®ï¼Œå®ƒæ‰§è¡Œçš„å‘½ä»¤ä¸º <code>runCommands</code>ï¼Œè¯¥å‘½ä»¤æ¥æ”¶çš„å‚æ•°ä¸º <code>args</code>ï¼Œåœ¨å‚æ•°ä¸­åˆå¯ä»¥å®šä¹‰ä¸€ä¸ªå‘½ä»¤åˆ—è¡¨ï¼Œä»¥å®ç°å¤šå‘½ä»¤æ‰§è¡Œã€‚</p>
<blockquote>
<p>å…¶ä¸­ <code>args</code> æ˜¯ <code>command</code> æ¥æ”¶çš„å‚æ•°ã€‚åŒç†ï¼Œåœ¨ <code>args.commands</code> çš„æ¯ä¸ªå‘½ä»¤ï¼Œéƒ½å¯ä»¥å®šä¹‰ä¸ºç±»ä¼¼ <code>{&quot;command&quot;: &quot;xxx&quot;, &quot;args&quot;: {&quot;parm1&quot;: &quot;value1&quot;}}</code> çš„å½¢å¼ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹åº”çš„ Command ID å¯ä»¥åœ¨å¿«æ·é”®é¢æ¿æ‰¾åˆ°ï¼Œå³é”®å¯å¤åˆ¶å‘½ä»¤ IDã€‚</p>
</blockquote>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªè¦ç”¨ä¸€ä¸ªå¿«æ·é”®å°±èƒ½å®ç°ä¸Šè¿° 1 ~ 4 çš„æ­¥éª¤ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689498745984.gif" alt=""></p>
<h3>åœºæ™¯äºŒ</h3>
<p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡ï¼Œå¦‚æœæ–‡ä»¶ URL å¾ˆé•¿ï¼Œä¸”è¶…å‡ºä¸€å±æ—¶ï¼Œä½¿ç”¨æ‹–åŠ¨é¼ æ ‡é€‰æ‹© URL æ—¶ç¨æœ‰ä¸æ…åç¦»æœ¬è¡Œçš„è¯ï¼ŒåŸºæœ¬ä¸Šå°±è¦é‡æ–°æ‹–é€‰äº†ã€‚</p>
<blockquote>
<p>æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œç»™æ ¼å¼åŒ–ç¨‹åºè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ printWidth å°±æ”¹å–„äº†ã€‚ä½†ç”±äºæŸäº›åŸå› ï¼Œè¯¥é¡¹ç›®çš„ printWidth å¾ˆå¤§ï¼Œå¾€å¾€å¾ˆå®¹æ˜“è¶…å‡ºä¸€å±ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå…¶ä¸­ URL åœ¨é å³ä¸€ç«¯ï¼š</p>
<pre><code class="language-html">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 622&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 100%; background-size: cover; background-position: top center; background-repeat: no-repeat; background-image: url(https://cloud-minapp-45362.cloud.ifanrusercontent.com/10eb615c88e3709c757f22a50c18f30a.gif)&quot;&gt;&lt;/svg&gt;
</code></pre>
<p>å¦‚ä½•å¿«é€Ÿæ›¿æ¢è¿™ä¸ª URL å‘¢ï¼Ÿ</p>
<ol>
<li>ä½¿ç”¨ã€ŒâŒƒ + â‡§ + Lã€å±•å¼€é€‰æ‹©ä¸¤æ¬¡ï¼Œä»¥é€‰ä¸­ URLã€‚</li>
<li>è¿›è¡Œç²˜è´´ï¼ˆå‰ªè´´æ¿ä¸­å·²æ‹·è´å°†è¦æ›¿æ¢çš„ URLï¼‰ã€‚</li>
</ol>
<pre><code class="language-json">{
  &quot;key&quot;: &quot;ctrl+alt+d&quot;,
  &quot;command&quot;: &quot;runCommands&quot;,
  &quot;args&quot;: {
    &quot;commands&quot;: [
      &quot;editor.action.smartSelect.expand&quot;,
      &quot;editor.action.smartSelect.expand&quot;,
      &quot;editor.action.clipboardPasteAction&quot;
    ]
  }
}
</code></pre>
<p>ç°åœ¨åªè¦æŒ‰ä¸‹ã€ŒâŒƒ + âŒ¥ + Dã€å°±å¯ä»¥å¿«é€Ÿæ›¿æ¢äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689500955408.gif" alt=""></p>
<p>ä¸Šè¿°è‡ªå®šä¹‰çš„å‘½ä»¤ï¼Œæ·»åŠ åˆ° <code>keybindings.json</code> æ–‡ä»¶ä¸­ï¼Œå…¥å£åœ¨è¿™é‡Œ ğŸ‘‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689501255480.png" alt=""></p>
<blockquote>
<p>æ›´å¤šç»†èŠ‚è¯·çœ‹ <a href="https://code.visualstudio.com/docs/getstarted/keybindings#_running-multiple-commands">Runing multiple commands</a>ã€‚</p>
</blockquote>
<blockquote>
<p>ä»¥ä¸Šä»…ä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œåªè®²äº†å¾ˆå°‘ä¸€éƒ¨åˆ†ï¼Œå¤§å®¶è‡ªç”±å‘æŒ¥æƒ³è±¡åŠ›å§ã€‚</p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://code.visualstudio.com/docs/getstarted/keybindings">Key Bindings for Visual Studio Code</a></li>
<li><a href="https://code.visualstudio.com/docs/editor/codebasics">User Guide for Visual Studio Code</a></li>
<li><a href="https://geek-docs.com/vscode/vscode-tutorials/vscode-keyboard.html">VS Code æ•™ç¨‹</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å­—ç¬¦ä¸å­—ç¬¦é›†]]></title>
            <link>https://github.com/toFrankie/blog/issues/316</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/316</guid>
            <pubDate>Sun, 02 Jul 2023 04:08:21 GMT</pubDate>
            <description><![CDATA[<h2>è®¡ç®—æœºå­˜å‚¨å•ä½</h2>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰å¿…è¦ç®€å•äº†è§£ä¸‹è®¡ç®—æœºä¸­å¸¸ç”¨çš„å­˜å‚¨å•ä½ã€‚</p>
<h3>æ¯”ç‰¹</h3>
<p>ã€Œ<strong>æ¯”ç‰¹</strong>ã€æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„æ¦‚å¿µï¼Œæ˜¯æ•°æ®å­˜å‚¨å’Œä¼ è¾“çš„æœ€å°å•ä½ï¼Œæœ‰ä¸”ä»…æœ‰ <code>0</code> å’Œ <code>1</code> ä¸¤ä¸ªå€¼ã€‚éŸ³è¯‘è‡ª bitï¼Œ]]></description>
            <content:encoded><![CDATA[<h2>è®¡ç®—æœºå­˜å‚¨å•ä½</h2>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰å¿…è¦ç®€å•äº†è§£ä¸‹è®¡ç®—æœºä¸­å¸¸ç”¨çš„å­˜å‚¨å•ä½ã€‚</p>
<h3>æ¯”ç‰¹</h3>
<p>ã€Œ<strong>æ¯”ç‰¹</strong>ã€æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„æ¦‚å¿µï¼Œæ˜¯æ•°æ®å­˜å‚¨å’Œä¼ è¾“çš„æœ€å°å•ä½ï¼Œæœ‰ä¸”ä»…æœ‰ <code>0</code> å’Œ <code>1</code> ä¸¤ä¸ªå€¼ã€‚éŸ³è¯‘è‡ª bitï¼Œæ˜¯ binary digit çš„ç®€å†™ã€‚</p>
<p>è¿™æ ·çš„ <code>0</code> æˆ– <code>1</code> ç§°ä¸º<strong>ä¸€ä½</strong>ï¼Œå¸¸ç”¨ <code>1b</code> æˆ– <code>1bit</code> è¡¨ç¤ºï¼ˆå°å†™å­—æ¯ï¼‰ã€‚ä¸€ä½å¯ä»¥è¡¨ç¤ºä¸¤ç§çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œç”¨ä¸€ä½è¡¨ç¤ºå¼€å…³çš„çŠ¶æ€ï¼Œ0 è¡¨ç¤ºæ‰“å¼€ï¼Œ1 è¡¨ç¤ºå…³é—­ã€‚</p>
<p>æ—¢ç„¶ <code>1bit</code> å¯ä»¥è¡¨ç¤ºä¸¤ç§çŠ¶æ€ï¼Œé‚£ä¹ˆå¤šä¸ª bit ç»„åˆï¼Œä¾¿å¯ä»¥è¡¨ç¤º N ç§çŠ¶æ€ã€‚æˆ‘ä»¬åœ¨è®¡ç®—æœºä¸­çœ‹åˆ°çš„æ•°å­—ã€å­—æ¯ã€ä¸­æ–‡ã€ç¬¦å·ã€å›¾ç‰‡ä»¥åŠéŸ³é¢‘ç­‰å†…å®¹éƒ½æ˜¯ç”±å¤šä¸ªäºŒè¿›åˆ¶æ•° <code>0</code> å’Œ <code>1</code> ç»„æˆçš„ï¼Œå®ƒä»¬å°±æ˜¯ä»¥äºŒè¿›åˆ¶æ•°çš„å½¢å¼å­˜å‚¨åœ¨å­˜å‚¨ä»‹è´¨ä¸Šçš„ã€‚</p>
<h3>å­—èŠ‚</h3>
<p>ç”±äº <code>1bit</code> åªèƒ½è¡¨ç¤ºä¸¤ç§çŠ¶æ€ï¼Œä¸ºäº†å¯ä»¥æ›´æ–¹ä¾¿åœ°è¡¨ç¤ºå¤šç§çŠ¶æ€ï¼Œåœ¨è®¡ç®—æœºä¸­è¿˜å¸¸ç”¨ã€Œ<strong>å­—èŠ‚</strong>ã€ä½œä¸ºå­˜å‚¨å•ä½ã€‚ä¸€ä¸ªå­—èŠ‚ç”¨ <code>1B</code> æˆ– <code>1Byte</code> è¡¨ç¤ºï¼ˆå¤§å†™å­—æ¯ï¼‰ï¼Œç”± <code>8bit</code> ç»„æˆï¼Œå¯ä»¥è¡¨ç¤º 256ï¼ˆ $2^{8}$ ï¼‰ç§ä¸åŒçš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>å­—èŠ‚å’Œæ¯”ç‰¹çš„æ¢ç®—å…³ç³»ä¸º 1 Byte = 8 bitã€‚</p>
</blockquote>
<h2>å­—ç¬¦ä¸å­—ç¬¦é›†</h2>
<p>ã€Œ<strong>å­—ç¬¦</strong>ã€æ˜¯ç›¸å¯¹äºäººç±»è‡ªç„¶è¯­è¨€æ¥è¯´çš„ï¼Œæ˜¯ä¸€ç§æ›´å‹å¥½çš„è¡¨ç¤ºæ–¹å¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªé˜¿æ‹‰ä¼¯æ•°å­—ã€è‹±æ–‡å­—æ¯ã€æ±‰å­—ã€ç‰‡å‡åã€æ ‡ç‚¹ç¬¦å·ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰åƒè¡¨ç¤ºå›è½¦ã€æ¢è¡Œã€åˆ¶è¡¨ç­‰æ§åˆ¶å­—ç¬¦ã€‚ã€Œ<strong>å­—ç¬¦é›†</strong>ã€åˆ™é¡¾åæ€ä¹‰ï¼Œæ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè®¡ç®—æœºä¸­å­˜å‚¨çš„æ‰€æœ‰ä¸œè¥¿æœ¬è´¨ä¸Šéƒ½æ˜¯ <code>0</code> å’Œ <code>1</code> ç»„æˆçš„ã€‚é‚£ä¹ˆï¼Œè‹±æ–‡å­—æ¯ <code>A</code> åœ¨è®¡ç®—æœºä¸Šå­˜å‚¨çš„äºŒè¿›åˆ¶æ•°æ˜¯ <code>01000001</code>ï¼Œæ˜¯ <code>01000010</code>ï¼Œè¿˜æ˜¯å…¶ä»–å‘¢ï¼Ÿç†è®ºä¸Šéƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†ä¸ºäº†ç»Ÿä¸€ï¼š</p>
<blockquote>
<p><code>A</code> å¯¹åº”ä¸º <code>01000001</code>
<code>B</code> å¯¹åº”ä¸º <code>01000010</code>
<code>C</code> å¯¹åº”ä¸º <code>01000011</code>
.....</p>
</blockquote>
<p>è¿™äº›æ˜ å°„å…³ç³»ç”±å­—ç¬¦é›†è§„å®šå¥½çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦éµå¾ªåŒä¸€å­—ç¬¦é›†ï¼Œé‚£ä¹ˆå­—ç¬¦ <code>A</code> åœ¨å­˜å‚¨æ—¶æ€»æ˜¯ <code>01000001</code>ã€‚ç›¸ååœ°ï¼Œè®¡ç®—æœºè¯»å–åˆ°äºŒè¿›åˆ¶æ•° <code>01000001</code> æ—¶ï¼Œæ€»ä¼šâ€œç¿»è¯‘â€ä¸º <code>A</code>ã€‚</p>
<p>ä» <code>A</code> åˆ° <code>01000001</code> çš„è¿‡ç¨‹ç§°ä¸ºã€Œ<strong>å­—ç¬¦ç¼–ç </strong>ã€ï¼ŒæŠŠå­—ç¬¦é›†ä¸­çš„å­—ç¬¦ç¼–ç ä¸ºæŒ‡å®šé›†åˆä¸­æŸä¸€å¯¹è±¡ï¼Œä»¥ä¾¿è®¡ç®—æœºå­˜å‚¨ã€ä¼ è¾“å’Œè½¬æ¢å®ƒä»¬ã€‚åä¹‹ï¼Œåˆ™ä¸ºè§£ç ã€‚</p>
<h2>å¸¸è§å­—ç¬¦é›†</h2>
<p>è®¡ç®—æœºæ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œä»–ä»¬çš„è¯­è¨€ä½“ç³»ä¸­åªæœ‰æ•°å­—ã€è‹±æ–‡å­—æ¯ä»¥åŠæ ‡ç‚¹ç¬¦å·ï¼Œå› æ­¤ä»–ä»¬åˆ¶å®šçš„ ASCII å­—ç¬¦é›†ï¼ŒåªåŒ…å«æ•°å­—ã€è‹±æ–‡å­—æ¯ã€æ ‡ç‚¹ç¬¦å·ä»¥åŠä¸€äº›æ§åˆ¶å­—ç¬¦ã€‚åœ¨å½“æ—¶ï¼Œè¿™å¯¹ä»–ä»¬æ¥è¯´æ˜¯è¶³å¤Ÿçš„ã€‚</p>
<p>ä½†éšç€è®¡ç®—æœºåœ¨å…¨ä¸–ç•Œæµè¡Œï¼ŒASCII å­—ç¬¦é›†æ— æ³•æ­£ç¡®åœ°è¡¨ç¤ºå…¶ä»–è‡ªç„¶è¯­è¨€çš„å­—ç¬¦ï¼Œæ¯”å¦‚ä¸­æ–‡ã€æ—¥æ–‡ç­‰ã€‚ä¸ºäº†é€‚åº”å„ç±»è¯­è¨€ï¼Œè¡ç”Ÿå‡ºä¸€ç³»åˆ—çš„å­—ç¬¦é›†ï¼Œæ¯”å¦‚æˆ‘å›½çš„ GB2312 å’Œ GBK å­—ç¬¦é›†ã€‚</p>
<p>ç„¶è€Œï¼Œå¾ˆå¤šå­—ç¬¦é›†æ˜¯åŸºäº ASCII çš„ï¼Œä¸”ä¸å…¼å®¹å…¶ä»–å­—ç¬¦é›†ï¼Œæ— æ³•åœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…ä½¿ç”¨ã€‚éšç€å›½é™…åŒ–æµè¡Œï¼Œè¿™æ ·ä¸‹å»è‚¯å®šä¸è¡Œå•Šï¼Œäºæ˜¯ä¸€ä¸ªéè¥åˆ©ç»„ç»‡ <a href="https://home.unicode.org/about-unicode/">Unicode è”ç›Ÿ</a>ç«™äº†å‡ºæ¥ï¼Œæ‰¬è¨€è¦åˆ¶å®šä¸€å¥—é€‚ç”¨äºå¤šå›½è¯­è¨€çš„å­—ç¬¦è½¬æ¢æ ‡å‡†ï¼Œç§¯æä¸ ISOã€W3Cã€ECMA ç­‰å„æ ‡å‡†åˆ¶å®šç»„ç»‡åˆä½œï¼Œå¹¶å–å¾—äº†æˆåŠŸï¼Œå¯¹å›½é™…åŒ–å’Œæœ¬åœ°åŒ–äº§ç”Ÿé‡å¤§å½±å“ã€‚</p>
<h3>ASCII å­—ç¬¦é›†</h3>
<p>ã€Œ<strong>ASCII</strong>ã€å…¨ç§°æ˜¯ç¾å›½æ ‡å‡†ä¿¡æ¯äº¤æ¢ä»£ç ï¼ˆAmerican Standard Code for Information Interchange, ASCIIï¼‰ï¼Œç”±ç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆAmerican Nation Standard Institute, ANSIï¼‰åˆ¶å®šã€‚</p>
<p>åœ¨æ ‡å‡† ASCII ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå³ <code>8bit</code>ã€‚ä½†å…¶æœ€é«˜ä½ï¼ˆé¦–ä½ï¼‰æ˜¯ <code>0</code>ï¼Œå¹¶æ²¡æœ‰è¢«åˆ©ç”¨ä¸Šï¼Œå¯è¡¨ç¤º <strong>128</strong> ä¸ªå­—ç¬¦ã€‚</p>
<blockquote>
<ul>
<li>ç¼–å·èŒƒå›´ä¸º 0 ~ 31 å’Œ 127 çš„æ˜¯ä¸å¯è§çš„æ§åˆ¶å­—ç¬¦ï¼Œå…± 33 ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ã€é€€æ ¼ç¬¦ç­‰ã€‚</li>
<li>ç¼–å·èŒƒå›´ä¸º 32 ~ 126 æ˜¯å¯æ˜¾ç¤ºå­—ç¬¦ï¼Œå…± 95 ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ç©ºæ ¼ã€Aã€B ç­‰ã€‚</li>
</ul>
</blockquote>
<p>å…¶ä¼˜ç‚¹æ˜¯æ¯ä¸ªå­—ç¬¦åªå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä½†ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œåªèƒ½æ˜¾ç¤ºå¤§å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—ä»¥åŠæ ‡ç‚¹ç¬¦å·ï¼Œå¯¹äºæ±‰å­—ã€è¥¿æ¬§è¯­è¨€æ˜¾ç¤ºæ— èƒ½ä¸ºåŠ›ã€‚</p>
<h3>EASCII å­—ç¬¦é›†</h3>
<p>ç”±äº ASCII æœ€é«˜ä½æ²¡æœ‰åˆ©ç”¨ä¸Šï¼Œåªè¡¨ç¤º 0x00 ~ 0x7Fï¼ˆåè¿›åˆ¶ 0 ~ 127ï¼‰å…± 128 ä¸ªå­—ç¬¦ã€‚äºæ˜¯å…¶ä»–å›½å®¶ç›¯ä¸Šäº† 0x80 ~ 0xFFï¼ˆåè¿›åˆ¶ 128 ~ 255ï¼‰è¿™ 128 ä¸ªå­—ç¬¦ï¼Œå¹¶æ‰©å±•å‡ºä¸€ç³»åˆ—çš„å­—ç¬¦é›†ã€‚</p>
<p>ã€Œ<strong>EASCII</strong>ã€ï¼ˆExtended ASCIIï¼‰å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå…¼å®¹ ASCII çš„æ‰©å±•å­—ç¬¦é›†ã€‚å°½ç®¡å®ƒè·Ÿ ASCII ä¸€æ ·ï¼Œéƒ½æ˜¯å•å­—èŠ‚ç¼–ç ï¼Œä½†å¯è¡¨ç¤º 256 ä¸ªå­—ç¬¦ï¼Œæ¯” ASCII å¤šäº†ä¸€å€ã€‚æ‰©å±•éƒ¨åˆ†åŒ…æ‹¬è¡¨æ ¼ç¬¦å·ã€è®¡ç®—ç¬¦å·ã€å¸Œè…Šå­—æ¯å’Œç‰¹æ®Šçš„æ‹‰ä¸ç¬¦å·ã€‚</p>
<p>åŸºæœ¬ä¸Šå·²è¢«æ·˜æ±°ï¼Œå…¶æ ‡å‡†åŒ–ç¨‹åº¦ä¹Ÿæ²¡æœ‰ ISO 8859 å¥½ã€‚</p>
<h3>ISO 8859 ç³»åˆ—å­—ç¬¦é›†</h3>
<p>ã€Œ<strong>ISO/IEC 8859</strong>ã€æ˜¯ç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰å’Œå›½é™…ç”µå·¥å§”å‘˜ä¼šï¼ˆIECï¼‰è”åˆåˆ¶å®šçš„<strong>ä¸€ç³»åˆ—</strong>å­—ç¬¦é›†æ ‡å‡†ã€‚åŒæ ·æ˜¯æ‰©å±•è‡ª ASCII å­—ç¬¦é›†ï¼Œå•å­—èŠ‚ç¼–ç ï¼Œç»Ÿä¸€äº†æ­¤å‰å„å›½å„è¯­è¨€å•ç‹¬ç¼–ç çš„å±€é¢ã€‚</p>
<p>ç›®å‰ï¼ŒISO 8859 ç³»åˆ—åŒ…å«äº†ä»¥ä¸‹ 15 ä¸ªå­—ç¬¦é›†ï¼Œå…¶ä¸­ ISO 8859-12 å·²åºŸé™¤ï¼ˆ<a href="https://www.wikiwand.com/zh-hans/ISO/IEC_8859">æ›´å¤š</a>ï¼‰ã€‚</p>
<ul>
<li>ISO/IEC 8859-1ï¼ˆLatin-1ï¼‰- è¥¿æ¬§è¯­è¨€</li>
<li>ISO/IEC 8859-2ï¼ˆLatin-2ï¼‰- ä¸­æ¬§è¯­è¨€</li>
<li>ISO/IEC 8859-3ï¼ˆLatin-3ï¼‰- å—æ¬§è¯­è¨€ã€‚ä¸–ç•Œè¯­ä¹Ÿå¯ç”¨æ­¤å­—ç¬¦é›†æ˜¾ç¤ºã€‚</li>
<li>ISO/IEC 8859-4ï¼ˆLatin-4ï¼‰- åŒ—æ¬§è¯­è¨€</li>
<li>ISO/IEC 8859-5ï¼ˆCyrillicï¼‰- æ–¯æ‹‰å¤«è¯­è¨€</li>
<li>ISO/IEC 8859-6ï¼ˆArabicï¼‰- é˜¿æ‹‰ä¼¯è¯­</li>
<li>ISO/IEC 8859-7ï¼ˆGreekï¼‰- å¸Œè…Šè¯­</li>
<li>ISO/IEC 8859-8ï¼ˆHebrewï¼‰- å¸Œä¼¯æ¥è¯­ï¼ˆè§†è§‰é¡ºåºï¼‰
<ul>
<li>ISO 8859-8-I - å¸Œä¼¯æ¥è¯­ï¼ˆé€»è¾‘é¡ºåºï¼‰</li>
</ul>
</li>
<li>ISO/IEC 8859-9ï¼ˆLatin-5 æˆ– Turkishï¼‰- å®ƒæŠŠ Latin-1 çš„å†°å²›è¯­å­—æ¯æ¢èµ°ï¼ŒåŠ å…¥åœŸè€³å…¶è¯­å­—æ¯ã€‚</li>
<li>ISO/IEC 8859-10ï¼ˆLatin-6 æˆ– Nordicï¼‰- åŒ—æ—¥è€³æ›¼è¯­æ”¯ï¼Œç”¨æ¥ä»£æ›¿ Latin-4ã€‚</li>
<li>ISO/IEC 8859-11ï¼ˆThaiï¼‰- æ³°è¯­ï¼Œä»æ³°å›½çš„ TIS620 æ ‡å‡†å­—é›†æ¼”åŒ–è€Œæ¥ã€‚</li>
<li>ISO/IEC 8859-13ï¼ˆLatin-7 æˆ– Baltic Rimï¼‰- æ³¢ç½—çš„è¯­æ—</li>
<li>ISO/IEC 8859-14ï¼ˆLatin-8 æˆ– Celticï¼‰- å‡¯å°”ç‰¹è¯­æ—</li>
<li>ISO/IEC 8859-15ï¼ˆLatin-9ï¼‰- è¥¿æ¬§è¯­è¨€ï¼ŒåŠ å…¥Latin-1æ¬ ç¼ºçš„èŠ¬å…°è¯­å­—æ¯å’Œå¤§å†™æ³•è¯­é‡éŸ³å­—æ¯ï¼Œä»¥åŠæ¬§å…ƒï¼ˆâ‚¬ï¼‰ç¬¦å·ã€‚</li>
<li>ISO/IEC 8859-16ï¼ˆLatin-10ï¼‰- ä¸œå—æ¬§è¯­è¨€ã€‚ä¸»è¦ä¾›ç½—é©¬å°¼äºšè¯­ä½¿ç”¨ï¼Œå¹¶åŠ å…¥æ¬§å…ƒç¬¦å·ã€‚</li>
</ul>
<blockquote>
<p>MySQL 8.0 ä¹‹å‰çš„é»˜è®¤å­—ç¬¦é›† Latin-1 å°±æ˜¯ ISO/IEC 8859-1ã€‚</p>
</blockquote>
<p>è¿™ç³»åˆ—å­—ç¬¦é›†è§„å®šï¼Œæ¯ä¸ªå­—ç¬¦é›†æœ€å¤šå¯å®šä¹‰ 96 ä¸ªå­—æ¯æˆ–ç¬¦å·ï¼Œåœ¨ 0xA0 ~ 0xFFï¼ˆåè¿›åˆ¶ 160 ~ 255ï¼‰èŒƒå›´å†…ã€‚å…¶ä¸­ 0xA0 ä½ç½®æ˜¯ä¸æ¢è¡Œç©ºæ ¼ï¼ˆNon-breaking spaceï¼‰ã€‚</p>
<p>ç›®å‰è¿™ä»½æ ‡å‡†ä¹Ÿä¸å†æ›´æ–°äº†ã€‚</p>
<h3>USC é€šç”¨å­—ç¬¦é›†</h3>
<p>ã€Œ<strong>é€šç”¨å­—ç¬¦é›†</strong>ã€ï¼ˆUniversal Character Set, UCSï¼‰æ˜¯ç”± ISO åˆ¶å®šçš„ ISO 10646 æ ‡å‡†æ‰€å®šä¹‰çš„æ ‡å‡†å­—ç¬¦é›†ã€‚åŸå…ˆç»´æŠ¤ ISO 8859 æ ‡å‡†çš„å·¥ä½œç»„å·²è§£æ•£ï¼Œç›®å‰è¯¥å§”å‘˜ä¼šå¦ä¸€å·¥ä½œç»„è‡´åŠ›äº ISO 10646 çš„å¼€å‘ã€‚</p>
<p>é€šç”¨å­—ç¬¦é›†åŒ…å«äº†å·²çŸ¥çš„æ‰€æœ‰å­—ç¬¦ï¼Œæ¯”å¦‚æ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€é˜¿æ‹‰ä¼¯å­—æ¯ã€æ±‰å­—ã€å‡åä»¥åŠå¤§é‡çš„ç¬¦å·ç­‰ã€‚å®ƒç»™æ¯ä¸ªå­—ç¬¦èµ‹äºˆä¸€ä¸ªæ­£å¼çš„åå­—ï¼Œåœ¨å­—ç¬¦çš„åå…­è¿›åˆ¶æ•°å‰é¢åŠ ä¸Š <code>U+</code> è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼š <code>U+0041</code> è¡¨ç¤ºå­—ç¬¦ <code>A</code>ã€‚</p>
<p>å†å²ä¸Šï¼Œåˆ¶å®šçš„ ISO 10646 æ ‡å‡†çš„å·¥ä½œç»„å’Œ Unicode è”ç›Ÿæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ç»„ç»‡ï¼Œèµ·åˆå®ƒä»¬å„è‡ªåˆ¶å®šçš„æ ‡å‡†å¹¶ä¸ç›¸åŒï¼Œåæ¥ä¸¤ä¸ªé¡¹ç›®çš„ç»„ç»‡è€…æ„è¯†åˆ°ä¸–ç•Œä¸Šå¹¶ä¸éœ€è¦ä¸¤ä¸ªä¸å…¼å®¹çš„å­—ç¬¦é›†ï¼Œäºæ˜¯ä¸¤è€…è¿›è¡Œåˆä½œï¼Œä» Unicode 2.0 èµ·ï¼ŒUnicode é‡‡ç”¨äº†ä¸ ISO 10646 ç›¸åŒçš„å­—åº“å’Œå­—ç ã€‚åœ¨ä¸¤ä¸ªæ ‡å‡†ä¸­ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½åœ¨ç›¸åŒçš„ä½ç½®å¹¶ä¸”å…·æœ‰ç›¸åŒçš„åå­—ã€‚</p>
<p>ä½† Unicode ä½¿ç”¨æ›´ä¸ºå¹¿æ³›ï¼Œæœ‰ä¸€ç»Ÿæ±Ÿæ¹–çš„æ„æ€ã€‚</p>
<h3>GB 2312ã€GBK å’Œ GB 18030 å­—ç¬¦é›†</h3>
<p>åœ¨è¥¿æ–¹è¯­è¨€ä½“ç³»ä¸­ï¼Œä½¿ç”¨å•å­—èŠ‚ç¼–ç å¯ä»¥è¡¨ç¤º 256 ä¸ªå­—ç¬¦ï¼Œå°±ç®—åŠ ä¸Šå…¶ä»–ä¸€äº›æ ‡ç‚¹ç¬¦å·ï¼Œå¯¹äºä»–ä»¬æ¥è¯´æ˜¯è¶³å¤Ÿçš„ã€‚ä½†å¯¹äºæˆ‘å›½çš„æ±‰å­—æ¥è¯´æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ã€‚</p>
<p>å°± 2013 å¹´å›½åŠ¡é™¢å…¬å¸ƒçš„ã€Š<a href="https://www.gov.cn/zwgk/2013-08/19/content_2469793.htm">é€šç”¨è§„èŒƒæ±‰å­—è¡¨</a>ã€‹æ¥è¯´ï¼Œå…¶ä¸­æ”¶å½•äº† 8105 ä¸ªå­—ï¼Œå…¶ä¸­ 3500 ä¸ªå¸¸ç”¨å­—ï¼Œ3000 ä¸ªæ¬¡å¸¸ç”¨å­—ï¼Œ1605 ä¸ªç”¨äºæ»¡è¶³ä¿¡æ¯åŒ–æ—¶ä»£å’Œä¸“é—¨é¢†åŸŸç”¨å­—éœ€æ±‚çš„å­—ã€‚é™¤ç®€ä½“å­—ä¹‹å¤–ï¼Œè¿˜æœ‰ç¹ä½“å­—ã€ç”Ÿåƒ»å­—ç­‰ã€‚åœ¨ç°ä»£æ±‰è¯­è¯å…¸ç¬¬ä¸ƒç‰ˆæ”¶å½•äº†çº¦ 12000 ä¸ªæ±‰å­—ã€‚</p>
<h4>GB 2312 å­—ç¬¦é›†</h4>
<p>ã€Œ<strong>GB 2312</strong>ã€åˆç§°ä¸º GB/T 2312ã€GB/T 2312-80 æˆ– GB/T 2312-1980ï¼Œæ˜¯ç”±å›½å®¶æ ‡å‡†æ€»å±€äº 1980 å¹´å‘å¸ƒçš„ä¿¡æ¯äº¤æ¢ç”¨æ±‰å­—ç¼–ç å­—ç¬¦é›†ï¼ˆåŸºæœ¬é›†ï¼‰ã€‚è¯¥å­—ç¬¦é›†é€‚ç”¨äºä¸­å›½å¤§é™†ã€æ–°åŠ å¡ç­‰åœ°ã€‚</p>
<blockquote>
<p>å…¼å®¹ ASCII å­—ç¬¦é›†ï¼Œä½†ä¸å…¼å®¹ ISO 8859 ç³»åˆ—å­—ç¬¦é›†ã€‚</p>
</blockquote>
<blockquote>
<p>å†·çŸ¥è¯†ï¼Œå…¶ä¸­ã€ŒGBã€æ˜¯ã€Œå›½å®¶æ ‡å‡†ï¼Œå›½æ ‡ã€äºŒå­—çš„æ‹¼éŸ³é¦–å­—æ¯ï¼š</p>
<ul>
<li><code>GB</code> è¡¨ç¤ºå¼ºåˆ¶æ€§å›½å®¶æ ‡å‡†ã€‚</li>
<li><code>GB/T</code> è¡¨ç¤ºæ¨èæ€§å›½å®¶æ ‡å‡†ã€‚</li>
<li><code>GB/Z</code> è¡¨ç¤ºæŒ‡å¯¼æ€§æŠ€æœ¯æ–‡ä»¶ã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>GB 2312-1980 è‡ª 2017 å¹´ 3 æœˆ 23 æ—¥èµ·ï¼Œè½¬ä¸ºæ¨èæ€§æ ‡å‡†ï¼Œç¼–å·æ”¹ä¸º GB/T 2312-1980ã€‚</p>
</blockquote>
<p>GB 2312 æ ‡å‡†æ”¶å½•äº†åŒ…å«æ±‰å­—ã€æ•°å­—ã€åºå·ã€æ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€ä¿„æ–‡å­—æ¯ã€æ—¥æ–‡å‡åç­‰ 7445 ä¸ªå›¾å½¢å­—ç¬¦ï¼Œå…¶ä¸­æœ‰ 6773 ä¸ªã€‚åŸºæœ¬æ»¡è¶³äº†æ±‰å­—ä½¿ç”¨åœºæ™¯ã€‚</p>
<p>å¯¹äºäººåã€åœ°åã€å¤æ±‰è¯­ç­‰æ–¹é¢å‡ºç°çš„ç½•è§å­—ã€ç¹ä½“å­—ï¼ŒGB 2312 å¹¶ä¸èƒ½å¤„ç†ã€‚åæ¥è¡ç”Ÿå‡º GBK ç­‰æ±‰å­—å­—ç¬¦é›†ã€‚</p>
<h4>GBK å­—ç¬¦é›†</h4>
<p>ã€Œ<strong>GBK</strong>ã€æ„ä¸ºå›½å®¶æ ‡å‡†æ‰©å±•ï¼Œæ˜¯å›½ã€æ ‡ã€æ‰©ä¸‰å­—æ‹¼éŸ³é¦–å­—æ¯çš„ç¼©å†™ã€‚ç”±å›½å®¶æŠ€æœ¯ç›‘ç£å±€æ ‡å‡†åŒ–å¸å’Œç”µå­å·¥ä¸šéƒ¨ç§‘æŠ€ä¸è´¨é‡ç›‘ç£å¸äº 1995 å¹´ 12 æœˆ 15 æ—¥å…¬å¸ƒï¼Œå®ƒæ˜¯æŠ€æœ¯è§„èŒƒæŒ‡å¯¼æ€§æ–‡ä»¶ï¼Œä¸å±äºå›½å®¶æ ‡å‡†ã€‚ç”±äºè®¡ç®—æœºçš„æ™®åŠï¼ŒGB 2313 æ”¶å½•çš„å­—ç¬¦ä¸å¤Ÿç”¨ï¼Œäºæ˜¯ GBK å­—ç¬¦é›†å‡ºç°äº†ï¼Œåè€…å…±æ”¶å½•äº† 21886 ä¸ªæ±‰å­—å’Œç¬¦å·ã€‚</p>
<blockquote>
<p>GBK å‘ä¸‹å®Œå…¨å…¼å®¹ GB 2312 ç¼–ç ã€‚</p>
</blockquote>
<p>GBK ä¸ GB 2312 ä¸€æ ·ï¼Œé‡‡ç”¨äº†åŒå­—èŠ‚ç¼–ç æ–¹å¼ï¼Œä½†ç¼–ç æ–¹å¼ä¸åŒï¼Œå› æ­¤å®ƒä»¬å¯å­˜å‚¨çš„å­—ç¬¦æ•°é‡å¹¶ä¸ç›¸åŒã€‚</p>
<ul>
<li>ä¸ºäº†å…¼å®¹ ASCII ç ï¼ŒGB 2313 çš„æ±‰å­—ä¸¤ä¸ªå­—èŠ‚éƒ½æ˜¯ä» 128 ä½ä¹‹åå¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿ç»­ä¸¤å­—èŠ‚éƒ½å¤§äº 128ï¼ˆåè¿›åˆ¶æ•°ï¼‰ï¼Œè¯´æ˜å®ƒå°±æ˜¯ä¸€ä¸ªä¸­æ–‡å­—ç¬¦ã€‚å®ƒæœ€å¤šèƒ½å­˜å‚¨ 16384ï¼ˆ $2^{14}$ ï¼‰ä¸ªæ±‰å­—ã€‚</li>
<li>è€Œ GBK çš„åšæ³•æ˜¯ç¬¬ä¸€ä¸ªå­—èŠ‚è¦æ±‚å¤§äº 128 ä½ï¼Œè€Œç¬¬äºŒä½å¯ä»¥å°äº 128ï¼Œæ‰€ä»¥å®ƒæœ€å¤šå¯ä»¥å­˜å‚¨ 32640ï¼ˆ $2^{15}$ - 128 ï¼‰ä¸ªæ±‰å­—ã€‚</li>
</ul>
<h4>GB 18030 å­—ç¬¦é›†</h4>
<p>ã€Œ<strong>GB 18030</strong>ã€æ˜¯ç”±å›½å®¶è´¨é‡æŠ€æœ¯ç›‘ç£å±€äº 2000 å¹´ 3 æœˆ 17 æ—¥æ¨å‡ºçš„æ ‡å‡†ï¼Œä»¥å–ä»£ GBKã€‚</p>
<blockquote>
<p>GB 18030 å®Œå…¨å…¼å®¹ GB 2313ï¼ŒåŸºæœ¬å…¼å®¹ GBKï¼Œå¹¶æ”¯æŒ Unicode æ‰€æœ‰ç ä½ã€‚</p>
</blockquote>
<p>GB 18030 é‡‡ç”¨å˜é•¿å¤šå­—èŠ‚ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å¯ä»¥ç”± 1 ä¸ªã€2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ç»„æˆï¼Œç¼–ç ç©ºé—´åºå¤§ï¼Œæœ€å¤šå¯å®šä¹‰ 160 å¤šä¸‡ä¸ªå­—ç¬¦ã€‚</p>
<h3>Unicode å­—ç¬¦é›†</h3>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ–‡ä»¶ä¿å­˜æ—¶ CSS å±æ€§è‡ªåŠ¨æ’åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/315</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/315</guid>
            <pubDate>Thu, 29 Jun 2023 03:35:46 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689824340734.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>åœ¨ä½¿ç”¨ VS Code ç¼–å†™ä»£ç æ—¶ï¼Œé€šå¸¸ä¼šå¼€å¯ <co]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689824340734.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>åœ¨ä½¿ç”¨ VS Code ç¼–å†™ä»£ç æ—¶ï¼Œé€šå¸¸ä¼šå¼€å¯ <code>editor.formatOnSave</code> é€‰é¡¹ä»¥åœ¨ä¿å­˜æ—¶æ ¼å¼åŒ–æ–‡ä»¶ã€‚</p>
<pre><code class="language-json">{
  &quot;editor.formatOnSave&quot;: true
}
</code></pre>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºå¤§å¤šæ•°è¯­è¨€æ¥è¯´ï¼ŒVS Code éƒ½æœ‰å¯¹åº”çš„å†…ç½®æ ¼å¼åŒ–ç¨‹åºï¼ˆformatterï¼‰ã€‚å®ƒä»¬é€šå¸¸åªä¼šå¤„ç†ç¼©è¿›ã€æŠ˜è¡Œã€å‰å¯¼å°¾éšç©ºæ ¼ç­‰æ“ä½œã€‚</p>
<p>å¦‚æœå†…ç½®çš„ä¸å¤Ÿç”¨ï¼Œå¯ä»¥é€šè¿‡å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ä»¥å®ç°æ›´å¤šçš„å¯èƒ½ã€‚æ¯”å¦‚ï¼Œå°†é¢œè‰²å€¼è½¬ä¸ºå°å†™ã€æ”¹è¿› JavaScript å†™æ³•ç­‰éƒ½å¯ä»¥åœ¨ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨å¤„ç†ï¼Œå…·ä½“å–å†³äºæ’ä»¶å®ç°ã€‚</p>
<p>ç”±äºè¯­è¨€ä¼—å¤šï¼Œæ ¼å¼åŒ–æ’ä»¶ä¹Ÿå¾ˆå¤šï¼Œè¿˜å¯ä»¥æ”¯æŒé…ç½®é»˜è®¤çš„æ ¼å¼åŒ–ç¨‹åºã€‚è¿™ä¸ªå¯ä»¥åœ¨æ–‡ä»¶ç¼–è¾‘åŒºå³é”®é€‰æ‹©ã€Œä½¿ç”¨ ... æ ¼å¼åŒ–ã€è¿›è¡Œé…ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-json">{
  &quot;[html]&quot;: {
    &quot;editor.defaultFormatter&quot;: &quot;vscode.html-language-features&quot;
  },
  &quot;[css]&quot;: {
    &quot;editor.defaultFormatter&quot;: &quot;stylelint.vscode-stylelint&quot;
  },
  &quot;[javascript]&quot;: {
    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;
  }
}
</code></pre>
<p>ç°åœ¨å¾ˆå¤šå·¥ç¨‹åŒ–é¡¹ç›®éƒ½ä¼šé…ç½®æ ¼å¼åŒ–å¤„ç†ï¼Œä¹Ÿå¯åœ¨ Git çš„ <code>pre-commit</code> å‹¾å­ä¸­è·‘ä¸€éå¤„ç†è„šæœ¬ï¼Œä»¥ç¡®ä¿æäº¤åˆ°ä»“åº“çš„ä»£ç æ ¼å¼æ˜¯ç»Ÿä¸€çš„ï¼Œå°½ç®¡å¤§å®¶ä½¿ç”¨çš„ç¼–è¾‘å™¨å¯èƒ½æœ‰å·®å¼‚ã€‚</p>
<p>è™½è¯´å¦‚æ­¤ï¼Œä»ç„¶æœ‰å¿…è¦æˆ‘ä»¬çš„ç¼–è¾‘å™¨é…ç½®ä¸€äº›æ ¼å¼åŒ–ç¨‹åºï¼Œä»¥ä¾¿äºåœ¨ç¼–å†™ä¸€äº› Snippetã€Demo ç­‰çš„æ—¶å€™ï¼Œä¹Ÿæœ‰ç€è¾ƒä¸ºè§„èŒƒã€æ ¼å¼ç»Ÿä¸€çš„ä»£ç ã€‚å°¤å…¶æ˜¯åƒæˆ‘è¿™ç§å¼ºè¿«ç—‡æ‚£è€…ã€‚</p>
<p>ä¸ªäººç”¨å¾—æœ€å¤šçš„æ˜¯ <a href="https://prettier.io/">Prettier</a>ï¼Œä¸»æµç¼–è¾‘å™¨éƒ½æœ‰å¯¹åº”æ’ä»¶ï¼Œæ”¯æŒ JavaScriptã€HTMLã€CSS ä»¥åŠå¯¹åº”å˜ä½“ç­‰ Web å‰ç«¯ç›¸å…³çš„è¯­è¨€ã€‚</p>
<blockquote>
<p>Prettier æ˜¯å›ºæ‰§å·±è§çš„ï¼ˆopinionatedï¼‰ï¼Œæä¾›çš„é€‰é¡¹å¾ˆå°‘ï¼Œä¸”åœ¨å¯è§çš„æœªæ¥å¯èƒ½ä¸ä¼šæ·»åŠ æ›´å¤šæ–°åŠŸèƒ½ã€‚åŸå› è¯·çœ‹ <a href="https://prettier.io/docs/en/option-philosophy.html">Option Philosophy</a>ã€‚</p>
</blockquote>
<h2>è¯‰æ±‚</h2>
<p>ç›®å‰æˆ‘æƒ³è¦çš„æ˜¯ï¼š<strong>åœ¨ä¿å­˜æ–‡ä»¶æ—¶ï¼ŒæŒ‰ä¸€å®šçš„è§„åˆ™è‡ªåŠ¨å¯¹ CSS å±æ€§è¿›è¡Œæ’åº</strong>ã€‚æ­¤æ—¶ Prettier å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚</p>
<p>å¯¹äº CSS å±æ€§å£°æ˜é¡ºåºï¼Œæœ€åˆæ˜¯å› ä¸ºçœ‹äº† <a href="http://alloyteam.github.io/CodeGuide/#css-declaration-order">Code Guide by @AlloyTeam</a> çš„è§„èŒƒï¼Œç›®å‰é‡Œé¢æåŠçš„å±æ€§é¡ºåºå·²è¿‡æ—¶ï¼Œæœ€åç»´æŠ¤æ—¶é—´å·²ç»æ˜¯ 2015 å¹´äº†ã€‚æœ‰ä¸€å¥è¯æˆ‘å¾ˆå–œæ¬¢ï¼ˆ<a href="https://github.com/AlloyTeam/CodeGuide">æºè‡ª</a>ï¼‰ï¼š</p>
<blockquote>
<p>è™½ç„¶è¿™äº›ç»†èŠ‚æ˜¯å°äº‹ï¼Œä¸ä¼šæœ‰ä½“éªŒæˆ–è€…æ€§èƒ½ä¸Šçš„ä¼˜åŒ–ï¼Œä½†æ˜¯å´ä½“ç°äº†ä¸€ä¸ª coder å’Œå›¢é˜Ÿçš„ä¸“ä¸šç¨‹åº¦ã€‚</p>
</blockquote>
<p>æ’åºçš„å¥½å¤„æ— éå°±æ˜¯å¿«é€Ÿçœ‹å¾—å‡ºå…ƒç´ ç›’å­æ‰€å çš„ç©ºé—´ï¼Œæ˜¯å¦æœ‰é‡å¤å£°æ˜çš„å±æ€§ç­‰ã€‚</p>
<p>ç›®å‰ï¼Œæœ¬äººæ‰€å‚è€ƒçš„æ˜¯ <a href="https://codeguide.co/#declaration-order">Code Guide @mdo</a> è§„èŒƒï¼Œå¯¹åº”çš„ Stylelint æ’ä»¶æ˜¯ Bootstrap åœ¨ç”¨çš„ <a href="https://github.com/stormwarning/stylelint-config-recess-order"><code>stylelint-config-recess-order</code></a>ï¼Œç»´æŠ¤è¾ƒä¸ºç§¯æï¼Œä¹Ÿèƒ½ç´§è·Ÿæœ€æ–°çš„ CSS å±æ€§ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§ä»¥ä¸‹åˆ†ç»„æ’åºï¼ˆ<a href="https://codeguide.co/#declaration-order">è¯¦è§</a>ï¼‰ï¼š</p>
<ul>
<li>Positioning</li>
<li>Box model</li>
<li>Typographic</li>
<li>Visual</li>
<li>Misc</li>
</ul>
<p>ä¸ Declaration order ç›¸å…³çš„æ’ä»¶è¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªï¼Œæœ‰äº›å·²ç»å¥½å‡ å¹´æ²¡æ›´æ–°äº†ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
<ul>
<li><a href="https://www.npmjs.com/package/stylelint-config-concentric-order">stylelint-config-concentric-order</a></li>
<li><a href="https://www.npmjs.com/package/stylelint-config-clean-order">stylelint-config-clean-order</a></li>
<li><a href="https://www.npmjs.com/package/stylelint-config-rational-order">stylelint-config-rational-order</a></li>
<li><a href="https://www.npmjs.com/package/prettier-plugin-rational-order">prettier-plugin-rational-order</a>ï¼ˆåŸºäº <code>stylelint-config-rational-order</code> çš„ Prettier æ’ä»¶ï¼‰</li>
</ul>
<p>ä»¥ä¸Šè¿™äº›é›†æˆåˆ°é¡¹ç›®é‡Œé¢æ˜¯éå¸¸å¥½ç”¨çš„ï¼Œä½†å¯¹äºå•ä¸ªæ–‡ä»¶æˆ–è€…å·¥ç¨‹åŒ–ç¨‹åº¦ä¸é«˜çš„é¡¹ç›®ï¼Œå®ƒä»¬æ²¡åŠæ³•æ–½å±•æ‰åã€‚åŸå› æ˜¯å®ƒä»¬éƒ½æ˜¯åŸºäº Stylelint çš„æ’ä»¶ <a href="https://github.com/hudochenkov/stylelint-order"><code>stylelint-order</code></a> å®ç°çš„ï¼Œè€Œå¯¹åº” VS Code æ’ä»¶å¹¶ä¸æ”¯æŒé…ç½®æ’ä»¶ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ–‡ä¼šå€ŸåŠ©ä¸€ä¸ªåä¸º <a href="https://github.com/csscomb/csscomb.js">CSScomb.js</a> çš„æ ¼å¼åŒ–ç¨‹åºï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½ä¾¿æ˜¯ã€Œ<strong>å±æ€§æ’åº</strong>ã€ï¼Œå¯¹åº”çš„ VS Code æ’ä»¶æ˜¯ <a href="https://marketplace.visualstudio.com/items?itemName=mrmlnc.vscode-csscomb">vscode-csscomb</a>ã€‚</p>
<blockquote>
<p>CSScomb.js æœ€åæ›´æ–°å·²ç»æ˜¯ 2019 å¹´ï¼Œçœ‹èµ·æ¥ä¼¼ä¹ä¸å†ç»´æŠ¤æ›´æ–°äº†ï¼Œå¯¹åº”æ’ä»¶ä¹Ÿå› æ­¤ä¸å†æ›´æ–°ã€‚</p>
</blockquote>
<p>å°½ç®¡å¦‚æ­¤ï¼Œå®ƒç›®å‰ä»ç„¶è¶³å¤Ÿå¥½ç”¨ã€‚</p>
<h2>é…ç½®</h2>
<p>å…¶ä¸­ vscode-csscomb æ’ä»¶é…ç½®é¡¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688027724003.png" alt=""></p>
<p>æ­¤å¤„ä¸å±•å¼€è¯´æ˜ï¼Œå…·ä½“å¯çœ‹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://github.com/csscomb/csscomb.js#2-configure">CSScomb.js</a></li>
<li><a href="https://github.com/mrmlnc/vscode-csscomb#supported-settings">vscode-csscomb</a></li>
</ul>
<p>æˆ‘çš„ VS Code é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;csscomb.formatOnSave&quot;: true,
  &quot;csscomb.syntaxAssociations&quot;: {
    &quot;*.wxss&quot;: &quot;css&quot;,
    &quot;*.acss&quot;: &quot;css&quot;
  },
  &quot;csscomb.ignoreFilesOnSave&quot;: [&quot;node_modules/**&quot;],
  &quot;csscomb.preset&quot;: &quot;~/Library/Mobile Documents/com~apple~CloudDocs/Terminal/csscomb/preset-custom.json&quot;,
}
</code></pre>
<p>å…¶ä¸­ï¼Œå¯¹äºåƒå°ç¨‹åºç­‰ WXSS æ ·å¼æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ <code>csscomb.syntaxAssociations</code> è¿›è¡Œå…³è”ï¼Œä½¿å…¶å½“æˆ CSS ä¸€æ ·å»å¤„ç†ã€‚</p>
<p>ç”±äº <a href="https://github.com/mrmlnc/vscode-csscomb#csscombpreset"><code>csscomb.preset</code></a> é…ç½®é¡¹éå¸¸åœ°é•¿ï¼ˆ<code>sort-order</code> é€ æˆçš„ï¼‰ï¼Œä¹Ÿä¾¿äºå¤šè®¾å¤‡åŒæ­¥ï¼Œæˆ‘é€‰æ‹©å°†å…¶å­˜æ”¾åˆ° iCloud Drive ç›®å½•ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;exclude&quot;: [
    &quot;.git/**&quot;,
    &quot;node_modules/**&quot;,
    &quot;bower_components/**&quot;
  ],
  &quot;verbose&quot;: true,
  &quot;always-semicolon&quot;: true,
  &quot;block-indent&quot;: 2,
  &quot;color-case&quot;: &quot;lower&quot;,
  &quot;color-shorthand&quot;: true,
  &quot;element-case&quot;: &quot;lower&quot;,
  &quot;eof-newline&quot;: true,
  &quot;leading-zero&quot;: true,
  &quot;quotes&quot;: &quot;single&quot;,
  &quot;remove-empty-rulesets&quot;: false,
  &quot;space-before-colon&quot;: 0,
  &quot;space-after-colon&quot;: 1,
  &quot;space-before-combinator&quot;: 1,
  &quot;space-after-combinator&quot;: 1,
  &quot;space-before-opening-brace&quot;: 1,
  &quot;space-after-opening-brace&quot;: &quot;\n&quot;,
  &quot;space-before-closing-brace&quot;: &quot;\n&quot;,
  &quot;space-before-selector-delimiter&quot;: 0,
  &quot;space-after-selector-delimiter&quot;: &quot;\n&quot;,
  &quot;space-between-declarations&quot;: &quot;\n &quot;,
  &quot;strip-spaces&quot;: true,
  &quot;unitless-zero&quot;: true,
  &quot;vendor-prefix-align&quot;: false,
  &quot;sort-order&quot;: []
}
</code></pre>
<p>ä»¥ä¸Šéƒ½æ˜¯ä¸€äº›æ¯”è¾ƒå¸¸è§„çš„é…ç½®ï¼Œå…¶ä¸­ä¸€äº›ä¹Ÿæ˜¯ä¸ºäº†è·Ÿ Prettier ä¿æŒä¸€è‡´è€Œè®¾ç½®çš„ã€‚å¦å¤–ï¼Œä¸ºäº†é¿å…å½±å“ç¯‡å¹…ä»¥ä¸Š <code>sort-order</code> é…ç½®çœç•¥äº†ï¼Œå¯å‚è€ƒ<a href="https://github.com/toFrankie/lint-config-custom/blob/ee24000a9d9c99188bb2e82dd9cc1cf380e55bb8/.csscomb.json">è¿™é‡Œ</a>ã€‚</p>
<h2>ç”Ÿæˆ sort-order</h2>
<p>ç”±äº CSS åœ¨ä¸æ–­çš„å‘å±•ï¼Œä¸ºäº†è®© <code>sort-order</code> è·Ÿä¸Šæœ€æ–°æ ‡å‡†ï¼Œè¿™é‡Œä½¿ç”¨ <a href="https://github.com/stormwarning/stylelint-config-recess-order"><code>stylelint-config-recess-order</code></a> æ¥ç”Ÿæˆã€‚</p>
<p>è„šæœ¬å¾ˆç®€å•ï¼Œä»…ä¾›å‚è€ƒï¼š</p>
<pre><code class="language-js">const path = require('path')
const fs = require('fs')
const propertyGroups = require('stylelint-config-recess-order/groups')

const CSSCOMB_SORT_ORDER_FILE_PATH = path.resolve(__dirname, '../csscomb/sort-order.json')
const CSSCOMB_PRESET_BASE_FILE_PATH = path.resolve(__dirname, '../csscomb/preset-base.json')
const CSSCOMB_PRESET_CUSTOM_FILE_PATH = path.resolve(__dirname, '../csscomb/preset-custom.json')

;(function main() {
  // generate sort-order
  const sortOrder = []
  propertyGroups.forEach(group =&gt; {
    if (!group?.properties?.length) return
    sortOrder.push(...group.properties)
  })

  // write sort-order.json
  let preset = { 'sort-order': sortOrder }
  const content = JSON.stringify(preset, null, 2)
  fs.writeFileSync(CSSCOMB_SORT_ORDER_FILE_PATH, content, 'utf8')

  // read preset-base.json
  const presetBaseContent = fs.readFileSync(CSSCOMB_PRESET_BASE_FILE_PATH, 'utf8')
  const presetBase = JSON.parse(presetBaseContent)

  // write preset.json
  preset = {
    ...presetBase,
    ...preset,
  }
  const presetContent = JSON.stringify(preset, null, 2)
  fs.writeFileSync(CSSCOMB_PRESET_CUSTOM_FILE_PATH, presetContent, 'utf8')
})()
</code></pre>
<p>å…¶ä¸­ <code>preset-base.json</code> å°±æ˜¯ä¸Šä¸€ç« èŠ‚ <code>csscomb.preset</code> æ‰€è´´å‡ºæ¥çš„å†…å®¹ï¼Œé™¤äº† <code>sort-order</code> é€‰é¡¹ä¹‹å¤–ï¼Œå…¶ä»–åŸºæœ¬ä¸Šæ˜¯ä¸å˜çš„ã€‚å…¶ä¸­ <code>sort-order.json</code> åªæ˜¯æœ¬åœ°çš„ä¸€ä»½å­˜æ¡£ï¼Œå¯è¦å¯ä¸è¦ã€‚æœ€åç”Ÿæˆçš„ <code>preset-custom.json</code> æ–‡ä»¶æ‰æ˜¯ä¾› <code>vscode-csscomb</code> ä½¿ç”¨çš„é…ç½®ã€‚</p>
<p>è¿™ä¸ªè„šæœ¬ç”Ÿæˆçš„è¿‡ç¨‹ï¼Œæˆ‘æ˜¯å°†å®ƒå­˜æ”¾åœ¨ iCloud Drive ä¸­çš„ã€‚æ¯”å¦‚ï¼Œä»Šå¤©å†™ä¸‹æ–‡ç« çš„æ—¶å€™æˆ‘å‘ç° <code>stylelint-config-recess-order</code> å¯æ›´æ–°ï¼Œåªè¦æ›´æ–°ä¸‹ä¾èµ–ï¼Œç„¶åæ‰§è¡Œ NPM Script å°± OK äº†ã€‚</p>
<h3>å…³äº node_modules åŒæ­¥é—®é¢˜</h3>
<p>ä»¥ä¸Šæ–¹å¼ï¼ŒåŠ¿å¿…åœ¨æœ¬åœ°äº§ç”Ÿä¸€ä¸ª <code>node_modules</code> ç›®å½•ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›é‡Œé¢æˆåƒä¸Šä¸‡çš„æ–‡ä»¶åœ¨ iCloud Drive ä¸­åŒæ­¥ã€‚</p>
<blockquote>
<p>å¦‚æœå¸Œæœ› iCloud Drive ä¸ŠæŸä¸ªç›®å½•ä¸åŒæ­¥ï¼Œéœ€åœ¨ç›®å½•åç§°ååŠ ä¸Š <code>.nosync</code>ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œå¦‚æœå°† <code>node_modules</code> ä¿®æ”¹ä¸º <code>node_modules.nosync</code>ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ï¼Œå°±ä¼šå› ä¸ºæ‰¾ä¸åˆ° <code>node_modules</code> è€Œå‡ºé”™ã€‚è¿™é‡Œå¯å‚è€ƒ <a href="https://github.com/HaoChuan9421/nosync-icloud">nosync-icloud</a> çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>åŸç†å¤§è‡´æ˜¯ï¼šåˆ›å»ºä¸€ä¸ªåä¸º <code>node_modules</code> çš„è½¯é“¾æ¥è‡³ <code>node_modules.nosync</code> ç›®å½•ï¼Œè€Œè½¯é“¾æ¥æ–‡ä»¶å†…å®¹åªæ˜¯å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶åœ°å€ï¼Œæ–‡ä»¶å¤§å°å¯å¿½ç•¥ï¼Œæ‰€ä»¥å®ƒåŒæ­¥åˆ° iCloud Drive ä¹Ÿé—®é¢˜ä¸å¤§ã€‚å½“è„šæœ¬æ‰§è¡Œï¼Œåœ¨æŸ¥æ‰¾ <code>node_modules</code> æ¨¡å—æ—¶ï¼Œä¼šæŒ‡å‘çœŸå®çš„ç›®å½•ï¼Œæ‰€ä»¥ä¹Ÿæ²¡é—®é¢˜ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://codeguide.co/">Code Guide @mdo</a></li>
<li><a href="https://github.com/stormwarning/stylelint-config-recess-order">stylelint-config-recess-order</a></li>
<li><a href="https://github.com/csscomb/csscomb.js#2-configure">CSScomb.js</a></li>
<li><a href="https://github.com/mrmlnc/vscode-csscomb#supported-settings">vscode-csscomb</a></li>
<li><a href="https://github.com/microsoft/vscode-docs/blob/c938434304d6b1b8d71898d2fc6941ff4782434c/release-notes/v1_44.md">Explicit ordering for Code Actions on save</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç®€å•æ˜“ç”¨çš„å›¾ç‰‡å‹ç¼©å°å·¥å…·]]></title>
            <link>https://github.com/toFrankie/blog/issues/314</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/314</guid>
            <pubDate>Thu, 29 Jun 2023 01:22:07 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688005927517.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œå›¾ç‰‡å‹ç¼©æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚ç½‘ä¸Šå„ç±»å‹ç¼©]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688005927517.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œå›¾ç‰‡å‹ç¼©æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚ç½‘ä¸Šå„ç±»å‹ç¼©å·¥å…·ä¼—å¤šï¼Œå¦‚æœå¯¹å›¾ç‰‡å‹ç¼©æ²¡æœ‰å¾ˆé«˜ã€å¾ˆç²¾ç»†çš„è¦æ±‚ï¼Œé‚£ä¹ˆ <a href="https://tinypng.com/">TinyPNG</a> æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688005743813.png" alt=""></p>
<p>æœ€ç›´æ¥çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ï¼šæ‰“å¼€å…¶<a href="https://tinypng.com/">å®˜ç½‘</a>ã€ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ã€å†ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<p><strong>æ˜¯çš„ï¼Œæˆ‘è§‰ç€æœ‰ç‚¹éº»çƒ¦</strong>ã€‚å¦‚æœåªæ˜¯å¶å°”ã€ä¸€ä¸¤å¼ å›¾ç‰‡çš„è¯è¿˜å¥½ã€‚</p>
<p>æœ¬æ–‡æ¨èä¸€ä¸ª CLI å·¥å…·ï¼š<a href="https://www.npmjs.com/package/tinypng-cli"><strong>tinypng-cli</strong></a>ï¼ˆnpm packageï¼‰ï¼Œå¯çœå»æ‰‹åŠ¨ä¸Šä¼ ä¸ä¸‹è½½çš„è¿‡ç¨‹ï¼Œä¸”æ²¡æœ‰æœ€å¤§ 5MB é™åˆ¶ã€‚</p>
<h2>å®‰è£…</h2>
<p>å…¨å±€å®‰è£…ï¼š</p>
<pre><code class="language-shell">$ npm i tinypng-cli -g
</code></pre>
<p>å…¶ CLI å‘½ä»¤å°±æ˜¯ <code>tinypng</code>ã€‚</p>
<p>ä½¿ç”¨ä¹‹å‰ï¼Œéœ€å‰å¾€ <a href="https://tinypng.com/developers">TinyPNG Developer API</a> ç”³è¯·ä¸€ä¸ª API keyï¼Œåœ¨ä¸‹æ–¹è¾“å…¥ Full name å’Œ Email å³å¯è·å–ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688003232369.png" alt=""></p>
<blockquote>
<p><strong>æ¯æœˆæœ‰ 500 ä¸ªã€Œå…è´¹ã€çš„å‹ç¼©æ¬¡æ•°</strong> ğŸ‘ğŸ»ï¼ˆäºæˆ‘è€Œè¨€è¶³çŸ£ï¼‰ã€‚è‹¥æœ‰éœ€è¦ï¼Œå¯ä»¥å‰å¾€ <a href="https://tinify.com/dashboard/api">TinyPNG API Dashboard</a> å‡çº§ä»˜è´¹è®¢é˜…ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1688003599768.png" alt=""></p>
<p>è·å–åˆ° API key ä¹‹åï¼Œæˆ‘ä»¬å°†å…¶å†™å…¥åˆ°ç”¨æˆ·ç›®å½•ä¸‹çš„ <code>.tinypng</code> æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="language-shell">$ echo &lt;your-api-key&gt; &gt; ~/.tinypng
</code></pre>
<p>å¦‚æœä¸å«Œéº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸å†™å…¥è¯¥æ–‡ä»¶ï¼Œæ¯æ¬¡æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ä¼ å…¥ <code>-k</code> å‚æ•°æ¥æŒ‡å®š API keyã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ tinypng /path/to/file.png -k &lt;your-api-key&gt;
</code></pre>
<h2>ä½¿ç”¨</h2>
<p>ç”¨æ³•å¾ˆç®€å•ï¼Œæ”¯æŒå•ä¸ªæˆ–å¤šä¸ªçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¹Ÿå¯é€’å½’éå†å­ç›®å½•ã€‚
å¦‚æœæ˜¯ç›®å½•çš„è¯ï¼Œä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å›¾ç‰‡å‹ç¼©åä¼šè¦†ç›–åŸæ–‡ä»¶</strong>ã€‚</p>
</blockquote>
<pre><code class="language-shell"># 1ï¸âƒ£ å¤„ç†å½“å‰ç›®å½•ï¼ˆå…¶ä¸­ `.` å¯çœç•¥ï¼‰
$ tinypng .

# 2ï¸âƒ£ å¤„ç†å•ä¸ªç›®å½•
$ tinypng /path/to/image-dir

# 3ï¸âƒ£ å¤„ç†å¤šä¸ªç›®å½•
$ tinypng /path/to/image-dir-1 /path/to/image-dir-2

# 4ï¸âƒ£ å¤„ç†å•ä¸ªå›¾ç‰‡
$ tinypng /path/to/image.png

# 5ï¸âƒ£ å¤„ç†å¤šä¸ªå›¾ç‰‡
$ tinypng /path/to/image-1.png /path/to/image-2.png

# 6ï¸âƒ£ å¤„ç†æŒ‡å®šç›®å½•åŠå…¶å­ç›®å½•çš„æ‰€æœ‰å›¾ç‰‡ï¼ˆæŒ‡å®š `-r` å‚æ•°ï¼‰
$ tinypng /path/to/image-dir -r
</code></pre>
<p>è¿˜å¯ä»¥æŒ‡å®š <code>--width</code> å’Œ <code>--height</code> å‚æ•°ä»¥è°ƒæ•´å›¾ç‰‡å¤§å°ã€‚ä½†å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªä½¿ç”¨åœºæ™¯å¾ˆå°‘ã€‚</p>
<p>æ›´å¤šè¯·çœ‹ <a href="https://github.com/websperts/tinypng-cli#readme">tinypng-cli</a> æˆ– <code>tinypng -h</code> æŸ¥çœ‹ã€‚</p>
<pre><code class="language-shell">$ tinypng -h
Usage
  tinypng &lt;path&gt;

Example
  tinypng .
  tinypng assets/img
  tinypng assets/img/test.png
  tinypng assets/img/test.jpg

Options
  -k, --key        Provide an API key
  -r, --recursive  Walk given directory recursively
  --width          Resize an image to a specified width
  --height         Resize an image to a specified height
  -v, --version    Show installed version
  -h, --help       Show help
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è°ˆç©ºç™½ç¬¦]]></title>
            <link>https://github.com/toFrankie/blog/issues/313</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/313</guid>
            <pubDate>Sat, 17 Jun 2023 06:22:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689824579267.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>ä½œä¸º Web å‰ç«¯å¼€å‘ï¼Œä½ ä¸€å®šå¬åˆ°è¿‡ç±»ä¼¼ã€ŒHTML ä¼š]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/7/1689824579267.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>ä½œä¸º Web å‰ç«¯å¼€å‘ï¼Œä½ ä¸€å®šå¬åˆ°è¿‡ç±»ä¼¼ã€ŒHTML ä¼šå°†å¤šä¸ªç©ºæ ¼åˆå¹¶ä¸ºä¸€ä¸ªã€çš„è¯´æ³•ï¼Œä½ æœ‰æ·±å…¥äº†è§£è¿‡å®ƒæ˜¯å¦‚ä½•æŠ˜å ï¼ˆåˆå¹¶ï¼‰çš„å—ï¼Ÿ</p>
<p>æˆ‘ä»¬å¹³å¸¸ç¼–å†™çš„æºç æ–‡ä»¶ï¼Œé€šå¸¸ä¼šåŒ…å«ä¸æœ€ç»ˆå‘ˆç°æ— å…³çš„æ ¼å¼ã€‚æ¯”å¦‚ï¼Œé¡¹ç›®é‡‡ç”¨ Space æˆ– Tab çš„ç¼©è¿›é£æ ¼ï¼Œé‡Œé¢å¯èƒ½åŒ…å«äº†ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ã€‚æµè§ˆå™¨åœ¨æ¸²æŸ“æºæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ä¸€å®šçš„è§„åˆ™å¤„ç†ï¼ˆä¿ç•™æˆ–æŠ˜å ï¼‰è¿™äº›å­—ç¬¦ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡ CSS å±æ€§ï¼ˆ<code>white-space</code>ï¼‰æ§åˆ¶å…¶æ¸²æŸ“è§„åˆ™ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å……åˆ†äº†è§£ç©ºç™½ç¬¦æ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›ï¼Ÿ</p>
<h2>ç©ºç™½ç¬¦</h2>
<blockquote>
<p><strong>ç©ºç™½ç¬¦ï¼ˆWhitespaceï¼‰æ˜¯ä¸å¯è§ï¼Œä½†å¯èƒ½ä¼šå æ®ä¸€å®šç©ºé—´ï¼Œå¯åœ¨æ’ç‰ˆä¸­æä¾›æ°´å¹³æˆ–å‚ç›´ç©ºé—´çš„ä¸€ç±»å­—ç¬¦</strong>ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ã€‚ç©ºç™½ç¬¦åœ¨å„ç±»ç¼–ç¨‹è¯­è¨€ä¸­å¯ä½œä¸ºåˆ†å‰² Token çš„æ ‡è¯†ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç©ºç™½ç¬¦</th>
<th style="text-align:left">ç®€ç§°</th>
<th style="text-align:left">è½¬ä¹‰å­—ç¬¦</th>
<th style="text-align:left">ç ä½</th>
<th style="text-align:left">åè¿›åˆ¶å€¼</th>
<th style="text-align:left">åå…­è¿›åˆ¶å€¼</th>
<th style="text-align:left">HTML å®ä½“</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Spaceï¼ˆæ™®é€šç©ºæ ¼ï¼‰</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">U+0020</td>
<td style="text-align:left">32</td>
<td style="text-align:left">20</td>
<td style="text-align:left"><code>&amp;#32;</code></td>
</tr>
<tr>
<td style="text-align:left">Horizontal tabulationï¼ˆæ°´å¹³åˆ¶è¡¨ç¬¦ï¼‰</td>
<td style="text-align:left">HT</td>
<td style="text-align:left"><code>\t</code></td>
<td style="text-align:left">U+0009</td>
<td style="text-align:left">9</td>
<td style="text-align:left">9</td>
<td style="text-align:left"><code>&amp;#9;</code></td>
</tr>
<tr>
<td style="text-align:left">Line Feedï¼ˆæ¢è¡Œç¬¦ï¼‰</td>
<td style="text-align:left">LF</td>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">U+000A</td>
<td style="text-align:left">10</td>
<td style="text-align:left">0A</td>
<td style="text-align:left"><code>&amp;#10;</code></td>
</tr>
<tr>
<td style="text-align:left">Vertical tabulationï¼ˆå‚ç›´åˆ¶è¡¨ç¬¦ï¼‰</td>
<td style="text-align:left">VT</td>
<td style="text-align:left"><code>\v</code></td>
<td style="text-align:left">U+000B</td>
<td style="text-align:left">11</td>
<td style="text-align:left">0B</td>
<td style="text-align:left"><code>&amp;#11;</code></td>
</tr>
<tr>
<td style="text-align:left">Form Feedï¼ˆåˆ†é¡µç¬¦ï¼‰</td>
<td style="text-align:left">FF</td>
<td style="text-align:left"><code>\f</code></td>
<td style="text-align:left">U+000C</td>
<td style="text-align:left">12</td>
<td style="text-align:left">0C</td>
<td style="text-align:left"><code>&amp;#12;</code></td>
</tr>
<tr>
<td style="text-align:left">Carriage Returnï¼ˆå›è½¦ç¬¦ï¼‰</td>
<td style="text-align:left">CR</td>
<td style="text-align:left"><code>\r</code></td>
<td style="text-align:left">U+000D</td>
<td style="text-align:left">13</td>
<td style="text-align:left">0D</td>
<td style="text-align:left"><code>&amp;#13;</code></td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­å‚ç›´åˆ¶è¡¨ç¬¦ã€åˆ†é¡µç¬¦å¯èƒ½å°‘è§ä¸€äº›ã€‚åœ¨ <a href="https://infra.spec.whatwg.org/#ascii-whitespace">ASCII</a> ç¼–ç ä¹Ÿæ²¡æœ‰ä¸“é—¨çš„å­—ç¬¦æ¥è¡¨ç¤ºå‚ç›´åˆ¶è¡¨ç¬¦ã€‚</p>
<p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå¯é€šè¿‡ <code>\s</code> æ¥åŒ¹é…ä¸€ä¸ªé™¤æ™®é€šç©ºæ ¼ä¹‹å¤–çš„ç©ºç™½ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ <code>\n</code>ã€<code>\r</code>ã€<code>\f</code>ã€<code>\t</code>ã€<code>\v</code>ï¼‰ï¼Œç›¸å½“äº <code>/[\n\r\f\t\v]/</code>ã€‚</p>
<h2>ç©ºæ ¼</h2>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨é”®ç›˜ä¸Šçš„ Space é”®è¾“å…¥ç©ºæ ¼ï¼ˆä¹Ÿå°±æ˜¯<strong>æ™®é€šç©ºæ ¼</strong>ï¼‰ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¡¨ç¤ºç©ºæ ¼çš„å­—ç¬¦è¿˜æœ‰å¾ˆå¤šç§ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">åç§°</th>
<th style="text-align:left">HTML å®ä½“</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Space%20(punctuation)">Space</a></td>
<td style="text-align:left"><code>&amp;32;</code></td>
<td style="text-align:left">æ™®é€šç©ºæ ¼ï¼Œé”®ç›˜ Space é”®äº§ç”Ÿçš„ç©ºæ ¼ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Non-breaking_space">Non-breaking space</a></td>
<td style="text-align:left"><code>&amp;npsp;</code></td>
<td style="text-align:left">åŠè§’ä¸æ¢è¡Œç©ºæ ¼ï¼Œå…¶å æ®çš„å®½åº¦å—å­—ä½“å½±å“æ˜æ˜¾ã€‚åŒºåˆ«äºæ™®é€šç©ºæ ¼ï¼Œåœ¨ macOS ä¸Šå¯é€šè¿‡ã€ŒAlt + Spaceã€æ‰“å‡ºä¸€ä¸ª Non-breaking spaceã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/En_(typography)">En space</a></td>
<td style="text-align:left"><code>&amp;ensp;</code></td>
<td style="text-align:left">åŠè§’ç©ºæ ¼ï¼Œè¡¨ç°ä¸º 1/2 ä¸ªä¸­æ–‡çš„å®½åº¦ï¼ŒåŸºæœ¬ä¸å—å­—ä½“å½±å“ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Em_(typography)">Em space</a></td>
<td style="text-align:left"><code>&amp;emsp;</code></td>
<td style="text-align:left">å…¨è§’ç©ºæ ¼ï¼Œè¡¨ç°ä¸º 1 ä¸ªä¸­æ–‡çš„å®½åº¦ï¼ŒåŸºæœ¬ä¸å—å­—ä½“å½±å“ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Thin_space">Thin space</a></td>
<td style="text-align:left"><code>&amp;thinsp;</code></td>
<td style="text-align:left">å®…ç©ºæ ¼ï¼Œé¡¾åæ€ä¹‰å…¶å æ®çš„å®½åº¦æ¯”è¾ƒå°ï¼Œä¸º em çš„ 1/6 å®½ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Zero-width_space">Zero-width space</a></td>
<td style="text-align:left"><code>&amp;ZeroWidthSpace;</code></td>
<td style="text-align:left">é›¶å®½ç©ºæ ¼ï¼Œæ˜¯ä¸€ç§ä¸å¯è§ã€ä¸å¯æ‰“å°çš„ Unicode å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Zero-width_joiner">Zero-width joiner</a></td>
<td style="text-align:left"><code>&amp;zwj;</code></td>
<td style="text-align:left">é›¶å®½è¿å­—ï¼Œæ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ï¼Œå¯ä½¿å¾—ä¸¤ä¸ªæœ¬ä¸ä¼šå‘ç”Ÿè¿å­—çš„å­—ç¬¦äº§ç”Ÿè¿å­—æ•ˆæœã€‚</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Zero-width_non-joiner">Zero-width non-joiner</a></td>
<td style="text-align:left"><code>&amp;zwnj;</code></td>
<td style="text-align:left">é›¶å®½ä¸è¿å­—ï¼Œæ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ï¼Œç”¨äºæŠ‘åˆ¶æœ¬æ¥ä¼šå‘ç”Ÿçš„è¿å­—ä½¿å¾—å…¶ä»¥åŸæœ¬çš„å­—ç¬¦æ¥ç»˜åˆ¶ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œåªæœ‰ã€Œæ™®é€šç©ºæ ¼ã€æ‰ç®—ä½œç©ºç™½ç¬¦ã€‚</p>
</blockquote>
<p>åœ¨ HTML ä¸­å¯å‘ç”ŸæŠ˜å çš„ç©ºæ ¼ï¼Œä¹Ÿåªæœ‰æ™®é€šç©ºæ ¼æ‰ä¼šã€‚</p>
<!--

å¯¹æ¯”ç¤ºä¾‹å¦‚ä¸‹ï¼š

```html
<div>Hey Frankie</div>

<div>Hey&nbsp;Frankie</div>

<div>Hey&ensp;Frankie</div>

<div>Hey&emsp;Frankie</div>

<div>Hey&thinsp;Frankie</div>

<div>Hey&ZeroWidthSpace;Frankie</div>

<div>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ vs ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦</div>

<div>Auflage vs Auf&zwnj;lage</div>
```

ä¸ºäº†å±•ç¤ºæ¢è¡Œçš„æ•ˆæœï¼Œæ•…æ„è®¾ `<div>` å®½åº¦ä¸º 60pxï¼Œä½¿å¾—ä¸€è¡Œå®¹ä¸ä¸‹ `Hey Frankie` æ–‡æœ¬ã€‚

```css
div {
  width: 60px;
  border: 1px solid #f00;
  margin-bottom: 30px;
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![](https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1685866841342.png)

å…¶ä¸­ `Hey Frankie` å’Œ `Hey&nbsp;Frankie`ï¼Œå‰è€…çš„ç©ºæ ¼æ˜¯é€šè¿‡é”®ç›˜ Space é”®è¾“å…¥çš„ï¼Œåè€…åˆ™æ˜¯åœ¨æºç ä¸­é”®å…¥äº† `&nbsp;`ï¼Œè¿™æ ·å¯ä»¥æ›´ç›´è§‚åœ°äº†è§£ No-Breaking Space çš„å«ä¹‰ï¼ˆä¸æ¢è¡Œç©ºæ ¼ï¼‰ã€‚`Hey&nbsp;Frankie` å°±ç›¸å½“äº `Hey Frankie` + `white-space: nowrap` çš„æ•ˆæœã€‚

å…¶ä¸­ `Hey Frankie` å’Œ `Hey&ensp;Frankie`ã€`Hey&emsp;Frankie`ã€`Hey&thinsp;Frankie`ï¼Œç”±äºä¸€è¡Œå®¹ä¸ä¸‹ï¼Œå› æ­¤éƒ½è¡¨ç°å‡ºäº†æ¢è¡Œçš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ã€Œç©ºæ ¼ã€åº”è¯¥æ˜¯ä¸€ä¸ªæ¢è¡Œç‚¹ã€‚å¦å¤–è¯·æ³¨æ„ï¼Œå°½ç®¡ä¸Šè¿°æˆªå›¾ä¸­å®ƒä»¬å‡ ä¸ªçš„æ¸²æŸ“æ•ˆæœç›¸åŒï¼Œä½†å®é™…ä¸Šå¹¶ä¸å®Œå…¨ç›¸åŒï¼Œä¸¤ä¸ªå•è¯ä¹‹é—´ç©ºæ ¼æ‰€å å®½åº¦æ˜¯ä¸å¤ªä¸€æ ·çš„ï¼Œè¯·çœ‹ [CodePen](https://codepen.io/tofrankie/pen/YzRKzex) ç¤ºä¾‹ã€‚

å…¶ä¸­ `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦` å®ƒæ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„æˆçš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹ HTML æºç å¯ä»¥å‘ç°å®ƒå°±æ˜¯ç”¨ `ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦` è¡¨ç¤ºçš„ï¼Œé›¶å®½è¿å­—çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€å°±æ˜¯ Emoji è¡¨æƒ…ã€‚æˆ‘æƒ³ï¼Œä½ åº”è¯¥çœ‹è¿‡è¯¸å¦‚ `[...'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦']` å°†ä¸€å®¶å››å£åˆ†å¼€çš„æ¢—ã€‚

å…¶ä¸­ `Auflage` æ˜¯ã€Œauf + lageã€ç»„æˆçš„å¤åˆè¯ï¼Œå¾·è¯­è¡¨ç¤ºç‰ˆæœ¬çš„æ„æ€ã€‚ä»”ç»†å¯¹æ¯” `f` å’Œ `l` å­—æ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ `fl` æ˜¯æœ‰è¿å­—æ•ˆæœçš„ï¼Œå½“ä¸¤è€…é—´åŠ å…¥ `&zwnj;` åæœ¬èº«ä¼šè¿å­—çš„ä¸¤ä¸ªå­—ç¬¦è¢«åˆ†å¼€äº†ã€‚è¯·æ³¨æ„ï¼Œè¿å­—æ•ˆæœä¸å­—ä½“æ˜¯æœ‰å…³çš„ï¼Œæ¢äº†å…¶ä»–å­—ä½“å¯èƒ½æ²¡æœ‰è¿å­—æ•ˆæœï¼Œæˆ–è€…è¿å­—æ•ˆæœä¸ä¸Šè¿°æˆªå›¾ä¸åŒã€‚

-->
<h2>å›è½¦ç¬¦ä¸æ¢è¡Œç¬¦</h2>
<p>å¯èƒ½è¿˜æœ‰ä¸€éƒ¨åˆ†åŒå­¦è¿˜åˆ†ä¸æ¸…ã€Œå›è½¦ã€å’Œã€Œæ¢è¡Œã€åŒºåˆ«çš„ã€‚</p>
<p>éšç€è®¡ç®—æœºçš„å¿«é€Ÿå‘å±•å’Œæ™®åŠï¼Œå¤§å®¶å¸¸è¯´çš„ã€Œæ¢è¡Œã€æˆ–ã€Œå›è½¦ã€æ“ä½œæ‰€è¡¨ç¤ºçš„æ„æ€ï¼Œç›¸æ¯”ä¹‹å‰ï¼Œå…¶å®æ—©å°±å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<blockquote>
<p>é€šå¸¸è¡¨ç¤ºä¸ºã€Œç§»åŠ¨è‡³ä¸‹ä¸€è¡Œè¡Œé¦–ã€ï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ Return/Enter é”®æ‰€åšçš„äº‹æƒ…ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¦‚ä»Šçš„åº”ç”¨ç¨‹åºåŠŸèƒ½è¶Šæ¥è¶Šå¼ºå¤§ï¼Œåœ¨æŒ‰ä¸‹ Return é”®åï¼Œå®ƒç”šè‡³å¯ä»¥è‡ªåŠ¨æ’å…¥æŒ‡å®šæ•°é‡çš„åˆ¶è¡¨ç¬¦æˆ–ç©ºæ ¼ä»¥å¿«é€Ÿå®ç°æ–‡æœ¬å¯¹é½ï¼ˆå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿæˆ–è€…åº”ç”¨ç¨‹åºçš„å®ç°ï¼‰ã€‚</p>
</blockquote>
<p>å…³äºã€Œå›è½¦ã€å’Œã€Œæ¢è¡Œã€çš„è¯æºï¼Œå®ƒä»¬æºèµ·è‡ª<a href="https://www.wikiwand.com/en/Typewriter">æ‰“å­—æœº</a>ï¼Œååº”ç”¨äºè®¡ç®—æœºã€‚åœ¨æ‰“å­—æœºä¸­æ¦‚å¿µå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å›è½¦ï¼ˆCarriage Return, CRï¼‰</strong>ï¼šè¡¨ç¤ºç§»åŠ¨è‡³<strong>å½“å‰è¡Œ</strong>è¡Œé¦–ã€‚</li>
<li><strong>æ¢è¡Œï¼ˆLine Feed, LFï¼‰</strong>ï¼šè¡¨ç¤ºç§»åŠ¨è‡³ä¸‹ä¸€è¡Œï¼Œä½†<strong>ä¸æ˜¯</strong>ä¸‹ä¸€è¡Œè¡Œé¦–ã€‚</li>
</ul>
<p>åœ¨æ—©æœŸï¼Œæœºæ¢°æ‰“å­—æœºå¤„ç†å­—ç¬¦çš„æ•ˆç‡å¾ˆä½ï¼Œä¸ºäº†é¿å…ä¸¢å¤±å­—ç¬¦ï¼Œé¡»å…ˆæ‰§è¡Œ <code>CR</code> æ“ä½œï¼Œå†æ‰§è¡Œ <code>LF</code> æ“ä½œã€‚ç°ä»£æ„ä¹‰ä¸Šçš„æ¢è¡Œç›¸å½“äºæ‰“å­—æœºä¸­ã€Œå›è½¦ + æ¢è¡Œã€çš„ç»„åˆã€‚</p>
<blockquote>
<p>ä½œä¸ºä¸€åè½¯ä»¶å¼€å‘è€…ï¼Œæœ¬ç€ä¸¥è°¨çš„æ€åº¦ï¼Œä¹ æƒ¯åœ°å°† <code>CR</code> ç§°ä¸ºã€Œå›è½¦ç¬¦ã€ï¼Œå°† <code>LF</code> ç§°ä¸ºã€Œæ¢è¡Œç¬¦ã€è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚</p>
</blockquote>
<h3>è®¡ç®—æœºä¸­çš„ä¸¤ç§æ¢è¡Œç¬¦</h3>
<p>å¾ˆå¤šåŒå­¦éƒ½çŸ¥é“ï¼Œç›®å‰ä¸»æµæ“ä½œç³»ç»Ÿä¸­è¡¨ç¤ºæ¢è¡Œçš„å­—ç¬¦ï¼Œæœ‰ <code>\r\n</code> å’Œ <code>\n</code> ä¸¤ç§ã€‚åŸå› æ˜¯å½“æ—¶å­˜å‚¨éå¸¸æ˜‚è´µï¼Œæœ‰äº›äººè®¤ä¸ºç”¨ <code>CR+LF</code> ä¸¤ä¸ªå­—ç¬¦è¡¨ç¤ºæ¢è¡Œè¿‡äºæµªè´¹ï¼Œå› æ­¤äº§ç”Ÿäº†åˆ†æ­§ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ“ä½œç³»ç»Ÿ</th>
<th style="text-align:left">ç®€ç§°</th>
<th style="text-align:left">è½¬ä¹‰å­—ç¬¦</th>
<th style="text-align:left">ç ä½</th>
<th style="text-align:left">åè¿›åˆ¶å€¼</th>
<th style="text-align:left">åå…­è¿›åˆ¶å€¼</th>
<th style="text-align:left">HTML å®ä½“</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows</td>
<td style="text-align:left">CR LF</td>
<td style="text-align:left"><code>\r\n</code></td>
<td style="text-align:left">U+000D U+000A</td>
<td style="text-align:left">13 10</td>
<td style="text-align:left">0D 0A</td>
<td style="text-align:left"><code>&amp;#13;&amp;#10;</code></td>
</tr>
<tr>
<td style="text-align:left">Unix, Linux, OS X, macOS</td>
<td style="text-align:left">LF</td>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">U+000A</td>
<td style="text-align:left">10</td>
<td style="text-align:left">0A</td>
<td style="text-align:left"><code>&amp;#10;</code></td>
</tr>
<tr>
<td style="text-align:left">classic Mac OS</td>
<td style="text-align:left">CR</td>
<td style="text-align:left"><code>\r</code></td>
<td style="text-align:left">U+000D</td>
<td style="text-align:left">13</td>
<td style="text-align:left">0D</td>
<td style="text-align:left"><code>&amp;#13;</code></td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.wikiwand.com/en/Newline">More...</a></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œ<a href="https://www.wikiwand.com/en/Classic_Mac_OS#Classic">classic Mac OS</a> æ­¢äº 2001 å¹´å‘å¸ƒçš„ Mac OS 9ï¼Œå†åæ¥çš„ OS Xã€macOS çš„æ¢è¡Œç¬¦ä¸º <code>\n</code>ã€‚</p>
</blockquote>
<p><strong>æ—¢ç„¶å­˜åœ¨ä¸¤ç§æ¢è¡Œç¬¦ï¼Œå¯¹æˆ‘ä»¬ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Ÿ</strong></p>
<p>å¦‚æœè½¯ä»¶å±‚é¢æ²¡åšå¥½é€‚é…ï¼ŒWindows æ–‡ä»¶åœ¨ Unix/Unix-like æ“ä½œç³»ç»Ÿä¸Šæ‰“å¼€å¯èƒ½ä¼šå˜æˆä¸€è¡Œã€‚è€Œ Unix/Unix-like æ–‡ä»¶åœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šæ‰“å¼€ï¼Œæ¯è¡Œç»“å°¾å¯èƒ½ä¼šå¤šä¸€ä¸ª <code>^M</code> ç¬¦å·ã€‚</p>
<p>ä½†åŸºæœ¬ä¸ç”¨æ‹…å¿ƒï¼Œå·²ç» 2023 å¹´äº†ï¼Œå¤§å¤šæ•°è½¯ä»¶éƒ½å¯ä»¥å¾ˆå¥½åœ°å…¼å®¹ä¸¤ç§æ¢è¡Œç¬¦ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¾ˆå¤š IDE/Editor éƒ½å¯ä»¥è®¾ç½®é»˜è®¤æ¢è¡Œç¬¦çš„ï¼Œä¹Ÿæœ‰å„ç§ Linter å·¥å…·ï¼ˆæ¯”å¦‚ <a href="https://editorconfig.org/">EditorConfig</a>ï¼‰è‡ªåŠ¨å¤„ç†ã€‚<strong>é€šå¸¸ï¼Œæ›´å¤šäººé€‰æ‹©å°†é»˜è®¤æ¢è¡Œç¬¦è®¾ä¸º <code>LF</code>ï¼Œä¹Ÿå°±æ˜¯ <code>\n</code></strong>ã€‚</p>
<h2>åˆ¶è¡¨ç¬¦</h2>
<p>åˆ¶è¡¨ç¬¦å°±æ˜¯é”®ç›˜ä¸Š Tab é”®è¾“å…¥çš„å­—ç¬¦ï¼Œç”¨äºå°†å…‰æ ‡å‰è¿›åˆ°ä¸‹ä¸€ä¸ªåˆ¶è¡¨ä½ï¼ˆ<a href="https://www.wikiwand.com/en/Tab_stop">Tab stop</a>ï¼‰ã€‚</p>
<p>å®ƒåŒæ ·æºè‡ªæ‰“å­—æœºï¼Œåœ¨å½“æ—¶å¦‚æœè¦æ‰“å‡ºä¸€ä¸ªè¡¨æ ¼ç­‰å†…å®¹æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¤§é‡çš„ç©ºæ ¼é”®ç­‰ï¼Œä¸ºæ­¤äººä»¬å‘æ˜äº†ä¸€ä¸ªç±»ä¼¼ç°ä»£çš„ Tab é”®çš„ä¸œè¥¿ï¼ŒæŒ‰ä¸‹è¯¥é”®å¯ä»¥å‰è¿›åˆ°ä¸‹ä¸€ä¸ªåˆ¶è¡¨ä½ã€‚</p>
<p>éšç€è®¡ç®—æœºå¿«é€Ÿå‘å±•ï¼Œç°ä»£çš„åº”ç”¨ç¨‹åºä¹Ÿè¶³å¤Ÿèªæ˜ï¼Œé™¤äº†å®ç°æ‰“å­—æœºé‚£äº›åŸºæœ¬åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›å…·æœ‰å¯¹å…¶å±æ€§çš„åˆ¶è¡¨ä½ï¼ˆæ¯”å¦‚ Microsoft Word ç­‰ï¼‰ï¼ŒåŠ¨æ€åˆ¶è¡¨ä½ã€è¡¥å…¨ï¼ˆTab completionï¼‰ç­‰èƒ½åŠ›ã€‚æ¯”å¦‚ï¼Œä»£ç ç¼–è¾‘å™¨ä¸­ Code Snippet çš„å ä½ç¬¦å¯é€šè¿‡ Tab é”®å¿«é€Ÿåˆ‡æ¢ï¼Œå°±æ˜¯åˆ©ç”¨äº†åŠ¨æ€åˆ¶è¡¨ä½å®ç°çš„ã€‚</p>
<p>å¹³å¸¸å†™ä»£ç è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ä¸‹å›è½¦é”®å¿«é€Ÿåˆ‡æ¢è‡³ä¸‹ä¸€è¡ŒæŒ‡å®šä½ç½®ï¼Œç›¸å½“äºã€ŒCR + LF + Tabã€ã€‚å¦‚æœé¡¹ç›®ä¸­æŒ‡å®šäº†ç±»ä¼¼ <code>useTab=false, tabSize=2</code> çš„é£æ ¼è¦æ±‚ï¼Œåœ¨æŒ‰ä¸‹ Tab é”®æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šæ ¹æ®é…ç½®æ›¿æ¢ä¸ºæŒ‡å®šæ•°é‡çš„ç©ºæ ¼å®ç°å¿«é€Ÿå¯¹é½æ•ˆæœï¼ˆå–å†³äºåº”ç”¨ç¨‹åºçš„å®ç°ï¼‰ã€‚</p>
<p>é€šå¸¸ Tab é”®äº§ç”Ÿçš„å­—ç¬¦ä¸ºæ°´å¹³åˆ¶è¡¨ç¬¦ï¼ˆHorizontal tabulation, HTï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å‚ç›´åˆ¶è¡¨ç¬¦ï¼ˆVertical tabulation, VTï¼‰ï¼Œç”¨äºæ‰“å°æˆ–è€… Word æ’ç‰ˆç­‰åœºæ™¯ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">åˆ¶è¡¨ç¬¦</th>
<th style="text-align:left">ç®€ç§°</th>
<th style="text-align:left">è½¬ä¹‰å­—ç¬¦</th>
<th style="text-align:left">ç ä½</th>
<th style="text-align:left">åè¿›åˆ¶å€¼</th>
<th style="text-align:left">åå…­è¿›åˆ¶å€¼</th>
<th style="text-align:left">HTML å®ä½“</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Horizontal tabulationï¼ˆæ°´å¹³åˆ¶è¡¨ç¬¦ï¼‰</td>
<td style="text-align:left">HT</td>
<td style="text-align:left"><code>\t</code></td>
<td style="text-align:left">U+0009</td>
<td style="text-align:left">9</td>
<td style="text-align:left">9</td>
<td style="text-align:left"><code>&amp;#9;</code></td>
</tr>
<tr>
<td style="text-align:left">Vertical tabulationï¼ˆå‚ç›´åˆ¶è¡¨ç¬¦ï¼‰</td>
<td style="text-align:left">VT</td>
<td style="text-align:left"><code>\v</code></td>
<td style="text-align:left">U+000B</td>
<td style="text-align:left">11</td>
<td style="text-align:left">0B</td>
<td style="text-align:left"><code>&amp;#11;</code></td>
</tr>
</tbody>
</table>
<p>æœ‰äº›æ ‡å‡†ä¸­å‚ç›´åˆ¶è¡¨ç¬¦ä¹Ÿç§°ä¸º Line tabbulationã€‚</p>
<blockquote>
<p>å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œä¸‹æ–‡æåˆ°çš„åˆ¶è¡¨ç¬¦ï¼ˆTabï¼‰å‡è¡¨ç¤ºæ°´å¹³åˆ¶è¡¨ç¬¦ï¼ˆU+0009ï¼‰ã€‚</p>
</blockquote>
<h2>HTML å®ä½“</h2>
<p>åœ¨ HTML ä¸­æœ‰äº›å­—ç¬¦æ˜¯é¢„ç•™çš„ã€‚æ¯”å¦‚å°äºå· <code>&lt;</code> å’Œå¤§äºå· <code>&gt;</code>ï¼Œå¦‚æœåœ¨æºç ä¸­ç›´æ¥é”®å…¥ï¼Œä¼šè¢«æµè§ˆå™¨è¯¯è®¤ä¸ºå®ƒä»¬æ˜¯æ ‡ç­¾ã€‚ä¸ºäº†æ­£ç¡®åœ°æ˜¾ç¤ºä¿ç•™å­—ç¬¦ã€éš¾ä»¥ç”¨é”®ç›˜è¾“å…¥çš„ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">HTML å®ä½“</a>è¡¨ç¤ºã€‚</p>
<blockquote>
<p>HTML å®ä½“æ˜¯ä»¥ <code>&amp;</code> å¼€å¤´ï¼Œä»¥ <code>;</code> ç»“æŸçš„æ–‡æœ¬ï¼Œä¸­é—´å¯ä»¥æ˜¯å®ä½“åç§°ï¼ˆEntity Nameï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å®ä½“æ•°å­—ï¼ˆEntity Numberï¼‰ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œå°äºå· <code>&lt;</code>ï¼Œå…¶å®ä½“åç§°æ˜¯ <code>lt</code>ï¼Œå®ä½“æ•°å­—ä¸º <code>60</code>ï¼ˆå¯¹åº”çš„ ASCII ç¼–ç å€¼ï¼‰ï¼Œæ‰€ä»¥å®ƒæœ‰ <code>&amp;lt;</code>ã€<code>&amp;#60;</code>ã€<code>&amp;#060;</code> ä¸‰ç§è¡¨ç¤ºæ–¹æ³•ã€‚</p>
<p>ä»¥ä¸‹åˆ—å‡ºå¯¹åº”çš„ HTML å®ä½“ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">åç§°</th>
<th style="text-align:left">å®ä½“åç§°</th>
<th style="text-align:left">å®ä½“æ•°å­—</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Space</td>
<td style="text-align:left"></td>
<td style="text-align:left"><code>&amp;#32;</code></td>
</tr>
<tr>
<td style="text-align:left">Non-breaking space</td>
<td style="text-align:left"><code>&amp;nbsp;</code></td>
<td style="text-align:left"><code>&amp;#160;</code></td>
</tr>
<tr>
<td style="text-align:left">En space</td>
<td style="text-align:left"><code>&amp;ensp;</code></td>
<td style="text-align:left"><code>&amp;#8194;</code></td>
</tr>
<tr>
<td style="text-align:left">Em space</td>
<td style="text-align:left"><code>&amp;emsp;</code></td>
<td style="text-align:left"><code>&amp;#8195;</code></td>
</tr>
<tr>
<td style="text-align:left">Thin space</td>
<td style="text-align:left"><code>&amp;thinsp;</code></td>
<td style="text-align:left"><code>&amp;#8201;</code></td>
</tr>
<tr>
<td style="text-align:left">Zero-width space</td>
<td style="text-align:left"><code>&amp;ZeroWidthSpace;</code></td>
<td style="text-align:left"><code>&amp;#8203;</code></td>
</tr>
<tr>
<td style="text-align:left">Zero-width non-joiner</td>
<td style="text-align:left"><code>&amp;zwnj;</code></td>
<td style="text-align:left"><code>&amp;#8204;</code></td>
</tr>
<tr>
<td style="text-align:left">Zero-width joiner</td>
<td style="text-align:left"><code>&amp;zwj;</code></td>
<td style="text-align:left"><code>&amp;#8205;</code></td>
</tr>
<tr>
<td style="text-align:left">Horizontal tabulation</td>
<td style="text-align:left"><code>&amp;Tab;</code></td>
<td style="text-align:left"><code>&amp;#9;</code></td>
</tr>
<tr>
<td style="text-align:left">Line feed</td>
<td style="text-align:left"></td>
<td style="text-align:left"><code>&amp;#10;</code></td>
</tr>
<tr>
<td style="text-align:left">Vertical tabulation</td>
<td style="text-align:left"></td>
<td style="text-align:left"><code>&amp;#11;</code></td>
</tr>
<tr>
<td style="text-align:left">Form feed</td>
<td style="text-align:left"></td>
<td style="text-align:left"><code>&amp;#12;</code></td>
</tr>
<tr>
<td style="text-align:left">Carriage Return</td>
<td style="text-align:left"></td>
<td style="text-align:left"><code>&amp;#13;</code></td>
</tr>
</tbody>
</table>
<p>HTML å®ä½“ç¼–ç åœ¨é¡µé¢ä¸Šå±•ç¤ºå–å†³äºé¡µé¢ä¸­æ‰€è®¾å­—ç¬¦é›†ã€‚å¸¸è§çš„é¡µé¢ä¹±ç ï¼Œå°±æ˜¯å› ä¸ºå­—ç¬¦é›†ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</p>
<ul>
<li>HTML 5 çš„é»˜è®¤å­—ç¬¦é›†æ˜¯ UTF-8</li>
<li>HTML 4.01 çš„é»˜è®¤å­—ç¬¦é›†æ˜¯ ISO-8859-1</li>
<li>HTML 1 çš„é»˜è®¤å­—ç¬¦é›†æ˜¯ ASCII ç </li>
</ul>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://html.spec.whatwg.org/multipage/named-characters.html">Named character references</a>ï¼ˆæ’ç‰ˆæœ‰æ—¶ä¼šé”™ä½ï¼‰</li>
<li><a href="https://www.freeformatter.com/html-entities.html">HTML Entity List</a></li>
<li><a href="https://www.ascii-codes.com/">ascii codes</a></li>
<li><a href="https://www.lookuptables.com/text/html-character-codes">HTML Character Codes</a></li>
</ul>
<h2>CSS ç©ºç™½ç¬¦å¤„ç†è§„åˆ™</h2>
<h3>å†™åœ¨å‰é¢</h3>
<p>åœ¨ CSS ä¸­ï¼Œè§„åˆ™æŒ‡å‡ºï¼ŒCSS çš„ç©ºç™½å¤„ç†<strong>ä»…å½±å“ä»¥ä¸‹ä¸‰ç§ç©ºç™½ç¬¦</strong>ï¼š</p>
<ul>
<li><strong>æ™®é€šç©ºæ ¼ï¼ˆSpace, U+0020ï¼‰</strong></li>
<li><strong>æ°´å¹³åˆ¶è¡¨ç¬¦ï¼ˆTab, U+0009ï¼‰</strong></li>
<li><strong>æ¢è¡Œç¬¦ï¼ˆLine Feed, U+000Aï¼‰</strong></li>
</ul>
<blockquote>
<p>å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œä¸‹æ–‡ä¸­æåˆ°å¯æŠ˜å ï¼ˆå¿½ç•¥ï¼‰çš„ç©ºç™½ç¬¦æ˜¯æŒ‡è¿™ä¸‰ç§ã€‚</p>
</blockquote>
<p>è¿™ä¸‰ä¸ªç©ºç™½ç¬¦å¯ç§°ä¸º <em>document white space characters</em>ï¼Œæœ¬æ–‡ç§°ä½œã€Œæ–‡æ¡£ç©ºç™½ç¬¦ã€ã€‚</p>
<p>ä½†åœ¨ HTML ä¸­è¡¨ç¤º Newlinesï¼ˆæ¢è¡Œï¼‰çš„å­—ç¬¦åŒ…å«æ¢è¡Œç¬¦ï¼ˆLF, U+000Aï¼‰ã€å›è½¦ç¬¦ï¼ˆCR, U+000Dï¼‰ä»¥åŠæˆå¯¹çš„ CR+LFã€‚</p>
<p><strong>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ CSS ä¸å¤„ç†å›è½¦ç¬¦ï¼ˆCR, U+000Dï¼‰å‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œæµè§ˆå™¨æ¸²æŸ“ HTML çš„æµç¨‹å¤§è‡´åŒ…æ‹¬ï¼šHTML è§£æå¾—åˆ° DOM Treeï¼ŒCSS è§£æå¾—åˆ° CSSOM Treeï¼Œç„¶å DOM Tree å’Œ CSSOM Tree ç»“åˆç”Ÿæˆ Render Treeï¼Œæ¥ç€ Layout é˜¶æ®µå°† Render Tree çš„æ‰€æœ‰èŠ‚ç‚¹åˆ†é…ç©ºé—´ç¡®å®šåæ ‡ï¼Œæœ€å Painting é˜¶æ®µå†å°†æ‰€æœ‰é˜¶æ®µç»˜åˆ¶å‡ºæ¥ã€‚è€Œ CSS èµ·ä½œç”¨å‘ç”Ÿåœ¨è§£æä¹‹åï¼Œå› æ­¤ CSS å¹¶ä¸ç›´æ¥ä½œç”¨äº HTMLï¼Œè€Œæ˜¯ DOM Treeã€‚</p>
<p>å…¶æ¬¡ï¼Œåœ¨ HTML è§£æä¸º DOM Tree çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>æ¯ä¸ªæ¢è¡Œåºåˆ—å­—ç¬¦ï¼ˆnewline sequenceï¼‰éƒ½ä¼šåšè§„èŒƒåŒ–å¤„ç†ä¸º Line Feedï¼ˆU+000Aï¼‰</strong>ï¼Œæ­¤æ—¶ Line Feed è¢«ç§°ä¸º segment breakã€‚</p>
<blockquote>
<p>To <a href="https://infra.spec.whatwg.org/#normalize-newlines">normalize newlines</a> in a string, replace every U+000D CR U+000A LF code point pair with a single U+000A LF code point, and then replace every remaining U+000D CR code point with a U+000A LF code point.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯åœ¨è§„åˆ’åŒ–å¤„ç†æ—¶ï¼Œå…ˆå°†æˆå¯¹çš„ U+000D CR U+000A LF æ›¿æ¢ä¸ºä¸€ä¸ª U+000A LFï¼Œç„¶åå°†å‰©ä½™çš„ U+000D CR ä¹Ÿæ›¿æ¢ä¸ºä¸€ä¸ª U+000A LFã€‚å› æ­¤å¯¹ CSS è€Œè¨€ï¼Œå®ƒå‹æ ¹æ„Ÿå—ä¸åˆ° U+000D çš„å­˜åœ¨ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœ HTML æ–‡æ¡£ä¸­å­˜åœ¨å›è½¦ç¬¦ï¼ˆCR, U+000Dï¼‰ï¼Œå®ƒä¸ä¼šå› ä¸ºä¸Šè¿°è§„åˆ’åŒ–å¤„ç†è€Œå‡­ç©ºæ¶ˆå¤±ï¼Œé€šè¿‡ <code>Element.innerHTML</code> ç­‰æ–¹å¼ä»ç„¶å¯ä»¥çœ‹å¾—åˆ°å…¶è½¬ä¹‰å­—ç¬¦ <code>\r</code> çš„ã€‚</p>
</blockquote>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://html.spec.whatwg.org/multipage/syntax.html#newlines">Newlines</a></li>
<li><a href="https://infra.spec.whatwg.org/#normalize-newlines">normalize newlines</a></li>
</ul>
<h3>white-space å±æ€§</h3>
<p>ç”¨äºæ§åˆ¶ç©ºç™½å¤„ç†çš„ CSS å±æ€§æ˜¯ <code>white-space</code>ï¼Œå…¶é»˜è®¤å€¼æ˜¯ <code>normal</code>ã€‚</p>
<p>è¯¥å±æ€§æŒ‡å®šäº†ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>ç©ºç™½ç¬¦æ˜¯å¦ä»¥åŠå¦‚ä½•æŠ˜å ã€‚</li>
<li>è¡Œæ˜¯å¦é‡‡ç”¨è½¯æ¢è¡Œã€‚</li>
</ul>
<p>è‹¥ <code>white-space</code> è®¾ä¸º <code>normal</code>ã€<code>nowrap</code> æˆ– <code>pre-line</code>ï¼Œé‚£ä¹ˆæ–‡æ¡£ç©ºç™½ç¬¦è¢«è®¤ä¸ºæ˜¯å¯æŠ˜å ï¼ˆcollapsibleï¼‰çš„ã€‚è¿™ç§æŠ˜å ç°è±¡å¯ä»¥ç§°ä¸ºç©ºç™½ç¬¦æŠ˜å ï¼ˆ<em>white space collapsing</em>ï¼‰ã€‚åœ¨ç©ºç™½å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰è¢«ç§»é™¤æˆ–æŠ˜å è€Œä¿ç•™ä¸‹æ¥çš„ç©ºç™½ç¬¦ï¼Œç§°ä¸ºä¿ç•™ç©ºç™½ç¬¦ï¼ˆ<em>preserved white space</em>ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">white-space</th>
<th style="text-align:left">New Lines</th>
<th style="text-align:left">Spaces and Tabs</th>
<th style="text-align:left">Text Wrapping</th>
<th style="text-align:left">End-of-line spaces</th>
<th style="text-align:left">End-of-line other space separators</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">normal</td>
<td style="text-align:left">æŠ˜å </td>
<td style="text-align:left">æŠ˜å </td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">ç§»é™¤</td>
<td style="text-align:left">æ‚¬æŒ‚ï¼ˆHangï¼‰</td>
</tr>
<tr>
<td style="text-align:left">pre</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">ä¸æ¢è¡Œ</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">ä¸æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">nowrap</td>
<td style="text-align:left">æŠ˜å </td>
<td style="text-align:left">æŠ˜å </td>
<td style="text-align:left">ä¸æ¢è¡Œ</td>
<td style="text-align:left">ç§»é™¤</td>
<td style="text-align:left">æ‚¬æŒ‚</td>
</tr>
<tr>
<td style="text-align:left">pre-wrap</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ‚¬æŒ‚</td>
<td style="text-align:left">æ‚¬æŒ‚</td>
</tr>
<tr>
<td style="text-align:left">break-spaces</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">pre-line</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">æŠ˜å </td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">ç§»é™¤</td>
<td style="text-align:left">æ‚¬æŒ‚</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>normal</strong></p>
<p>é»˜è®¤å€¼ã€‚è¯¥å€¼æŒ‡ç¤ºæµè§ˆå™¨å°†ï¼ˆå¤šä¸ªï¼‰ç©ºç™½åºåˆ—æŠ˜å ä¸ºä¸€ä¸ªå•ä¸ªå­—ç¬¦ï¼ˆæœ‰äº›æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å­—ç¬¦ï¼‰ã€‚å…è®¸å­˜åœ¨è½¯æ¢è¡Œæœºä¼šçš„ä½ç½®æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>pre</strong></p>
<p>æ„ä¸ºä¿ç•™ï¼ˆpreservedï¼‰ã€‚è¯¥å€¼é˜²æ­¢æµè§ˆå™¨æŠ˜å ç©ºç™½åºåˆ—ã€‚Line Feedï¼ˆU+000Aï¼‰è¢«ä¿ç•™ä¸º <em>forced line breaks</em>ï¼Œå½“ä¸”ä»…å½“ä¸ºå¼ºåˆ¶æ¢è¡Œç¬¦æ—¶ï¼Œæ‰å‘ç”Ÿæ¢è¡Œã€‚å½“å®¹å™¨çš„å®½åº¦æ— æ³•æ»¡è¶³å†…å®¹æ—¶ï¼Œå†…å®¹ä¼šå‘ç”Ÿæº¢å‡ºã€‚</p>
</li>
<li>
<p><strong>nowrap</strong></p>
<p>æ„ä¸ºä¸æ¢è¡Œã€‚è¯¥å€¼åƒ <code>normal</code> ä¸€æ ·ä¼šæŠ˜å ç©ºç™½åºåˆ—ï¼Œä½†åˆåƒ <code>pre</code> é‚£æ ·ï¼Œä¸å…è®¸æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>pre-wrap</strong></p>
<p>æ„ä¸ºä¿ç•™æ¢è¡Œã€‚åƒ <code>pre</code> é‚£æ ·ä¿ç•™ç©ºç™½åºåˆ—ï¼Œåˆåƒ <code>normal</code> é‚£æ ·å…è®¸æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>break-spaces</strong></p>
<p>è¯¥å€¼ä¸ <code>pre-wrap</code> è¡Œä¸ºä¸€è‡´ï¼Œé™¤äº†ï¼š</p>
<ul>
<li>ä»»ä½•ä¿ç•™çš„ç©ºç™½åºåˆ—å’Œå…¶ä»–ç©ºæ ¼åˆ†éš”ç¬¦æ€»æ˜¯å æ®ç©ºé—´ï¼ŒåŒ…æ‹¬åœ¨è¡Œå°¾ã€‚</li>
<li>è½¯æ¢è¡Œæœºä¼šå­˜åœ¨äºåœ¨æ¯ä¸ªä¿ç•™çš„ç©ºç™½åºåˆ—ä¹‹åå’Œæ¯ä¸ªå…¶ä»–ç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆåŒ…æ‹¬ç›¸é‚»ç©ºæ ¼ä¹‹é—´ï¼‰ ä¹‹åã€‚</li>
</ul>
</li>
<li>
<p><strong>pre-line</strong></p>
<p>è¯¥å€¼ä¸ <code>normal</code> ä¸€æ ·ï¼Œæ­¤å€¼æŠ˜å è¿ç»­çš„ç©ºç™½å­—ç¬¦ï¼Œå¹¶å…è®¸æ¢è¡Œï¼Œä½†åŒæ—¶ä¿ç•™æºç ä¸­çš„ Line Feed ä½œä¸º <em>forced line breaks</em>ã€‚</p>
</li>
</ul>
<blockquote>
<p>åœ¨ <a href="https://www.unicode.org/reports/tr44/tr44-30.html">UnicodeÂ® Standard Annex #44</a> å®šä¹‰äº†ä¸€äº›åŒ…æ‹¬ <a href="https://jkorpela.fi/chars/spaces.html">U+1680ã€U+2000 ~ U+200A</a> åœ¨å†…çš„ 12 ä¸ªç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆSpace separatorï¼‰ã€‚åœ¨ CSS è§„èŒƒæ–‡æ¡£ä¸­ï¼Œå°†é™¤äº†æ™®é€šç©ºæ ¼ï¼ˆU+0020ï¼‰å’Œä¸æ¢è¡Œç©ºæ ¼ï¼ˆU+00A0ï¼‰ä¹‹å¤–çš„ç©ºæ ¼åˆ†éš”ç¬¦ç§°ä¸ºå…¶ä»–ç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆ<em>other space separators</em>ï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p><code>white-space: normal</code> å°±åƒå¾ªè§„è¹ˆçŸ©çš„å€”ç‰›ï¼Œå®ƒä¸ç®¡ä½ æ˜¯å¦æœ‰æ˜¾ç¤ºæŒ‡å®šæ¢è¡Œç¬¦ï¼ˆLine Feedï¼‰ï¼Œå®ƒåªä¼šåœ¨è¯¥æ¢è¡Œçš„æ—¶å€™ï¼ˆæœ‰è½¯æ¢è¡Œæœºä¼šï¼‰æ‰è¿›è¡Œæ¢è¡Œï¼Œæ¯”å¦‚å—å®¹å™¨ç©ºé—´ä¸å¤Ÿäº†ï¼Œè€Œä¸”æœ‰è½¯æ¢è¡Œæœºä¼šçš„æ—¶å€™æ‰è¿›è¡Œæ¢è¡Œã€‚åŒæ—¶ä¸ºäº†æ’ç‰ˆæ›´ç¾è§‚ï¼Œå®ƒä¼šå°†è¿ç»­çš„ç©ºç™½ç¬¦æŠ˜å æˆä¸€ä¸ªã€‚ä½†ä¸ºäº†æ»¡è¶³å„ç§å„æ ·çš„æ’ç‰ˆéœ€æ±‚ï¼Œæ‰æœ‰äº†å…¶ä»–å€¼ä»¥æ–¹ä¾¿æ¢è¡Œã€æˆ–è€…ä¿ç•™å¤šä¸ªç©ºæ ¼ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>å…³äºè½¯æ¢è¡Œæœºä¼šï¼š</p>
<p>ä»¥ä¸­æ–‡ä¸ºä¾‹ï¼Œæ¯ä¸ªç©ºæ ¼ã€ä¸­æ–‡å­—åé¢éƒ½å­˜åœ¨ä¸€ä¸ªè½¯æ¢è¡Œæœºä¼šã€‚è¿˜æœ‰ä¸­æ–‡æ ‡ç‚¹ç¬¦å·æœ‰ä¸€ç§ã€Œé¿å¤´ã€æˆ–ã€Œé¿å°¾ã€ç‰¹æ€§ï¼Œå®ƒä»¬é€šå¸¸ä¸ä¼šåœ¨è¡Œé¦–æˆ–è¡Œå°¾å‡ºç°ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡ <code>line-break</code> æ¥æ”¹å˜ã€‚</p>
<p>ä»¥è‹±æ–‡å’Œæ•°å­—ä¸ºä¾‹ï¼Œè½¯æ¢è¡Œæœºä¼šé€šå¸¸æ˜¯ç©ºæ ¼ï¼Œç”±è¿ç»­çš„æ•°å­—æˆ–å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•è¯ï¼Œè¦ä¸å°±ä»è¿™ä¸ªå­—ç¬¦ä¸²å¼€å¤´å°±æŠ˜è¡Œæ˜¾ç¤ºï¼Œè¦ä¸å°±æ˜¯åœ¨å­—ç¬¦ä¸²ç»“æŸåçš„ç©ºæ ¼å¤„æ‰ä¼šæ¢è¡Œï¼ˆå³ä½¿å†…å®¹æº¢å‡ºï¼‰ã€‚æ¯”å¦‚ <code>&lt;div&gt;11111...&lt;/div&gt;</code>ï¼ˆè¿™é‡Œæœ‰è¶³å¤Ÿå¤šçš„ <code>1</code> ç»„æˆï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒåªä¼šå•è¡Œæ˜¾ç¤ºï¼ŒåŸå› å°±æ˜¯å®ƒä¸­é—´æ²¡æœ‰è½¯æ¢è¡Œæœºä¼šã€‚</p>
<p>å¯¹äºä¸€äº›ä¸ä»¥ç©ºæ ¼æˆ–æ ‡ç‚¹ç¬¦å·åˆ†å‰²çš„è¯­è¨€ï¼Œè¿™é‡Œå°±ä¸å±•å¼€å™è¿°äº†ã€‚</p>
</blockquote>
<!--

### ç©ºç™½å¤„ç†

1. æ ¹æ® `white-space` å†³å®šç©ºç™½ç¬¦æ˜¯å¦å¯æŠ˜å ï¼š
    1. å¦‚æœå¯æŠ˜å ï¼ˆ`normal`ã€`nowrap` æˆ– `pre-line`)ï¼Œ
        1. å°† Line Feed å‰åçš„ Space å’Œ Tab åˆ é™¤ï¼›
        2. æ ¹æ® `white-space` å†³å®š Line Feed æ˜¯å¦å¯æŠ˜å ï¼š
            1. è‹¥ä¸å¯æŠ˜å ï¼ˆ`pre`ã€`pre-wrap`ã€`break-spaces` æˆ– `pre-line`ï¼‰ï¼Œä¿ç•™ Line Feedã€‚
            2. è‹¥å¯æŠ˜å ï¼ˆ`normal` æˆ– `nowrap`ï¼‰ï¼š
                1. å°†å¤šä¸ª Line Feed ç§»é™¤å‰©ä½™æœ€åä¸€ä¸ªï¼›
                2. è¦ä¸å°† Line Feed è½¬æ¢ä¸º Spaceï¼Œè¦ä¸ç§»é™¤ Line Feedï¼ˆå–å†³äºæµè§ˆå™¨ï¼‰ã€‚
        3. å°†æ‰€æœ‰ Tab è½¬æ¢ä¸º Spaceï¼›
        4. å°†å¤šä¸ª Space æŠ˜å ä¸ºä¸€ä¸ª Spaceã€‚
    2. å¦‚æœä¸å¯æŠ˜å ï¼ˆ`pre`ã€`pre-wrap` æˆ– `break-spaces`ï¼‰ï¼Œä»»ä½• Space å½“åš Non-breaking spaceã€‚
2. æ¸²æŸ“å—ï¼Œå¤„ç†æ¯è¡Œå‰å¯¼ã€å°¾éšçš„ç©ºç™½ç¬¦ï¼š
    1. ç§»é™¤æ¯è¡Œè¡Œé¦–çš„æ‰€æœ‰ Spaceï¼›
    2. è‹¥ `tab-size` ä¸º `0`ï¼Œåˆ™ä¸æ¸²æŸ“ Tabï¼Œå¦åˆ™æŒ‰å€¼æ¸²æŸ“ Tabï¼ˆæ³¨æ„ `tab-size` çš„é»˜è®¤å€¼ä¸º `8`ï¼‰ï¼›
    3. è‹¥æ¯è¡Œè¡Œå°¾æœ‰å¯æŠ˜å çš„ Spaceï¼Œå°†å…¶ç§»é™¤ï¼›
    4. è‹¥æ¯è¡Œè¡Œå°¾å­˜åœ¨ç©ºç™½ç¬¦ã€å…¶ä»–ç©ºæ ¼åˆ†éš”ç¬¦å’Œä¿ç•™çš„ Tabï¼Œå†æ ¹æ® `white-space` å†³å®šæ˜¯å¦æ‚¬æŒ‚ï¼ˆHangï¼‰ã€‚
    
> æ€»çš„æ¥è¯´ï¼Œå…ˆå°†ç©ºç™½ç¬¦åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯ Space å’Œ Tabï¼Œå¦ä¸€ç±»æ˜¯ Line Feedã€‚
>
> å¦‚æœæ˜¯å¯æŠ˜å çš„ï¼ŒTab æœ€ç»ˆä¼šè½¬æ¢ä¸º Spaceï¼Œç„¶å Line Feed åˆ™æ ¹æ® `white-space` å†åˆ¤æ–­æ˜¯ä¿ç•™ï¼Œè¿˜æ˜¯è½¬ä¸º Spaceï¼Œæœ€åå¤šä¸ª Space è¢«æŠ˜å æˆä¸€ä¸ª Spaceã€‚
>
> å¦‚æœæ˜¯ä¸å¯æŠ˜å çš„ï¼ŒSpace ä¸ä¼šæŠ˜å ï¼Œè¢«å½“åšä¸æ¢è¡Œç©ºæ ¼ã€‚Tab æ ¹æ® `tab-size` è¿›è¡Œæ¸²æŸ“ã€‚Line Feed ä¹Ÿæ ¹æ® `white-space` å†åˆ¤æ–­æ˜¯å¦ä¿ç•™ã€‚
                
-->
<h3>ç©ºç™½å¤„ç†è§„åˆ™</h3>
<p>åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>æŠ˜å ä¸è½¬æ¢</li>
<li>è£å‰ªä¸å®šä½</li>
<li>æ¢è¡Œè½¬æ¢è§„åˆ™</li>
</ul>
<p>ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µä¸­æåˆ°çš„ Line Feedï¼Œåœ¨è§„èŒƒä¸­æ—¶ç”¨ <em>segment break</em> è¡¨ç¤ºçš„ã€‚å¦‚æœ <a href="https://www.w3.org/TR/CSS21/conform.html#doclanguage">Document language</a> æœªå®šä¹‰ segment break æˆ– newline sequence çš„è¯ï¼Œé‚£ä¹ˆæ–‡æœ¬ä¸­çš„ Line Feedï¼ˆU+000Aï¼‰è¢«è§†ä¸º segment breakã€‚å› æ­¤ä¸‹é¢æ‰ç›´æ¥ç§°ä¸º Line Feedã€‚</p>
<h4>æŠ˜å ä¸è½¬æ¢ï¼ˆCollapsing and Transformationï¼‰</h4>
<p>å¯¹äºå†…è”æ ¼å¼ä¸Šä¸‹æ–‡ï¼ˆ<a href="https://www.w3.org/TR/CSS2/visuren.html#normal-flow">Inline formatting contexts</a>, IFCï¼‰ä¸­çš„æ¯ä¸ªå†…è”å…ƒç´ ï¼Œç©ºç™½åºåˆ—åœ¨æ¢è¡Œå’Œ<a href="https://www.w3.org/TR/css-writing-modes-4/#text-direction">åŒå‘é‡æ–°æ’åº</a>ï¼ˆé’ˆå¯¹è¯¸å¦‚é˜¿æ‹‰ä¼¯è¯­ç­‰ä»å³åˆ°å·¦ä¹¦å†™çš„è¯­è¨€ï¼‰ä¹‹å‰ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œå¤„ç†ï¼š</p>
<ul>
<li>
<p>å¦‚æœ <code>white-space</code> è®¾ä¸º <code>normal</code>ã€<code>nowrap</code> æˆ– <code>pre-line</code>ï¼Œç©ºç™½åºåˆ—è¢«è®¤ä¸ºæ˜¯å¯æŠ˜å çš„ï¼Œå¹¶é€šè¿‡ä¸€ä¸‹æ­¥éª¤å¤„ç†ï¼š</p>
<ol>
<li>ç´§æ¥åœ¨ Line Feed ä¹‹å‰æˆ–ä¹‹åçš„ä»»ä½•å¯æŠ˜å  Space å’Œ Tab éƒ½ä¼šè¢«ç§»é™¤ã€‚</li>
<li>å¯æŠ˜å çš„ Line Feed æŒ‰ç¬¬ä¸‰ä¸ªé˜¶æ®µã€Œæ¢è¡Œè½¬æ¢è§„åˆ™ã€å¤„ç†ã€‚</li>
<li>æ¯ä¸ªå¯æŠ˜å çš„ Tab è¢«è½¬æ¢ä¸ºä¸€ä¸ªå¯æŠ˜å çš„ Spaceã€‚</li>
<li>ä»»ä½•ç´§è·Ÿåœ¨å¦ä¸€ä¸ªå¯æŠ˜å çš„ Space çš„å¯æŠ˜å  Space ä¼šè¢«æŠ˜å ï¼Œåœ¨æ¸²æŸ“æ—¶ä¸å æ®ä»»ä½•æ°´å¹³ç©ºé—´ï¼Œå³è§†è§‰ä¸Šä¸å¯è§ã€‚ä½†ä¿ç•™äº†è½¯æ¢è¡Œæœºä¼šï¼Œå¦‚æœæœ‰çš„è¯ã€‚</li>
</ol>
</li>
<li>
<p>å¦‚æœ <code>white-space</code> è®¾ä¸º <code>pre</code>ã€<code>pre-wrap</code> æˆ– <code>break-spaces</code>ï¼Œä»»ä½• Space è¢«è§†ä¸º Non-breaking spaceï¼ˆU+00A0ï¼‰ã€‚</p>
<ul>
<li>å¯¹äº <code>white-space: pre-wrap</code>ï¼Œåœ¨ä¸€ç³»åˆ—çš„ Space æˆ– Tab çš„æœ«å°¾å­˜åœ¨è½¯æ¢è¡Œæœºä¼šã€‚</li>
<li>å¯¹äº <code>white-space: break-spaces</code>ï¼Œæ¯ä¸ª Space å’Œæ¯ä¸ª Tab ä¹‹åéƒ½å­˜åœ¨è½¯æ¢è¡Œæœºä¼šã€‚</li>
</ul>
</li>
</ul>
<p>å¦‚ä½•ç†è§£å†…è”æ ¼å¼ä¸Šä¸‹æ–‡ä¸­çš„æ¯ä¸ªå†…è”å…ƒç´ ï¼ˆåŒ…å«åŒ¿åå†…è”å…ƒç´ ï¼‰ï¼Ÿ</p>
<pre><code class="language-html">&lt;p&gt;Several &lt;em&gt;emphasized words&lt;/em&gt; appear
&lt;strong&gt;in this&lt;/strong&gt; sentence, dear.&lt;/p&gt;
</code></pre>
<p><code>&lt;p&gt;</code> æ˜¯ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œé‡Œé¢åŒ…å«äº† 5 ä¸ªå†…è”å…ƒç´ ï¼Œå…¶ä¸­ 3 ä¸ªæ˜¯åŒ¿åçš„ï¼š</p>
<ul>
<li>Anonymous: <code>Several</code></li>
<li>Em: <code>emphasized words</code></li>
<li>Anonymous: <code>appear</code></li>
<li>Strong: <code>in this</code></li>
<li>Anonymous: <code>sentence, dear.</code></li>
</ul>
<blockquote>
<p>ä»»ä½•ç›´æ¥åŒ…å«åœ¨å—çº§å…ƒç´ å†…ï¼ˆè€Œä¸æ˜¯å†…è”å…ƒç´ å†…ï¼‰çš„æ–‡æœ¬éƒ½è§†ä¸ºåŒ¿åå†…è”å…ƒç´ ï¼ˆ<a href="https://www.w3.org/TR/CSS21/visuren.html#anonymous">Anonymous inline element</a>ï¼‰ã€‚</p>
</blockquote>
<h4>è£å‰ªä¸å®šä½ï¼ˆTrimming and Positioningï¼‰</h4>
<p>æ¥ç€ï¼Œæ•´ä¸ªå—ï¼ˆblockï¼‰è¢«æ¸²æŸ“ã€‚å†…è”å…ƒç´ ï¼ˆinlinesï¼‰æŒ‰ç…§åŒå‘é‡æ’çš„è§„åˆ™è¿›è¡Œå¸ƒå±€ï¼Œå¹¶æ ¹æ® <code>white-space</code> å±æ€§æŒ‡å®šçš„æ–¹å¼è¿›è¡Œæ¢è¡Œã€‚åœ¨é€è¡Œå¸ƒå±€çš„è¿‡ç¨‹ä¸­ï¼š</p>
<ol>
<li>ç§»é™¤è¡Œå¼€å¤´çš„ä¸€ç³»åˆ—å¯æŠ˜å  Spaceã€‚</li>
<li>è‹¥ <code>tab-size</code> ä¸º <code>0</code>ï¼Œä¿ç•™çš„ Tab ä¸è¿›è¡Œæ¸²æŸ“ã€‚å¦åˆ™ï¼Œæ¯ä¸ªä¿ç•™çš„ Tab éƒ½å‘ˆç°ä¸ºæ°´å¹³ç§»åŠ¨ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªå­—å½¢çš„èµ·å§‹è¾¹ç¼˜ä¸ä¸‹ä¸€ä¸ªåˆ¶è¡¨ä½ï¼ˆTab Stopï¼‰å¯¹é½ã€‚</li>
<li>è‹¥åœ¨ä¸€è¡Œçš„æœ«å°¾æœ‰ä¸€ç³»åˆ—å¯æŠ˜å çš„ Spaceï¼Œå®ƒä»¬ä¼šè¢«ç§»é™¤ã€‚åŒæ—¶ï¼Œå¦‚æœåœ¨è¡Œæœ«å°¾æœ‰ OGHAM SPACE MARKï¼ˆU+1680ï¼‰å­—ç¬¦ï¼Œå¹¶ä¸”å®ƒçš„ <code>white-space</code> ä¸º <code>normal</code>ã€<code>nowrap</code> æˆ– <code>pre-line</code>ï¼Œé‚£ä¹ˆä¹Ÿä¼šå°†è¯¥å­—ç¬¦ç§»é™¤ã€‚</li>
<li>å¦‚æœåœ¨ä¸€è¡Œçš„æœ«å°¾æœ‰æ–‡æ¡£ç©ºç™½ç¬¦ï¼ˆ<em>document white space characters</em>ï¼‰ã€å…¶ä»–ç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆ<em>other space separators</em>ï¼‰å’Œä¿ç•™çš„ Tabï¼š
<ul>
<li>å¦‚æœ <code>white-space</code> ä¸º <code>normal</code>ã€<code>nowrap</code> æˆ– <code>pre-line</code>ï¼Œæµè§ˆå™¨å¿…é¡»ï¼ˆæ— æ¡ä»¶åœ°ï¼‰æŒ‚èµ·ï¼ˆ<a href="https://drafts.csswg.org/css-text/#hang">hang</a>ï¼‰è¯¥å­—ç¬¦ã€‚</li>
<li>å¦‚æœ <code>white-space</code> ä¸º <code>pre-wrap</code>ï¼Œæµè§ˆå™¨å¿…é¡»æŒ‚èµ·è¯¥å­—ç¬¦ï¼Œé™¤éè¯¥å­—ç¬¦åè·Ÿäº†ä¸€ä¸ª <em>forced line break</em>ï¼Œè¿™æ—¶æµè§ˆå™¨å¿…é¡»ï¼ˆæœ‰æ¡ä»¶åœ°ï¼‰æŒ‚èµ·è¯¥å­—ç¬¦ã€‚æ­¤å¤–ï¼Œæµè§ˆå™¨è¿˜å¯ä»¥åœ¨è¯¥å­—ç¬¦çš„å®½åº¦è¶…å‡ºé™åˆ¶æ—¶ï¼Œå°†å…¶å­—ç¬¦å®½åº¦è¿›è¡Œè§†è§‰ä¸Šçš„æŠ˜å ã€‚</li>
<li>å¦‚æœ <code>white-space</code> ä¸º <code>break-spaces</code>ï¼ŒSpaceã€Tab å’Œ <em>other space separators</em> è¢«è§†ä¸ºä¸å…¶ä»–å¯è§å­—ç¬¦ç›¸åŒï¼Œå®ƒä»¬ä¸èƒ½è¢«æŒ‚èµ·ï¼Œä¹Ÿä¸èƒ½æŠ˜å å…¶å‰è¿›å®½åº¦ã€‚</li>
</ul>
</li>
</ol>
<h4>æ¢è¡Œè½¬æ¢è§„åˆ™ï¼ˆSegment Break Transformation Rulesï¼‰</h4>
<p>å½“ <code>white-space</code> ä¸º <code>pre</code>ã€<code>pre-wrap</code>ã€<code>break-spaces</code> æˆ– <code>pre-line</code> æ—¶ï¼ŒLine Feed ä¸å¯æŠ˜å ï¼Œè€Œæ˜¯è½¬æ¢ä¸ºä¿ç•™çš„ Line Feedï¼ˆpreserved line feed, U+000Aï¼‰ã€‚</p>
<p>è‹¥ <code>white-space</code> ä¸ºå…¶ä»–å€¼ï¼ŒLine Feed æ˜¯å¯æŠ˜å çš„ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡ŒæŠ˜å ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œç§»é™¤ç´§è·Ÿåœ¨å¦ä¸€ä¸ªå¯æŠ˜å çš„ Line Feed ä¹‹åçš„ä»»ä½•å¯æŠ˜å  Line Feedã€‚</li>
<li>ç„¶åï¼Œæ ¹æ®ä¸­æ–­å‰åçš„ä¸Šä¸‹æ–‡ï¼Œä»»ä½•å‰©ä½™çš„ Line Feed è¦ä¹ˆè¢«è½¬æ¢ä¸º Spaceï¼Œè¦ä¹ˆè¢«ç§»é™¤ã€‚å…·ä½“å–å†³äºæµè§ˆå™¨çš„å®šä¹‰ã€‚è¯·æ³¨æ„ï¼šåœ¨è¯„ä¼°æ­¤ä¸Šä¸‹æ–‡ä¹‹å‰ï¼Œç©ºç™½å¤„ç†è§„åˆ™å·²ç»ç§»é™¤äº† Line Feed å‘¨å›´çš„æ‰€æœ‰ Tab å’Œ Spaceã€‚</li>
</ol>
<h3>æ¢è¡Œä¸å•è¯è¾¹ç•Œ</h3>
<ul>
<li>å½“ inline-level content è¢«å¸ƒå±€æˆè¡Œæ—¶ï¼Œå®ƒä¼šè·¨è¡Œç›’å­è¢«æ‰“æ–­ï¼Œè¿™æ ·çš„æ¢è¡Œç§°ä¸º <strong><a href="https://drafts.csswg.org/css-text/#line-break">line break</a></strong>ã€‚</li>
<li>å½“ç”±äºæ˜¾å¼çš„æ¢è¡Œæ§åˆ¶ç¬¦(æ¯”å¦‚è¢«ä¿ç•™ä¸‹æ¥çš„æ¢è¡Œç¬¦)æˆ–å—çš„å¼€å§‹æˆ–ç»“æŸè€Œå¯¼è‡´æ¢è¡Œæ—¶ï¼Œç§°ä¸º <strong><a href="https://drafts.csswg.org/css-text/#forced-line-break">forced line break</a></strong> ã€‚</li>
<li>å½“ä¸€è¡Œç”±äºå†…å®¹æ¢è¡Œè€Œè¢«æ‰“æ–­æ—¶ï¼Œè¿™æ˜¯ <strong><a href="https://drafts.csswg.org/css-text/#soft-wrap-break">soft wrap break</a></strong>ã€‚</li>
<li>å°†è¡Œçº§å†…å®¹åˆ†æˆå¤šè¡Œçš„è¿‡ç¨‹è¢«ç§°ä¸º <strong><a href="https://drafts.csswg.org/css-text/#line-breaking-process">line breaking</a></strong>ã€‚</li>
</ul>
<p>å½“æ¢è¡Œä»…åœ¨å…è®¸çš„æ¢è¡Œç‚¹å¤„æ‰§è¡Œï¼Œç§°ä¸º <strong><a href="https://drafts.csswg.org/css-text/#soft-wrap-opportunity">soft wrap opportunity</a></strong>ï¼ˆè½¯æ¢è¡Œæœºä¼šï¼‰ã€‚å¯¹äºå¤§å¤šæ•°ä¹¦å†™ç³»ç»Ÿæ¥è¯´ï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨è¿å­—çš„æƒ…å†µä¸‹ï¼Œè½¯æ¢è¡Œåªä¼šåœ¨å•è¯ä¹‹é—´å‘ç”Ÿã€‚å¯¹äºä½¿ç”¨ç©ºæ ¼æˆ–æ ‡ç‚¹ç¬¦å·åˆ†éš”å•è¯çš„ä¹¦å†™ç³»ç»Ÿï¼Œè½¯æ¢è¡Œçš„ä½ç½®å¯ä»¥é€šè¿‡è¿™äº›å­—ç¬¦æ¥ç¡®å®šã€‚</p>
<p>å°½ç®¡ CSS æ²¡æœ‰ç”¨äºè½¯æ¢è¡Œæœºä¼šçš„å±æ€§ï¼Œä½†å¯ä»¥é€šè¿‡è¯¸å¦‚ <code>line-break</code>ã€<code>work-break</code>ã€<code>hyphens</code>ã€<code>overflow-wrap</code>/<code>work-wrap</code> å±æ€§å»æŒ‡å®šæ”¹å˜æ¢è¡Œç‚¹ã€‚</p>
<h4>æ¢è¡Œç»†èŠ‚</h4>
<p>åœ¨ç¡®å®š line break æ—¶ï¼š</p>
<ul>
<li>
<p>line breaking å’ŒåŒå‘æ–‡æœ¬çš„äº¤äº’ç”± <a href="https://www.w3.org/TR/css-writing-modes-4/#bidi-algo">CSS Writing Modes 4</a> å’Œ <a href="http://unicode.org/reports/tr9/#Reordering_Resolved_Levels">Unicode Bidirectional Algorithm</a> å®šä¹‰ã€‚</p>
</li>
<li>
<p>ä¿ç•™çš„ Line Feedã€å…·æœ‰ <a href="https://www.unicode.org/reports/tr14/tr14-49.html#BK">BK</a>ï¼ˆU+000Cã€U+000Bã€U+2028ã€U+2029ï¼‰ã€<a href="https://www.unicode.org/reports/tr14/tr14-49.html#NL">NL</a>ï¼ˆU+0085ï¼‰ç±»åˆ«çš„ Unicode å­—ç¬¦ï¼Œå¿…é¡»è§†ä¸º forced line breaksï¼Œä¸”ä¸å— <code>white-space</code> å±æ€§çš„å½±å“ã€‚</p>
</li>
<li>
<p>é™¤éå¦æœ‰æ˜ç¡®å®šä¹‰ï¼ˆä¾‹å¦‚ <code>line-break: anywhere</code> æˆ– <code>overflow-wrap: anywhere</code>ï¼‰ï¼Œå¦åˆ™å¿…é¡»éµå®ˆ <a href="https://www.unicode.org/reports/tr14/tr14-49.html#WJ">WJ</a>ï¼ˆU+2060ã€U+FEFFï¼‰ã€<a href="https://www.unicode.org/reports/tr14/tr14-49.html#ZW">ZW</a>ï¼ˆU+200Bï¼‰ã€<a href="https://www.unicode.org/reports/tr14/tr14-49.html#GL">GL</a>ï¼ˆU+00A0ã€U+202Fã€U+180Eï¼‰å’Œ <a href="https://www.unicode.org/reports/tr14/tr14-49.html#ZWJ">ZWJ</a>ï¼ˆU+200Dï¼‰ç±»åˆ«çš„ Unicode å­—ç¬¦çš„æ¢è¡Œè¡Œä¸ºã€‚</p>
</li>
<li>
<p>å¯¹äºä½¿ç”¨æ ‡ç‚¹ç¬¦å·ä½œä¸ºåˆ†éš”ç¬¦çš„ä¹¦å†™ç³»ç»Ÿï¼Œæµè§ˆå™¨å¯ä»¥å…è®¸åœ¨é™¤äº†è¯åˆ†éš”ç¬¦ä¹‹å¤–çš„æ ‡ç‚¹ç¬¦å·å¤„è¿›è¡Œæ¢è¡Œï¼Œä½†åœ¨ç¡®å®šæ¢è¡Œä½ç½®æ—¶åº”ä¼˜å…ˆè€ƒè™‘æ¢è¡Œç‚¹ï¼ˆbreakpointï¼‰çš„è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ <code>/</code> åé¢çš„æ¢è¡Œç‚¹ï¼ˆbreakpointï¼‰ä¼˜å…ˆçº§ä½äºç©ºæ ¼ï¼Œé‚£ä¹ˆåœ¨åºåˆ— <code>check /etc</code> ä¸­ï¼Œå°†ä¸ä¼šåœ¨ <code>/</code> å’Œå­—æ¯ <code>e</code> ä¹‹é—´å‘ç”Ÿæ¢è¡Œã€‚</p>
</li>
<li>
<p>è„±ç¦»æ ‡å‡†æ–‡æ¡£æµçš„å…ƒç´ ï¼ˆout-of-flow elementsï¼‰å’Œè¡Œå†…å…ƒç´ çš„è¾¹ç•Œä¸ä¼šå¼•å…¥ forced line break æˆ– soft wrap opportunityï¼Œå®ƒä»¬ä¸ä¼šä¸­æ–­æ–‡æœ¬æµçš„è¿ç»­æ€§ã€‚</p>
</li>
<li>
<p>ä¸ºäº† Web å…¼å®¹æ€§ï¼Œåœ¨æ¯ä¸ªæ›¿æ¢å…ƒç´ ï¼ˆreplaced elementï¼‰æˆ–å…¶ä»–åŸå­å†…è”ï¼ˆ<a href="https://www.w3.org/TR/css-display-3/#atomic-inline">atomic inline</a>ï¼‰å‰åéƒ½æœ‰ä¸€ä¸ªè½¯æ¢è¡Œæœºä¼šï¼Œå³ä½¿ä¸é€šå¸¸ä¼šæŠ‘åˆ¶å®ƒä»¬çš„å­—ç¬¦ç›¸é‚»æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¾‹å¦‚ Non-breaking spaceã€‚</p>
</li>
<li>
<p>å¯¹äºç”±åœ¨æ¢è¡Œå¤„æ¶ˆå¤±çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ U+0020 Spaceï¼‰åˆ›å»ºçš„è½¯æ¢è¡Œæœºä¼šï¼Œç›´æ¥åŒ…å«è¯¥å­—ç¬¦çš„ç›’å­ä¸Šçš„å±æ€§æ§åˆ¶è¯¥æœºä¼šçš„æ¢è¡Œã€‚å¯¹äºç”±ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„è¾¹ç•Œå®šä¹‰çš„è½¯æ¢è¡Œæœºä¼šï¼Œä¸¤ä¸ªå­—ç¬¦æœ€è¿‘çš„å…±åŒç¥–å…ˆä¸Šçš„ <code>white-space</code> å±æ€§æ§åˆ¶æ¢è¡Œï¼›å“ªäº›å…ƒç´ çš„ <code>line-break</code>ã€<code>word-break</code> å’Œ <code>overflow-wrap</code> å±æ€§æ§åˆ¶åœ¨æ­¤ç±»è¾¹ç•Œå¤„è½¯æ¢è¡Œæœºä¼šçš„ç¡®å®šåœ¨ CSS Level 3 ä¸­æœªå®šä¹‰ã€‚</p>
</li>
<li>
<p>å¯¹äºç›’å­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¹‹å‰æˆ–æœ€åä¸€ä¸ªå­—ç¬¦ä¹‹åçš„è½¯åŒ…è£…æœºä¼šï¼Œæ¢è¡Œå‘ç”Ÿåœ¨ç›’å­ä¹‹å‰/ä¹‹åï¼ˆåœ¨å…¶å¤–è¾¹è·è¾¹ç¼˜ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨å…¶å†…å®¹è¾¹ç¼˜å’Œå†…å®¹ä¹‹é—´å‘ç”Ÿæ¢è¡Œã€‚</p>
</li>
<li>
<p>åœ¨ <code>/</code> å‘¨å›´çš„ Ruby æ–‡æœ¬ä¸­çš„æ¢è¡Œè¡Œä¸ºåœ¨ <a href="https://www.w3.org/TR/css-ruby-1/#line-breaks">CSS Ruby Annotation Layout 1</a> ä¸­å®šä¹‰ã€‚</p>
</li>
<li>
<p>ä¸ºäº†é¿å…æ„å¤–çš„æº¢å‡ºï¼Œåœ¨æµè§ˆå™¨æ— æ³•æ‰§è¡Œæ‰€éœ€çš„è¯æ³•æˆ–æ­£å­—æ³•åˆ†æï¼ˆorthographic analysisï¼‰æ¥è¿›è¡Œéœ€è¦æ¢è¡Œçš„ä»»ä½•è¯­è¨€ï¼ˆä¾‹å¦‚ç”±äºç¼ºä¹æŸäº›è¯­è¨€çš„å­—å…¸ï¼‰æ—¶ï¼Œå®ƒå¿…é¡»åœ¨è¯¥ä¹¦å†™ç³»ç»Ÿä¸­çš„æ’ç‰ˆå­—æ¯å•å…ƒå¯¹ä¹‹é—´å‡è®¾å­˜åœ¨è½¯æ¢è¡Œæœºä¼šã€‚</p>
</li>
</ul>
<h4>work-break å±æ€§</h4>
<p>æ­¤å±æ€§æŒ‡å®šå­—æ¯ä¹‹é—´çš„è½¯æ¢è¡Œæœºä¼šï¼Œå³å®ƒæ˜¯â€œæ­£å¸¸â€ä¸”å…è®¸æ¢è¡Œçš„ä½ç½®ã€‚</p>
<ul>
<li>
<p><strong>normal</strong>ï¼ˆé»˜è®¤å€¼ï¼‰</p>
<p>é»˜è®¤æ–­è¡Œè§„åˆ™ï¼Œåƒä¸Šé¢æåˆ°çš„ <strong><a href="https://drafts.csswg.org/css-text/#line-break">line break</a></strong> é‚£æ ·ï¼Œå•è¯æŒ‰ç…§å®ƒä»¬è‡ªå·±çš„ä¹ æƒ¯è¿›è¡Œæ–­è¡Œã€‚</p>
</li>
<li>
<p><strong>break-all</strong></p>
<p>åœ¨æ–­è¡Œä¸­å…è®¸åœ¨å•è¯å†…è¿›è¡Œæ–­è¡Œã€‚å…·ä½“è€Œè¨€ï¼Œé™¤äº† <code>normal</code> çš„è½¯æ¢è¡Œæœºä¼šå¤–ï¼Œä»»ä½•æ’ç‰ˆå­—æ¯å•å…ƒï¼ˆä»¥åŠè§£æä¸º <a href="https://www.unicode.org/reports/tr14/tr14-49.html#NU">NU</a>ï¼ˆNumericï¼‰ã€<a href="https://www.unicode.org/reports/tr14/tr14-49.html#AL">AL</a>ï¼ˆAlphabeticï¼‰æˆ– <a href="https://www.unicode.org/reports/tr14/tr14-49.html#SA">SA</a>ï¼ˆSouth East Asianï¼‰æ–­è¡Œç±»åˆ«çš„ä»»ä½•æ’ç‰ˆå­—ç¬¦å•å…ƒï¼‰éƒ½è¢«è§†ä¸ºè¡¨æ„å­—ç¬¦ï¼ˆideographic characters, <a href="https://www.unicode.org/reports/tr14/tr14-49.html#ID">ID</a>ï¼‰ç”¨äºæ–­è¡Œçš„ç›®çš„ã€‚ä¸ä¼šåº”ç”¨è¿å­—ç¬¦åŒ–ã€‚</p>
</li>
<li>
<p><strong>keep-all</strong></p>
<p>åœ¨å•è¯å†…ç¦æ­¢æ–­è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥é€‰é¡¹ä¸ <code>normal</code> æƒ…å†µç›¸åŒã€‚åœ¨è¿™ç§æ ·å¼ä¸­ï¼Œè¿ç»­çš„ <a href="https://www.wikiwand.com/en/CJK%20characters">CJK</a>ï¼ˆä¸­æ–‡ã€æ—¥æ–‡å’ŒéŸ©æ–‡çš„ç»Ÿç§°ï¼‰å­—ç¬¦åºåˆ—ä¸ä¼šæ–­è¡Œã€‚æ¯”å¦‚ï¼š<code>è¿™æ˜¯ä¸€äº›æ±‰å­— and some Latin</code> çš„æ¢è¡Œæœºä¼šåœ¨ <code>è¿™æ˜¯ä¸€äº›æ±‰å­—Â·andÂ·someÂ·Latin</code>ï¼ˆç”¨ <code>Â·</code> è¡¨ç¤ºï¼‰</p>
</li>
</ul>
<h4>line-break å±æ€§</h4>
<p>æ­¤å±æ€§æŒ‡å®šå…ƒç´ å†…åº”ç”¨çš„æ¢è¡Œè§„åˆ™çš„ä¸¥æ ¼æ€§ï¼šå°¤å…¶æ˜¯æ¢è¡Œå¦‚ä½•ä¸æ ‡ç‚¹ç¬¦å·ï¼ˆpunctuationï¼‰å’Œç¬¦å·ï¼ˆsymbolsï¼‰äº¤äº’ã€‚</p>
<ul>
<li>
<p><strong>auto</strong> ï¼ˆé»˜è®¤å€¼ï¼‰</p>
<p>æµè§ˆå™¨ç¡®å®šè¦ä½¿ç”¨çš„æ–­è¡Œé™åˆ¶é›†ï¼Œå¹¶ä¸”å®ƒå¯ä»¥æ ¹æ®è¡Œçš„é•¿åº¦å˜åŒ–é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¾ƒçŸ­çš„è¡Œä½¿ç”¨ä¸€ç»„è¾ƒå°‘é™åˆ¶çš„æ–­è¡Œè§„åˆ™ã€‚</p>
</li>
<li>
<p><strong>loose</strong></p>
<p>ä½¿ç”¨æœ€å®½æ¾çš„æ–­è¡Œè§„åˆ™æ¥æ–­å¼€æ–‡æœ¬ã€‚é€šå¸¸åœ¨çŸ­è¡Œæ–‡æœ¬ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚æŠ¥çº¸ã€‚</p>
</li>
<li>
<p><strong>normal</strong></p>
<p>ä½¿ç”¨æœ€å¸¸è§çš„ä¸€ç»„æ¢è¡Œè§„åˆ™æ¥æ‰“æ–­æ–‡æœ¬ã€‚</p>
</li>
<li>
<p><strong>strict</strong></p>
<p>ä½¿ç”¨æœ€ä¸¥æ ¼çš„ä¸€ç»„æ¢è¡Œè§„åˆ™æ¥æ–­å¼€æ–‡æœ¬ã€‚</p>
</li>
<li>
<p><strong>anywhere</strong></p>
<p>æ¯ä¸ªå°åˆ·å­—ç¬¦å•å…ƒå‘¨å›´éƒ½æœ‰ä¸€ä¸ªè½¯æ¢è¡Œæœºä¼šï¼ŒåŒ…æ‹¬ä»»ä½•æ ‡ç‚¹ç¬¦å·å‘¨å›´æˆ–ä¿ç•™çš„ç©ºç™½ç¬¦ï¼Œæˆ–åœ¨å•è¯ä¸­é—´ï¼Œæ— è§†ä»»ä½•ç¦æ­¢æ¢è¡Œç¬¦çš„è§„å®šï¼Œå³ä½¿æ˜¯é‚£äº›ç”±å…·æœ‰ <a href="https://www.unicode.org/reports/tr14/tr14-49.html#GL">GL</a>ã€<a href="https://www.unicode.org/reports/tr14/tr14-49.html#WJ">WJ</a> æˆ– <a href="https://www.unicode.org/reports/tr14/tr14-49.html#ZWJ">ZWJ</a> æ¢è¡Œç¬¦ç±»åˆ«çš„å­—ç¬¦å¼•å…¥çš„æˆ–ç”± <code>work-break</code> å±æ€§å¼ºåˆ¶è¦æ±‚ã€‚ä¸èƒ½ä¼˜å…ˆè€ƒè™‘ä¸åŒçš„æ¢è¡Œæœºä¼šã€‚ä¸åº”ç”¨è¿å­—ç¬¦ã€‚</p>
</li>
</ul>
<p>è¯·æ³¨æ„ï¼š<code>line-break: anywhere</code> åªå…è®¸åœ¨ <code>white-space</code> è®¾ä¸º <code>break-spaces</code> æ—¶ï¼Œå°†è¡Œæœ«çš„ä¿ç•™ç©ºæ ¼æ¢è¡Œåˆ°ä¸‹ä¸€è¡Œï¼Œå› ä¸ºåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>åœ¨ <code>white-space: normal</code> å’Œ <code>white-space: pre-line</code> ä¸‹ï¼Œè¡Œæœ«/è¡Œé¦–çš„ä¿ç•™ç©ºæ ¼ä¼šè¢«ä¸¢å¼ƒã€‚</li>
<li>åœ¨ <code>white-space: nowrap</code> å’Œ <code>white-space: pre</code> ä¸‹ï¼Œç¦æ­¢æ¢è¡Œã€‚</li>
<li>åœ¨ <code>white-space: pre-wrap</code> ä¸‹ï¼Œä¿ç•™ç©ºæ ¼ä¼šä¿æŒæ‚¬æŒ‚çŠ¶æ€ã€‚</li>
</ul>
<p>å½“ <code>line-break: anywhere</code> å¯¹ä¿ç•™ç©ºæ ¼äº§ç”Ÿå½±å“æ—¶ï¼ˆåœ¨ <code>white-space: break-spaces</code> ä¸‹ï¼‰ï¼Œå®ƒå…è®¸åœ¨è¿ç»­ç©ºæ ¼åºåˆ—çš„ç¬¬ä¸€ä¸ªç©ºæ ¼ä¹‹å‰è¿›è¡Œæ¢è¡Œï¼Œè€Œç‹¬ç«‹ä½¿ç”¨ <code>white-space: break-spaces</code> åˆ™ä¸å…·å¤‡è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<h4>overflow-wrap å’Œ word-wrap å±æ€§</h4>
<blockquote>
<p><code>word-wrap</code> å±æ€§åŸæœ¬å±äºå¾®è½¯æ‰©å±•çš„ä¸€ä¸ªéæ ‡å‡†ã€æ— å‰ç¼€çš„å±æ€§ï¼Œåæ¥åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­ä»¥ç›¸åŒçš„åç§°å®ç°ã€‚ç›®å‰å®ƒå·²è¢«æ›´åä¸ºÂ <code>overflow-wrap</code>ï¼Œ<code>word-wrap</code>Â ç›¸å½“äºå…¶åˆ«ç§°ã€‚è‹¥è€ƒè™‘åˆ°å…¼å®¹æ€§ï¼Œè¿˜æ˜¯ç”¨ <code>word-wrap</code> å§ã€‚</p>
</blockquote>
<p>æ­¤å±æ€§æŒ‡å®šæµè§ˆå™¨æ˜¯å¦å¯ä»¥åœ¨ä¸€è¡Œå†…ä¸å…è®¸çš„ä½ç½®æ¢è¡Œä»¥é˜²æ­¢æº¢å‡ºï¼Œå½“ otherwise-unbreakable çš„å­—ç¬¦ä¸²å¤ªé•¿è€Œæ— æ³•æ”¾å…¥è¡Œç›’å­æ—¶ã€‚å®ƒä»…åœ¨ <code>white-space</code> å…è®¸æ¢è¡Œæ—¶æœ‰æ•ˆã€‚</p>
<ul>
<li>
<p><strong>normal</strong>ï¼ˆé»˜è®¤å€¼ï¼‰</p>
<p>è¡Œåªèƒ½åœ¨å…è®¸çš„æ¢è¡Œç‚¹å¤„æ¢è¡Œã€‚ç„¶è€Œï¼Œç”±äº <code>word-break: keep-all</code> å¼•å…¥çš„é™åˆ¶å¯ä»¥æ”¾å®½ä»¥åŒ¹é… <code>word-break: normal</code> å¦‚æœè¡Œä¸­æ²¡æœ‰ otherwise-acceptable æ¢è¡Œç‚¹ã€‚</p>
</li>
<li>
<p><strong>anywhere</strong></p>
<p>å¦‚æœè¯¥è¡Œä¸­æ²¡æœ‰å…¶ä»–æ–¹é¢å¯æ¥å—çš„æ¢è¡Œç‚¹ï¼Œåˆ™å¯ä»¥åœ¨ä»»æ„ä½ç½®ä¸­æ–­ä¸€ä¸ª otherwise-unbreakable å­—ç¬¦ã€‚</p>
</li>
<li>
<p><strong>break-word</strong></p>
<p>é™¤äº†ç”± <code>overflow-wrap: break-word</code> äº§ç”Ÿçš„è½¯æ¢è¡Œæœºä¼šä¹‹å¤–ï¼Œåœ¨è®¡ç®—<a href="https://www.w3.org/TR/css-sizing-3/#min-content">å…ƒç´ çš„æœ€å°å†…å®¹å›ºæœ‰å°ºå¯¸</a>æ—¶ï¼Œä¸è€ƒè™‘å…¶ä»–ä»»ä½•è½¯æ¢è¡Œæœºä¼šã€‚</p>
</li>
</ul>
<h2>è¡Œå†…å…ƒç´ æ ‡ç­¾ä¹‹é—´çš„ç©ºç™½ç¬¦</h2>
<p>ä¸¤ä¸ªå—çº§å…ƒç´ ä¹‹é—´ã€å—çº§å…ƒç´ ä¸è¡Œå†…å…ƒç´ ä¹‹é—´çš„æ™®é€šç©ºç™½ç¬¦ä¼šè¢«å¿½ç•¥ã€‚ä½†è¡Œå†…å…ƒç´ ä¹‹é—´çš„æ™®é€šç©ºç™½ç¬¦å°±è¦æ³¨æ„äº†ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç»å¸¸é‡åˆ°ç±»ä¼¼çš„æ’ç‰ˆï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;list&quot;&gt;
  &lt;div class=&quot;item&quot;&gt;1&lt;/div&gt;
  &lt;div class=&quot;item&quot;&gt;2&lt;/div&gt;
  &lt;div class=&quot;item&quot;&gt;3&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.list {
  background: #f00;
}

.item {
  font-size: initial;
  display: inline-block;
  background: #eee;
  padding: 4px 10px;
}
</code></pre>
<p>ç»™æ¯ä¸ª <code>item</code> è®¾ä¸º <code>display: inline-block</code>ï¼Œä½¿å¾—å®ƒæ—¢èƒ½åƒå—çº§å…ƒç´ é‚£æ ·è®¾ç½®è¾¹è·å®½é«˜ç­‰ï¼Œåˆèƒ½åƒè¡Œå†…å…ƒç´ é‚£æ ·æ’åˆ—åœ¨ä¸€è¡Œä¸­ï¼Œå…¼å®¹æ€§è¿˜å¥½ã€‚ä½†é—®é¢˜å´æ˜¯è¡Œå†…å…ƒç´ ä¹‹é—´æœ‰é—´éš™ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1686665022482.png" alt=""></p>
<p>åŸå› å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨æºç ä¸­è¾“å…¥äº†ç©ºæ ¼ã€æ¢è¡Œç¬¦ï¼ˆæˆ–æ˜¯æ ¼å¼åŒ–å·¥å…·äº§ç”Ÿçš„ï¼‰ï¼Œå¯ä»¥æ‰“å°ä¸€ä¸‹ <code>list</code> å…ƒç´ çš„ HTML ç»“æ„ï¼š</p>
<pre><code class="language-txt">\n  &lt;div class=&quot;item&quot;&gt;1&lt;/div&gt;\n  &lt;div class=&quot;item&quot;&gt;2&lt;/div&gt;\n  &lt;div class=&quot;item&quot;&gt;3&lt;/div&gt;\n
</code></pre>
<blockquote>
<p>æœ¬æ–‡ä¸è®¨è®ºé‡‡ç”¨ flex ç­‰å¸ƒå±€æ–¹å¼ã€‚</p>
</blockquote>
<p>å‰å¯¼å’Œå°¾éšçš„æ™®é€šç©ºç™½ç¬¦è¢«å¿½ç•¥äº†ï¼Œä½†ä¸­é—´çš„åˆ™è¢«è§£æä¸ºæ™®é€šç©ºæ ¼ï¼Œè€Œæ™®é€šç©ºæ ¼å æ®çš„å®½åº¦åˆè·Ÿå­—ä½“å¤§å°æœ‰å…³ç³»ï¼Œå› æ­¤å°±äº§ç”Ÿäº†ç¼éš™ã€‚</p>
<p>è¯¸å¦‚å¤–éƒ¨å…ƒç´ è®¾ä¸º <code>font-size: 0</code>ã€æ”¹å˜å¸ƒå±€æ–¹å¼ç­‰ï¼Œéƒ½èƒ½ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜ï¼Œæ›´å¤šå¯çœ‹å¼ é‘«æ—­å¤§ä½¬çš„æ–‡ç« ã€Š<a href="https://www.zhangxinxu.com/wordpress/2012/04/inline-block-space-remove-%e5%8e%bb%e9%99%a4%e9%97%b4%e8%b7%9d/">å»é™¤ inline-block å…ƒç´ é—´é—´è·çš„ N ç§æ–¹æ³•</a>ã€‹ã€‚</p>
<p>é—®é¢˜çš„æœ¬è´¨æ˜¯è¡Œå†…å…ƒç´ ä¹‹é—´çš„ç©ºç™½ç¬¦æ˜¯ä¼šè¢«è§£æå‡ºæ¥çš„ï¼Œæ¯”å¦‚ <code>&lt;a&gt;link1&lt;/a&gt; &lt;a&gt;link2&lt;/a&gt;</code> ä¸¤ä¸ª <code>&lt;a&gt;</code> æ ‡ç­¾ä¹‹é—´çš„ç©ºæ ¼æ˜¯æ— æ³•å¿½ç•¥çš„ã€‚é‚£ä¹ˆå½»åº•è§£å†³é—®é¢˜çš„æ–¹å¼æ˜¯åœ¨æºç ä¸­å¹²æ‰ç©ºæ ¼ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;list&quot;&gt;
  &lt;div class=&quot;item&quot;
    &gt;1&lt;/div
  &gt;&lt;div class=&quot;item&quot;
    &gt;2&lt;/div
  &gt;&lt;div class=&quot;item&quot;&gt;3&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>è™½ç„¶è¿™ç§å†™æ³•æ˜¯ã€Œä¸‘ã€çš„ï¼Œå¯è¯»æ€§ä¸å¥½ï¼Œä½†å®ƒæ‰æ˜¯ç»ˆæè§£å†³æ–¹æ³•ã€‚</p>
<p><strong>éš¾é“æˆ‘ä»¬å¼€å‘çš„è¿‡ç¨‹ä¸­çœŸçš„è¦è¿™æ ·å†™ï¼Ÿ</strong></p>
<p>å¹¶ä¸æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨äº«å—ç€å„ç§æ¡†æ¶æ‰€å¸¦æ¥çš„ä¾¿åˆ©ï¼Œå„ç§ç¼–è¯‘ã€å‹ç¼©å·¥å…·æ¨ªè¡Œï¼Œå®ƒä»¬å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šã€Œè„æ´»ã€ï¼Œåœ¨ç¼–è¯‘å‡º HTML æˆ–è€…åŠ¨æ€æ›´æ–° DOM ä¹‹å‰å·²ç»æŠŠæ ‡ç­¾ä¹‹é—´çš„ç©ºæ ¼ã€æ¢è¡Œç¬¦éƒ½å»æ‰äº†ã€‚ä¸ä¿¡ä½ å¯ä»¥ç”¨ React ç­‰æ¡†æ¶è¿˜åŸä¸Šè¿°ç¤ºä¾‹ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯åªæ³¨é‡æ¡†æ¶ä½¿ç”¨ï¼Œè€Œå¿½è§†åŸºç¡€çŸ¥è¯†çš„ä¸€ä¸ªåæ˜ ï¼Œå®ƒæ©ç›–äº†ä¸€äº›ç»†èŠ‚ï¼Œå®¹æ˜“è®©ä½¿ç”¨è€…å¿½ç•¥æ‰äº†äº‹ç‰©çš„æœ¬è´¨ã€‚</p>
<h2>htmlWhitespaceSensitivity</h2>
<p>æˆ‘ä»¬çŸ¥é“åœ¨ <a href="https://prettier.io/docs/en/options.html#html-whitespace-sensitivity">Prettier</a> ä¸­æœ‰ä¸€ä¸ª <code>htmlWhitespaceSensitivity</code> é€‰é¡¹ï¼Œå°±æ˜¯ç”¨æ¥æŒ‡å®šå¦‚ä½•æ ¼å¼åŒ– HTML æ–‡ä»¶çš„ã€‚</p>
<p>é€šè¿‡å‰é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ <code>1&lt;b&gt; 2 &lt;/b&gt;3</code> å°†ä¼šè¢«è§£æä¸º <code>1 2 3</code>ï¼ˆä¸­é—´æ˜¯æœ‰ç©ºæ ¼çš„ï¼‰ï¼Œä½†å¦‚æœæˆ‘ä»¬æœ¬åœ°çš„æ ¼å¼åŒ–ç¨‹åºå°†æºç æ ¼å¼åŒ–ä¸º <code>1&lt;b&gt;2&lt;/b&gt;3</code>ï¼ˆæ–‡æœ¬çš„å‰å¯¼å’Œå°¾éšç©ºæ ¼è¢«ç§»é™¤ï¼‰ï¼Œé‚£ä¹ˆè§£æç»“æœå°±æ˜¯ <code>123</code>ï¼ˆä¸­é—´æ²¡æœ‰ç©ºæ ¼ï¼‰ï¼Œè¿™å¯èƒ½æ˜¯éé¢„æœŸè¡Œä¸ºã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä»¥ä¸‹å…ƒç´ ä¸èƒ½å®‰å…¨åœ°æ ¼å¼åŒ–ï¼š</p>
<pre><code class="language-html">&lt;a href=&quot;https://prettier.io/&quot;&gt;Prettier is an opinionated code formatter.&lt;/a&gt;
</code></pre>
<p>ç”±äº <code>printWidth</code> çš„å­˜åœ¨ï¼Œå®ƒæœ‰å¯èƒ½ä¼šè¢«æ ¼å¼åŒ–ä¸ºï¼š</p>
<pre><code class="language-html">&lt;a href=&quot;https://prettier.io/&quot;&gt;
  Prettier is an opinionated code formatter.
&lt;/a&gt;
</code></pre>
<p>è¿™æ ·é¡µé¢å‘ˆç°çš„é“¾æ¥å·¦å³å¯èƒ½ä¼šå‡ºç°ç©ºæ ¼ã€‚</p>
<p><code>htmlWhitespaceSensitivity</code> æä¾›äº†ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p>
<ul>
<li><code>css</code>ï¼šéµå¾ª CSS ä¸­ <code>display</code> å±æ€§çš„é»˜è®¤å€¼ã€‚</li>
<li><code>strict</code>ï¼šè®¤ä¸ºæ‰€æœ‰ç©ºç™½ç¬¦éƒ½æ˜¯é‡è¦çš„ã€‚</li>
<li><code>ignore</code>ï¼šè®¤ä¸ºæ‰€æœ‰ç©ºç™½ç¬¦éƒ½ä¸é‡è¦ã€‚</li>
</ul>
<pre><code class="language-html">&lt;!-- &lt;span&gt; is an inline element, &lt;div&gt; is a block element --&gt;

&lt;!-- input --&gt;
&lt;span class=&quot;dolorum atque aspernatur&quot;&gt;Est molestiae sunt facilis qui rem.&lt;/span&gt;
&lt;div class=&quot;voluptatem architecto at&quot;&gt;Architecto rerum architecto incidunt sint.&lt;/div&gt;
</code></pre>
<p>å¦‚æœæ˜¯ <code>&quot;htmlWhitespaceSensitivity&quot;: &quot;css&quot;</code>ï¼Œæ ¼å¼åŒ–ç»“æœå¦‚ä¸‹ã€‚å³å—çº§å…ƒç´ çš„å‰å¯¼å’Œå°¾éšç©ºç™½ç¬¦å¯ä»¥å¿½ç•¥ï¼Œå› æ­¤æ¢è¡Œæ˜¾ç¤ºã€‚è€Œè¡Œå†…å…ƒç´ å‰å¯¼æˆ–å°¾éšç©ºç™½ç¬¦æ˜¯å½±å“æ˜¾ç¤ºçš„ä¸åº”å¿½ç•¥ã€‚</p>
<pre><code class="language-html">&lt;!-- output --&gt;
&lt;span class=&quot;dolorum atque aspernatur&quot;
  &gt;Est molestiae sunt facilis qui rem.&lt;/span
&gt;
&lt;div class=&quot;voluptatem architecto at&quot;&gt;
  Architecto rerum architecto incidunt sint.
&lt;/div&gt;
</code></pre>
<p>å¦‚æœæ˜¯ <code>&quot;htmlWhitespaceSensitivity&quot;: &quot;strict&quot;</code>ï¼Œæ ¼å¼åŒ–ç»“æœå¦‚ä¸‹ã€‚</p>
<pre><code class="language-html">&lt;!-- output --&gt;
&lt;span class=&quot;dolorum atque aspernatur&quot;
  &gt;Est molestiae sunt facilis qui rem.&lt;/span
&gt;
&lt;div class=&quot;voluptatem architecto at&quot;
  &gt;Architecto rerum architecto incidunt sint.&lt;/div
&gt;
</code></pre>
<p>å¦‚æœæ˜¯ <code>&quot;htmlWhitespaceSensitivity&quot;: &quot;ignore&quot;</code>ï¼Œæ ¼å¼åŒ–ç»“æœå¦‚ä¸‹ã€‚</p>
<pre><code class="language-html">&lt;!-- output --&gt;
&lt;span class=&quot;dolorum atque aspernatur&quot;&gt;
  Est molestiae sunt facilis qui rem.
&lt;/span&gt;
&lt;div class=&quot;voluptatem architecto at&quot;&gt;
  Architecto rerum architecto incidunt sint.
&lt;/div&gt;
</code></pre>
<p>åœ¨å…¨å±€æŒ‡å®šå¤„ç†æ–¹å¼ä¹‹åï¼Œè¿˜æ”¯æŒåœ¨å±€éƒ¨æ·»åŠ  <code>&lt;!-- display: block --&gt;</code> æ¥è¦†ç›–å…¨å±€é…ç½®ã€‚æ›´å¤šè¯·çœ‹ <a href="https://prettier.io/blog/2018/11/07/1.15.0.html#whitespace-sensitive-formatting">Whitespace-sensitive formatting</a>ã€‚</p>
<h2><code>&lt;pre&gt;</code> ä¸ <code>&lt;code&gt;</code></h2>
<p>å¦‚æœè¦ä½¿å¾—å‰å¯¼ã€å°¾éšæˆ–ä¸­é—´çš„æ™®é€šç©ºæ ¼ç­‰å¦‚æºç èˆ¬å‘ˆç°åœ¨é¡µé¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;pre&gt;</code> å…ƒç´ ã€‚</p>
<p>è¯¥å…ƒç´ ä¸­çš„æ–‡æœ¬é€šå¸¸æŒ‰ç…§åŸæ–‡ä»¶ä¸­çš„ç¼–æ’ï¼Œä»¥ç­‰å®½å­—ä½“çš„å½¢å¼å±•ç°å‡ºæ¥ï¼Œæ–‡æœ¬ä¸­çš„ç©ºç™½ç¬¦ï¼ˆæ¯”å¦‚ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼‰éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚ä½†ç´§è·Ÿåœ¨ <code>&lt;pre&gt;</code> å¼€å§‹æ ‡ç­¾åçš„æ¢è¡Œç¬¦ä¼šè¢«çœç•¥ã€‚</p>
<pre><code class="language-html">&lt;pre&gt;
  *
  * ã€€ã€€ã€€â”â”“ã€€ã€€ã€€â”â”“
  * ã€€ã€€â”â”›â”»â”â”â”â”›â”»â”“
  * ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ
  * ã€€ã€€â”ƒã€€ã€€ã€€â”ã€€ã€€ã€€â”ƒ
  * ã€€ã€€â”ƒã€€â”³â”›ã€€â”—â”³ã€€â”ƒ
  * ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ
  * ã€€ã€€â”ƒã€€ã€€ã€€â”»ã€€ã€€ã€€â”ƒ
  * ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”ƒ
  * ã€€ã€€â”—â”â”“ã€€ã€€ã€€â”â”â”›
  * ã€€ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ
  * ã€€ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”ƒ
  * ã€€ã€€ã€€ã€€â”ƒã€€ã€€ã€€â”—â”â”â”â”“
  * ã€€ã€€ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”—â”“
  * ã€€ã€€ã€€ã€€â”ƒã€€ã€€ã€€ã€€ã€€ã€€ã€€â”â”›
  * ã€€ã€€ã€€ã€€â”—â”“â”“â”â”â”³â”“â”â”›
  * ã€€ã€€ã€€ã€€ã€€â”ƒâ”«â”«ã€€â”ƒâ”«â”«
  * ã€€ã€€ã€€ã€€ã€€â”—â”»â”›ã€€â”—â”»â”›
  *
  * ã€€ã€€Code is far away from bug with the animal protecting.
  *
&lt;/pre&gt;
</code></pre>
<pre><code class="language-css">pre {
  margin: 0;
  border: 1px solid #f00;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1686465790099.png" alt=""></p>
<p>ä»¥ä¸Šç¤ºä¾‹æœ‰æ™®é€šç©ºæ ¼ã€æ¢è¡Œç¬¦ã€åŠè§’ç©ºæ ¼å’Œå…¨è§’ç©ºæ ¼ç­‰ã€‚åœ¨ Markdown æ–‡æ¡£å¸¸ç”¨çš„ Code Block ä¹Ÿæ˜¯ç”¨ <code>&lt;pre&gt;</code> è¿›è¡Œæ¸²æŸ“çš„ã€‚</p>
<p>ç±»ä¼¼çš„ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>&lt;code&gt;</code> å…ƒç´ ï¼Œè¡¨ç¤ºå‘ˆç°ä¸€æ®µè®¡ç®—æœºä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¥æµè§ˆå™¨çš„é»˜è®¤ç­‰å®½å­—ä½“æ˜¾ç¤ºã€‚ä½†å®ƒä¸ <code>&lt;pre&gt;</code> ä¸åŒçš„æ˜¯ï¼Œè¿ç»­å¤šä¸ªç©ºç™½ç¬¦ä»…ç®—ä½œä¸€ä¸ªã€‚</p>
<pre><code class="language-html">&lt;p&gt;Regular text. &lt;code&gt;This is code.&lt;/code&gt; Regular text.&lt;/p&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1686466914475.png" alt=""></p>
<p>åŒæ ·åœ°ï¼Œåœ¨ Markdown ä¸­å•è¡Œä»£ç å—å°±æ˜¯ç”¨ <code>&lt;code&gt;</code>ï¼ˆå³é”®æ£€æŸ¥å…ƒç´ è¯•è¯•ï¼Ÿï¼‰å…ƒç´ è¿›è¡Œæ¸²æŸ“çš„ï¼Œä½†é€šå¸¸ç½‘ç«™ä¼šç»™è¯¥å…ƒç´ è®¾ç½®èƒŒæ™¯é¢œè‰²ä½¿å¾—æ›´åŠ çªå‡ºã€‚</p>
<h2>React å¦‚ä½•è¡¨ç¤ºæ¢è¡Œ</h2>
<p>ç”±äº JSX åœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå°†æ–‡æœ¬ä¸­çš„æ¢è¡Œç¬¦è½¬æ¢ä¸ºç©ºæ ¼ï¼ˆ<a href="https://legacy.reactjs.org/docs/jsx-in-depth.html#string-literals-1">è¯¦è§</a>ï¼‰ã€‚</p>
<blockquote>
<p>JSX removes whitespace at the beginning and ending of a line. It also removes blank lines. New lines adjacent to tags are removed; new lines that occur in the middle of string literals are condensed into a single space.</p>
</blockquote>
<p>å› æ­¤ï¼Œä»¥ä¸‹å‡ ç§å†™æ³•çš„è¡¨ç°æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸ä¼šè¡¨ç°å‡ºæ¢è¡Œï¼Œå³ä½¿ç»™è®¾ç½®ä¸Š <code>white-space: pre-wrap</code>ã€‚</p>
<pre><code class="language-html">&lt;div&gt;Hello World&lt;/div&gt;

&lt;div&gt;
  Hello World
&lt;/div&gt;

&lt;div&gt;
  Hello
  World
&lt;/div&gt;

&lt;div&gt;

  Hello World
&lt;/div&gt;
</code></pre>
<p>è§£æ³•ä¸€ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return &lt;div style={{ whiteSpace: &quot;pre-wrap&quot; }}&gt;{'Hello\nWorld'}&lt;/div&gt;
}
</code></pre>
<p>è§£æ³•äºŒï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return (
    &lt;div&gt;
      Hello
      &lt;br /&gt;
      World
    &lt;/div&gt;
  )
}
</code></pre>
<p>è§£æ³•äºŒï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return &lt;div style={{ whiteSpace: 'pre-wrap' }}&gt;{'Hello\u000AWorld'}&lt;/div&gt;
}
</code></pre>
<p>è§£æ³•ä¸‰ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return (
    &lt;div
      dangerouslySetInnerHTML={{
        __html: '&lt;div style=&quot;white-space: pre-wrap&quot;&gt;Hello&amp;#10;World&lt;/div&gt;',
      }}
    /&gt;
  )
}
</code></pre>
<blockquote>
<p>ä¸€ä¸ªæœ‰è¶£çš„ Issueï¼š<a href="https://github.com/babel/babel/issues/10356">Newline having a trailing whitespace character is removed in JSX attribute value #10356</a></p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Whitespace">Whitespace</a></li>
<li><a href="https://drafts.csswg.org/css-text/#white-space-rules">The White Space Processing Rules</a></li>
<li><a href="https://www.unicode.org/versions/Unicode15.0.0/">UnicodeÂ® 15.0.0</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Safari/WebKit æ— æ³•æ­£ç¡®æ¸²æŸ“ <foreignObject> ä¸­çš„ HTML å…ƒç´ ]]></title>
            <link>https://github.com/toFrankie/blog/issues/312</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/312</guid>
            <pubDate>Tue, 25 Apr 2023 10:14:52 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733301507617.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å®é”¤äº†ï¼ŒSafari å°±æ˜¯æ–°æ—¶ä»£çš„ IE æµè§ˆå™¨ã€‚åŸå› æ˜¯æœ‰äº›ä¸œè¥¿åœ¨ Safa]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733301507617.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å®é”¤äº†ï¼ŒSafari å°±æ˜¯æ–°æ—¶ä»£çš„ IE æµè§ˆå™¨ã€‚åŸå› æ˜¯æœ‰äº›ä¸œè¥¿åœ¨ Safari æ¸²æŸ“è¡¨ç°ä¸é¢„æœŸï¼ˆæ ‡å‡†ï¼‰ä¸ä¸€è‡´ï¼Œè€Œä¸” Safari for Mac è·Ÿ Safari for iOS çš„è¡¨ç°è¿˜ä¸ä¸€å®šæ˜¯ç›¸åŒçš„ã€‚</p>
<h2>èƒŒæ™¯</h2>
<p>ä»Šå¤©é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å¤–å±‚ä¸€ä¸ª max-width: 430px çš„ section å…ƒç´ ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ª svg å…ƒç´ ï¼Œé‡Œé¢åŒ…å«åŠ¨ç”»è¿˜æœ‰åµŒå¥—äº†ä¸€äº›å…ƒç´ ã€‚é¢„æœŸè¡¨ç°æ˜¯ï¼šç‚¹å‡»çº¢è‰²åŒºåŸŸï¼Œç»¿è‰²èƒŒæ™¯é€æ˜åº¦åŒ€é€Ÿä» 0 åˆ‡æ¢è‡³ 1ã€‚</p>
<pre><code class="language-html">&lt;section style=&quot;max-width: 430px; margin: auto; overflow: hidden; font-size: 0&quot;&gt;
  &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;pointer-events: none; width: 100%; background-color: red&quot;&gt;
    &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; background-color: green&quot;&gt;
        &lt;animate attributeName=&quot;opacity&quot; begin=&quot;click&quot; from=&quot;0&quot; to=&quot;1&quot; calcMode=&quot;linear&quot; dur=&quot;1s&quot; fill=&quot;freeze&quot; restart=&quot;never&quot; /&gt;
        &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; style=&quot;pointer-events: visible&quot;&gt;
          &lt;set attributeName=&quot;visibility&quot; begin=&quot;click&quot; to=&quot;hidden&quot; fill=&quot;freeze&quot; restart=&quot;never&quot; /&gt;
        &lt;/rect&gt;
      &lt;/svg&gt;
    &lt;/foreignObject&gt;
  &lt;/svg&gt;
&lt;/section&gt;
</code></pre>
<pre><code class="language-css">body {
  margin: 20px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682438823134.png" alt=""></p>
<p>æ ¹æ®æ‰€è®¾ç½®çš„ <code>viewBox=&quot;0 0 350 350&quot;</code>ã€<code>preserveAspectRatio=&quot;xMidYMin meet&quot;</code> ä»¥åŠ <code>width: 100%</code>ï¼ŒæŒ‰é“ç†çš„è¯ï¼Œçº¢è‰²çš„ <code>&lt;svg&gt;</code> åŠå…¶å†…åµŒå¥— <code>&lt;foreignObject&gt;</code> å’Œ <code>&lt;svg&gt;</code>ï¼Œåº”è¯¥éƒ½æ˜¯åŒç­‰å¤§å°çš„æ­£æ–¹å½¢ï¼Œè€Œä¸”å–å†³äºçˆ¶å…ƒç´  <code>&lt;section&gt;</code> çš„å®½åº¦ã€‚</p>
<p>æ˜¯çš„ï¼Œè¿™ä¸ªåœ¨ Chrome è¡¨ç°æ²¡é—®é¢˜ï¼Œ<strong>ä½†åœ¨ Safari for Mac ä¸Šå°±å‡ºç°é—®é¢˜äº†ï¼Œç¦»å¥‡çš„æ˜¯ Safari for iOS ä¹Ÿæ˜¯æ­£å¸¸çš„</strong>ã€‚</p>
<h2>æ¡ˆä¾‹ä¸€</h2>
<p>å¦‚ä¸‹å›¾ï¼Œæ­¤æ—¶ <code>&lt;body&gt;</code> çš„å®½åº¦æ˜¯å¤§äº 430pxï¼Œå› æ­¤ <code>&lt;section&gt;</code> çš„å®½åº¦ä¸º 430pxï¼Œè‡ªç„¶ <code>&lt;svg&gt;</code> çš„å®½åº¦å°±æ˜¯ <code>430px</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682439643757.png" alt=""></p>
<p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»è“è‰²æ¡†ä¹‹å¤–ï¼Œçº¢è‰²åŒºåŸŸï¼ˆæˆªå›¾ç”±äºé€‰ä¸­å…ƒç´ ï¼Œè¯¥åŒºåŸŸè¡¨ç°ä¸ºæ©˜è‰²ï¼‰ä»¥å†…çš„ä½ç½®ï¼Œä½ çŸ¥é“ Safari å®šä½åˆ°çš„å…ƒç´ æ˜¯ä»€ä¹ˆå—ï¼Ÿ</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682440118162.png" alt=""></p>
<p>å—¯......å®ƒå®šä½åˆ° <code>&lt;section&gt;</code> å…ƒç´ äº†ã€‚æ„æ€å°±æ˜¯è¯´ï¼Œå†…éƒ¨çš„ <rect> å…ƒç´ åŒºåŸŸå¹¶æœªè¦†ç›–åˆ°ç‚¹å‡»åŒºï¼Œä½†æˆ‘å®½é«˜æ˜æ˜è®¾ç½®çš„éƒ½æ˜¯ <code>100%</code>ï¼Œå°±å¾ˆç¦»è°±ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘åœ¨å³ä¾§ Elements é€‰é¡¹å¡é€‰ä¸­ <code>&lt;rect&gt;</code> å…ƒç´ æ—¶ï¼Œå®ƒè¡¨ç°çš„åŒºåŸŸæ˜æ˜å°±æ˜¯å æ»¡çš„å•Šï¼Œä¹Ÿå°±æ˜¯ <code>430 * 430</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682440419479.png" alt=""></p>
<p>Safari ä½ åœ¨ç©æˆ‘ï¼Ÿ</p>
<p>ç»å¤šæ¬¡æµ‹è¯•ï¼Œå®ƒå¯ç‚¹å‡»åŒºåŸŸåªæœ‰ <code>350 * 350</code>ï¼Œä¹Ÿå°±æ˜¯ <code>viewBox</code> é‚£ä¸ªç©ºé—´ã€‚</p>
<h3>è§£å†³åŠæ³•</h3>
<p>ç”±äºæ˜¯ Safari çš„ bugï¼Œç›®å‰åªèƒ½ç”¨ä¸€äº›æ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ³•ï¼Œç”¨é­”æ³•æ‰“è´¥é­”æ³•ã€‚</p>
<p>ç»™ <code>&lt;rect&gt;</code> è®¾ç½® <code>transform: scale(2); transform-origin: left top;</code>ï¼Œå…¶çˆ¶çº§çš„ <code>&lt;svg&gt;</code> è®¾ç½® <code>overflow: visible</code>ã€‚ç”±äº <code>&lt;foreignObject&gt;</code> å…ƒç´ é»˜è®¤ä¸º <code>overflow: hidden</code>ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒç‚¹å‡» <code>430 * 430</code> ä¹‹å¤–çš„ä½ç½®ä¼šè§¦å‘äº‹ä»¶ã€‚</p>
<h2>æ¡ˆä¾‹äºŒ</h2>
<p>åˆ©ç”¨ <code>&lt;svg&gt;</code> åšäº†ä¸€ä¸ªå¾ªç¯åˆ‡æ¢çš„äº¤äº’ï¼ŒåŒæ ·åœ°ï¼Œå®ƒåœ¨ Chrome ä¸€åˆ‡å®‰å¥½ï¼Œè€Œåœ¨ Safari ä¸‹åˆ™æƒŠå–œæ»¡æ»¡ã€‚</p>
<pre><code class="language-html">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 100%&quot;&gt;
  &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 100%&quot;&gt;
      &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
        &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 1; width: 100%; background-size: cover; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475354583.png); background-color: red&quot;&gt;
          &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.22222222; 0.33333333; 1&quot; values=&quot;1; 1; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
        &lt;/svg&gt;
      &lt;/foreignObject&gt;
      &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
        &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475369330.png); background-color: green&quot;&gt;
          &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.22222222; 0.33333333; 0.55555556; 0.66666667; 0.666666670001; 1&quot; values=&quot;0; 0; 1; 1; 0; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
        &lt;/svg&gt;
      &lt;/foreignObject&gt;
      &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
        &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475408407.png); background-color: blue&quot;&gt;
          &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.55555556; 0.66666667; 0.88888889; 0.99999999; 1&quot; values=&quot;0; 0; 1; 1; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
        &lt;/svg&gt;
      &lt;/foreignObject&gt;
      &lt;foreignObject x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
        &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475354583.png); background-color: red&quot;&gt;
          &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.88888889; 0.99999999; 1&quot; values=&quot;0; 0; 1; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
        &lt;/svg&gt;
      &lt;/foreignObject&gt;
    &lt;/svg&gt;
  &lt;/foreignObject&gt;
&lt;/svg&gt;
</code></pre>
<p>Safari è¡¨ç°å‡ºã€Œå¿½å¤§å¿½å°ã€çš„é—®é¢˜ã€‚å¦‚ä¸‹å›¾ï¼Œç°è‰²èƒŒæ™¯å¤§å°ä¸º 430 * 430ï¼Œè€Œçº¢è‰²èƒŒæ™¯å¤„åˆ™æ˜¯ 350 * 350ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682480492277.png" alt=""></p>
<p>ç”±äºå½•åˆ¶ GIF å¤ªéº»çƒ¦äº†ï¼Œä½ å¯ä»¥ä½¿ç”¨ Safari æ‰“å¼€é“¾æ¥ä½“éªŒä¸€ä¸‹ï¼š<a href="https://codepen.io/tofrankie/full/abRWpaE">https://codepen.io/tofrankie/full/abRWpaE</a>ã€‚</p>
<h3>è§£å†³æ–¹æ³•</h3>
<p>ç”±äº <code>&lt;foreignObject&gt;</code> çš„å‘ï¼Œé‚£å°±ä¸è¦åµŒå¥—å¤šå±‚ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å¤„ç†ï¼Œç»“æ„ä¸Šä¹Ÿæ›´æ¸…æ™°ã€‚</p>
<pre><code class="language-html">&lt;section&gt;
  &lt;section style=&quot;height: 0&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 1; width: 100%; background-size: cover; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475354583.png); background-color: red&quot;&gt;
      &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.22222222; 0.33333333; 1&quot; values=&quot;1; 1; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
    &lt;/svg&gt;
  &lt;/section&gt;
  &lt;section style=&quot;height: 0&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475369330.png); background-color: green&quot;&gt;
      &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.22222222; 0.33333333; 0.55555556; 0.66666667; 0.666666670001; 1&quot; values=&quot;0; 0; 1; 1; 0; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
    &lt;/svg&gt;
  &lt;/section&gt;
  &lt;section style=&quot;height: 0&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475408407.png); background-color: blue&quot;&gt;
      &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.55555556; 0.66666667; 0.88888889; 0.99999999; 1&quot; values=&quot;0; 0; 1; 1; 0; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
    &lt;/svg&gt;
  &lt;/section&gt;
  &lt;section style=&quot;height: 0&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;opacity: 0; width: 100%; background-repeat: no-repeat; background-size: cover; background-position: top center; background-image: url(https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682475354583.png); background-color: red&quot;&gt;
      &lt;animate attributeName=&quot;opacity&quot; begin=&quot;0s&quot; keyTimes=&quot;0; 0.88888889; 0.99999999; 1&quot; values=&quot;0; 0; 1; 0&quot; calcMode=&quot;linear&quot; dur=&quot;9s&quot; repeatCount=&quot;indefinite&quot; /&gt;
    &lt;/svg&gt;
  &lt;/section&gt;
  &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 350&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 100%&quot;&gt;&lt;/svg&gt;
&lt;/section&gt;
</code></pre>
<h2>åŸå› </h2>
<p>è¿™æ˜¯ Webkit çš„ Bugï¼Œç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://bugs.webkit.org/show_bug.cgi?id=23113">Layer content inside HTML in SVG foreignObject renders in the wrong place</a></li>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=976224">Support zoom on foreignObject</a></li>
</ul>
<p>è¯¥é—®é¢˜æ—©åœ¨ 2009 å¹´å°±æå‡ºäº†ï¼Œè‡³ä»Šä»ç„¶æ²¡æœ‰ä»»ä½•è¿›å±•ï¼Œéš”å£ Chromium çš„ Blink å·²åœ¨ 2020 å¹´ 9 æœˆä¿®å¤ã€‚å…¶ä¸­ä¸€ä¸ªå¯å¤ç°çš„ç¤ºä¾‹ï¼š<a href="https://codesandbox.io/s/chrome-foreignobject-defect-wf91j">https://codesandbox.io/s/chrome-foreignobject-defect-wf91j</a>ã€‚åœ¨ Safari æ‰“å¼€ä½¿ç”¨ <code>âŒ˜</code> + <code>+</code> æˆ– <code>âŒ˜</code> + <code>-</code> å»ç¼©æ”¾é¡µé¢å°±èƒ½çœ‹åˆ°ã€‚</p>
<p>æˆ‘ç”¨ Chrome 62 äº²æµ‹äº†ä¸€ä¸‹ï¼Œç¡®å®ä¹Ÿæœ‰é—®é¢˜ï¼Œè€Œä¸”åŒºåŸŸæ›´å°äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682491902277.png" alt="Chrome 62"></p>
<p>ç®€è¨€ä¹‹ï¼Œæ ¹æœ¬åŸå› å°±æ˜¯ <strong>Safari/WebKit æ— æ³•æ­£ç¡®æ¸²æŸ“ <code>&lt;foreignObject&gt;</code> ä¸­çš„ HTML å…ƒç´ </strong>ã€‚</p>
<p>å®é”¤äº†ï¼ŒSafari å°±æ˜¯æ–°æ—¶ä»£çš„ IE æµè§ˆå™¨ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/63690664/safari-macos-foreign-object-not-scaled-properly-inside-svg">Safari MacOS Foreign Object not scaled properly inside svg</a></li>
<li><a href="https://stackoverflow.com/questions/54221528/safari-is-not-respecting-scaling-applied-to-a-foreignobject">Safari is not respecting scaling applied to a foreignObject</a></li>
<li><a href="https://bugs.webkit.org/show_bug.cgi?id=23113">Layer content inside HTML in SVG foreignObject renders in the wrong place</a></li>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=976224">Support zoom on foreignObject</a></li>
<li><a href="https://github.com/bkrem/react-d3-tree/issues/284">Safari + foreignobject render issue [SOLVED]</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½ ä¸çŸ¥é“çš„ Margin]]></title>
            <link>https://github.com/toFrankie/blog/issues/311</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/311</guid>
            <pubDate>Wed, 12 Apr 2023 16:05:44 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682153556198.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åªè¦ä½ æ˜¯ Web å‰ç«¯å¼€å‘ï¼Œæ˜¯åœ¨å†™é¡µé¢ï¼Œå‡ ä¹ç¦»ä¸å¼€ Margin å§ã€‚</p>]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682153556198.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åªè¦ä½ æ˜¯ Web å‰ç«¯å¼€å‘ï¼Œæ˜¯åœ¨å†™é¡µé¢ï¼Œå‡ ä¹ç¦»ä¸å¼€ Margin å§ã€‚</p>
<p>é‚£ä¹ˆï¼Œä½ çœŸçš„äº†è§£å®ƒå—ï¼Ÿæœ‰å“ªäº›ç‰¹åˆ«çš„åº”ç”¨ï¼Ÿ</p>
<p>æœ¬æ–‡å°±ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å±•å¼€ä»‹ç»ï¼š</p>
<ul>
<li>å¤§å®¶éƒ½ç†Ÿæ‚‰çš„å†…å®¹</li>
<li>Margin Auto çš„ä½œç”¨</li>
<li>Margin ä¸ Relative Position çš„åŒºåˆ«</li>
<li>å¤–è¾¹æ¡†æŠ˜å </li>
<li>è´Ÿå€¼ Margin</li>
<li>è´Ÿå€¼ Margin çš„åº”ç”¨</li>
</ul>
<h2>ä»å¤§å®¶çŸ¥é“çš„è®²èµ·</h2>
<h3>è¯­æ³•</h3>
<p>Margin ç”¨äºè®¾ç½®å…ƒç´ çš„å¤–è¾¹è·ï¼Œå…¶è¯­æ³•å¾ˆç®€å•ã€‚</p>
<pre><code class="language-css">div {
  margin: 10px; /* ä¸€ä¸ªå±æ€§å€¼ */
  margin: 10px 20px; /* ä¸¤ä¸ªå±æ€§å€¼ */
  margin: 10px 20px 30px; /* ä¸‰ä¸ªå±æ€§å€¼ */
  margin: 10px 20px 30px 40px; /* å››ä¸ªå±æ€§å€¼ */
}
</code></pre>
<p>å››ç§æ–¹å¼å¯¹åº”çš„å«ä¹‰å¤§å®¶éƒ½æ‡‚ï¼Œå°±ä¸å†å•°å—¦äº†ï¼Œç•¥è¿‡...</p>
<h3>å±æ€§å€¼</h3>
<p>å…¶å±æ€§å€¼å¯æ¥å—å…·ä½“å€¼ï¼ˆ<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/length#">length</a>ï¼‰ã€ç™¾åˆ†æ¯”å€¼ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/percentage">percentage</a>ï¼‰å’Œ <code>auto</code> ã€‚é¡ºä¾¿æä¸€å¥ï¼Œç™¾åˆ†æ¯”å€¼é€šå¸¸æ ¹æ®çˆ¶å…ƒç´ å®½åº¦æ¥ç¡®å®šå¤§å°ï¼Œæ›´ä¸¥è°¨åº”è¯¥ç§°ä¸º<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Containing_block">åŒ…å«å—</a>ï¼ˆContaining Blockï¼‰ã€‚</p>
<h3>ä½œç”¨èŒƒå›´</h3>
<p>é™¤äº†è¡Œå†…å…ƒç´ è®¾ç½® <code>margin-top</code> å’Œ <code>margin-bottom</code> æ— æ•ˆï¼ŒåŒ…æ‹¬ <code>inline-block</code> åœ¨å†…çš„æ‰€æœ‰å…ƒç´ éƒ½ä¼šèµ·ä½œç”¨ã€‚</p>
<h3>é€»è¾‘å±æ€§</h3>
<p>æˆ‘ä»¬çŸ¥é“ <code>margin-left</code> ç­‰æ–¹å‘æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæ°¸è¿œè¡¨ç¤ºå·¦å¤–è¾¹è·ã€‚ä½†æ˜¯ä¸ Margin ç›¸å…³çš„é€»è¾‘å±æ€§ <code>margin-inline</code> å’Œ <code>margin-block</code>ï¼Œå®ƒä»¬å®é™…æ’ç‰ˆæ–¹å‘ä¼šéšç€ä¹¦å†™æ¨¡å¼ç­‰æ”¹å˜è€Œæ”¹å˜ï¼Œä¹Ÿå°±æ˜¯ <code>margin-inline-start</code> ç­‰å¯èƒ½æ˜¯å·¦å¤–è¾¹è·ï¼Œä¹Ÿå¯èƒ½æ˜¯å³å¤–è¾¹è·ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>margin-inline</code> å¯¹åº”æ°´å¹³æ–¹å‘ï¼Œ<code>margin-block</code> å¯¹åº”å‚ç›´æ–¹å‘ã€‚è¿™ä¸ªè·Ÿæˆ‘ä»¬å¹³å¸¸çš„é˜…è¯»æˆ–ä¹¦å†™ä¹ æƒ¯æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p><code>margin-block</code> æ˜¯ <code>margin-block-start</code> å’Œ <code>margin-block-end</code> çš„ç®€å†™ã€‚
<code>margin-inline</code> æ˜¯ <code>margin-inline-start</code> å’Œ <code>margin-inline-end</code> çš„ç®€å†™ã€‚</p>
</blockquote>
<p>è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">div {
  margin-inline: 10px; /* ä¸€ä¸ªå±æ€§å€¼ï¼Œåº”ç”¨äºè¡Œé¦–å’Œè¡Œæœ« */
  margin-inline: 10px 20px; /* ä¸€ä¸ªå±æ€§å€¼ï¼Œç¬¬ä¸€ä¸ªåº”ç”¨äºè¡Œé¦–ï¼Œç¬¬äºŒä¸ªåº”ç”¨äºè¡Œæœ« */
}
</code></pre>
<p><code>margin-block</code> åŒç†ã€‚é€šå¸¸æˆ‘ä»¬çš„ä¹¦å†™ä¹ æƒ¯æ˜¯ä»å·¦è‡³å³ã€ä»ä¸Šè‡³ä¸‹ï¼Œæ­¤æ—¶ <code>margin-inline</code> å¯¹åº” <code>margin-left</code> å’Œ <code>margin-right</code>ï¼Œ<code>margin-block</code> å¯¹åº” <code>margin-top</code> å’Œ <code>margin-right</code>ã€‚</p>
<blockquote>
<p>åƒ <code>*-start</code>ã€<code>*-end</code>ã€<code>*-inline-start</code>ã€<code>*-inline-end</code> ç­‰è¿™ç±»å±æ€§æ˜¯ CSS é€»è¾‘å±æ€§ï¼Œå®ƒä»¬ä¼šæ ¹æ®  <code>writing-mode</code>ã€<code>direction</code> å’Œ <code>text-orientation</code> æ‰€å®šä¹‰çš„å€¼å»å¯¹åº” <code>margin-top</code> ç­‰å±æ€§ã€‚æ­¤å¤„ä¸å±•å¼€ä»‹ç»ï¼Œæœ‰å…´è¶£è‡ªè¡ŒæŸ¥é˜…ã€‚</p>
</blockquote>
<h2>Margin Auto</h2>
<p>å½“è®¾ç½®ä¸º <code>auto</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¡ç®—å¤–è¾¹è·ã€‚ç”¨å¾—æœ€å¤šçš„å°±æ˜¯ <code>margin: auto</code> æˆ– <code>margin: 0 auto</code>ï¼Œå¯ä½¿å¾—å—çº§å…ƒç´ æ°´å¹³å±…ä¸­å¯¹é½ã€‚</p>
<p>ä»¥ä¸Šä¸¤ç§å†™æ³•æ˜¯ <code>margin: auto auto auto</code> å’Œ <code>margin: 0 auto 0 auto</code> çš„ç®€å†™ã€‚</p>
<p>å‡è®¾è¦å®ç°ä»¥ä¸‹è¿™ç§å¸ƒå±€ï¼šå­å…ƒç´ å®½åº¦æ˜¯çˆ¶å…ƒç´ çš„ 30%ï¼Œä¸”å±…å³å¯¹é½ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682149906949.png" alt=""></p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªè¦ç»™å­å…ƒç´ è®¾ç½®ä¸€ä¸ª <code>margin-left: auto</code> å°±å¯å±…å³å¯¹é½ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;border: 1px solid red&quot;&gt;
  &lt;div style=&quot;width: 30%; height: 100px; margin-right: auto; background: green&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™ä¸Šä¸‹å¤–è¾¹è·è®¾ç½® <code>auto</code> æ— æ•ˆçš„åŸå› æ˜¯æµè§ˆå™¨è‡ªåŠ¨è®¡ç®—ç»“æœä¸º <code>0</code>ï¼Œæ­¤æ—¶ <code>marign: auto</code> ç›¸å½“äº <code>margin: 0 auto</code>ã€‚å¯¹äºå·¦å³å¤–è¾¹è·è€Œè¨€ï¼Œå¦‚æœä¸€ä¾§å®šå®½ï¼Œä¸€ä¾§ autoï¼Œauto åˆ™ä¸ºå‰©ä½™ç©ºé—´å¤§å°ã€‚å¦‚æœä¸¤ä¾§å‡ä¸º autoï¼Œåˆ™ä¸¤ä¾§å¹³åˆ†å‰©ä½™ç©ºé—´ã€‚</p>
<p>å…¶å® <code>margin: auto</code> åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯ä»¥ä½¿å¾—å…ƒç´ åœ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘å®ç°å±…ä¸­ï¼Œé‚£å°±æ˜¯ç»å¯¹å®šä½çš„å…ƒç´ ã€‚</p>
<pre><code class="language-html">&lt;div id=&quot;parent&quot;&gt;
  &lt;div id=&quot;child&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">#parent {
  position: relative;
  margin: 0 auto;
  border: 1px solid red;
  width: 200px;
  height: 200px;
}

#child {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  width: 100px;
  height: 100px;
  background: green;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682151564225.png" alt=""></p>
<p>å®ç°å±…ä¸­å¯¹é½çš„å…³é”®ç‚¹ï¼šä¸€æ˜¯ä¸Šä¸‹å·¦å³åç§»å€¼å‡ä¸º <code>0</code>ï¼ŒäºŒæ˜¯ <code>margin: auto</code>ã€‚</p>
<h2>Margin ä¸ Relative Position çš„åŒºåˆ«</h2>
<p>æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ margin æˆ– position éƒ½èƒ½å®ç°ç›¸åŒçš„æ’ç‰ˆã€‚æ¯”å¦‚ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681636283231.png" alt=""></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å‘ item å…ƒç´ ä¸­è¿½åŠ ä¸€ä¸ªå­å…ƒç´ ï¼ŒäºŒè€…åŒºåˆ«å°±èƒ½çª¥æ¢ä¸€äºŒäº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681636439295.png" alt=""></p>
<p>å°½ç®¡å‰é¢ç¤ºä¾‹ï¼Œåœ¨æ•ˆæœä¸Šéƒ½æ˜¯â€œå‘ä¸‹åç§»â€äº† 30 ä¸ªåƒç´ ï¼Œä½†æ˜¯ <code>margin</code> ä¼šå½±å“æ–‡æ¡£æµçš„ä½ç½®ï¼Œé™¤äº†å…¶æœ¬èº«ä½ç½®å‘ç”Ÿåç§»ï¼Œå…¶åçš„å¤„äºæ ‡å‡†æ–‡æ¡£æµçš„å…ƒç´ éƒ½è·Ÿç€å‘ç”Ÿå˜åŒ–ã€‚è€Œ <code>position: relative</code> åˆ™ä¸åŒï¼Œå®ƒè‡ªå¯¹è‡ªèº«æœ‰å½±å“ï¼Œå®ƒæœ¬èº«åœ¨æ–‡æ¡£æµä¸­çš„ä½ç½®å¹¶æ— å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å…¶åå…ƒç´ ä»å¤„åœ¨åŸæœ‰ä½ç½®ï¼Œå› æ­¤æˆªå›¾ä¸­çœ‹åˆ°ä¸¤ä¸ªå…ƒç´ åœ¨è¡¨ç°ä¸Šé‡å åœ¨ä¸€èµ·äº†ã€‚</p>
<p><a href="https://codesandbox.io/s/margin-relatvie-demo-l8r8ec?file=/index.html">CodeSandbox Demo</a></p>
<h2>å¤–è¾¹è·æŠ˜å </h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå‡è®¾æœ‰å¦‚ä¸‹ä¸¤ä¸ªç›¸é‚»çš„æ™®é€šï¼ˆå—çº§ï¼‰å…ƒç´ ï¼Œä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„å¤–è¾¹è·ä¼šå‘ç”Ÿé‡å ï¼Œå–æœ€å¤§å€¼ 50px ä½œä¸ºä¸¤è€…ä¹‹é—´çš„è·ç¦»ï¼Œè¿™ç§ç°è±¡ç§°ä¸ºã€Œå¤–è¾¹è·æŠ˜å ï¼ˆmargin collapsingï¼‰ã€ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;margin-bottom: 30px&quot;&gt;Hey,&lt;/div&gt;
&lt;div style=&quot;margin-top: 50px&quot;&gt;Frankie&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681570358976.png" alt=""></p>
<h3>ä¸ºä»€ä¹ˆè¦æŠ˜å ï¼Ÿ</h3>
<p><a href="https://www.w3.org/TR/CSS1/#vertical-formatting">CSS1 Vertical formatting</a>ï¼š</p>
<blockquote>
<p>The width of the margin on non-floating block-level elements specifies the minimum distance to the edges of surrounding boxes. Two or more adjoining vertical margins (i.e., with no border, padding or content between them) are collapsed to use the maximum of the margin values. In most cases, after collapsing the vertical margins the result is visually more pleasing and closer to what the designer expects.</p>
</blockquote>
<p><a href="https://www.w3.org/TR/CSS2/box.html#collapsing-margins">CSS2 Collapsing margins</a>ï¼š</p>
<blockquote>
<p>In CSS, the adjoining margins of two or more boxes (which might or might not be siblings) can combine to form a single margin. Margins that combine this way are said to collapse, and the resulting combined margin is called a collapsed margin.</p>
</blockquote>
<p>ä»è§„èŒƒæè¿°å¯çŸ¥ï¼Œè¿™ç§æŠ˜å è¡Œä¸ºæ˜¯æ•…æ„ä¸ºä¹‹ï¼Œç›®çš„æ˜¯ä½¿å¾—å†…å®¹æ’ç‰ˆåœ¨è§†è§‰ä¸Šæ›´ç¾è§‚ã€‚å¦å¤–ï¼Œæœ‰å…´è¶£å¯ä»¥ç¿»ç¿»è¿™<a href="https://stackoverflow.com/questions/46563579/why-the-css-specification-need-to-have-margin-collapse-on-vertical-direction-bu">æ–‡ç« </a>çš„å›ç­”ï¼Œå†å²åŸå› ä¼¼ä¹è·Ÿ <code>&lt;p&gt;</code> å…ƒç´ æ’ç‰ˆæœ‰å…³ï¼Œç„¶åä¸€ç›´å»¶ç»­ä¸‹æ¥ã€‚</p>
<h3>ä»€ä¹ˆæ—¶å€™å‘ç”ŸæŠ˜å ï¼Ÿ</h3>
<p>æŠ˜å åªå‘ç”Ÿ<strong>å—çº§å…ƒç´ </strong>çš„å‚ç›´æ–¹å‘ä¸Šï¼Œæ°´å¹³æ–¹å‘æ˜¯æ°¸è¿œä¸ä¼šçš„ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;margin-bottom: 30px; display: inline-block&quot;&gt;Hey,&lt;/div&gt;
&lt;div style=&quot;margin-top: 50px&quot;&gt;Frankie&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681571039267.png" alt=""></p>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œç”±äºç¬¬ä¸€ä¸ªå…ƒç´ è®¾ä¸º <code>inline-block</code>ï¼Œå› æ­¤ä¸¤ä¸ªå…ƒç´ ä¹‹é—´æœªäº§ç”ŸæŠ˜å ç°è±¡ï¼Œä¸¤è€…åœ¨å‚ç›´æ–¹å‘çš„é—´è·ä¸º 80pxã€‚ä¸‹æ–‡è‹¥æ— ç‰¹åˆ«è¯´æ˜ï¼Œåœ¨ä»‹ç»æŠ˜å çš„æ—¶å€™é»˜è®¤å…ƒç´ ä¸ºå—çº§å…ƒç´ ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ ‡å‡†æ–‡æ¡£æµä¸­å…ƒç´ ä¼šä»å·¦åˆ°å³ã€ä»ä¸Šå¾€ä¸‹çš„æµå¼æ’åˆ—ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ è„±ç¦»äº†æ–‡æ¡£æµï¼Œè¯¥å…ƒç´ ä¼šä»é»˜è®¤æ’åˆ—ä¸­ç§»å»ï¼Œä¸å†å æ®ç©ºé—´ï¼Œå…¶åçš„å…ƒç´ ä¼šå¾€ä¸Šæˆ–å¾€å·¦ç§»åŠ¨ã€‚è„±ç¦»æ–‡æ¡£æµçš„æ–¹å¼æœ‰ floatã€absolute position å’Œ fixed positionã€‚</p>
<p>å½“ä¸¤ä¸ªå…ƒç´ æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ä¼šå‘ç”Ÿå¤–è¾¹è·æŠ˜å ï¼š</p>
<blockquote>
<ol>
<li>å¤„äºåŒä¸€å—çº§æ ¼å¼ä¸Šä¸‹æ–‡ï¼ˆBFCï¼‰ä¸­çš„ä¸¤ä¸ªå—çº§å…ƒç´ ï¼Œè€Œä¸”å…ƒç´ å‡å±äºæ ‡å‡†æ–‡æ¡£æµã€‚</li>
<li>ä¸¤ä¸ªå…ƒç´ ä¹‹é—´æ²¡æœ‰è¢«éç©ºå…ƒç´ ï¼ˆåŒ…æ‹¬æœ‰å†…å®¹ï¼Œä½†é«˜åº¦ä¸º 0 çš„æƒ…å†µï¼‰ã€æ¸…é™¤æµ®åŠ¨ã€è¾¹æ¡†ã€å†…è¾¹è·éš”å¼€ã€‚</li>
<li>ä¸¤ä¸ªå…ƒç´ åœ¨å‚ç›´æ–¹å‘ä¸Šæ˜¯ã€Œç›¸é‚»ã€çš„</li>
</ol>
</blockquote>
<p>æ»¡è¶³ä»¥ä¸‹æƒ…å†µåˆ™è§†ä¸ºç›¸é‚»ï¼ˆæ¯—é‚»ï¼‰ï¼š</p>
<blockquote>
<ul>
<li>å…ƒç´ çš„ <code>margin-top</code> å’Œå®ƒçš„ç¬¬ä¸€ä¸ªæ ‡å‡†æ–‡æ¡£æµå­å…ƒç´ çš„ <code>margin-top</code>ã€‚</li>
<li>å…ƒç´ çš„ <code>margin-bottom</code> å’Œå®ƒçš„ä¸‹ä¸€ä¸ªæ ‡å‡†æ–‡æ¡£æµå…ƒç´ çš„ <code>margin-top</code>ã€‚</li>
<li>å¦‚æœçˆ¶çº§è‡ªåŠ¨è®¡ç®—é«˜åº¦ï¼Œå…ƒç´ æ˜¯æœ€åä¸€ä¸ªä¸”ä¸ºæ ‡å‡†æ–‡æ¡£æµï¼Œå…ƒç´ çš„ <code>margin-bottom</code> å’Œçˆ¶çº§å…ƒç´ çš„ <code>margin-bottom</code>ã€‚</li>
<li>å…ƒç´ ï¼ˆæœ¬èº«ï¼‰çš„ <code>margin-top</code> å’Œ <code>margin-bottom</code>ï¼Œä¸”æœªåˆ›å»ºæ–°çš„å—çº§æ ¼å¼ä¸Šä¸‹æ–‡çš„æ ‡å‡†æ–‡æ¡£æµå…ƒç´ ï¼Œå…¶é«˜åº¦è¡¨ç°ä¸ºé›¶ã€‚åŒ…æ‹¬ <code>height: 0</code>ã€<code>min-height: 0</code>ã€<code>height: auto</code> ä¸”æ ‡å‡†æ–‡æ¡£æµçš„æ— å­å…ƒç´ ä¸‰ç§æƒ…å†µã€‚</li>
</ul>
</blockquote>
<p>æ³¨æ„ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>å…ƒç´ ç›¸é‚»ä¸ä¸€å®šæ˜¯å…„å¼Ÿæˆ–ç¥–å…ˆå…ƒç´ ã€‚</li>
<li>æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–ä»»æ„å…ƒç´ ä¸ä¼šå‘ç”ŸæŠ˜å ã€‚</li>
<li>å½“ä¸€ä¸ªå…ƒç´ åˆ›å»ºäº†æ–°çš„å—çº§æ ¼å¼ä¸Šä¸‹æ–‡åï¼Œå®ƒä¸ä¼šä¸å…¶å­å…ƒç´ å‘ç”ŸæŠ˜å ã€‚</li>
<li>ç»å¯¹å®šä½çš„å…ƒç´ ä¸ä¼šå‘ç”ŸæŠ˜å ï¼Œæ— è®ºæ˜¯å…¶å…„å¼Ÿå…ƒç´ ï¼Œè¿˜æ˜¯å…¶å­å…ƒç´ ã€‚</li>
<li>è¡Œå†…å…ƒç´ ä¸ä¼šå‘ç”ŸæŠ˜å ã€‚</li>
<li>å½“å‘ç”ŸæŠ˜å æ—¶ï¼Œäº§ç”Ÿçš„è¾¹è·å–å€¼åˆ†ä¸ºå‡ ç§æƒ…å†µï¼š
<ul>
<li>å¤–è¾¹è·å‡ä¸ºæ­£æ•°æ—¶ï¼Œå–æœ€å¤§å€¼ã€‚</li>
<li>å¤–è¾¹è·å‡ä¸ºè´Ÿæ•°æ—¶ï¼Œå–ç»å¯¹å€¼æœ€å¤§çš„å€¼ã€‚</li>
<li>å¤–è¾¹è·ä¸ºä¸€æ­£ä¸€è´Ÿæ—¶ï¼Œå–ä¸¤è€…ç›¸åŠ çš„å’Œã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<h3>æŠ˜å ç¤ºä¾‹</h3>
<p>æ¥ä¸‹æ¥ï¼Œå°†åˆ—ä¸¾éƒ¨åˆ†ç¤ºä¾‹è¯´æ˜ã€‚</p>
<p>ç¤ºä¾‹ä¸€</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;height: 40px; background: green; margin-top: 20px&quot;&gt;
  &lt;div style=&quot;height: 20px; background: blue; margin-top: 50px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681578490973.png" alt=""></p>
<p>ç»¿è‰²å—ï¼ˆçˆ¶ï¼‰ä¸è“è‰²å—ï¼ˆå­ï¼‰ <code>margin-top</code> å‘ç”Ÿäº†æŠ˜å ï¼Œä¸”å–æœ€å¤§å€¼ï¼Œå› æ­¤ä¸çº¢è‰²å—çš„è¾¹è·æ˜¯ 50pxã€‚</p>
<p>ç¤ºä¾‹äºŒ</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;background: green; margin-bottom: 20px&quot;&gt;
  &lt;div style=&quot;height: 20px; background: blue; margin-bottom: 50px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div style=&quot;height: 20px; background: yellow&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681579283350.png" alt=""></p>
<p>ç»¿è‰²å—å…ƒç´ ä¸ºè‡ªåŠ¨é«˜åº¦ï¼Œæ­¤æ—¶ç»¿è‰²å—ï¼ˆçˆ¶ï¼‰ä¸è“è‰²å—ï¼ˆå­ï¼‰ <code>margin-bottom</code> å‘ç”Ÿäº†æŠ˜å ï¼Œä¸”å–æœ€å¤§å€¼ï¼Œå› æ­¤ä¸é»„è‰²å—çš„è¾¹è·æ˜¯ 50pxã€‚</p>
<p>ç¤ºä¾‹ä¸‰</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;background: green; margin-top: 20px; margin-bottom: 20px&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;height: 20px; background: blue&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681580028452.png" alt=""></p>
<p>ä¸­é—´ç»¿è‰²è‡ªåŠ¨é«˜åº¦ï¼Œä¸”æ— å­å…ƒç´ ï¼Œç›¸å½“äº <code>height</code> ä¸º <code>0</code>ã€‚æ­¤æ—¶ç»¿è‰²å—æœ¬èº«å‘ç”ŸæŠ˜å ï¼Œå› æ­¤çº¢è‰²å—ä¸è“è‰²å—ä¹‹é—´çš„è¾¹è·ä¸º 20pxã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬ç»™é›¶é«˜çš„å…ƒç´ åŠ äº›å†…å®¹ï¼Œå®ƒå°±ä¸ä¼šæŠ˜å äº†ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;background: green; margin-top: 20px; margin-bottom: 20px; height: 0&quot;&gt;some text...&lt;/div&gt;
&lt;div style=&quot;height: 20px; background: blue&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681632853432.png" alt=""></p>
<p>ç¤ºä¾‹å››</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;background: green; margin-bottom: 20px&quot;&gt;
  &lt;div style=&quot;height: 20px; position: absolute&quot;&gt;&lt;/div&gt;
  &lt;div style=&quot;height: 20px; background: blue; margin-top: 50px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681629062739.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°çº¢è‰²å—ä¸è“è‰²å—çš„è¾¹è·ä¸º 50pxï¼Œä½†è“è‰²å—å¹¶éæ˜¯çº¢è‰²å—çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ï¼Œä½†å®ƒæ˜¯çº¢è‰²å—çš„ç¬¬ä¸€ä¸ªæ ‡å‡†æ–‡æ¡£æµçš„å­å…ƒç´ ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¹Ÿæ˜¯æ»¡è¶³ç›¸é‚»æ¡ä»¶çš„ã€‚</p>
<p>ç¤ºä¾‹äº”</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red; margin-bottom: 20px&quot;&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div style=&quot;height: 20px; background: green; margin-top: 50px&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681631339178.png" alt="image.png"></p>
<p>ä¸­é—´éš”äº†ä¸ªé›¶é«˜å…ƒç´ ï¼Œä¸”æ— å­å…ƒç´ ï¼Œä¹Ÿä¼šå‘ç”ŸæŠ˜å ï¼Œè¾¹è·ä¸º 50pxã€‚</p>
<p>æˆ‘ä»¬å°†ä¸­é—´çš„å…ƒç´ åŠ ä¸€äº›å†…å®¹ï¼Œå¹¶æ˜¾å¼æŒ‡å®š <code>height</code> ä¸º <code>0</code>ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;height: 20px; background: red; margin-bottom: 20px&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;height: 0&quot;&gt;some text...&lt;/div&gt;
&lt;div style=&quot;height: 20px; background: green; margin-top: 50px&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681631886289.png" alt=""></p>
<p>å°½ç®¡ä¸­é—´å…ƒç´ ä»ä¸ºé›¶é«˜ï¼Œå¯ç”±äºå…¶å­å…ƒç´ æœ‰å†…å®¹ï¼Œå› æ­¤çº¢è‰²å—ä¸ç»¿è‰²å—å¹¶æœªå‘ç”ŸæŠ˜å ï¼Œè¾¹è·ä¸º 70pxã€‚</p>
<h3>å¦‚ä½•æ¸…é™¤å¤–è¾¹è·æŠ˜å ï¼Ÿ</h3>
<p>æ ¹æ®å‰é¢å‘ç”ŸæŠ˜å çš„æ¡ä»¶å¯çŸ¥ï¼Œåªè¦ç ´åä»»ä¸€æ¡ä»¶ï¼Œä½¿å…¶ä¸æ»¡è¶³å°±èƒ½æ¸…é™¤æŠ˜å ç°è±¡ï¼Œé€šå¸¸é‡‡ç”¨åˆ›å»ºæ–°çš„å—çº§æ ¼å¼ä¸Šä¸‹æ–‡çš„æ–¹å¼ã€‚</p>
<p>åˆ›å»ºæ–° BFC çš„å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>float</code> ä¸ä¸º <code>none</code>ã€‚</li>
<li><code>overflow</code> çš„å€¼ä¸ä¸º <code>visible</code>ã€‚</li>
<li><code>display</code> çš„å€¼ä¸º <code>table-cell</code>ã€<code>table-caption</code>ã€<code>inline-block</code> ä¸­ä»»æ„ä¸€ä¸ªã€‚</li>
<li><code>position</code> ä¸ä¸º <code>relative</code> æˆ– <code>static</code>ã€‚</li>
</ul>
<p>ç”±äº BFC å†…çš„å­å…ƒç´ æ— è®ºå¦‚ä½•æ’åˆ—ï¼Œéƒ½ä¸ä¼šå½±å“å¤–éƒ¨çš„å…ƒç´ ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨äºé¿å…å¤–è¾¹æ¡†æŠ˜å ã€‚</p>
<h2>è´Ÿå€¼ Margin</h2>
<p>å¹³å¸¸ä½¿ç”¨ Margin éƒ½æ˜¯æ­£å€¼å±…å¤šï¼Œé‚£ä¹ˆè´Ÿå€¼ Margin ä¼šå‘ç”Ÿä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…å‘¢ï¼Ÿ</p>
<p>ç®€å•æ€»ç»“ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è®¾ç½®è´Ÿå€¼çš„è¡Œä¸º</th>
</tr>
</thead>
<tbody>
<tr>
<td>margin-top</td>
<td>å…ƒç´ æœ¬èº«å‘ä¸Šåç§»</td>
</tr>
<tr>
<td>margin-left</td>
<td>å…ƒç´ æœ¬èº«å‘å·¦åç§»</td>
</tr>
<tr>
<td>margin-right</td>
<td>å…ƒç´ æœ¬èº«ä¸åç§»ï¼Œå…¶å³è¾¹å…ƒç´ å‘å·¦åç§»</td>
</tr>
<tr>
<td>margin-bottom</td>
<td>å…ƒç´ æœ¬èº«ä¸åç§»ï¼Œå…¶ä¸‹æ–¹å…ƒç´ å‘ä¸Šåç§»</td>
</tr>
</tbody>
</table>
<p>ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„è¡¨ç°ï¼š</p>
<blockquote>
<ul>
<li>è‹¥å—çº§å…ƒç´ çˆ¶çº§ä¸ºè‡ªåŠ¨é«˜åº¦ï¼Œå­å…ƒç´ ä¸­è®¾ç½®è´Ÿå€¼ margin-topï¼Œä¼šã€Œæ”¹å˜ã€å…ƒç´ çˆ¶çº§åœ¨æ ‡å‡†æ–‡æ¡£æµä¸­å ç”¨çš„é«˜åº¦ã€‚</li>
<li>è‹¥å—çº§å…ƒç´ ä¸ºè‡ªåŠ¨å®½åº¦ï¼Œå…ƒç´ è®¾ç½®è´Ÿå€¼ margin-left æˆ– margin-rightï¼Œä¼šä½¿å¾—å…ƒç´ å‘å·¦ä¾§æˆ–å³ä¾§å¢åŠ å®½åº¦ã€‚</li>
</ul>
</blockquote>
<h3>è´Ÿå€¼çš„å¤–è¾¹è·æŠ˜å </h3>
<p>å½“å‘ç”ŸæŠ˜å æ—¶ï¼Œå¦‚æœéƒ½æ˜¯æ­£å€¼çš„è¯ï¼Œå–æœ€å¤§å€¼ä½œä¸ºè¾¹è·ã€‚ä½†å¦‚æœå¤–è¾¹è·ä¸ºä¸€æ­£ä¸€è´Ÿæˆ–è€…å‡ä¸ºè´Ÿå€¼å‘¢ï¼Ÿ</p>
<ul>
<li>å¤–è¾¹è·ä¸ºä¸€æ­£ä¸€è´Ÿæ—¶ï¼Œå–ä¸¤è€…ç›¸åŠ çš„å’Œã€‚</li>
<li>å¤–è¾¹è·å‡ä¸ºè´Ÿæ•°æ—¶ï¼Œå–ç»å¯¹å€¼æœ€å¤§çš„å€¼ã€‚</li>
</ul>
<h4>ä¸€æ­£ä¸€è´Ÿ</h4>
<pre><code class="language-html">&lt;div id=&quot;parent&quot;&gt;
  &lt;div id=&quot;child1&quot; style=&quot;height: 20px; background: red; margin-bottom: 20px&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child2&quot; style=&quot;height: 20px; background: green; margin-top: -30px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<!-- ![](https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681646725234.png) -->
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681654426286.png" alt=""></p>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œchild1 å’Œ child2 å‘ç”ŸæŠ˜å ï¼Œå…ƒç´ é—´çš„è¾¹è·ä¸ºä¸¤æ•°ä¹‹å’Œ -10pxï¼Œå› æ­¤ child2 å‘ä¸Šåç§» 10pxï¼Œè¦†ç›–äº† child1 çš„ä¸‹åŠéƒ¨åˆ†ã€‚<strong>è¯·æ³¨æ„ï¼Œæ–‡æ¡£æµåªä¼šå‘ä¸Šæˆ–å‘å·¦æµåŠ¨ï¼Œä¸èƒ½å‘ä¸‹æˆ–å‘å³æµåŠ¨çš„</strong>ã€‚</p>
<h4>å‡ä¸ºè´Ÿæ•°</h4>
<pre><code class="language-html">&lt;div id=&quot;parent&quot;&gt;
  &lt;div id=&quot;child1&quot; style=&quot;height: 20px; background: red; margin-bottom: -20px&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child2&quot; style=&quot;height: 20px; background: green; margin-top: -30px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<!-- ![](https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681647201385.png) -->
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681654518219.png" alt=""></p>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œchild1 å’Œ child2 å‘ç”ŸæŠ˜å ï¼Œå…ƒç´ é—´çš„è¾¹è·å–ç»å¯¹å€¼æœ€å¤§è€…ï¼Œå³ä¸º -30pxã€‚æ‰€ä»¥ child2 å‘ä¸Šåç§» 30pxï¼Œchild2 è¦†ç›–äº† child1 çš„ä¸ŠåŠéƒ¨åˆ†ã€‚</p>
<h3>è´Ÿå€¼ margin-topã€margin-bottom</h3>
<p>æ— è®ºæ­£å€¼ï¼Œè¿˜æ˜¯è´Ÿå€¼ï¼Œå‚ç›´æ–¹å‘çš„å¤–è¾¹è·åªå¯¹å—çº§å…ƒç´ äº§ç”Ÿä½œç”¨ã€‚åŒæ ·åœ°ï¼Œæ— è®ºæ­£è´Ÿå€¼éƒ½ä¼šå½±å“å…ƒç´ åœ¨æ ‡å‡†æ–‡æ¡£æµçš„ä½ç½®æˆ–ç©ºé—´ï¼Œåªä¸è¿‡æ­£å€¼æ˜¯ç›´è§‰æ€§çš„ï¼Œç†è§£èµ·æ¥å¾ˆè‡ªç„¶ã€‚è€Œè´Ÿå€¼ä¼¼ä¹æœ‰ç‚¹åç›´è§‰ç½¢äº†ã€‚</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è®¾ç½®è´Ÿå€¼çš„è¡Œä¸º</th>
</tr>
</thead>
<tbody>
<tr>
<td>margin-top</td>
<td>å…ƒç´ æœ¬èº«å‘ä¸Šåç§»</td>
</tr>
<tr>
<td>margin-bottom</td>
<td>å…ƒç´ æœ¬èº«ä¸åç§»ï¼Œå…¶ä¸‹æ–¹å…ƒç´ å‘ä¸Šåç§»</td>
</tr>
</tbody>
</table>
<p>å¦å¤–ï¼Œå¦‚æœå…ƒç´ çˆ¶çº§æ˜¯è‡ªåŠ¨è®¡ç®—çš„é«˜åº¦ï¼Œåœ¨å­å…ƒç´ ä¸­è®¾ç½®è´Ÿå€¼çš„ margin-top æˆ– margin-bottom çš„è¯ï¼Œæœ€ç»ˆä¼šå½±å“çˆ¶çº§åœ¨æ ‡å‡†æ–‡æ¡£æµä¸­çš„é«˜åº¦ã€‚</p>
<h4>è´Ÿå€¼ margin-top</h4>
<pre><code class="language-html">&lt;div id=&quot;parent&quot;&gt;
  &lt;div id=&quot;child1&quot; style=&quot;height: 60px; background: red&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child2&quot; style=&quot;height: 20px; background: green; margin-top: -60px&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child3&quot; style=&quot;height: 20px; background: blue&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681655729484.png" alt=""></p>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œchild2 è®¾ç½®äº† <code>margin-top: -60px</code>ï¼Œå…ƒç´ è‡ªèº«ï¼ˆç»¿è‰²å—ï¼‰å‘ä¸Šåç§»äº† 60pxï¼Œæ‰€ä»¥è·Ÿ child1 çš„ä¸Šæ–¹é‡åˆã€‚å½“ child2 åœ¨æ ‡å‡†æ–‡æ¡£æµä¸­çš„ä½ç½®å‘ä¸Šåç§»åï¼Œå…¶åçš„ child3 å…ƒç´ ä¹Ÿè·Ÿç€å‘ä¸ŠæµåŠ¨ï¼Œç´§è·Ÿåœ¨ child2 ä¹‹åã€‚</p>
<p>å¦‚æœ child2 æœªè®¾ç½® <code>margin-top: -60px</code> çš„è¯ï¼Œparent å…ƒç´ çš„é«˜åº¦åº”ä¸º <code>height(child1 + child2 + child3) = 100px</code>ã€‚å¯è®¾ç½®è´Ÿå€¼ margin-top åï¼Œä½¿å¾—ä» child2 å…ƒç´ èµ·æ ‡å‡†æ–‡æ¡£æµçš„ä½ç½®å‘ä¸Šç§»åŠ¨äº† 60pxï¼Œæ‰€ä»¥ parent å…ƒç´ çš„é«˜åº¦ä¸º <code>height(child1 + child2 + child3) + å‚ç›´æ–¹å‘çš„åç§»å€¼</code>ï¼Œå³ <code>60 + 20 + 20 - 60 = 40px</code>ã€‚</p>
<h4>è´Ÿå€¼ margin-bottom</h4>
<pre><code class="language-html">&lt;div id=&quot;parent&quot;&gt;
  &lt;div id=&quot;child1&quot; style=&quot;height: 40px; background: red&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child2&quot; style=&quot;height: 20px; background: green; margin-bottom: -60px&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;child3&quot; style=&quot;height: 20px; background: blue&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681656532840.png" alt=""></p>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œchild2 è®¾ç½®äº† margin-bottom: -60pxï¼Œå…ƒç´ æœ¬èº«ï¼ˆç»¿è‰²å—ï¼‰æœªå‘ç”Ÿåç§»ï¼Œä»åœ¨ç´§è·Ÿåœ¨ child1 ä¹‹åã€‚ä½† child2 çš„è´Ÿå€¼ margin-bottom ä¼šä½¿å¾—å…¶ä¸‹æ–¹çš„ child3 å…ƒç´ å‘ä¸Šåç§» 60pxï¼Œæ‰€ä»¥è·Ÿ child1 çš„ä¸Šæ–¹é‡åˆã€‚çœ‹èµ·æ¥åƒæ¢äº†ä½ç½®ä¸€æ ·ã€‚</p>
<p>å¦‚æœ child2 æœªè®¾ç½® <code>margin-top: -60px</code> çš„è¯ï¼Œparent å…ƒç´ çš„é«˜åº¦åº”ä¸º <code>height(child1 + child2 + child3) = 80px</code>ã€‚è™½ç„¶è´Ÿå€¼çš„ margin-bottom ä¸ä¼šä½¿è‡ªèº«åœ¨æ ‡å‡†æ–‡æ¡£æµçš„ä½ç½®å‘ä¸Šç§»åŠ¨ï¼Œä½†å®ƒä¼šä½¿å…¶ä¸‹æ–¹çš„å…ƒç´ åœ¨æ ‡å‡†æ–‡æ¡£æµçš„ä½ç½®ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸”å‘ä¸Šç§»åŠ¨ï¼Œæœ‰ç‚¹åƒç»™ä¸‹æ–¹å…ƒç´ è®¾ç½®äº†è´Ÿå€¼ margin-top çš„æ„æ€ï¼Œæ‰€ä»¥ parent å…ƒç´ çš„é«˜åº¦ä¸º <code>height(child1 + child2 + child3) + å‚ç›´æ–¹å‘çš„åç§»å€¼</code>ï¼Œå³ <code>40 + 20 + 20 - 60 = 20px</code>ã€‚</p>
<h4>å°ç»“</h4>
<p>è´Ÿå€¼çš„ margin-top å’Œ margin-bottom éƒ½ä¼šä½¿å¾—å…ƒç´ åœ¨æ ‡å‡†æ–‡æ¡£æµä¸­çš„ä½ç½®ï¼ŒåŒºåˆ«åœ¨äºå½±å“æœ¬èº«è¿˜æ˜¯å…¶åçš„å…ƒç´ ï¼Œè¿›è€Œå¯èƒ½ä¼šå½±å“åˆ°çˆ¶çº§å…ƒç´ åœ¨æ–‡æ¡£æµä¸­å ç”¨çš„ç©ºé—´ï¼ˆæŒ‡é«˜åº¦ï¼‰ã€‚å½“ç„¶ï¼Œå¦‚æœçˆ¶çº§å…ƒç´ æŒ‡å®šäº†å…·ä½“é«˜åº¦ï¼Œå°†ä¸ä¼šå…¶é«˜åº¦å°†ä¸ä¼šå—åˆ°å½±å“ã€‚</p>
<p>å°½ç®¡å‰é¢è®¾ç½®äº†è´Ÿå€¼è¾¹è·ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥çœ‹åˆ°ä»–ä»¬è¢«å®Œæ•´åœ°ç»˜åˆ¶å‡ºæ¥äº†ï¼ŒåŸå› æ˜¯å…ƒç´ çš„ overflow å±æ€§é»˜è®¤æº¢å‡ºå¯è§ï¼Œå¦‚æœå‰é¢çš„ç¤ºä¾‹ä¸­ parent å…ƒç´ æŒ‡å®š overflow: hidden çš„è¯ï¼Œä½ å°†ä¼šçœ‹åˆ°åªæœ‰ 40px å’Œ 20px çš„å¤§å°ã€‚è¿˜æœ‰ï¼Œå­å…ƒç´ å ç”¨çš„ç©ºé—´å¤§å°æ˜¯ä¸ä¼šå› ä¸ºè®¾ç½®äº† margin-top/margin-bottom å€¼å‘ç”Ÿå˜åŒ–çš„ã€‚</p>
<p>å¯ä»¥ç®€å•åœ°è¿™æ ·ç†è§£ï¼Œåœ¨æ–‡æ¡£æµçš„çœ¼é‡Œï¼Œå…ƒç´ çš„åœ¨æ–‡æ¡£æµä¸­çš„å¼€å§‹ä½ç½®æ˜¯ç”± margin å†³å®šçš„ï¼Œä¸ºæ­£æ•°åˆ™å¢åŠ ï¼Œä¸ºè´Ÿæ•°åˆ™å‡å°ï¼Œè€Œä¸æ˜¯çœ‹å…ƒç´ å®é™…å¤§å°çš„ã€‚</p>
<h3>è´Ÿå€¼ margin-left å’Œ margin-right</h3>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºè‡ªåŠ¨å®½åº¦çš„å—çº§å…ƒç´ ï¼Œè®¾ç½®æ­£å€¼çš„ margin-left æˆ– margin-right ä¼šæ”¹å˜å‡å°å…ƒç´ å®½åº¦ã€‚ç›¸ååœ°ï¼Œè´Ÿå€¼ä¼šå¢åŠ å®½åº¦ã€‚</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è®¾ç½®è´Ÿå€¼çš„è¡Œä¸º</th>
</tr>
</thead>
<tbody>
<tr>
<td>margin-left</td>
<td>å…ƒç´ æœ¬èº«å‘å·¦åç§»</td>
</tr>
<tr>
<td>margin-right</td>
<td>å…ƒç´ æœ¬èº«ä¸åç§»ï¼Œå…¶å³è¾¹å…ƒç´ å‘å·¦åç§»</td>
</tr>
</tbody>
</table>
<h4>å¢åŠ å®½åº¦</h4>
<p>æˆ‘ä»¬ç»™ä¸€ä¸ªè‡ªåŠ¨è®¡ç®—å®½åº¦çš„å—çº§å…ƒç´ è®¾ç½®å·¦å³å¤–è¾¹è·è®¾ä¸º -20pxï¼Œå®ƒçš„å®½åº¦å¢é•¿äº† 40pxã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;border: 1px solid red; margin-left: -20px; margin-right: -20px&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/div&gt;
&lt;div style=&quot;height: 20px; background-color: green; margin-top: 20px&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681650216348.png" alt=""></p>
<h4>è´Ÿå€¼ margin-left</h4>
<p>æˆ‘ä»¬åœ¨è¿™æ®µæ–‡å­—ä¸­æ’å…¥äº†ä¸€ä¸ª inline å…ƒç´ å’Œä¸€ä¸ª inline-block å…ƒç´ ï¼Œæœªè®¾ç½® margin çš„è¡¨ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div style=&quot;border: 1px solid red&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚ &lt;span style=&quot;background-color: darkorange; margin-left: 0px&quot;&gt;æˆ‘æ˜¯ inline å…ƒç´ ã€‚&lt;/span&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;span style=&quot;display: inline-block; background-color: plum; margin-left: 0px&quot;&gt;æˆ‘æ˜¯ inline-block å…ƒç´ ã€‚&lt;/span&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681649284407.png" alt=""></p>
<p>æ¥ç€ï¼Œç»™ inline å’Œ inline-block å…ƒç´ åŠ ä¸Š <code>margin-left: -50px</code>ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;border: 1px solid red&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚&lt;span style=&quot;background-color: darkorange; margin-left: -50px&quot;&gt;æˆ‘æ˜¯ inline å…ƒç´ ã€‚&lt;/span&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;span style=&quot;display: inline-block; background-color: plum; margin-left: -50px&quot;&gt;æˆ‘æ˜¯ inline-block å…ƒç´ ã€‚&lt;/span&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681649534837.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°é™¤äº† inline å’Œ inline-block å…ƒç´ å‘å·¦åç§»ä¹‹å¤–ï¼Œå…¶åçš„å†…å®¹ä¹Ÿæ˜¯è·Ÿç€ç§»åŠ¨çš„ã€‚è¯´æ˜å®ƒä»¬çš„åœ¨æ ‡å‡†æ–‡æ¡£æµçš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<h4>è´Ÿå€¼ margin-right</h4>
<p>è¿˜æ˜¯åœ¨å‰é¢çš„ç¤ºä¾‹åŸºç¡€ä¸Šï¼Œç»™ inline å’Œ inline-block å…ƒç´ åŠ ä¸Š <code>margin-right: -50px</code>ã€‚</p>
<pre><code class="language-html">&lt;div style=&quot;border: 1px solid red&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚&lt;span style=&quot;background-color: darkorange; margin-right: -50px&quot;&gt;æˆ‘æ˜¯ inline å…ƒç´ ã€‚&lt;/span&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;span style=&quot;display: inline-block; background-color: plum; margin-right: -50px&quot;&gt;æˆ‘æ˜¯ inline-block å…ƒç´ ã€‚&lt;/span&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681651109445.png" alt=""></p>
<p>è¯·ä»”ç»†è§‚å¯Ÿï¼Œinline å…ƒç´ ï¼ˆæœ¬èº«ï¼‰å¹¶æœªå‘ç”Ÿç§»åŠ¨ï¼Œä½†å…¶å³è¾¹çš„å…ƒç´ åˆ™å‘å·¦åç§»ï¼Œå¯¼è‡´è¦†ç›–åœ¨å…ƒç´ ä¸Šäº†ï¼Œinline-block åŒç†ã€‚å¯¹æ¯”å‰é¢è´Ÿå€¼ margin-left æ›´æ˜æ˜¾ã€‚</p>
<h4>å°ç»“</h4>
<p>å¯¹äº margin-left å’Œ margin-right æ— è®ºæ­£è´Ÿå€¼éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚</p>
<h2>è´Ÿå€¼ Margin çš„åº”ç”¨</h2>
<h3>è‡ªé€‚åº”ä¸‰æ å¸ƒå±€</h3>
<p>ç›¸ä¿¡å¤§å®¶éƒ½å¬è¯´è¿‡ã€Œåœ£æ¯å¸ƒå±€ã€ã€ã€ŒåŒé£ç¿¼å¸ƒå±€ã€è¿™äº›ç»å…¸çš„ä¸‰æ å¸ƒå±€ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨äº†æµ®åŠ¨å’Œè´Ÿå€¼ Margin å®ç°çš„ã€‚å½“ç„¶ï¼Œè¿™äº›ç»å…¸å¸ƒå±€æ–¹å¼æœ‰æ›´ç°ä»£åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œåƒ Flexã€Grid ç­‰ï¼Œå†åˆ©ç”¨ Media Queries å¯ä»¥å®ç°é€‚é…ç§»åŠ¨ç«¯ã€PC ç«¯çš„å“åº”å¼å¸ƒå±€ã€‚</p>
<p>åœ£æ¯å¸ƒå±€æ˜¯ç”± Matthew Levine äº 2006 å¹´æå‡ºçš„ï¼Œåæ¥å›½å†…æå‡ºäº†æ”¹è¿›ç‰ˆçš„åŒé£ç¿¼å¸ƒå±€ï¼Œæ®è¯´æ˜¯ç‰ä¼¯å¤§ä½¬æå‡ºçš„ï¼Œæˆ‘æœªæ‰¾åˆ°å‡ºå¤„æˆ–åŸè´´ã€‚ä¸‹é¢å°†ä¼šä»‹ç»ä¸¤è€…çš„åŒºåˆ«ï¼Œä»¥åŠæ”¹è¿›äº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
<h4>åœ£æ¯å¸ƒå±€ï¼ˆHoly Grail Layoutï¼‰</h4>
<p>å‡ºå¤„ï¼š<a href="https://alistapart.com/article/holygrail/">In Search of the Holy Grail</a></p>
<p>åœ£æ¯å¸ƒå±€é•¿è¿™æ · ğŸ‘‡ï¼Œä¸Šä¸‹åˆ†åˆ«ä¸º headerã€footerï¼Œä¸­é—´æ˜¯ä¸‰åˆ—å¸ƒå±€ï¼Œæœ‰ leftã€middleã€rightï¼Œå…¶ä¸­å·¦å³æ˜¯å®šå®½çš„ï¼Œä¸­é—´åˆ™æ ¹æ®çª—å£å¤§å°è‡ªé€‚åº”ï¼Œè€Œä¸” container çš„é«˜åº¦ä¹Ÿæ˜¯æ ¹æ®å†…å®¹è‡ªé€‚åº”è°ƒæ•´çš„ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681896192203.png" alt=""></p>
<p>DOM ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;header&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;container&quot;&gt;
  &lt;div id=&quot;middle&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;left&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;right&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>container è®¾ç½® <code>padding-left</code> å’Œ <code>padding-right</code>ï¼Œä»¥è…¾å‡ºä½ç½®ç•™ç»™ leftã€rightï¼Œé™¤å»å·¦å³å†…è¾¹è·ä½™ä¸‹çš„å®½åº¦å°†ç•™ç»™ middle ä½œä¸ºä¸»è¦å†…å®¹åŒºåŸŸã€‚</li>
<li>container å†…ä¸‰ä¸ªå­å…ƒç´  middleã€leftã€right å‡ä¼šè®¾ä¸ºå·¦æµ®åŠ¨ï¼Œå› æ­¤ container ä¸å æ®æ ‡å‡†æ–‡æ¡£æµçš„ç©ºé—´ï¼Œå› è€Œ footer è¦æ¸…é™¤æµ®åŠ¨ä»¥é¿å…é«˜åº¦åå¡Œã€‚</li>
<li>container å†… DOM é¡ºåºä¸º middleã€leftã€rightï¼Œç›®çš„æ˜¯ä½¿å¾— middle å†…å®¹ä¼˜å…ˆæ¸²æŸ“ã€‚</li>
<li>åŸºäºä»¥ä¸Šé¡ºåºè®¾è®¡ï¼Œéœ€åˆ©ç”¨è´Ÿå€¼ <code>margin-left</code> ä½¿ left å’Œ right ä½ç½®å‘ç”Ÿåç§»ï¼š
<ul>
<li>left è®¾ <code>margin-left</code> ä¸º <code>-100%</code> ä½¿å…¶åç§»è‡³ container å·¦ä¾§ï¼›</li>
<li>right è®¾ <code>margin-left</code> ä¸ºè‡ªèº«å®½åº¦å¤§å°ï¼ŒåŠ ä¸Š left çš„ <code>-100%</code>ï¼Œright å®é™…å‘å·¦çš„åç§»é‡ä¸º <code>100% + è‡ªèº«å®½åº¦</code>ï¼Œå› æ­¤åç§»è‡³ container å³ä¾§ã€‚</li>
<li>å‰ä¸¤é¡¹è®¾ç½®ï¼Œä½¿å¾— left å’Œ right å¤„äº container çš„å·¦ä¾§å’Œå³ä¾§ï¼Œä¸”ç”±äºå®ƒä»¬åœ¨ DOM ä¸Šæ’åï¼Œå› æ­¤ä¼šè¦†ç›–åœ¨ middle ä¸Šã€‚æ­¤æ—¶ï¼Œéœ€å°† left å’Œ right è®¾ä¸ºç›¸å¯¹å¸ƒå±€ï¼Œå¹¶åˆ†åˆ«å‘å·¦ã€å‘å³åç§»å€¼æ˜¯å‰é¢ container è®¾ç½®çš„å·¦å³å†…è¾¹è·å¤§å°ã€‚</li>
</ul>
</li>
<li>ç”±äº container å‡ä¸ºæµ®åŠ¨å…ƒç´ ï¼Œä¸” footer æ¸…é™¤æµ®åŠ¨ï¼Œå› æ­¤ container è¡¨ç°å‡ºæ¥çš„â€œé«˜åº¦â€å°†å–å†³äºä¸‰è€…æœ€å¤§å€¼ã€‚</li>
</ul>
<p>å®ç°ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;container&quot;&gt;
  &lt;div id=&quot;middle&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;left&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;right&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
</code></pre>
<pre><code class="language-css">#header {
  height: 50px;
  background: #eee;
}

#container {
  padding-right: 100px; /* left å®½åº¦å¤§å° */
  padding-left: 100px; /* right å®½åº¦å¤§å° */
}

#middle,
#left,
#right {
  float: left;
}

#middle {
  width: 100%;
  background-color: green;
}

#left {
  position: relative;
  left: -100px; /* ä½¿å…¶ä½ç½®åç§»è‡³ container çš„ padding-left åŒºåŸŸ */
  margin-left: -100%; /* æœ¬èº«åŠå…¶åå…ƒç´ å‡å‘å·¦åç§» 100%ï¼ˆç›¸å¯¹äºçˆ¶å…ƒç´ å®½åº¦ï¼Œå³ container çš„å®½åº¦ï¼‰ */
  width: 100px;
  background-color: red;
}

#right {
  position: relative;
  right: -100px; /* ä½¿å…¶ä½ç½®åç§»è‡³ container çš„ padding-right åŒºåŸŸ */
  margin-left: -100px; /* ä½¿å…¶å†å‘å·¦åç§» 100pxï¼Œè¯¥æŒ‡éœ€ä¸ container çš„ padding-right å’Œæœ¬èº«å¤§å°ä¸€è‡´ */
  width: 100px;
  background-color: blue;
}

#footer {
  clear: both; /* æ¸…é™¤æµ®åŠ¨ */
  height: 50px;
  background: #eee;
}

.column {
  height: 300px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681917383978.png" alt=""></p>
<p>åœ£æ¯å¸ƒå±€æœ‰ä¸€ç¼ºç‚¹æ˜¯å½“æµè§ˆå™¨çª—å£è¿‡å°ï¼Œå¸ƒå±€å°±å®Œå…¨å˜å½¢äº†ï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681917762347.png" alt=""></p>
<p>é‚£ä¹ˆå½“çª—å£ç¼©å°åˆ°å¤šå°‘ä¼šå‘ç”Ÿå˜å½¢å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŸå› ï¼Œå‰é¢ middleã€leftã€right çš„å®½åº¦åˆ†åˆ«ä¸º <code>100%</code>ï¼ˆå³çˆ¶çº§å…ƒç´ çš„å®½åº¦ï¼‰ã€<code>100px</code>ã€<code>100px</code>ã€‚å½“çª—å£ç¼©å°è‡³ <code>width(middle) &lt; width(left)</code> æ—¶ï¼Œå°±å¼€å§‹å˜å½¢ã€‚å‡è®¾ middle çš„å®½åº¦ä¸º <code>47px</code>ï¼Œé‚£ä¹ˆ left å…ƒç´ çš„ <code>margin-left: -100%</code> å‘å·¦åç§»çš„å€¼ä¸º <code>47px</code>ï¼Œæ­¤æ—¶ left å…ƒç´ çš„æ–‡æ¡£æµï¼ˆè„±ç¦»æ–‡æ¡£æµï¼‰å·¦ä¾§èµ·å§‹ä½ç½®ä¸ middle å·¦ä¾§é‡åˆï¼Œä½†ç”±äº middle çš„å®½åº¦ä¸º <code>47px</code>ï¼Œè€Œ left çš„å®½åº¦ä¸º <code>100px</code>ï¼Œä¹Ÿå°±æ˜¯ middle è¿™è¡Œå®¹ä¸ä¸‹ left å…ƒç´ ï¼Œå› æ­¤ left å°±â€œç§»â€åˆ°ä¸‹ä¸€è¡Œå»äº†ã€‚åŒæ—¶å—åˆ° <code>margin-left: -47px</code> å’Œ <code>posotion: relative; left: -100px</code> çš„å½±å“ï¼Œå…ƒç´ å…ˆå‘å·¦åç§»äº† <code>47px</code>ï¼Œç„¶åå†åŸºäºå½“å‰ä½ç½®å†å‘å·¦åç§» 100pxï¼Œäºæ˜¯ä»…å‰©ä¸‹ä¸Šå›¾çº¢è‰²å¯è§éƒ¨åˆ†ã€‚</p>
<p>å› æ­¤ï¼ŒMatthew Levine åœ¨ <a href="https://alistapart.com/article/holygrail/#section9">In Search of the Holy Grail</a> ä¸€æ–‡ä¸­é€šè¿‡æ§åˆ¶ body çš„æœ€å°å®½åº¦å¤„ç†è¯¥é—®é¢˜ã€‚</p>
<pre><code class="language-css">body {
  min-width: 550px;  /* 2x LC width + RC width */
}
</code></pre>
<h4>åŒé£ç¿¼å¸ƒå±€</h4>
<p>ç‰ä¼¯å¤§ä½¬æå‡ºçš„åŒé£ç¿¼å¸ƒå±€ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>å…ˆå¯¹æ¯”ä¸‹ DOM ç»“æ„ï¼š</p>
<pre><code class="language-html">&lt;!-- åœ£æ¯å¸ƒå±€ --&gt;
&lt;div id=&quot;header&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;container&quot;&gt;
  &lt;div id=&quot;middle&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;left&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;right&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- åŒé£ç¿¼å¸ƒå±€ --&gt;
&lt;div id=&quot;header&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;middle&quot;&gt;
  &lt;div id=&quot;content&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;left&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;right&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
</code></pre>
<p>åŒºåˆ«åœ¨äºåŒé£ç¿¼å¸ƒå±€ï¼Œåœ¨ middle å†…å¢åŠ äº†ä¸€ä¸ªå…ƒç´  contentï¼Œå…¶ä¸­ content è®¾ç½®å·¦å³å¤–è¾¹è·ä»¥é¿å…å†…å®¹è¢« left å’Œ right è¦†ç›–ä½ã€‚å¦å¤–ç”±äºä¸ç”¨å†åƒåœ£æ¯å¸ƒå±€é‚£æ ·åœ¨ container ä¸­è®¾ç½®å·¦å³å†…è¾¹è·ï¼Œå› æ­¤å¯ä»¥æŠŠè¯¥å…ƒç´ å¹²æ‰ã€‚</p>
<p>å®ç°ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;header&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;middle&quot;&gt;
  &lt;div id=&quot;content&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;left&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;right&quot; class=&quot;column&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
</code></pre>
<pre><code class="language-css">#header {
  height: 50px;
  background: #eee;
}

#middle,
#left,
#right {
  float: left;
}

#middle {
  width: 100%;
}

#content {
  margin-right: 100px;
  margin-left: 100px;
  background-color: green;
}

#left {
  margin-left: -100%;
  width: 100px;
  background-color: red;
}

#right {
  margin-left: -100px;
  width: 100px;
  background-color: blue;
}

#footer {
  clear: both;
  height: 50px;
  background: #eee;
}

.column {
  height: 300px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1681921300354.png" alt=""></p>
<p>ä½†å…¶å®å®ƒä¹Ÿå¹¶æ²¡æœ‰è§£å†³åœ£æ¯æ¨¡å¼çª—å£ç¼©å°çš„é—®é¢˜ï¼Œå½“ <code>width(middle) &lt; width(left)</code> æ—¶ä»ä¼šå˜å½¢ï¼Œleft éƒ¨åˆ†ä¼šæ‰ä¸‹æ¥ã€‚</p>
<h4>å°ç»“</h4>
<p>éšç€ CSS è¶Šæ¥è¶Šå¼ºå¤§ï¼Œå®ç°ä¸Šè¿°ä¸‰åˆ—å¸ƒå±€æœ‰æ›´å¤šã€æ›´å¥½çš„ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥å°è¯•ä½¿ç”¨ Flexã€Grid ç­‰æ–¹å¼å®ç°ï¼Œæ­¤æ–‡å°±ä¸å†å±•å¼€äº†ã€‚</p>
<p>å¦å¤–ï¼Œå‰é¢ä¸¤ç§å¸ƒå±€æ–¹å¼ï¼Œéƒ½å°† middle éƒ¨åˆ†æ”¾åœ¨å‰é¢ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ DOM æ¸²æŸ“æ—¶ä¼˜å…ˆæ¸²æŸ“ä¸»è¦å†…å®¹éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒä¼šå¯¼è‡´ DOM é¡ºåºä¸è§†è§‰é¡ºåºä¸ä¸€è‡´ï¼Œè¿›è€Œå½±å“åˆ°å¯è®¿é—®æ€§ï¼ˆ<a href="https://developer.mozilla.org/en-US/docs/Glossary/Accessibility">Accessibility</a>ï¼ŒA11Yï¼‰ï¼Œåˆç§°æ— éšœç¢ã€‚å½“è§†éšœäººç¾¤ä½¿ç”¨å±å¹•é˜…è¯»å™¨ç­‰å·¥å…·è®¿é—®ç½‘é¡µæ—¶ï¼Œç”±äºé¡ºåºçš„ä¸ä¸€è‡´ï¼Œå®ƒä»¬å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ã€‚</p>
<p>ç›¸å…³æ–‡ç« ï¼š<a href="https://www.456bereastreet.com/archive/201103/source_order_and_display_order_should_match/">Source order and display order should match</a></p>
<h3>å¤šåˆ—ç­‰é«˜å¸ƒå±€</h3>
<p>åŒæ ·åœ°ï¼Œå®ç°è¿™ç§å¸ƒå±€æœ‰ Flexã€Grid ç­‰ç°ä»£åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚è¿™é‡Œä»‹ç»ä¸€ç§åˆ©ç”¨äº† floatã€margin å’Œ padding å®ç°ã€Œè§†è§‰ç­‰é«˜ã€çš„æ–¹å¼ã€‚</p>
<p>ä»¥ä¸‰åˆ—ç­‰é«˜ä¸ºä¾‹ï¼Œå…¶ DOM ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;container&quot;&gt;
  &lt;div id=&quot;left&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;middle&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;right&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ç»™ leftã€middleã€right ä¸‰ä¸ªå…ƒç´ è®¾ç½®èƒŒæ™¯è‰²ä»¥ä¾¿äºåˆ¤æ–­æ˜¯å¦ç­‰é«˜ã€‚è¿˜æœ‰éœ€å°† leftã€middleã€right è®¾ä¸º <code>float: left</code>ï¼Œæ¯ä¸ªå…ƒç´ è®¾ç½®åŒç­‰å¤§å°çš„æ­£ç›´ <code>padding-bottom</code> å’Œè´Ÿå€¼ <code>margin-bottom</code>ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼è¦è¶³å¤Ÿå¤§ã€‚æˆ‘ä»¬çŸ¥é“è´Ÿå€¼ <code>margin-bottom</code> ä¼šä½¿å¾—å…¶åå…ƒç´ çš„æ–‡æ¡£æµä½ç½®å‘ä¸Šåç§»ï¼Œè‹¥å®ƒæœ¬èº«æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°±ç›¸å½“äºè‡ªèº«å‘ä¸Šåç§»ã€‚åœ¨ <code>padding-bottom</code> å’Œ <code>margin-bottom</code> çš„åŒæ—¶ä½œç”¨ä¸‹ï¼Œä½¿å¾—æ–‡æ¡£æµæœ€åçš„ä½ç½®ä¸è¯¥å…ƒç´ é«˜åº¦åº•éƒ¨å¯¹åº”çš„é‡åˆï¼Œè¿™æ ·ä¹Ÿå°±èƒ½æŒ‰å†…å®¹è‡ªé€‚åº”é«˜åº¦äº†ã€‚è€Œä¸”ç”±äºèƒŒæ™¯è‰²åŒºåŸŸä¹ŸåŒ…æ‹¬ <code>padding</code> éƒ¨åˆ†ï¼Œå› æ­¤è§†è§‰ä¸Šçœ‹ç€å°±ç­‰é«˜ï¼Œå®åˆ™ä¸æ˜¯ã€‚æœ€åï¼Œè¦è®°å¾—å¾€ container éƒ¨åˆ†åŠ ä¸Š <code>overflow: hidden</code>ï¼Œå¦åˆ™æ¸²æŸ“å‡ºæ¥çš„é«˜åº¦ä¸ºä¸‰è€…ä¸­ <code>height + padding-bottom</code> æœ€å¤§çš„é‚£ä¸ªã€‚</p>
<pre><code class="language-css">#container {
  overflow: hidden;
  margin: 0 auto;
  width: 100%;
}

#left {
  float: left;
  margin-bottom: -1000px; /* ç¤ºä¾‹é‡Œå°±ä¸è®¾è¿‡å¤§çš„å€¼äº† */
  padding-bottom: 1000px;
  width: 33.33%;
  height: 100px;
  background-color: red;
}

#middle {
  float: left;
  margin-bottom: -1000px;
  padding-bottom: 1000px;
  width: 33.33%;
  height: 200px;
  background-color: green;
}

#right {
  float: left;
  margin-bottom: -1000px;
  padding-bottom: 1000px;
  width: 33.34%;
  height: 300px;
  background-color: blue;
}

#footer {
  height: 100px;
  background: #eee;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682004723649.png" alt=""></p>
<p>ç°åœ¨ container æ•´ä½“çš„é«˜åº¦å–å†³äºä¸‰è€…æœ€å¤§çš„é‚£ä¸ªï¼Œä¹Ÿå°±æ˜¯ right çš„ 300pxã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬å°† right çš„é«˜åº¦è®¾ä¸º 1300px çš„è¯ï¼Œè¿™ç§å¸ƒå±€çš„é—®é¢˜å°±æš´æ¼å‡ºæ¥äº†ï¼Œå®ƒä»¬ä¸ç­‰é«˜äº†ï¼ŒåŸå› å¾ˆç®€å• left å’Œ right çš„èƒŒæ™¯è‰²é«˜åº¦æ˜¯ height + padding-bottomï¼Œä¹Ÿå°±æ˜¯ 1100px å’Œ 1200pxï¼Œæ‰€ä»¥å°±ä¸ç­‰é«˜äº†ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆå¥½è§£å†³ï¼Œå®é™…åº”ç”¨ä¸­æŠŠ padding-bottom è®¾å¾—è¶³å¤Ÿå¤§å³å¯ã€‚æœ¬æ–‡æ˜¯ä¸ºäº†ä¸¾ä¾‹æ•…è€Œè®¾å¾—è¾ƒå°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682004861068.png" alt=""></p>
<h3>å»é™¤è¾¹æ¡†</h3>
<p>è¿˜æ˜¯åˆ©ç”¨è´Ÿå€¼ margin-bottom å‘—ã€‚</p>
<p>ç¤ºä¾‹ä¸€</p>
<pre><code class="language-html">&lt;ul&gt;
  &lt;li&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚&lt;/li&gt;
  &lt;li&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<pre><code class="language-css">li {
  border-bottom: 2px solid red;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682006174729.png" alt=""></p>
<p>å‡è®¾æˆ‘ä»¬è¦å¹²æ‰æœ€åä¸€ä¸ª <code>&lt;li&gt;</code> çš„ä¸‹è¾¹æ¡†ï¼Œé¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯ <code>li:last-child { border-bottom: none }</code> ç­‰å¸¸è§„è§£æ³•ã€‚ç„¶åæˆ‘ä»¬ä»Šå¤©å……åˆ†äº†è§£ Margin çš„ç‰¹æ€§åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ margin-bottom æ¥è§£å†³ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-css">#box {
  overflow: hidden;
}

ul {
  margin-bottom: -2px;
}

li {
  border-bottom: 2px solid red;
}
</code></pre>
<pre><code class="language-html">&lt;div id=&quot;box&quot;&gt;
  &lt;ul&gt;
    &lt;li&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚&lt;/li&gt;
    &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚&lt;/li&gt;
    &lt;li&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;/li&gt;
    &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚&lt;/li&gt;
    &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;
</code></pre>
<p>ä¸Šé¢ <code>margin-bottom</code> ä½¿å¾—æ–‡æ¡£æµå‘ä¸Šåç§» 2pxï¼Œä¹Ÿå°±æ˜¯è¯´ <code>&lt;ul&gt;</code> çš„é«˜åº¦å‡å°‘äº† 2pxï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¤–å±‚è®¾ç½®ä¸€ä¸ª <code>overflow: hidden</code> å°±èƒ½éšè—æœ€åº•ä¸‹çš„è¾¹æ¡†äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682006827676.png" alt=""></p>
<p>ç¤ºä¾‹äºŒ</p>
<pre><code class="language-html">&lt;ul&gt;
  &lt;li&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚&lt;/li&gt;
  &lt;li&gt;æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚&lt;/li&gt;
  &lt;li&gt;å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<pre><code class="language-css">ul {
  border: 2px solid red;
}

li {
  margin-bottom: -2px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682007119261.png" alt=""></p>
<p>å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªç±»ä¼¼äºå•è¡Œç°¿çš„æ ·å¼ï¼Œå…¶ä¸­ <code>&lt;ul&gt;</code> å¤–éƒ¨è®¾ç½®äº† 2px çš„è¾¹æ¡†ï¼Œå®ƒä¸æœ€åä¸€ä¸ª <code>&lt;li&gt;</code> ä¸‹è¾¹æ¡†é‡å¤äº†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç»™ <code>&lt;li&gt;</code> è®¾ç½®ä¸€ä¸ª <code>margin-bottom: -2px</code> å³å¯ã€‚ä½†æ³¨æ„ï¼Œè¿™ç§æ–¹å¼ä¼šå¯¼è‡´æ¯ä¸ªå…ƒç´ éƒ½ä¼šå‡å°‘ 2pxï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®åä¼šæ€»ä½“å‡å°‘ 10pxã€‚</p>
<pre><code class="language-css">li {
  margin-bottom: -2px;
  border-bottom: 2px solid red;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682007541015.png" alt=""></p>
<h3>å®«æ ¼å¸ƒå±€</h3>
<p>è¦å®ç°è¿™æ ·çš„å¸ƒå±€ï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿä¸ºäº†ä»‹ç» Margin çš„åº”ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬ä¸ç”¨ Flex ç­‰å¸ƒå±€æ–¹å¼å“ˆã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682145120792.png" alt=""></p>
<p>å‡è®¾æ¯ä¸ªæ ¼å­å®½é«˜ä¸º 100pxï¼Œæ ¼å­é—´è·ä¸º 10pxï¼Œè¿™æ ·çš„è¯å®¹å™¨çš„å®½åº¦åº”è¯¥ä¸º 540pxã€‚æˆ‘ä»¬è„‘æµ·ä¸­ç¬¬ä¸€ååº”å¯èƒ½æ˜¯ä½¿ç”¨ nth-child() ç­‰æ–¹å¼è®¾ç½®å³ä¾§çš„ margin-right ä¸º 0ï¼Œä½†å¦‚æœæ˜¯ 3 åˆ—æˆ– 4 åˆ—å‘¢ï¼Œè®¡ç®—è¿˜æœ‰ç‚¹çƒ¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨è´Ÿå€¼ margin-right å¯ä»¥å¢åŠ å…ƒç´ å®½åº¦çš„ç‰¹æ€§å»è§£å†³å‘¢ï¼Ÿ</p>
<p>å…¶ DOM ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;container&quot;&gt;
  &lt;div id=&quot;box&quot;&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;item&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">#container {
  margin: 0 auto;
  border: 1px solid red; /* è¾¹æ¡† */
  width: 540px; /* å®¹å™¨å®½åº¦ */
}

#box::after {
  display: block;
  clear: both; /* æ¸…é™¤æµ®åŠ¨ï¼Œä½¿å¾— container é«˜åº¦ä¸åå¡Œ */
  content: '';
}

.item {
  float: left; /* è®¾ä¸ºå·¦æµ®åŠ¨ï¼Œä½¿å¾—æ¯ä¸ª item å‘å·¦æ’åˆ— */
  margin: 0 10px 10px 0; /* å³ä¸‹å¤–è¾¹è·è®¾ä¸º 10pxï¼Œç•™å‡ºé—´è·  */
  width: 100px;
  height: 100px;
  background: #eee;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682146408304.png" alt=""></p>
<p>è¿˜ä¸æ˜¯é¢„æœŸç»“æœï¼ŒåŸå› å¾ˆç®€å•ï¼šcontainer çš„å®½åº¦ä¸º 540pxï¼Œç”±äºå³å¤–è¾¹è·çš„å­˜åœ¨ï¼Œå¯¼è‡´æ¯è¡Œå³ä¾§ä»…å‰©ä¸‹ 100pxï¼Œè¯¥è¡Œä½™ä¸‹ç©ºé—´å®¹çº³ä¸äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆ100px å®½åº¦ + 10px å³å¤–è¾¹æ¡†ï¼‰ã€‚æ­¤æ—¶å¯¹ box å…ƒç´ è®¾ç½® <code>marign-rightï¼š -10px</code> ä»¥å¢åŠ å…¶å®½åº¦è‡³ 550pxï¼ŒåŸæœ¬ä¸‹ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±èƒ½æµ®ä¸Šæ¥äº†ï¼Œç„¶åå†ç»™ container è®¾ç½® <code>overflow: hidden</code> æˆªå–æ‰æº¢å‡ºéƒ¨åˆ†ã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°æœ€åä¸€è¡Œä¹Ÿæœ‰ä¸€ä¸ª 10px çš„ä¸‹å¤–è¾¹è·ï¼ŒåŒç†å€ŸåŠ© <code>margin-bottom: -10px</code> ä½¿å¾—æ–‡æ¡£æµä½ç½®å‘ä¸Šåç§»å°±èƒ½å¾ˆå¥½åœ°å¤„ç†ã€‚</p>
<p>æˆ‘ä»¬åŠ ä¸Šè¿™æ ·ä¸€ä¸ªæ ·å¼å³å¯ï¼š</p>
<pre><code class="language-css">#box {
  margin-right: -10px;
  margin-bottom: -10px;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1682147250811.png" alt=""></p>
<h3>å¾®ä¿¡æ’ç‰ˆå¸ƒå±€</h3>
<p>åˆ©ç”¨è´Ÿå€¼ Margin çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½œä¸€ä¸ªã€Œå±•å¼€ã€çš„äº¤äº’ã€‚å¦‚æœç»“åˆé›¶é«˜ç‰¹æ€§ï¼Œç”šè‡³å¯ä»¥åšå¤šæ¬¡å±•å¼€ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼šæ•´ä½“é«˜åº¦ä»åŸæ¥çš„ 600pxï¼Œåœ¨ç‚¹å‡»è§¦å‘ <code>&lt;svg&gt;</code> çš„åŠ¨ç”»åå˜ä¸º 1200pxï¼Œä¸æ­¤åŒæ—¶ <code>&lt;svg&gt;</code> ä¼šéšè—å¯æš´æ¼å‡ºå‰é¢ç»¿ã€è“çš„å…ƒç´ ï¼Œä»¥è¾¾åˆ°å±•å¼€çš„æ•ˆæœã€‚</p>
<pre><code class="language-html">&lt;section style=&quot;width: 350px; margin: 0 auto; overflow: hidden; font-size: 0; line-height: 0&quot;&gt;
  &lt;section&gt;
    &lt;section style=&quot;height: 600px; background-color: green&quot;&gt;&lt;/section&gt;
    &lt;section style=&quot;height: 600px; background-color: blue&quot;&gt;&lt;/section&gt;
  &lt;/section&gt;
  &lt;section style=&quot;margin-top: -1200px&quot;&gt;
    &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 350 600&quot; preserveAspectRatio=&quot;xMidYMin meet&quot; style=&quot;width: 100%; max-width: none !important; background-color: red; pointer-events: none&quot;&gt;
      &lt;animate attributeName=&quot;width&quot; begin=&quot;click&quot; from=&quot;100%&quot; to=&quot;200%&quot; calcMode=&quot;linear&quot; dur=&quot;2s&quot; fill=&quot;freeze&quot; restart=&quot;never&quot; /&gt;
      &lt;animate attributeName=&quot;opacity&quot; begin=&quot;click&quot; from=&quot;1&quot; to=&quot;0&quot; calcMode=&quot;linear&quot; dur=&quot;0.001s&quot; fill=&quot;freeze&quot; restart=&quot;never&quot; /&gt;
      &lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;transparent&quot; style=&quot;pointer-events: visible&quot;&gt;
        &lt;set attributeName=&quot;visibility&quot; begin=&quot;click&quot; to=&quot;hidden&quot; fill=&quot;freeze&quot; restart=&quot;never&quot; /&gt;
      &lt;/rect&gt;
    &lt;/svg&gt;
  &lt;/section&gt;
&lt;/section&gt;
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.w3.org/TR/CSS1/#vertical-formatting">Vertical formatting (CSS1)</a></li>
<li><a href="https://www.w3.org/TR/CSS2/box.html#collapsing-margins">Collapsing margins (CSS2)</a></li>
<li><a href="https://www.smashingmagazine.com/2009/07/the-definitive-guide-to-using-negative-margins/">The Definitive Guide to Using Negative Margins</a></li>
<li><a href="https://alistapart.com/article/holygrail/">In Search of the Holy Grail</a></li>
<li><a href="https://www.cnblogs.com/2050/archive/2012/08/13/2636467.html">CSS å¸ƒå±€å¥‡æ·«å·§è®¡ä¹‹-å¼ºå¤§çš„è´Ÿè¾¹è·</a></li>
<li><a href="https://lizh.gitbook.io/knowledge/css-tan-suo-xi-lie/01css-tan-suo-xi-lie-margin">CSS æ¢ç´¢ç³»åˆ— Margin</a></li>
<li><a href="https://www.zhihu.com/question/21644198/answer/42702524">ä¸ºä»€ä¹ˆã€Œmargin: autoã€å¯ä»¥è®©å—çº§å…ƒç´ æ°´å¹³å±…ä¸­ï¼Ÿ</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ macOS è‡ªåŠ¨æ›´æ¢æ¡Œé¢ä½ç½®çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/310</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/310</guid>
            <pubDate>Fri, 07 Apr 2023 09:20:43 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ¥ macOS çš„å¤šæ¡Œé¢ç»“åˆè§¦æ§æ¿èƒ½å¸¦æ¥æå¥½çš„ä½“éªŒï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜æ˜¯ï¼šç³»ç»Ÿä¼šæ ¹æ®ä½¿ç”¨æƒ…å†µã€Œè‡ªåŠ¨ã€æ›´æ¢æ¡Œé¢ä½ç½®ã€‚</p>
<p>å¯ä»¥åœ¨ã€Œç³»ç»Ÿåå¥½è®¾ç½® - è°ƒåº¦ä¸­å¿ƒã€å°†ã€Œæ ¹æ®æœ€è¿‘çš„ä½¿ç”¨æƒ…å†µè‡ªåŠ¨æ’åˆ—ç©ºæ ¼ã€é€‰é¡¹å…³é—­ã€‚å›°æ‰°äº†å¾ˆä¹…çš„é—®é¢˜ç»ˆäºè§£å†³äº†ã€‚</p>
<p><img src="https://cdn.jsde]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ¥ macOS çš„å¤šæ¡Œé¢ç»“åˆè§¦æ§æ¿èƒ½å¸¦æ¥æå¥½çš„ä½“éªŒï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜æ˜¯ï¼šç³»ç»Ÿä¼šæ ¹æ®ä½¿ç”¨æƒ…å†µã€Œè‡ªåŠ¨ã€æ›´æ¢æ¡Œé¢ä½ç½®ã€‚</p>
<p>å¯ä»¥åœ¨ã€Œç³»ç»Ÿåå¥½è®¾ç½® - è°ƒåº¦ä¸­å¿ƒã€å°†ã€Œæ ¹æ®æœ€è¿‘çš„ä½¿ç”¨æƒ…å†µè‡ªåŠ¨æ’åˆ—ç©ºæ ¼ã€é€‰é¡¹å…³é—­ã€‚å›°æ‰°äº†å¾ˆä¹…çš„é—®é¢˜ç»ˆäºè§£å†³äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1680859249023.png" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[npm install æŒ‡å®šç‰ˆæœ¬]]></title>
            <link>https://github.com/toFrankie/blog/issues/309</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/309</guid>
            <pubDate>Wed, 05 Apr 2023 04:37:09 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1680686247374.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>npm å®‰è£…åŒ…çš„æ–¹å¼å¾ˆå¤šå¾ˆå¤šï¼Œæœ¬æ–‡å°±ä»¥ä¸‹å‡ ç§æ–¹å¼ä½œç®€è¦ä»‹ç»ã€‚</p>
<pre]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1680686247374.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>npm å®‰è£…åŒ…çš„æ–¹å¼å¾ˆå¤šå¾ˆå¤šï¼Œæœ¬æ–‡å°±ä»¥ä¸‹å‡ ç§æ–¹å¼ä½œç®€è¦ä»‹ç»ã€‚</p>
<pre><code class="language-shell">$ npm install &lt;name&gt;
$ npm install &lt;name&gt;@&lt;tag&gt;
$ npm install &lt;name&gt;@&lt;version&gt;
$ npm install &lt;name&gt;@&lt;version range&gt;
</code></pre>
<h2>npm install &lt;name&gt;</h2>
<p>å®ƒå…¶å®å°±æ˜¯ <code>npm install &lt;name&gt;@&lt;tag&gt;</code> ç®€å†™å½¢å¼ã€‚ç”±äº <code>&lt;tag&gt;</code> é»˜è®¤ä¸º <code>latest</code>ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰ï¼Œå› æ­¤åœ¨ä¸ä½œä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ <code>npm install &lt;name&gt;</code> ä¼šæŒ‰ç…§è¯¥åŒ…çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<h2>npm install &lt;name&gt;@&lt;tag&gt;</h2>
<h3>tag æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ‰é‡å¤§çš„ç‰ˆæœ¬å˜æ›´ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»™å®ƒæ‰“ä¸Šä¸€ä¸ªã€Œæ ‡ç­¾ã€ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ›´å‹å¥½ã€æ˜“äºç†è§£çš„ã€Œåˆ«åã€ç½¢äº†ã€‚åƒå¹³å¸¸ä½¿ç”¨ Git åšç‰ˆæœ¬ç®¡ç†æ—¶ï¼Œä¹Ÿä¼šç”¨ <code>git tag</code> æ‰“æ ‡ç­¾ã€‚</p>
<h3>æœ‰å“ªäº› tagï¼Ÿ</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>latest</code> æ ‡ç­¾ç”¨æ¥æ ‡è¯†æŸä¸ªåŒ…çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>é™¤äº† <code>latest</code> ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•æ ‡ç­¾å¯¹ npm æœ¬èº«æœ‰ä»»ä½•ç‰¹æ®Šæ„ä¹‰ã€‚</p>
</blockquote>
<p>ä¸€ä¸ªåŒ…å¦‚æœ‰å¤šä¸ªå¼€å‘æµç¨‹å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æœ‰æ„ä¹‰çš„ tagï¼Œæ¯”å¦‚ï¼š<code>stable</code>ã€<code>alpha</code>ã€<code>beta</code>ã€<code>dev</code>ã€<code>canary</code>ã€<code>next</code>ã€‚é™¤äº† <code>latest</code> ä¹‹å¤–çš„æ‰€æœ‰ tagï¼Œéƒ½éœ€è¦åœ¨æ‰‹åŠ¨æŒ‡å®šã€‚</p>
<h3>å¦‚ä½•æŸ¥çœ‹ tagï¼Ÿ</h3>
<p>é€šè¿‡ <a href="https://docs.npmjs.com/cli/v9/commands/npm-dist-tag">npm-dist-tag</a> å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">$ npm dist-tag ls &lt;name&gt;
</code></pre>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ npm dist-tag ls lodash-es
latest: 4.17.21

$ npm dist-tag ls react
beta: 18.0.0-beta-24dd07bd2-20211208
experimental: 0.0.0-experimental-b14f8da15-20230403
latest: 18.2.0
next: 18.3.0-next-b14f8da15-20230403
rc: 18.0.0-rc.3
</code></pre>
<p>æˆ–åœ¨ <a href="https://www.npmjs.com/">npmjs.com</a> ç­‰å¹³å°æŸ¥çœ‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1680675748538.png" alt=""></p>
<h3>å¦‚ä½•æ·»åŠ /ç§»é™¤ tagï¼Ÿ</h3>
<p>åœ¨å‘åŒ…æ—¶é€šè¿‡ <code>--tag</code> å‚æ•°æŒ‡å®šï¼Œè‹¥æ— æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º <code>latest</code>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ npm publish --tag &lt;tag&gt;
</code></pre>
<p>å¯¹äºå·²å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ <code>npm dist-tag add</code> æˆ– <code>npm dist-tag rm</code> æ¥æ·»åŠ /ç§»é™¤ tagã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ npm dist-tag add &lt;name&gt;@&lt;version&gt; &lt;tag&gt;
$ npm dist-tag rm &lt;name&gt; &lt;tag&gt;
</code></pre>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell"># æœªæŒ‡å®šæ—¶ï¼Œé»˜è®¤ä¸º latest
$ npm publish
npm notice 
npm notice ğŸ“¦  @summer/my-pack@0.0.1
npm notice === Tarball Contents === 
npm notice 27B  README.md   
npm notice 232B package.json
npm notice 27B  src/index.js
npm notice === Tarball Details === 
npm notice name:          @summer/my-pack                         
npm notice version:       0.0.1                                   
npm notice filename:      summer-my-pack-0.0.1.tgz                
npm notice package size:  342 B                                   
npm notice unpacked size: 286 B                                   
npm notice shasum:        84c45d5eb997b714cb1348624b71046ed6c987a8
npm notice integrity:     sha512-blbi1Q3A8La3A[...]r6BVjGtYZ8rCw==
npm notice total files:   3                                       
npm notice 
npm notice Publishing to http://localhost:4873/ with tag latest and default access
+ @summer/my-pack@0.0.1

$ npm dist-tag ls @summer/my-pack
latest: 0.0.1

# å‘å¸ƒä¸€ä¸ªåä¸º next çš„ tag
$ npm publish --tag next
npm notice 
npm notice ğŸ“¦  @summer/my-pack@0.0.2
npm notice === Tarball Contents === 
npm notice 27B  README.md   
npm notice 232B package.json
npm notice 27B  src/index.js
npm notice === Tarball Details === 
npm notice name:          @summer/my-pack                         
npm notice version:       0.0.2                                   
npm notice filename:      summer-my-pack-0.0.2.tgz                
npm notice package size:  342 B                                   
npm notice unpacked size: 286 B                                   
npm notice shasum:        e9575fc34aacf2a08bb4f33a768dcf5ba4aab494
npm notice integrity:     sha512-kcHYodhWGbAds[...]TU53bhFy46wUw==
npm notice total files:   3                                       
npm notice 
npm notice Publishing to http://localhost:4873/ with tag next and default access
+ @summer/my-pack@0.0.2

$ npm dist-tag ls @summer/my-pack
latest: 0.0.1
next: 0.0.2

# ç§»é™¤ next tagï¼Œä½†æ³¨æ„ç§»é™¤å latest ä»ä¸º 0.0.1 ç‰ˆæœ¬
$ npm dist-tag rm @summer/my-pack next
-next: @summer/my-pack@0.0.2

$ npm dist-tag ls @summer/my-pack
latest: 0.0.1

# æ‰‹åŠ¨æŒ‡å®š 0.0.2 ç‰ˆæœ¬ä¸º latest tag
$ npm dist-tag add @summer/my-pack@0.0.2 latest
+latest: @summer/my-pack@0.0.2

# æ‰‹åŠ¨æŒ‡å®š 0.0.1 ç‰ˆæœ¬ä¸º legacy tag
$ npm dist-tag add @summer/my-pack@0.0.1 legacy
+legacy: @summer/my-pack@0.0.1

$ npm dist-tag ls @summer/my-pack
latest: 0.0.2
legacy: 0.0.1
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/4/1680678651843.png" alt=""></p>
<h3>å®‰è£…æŒ‡å®š tag</h3>
<p>å‰é¢äº†è§£ tag ä¹‹åï¼Œå®‰è£…å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<pre><code class="language-shell">$ npm install &lt;name&gt;@&lt;tag&gt;

# ç›¸å½“äº
$ npm install &lt;name&gt; --tag &lt;tag&gt;
</code></pre>
<p>å¦‚æœ‰ç‰¹æ®Šéœ€è¦ï¼Œå¯é€šè¿‡ <code>npm config set tag &lt;tag&gt;</code> å»é…ç½® tagï¼ˆ<a href="https://docs.npmjs.com/cli/v9/using-npm/config#tag">è¯¦è§</a>ï¼‰ï¼Œåé¢ <code>npm install</code> ä¸æŒ‡å®š tag æ—¶ï¼Œé»˜è®¤å–è¯¥é…ç½®å€¼ã€‚</p>
<h2>npm install &lt;name&gt;@&lt;version&gt;</h2>
<p>å®‰è£…æ—¶æŒ‡å®šç‰ˆæœ¬æˆ–æŒ‡å®šç‰ˆæœ¬èŒƒå›´ï¼š</p>
<pre><code class="language-shell">$ npm install &lt;name&gt;@&lt;version&gt;
$ npm install &lt;name&gt;@&lt;version range&gt;
</code></pre>
<h3>å®‰è£…ç¡®åˆ‡ç‰ˆæœ¬</h3>
<p>ä¸€æ˜¯å®‰è£…æ—¶æŒ‡å®šç¡®åˆ‡ç‰ˆæœ¬ï¼ŒäºŒæ˜¯é…ç½® <code>save-exact</code> ä¸º <code>true</code>ï¼ˆ<code>npm config set save-exact true</code>ï¼‰ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ npm install react@18.0.0

# ç›¸å½“äºï¼ˆå‡è®¾å½“å‰ react çš„ latest ä¸º 18.0.0ï¼‰
$ npm config set save-exact true
$ npm install react
</code></pre>
<p>é‚£ä¹ˆå®‰è£…å°±ä¸ä¼šä¸‹è½½ç¬¦åˆ <code>^x.y.z</code> æˆ– <code>~x.y.z</code> èŒƒå›´çš„ç‰ˆæœ¬äº†ã€‚</p>
<h3>å®‰è£… ^ æˆ– ~ ç‰ˆæœ¬</h3>
<p>ä½¿ç”¨ <code>npm install &lt;name&gt;</code> å®‰è£…åŒ…æ—¶ï¼Œå®ƒä¼šä»¥ <code>^x.y.z</code> å½¢å¼æ·»åŠ åˆ° <code>package.json</code> é‡Œé¢ã€‚å› ä¸º npm çš„ <code>save-prefix</code> é»˜è®¤é…ç½®å°±æ˜¯ <code>^</code>ï¼Œå¯é€šè¿‡ <code>npm config set save-prefix '~'</code> æŒ‡å®šä¸º <code>~</code>ã€‚äºŒè€…å«ä¹‰ï¼Œå¤§å®¶éƒ½æ‡‚å°±ä¸å†å±•å¼€èµ˜è¿°äº†ã€‚</p>
<h3>å®‰è£…ä¸»è¦ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆæœ¬</h3>
<pre><code class="language-shell">$ npm install &lt;name&gt;@&lt;major-version&gt;
</code></pre>
<p>æ¯”å¦‚ <code>npm install react@16</code> æˆ– <code>npm install react@16.x</code> ä¼šå®‰è£… 16.x ä¸­æœ€æ–°çš„ç‰ˆæœ¬ <code>^16.14.0</code>ã€‚</p>
<p>æœ€è¿‘ä¹Ÿé‡åˆ°è¿™ç§éœ€æ±‚ï¼šç›®å‰ <a href="https://www.npmjs.com/package/ora">ora</a> æœ€æ–°ç‰ˆæœ¬æ˜¯ 6.3.0ï¼Œè¯¥ç‰ˆæœ¬ä¸å†æ”¯æŒ CommonJS å½¢å¼å¯¼å…¥ï¼Œå› æ­¤ä½¿ç”¨ <code>const ora = require('ora')</code> å°†ä¼šæŠ¥é”™ï¼š</p>
<pre><code class="language-shell">const ora = require('ora')
            ^

Error [ERR_REQUIRE_ESM]: require() of ES Module /Users/frankie/Web/Temp/demo/node_modules/ora/index.js from /Users/frankie/Web/Temp/demo/src/index.js not supported.
</code></pre>
<p>å¯å®‰è£… 5.x ç‰ˆæœ¬ä»¥æ”¯æŒ CommonJSï¼ˆ<code>npm install ora@5</code>ï¼‰ã€‚</p>
<h2>npm install &lt;name&gt;@&lt;version range&gt;</h2>
<p>èŒƒå›´å¯é€šè¿‡ä½¿ç”¨ <code>&gt;</code>ã€<code>&lt;</code>ã€<code>=</code>ã€ <code>-</code> ç­‰é™å®šç¬¦ç»„åˆã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell"># å®‰è£…èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ17.0.1ï¼‰
$ npm install react@&quot;&gt;=16.0.0 &lt;17.0.2&quot; 

# å®‰è£…å¤§ç‰ˆæœ¬ä¸º 16 è‡³ 17 çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ17.0.2ï¼‰
$ npm install react@&quot;16 - 17&quot;
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://docs.npmjs.com/cli/v9/commands/npm-install">npm-install</a></li>
<li><a href="https://docs.npmjs.com/cli/v9/commands/npm-dist-tag">npm-dist-tag</a></li>
<li><a href="https://semver.npmjs.com/">npm SemVer Calculator</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[tsconfig.json è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/308</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/308</guid>
            <pubDate>Sat, 25 Mar 2023 14:16:58 GMT</pubDate>
            <description><![CDATA[<h2>ä¸€ã€ç®€ä»‹</h2>
<p><code>tsconfig.json</code> æ˜¯ TypeScript ç¼–è¯‘å™¨çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šç¼–è¯‘ TypeScript ä»£ç æ—¶çš„ç¼–è¯‘é€‰é¡¹å’Œç¼–è¯‘ç›®æ ‡ç­‰ä¿¡æ¯ã€‚é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œå¯ä»¥å®šåˆ¶ TypeScript ç¼–è¯‘å™¨çš„è¡Œä¸ºï¼Œä¾‹å¦‚æŒ‡å®šç¼–è¯‘ç›®æ ‡ã€å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„è¯­è¨€ç‰¹æ€§ã€è®¾ç½®ä»£ç æ£€æŸ¥]]></description>
            <content:encoded><![CDATA[<h2>ä¸€ã€ç®€ä»‹</h2>
<p><code>tsconfig.json</code> æ˜¯ TypeScript ç¼–è¯‘å™¨çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šç¼–è¯‘ TypeScript ä»£ç æ—¶çš„ç¼–è¯‘é€‰é¡¹å’Œç¼–è¯‘ç›®æ ‡ç­‰ä¿¡æ¯ã€‚é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œå¯ä»¥å®šåˆ¶ TypeScript ç¼–è¯‘å™¨çš„è¡Œä¸ºï¼Œä¾‹å¦‚æŒ‡å®šç¼–è¯‘ç›®æ ‡ã€å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„è¯­è¨€ç‰¹æ€§ã€è®¾ç½®ä»£ç æ£€æŸ¥è§„åˆ™ç­‰ã€‚</p>
<h3>1.1 ä¸ jsconfig.json çš„å…³ç³»</h3>
<p><code>jsconfig.json</code> æºè‡ª <code>tsconfig.json</code>ï¼Œé»˜è®¤å¯ç”¨äº†ä¸€äº›ä¸ JavaScript ç›¸å…³çš„ç¼–è¯‘é€‰é¡¹ï¼Œå¸¸ç”¨äº JavaScript é¡¹ç›®ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºè®¾ç½®äº† <code>allowJs</code> ä¸º <code>true</code> çš„ <code>tsconfig.json</code>ã€‚</p>
<p>æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <a href="https://webpack.js.org/configuration/resolve/#resolvealias">Webpack Alias</a> æ—¶ï¼Œå¯ä»¥å¾€ <code>jsconfig.json</code> é‡Œæ·»åŠ  <code>baseUrl</code>ã€<code>paths</code> é…ç½®ä»¥è·å¾—è·¯å¾„æ™ºèƒ½æç¤ºï¼Œæé«˜å¼€å‘ä½“éªŒã€‚</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./src/*&quot;]
    }
  }
}
</code></pre>
<h3>1.2 åˆ›å»º tsconfig.json</h3>
<p>æ–¹å¼æœ‰äºŒã€‚ä¸€æ˜¯åˆ©ç”¨ <code>tsc --init</code> å‘½ä»¤æ·»åŠ ï¼ˆ<a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html#compiler-options">è¯¦è§</a>ï¼‰ã€‚</p>
<pre><code class="language-shell">$ cd /path/to/project
$ npm init -y
$ npm i typescript -D
$ npx tsc --init

Created a new tsconfig.json with:                                                       
  target: es2016
  module: commonjs
  strict: true
  esModuleInterop: true
  skipLibCheck: true
  forceConsistentCasingInFileNames: true


You can learn more at https://aka.ms/tsconfig
</code></pre>
<p>äºŒæ˜¯æ‰‹åŠ¨æ·»åŠ ï¼Œç„¶åå‚è€ƒ <a href="https://github.com/tsconfig/bases#centralized-recommendations-for-tsconfig-bases">TSConfig bases</a>ï¼Œå€Ÿé‰´å„ç§æ¡†æ¶çš„é…ç½®ç¤ºä¾‹ï¼Œä¹Ÿå¯ç›´æ¥å®‰è£…å¯¹åº” <code>@tsconfig/xxx</code> åŒ…å¹¶ä½¿ç”¨ <code>extends</code> ç»§æ‰¿é…ç½®ã€‚</p>
<h3>1.3 é€‰æ‹©ç¼–è¯‘é…ç½®</h3>
<p>é€šå¸¸ï¼Œè‹¥ç›®å½•ä¸‹å­˜åœ¨ <code>tsconfig.json</code> æ–‡ä»¶ï¼Œåˆ™è¡¨ç¤ºè¯¥ç›®å½•æ˜¯ TypeScript é¡¹ç›®çš„æ ¹ç›®å½•ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ç”¨æ³•ä¸Šè¿˜æ˜¯è¦æ³¨æ„ã€‚</p>
<pre><code class="language-shell"># 1ï¸âƒ£
$ tsc

# 2ï¸âƒ£
$ tsc index.ts

# 3ï¸âƒ£
$ tsc --project /path/to/your_tsconfig.json
</code></pre>
<p>ä»¥ä¸Šä¸‰ç§æ–¹å¼ï¼Œç¼–è¯‘æ—¶çš„é…ç½®ç¨æœ‰ä¸åŒï¼š</p>
<blockquote>
<ul>
<li>1ï¸âƒ£ æ— è¾“å…¥æ–‡ä»¶çš„æƒ…å†µä¸‹è°ƒç”¨ <code>tsc</code>ï¼Œç¼–è¯‘å™¨ä¼šä»å½“å‰ç›®å½•å¼€å§‹å¹¶é€çº§å‘ä¸Šæ£€ç´¢ <code>tsconfig.json</code> æ–‡ä»¶ä½œä¸ºå…¶ç¼–è¯‘é…ç½®ã€‚è‹¥ä¸€ç›´æ‰¾ä¸åˆ°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®ã€‚</li>
<li>2ï¸âƒ£ æœ‰è¾“å…¥æ–‡ä»¶çš„æƒ…å†µä¸‹è°ƒç”¨ <code>tsc</code>ï¼Œç¼–è¾‘å™¨å°†ä¼šä½¿ç”¨é»˜è®¤é…ç½®ã€‚</li>
<li>3ï¸âƒ£ æŒ‡å®š <code>--project</code> æˆ– <code>-p</code> å‚æ•°æƒ…å†µä¸‹è°ƒç”¨ <code>tsc</code>ï¼Œç¼–è¯‘å™¨å°†ä¼šä½¿ç”¨è¯¥è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚</li>
</ul>
</blockquote>
<p>å¦‚æœä½ æ˜¯åˆšæ¥è§¦ï¼Œå¯å‚è€ƒ <a href="https://github.com/tsconfig/bases#centralized-recommendations-for-tsconfig-bases">TSConfig bases</a> é€‰æ‹©é€‚åˆä½ æ‰€ç”¨æ¡†æ¶çš„é…ç½®ã€‚</p>
<h3>1.4 é…ç½®ä¼˜å…ˆçº§</h3>
<p>CLI Options &gt; é¡¹ç›® tsconfig.json é…ç½® &gt; é»˜è®¤é…ç½®</p>
<h2>äºŒã€é…ç½®é€‰é¡¹</h2>
<p>tsconfig.json é‡Œé…ç½®é€‰é¡¹å¾ˆå¤šï¼Œè¶…è¿‡ 100 ä¸ªã€‚</p>
<h3>2.1 é¡¶çº§é€‰é¡¹ï¼ˆRoot Fieldsï¼‰</h3>
<p>é¡¶çº§é€‰é¡¹æœ‰è¿™å‡ ä¸ªï¼š</p>
<pre><code class="language-json">{
  &quot;compileOnSave&quot;: true,
  &quot;vueCompilerOptions&quot;: {},
  &quot;compilerOptions&quot;: {},
  &quot;watchOptions&quot;: {},
  &quot;include&quot;: [],
  &quot;exclude&quot;: [],
  &quot;files&quot;: [],
  &quot;typeAcquisition&quot;: {},
  &quot;references&quot;: [],
  &quot;extends&quot;: [],
  &quot;buildOptions&quot;: {},
  &quot;ts-node&quot;: {}
}
</code></pre>
<p>è¿˜åŒ…æ‹¬ Vue.js ä¸­ä¼šç”¨åˆ°çš„ vueCompilerOptions é€‰é¡¹ç­‰ã€‚</p>
<h4>2.1.1 compileOnSave</h4>
<p>å¯ç”¨è¯¥é€‰é¡¹ï¼Œå¯ä»¥è®© IDE/Editor åœ¨ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨ç¼–è¯‘ã€‚</p>
<p><strong>è¯·æ³¨æ„ï¼Œå®ƒï¼ˆç›®å‰ï¼‰å¹¶æ²¡æœ‰å¾—åˆ° Visual Studio Code çš„æ”¯æŒ</strong>ã€‚ä»…åœ¨ Visual Studio 2015 å’Œå®‰è£…äº† <a href="https://github.com/TypeStrong/atom-typescript#installation">atom-typescript</a> æ’ä»¶çš„ <a href="https://atom.io/">Atom</a> ä¸­å¾—åˆ°äº†æ”¯æŒã€‚è€Œè¯¥æ’ä»¶å’Œ Atom å‡å·²åœæ­¢ç»´æŠ¤ã€‚</p>
<h4>2.1.2 compileerOptions</h4>
<p>è¯¥é€‰é¡¹æ˜¯ TypeScript é…ç½®çš„é‡å¤´æˆï¼Œä¸‹æ–‡å†è¯¦ç»†ä»‹ç»ã€‚</p>
<h4>2.1.3 files</h4>
<p>è¯¥é€‰é¡¹ç”¨äºæŒ‡å®šå¾…ç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼Œä½†ä¸èƒ½æ˜¯ Glob æ¨¡å¼ã€‚</p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>å¦‚æœæŒ‡å®šäº† <code>files</code> é€‰é¡¹ï¼Œåˆ™åªæœ‰æŒ‡å®šçš„æ–‡ä»¶æ‰ä¼šè¢«ç¼–è¯‘ï¼Œå…¶ä»–æ–‡ä»¶ä¼šè¢«å¿½ç•¥ï¼›</li>
<li>å¦‚æœ <code>files</code> å†…æŒ‡å®šçš„æ–‡ä»¶å¼•ç”¨äº†å…¶ä»–æ¨¡å—ï¼Œè¿™äº›æ¨¡å—ä¹Ÿä¼šè¢«ç¼–è¯‘ã€‚</li>
<li>å½“ä½¿ç”¨äº† <code>files</code> é€‰é¡¹ï¼Œé€šå¸¸è¿˜ä¼šæŒ‡å®š <code>compilerOptions.outFile</code> æˆ– <code>compilerOptions.outDir</code> é€‰é¡¹ä»¥ä¾¿ç¼–è¯‘å™¨å°†ç¼–è¯‘ç»“æœè¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚</li>
<li>å¦‚æœæŒ‡å®šäº† <code>files</code>ï¼Œ<code>include</code> çš„é»˜è®¤å€¼ä¸º <code>[]</code>ï¼Œå¦åˆ™ä¸º <code>[&quot;**&quot;]</code>ã€‚</li>
</ul>
</blockquote>
<h4>2.1.4 include</h4>
<p>è¯¥é€‰é¡¹ç±»ä¼¼äº <code>files</code> å­—æ®µï¼ŒåŒæ ·ç”¨äºæŒ‡å®šç¼–è¯‘å™¨åº”è¯¥åŒ…å«å“ªäº›æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼ŒæœªæŒ‡å®šæ—¶é»˜è®¤ç¼–è¯‘æ ¹ç›®å½•ä¸‹æ‰€æœ‰ TypeScript æ–‡ä»¶ã€‚åŒºåˆ«åœ¨äºï¼Œ<code>include</code> æ”¯æŒ Glob æ¨¡å¼æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚</p>
<p><code>include</code> å’Œ <code>exclude</code> æ”¯æŒ Glob æ¨¡å¼å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><code>*</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼ˆé™¤äº†è·¯å¾„åˆ†éš”ç¬¦ <code>/</code>ï¼‰ã€‚
<code>?</code> åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼ˆé™¤äº†è·¯å¾„åˆ†éš”ç¬¦ <code>/</code>ï¼‰ã€‚
<code>**/</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªç›®å½•åŠå…¶å­ç›®å½•ã€‚</p>
</blockquote>
<p>è‹¥ Glob æ¨¡å¼æœªæŒ‡å®šæ–‡ä»¶æ‰©å±•åæ—¶ï¼Œé»˜è®¤æ”¯æŒ <code>.ts</code>ã€<code>.tsx</code> å’Œ <code>.d.ts</code>ã€‚è‹¥ <code>allowJs</code> ä¸º <code>true</code>ï¼Œè¿˜åŒ…æ‹¬ <code>.js</code> å’Œ <code>.jsx</code>ã€‚</p>
<h4>2.1.5 exclude</h4>
<p>è¯¥é€‰é¡¹ç”¨äºæŒ‡å®š <code>include</code> é‡Œé¢éœ€è¦å¿½ç•¥çš„æ–‡ä»¶ã€‚exclude çš„é»˜è®¤å€¼ä¸º <code>[&quot;node_modules&quot;, &quot;bower_components&quot;, &quot;jspm_packages&quot;]</code>ï¼Œä½†æ’é™¤æ–‡ä»¶è¿˜åŒ…æ‹¬ <code>outDir</code> æŒ‡å®šå€¼ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†ä¼šå¿½ç•¥çš„æ–‡ä»¶ä¸º <code>[&quot;node_modules&quot;, &quot;bower_components&quot;, &quot;jspm_packages&quot;, &quot;dist&quot;]</code>ã€‚</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;outDir&quot;: &quot;dist&quot;
  },
  &quot;exclude&quot;: []
}
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œ<code>exclude</code> å­—æ®µåªå½±å“ç”± <code>include</code> å­—æ®µæŒ‡å®šçš„æ–‡ä»¶å’Œç›®å½•ä¸­åŒ…å«å“ªäº›æ–‡ä»¶ï¼Œè€Œä¸ä¼šå®Œå…¨æ’é™¤åœ¨ <code>exclude</code> ä¸­åˆ—å‡ºçš„æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶åœ¨ <code>exclude</code> ä¸­åˆ—å‡ºï¼Œä½†æ˜¯å®ƒè¢«ä»£ç ä¸­çš„ <code>import</code> è¯­å¥ã€<code>/// &lt;reference</code> æˆ–è€…åœ¨ <code>files</code>ã€<code>types</code> å­—æ®µä¸­çš„æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ä»ç„¶ä¼šè¢«ç¼–è¯‘ã€‚</p>
</blockquote>
<h4>2.1.6 filesã€include å’Œ exclude çš„å…³ç³»</h4>
<p>æœªå®Œå¾…ç»­...</p>
<h2>Related Link</h2>
<ul>
<li><a href="https://code.visualstudio.com/docs/languages/jsconfig">What is jsconfig.json?</a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">What is a tsconfig.json?</a></li>
<li><a href="https://www.typescriptlang.org/tsconfig">TSConfig Reference</a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">tsc CLI Options</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS ä¸‰è§’å½¢è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/307</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/307</guid>
            <pubDate>Sat, 25 Mar 2023 09:38:00 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679746307035.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡å°†ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨çº¯ CSS å®ç°å„ç§ä¸‰è§’å½¢ã€‚æ–‡æœ«ä¼šæ¨èä¸€ä¸ªåœ¨çº¿å·¥å…·ã€‚<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679746307035.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡å°†ä¼šè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨çº¯ CSS å®ç°å„ç§ä¸‰è§’å½¢ã€‚æ–‡æœ«ä¼šæ¨èä¸€ä¸ªåœ¨çº¿å·¥å…·ã€‚</p>
<h2>äº†è§£è¾¹æ¡†</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä»»ä½• HTML å…ƒç´ å…¶å®éƒ½æ˜¯ä¸€ä¸ªçŸ©å½¢çš„ç›’å­ã€‚é€šè¿‡ä»¥ä¸‹ CSS å±æ€§å¯ä»¥è®¾ç½®å…ƒç´ çš„å››æ¡è¾¹æ¡†ï¼š</p>
<blockquote>
<ul>
<li>border-top</li>
<li>border-right</li>
<li>border-bottom</li>
<li>border-left</li>
</ul>
</blockquote>
<p>è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;!-- ä¸ºäº†æ–¹ä¾¿æˆªå›¾ï¼Œçˆ¶å…ƒç´ å®½åº¦è®¾ç½®ä¸º 300px --&gt;
&lt;div class=&quot;rect&quot;&gt;some text...&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.rect {
  border-top: 30px solid red;
  border-right: 30px solid green;
  border-bottom: 30px solid blue;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679737212839.png" alt=""></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æŠŠ div çš„æ–‡æœ¬å¹²æ‰ï¼Œå†çœ‹ä¸‹æ•ˆæœï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;rect&quot;&gt;&lt;/div&gt;
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679737896858.png" alt=""></p>
<p>ç”±äº div æ˜¯å—çº§å…ƒç´ ï¼Œå®ƒé»˜è®¤å æ»¡çˆ¶å…ƒç´ çš„å®½åº¦ï¼ˆæˆªå›¾ä¸­çˆ¶å…ƒç´ å®½åº¦ä¸º 300pxï¼‰ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬æŠŠ div çš„ <code>width</code> å’Œ <code>height</code> å‡è®¾ä¸º <code>0</code>ï¼Œå†çœ‹ä¸‹æ•ˆæœï¼š</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  border-top: 30px solid red;
  border-right: 30px solid green;
  border-bottom: 30px solid blue;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679738020081.png" alt="image.png"></p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ä½ åº”è¯¥çŸ¥é“å¦‚ä½•è®¾ç½®å„ç§å½¢çŠ¶çš„ä¸‰è§’å½¢äº†ï¼Œæœ€èµ·ç æ€è·¯æ˜¯æœ‰äº†ã€‚</p>
<p>åªè¦æŠŠè¾¹ã€è¾¹æ¡†èƒŒæ™¯ç»„åˆä¸€ä¸‹ï¼Œå°±èƒ½å®ç°å„ç§å½¢çŠ¶äº†ã€‚</p>
<h2>ç›´è§‰æ€§è¯¯åŒº</h2>
<p>å‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªå·¦ä¸‹è¾¹ï¼ˆæ©™è“ï¼‰ç»„æˆçš„ç›´è§’ä¸‰è§’å½¢ï¼Œé‚£æ˜¯ä¸æ˜¯åªè¦æŠŠå³ä¸Šï¼ˆç»¿çº¢ï¼‰çš„è¾¹æ¡†å¹²æ‰å°±è¡Œï¼Ÿ</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  /* border-top: 30px solid red; */
  /* border-right: 30px solid green; */
  border-bottom: 30px solid blue;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679739447100.png" alt=""></p>
<p>è¿™ä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœå“¦ï¼æ¢ä¸ªæ€è·¯ï¼ŒæŠŠå³ä¸Šçš„è¾¹æ¡†é¢œè‰²è®¾ä¸ºé€æ˜ï¼ˆtransparentï¼‰å‘¢ï¼Ÿ</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  border-top: 30px solid transparent;
  border-right: 30px solid transparent;
  border-bottom: 30px solid blue;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679740268567.png" alt=""></p>
<p>è¿™æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸‹åŸå› ï¼š</p>
<blockquote>
<p>ç”±äºæˆ‘ä»¬å°† div çš„ <code>width</code> å’Œ <code>height</code> å‡è®¾ä¸º <code>0</code>ï¼Œé‚£ä¹ˆå®ƒå°±é  <code>border</code> æ¥æ’‘å¼€ç©ºé—´äº†ã€‚å…¶ä¸­ã€Œæ°´å¹³æ–¹å‘ã€é  <code>border-left</code>ã€<code>border-right</code> æ¥æ’‘å¼€ï¼Œã€Œå‚ç›´æ–¹å‘ã€é  <code>border-top</code>ã€<code>border-bottom</code> æ¥æ’‘å¼€ã€‚æ‰€ä»¥è®¾ç½®å››æ¡è¾¹ä¸º 30px çš„æ—¶å€™ï¼Œå®ƒå ç”¨äº† 60 Ã— 60 çš„ç©ºé—´ã€‚ä¸€æ—¦æˆ‘ä»¬å¹²æ‰äº†ä¸Šè¾¹æ¡†å’Œå³è¾¹æ¡†ï¼Œå®ƒå®é™…åªå äº† 30 Ã— 30 çš„ç©ºé—´ï¼Œå³å³ä¸‹è§’çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679741600611.png" alt=""></p>
<h2>åŸºç¡€ä¸‰è§’å½¢</h2>
<blockquote>
<p>æœ¬æ–‡ä¸ä¼šä¸€ä¸€åˆ—ä¸¾å„ç§å½¢çŠ¶çš„ç¤ºä¾‹ï¼Œé“ç†æ˜¯ç›¸é€šçš„ï¼Œè‡ªç”±ç»„åˆå³å¯ã€‚</p>
</blockquote>
<p>å¦‚æœè¦å®ç°ä»¥ä¸‹è¿™ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œæœ‰å¤šå°‘ç§åšæ³•å‘¢ï¼Ÿ</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679742984584.png" alt=""></p>
<p>æˆ‘ä»¬åšä¸ªè¾…åŠ©çº¿ï¼Œå°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679743275248.png" alt=""></p>
<p>å…±æœ‰ä¸‰ç§æ–¹å¼å¯å®ç°ï¼š<strong>æ©™è‰² + çº¢è‰²</strong>ã€<strong>äºŒåˆ†ä¹‹ä¸€æ©™è‰²</strong>ã€<strong>äºŒåˆ†ä¹‹ä¸€çº¢è‰²</strong>ã€‚ä¸ºäº†æ–¹ä¾¿ä¸¾ä¾‹ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸è®¾ä¸ºç›¸åŒçš„é¢œè‰²ï¼Œå®ç°éœ€æ±‚å½¢çŠ¶å³å¯ï¼Œå¤§å°ä¹Ÿè¯·è‡ªè¡Œè°ƒæ•´ã€‚</p>
<h3>æ©™è‰² + çº¢è‰²</h3>
<p>å››æ¡è¾¹å‡ä¸èƒ½çœç•¥ï¼Œå…¶ä¸­ border-top å’Œ border-left è®¾ä¸ºç›¸åŒçš„é¢œè‰²ï¼Œborder-right å’Œ border-bottom è®¾ä¸ºé€æ˜è‰²ã€‚</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  border-top: 30px solid red;
  border-right: 30px solid transparent;
  border-bottom: 30px solid transparent;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679743815638.png" alt=""></p>
<h3>äºŒåˆ†ä¹‹ä¸€æ©™è‰²</h3>
<p>ä¸è®¾ç½® border-top å’Œ border-right ä¸¤æ¡è¾¹ã€‚boder-bottom è®¾ä¸ºé€æ˜è‰²ï¼Œborder-left è®¾ç½®èƒŒæ™¯è‰²ã€‚</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  border-bottom: 30px solid transparent;
  border-left: 30px solid orange;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679744138587.png" alt=""></p>
<h3>äºŒåˆ†ä¹‹ä¸€çº¢è‰²</h3>
<p>ä¸è®¾ç½® border-left å’Œ border-bottom ä¸¤æ¡è¾¹ã€‚boder-right è®¾ä¸ºé€æ˜è‰²ï¼Œborder-top è®¾ç½®èƒŒæ™¯è‰²ã€‚</p>
<pre><code class="language-css">.rect {
  width: 0;
  height: 0;
  border-top: 30px solid red;
  border-right: 30px solid transparent;
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679744330161.png" alt=""></p>
<h2>ç‰¹æ®Šä¸‰è§’å½¢</h2>
<p>æœ‰æ—¶å€™å¯èƒ½è¦å®ç°ç­‰è…°ä¸‰è§’å½¢ã€ç­‰è¾¹ä¸‰è§’å½¢ç­‰ã€‚é“ç†å¾ˆç®€å•ï¼Œæ— éå°±æ˜¯æŒ‰è¦æ±‚å…ˆæŠŠå®½é«˜è®¡ç®—å‡ºæ¥ï¼Œç„¶åè®¾ç½®å¯¹åº”è¾¹çš„ <code>border-width</code> å³å¯ã€‚</p>
<p>å¹³æ—¶å·¥ä½œå½“ç„¶è¦å–„ç”¨å·¥å…·äº†ï¼Œæ¯”å¦‚ <s><a href="http://apps.eky.hk/css-triangle-generator/zh-hant">CSS triangle generator</a></s>ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679745033878.png" alt=""></p>
<p>æ—¢èƒ½é€‰æ‹©å„ç§å½¢çŠ¶ï¼Œä¹Ÿèƒ½è¾“å…¥è®¾ç½®å®½é«˜ï¼Œé‚£è¿˜ç”¨å¾—ç€è‡ªå·±è®¡ç®—å‘¢ï¼Œå¯¹å§ã€‚</p>
<p>2024.02.01 æ›´æ–°ï¼Œä¸Šè¿°å·¥å…·é“¾æ¥å·²å¤±æ•ˆï¼Œå…¶ä»–æ›´å¤šé€‰æ‹© ğŸ‘‡</p>
<ul>
<li><a href="https://unused-css.com/tools/triangle-generator">CSS Triangle Generator</a>ï¼ˆæ‹–æ‹½ã€æ›´å¤šå½¢çŠ¶æ”¯æŒï¼‰</li>
<li><a href="https://10015.io/tools/css-triangle-generator">CSS Triangle Generator</a>ï¼ˆå¸¸è§å½¢çŠ¶æ”¯æŒï¼‰</li>
</ul>
<h2>æ€»ç»“</h2>
<p>ä½¿ç”¨ CSS æ¥ç”»ä¸‰è§’å½¢ï¼Œæ— éå°±æ˜¯å°†å…ƒç´ çš„å®½é«˜è®¾ä¸º <code>0</code>ï¼Œç„¶åå°†å››æ¡è¾¹è‡ªç”±ç»„åˆå°±èƒ½ç”»å‡ºå„ç§å½¢çŠ¶ã€‚è¾ƒä¸ºéº»çƒ¦çš„æ˜¯ï¼Œç‰¹æ®Šä¸‰è§’å½¢å®½é«˜éœ€è®¡ç®—ï¼Œä½†å·²ç»æœ‰å·¥å…·åœ¨å¸®æˆ‘ä»¬åšè¿™ä»¶äº‹äº†ï¼Œæ‰€ä»¥éå¸¸è½»æ¾å°±èƒ½å®Œæˆäº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åœ¨ Parallels Desktop ä¸­ä½¿ç”¨å®¿ä¸»æœºä»£ç†]]></title>
            <link>https://github.com/toFrankie/blog/issues/306</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/306</guid>
            <pubDate>Sat, 25 Mar 2023 08:08:17 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ Mac ä¸Šå®‰è£…äº† ClashX ç­‰ä»£ç†å®¢æˆ·ç«¯åï¼Œå¦‚ä½•è®© Parallels Desktop é‡Œçš„ Windows ä½¿ç”¨å®¿ä¸»æœºä»£ç†ä»¥ç§‘å­¦ä¸Šç½‘å‘¢ï¼Ÿ</p>
<ol>
<li>å¯ç”¨ã€ŒClashX â†’ å…è®¸å±€åŸŸç½‘è¿æ¥ã€é€‰é¡¹ã€‚</li>
<li>æ‰“å¼€ Windowsï¼Œæ‰¾åˆ°ã€Œè®¾ç½® â†’ ç½‘ç»œå’Œ Internet â†’ æ‰‹åŠ¨è®¾]]></description>
            <content:encoded><![CDATA[<p>åœ¨ Mac ä¸Šå®‰è£…äº† ClashX ç­‰ä»£ç†å®¢æˆ·ç«¯åï¼Œå¦‚ä½•è®© Parallels Desktop é‡Œçš„ Windows ä½¿ç”¨å®¿ä¸»æœºä»£ç†ä»¥ç§‘å­¦ä¸Šç½‘å‘¢ï¼Ÿ</p>
<ol>
<li>å¯ç”¨ã€ŒClashX â†’ å…è®¸å±€åŸŸç½‘è¿æ¥ã€é€‰é¡¹ã€‚</li>
<li>æ‰“å¼€ Windowsï¼Œæ‰¾åˆ°ã€Œè®¾ç½® â†’ ç½‘ç»œå’Œ Internet â†’ æ‰‹åŠ¨è®¾ç½®ä»£ç†ã€ï¼Œæ·»åŠ ä»¥ä¸‹è®¾ç½®å¹¶ä¿å­˜ã€‚</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679731650752.png" alt=""></p>
<p>ä»£ç† IP åœ°å€ä¿®æ”¹ä¸ºä½ çš„ IP åœ°å€ï¼Œ<code>7890</code> æ˜¯ ClashX çš„é»˜è®¤ç«¯å£å·ã€‚è‹¥æœ‰è°ƒæ•´ï¼Œè‡ªè¡Œæ›´æ”¹ã€‚</p>
<p>æŸ¥çœ‹ Mac çš„ IP åœ°å€ï¼š</p>
<pre><code class="language-shell">$ ifconfig | grep &quot;inet &quot; | grep -Fv 127.0.0.1 | awk '{print $2}'
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[npm å®‰è£…æ—¶é”å®šç‰ˆæœ¬]]></title>
            <link>https://github.com/toFrankie/blog/issues/305</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/305</guid>
            <pubDate>Thu, 23 Mar 2023 06:34:55 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679576865201.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ npm æˆ– yarn å®‰è£…åŒ…æ—¶ï¼Œå®ƒä¼šä»¥ <code>^x.y.]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1679576865201.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ npm æˆ– yarn å®‰è£…åŒ…æ—¶ï¼Œå®ƒä¼šä»¥ <code>^x.y.z</code> å½¢å¼æ·»åŠ åˆ° <code>package.json</code> é‡Œé¢ã€‚</p>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;typescript&quot;: &quot;^5.0.2&quot;
  }
}
</code></pre>
<p>å¯é€šè¿‡ <a href="https://docs.npmjs.com/cli/v9/using-npm/config?v=true#save-prefix">save-prefix</a>  æˆ– <a href="https://docs.npmjs.com/cli/v9/using-npm/config?v=true#save-exact">save-exact</a> è¿›è¡Œä¿®æ”¹ï¼š</p>
<ul>
<li><code>save-prefix</code> å¯ä»¥æŒ‡å®šä¸º <code>^</code>ï¼ˆé»˜è®¤ï¼‰æˆ– <code>~</code>ã€‚</li>
<li><code>save-exact</code> æŒ‡å®šç¡®åˆ‡ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰ã€‚</li>
</ul>
<p>npm é…ç½®æ–‡ä»¶çš„ä½œç”¨èŒƒå›´å¯åˆ†ä¸º <code>global</code>ã€<code>user</code>ã€<code>project</code>ï¼Œä½†é€šå¸¸æˆ‘ä»¬åªè¦å…³æ³¨ <code>user</code> å’Œ <code>project</code> å°±è¡Œï¼Œå¯¹åº”çš„é…ç½®æ–‡ä»¶åœ¨ <code>~/.npmrc</code> å’Œ <code>/path/to/project/.npmrc</code>ã€‚</p>
<pre><code class="language-shell"># ç”¨æˆ·çº§åˆ«
$ npm config set save-prefix '~'

# é¡¹ç›®çº§åˆ«
$ npm config set save-prefix '~' --location project
</code></pre>
<pre><code class="language-shell"># ç”¨æˆ·çº§åˆ«
$ npm config set save-exact true

# é¡¹ç›®çº§åˆ«
$ npm config set save-exact true --location project
</code></pre>
<p>å…¶ä¸­ <a href="https://docs.npmjs.com/cli/v9/commands/npm-config#location">npm config</a> ä¿®æ”¹é…ç½®æ˜¯ <code>user</code> çº§åˆ«çš„ï¼ˆé€šå¸¸æ„ä¹‰ä¸Šçš„å…¨å±€é…ç½®ï¼‰ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹å¯¹åº”é…ç½®æ–‡ä»¶ï¼ˆå…¶ä¸­ <code>.npmrc</code> ä¸º ini æ ¼å¼ï¼‰ã€‚</p>
<p>ç”±äº yarn v1 ä¼šè¯»å– <code>.npmrc</code> ä½œä¸ºè¡¥å……ï¼Œé€šå¸¸æˆ‘ä»¬åªè¦ä½¿ç”¨ <code>npm config</code> å»è®¾ç½®å³å¯ã€‚</p>
<h2>Related Link</h2>
<ul>
<li><a href="https://docs.npmjs.com/cli/v9/configuring-npm/npmrc#files">npmrc</a></li>
<li><a href="https://docs.npmjs.com/cli/v9/commands/npm-config">npm-config</a></li>
<li><a href="https://docs.npmjs.com/cli/v9/using-npm/config?v=true#save-prefix">config#save-prefix</a></li>
<li><a href="https://docs.npmjs.com/cli/v9/using-npm/config?v=true#save-exact">config#save-exact</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åº textarea ç»„ä»¶çš„å‘]]></title>
            <link>https://github.com/toFrankie/blog/issues/304</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/304</guid>
            <pubDate>Fri, 10 Mar 2023 02:22:46 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1745911898628.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>éƒ½ 2021 å¹´äº†ï¼Œå¾®ä¿¡å°ç¨‹åº textarea ç»„ä»¶è¿˜æ˜¯é‚£ä¹ˆå¤šé—®é¢˜ï¼Œå…¼å®¹æ€§é—®]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/4/1745911898628.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>éƒ½ 2021 å¹´äº†ï¼Œå¾®ä¿¡å°ç¨‹åº textarea ç»„ä»¶è¿˜æ˜¯é‚£ä¹ˆå¤šé—®é¢˜ï¼Œå…¼å®¹æ€§é—®é¢˜åœ¨ Android æœºå‹ï¼ˆç‰¹åˆ«æ˜¯ä½é…ç½®çš„ï¼‰ä¸Šå°¤ä¸ºçªå‡ºï¼</p>
<blockquote>
<p>2025 å¹´äº†ï¼Œå¥½åƒè¿˜å¾ˆå¤šé—®é¢˜ï¼Œå¯èƒ½æ˜¯å‹æ ¹æ²¡ä¿®å§...</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­</p>
<pre><code class="language-html">&lt;textarea
  name=&quot;address&quot;
  id=&quot;address&quot;
  rows=&quot;3&quot;
  bindinput=&quot;onInput&quot;
  bindblur=&quot;onBlur&quot;
  bindfocus=&quot;onFocus&quot;
  class=&quot;textarea&quot;
  value=&quot;{{address}}&quot;
  placeholder-class=&quot;input-placeholder&quot;
  placeholder=&quot;è¯·è¾“å…¥åœ°å€&quot;
  confirm-type=&quot;done&quot;
  disable-default-padding=&quot;{{true}}&quot;
  cursor-spacing=&quot;50&quot;
  show-confirm-bar=&quot;{{false}}&quot;
  auto-height=&quot;{{true}}&quot;
  maxlength=&quot;60&quot;
/&gt;
</code></pre>
<h2>1. show-confirm-bar é—®é¢˜</h2>
<p>æµ‹è¯•åŒå­¦å‘ç°ï¼Œåœ¨çº¢ç±³ 4X ä¸Š textarea ç»„ä»¶çš„ã€Œå®Œæˆã€ä¸€æ ä¸é€æ˜åº¦ä¸æ˜¯ 100%ï¼Œå¯¼è‡´æ–‡æ¡ˆä¸åº•ä¸‹æ–‡æ¡ˆé‡å ã€‚</p>
<p>å°è¯•ä½¿ç”¨ <code>show-confirm-bar=&quot;{{false}}&quot;</code> æ¥éšè—ã€Œå®Œæˆã€ä¸€æ ã€‚å¥½å®¶ä¼™ï¼Œæ–°é—®é¢˜åˆæ¥äº†ã€‚å½“è®¾ç½®ä¹‹åï¼Œåœ¨ Android ä¸Šé¦–æ¬¡èšç„¦è¾“å…¥æ¡†æ—¶ï¼Œä¼šå¤±ç„¦ï¼ˆè‡ªåŠ¨æ”¶èµ·é”®ç›˜ï¼‰ã€‚</p>
<blockquote>
<p>å¤–éƒ¨åŸå› ï¼Œæ— æ³•è§£å†³ï¼Œä¸è€ƒè™‘è®¾ç½® show-confirm-barã€‚</p>
</blockquote>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/0006eea86ec8f0d4b21c31aa85b800?highLine=show-confirm-bar">textareaï¼šshow-confirm-bar=&quot;false&quot; å¤±å»ç„¦ç‚¹ï¼Ÿ</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/000ce2547e8b1875233ce289f56400?highLine=show-confirm-bar">textarea ç»„ä»¶ä½¿ç”¨ show-confirm-bar=&quot;{{false}}&quot; æ—¶é¦–æ¬¡èšç„¦ä¼šå¤±ç„¦ï¼Ÿ</a></li>
</ul>
<h2>2. auto-height é—®é¢˜</h2>
<p><code>auto-height=&quot;{{true}}&quot;</code> ä½œç”¨æ˜¯æ ¹æ®å†…å®¹è‡ªé€‚åº”é«˜åº¦ï¼Œä»¥æé«˜ç”¨æˆ·ä½“éªŒã€‚</p>
<p>å®é™…ä¸Šï¼Œç”¨æˆ·ä½“éªŒæ²¡æé«˜ï¼Œå€’æ˜¯æé«˜äº†å¼€å‘è€…çš„å¼€å‘éš¾åº¦ã€‚</p>
<p>è¿˜æ˜¯ Android æœºå‹çš„é—®é¢˜ï¼Œåœ¨å¤±ç„¦ä¹‹å textarea ä¼šå¤šäº†ä¸€å¤§éƒ¨åˆ†çš„ç©ºç™½éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>æŠ˜ä¸­å¤„ç†ï¼šå»æ‰ <code>auto-height</code> å±æ€§ï¼Œä½¿ç”¨ CSS æ§åˆ¶ <code>min-height</code> å±æ€§ã€‚</p>
</blockquote>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/00080ea90f44f864466b1d91b5b400?highLine=auto-height%2520%25E7%259A%2584%25E9%2597%25AE%25E9%25A2%2598">textarea è®¾ç½® auto-height è¶…å‡ºä¸€å±åæ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ</a></li>
</ul>
<h2>3. disable-default-padding é—®é¢˜</h2>
<p>é€šå¸¸ï¼Œè®¾è®¡ç¨¿è¦æ±‚è¾“å…¥æ¡†å†…å®¹ä¸å…¶ä»–æ–‡æœ¬éƒ½æ˜¯å·¦å¯¹é½ã€‚</p>
<p>ä½†ç”±äº iOS ä¸Šä¼šæœ‰é»˜è®¤çš„å†…è¾¹è·ï¼Œå³ä¾¿è®¾ç½®äº† <code>padding-left</code> ç­‰å±æ€§ä¹Ÿæ˜¯æ— æ³•æ¶ˆé™¤çš„ã€‚</p>
<blockquote>
<p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ <code>disable-default-padding=&quot;{{true}}&quot;</code>ã€‚</p>
</blockquote>
<h2>4. textarea åŸç”Ÿç»„ä»¶é—®é¢˜</h2>
<p>ç”±äº<a href="https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html">åŸç”Ÿç»„ä»¶</a>çš„ç‰¹æ€§ï¼Œåœ¨æ”¯æŒ<strong>åŸç”Ÿç»„ä»¶åŒå±‚æ¸²æŸ“</strong>ä¹‹å‰ï¼Œtextarea ç­‰åŸç”Ÿç»„ä»¶å±‚çº§æ˜¯æœ€é«˜çš„ï¼Œæ— è®ºå…¶ä»–æ ‡ç­¾çš„ <code>z-index</code> æœ‰å¤šå¤§ï¼Œå‡æ— æ³•è¦†ç›–åŸç”Ÿç»„ä»¶ã€‚</p>
<p>å”¯ä¸€è§£å†³çš„æ–¹æ³•æ˜¯ä½¿ç”¨ cover-viewã€cover-image ç­‰ç»„ä»¶åŒ…è£¹åŸç”Ÿç»„ä»¶ï¼Œä½†æ˜¯æœ¬èº« cover-view ç­‰å°±ä¸€èº«æ¯›ç—…ï¼Œæ¯«æ— å¼€å‘ä½“éªŒã€‚</p>
<blockquote>
<p>å…³äºåŸç”Ÿç»„ä»¶ï¼Œå¯çœ‹æ–‡æ¡£ <a href="https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html">native-component</a>ã€‚</p>
</blockquote>
<p>ç»“åˆä»¥ä¸Šé—®é¢˜ï¼Œäºæ˜¯æ”¹æˆè¿™æ ·å­ï¼š</p>
<pre><code class="language-html">&lt;textarea
  name=&quot;address&quot;
  id=&quot;address&quot;
  rows=&quot;3&quot;
  bindinput=&quot;onInput&quot;
  bindblur=&quot;onBlur&quot;
  bindfocus=&quot;onFocus&quot;
  class=&quot;textarea&quot;
  value=&quot;{{address}}&quot;
  placeholder-class=&quot;input-placeholder&quot;
  placeholder=&quot;è¯·è¾“å…¥åœ°å€&quot;
  confirm-type=&quot;done&quot;
  disable-default-padding=&quot;{{true}}&quot;
  cursor-spacing=&quot;50&quot;
  maxlength=&quot;60&quot;
/&gt;
</code></pre>
<h2>5. å½“ fixed å…ƒç´ ç¢°ä¸Šè¾“å…¥æ¡†</h2>
<p>åœ¨äº§å“ä¸Šè¦æ±‚ï¼Œèšç„¦æ—¶è¾“å…¥æ¡†è¦åœ¨å¯è§†èŒƒå›´å†…ï¼Œè¾“å…¥æ¢è¡Œæ—¶ä¹Ÿå¯ä»¥ä¸Šæ¨é¡µé¢ã€‚å¾ˆå¥½ï¼Œæœ‰å±æ€§ adjust-position æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚</p>
<p>ä¸€ä¸ªè¡¨å•é¡µï¼Œæœ‰ N ä¸ªè¡¨å•é¡¹ï¼Œåº•éƒ¨ä¸€ä¸ª fixed çš„æ‚¬æµ®æäº¤æŒ‰é’®ï¼Œè¿™æ˜¯éå¸¸å¸¸è§çš„è®¾è®¡ç¨¿ã€‚</p>
<h3>é—®é¢˜ä¸€</h3>
<p>å‡è®¾æäº¤æŒ‰é’®å¤„äº textarea ä¸Šæ–¹ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œä½ ä¼šå‘ç° textarea çš„ focus äº‹ä»¶ä¹Ÿè¢«è§¦å‘äº†ã€‚</p>
<p>å°è¯•ä½¿ç”¨ catch äº‹ä»¶ä¹Ÿæ— æ³•é˜»æ­¢è¿™ç§äº‹ä»¶ç©¿é€ç°è±¡ï¼Œæ¯•ç«Ÿæäº¤æŒ‰é’®ä¸æ˜¯ textarea çš„åä»£å…ƒç´ ï¼Œæ‰€ä»¥é˜»æ­¢å†’æ³¡ä¸èµ·ä½œç”¨ä¹Ÿæ˜¯åˆç†çš„ã€‚</p>
<blockquote>
<p>è§£å†³æ–¹æ³•ï¼šåœ¨æäº¤æŒ‰é’®ä¸‹æ–¹ fixed ä¸€ä¸ª disabled çš„ textareaã€‚</p>
</blockquote>
<h3>é—®é¢˜äºŒ</h3>
<p>å½“èšç„¦è¾“å…¥æ¡†æ—¶ï¼š</p>
<ul>
<li>iOS é¡µé¢æ•´ä½“ä¸Šæ¨ï¼ˆåŒ…æ‹¬ fixed çš„å…ƒç´ ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¾“å…¥æ¢è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šçœ‹åˆ°â€œå†‰å†‰å‡èµ·â€çš„æäº¤æŒ‰é’®ï¼ŒæŒ¡ä½äº†è¾“å…¥æ¡†çš„å†…å®¹ã€‚</li>
<li>Android ä¸Šè¡¨ç°çœ‹ä¼¼æ²¡å•¥é—®é¢˜ï¼Œé¡µé¢ä¼šä¸Šæ¨ï¼Œä½† fixed å…ƒç´ ä¸ä¼šè·Ÿç€ä¸Šæ¥ã€‚</li>
</ul>
<blockquote>
<p>è§£å†³æ–¹æ³•ï¼šåœ¨ iOS è®¾å¤‡èšç„¦æ—¶éšè—æŒ‰é’®ï¼Œå¤±ç„¦åå†æ˜¾ç¤ºã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åºçš„è¸©å‘è¿‡ç¨‹...]]></title>
            <link>https://github.com/toFrankie/blog/issues/303</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/303</guid>
            <pubDate>Fri, 10 Mar 2023 02:22:16 GMT</pubDate>
            <description><![CDATA[<h2>èƒŒæ™¯</h2>
<p>è¿‘æœŸï¼Œé¡¹ç›®ä¸­æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å¾®ä¿¡å°ç¨‹åºçš„éœ€æ±‚ï¼Œæ‰€ä»¥æ•´ç†äº†ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œå”¤èµ·å¾®ä¿¡å°ç¨‹åºçš„å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>æ‰«å°ç¨‹åºç </p>
</li>
<li>
<p>æ‰«å°ç¨‹åºäºŒç»´ç ï¼Œå¯æ»¡è¶³ä¸åŒéœ€æ±‚å’Œåœºæ™¯ï¼Œä¾‹å¦‚ä¸šåŠ¡ä¸­éœ€è¦è®°å½•æ¸ é“å‚æ•°ç­‰ã€‚è¯¥äºŒç»´ç å¯é€š]]></description>
            <content:encoded><![CDATA[<h2>èƒŒæ™¯</h2>
<p>è¿‘æœŸï¼Œé¡¹ç›®ä¸­æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å¾®ä¿¡å°ç¨‹åºçš„éœ€æ±‚ï¼Œæ‰€ä»¥æ•´ç†äº†ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œå”¤èµ·å¾®ä¿¡å°ç¨‹åºçš„å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>æ‰«å°ç¨‹åºç </p>
</li>
<li>
<p>æ‰«å°ç¨‹åºäºŒç»´ç ï¼Œå¯æ»¡è¶³ä¸åŒéœ€æ±‚å’Œåœºæ™¯ï¼Œä¾‹å¦‚ä¸šåŠ¡ä¸­éœ€è¦è®°å½•æ¸ é“å‚æ•°ç­‰ã€‚è¯¥äºŒç»´ç å¯é€šè¿‡å¾®ä¿¡æä¾›çš„æ¥å£ç”Ÿæˆï¼Œè¯¦æƒ…çœ‹<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html#%E8%8E%B7%E5%8F%96%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%8C%E7%BB%B4%E7%A0%81%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%EF%BC%89">è·å–å°ç¨‹åºäºŒç»´ç </a></p>
</li>
<li>
<p>H5 é¡¹ç›®å”¤èµ·å°ç¨‹åºï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­ï¼Œåªèƒ½é€šè¿‡ <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html">wx-open-launch-weapp</a> æ ‡ç­¾å”¤èµ·ï¼Œå¯å‚è€ƒæ–‡ç« <a href="https://github.com/toFrankie/blog/issues/153">å…³äº React ä¸­ä½¿ç”¨ wx-open-launch-weapp å”¤èµ·å¾®ä¿¡å°ç¨‹åº</a>ï¼Œé€‚ç”¨äºå…¬ä¼—å·ç½‘é¡µæˆ–è€…æ´»åŠ¨ç­‰æ‰“å¼€å°ç¨‹åºçš„åœºæ™¯ã€‚</li>
<li>æ™®é€šæµè§ˆå™¨ï¼ˆå¦‚Safariã€UCã€ç³»ç»Ÿè‡ªå¸¦æµè§ˆå™¨ç­‰ï¼‰ï¼Œå¯é€šè¿‡ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/url-scheme.html">URL Scheme æ‰“å¼€å°ç¨‹åº</a>æ–¹å¼å”¤èµ·ï¼Œéœ€è‡ªè¡Œç¼–å†™ H5 å®ç°ï¼Œä½¿ç”¨äºçŸ­ä¿¡æ¨é€ç­‰åœºæ™¯ã€‚</li>
<li>å¾®ä¿¡å°ç¨‹åºå­˜åœ¨ç«äº‰å…³ç³»çš„çš„ Appï¼Œä»¥ä¸Šæ–¹å¼å‡æ— æ³•å”¤èµ·ï¼Œä½ æ‡‚çš„ã€‚</li>
</ul>
</li>
<li>
<p>æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åºï¼ˆæœ¬æ–‡ä»‹ç»çš„å¯¹è±¡ï¼‰ã€‚ç™»å½•å°ç¨‹åºåå°ï¼Œè¿›å…¥â€œ<strong>è®¾ç½® â€” å¼€å‘è®¾ç½® â€” æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åº</strong>â€ï¼Œå¼€å¯åŠŸèƒ½åå³å¯é…ç½®äºŒç»´ç è§„åˆ™ã€‚è¿™ç§æ–¹å¼é…ç½®ç®€å•ã€çµæ´»ï¼Œä¸”æ— éœ€è‡ªè¡Œå¼€å‘ H5 é¡¹ç›®ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>wx-open-launch-weapp</code> éœ€åœ¨å¾®ä¿¡å®¢æˆ·ç«¯æ–¹å¯æœ‰æ•ˆã€‚<code>URL Scheme</code> æ–¹å¼ä»…å¯åœ¨æ™®é€šæµè§ˆå™¨ä¸­å”¤èµ·ã€‚è¿™ä¸¤ç§éƒ½éœ€è¦è‡ªè¡Œå®ç° H5ã€‚<code>æ™®é€šé“¾æ¥äºŒç»´ç </code> æ”¯æŒä½¿ç”¨å¾®ä¿¡æ‰«ä¸€æ‰«æˆ–å¾®ä¿¡å†…é•¿æŒ‰è¯†åˆ«äºŒç»´ç è·³è½¬å°ç¨‹åºã€‚</p>
</blockquote>
<h2>æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åº</h2>
<p>ä¸‹é¢åªä¼šä»‹ç»æˆ–è€…å¼ºè°ƒï¼Œä¸€äº›è¸©å‘ç‚¹ã€å®¹æ˜“å¿½ç•¥çš„åœ°æ–¹ï¼Œæ›´å¤šçœ‹<a href="https://developers.weixin.qq.com/miniprogram/introduction/qrcode.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<blockquote>
<p>æ³¨ï¼šè§„åˆ™å¯èƒ½éšæ—¶å‘ç”Ÿæ”¹å˜ï¼Œä»¥å®˜æ–¹ä¸ºå‡†ã€‚</p>
</blockquote>
<ol>
<li>
<p>å¯¹äºæ™®é€šé“¾æ¥äºŒç»´ç ï¼Œç›®å‰æ”¯æŒä½¿ç”¨<strong>å¾®ä¿¡æ‰«ä¸€æ‰«</strong>æˆ–<strong>å¾®ä¿¡å†…é•¿æŒ‰è¯†åˆ«äºŒç»´ç </strong>è·³è½¬å°ç¨‹åºã€‚</p>
</li>
<li>
<p>è¯¥åŠŸèƒ½æš‚ä¸æ”¯æŒ<strong>ä¸ªäººç±»å‹å°ç¨‹åº</strong>ã€‚</p>
</li>
<li>
<p>äºŒç»´ç è·³è½¬è§„åˆ™å…¶ä¸­ä¸€æ¡éœ€è¦æ³¨æ„çš„ï¼šå¦‚éœ€æ”¯æŒå­è·¯å¾„åŒ¹é…ï¼Œè¯·ç¡®è®¤åå°é…ç½®çš„äºŒç»´ç è§„åˆ™ä»¥ <code>/</code> ç»“å°¾ã€‚</p>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">åå°å·²é…ç½®çš„äºŒç»´ç è§„åˆ™</th>
<th style="text-align:center">çº¿ä¸‹äºŒç»´ç å®Œæ•´é“¾æ¥</th>
<th>é”™è¯¯åŸå› </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>https://www.qq.com/a/b</code></td>
<td style="text-align:center"><code>https://www.qq.com/a/b/123</code></td>
<td>è§„åˆ™æ²¡æœ‰ä»¥ <code>/</code> ç»“å°¾ï¼Œä¸æ”¯æŒå­è·¯å¾„åŒ¹é…</td>
</tr>
</tbody>
</table>
<ol start="4">
<li>å¸¦å‚å–å‚çš„é—®é¢˜ï¼š</li>
</ol>
<p>å‡è®¾æˆ‘ä»¬æ‰€è¦æ‰“å¼€å°ç¨‹åºçš„è·¯å¾„ä¸º <code>pages/index/index</code>ï¼Œéœ€è¦æºå¸¦å‚æ•° <code>channel</code> å­—æ®µï¼Œè‹¥é…ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c64bdae4f9168d73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å›¾ä¸­äºŒç»´ç è§„åˆ™çš„åŸŸåæ˜¯ä¹±å†™çš„ï¼Œè‡ªè¡Œæ”¹æˆåä¸‹æœåŠ¡å™¨å¹¶æ ¡éªŒå³å¯ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªç¬¦åˆè§„åˆ™çš„é“¾æ¥ï¼š<code>https://www.qq.com/test?channel=123</code>ï¼Œè¿™ä¹Ÿæ»¡è¶³äº†æˆ‘ä»¬æºå¸¦ <code>channel</code> å‚æ•°çš„éœ€æ±‚ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶å®ƒå·¥å…·å°†è¯¥é“¾æ¥ç”ŸæˆäºŒç»´ç æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>å¦‚ä¸ç¡®å®šè‡ªå·±ç¼–å†™çš„é“¾æ¥æ˜¯å¦æ»¡è¶³è§„åˆ™ï¼Œå¯åœ¨é…ç½®é¡¹çš„<strong>æµ‹è¯•é“¾æ¥</strong>ä¸­å¡«å†™ï¼Œè‹¥ä¸ç¬¦åˆè§„åˆ™ï¼Œä¼šæœ‰æç¤ºä»¥åŠæ— æ³•ä¿å­˜æˆåŠŸã€‚</p>
</blockquote>
<p><strong>å¦‚ä½•è·å–è¯¥å‚æ•°å‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬äºŒç»´ç çš„é“¾æ¥å†…å®¹ä¼šä»¥å‚æ•° <code>q</code> çš„å½¢å¼å¸¦ç»™é¡µé¢ã€‚å¯åœ¨ <code>App.onLaunch</code>ã€<code>App.onShow</code>ã€<code>Page.onLoad</code> ä¸­å–å‡ºæ¥ï¼Œè¿˜éœ€è¦è‡ªè¡Œ <code>decodeURIComponent</code> ä¸€ä¸‹ï¼Œæ‰æ˜¯åŸäºŒç»´ç çš„å®Œæ•´å†…å®¹ã€‚</p>
<pre><code class="language-js">// app.js
App({
  onLaunch(options) {
    console.log(options)
    // {
    //   mode: 'default',
    //   path: 'pages/index/index',
    //   query: {
    //     q: 'https%3A%2F%2Fwww.qq.com%2Ftest%3Fchannel%3D123',
    //     scancode_time: '1615973269',
    //   },
    //   referrerInfo: {
    //     scene: 1011
    //   }
    // }
  }
})


// index.js
Page({
 onLoad(options) {
    console.log(options)
    // {
    //   q: 'https%3A%2F%2Fwww.qq.com%2Ftest%3Fchannel%3D123',
    //   scancode_time: '1615973269'
    // }
  }
})
</code></pre>
<ol start="5">
<li>
<p>å°ç¨‹åºå¿…é¡»å…ˆå‘å¸ƒä»£ç æ‰å¯ä»¥å‘å¸ƒäºŒç»´ç è·³è½¬è§„åˆ™ã€‚ä¸€ä¸ªå°ç¨‹åºå¸å·ä¸€ä¸ªæœˆå¯å‘å¸ƒä¸å¤šäº 20 æ¬¡äºŒç»´ç è·³è½¬è§„åˆ™ã€‚</p>
</li>
<li>
<p><strong>å¦‚ä½•åœ¨ä¸æå®¡çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ï¼Ÿ</strong></p>
</li>
</ol>
<p>å‡è®¾æˆ‘ä»¬å°ç¨‹åºå·²ç»ä¸Šçº¿ï¼Œä¸”ç›¸å…³è§„åˆ™å‘å¸ƒä¹‹åï¼Œæ‰«ç è¯¥é“¾æ¥ä¼šæ‰“å¼€çº¿ä¸Šç‰ˆæœ¬çš„å°ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰“å¼€å¼€å‘ç‰ˆï¼Œå°±è¦åœ¨<strong>æµ‹è¯•é“¾æ¥</strong>ä¸­ï¼Œå°†è¯¥é“¾æ¥é…ç½®å¹¶ä¿å­˜ï¼Œç„¶åé‡æ–°æ‰«ç å³å¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c147951fb794781c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol start="7">
<li>äºŒç»´ç é…ç½®è§„åˆ™å¿…é¡»å‘å¸ƒåç­‰å¾… 5 åˆ†é’Ÿä»¥åæ‰å¯ä»¥ä½¿ç”¨ã€‚ï¼ˆè¿™ä¸ªå‘æˆ‘æ²¡è¸©ï¼Œå› ä¸ºæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™è¿˜å¤„åœ¨è°ƒç ”é˜¶æ®µï¼Œå“ˆå“ˆï¼‰</li>
</ol>
<h2>References</h2>
<ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/introduction/qrcode.html">æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åº</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ”¯ä»˜å®å°ç¨‹åºè·å–ç”¨æˆ·æ‰‹æœºå·]]></title>
            <link>https://github.com/toFrankie/blog/issues/302</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/302</guid>
            <pubDate>Fri, 10 Mar 2023 02:21:43 GMT</pubDate>
            <description><![CDATA[<p>è®°å½•ä¸‹æ”¯ä»˜å®å°ç¨‹åºè·å–ä¼šå‘˜æ‰‹æœºå·çš„è¸©å‘è¿‡ç¨‹ã€‚</p>
<h3>ä½¿ç”¨é™åˆ¶</h3>
<ul>
<li><strong>åŸºç¡€åº“</strong>Â <a href="https://opendocs.alipay.com/mini/framework/lib">1.16.4</a>Â æˆ–æ›´é«˜ç‰ˆæœ¬ï¼›<strong>æ”¯ä»˜å®å®¢]]></description>
            <content:encoded><![CDATA[<p>è®°å½•ä¸‹æ”¯ä»˜å®å°ç¨‹åºè·å–ä¼šå‘˜æ‰‹æœºå·çš„è¸©å‘è¿‡ç¨‹ã€‚</p>
<h3>ä½¿ç”¨é™åˆ¶</h3>
<ul>
<li><strong>åŸºç¡€åº“</strong>Â <a href="https://opendocs.alipay.com/mini/framework/lib">1.16.4</a>Â æˆ–æ›´é«˜ç‰ˆæœ¬ï¼›<strong>æ”¯ä»˜å®å®¢æˆ·ç«¯</strong>Â 10.1.35 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè‹¥ç‰ˆæœ¬è¾ƒä½ï¼Œå»ºè®®é‡‡å–<a href="https://opendocs.alipay.com/mini/framework/compatibility">å…¼å®¹å¤„ç†</a>ã€‚</li>
<li>æ­¤ API æš‚ä»…æ”¯æŒ<strong>ä¼ä¸šæ”¯ä»˜å®è´¦æˆ·</strong>ä½¿ç”¨ã€‚</li>
<li>IDE æ¨¡æ‹Ÿå™¨æš‚ä¸æ”¯æŒè°ƒè¯•ï¼Œè¯·ä»¥çœŸæœºè°ƒè¯•ç»“æœä¸ºå‡†ã€‚</li>
<li>ç›®å‰è¯¥åŠŸèƒ½éœ€è¦åœ¨å¼€å‘è€…åå°å®Œæˆæ•æ„Ÿä¿¡æ¯ç”³è¯·æ‰å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå…¥å£ä¸º<strong>å¼€å‘ç®¡ç†</strong> &gt; <strong>åŠŸèƒ½åˆ—è¡¨</strong> &gt; <strong>æ·»åŠ åŠŸèƒ½</strong>Â &gt; <strong>è·å–ä¼šå‘˜æ‰‹æœºå·</strong> &gt; <strong>ç”¨æˆ·ä¿¡æ¯ç”³è¯·</strong>ï¼Œæ­¤åŠŸèƒ½éœ€è°¨æ…ä½¿ç”¨ï¼Œè‹¥æ”¯ä»˜å®å‘ç°ä¿¡æ¯å­˜åœ¨è¶…å‡ºçº¦å®šèŒƒå›´ä½¿ç”¨æˆ–è€…ä¸åˆç†ä½¿ç”¨ç­‰æƒ…å†µï¼Œæ”¯ä»˜å®æœ‰æƒæ°¸ä¹…å›æ”¶è¯¥å°ç¨‹åºçš„è¯¥æ¥å£æƒé™ã€‚</li>
<li>éœ€è¦å°†Â <code>&lt;button&gt;</code>Â ç»„ä»¶Â <code>open-type</code>Â çš„å€¼è®¾ç½®ä¸ºÂ <code>getAuthorize</code>ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¹¶åŒæ„ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>my.getPhoneNumber()</code>Â æ¥å£è·å–åˆ°æ”¯ä»˜å®æœåŠ¡å™¨è¿”å›çš„åŠ å¯†æ•°æ®ï¼Œ ç„¶ååœ¨ç¬¬ä¸‰æ–¹æœåŠ¡ç«¯ç»“åˆç­¾åç®—æ³•å’Œ AES å¯†é’¥è¿›è¡Œè§£å¯†è·å–æ‰‹æœºå·ï¼Œæ–¹æ³•è¯¦è§<a href="https://opendocs.alipay.com/mini/2019110100244259">æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ–¹æ³•</a>ï¼Œè‹¥ç”¨æˆ·æœªæˆæƒï¼Œç›´æ¥è°ƒç”¨<code>my.getPhoneNumber()</code>Â æ¥å£ï¼Œåˆ™æ— æ³•è¿”å›æ­£ç¡®ä¿¡æ¯ã€‚</li>
</ul>
<h3>é…ç½®å·¥ä½œ</h3>
<ul>
<li>
<p>è¯·æ£€æŸ¥å°ç¨‹åºåå°å·²æ·»åŠ <strong>è·å–ä¼šå‘˜æ‰‹æœºå·</strong>åŠŸèƒ½åŒ…ï¼Œå¹¶å·²åœ¨<strong>éšç§å†…å®¹ç”³è¯·</strong>ä¸­<strong>ç”³è¯·æ‰‹æœºå·</strong>ï¼ˆè‹¥åœ¨å°ç¨‹åºåå°çœ‹ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ç”³è¯·çš„å…¥å£ï¼Œè¯·ä½¿ç”¨ä¸»è´¦å·ç™»å½•ï¼‰ã€‚ç”³è¯·è·¯å¾„ä¸ºï¼š<strong>å°ç¨‹åºåå°</strong> &gt; <strong>å¼€å‘ç®¡ç†</strong> &gt; <strong>åŠŸèƒ½åˆ—è¡¨æ·»åŠ åŠŸèƒ½</strong> &gt; <strong>è·å–ä¼šå‘˜æ‰‹æœºå·</strong> &gt; <strong>ç”¨æˆ·ä¿¡æ¯ç”³è¯·</strong>ã€‚</p>
</li>
<li>
<p>è¯·ç¡®ä¿å·²åœ¨<strong>å°ç¨‹åºåå°</strong> &gt; <strong>è®¾ç½®</strong> &gt; <strong>å¼€å‘è®¾ç½®</strong>ä¸­ï¼Œè®¾ç½®<strong>æ”¯ä»˜å®å…¬é’¥</strong>ã€<strong>aes å¯†é’¥</strong>ã€<strong>åº”ç”¨ç½‘å…³</strong>ã€‚aes ç›¸å…³ä¿¡æ¯å¯å‚è§<a href="https://opendocs.alipay.com/mini/2019110100244259">å†…å®¹åŠ å¯†æ¥å…¥æŒ‡å¼•</a>ã€‚(è‹¥ç¼ºå¤±è¿™ä¸‰ä¸ªè®¾ç½®ï¼Œåœ¨è°ƒç”¨ <code>my.getPhoneNumber()</code> æ—¶å¯èƒ½åªè¿”å› <code>response</code> ä¸ä¼šè¿”å› <code>sign</code>)ã€‚</p>
</li>
</ul>
<h3>å‰ç«¯å·¥ä½œ</h3>
<p><a href="https://opendocs.alipay.com/mini/api/getphonenumber">my.getPhoneNumber</a> æ˜¯è·å–æ”¯ä»˜å®ç”¨æˆ·ç»‘å®šçš„æ‰‹æœºå· APIã€‚å› ä¸ºéœ€è¦ç”¨æˆ·ä¸»åŠ¨è§¦å‘æ‰èƒ½å‘èµ·è·å–æ‰‹æœºå·ï¼Œæ‰€ä»¥è¯¥åŠŸèƒ½ä¸ç”± API ç›´æ¥è°ƒç”¨ï¼Œéœ€ç”¨Â <a href="https://opendocs.alipay.com/mini/component/button">button ç»„ä»¶</a>Â çš„ç‚¹å‡»æ¥è§¦å‘ã€‚</p>
<pre><code class="language-html">&lt;button
  open-type=&quot;getAuthorize&quot;
  scope=&quot;phoneNumber&quot;
  onGetAuthorize=&quot;getPhoneNumber&quot;
  onError=&quot;getPhoneNumberError&quot;
&gt;
  è·å–æ‰‹æœºå·ç 
&lt;/button&gt;
</code></pre>
<pre><code class="language-js">Page({
  /**
   * è·å–æ‰‹æœºå·ç ï¼Œç”¨æˆ·ç‚¹å‡»å¹¶åŒæ„å›è°ƒå‡½æ•°
   *
   * @param {object} e æˆæƒæˆåŠŸå›è°ƒä¿¡æ¯ { type: 'getAuthorize', target, currentTarget, timeStamp }
   */
  async getPhoneNumber(e) {
    my.getPhoneNumber({
      success: res =&gt; {
        // è·å–åˆ°æ”¯ä»˜å®æœåŠ¡å™¨è¿”å›çš„åŠ å¯†æ•°æ®
        // å…¶ä¸­ response ä¸º JSON å­—ç¬¦ä¸²ï¼Œç»“æ„ä¸ºï¼š'{&quot;response&quot;:&quot;xxxxx&quot;,&quot;sign&quot;:&quot;xxx&quot;}'
        const { respone, ariverRpcTraceId } = res

        // å°†åŠ å¯†æ•°æ®ä¼ ç»™åç«¯ï¼Œç»“åˆç­¾åç®—æ³•å’ŒAESå¯†é’¥è¿›è¡Œè§£å¯†è·å–æ‰‹æœºå·
        my.request({
          url: 'åç«¯æœåŠ¡ç«¯ URL',
          data: respone,
          success: res =&gt; {
            // è§£å¯†æˆåŠŸè¿”å›
          },
          fail: err =&gt; {
            console.warn('my.request fail: ', err)
          }
        })
      },
      fail: err =&gt; {
        console.warn('my.getPhoneNumber fail: ', err)
      }
    })
  },

  /**
   * è·å–æ‰‹æœºå·å¼‚å¸¸ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ‹’ç»å’Œç³»ç»Ÿå¼‚å¸¸
   * @param {object} e æˆæƒå¤±è´¥å›è°ƒä¿¡æ¯
   */
  getPhoneNumberError(e) {
    console.warn('getPhoneNumberError fail: ', e)
    // å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š
    // {
    //   type: 'error',
    //   timeStamp: 1610937854940,
    //   target: {
    //     targetDataset: {},
    //     tagName: 'button',
    //     dataset: {}
    //   },
    //   currentTarget: {
    //     tagName: 'button',
    //     dataset: {}
    //   },
    //   detail: {
    //     errorMessage: 'ç”¨æˆ·å–æ¶ˆæˆæƒ',
    //     type: 'getAuthorize'
    //   }
    // }
  }
})
</code></pre>
<h3>åç«¯è§£å¯†</h3>
<p>ç”±äºå¯¹åç«¯ä¸æ˜¯å¾ˆäº†è§£ï¼Œå…·ä½“çœ‹<a href="https://opendocs.alipay.com/mini/2019110100244259">å†…å®¹åŠ å¯†æŒ‡å¼•</a>ã€‚</p>
<h3>å¸¸è§é—®é¢˜</h3>
<ol>
<li>è°ƒç”¨ <code>my.getPhoneNumber()</code>ï¼ŒæŠ¥é”™ <code>isv.insufficient-isv-permissionsï¼ˆISV æƒé™ä¸è¶³ï¼‰</code>ã€‚</li>
</ol>
<pre><code class="language-json">{
  &quot;code&quot;:&quot;40006&quot;,
  &quot;msg&quot;:&quot;Insufficient Permissions&quot;,
  &quot;subCode&quot;:&quot;isv.insufficient-isv-permissions&quot;,
  &quot;subMsg&quot;:&quot;ISVæƒé™ä¸è¶³ï¼Œå»ºè®®åœ¨å¼€å‘è€…ä¸­å¿ƒæ£€æŸ¥å¯¹åº”åŠŸèƒ½æ˜¯å¦å·²ç»æ·»åŠ ï¼Œè§£å†³åŠæ³•è¯¦è§ï¼šhttps://docs.open.alipay.com/common/isverror&quot;
}
</code></pre>
<p>åŸå› å¯èƒ½æ˜¯ï¼Œæ²¡æœ‰æ·»åŠ **â€œè·å–ä¼šå‘˜æ‰‹æœºå·â€<strong>åŠŸèƒ½åŒ…æˆ–è€…æ²¡æœ‰</strong>â€œç”³è¯·ç”¨æˆ·ä¿¡æ¯â€**ã€‚
è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li>åœ¨<a href="https://openhome.alipay.com/mini/dev/list">å°ç¨‹åºå¼€å‘ç®¡ç†åå°</a>çš„<strong>èƒ½åŠ›åˆ—è¡¨</strong>ä¸­ï¼Œç‚¹å‡»<strong>æ·»åŠ èƒ½åŠ›</strong>ï¼›</li>
<li>æ·»åŠ <strong>è·å–ä¼šå‘˜æ‰‹æœºå·</strong>åŠŸèƒ½åŒ…ï¼›</li>
<li>ç‚¹å‡»<strong>ç”¨æˆ·ä¿¡æ¯ç”³è¯·</strong>ï¼›ï¼ˆè¿™ä¸€æ­¥ä¸èƒ½å¿½ç•¥ï¼‰</li>
<li>åœ¨<strong>ç”³è¯·æƒé™</strong>ä¸­ç”³è¯·ç”¨æˆ·æ‰‹æœºå·ï¼›</li>
<li>å¡«å†™ç”³è¯·åŸå› ã€ä½¿ç”¨åœºæ™¯ç­‰ä¿¡æ¯ï¼Œæäº¤ç”³è¯·ï¼Œç­‰å¾…å®¡æ ¸ã€‚</li>
</ol>
<blockquote>
<p>å…³äºæ·»åŠ äº†ç›¸å…³èƒ½åŠ›ä¹‹åï¼Œæ²¡æœ‰**â€œç”¨æˆ·ä¿¡æ¯ç”³è¯·â€**çš„å…¥å£ï¼Œå¯ä»¥çœ‹<a href="https://opensupport.alipay.com/support/helpcenter/142/201602633683?ant_source=zsearch">è¿™é‡Œ</a>ã€‚</p>
<p>æˆ‘å°±é‡åˆ°è¿‡è¿™ä¸ªå‘ï¼Œæ˜¯å°ç¨‹åºä¸€äº›åŸºç¡€ä¿¡æ¯æœªè®¾ç½®ï¼Œå®Œå–„ä¿¡æ¯ä¿å­˜ä¹‹åï¼Œå…¥å£å°±å‡ºæ¥äº†ã€‚</p>
</blockquote>
<h3>ç›¸å…³é“¾æ¥</h3>
<ul>
<li><a href="https://opendocs.alipay.com/mini/api/getphonenumber">my.getPhoneNumber API</a></li>
<li><a href="https://opendocs.alipay.com/mini/api/dwou7f">è·å–ä¼šå‘˜æ‰‹æœºå· FAQ</a></li>
<li><a href="https://opendocs.alipay.com/mini/introduce/getphonenumber">è·å–ä¼šå‘˜æ‰‹æœºå·</a></li>
<li><a href="https://opensupport.alipay.com/support/helpcenter/142/201602633683?ant_source=zsearch">ç”¨æˆ·ä¿¡æ¯ç”³è¯·å…¥å£ä¸æ˜¾ç¤º</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åºæ‰«ç åŠ è½½çš„åŒºåˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/301</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/301</guid>
            <pubDate>Fri, 10 Mar 2023 02:20:56 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘ï¼Œé¡¹ç›®è¦è°ƒæ•´è·å–å°ç¨‹åºæ¸ é“çš„æ–¹å¼ï¼Œäºæ˜¯è®°å½•ä¸€ä¸‹æœ‰äº›å¿˜æ‰æˆ–è€…ä¸ç¡®å®šçš„ä¸œè¥¿ï¼š</p>
<h3>å¾®ä¿¡å°ç¨‹åº</h3>
<p><strong>åœºæ™¯ä¸€</strong>ï¼šå…ˆåæ‰«åŒä¸€ä¸ªæˆ–è€…ä¸åŒçš„äºŒç»´ç ã€‚</p>
<ol>
<li>é€šè¿‡ã€å¼€å‘å·¥å…· - é¢„è§ˆã€‘æ–¹å¼ã€‚</li>
</ol>
<blockquote>
<p>ç¬¬äºŒ]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘ï¼Œé¡¹ç›®è¦è°ƒæ•´è·å–å°ç¨‹åºæ¸ é“çš„æ–¹å¼ï¼Œäºæ˜¯è®°å½•ä¸€ä¸‹æœ‰äº›å¿˜æ‰æˆ–è€…ä¸ç¡®å®šçš„ä¸œè¥¿ï¼š</p>
<h3>å¾®ä¿¡å°ç¨‹åº</h3>
<p><strong>åœºæ™¯ä¸€</strong>ï¼šå…ˆåæ‰«åŒä¸€ä¸ªæˆ–è€…ä¸åŒçš„äºŒç»´ç ã€‚</p>
<ol>
<li>é€šè¿‡ã€å¼€å‘å·¥å…· - é¢„è§ˆã€‘æ–¹å¼ã€‚</li>
</ol>
<blockquote>
<p>ç¬¬äºŒæ¬¡æ‰«ç ï¼Œä¼šé‡æ–°åŠ è½½å°ç¨‹åºï¼Œä¼šè§¦å‘ <code>App.onLaunch</code>ã€<code>App.onShow</code>ã€<code>Page.onLoad</code> ç­‰æ–¹æ³•ã€‚</p>
</blockquote>
<ol start="2">
<li>æ‰«æçœŸæ­£çš„çº¿ä¸Šå°ç¨‹åºäºŒç»´ç </li>
</ol>
<blockquote>
<p>å®ƒä¸ä¼šè§¦å‘ <code>App.onLaunch</code>ï¼Œä½†ä¼šè§¦å‘ <code>App.onShow</code>ã€<code>Page.onLoad</code> ç­‰æ–¹æ³•ã€‚å¯é€šè¿‡ <code>App.onShow</code>ã€<code>Page.onLoad</code> é’©å­å¯ä»¥æ‹¿åˆ°æœ€æ–°ç çš„ä¸€äº›å‚æ•°ã€‚</p>
</blockquote>
<pre><code>// å‡å¦‚å½“å‰é¡µé¢ä¸º pages/xxx/xxxï¼Œç‚¹å‡»å³ä¸Šè§’æŒ‰é’®é€€å‡ºå°ç¨‹åºï¼Œæ¥ç€é‡æ–°æ‰«ç ï¼Œä¼šè§¦å‘ä»¥ä¸‹åŠ¨ä½œï¼š
pages/xxx/xxx: onHide have been invoked
App: onHide have been invoked
App: onShow have been invoked
On app route: pages/xxx/xxx
pages/xxx/xxx: onUnload have been invoked
Update view with init data
pages/xxx/xxx: onLoad have been invoked
pages/xxx/xxx: onShow have been invoked
Invoke event onReady in page: pages/xxx/xxx
pages/xxx/xxx: onReady have been invoked
...
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å°ç¨‹åºå°†å­—ç¬¦ä¸²ä¸­æ‰€æœ‰ '\\n' è½¬æ¢æˆ '\n']]></title>
            <link>https://github.com/toFrankie/blog/issues/300</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/300</guid>
            <pubDate>Fri, 10 Mar 2023 02:20:20 GMT</pubDate>
            <description><![CDATA[<p>å‡å¦‚æœ‰ä¸€ä¸ªé…ç½®çš„åŠŸèƒ½ï¼Œæ¥å£è¿”å›æ•°æ®å¦‚ä¸‹ï¼Œå…¶ä¸­ <code>\n</code> è¡¨ç¤ºæ¢è¡Œï¼Œå³åœ¨å‰ç«¯éœ€è¦æ¢è¡Œå±•ç¤ºã€‚</p>
<pre><code class="language-html">&lt;view style=&quot;white-space: pre-wrap&quot;&gt;{{message}}&]]></description>
            <content:encoded><![CDATA[<p>å‡å¦‚æœ‰ä¸€ä¸ªé…ç½®çš„åŠŸèƒ½ï¼Œæ¥å£è¿”å›æ•°æ®å¦‚ä¸‹ï¼Œå…¶ä¸­ <code>\n</code> è¡¨ç¤ºæ¢è¡Œï¼Œå³åœ¨å‰ç«¯éœ€è¦æ¢è¡Œå±•ç¤ºã€‚</p>
<pre><code class="language-html">&lt;view style=&quot;white-space: pre-wrap&quot;&gt;{{message}}&lt;/view&gt;
</code></pre>
<pre><code class="language-js">// æ¥å£æ•°æ®
const res = {
  code: 1000,
  body: {
    message: &quot;1. è§„åˆ™ä¸€\n2. è§„åˆ™äºŒ\n3. è§„åˆ™ä¸‰&quot;
  },
  msg: &quot;request:ok&quot;
}

this.setData({ message: res.body.message })
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºé‡Œé¢ç›´æ¥ setDate çš„è¯ï¼Œä¼šè¢«è½¬åŒ–ä¸º <code>'1. è§„åˆ™ä¸€\\n2. è§„åˆ™äºŒ\\n3. è§„åˆ™ä¸‰'</code> å¯¼è‡´æ— æ³•æ¢è¡Œã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ <code>replace(/\\n/g, '\n')</code> è½¬åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">const message = res.body.message.replace(/\\n/g, '\n')
this.setData({ message })
</code></pre>
<p>è¿™æ ·å°± OK äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åº onLaunch å‚æ•°å·®åˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/299</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/299</guid>
            <pubDate>Fri, 10 Mar 2023 02:19:29 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©åœ¨è°ƒæ•´å°ç¨‹åºé¡¹ç›®è·å–å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå‘ç°ä¸€ç›´ä»¥æ¥æœ‰ä¸ªå‚æ•°è®°é”™äº†ï¼Œæ‰€ä»¥æ•´ç†ä¸€ä¸‹å¾®ä¿¡ã€æ”¯ä»˜å®ã€ç™¾åº¦å°ç¨‹åºçš„ <code>App.onLaunch</code> å‚æ•°çš„å·®åˆ«ï¼Œå¤§ä½“ç›¸ä¼¼ï¼Œä½†è¿˜æ˜¯æœ‰ç»†å¾®çš„åŒºåˆ«ã€‚</p>
<h3>å¾®ä¿¡å°ç¨‹åº</h3>
<p><a href="https://developers.weixin]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©åœ¨è°ƒæ•´å°ç¨‹åºé¡¹ç›®è·å–å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå‘ç°ä¸€ç›´ä»¥æ¥æœ‰ä¸ªå‚æ•°è®°é”™äº†ï¼Œæ‰€ä»¥æ•´ç†ä¸€ä¸‹å¾®ä¿¡ã€æ”¯ä»˜å®ã€ç™¾åº¦å°ç¨‹åºçš„ <code>App.onLaunch</code> å‚æ•°çš„å·®åˆ«ï¼Œå¤§ä½“ç›¸ä¼¼ï¼Œä½†è¿˜æ˜¯æœ‰ç»†å¾®çš„åŒºåˆ«ã€‚</p>
<h3>å¾®ä¿¡å°ç¨‹åº</h3>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html">ç›¸å…³è¯´æ˜</a></p>
<pre><code class="language-js">{
  path: 'pages/handle/handle', // å¯åŠ¨å°ç¨‹åºçš„è·¯å¾„
  scene: '1037', // åœºæ™¯å€¼
  query: {
    // å¯åŠ¨å°ç¨‹åºçš„ query å‚æ•°
    // è‹¥æ²¡æœ‰å¯åŠ¨å‚æ•°ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡
    // ...
  },
  shareTicket: undefined, // string ç±»å‹ï¼Œè½¬å‘ä¿¡æ¯
  referrerInfo: {
    // æ¥æºä¿¡æ¯
    appId: '', // æ¥æºå°ç¨‹åºã€å…¬ä¼—å·æˆ–è€… App çš„ AppId
    extraData: {
      // æ¥æºå°ç¨‹åºä¼ è¿‡æ¥çš„æ•°æ®ï¼Œscene=1037 æˆ–è€… 1038 æ—¶æ”¯æŒ
      // ...
    }
  }
}
</code></pre>
<blockquote>
<p>è¿”å›æœ‰æ•ˆ <code>referrerInfo</code> çš„åœºæ™¯<a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html">æœ‰è¿™äº›</a>ã€‚</p>
</blockquote>
<h3>æ”¯ä»˜å®å°ç¨‹åº</h3>
<p><a href="https://opendocs.alipay.com/mini/framework/app-detail">ç›¸å…³è¯´æ˜</a></p>
<ul>
<li>å°ç¨‹åºé¦–æ¬¡å¯åŠ¨æ—¶ï¼Œ<code>App.onLaunch</code> æ–¹æ³•å¯è·å– <code>query</code>ã€<code>path</code> å±æ€§å€¼ã€‚</li>
<li>å°ç¨‹åºåœ¨åå°è¢«ç”¨ scheme æ‰“å¼€ï¼Œä¹Ÿå¯ä» <code>App.onShow</code> æ–¹æ³•ä¸­è·å– <code>query</code>ã€<code>path</code> å±æ€§å€¼ã€‚</li>
</ul>
<pre><code class="language-js">{
  path: 'pages/handle/handle', // å½“å‰å°ç¨‹åºçš„é¡µé¢åœ°å€ï¼Œä»å¯åŠ¨å‚æ•° page å­—æ®µè§£æè€Œæ¥ï¼Œpage å¿½ç•¥æ—¶é»˜è®¤ä¸ºé¦–é¡µã€‚
  scene: '1037', // åœºæ™¯å€¼
  query: {
    // å¯åŠ¨å°ç¨‹åºçš„ query å‚æ•°
    // è‹¥æ²¡æœ‰å¯åŠ¨å‚æ•°ï¼Œåˆ™ä¸ä¼šè¿”å› query å‚æ•°ã€‚è¿™ç‚¹è·Ÿå¾®ä¿¡å°ç¨‹åºæœ‰åŒºåˆ«
    // ...
  },
  referrerInfo: {
    // æ¥æºæ¶ˆæ¯
    appId: '', // æ¥æºå°ç¨‹åº
    sourceServiceId: '', // æ¥æºæ’ä»¶ï¼Œå½“å¤„äºæ’ä»¶è¿è¡Œæ¨¡å¼æ—¶å¯è§ã€‚ï¼ˆæ³¨æ„ï¼šåŸºç¡€åº“ 1.11.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼‰
    extraData: {
      // æ¥æºå°ç¨‹åºä¼ è¿‡æ¥çš„æ•°æ®ã€‚
      // ...
    }
  }
}
</code></pre>
<h3>ç™¾åº¦å°ç¨‹åº</h3>
<p><a href="https://smartprogram.baidu.com/docs/develop/framework/app_service_register/">ç›¸å…³è¯´æ˜</a></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç™¾åº¦å°ç¨‹åºä¹‹é—´è·³è½¬æ˜¯é€šè¿‡ <code>appKey</code> çš„ï¼Œæ‰€ä»¥è·å–åˆ°çš„ <code>referrerInfo.appId</code> ä¹Ÿæ˜¯æŒ‡ <code>appKey</code>ã€‚è¿™ç‚¹è·Ÿå¾®ä¿¡ã€æ”¯ä»˜å®å°ç¨‹åºæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
</blockquote>
<pre><code class="language-js">{
  path: 'pages/handle/handle', // æ‰“å¼€å°ç¨‹åºçš„è·¯å¾„ã€‚
  scene: '11700000', // æ‰“å¼€æ™ºèƒ½å°ç¨‹åºçš„åœºæ™¯å€¼ï¼Œscene å€¼ç»Ÿä¸€ç”±ç™¾åº¦å°ç¨‹åºåœºæ™¯å€¼ç®¡ç†ä¸­å¿ƒåœ¨ B ç«¯å¹³å°ç»Ÿä¸€é…ç½®åä¸‹å‘åˆ°å®¿ä¸»ï¼ˆä¾‹å¦‚ç™¾åº¦ Appï¼‰ï¼Œè°ƒèµ·åè®®ä¸­ä¼šæºå¸¦ç›¸åº”å…¥å£çš„ scene å€¼ã€‚
  query: {
    // æ‰“å¼€å½“å‰é¡µé¢è·¯å¾„ä¸­çš„å‚æ•°
    // ...
  },
  shareTicket: '', // æ ‡è®°è½¬å‘å¯¹è±¡
  referrerInfo: {
    // ä»å¦ä¸€ä¸ªå°ç¨‹åºæ‰“å¼€è¯¥å°ç¨‹åºæ—¶ï¼Œè¿”å›æ­¤å­—æ®µ
    appId: '', // æ¥æºå°ç¨‹åºçš„ appKey
    extraData: {
      // æ¥æºå°ç¨‹åºä¼ è¿‡æ¥çš„æ•°æ®
      // ...
    }
  }
}
</code></pre>
<h3>ä¸‰è€…çš„éƒ¨åˆ†åŒºåˆ«</h3>
<h5>1. query æ¥æºï¼š</h5>
<ul>
<li>å¾®ä¿¡å°ç¨‹åºçš„ <code>query</code> å‚æ•°æºäºæ‰€æ‰“å¼€é¡µé¢è·¯å¾„çš„å‚æ•°</li>
<li>æ”¯ä»˜å®å°ç¨‹åºæ˜¯åŒºåˆ†<strong>å…¨å±€å‚æ•°</strong>ä¸<strong>é¡µé¢å‚æ•°</strong>çš„ï¼Œå…¶ <code>query</code> å‚æ•°æºäºå‰è€…ã€‚</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-595d0719858c5b42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ”¯ä»˜å®å°ç¨‹åº"></p>
<h5>2. query å¯¹è±¡ï¼š</h5>
<ul>
<li>
<p>æ”¯ä»˜å®å°ç¨‹åº <code>App.onLaunch</code> çš„ <code>options.query</code> å‚æ•°ã€ <code>Page.onLoad</code> çš„ <code>options</code> å‚æ•°åº”è¯¥æ˜¯é€šè¿‡ <code>Object.create(null)</code> åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸èƒ½é€šè¿‡ <code>obj.constructor === Object</code> ï¼ˆç»“æœä¸º <code>false</code>ï¼‰æ¥åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹è±¡ç±»å‹ã€‚</p>
</li>
<li>
<p>å¾®ä¿¡å°ç¨‹åº <code>App.onLaunch</code> çš„ <code>options.query</code> å‚æ•°ã€ <code>Page.onLoad</code> çš„ <code>options</code> å‚æ•° <code>obj.constructor === Object</code> ï¼ˆç»“æœä¸º <code>true</code>ï¼‰</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¼€å¯ Chrome æµè§ˆå™¨çš„ä¸‹è½½æ°”æ³¡]]></title>
            <link>https://github.com/toFrankie/blog/issues/298</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/298</guid>
            <pubDate>Sat, 04 Mar 2023 06:41:37 GMT</pubDate>
            <description><![CDATA[<p>ä¸€ç›´ä»¥æ¥ï¼ŒChrome æµè§ˆå™¨æ–‡ä»¶ä¸‹è½½å·¥å…·æ éƒ½å­˜åœ¨äºåº•éƒ¨ï¼Œé™¤äº†ä¸ç¾è§‚ä¹‹å¤–ï¼Œè¿˜å ç”¨ç½‘é¡µç©ºé—´ã€‚</p>
<p>ä½ æœ‰æ²¡æœ‰å¾ˆç¾¡æ…•éš”å£ Microsoft Edge çš„ Download Hub ğŸ‘‡ï¼Œå´åˆä¸æƒ³ç¦»å¼€ Chromeã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/t]]></description>
            <content:encoded><![CDATA[<p>ä¸€ç›´ä»¥æ¥ï¼ŒChrome æµè§ˆå™¨æ–‡ä»¶ä¸‹è½½å·¥å…·æ éƒ½å­˜åœ¨äºåº•éƒ¨ï¼Œé™¤äº†ä¸ç¾è§‚ä¹‹å¤–ï¼Œè¿˜å ç”¨ç½‘é¡µç©ºé—´ã€‚</p>
<p>ä½ æœ‰æ²¡æœ‰å¾ˆç¾¡æ…•éš”å£ Microsoft Edge çš„ Download Hub ğŸ‘‡ï¼Œå´åˆä¸æƒ³ç¦»å¼€ Chromeã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1677910377682.gif" alt=""></p>
<p>ç°åœ¨ï¼ŒGoogle Chrome ä¹Ÿå¯ä»¥äº† ğŸ‘‡</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1677910556014.gif" alt=""></p>
<p>è¯¥åŠŸèƒ½å¯ä»¥è¿½æº¯åˆ° Chrome 102 Canary ç‰ˆæœ¬ï¼Œå½“æ—¶å¯ä»¥åœ¨å¯åŠ¨æ—¶æ·»åŠ  <code>--enable-features=DownloadBubble</code> å‚æ•°æ¥å¯ç”¨ä¸‹è½½æ°”æ³¡çš„åŠŸèƒ½ã€‚</p>
<pre><code class="language-shell">$ open -a &quot;Google Chrome&quot; --args --enable-features=DownloadBubble
</code></pre>
<p>ç°åœ¨ï¼Œå°½ç®¡æ¥åˆ° Chrome 110 ç‰ˆæœ¬ï¼Œå®ƒä»ç„¶æ˜¯å®éªŒæ€§åŠŸèƒ½ã€‚å®é™…ä¸ŠåŒç‰ˆæœ¬ä¸‹ ARM Mac å·²æ­£å¼å¯ç”¨ï¼Œä½† Intel Mac å´æ²¡æœ‰ã€‚</p>
<p>åœ¨ <a href="chrome://flags/#download-bubble"><code>chrome://flags/#download-bubble</code></a> ç•Œé¢è®¾ç½®ï¼Œå°† <code>Default</code> è°ƒæ•´ä¸º <code>Enabled</code> å¹¶é‡å¯æµè§ˆå™¨å³å¯ä½“éªŒè¯¥åŠŸèƒ½ï¼Œå†ä¹Ÿä¸ç”¨ä¸‹è½½ç¬¬ä¸‰æ–¹æ’ä»¶å®ç°äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1677911499825.png" alt=""></p>
<p>ç°åœ¨ï¼Œä¸‹è½½æ–‡ä»¶ä¼šå‡ºç°åœ¨å·¦ä¸Šè§’ä½ç½®ï¼Œç¾è§‚ä¸”ä¸å ä½ç½®ã€‚åœ¨ä¸ä½¿ç”¨å¿«æ·é”®ä¹Ÿèƒ½æ›´å¿«åœ°è¿›å…¥ä¸‹è½½åˆ—è¡¨äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/3/1677911650077.png" alt=""></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TypeError: can't access property "writeText", navigator.clipboard is undefined]]></title>
            <link>https://github.com/toFrankie/blog/issues/297</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/297</guid>
            <pubDate>Sun, 26 Feb 2023 13:14:32 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-09ee2c9decfa699c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-09ee2c9decfa699c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>åœ¨æ­¤å‰ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ <code>document.execCommand('copy')</code> å’Œ <code>document.execCommand('paste')</code> æ¥å®ç°å¤æ‚å’Œç²˜è´´çš„åŠŸèƒ½ã€‚ä½†å®ƒä»¬æ˜¯åŒæ­¥çš„ï¼Œåœ¨å¤„ç†å¤§é‡æ–‡æœ¬æˆ–è€…å›¾åƒè§£ç ç­‰è€—æ—¶è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šé˜»å¡é¡µé¢ã€‚</p>
<p>åæ¥ï¼ŒWHATWG å¸¦æ¥äº†å¼‚æ­¥çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API">Clipboard API</a>ï¼Œå¦‚æœç”¨æˆ·æˆäºˆäº†ç›¸åº”çš„æƒé™ï¼Œå®ƒå°±èƒ½æä¾›ç³»ç»Ÿå‰ªè´´æ¿çš„è¯»å†™è®¿é—®èƒ½åŠ›ï¼Œå¸¸ç”¨äºå®ç°å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´åŠŸèƒ½ã€‚</p>
<p>å®ƒä»¬éƒ½æš´éœ²äº <code>navigator.clipboard</code> å±æ€§ä¸Šï¼š</p>
<blockquote>
<ul>
<li><code>navigator.clipboard.write()</code></li>
<li><code>navigator.clipboard.writeText()</code></li>
<li><code>navigator.clipboard.read()</code></li>
<li><code>navigator.clipboard.readText()</code></li>
</ul>
</blockquote>
<p>å‡è¿”å› Promise å¯¹è±¡ã€‚å…¶ä¸­ <code>writeText()</code> åªæ˜¯é€šç”¨ <code>write()</code> æ–¹æ³•çš„ä¸€ç§ä¾¿æ·æ–¹æ³•ï¼Œ<code>read()</code> ä¸ <code>readText()</code> åŒç†ã€‚</p>
<p>å…¶å…¼å®¹æ€§å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ca54eae2c93f74f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>é—®é¢˜</h2>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ï¼Œåˆ©ç”¨ <code>navigator.clipboard.writeText()</code> å¤åˆ¶ä¸€æ®µæ–‡æœ¬ã€‚</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;body&gt;
    &lt;button&gt;Copy&lt;/button&gt;
    &lt;script&gt;
      const btn = document.querySelector('button')
      btn.addEventListener('click', copy)

      function copy() {
        navigator.clipboard.writeText(new Date())
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å½“æˆ‘ä»¬å¯ç”¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œå‘ç°ç‚¹å‡»å¤åˆ¶æ˜¯ä¸æˆåŠŸçš„ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>TypeError: can't access property &quot;writeText&quot;, navigator.clipboard is undefined
TypeError: Cannot read properties of undefined (reading 'writeText')</p>
</blockquote>
<p>ç”±äº</p>
<blockquote>
<p>ä¸è®¸å¤šæ–° API ä¸€æ ·ï¼ŒClipboard API ä»…æ”¯æŒé€šè¿‡ HTTPS æä¾›çš„é¡µé¢ã€‚ä¸ºå¸®åŠ©é˜²æ­¢æ»¥ç”¨ï¼Œä»…å½“é¡µé¢æ˜¯æ´»åŠ¨é€‰é¡¹å¡æ—¶æ‰å…è®¸è®¿é—®å‰ªè´´æ¿ã€‚æ´»åŠ¨é€‰é¡¹å¡ä¸­çš„é¡µé¢æ— éœ€è¯·æ±‚è®¸å¯å³å¯å†™å…¥å‰ªè´´æ¿ï¼Œä½†ä»å‰ªè´´æ¿è¯»å–å§‹ç»ˆéœ€è¦è®¸å¯ã€‚</p>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API">Clipboard API</a> çš„å¤åˆ¶ä¸ç²˜è´´èƒ½åŠ›å¯¹åº” <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Permissions_API">Permissions API</a> çš„ <code>clipboard-write</code> å’Œ <code>clipboard-read</code> æƒé™ã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p>
<pre><code class="language-js">const queryOpts = { name: 'clipboard-write', allowWithoutGesture: false }
const permissionStatus = await navigator.permissions.query(queryOpts)
console.log(permissionStatus.state) // Will be 'granted', 'denied' or 'prompt'
</code></pre>
<p><code>permissionStatus.state</code> è¿”å›ç»“æœæ˜¯ <code>denied</code>ï¼Œä¹Ÿå°±æ˜¯è¯¥æƒé™è¢«è®¾ä¸ºã€Œæ‹’ç»ã€çŠ¶æ€ï¼Œè‡ªç„¶å°±æ— æ³•å®ç°å¤åˆ¶çš„ç›®çš„äº†ã€‚</p>
<p>å…¶å®æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨ç­–ç•¥ï¼Œå½“é¡µé¢ä¸å®‰å…¨çš„æ—¶å€™ï¼Œå…¨å±€å±æ€§ <code>navigator.clipboard</code> æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯ <code>undefined</code>ï¼Œæ‰€ä»¥å°±å‡ºç°å‰é¢çš„é—®é¢˜äº†ã€‚</p>
<h2>è§£å†³æ–¹æ³•</h2>
<p>åœ¨åŸŸåå®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ <code>HTTPS</code>ã€<code>localhost</code>ã€<code>127.0.0.1</code>ï¼Œæ˜¯å¯ä»¥è®¿é—®åˆ° <code>navigator.clipboard</code> å¯¹è±¡çš„ã€‚
ç”±äºç”Ÿäº§ç¯å¢ƒä¸Šå‡ ä¹éƒ½æ˜¯ HTTPS äº†ï¼Œæ‰€ä»¥ä¸»è¦é¢å‘æœ¬åœ°è°ƒè¯•çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç±»ä¼¼ <code>http://172.10.3.24:3000</code> æ”¹æˆ <code>http://localhost:3000</code> æ¥è§£å†³å¤åˆ¶é—®é¢˜ã€‚</p>
<h2>æ›´å¤š</h2>
<p>å…¶å® window å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªå±æ€§ <code>isSecureContext</code> å¯ç”¨äºåˆ¤æ–­å½“å‰åŸŸåæ˜¯å¦å®‰å…¨ã€‚</p>
<pre><code class="language-js">if (window.isSecureContext) {
  // é¡µé¢åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€ä»¥ Clipboard API å¯ç”¨
  // do something...
}
</code></pre>
<p>è®¸å¤š Web API ä»…èƒ½åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Secure_Contexts">Secure contexts</a>ï¼‰ä¸­è®¿é—®ã€‚</p>
<p>æœ¬åœ°ä¼ é€’çš„èµ„æºï¼Œå¦‚é‚£äº›å¸¦æœ‰ <code>http://127.0.0.1</code>ã€<code>http://localhost</code> å’Œ <code>http://*.localhost</code> ç½‘å€ï¼ˆå¦‚ <code>http://dev.whatever.localhost/</code>ï¼‰å’Œ <code>file://</code> ç½‘å€çš„èµ„æºä¹Ÿæ˜¯è®¤ä¸ºç»è¿‡å®‰å…¨ä¼ é€’çš„ã€‚</p>
<p>éæœ¬åœ°èµ„æºè¦è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š</p>
<ul>
<li>å¿…é¡»é€šè¿‡ <code>https://</code> æˆ– <code>wss://</code> URL æä¾›æœåŠ¡</li>
<li>ç”¨äºä¼ é€èµ„æºçš„ç½‘ç»œä¿¡é“çš„å®‰å…¨å±æ€§ä¸èƒ½æ˜¯åºŸå¼ƒçš„</li>
</ul>
<h2>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://web.dev/async-clipboard/">Unblocking clipboard access</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API">Clipboard API</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Permissions_API">Permissions API</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Secure_Contexts">Secure contexts</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é›¶å®½ç©ºæ ¼ U+200B å¼•å‘çš„é—®é¢˜åŠæ‰©å±•]]></title>
            <link>https://github.com/toFrankie/blog/issues/296</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/296</guid>
            <pubDate>Sun, 26 Feb 2023 13:13:36 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-136ccf9ecdd9d9f8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-136ccf9ecdd9d9f8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘åœ¨å†™ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„å¤„ç†è„šæœ¬ï¼Œç”¨æ¥æ›¿æ¢æ›¿æ¢æ–‡ç« ä¸­çš„æŒ‡å®šå†…å®¹ã€‚</p>
<pre><code class="language-js">function getInsertElement(rootElement) {
  const matchFlag = 'AA'
  const pList = [...rootElement.querySelectorAll('p')]
  let matchedElement = pList.find(el =&gt; {
    const text = (el.textContent || el.innerText).replace(/\u00a0/gi, '').trim()
    return text === matchFlag
  })
  return matchedElement
}
</code></pre>
<p>ä¸Šé¢çš„æ–¹æ³•æ˜¯è„šæœ¬çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè·å–æ–‡ç« ä¸­æŒ‡å®šå­—ç¬¦ä¸²æ‰€åœ¨çš„ DOM å…ƒç´ ï¼Œæ€è·¯æ˜¯é€šè¿‡ <code>Node.textContent</code> æ¥åŒ¹é…çš„ã€‚</p>
<p>åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œå‘ç°æœ‰æ—¶å€™åŒ¹é…ä¸ä¸Šï¼Œç”¨ã€Œè‚‰çœ¼ã€çœ‹æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†ç¡¬æ˜¯åŒ¹é…ä¸ä¸Šã€‚ç»è¿‡ä¸€ç•ªæ’æŸ¥ä¹‹åï¼Œå‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6410c751bc07389d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ç¼–è¾‘å™¨å†…æœ‰å­—ç¬¦ <code>AA</code>ï¼Œç„¶åä½¿ç”¨ <code>encodeURIComponent($0.textContent)</code> çš„ç¼–ç ç»“æœæ˜¯ <code>AA%E2%80%8B</code>ï¼Œæ‰€ä»¥ä¸Šé¢ <code>text === matchFlag</code> æ¯”è¾ƒç»“æœä¸º <code>false</code>ï¼Œè‡ªç„¶å°±åŒ¹é…ä¸ä¸Šäº†ã€‚ä¸‹é¢å°†å…¶è½¬æ¢ä¸º Unicode å­—ç¬¦ï¼š</p>
<pre><code class="language-js">function string2Unicode(str) {
  return str
    .split('')
    .map(value =&gt; {
      const temp = value.charCodeAt(0).toString(16).padStart(4, '0').toUpperCase()
      if (temp.length &gt; 2) return '\\u' + temp
      return value
    })
    .join('')
}

const encodedStr = '%E2%80%8B'
const originString = decodeURIComponent(encodedStr)
const unicodeStr = string2Unicode(originString)
console.log(unicodeStr) // \u200B
</code></pre>
<p>è½¬æ¢å¾—å‡º <code>%E2%80%8B</code> çš„ Unicode ç¼–ç ä¸º <code>U+200B</code>ï¼Œç„¶åæŸ¥è¯¢<a href="https://unicode-table.com/cn/200B/">è¿™é‡Œ</a>å‘ç°å®ƒæ˜¯ã€Œé›¶å®½ç©ºæ ¼ã€ï¼Œæ˜¯ä¸€ç§ä¸å¯è§çš„å­—ç¬¦ã€‚</p>
<p>å› æ­¤ï¼Œåªè¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>/\u200b/gi</code>ï¼ŒæŠŠæ‰€æœ‰é›¶å®½ç©ºæ ¼å¹²æ‰å°±è¡Œäº†ã€‚</p>
<pre><code class="language-js">function getInsertElement(rootElement) {
  const matchFlag = 'AA'
  const pList = [...rootElement.querySelectorAll('p')]
  let matchedElement = pList.find(el =&gt; {
    const text = (el.textContent || el.innerText)
      .replace(/\u00a0/gi, '')
      .replace(/\u200b/gi, '')
      .trim()
    return text === matchFlag
  })
  return matchedElement
}
</code></pre>
<h2>é›¶å®½ç©ºæ ¼</h2>
<blockquote>
<p>é›¶å®½ç©ºæ ¼ï¼ˆzero-width spaceï¼ŒZWSPï¼‰æ˜¯ä¸€ç§ä¸å¯è§ã€ä¸å¯æ‰“å°çš„ Unicode å­—ç¬¦ï¼Œç”¨äºå¯èƒ½éœ€è¦æ¢è¡Œå¤„ã€‚</p>
</blockquote>
<p>åœ¨ Unicode ä¸­ï¼Œè¯¥å­—å…ƒä¸º <code>U+200B</code>ã€‚åœ¨ HTML ä¸­è½¬ä¹‰å­—ç¬¦æœ‰ï¼š<code>&amp;#8203;</code>ã€<code>&amp;ZeroWidthSpace;</code>ã€<code>&amp;#x200B;</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸å¯è§çš„ï¼Œä½†ä¸€äº›è½¯ä»¶å¯¹è¿™äº›ä¸å¯è§å­—ç¬¦åšäº†å¤„ç†ï¼Œè§†è§‰ä¸Šå¯æ„ŸçŸ¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ç›¸é‚»å•è¯ä¹‹é—´æœ‰ä¸€ä¸ªé›¶å®½ç©ºæ ¼ ğŸ‘‡</p>
<pre><code>LoremIpsumDolorSitAmetConsecteturAdipiscingElitSedDoEiusmodTemporIncididuntUtLaboreEtDoloreMagnaAliquaUtEnimAdMinimVeniamQuisNostrudExercitationUllamcoLaborisNisiUtAliquipExEaCommodoConsequatDuisAuteIrureDolorInReprehenderitInVoluptateVelitEsseCillumDoloreEuFugiatNullaPariaturExcepteurSintOccaecatCupidatatNonProidentSuntInCulpaQuiOfficiaDeseruntMollitAnimIdEstLaborum
</code></pre>
<p>ç›¸é‚»å•è¯ä¹‹é—´æ— é›¶å®½ç©ºæ ¼ ğŸ‘‡</p>
<pre><code>LoremIpsumDolorSitAmetConsecteturAdipiscingElitSedDoEiusmodTemporIncididuntUtLaboreEtDoloreMagnaAliquaUtEnimAdMinimVeniamQuisNostrudExercitationUllamcoLaborisNisiUtAliquipExEaCommodoConsequatDuisAuteIrureDolorInReprehenderitInVoluptateVelitEsseCillumDoloreEuFugiatNullaPariaturExcepteurSintOccaecatCupidatatNonProidentSuntInCulpaQuiOfficiaDeseruntMollitAnimIdEstLaborum
</code></pre>
<p>å®ƒä»¬åœ¨ VS Code åŠé¡µé¢ä¸­çš„å±•ç¤ºæ•ˆæœï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-67789488fcdea503.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-28af3b15691241b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>æ‰©å±•</h2>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰é›¶å®½è¿å­—ã€é›¶å®½ä¸è¿å­—ä¹Ÿæ˜¯ä¸å¯è§å­—ç¬¦ã€‚</p>
<blockquote>
<ul>
<li>
<p><strong>é›¶å®½è¿å­—</strong>ï¼ˆzero-width joinerï¼ŒZWJï¼‰æ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ï¼Œæ”¾åœ¨æŸäº›éœ€è¦å¤æ‚æ’ç‰ˆè¯­è¨€ï¼ˆå¦‚é˜¿æ‹‰ä¼¯è¯­ã€å°åœ°è¯­ï¼‰çš„ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªæœ¬ä¸ä¼šå‘ç”Ÿè¿å­—çš„å­—ç¬¦äº§ç”Ÿäº†è¿å­—æ•ˆæœã€‚å…¶ Unicode ç¼–ç ä¸º <code>U+200D</code>ï¼ŒHTML è½¬ä¹‰å­—ç¬¦æœ‰ï¼š<code>&amp;#8205;</code>ã€<code>&amp;zwj;</code>ã€‚</p>
</li>
<li>
<p><strong>é›¶å®½ä¸è¿å­—</strong>ï¼ˆzero-width non-joinerï¼ŒZWNJï¼‰æ˜¯ä¸€ä¸ªä¸æ‰“å°å­—ç¬¦ï¼Œæ”¾åœ¨ç”µå­æ–‡æœ¬çš„ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´ï¼ŒæŠ‘åˆ¶æœ¬æ¥ä¼šå‘ç”Ÿçš„è¿å­—ï¼Œè€Œæ˜¯ä»¥è¿™ä¸¤ä¸ªå­—ç¬¦åŸæœ¬çš„å­—å½¢æ¥ç»˜åˆ¶ã€‚å…¶ Unicode ç¼–ç ä¸º<code>U+200C</code>ï¼ŒHTML è½¬ä¹‰å­—ç¬¦æœ‰ï¼š<code>&amp;#8204;</code>ã€<code>&amp;zwnj;</code>ã€‚</p>
</li>
</ul>
</blockquote>
<p>ç›¸ä¿¡ä½ ä¹Ÿçœ‹è¿‡ç½‘å‹ã€ŒæŠŠå¹¸ç¦çš„ä¸€å®¶å‡ å£å¼ºè¡Œåˆ†å¼€ã€çš„æ®µå­ï¼Œå“ˆå“ˆï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d54ed217f2bcac8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬åˆ©ç”¨å‰é¢çš„ <code>string2Unicode()</code> æ–¹æ³•ï¼Œå°†å…¶è½¬åŒ–ä¸º Unicode ç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b27f1d52a9fb08e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶å®å®ƒä»¬æ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„åˆè€Œæˆçš„ï¼Œå‰é¢æ‰€çœ‹åˆ°çš„â€œç©ºå­—ç¬¦ä¸²â€å…¶å®å°±æ˜¯ <code>U+200D</code>ï¼ˆé›¶å®½è¿å­—ï¼‰ã€‚</p>
<blockquote>
<p>ä¸€ç¯‡æœ‰è¶£çš„æ–‡ç« ï¼š<a href="https://medium.com/frontend-canteen/why-%EF%B8%8F-returns-%EF%B8%8F-in-javascript-7b890e3a13b2">Why [â€¦â€˜ğŸ‘©â¤ï¸ğŸ’‹ğŸ‘¨â€™] returns [â€˜ğŸ‘©â€™, â€˜â€™, â€˜â¤â€™, â€˜ï¸â€™, â€˜â€™, â€˜ğŸ’‹â€™, â€˜â€™, â€˜ğŸ‘¨â€™] in JavaScript?</a></p>
</blockquote>
<h2>åº”ç”¨</h2>
<p>é›¶å®½å­—ç¬¦èƒ½åšä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>ä¼ é€’ä¿¡æ¯ï¼šåˆ©ç”¨å…¶ä¸å¯è§çš„ç‰¹æ€§ï¼Œåœ¨æœªå¯¹é›¶å®½å­—ç¬¦åšè¿‡æ»¤çš„ç½‘ç«™æ’å…¥ä¸å¯è§çš„éšå½¢æ–‡æœ¬ã€‚</li>
<li>æ°´å°ï¼šåŒæ ·åˆ©ç”¨å…¶ä¸å¯è§çš„ç‰¹æ€§ï¼Œç»™æˆ‘ä»¬çš„äº§å“æ·»åŠ éšå½¢æ°´å°ã€‚</li>
<li>...</li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[äºŒç»´ç å†…å®¹è§£æ]]></title>
            <link>https://github.com/toFrankie/blog/issues/295</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/295</guid>
            <pubDate>Sun, 26 Feb 2023 13:12:54 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5c30bb5e4af7039d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5c30bb5e4af7039d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¦‚æœéœ€è¦è·å–äºŒç»´ç çš„åŸå§‹å†…å®¹ï¼Œå¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<pre><code class="language-js">const Jimp = require('jimp')
const QrcodeReader = require('qrcode-reader')

async function parseQrcode(qrcodePath) {
  const image = await Jimp.read(qrcodePath) // å¯ä»¥æ˜¯æœ¬åœ°è·¯å¾„ã€ç½‘ç»œé“¾æ¥
  const originContent = await new Promise((resolve, reject) =&gt; {
    const qr = new QrcodeReader()
    qr.callback = (err, value) =&gt; {
      if (err) {
        reject(err)
        return
      }
      resolve(value.result)
    }
    qr.decode(image.bitmap)
  })

  return originContent
}
</code></pre>
<p>ä»¥ä¸Šç”¨åˆ° <a href="https://www.npmjs.com/package/jimp">jimp</a> å’Œ <a href="https://www.npmjs.com/package/qrcode-reader">qrcode-reader</a> æ¥ä¸ªåº“ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ª<a href="https://upload-images.jianshu.io/upload_images/5128488-4997f2bfcc035f07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">äºŒç»´ç </a>ï¼Œå°±èƒ½è§£æåˆ°å…¶åŸå§‹å†…å®¹ã€‚</p>
<!--
![wxc0e8fba930df8406.png](https://upload-images.jianshu.io/upload_images/5128488-4997f2bfcc035f07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<pre><code class="language-js">parseQrcode('https://upload-images.jianshu.io/upload_images/5128488-4997f2bfcc035f07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240')
  .then(res =&gt; {
    console.log(res) // https://mp.weixin.qq.com/a/~~piirdiB7tRQ~GYk703f8DizEuFT0tGHcvA~~
  })
</code></pre>
<p>æˆ‘é‡åˆ°çš„ä¸€ä¸ªåœºæ™¯æ˜¯ï¼Œå¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ¥å…¥å®˜æ–¹çš„ <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html#%E9%A2%84%E8%A7%88">CI å·¥å…·</a>ä»¥æä¾›äºŒç»´ç ã€Œé¢„è§ˆã€æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹äºŒç»´ç è¿‡å¤§ï¼Œå¯¼è‡´åœ¨ç»ˆç«¯ä½“éªŒä¸ä½³ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘çš„åšæ³•æ˜¯å¯¹ CI å·¥å…·ç”Ÿæˆçš„äºŒç»´ç è¿›è¡Œè§£æï¼Œè·å–åˆ°å…¶åŸå§‹å†…å®¹ï¼ˆå¦‚ä¸Šï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª URL è€Œå·²ï¼‰ï¼Œç„¶ååˆ©ç”¨ <a href="https://www.npmjs.com/package/qrcode-terminal">qrcode-terminal
</a> æˆ– <a href="https://www.npmjs.com/package/qrcode">qrcode</a> ç­‰ä¸»æµåº“é‡æ–°æ‰“å°ã€Œå°ºå¯¸è¾ƒå°ã€çš„äºŒç»´ç åˆ° Terminal ä¸Šã€‚</p>
<pre><code class="language-js">const qrcode = require('qrcode-terminal')

qrcode.generate('qrcodeOriginUrl', {small: true})
</code></pre>
<p>ä½œä¸€ä¸ªè®°å½•ï¼ŒThe end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åˆå° AST]]></title>
            <link>https://github.com/toFrankie/blog/issues/294</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/294</guid>
            <pubDate>Sun, 26 Feb 2023 13:12:13 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9648d6f638f47ca9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9648d6f638f47ca9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>æ¦‚å¿µ</h2>
<p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<strong>æŠ½è±¡è¯­æ³•æ ‘</strong>ï¼ˆAbstractÂ SyntaxÂ Treeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°<strong>è¯­æ³•æ ‘</strong>ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚</p>
<p>ä¹‹æ‰€ä»¥è¯´è¯­æ³•æ˜¯â€œæŠ½è±¡â€çš„ï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„è¯­æ³•å¹¶ä¸ä¼šè¡¨ç¤ºå‡ºçœŸå®è¯­æ³•ä¸­å‡ºç°çš„æ¯ä¸ªç»†èŠ‚ã€‚æ¯”å¦‚ï¼ŒåµŒå¥—æ‹¬å·è¢«éšå«åœ¨æ ‘çš„ç»“æ„ä¸­ï¼Œå¹¶æ²¡æœ‰ä»¥èŠ‚ç‚¹çš„å½¢å¼å‘ˆç°ï¼›è€Œç±»ä¼¼äºÂ <code>if-condition-then</code>Â è¿™æ ·çš„æ¡ä»¶è·³è½¬è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸‰ä¸ªåˆ†æ”¯çš„èŠ‚ç‚¹æ¥è¡¨ç¤ºã€‚</p>
<h2>åˆæ¬¡è§é¢</h2>
<p>ä»¥ JavaScript ä¸ºä¾‹ï¼Œé€šè¿‡ <a href="https://esprima.org/index.html">Esprima</a>ã€<a href="https://astexplorer.net/">AST Explorer</a> ç­‰å¹³å°ï¼Œå°±å¯ä»¥è·Ÿ AST åˆæ¬¡è§é¢ï¼Œäº¤ä¸ªæœ‹å‹ã€‚</p>
<pre><code class="language-js">x + y
</code></pre>
<p>ä»¥ä¸Šæœ€ç®€å•çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºè¿™æ ·ä¸€æ£µæ ‘ï¼š</p>
<pre><code class="language-txt">type: Program
-body
  -#1
    type: ExpressionStatement
    -expression
      type: BinaryExpression
      operator: +
        -left
          type: Identifier
          name: x
        -right
          type: Identifier
          name: y
sourceType: script
</code></pre>
<p>å¦‚æœç”¨ JSON è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-js">{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;body&quot;: [
    {
      &quot;type&quot;: &quot;ExpressionStatement&quot;,
      &quot;expression&quot;: {
        &quot;type&quot;: &quot;BinaryExpression&quot;,
        &quot;operator&quot;: &quot;+&quot;,
        &quot;left&quot;: {
          &quot;type&quot;: &quot;Identifier&quot;,
          &quot;name&quot;: &quot;x&quot;
        },
        &quot;right&quot;: {
          &quot;type&quot;: &quot;Identifier&quot;,
          &quot;name&quot;: &quot;y&quot;
        }
      }
    }
  ],
  &quot;sourceType&quot;: &quot;script&quot;
}
</code></pre>
<p>åœ¨ <a href="https://esprima.org/index.html">Esprima</a> ç¼–å†™æ›´å¤šçš„æ¡ˆä¾‹ï¼Œå¯ä»¥å‘ç°æ¯ä¸€å±‚çš„ç»“æ„éƒ½æ˜¯ç›¸ä¼¼çš„ï¼š</p>
<pre><code class="language-js">{
  &quot;type&quot;: &quot;FunctionDeclaration&quot;,
  &quot;id&quot;: {...},
  &quot;params&quot;: [...],
  &quot;body&quot;: {...}
}
</code></pre>
<pre><code class="language-js">{
  &quot;type&quot;: &quot;Identifier&quot;,
  &quot;name&quot;: &quot;...&quot;
}
</code></pre>
<pre><code class="language-js">{
  &quot;type&quot;: &quot;BinaryExpression&quot;,
  &quot;operator&quot;: &quot;...&quot;,
  &quot;left&quot;: {...},
  &quot;right&quot;: {...}
}
</code></pre>
<p>è¿™äº›æ¯å±‚ç»“æ„ä¹Ÿç§°ä¸ºèŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œä¸€ä¸ª JavaScript ç¨‹åºå°±æ˜¯ç”±æˆåƒä¸Šä¸‡çš„èŠ‚ç‚¹æ„æˆçš„ã€‚</p>
<blockquote>
<p>AST èŠ‚ç‚¹å¾ˆå¤šå¾ˆå¤šï¼Œä¸éœ€è¦å…¨éƒ¨è®°ä½ã€‚</p>
</blockquote>
<p>å¦‚æœæœ‰éœ€è¦ï¼Œä½†åˆä¸è®°å¾—çš„è¯ï¼Œå¯ä»¥å€ŸåŠ© <a href="https://esprima.org/index.html">Esprima</a>ã€<a href="https://astexplorer.net/">AST Explorer</a> å»æŸ¥çœ‹ï¼Œåè€…è¿˜æ”¯æŒåˆ‡æ¢å¤šç§è§£æå™¨ï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a1d097c92eed095a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœä½ æƒ³è¦æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯ä»¥å»å¯¹åº”å®˜ç½‘æŸ¥çœ‹ï¼Œæ¯”å¦‚ <a href="https://github.com/babel/babel/blob/main/packages/babel-parser/ast/spec.md">@babel/parser (babylon) Spec</a> ç­‰ã€‚</p>
<blockquote>
<p>å‰é¢æåˆ°å¯åˆ‡æ¢ AST è§£æå™¨ï¼Œæ˜¯å› ä¸ºæ¯ä¸€ç§ AST è§„èŒƒåˆæœ‰ç»†å¾®çš„å·®åˆ«ï¼Œä½†åŸºæœ¬ä¸Šéƒ½éµå¾ª <a href="https://github.com/estree/estree">ESTree Spec</a> çš„ã€‚è¢«æ›´å¤šäººå¹¿æ³›ä½¿ç”¨çš„åº”è¯¥æ˜¯ Babel AST å§ï¼Œå› æ­¤æ¥ä¸‹æ¥å­¦ä¹ ä¹Ÿæ˜¯åŸºäºå®ƒæ¥å±•å¼€ã€‚</p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
<!--

* https://astexplorer.net/
* https://esprima.org/demo/parse.html#
* https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è°ˆè®¾è®¡æ¨¡å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/293</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/293</guid>
            <pubDate>Sun, 26 Feb 2023 13:10:37 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677417091573.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç»ˆäºæœ‰æ—¶é—´å†™è¿™ä¸€ç³»åˆ—å•¦...</p>
<h2>ä¸€ã€èµ·æº</h2>
<ul>
<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677417091573.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç»ˆäºæœ‰æ—¶é—´å†™è¿™ä¸€ç³»åˆ—å•¦...</p>
<h2>ä¸€ã€èµ·æº</h2>
<ul>
<li>1977 å¹´ï¼Œå»ºç­‘å¸ˆ Christopher Alexander ç¼–å†™äº†ä¸€æœ¬æ±‡é›†è®¾è®¡æ¨¡å¼çš„ä¹¦ï¼Œæ¨¡å¼ï¼ˆPatternï¼‰ä¸€è¯æºè‡ªæ­¤ä¹¦ã€‚</li>
<li>1987 å¹´ï¼ŒKent Beck å’Œ Ward Cunningham åˆ©ç”¨ Christopher Alexander çš„æ€æƒ³å¼€å‘äº†è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼Œå¹¶é¦–æ¬¡åº”ç”¨äºè®¡ç®—æœºé¢†åŸŸã€‚</li>
<li>1989 å¹´ï¼ŒErich Gamma åœ¨å…¶åšå£«æ¯•ä¸šè®ºæ–‡ä¸­å°†è¿™ç§æ€æƒ³æ”¹å†™ä¸ºé€‚ç”¨äºè½¯ä»¶å¼€å‘ã€‚</li>
<li>1989 ~ 1991 å¹´æœŸé—´ï¼ŒJames Coplien åˆ©ç”¨ç›¸åŒçš„æ€æƒ³è‡´åŠ›äº C++ å¼€å‘ã€‚</li>
<li>1994 å¹´ï¼Œè¢«ç§°ä¸ºå››äººå¸®ï¼ˆGang of Fourï¼ŒGoFï¼‰çš„ Erich Gammaã€Richard Helmã€Ralph Johnsonã€John Vlissides äº 1994 å¹´åˆä½œå‡ºç‰ˆäº†ã€ŠDesign Patterns: Elements of Reusable Object-Oriented Softwareã€‹ä¸€ä¹¦ï¼Œæ­¤ä¹¦å…±æ”¶å½•äº† 23 ç§è®¾è®¡æ¨¡å¼ã€‚</li>
</ul>
<p>æ›´å¤šè¯·çœ‹<a href="https://www.wikiwand.com/en/Software_design_pattern">ç»´åŸºç™¾ç§‘</a>ã€‚</p>
<h2>äºŒã€ç®€ä»‹</h2>
<p>è®¾è®¡æ¨¡å¼ç”¨äºè§£å†³è½¯ä»¶ã€Œè®¾è®¡ã€å±‚é¢çš„é—®é¢˜ï¼Œè€Œéå…·ä½“çš„ç¼–ç å®ç°ã€‚</p>
<blockquote>
<p>è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€ç¨‹åºçš„é‡ç”¨æ€§ã€‚ ï¼ˆæ‘˜è‡ª<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/2117635">ç™¾åº¦ç™¾ç§‘</a>ï¼‰</p>
</blockquote>
<h3>ä¸‰ã€è®¾è®¡åŸåˆ™</h3>
<p>è®¾è®¡æ¨¡å¼å¹¶ä¸æ˜¯è¯­è¨€è§„èŒƒï¼Œè§£å†³å®é™…é—®é¢˜æ—¶å¹¶æ²¡æœ‰è§„èŒƒå¿…é¡»ä½¿ç”¨å“ªä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œä¸å®œç”Ÿæ¬ç¡¬å¥—ï¼Œåº”çµæ´»è¿ç”¨ã€‚<strong>æœ€é‡è¦çš„æ˜¯ï¼Œä¸€å®šä¸è¦ä¸ºäº†ç”¨è®¾è®¡æ¨¡å¼è€Œç”¨è®¾è®¡æ¨¡å¼ï¼Œé¿å…è®¾è®¡è¿‡åº¦ï¼Œä½¿å¾—ç®€å•é—®é¢˜å¤æ‚åŒ–ã€‚å› æ­¤ï¼Œåœ¨ç”¨ä¹‹å‰åº”æ€è€ƒé—®é¢˜æœ¬èº«æ˜¯å¦éœ€è¦è®¾è®¡æ¨¡å¼ã€‚</strong></p>
<p>é€šå¸¸åº”éµå¾ªä¸ƒå¤§è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li>
<p>å¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼ŒOCPï¼‰
å½“åº”ç”¨çš„éœ€æ±‚æ”¹å˜æ—¶ï¼Œåœ¨ä¸ä¿®æ”¹è½¯ä»¶å®ä½“çš„æºä»£ç æˆ–è€…äºŒè¿›åˆ¶ä»£ç çš„å‰æä¸‹ï¼Œå¯ä»¥æ‰©å±•æ¨¡å—çš„åŠŸèƒ½ï¼Œä½¿å…¶æ»¡è¶³æ–°çš„éœ€æ±‚ã€‚</p>
</li>
<li>
<p>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰
å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼ŒDIPï¼‰
é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚</p>
</li>
<li>
<p>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼ŒSRPï¼‰
å…¶æ ¸å¿ƒæ˜¯æ§åˆ¶ç±»çš„ç²’åº¦å¤§å°ã€å°†å¯¹è±¡è§£è€¦ã€æé«˜å…¶å†…èšæ€§ã€‚</p>
</li>
<li>
<p>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼ŒISPï¼‰
ä¸ºäº†çº¦æŸæ¥å£ã€é™ä½ç±»å¯¹æ¥å£çš„ä¾èµ–æ€§ã€‚</p>
</li>
<li>
<p>è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼ŒLoDï¼‰
å¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</p>
</li>
<li>
<p>åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼ŒCRPï¼‰
é€šè¿‡å°†å·²æœ‰çš„å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½œä¸ºæ–°å¯¹è±¡çš„æˆå‘˜å¯¹è±¡æ¥å®ç°çš„ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œä»è€Œè¾¾åˆ°å¤ç”¨ã€‚</p>
</li>
</ul>
<p>æ ¹æ®ä¾§é‡ç‚¹æ€»ç»“å½’çº³ï¼š</p>
<table>
<thead>
<tr>
<th>è®¾è®¡åŸåˆ™</th>
<th>ä¸€å¥è¯å½’çº³</th>
<th>ç›®çš„</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¼€é—­åŸåˆ™</td>
<td>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</td>
<td>é™ä½ç»´æŠ¤å¸¦æ¥çš„æ–°é£é™©</td>
</tr>
<tr>
<td>ä¾èµ–å€’ç½®åŸåˆ™</td>
<td>é«˜å±‚ä¸åº”è¯¥ä¾èµ–ä½å±‚ï¼Œè¦é¢å‘æ¥å£ç¼–ç¨‹</td>
<td>æ›´åˆ©äºä»£ç ç»“æ„çš„å‡çº§æ‰©å±•</td>
</tr>
<tr>
<td>å•ä¸€èŒè´£åŸåˆ™</td>
<td>ä¸€ä¸ªç±»åªå¹²ä¸€ä»¶äº‹ï¼Œå®ç°ç±»è¦å•ä¸€</td>
<td>ä¾¿äºç†è§£ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§</td>
</tr>
<tr>
<td>æ¥å£éš”ç¦»åŸåˆ™</td>
<td>ä¸€ä¸ªæ¥å£åªå¹²ä¸€ä»¶äº‹ï¼Œæ¥å£è¦ç²¾ç®€å•ä¸€</td>
<td>åŠŸèƒ½è§£è€¦ï¼Œé«˜èšåˆã€ä½è€¦åˆ</td>
</tr>
<tr>
<td>è¿ªç±³ç‰¹æ³•åˆ™</td>
<td>ä¸è¯¥çŸ¥é“çš„ä¸è¦çŸ¥é“ï¼Œä¸€ä¸ªç±»åº”è¯¥ä¿æŒå¯¹å…¶å®ƒå¯¹è±¡æœ€å°‘çš„äº†è§£ï¼Œé™ä½è€¦åˆåº¦</td>
<td>åªå’Œæœ‹å‹äº¤æµï¼Œä¸å’Œé™Œç”Ÿäººè¯´è¯ï¼Œå‡å°‘ä»£ç è‡ƒè‚¿</td>
</tr>
<tr>
<td>é‡Œæ°æ›¿æ¢åŸåˆ™</td>
<td>ä¸è¦ç ´åç»§æ‰¿ä½“ç³»ï¼Œå­ç±»é‡å†™æ–¹æ³•åŠŸèƒ½å‘ç”Ÿæ”¹å˜ï¼Œä¸åº”è¯¥å½±å“çˆ¶ç±»æ–¹æ³•çš„å«ä¹‰</td>
<td>é˜²æ­¢ç»§æ‰¿æ³›æ»¥</td>
</tr>
<tr>
<td>åˆæˆå¤ç”¨åŸåˆ™</td>
<td>å°½é‡ä½¿ç”¨ç»„åˆæˆ–è€…èšåˆå…³ç³»å®ç°ä»£ç å¤ç”¨ï¼Œå°‘ä½¿ç”¨ç»§æ‰¿</td>
<td>é™ä½ä»£ç è€¦åˆ</td>
</tr>
</tbody>
</table>
<p>ä»¥ä¸Šè¿™äº›åŸåˆ™çš„ç›®çš„åªæœ‰ä¸€ä¸ªï¼šé™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œå¢åŠ ç¨‹åºçš„å¯å¤ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<blockquote>
<p>è®¿é—®åŠ é™åˆ¶ï¼Œå‡½æ•°è¦èŠ‚ä¿­ï¼Œä¾èµ–ä¸å…è®¸ï¼ŒåŠ¨æ€åŠ æ¥å£ï¼Œçˆ¶ç±»è¦æŠ½è±¡ï¼Œæ‰©å±•ä¸æ›´æ”¹ã€‚</p>
</blockquote>
<h3>å››ã€åˆ†ç±»</h3>
<p>ä¸€ä¸ªè½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ ¼å¼æ ¹æ®ä½œè€…çš„ä¸åŒï¼Œåˆ’åˆ†å’Œåç§°ç­‰éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ã€ŠDesign Patternsã€‹ä¸€ä¹¦å°†è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåˆ›å»ºå‹æ¨¡å¼ã€ç»“æ„å‹æ¨¡å¼å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼Œå…± 23 ç§ã€‚</p>
<ul>
<li>åˆ›å»ºå‹æ¨¡å¼
<ul>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼</li>
<li>å»ºé€ è€…æ¨¡å¼</li>
<li>åŸå‹æ¨¡å¼</li>
<li>å•ä¾‹æ¨¡å¼</li>
</ul>
</li>
<li>ç»“æ„å‹æ¨¡å¼
<ul>
<li>é€‚é…å™¨</li>
<li>æ¡¥æ¥</li>
<li>ç»„åˆ</li>
<li>è£…é¥°å™¨</li>
<li>å¤–è§‚</li>
<li>äº«å…ƒ</li>
<li>ä»£ç†</li>
</ul>
</li>
<li>è¡Œä¸ºå‹æ¨¡å¼
<ul>
<li>è´£ä»»é“¾</li>
<li>å‘½ä»¤</li>
<li>è§£é‡Šå™¨</li>
<li>è¿­ä»£å™¨</li>
<li>ä¸­ä»‹</li>
<li>å¤‡å¿˜å½•</li>
<li>è§‚å¯Ÿè€…</li>
<li>çŠ¶æ€</li>
<li>ç­–ç•¥</li>
<li>æ¨¡æ¿æ–¹æ³•</li>
<li>è®¿é—®è€…</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼Œè®¾è®¡æ¨¡å¼å¹¶ä¸æ˜¯æŸä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„ä¸“åˆ©ï¼Œå®ƒé€‚ç”¨äº Javaã€C++ã€C#ã€JavaScript ç­‰é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ã€‚ä¸‹æ–‡å°†ä¼šä»¥ JavaScript ä¸ºä¾‹ã€‚</p>
<h2>äº”ã€åˆ›å»ºå‹æ¨¡å¼</h2>
<h3>5.1 å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Method Patternï¼‰</h3>
<p>æˆ‘ä»¬å¸¸è¯´çš„å·¥å‚æ¨¡å¼å°±æ˜¯æŒ‡å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œä¹Ÿæ˜¯ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚</p>
<p><strong>ç®€å•å·¥å‚æ¨¡å¼</strong></p>
<p>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰å¹¶ä¸å±äº GoF çš„ 23 ç§è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚ä½†å®ƒæ˜¯å…¶ä»–å·¥å‚æ¨¡å¼çš„åŸºç¡€ã€‚</p>
<p>ç®€å•å·¥å‚æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ã€‚å½“ç³»ç»Ÿä¸­éœ€è¦å¼•å…¥æ–°äº§å“æ—¶ï¼Œç”±äºé™æ€å·¥å‚æ–¹æ³•é€šè¿‡æ‰€ä¼ å…¥å‚æ•°çš„ä¸åŒæ¥åˆ›å»ºä¸åŒçš„äº§å“ï¼Œè¿™å¿…å®šè¦ä¿®æ”¹å·¥å‚ç±»çš„æºä»£ç ï¼Œå°†è¿èƒŒâ€œå¼€é—­åŸåˆ™â€ï¼Œå¦‚ä½•å®ç°å¢åŠ æ–°äº§å“è€Œä¸å½±å“å·²æœ‰ä»£ç ï¼Ÿ</p>
<p>å®šä¹‰ä¸€ä¸ªæ¥å£ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯è®©å­ç±»å†³å®šåˆå§‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠä¸€ä¸ªç±»çš„åˆå§‹åŒ–ä¸‹æ”¾åˆ°å­ç±»ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<!--



## References

* [JavaScriptè®¾è®¡æ¨¡å¼es6ï¼ˆ23ç§)](https://juejin.cn/post/6844904032826294286)
* [è®¾è®¡æ¨¡å¼ï¼ˆRUNOOBï¼‰](https://www.runoob.com/design-pattern/design-pattern-tutorial.html)
* [è½¯ä»¶è®¾è®¡æ¨¡å¼æ¦‚è¿°](http://c.biancheng.net/view/1317.html)
* [è®¾è®¡æ¨¡å¼](https://segmentfault.com/u/yu_5e842f4043ba6/articles?sort=newest&page=5)
-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é€šè¿‡é¢è¯•é¢˜ a == 1 && a == 2 && a == 3ï¼Œä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/292</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/292</guid>
            <pubDate>Sun, 26 Feb 2023 13:07:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3905c600091ee348.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3905c600091ee348.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€èƒŒæ™¯</h2>
<p>ä¸Šå‘¨å›å®¶è·¯ä¸Šï¼Œé€›ç¤¾åŒºç»™æˆ‘æ¨äº†è¿™æ ·ä¸€é“ã€Œé¢è¯•é¢˜ã€ï¼Œè¦ä½¿å…¶ç»“æœä¸º <code>true</code>ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</p>
<pre><code class="language-js">a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3
</code></pre>
<p>å¿ƒæƒ³ä¸æ˜¯å¾ˆç®€å•å˜›ï¼Œè€ƒå¯Ÿçš„æ˜¯æ•°æ®ç±»å‹è½¬æ¢çš„çŸ¥è¯†ã€‚è‡ªå®ç°ä¸€ä¸ª <code>@@toPrimitive</code> æ–¹æ³•å°±è¡Œï¼Œæ€è·¯å¾ˆç®€å•ã€‚æ¢å¥è¯è¯´ï¼šå®ç°è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨æ—¶è¿”å›å€¼å¢åŠ  <code>1</code>ã€‚è¿™æ ·å¤§å®¶é—­çœ¼å°±èƒ½å†™å‡ºæ¥äº†ï¼š</p>
<pre><code class="language-js">const a = {
  [Symbol.toPrimitive]() {
    if (this._val === undefined) this._val = 0
    this._val++
    return this._val
  }
}

console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // true
</code></pre>
<p>è¿™é“é¢˜å®ƒçš„å±æ€§å <code>[Symbol.toPrimitive]</code> æ¯”è¾ƒå°‘ç”¨å°‘è§ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<blockquote>
<p>å…¶ä¸­ <code>@@toPrimitive</code> æ–¹æ³•åªèƒ½é€šè¿‡è®¡ç®—å±æ€§ <code>[Symbol.toPrimitive]</code> çš„æ–¹å¼å»è¡¨ç¤ºã€‚ç±»ä¼¼çš„è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å®ç°æˆ–é‡å†™è¿­ä»£å™¨çš„ <code>@@iterator</code> æ–¹æ³•è¡¨ç¤ºä¸º <code>[Symbol.iterator]</code> ã€‚</p>
</blockquote>
<h2>äºŒã€ä¸ºä»€ä¹ˆï¼Ÿ</h2>
<p>è¿™ä¼šè¯¥æœ‰äººè·³å‡ºæ¥åæ§½ï¼š<strong>å®é™…é¡¹ç›®ä¸­æ¯«æ— æ„ä¹‰ï¼Œæ€ä¹ˆè¿˜æœ‰é¢è¯•å®˜é—®è¿™ç§å‚»é€¼é—®é¢˜</strong>ï¼Ÿæˆ‘å°è¯•æ¢ä½æ€è€ƒï¼Œé¢è¯•å®˜å¦‚ä½•åœ¨çŸ­æ—¶é—´å†…åˆ¤æ–­ä¸€ä¸ªå€™é€‰äººçš„ä¸“ä¸šæŠ€èƒ½ï¼Ÿé€šè¿‡è¿™äº›çœ‹ä¼¼å¥‡è‘©ï¼Œä½†ç»¼åˆæ€§è¾ƒå¼ºçš„é¢˜ç›®æ¥è€ƒå¯Ÿä¸å¤±ä¸ºä¸€ç§å¥½æ–¹æ³•ï¼ˆè¿™é¢˜å¥½åƒä¸å¤ªå¼ºï¼‰ã€‚</p>
<blockquote>
<p>ç§ä»¥ä¸ºï¼Œå­¦å¥½ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œåº”åšåˆ°ã€Œæ·±å…¥äº†è§£ï¼Œä¸¾ä¸€åä¸‰ã€ã€‚</p>
</blockquote>
<p>åŠ ä¸ªèœï¼Œè‹¥è¦ä½¿ä¸‹é¢åŒæ—¶æˆç«‹ï¼ˆä¸´æ—¶æƒ³å‡ºæ¥çš„ï¼‰ï¼Œä½ è¿˜ä¼šåšå—ï¼Ÿ</p>
<pre><code class="language-js">console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // true
console.log(+a) // 100
console.log(`${a}`) // 1000
</code></pre>
<p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼ŒåŸå› æ˜¯ <code>@@toPrimitive</code> æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šæ¥æ”¶åˆ°ä¸€ä¸ª <code>hint</code> å‚æ•°ï¼Œå…¶å€¼ä¸º <code>default</code>ã€<code>string</code>ã€<code>number</code> ä¹‹ä¸€ã€‚ç„¶åä½ åˆèƒ½ç«‹åˆ»å®ç°å‡ºæ¥äº†ï¼š</p>
<pre><code class="language-js">const a = {
  [Symbol.toPrimitive](hint) {
    if (hint === 'number') return 100
    if (hint === 'string') return 1000
    if (this._val === undefined) this._val = 0
    this._val++
    return this._val
  },
}

console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // true
console.log(+a) // 100
console.log(`${a}`) // 1000
</code></pre>
<p>ç§ä»¥ä¸ºï¼Œä¸èƒ½åšåˆ°ä¸¾ä¸€åä¸‰ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰å®Œå…¨æŒæ¡ç›¸å…³çŸ¥è¯†ã€‚è¿™æ ·çš„è¯ï¼Œåº”è¯¥æ‰¾æ—¶é—´å»å­¦ä¹ ä¸€ä¸‹ã€‚</p>
<h2>ä¸‰ã€è¿›ä¸€æ­¥æ·±å…¥ï¼Ÿ</h2>
<p>åœ¨ ECMAScript æ ‡å‡†ä¸­ï¼Œå¸¸è§æ•°æ®ç±»å‹è½¬æ¢æ“ä½œæœ‰è¿™äº›ï¼š</p>
<ul>
<li><a href="https://262.ecma-international.org/#sec-toprimitive">ToPrimitive</a> - è½¬æ¢ä¸ºåŸå§‹å€¼</li>
<li><a href="https://262.ecma-international.org/#sec-toboolean">ToBoolean</a> - è½¬æ¢ä¸ºå¸ƒå°”å€¼</li>
<li><a href="https://262.ecma-international.org/#sec-tonumber">ToNumber</a> - è½¬æ¢ä¸ºæ•°å€¼</li>
<li><a href="https://262.ecma-international.org/#sec-tostring">ToString</a> - è½¬æ¢ä¸ºå­—ç¬¦ä¸²</li>
<li><a href="https://262.ecma-international.org/#sec-toobject">ToObject</a> - è½¬æ¢ä¸ºå¼•ç”¨å€¼</li>
</ul>
<p>æ³¨æ„ï¼Œä»¥ä¸Šè¿™äº›å¹¶ä¸æ˜¯ JavaScript é‡Œé¢å…·ä½“çš„æ–¹æ³•ï¼Œè€Œæ˜¯ ECMAScript æ ‡å‡†ä¸­çš„æŠ½è±¡æ“ä½œï¼ˆAbstract Operationsï¼‰ã€‚å…¶å®ä¸æ­¢è¿™äº›ï¼ŒECMAScript æ ‡å‡†è¿˜æœ‰å¾ˆå¤šè½¬æ¢æ–¹æ³•ï¼Œæ›´å¤šè¯·çœ‹ <a href="https://262.ecma-international.org/#sec-type-conversion">Type Conversion</a> ç« èŠ‚ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡é˜…è¯» ECMAScript æ ‡å‡†ï¼Œéš¾å…ä¼šæœ‰ç§ç¾æ¶©éš¾æ‡‚çš„æ„Ÿè§‰ï¼Œè¿™é‡Œæ¨èé˜®ä¸€å³°è€å¸ˆ<a href="https://es6.ruanyifeng.com/#docs/spec">è¯»æ‡‚è§„èŒƒ</a>ä¸€æ–‡ï¼Œæˆ–è®¸æœ‰å¸®åŠ©ã€‚</p>
<blockquote>
<p>æ­¤å‰å…¶å®å·²ç»å†™è¿‡ä¸€ç¯‡å…³äº JavaScript æ•°æ®ç±»å‹è½¬æ¢çš„æ–‡ç« ï¼Œé‡Œé¢ä¹Ÿå¾ˆè¯¦ç»†åœ°ä»‹ç»äº†ï¼Œå¯ç§»æ­¥è‡³ï¼š<a href="https://github.com/toFrankie/blog/issues/242">æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£</a>ã€‚è¿˜å†™ä¸‹è¿™ç¯‡æ–‡ç« å…¶å®æ˜¯æƒ³ã€Œæ¸©æ•…çŸ¥æ–°ã€ã€‚å¦å¤–ï¼Œæˆ‘æƒ³è¯»è€…å¯èƒ½æ›´å–œæ¬¢ä»ä¸€ä¸ªå®é™…é—®é¢˜å‡ºå‘ï¼Œç„¶åå†æ·±å…¥å…¶èƒŒåçš„åŸç†ã€‚</p>
</blockquote>
<p>å°±æ–‡ç« å¼€å¤´çš„é¢˜ç›®è€Œè¨€ï¼Œè¿™é‡Œæ˜æ˜¾å°±æ˜¯ã€ŒToPrimitiveã€æ“ä½œäº†ï¼Œç»™å¤§å®¶çœ‹ä¸‹ ECMAScript æ˜¯å¦‚ä½•å®šä¹‰ï¼ˆ<a href="https://262.ecma-international.org/#sec-toprimitive">è¯¦è§</a>ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e2b8af68dd742716.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç¬¬ä¸€æ¬¡é˜…è¯»çš„æ—¶å€™ï¼Œä¹Ÿæ›¾æ„Ÿæ…¨ã€Œä¸æ„§æ˜¯æŠ½è±¡æ“ä½œï¼Œç¡®å®å¾ˆæŠ½è±¡ã€ï¼Œä½†åå¤é˜…è¯»ä¸‹æ¥ä¹‹åï¼Œä¹Ÿä¸ä¼šå¾ˆéš¾ã€‚</p>
<p>æœ¬æ–‡å°†ä¸ä¼šé€è¡Œé€å­—è¿›è¡Œç¿»è¯‘ï¼Œæ­¤å‰å†™é‚£ç¯‡æ–‡ç«  <a href="https://github.com/toFrankie/blog/issues/242">æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£</a> å·²ç»åšäº†è¿™ä»¶äº‹ã€‚</p>
<p>ä»¥ <code>ToPrimitive(obj, hint)</code> ä¸ºä¾‹</p>
<blockquote>
<ol>
<li>
<p>å¦‚æœ <code>obj</code> ä¸ºåŸå§‹å€¼ï¼Œç›´æ¥è¿”å›è¯¥å€¼ã€‚</p>
</li>
<li>
<p>å¦‚æœ <code>obj</code> ä¸ºå¼•ç”¨å€¼ï¼Œä¸”å«æœ‰ <code>@@toPrimitive</code> æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯å‡½æ•°ï¼‰ï¼Œç„¶å
a. è‹¥å‚æ•° <code>hint</code> ä¸å­˜åœ¨ï¼Œä»¤ <code>hint</code> ä¸º <code>&quot;default&quot;</code>ï¼›è‹¥ <code>hint</code> ä¸ºå­—ç¬¦ä¸²ï¼Œä»¤ <code>hint</code> ä¸º <code>&quot;string&quot;</code>ï¼›å¦åˆ™ä»¤ <code>hint</code> ä¸º <code>&quot;number&quot;</code>ã€‚
b. è°ƒç”¨ <code>@@toPrimitive</code> æ–¹æ³•ï¼Œè‹¥å…¶è¿”å›å€¼ä¸ºã€ŒåŸå§‹å€¼ã€ï¼Œåˆ™è¿”å›å…¶å€¼ï¼Œå¦åˆ™æŠ›å‡º TypeErrorã€‚</p>
</li>
<li>
<p>è‹¥å‚æ•° <code>hint</code> ä¸å­˜åœ¨ï¼Œä»¤ <code>hint</code> ä¸º <code>&quot;number&quot;</code>ï¼›</p>
</li>
<li>
<p>å½“ <code>hint</code> ä¸º <code>&quot;string&quot;</code>ï¼Œå°†ä¼šå…ˆåè°ƒç”¨ <code>obj</code> çš„ <code>toString()</code>ã€<code>valueOf()</code> æ–¹æ³•ï¼Œç„¶å
a. è‹¥ <code>toString</code> ä¸ºå‡½æ•°ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•ã€‚è‹¥å…¶è¿”å›å€¼ä¸ºã€ŒåŸå§‹å€¼ã€ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼Œå¦åˆ™è¿›è¡Œå¾€ä¸‹ã€‚
b. è‹¥ <code>valueOf</code> ä¸ºå‡½æ•°ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•ã€‚è‹¥å…¶è¿”å›å€¼ä¸ºã€ŒåŸå§‹å€¼ã€ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼Œå¦åˆ™æŠ›å‡º TypeErrorã€‚</p>
</li>
<li>
<p>å½“ <code>hint</code> ä¸º <code>&quot;number&quot;</code>ï¼Œå°†ä¼šå…ˆåè°ƒç”¨ <code>obj</code> çš„ <code>valueOf()</code>ã€<code>toString()</code> æ–¹æ³•ï¼Œç„¶å</p>
<p>a. è‹¥ <code>valueOf</code> ä¸ºå‡½æ•°ï¼Œå°±è°ƒç”¨è¯¥æ–¹æ³•ã€‚è‹¥å…¶è¿”å›å€¼ä¸ºã€ŒåŸå§‹å€¼ã€ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼Œå¦åˆ™è¿›è¡Œå¾€ä¸‹ã€‚
b. è‹¥ <code>toString</code> ä¸ºå‡½æ•°ï¼Œå°±è°ƒç”¨è¯¥æ–¹æ³•ã€‚è‹¥å…¶è¿”å›å€¼ä¸ºã€ŒåŸå§‹å€¼ã€ï¼Œåˆ™è¿”å›è¯¥å€¼ï¼Œå¦åˆ™æŠ›å‡º TypeErrorã€‚</p>
</li>
</ol>
</blockquote>
<p>ç›®å‰ ECMAScript å†…ç½®çš„å¯¹è±¡ä¸­ï¼Œåªæœ‰ <code>Date</code> å’Œ <code>Symbol</code> å¯¹è±¡æœ‰å®ç°å…¶ <code>@@toPrimitive</code> æ–¹æ³•ã€‚å› æ­¤ï¼Œå…¶ä»–å†…ç½®å¯¹è±¡æ— éå°±æ˜¯æ ¹æ® <code>valueOf()</code> æˆ– <code>toString()</code> æ–¹æ³•ï¼Œå¾—åˆ°å…¶è½¬æ¢ç»“æœç½¢äº†ï¼Œæ‰€ä»¥æ•°æ®ç±»å‹è½¬æ¢æ²¡é‚£ä¹ˆç¥ç§˜ã€‚</p>
<blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/@@toPrimitive">Date.prototype[@@toPrimitive]</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/@@toPrimitive">Symbol.prototype[@@toPrimitive]</a></li>
</ul>
</blockquote>
<p>ç„¶åï¼Œå›åˆ°æ–‡ç« å¼€å¤´é‚£é“é¢˜ï¼š</p>
<pre><code class="language-js">a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3
</code></pre>
<p>ä»¤ <code>a</code> æˆä¸ºä¸€ä¸ªå¼•ç”¨å€¼ï¼Œæ¯”å¦‚å¯¹è±¡ã€‚è¿™æ—¶ï¼Œé™¤äº†å®ç° <code>@@toPrimitive</code> æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ”¹å†™å…¶ <code>toString()</code> æ–¹æ³•å»è¾¾åˆ°ç›®çš„ã€‚</p>
<pre><code class="language-js">const a = {
  toString() {
    if (this._val === undefined) this._val = 0
    this._val++
    return this._val
  }
}

console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // true
</code></pre>
<p>ä½†å¦‚æœè¦ä½¿æˆç«‹ï¼Œåªèƒ½åˆ©ç”¨ <code>@@toPrimitive</code> æ–¹æ³•ä¼šä¼ å…¥ <code>hint</code> å‚æ•°çš„ç‰¹ç‚¹å»å®ç°äº†ï¼š</p>
<pre><code class="language-js">console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // true
console.log(+a) // 100
console.log(`${a}`) // 1000
</code></pre>
<p>ä¹Ÿå°±æ˜¯</p>
<pre><code class="language-js">const a = {
  [Symbol.toPrimitive](hint) {
    if (hint === 'number') return 100
    if (hint === 'string') return 1000
    if (this._val === undefined) this._val = 0
    this._val++
    return this._val
  },
}

console.log(a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3) // trueï¼Œæ­¤æ—¶ hint ä¸º &quot;default&quot;
console.log(+a) // 100ï¼Œæ­¤æ—¶ hint ä¸º &quot;number&quot;
console.log(`${a}`) // 1000ï¼Œæ­¤æ—¶ hint ä¸º &quot;string&quot;
</code></pre>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ª <code>hint</code> æœ‰ä½•è§„å¾‹å‘¢ï¼Ÿå®åœ¨æƒ­æ„§ï¼Œæˆ‘ä¹Ÿæ²¡å¤ªç¢ç£¨å‡ºæ¥ã€‚å¸¸è§æ“ä½œçš„ <code>hint</code> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const obj = {
  [Symbol.toPrimitive](hint) {
    if (hint === 'number') {
      return 1
    } else if (hint === 'string') {
      return 'string'
    } else {
      return 'default'
    }
  }
}


console.log(+obj)          // 1              hint is &quot;number&quot;
console.log(Number(obj))   // 1              hint is &quot;number&quot;

console.log(`${obj}`)      // &quot;string&quot;       hint is &quot;string&quot;
console.log(String(obj))   // &quot;string&quot;       hint is &quot;string&quot;

console.log(obj + '')      // &quot;default&quot;      hint is &quot;default&quot;
console.log(obj + 1)       // &quot;default1&quot;     hint is &quot;default&quot;
</code></pre>
<blockquote>
<p>ä¸ªäººçŒœæµ‹ï¼šã€Œæ˜¾å¼è½¬æ¢ã€ä¸ºå­—ç¬¦ä¸²æˆ–æ•°ç»„æ—¶ï¼Œå¯¹åº”ä¸º <code>&quot;string&quot;</code> æˆ– <code>&quot;number&quot;</code>ï¼Œå…¶ä»–æƒ…å†µä¸º <code>&quot;default&quot;</code>ã€‚</p>
</blockquote>
<p>è¿˜æœ‰ä¸€ä¸ªç•¥éº»çƒ¦çš„æ–¹æ³•ï¼Œåœ¨<a href="https://262.ecma-international.org/#sec-toprimitive">è§„èŒƒ</a>ä¸­é€šè¿‡ References ä¸­ä¸€ä¸ªä¸€ä¸ªæ‰¾åˆ°å¼•ç”¨æ­¤ç®—æ³•çš„å…¶ä»–æ“ä½œï¼Œç„¶åä¸€å±‚ä¸€å±‚å»æŸ¥å“ªäº›æ–¹æ³•æœ‰ä½¿ç”¨äº†è¿™ç§æ“ä½œï¼Œç„¶åæ€»ç»“åˆ—å‡ºæ¥ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c3131891163a0749.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>å››ã€å…¶ä»–</h2>
<p>æ­¤å‰å†™è¿‡ä¸å°‘ä¸ JavaScript æ•°æ®ç±»å‹ç›¸å…³çš„æ–‡ç« ï¼Œå¦‚æœå¯¹æ­¤ä¸ç†Ÿçš„ç«¥é‹ï¼Œå¯ä»¥çœ‹ä¸€çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/240">ç›¸ç­‰æ¯”è¾ƒè¯¦è§£</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/242">æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/241">valueOf å’Œ toString æ–¹æ³•</a></li>
<li><a href="https://262.ecma-international.org/#sec-type-conversion">ECMAScript Type Conversion</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | è¯¦è°ˆä¸€ä¸‹ NaN]]></title>
            <link>https://github.com/toFrankie/blog/issues/291</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/291</guid>
            <pubDate>Sun, 26 Feb 2023 13:04:21 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d85ecd58f0b6aa59.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Freepik"></p>]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d85ecd58f0b6aa59.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Freepik"></p>
<h2>NaN çš„æ€ªè¯è¡Œä¸ºï¼Ÿ</h2>
<p>NaN æ˜¯ Not-A-Number çš„ç®€å†™ï¼Œè¡¨ç¤ºã€Œä¸æ˜¯ä¸€ä¸ªæ•°å­—ã€çš„æ„æ€ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œå®ƒå´æ˜¯ Number ç±»å‹ã€‚</p>
<pre><code class="language-js">typeof NaN === 'number' // true
</code></pre>
<p><strong>å¹³å¸¸æ‰€å†™çš„ <code>NaN</code> åªæ˜¯ã€Œå…¨å±€å˜é‡ã€çš„ä¸€ä¸ªã€Œå±æ€§ã€è€Œå·²ï¼Œè¯¥å±æ€§çš„ã€Œåˆå§‹å€¼ã€ä¸º NaNã€‚</strong></p>
<blockquote>
<p>ä¸ºäº†ä¾¿äºåŒºåˆ†ï¼Œä¸‹æ–‡ä¸­é«˜äº® <code>NaN</code> è¡¨ç¤ºå…¨å±€å˜é‡çš„å±æ€§ï¼ŒNaN è¡¨ç¤ºå±æ€§å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>ç±»ä¼¼çš„è¿˜æœ‰Â <code>undefined</code>ã€<code>Infinity</code>ã€<code>globalThis</code>ï¼Œå®ƒä»¬éƒ½æ˜¯å…¨å±€å¯¹è±¡å±æ€§ã€‚</p>
</blockquote>
<p>å‰é¢æ•…æ„æåˆ° <code>NaN</code> çš„åˆå§‹å€¼ä¸º NaNï¼ŒåŸå› æ˜¯åœ¨ ES3 æ—¶ä»£ï¼Œè¯¥å±æ€§æ˜¯å¯ä»¥è¢«è¦†ç›–çš„ï¼Œä¹Ÿå°±æ˜¯ writable çš„ï¼ˆè¿™ç‚¹ä¸ <code>undefined</code> è¡¨ç°æ˜¯ä¸€è‡´çš„ï¼‰ï¼Œè‡ª ES5 èµ·å°±ä¸å¯è¢«é‡æ–°èµ‹å€¼äº†ã€‚</p>
<blockquote>
<p><a href="https://262.ecma-international.org/#sec-value-properties-of-the-global-object">The value of NaN is <em>NaN</em>.</a></p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>NaN æ˜¯ JavaScript ä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºå…¶æœ¬èº«çš„å€¼</strong>ã€‚è¿™æ ·çš„è¯ï¼Œå…¨ç­‰æ¯”è¾ƒç»“æœä¸º <code>false</code> æ˜¯ä¸æ˜¯çœ‹èµ·æ¥åˆä¹æƒ…ç†äº†ï¼Ÿ</p>
<pre><code class="language-js">NaN === NaN // false
</code></pre>
<p>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥å¿«é€Ÿåœ°å†™å‡ºä¸€ä¸ªåˆ¤æ–­æŸä¸ªå€¼æ˜¯å¦ä¸º NaN çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-js">const myIsNaN = x =&gt; x !== x

myIsNaN(NaN) // true
</code></pre>
<p>å°ç»“ï¼š</p>
<ul>
<li>NaN è¡¨ç¤ºä¸€ä¸ªä¸ä¸ºæ•°å­—çš„å€¼ï¼Œä½†å®ƒç±»å‹æ˜¯ Number ç±»å‹ã€‚</li>
<li>NaN æ˜¯ JavaScript ä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºå…¶æœ¬èº«çš„å€¼ã€‚</li>
<li><code>NaN === NaN</code> çš„æ¯”è¾ƒç»“æœä¸º <code>false</code>ã€‚</li>
</ul>
<h2>isNaN()ã€Number.isNaN()ã€Number.NaN å‚»å‚»åˆ†ä¸æ¸…ï¼Ÿ</h2>
<p>å…ˆä¸Šå‡ ä¸ªèœå°å°é²œï¼š</p>
<pre><code class="language-js">NaN == NaN // false
NaN === NaN // false
NaN === Number.NaN // false
</code></pre>
<pre><code class="language-js">isNaN(NaN) // true
isNaN('NaN') // true
isNaN('string') // true
isNaN(undefined) // true
isNaN({}) // true
isNaN('11abc') // true
isNaN(new Date().toString()) // true

isNaN(null) // false
isNaN(10) // false
isNaN('10') // false
isNaN('10.2') // false
isNaN('') // false
isNaN(' ') // false
isNaN(new Date()) // false
</code></pre>
<pre><code class="language-js">Number.isNaN(NaN) // true
Number.isNaN(Number.NaN) // true
Number.isNaN(0 / 0) // true

Number.isNaN('NaN') // false
Number.isNaN('') // false
Number.isNaN(' ') // false
Number.isNaN(10) // false
Number.isNaN(undefined) // false
Number.isNaN(null) // false
Number.isNaN({}) // false
Number.isNaN(new Date()) // false
Number.isNaN(new Date().toString()) // false
</code></pre>
<p>å¸Œæœ›ä½ æ²¡æœ‰æ™•ï¼Œå…¶å®æŒæ¡å†…åœ¨åŸç†å°±å¾ˆç®€å•äº†ï¼Œæœ€å¤šæ˜¯ã€Œåç›´è§‰ã€è€Œå·²...</p>
<h3>Number.NaN</h3>
<p>å®ƒæ˜¯å†…ç½®å¯¹è±¡ <code>Number</code> æä¾›çš„ä¸€ä¸ªã€Œé™æ€å±æ€§ã€ï¼Œå…¶å€¼å°±æ˜¯ NaNï¼Œä¸”ã€Œ<strong>åªè¯»</strong>ã€ã€‚</p>
<p>ä» <a href="https://www.ecma-international.org/wp-content/uploads/ECMA-262_1st_edition_june_1997.pdf">ECMAScript 1st Edition #15.7.3.4</a> å¯ä»¥çœ‹åˆ°ï¼š</p>
<blockquote>
<p>The value of Number.NaN is <em>NaN</em>.
This property shall have the attributes { DontEnum, DontDelete, ReadOnly }.</p>
</blockquote>
<p>è¿™å¤§æ¦‚å°±æ˜¯ä¸å…¨å±€å¯¹è±¡å±æ€§ <code>NaN</code> çš„å”¯ä¸€åŒºåˆ«å§ã€‚</p>
<h3>isNaN()</h3>
<p>å®ƒæ˜¯å…¨å±€å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸º NaNã€‚</p>
<p>ä» <a href="https://www.ecma-international.org/wp-content/uploads/ECMA-262_1st_edition_june_1997.pdf">ECMAScript 1st Edition #15.1.2.6</a> å¯ä»¥çœ‹åˆ°ï¼š</p>
<blockquote>
<p>Applies <em>ToNumber</em> to its argument, then returns true if the result is <em>NaN</em>, and otherwise returns false.</p>
</blockquote>
<p>ä»è§„èŒƒæè¿°å¯çŸ¥ï¼Œå®ƒå†…éƒ¨åšäº†ã€Œç±»å‹è½¬æ¢ã€ã€‚</p>
<p>ä»¥ <code>isNaN(x)</code> ä¸ºä¾‹ï¼Œå®ƒå…ˆå°† <code>x</code> è½¬æ¢ä¸º Number ç±»å‹ï¼ˆå³è§„èŒƒä¸­çš„ <a href="https://262.ecma-international.org/#sec-tonumber">ToNumber</a> æŠ½è±¡æ“ä½œï¼‰ï¼Œç„¶åå†åˆ¤æ–­è½¬æ¢åçš„å€¼æ˜¯å¦ä¸º NaNï¼Œè‹¥ä¸º NaN è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const str = 'string'

isNaN(str) // true

// ç›¸å½“äº
const transformedStr = Number(str) // NaN
isNaN(transformedStr) // true
</code></pre>
<p>è¿™æ ·çš„ç‰¹æ€§æœ‰ä»€ä¹ˆç”¨å‘¢ï¼ŒMDN æ˜¯è¿™æ ·ä»‹ç»çš„ï¼Œè¯·çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/isNaN#useful_special-case_behavior">è¿™é‡Œ</a>ã€‚</p>
<p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå†™å‡ºå…¶ Polyfill æ–¹æ³•ï¼š</p>
<pre><code class="language-js">globalThis.myIsNaN = function (value) {
  const transformedValue = Number(vulue)
  return transformedValue != transformedValue
}
</code></pre>
<blockquote>
<p>è‹¥å¯¹æ•°æ®ç±»å‹è½¬æ¢ä¸æ˜¯å¤ªç†Ÿï¼Œå¯ä»¥é˜…è¯»æ–‡ç«  ğŸ‘‰<a href="https://github.com/toFrankie/blog/issues/242">ï¼ˆéšå¼ï¼‰æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£</a>ã€‚</p>
</blockquote>
<h3>Number.isNaN()</h3>
<p>ä»å‘½åä¸Šçœ‹ï¼Œ<code>globalThis.isNaN()</code> å®ƒæ˜¯åç›´è§‰çš„ï¼Œå®ƒå·å·ç»™æˆ‘ä»¬åšäº†ä¸€æ¬¡ç±»å‹è½¬æ¢ã€‚</p>
<p>å¯èƒ½æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥ ES6 æ ‡å‡†ä¸­æä¾›äº†ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³• <code>Number.isNaN()</code>ï¼Œå…¶å†…éƒ¨é€»è¾‘å¦‚ä¸‹ï¼ˆ<a href="https://262.ecma-international.org/#sec-number.isnan">å¯çœ‹</a>ï¼‰ï¼š</p>
<blockquote>
<ol>
<li>è‹¥å…¥å‚å€¼ä¸æ˜¯ Number ç±»å‹ï¼Œåˆ™è¿”å› <code>false</code>ï¼›</li>
<li>è‹¥å…¥å‚å€¼ä¸º <code>NaN</code> åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
</ol>
</blockquote>
<p>ä¸ <code>isNaN()</code> ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä¼šå¯¹ä¼ å…¥çš„å€¼åšç±»å‹è½¬æ¢ã€‚å› æ­¤ï¼Œå¯ä»¥å¿«é€Ÿå†™å‡ºå…¶ Polyfill æ–¹æ³•ï¼š</p>
<pre><code class="language-js">Number.myIsNaN = function (value) {
  if (typeof value !== 'number') return false
  return value !== value
}
</code></pre>
<p>éƒ½ 2022 å¹´äº†ï¼Œéƒ½ç”¨ <code>Number.isNaN()</code> æ¥åˆ¤æ–­å§ï¼Œå…¶ä½™çš„å°±äº¤ç»™ Babel äº†ã€‚</p>
<h3>å°ç»“</h3>
<ul>
<li><code>Number.NaN</code> é™æ€å±æ€§çš„è¿”å›å€¼æ­£æ˜¯ NaN æœ¬èº«ï¼Œè¯¥å±æ€§åªè¯»ã€‚</li>
<li>åœ¨ ES5 åŠä»¥ä¸Šï¼Œå¯ä»¥è®¤ä¸º <code>globalThis.NaN</code> ç­‰ä»·äº <code>Number.NaN</code>ï¼Œå®ƒä»¬çš„å€¼å‡ä¸º NaNã€‚</li>
<li><code>isNaN()</code> æ¯” <code>Number.isNaN()</code> å¤šäº†ä¸€ä¸ª <code>Number()</code> è¿‡ç¨‹ï¼Œå®é™…é¡¹ç›®ä¸­è‹¥è¦åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸º NaNï¼Œå»ºè®®ä½¿ç”¨åè€…ã€‚</li>
</ul>
<h2>indexOf() å’Œ includes() å¯¹ NaN æ˜¯å¦‚ä½•åˆ¤æ–­çš„ï¼Ÿ</h2>
<p>å…¶å®åœ¨å¦ä¸€ç¯‡æ–‡ç« ã€Š<a href="https://github.com/toFrankie/blog/issues/240">ç›¸ç­‰æ¯”è¾ƒè¯¦è§£</a>ã€‹å·²ç»ä»‹ç»è¿‡äº†ã€‚</p>
<pre><code class="language-js">const arr = [NaN]

arr.indexOf(NaN) // -1
arr.includes(NaN) // true
</code></pre>
<p>ç©¶å…¶åŸå› ï¼Œæ˜¯ç”±äºå…¶å†…éƒ¨ä½¿ç”¨äº†ä¸åŒçš„æ¯”è¾ƒç®—æ³•ã€‚</p>
<ul>
<li><a href="https://262.ecma-international.org/#sec-array.prototype.indexof"><code>Array.prototype.indexOf()</code></a> ä½¿ç”¨äº†Â <a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">Number::equal (x, y)</a> ç®—æ³•ã€‚</li>
<li><a href="https://262.ecma-international.org/#sec-array.prototype.includes"><code>Array.prototype.includes()</code></a> ä½¿ç”¨äº† <a href="https://262.ecma-international.org/#sec-numeric-types-number-sameValueZero">Number::sameValueZero (x, y)</a> ç®—æ³•ã€‚</li>
</ul>
<p>è¿™ä¿©ç®—æ³•å¯¹ NaN çš„å¤„ç†å¦‚ä¸‹ï¼ˆ<a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">è¯¦è§</a>ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e922050bcbca56ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦å¤–ï¼Œ<a href="https://262.ecma-international.org/#sec-strict-equality-comparison">å…¨ç­‰æ¯”è¾ƒ</a>ä¹Ÿä½¿ç”¨äº† <a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">Number::equal (x, y)</a> ç®—æ³•ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d3b085e0ddd03730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>ä¸¤ä¸ª Number ç±»å‹çš„å€¼çš„æ¯”è¾ƒï¼Œå…¶å®éƒ½æ˜¯å›´ç»•äº†è¿™ä¸‰ä¸ªç®—æ³•ï¼š<a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">Number::equal (x, y)</a>ã€<a href="https://262.ecma-international.org/#sec-numeric-types-number-sameValue">Number:: sameValue (x, y)</a>ã€<a href="https://262.ecma-international.org/#sec-numeric-types-number-sameValueZero">Number::sameValueZero (x, y)</a>ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹ã€‚å®ƒä»¬ä¹‹ä¸­æ¯”è¾ƒç‰¹åˆ«çš„å€¼æ— éå°±æ˜¯ <code>+0</code>ã€<code>-0</code>ã€<code>NaN</code>ã€‚</p>
</blockquote>
<h2>å…¶ä»–</h2>
<p>æ­¤å‰å†™è¿‡ä¸å°‘å…³äº JavaScript æ•°æ®ç±»å‹çš„ä¸€äº›æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/241">valueOf å’Œ toString æ–¹æ³•</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/234">JavaScript çš„è¿·æƒ‘è¡Œä¸ºå¤§èµ</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/240">ç›¸ç­‰æ¯”è¾ƒè¯¦è§£</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/242">ï¼ˆéšå¼ï¼‰æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Prettier ç»ˆäºæ”¯æŒç¼“å­˜ç­–ç•¥äº†]]></title>
            <link>https://github.com/toFrankie/blog/issues/290</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/290</guid>
            <pubDate>Sun, 26 Feb 2023 13:03:27 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a70fbd245bd36d5d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å¥—æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a70fbd245bd36d5d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å¥—æºè‡ª Freepik"></p>
<p>å°±åœ¨æ˜¨å¤© Prettier å‘å¸ƒäº† v2.7.0 ç‰ˆæœ¬ï¼ˆ<a href="https://prettier.io/blog/2022/06/14/2.7.0.html">Release Note</a>ï¼‰ï¼Œå®ƒç»ˆäºæ”¯æŒç¼“å­˜äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-518296c3a3925455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>--cache</h2>
<p>åœ¨ CLI ä¸­æ·»åŠ  <code>--cache</code> å‚æ•°ï¼š</p>
<pre><code class="language-shell">prettier --cache --write .
</code></pre>
<p>å½“ Prettier ç‰ˆæœ¬ã€Prettier é…ç½®ã€Node ç‰ˆæœ¬å‘ç”Ÿå˜åŒ–ï¼Œä»¥åŠæ»¡è¶³ <code>--cache-strategy</code> æ¡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œæ ¼å¼åŒ–ã€‚</p>
<h2>--cache-strategy</h2>
<p>å…¶ç¼“å­˜ç­–ç•¥ç±»ä¼¼äº <a href="https://eslint.org/docs/user-guide/command-line-interface#--cache-strategy">ESLint</a>ã€‚</p>
<pre><code class="language-shell">prettier --cache --cache-strategy metadata --write .
</code></pre>
<p>å–å€¼æ”¯æŒ <code>metadata</code> å’Œ <code>content</code>ï¼ˆé»˜è®¤ï¼‰ï¼Œå‰è€…å¯æ ¹æ®æ–‡ä»¶å…ƒæ•°æ®çš„å˜æ›´ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼‰è€Œè§¦å‘ï¼Œåè€…åˆ™æ ¹æ®æ–‡ä»¶å†…å®¹æ˜¯å¦å˜æ›´æ¥è§¦å‘ã€‚</p>
<h2>å…¶ä»–</h2>
<p>å¦ä¸€ä¸ªå¸¸ç”¨çš„æ ¼å¼åŒ–å·¥å…· <a href="https://stylelint.io/user-guide/usage/options#cache">Stylelint</a> åˆ™æ—©å·²æ”¯æŒï¼Œå®ƒè¿˜æ”¯æŒ CSS æ’åºï¼Œå¯¹äºæˆ‘è¿™æ ·çš„å¼ºè¿«ç—‡ï¼Œè¿™åŠŸèƒ½å¤ªçˆ±äº†ï¼Œå¦‚æœ Prettier ä¹Ÿæ”¯æŒå°±å¥½äº†ï¼ˆä½† Prettier ä¼¼ä¹æ²¡æœ‰è¿™ä¸ªè®¡åˆ’ï¼Œ<a href="https://github.com/prettier/prettier/issues/1963">#1963</a>ï¼‰ã€‚ç¤¾åŒºä¸Šä¹Ÿæœ‰ä¸€ä¸ª Prettier æ’ä»¶ <a href="https://github.com/tujoworker/prettier-plugin-rational-order">prettier-plugin-rational-order</a>ï¼Œä¹Ÿæ˜¯åŸºäº Stylelint æ’ä»¶ä¿®æ”¹çš„ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[requestAnimationFrame ä½¿ç”¨]]></title>
            <link>https://github.com/toFrankie/blog/issues/289</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/289</guid>
            <pubDate>Sun, 26 Feb 2023 13:02:48 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b190e36b0b8ca357.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b190e36b0b8ca357.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€requestAnimationFrame</h2>
<p>ä» <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">MDN</a> ä»‹ç»å¯çŸ¥ï¼š</p>
<blockquote>
<p>è°ƒç”¨ <code>window.requestAnimationFrame()</code> æ–¹æ³•å‘ŠçŸ¥æµè§ˆå™¨ï¼Œå¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚</p>
</blockquote>
<p>ä»è¿™å¥è¯å¯ä»¥çœ‹å‡ºï¼Œå®ƒç›¸æ¯” <code>setTimeout</code> ç­‰ API çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å‡å°‘ DOM é‡ç»˜çš„æ¬¡æ•°ã€‚</p>
<p>è¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre><code class="language-js">window.requestAnimationFrame(callback)
</code></pre>
<p>å®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå³ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»å¸§æ‰€è°ƒç”¨çš„å‡½æ•°ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªéé›¶ä¸”å”¯ä¸€çš„ <code>requestId</code>ï¼ˆå¯ä»¥ä¼ ç»™ <code>window.cancelAnimationFrame()</code> ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ï¼‰ã€‚</p>
<p>å›è°ƒå‡½æ•°å°†ä¼šè¢«ä¼ å…¥ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp"><code>DOMHighResTimeStamp</code></a> å‚æ•°ï¼Œè¡¨ç¤º <code>requestAnimationFrame()</code> å¼€å§‹å»æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚</p>
<p>çœ‹ä¸€ä¸‹ MDN ç»™å‡ºçš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
      #foo {
        width: 100px;
        height: 100px;
        background-color: rebeccapurple;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;foo&quot;&gt;&lt;/div&gt;
    &lt;script&gt;
      let start
      const element = document.getElementById('foo')

      function step(timestamp) {
        if (start === undefined) start = timestamp
        const elapsed = timestamp - start

        // è¿™é‡Œä½¿ç”¨ `Math.min()` ç¡®ä¿å…ƒç´ åˆšå¥½åœåœ¨ 200px çš„ä½ç½®ã€‚
        element.style.transform = `translateX(${Math.min(0.1 * elapsed, 200)}px)`

        if (elapsed &lt; 2000) {
          // åœ¨ä¸¤ç§’ååœæ­¢åŠ¨ç”»
          window.requestAnimationFrame(step)
        }
      }

      window.requestAnimationFrame(step)
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>æ•ˆæœå¯çœ‹ä¸‹ ğŸ‘‰ <a href="https://codesandbox.io/s/request-animation-frame-demo-280e0p?file=/index.html">CodeSandbox</a>ã€‚</p>
<p>å¸§åŠ¨ç”»å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°å–å†³äºã€Œå±å¹•åˆ·æ–°ç‡ã€ï¼Œä»¥ 60Hzï¼ˆè¡¨ç¤ºæ¯ç§’é’Ÿå›¾åƒåˆ·æ–°çš„æ¬¡æ•°ï¼‰çš„å±å¹•æ¥è¯´ï¼Œçº¦ 16.7ms ä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>requestAnimationFrame()</code> çš„å›è°ƒå‡½æ•°çº¦ 16.7ms å°±ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>è€Œä¸”ï¼Œåœ¨å¤šæ•°æµè§ˆå™¨ä¸­ï¼Œå½“ <code>requestAnimationFrame()</code> å¤„äºåå°æ ‡ç­¾é¡µæˆ–è€…è¢«éšè—çš„ <code>&lt;iframe&gt;</code> å…ƒç´ é‡Œï¼Œå®ƒä¼šè¢«æš‚åœè°ƒç”¨ä»¥æå‡æ€§èƒ½å’Œç”µæ± å¯¿å‘½ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<!--

## References

* [2022 å¹´äº†,çœŸçš„æ‡‚ requestAnimationFrame ä¹ˆï¼Ÿ](https://juejin.cn/post/7062178363800027173)
* [æ·±å…¥å­¦ä¹ å®šæ—¶å™¨](http://www.alloyteam.com/2021/03/15389/)
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[HTML è¡¨å•å…ƒç´ çš„è‡ªåŠ¨å¡«å……ä¸èšç„¦æ ·å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/288</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/288</guid>
            <pubDate>Sun, 26 Feb 2023 13:01:10 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7cc9044d782ebe65.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7cc9044d782ebe65.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©æ¥çœ‹ä¸€ä¸‹ä¸è¡¨å•å…ƒç´ ç›¸å…³çš„ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<ul>
<li><code>outline</code>ï¼šç»˜åˆ¶è½®å»“æ ·å¼</li>
<li><code>autocomplete</code>ï¼šè¡¨å•è‡ªåŠ¨å¡«å……åŠŸèƒ½</li>
</ul>
<h2>outline</h2>
<p>åœ¨ç»å¤§å¤šæ•°æµè§ˆå™¨ä¸­ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ æ˜¯å¯äº¤äº’çš„ï¼Œå®ƒä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ªå¯è§çš„èšç„¦æç¤ºã€‚æ¯”å¦‚ Chrome æµè§ˆå™¨ä¸‹å½“ <code>&lt;input&gt;</code> èšç„¦æ—¶ï¼Œé»˜è®¤ä¼šæœ‰ä¸€ä¸ªè“è‰²çš„è¾¹æ¡†ã€‚</p>
<blockquote>
<p>ä»ç”¨æˆ·äº¤äº’ä½“éªŒä¸Šè®²ï¼Œæµè§ˆå™¨è¿™ç§æç¤ºæ˜¯å¥½çš„ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªè‰¯å¥½çš„æŒ‰é’®äº¤äº’ï¼Œåº”è¯¥è¦åŒ…æ‹¬è¢«æŒ‰ä¸‹é‚£ä¸€åˆ»çš„æ ·å¼ã€‚</p>
</blockquote>
<p>ä½†å¯èƒ½é»˜è®¤æ ·å¼ä¸ä½ çš„é¡µé¢é£æ ¼ä¸ç›¸ç¬¦ï¼Œç„¶åå°±éœ€è¦å…ˆç§»é™¤é»˜è®¤æ ·å¼ï¼Œç„¶åå†è‡ªå®šä¹‰ã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸€ä¸ª <code>&lt;input&gt;</code> å…ƒç´ èšç„¦æ—¶ï¼Œåœ¨ä¸æ·»åŠ ä»»ä½•æ ·å¼æƒ…å†µä¸‹ï¼ŒChrome æµè§ˆå™¨è¡¨ç°å¦‚ä¸‹å›¾ï¼š</p>
<pre><code class="language-html">&lt;input type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥æ–‡æœ¬&quot; /&gt;
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2984a78ab01b1597.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æƒ³è¦ç§»é™¤è¿™ç§é»˜è®¤èšç„¦æ ·å¼ï¼Œéå¸¸åœ°ç®€å•ï¼Œåªè¦æ·»åŠ ä»¥ä¸‹æ ·å¼å³å¯ï¼š</p>
<pre><code class="language-css">input {
  outline: none;
} 
</code></pre>
<p>å°† <code>outline</code> è®¾ç½®ä¸º <code>0</code> æˆ– <code>none</code> ä¼šç§»é™¤æµè§ˆå™¨çš„é»˜è®¤èšç„¦æ ·å¼ã€‚</p>
<p><code>outline</code> æ˜¯ <code>outline-style</code>ã€<code>outline-width</code>ã€<code>outline-color</code> çš„ç®€å†™ï¼Œç”¨äºç»˜åˆ¶å…ƒç´ è½®å»“çš„æ ·å¼ã€‚</p>
<blockquote>
<p>å®ƒè·Ÿ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/border">boder</a> å¾ˆç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº <code>outline</code> ä¸å æ®ç©ºé—´ï¼Œç»˜åˆ¶äºå…ƒç´ å†…å®¹å‘¨å›´ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¹äºå¾ˆå¤šå…ƒç´ æ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ ·å¼ï¼Œè½®å»“æ˜¯ä¸å¯è§çš„ã€‚å› ä¸ºæ ·å¼çš„é»˜è®¤å€¼æ˜¯ <code>none</code>ã€‚ä½† <code>&lt;input&gt;</code> å…ƒç´ æ˜¯ä¾‹å¤–ï¼Œå…¶æ ·å¼é»˜è®¤å€¼ç”±æµè§ˆå™¨å†³å®šã€‚</p>
</blockquote>
<p>è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">/* æ ·å¼ */
outline: solid;

/* é¢œè‰² | æ ·å¼ */
outline: #f66 dashed;

/* æ ·å¼ | å®½åº¦ */
outline: inset thick;

/* é¢œè‰² | æ ·å¼ | å®½åº¦ */
outline: green solid 3px;
</code></pre>
<p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæˆ‘è¿˜çœŸåªè§è¿‡ç§»é™¤é»˜è®¤æ ·å¼ï¼Œè¿˜æ²¡æœ‰é‡åˆ°ä¸»åŠ¨è®¾ç½®æ ·å¼çš„ã€‚å› æ­¤å–å€¼ä¸åšè¯¦ç»†ä»‹ç»ï¼Œæ›´å¤šè¯·çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/outline#values">MDN</a>ã€‚</p>
<h2>autocomplete</h2>
<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªç°è±¡ï¼Œå½“æˆ‘ä»¬èšç„¦æŸä¸ªè¾“å…¥æ¡†çš„æ—¶ï¼Œæµè§ˆå™¨ä¼šæœ‰ä¸€ä¸ªå†å²è¾“å…¥çš„æç¤ºï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;input name=&quot;nickname&quot; type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot; /&gt;
</code></pre>
<p>Chrome æµè§ˆå™¨å¯èƒ½ä¼šå‡ºç°å¦‚å›¾ç±»ä¼¼ã€Œå»ºè®®å€¼ã€æç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-86ce4db18b6b98d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™æ˜¯ä»€ä¹ˆå›äº‹å‘¢ï¼ŸåŸæ¥æ˜¯æµè§ˆå™¨ä¼šè®°å½•æˆ‘ä»¬çš„æ–‡æœ¬è¾“å…¥å†å²ï¼Œå½“ <code>&lt;input&gt;</code> çš„ <code>name</code> æˆ– <code>id</code> å±æ€§åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰æ­¤æç¤ºï¼ˆå‰ææ˜¯å¯ç”¨äº† <code>autocomplete</code> å±æ€§ï¼‰ã€‚ä¸Šä¸€ä¸ªç¤ºä¾‹ï¼Œç”±äº <code>&lt;input&gt;</code> å¹¶æœªè®¾ç½® <code>name</code> æˆ– <code>id</code> å±æ€§ï¼Œå› æ­¤æ˜¯æ²¡æœ‰æç¤ºçš„ã€‚</p>
<blockquote>
<p>ä½ å¯ä»¥è¯•ä¸‹æ”¹ä¸º <code>name=&quot;email&quot;</code>ï¼Œé‚£ä¹ˆæ–‡æœ¬æç¤ºå°±å¯èƒ½ä¼šå‡ºç°ä½ å¸¸è¾“å…¥çš„é‚®ç®±åœ°å€ã€‚</p>
</blockquote>
<h3>autocomplete æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Attributes/autocomplete">MDN</a> æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>HTMLÂ <code>autocomplete</code>Â å±æ€§å¯ç”¨äºä»¥æ–‡æœ¬æˆ–æ•°å­—å€¼ä½œä¸ºè¾“å…¥çš„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input"><code>&lt;input&gt;</code></a>Â å…ƒç´  ï¼ŒÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea"><code>&lt;textarea&gt;</code></a>Â å…ƒç´ ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/select"><code>&lt;select&gt;</code></a>Â å…ƒç´ ï¼Œå’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/form"><code>&lt;form&gt;</code></a>Â å…ƒç´ ã€‚Â <code>autocomplete</code>Â å…è®¸ web å¼€å‘äººå‘˜æŒ‡å®šï¼Œå¦‚æœæœ‰ä»»ä½•æƒé™Â <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent">user agent</a>Â å¿…é¡»æä¾›å¡«å†™è¡¨å•å­—æ®µå€¼çš„è‡ªåŠ¨å¸®åŠ©ï¼Œå¹¶ä¸ºæµè§ˆå™¨æä¾›å…³äºå­—æ®µä¸­æ‰€æœŸæœ›çš„ä¿¡æ¯ç±»å‹çš„æŒ‡å¯¼ã€‚</p>
</blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>&lt;input&gt;</code>ã€<code>&lt;select&gt;</code>ã€<code>&lt;textarea&gt;</code>Â è¿™äº›å…ƒç´ å…·å¤‡ä»¥ä¸‹æ¡ä»¶æ‰ä¼šæœ‰è‡ªåŠ¨å¡«å……åŠŸèƒ½ï¼š</p>
<ol>
<li>å…·æœ‰Â <code>name</code>Â æˆ–Â <code>id</code>Â å±æ€§ã€‚</li>
<li>æˆä¸ºÂ <code>&lt;form&gt;Â </code>Â çš„åä»£ã€‚</li>
<li>å…·æœ‰Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input/submit">submit</a>Â æŒ‰é’®çš„è¡¨å•ã€‚</li>
</ol>
<p>è‡ªåŠ¨å¡«å……çš„å»ºè®®å€¼æ¥æºé€šå¸¸å–å†³äºæµè§ˆå™¨ã€‚ ä¸€èˆ¬æ˜¯æ¥è‡ªç”¨æˆ·è¾“å…¥çš„è¿‡å»å€¼ï¼Œä½†å®ƒä»¬ä¹Ÿå¯èƒ½æ¥è‡ªé¢„å…ˆé…ç½®çš„å€¼ã€‚</p>
<p>è‡ªåŠ¨å¡«å……åŠŸèƒ½é€šå¸¸æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œå¦‚æœæƒ³è¦å…³é—­ï¼Œå¯ä»¥ä¸ºæ•´ä¸ªè¡¨å•è®¾ç½®æˆ–ä¸ºè¡¨å•ä¸­æŸä¸ªè¾“å…¥å…ƒç´ å•ç‹¬è®¾ç½®ï¼š</p>
<pre><code class="language-html">&lt;form id=&quot;form1&quot; autocomplete=&quot;off&quot;&gt;
  &lt;!-- è¿™æ—¶ï¼Œå…¶ä¸‹å±è¡¨å•å…ƒç´ å°†ä¼šé»˜è®¤å…³é—­ autocomplete --&gt;
  &lt;input name=&quot;nickname&quot; type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot; /&gt;
&lt;/form&gt;
</code></pre>
<pre><code class="language-html">&lt;form id=&quot;form2&quot;&gt;
  &lt;!-- å¯å¯¹å…¶ä¸‹å±è¡¨å•å…ƒç´ ç‹¬ç«‹è®¾ç½® autocomplete --&gt;
  &lt;input name=&quot;nickname&quot; type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot; autocomplete=&quot;off&quot; /&gt;
&lt;/form&gt;
</code></pre>
<pre><code class="language-html">&lt;form id=&quot;form3&quot; autocomplete=&quot;off&quot;&gt;
  &lt;!-- å½“ form å’Œä¸‹å±è¡¨å•å…ƒç´ åŒæ—¶æŒ‡å®š autocomplete æ—¶ï¼Œä¸‹å±è¡¨å•ä¼šè¦†ç›– form å…ƒç´ çš„æŒ‡å®š --&gt;
  &lt;input name=&quot;nickname&quot; type=&quot;text&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot; autocomplete=&quot;on&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>è®¾ç½® <code>autocomplete=&quot;off&quot;</code> ä¼šæœ‰ä¸¤ç§æ•ˆæœï¼š</p>
<ul>
<li>è¿™ä¼šå‘Šè¯‰æµè§ˆå™¨ï¼Œä¸è¦ä¸ºäº†ä»¥ååœ¨ç±»ä¼¼è¡¨å•ä¸Šè‡ªåŠ¨å¡«å……è€Œä¿å­˜ç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚<strong>ä½†æµè§ˆå™¨ä¸ä¸€å®šéµå®ˆ</strong>ã€‚</li>
<li>è¿™ä¼šé˜»æ­¢æµè§ˆå™¨ç¼“å­˜ä¼šè¯å†å²è®°å½•ä¸­çš„æ•°æ®ã€‚è‹¥è¡¨å•æ•°æ®ç¼“å­˜äºä¼šè¯å†å²è®°å½•ï¼Œç”¨æˆ·æäº¤è¡¨å•åï¼Œå†ç‚¹å‡»è¿”å›æŒ‰é’®è¿”å›ä¹‹å‰çš„è¡¨å•é¡µé¢ï¼Œåˆ™ä¼šæ˜¾ç¤ºç”¨æˆ·ä¹‹å‰è¾“å…¥çš„æ•°æ®ã€‚</li>
</ul>
<p>å¦‚æœå³ä½¿åœ¨ <code>autocomplete</code> å·²ç»è®¾ç½®ä¸º <code>off</code> æ—¶ï¼Œæµè§ˆå™¨ä»ç»§ç»­æä¾›è¾“å…¥å»ºè®®ï¼Œé‚£ä¹ˆä½ éœ€è¦æ›´æ”¹è¾“å…¥å…ƒç´ çš„ <code>name</code> å±æ€§ã€‚</p>
<h3>å…¶ä»–</h3>
<p>è®¸å¤šç°ä»£æµè§ˆå™¨ï¼Œä¸æ”¯æŒåœ¨ç™»å½•å­—æ®µä¸­è®¾ç½® <code>autocomplete=&quot;off&quot;</code>ï¼ˆå³ä½¿è®¾ç½®äº†ä¹Ÿä¼šæœ‰æç¤ºï¼‰ï¼Œå› ä¸ºæµè§ˆå™¨å†…ç½®äº†å¯†ç ç®¡ç†ï¼Œå®ƒä»¬è®¤ä¸ºå¯¹å®‰å…¨æ˜¯æœ‰ç›Šæ— å®³çš„ã€‚æ›´å¤šè¯·çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion#the_autocomplete_attribute_and_login_fields">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>Â åœ¨å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨ä¸­ï¼ŒÂ <code>autocomplete</code>Â è®¾ç½®ä¸º <code>&quot;off&quot;</code> ä¸ä¼šé˜»æ­¢å¯†ç ç®¡ç†å™¨è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦ä¿å­˜ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ï¼Œæˆ–è€…è‡ªåŠ¨åœ¨ç½‘ç«™çš„ç™»å½•è¡¨å•ä¸­å¡«å†™è¿™äº›å€¼ã€‚ è¯·å‚é˜…Â <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion#the_autocomplete_attribute_and_login_fields">the autocomplete attribute and login fields</a>ã€‚</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å¯†ç å­—æ®µé˜»æ­¢è‡ªåŠ¨å¡«å……ï¼Œå¯ä»¥æ·»åŠ  <code>autocomplete=&quot;new-password&quot;</code> æ¥é¿å…æ„å¤–å¡«å†™ç°æœ‰å¯†ç ï¼š</p>
<pre><code class="language-html">&lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;è¯·è¾“å…¥å¯†ç &quot; autocomplete=&quot;new-password&quot; /&gt;
</code></pre>
<p>é™¤äº†å¸¸è§çš„ <code>&quot;on&quot;</code>ã€<code>&quot;off&quot;</code> ä¹‹å¤–ï¼Œæ›´å¤š <code>autocomplete</code> å–å€¼è¯·çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete#values">è¿™é‡Œ</a>ã€‚</p>
<h3>å°ç»“</h3>
<p>æŒ‰ç…§è§„èŒƒï¼Œå½“æŒ‡å®š <code>autocomplete=&quot;on&quot;</code> æˆ– <code>autocomplete=&quot;off&quot;</code> æ—¶ï¼Œä¼šå¯ç”¨æˆ–å…³é—­è‡ªåŠ¨å¡«å……åŠŸèƒ½ã€‚ä½†æ˜¯å®é™…æƒ…å†µæ˜¯ï¼Œæµè§ˆå™¨ä¸ä¸€å®šéµå¾ªæ ‡å‡†å®ç°ã€‚</p>
<p>æ‰€ä»¥ï¼Œè§„èŒƒåªæ˜¯å¼Ÿå¼Ÿï¼Œæµè§ˆå™¨å‚å•†æ‰æ˜¯å¤§çˆ·å•Šã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete">HTML attribute: autocomplete</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site/Turning_off_form_autocompletion">How to turn off form autocompletion</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form#attr-autocomplete">The Form element</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input#autocomplete">The Input (Form Input) element</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸ºä»€ä¹ˆç”¨ void 0 ä»£æ›¿ undefinedï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/287</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/287</guid>
            <pubDate>Sun, 26 Feb 2023 13:00:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-913c4fcc3b5a407f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-913c4fcc3b5a407f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>void</code> è¿ç®—ç¬¦æ€»ä¼šè¿”å›ä¸€ä¸ª <code>undefined</code> çš„ç»“æœã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨ <code>void 0</code> ä»£æ›¿ <code>undefined</code> å‘¢ï¼Ÿè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾äº†å—ï¼Ÿ</p>
<p>ä¸æ€¥ï¼Œæ…¢æ…¢é“æ¥~</p>
<h2>void è¿ç®—ç¬¦</h2>
<p>è¯­æ³•éå¸¸ç®€å•ï¼š</p>
<pre><code class="language-js">void expression
</code></pre>
<p>å®ƒå°†ä¼šå¯¹è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç„¶åè¿”å› <code>undefined</code> çš„ã€ŒåŸå§‹å€¼ã€ã€‚é‚£ä¹ˆï¼Œ<code>void 0</code> ä¸å°±æ˜¯å¾—åˆ° <code>undefined</code> æœ€ç®€å•çš„å†™æ³•å˜›ï¼</p>
<blockquote>
<p>å†™æ³•ä¸Š <code>void 0</code> ç›¸å½“äº <code>void(0)</code>ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œç«‹å³å‡½æ•°æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆIIFEï¼‰æœ‰éå¸¸å¤šçš„å†™æ³•ï¼Œä½¿ç”¨ <code>void</code> å…³é”®å­—ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">void (function () {
  // some statements
})()

// ç›¸å½“äº
void function () { /* some statements */ }()
</code></pre>
<p>å¦å¤–ï¼Œä½ åº”è¯¥çœ‹è¿‡ä»¥ä¸‹ç±»ä¼¼çš„å†™æ³•ï¼š</p>
<pre><code class="language-html">&lt;a href=&quot;javascript:0;&quot;&gt;Link&lt;/a&gt;
</code></pre>
<p>æˆ‘ä»¬çŸ¥é“ <code>javascript:</code> æ˜¯ JavaScript ä¸­çš„ä¼ªåè®®ï¼Œè¡¨ç¤ºå°†ä¼šä½¿ç”¨ JS è§£æå™¨æ‰§è¡Œå…¶åçš„æ‰€æœ‰è¯­å¥ï¼Œè‹¥å…¶æœ€åä¸€ä¸ªJavaScript è¯­å¥è¿”å›å€¼ä¸ä¸º <code>undefined</code>ï¼Œé‚£ä¹ˆå…¶è¿”å›å€¼å°†ä¼šæ›¿æ¢ä¸ºé¡µé¢å†…å®¹ã€‚</p>
<p>å°±ä»¥ä¸Š HTML æ ‡ç­¾ï¼Œåœ¨ä¸åŒæµè§ˆå™¨ä¸‹ç‚¹å‡»ï¼Œä¼šæœ‰ä¸åŒçš„ç»“æœã€‚å…¶ä¸­ Chromeã€Safari ä¸­ç‚¹å‡»æ— ä»»ä½•åé¦ˆï¼Œè€Œ Firefox ä¸­é¡µé¢å†…å®¹å°†ä¼šè¢«æ›¿æ¢ä¸º <code>0</code>ã€‚</p>
<p>ä¸ºäº†è§£å†³ä»¥ä¸Šå·®å¼‚è¡¨ç°ï¼Œé€šå¸¸çš„åšæ³•å°±æ˜¯ä½¿ç”¨ <code>void</code> å…³é”®å­—ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;a href=&quot;javascript:void(0);&quot;&gt;Link&lt;/a&gt;
</code></pre>
<p>è¿™ä¹Ÿæ˜¯å¤„ç† <code>&lt;a&gt;</code> æ ‡ç­¾é»˜è®¤è¡Œä¸ºçš„æ–¹å¼ä¹‹ä¸€ã€‚</p>
<p>è¿™ç§ä¼ªåè®®é™¤äº†åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯åœ¨æµè§ˆå™¨åœ°å€æ ã€ä¹¦ç­¾åœ°å€ä¸­ä½¿ç”¨ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¸¸ç”¨çš„ç”¨æ³•ï¼šå½“ç®­å¤´å‡½æ•°ä¸­åªæœ‰ä¸€è¡Œè¯­å¥ï¼Œä¸”ä¸éœ€è¦è¿”å›å€¼æ—¶ï¼Œåˆ™å¯ä»¥ï¼š</p>
<pre><code class="language-js">element.onclick = () =&gt; void doSomething()
</code></pre>
<h2>undefined</h2>
<p>ä½ æœ‰å¯èƒ½ä¸çŸ¥é“ï¼Œæˆ‘ä»¬å¤©å¤©å†™çš„ <code>undefined</code>ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªã€Œå…¨å±€å¯¹è±¡ã€ä¸­çš„ä¸€ä¸ªã€Œå±æ€§ã€ã€‚</p>
<pre><code class="language-js">// æµè§ˆå™¨å®¿ä¸»ç¯å¢ƒ
window.undefined === undefined // true

// Node å®¿ä¸»ç¯å¢ƒ
global.undefined === undefined // true
</code></pre>
<blockquote>
<p>é™¤äº† <code>undefined</code> ä¹‹å¤–ï¼Œç±»ä¼¼çš„è¿˜æœ‰ <code>NaN</code>ã€<code>Infinity</code>ã€<code>globalThis</code> ä¹Ÿæ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§ã€‚å®ƒä»¬çš„å±æ€§æè¿°å¯¹è±¡éƒ½æ˜¯ï¼šä¸å¯å†™ã€ä¸å¯æšä¸¾ã€ä¸å¯é…ç½®ï¼ˆè¯¦çœ‹ <a href="https://262.ecma-international.org/#sec-value-properties-of-the-global-object">ECMAScript 19.1 Value Properties of the Global Object</a>ï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">{
  [[writable]]: false,
  [[enumerable]]: false
  [[configurable]]: false
}
</code></pre>
<p>å½“ç„¶ï¼Œè¿™ä¸ªåœ¨ ES5 ä¹‹å‰æ˜¯å¯ä»¥è¢«æ”¹å†™çš„ï¼Œä¸‹é¢å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-34f79279aa012e23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IE 8"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c18205a865b8eb12.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Chrome 100"></p>
<p>ä»è¿™ä¸ªè§’åº¦çœ‹æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆç”¨ <code>void 0</code> è€Œä¸æ˜¯ <code>undefined</code> è¿™ä¸ªå…¨å±€å±æ€§äº†ã€‚</p>
<p>è¿˜æœ‰ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼š</p>
<blockquote>
<p><code>undefined</code> å¹¶ä¸æ˜¯ ECMAScript æ ‡å‡†ä¸­çš„ä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#keywords">ä¿ç•™å­—</a>ï¼Œå› æ­¤å®ƒæ˜¯å¯ä»¥è¢«ä½œä¸ºå˜é‡æ ‡è¯†ç¬¦è€Œä½¿ç”¨çš„ï¼ˆä½†é¡¹ç›®ä¸­åƒä¸‡åˆ«è¿™ä¹ˆç”¨ï¼‰ï¼Œå°±åƒ <code>window</code> ä¸€æ ·ã€‚</p>
</blockquote>
<p>åœ¨ ECMAScript æ ‡å‡†ä¸­ï¼Œä¿ç•™å­—æœ‰ä»¥ä¸‹è¿™äº›ï¼ˆ<a href="https://262.ecma-international.org/#sec-keywords-and-reserved-words">è¯¦è§ 12.6.2 Keywords and Reserved Words</a>ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ccf2d144faf1ef0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ç°ä»£æµè§ˆå™¨ä¸‹ï¼Œè¯·å¯¹æ¯”ä»¥ä¸‹ä¸‰ç§ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// ç¤ºä¾‹ä¸€
!(function () {
  var undefined = 1
  console.log(undefined) // ç»“æœæ˜¯ï¼Ÿ
})()
</code></pre>
<pre><code class="language-js">// ç¤ºä¾‹äºŒ
!(function () {
  undefined = 2
  console.log(undefined) // ç»“æœæ˜¯ï¼Ÿ
})()
</code></pre>
<pre><code class="language-js">// ç¤ºä¾‹ä¸‰
var undefined = 3
console.log(undefined) // ç»“æœæ˜¯ï¼Ÿ
</code></pre>
<pre><code class="language-js">// ç¤ºä¾‹å››
let undefined = 4
console.log(undefined) // ç»“æœæ˜¯ï¼Ÿ
</code></pre>
<p>å‰ä¸‰ä¸ªæ‰“å°ç»“æœåˆ†åˆ«æ˜¯ï¼š<code>1</code>ã€<code>undefined</code>ã€<code>undefined</code>ï¼Œæœ€åä¸€ä¸ªåˆ™åœ¨ <code>let undefined = 4</code> å¤„æŠ›å‡º SyntaxErrorã€‚</p>
<p>åŸå› åˆ†æï¼š</p>
<ul>
<li>ç¤ºä¾‹ä¸€çš„ <code>undefined</code> è¢«å£°æ˜ä¸ºä¸€ä¸ªå˜é‡æ ‡è¯†ç¬¦ï¼Œå¹¶èµ‹å€¼ä¸º <code>1</code>ï¼Œå› æ­¤æ‰“å°ç»“æœä¸º <code>1</code>ï¼›</li>
<li>ç¤ºä¾‹äºŒä¸­ <code>undefined = 2</code> è¡¨ç¤ºä¿®æ”¹å…¨å±€å˜é‡çš„ <code>undefined</code> å±æ€§ï¼ˆ<code>window.undefined</code>ï¼‰ï¼Œç”±äºå®ƒæ˜¯ <code>non-writable</code> çš„ï¼Œå› æ­¤ä¸ä¼šè¢«é‡å†™ï¼Œæ‰“å°ç»“æœè¿˜æ˜¯å…¶é»˜è®¤å€¼ <code>undefined</code>ï¼›</li>
<li>ç¤ºä¾‹ä¸‰ä¸ç¤ºä¾‹äºŒåŒç†ï¼Œåªæ˜¯å®ƒä»¬æ‰€å¤„çš„ä½œç”¨åŸŸä¸åŒç½¢äº†ï¼›</li>
<li>ç¤ºä¾‹å››åŸæ„æ˜¯ä¸ºäº†è¯´æ˜ <code>var</code> å’Œ <code>let/const</code> çš„åŒºåˆ«ï¼Œåœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œå‰è€…å£°æ˜çš„å˜é‡ä¼šè¢«æ·»åŠ è‡³å…¨å±€å¯¹è±¡ä¸Šï¼Œè€Œåè€…åˆ™ä¸ä¼šã€‚ä½†æ˜¯å®é™…æ‰§è¡Œä¸‹æ¥ï¼Œä¼šæŠ›å‡ºè¯­æ³•ï¼š<code>Uncaught SyntaxError: Identifier 'undefined' has already been declared</code>ï¼ˆç›®æµ‹æ˜¯é»˜è®¤æƒ…å†µä¸‹å°±æœ‰ä¸€ä¸ª <code>var undefined</code> çš„å£°æ˜çš„è¯­å¥äº†ï¼Œå› æ­¤ä½¿ç”¨ <code>let undefined</code> é‡å¤å£°æ˜ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¿™ç§çŒœæµ‹æš‚æœªåœ¨æ ‡å‡†ä¸­æ‰¾åˆ°ä½è¯ï¼‰ã€‚</li>
</ul>
<p>ä¸çŸ¥é“æœ‰æ²¡æœ‰äººä¼šåˆ†ä¸æ¸…ï¼š<code>undefined</code> ä»€ä¹ˆæ—¶å€™ä½œä¸ºåŸå§‹å€¼ï¼Ÿä»€ä¹ˆæ—¶å€™æ˜¯ä½œä¸ºå˜é‡ï¼ˆå±æ€§ï¼‰ï¼Ÿ</p>
<pre><code class="language-js">var foo // æ­¤å¤„ foo çš„å€¼æ˜¯åŸå§‹å€¼ undefinedï¼›

function bar() {}
bar() // æ­¤å¤„å‡½æ•° bar çš„è¿”å›å€¼æ˜¯åŸå§‹å€¼ undefinedï¼›

void 0 // æ­¤å¤„ void æ“ä½œçš„è¿”å›å€¼æ˜¯åŸå§‹å€¼ undefinedï¼›

foo == undefined // æ­¤å¤„ç›¸ç­‰è¿ç®—ç¬¦å³ä¾§çš„ undefined æ˜¯å…¨å±€å¯¹è±¡çš„ undefined å±æ€§ã€‚
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å¯¹äº <code>undefined</code> æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„è®¤è¯†äº†ã€‚</p>
<p>æˆ‘çŒœä½ åº”è¯¥çœ‹è¿‡ç±»ä¼¼ä»¥ä¸‹çš„ã€Œå°å¿ƒæœºã€ä»£ç ï¼š</p>
<pre><code class="language-js">;(function ($, window, undefined) {
  // some statements
})(jQuery, window)
</code></pre>
<p>å¦‚æœåœ¨ IIFE ä¸­ä½¿ç”¨ <code>undefined</code>ï¼Œå®ƒå…¶å®æ˜¯å¼•ç”¨äº†å½¢å‚ <code>undefined</code>ã€‚ä½†å½¢å‚ <code>undefined</code> çš„å€¼å°±æ˜¯ <code>undefined</code> çš„åŸå§‹å€¼ï¼Œå› ä¸ºåœ¨è°ƒç”¨å‡½æ•°æ—¶å¹¶æœªä¼ å…¥å®å‚ã€‚é™¤äº†èƒ½ç¡®ä¿ <code>undefined</code> çš„å€¼æ˜¯åŸå§‹å€¼ä¹‹å¤–ï¼Œè¿˜èƒ½åŠ é€Ÿå˜é‡ <code>undefined</code> çš„æŸ¥æ‰¾ï¼Œç”±äºå®ƒåœ¨å‡½æ•°ä½œç”¨åŸŸå†…å°±èƒ½æ‰¾åˆ°è¯¥å˜é‡ï¼Œå°±ä¸ä¼šç»§ç»­å¾€ä½œç”¨åŸŸé“¾ä¸ŠæŸ¥æ‰¾ã€‚</p>
<h2>ç”¨ void 0 ä»£æ›¿ undefinedï¼Ÿ</h2>
<p><code>void 0</code> æ€»æ˜¯è¿”å›åŸå§‹å€¼ <code>undefined</code>ï¼Œæ— è®ºå…¨å±€å±æ€§ <code>undefined</code> æ˜¯å¦è¢«æ”¹å†™ï¼Œå®ƒéƒ½èƒ½ç¡®ä¿å…¶å€¼æ˜¯ <code>undefined</code>ï¼ˆåŸå§‹å€¼ï¼‰ã€‚</p>
<p>æ¯”å¦‚è‘—åçš„å·¥å…·åº“ <a href="https://github.com/jashkenas/underscore/blob/da06656712e023ed40198310bab29634a7170ec2/modules/sortBy.js#L19">underscore</a> å¤§é‡ä½¿ç”¨äº† <code>void 0</code> æ¥ä»£æ›¿ <code>undefined</code>ï¼Œå†è€… UglifyJSã€Terser ç­‰ä»£ç å‹ç¼©å·¥å…·ä¹Ÿä¼šå°† <code>undefined</code> è½¬æ¢ä¸º <code>void 0</code>ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœä¸€äº›å­—èŠ‚ï¼š</p>
<pre><code class="language-js">function isUndefined(x) {
 return x === undefined
}

// Minified
function isUndefined(n){return void 0===n}
</code></pre>
<p>ä½†æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨ <code>undefined</code> ä¹Ÿæ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ï¼Œæ³¨æ„ä¸‹å‰é¢æåˆ°çš„ä¸€äº›ç‚¹å°±å¥½äº†ï¼Œå…¶ä½™çš„å°±äº¤ç”±å·¥å…·æ¥å¤„ç†å³å¯ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å•Šï¼Œä¼¼ä¹æ²¡æœ‰çœŸæ­£ç†è§£ try...catch...finallyï¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/286</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/286</guid>
            <pubDate>Sun, 26 Feb 2023 12:54:04 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8d67c27213a10cb8.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8d67c27213a10cb8.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å†™äº†é‚£ä¹ˆä¹…çš„ JavaScriptï¼Œä¼¼ä¹çœŸçš„æ²¡æœ‰å¾ˆè®¤çœŸåœ°å»äº†è§£ <code>try...catch...finally</code> çš„å„ç§ç”¨æ³•ï¼ŒçœŸæ˜¯æƒ­æ„§äº†ï¼Anywayï¼Œä¸æ‡‚å°±å­¦...</p>
<h2>ä¸€ã€é”™è¯¯ä¸å¼‚å¸¸</h2>
<p>é”™è¯¯ï¼Œåœ¨ç¨‹åºä¸­æ˜¯å¾ˆå¸¸è§çš„ã€‚å®ƒå¯ä»¥æ˜¯ JS å¼•æ“åœ¨æ‰§è¡Œä»£ç æ—¶å†…éƒ¨æŠ›å‡ºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£ç å¼€å‘äººå‘˜é’ˆå¯¹ä¸€äº›ä¸åˆæ³•çš„è¾“å…¥è€Œä¸»åŠ¨æŠ›å‡ºçš„ï¼Œæˆ–è€…æ˜¯ç½‘ç»œæ–­å¼€è¿æ¥å¯¼è‡´çš„é”™è¯¯ç­‰ç­‰...</p>
<p><strong>å¯èƒ½å¾ˆå¤šäººä¼šè®¤ä¸ºï¼Œã€Œé”™è¯¯ã€å’Œã€Œå¼‚å¸¸ã€æ˜¯åŒä¸€å›äº‹ï¼Œå…¶å®ä¸ç„¶ï¼Œä¸€ä¸ªé”™è¯¯å¯¹è±¡åªæœ‰åœ¨è¢«æŠ›å‡ºæ—¶æ‰æˆä¸ºå¼‚å¸¸ã€‚</strong></p>
<h4>1.1 é”™è¯¯</h4>
<p>åœ¨ JavaScript ä¸­ï¼Œé”™è¯¯é€šå¸¸æ˜¯æŒ‡ Error å®ä¾‹å¯¹è±¡æˆ– Error çš„æ´¾ç”Ÿç±»å®ä¾‹å¯¹è±¡ï¼ˆæ¯”å¦‚ <code>TypeError</code>ã€<code>ReferenceError</code>ã€<code>SyntaxError</code> <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error#error_types">ç­‰ç­‰</a>ï¼‰ã€‚åˆ›å»º <code>Error</code> å®ä¾‹å¯¹è±¡å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const error = new Error('oops') // ç­‰ä»·äº Error('oops')
const typeError = new TypeError('oops')
// ...
</code></pre>
<p>è™½ç„¶ <code>Error</code> åŠå…¶æ´¾ç”Ÿç±»æ˜¯æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å½“ä½œå‡½æ•°è°ƒç”¨ä¹Ÿæ˜¯å…è®¸çš„ï¼ˆå³çœç•¥ <code>new</code> å…³é”®å­—ï¼‰ï¼ŒåŒæ ·ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯å®ä¾‹å¯¹è±¡ã€‚</p>
<p>ä¸€ä¸ªé”™è¯¯å®ä¾‹å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š</p>
<pre><code class="language-js">const errorInstance = {
  name: String, // æ ‡å‡†å±æ€§ï¼Œæ‰€æœ‰æµè§ˆå™¨å‡æ”¯æŒï¼ˆé»˜è®¤å€¼ä¸ºæ„é€ æ–¹æ³•åç§°ï¼‰
  message: String, // æ ‡å‡†å±æ€§ï¼Œæ‰€æœ‰æµè§ˆå™¨å‡æ”¯æŒï¼ˆé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä¿®æ”¹å…¶å±æ€§å€¼ï¼‰
  stack: String, // éæ ‡å‡†å±æ€§ï¼Œä½†æ‰€æœ‰æµè§ˆå™¨å‡æ”¯æŒï¼ˆæ ˆå±æ€§ï¼Œå¯ä»¥è¿½è¸ªå‘ç”Ÿé”™è¯¯çš„å…·ä½“ä¿¡æ¯ï¼‰

  columnNumber: Number, // éæ ‡å‡†å±æ€§ï¼Œä»… Firefox æµè§ˆå™¨æ”¯æŒï¼ˆåˆ—å·ï¼‰
  lineNumber: Number, // éæ ‡å‡†å±æ€§ï¼Œä»… Firefox æµè§ˆå™¨æ”¯æŒï¼ˆè¡Œå·ï¼‰
  fileName: String, // éæ ‡å‡†å±æ€§ï¼Œä»… Firefox æµè§ˆå™¨æ”¯æŒï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰

  column: Number, // éæ ‡å‡†å±æ€§ï¼Œä»… Safari æµè§ˆå™¨æ”¯æŒï¼ˆåŒä¸Šè¿°ä¸‰ä¸ªå±æ€§ï¼‰
  line: Number, // éæ ‡å‡†å±æ€§ï¼Œä»… Safari æµè§ˆå™¨æ”¯æŒ
  sourceURL: String, // éæ ‡å‡†å±æ€§ï¼Œä»… Safari æµè§ˆå™¨æ”¯æŒ

  toString: Function, // æ ‡å‡†æ–¹æ³•ï¼ˆå…¶è¿”å›å€¼æ˜¯ name å’Œ message å±æ€§çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼‰
}
</code></pre>
<p>æˆ‘ä»¬å†™ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ï¼Œæ‰“å°çœ‹ä¸‹å„å¤§æµè§ˆå™¨çš„æƒ…å†µï¼š</p>
<pre><code class="language-js">try {
  throw new TypeError('oops')
} catch (e) {
  console.log(e.toString())
  console.dir(e)
}
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677416344743.png" alt=""></p>
<p>æ’ä¸ªé¢˜å¤–è¯ï¼š</p>
<p>ä¸çŸ¥é“æœ‰äººæ²¡æœ‰å¯¹æ­¤æœ‰ç–‘æƒ‘çš„ï¼Œä¸ºä»€ä¹ˆ <code>console.log()</code> ä¸€ä¸ª <code>Error</code> å¯¹è±¡ï¼Œæ‰“å°å‡ºæ¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å‘¢ï¼Ÿ</p>
<pre><code class="language-js">const err = new Error('wrong')
console.log(err) // &quot;Error: wrong&quot;
console.log(typeof err) // &quot;object&quot;
</code></pre>
<p>é‚£ä¹ˆï¼Œå¦‚æœæƒ³æ‰“å°å‡º <code>Error</code> å¯¹è±¡ï¼Œä½¿ç”¨ <code>console.dir()</code> å³å¯ã€‚</p>
<p>å‰é¢ <code>console.log()</code> æ‰“å°ç»“æœä¸ºå­—ç¬¦ä¸²çš„åŸå› å…¶å®å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ <code>console.log()</code> å†…éƒ¨ã€Œå·å·åœ°ã€åšäº†ä¸€ä»¶äº‹ï¼Œå½“ä¼ å…¥çš„å®å‚ä¸º <code>Error</code> å¯¹è±¡ï¼ˆæˆ–å…¶æ´¾ç”Ÿç±»é”™è¯¯å¯¹è±¡ï¼‰ï¼Œå®ƒä¼šå…ˆè°ƒç”¨ <code>Error</code> å¯¹è±¡çš„ <code>Error.prototype.toString()</code> æ–¹æ³•ï¼Œç„¶åå°†å…¶ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„æ‰“å°ç»“æœä¸ºå­—ç¬¦ä¸²ã€‚</p>
<p>å…¶å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// polyfill
Error.prototype.toString = function () {
  'use strict'

  var obj = Object(this)
  if (obj !== this) throw new TypeError()

  var name = this.name
  name = name === undefined ? 'Error' : String(name)

  var msg = this.message
  msg = msg === undefined ? '' : String(msg)

  if (name === '') return msg
  if (msg === '') return name

  return name + ': ' + msg
}
</code></pre>
<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨ä¸åŒæµè§ˆå™¨ä¸‹ï¼Œå…¶æ‰“å°ç»“æœå¯èƒ½ä¼šä¸ç›¸åŒï¼ˆä½†ä¸é‡è¦ï¼‰ã€‚åŸå› ä¹Ÿéå¸¸ç®€å•ï¼Œ<code>console</code> å¹¶ä¸æ˜¯ ECMAScript æ ‡å‡†ï¼Œè€Œæ˜¯æµè§ˆå™¨ BOM å¯¹è±¡æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œå…¶<a href="https://console.spec.whatwg.org/">æ ‡å‡†</a>ç”± WHATWG æœºæ„åˆ¶å®šï¼Œè™½ç„¶æ ‡å‡†æ˜¯ç»Ÿä¸€çš„ï¼Œä½†å®ç°çš„æ˜¯å„æµè§ˆå™¨å‚å•†å¤§çˆ·ä»¬ï¼Œå®ƒä»¬æœ‰å¯èƒ½ä¸ä¼šä¸¥æ ¼éµå®ˆè§„èŒƒå»å®ç°ï¼Œå› è€Œäº§ç”Ÿå·®å¼‚åŒ–ã€‚æ¯”å¦‚ï¼Œæ­¤å‰å†™è¿‡ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/260">æ–‡ç« </a>æ˜¯å…³äºä¸åŒå®¿ä¸»ç¯å¢ƒä¸‹ async/await å’Œ promise æ‰§è¡Œé¡ºåºçš„å·®å¼‚ï¼Œå°±å› ä¸º JS å¼•æ“å®ç°å·®å¼‚å¯¼è‡´çš„ã€‚</p>
<h4>1.2 å¼‚å¸¸</h4>
<p>å‰é¢æåˆ°ï¼Œå½“é”™è¯¯è¢«æŠ›å‡ºæ—¶å°±ä¼šæˆä¸ºå¼‚å¸¸ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ç¼–å†™çš„ä»£ç å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘é˜¶æ®µçš„è¯­æ³•åˆ†æè¿‡ç¨‹å°±ä¼šè¢«èªæ˜çš„ JS å¼•æ“å‘ç°ï¼Œå› è€Œåœ¨ç¼–è¯‘é˜¶æ®µä¾¿ä¼šæŠ›å‡º SyntaxErrorã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ä»£ç æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œä½†é”™è¯¯åœ°å¼•ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å˜é‡ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé˜¶æ®µçš„æ‰§è¡Œä¸Šä¸‹æ–‡è¿‡ç¨‹ï¼ˆä»£ç æ‰§è¡Œä¹‹å‰çš„ä¸€ä¸ªè¿‡ç¨‹ï¼‰ï¼Œèªæ˜çš„ JS å¼•æ“å‘ç°åœ¨å…¶ä½œç”¨åŸŸé“¾ä¸Šæ‰¾ä¸åˆ°è¯¥å˜é‡ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º ReferenceErrorã€‚</p>
<p>å‡è®¾å³ä¸å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œä¹Ÿæ²¡æœ‰å¼•ç”¨é”™è¯¯ï¼Œä½†æˆ‘ä»¬å¯¹ä¸€ä¸ªå˜é‡åšäº†â€œä¸åˆæ³•â€çš„æ“ä½œï¼Œæ¯”å¦‚ <code>null.name</code>ã€<code>'str'.push('ing')</code>ï¼Œé‚£ä¹ˆ JS å¼•æ“å°±ä¼šæŠ›å‡º TypeErrorã€‚</p>
<p>è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œå°±ä¸ä¸¾ä¾‹äº†ã€‚</p>
<p>å‰é¢éƒ½æ˜¯ JS å¼•æ“ä¸»åŠ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¼€å‘è€…åˆ™å¯é€šè¿‡ <code>throw</code> å…³é”®å­—æ¥æŠ›å‡ºé”™è¯¯ï¼Œè¯­æ³•å¾ˆç®€å•ï¼š</p>
<pre><code class="language-js">// throw expression
throw 123
throw 'abc'
throw { name: 'Frankie' }
// ...
</code></pre>
<p>è¯·æ³¨æ„ï¼Œåœ¨ JavaScript ä¸­ <code>throw</code> å…³é”®å­—å’Œ <code>return</code>ã€<code>break</code>ã€<code>continue</code> ç­‰å…³é”®å­—ä¸€æ ·ï¼Œä¼šå—åˆ° ASIï¼ˆ<a href="http%3A%2F%2Fwww.ecma-international.org%2Fecma-262%2F6.0%2Findex.html%23sec-automatic-semicolon-insertion">Automatic Semicolon Insertion</a>ï¼‰è§„åˆ™çš„å½±å“ï¼Œå®ƒä¸èƒ½åœ¨ <code>throw</code> ä¸ <code>expression</code> ä¹‹é—´æ’å…¥ä»»æ„æ¢è¡Œç¬¦ï¼Œå¦åˆ™å¯èƒ½å¾—ä¸åˆ°é¢„æœŸç»“æœã€‚</p>
<p>è¯­æ³•å¾ˆç®€å•ï¼Œä½†é€šå¸¸é¡¹ç›®ä¸­ã€Œä¸å»ºè®®ã€ç›´æ¥æŠ›å‡ºä¸€ä¸ªå­—é¢é‡ï¼Œè€Œæ˜¯æŠ›å‡º <code>Error</code> å¯¹è±¡æˆ–å…¶æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œåº”è¯¥è¿™æ ·ï¼š</p>
<pre><code class="language-js">throw new Error('oops')
throw new TypeError('arguments must be a number.')
// ...
</code></pre>
<p>åŸå› æ˜¯ <code>Error</code> å¯¹è±¡ä¼šè®°å½•å¼•å‘æ­¤é”™è¯¯çš„æ–‡ä»¶çš„è·¯å¾„ã€è¡Œå·ã€åˆ—å·ç­‰ä¿¡æ¯ï¼Œè¿™åº”è¯¥æ˜¯æ’é™¤é”™è¯¯æœ€æœ‰æ•ˆçš„ä¿¡æ¯ã€‚åœ¨ ESLint ä¸­çš„ <a href="https://eslint.org/docs/rules/no-throw-literal">no-throw-literal</a> è§„åˆ™ï¼Œæ­£æ˜¯ç”¨æ¥çº¦æŸä¸Šè¿°ç›´æ¥æŠ›å‡ºå­—é¢é‡çš„å†™æ³•çš„ã€‚</p>
<p>é™¤äº† <code>throw</code> å…³é”®å­—ä¹‹å¤–ï¼ŒES6 ä¸­å¼ºå¤§çš„ Generator å‡½æ•°ä¹Ÿæä¾›äº†ä¸€ä¸ªå¯æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼š<code>Generator.prototype.throw()</code>ã€‚å®ƒå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶ååœ¨å‡½æ•°ä½“å†…æ•è·å¼‚å¸¸ã€‚</p>
<pre><code class="language-js">function* genFn() {
  try {
    yield 1
  } catch (e) {
    console.log('inner --&gt;', e)
  }
}

try {
  const gen = genFn()
  gen.next()
  gen.throw(new Error('oops'))
} catch (e) {
  console.log('outer --&gt;', e)
}
</code></pre>
<p>æ‰“å°ç»“æœæ˜¯ <code>inner --&gt; Error: oops</code>ã€‚å¦‚æœç”Ÿæˆå™¨å‡½æ•°ä½“å†…æ²¡æœ‰ <code>try...catch</code> å»æ•è·å¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒæ‰€æŠ›å‡ºçš„å¼‚å¸¸å¯ä»¥è¢«å¤–éƒ¨çš„ <code>try...catch</code> è¯­å¥æ•è·åˆ°ã€‚</p>
<p>å½“ç”Ÿæˆå™¨ã€Œæœªå¼€å§‹æ‰§è¡Œä¹‹å‰ã€æˆ–è€…ã€Œæ‰§è¡Œç»“æŸä¹‹åã€ï¼Œè°ƒç”¨ç”Ÿæˆå™¨çš„ <code>throw()</code> æ–¹æ³•ã€‚å®ƒçš„å¼‚å¸¸åªä¼šè¢«ç”Ÿæˆå™¨å‡½æ•°å¤–éƒ¨çš„ <code>try...catch</code> æ•è·åˆ°ã€‚è‹¥å¤–éƒ¨æ²¡æœ‰ <code>try...catch</code> è¯­å¥ï¼Œåˆ™ä¼šæŠ¥é”™ä¸”ä»£ç å°±ä¼šåœæ­¢æ‰§è¡Œã€‚<a href="https://www.jianshu.com/p/7ee993ec1a80">è¯¦çœ‹</a></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿæˆå™¨å‡½æ•°è™½ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒæœ¬èº«æ˜¯åŒæ­¥çš„ï¼Œè€Œä¸”æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°å¹¶ä¸ä¼šç«‹åˆ»æ‰§è¡Œå‡½æ•°ä½“çš„é€»è¾‘ï¼Œå®ƒéœ€è¦ä¸»åŠ¨è°ƒç”¨ç”Ÿæˆå™¨å®ä¾‹å¯¹è±¡çš„ <code>next()</code>ã€<code>return()</code>ã€<code>throw()</code> æ–¹æ³•å»æ‰§è¡Œå‡½æ•°ä½“å†…çš„ä»£ç ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>for...of</code>ã€è§£æ„ç­‰è¯­æ³•å»éå†å®ƒï¼Œå› ä¸ºç”Ÿæˆå™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p>
</blockquote>
<h2>äºŒã€try...catch</h2>
<p>å¯¹äºå¯èƒ½å­˜åœ¨å¼‚å¸¸çš„ä»£ç ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ <code>try...catch...finally</code> å»å¤„ç†ä¸€äº›å¯é¢„è§æˆ–ä¸å¯é¢„è§çš„é”™è¯¯ã€‚è¯­æ³•æœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š</p>
<blockquote>
<ul>
<li><code>try...catch</code></li>
<li><code>try...finally</code></li>
<li><code>try...catch...finally</code></li>
</ul>
</blockquote>
<p><strong>ä¸”å¿…é¡»è‡³å°‘å­˜åœ¨ä¸€ä¸ª <code>catch</code> å—æˆ– <code>finally</code> å—ã€‚</strong></p>
<pre><code class="language-js">try {
  throw new Error('oops')
} catch (e) {
  // some statements...
}
</code></pre>
<p>ä»¥ä¸Šè¿™äº›è¯­æ³•ï¼Œå†™è¿‡ JavaScript ç›¸ä¿¡éƒ½æ‡‚ã€‚</p>
<p>æ›¾ç» Firefox 59 åŠä»¥ä¸‹ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œæœ‰ä¸€ç§ Conditional catch-blocks çš„ã€Œæ¡ä»¶ <code>catch</code> å­å¥ã€çš„è¯­æ³•ï¼ˆè¯·æ³¨æ„ï¼Œå…¶ä»–æµè§ˆå™¨å¹¶ä¸æ”¯æŒè¯¥è¯­æ³•ï¼Œå³ä¾¿æ˜¯è¿œå¤ç¥å™¨ IE5ï¼Œå› æ­¤çŸ¥é“æœ‰è¿™å›äº‹å°±è¡Œäº†ï¼‰ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">try {
  // may throw three types of exceptions
  willThrowError()
} catch (e if e instanceof TypeError) {
  // statements to handle TypeError exceptions
} catch (e if e instanceof RangeError) {
  // statements to handle RangeError exceptions
} catch (e if e instanceof EvalError) {
  // statements to handle EvalError exceptions
} catch (e) {
  // statements to handle any unspecified exceptions
}
</code></pre>
<p>é‚£ä¹ˆç¬¦åˆ ECMAScript æ ‡å‡†çš„ã€Œæ¡ä»¶ <code>catch</code> å­å¥ã€åº”è¯¥è¿™æ ·å†™ï¼š</p>
<pre><code class="language-js">try {
  // may throw three types of exceptions
  willThrowError()
} catch (e) {
  if (e instanceof TypeError) {
    // statements to handle TypeError exceptions
  } else if (e instanceof RangeError) {
    // statements to handle RangeError exceptions
  } else if (e instanceof EvalError) {
    // statements to handle EvalError exceptions
  } else {
    // statements to handle any unspecified exceptions
  }
}
</code></pre>
<p>è¯·æ³¨æ„ï¼Œ<code>try...catch</code> åªèƒ½ä»¥ã€ŒåŒæ­¥ã€çš„å½¢å¼å¤„ç†å¼‚å¸¸ï¼Œå› æ­¤å¯¹äº XHRã€Fetch APIã€Promise ç­‰å¼‚æ­¥å¤„ç†æ˜¯æ— æ³•æ•è·å…¶é”™è¯¯çš„ï¼Œç©¶å…¶åŸå› å°±æ˜¯ Event Loop å˜›ã€‚å½“ç„¶å®é™…ä¸­å¯èƒ½ç»“åˆ <code>async/await</code> æ¥æ§åˆ¶ä¼šæ›´å¤šä¸€äº›ã€‚</p>
<h4>2.1 catchå­å¥</h4>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè‹¥ <code>try</code> å—ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šç«‹å³è½¬è‡³ <code>catch</code> å­å¥æ‰§è¡Œã€‚è‹¥ <code>try</code> å—ä¸­æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œä¼šè·³è¿‡ <code>catch</code> å­å¥ã€‚</p>
<pre><code class="language-js">try {
  // try statements
} catch (exception_var) {
  // catch statements
}
</code></pre>
<p>å…¶ä¸­ <code>exception_var</code> è¡¨ç¤ºå¼‚å¸¸æ ‡è¯†ç¬¦ï¼ˆå¦‚ <code>catch(e)</code> ä¸­çš„ <code>e</code>ï¼‰ï¼Œå®ƒæ˜¯ã€Œå¯é€‰ã€çš„ï¼Œå› æ­¤å¯ä»¥è¿™æ ·ç¼–å†™ <code>try { ... } catch { ... }</code>ã€‚é€šè¿‡è¯¥æ ‡è¯†ç¬¦æˆ‘ä»¬å¯ä»¥è·å–å…³äºè¢«æŠ›å‡ºå¼‚å¸¸çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<p>**è¯·æ³¨æ„ï¼Œè¯¥æ ‡è¯†ç¬¦çš„ã€Œä½œç”¨åŸŸã€ä»…åœ¨ <code>catch</code> å—ä¸­æœ‰æ•ˆã€‚**å½“è¿›å…¥ <code>catch</code> å­å¥æ—¶ï¼Œå®ƒè¢«åˆ›å»ºï¼Œå½“ <code>catch</code> å­å¥æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤æ ‡è¯†ç¬¦å°†ä¸å¯å†ç”¨ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼ˆåœ¨ ES6 ä»¥å‰ï¼‰å¼‚å¸¸æ ‡è¯†ç¬¦æ˜¯ JavaScript ä¸­å«æœ‰â€œå—çº§ä½œç”¨åŸŸâ€çš„å˜é‡ã€‚</p>
</blockquote>
<h4>2.2 finally å­å¥</h4>
<p>è€Œ <code>finally</code> å­å¥åœ¨ <code>try</code> å—å’Œ <code>catch</code> å—ä¹‹åæ‰§è¡Œï¼Œä½†åœ¨ä¸‹ä¸€ä¸ª <code>try</code> å£°æ˜ä¹‹å‰æ‰§è¡Œã€‚æ— è®ºæ˜¯å¦å¼‚å¸¸æŠ›å‡ºï¼Œ<code>finally</code> å­å¥æ€»æ˜¯ä¼šæ‰§è¡Œã€‚</p>
<blockquote>
<p>å¦‚æœä» <code>finally</code> å—ä¸­è¿”å›ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†æˆä¸ºæ•´ä¸ª <code>try...catch...finally</code> çš„è¿”å›å€¼ï¼Œæ— è®ºæ˜¯å¦æœ‰ <code>return</code> è¯­å¥åœ¨ <code>try</code> å’Œ <code>catch</code> å—ä¸­ï¼ˆå³ä½¿ <code>catch</code> å—ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼‰ã€‚</p>
</blockquote>
<p>å¯¹äºè¿™ä¸ªæˆ‘è¡¨ç¤ºå¾ˆæ— è¯­ï¼Œå¯èƒ½æ•´ä¸ªå‰ç«¯åœˆå­å°±æˆ‘è¿˜ä¸çŸ¥é“å§ï¼ŒåŸæ¥ <code>finally</code> è¿˜èƒ½ <code>return</code> ä¸€ä¸ªå€¼ï¼Œåœ¨åšé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œç¡®å®æ²¡å†™è¿‡å’Œè§è¿‡åœ¨ <code>finally</code> ä¸­ <code>return</code> æŸä¸ªå€¼çš„ï¼Œè®©æ‚¨è§ç¬‘äº†ï¼Œå®åœ¨æƒ­æ„§ã€‚</p>
<p><strong>ä½†è¯·æ³¨æ„ï¼Œè‹¥è¦åœ¨ <code>try...catch...finally</code> ä¸­ä½¿ç”¨ <code>return</code>ï¼Œå®ƒåªèƒ½åœ¨å‡½æ•°ä¸­è¿è¡Œï¼Œå¦åˆ™æ˜¯ä¸å…è®¸çš„ï¼Œä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚</strong></p>
<pre><code class="language-js">try {
  doSomething()
} catch (e) {
  console.warn(e)
  throw e
} finally {
  return 'completed' // SyntaxError: Illegal return statement
}
</code></pre>
<h4>2.3 æ‰§è¡Œé¡ºåº</h4>
<p>åœ¨å¹³å¸¸çš„é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬çš„ <code>try...catch</code> å†™æ³•æ˜¯åœ¨ <code>try</code> å—ä¸­ <code>return</code>ï¼Œ<code>catch</code> å—åˆ™ä½œç›¸åº”çš„å¼‚å¸¸å¤„ç†ï¼Œå°‘æ•°æƒ…å†µä¹Ÿä¼šåœ¨ <code>catch</code> å—ä¸­ <code>return</code>ã€‚å› æ­¤ï¼Œå¤§å®¶å¯¹è¿™ç§å¸¸è§„å†™æ³•çš„æ‰§è¡Œé¡ºåºåº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>å…ˆæ¥ä¸ªè°éƒ½ä¼šçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function foo() {
  try {
    console.log('try statement')
    throw new Error('oops')
  } catch (e) {
    console.log('catch statement')
    return 'fail'
  }
}

foo()
// ä»¥ä¸Šï¼Œå…ˆåæ‰“å° &quot;try statement&quot;ã€&quot;catch statement&quot;ï¼Œfoo å‡½æ•°è¿”å›ä¸€ä¸ª &quot;fail&quot; å€¼
</code></pre>
<p>æ¥ç€å†çœ‹ï¼Œå®ƒæ‰“å°ä»€ä¹ˆï¼Œå‡½æ•°åˆè¿”å›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre><code class="language-js">function foo() {
  try {
    console.log('try statement')
    throw new Error('oops')
  } catch (e) {
    console.log('catch statement')
    return 'fail'
  } finally {
    console.log('finally statement')
    return 'complete'
  }
}

foo()
// å…ˆåæ‰“å°ï¼š&quot;try statement&quot;ã€&quot;catch statement&quot;ã€&quot;finally statement&quot;
// foo å‡½æ•°è¿”å›å€¼æ˜¯ &quot;complete&quot;
</code></pre>
<p>å‰é¢æåˆ°ï¼Œå¦‚æœ <code>finally</code> å—ä¸­å«æœ‰ <code>return</code> è¯­å¥ï¼Œé‚£ä¹ˆå®ƒçš„ <code>return</code> å€¼å°†ä½œä¸ºå½“å‰å‡½æ•°çš„è¿”å›å€¼ï¼Œå› æ­¤ <code>foo()</code> ç»“æœä¸º <code>&quot;complete&quot;</code>ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ï¼Œåœ¨ <code>try</code> å—ä¸­ <code>return</code> ä¸€ä¸ªå€¼ï¼Œçœ‹ä¸‹ç»“æœåˆæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p>
<pre><code class="language-js">function foo() {
  try {
    console.log('try statement')
    return 'success'
  } catch (e) {
    console.log('catch statement')
    return 'fail'
  } finally {
    console.log('finally statement')
    return 'complete'
  }
}

foo()
// å…ˆåæ‰“å°ï¼š&quot;try statement&quot;ã€&quot;finally statement&quot;
// foo å‡½æ•°è¿”å›å€¼æ˜¯ &quot;complete&quot;
</code></pre>
<p>ç”±äº <code>try</code> å—ä¸­æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤ <code>catch</code> å—ä¼šè¢«è·³è¿‡ï¼Œä¸æ‰§è¡Œï¼Œä½†æ˜¯ <code>finally</code> å—è¿˜æ˜¯ä¼šæ‰§è¡Œçš„ï¼Œè€Œä¸”å®ƒé‡Œé¢è¿”å›äº† <code>&quot;complete&quot;</code>ï¼Œå› æ­¤è¿™ä¸ªå€¼ä¹Ÿå°±ä½œä¸º <code>foo</code> å‡½æ•°çš„è¿”å›å€¼äº†ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œ<code>finally</code> å—çš„ä»£ç æ€»ä¼šåœ¨ <code>return</code> <strong>ä¹‹å‰</strong>æ‰§è¡Œï¼Œä¸ç®¡ <code>return</code> æ˜¯å­˜åœ¨äº <code>try</code>ã€<code>catch</code> è¿˜æ˜¯ <code>finally</code> å—ä¸­ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œè¿™å°±å®Œäº†å—ï¼Ÿ</p>
<p>è¿˜æ²¡æœ‰ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œçœ‹çœ‹é‡Œé¢è¿™ä¸ª <code>bar()</code> å‡½æ•°æ˜¯æƒ°æ€§æ±‚å€¼ï¼Ÿè¿˜æ˜¯æ€æ ·ï¼Ÿ</p>
<pre><code class="language-js">function foo() {
  try {
    console.log('try statement')
    throw new Error('oops')
  } catch (e) {
    console.log('catch statement')
    return bar()
  } finally {
    console.log('finally statement')
    return 'complete'
  }
}

function bar() {
  console.log('bar statement')
  return 'something'
}

foo()
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œæ‰“å°é¡ºåºå’Œç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre><code class="language-js">// æ‰“å°é¡ºåºï¼Œä¾æ¬¡æ˜¯ï¼š
&quot;try statement&quot;
&quot;catch statement&quot;
&quot;bar statement&quot;
&quot;finally statement&quot;

// ç»“æœæ˜¯ &quot;complete&quot;
</code></pre>
<p>å‡è®¾ <code>catch</code> å—ä¸­çš„ <code>return bar()</code> æ¢æˆ <code>throw bar()</code> å‘¢ï¼Œç»“æœåˆæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿå¦‚æœæ¢æˆè¿™ä¸ªä½ å°±çŠ¹è±«äº†ï¼Œè¯´æ˜ä½ ç†è§£å¾—ä¸å¤Ÿæ·±åˆ»ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä¸ç»™å‡ºç­”æ¡ˆï¼Œä½ è‡ªå·±å»è¯•è¯•ï¼Œæ•ˆæœæ›´ä½³ï¼</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>finally</code> å—çš„æ‰§è¡Œæ—¶æœºå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>åœ¨æ‰€æœ‰ <code>try</code> å—å’Œ <code>catch</code> å—ï¼ˆå¦‚æœæœ‰ï¼Œä¸”è§¦å‘è¿›å…¥çš„è¯ï¼‰æ‰§è¡Œå®Œ<strong>ä¹‹å</strong>ï¼Œå³ä¾¿æ­¤æ—¶ <code>try</code> å—æˆ– <code>catch</code> å—ä¸­å­˜åœ¨ <code>return</code> æˆ– <code>throw</code> è¯­å¥ï¼Œå®ƒä»¬å°†ä¼šè¢« Hold ä½å…ˆä¸è¿”å›æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œç»§ç»­æ‰§è¡Œ <code>finally</code> å—ä¸­çš„ä»£ç ï¼š</p>
<ul>
<li>å¦‚æœ <code>finally</code> ä¸­å­˜åœ¨ <code>return</code> è¯­å¥ï¼Œå…¶è¿”å›å€¼å°†ä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼ˆå‰é¢ <code>try</code> å—æˆ– <code>catch</code> ä¸­çš„ <code>return</code> æˆ– <code>throw</code> éƒ½ä¼šè¢«å¿½ç•¥ï¼Œå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰äº† <code>return</code> æˆ– <code>throw</code> å…³é”®å­—ä¸€æ ·ï¼‰ã€‚</li>
<li>å¦‚æœ <code>finally</code> ä¸­å­˜åœ¨ <code>throw</code> è¯­å¥ï¼Œå‰é¢ <code>try</code> å—æˆ– <code>catch</code> ä¸­çš„ <code>return</code> æˆ– <code>throw</code> åŒæ ·ä¼šè¢«å¿½ç•¥ï¼Œæœ€åæ•´ä¸ªå‡½æ•°å°†ä¼šæŠ›å‡º <code>finally</code> å—ä¸­çš„å¼‚å¸¸ã€‚</li>
</ul>
</blockquote>
<h4>2.4 åµŒå¥—ä½¿ç”¨</h4>
<p>å®ƒæ˜¯å¯ä»¥åµŒå¥—ä½¿ç”¨çš„ï¼Œå½“å†…éƒ¨çš„ <code>try...catch...finally</code> ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒä¼šè¢«ç¦»å®ƒæœ€è¿‘çš„ <code>catch</code> å—æ•è·åˆ°ã€‚</p>
<pre><code class="language-js">function foo() {
  try {
    try {
      return 'success'
    } finally {
      throw new Error('inner oops') // å®ƒå°†ä¼šè¢«å¤–å±‚çš„ catch å—æ‰€æ•è·åˆ°
    }
  } catch (e) {
    console.log(e) // Error: inner oops
  }
}

foo()
</code></pre>
<p>æ³¨æ„ï¼Œæœ¬èŠ‚å†…å®¹æ‰€è¿°éƒ½æ˜¯åŒæ­¥ä»£ç ï¼Œè€Œä¸å­˜åœ¨ä»»ä½•å¼‚æ­¥ä»£ç ã€‚</p>
<p>åˆ°æ­¤ï¼Œå·²å½»åº•å¼„æ‡‚ <code>try...catch...finally</code> è¯­å¥äº†ï¼Œå†ä¹Ÿä¸æ…Œäº†ï¼</p>
<h2>ä¸‰ã€å¼‚å¸¸æœ‰å“ªäº›ï¼Ÿ</h2>
<p>åœ¨ Web ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¼‚å¸¸ç±»å‹ï¼š</p>
<ul>
<li>JavaScript å¼‚å¸¸</li>
<li>DOM å’Œ BOM å¼‚å¸¸</li>
<li>ç½‘ç»œèµ„æºåŠ è½½å¼‚å¸¸</li>
<li>Script Error</li>
<li>ç½‘é¡µå¼‚å¸¸</li>
</ul>
<h4>3.1 JavaScript å¼‚å¸¸</h4>
<p><code>try...catch</code> å¯ä»¥æ•è·åŒæ­¥ä»»åŠ¡å¯¼è‡´çš„å¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥æ•è· <code>async/await</code> ä¸­çš„å¼‚å¸¸ã€‚</p>
<p><code>Promise</code> ä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåˆ™å¯é€šè¿‡ <code>Promise.prototype.catch()</code> æˆ– <code>Promise.prototype.then(onResolved, onRejected)</code> æ•è·ã€‚</p>
<h4>3.2 DOM Exception</h4>
<p>åœ¨è°ƒç”¨ DOM API æ—¶å‘ç”Ÿçš„ï¼Œéƒ½å±äº DOM Exceptionã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;video id=&quot;video&quot; controls src=&quot;https://dl.ifanr.cn/hydrogen/landing-page/ifanr-products-introduce-v1.1.mp4&quot;&gt;&lt;/video&gt;
    &lt;script&gt;
      window.onload = function () {
        const video = document.querySelector('#video')
        video.play() // Uncaught (in promise) DOMException: play() failed because the user didn't interact with the document first.
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<!--





## References

* [JavaScript é”™è¯¯å¤„ç†å®Œå…¨æŒ‡å—](https://www.infoq.cn/article/glS9HjuSGhQMLL1zowwN)
* [A mostly complete guide to error handling in JavaScript.](https://www.valentinog.com/blog/error/)
* [no-throw-literal](https://eslint.org/docs/rules/no-throw-literal)
* [æ·±å…¥å‰ç«¯é”™è¯¯/å¼‚å¸¸](https://juejin.cn/post/6844904138334011406)


-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | æ¨¡æ¿å­—ç¬¦ä¸²è¿›é˜¶ç”¨æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/285</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/285</guid>
            <pubDate>Sun, 26 Feb 2023 12:52:38 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-75e185fd400c5c78.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-75e185fd400c5c78.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆtemplate stringï¼‰æ˜¯ ECMAScript 2015 è§„èŒƒä¸­çš„ä¸€ç§æ–°ç‰¹æ€§ï¼Œåœ¨å¹³å¸¸å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ã€‚ä¹Ÿå¯ç§°ä½œæ¨¡æ¿å­—é¢é‡ï¼ˆtemplate literalï¼‰ã€‚</p>
<h2>å¸¸è§„ç”¨æ³•</h2>
<p>æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨åå¼•å·ï¼ˆ` `ï¼‰æ¥ä»£æ›¿æ™®é€šå­—ç¬¦ä¸²ä¸­çš„ç”¨åŒå¼•å·å’Œå•å¼•å·ã€‚</p>
<pre><code class="language-js">// å•è¡Œå­—ç¬¦ä¸²
`single line text`

// å¤šè¡Œå­—ç¬¦ä¸²
`multiline text 1
 multiline text 2`

// åµŒå…¥è¡¨è¾¾å¼
function sayHi(name) {
  console.log(`Hi, ${name}~`)
}

// æ¨¡æ¿å­—ç¬¦ä¸²å†…ä½¿ç”¨åå¼•å·ï¼Œéœ€åœ¨å‰é¢æ·»åŠ è½¬ä¹‰ç¬¦ (\)
`\`` === '`' // true
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å†…çš„ã€Œä»»æ„å­—ç¬¦ã€éƒ½æ˜¯å®ƒçš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å¾ˆå®¹æ˜“è¢«è§†è§‰å¿½ç•¥çš„å‰å¯¼å°¾éšç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ã€Œç©ºç™½ç¬¦ã€ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">String.raw`multiline text 1
 multiline text 2` // &quot;multiline text 1\n multiline text 2&quot;
</code></pre>
<p>ä»¥ä¸Š <code>String.raw()</code> æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²çš„æ ‡ç­¾å‡½æ•°ï¼ˆä¸‹é¢ä¼šä»‹ç»ï¼‰ï¼Œå®ƒè¿”å›æŒ‡å®šæ¨¡æ¿å­—ç¬¦ä¸²çš„åŸå§‹å­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯åŒ…å« <code>\n </code>ï¼ˆæ¢è¡Œç¬¦å’Œç©ºæ ¼ï¼‰çš„ã€‚</p>
<p>å®ƒä¹Ÿæ”¯æŒåµŒå¥—è¯­æ³•ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const className = `flex-center ${isShow ? `display ${isLarge ? 'big' : 'normal'}` : ''}`
</code></pre>
<p>ä»¥ä¸Šè¿™äº›å†…å®¹ï¼Œç›¸ä¿¡çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ éƒ½æ‡‚ï¼Œæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>
<h2>è¿›é˜¶ç”¨æ³•</h2>
<p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿‡ <a href="https://www.wikiwand.com/en/CSS-in-JS">CSS-in-JS</a>ï¼Œå¯ä»¥ç»å¸¸çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¯­æ³•ï¼š</p>
<pre><code class="language-js">import styled from 'styled-components'

const Button = styled.button`
  color: palevioletred;
  font-size: 1em;
  margin: 1em;
  padding: 0.25em 1em;
  border: 2px solid palevioletred;
  border-radius: 3px;
`
</code></pre>
<p>ä»¥ä¸Šæ˜¯ <a href="https://styled-components.com/">styled-components</a> çš„åŸºç¡€ç”¨æ³•ã€‚</p>
<p>è¿™çœ‹èµ·æ¥æœ‰ç‚¹â€œå¥‡æ€ªâ€çš„è¯­æ³•ï¼Œæ­£æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„<strong>æ ‡ç­¾æ¨¡æ¿</strong>ï¼ˆtagged templateï¼‰ã€‚çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">alert`Hey`
</code></pre>
<p>ä»¥ä¸Šç­‰åŒäº <code>alert('Hey')</code>ï¼Œåœ¨è¿™é‡Œ <code>alert</code> è¢«ç§°ä½œã€Œæ ‡ç­¾å‡½æ•°ã€ã€‚</p>
<p><strong>å› æ­¤ã€Œæ ‡ç­¾æ¨¡æ¿ã€å®é™…ä¸Šåªæ˜¯å‡½æ•°è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼</strong>ã€‚æ ‡ç­¾æŒ‡çš„æ˜¯å‡½æ•°ï¼ˆå³ <code>alert()</code> æ–¹æ³•ï¼‰ï¼Œè€Œå‡½æ•°åé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²å°±æ˜¯å®ƒçš„å‚æ•°ã€‚</p>
<p>å¦‚æœæ ‡ç­¾æ¨¡æ¿ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯åŒ…å«å˜é‡çš„ï¼Œå°±ä¸æ˜¯ç®€å•çš„è°ƒç”¨äº†ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">const name = 'Frankie'

// æ ‡ç­¾æ¨¡æ¿
tag`Hey, ${name}~`

// ç­‰åŒäºè¿™æ ·è°ƒç”¨å‡½æ•°
tag(['Hey, ', '~'], 'Frankie')
</code></pre>
<p>æ ‡ç­¾å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ç”±ä¸åŒ…å« <code>${expression}</code> éƒ¨åˆ†çš„å­—ç¬¦ä¸²æ‹†åˆ†è€Œæˆçš„æ•°ç»„ã€‚å³ `Hey, ${name}~` ä¸­çš„å‰”é™¤æ‰ <code>${name}</code> åæ‹†åˆ†ç»„æˆçš„æ•°ç»„ã€‚è€Œåé¢çš„å‚æ•°åˆ™ä¸ºæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å˜é‡ã€‚æ³¨æ„ï¼Œæ ‡ç­¾å‡½æ•°å¹¶ä¸æ˜¯åªèƒ½è¿”å›å­—ç¬¦ä¸²ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œå¯ä»¥è¿”å›ä»»ä½•å€¼ã€‚</p>
<p>å½¢å¼å¦‚ï¼š</p>
<pre><code class="language-js">function tagFunction(strArr, ...values) {
  // some statements...
}
</code></pre>
<p>å…¶ä¸­æ ‡ç­¾å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ <code>raw</code>ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¿é—®æ¨¡æ¿å­—ç¬¦ä¸²çš„ã€ŒåŸå§‹å­—ç¬¦ä¸²ã€ï¼Œè€Œä¸ç»è¿‡ç‰¹æ®Šå­—ç¬¦çš„è½¬æ¢ã€‚</p>
<pre><code class="language-js">function tagFunction(strArr) {
  console.log(strArr.raw[0])
}

tagFunction`multiline text 1
 multiline text 2` // &quot;multiline text 1\n multiline text 2&quot;
</code></pre>
<h2>åº”ç”¨åœºæ™¯</h2>
<ol>
<li>å†™ GraphQL åº”ç”¨å¸¸ç”¨çš„ <a href="https://github.com/apollographql/graphql-tag">graphql-tag</a> åº“ï¼Œå°±æ˜¯åº”ç”¨äº†æ ‡ç­¾å‡½æ•°çš„è¯­æ³•ï¼Œå†™æ³•å¾ˆç®€æ´ã€‚</li>
</ol>
<pre><code class="language-js">import gql from 'graphql-tag';

const query = gql`
  {
    user(id: 5) {
      firstName
      lastName
    }
  }
`
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<!--

## References

* [The magic behind ğŸ’… styled-components](https://mxstbr.blog/2016/11/styled-components-magic-explained/)
* [æ·±å…¥æµ…å‡º æ ‡ç­¾æ¨¡æ¿å­—ç¬¦ä¸² å’Œ ğŸ’… styled-components ğŸ’…](https://juejin.cn/post/6844903858083201037)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é¢è¯•é¢˜ï¼š['1', '2', '3'].map(parseInt) è¾“å‡ºä»€ä¹ˆï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/284</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/284</guid>
            <pubDate>Sun, 26 Feb 2023 12:51:47 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-af9c6fe13a3b02a1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-af9c6fe13a3b02a1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€èƒŒæ™¯</h2>
<p>äº‹æƒ…ç»è¿‡æ˜¯è¿™æ ·çš„ï¼Œå‰å‡ å¤©ä¸Šç­è·¯ä¸Šï¼Œè·Ÿå¾€å¸¸ä¸€æ ·æ‹¿èµ·æ‰‹æœºçœ‹å¤´æ¡ã€é€›çŸ¥ä¹ã€åˆ·æ˜é‡‘å˜›ã€‚</p>
<p>è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°ä»¥ä¸‹è¿™ä¸ªé¢è¯•é¢˜ï¼š</p>
<blockquote>
<p><code>['1', '2', '3'].map(parseInt)</code> è¾“å‡ºä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>å…¶å®ï¼Œè¿™é¢˜å¾ˆç®€å•ï¼Œä¸å°±æ˜¯ç±»ä¼¼ <code>[0, 1, 2].filter(Boolean)</code> è¿™ç§å˜å½¢é¢˜ç›®å˜›ï¼Œä½†æˆ‘å´æ²¡èƒ½é©¬ä¸Šè¯´å‡ºç­”æ¡ˆã€‚</p>
<p>æˆ‘çŸ¥é“ <code>parseInt()</code> çš„ç¬¬äºŒä¸ªå‚æ•°è·Ÿè¿›åˆ¶æ•°ç›¸å…³ï¼Œä½†ç”±äºå¹³å¸¸å¤šæ•°æ˜¯ç¼ºçœç¬¬äºŒä¸ªå‚æ•°ï¼Œå¹³å¸¸å†™é¡¹ç›®ä¹Ÿä¼šå¯ç”¨ ESLint çš„ <a href="https://eslint.org/docs/rules/radix">radix</a> è§„åˆ™ï¼Œä½†è§„åˆ™å¯ç”¨æ—¶ä¹Ÿå‡ ä¹æ˜¯å¡«å†™ <code>10</code> ä½œä¸ºå®å‚ï¼Œå› ä¸ºæ¶‰åŠå…¶ä»–è¿›åˆ¶æ•°çš„æƒ…å†µç¡®å®å¾ˆå°‘å¾ˆå°‘...</p>
<p>æ‰€ä»¥ï¼Œè¶æœºå†ç†Ÿæ‚‰ä¸‹ <code>parseInt(string, radix)</code> è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿæ˜¯æŒºä¸é”™çš„ã€‚</p>
<p>å›åˆ°ä¸Šé¢çš„é¢˜ç›®ï¼Œåˆ†è§£ä¸€ä¸‹ï¼Œå°±æ˜¯è¿”å›ä»¥ä¸‹ä¸‰ä¸ªè¿ç®—ç»“æœç»„æˆçš„æ•°ç»„å˜›ï¼š</p>
<pre><code class="language-js">parseInt('1', 0, ['1', '2', '3'])
parseInt('2', 1, ['1', '2', '3'])
parseInt('3', 2, ['1', '2', '3'])
</code></pre>
<p>å¯¹äº <code>parseInt()</code> å‡½æ•°ï¼Œä»…æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå‚æ•°å®é™…ä¸Šæ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå› æ­¤ <code>['1', '2', '3'].map(parseInt)</code> ç»“æœå°±æ˜¯ï¼š</p>
<pre><code class="language-js">[
  parseInt('1', 0),
  parseInt('2', 1),
  parseInt('3', 2)
]
</code></pre>
<p>ä½†è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹å¹¶éæ˜¯ç­”æ¡ˆï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/parseInt">parseInt(string, radix)</a> å‡½æ•°æœ¬èº«ã€‚</p>
<h2>äºŒã€å…«è¿›åˆ¶æ•°è¡¨ç¤ºæ³•çš„å‰ä¸–ä»Šç”Ÿ</h2>
<p>å¦‚æœå¸¸ç”¨ ESLint çš„åŒå­¦ï¼Œåº”è¯¥çŸ¥é“å®ƒæœ‰ä¸€ä¸ªè§„åˆ™ <a href="https://eslint.org/docs/rules/radix">radix</a> æ˜¯è·Ÿ <code>parseInt()</code> ç›¸å…³çš„ã€‚</p>
<p>çœ‹ä¸ªä¾‹å­ï¼Œå®ƒä»¬åˆ†åˆ«æ‰“å°ä»€ä¹ˆç»“æœï¼Ÿ</p>
<pre><code class="language-js">parseInt('071') // 57
parseInt('071', 10) // 71
</code></pre>
<blockquote>
<p>æœ‰äº›æœ¬ç€æ±‚çœŸçš„åŒå­¦ï¼Œå°† <code>parseInt('071')</code> æ‹·åˆ°æ§åˆ¶å°å‘ç°ï¼Œæ— è®ºæ˜¯ Chromeã€Firefox è¿˜æ˜¯ Safari éƒ½æ˜¯æ‰“å°å‡º <code>71</code> è€Œä¸æ˜¯ <code>57</code>ã€‚</p>
</blockquote>
<p><strong>æˆ‘ä¸ºä»€ä¹ˆå†™æˆ <code>57</code> å‘¢ï¼Ÿæ˜¯å†™é”™äº†å—ï¼Ÿæ˜æ˜åœ¨æµè§ˆå™¨ä¸­ <code>parseInt('071')</code> éƒ½æ˜¯æ‰“å°å‡º <code>71</code> å‘¢ï¼</strong></p>
<p>å…ˆåˆ«æ€¥ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ã€Œä¸¥æ ¼æ¨¡å¼ã€ä¸‹ï¼Œæ˜¯ä¸å…è®¸ä½¿ç”¨ä»¥ <code>0</code> å¼€å¤´çš„å…«è¿›åˆ¶è¯­æ³•çš„ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;
var n = 071 // SyntaxError: Octal literals are not allowed in strict mode.
</code></pre>
<p><strong>ä½ æœ‰å¯èƒ½ä¸çŸ¥é“ï¼Œå…¶å®åœ¨ ES6 æ ‡å‡†å‘å¸ƒä¹‹å‰ï¼ŒECMAScript æ˜¯æ²¡æœ‰å…«è¿›åˆ¶è¯­æ³•çš„ï¼Œè‡³äºç±»ä¼¼ <code>071</code> è¿™ç§å…«è¿›åˆ¶è¡¨ç¤ºæ³•å®ƒåªæ˜¯è¢«æ‰€æœ‰æµè§ˆå™¨å‚å•†æ”¯æŒç½¢äº†</strong>ã€‚æ¯”å¦‚ <code>Object.prototype.__proto__</code> ä»æ¥å°±ä¸æ˜¯ ECMAScript çš„æ ‡å‡†è¯­æ³•ä¸€æ ·ï¼Œä½†æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒç½¢äº†ï¼Œæ ‡å‡†è¯­æ³•æ˜¯ <code>Object.getPrototypeOf()</code>ã€‚</p>
<blockquote>
<p><strong>åœ¨ ES6 ä¸­æä¾›äº†å…«è¿›åˆ¶æ•°çš„æ ‡å‡†è§„èŒƒï¼šåœ¨æ•°å­—å‰åŠ ä¸Š <code>0o</code> æ¥è¡¨ç¤ºå…«è¿›åˆ¶æ•°ï¼Œæ¯”å¦‚å…«è¿›åˆ¶çš„ <code>71</code> ç”¨ <code>0o71</code> è¡¨ç¤ºã€‚</strong></p>
</blockquote>
<p>å›åˆ° <code>parseInt(string, radix)</code> ä¸å…«è¿›åˆ¶çš„è¯é¢˜ä¸Šï¼Œ</p>
<p>å½“æ²¡æœ‰æŒ‡å®š <code>radix</code> å‚æ•°æ—¶ï¼Œçœ‹çœ‹å„å®¶æ˜¯å¦‚ä½•è§£æå…«è¿›åˆ¶æ•°çš„ï¼Ÿ</p>
<ul>
<li>
<p>ES3ã€Œä¸æå€¡ã€å°†å¸¦æœ‰ <code>0</code> å¼€å¤´çš„æ•°å€¼å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªå…«è¿›åˆ¶ã€‚<strong>ï¼ˆä¸èµæˆï¼Œä½†æ²¡ç¦æ­¢ï¼‰</strong></p>
</li>
<li>
<p>ES5 è§„èŒƒä¸­ã€Œä¸å…è®¸ã€<code>parseInt</code> å‡½æ•°çš„å®ç°ç¯å¢ƒæŠŠå¸¦æœ‰ <code>0</code> å¼€å¤´çš„æ•°å€¼å­—ç¬¦ä¸²è§£æä¸ºå…«è¿›åˆ¶æ•°å€¼ï¼Œè€Œæ˜¯ä»¥ <code>10</code> ä¸ºåŸºæ•°ï¼ˆå³åè¿›åˆ¶ï¼‰è¿›è¡Œè§£æã€‚<strong>ï¼ˆè§„èŒƒç¦æ­¢äº†ï¼Œä½†æµè§ˆå™¨æ²¡æœ‰æŒ‰æ ‡å‡†å®ç°ï¼‰</strong></p>
</li>
<li>
<p>å„æµè§ˆå™¨å‚å•†å¤§çˆ·ä»¬ï¼šæˆ‘åä¸æŒ‰ä½ è§„èŒƒå»å®ç°ï¼Œä»è¦æŠŠå¸¦æœ‰ <code>0</code> å¼€å¤´çš„æ•°å€¼å­—ç¬¦ä¸²è§£ææˆå…«è¿›åˆ¶æ•°å€¼ã€‚<strong>ï¼ˆæˆ‘è¡Œæˆ‘ç´ ï¼‰</strong></p>
</li>
</ul>
<p>æœ¬ç€æ±‚çœŸçš„æ€åº¦ï¼Œæ‹¿å‡ºäº†ä¸Šå¤ç¥å™¨å»éªŒè¯å¹¶å¾—å‡ºç»“æœï¼šåœ¨ IE8 åŠä»¥ä¸‹æµè§ˆå™¨ <code>parseInt('071')</code> æ‰“å°ç»“æœä¸º <code>57</code>ï¼ˆä¸‹å›¾ï¼‰ï¼Œè€Œ IE9 åŠä»¥ä¸Šåˆ™ä¸º <code>71</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-53afd121e15d550d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Internet Explorer 8"></p>
<p>éšç€ JavaScript çš„é£é€Ÿå‘å±•ï¼Œæµè§ˆå™¨å‚å•†ä»¬éƒ½å‘æ ‡å‡†é è¿‘äº†ï¼Œä¸å†è‚†æ„æˆ‘è¡Œæˆ‘ç´ äº†ã€‚è‡³äºæµè§ˆå™¨ <code>parseInt('071')</code> æ‰“å°ç»“æœæ˜¯ <code>71</code>ï¼ŒåŸå› æ­£æ˜¯ç°åœ¨çš„æµè§ˆå™¨ JS å¼•æ“æ˜¯ä»¥ <code>10</code> ä¸ºåŸºæ•°è¿›è¡Œè§£æäº†ã€‚</p>
<p>å°½ç®¡ 2022 å¹´äº†ï¼Œä½†ä»è¦å…¼å®¹æ—§ç‰ˆï¼ˆè¿œå¤ï¼‰æµè§ˆå™¨ï¼Œæ‰€ä»¥æ˜¾å¼æŒ‡å®š <code>radix</code> å‚æ•°æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ¬èŠ‚ç”¨ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æ¡ˆä¾‹æ¥è¯´æ˜ï¼Œä½¿ç”¨ <code>parseInt</code> å‡½æ•°æ—¶ï¼Œåº”å½“æŒ‡å®š <code>radix</code> å‚æ•°ã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œæœ‰å››ç§è¿›åˆ¶æ•°çš„è¡¨ç¤ºè¯­æ³•ï¼š</p>
<ul>
<li>åè¿›åˆ¶ï¼šæ²¡æœ‰ã€Œå‰å¯¼é›¶ã€çš„æ•°å€¼ã€‚</li>
<li>äºŒè¿›åˆ¶ï¼šä»¥ <code>0b</code> æˆ– <code>0B</code> å¼€å¤´çš„æ•°å€¼ã€‚</li>
<li>å…«è¿›åˆ¶ï¼šä»¥ <code>0o</code> æˆ– <code>0O</code> å¼€å¤´çš„æ•°å€¼ã€‚æµè§ˆå™¨ç­‰å®¿ä¸»ç¯å¢ƒä¹Ÿæ”¯æŒä»¥ã€Œå‰å¯¼é›¶ã€å¼€å¤´ï¼Œä¸”åªæœ‰ <code>0 ~ 7</code> çš„æ•°å­—è¡¨ç¤ºå…«è¿›åˆ¶æ•°ã€‚</li>
<li>åå…­è¿›åˆ¶ï¼šä»¥ <code>0x</code> æˆ– <code>0X</code> å¼€å¤´çš„æ•°å€¼ã€‚</li>
</ul>
<h2>ä¸‰ã€parseInt</h2>
<h3>è¯­æ³•</h3>
<pre><code class="language-js">parseInt(string, radix)
</code></pre>
<p>è§£æä¸€ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›æŒ‡å®šåŸºæ•°çš„ã€Œåè¿›åˆ¶æ•´æ•°ã€æˆ–è€… <code>NaN</code>ã€‚</p>
<ul>
<li>
<p><code>string</code>
è¢«è§£æçš„å€¼ã€‚è‹¥å‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå†…éƒ¨å…ˆéšå¼ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼ˆå³è°ƒç”¨ç›¸åº”å€¼çš„ <code>toString()</code> æ–¹æ³•ï¼‰</p>
</li>
<li>
<p><code>radix</code>ï¼ˆå¯é€‰ï¼Œå–å€¼èŒƒå›´ <code>2 ~ 36</code> çš„æ•´æ•°ï¼‰
è¡¨ç¤ºå­—ç¬¦ä¸²çš„åŸºæ•°ã€‚<strong>ä½†è¯·æ³¨æ„ï¼Œ<code>10</code> ä¸æ˜¯é»˜è®¤å€¼</strong>ï¼å½“å‚æ•° <code>radix</code> ç¼ºçœæ—¶ï¼Œä¼šæœ‰å‡ ç§æƒ…å†µï¼Œä¸‹é¢ä¼šä»‹ç»ã€‚</p>
</li>
</ul>
<h3>æ³¨æ„ç‚¹ 1</h3>
<p>è‹¥ <code>string</code> å‚æ•°å¸¦æœ‰å‰å¯¼æˆ–å°¾éšç©ºç™½ç¬¦ï¼ˆåŒ…æ‹¬ <code>\n</code>ã€<code>\r</code>ã€<code>\f</code>ã€<code>\t</code>ã€<code>\v</code> å’Œç©ºæ ¼ï¼‰ï¼Œå®ƒä»¬å°†ä¼šè¢«å¿½ç•¥ã€‚æ¢å¥è¯è¯´ï¼Œå®é™…æœ‰æ„ä¹‰çš„æ˜¯ç¬¬ä¸€ä¸ªéç©ºç™½ç¬¦å¼€å§‹ã€‚</p>
<pre><code class="language-js">parseInt('  \n\r\f\t\v   11', 2) // 3ï¼Œç›¸å½“äº parseInt('11', 2)
</code></pre>
<h3>æ³¨æ„ç‚¹ 2</h3>
<p>å½“ <code>string</code> å‚æ•°çš„ã€Œç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ã€ä¸èƒ½è½¬æ¢ä¸ºæ•°å­—ï¼Œæˆ–è€…å½“ <code>radix &lt; 2 || radix &gt; 36</code> æ—¶ï¼Œè¿”å›å€¼ä¸º <code>NaN</code>ã€‚</p>
<pre><code class="language-js">parseInt('a11') // NaN
parseInt('11', 1) // NaN
parseInt('11', 37) // NaN
</code></pre>
<p>ä½†è¯·æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—æ¯å¼€å¤´çš„éƒ½è¿”å› <code>NaN</code>ã€‚æ¯”å¦‚ <code>parseInt('a11', 12)</code> è¿”å›å€¼ä¸º <code>1453</code>ã€‚å› ä¸ºè¶…è¿‡åè¿›åˆ¶ä¹‹åï¼Œå­—æ¯ä¹Ÿå¯èƒ½ç”¨äºè¡¨ç¤ºç›¸åº”çš„è¿›åˆ¶æ•°çš„ã€‚</p>
<h3>æ³¨æ„ç‚¹ 3</h3>
<p>å½“ <code>radix</code> å‚æ•°ä¸º <code>undefined</code>ã€<code>null</code>ã€<code>0</code> æˆ–ç¼ºçœï¼ˆæœªæ˜¾å¼æŒ‡å®šï¼‰æ—¶ï¼ŒJavaScript å¼•æ“ä¼šå‡å®šä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>
<p>å¦‚æœ <code>string</code> æ˜¯ä»¥ <code>0x</code> æˆ– <code>0X</code> å¼€å¤´çš„ï¼Œé‚£ä¹ˆ <code>radix</code> å°†ä¼šå‡å®šä¸º <code>16</code>ï¼Œå°†å…¶ä½™éƒ¨åˆ†å½“ä½œåå…­è¿›åˆ¶æ•°å»è§£æã€‚æ¯”å¦‚ <code>parseInt('0xf')</code> ç›¸å½“äº <code>parseInt('f', 16)</code>ï¼Œç»“æœä¸º <code>15</code>ã€‚</p>
</li>
<li>
<p>å¦‚æœ <code>string</code> æ˜¯ä»¥ <code>0</code> å¼€å¤´çš„ï¼Œé‚£ä¹ˆ <code>radix</code> åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½è¢«å‡å®šä¸º <code>8</code>ï¼ˆå…«è¿›åˆ¶ï¼‰æˆ–å‡å®šä¸º <code>10</code>ï¼ˆåè¿›åˆ¶ï¼‰ã€‚å…·ä½“é€‰æ‹©å“ªä¸€ç§ä½œä¸º <code>radix</code> çš„å€¼ï¼Œè§†ä¹è¿è¡Œ JavaScript çš„å®¿ä¸»ç¯å¢ƒï¼ˆå‰é¢æåˆ°è¿‡äº†ï¼‰ã€‚<strong>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ <code>parseInt</code> æ—¶ï¼Œä¸€å®šè¦æ˜¾å¼æŒ‡å®š <code>radix</code> å‚æ•°ã€‚</strong></p>
</li>
<li>
<p>å¦‚ä½• <code>string</code> æ˜¯ä»¥ä»»ä½•å…¶ä»–å€¼å¼€å¤´ï¼Œ<code>radix</code> ä¼šè¢«å‡å®šä¸º <code>10</code>ï¼ˆåè¿›åˆ¶ï¼‰ã€‚</p>
</li>
</ul>
<h3>æ³¨æ„ç‚¹ 4</h3>
<p><code>parseInt</code> å¯¹ <code>string</code> çš„è§£æè§„åˆ™æ˜¯ï¼šä»ç¬¬ä¸€ä¸ªéç©ºç™½ç¬¦å¼€å§‹ï¼Œç„¶åä¸€ç›´å¾€åé¢æŸ¥æ‰¾ï¼Œè‹¥æœ‰ä»»æ„ä¸€ä¸ªå­—ç¬¦ä¸èƒ½è¢«è½¬æ¢ä¸ºæ•°å€¼å°±ä¼šåœæ­¢ï¼Œé‚£ä¹ˆæœ€ç»ˆè¢«è§£æçš„å­—ç¬¦ä¸²å°±æ˜¯ä»å¼€å§‹åˆ°åœæ­¢çš„è¿™ä¸€æˆªå­—ç¬¦ä¸²ã€‚</p>
<pre><code>parseInt('11a', 10) // ç»“æœä¸º 11ï¼Œè¢«è§£æçš„å­—ç¬¦ä¸²ä¸º '11'
parseInt('11a', 11) // ç»“æœä¸º 142ï¼Œè¢«è§£æçš„å­—ç¬¦ä¸²ä¸º '11a'ï¼Œå› ä¸ºåœ¨åä¸€è¿›åˆ¶é‡Œé¢ï¼Œa æ˜¯æœ‰æ„ä¹‰çš„ã€‚
</code></pre>
<p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ <code>parseInt</code> å¤„ç† <code>BigInt</code> ç±»å‹çš„æ—¶å€™ï¼Œæœ€ç»ˆçš„è¿”å›å€¼æ€»æ˜¯ä¸º <code>Number</code> ç±»å‹ï¼ˆè¿‡ç¨‹ä¸­ä¼šå¤±å»ç²¾åº¦ï¼‰ï¼Œå…¶ä¸­ <code>BigInt</code> ç±»å‹çš„æ‹–å°¾çš„ <code>n</code> æ˜¯ä¼šè¢«ä¸¢å¼ƒçš„ã€‚</p>
<pre><code class="language-js">parseInt(1024n, 10) // 1024
parseInt(1024n, 36) // 46732ï¼Œç›¸å½“äº parseInt('1024', 36)

// æ³¨æ„ï¼Œæœ‰åˆ«äºä»¥ä¸‹è¿™ä¸ª
parseInt('1024n', 36) // 1682375
</code></pre>
<p>åŸå› éå¸¸çš„ç®€å•ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡çš„ã€‚å½“ <code>parseInt</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ <code>String</code> ç±»å‹æ—¶ï¼Œä¼šè°ƒç”¨ <code>BigInt.prototype.toString()</code> æ–¹æ³•å…ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå³ <code>1024n.toString()</code>ï¼Œç»“æœä¸º <code>1024</code>ã€‚</p>
<h2>å››ã€æœ€å</h2>
<p>å›åˆ°æ–‡ç« å¼€å¤´çš„é¢˜ç›®ï¼š</p>
<pre><code class="language-js">[
  parseInt('1', 0),
  parseInt('2', 1),
  parseInt('3', 2)
]
</code></pre>
<p>è¿™æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥å¿«é€Ÿè¯´å‡ºç­”æ¡ˆäº†ï¼š<code>[1, NaN, NaN]</code>ã€‚</p>
<p>å€Ÿæœºå½»åº•å¼„æ‡‚äº† <code>parseInt()</code> çš„æ–¹æ³•ï¼Œå¯ä»¥æ»¡æ„åœ°ç¦»å¼€äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æµ…è¯» HTTP]]></title>
            <link>https://github.com/toFrankie/blog/issues/283</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/283</guid>
            <pubDate>Sun, 26 Feb 2023 12:51:01 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6654611cff6ccb95.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6654611cff6ccb95.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<!--

* ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ
* HTTP è§£å†³äº†ä»€ä¹ˆï¼Ÿ
* ä¸ºä»€ä¹ˆè¦é€‰æ‹© HTTPï¼Ÿ
* HTTP æ˜¯æ€æ ·çš„ï¼Ÿ

-->
<p><strong>HTTP</strong>ï¼Œå…¨ç§°æ˜¯ Hyper Text Transfer Protocolï¼Œè¯‘ä¸ºâ€œè¶…æ–‡æœ¬ä¼ è¾“åè®®â€ï¼ˆè¶…æ–‡æœ¬è½¬ç§»åè®®ï¼‰ã€‚</p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>åœ¨å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œäººä»¬ä¸ºäº†åœ¨ä¸–ç•ŒèŒƒå›´å†…è½»æ¾çŸ¥è¯†å…±äº«ï¼Œæå‡ºäº† Webï¼ˆWorld Wide Webï¼‰çš„æ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨ Web æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥ Web é¡µé¢å¯¹åº”çš„ URLï¼ŒWeb æµè§ˆå™¨ä» Web æœåŠ¡å™¨ç«¯è·å–åˆ°æ–‡ä»¶èµ„æºç­‰ä¿¡æ¯ï¼Œä»è€Œæ˜¾ç¤ºå‡º Web é¡µé¢ã€‚å®ƒä½¿ç”¨ HTTP åè®®ä¸ºè§„èŒƒï¼Œå®Œæˆåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¸€ç³»åˆ—çš„è¿ä½œæµç¨‹ã€‚</p>
<p>æœ€åˆï¼ŒHTTP åè®®å‡ºç°æ˜¯ä¸ºäº†è§£å†³æ–‡æœ¬ä¼ è¾“çš„éš¾é¢˜ã€‚ä½†ç”±äºåè®®æœ¬èº«éå¸¸ç®€å•ï¼Œç°åœ¨ HTTP åè®®å·²ç»è¶…å‡ºäº† Web è¿™ä¸ªæ¡†æ¶ï¼Œè¢«è¿ç”¨åˆ°å„ç§åœºæ™¯é‡Œã€‚</p>
<p>å°½ç®¡æˆ‘ä»¬å¸¸è¯´ï¼Œåœ¨ Web ä¸­å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯æ˜¯é€šè¿‡ HTTP åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œä½†ä¸ä»£è¡¨è¿™ä¸ªé€šä¿¡çš„å…¨è¿‡ç¨‹éƒ½ç”± HTTP å°±èƒ½å®Œæˆçš„ã€‚</p>
<p>é€šå¸¸ä½¿ç”¨çš„çš„ç½‘ç»œæ˜¯åœ¨ TCP/IP åè®®ç°‡çš„åŸºç¡€ä¸Šè¿ä½œçš„ï¼Œè€Œ HTTP å±äºå®ƒå†…éƒ¨çš„ä¸€ä¸ªå­é›†ã€‚</p>
<h2>äºŒã€æ¦‚å¿µ</h2>
<h4>åè®®ï¼ˆProtocolï¼‰</h4>
<p>åœ¨è®¡ç®—æœºä¸ç½‘ç»œè®¾å¤‡è¿›è¡Œé€šä¿¡ï¼ŒåŒæ–¹éœ€è¦åŸºäºç›¸åŒçš„æ–¹æ³•ã€‚ä¸åŒçš„ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ï¼Œæ‰€æœ‰çš„è¿™ä¸€åˆ‡éƒ½éœ€è¦ä¸€ç§è§„åˆ™ï¼Œè¿™ç§è§„åˆ™è¢«ç§°ä¸ºâ€œåè®®â€ã€‚</p>
<h4>TCP/IP åè®®ï¼ˆç°‡ï¼‰</h4>
<p>TCP/IPï¼ˆTransmission Control Protocol/Internet Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®/ç½‘é™…åè®®ï¼‰æ˜¯æŒ‡èƒ½å¤Ÿåœ¨å¤šä¸ªä¸åŒç½‘ç»œé—´å®ç°ä¿¡æ¯ä¼ è¾“çš„åè®®ç°‡ï¼ˆProtocol Suiteï¼Œä¹Ÿæœ‰è¯‘ä½œâ€œåè®®æ—â€ï¼‰ã€‚TCP/IP åè®®ä¸ä»…ä»…æŒ‡çš„æ˜¯ TCP å’Œ IP ä¸¤ä¸ªåè®®ï¼Œè€Œæ˜¯æŒ‡ç”± FTPã€SMTPã€TCPã€IP ç­‰åè®®æ„æˆçš„åè®®ç°‡ã€‚<strong>ç”±äºåœ¨ TCP/IP åè®®ä¸­ TCP åè®®å’Œ IP åè®®æœ€å…·ä»£è¡¨æ€§ï¼Œå› æ­¤è¢«ç§°ä¸º TCP/IP åè®®ã€‚</strong></p>
<h4>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„åˆ†å±‚</h4>
<p>OSIï¼ˆOpen System Interconnectï¼‰ä¸ƒå±‚æ¨¡å‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3f91724273a6a63d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>OSI ä¸ƒå±‚æ¨¡å‹ä¸ TCP/IP å››å±‚æ¨¡å‹çš„åŒºåˆ«ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c81de20c54419c00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>OSI ä¸ƒå±‚æ¨¡å‹ï¼š</p>
<pre><code class="language-text">åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰
    ç½‘ç»œæœåŠ¡ä¸æœ€ç»ˆç”¨æˆ·çš„ä¸€ä¸ªæ¥å£ã€‚
    åè®®æœ‰ï¼šHTTPã€FTPã€TFTPã€SMTPã€SNMPã€DNSã€TELNETã€POP3ã€DHCP ç­‰ã€‚

è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰
    æ•°æ®çš„è¡¨ç¤ºã€å®‰å…¨ã€å‹ç¼©ã€‚
    æ ¼å¼æœ‰ JPEGã€ASCIIã€EBCDICã€åŠ å¯†æ ¼å¼ç­‰ã€‚

ä¼šè¯å±‚ï¼ˆSession Layerï¼‰
    å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢ä¼šè¯ã€‚
    å¯¹åº”ä¸»æœºè¿›ç¨‹ï¼ŒæŒ‡æœ¬åœ°ä¸»æœºä¸è¿œç¨‹ä¸»æœºæ­£åœ¨è¿›è¡Œçš„ä¼šè¯ã€‚

ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰
    å®šä¹‰ä¼ è¾“æ•°æ®çš„åè®®ç«¯å£å·ï¼Œä»¥åŠæµæ§å’Œå·®é”™æ ¡éªŒã€‚
    åè®®æœ‰ï¼šTCPã€UDPï¼Œæ•°æ®åŒ…ä¸€æ—¦ç¦»å¼€ç½‘å¡å³è¿›å…¥ç½‘ç»œä¼ è¾“å±‚ã€‚

ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰
    è¿›è¡Œé€»è¾‘åœ°å€å¯»å€ï¼Œå®ç°ä¸åŒç½‘ç»œä¹‹é—´çš„è·¯å¾„é€‰æ‹©ã€‚
    åè®®æœ‰ï¼šICMPã€IGMPã€IPï¼ˆIPv4ã€IPv6ï¼‰ã€‚

æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰
    å»ºç«‹é€»è¾‘è¿æ¥ã€è¿›è¡Œç¡¬ä»¶åœ°å€å¯»å€ã€å·®é”™æ ¡éªŒç­‰åŠŸèƒ½ã€‚ï¼ˆç”±åº•å±‚ç½‘ç»œå®šä¹‰åè®®ï¼‰
    å°†æ¯”ç‰¹ç»„åˆå±‚å­—èŠ‚è¿›è€Œç»„åˆæˆå¸§ï¼Œç”¨ MAC åœ°å€è®¿é—®ä»‹è´¨ï¼Œé”™è¯¯å‘ç°ä½†ä¸èƒ½çº æ­£ã€‚

ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰
    å»ºç«‹ã€ç»´æŠ¤ã€æ–­å¼€ç‰©ç†è¿æ¥ã€‚ï¼ˆç”±åº•å±‚ç½‘ç»œå®šä¹‰åè®®ï¼‰
</code></pre>
<p>TCP/IP å››å±‚æ¨¡å‹ï¼š</p>
<p>TCP/IP åè®®ç°‡æŒ‰å±‚æ¬¡åˆ†åˆ«åˆ†ä¸ºï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ã€‚</p>
<pre><code class="language-text">åº”ç”¨å±‚ï¼š
    åº”ç”¨å±‚å†³å®šäº†å‘ç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡æ—¶é€šä¿¡çš„æ´»åŠ¨ã€‚
    TCP/IP åè®®ç°‡å†…é¢„è®¾äº†å„ç±»é€šç”¨çš„åº”ç”¨æœåŠ¡ã€‚æ¯”å¦‚ï¼šFTPã€DNS æœåŠ¡å°±æ˜¯å…¶ä¸­ä¸¤ç±»ã€‚
    HTTP åè®®ä¹Ÿå¤„äºè¯¥å±‚ã€‚

ä¼ è¾“å±‚ï¼š
    ä¼ è¾“å±‚å¯¹åº”ä¸Šå±‚åº”ç”¨å±‚ï¼Œæä¾›å¤„äºç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚
    åœ¨ä¼ è¾“å±‚æœ‰ä¸¤ä¸ªæ€§è´¨ä¸åŒçš„åè®®ï¼šTCP å’Œ UDPã€‚

ç½‘ç»œå±‚ï¼ˆç½‘ç»œäº’è¿å±‚ï¼‰ï¼š
    ç½‘ç»œå±‚ç”¨æ¥å¤„ç†åœ¨ç½‘ç»œä¸ŠæµåŠ¨çš„æ•°æ®åŒ…ã€‚æ•°æ®åŒ…æ˜¯ç½‘ç»œä¼ è¾“çš„æœ€å°æ•°æ®å•ä½ã€‚è¯¥å±‚è§„å®šäº†é€šè¿‡æ€æ ·çš„è·¯å¾„ï¼ˆæ‰€è°“çš„ä¼ è¾“è·¯çº¿ï¼‰åˆ°è¾¾å¯¹æ–¹è®¡ç®—æœºï¼Œå¹¶æŠŠæ•°æ®åŒ…ä¼ é€ç»™å¯¹æ–¹ã€‚
    ä¸å¯¹æ–¹è®¡ç®—æœºä¹‹é—´é€šè¿‡å¤šå°è®¡ç®—æœºæˆ–ç½‘ç»œè®¾å¤‡è¿›è¡Œä¼ è¾“æ—¶ï¼Œç½‘ç»œå±‚æ‰€èµ·çš„ä½œç”¨å°±æ˜¯åœ¨ä¼—å¤šçš„é€‰é¡¹å†…é€‰æ‹©ä¸€æ¡ä¼ è¾“çº¿è·¯ã€‚

é“¾è·¯å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œæ¥å£å±‚ï¼‰
    ç”¨æ¥å¤„ç†è¿æ¥ç½‘ç»œçš„ç¡¬ä»¶éƒ¨åˆ†ã€‚åŒ…æ‹¬æ§åˆ¶æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶çš„è®¾å¤‡é©±åŠ¨ã€NICï¼ˆç½‘ç»œé€‚é…å™¨ï¼Œå³ç½‘å¡ï¼‰ã€åŠå…‰çº¤ç­‰ç‰©ç†å¯è§éƒ¨åˆ†ï¼ˆè¿˜åŒ…æ‹¬è¿æ¥å™¨ç­‰ä¸€åˆ‡ä¼ è¾“åª’ä»‹ï¼‰ã€‚ç¡¬ä»¶ä¸Šçš„èŒƒç•´å‡åœ¨é“¾è·¯å±‚çš„ä½œç”¨èŒƒå›´ä¹‹å†…ã€‚
</code></pre>
<h2>ä¸‰ã€HTTP</h2>
<h4>HTTP çŠ¶æ€ç </h4>
<pre><code class="language-text">2XXï¼ˆæˆåŠŸï¼‰
    200 OKï¼šè¡¨ç¤ºè¯·æ±‚åœ¨æœåŠ¡ç«¯è¢«æ­£å¸¸å¤„ç†äº†ã€‚
    204 No Contentï¼šè¡¨ç¤ºè¯·æ±‚å·²æ­£å¸¸å¤„ç†ï¼Œä½†åœ¨è¿”å›çš„å“åº”æŠ¥æ–‡ä¸­ä¸å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚
    206 Partial Contentï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œäº†è¿™éƒ¨åˆ†çš„ GET è¯·æ±‚ã€‚

3XXï¼ˆé‡å®šå‘ï¼‰
    301 Moved Permanentlyï¼šè¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ã€‚å®ƒä¼šæŒ‰ç…§å“åº”æŠ¥æ–‡çš„ Location å­—æ®µé‡æ–°å‘èµ·è¯·æ±‚ã€‚
    302 Foundï¼šè¡¨ç¤ºä¸´æ—¶é‡å®šå‘ã€‚ä¸ 301 ç›¸ä¼¼ï¼Œä½†å®ƒåªæ˜¯ä¸´æ—¶æ€§è´¨çš„ï¼Œæ¢å¥è¯è¯´ï¼Œèµ„æºå¯¹åº” URI æœªæ¥è¿˜æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚
    303 See Otherï¼šè¡¨ç¤ºè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª URIï¼Œåº”ä½¿ç”¨ GET æ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æºã€‚
    304 Not Modifiedï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯èµ„æºæœªå‘ç”Ÿæ”¹å˜ï¼Œå¯ç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯æœªè¿‡æœŸçš„ç¼“å­˜ã€‚å°½ç®¡ 304 è¢«åˆ’åˆ†åœ¨ 3XX ç±»åˆ«ä¸­ï¼Œä½†å®ƒå’Œé‡å®šå‘æ²¡æœ‰å…³ç³»ã€‚
    307 Temporary Redirectï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 Found æœ‰ç€ç›¸åŒçš„å«ä¹‰ã€‚ä½†å®ƒä¸ä¼šä» POST å˜æˆ GETã€‚

4XXï¼ˆå®¢æˆ·ç«¯é”™è¯¯ï¼‰
    400 Bad Requestï¼šè¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚
    401 Unauthorizedï¼šè¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ï¼Œå³è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ã€‚
    403 Forbiddenï¼šè¡¨ç¤ºå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†ã€‚
    404 Not Foundï¼šè¡¨ç¤ºæœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚

5XXï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰
    500 Internal Server Errorï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œ è¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚
    503 Service Unavailableï¼šè¡¨ç¤ºæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚
</code></pre>
<h4>HTTP æŠ¥æ–‡</h4>
<pre><code class="language-text">æŠ¥æ–‡é¦–éƒ¨
ç©ºè¡Œ
æŠ¥æ–‡ä¸»ä½“

æŠ¥æ–‡é¦–éƒ¨åˆ†ä¸ºï¼šè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨ã€å“åº”æŠ¥æ–‡é¦–éƒ¨

è¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬ï¼šè¯·æ±‚è¡Œã€é¦–éƒ¨å­—æ®µï¼ˆè¯·æ±‚é¦–éƒ¨å­—æ®µã€é€šç”¨é¦–éƒ¨å­—æ®µã€å®ä½“é¦–éƒ¨å­—æ®µï¼‰ã€å…¶ä»–
å“åº”æŠ¥æ–‡åŒ…æ‹¬ï¼šçŠ¶æ€è¡Œã€é¦–éƒ¨å­—æ®µï¼ˆå“åº”é¦–éƒ¨å­—æ®µã€é€šç”¨é¦–éƒ¨å­—æ®µã€å®ä½“é¦–éƒ¨å­—æ®µï¼‰ã€å…¶ä»–

è¯·æ±‚è¡Œï¼šç”±æ–¹æ³•ã€URIã€HTTP ç‰ˆæœ¬ç»„æˆ
çŠ¶æ€è¡Œï¼šç”±HTTP ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆæ•°å­—å’ŒåŸå› çŸ­è¯­ï¼‰ç»„æˆ
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<!--

```
åº”ç”¨å±‚ï¼šï¼ˆHTTP åè®®ã€DNS åè®®ï¼‰
  1. å½¢æˆ HTTP æŠ¥æ–‡
  2. é€šè¿‡ DNS æœåŠ¡ï¼Œç”¨åŸŸåæŸ¥æ‰¾ IP åœ°å€ï¼ˆæˆ–é€†å‘åæŸ¥ï¼‰

ä¼ è¾“å±‚ï¼šï¼ˆTCP åè®®ï¼‰
  1. ä¸ºäº†ä¼ è¾“æ–¹ä¾¿ï¼Œå°†ä¸Šå±‚çš„ HTTP æŠ¥æ–‡è¿›è¡Œåˆ†éš”ï¼ˆå¹¶æ‰“ä¸Šæ ‡è®°ï¼Œæ–¹ä¾¿æœåŠ¡ç«¯æ¥æ”¶æ—¶æ–¹ä¾¿é‡ç»„æŠ¥æ–‡ï¼‰
  2. æä¾›å¯é çš„ä¼ è¾“æœåŠ¡ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ— è¯¯åœ°é€è¾¾ç›®æ ‡ï¼šï¼ˆå»ºç«‹ TCP è¿æ¥ï¼Œæ–¹å¼ä¸ºä¸‰æ¬¡æ¡æ‰‹ï¼‰

ç½‘ç»œå±‚ï¼šï¼ˆIP åè®®ï¼‰
  1. å¢åŠ ä½œä¸ºé€šä¿¡ç›®çš„åœ°çš„ MAC åœ°å€åï¼Œè½¬å‘ç»™é“¾è·¯å±‚
  2. æ ¹æ® IP åœ°å€æœç´¢å¯¹æ–¹çš„åœ°å€ï¼Œå¯èƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„ä¸­è½¬è¿‡ç¨‹

é“¾è·¯å±‚ï¼š
```

è¾“å…¥ URL çš„è¿‡ç¨‹

> 1. DNS æœåŠ¡è§£æï¼šå¾—åˆ°åŸŸåå¯¹åº”çš„ IP åœ°å€å’Œç«¯å£ã€‚
> 2. å»ºç«‹ TCP è¿æ¥ï¼šç¡®ä¿ä¼ è¾“å¯é æ€§ï¼Œä¸‰æ¬¡æ¡æ‰‹
> 3. å‘é€ HTTP è¯·æ±‚ï¼š
> 4. æœåŠ¡å™¨ç«¯è¿”å› HTTP å“åº”æŠ¥æ–‡ï¼š
> 5. æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢
> 6. è¿æ¥ç»“æŸ

-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åˆè¯• Yarn Workspaces]]></title>
            <link>https://github.com/toFrankie/blog/issues/282</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/282</guid>
            <pubDate>Sun, 26 Feb 2023 12:50:04 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8ca6d14242f855ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8ca6d14242f855ee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç¤ºä¾‹ ğŸ‘‰ <strong><a href="https://github.com/toFrankie/yarn-workspaces-demo">toFrankie/yarn-workspaces-demo</a></strong></p>
<h2>Usage</h2>
<p>æŸ¥çœ‹ workspaces</p>
<pre><code class="language-shell"># æŸ¥çœ‹ Workspace ä¿¡æ¯
$ yarn workspaces info
</code></pre>
<p>æ‰§è¡Œè„šæœ¬å‘½ä»¤</p>
<pre><code class="language-shell"># åœ¨æŸä¸ª workspace ä¸­æ‰§è¡Œè„šæœ¬å‘½ä»¤
$ yarn workspace &lt;workspace-name&gt; &lt;command&gt;

# åœ¨æ‰€æœ‰ workspace ä¸­æ‰§è¡Œè„šæœ¬å‘½ä»¤
$ yarn workspaces run &lt;command&gt;
</code></pre>
<p>æ·»åŠ ä¾èµ–</p>
<pre><code class="language-shell"># åœ¨æŸä¸ª workspace ä¸­æ·»åŠ ä¾èµ–
$ yarn workspace &lt;workspace-name&gt; add &lt;package&gt;
</code></pre>
<p>*ä»¥ä¸Šä¸º Yarn 1.x å‘½ä»¤ï¼Œè€Œ 2.x éƒ¨åˆ†æœ‰è°ƒæ•´ï¼Œè¯¦çœ‹<a href="https://yarnpkg.com/features/workspaces">è¿™é‡Œ</a>ã€‚</p>
<h2>è½¯é“¾æ¥æŸ¥æ‰¾</h2>
<p>å‡è®¾æˆ‘ä»¬é¡¹ç›®çš„ Workspaces å¦‚ä¸‹ï¼Œ</p>
<pre><code class="language-json">{
  &quot;@workspace/project-1&quot;: {
    &quot;location&quot;: &quot;packages/project-1&quot;,
    &quot;workspaceDependencies&quot;: [&quot;@workspace/common&quot;],
    &quot;mismatchedWorkspaceDependencies&quot;: []
  },
  &quot;@workspace/project-2&quot;: {
    &quot;location&quot;: &quot;packages/project-2&quot;,
    &quot;workspaceDependencies&quot;: [],
    &quot;mismatchedWorkspaceDependencies&quot;: []
  },
  &quot;@workspace/common&quot;: {
    &quot;location&quot;: &quot;packages/common&quot;,
    &quot;workspaceDependencies&quot;: [],
    &quot;mismatchedWorkspaceDependencies&quot;: []
  }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­ <code>@workspace/project-1</code> ä¾èµ–äº† <code>@workspace/common</code>ï¼Œæ‰€ä»¥ <code>workspaceDependencies</code> ä¸ä¸ºç©ºã€‚åä¹‹ï¼Œæ²¡æœ‰å¼•ç”¨çš„è¯å°±ä¸ºç©ºæ•°ç»„ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬åœ¨ <code>project-1</code> ä¸­å¼•ç”¨äº† <code>common</code> ä¸­çš„å¯¼å‡ºæ¨¡å—ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// packages/common/index.js
export const config = { name: 'Frankie', age: 20 }
</code></pre>
<pre><code class="language-js">// packages/project-1/index.js
import { config } from '@workspace/common'
console.log(config)
</code></pre>
<p>å½“ <code>project-1</code> ä¸­æŸ¥æ‰¾ <code>@workspace/common</code> æ—¶ï¼š</p>
<ol>
<li>å…ˆæŸ¥æ‰¾ <code>project-1</code> æ˜¯å¦å­˜åœ¨å¯¹åº”ç‰ˆæœ¬çš„ <code>@workspace/common</code>ï¼Œè‹¥æ‰¾ä¸åˆ°ç»§ç»­å¾€ä¸‹ï¼›</li>
<li>æŸ¥æ‰¾ workspace-root æ˜¯å¦å­˜åœ¨å¯¹åº”ç‰ˆæœ¬çš„ <code>@workspace/common</code>ï¼Œè‹¥æ‰¾ä¸åˆ°ç»§ç»­å¾€ä¸‹ï¼›</li>
<li>æŸ¥æ‰¾ NPM å¹³å°æ˜¯å¦å­˜åœ¨å¯¹åº”ç‰ˆæœ¬çš„ <code>@workspace/common</code>ï¼Œè‹¥æ‰¾åˆ°ä¼šæ‹‰å–ä¸‹æ¥ï¼Œè‹¥æ‰¾ä¸åˆ°ç»§ç»­å¾€ä¸‹ï¼›</li>
<li>æŠ›å‡ºé”™è¯¯ Not Foundã€‚</li>
</ol>
<h2>References</h2>
<ul>
<li><a href="https://classic.yarnpkg.com/lang/en/docs/workspaces/">Yarn Workspace 1.x</a></li>
<li><a href="https://yarnpkg.com/features/workspaces">Yarn Workspace 2.x</a></li>
<li><a href="https://juejin.cn/post/7011024137707585544">Monorepo æœ€ä½³å®è·µä¹‹ Yarn Workspaces</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | JavaScript æ¨¡å—åŒ–ä¹‹è·¯]]></title>
            <link>https://github.com/toFrankie/blog/issues/281</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/281</guid>
            <pubDate>Sun, 26 Feb 2023 12:47:42 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8cb6821ff4fdc2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8cb6821ff4fdc2a0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å­¦ä¹ ä¸èƒ½åœï¼Œéƒ½ç»™æˆ‘å·èµ·æ¥...</p>
<h2>ä¸€ã€å‰ä¸–ä»Šç”Ÿ</h2>
<p>åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript ä¸€ç›´æ²¡æœ‰å®˜æ–¹çš„æ¨¡å—ï¼ˆModuleï¼‰ä½“ç³»ï¼Œå¯¹äºå¼€å‘å¤§å‹ã€å¤æ‚çš„é¡¹ç›®å½¢æˆäº†å·¨å¤§çš„éšœç¢ã€‚å¹¸å¥½ç¤¾åŒºä¸Šæœ‰ä¸€äº›æ¨¡å—åŠ è½½æ–¹æ¡ˆï¼Œæœ€ä¸»è¦çš„æœ‰ CommonJSï¼ˆCommonJS Modulesï¼‰å’Œ AMDï¼ˆAsynchronous Module Definitionï¼‰ä¸¤ç§æ¨¡å—è§„èŒƒï¼Œå‰è€…ç”¨äºæœåŠ¡å™¨ï¼Œåè€…ç”¨äºæµè§ˆå™¨ã€‚</p>
<p>éšç€ ES6 çš„æ­£å¼å‘å¸ƒï¼Œå…¨æ–°çš„æ¨¡å—å°†é€æ­¥å–ä»£ CommonJS å’Œ AMD è§„èŒƒï¼Œæˆä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šç”¨çš„æ¨¡å—è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ES6 æ¨¡å—çš„è®¾è®¡æ€æƒ³å°½é‡çš„é™æ€åŒ–ï¼Œæ˜¯çš„ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè¾“å…¥å’Œè¾“å‡ºçš„å˜é‡ã€‚</p>
<blockquote>
<p>åœ¨ <a href="https://rollupjs.org/guide/en/#tree-shaking">rollup</a>ã€ <a href="https://webpack.docschina.org/guides/tree-shaking/#root">webpack</a> ç­‰æ„å»ºå·¥å…·ä¸­å¸¸è§çš„ <strong>Tree Shaking</strong> èƒ½åŠ›ï¼Œå°±æ˜¯ä¾èµ–äº ES6 æ¨¡å—çš„<a href="https://exploringjs.com/es6/ch_modules.html#static-module-structure">é™æ€ç‰¹æ€§</a>å®ç°çš„ã€‚</p>
</blockquote>
<p>è€Œ CommonJS å’Œ AMD æ¨¡å—éƒ½åªèƒ½åœ¨è¿è¡Œæ—¶ç¡®å®šè¿™äº›ä¸œè¥¿ã€‚æ¯”å¦‚ï¼ŒCommonJS æ¨¡å—å°±æ˜¯å¯¹è±¡ï¼Œè¾“å…¥æ—¶å¿…é¡»æŸ¥æ‰¾å¯¹è±¡å±æ€§ã€‚</p>
<pre><code class="language-js">// CommonJS æ¨¡å—
const { stat, exists, readFile } = require('fs')

// ç›¸å½“äº
const _fs = require('fs')
const stat = _fs.stat
const exists = _fs.exists
const readFile = _fs.readFile
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œå®é™…ä¸Šæ˜¯æ•´ä½“åŠ è½½äº† <code>fs</code> æ¨¡å—ï¼ˆå³åŠ è½½ <code>fs</code> çš„æ‰€æœ‰æ–¹æ³•ï¼‰ï¼Œç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡ <code>_fs</code>ï¼Œç„¶åå†ä»è¿™ä¸ªå¯¹è±¡ä¸Šè¯»å–äº† 3 ä¸ªæ–¹æ³•ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºâ€œ<strong>è¿è¡Œæ—¶åŠ è½½</strong>â€ï¼ŒåŸå› æ˜¯åªæœ‰è¿è¡Œæ—¶æ‰èƒ½å¾—åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå¯¼è‡´å®Œå…¨æ²¡æœ‰åŠæ³•åœ¨ç¼–è¯‘æ—¶åšâ€œé™æ€ä¼˜åŒ–â€ã€‚</p>
<p>ES6 æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ <code>export</code> å‘½ä»¤æ˜¾å¼æŒ‡å®šè¾“å‡ºçš„ä»£ç ï¼Œå†é€šè¿‡ <code>import</code> å‘½ä»¤è¾“å…¥ã€‚</p>
<pre><code class="language-js">import { stat, exists, readFile } from 'fs'
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œå®é™…ä¸Šæ˜¯ä» <code>fs</code> æ¨¡å—ä¸­åŠ è½½äº† 3 ä¸ªæ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ä¸åŠ è½½ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºâ€œ<strong>ç¼–è¯‘æ—¶åŠ è½½</strong>â€æˆ–â€œ<strong>é™æ€åŠ è½½</strong>â€ï¼Œå³ ES6 æ¨¡å—å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆæ¨¡å—åŠ è½½ï¼Œæ•ˆç‡è¦é«˜äº CommonJS æ¨¡å—çš„åŠ è½½æ–¹å¼ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æ²¡æ³•å¼•ç”¨ ES6 æ¨¡å—æœ¬èº«ï¼Œå› ä¸ºå®ƒä¸æ˜¯å¯¹è±¡ã€‚</p>
<p>ç”±äº ES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶åŠ è½½ï¼Œä½¿å¾—é™æ€åˆ†ææˆä¸ºå¯èƒ½ã€‚æœ‰äº†å®ƒï¼Œå°±èƒ½è¿›ä¸€æ­¥æ‹“å®½ JavaScript çš„è¯­æ³•ï¼Œæ¯”å¦‚å¼•å…¥å®ï¼ˆmacroï¼‰å’Œç±»å‹æ£€éªŒï¼ˆtype systemï¼‰è¿™äº›åªèƒ½é é™æ€åˆ†æå®ç°çš„åŠŸèƒ½ã€‚</p>
<p>é™¤äº†é™æ€åŠ è½½å¸¦æ¥çš„å„ç§å¥½å¤„ï¼ŒES6 æ¨¡å—è¿˜æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ul>
<li>ä¸å†éœ€è¦ UMD æ¨¡å—æ ¼å¼äº†ï¼Œå°†æ¥æœåŠ¡å™¨å’Œæµè§ˆå™¨éƒ½ä¼šæ”¯æŒ ES6 æ¨¡å—æ ¼å¼ã€‚</li>
<li>å°†æ¥æµè§ˆå™¨çš„æ–° API å°±èƒ½ç”¨æ¨¡å—æ ¼å¼æä¾›ï¼Œä¸å†å¿…é¡»åšæˆå…¨å±€å˜é‡æˆ–è€… navigator å¯¹è±¡çš„å±æ€§ã€‚</li>
<li>ä¸å†éœ€è¦å¯¹è±¡ä½œä¸ºå‘½åç©ºé—´ï¼ˆæ¯”å¦‚ Math å¯¹è±¡ï¼‰ï¼Œæœªæ¥è¿™äº›åŠŸèƒ½å¯ä»¥é€šè¿‡æ¨¡å—æä¾›ã€‚</li>
</ul>
<h2>äºŒã€ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–ï¼Ÿ</h2>
<p>ä¸¾ä¸ª ğŸŒ°</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;body&gt;
    &lt;script src=&quot;module-a.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;module-b.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="language-js">// module-a.js
var person = { name: 'Frankie', age: 20 }
</code></pre>
<pre><code class="language-js">// module-b.js
console.log(person.name) // å°†ä¼šæ‰“å°ä»€ä¹ˆå‘¢ï¼Ÿ
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥è½»è€Œæ˜“ä¸¾å°±çŸ¥é“ <code>module-b.js</code> é‡Œå°†ä¼šæ‰“å°å‡º <code>Frankie</code>ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå®ƒä»¬éƒ½æ˜¯å¤„äºå…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œå› æ­¤ <code>module-b.js</code> ä¸­çš„ <code>person.name</code> å°±èƒ½è¯»å–åˆ°åœ¨ <code>module-a.js</code> ä¸­å®šä¹‰çš„ person å˜é‡ã€‚</p>
<p>å¦‚æœå°† <code>module-a.js</code> å’Œ <code>module-b.js</code> åœ¨ HTML ä¸­çš„é¡ºåºæ¢è¿‡æ¥ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚åŸå› æ˜¯<code>&lt;script&gt;</code> æ˜¯æŒ‰å—åŠ è½½çš„ï¼ŒåŒ…æ‹¬ä¸‹è½½ã€ï¼ˆé¢„ï¼‰ç¼–è¯‘å’Œæ‰§è¡Œã€‚å”¯æœ‰å½“å‰å—æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…æŠ›å‡ºé”™è¯¯ï¼Œæ‰ä¼šæ¥ç€åŠ è½½ä¸‹ä¸€ä¸ª <code>&lt;script&gt;</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œæåˆ°çš„æŒ‰é¡ºåºåŠ è½½ï¼Œæ˜¯æŒ‡æ²¡æœ‰ <code>defer</code> å’Œ <code>async</code> å±æ€§çš„å“ˆã€‚å®ƒä¿©å¯¹å¤–éƒ¨è„šæœ¬çš„åŠ è½½æ–¹å¼æ˜¯æœ‰å½±å“çš„ã€‚ä½†éæœ¬æ–‡è¯é¢˜ï¼Œå› æ­¤ä¸å±•å¼€è®²è¿°ã€‚</p>
</blockquote>
<p>é‚£é—®é¢˜å°±æ¥äº†ï¼Œè¿™å¾ˆå®¹æ˜“é€ æˆ<strong>å…¨å±€æ±¡æŸ“</strong>ï¼Œå¯¹äºå¤§å‹ã€å¤æ‚çš„é¡¹ç›®æ¥è¯´ä¼šéå¸¸æ£˜æ‰‹ã€‚</p>
<h4>å‡è®¾æ²¡æœ‰è¯¸å¦‚ CommonJS ç­‰æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆå¯ç”¨ï¼Œè¦æ€æ ·è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ</h4>
<p><strong>1. å¯¹è±¡å­—é¢é‡ï¼ˆObject Literalï¼‰</strong></p>
<pre><code class="language-js">// å£°æ˜
var namespace = {
  prop: 123,
  method: function () {},
  // ...
}

// è°ƒç”¨
namespace.prop
namespace.method()
</code></pre>
<p>ç¼ºç‚¹ï¼š</p>
<p>ä½œä¸ºä¸€ä¸ªå•ä¸€çš„ã€æœ‰æ—¶å¾ˆé•¿çš„å¥æ³•ç»“æ„ï¼Œå®ƒå¯¹å…¶å†…å®¹æ–½åŠ äº†é™åˆ¶ã€‚å†…å®¹å¿…é¡»åœ¨ <code>{}</code> ä¹‹é—´ï¼Œå¹¶ä¸”å±æ€§æˆ–æ–¹æ³•ä¹‹é—´å¿…é¡»æ·»åŠ é€—å·ã€‚å½“æ¨¡å—å†…å®¹å¤æ‚èµ·æ¥ä¹‹åï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼Œç§»åŠ¨å†…å®¹å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„å‘½åç©ºé—´ï¼šå¯ä»¥å°†æ¨¡å—å®šä¹‰åˆ†æ•£åˆ°å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼åˆ›å»ºå‘½åç©ºé—´å˜é‡ï¼Œåˆ™å¯å¿½è§†åŠ è½½æ–‡ä»¶çš„é¡ºåºã€‚</p>
<pre><code class="language-js">var namespace = namespace || {}
</code></pre>
<p>ä½¿ç”¨å¤šä¸ªæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå•ä¸ªå…¨å±€å‘½åç©ºé—´å¹¶å‘å…¶æ·»åŠ å­æ¨¡å—æ¥é¿å…å…¨å±€åç§°çš„æ‰©æ•£ã€‚ä¸å»ºè®®è¿›ä¸€æ­¥åµŒå¥—ï¼Œå¦‚æœåç§°å†²çªæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ›´é•¿çš„åç§°ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºï¼šåµŒå¥—å‘½åç©ºé—´ã€‚</p>
<pre><code class="language-js">// å…¨å±€å‘½åç©ºé—´
var globalns = globalns || {}

// æ·»åŠ  A å­æ¨¡å—
globalns.moduleA = {
  // module content
}

// æ·»åŠ  B å­æ¨¡å—
globalns.moduleB = {
  // module content
}
</code></pre>
<p>å°½ç®¡ä½¿ç”¨å‘½åç©ºé—´å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å‘½åå†²çªçš„é—®é¢˜ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ <code>moduleB</code> ä¸­å¯ä»¥ä¿®æ”¹ <code>moduleA</code> çš„å†…å®¹ï¼Œè€Œä¸” <code>moduleA</code> å¯èƒ½è¿˜è’™åœ¨é¼“é‡Œï¼Œä¸çŸ¥æƒ…ã€‚</p>
<blockquote>
<p>ä»¥ä¸Šå‘½åç©ºé—´å†…çš„æ‰€æœ‰æˆå‘˜å’Œæ–¹æ³•ï¼Œæ— è®ºæ˜¯å¦ç§æœ‰ï¼Œå¯¹å¤–éƒ½æ˜¯å¯è®¿é—®çš„ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œæ¨¡å—åŒ–ä¸åº”è¯¥å¦‚æ­¤è®¾è®¡ã€‚</p>
</blockquote>
<p>Yahoo å…¬å¸çš„ <a href="https://clarle.github.io/yui2/">YUI 2</a> å°±æ˜¯é‡‡ç”¨äº†è¿™ç§æ–¹æ¡ˆã€‚</p>
<p><strong>2. ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆImmediately-Invoked Function Expressionï¼Œç®€ç§° IIFEï¼‰</strong></p>
<p>åœ¨æ¨¡å—æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ IIFE å°†ç¯å¢ƒé™„åŠ åˆ°æ¨¡å—æ•°æ®ã€‚å¯ä»¥ä»æ¨¡å—è®¿é—®è¯¥ç¯å¢ƒå†…çš„ç»‘å®šï¼Œä½†ä¸èƒ½ä»å¤–éƒ¨è®¿é—®ã€‚å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ IIFE ä¸ºæˆ‘ä»¬æä¾›äº†æ‰§è¡Œåˆå§‹åŒ–çš„åœ°æ–¹ã€‚</p>
<pre><code class="language-js">var namespace = (function () {
  // private data
  var _prop = 123
  var _method = function () {}

  return {
    // read-only
    get prop() {
      return _prop
    },
    get method() {
      return _method
    }
  }
})()
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨å¤–éƒ¨ç›´æ¥ä¿®æ”¹  <code>namespace</code> å†…éƒ¨çš„æˆå‘˜æˆ–è€…æ–¹æ³•äº†ã€‚</p>
<pre><code class="language-js">// è¯»å–
namespace.prop // 123
namespace.method() 

// å†™å…¥
namespace.prop = 456 // æ— æ•ˆ
namespace.method = function foo() {} // æ— æ•ˆ
</code></pre>
<p>å› æ­¤ï¼Œç»“åˆå‰é¢çš„å†…å®¹ï¼Œå°±å¯ä»¥è¿™æ ·å»å¤„ç†ï¼š</p>
<pre><code class="language-js">// å…¨å±€å‘½åç©ºé—´
var globalns = globalns || {}

// æ·»åŠ  A å­æ¨¡å—
globalns.moduleA = (function () {
  // ...

  return {
    // ...
  }
})()

// æ·»åŠ  B å­æ¨¡å—
globalns.moduleB = (function () {
  // ...

  return {
    // ...
  }
})()
</code></pre>
<p>åˆ°ç°åœ¨ï¼Œæœ‰äº†å‘½åç©ºé—´è§£å†³äº†å‘½åå†²çªé—®é¢˜ï¼ŒåŒæ—¶ä½¿ç”¨ IIFE æ¥ç»´æŠ¤å„æ¨¡å—çš„ç§æœ‰æˆå‘˜å’Œæ–¹æ³•ï¼Œå¯¼å‡ºå¯¹å¤–çš„å¼€æ”¾æ¥å£å³å¯ã€‚è¿™ä¼¼ä¹æœ‰äº†æ¨¡å—åŒ–è¯¥æœ‰çš„æ ·å­ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å‰é¢æåˆ°è¿‡ <code>&lt;script&gt;</code> æ˜¯æŒ‰ä¹¦å†™é¡ºåºåŠ è½½çš„ï¼ˆå³ä½¿ä¸‹è½½é¡ºåºå¯èƒ½å¹¶è¡Œçš„ï¼‰ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>è„šæœ¬ä¸‹è½½</li>
<li>è„šæœ¬è§£æï¼ˆç¼–è¯‘å’Œæ‰§è¡Œï¼‰</li>
</ul>
<p>å‡è®¾æˆ‘ä»¬çš„è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;body&gt;
    &lt;script src=&quot;module-a.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;module-b.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„ <code>modueA</code> åœ¨ï¼ˆé¦–æ¬¡ï¼‰è§£æçš„æ—¶å€™ï¼Œå°±æ²¡åŠæ³•è°ƒç”¨ <code>moduleB</code> çš„å†…å®¹ï¼Œå› ä¸ºå®ƒå‹æ ¹è¿˜æ²¡è§£ææ‰§è¡Œã€‚ä¸€æ—¦é¡¹ç›®å¤æ‚åº¦ã€æ¨¡å—æ•°é‡ä¸Šæ¥ä¹‹åï¼Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å°±å¾ˆéš¾ç»´æŠ¤äº†ã€‚</p>
<h2>ä¸‰ã€ç¤¾åŒºæ¨¡å—åŒ–æ–¹æ¡ˆ</h2>
<p>åœ¨ ES2015 ä¹‹å‰ï¼Œç¤¾åŒºä¸Šå·²ç»æœ‰äº†å¾ˆå¤šæ¨¡å—åŒ–æ–¹æ¡ˆï¼Œæµè¡Œçš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼šï¼š</p>
<blockquote>
<ul>
<li><strong>CommonJS</strong></li>
<li><strong>AMD</strong>ï¼ˆAsynchronous Module Definitionï¼‰</li>
<li><strong>CMD</strong>ï¼ˆCommon Module Definitionï¼‰</li>
<li><strong>UMD</strong>ï¼ˆUniversal Module Definitionï¼‰</li>
</ul>
</blockquote>
<p>å…¶ä¸­ CommonJS è§„èŒƒåœ¨ Node.js ç¯å¢ƒä¸‹å–å¾—äº†å¾ˆä¸é”™çš„å®è·µï¼Œå®ƒåªèƒ½åº”ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œè€Œä¸æ”¯æŒæµè§ˆå™¨ç¯å¢ƒã€‚CommonJS è§„èŒƒçš„æ¨¡å—æ˜¯åŒæ­¥åŠ è½½çš„ï¼Œç”±äºæœåŠ¡å™¨çš„æ¨¡å—æ–‡ä»¶å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œåªæœ‰ç£ç›˜ I/O çš„ï¼Œå› æ­¤åŒæ­¥åŠ è½½æœºåˆ¶æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>ä½†åœ¨æµè§ˆå™¨ç¯å¢ƒï¼Œä¸€æ˜¯ä¼šäº§ç”Ÿå¼€é”€æ›´å¤§çš„ç½‘ç»œ I/Oï¼ŒäºŒæ˜¯å¤©ç„¶å¼‚æ­¥ï¼Œå°±ä¼šäº§ç”Ÿæ—¶åºä¸Šçš„é”™è¯¯ã€‚åæ¥ç¤¾åŒºä¸Šæ¨å‡ºäº†å¼‚æ­¥åŠ è½½ã€å¯åœ¨æµè§ˆå™¨ç¯å¢ƒè¿è¡Œçš„ RequireJS æ¨¡å—åŠ è½½å™¨ï¼Œä¸ä¹…ä¹‹åï¼Œèµ·è‰å¹¶å‘å¸ƒäº† AMD æ¨¡å—åŒ–æ ‡å‡†è§„èŒƒã€‚</p>
<p>ç”±äº AMD ä¼šæå‰åŠ è½½ï¼Œå¾ˆå¤šå¼€å‘è€…æ‹…å¿ƒæœ‰æ€§èƒ½é—®é¢˜ã€‚å‡è®¾ä¸€ä¸ªæ¨¡å—ä¾èµ–äº†å¦å¤– 5 ä¸ªæ¨¡å—ï¼Œä¸ç®¡è¿™äº›æ¨¡å—æ˜¯å¦é©¬ä¸Šè¢«ç”¨åˆ°ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€éï¼Œè¿™äº›æ€§èƒ½æ¶ˆè€—æ˜¯ä¸å®¹å¿½è§†çš„ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæœ‰éƒ¨åˆ†äººè¯•å›¾ä¿ç•™ CommonJS ä¹¦å†™æ–¹å¼å’Œå»¶è¿ŸåŠ è½½ã€å°±è¿‘å£°æ˜ï¼ˆå°±è¿‘ä¾èµ–ï¼‰ç­‰ç‰¹æ€§ï¼Œå¹¶å¼•å…¥å¼‚æ­¥åŠ è½½æœºåˆ¶ï¼Œä»¥é€‚é…æµè§ˆå™¨ç‰¹æ€§ã€‚æ¯”å¦‚ï¼Œå·²ç»å‡‰å‡‰çš„ BravoJSã€FlyScript ç­‰æ–¹æ¡ˆã€‚</p>
<p>åœ¨ 2011 å¹´ï¼Œå›½å†…çš„å‰ç«¯å¤§ä½¬ç‰ä¼¯æå‡ºäº† SeaJSï¼Œå®ƒå€Ÿé‰´äº† CommonJSã€AMDï¼Œå¹¶æå‡ºäº† CMD æ¨¡å—åŒ–æ ‡å‡†è§„èŒƒã€‚ä½†å¹¶æ²¡æœ‰å¤§èŒƒå›´çš„æ¨å¹¿å’Œä½¿ç”¨ã€‚</p>
<p>åœ¨ 2014 å¹´ï¼Œç¾ç±åè£” Homa Wong æå‡ºäº† UMD æ–¹æ¡ˆï¼šå°† CommonJS å’Œ AMD ç›¸ç»“åˆã€‚æœ¬è´¨ä¸Šè¿™ä¸ç®—æ˜¯ä¸€ç§æ¨¡å—åŒ–æ–¹æ¡ˆã€‚</p>
<p>åˆ°äº† 2015 å¹´ 6 æœˆï¼Œéšç€ ECMAScript 2015 çš„æ­£å¼å‘å¸ƒï¼ŒJavaScript ç»ˆäºåŸç”Ÿæ”¯æŒæ¨¡å—åŒ–ï¼Œè¢«ç§°ä¸º ES Moduleã€‚åŒæ—¶æ”¯æŒæœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ç«¯ã€‚</p>
<p>å°½ç®¡åˆ°äº† 2022 å¹´ï¼Œç°çŠ¶ä»ç„¶æ˜¯å¤šç§æ¨¡å—åŒ–æ–¹æ¡ˆå…±å­˜ï¼Œä½†æœªæ¥è‚¯å®šæ˜¯ ES Module ä¸€ç»Ÿæ±Ÿæ¹–...</p>
<blockquote>
<p>å…³äº JavaScript æ¨¡å—åŒ–å†å²çº¿ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://segmentfault.com/a/1190000023017398">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h2>å››ã€CommonJS</h2>
<p><a href="https://nodejs.org/en/">Node.js</a> çš„æ¨¡å—ç³»ç»Ÿæ˜¯åŸºäº <a href="http://www.commonjs.org/specs/modules/1.0/">CommonJS</a> è§„èŒƒçš„å®ç°çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåƒ <a href="https://couchdb.apache.org/">CouchDB</a> ç­‰ä¹Ÿæ˜¯ CommonJS çš„ä¸€ç§å®ç°ã€‚è€Œä¸”å®ƒä»¬æœ‰ä¸€äº›æ˜¯æ²¡æœ‰å®Œå…¨æŒ‰ç…§ CommonJS è§„èŒƒå»å®ç°çš„ï¼Œç”šè‡³é¢å¤–æ·»åŠ äº†ç‰¹æœ‰çš„åŠŸèƒ½ã€‚</p>
<p>ç”±äºæˆ‘ä»¬æ¥è§¦åˆ°çš„ CommonJS é€šå¸¸æŒ‡ Node.js ä¸­çš„æ¨¡å—åŒ–è§£å†³æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥æåˆ°çš„ CommonJS å‡æŒ‡ Node.js çš„æ¨¡å—ç³»ç»Ÿã€‚</p>
<p>å…ˆç…ä¸€ä¸‹ï¼Œä¸€ä¸ª CommonJS æ¨¡å—é‡Œé¢éƒ½åŒ…æ‹¬ä¸€äº›ä»€ä¹ˆä¿¡æ¯ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-00c9aa6d08914919.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœæœ‰ä¸€äº›çœ‹ä¸æ‡‚æˆ–ä¸äº†è§£å…¶ç”¨å¤„çš„ï¼Œå…ˆä¸æ€¥ï¼Œä¸‹é¢å¨“å¨“é“æ¥ã€‚</p>
<p>CommonJS çš„æ¨¡å—ç‰¹ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>æ¯ä¸€ä¸ª JavaScript æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œå…¶ä½œç”¨åŸŸä»…åœ¨æ¨¡å—å†…ï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</li>
<li>ä¸€ä¸ªæ¨¡å—åŒ…æ‹¬ <code>require</code>ã€<code>module</code>ã€<code>exports</code> ä¸‰ä¸ªæ ¸å¿ƒå˜é‡ã€‚</li>
<li>å…¶ä¸­ <code>module.exports</code>ã€<code>exports</code> è´Ÿè´£æ¨¡å—çš„å†…å®¹å¯¼å‡ºã€‚åè€…åªæ˜¯å‰è€…çš„â€œåˆ«åâ€ï¼Œè‹¥ä½¿ç”¨ä¸å½“ï¼Œè¿˜å¯èƒ½ä¼šå¯¼è‡´æ— æ³•å¯¼å‡ºé¢„æœŸå†…å®¹ã€‚å…¶ä¸­ <code>require</code> è´Ÿè´£å…¶ä»–æ¨¡å—å†…å®¹çš„å¯¼å…¥ï¼Œè€Œä¸”å…¶å¯¼å…¥çš„æ˜¯å…¶ä»–æ¨¡å—çš„ <code>module.exports</code> å¯¹è±¡ã€‚</li>
<li>æ¨¡å—å¯ä»¥åŠ è½½å¤šæ¬¡ï¼Œä½†åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç„¶åè¿è¡Œç»“æœå°±ä¼šè¢«ç¼“å­˜èµ·æ¥ã€‚ä¸‹æ¬¡å†åŠ è½½æ˜¯ç›´æ¥è¯»å–ç¼“å­˜ç»“æœã€‚æ¨¡å—ç¼“å­˜æ˜¯å¯ä»¥è¢«æ¸…é™¤çš„ã€‚</li>
<li>æ¨¡å—çš„åŠ è½½æ˜¯åŒæ­¥çš„ï¼Œè€Œä¸”æ˜¯æŒ‰ç¼–å†™é¡ºåºè¿›è¡ŒåŠ è½½ã€‚</li>
</ul>
</blockquote>
<h4>4.1 Module å¯¹è±¡</h4>
<p>å‰é¢æ‰“å°çš„ <code>module</code> å°±æ˜¯ <code>Module</code> çš„å®ä¾‹å¯¹è±¡ã€‚æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œéƒ½æœ‰ä¸€ä¸ª <code>module</code> å¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å—ã€‚å®ƒæœ‰ä»¥ä¸‹å±æ€§ï¼š</p>
<pre><code class="language-js">// Module æ„é€ å‡½æ•°
function Module(id = '', parent) {
  this.id = id
  this.path = path.dirname(id)
  this.exports = {}
  moduleParentCache.set(this, parent)
  updateChildren(parent, this, false)
  this.filename = null
  this.loaded = false
  this.children = []
}
</code></pre>
<p>æºç  ğŸ‘‰ <a href="https://github.com/nodejs/node/blob/34be1af5e17195dd9ce127e1daa7ab2bafd2df84/lib/internal/modules/cjs/loader.js#L172-L181">node/lib/internal/modules/cjs/loader.jsï¼ˆNode.js v17.xï¼‰</a></p>
<blockquote>
<p><code>module.id</code>ï¼šè¿”å›å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¨¡å—çš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸è¿™æ˜¯å®Œå…¨è§£æçš„æ–‡ä»¶åã€‚
<code>module.path</code>ï¼šè¿”å›å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¨¡å—çš„ç›®å½•åç§°ï¼Œé€šå¸¸ä¸Â <code>module.id</code>Â çš„Â <code>path.dirname()</code>Â ç›¸åŒã€‚
<code>module.exports</code>ï¼šæ¨¡å—å¯¹å¤–è¾“å‡ºçš„æ¥å£ï¼Œé»˜è®¤å€¼ä¸º <code>{}</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>module.exports</code> ä¸ <code>exports</code> æ˜¯ç›¸ç­‰çš„ã€‚
<code>module.filename</code>ï¼šè¿”å›å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¨¡å—çš„å®Œå…¨è§£ææ–‡ä»¶åï¼ˆå«ç»å¯¹è·¯å¾„ï¼‰ã€‚
<code>module.loaded</code>ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ¨¡å—æ˜¯å¦å·²å®ŒæˆåŠ è½½æˆ–æ­£åœ¨åŠ è½½ã€‚
<code>module.children</code>ï¼šè¿”å›æ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å—å¼•ç”¨çš„å…¶ä»–æ¨¡å—çš„å®ä¾‹å¯¹è±¡ã€‚
<code>module.parent</code>ï¼šè¿”å› <code>null</code> æˆ–æ•°ç»„ã€‚è‹¥è¿”å›å€¼ä¸ºæ•°ç»„æ—¶ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å—è¢«å…¶ä»–æ¨¡å—å¼•ç”¨äº†ï¼Œè€Œä¸”æ¯ä¸ªæ•°ç»„å…ƒç´ è¡¨ç¤ºè¢«å¼•ç”¨æ¨¡å—å¯¹åº”çš„å®ä¾‹å¯¹è±¡ã€‚
<code>module.paths</code>ï¼šè¿”å›æ•°ç»„ï¼Œè¡¨ç¤ºæ¨¡å—çš„æœç´¢è·¯å¾„ï¼ˆå«ç»å¯¹è·¯å¾„ï¼‰ã€‚
<code>module.isPreloading</code>ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œå¦‚æœæ¨¡å—åœ¨ Node.js é¢„åŠ è½½é˜¶æ®µè¿è¡Œï¼Œåˆ™ä¸º trueã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ç‚¹</strong></p>
<ul>
<li>èµ‹å€¼ç»™ <code>module.exports</code> å¿…é¡»ç«‹å³å®Œæˆï¼Œä¸èƒ½åœ¨ä»»ä½•å›è°ƒä¸­å®Œæˆï¼ˆåº”åœ¨åŒæ­¥ä»»åŠ¡ä¸­å®Œæˆï¼‰ã€‚
æ¯”å¦‚ï¼Œåœ¨ <code>setTimeout</code> å›è°ƒä¸­å¯¹ <code>module.exports</code> è¿›è¡Œèµ‹å€¼æ˜¯â€œä¸èµ·ä½œç”¨â€çš„ï¼ŒåŸå› æ˜¯ CommonJS æ¨¡å—åŒ–æ˜¯åŒæ­¥åŠ è½½çš„ã€‚</li>
</ul>
<p>è¯·çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// module-a.js
setTimeout(() =&gt; {
  module.exports = { welcome: 'Hello World' }
}, 0)

// module-b.js
const a = require('./a')
console.log(a.welcome) // undefined

// âŒ é”™è¯¯ç¤ºä¾‹
</code></pre>
<p>å†çœ‹ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// module-a.js
const EventEmitter = require('events')
module.exports = new EventEmitter() // åŒæ­¥ä»»åŠ¡ä¸­å®Œæˆå¯¹ module.exports çš„èµ‹å€¼

setTimeout(() =&gt; {
  module.exports.emit('ready') // â“ è¿™ä¸ªä¼šç”Ÿæ•ˆå—ï¼Ÿ
}, 1000)

// module-b.js
const a = require('./module-a')
a.on('ready', () =&gt; {
  console.log('module a is ready')
})

// âš ï¸ æ‰§è¡Œ `node module-b.js` å‘½ä»¤è¿è¡Œè„šæœ¬ï¼Œä»¥ä¸Š ready äº‹ä»¶å¯ä»¥æ­£å¸¸å“åº”ï¼Œ
// åŸå›  require() ä¼šå¯¹æ¨¡å—è¾“å‡ºå€¼è¿›è¡Œâ€œæµ…æ‹·è´â€ï¼Œå› æ­¤ module-a.js ä¸­çš„ setTimeout æ˜¯å¯ä»¥æ›´æ–° EventEmitter å®ä¾‹å¯¹è±¡çš„ã€‚
</code></pre>
<ul>
<li>å½“ <code>module.exports</code> å±æ€§è¢«æ–°å¯¹è±¡å®Œå…¨æ›¿æ¢æ—¶ï¼Œé€šå¸¸ä¹Ÿä¼šâ€œè‡ªåŠ¨â€é‡æ–°åˆ†é… <code>exports</code>ï¼ˆè‡ªåŠ¨æ˜¯æŒ‡ä¸æ˜¾å¼åˆ†é…æ–°å¯¹è±¡ç»™ <code>exports</code> å˜é‡çš„å‰æä¸‹ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ <code>exports</code> å˜é‡å¯¼å‡ºæ–°å¯¹è±¡ï¼Œåˆ™å¿…é¡»â€œæ‰‹åŠ¨â€å…³è” <code>module.exprots</code> å’Œ <code>exports</code>ï¼Œå¦åˆ™æ— æ³•æŒ‰é¢„æœŸè¾“å‡ºæ¨¡å—å€¼ã€‚</li>
</ul>
<p>è¯·çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// 1ï¸âƒ£ ä»¥è¿™ç§æ–¹å¼è¿›è¡Œæ¨¡å—çš„è¾“å‡ºï¼Œmodule.exports ä¸ exports ä¼šè‡ªåŠ¨åˆ†é…ï¼Œå³ module.exports === exports
module.exports = {
  // ...
}

// 2ï¸âƒ£ ä»¥è¿™ç§æ–¹å¼å¯¼å‡ºçš„å€¼ï¼Œå°†ä¼šæ˜¯ç©ºå¯¹è±¡ {}ï¼Œè€Œä¸æ˜¯ { sayHi: &lt;Function&gt; }
// æ­¤æ—¶ module.exports !== exports
exports = { sayHi: function () {} } // âŒ

// 3ï¸âƒ£ è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œéœ€è¦æ‰‹åŠ¨å…³è” module.exprots å’Œ exportsï¼Œä½¿å¾—äºŒè€…ç›¸ç­‰
module.exports = exports = { sayHi: function () {} } // âœ…
</code></pre>
<ul>
<li>ç”±ä»¥ä¸Šç¤ºä¾‹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ<code>require()</code> æ–¹æ³•å¼•ç”¨çš„æ˜¯ <code>module.exports</code> å¯¹è±¡ï¼Œè€Œä¸æ˜¯ <code>exports</code> å˜é‡ã€‚</li>
<li>åˆ©ç”¨ <code>module.parent</code> è¿”å› <code>null</code> æˆ–æ•°å€¼çš„ç‰¹æ€§ï¼Œå¯ä»¥åˆ¤æ–­å½“å‰æ¨¡å—æ˜¯å¦ä¸ºå…¥å£è„šæœ¬ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>require.main</code> æ¥è·å–å…¥å£è„šæœ¬çš„å®ä¾‹å¯¹è±¡ã€‚</li>
</ul>
<p><strong>module.exports ä¸ exports çš„æ³¨æ„ç‚¹</strong></p>
<p>æ­¤å‰å·²å†™è¿‡ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/218">æ–‡ç« </a>å»ä»‹ç»å®ƒä¿©çš„åŒºåˆ«äº†ã€‚</p>
<blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼š<strong><code>exports</code> å˜é‡åªæ˜¯ <code>module.exports</code> å±æ€§çš„ä¸€ä¸ªåˆ«åï¼Œä»…æ­¤è€Œå·²ã€‚</strong></p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¹æ¨¡å—è¿›è¡Œè¾“å‡ºï¼š</p>
<pre><code class="language-js">module.exports = {
  name: 'Frankie',
  age: 20,
  sayHi: () =&gt; console.log('Hi~')
}

// ç›¸å½“äº
exports.name = 'Frankie'
exports.age = 20
exports.sayHi = () =&gt; console.log('Hi~')
</code></pre>
<p>ä½†è¯·æ³¨æ„ï¼Œè‹¥æ¨¡å—åªå¯¹å¤–è¾“å‡ºä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šæ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">// âŒ ä»¥ä¸‹æ¨¡å—çš„è¾“å‡ºæ˜¯â€œæ— æ•ˆâ€çš„ï¼Œæœ€ç»ˆè¾“å‡ºå€¼ä»æ˜¯ {}
exports = function () { console.log('Hi~') }
</code></pre>
<p>åŸå› å¾ˆç®€å•ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ <code>module.exports</code> å±æ€§å’Œ <code>exports</code> å˜é‡éƒ½æ˜¯åŒä¸€ä¸ªç©ºå¯¹è±¡ <code>{}</code>ï¼ˆé»˜è®¤å€¼ï¼‰çš„<strong>å¼•ç”¨</strong>ï¼ˆreferenceï¼‰ï¼Œå³ <code>module.exports === exports</code>ã€‚</p>
<p>å½“å¯¹ <code>exports</code> å˜é‡é‡æ–°èµ‹äºˆä¸€ä¸ªåŸºæœ¬å€¼æˆ–å¼•ç”¨å€¼çš„æ—¶å€™ï¼Œ <code>module.exports</code> å’Œ <code>exports</code> ä¹‹é—´çš„è”ç³»è¢«åˆ‡æ–­äº†ï¼Œæ­¤æ—¶  <code>module.exports !== exports</code>ï¼Œåœ¨å½“å‰æ¨¡å—ä¸‹ <code>module.exports</code> çš„å€¼ä»ä¸º <code>{}</code>ï¼Œè€Œ <code>exports</code> å˜é‡çš„å€¼å˜ä¸ºå‡½æ•°ã€‚è€Œ <code>require()</code> æ–¹æ³•çš„è¿”å›å€¼æ˜¯æ‰€å¼•ç”¨æ¨¡å—çš„ <code>module.exports</code> çš„æµ…æ‹·è´ç»“æœã€‚</p>
<p>æ­£ç¡®å§¿åŠ¿åº”è¯¥æ˜¯ï¼š</p>
<pre><code class="language-js">module.exports = export = function () { console.log('Hi~') } // âœ…
</code></pre>
<p>ä½¿ç”¨ç±»ä¼¼å¤„ç†ï¼Œä½¿å¾— <code>module.exports</code> ä¸ <code>exports</code> é‡æ–°å»ºç«‹å…³è”å…³ç³»ã€‚</p>
<p>è¿™é‡Œå¹¶ä¸å­˜åœ¨ä»»ä½•éš¾ç‚¹ï¼Œä»…ä»…æ˜¯ JavaScript åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹çš„ç‰¹æ€§ç½¢äº†ã€‚å¦‚æœä½ è¿˜æ˜¯åˆ†ä¸æ¸…æ¥šçš„è¯ï¼Œå»ºè®®åªä½¿ç”¨ <code>module.exports</code> è¿›è¡Œå¯¼å‡ºï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚</p>
<h4>4.2 require æŸ¥æ‰¾ç®—æ³•</h4>
<p><code>require()</code> å‚æ•°å¾ˆç®€å•ï¼Œé‚£ä¹ˆ <code>require()</code> å†…éƒ¨æ˜¯å¦‚ä½•æŸ¥æ‰¾æ¨¡å—çš„å‘¢ï¼Ÿ</p>
<p>ç®€å•å¯ä»¥åˆ†ä¸ºå‡ ç±»ï¼š</p>
<ul>
<li>
<p>åŠ è½½ Node å†…ç½®æ¨¡å—
å½¢å¼å¦‚ï¼š<code>require('fs')</code>ã€<code>require('http')</code> ç­‰ã€‚</p>
</li>
<li>
<p>ç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„åŠ è½½æ¨¡å—
å½¢å¼å¦‚ï¼š<code>require('./file')</code>ã€<code>require('../file')</code>ã€<code>require('/file')</code>ã€‚</p>
</li>
<li>
<p>åŠ è½½ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆå³éå†…ç½®æ¨¡å—ï¼‰
å½¢å¼å¦‚ï¼š<code>require('react')</code>ã€<code>require('lodash/debounce')</code>ã€<code>require('some-library')</code>ã€<code>require('#some-library')</code> ç­‰ã€‚</p>
</li>
</ul>
<p>å…¶ä¸­ï¼Œç»å¯¹è·¯å¾„å½¢å¼åœ¨å®é™…é¡¹ç›®ä¸­å‡ ä¹ä¸ä¼šä½¿ç”¨ï¼ˆåæ­£æˆ‘æ˜¯æ²¡ç”¨è¿‡ï¼‰ã€è€Œ <code>require('#some-library')</code> å½¢å¼ç›®å‰ä»åœ¨è¯•éªŒé˜¶æ®µ...</p>
<p>ä»¥ä¸‹åŸºäº <a href="https://nodejs.org/api/modules.html#all-together">Node.js å®˜ç½‘</a> ç›¸å…³å†…å®¹ç¿»è¯‘å¹¶æ•´ç†çš„ç‰ˆæœ¬ï¼ˆ<a href="https://codesandbox.io/s/interesting-agnesi-46jjzl?file=/README.md">å­˜æ¡£</a>ï¼‰</p>
<pre><code class="language-txt">åœºæ™¯ï¼šåœ¨ `Y.js` æ–‡ä»¶ä¸‹ï¼Œ`require(X)`ï¼ŒNode.js å†…éƒ¨æ¨¡å—æŸ¥æ‰¾ç®—æ³•ï¼š

1. å¦‚æœ `X` ä¸ºå†…ç½®æ¨¡å—çš„è¯ï¼Œç«‹å³è¿”å›è¯¥æ¨¡å—ï¼›

   å› æ­¤ï¼Œå¾€ NPM å¹³å°ä¸Šå‘åŒ…çš„è¯ï¼Œ`package.json` ä¸­çš„ `name` å­—æ®µä¸èƒ½ä¸ Node.js å†…ç½®æ¨¡å—åŒåã€‚

2. å¦‚æœ `X` æ˜¯ä»¥ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„å½¢å¼ï¼Œæ ¹æ® `Y` æ‰€åœ¨ç›®å½•ä»¥åŠ `X` çš„å€¼ä»¥ç¡®å®šæ‰€è¦æŸ¥æ‰¾çš„æ¨¡å—è·¯å¾„ï¼ˆç§°ä¸º `Z`ï¼‰ã€‚

  a. å°† `Z` å½“ä½œã€Œæ–‡ä»¶ã€ï¼ŒæŒ‰ `Z`ã€`Z.js`ã€`Z.json`ã€`Z.node` é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼Œè‹¥æ‰¾åˆ°ç«‹å³è¿”å›æ–‡ä»¶ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æŸ¥æ‰¾ï¼›
  b. å°† `Z` å½“ä½œã€Œç›®å½•ã€ï¼Œ
     1ï¼‰æŸ¥æ‰¾ `Z/package.json` æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ `package.json` å­˜åœ¨ä¸”å…¶ `main` å­—æ®µå€¼ä¸ä¸ºè™šå€¼ï¼Œå°†ä¼šæŒ‰ç…§å…¶å€¼ç¡®å®šæ¨¡å—ä½ç½®ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹ï¼›
     2ï¼‰æŒ‰ `Z/index.js`ã€`Z/index.json`ã€`Z/index.node` é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼Œè‹¥æ‰¾åˆ°ç«‹å³è¿”å›æ–‡ä»¶ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ &quot;not found&quot;ã€‚

3. è‹¥ `X` æ˜¯ä»¥ `#` å·å¼€å¤´çš„ï¼Œå°†ä¼šæŸ¥æ‰¾æœ€é è¿‘ `Y` çš„ `package.json` ä¸­çš„ `imports` å­—æ®µä¸­ `node`ã€`require` å­—æ®µçš„å€¼ç¡®è®¤æ¨¡å—çš„å…·ä½“ä½ç½®ã€‚
  ï¼ˆè¿™ä¸€ç±»ç°é˜¶æ®µç”¨å¾—æ¯”è¾ƒå°‘ï¼Œåé¢å†å±•å¼€ä»‹ç»ä¸€ä¸‹ï¼‰
   // https://github.com/nodejs/node/pull/34117

4. åŠ è½½è‡ªèº«å¼•ç”¨ `LOAD_PACKAGE_SELF(X, dirname(Y))`

    a. å¦‚æœå½“å‰æ‰€åœ¨ç›®å½•å­˜åœ¨ `package.json` æ–‡ä»¶ï¼Œè€Œä¸” `package.json` ä¸­å­˜åœ¨ `exports` å­—æ®µï¼Œ
       å…¶ä¸­ `name` å­—æ®µçš„å€¼è¿˜è¦æ˜¯ `X` å¼€å¤´ä¸€éƒ¨åˆ†ï¼Œ
       æ»¡è¶³å‰ç½®æ¡ä»¶ä¸‹ï¼Œå°±ä¼šåŒ¹é… subpath å¯¹åº”çš„æ¨¡å—ï¼ˆæ— åŒ¹é…é¡¹ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚
      ï¼ˆè¿™é‡Œæåˆ°çš„ subpath ä¸ 5.b.1).1.1 ç±»ä¼¼ï¼‰
    b. è‹¥ä¸æ»¡è¶³ a ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³ï¼Œæ­¥éª¤ 4 æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­å¾€ä¸‹æŸ¥æ‰¾ã€‚

5. åŠ è½½ node_modules `LOAD_NODE_MODULES(X, dirname(Y))`
   a. ä»å½“å‰æ¨¡å—æ‰€åœ¨ç›®å½•ï¼ˆå³ `dirname(Y)`ï¼‰å¼€å§‹ï¼Œé€å±‚æŸ¥æ‰¾æ˜¯å¦ `node_modules/X` æ˜¯å¦å­˜åœ¨ï¼Œ
      è‹¥æ‰¾åˆ°å°±è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€çˆ¶çº§ç›®å½•æŸ¥æ‰¾ `node_modules/X` ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ã€‚
   b. ä»å…¨å±€ç›®å½•ï¼ˆæŒ‡ `NODE_PATH` ç¯å¢ƒå˜é‡ç›¸å…³çš„ç›®å½•ï¼‰ç»§ç»­æŸ¥æ‰¾ã€‚
  
   è‹¥ `LOAD_NODE_MODULES` è¿‡ç¨‹æŸ¥æ‰¾åˆ°æ¨¡å— Xï¼ˆå¯å¾—åˆ° X å¯¹åº”çš„ç»å¯¹è·¯å¾„ï¼Œå‡å®šä¸º Mï¼‰ï¼Œå°†æŒ‰ä»¥ä¸‹æ­¥éª¤æŸ¥æ‰¾æŸ¥æ‰¾ï¼š
      1) è‹¥ Node.js ç‰ˆæœ¬æ”¯æŒ `exports` å­—æ®µï¼ˆNode.js 12+ï¼‰ï¼Œ
          1.1 å°è¯•å°† `M` æ‹†åˆ†ä¸º name å’Œ subpath å½¢å¼ï¼ˆä¸‹ç§° name ä¸º `NAME`ï¼‰

              æ¯”å¦‚ `my-pkg` æ‹†åˆ†åï¼Œname ä¸º `my-pkg`ï¼Œsubpath åˆ™ä¸ºç©ºï¼ˆä¸ºç©ºçš„è¯ï¼Œå¯¹åº”  `exports` çš„ &quot;.&quot; å¯¼å‡ºï¼‰ã€‚
              æ¯”å¦‚ `my-pkg/sub-module` æ‹†åˆ†åï¼Œname ä¸º `my-pkg`ï¼Œsubpath ä¸º `sub-module`ã€‚
              è¯·æ³¨æ„å¸¦ Scope çš„åŒ…ï¼Œæ¯”å¦‚ `@myorg/my-pkg/sub-module` æ‹†åˆ†å name åº”ä¸º `@myorg/my-pkg`ï¼Œsubpath ä¸º `sub-module`ã€‚

          1.2 å¦‚æœåœ¨ M ç›®å½•ä¸‹å­˜åœ¨ `NAME/package.json` æ–‡ä»¶ï¼Œè€Œä¸” `package.json` çš„ `exports` å­—æ®µæ˜¯çœŸå€¼ï¼Œ
              ç„¶åæ ¹æ® subpath åŒ¹é… `exports` å­—æ®µé…ç½®ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ¨¡å—ï¼ˆè‹¥ subpath åŒ¹é…ä¸ä¸Šçš„å°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚
              è¯·æ³¨æ„ï¼Œç”±äº `exports` æ”¯æŒæ¡ä»¶å¯¼å‡ºï¼Œè€Œä¸”è¿™é‡ŒæŸ¥æ‰¾çš„æ˜¯ CommonJS æ¨¡å—ï¼Œ
              å› æ­¤ `exports` çš„ `node`ã€`require`ã€`default` å­—æ®µéƒ½æ˜¯æ”¯æŒçš„ï¼Œé”®é¡ºåºæ›´æ—©å®šä¹‰çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚

          1.3 å¦‚æœä»¥ä¸Šä»»æ„ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³çš„è¯ï¼Œå°†ç»§ç»­æ‰§è¡Œ 2) æ­¥éª¤

      2) å°† X ä»¥ç»å¯¹è·¯å¾„çš„å½¢å¼æŸ¥æ‰¾æ¨¡å—ï¼ˆå³å‰é¢çš„æ­¥éª¤ 2ï¼‰ï¼Œè‹¥æ‰¾ä¸åˆ°æ­¥éª¤ 5 æ‰§è¡Œå®Œæ¯•ï¼Œå°†ä¼šè·‘åˆ°æ­¥éª¤ 6ã€‚

6. æŠ›å‡ºå¼‚å¸¸ &quot;not found&quot;
</code></pre>
<p>å¦‚æœä¸æ˜¯å¼€å‘ NPM åŒ…ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­çš„è¯ï¼Œå¹¶æ²¡æœ‰ä»¥ä¸Šé‚£ä¹ˆå¤šå¤æ‚çš„æ­¥éª¤ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚ä½†æ·±å…¥äº†è§£ä¹‹åæœ‰åŠ©äºå¹³å¸¸é‡åˆ°é—®é¢˜æ›´å¿«æ’æŸ¥å‡ºåŸå› å¹¶å¤„ç†æ‰ã€‚å¦‚æœä½ æ˜¯å‘åŒ…çš„è¯ï¼Œå¯ä»¥åˆ©ç”¨ <code>exports</code> ç­‰åšæ¡ä»¶å¯¼å‡ºæ¨¡å—ã€‚</p>
<p>æƒ³äº†è§£ Node.js package.json çš„ä¸¤ä¸ªå­—æ®µçš„æ„ä¹‰ï¼Œè¯·çœ‹ï¼š</p>
<ul>
<li><a href="http://nodejs.cn/api/packages.html#exports">exports</a>ï¼ˆNode.js 12 èµ·æ”¯æŒï¼‰</li>
<li><a href="http://nodejs.cn/api/packages.html#imports">imports</a></li>
</ul>
<h4>4.3 require æºç </h4>
<p>æºç  ğŸ‘‰ <a href="https://github.com/nodejs/node/blob/34be1af5e17195dd9ce127e1daa7ab2bafd2df84/lib/internal/modules/cjs/loader.js#L989-L1003">node/lib/internal/modules/cjs/loader.jsï¼ˆNode.js v17.xï¼‰</a></p>
<pre><code class="language-js">// Loads a module at the given file path. Returns that module's `exports` property.
Module.prototype.require = function (id) {
  validateString(id, 'id')
  if (id === '') {
    throw new ERR_INVALID_ARG_VALUE('id', id, 'must be a non-empty string')
  }
  requireDepth++
  try {
    return Module._load(id, this, /* isMain */ false)
  } finally {
    requireDepth--
  }
}
</code></pre>
<p>æºç  ğŸ‘‰ <a href="https://github.com/nodejs/node/blob/34be1af5e17195dd9ce127e1daa7ab2bafd2df84/lib/internal/modules/cjs/loader.js#L750-L846">node/lib/internal/modules/cjs/loader.jsï¼ˆNode.js v17.xï¼‰</a></p>
<pre><code class="language-js">/**
 * æ£€æŸ¥æ‰€è¯·æ±‚æ–‡ä»¶çš„ç¼“å­˜
 * 1. å¦‚æœç¼“å­˜ä¸­å·²å­˜åœ¨è¯·æ±‚çš„æ–‡ä»¶ï¼Œè¿”å›å…¶å¯¼å‡ºå¯¹è±¡ï¼ˆmodule.exportsï¼‰
 * 2. å¦‚æœè¯·æ±‚çš„æ˜¯åŸç”Ÿæ¨¡å—ï¼Œè°ƒç”¨ `NativeModule.prototype.compileForPublicLoader()` å¹¶è¿”å›å…¶å¯¼å‡ºå¯¹è±¡
 * 3. å¦åˆ™ï¼Œä¸ºè¯¥æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å—å¹¶å°†å…¶ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚ ç„¶åè®©å®ƒåœ¨è¿”å›å…¶å¯¼å‡ºå¯¹è±¡ä¹‹å‰åŠ è½½æ–‡ä»¶å†…å®¹ã€‚
 */
Module._load = function (request, parent, isMain) {
  let relResolveCacheIdentifier
  if (parent) {
    debug('Module._load REQUEST %s parent: %s', request, parent.id)
    // Fast path for (lazy loaded) modules in the same directory. The indirect
    // caching is required to allow cache invalidation without changing the old
    // cache key names.
    relResolveCacheIdentifier = `${parent.path}\x00${request}`
    const filename = relativeResolveCache[relResolveCacheIdentifier]
    if (filename !== undefined) {
      const cachedModule = Module._cache[filename]
      if (cachedModule !== undefined) {
        updateChildren(parent, cachedModule, true)
        if (!cachedModule.loaded) return getExportsForCircularRequire(cachedModule)
        return cachedModule.exports
      }
      delete relativeResolveCache[relResolveCacheIdentifier]
    }
  }

  // 1ï¸âƒ£ è·å– require(id) ä¸­ id çš„ç»å¯¹è·¯å¾„ï¼ˆfilename ä½œä¸ºæ¨¡å—çš„æ ‡è¯†ç¬¦ï¼‰
  const filename = Module._resolveFilename(request, parent, isMain)

  if (StringPrototypeStartsWith(filename, 'node:')) {
    // Slice 'node:' prefix
    const id = StringPrototypeSlice(filename, 5)

    const module = loadNativeModule(id, request)
    if (!module?.canBeRequiredByUsers) {
      throw new ERR_UNKNOWN_BUILTIN_MODULE(filename)
    }

    return module.exports
  }

  // 2ï¸âƒ£ ç¼“åŠ¨æ˜¯å¦å­˜åœ¨ç¼“å­˜
  // æ‰€æœ‰åŠ è½½è¿‡çš„æ¨¡å—éƒ½ç¼“å­˜äº Module._cache ä¸­ï¼Œä»¥æ¨¡å—çš„ç»å¯¹è·¯å¾„ä½œä¸ºé”®å€¼ï¼ˆcache keyï¼‰
  const cachedModule = Module._cache[filename]

  if (cachedModule !== undefined) {
    updateChildren(parent, cachedModule, true)
    if (!cachedModule.loaded) {
      const parseCachedModule = cjsParseCache.get(cachedModule)
      if (!parseCachedModule || parseCachedModule.loaded) return getExportsForCircularRequire(cachedModule)
      parseCachedModule.loaded = true
    } else {
      // è‹¥è¯¥æ¨¡å—ç¼“å­˜è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥æ¨¡å—çš„ module.exports å±æ€§
      return cachedModule.exports
    }
  }

  // 3ï¸âƒ£ åŠ è½½ Node.js åŸç”Ÿæ¨¡å—ï¼ˆå†…ç½®æ¨¡å—ï¼‰
  const mod = loadNativeModule(filename, request)
  if (mod?.canBeRequiredByUsers) return mod.exports

  // 4ï¸âƒ£ è‹¥è¯·æ±‚æ¨¡å—æ— ç¼“å­˜ï¼Œè°ƒç”¨ Module æ„é€ å‡½æ•°ç”Ÿæˆæ¨¡å—å®ä¾‹ module
  const module = cachedModule || new Module(filename, parent)

  // å¦‚æœæ˜¯å…¥å£è„šæœ¬ï¼Œå°†å…¥å£æ¨¡å—çš„ id ç½®ä¸º &quot;.&quot;
  if (isMain) {
    process.mainModule = module
    module.id = '.'
  }

  // 5ï¸âƒ£ å°†æ¨¡å—å­˜å…¥ç¼“å­˜ä¸­
  // âš ï¸âš ï¸âš ï¸ åœ¨æ¨¡å—æ‰§è¡Œä¹‹å‰ï¼Œæå‰æ”¾å…¥ç¼“å­˜ï¼Œä»¥å¤„ç†ã€Œå¾ªç¯å¼•ç”¨ã€çš„é—®é¢˜
  // See, http://nodejs.cn/api/modules.html#cycles
  Module._cache[filename] = module
  if (parent !== undefined) {
    relativeResolveCache[relResolveCacheIdentifier] = filename
  }

  let threw = true
  try {
    // 6ï¸âƒ£ æ‰§è¡Œæ¨¡å—
    module.load(filename)
    threw = false
  } finally {
    if (threw) {
      delete Module._cache[filename]
      if (parent !== undefined) {
        delete relativeResolveCache[relResolveCacheIdentifier]
        const children = parent?.children
        if (ArrayIsArray(children)) {
          const index = ArrayPrototypeIndexOf(children, module)
          if (index !== -1) {
            ArrayPrototypeSplice(children, index, 1)
          }
        }
      }
    } else if (
      module.exports &amp;&amp;
      !isProxy(module.exports) &amp;&amp;
      ObjectGetPrototypeOf(module.exports) === CircularRequirePrototypeWarningProxy
    ) {
      ObjectSetPrototypeOf(module.exports, ObjectPrototype)
    }
  }

  // 7ï¸âƒ£ è¿”å›æ¨¡å—çš„è¾“å‡ºæ¥å£
  return module.exports
}
</code></pre>
<h4>4.4 require ä¸­å‡ ä¸ªå¸¸è§çš„é—®é¢˜</h4>
<p>Q: Node.js æ˜¯å¦‚ä½•å®ç°åŒæ­¥åŠ è½½æœºåˆ¶çš„ï¼Ÿ
A:</p>
<!--

## å¾…æ•´ç†

1. CommonJSè§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œã€‚AMDè§„èŒƒåˆ™æ˜¯éåŒæ­¥åŠ è½½æ¨¡å—ï¼Œå…è®¸æŒ‡å®šå›è°ƒå‡½æ•°ã€‚ç”±äºNode.jsä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—æ–‡ä»¶ä¸€èˆ¬éƒ½å·²ç»å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œæ‰€ä»¥åŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼Œä¸ç”¨è€ƒè™‘éåŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥CommonJSè§„èŒƒæ¯”è¾ƒé€‚ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯æµè§ˆå™¨ç¯å¢ƒï¼Œè¦ä»æœåŠ¡å™¨ç«¯åŠ è½½æ¨¡å—ï¼Œè¿™æ—¶å°±å¿…é¡»é‡‡ç”¨éåŒæ­¥æ¨¡å¼ï¼Œå› æ­¤æµè§ˆå™¨ç«¯ä¸€èˆ¬é‡‡ç”¨AMDè§„èŒƒã€‚

2. å…³äº Node.js ä¸­çš„ this

* [Meaning of "this" in node.js modules and functions](https://stackoverflow.com/questions/22770299/meaning-of-this-in-node-js-modules-and-functions)
* [What is "this"?](http://howtonode.org/what-is-this)


-->
<p>æœªå®Œå¾…ç»­...</p>
<h2>References</h2>
<ul>
<li><a href="https://exploringjs.com/es6/ch_modules.html#ch_modules">ECMAScript 6 Modules</a></li>
<li><a href="https://addyosmani.com/writing-modular-js/">Writing Modular JavaScript With AMD, CommonJS &amp; ES Harmony</a></li>
<li><a href="https://www.oreilly.com/library/view/learning-javascript-design/9781449334840/ch09s02.html">Learning JavaScript Design Patterns by Addy Osmani</a></li>
<li><a href="https://2ality.com/2011/04/modules-and-namespaces-in-javascript.html">Patterns for modules and namespaces in JavaScript</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | XSSã€CSRF æµ…è°ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/280</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/280</guid>
            <pubDate>Sun, 26 Feb 2023 12:46:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6f081762563852e2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6f081762563852e2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€å‰æ</h2>
<ul>
<li>Cookie å¸¸ç”¨äºä¼šè¯çŠ¶æ€ç®¡ç†ã€ä¸ªæ€§åŒ–è®¾ç½®ç­‰ã€‚</li>
<li>åœ¨æµè§ˆå™¨å¯ä»¥é€šè¿‡ <code>document.cookie</code> æ¥è®¿é—® Cookie</li>
<li>document.cookie åªèƒ½è·å–å½“å‰ä½œç”¨åŸŸä¸‹çš„ Cookieï¼Œè¿™ä¸ªä½œç”¨åŸŸå— <code>Domain</code> å’Œ <code>Path</code> å…±åŒå½±å“ã€‚</li>
</ul>
<h2>äºŒã€CSRF æ”»å‡»</h2>
<p>å®ƒä¸ Cookie ç›¸å…³</p>
<h4>1. ä»€ä¹ˆæ˜¯ CSRFï¼Ÿ</h4>
<p>CSRF æ˜¯ Cross-Site Request Forgery çš„ç®€ç§°ï¼Œè¯‘ä¸ºâ€œè·¨ç«™è¯·æ±‚ä¼ªé€ â€ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªç½‘ç«™ A å’Œ Bï¼š</p>
<blockquote>
<ul>
<li>åªè¦åœ¨ B ç½‘ç«™å‘èµ·äº† A ç½‘ç«™çš„ HTTP(S) è¯·æ±‚ï¼Œè¿™ä¸ªå°±ç®—æ˜¯è·¨ç«™è¯·æ±‚ï¼ˆè‡³äºç®—ä¸ç®—æ”»å‡»å°±å¦è¯´ï¼‰ã€‚</li>
<li>å½“ä½ è®¿é—®å¹¶ç™»å½•ç½‘ç«™ Aï¼ŒæœåŠ¡å™¨è¿”å›äº†ä¸€äº› Set-Cookie å­—æ®µã€‚è‹¥å‰å¾€ B ç½‘ç«™ï¼Œå¹¶åœ¨ B ç½‘ç«™å‘èµ·äº† A ç½‘ç«™çš„è¯·æ±‚ï¼Œè¿™æ—¶å€™åœ¨ HTTP è¯·æ±‚å¤´æ˜¯ä¼šè‡ªåŠ¨å¸¦ä¸Š A ç½‘ç«™çš„ Cookie çš„ï¼ˆè¿™é‡Œå‡å®šæ²¡æœ‰ Cookie çš„ SameSite é™åˆ¶ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>å…³äºç¬¬äºŒç‚¹ï¼Œå¯èƒ½ä¼šæœ‰äººç–‘æƒ‘ã€‚</p>
<p>å…ˆæ˜ç¡®ä¸€ä¸‹ï¼Œé€šè¿‡ JS è„šæœ¬ï¼ˆ<code>document.cookie</code>ï¼‰åªèƒ½è·å–æœ¬ç«™ä¸‹çš„ Cookieï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨ B ç½‘ç«™é‡Œåªèƒ½è·å– B ç½‘ç«™çš„ Cookieï¼Œæ˜¯æ°¸è¿œæ²¡æœ‰åŠæ³•è·å–åˆ°ç½‘ç«™ A çš„ Cookie çš„ã€‚è¿™æ˜¯è„šæœ¬çš„è¡Œä¸ºã€‚</p>
<p>å…¶æ¬¡ï¼Œåœ¨å‘èµ· HTTP  è¯·æ±‚æ—¶ï¼Œä¼šæœ‰ä¸€ç§è‡ªåŠ¨æºå¸¦ Cookie çš„è¡Œä¸ºã€‚å®ƒä¼šè‡ªåŠ¨å¸¦ä¸Šæ‰€è¯·æ±‚ URL å¯¹åº”ç«™ç‚¹çš„ç›¸å…³ Cookieã€‚</p>
<blockquote>
<p>CSRF æ”»å‡»åªæ˜¯åˆ©ç”¨äº† HTTP è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»ï¼Œæ”»å‡»è€…è¿˜æ˜¯æ— æ³•è·å–åˆ°è¢«æ”»å‡»ç½‘ç«™çš„ Cookie çš„ã€‚è¿™ä¸ XSS ä¸åŒï¼Œå®ƒæ˜¯ç›´æ¥æ‹¿åˆ°è¢«æ”»å‡»ç½‘ç«™çš„ Cookieï¼Œç„¶åè¿›è¡Œæ”»å‡»ã€‚</p>
</blockquote>
<h4>2. å¦‚ä½•åº”å½“ CSRFï¼Ÿ</h4>
<p><strong>æ–¹æ¡ˆä¸€ï¼šæ”¾å¼ƒ Cookieï¼Œä½¿ç”¨ Token</strong></p>
<p>æ—¢ç„¶ CSRF æ˜¯åˆ©ç”¨äº† HTTP è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie çš„ç‰¹æ€§ï¼Œä¼ªé€ è¯·æ±‚ä»¥è¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨çš„ç›®çš„ã€‚é‚£ä¹ˆåªè¦æˆ‘ä»¬ä¸ä½¿ç”¨ Cookie çš„æ–¹å¼æ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œè½¬ç”¨ Token ç­–ç•¥ï¼Œå°±èƒ½å®Œå…¨é¿å… CSRF æ”»å‡»ã€‚</p>
<p><strong>æ–¹æ¡ˆäºŒï¼šSameSite</strong></p>
<p>è¿™æ˜¯ Chrome 51 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼ï¼š<code>None</code>ã€<code>Lax</code>ã€<code>Strict</code>ã€‚è‡ª Chrome 80 èµ·ï¼ŒCookie çš„ SameSite  é»˜è®¤å€¼ä¸º <code>Lax</code>ï¼ˆåœ¨ä¸è®¾ç½® SameSite æ—¶ï¼Œå…¶é»˜è®¤å€¼å–å†³äºæµè§ˆå™¨çš„é»˜è®¤å€¼ï¼‰ã€‚äº¦å¯ä¸»åŠ¨è®¾ç½®ä¸º <code>None</code>ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼ŒCookie å¿…é¡»è®¾ç½®ä¸º <code>Secure</code>ã€‚</p>
<p>è¿™ä¸ªç‰¹æ€§å¯ä»¥è§£å†³ CSRF æ”»å‡»çš„é—®é¢˜ï¼Œè¡¨ç¤ºå½“å‰é¡µé¢ä¸è¯·æ±‚çš„ URL æ˜¯ç›¸åŒçš„ï¼Œæ‰ä¼šæºå¸¦ä¸Šè¿™ä¸ª Cookieã€‚</p>
<p>è¿˜æ˜¯å‰é¢çš„ä¾‹å­ï¼Œæ”»å‡»è€… B ç½‘ç«™ä¸è¢«æ”»å‡»è€… A ç½‘ç«™æ˜¯ä¸åŒåŸŸçš„ï¼Œå½“åœ¨ B ç½‘ç«™å†…å‘èµ· A ç½‘ç«™çš„è¯·æ±‚æ—¶ï¼Œå¯¹åº” Cookie å°±ä¸ä¼šæºå¸¦ä¸Šã€‚</p>
<blockquote>
<p>ä½† SameSite è¾ƒæ–°ï¼Œåœ¨å…¼å®¹æ€§ä¸Šå¯èƒ½ä¸å¤ªå¥½ã€‚</p>
</blockquote>
<p><strong>æ–¹æ¡ˆä¸‰ï¼šæœåŠ¡ç«¯ Referer éªŒè¯</strong></p>
<p>åœ¨å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­ä¼šæœ‰ <code>Referer</code> å­—æ®µï¼Œå®ƒè¡¨ç¤ºå½“å‰åŸŸçš„åŸŸåã€‚æœåŠ¡ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªâ€œçœŸæ­£â€çš„ç”¨æˆ·è¯·æ±‚ã€‚</p>
<p>ä½†æ˜¯ Referer æ˜¯å¯ä»¥ä¼ªé€ çš„ï¼Œå› æ­¤å¹¶ä¸å¯é ã€‚</p>
<p>è™½ç„¶ Referer å¹¶ä¸å¯é ï¼Œä½†ç”¨æ¥é˜²æ­¢å›¾ç‰‡ç›—é“¾è¿˜æ˜¯è¶³å¤Ÿçš„ï¼Œæ¯•ç«Ÿä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šä¿®æ”¹å®¢æˆ·ç«¯çš„é…ç½®ã€‚ï¼ˆä¸€èˆ¬åªå…è®¸ç«™å†…è®¿é—®ï¼‰</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Referer</code> çš„æ­£ç¡®è‹±è¯­æ‹¼æ³•æ˜¯ <strong>referrer</strong>ã€‚ç”±äºæ—©æœŸ HTTP è§„èŒƒçš„æ‹¼å†™é”™è¯¯ï¼Œä¸ºä¿æŒ<a href="https://www.wikiwand.com/zh/%E5%90%91%E4%B8%8B%E5%85%BC%E5%AE%B9%22">å‘ä¸‹å…¼å®¹</a>å°±å°†é”™å°±é”™äº†ã€‚ä¾‹å¦‚ <a href="https://www.w3.org/TR/DOM-Level-2-Core/">DOM Level 2</a>ã€<a href="https://w3c.github.io/webappsec-referrer-policy/#directive-referrer">Referrer Policy</a> ç­‰å…¶ä»–ç½‘ç»œæŠ€æœ¯çš„è§„èŒƒæ›¾è¯•å›¾ä¿®æ­£æ­¤é—®é¢˜ï¼Œä½¿ç”¨æ­£ç¡®æ‹¼æ³•ï¼Œå¯¼è‡´ç›®å‰æ‹¼æ³•å¹¶ä¸ç»Ÿä¸€ã€‚</p>
</blockquote>
<h2>ä¸‰ã€XSS æ”»å‡»</h2>
<p>XSSï¼Œæ˜¯ Cross-Site Scripting çš„ç®€ç§°ï¼Œè¯‘ä¸ºâ€œè·¨ç«™è„šæœ¬æ”»å‡»â€ã€‚å‘½ååº”è¯¥æ˜¯ä¸ºäº†ä¸ CSS è¿›è¡ŒåŒºåˆ†ã€‚</p>
<h4>1. ä»€ä¹ˆæ˜¯ XSSï¼Ÿ</h4>
<p>XSS æ˜¯ç”±äºä¸å®‰å…¨çš„æ•°æ®å¼•èµ·çš„ï¼Œå¯èƒ½æ˜¯æäº¤è¡¨å•æ•°æ®ï¼Œæœ‰å¯èƒ½æ˜¯é¡µé¢è·¯å¾„çš„å‚æ•°é—®é¢˜ã€‚</p>
<blockquote>
<p>ä¸ CSRF ä¸åŒçš„æ˜¯ï¼ŒCSRF æ˜¯åˆ©ç”¨äº† HTTP è‡ªåŠ¨æºå¸¦ Cookie çš„ç‰¹æ€§æ¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œæ”»å‡»è€…æ— æ³•é€šè¿‡ JS è„šæœ¬è·å–åˆ°è¢«æ”»å‡»è€…çš„ Cookie ç­‰ä¿¡æ¯çš„ã€‚è€Œ XSS åˆ™æ˜¯åˆ©ç”¨ä¸€äº›ä¸å®‰å…¨çš„æ•°æ®ï¼Œä¾‹å¦‚æ˜¯ä¸€ä¸ª <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œç„¶åè·å–åˆ°ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œå¯¹å…¶å‘èµ·æ”»å‡»ã€‚</p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
<h2>References</h2>
<ul>
<li><a href="https://juejin.cn/post/6844904102544031757">å½»åº•ç†è§£ Cookie ä»¥åŠ Cookie å®‰å…¨</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | æµ…è°ˆå†…å­˜æ³„éœ²ã€å†…å­˜æº¢å‡º]]></title>
            <link>https://github.com/toFrankie/blog/issues/279</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/279</guid>
            <pubDate>Sun, 26 Feb 2023 12:46:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3b8d6484e593ade1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3b8d6484e593ade1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è®²çœŸï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µå¾ˆå®¹æ˜“è¢«æ··ä¸ºä¸€è°ˆã€‚</p>
<h2>ä¸€ã€å†…å­˜</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œæ²¡æœ‰åƒ C è¯­è¨€ç­‰æä¾›æœ‰å†…å­˜ç®¡ç†æ¥å£ï¼ŒJavaScript æ˜¯åœ¨åˆ›å»ºå˜é‡æ—¶è‡ªåŠ¨è¿›è¡Œåˆ†é…å†…å­˜ï¼Œå¹¶ä¸”åœ¨ä¸ä½¿ç”¨å®ƒä»¬æ—¶â€œ<strong>è‡ªåŠ¨</strong>â€é‡Šæ”¾ã€‚é‡Šæ”¾çš„è¿‡ç¨‹è¢«ç§°ä¸ºâ€œ<strong>åƒåœ¾å›æ”¶</strong>â€ã€‚</p>
<blockquote>
<p>è¿™ä¸ªâ€œè‡ªåŠ¨â€å°±æ˜¯æ··ä¹±çš„æ ¹æºï¼Œå¹¶è®© JavaScript å¼€å‘è€…é”™è¯¯åœ°è®¤ä¸ºä»–ä»¬å¯ä»¥ä¸ç”¨å…³å¿ƒå†…å­˜ç®¡ç†ã€‚</p>
</blockquote>
<h4>å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸ</h4>
<p>ä¸ç®¡ä»€ä¹ˆç¨‹åºè¯­è¨€ï¼Œå†…å­˜çš„ç”Ÿå‘½å‘¨æœŸåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼š</p>
<ol>
<li>åˆ†é…ä½ æ‰€éœ€è¦çš„å†…å­˜</li>
<li>ä½¿ç”¨åˆ†é…åˆ°çš„å†…å­˜ï¼ˆè¯»ã€å†™ï¼‰</li>
<li>ä¸éœ€è¦æ—¶ï¼Œå°†å…¶é‡Šæ”¾/å½’è¿˜</li>
</ol>
<p>æ‰€æœ‰è¯­è¨€ç¬¬äºŒéƒ¨åˆ†éƒ½æ˜¯æ˜ç¡®çš„ã€‚ç¬¬ä¸€å’Œç¬¬ä¸‰éƒ¨åˆ†åœ¨åº•å±‚è¯­è¨€ä¸­æ˜¯æ˜ç¡®çš„ï¼Œä½†åœ¨åƒ JavaScript è¿™äº›é«˜çº§è¯­è¨€ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯éšå«çš„ã€‚</p>
<h4>å†…å­˜ç®¡ç†çš„éš¾é¢˜</h4>
<p>å¤§å¤šæ•°å†…å­˜ç®¡ç†çš„é—®é¢˜éƒ½åœ¨â€œ<strong>å½“å†…å­˜ä¸éœ€è¦ä½¿ç”¨æ—¶é‡Šæ”¾</strong>â€è¿™ä¸ªé˜¶æ®µã€‚æœ€å›°éš¾çš„å°±æ˜¯å¦‚ä½•ç•Œå®šå¹¶æ‰¾åˆ°â€œ<strong>å“ªäº›è¢«åˆ†é…çš„å†…å­˜ç¡®å®ä¸å†éœ€è¦äº†</strong>â€ã€‚å®ƒå¾€å¾€è¦æ±‚å¼€å‘äººå‘˜æ¥ç¡®å®šåœ¨ç¨‹åºä¸­å“ªä¸€å—å†…å­˜ä¸å†éœ€è¦å¹¶ä¸”é‡Šæ”¾å®ƒã€‚</p>
<blockquote>
<p>é«˜çº§è¯­è¨€è§£é‡Šå™¨åµŒå…¥äº†â€œåƒåœ¾å›æ”¶å™¨â€ï¼Œå®ƒçš„ä¸»è¦å·¥ä½œæ˜¯è·Ÿè¸ªå†…å­˜çš„åˆ†é…å’Œä½¿ç”¨ï¼Œä»¥ä¾¿å½“åˆ†é…çš„å†…å­˜ä¸å†ä½¿ç”¨æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾å®ƒã€‚<strong>è¿™åªèƒ½æ˜¯ä¸€ä¸ªè¿‘ä¼¼çš„è¿‡ç¨‹ï¼Œå› ä¸ºè¦çŸ¥é“æ˜¯å¦ä»ç„¶éœ€è¦æŸå—å†…å­˜æ˜¯<a href="http://en.wikipedia.org/wiki/Decidability_%28logic%29">æ— æ³•åˆ¤å®šçš„</a>ï¼ˆæ— æ³•é€šè¿‡æŸç§ç®—æ³•è§£å†³ï¼‰</strong>ã€‚</p>
</blockquote>
<h4>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰</h4>
<p>ç”±äºä¸€äº›å†…å­˜â€œä¸å†éœ€è¦â€çš„é—®é¢˜æ— æ³•åˆ¤å®šï¼Œå› æ­¤ï¼Œåƒåœ¾å›æ”¶å®ç°åªèƒ½æœ‰é™åˆ¶çš„è§£å†³ä¸€èˆ¬é—®é¢˜ã€‚</p>
<ul>
<li>
<p><strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>
æœ€åˆçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå®ƒæŠŠâ€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€ç®€åŒ–ä¸ºâ€œå¯¹è±¡æœ‰æ²¡æœ‰å…¶ä»–å¯¹è±¡å¼•ç”¨åˆ°å®ƒâ€ã€‚å¦‚æœæ²¡æœ‰å¼•ç”¨æŒ‡å‘æ”¹å¯¹è±¡ï¼ˆé›¶å¼•ç”¨ï¼‰ï¼Œå¯¹è±¡å°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚ä½†æ˜¯è¿™ä¸ªç®—æ³•æœ‰ä¸ªé™åˆ¶ï¼Œæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚</p>
<p>å…³äºâ€œå¼•ç”¨â€çš„æ¦‚å¿µï¼Œä¸€ä¸ªå¯¹è±¡å¦‚æœæœ‰è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡çš„æƒé™ï¼ˆæ˜¾å¼æˆ–éšå¼ï¼‰ï¼Œå«åšä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>
è¿™ä¸ªç®—æ³•æŠŠâ€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€ç®€åŒ–å®šä¹‰ä¸ºâ€œå¯¹è±¡æ˜¯å¦å¯ä»¥è·å¾—â€ã€‚</p>
<p>è¿™ä¸ªç®—æ³•å‡å®šè®¾ç½®ä¸€ä¸ªå«åšæ ¹å¯¹è±¡ï¼ˆåœ¨ Javascript é‡Œæ˜¯ <code>globalThis</code> å¯¹è±¡ï¼‰ã€‚åƒåœ¾å›æ”¶å™¨å°†å®šæœŸä»æ ¹å¼€å§‹ï¼Œæ‰¾æ‰€æœ‰ä»æ ¹å¼€å§‹å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åæ‰¾è¿™äº›å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡â€¦â€¦ä»æ ¹å¼€å§‹ï¼Œåƒåœ¾å›æ”¶å™¨å°†æ‰¾åˆ°æ‰€æœ‰å¯ä»¥è·å¾—çš„å¯¹è±¡å’Œæ”¶é›†æ‰€æœ‰ä¸èƒ½è·å¾—çš„å¯¹è±¡ã€‚</p>
<p>å®ƒè§£å†³äº†æ—©æœŸç®—æ³•æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€ä¸ªé™åˆ¶ï¼šé‚£äº›æ— æ³•ä»æ ¹å¯¹è±¡æŸ¥è¯¢åˆ°çš„å¯¹è±¡éƒ½å°†è¢«æ¸…é™¤ï¼ˆå®é™…ä¸­å¾ˆå°‘ä¼šç¢°åˆ°è¿™ç§æƒ…å†µï¼‰ã€‚</p>
<p><strong>ä» 2012 å¹´èµ·ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½ä½¿ç”¨äº†æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•</strong>ã€‚æ‰€æœ‰å¯¹ JavaScript åƒåœ¾å›æ”¶ç®—æ³•çš„æ”¹è¿›éƒ½æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ”¹è¿›ï¼Œå¹¶æ²¡æœ‰æ”¹è¿›æ ‡è®°-æ¸…é™¤ç®—æ³•æœ¬èº«å’Œå®ƒå¯¹â€œå¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦â€çš„ç®€åŒ–å®šä¹‰ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬ä¸ä¼šåœ¨å…¨å±€ä½œç”¨åŸŸä¸‹è¿›è¡Œè¿‡å¤šçš„å˜é‡æˆ–å‡½æ•°å£°æ˜ï¼Œæ›´æ¨èå°†å®ƒä»¬æ”¾åœ¨ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼‰å†…è¿›è¡Œå£°æ˜ã€‚å¦åˆ™å®ƒä»¬å°†æ— æ³•è¢«åƒåœ¾å›æ”¶ï¼Œå³åœ¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´å­˜åœ¨ã€‚</p>
<blockquote>
<p>è¿™ä¸€å°èŠ‚æåˆ°çš„â€œå¯¹è±¡â€ï¼Œä¸ä»…ç‰¹æŒ‡ JavaScript å¯¹è±¡ï¼Œè¿˜åŒ…æ‹¬å‡½æ•°ä½œç”¨åŸŸã€å…¨å±€ä½œç”¨åŸŸã€‚</p>
</blockquote>
<h2>äºŒã€å†…å­˜æ³„éœ²ã€æº¢å‡º</h2>
<h4>åŒºåˆ«</h4>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯å­˜åœ¨åŒºåˆ«çš„ã€‚</p>
<ul>
<li>
<p><strong>å†…å­˜æº¢å‡º</strong>ï¼ˆOut of Memoryï¼‰
å½“ç³»ç»Ÿæ— æ³•æä¾›åº”ç”¨ç¨‹åºæ‰€éœ€å†…å­˜æ—¶ï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºæŠ›å‡ºå†…å­˜æº¢å‡ºçš„é”™è¯¯ã€‚</p>
</li>
<li>
<p><strong>å†…å­˜æ³„éœ²</strong>ï¼ˆMemory Leakï¼‰
åº”ç”¨ç¨‹åºä¸­ä¸€äº›è¢«åˆ†é…çš„å†…å­˜ï¼Œåœ¨ä½¿ç”¨å®Œä¹‹åï¼Œæ²¡æœ‰åŠæ—¶è¢«åƒåœ¾å›æ”¶å™¨è¿›è¡Œå›æ”¶ï¼ˆé‡Šæ”¾ï¼‰ï¼Œå¯¼è‡´ä¸€éƒ¨åˆ†æ— æ•ˆçš„å†…å­˜è¢«å ç”¨ç€ã€‚</p>
</li>
</ul>
<blockquote>
<p>å½“å†…å­˜æ³„éœ²ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºã€‚è€Œå†…å­˜æº¢å‡ºå¯¼è‡´çš„ç»“æœæ˜¯åº”ç”¨ç¨‹åºè¢«æ€æ­»ã€‚</p>
</blockquote>
<h4>åœºæ™¯</h4>
<ol>
<li>å†…å­˜æº¢å‡º</li>
</ol>
<pre><code class="language-js">const obj = {}
for (let i = 0; i &lt; 10000; i++) {
  obj[i] = new Array(1000000)
}
// å°†ä¼šå´©æºƒ
</code></pre>
<ol start="2">
<li>å†…å­˜æ³„éœ²</li>
</ol>
<ul>
<li>æ„å¤–çš„å…¨å±€å˜é‡</li>
<li>é—­åŒ…</li>
<li>setInterval æ²¡æœ‰åŠæ—¶æ¸…é™¤</li>
<li>DOM å¼•ç”¨æœªç§»é™¤</li>
<li>...</li>
</ul>
<p>æœªå®Œå¾…ç»­...</p>
<!--

```js
function foo() {
  bar = 'bar'
}
foo()

// delete window.bar // ä¸»åŠ¨åˆ é™¤
```

-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | Cookie è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/278</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/278</guid>
            <pubDate>Sun, 26 Feb 2023 12:41:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-492e5a4beb7c95e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-492e5a4beb7c95e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>Cookie ç®€è¿°</h2>
<h3>Cookie æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>â€œCookieâ€ è¿™ä¸ªè¯æ²¡æœ‰å¤ªå¤šçš„å«ä¹‰ï¼Œåœ¨è®¡ç®—æœºå­¦ç§‘ä¸­å¾ˆæ—©å°±å‡ºç°äº†ï¼Œç”¨æ¥è¡¨ç¤ºå°‘é‡æ–‡æœ¬æ•°æ®ã€‚</p>
<p>åœ¨å‰ç«¯é¢†åŸŸï¼Œæˆ‘è®¤ä¸º Cookie çš„æ¦‚å¿µæ˜¯å¾ˆæ¨¡ç³Šçš„ã€‚æœ‰çš„æ—¶å€™ï¼Œå¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªå°å‹æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§å®¢æˆ·ç«¯ï¼ˆä¸‹ç§°â€œæµè§ˆå™¨â€ï¼‰ä¸æœåŠ¡ç«¯ï¼ˆä¸‹ç§°â€œæœåŠ¡å™¨â€ï¼‰äº¤äº’çš„ä¸€ç§å­˜å‚¨æœºåˆ¶ã€‚æ¯”å¦‚ï¼ŒåŒäº‹ A è¯´è®©æˆ‘çœ‹çœ‹é‚£ä¸ª XXX Cookie æ˜¯å¤šå°‘ï¼Œå®ƒå…·ä½“æŒ‡æµè§ˆå™¨ä¸­å­˜å‚¨çš„ä¸€å°å—æ–‡æœ¬ã€‚å¦‚æœå°† Cookie ä¸æœåŠ¡å™¨ Session æ”¾ä¸€èµ·æè¿°çš„æ—¶å€™ï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€ç§äº¤äº’æœºåˆ¶ã€‚</p>
<p>Cookie æ˜¯ä¸å®‰å…¨çš„ï¼ŒåŸå› æ˜¯å®ƒæœ¬èº«æ²¡æœ‰é‡‡ç”¨ä»»ä½•åŠ å¯†æœºåˆ¶ã€‚é€šè¿‡ HTTPS æ¥ä¼ è¾“ Cookie æ•°æ®æ˜¯å®‰å…¨çš„ï¼Œå®ƒä¸ Cookie æœ¬èº«æ— å…³ï¼Œä¸ HTTPS åè®®ç›¸å…³ã€‚</p>
<p>åœ¨ Web ä¸­ï¼ŒCookie å¯è¢«æœåŠ¡å™¨ã€æµè§ˆå™¨è¿›è¡Œè¯»å†™æ“ä½œã€‚åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨ä¼šå°†ä»»æ„ Cookie å†™å…¥ HTTP å¤´éƒ¨ï¼Œä¼ è¾“ç»™æœåŠ¡ç«¯ã€‚éšç€ Web çš„é£é€Ÿå‘å±•ï¼Œå‡ºäºå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œæ ‡å‡†ä¸æµè§ˆå™¨éƒ½åœ¨å¾€å‰èµ°ï¼Œå› è€Œå¹¶ä¸æ˜¯æ‰€æœ‰ Cookie éƒ½ä¼šå‡ºç°åœ¨ HTTP å¤´éƒ¨ã€‚å…·ä½“è¡Œä¸ºä¸‹æ–‡å†è°ˆã€‚</p>
<blockquote>
<p>Cookie æ˜¯ä¸€ä¸ªå°å‹æ–‡æœ¬æ–‡ä»¶ï¼Œç”¨äºæµè§ˆå™¨ä¸æœåŠ¡å™¨çš„æ•°æ®ä¼ è¾“ã€‚</p>
</blockquote>
<h3>ä¸ºä»€ä¹ˆéœ€è¦ Cookieï¼Ÿ</h3>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ HTTP æ˜¯æ— çŠ¶æ€çš„ã€‚é€šä¿—åœ°è®²ï¼Œ åŒä¸€æµè§ˆå™¨è¿ç»­å‘é€ HTTP è¯·æ±‚ä¸¤æ¬¡ï¼ŒæœåŠ¡å™¨ä¹Ÿæ— æ³•è¯†åˆ«åˆ°ä¸¤ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯çš„ã€‚</p>
<p>ä½†å¹¶ä¸æ„å‘³ç€ï¼ŒHTTP åè®®çš„æ— çŠ¶æ€æ˜¯ä¸å¥½çš„ã€‚åªæ˜¯ä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ¥ç»´æŠ¤â€œçŠ¶æ€â€ï¼ˆæŒ‡çš„æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼šè¯çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯è¯´ç»™ HTTP åè®®åŠ ä¸ªçŠ¶æ€ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œä¹Ÿæ— æ³•åšåˆ°ï¼‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œç½‘ä¸Šè´­ç‰©ã€ç½‘ç»œèŠå¤©ã€å‘å¸ƒè¯„è®ºç­‰åœºæ™¯ï¼Œæ˜¯éœ€è¦ç»´æŠ¤çŠ¶æ€çš„ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰çŠ¶æ€ï¼Œä½ æ·»åŠ è‡³è´­ç‰©è½¦çš„å•†å“ï¼Œåˆ·æ–°ä¸‹é¡µé¢å°±ä¸è§äº†ï¼Œé‚£è¿˜ä¸å¾—æ€¥......è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚ç»™è¯·æ±‚æ‰“ä¸Šä¸€ä¸ªâ€œ<strong>æ ‡è®°</strong>â€å³å¯ï¼Œåœ¨æ·»åŠ è‡³è´­ç‰©è½¦çš„è¯·æ±‚ä¸Šå¸¦ä¸Š <code>userId</code> å’Œ <code>goodsId</code> å¹¶å‘é€æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°è¿™äº›ä¿¡æ¯å°±å¯ä»¥åŒºåˆ†æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„äº†ï¼Œå¹¶å­˜å‚¨åˆ°ç›¸åº”çš„è¡¨ã€‚è¿™é‡Œæåˆ°çš„ <code>userId</code>ã€<code>goodsId</code> éƒ½æ˜¯æ ‡è®°ã€‚</p>
<p>é‚£ä¸€ç³»åˆ—çš„é—®é¢˜æ¥äº†ï¼Œæ ‡è®°æ¥è‡ªå“ªé‡Œã€å¦‚ä½•å­˜å‚¨ã€å‘é€è¯·æ±‚å¦‚ä½•å¸¦ä¸Šã€æœåŠ¡ç«¯å¦‚ä½•æ¥å—ï¼Ÿ</p>
<ul>
<li>æ ‡è®°ä¸€èˆ¬æ¥è‡ªæœåŠ¡ç«¯</li>
<li>å®¢æˆ·ç«¯å­˜å‚¨æ ‡è®°çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¸¸è§çš„æœ‰ï¼šå…¨å±€å˜é‡ã€<code>Cookie</code>ã€<code>sessionStorage</code>ã€<code>localStorage</code>ï¼Œå†æœ‰æ›´æ–°çš„ <code>IndexedDB</code>ã€<code>Cache API</code> ç­‰æ¥å£ã€‚</li>
</ul>
<p><code>Cookie</code> ä»…ä»…åªæ˜¯å…¶ä¸­ä¸€ç§å­˜å‚¨æ–¹å¼è€Œå·²ï¼Œä½†å®ƒå¯ä»¥åšåˆ°åœ¨æœåŠ¡ç«¯å†™ã€å®¢æˆ·ç«¯è¯»ï¼Œç„¶åå‘èµ·è¯·æ±‚æ—¶ï¼Œè‡ªåŠ¨æºå¸¦åœ¨ HTTP å¤´éƒ¨ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ¥æ”¶åˆ°ã€‚æ˜¯ä¸€ç§å¯ä»¥åšåˆ°æ— æ„Ÿçš„è¯»å†™æ–¹æ¡ˆã€‚åŒæ—¶ï¼Œæ­£æ˜¯å› ä¸ºè¿™ç§è¯·æ±‚æ—¶è‡ªåŠ¨å¸¦ä¸Šçš„æœºåˆ¶ï¼Œè¢«ä¸€äº›åˆ«æœ‰ç”¨å¿ƒçš„äººåˆ©ç”¨å®ƒæ¥åšä¸€äº›åäº‹ï¼Œæ¯”å¦‚ XSSã€CSRF ç­‰ã€‚</p>
<blockquote>
<p>åœ¨è¿™äº›å­˜å‚¨æ–¹æ¡ˆé‡Œï¼Œ<code>Cookie</code> æ˜¯æœ€æ—©å‡ºç°çš„ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒã€‚éšç€ Web Storage çš„å‘å±•ï¼Œåˆå‡ºç°äº†è¯¸å¦‚ <code>sessionStorage</code>ã€<code>localStorage</code> ç­‰æ–¹æ¡ˆã€‚å¦‚æœè¿˜ä¸å¤Ÿç”¨ï¼Œè¿˜æœ‰å¯å­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®çš„è§£å†³æ–¹æ¡ˆ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">IndexedDB</a>ã€‚</p>
<p>éšç€ Web Storage çš„æ™®åŠï¼ŒCookie å°†ä¼šå›åˆ°æœ€åˆçš„å½¢æ€ï¼Œä½œä¸ºä¸€ç§è¢«æœåŠ¡ç«¯è„šæœ¬ä½¿ç”¨çš„å®¢æˆ·ç«¯å­˜å‚¨æœºåˆ¶ã€‚</p>
</blockquote>
<h2>Cookie å±æ€§</h2>
<blockquote>
<p>å¾€ä¸‹ä¹‹å‰ï¼Œå¯ä»¥å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/275">Cookie å’Œ Storage API åŒºåˆ«ä¸è¯¦è§£</a>ã€‚</p>
</blockquote>
<p>Cookie ä¸»è¦æ˜¯ç”¨æ¥æœåŠ¡æœåŠ¡å™¨çš„ï¼Œåœ¨æµè§ˆå™¨é‡Œï¼Œæ¯ä¸ªåŸŸ Cookie çš„ç©ºé—´é™åˆ¶ä¸è¶…è¿‡ <code>4K</code>ï¼Œå› è€Œä¸é€‚å®œç”¨äºå­˜å‚¨ä¸æœåŠ¡å™¨æ— å…³çš„æ•°æ®ã€‚</p>
<p>ä»¥ä¸‹è¿™äº›å…ƒæ•°æ®ï¼Œç”¨æ¥è¡¨ç¤º Cookie çš„æ–‡æœ¬æ•°æ®ã€æœ‰æ•ˆæœŸã€ä½œç”¨åŸŸã€å¯è®¿é—®æ€§ã€‚</p>
<ul>
<li><strong><code>Name</code>ã€<code>Value</code></strong> - å¯¹åº” Cookie çš„åç§°å’ŒçœŸå®æ•°æ®ã€‚</li>
<li><strong><code>Domain</code>ã€<code>Path</code></strong> - å†³å®šè°å¯ä»¥è¯»å†™è¿™ä¸ª Cookieï¼Œç±»ä¼¼äºä½œç”¨åŸŸã€‚</li>
<li><strong><code>Expires</code>ã€<code>Max-Age</code></strong> - å†³å®šäº†è¿™ä¸ª Cookie çš„å¯¿å‘½ï¼ˆæœ‰æ•ˆæœŸï¼‰ã€‚</li>
<li><strong><code>Secure</code>ã€<code>HttpOnly</code></strong> - ç”¨æ¥åº”å¯¹ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ã€‚</li>
<li><strong><code>SameSite</code></strong> - ç”¨æ¥åº”å¯¹ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚</li>
</ul>
<p>å…ˆçœ‹çœ‹ä¸€ä¸ªçœŸå®çš„ Cookie å§ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b6661abcad17c525.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>Nameã€Value</h3>
<p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå¯¹åº” Cookie çš„åç§°å’Œæ•°æ®ï¼Œå±äº <code>Key-Value</code> é”®å€¼å¯¹å½¢å¼ã€‚Cookie ä¸€æ—¦åˆ›å»ºï¼Œåç§°å°±ä¸èƒ½æ›´æ”¹äº†ã€‚Value é€šå¸¸è¦è¿›è¡Œç¼–ç å¤„ç†ã€‚</p>
<h3>Domainã€Path</h3>
<p>Domain å†³å®šäº†æµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œå“ªäº›åŸŸåä¼šæºå¸¦è¿™ä¸ª Cookieã€‚Path åˆ™åœ¨ Domain çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥çº¦æŸäº†è¯¥ Cookie çš„å¯è®¿é—®è·¯å¾„ã€‚</p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>è‹¥æ²¡æœ‰æŒ‡å®š Domain å±æ€§ï¼Œåˆ™é»˜è®¤è®¾ä¸ºå½“å‰ URL çš„åŸŸåï¼Œå³å¯¹åº” <code>window.location.host</code> æˆ– <code>document.domain</code> çš„å€¼ã€‚</li>
<li>è‹¥æ²¡æœ‰æŒ‡å®š Path çš„è¯ï¼Œé»˜è®¤ä¸º <code>/</code>ã€‚</li>
<li>å¦å¤–ï¼Œåœ¨ç™¾åº¦çš„é¡µé¢ä¸‹ï¼Œä¸èƒ½å°† Domain è®¾ç½®æˆé˜¿é‡Œçš„ã€‚å³ä½¿ä¸ä¼šæŠ¥é”™ï¼Œä½†å®ƒæ— æ•ˆçš„ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¿½ç•¥ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>å‡è®¾ Cookie çš„ Domain æ˜¯ <code>.example.com</code>ï¼Œé‚£ä¹ˆå‘èµ· <code>a.example.com</code> æˆ– <code>b.example.com</code> åŸŸåä¸‹çš„ HTTP è¯·æ±‚ï¼Œéƒ½ä¼šæºå¸¦è¯¥ Cookieï¼Œåä¹‹ä¸è¡Œã€‚</p>
<p>å‡è®¾ Cookie çš„ Path ä¸º <code>/user</code>ï¼Œé‚£ä¹ˆè¯·æ±‚è·¯å¾„ä¸º <code>/user/1</code> ä¼šå¸¦ä¸Šï¼›è‹¥è¯·æ±‚è·¯å¾„ä¸º <code>/</code> æˆ– <code>/config</code> åˆ™ä¸ä¼šå¸¦ä¸Šã€‚</p>
<p>é€šä¿—åœ°è®²ï¼Œ</p>
<blockquote>
<p>Domainï¼šä½ æ˜¯ A å…¬å¸çš„å‘˜å·¥ï¼Œé‚£ä¹ˆ B å…¬å¸å°±ä¸èƒ½ä½¿å”¤ä½ ã€‚
Pathï¼šä½ æ˜¯ C éƒ¨é—¨çš„äººï¼Œé‚£ä¹ˆ D éƒ¨é—¨å°±ä¸èƒ½ä½¿å”¤ä½ å¹²æ´»ã€‚</p>
</blockquote>
<h3>Expiresã€Max-Age</h3>
<ul>
<li>è‹¥æ²¡æœ‰æŒ‡å®š Expires å’Œ Max-Age æ—¶ï¼Œè¿™ä¸ª Cookie å±äº Session Cookieï¼Œé€€å‡ºæµè§ˆå™¨å°±ä¼šè¢«æ¸…é™¤ã€‚</li>
<li>Expires ç”¨äºè®¾ç½® Cookie çš„è¿‡æœŸæ—¶é—´ï¼Œå®ƒçš„å€¼æ˜¯ UTC æ ¼å¼ã€‚</li>
<li>Max-Age ç”¨äºæŒ‡å®šä»ç°åœ¨å¼€å§‹ Cookie å­˜åœ¨çš„ç§’æ•°ï¼Œæ¯”å¦‚ï¼š<code>60 * 60 * 24 * 7</code> è¡¨ç¤ºä¸€å‘¨ã€‚</li>
<li>è‹¥åŒæ—¶æŒ‡å®š Expires å’Œ Max-Ageï¼Œé‚£ä¹ˆ Max-Age ä¼˜å…ˆç”Ÿæ•ˆã€‚</li>
<li>è‹¥åˆ°äº†å¤±æ•ˆæ—¶é—´ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ¸…é™¤ç›¸åº”çš„ Cookieã€‚</li>
</ul>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>Session Cookie é€€å‡ºæµè§ˆå™¨æ—¶ï¼Œæœ‰äº›æµè§ˆå™¨ä¸ä¸€å®šä¼šæ¸…é™¤ï¼ŒåŸå› è¯·çœ‹<a href="https://www.jianshu.com/p/d6a400445b27">è¿™é‡Œ</a>ã€‚</li>
<li>Expires ä¾èµ–äºæœ¬åœ°ç³»ç»Ÿæ—¶é—´ï¼Œå› æ­¤æ˜¯ä¸å¯é çš„ã€‚è€Œ Max-Age åˆ™ä¸æœ¬åœ°æ—¶é—´æ— å…³ï¼Œå®ƒæ€»ä¼šåœ¨è®¾ç½®å®Œçš„å¤šå°‘ç§’ä¹‹åå¤±æ•ˆã€‚</li>
<li>è‹¥æƒ³é€šè¿‡è„šæœ¬å»åˆ é™¤æŸä¸ª Cookieï¼Œå¯ä»¥å°† Expires è®¾ä¸ºè¿‡å»çš„æ—¶é—´ï¼Œæ¯”å¦‚ <code>new Date(0)</code>ã€‚ä¹Ÿå¯å°† Max-Age è®¾ä¸º <code>0</code>ã€‚</li>
<li>å°† Max-Age è®¾ä¸ºè´Ÿæ•°ï¼Œä¹Ÿç›¸å½“äºä¼šè¯çº§ Cookieã€‚</li>
<li>åœ¨ HTTP/1.0 æ˜¯é€šè¿‡ Expires æ¥åˆ¤æ–­çš„ï¼Œè€Œ HTTP/1.1 åˆ™é€šè¿‡ Max-Age æ¥åˆ¤æ–­ï¼Œè‹¥æ— æ­¤å‚æ•°ï¼Œåˆ™é™çº§ä½¿ç”¨ Expires åˆ¤æ–­ã€‚</li>
</ul>
<h3>Secureã€HttpOnly</h3>
<p>Secureï¼š</p>
<ul>
<li>è‹¥ Cookie æŒ‡å®šäº† Secureï¼Œå®ƒåªä¼šåœ¨ HTTPS è¯·æ±‚ä¸­æºå¸¦ä¸Šã€‚</li>
<li>è‹¥å½“å‰åè®®æ˜¯ HTTPï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šè‡ªåŠ¨å¿½ç•¥æœåŠ¡å™¨å‘æ¥çš„ Secure å±æ€§ã€‚</li>
<li>Secure åªæ˜¯ä¸€ä¸ªå¼€å…³ï¼Œä¸éœ€è¦æŒ‡å®šå€¼ã€‚å¦‚æœé€šä¿¡åè®®æ˜¯ HTTPS åè®®ï¼Œé€šè¿‡æœåŠ¡å™¨å†™å…¥çš„æ–¹å¼ï¼Œå°†ä¼šè‡ªåŠ¨æ‰“å¼€ã€‚</li>
</ul>
<p>HttpOnlyï¼š</p>
<p>è‹¥ Cookie æŒ‡å®šäº† HttpOnly å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ª Cookie å°†æ— æ³•é€šè¿‡ JavaScript è„šæœ¬è·å–ã€‚åªæœ‰åœ¨æµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶æ‰ä¼šæºå¸¦ä¸Šè¯¥ Cookieã€‚è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥è§£å†³ XSS æ”»å‡»çš„ã€‚</p>
<h3>SameSite</h3>
<p>åœ¨ Chrome 51 ä¸­å¼•å…¥è¿™ä¸ª SameSite å±æ€§ï¼Œé‚£æ—¶é»˜è®¤å€¼ä¸º Noneã€‚<strong>ä» Chrome 80 å¼€å§‹ï¼Œé»˜è®¤å€¼æ”¹ä¸º Lax</strong>ã€‚</p>
<p>Cookie çš„ SameSite å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚å®ƒå¯ä»¥è®¾ç½®ä¸‰ä¸ªå€¼ï¼š</p>
<ul>
<li><code>Strict</code> - æœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™è¯·æ±‚æ—¶ï¼Œä»»ä½•æƒ…å†µéƒ½ä¸ä¼šå‘é€ Cookieã€‚åªæœ‰å½“å‰é¡µé¢ URL ä¸è¯·æ±‚ URL ä¸€è‡´ï¼Œæ‰ä¼šå¸¦ä¸Š Cookieã€‚</li>
<li><code>Lax</code> - è§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œä½†æ˜¯å¯¼èˆªåˆ°ç›®æ ‡ç½‘ç«™çš„ GET è¯·æ±‚é™¤å¤–ï¼ŒåªåŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼šé“¾æ¥ï¼Œé¢„åŠ è½½è¯·æ±‚ï¼ŒGET è¡¨å•ï¼ˆè¯¦è§ä¸‹è¡¨ï¼‰ã€‚</li>
<li><code>None</code> - è‹¥æµè§ˆå™¨çš„ SameSite ä¸ä¸º None æ—¶ï¼Œç½‘ç«™å¯ä»¥æ˜¾å¼å…³é—­ SameSite å±æ€§ï¼Œå°†å…¶è®¾ä¸º Noneã€‚ä¸è¿‡å‰ææ˜¯å¿…é¡»åŒæ—¶è®¾ç½® Secure å±æ€§ï¼ˆCookie åªèƒ½é€šè¿‡ HTTPS åè®®å‘é€ï¼‰ï¼Œå¦åˆ™æ— æ³•æ˜¾å¼å…³é—­ï¼Œå³è®¾ç½®æ— æ•ˆã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>è¯·æ±‚ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>None</th>
<th>Lax</th>
</tr>
</thead>
<tbody>
<tr>
<td>é“¾æ¥</td>
<td><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>å‘é€ Cookie</td>
</tr>
<tr>
<td>é¢„åŠ è½½</td>
<td><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>å‘é€ Cookie</td>
</tr>
<tr>
<td>GET è¡¨å•</td>
<td><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>å‘é€ Cookie</td>
</tr>
<tr>
<td>POST è¡¨å•</td>
<td><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>ä¸å‘é€</td>
</tr>
<tr>
<td>iframe</td>
<td><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>ä¸å‘é€</td>
</tr>
<tr>
<td>AJAX</td>
<td><code>$.get(&quot;...&quot;)</code></td>
<td>å‘é€ Cookie</td>
<td>ä¸å‘é€</td>
</tr>
<tr>
<td>Image</td>
<td><code>&lt;img src=&quot;...&quot;&gt;</code></td>
<td>å‘é€ Cookie</td>
<td>ä¸å‘é€</td>
</tr>
</tbody>
</table>
<p>è®¾ç½®äº† <code>Strict</code> æˆ– <code>Lax</code> ä»¥åï¼ŒåŸºæœ¬å°±æœç»äº† CSRF æ”»å‡»ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ç”¨æˆ·æµè§ˆå™¨æ”¯æŒ <code>SameSite</code> å±æ€§ã€‚</p>
<p>è®¾ç½®ä¸º Strict</p>
<pre><code>Set-Cookie: CookieName=CookieValue; SameSite=Strict;
</code></pre>
<p>è®¾ç½®ä¸º Lax</p>
<pre><code>Set-Cookie: CookieName=CookieValue; SameSite=Lax;
</code></pre>
<p>è®¾ç½®ä¸º None</p>
<pre><code>// âŒ æ— æ•ˆ
Set-Cookie: widget_session=abc123; SameSite=None

// âœ… æœ‰æ•ˆ
Set-Cookie: widget_session=abc123; SameSite=None; Secure
</code></pre>
<p><strong>é¢å¤–åœ°ï¼ŒCookie å’Œ CSRF çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>CSRF æ”»å‡»ï¼Œä»…ä»…æ˜¯åˆ©ç”¨äº† HTTP æºå¸¦ Cookie çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»çš„ï¼Œä½†æ˜¯æ”»å‡»ç«™ç‚¹è¿˜æ˜¯æ— æ³•å¾—åˆ°è¢«æ”»å‡»ç«™ç‚¹çš„ Cookieã€‚è¿™ä¸ªå’Œ XSS ä¸åŒï¼ŒXSS æ˜¯ç›´æ¥é€šè¿‡æ‹¿åˆ° Cookie ç­‰ä¿¡æ¯è¿›è¡Œæ”»å‡»çš„ã€‚</p>
<h3>Priority</h3>
<p>ä¼˜å…ˆçº§ï¼Œè¿™æ˜¯ Chrome çš„ææ¡ˆï¼Œå®šä¹‰äº†ä¸‰ç§ä¼˜å…ˆçº§ï¼ŒLow/Medium/Highï¼Œå½“ cookie æ•°é‡è¶…å‡ºæ—¶ï¼Œä½ä¼˜å…ˆçº§çš„ cookie ä¼šè¢«ä¼˜å…ˆæ¸…é™¤ã€‚åœ¨ Safari å’Œ FireFox ä¸­ï¼Œä¸å­˜åœ¨ Priority å±æ€§ã€‚</p>
<p>ä¸åŒæµè§ˆå™¨æœ‰ä¸åŒçš„æ¸…é™¤ç­–ç•¥ï¼šä¸€äº›æ˜¯æ›¿æ¢æ‰æœ€å…ˆï¼ˆè€ï¼‰çš„ Cookieï¼Œæœ‰äº›åˆ™æ˜¯éšæœºæ›¿æ¢ã€‚</p>
<h3>SameParty</h3>
<p>å‰é¢ä¸æ˜¯æåˆ° SameSite ä¼šç¦ç”¨ç¬¬ä¸‰æ–¹ Cookie å˜›ï¼Œè¿™ä¸ª SameParty å°±æ˜¯ä¸ºäº†åˆæ³•åœ°ä½¿ Cookie åœ¨ä¸€äº›ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¸‹ä¹Ÿå¯ä½¿ç”¨ï¼ˆæŒ‡çš„æ˜¯å‘èµ· HTTP è¯·æ±‚æ—¶ä¼šå¸¦ä¸Šï¼‰ã€‚å®ƒéœ€è¦é…åˆ First-Party Sets ç­–ç•¥ä½¿ç”¨ã€‚</p>
<pre><code class="language-text">Set-Cookie: name=frankie; Secure; SameSite=Lax; SameParty
</code></pre>
<blockquote>
<p>è¿™ä¸ªæ˜¯æ–°ç‰¹æ€§ï¼Œæ›´å¤šè¯·çœ‹<a href="https://cloud.tencent.com/developer/article/1874999">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h2>Cookie è¯»å†™</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒCookie çš„è¯»å†™æ˜¯æœ‰å·®å¼‚çš„ï¼Œè¯»å–çš„æ—¶å€™å¯ä»¥ä¸€æ¬¡æ€§è·å–å½“å‰ä½œç”¨åŸŸä¸‹çš„æ‰€ç”¨ Cookieï¼Œè€Œå†™å…¥çš„æ—¶å€™åªèƒ½ä¸€æ¡ä¸€æ¡åœ°è¿›è¡Œå†™å…¥æ“ä½œã€‚è¿™è·Ÿæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´ Cookie çš„é€šä¿¡æ ¼å¼æœ‰å…³ã€‚æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ Cookie çš„æ—¶å€™ï¼Œæ˜¯ä¸€è¡Œå°†æ‰€æœ‰ Cookie å…¨éƒ¨å‘é€ã€‚</p>
<blockquote>
<p>å…³äº <code>document.cookie</code> çš„è¯»å†™å·®å¼‚ï¼Œå°±æ˜¯å¯¹è±¡çš„ <code>set/get</code> çš„åŸå› ã€‚</p>
</blockquote>
<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼Œå¯ä»¥çª¥æ¢ä¸€äºŒï¼Œå¯ä»¥çŸ¥é“å®ƒä»¬éƒ½æ˜¯å‡½æ•°ã€‚ä½†ç”±äºæ˜¯åŸç”Ÿçš„å†…ç½®æ–¹æ³•ï¼Œå› æ­¤æ— æ³•æ‰“å°å‡ºå…·ä½“çš„å‡½æ•°å†…å®¹ã€‚</p>
<pre><code class="language-js">// è¿™ç§æ–¹å¼å·²åºŸå¼ƒ
document.__lookupSetter__('cookie') // Æ’ cookie() { [native code] }
document.__lookupGetter__('cookie') // Æ’ cookie() { [native code] }

// ç°åœ¨æ ‡å‡†æ¨èç”¨è¿™ä¸ªï¼Œä½†æ³¨æ„è¦ Document.prototype ä¸Šé¢æ‰¾ï¼Œå› ä¸ºå®ƒä¸ä¼šå¾€åŸå‹ä¸Šæ‰¾çš„ã€‚
const descriptor = Object.getOwnPropertyDescriptor(Document.prototype, 'cookie')
descriptor.set // Æ’ cookie() { [native code] }
descriptor.get // Æ’ cookie() { [native code] }

// è‹¥è¦è¦†ç›–ï¼Œå¯ä»¥è¿™æ ·å†™ï¼ˆå®é™…é¡¹ç›®ä¸­åƒä¸‡åˆ«é‡å†™ï¼Œé™¤éå¦èµ·åç§°ï¼‰
Object.defineProperty(document, 'cookie', {
  set: function () {
    console.log('custom setter method...')
    // do something...
  },
  get: function () {
    console.log('custom getter method...')
    // do something and return some value
  }
})
</code></pre>
<h3>æµè§ˆå™¨ç¦ç”¨ Cookie</h3>
<p>é€šè¿‡ä»¥ä¸‹è¯­å¥ï¼Œå¯åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ‰“å¼€äº† Cookie åŠŸèƒ½ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</p>
<pre><code>window.navigator.cookieEnabled // true å¼€å¯
</code></pre>
<p>è‹¥å…³é—­äº† Cookie åŠŸèƒ½ï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨ Set-Cookieï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯é€šè¿‡ JS è„šæœ¬ï¼Œéƒ½æ— æ³•å†™å…¥ Cookieã€‚åŒæ ·åœ°ï¼Œå‘èµ· HTTP è¯·æ±‚ä¹Ÿå°†æ— æ³•æºå¸¦ã€‚</p>
<h3>å†™å…¥ Cookie</h3>
<p>åœ¨æœåŠ¡ç«¯ï¼Œå„ç§åç«¯è¯­è¨€æˆ–æ¡†æ¶æ—ç«‹ï¼Œå†™å…¥ Cookie çš„æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚ä¸‹é¢ä»¥ <a href="http://expressjs.com/en/4x/api.html#res.cookie">express</a> ä¸ºä¾‹ï¼š</p>
<pre><code class="language-js">import express from 'express'

const app = express()
const port = 8080

app.get('/', (req, res) =&gt; {
  // é€šå¸¸ name å’Œ value ä¼šç»è¿‡ç¼–ç å¤„ç†çš„ï¼Œåƒ express é»˜è®¤é‡‡ç”¨ encodeURIComponent è¿›è¡Œç¼–ç å¤„ç†ï¼Œäº¦å¯åœ¨ä»¥ä¸‹å¯é€‰é¡¹ä¸­ä¼ å…¥ encode å±æ€§ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ã€‚
  res.cookie('cookie-name', 'cookie-value', {
    // ä»¥ä¸‹ä¸ºå¯é€‰é¡¹
    // domain, // é»˜è®¤ä¸º URL å¯¹åº”åŸŸåï¼ˆæ³¨æ„æ˜¯æœåŠ¡å™¨ URLï¼‰
    // path, // é»˜è®¤ä¸º /
    // expires, // é»˜è®¤ä¸è®¾ç½®ï¼Œå³ä¼šè¯çº§ Cookie
    // maxAge, // é»˜è®¤ä¸è®¾ç½®ï¼Œå³ä¼šè¯çº§ Cookie
    // secure, // é»˜è®¤ï¼Œæ ¹æ®è¯·æ±‚åè®®å†³å®šæ˜¯å¦å¼€å¯ã€‚è‹¥ HTTP è¯·æ±‚ï¼Œè®¾ç½®äº† trueï¼Œå°†æ— æ³•å†™å…¥æµè§ˆå™¨
    // httpOnly, // é»˜è®¤ä¸º false
    // sameSite // é»˜è®¤ä¸è®¾ç½®ï¼Œæ­¤æ—¶å®ƒçš„å€¼å–å†³äºæµè§ˆå™¨çš„é»˜è®¤å€¼ã€‚æ¯”å¦‚ Chrome 80 ä¹‹åï¼Œå³ä½¿ä½ åœ¨æµè§ˆå™¨çœ‹åˆ°çš„æ˜¯ç©ºçš„ï¼Œä½†å®ƒçš„é»˜è®¤å€¼ä¸º Laxã€‚
  })

  // å¯å†™å…¥å¤šä¸ª
  res.cookie('other', '123')

  // other statements...
})

app.listen(port)
</code></pre>
<p>åœ¨å®¢æˆ·ç«¯å†™å…¥ï¼Œåªèƒ½é€šè¿‡ <code>document.cookie</code> è¿›è¡Œè®¾ç½®ã€‚æ³¨æ„ï¼Œå®ƒåªèƒ½ä¸ºå½“å‰åŸŸå†™å…¥ Cookieã€‚å‡è®¾ä½ åœ¨ä¸ªäººç½‘ç«™è®¾ç½®ï¼š<code>name=Frankie; Domain=github.com</code> æ˜¯æ— æ•ˆçš„ã€‚</p>
<pre><code class="language-js">document.cookie = 'name=Frankie; domain=*.example.com; path=/user; expires=Fri, 31 Dec 9999 23:59:59 GMT; max-age=3600; sameSite=Lax; secure; HttpOnly'
</code></pre>
<blockquote>
<p>åœ¨æµè§ˆå™¨é‡Œï¼Œé€šè¿‡ JS è„šæœ¬çš„æ–¹å¼ï¼Œä¼¼ä¹æ— æ³•å†™å…¥ <code>HttpOnly</code> çš„ Cookieã€‚ï¼ˆå¾…è¿›ä¸€æ­¥éªŒè¯ï¼‰</p>
</blockquote>
<p>è¿™æ ·è®¾ç½®å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°è£…ä¸€ä¸ªæ–¹æ³•æ¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€æ£€æŸ¥ Cookieï¼Œè¯·çœ‹ï¼š<a href="https://github.com/toFrankie/Some-JavaScript-File/blob/master/utils/Cookie.js">Cookie.js</a>ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Promise ä¸èƒ½è¢«å–æ¶ˆï¼ŒçœŸçš„ç®—æ˜¯ç¼ºç‚¹å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/277</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/277</guid>
            <pubDate>Sun, 26 Feb 2023 12:40:39 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-37a1b7678bb918ce.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-37a1b7678bb918ce.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å‰ä¸¤å¤©é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜é—®åˆ° Promise æœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ</p>
<p>æˆ‘çš„å›ç­”æ˜¯ï¼Œåœ¨å¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œæ—¶ï¼Œéœ€è¦ç¼–å†™å¤šä¸ª <code>then()</code> æˆ– <code>catch()</code> æ–¹æ³•æ¥å¤„ç†ç»“æœï¼Œå°½ç®¡å¯ä»¥æœ‰æ•ˆè§£å†³å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ï¼Œä½†ä¹Ÿä¼šæœ‰çºµå‘å‘å±•çš„è¶‹åŠ¿ï¼Œä¸å¤Ÿä¼˜é›…ã€‚</p>
<p>å°±æ²¡æƒ³èµ·ä»¥ä¸‹è¿™å‡ ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>æ— æ³•å–æ¶ˆ Promiseï¼Œä¸€æ—¦åˆ›å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆï¼›</li>
<li>åœ¨ä¸è®¾ç½®å›è°ƒå‡½æ•°æƒ…å†µä¸‹ï¼ŒPromise å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œä¸ä¼šåé¦ˆåˆ°å¤–éƒ¨ï¼›</li>
<li>å½“å¤„äº pending çŠ¶æ€ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸ªé˜¶æ®µã€‚</li>
</ul>
</blockquote>
<p>å“¦ï¼ŒåŸæ¥ä¸Šé¢è¿™äº›æ˜¯å®ƒçš„ç¼ºç‚¹å•Šï¼Œå½“æ—¶å°±æ²¡å¾€è¿™æ–¹é¢æƒ³ã€‚</p>
<p>ä½†æ˜¯ç»†æƒ³ä¸€ä¸‹ï¼Œç¬¬ä¸€ç‚¹çœŸçš„ç®—æ˜¯å®ƒçš„ç¼ºç‚¹å—ï¼Ÿ</p>
<p>æœ‰å…´è¶£çš„è¯ï¼Œè¯·çœ‹ä»¥ä¸‹ä¸¤ä¸ªé—®ç­”ï¼š</p>
<ul>
<li><a href="https://www.zhihu.com/question/495412354">Promise ä¸èƒ½è¢«å–æ¶ˆï¼ŒçœŸçš„ç®—æ˜¯å®ƒçš„ç¼ºç‚¹å—ï¼Ÿ</a></li>
<li><a href="https://segmentfault.com/q/1010000009781257">ä¸ºä»€ä¹ˆè¯´ Promise ä¸èƒ½å–æ¶ˆæ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[0.1 + 0.2 ä¸ºä»€ä¹ˆä¸ç­‰äº 0.3ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/276</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/276</guid>
            <pubDate>Sun, 26 Feb 2023 12:40:05 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5e174c3c8d690633.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5e174c3c8d690633.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p><code>0.1</code> å’Œ <code>0.2</code> åœ¨è½¬æ¢æˆäºŒè¿›åˆ¶åä¼šæ— é™å¾ªç¯ï¼Œç”±äºæ ‡å‡†ä½æ•°çš„é™åˆ¶åé¢å¤šä½™çš„ä½æ•°ä¼šè¢«æˆªæ‰ï¼Œæ­¤æ—¶å°±å·²ç»å‡ºç°äº†ç²¾åº¦çš„æŸå¤±ï¼Œç›¸åŠ åå› æµ®ç‚¹æ•°å°æ•°ä½çš„é™åˆ¶è€Œæˆªæ–­çš„äºŒè¿›åˆ¶æ•°å­—åœ¨è½¬æ¢ä¸ºåè¿›åˆ¶å°±ä¼šå˜æˆ <code>0.30000000000000004</code>ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaScript ä»…æœ‰ Number è¿™ä¸ªæ•°å€¼ç±»å‹ï¼Œè€Œ Number é‡‡ç”¨çš„æ˜¯ IEEE 754 64 ä½åŒç²¾åº¦æµ®ç‚¹æ•°ç¼–ç ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä»…æ˜¯ JavaScript ä¼šäº§ç”Ÿè¿™ç§é—®é¢˜ï¼Œåªè¦æ˜¯é‡‡ç”¨ IEEE 754 Floating-point çš„æµ®ç‚¹æ•°ç¼–ç æ–¹å¼æ¥è¡¨ç¤ºæµ®ç‚¹æ•°æ—¶ï¼Œåˆ™ä¼šäº§ç”Ÿè¿™ç±»é—®é¢˜ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://0.30000000000000004.com/">https://0.30000000000000004.com/</a></li>
<li><a href="https://www.cnblogs.com/fsjohnhuang/p/5115672.html">JSé­”æ³•å ‚ï¼šå½»åº•ç†è§£ 0.1 + 0.2 === 0.30000000000000004 çš„èƒŒå</a></li>
<li><a href="https://segmentfault.com/a/1190000011913127">å¦‚ä½•è§£å†³ 0.1 +0.2 === 0.30000000000000004 ç±»é—®é¢˜</a></li>
<li><a href="https://github.com/camsong/blog/issues/9">JavaScript æµ®ç‚¹æ•°é™·é˜±åŠè§£æ³•</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Cookie å’Œ Storage API åŒºåˆ«ä¸è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/275</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/275</guid>
            <pubDate>Sun, 26 Feb 2023 12:38:59 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ab497f7f6845b0cb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ab497f7f6845b0cb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å®ƒä»¬éƒ½æ˜¯æµè§ˆå™¨æ•°æ®å­˜å‚¨çš„æ–¹æ¡ˆï¼Œæ˜¯ç”¨äºè§£å†³<strong>æ•°æ®æŒä¹…åŒ–</strong>çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ•°æ®ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆæ¯”å¦‚æŒ‚è½½åˆ° <code>window</code> ç­‰å…¨å±€å¯¹è±¡ä¸‹ï¼‰ï¼Œä½†è¿™ç§æ–¹å¼æ¯å½“é¡µé¢åˆ·æ–°å°±ä¼šä¸¢å¤±ã€‚</p>
<p>ä¸‹é¢åˆ†åˆ«ä»å‡ ä¸ªæ–¹é¢ï¼Œè¯¦ç»†åœ°ä»‹ç» <code>Cookie</code>ã€<code>sessionStorage</code>ã€<code>localStorage</code> çš„åŒºåˆ«ã€‚</p>
<h2>ç©ºé—´é™åˆ¶</h2>
<ul>
<li><code>Cookie</code> - å¤§å°çº¦ä¸º <code>4K</code>ã€‚</li>
<li><code>sessionStorage</code> å’Œ <code>localStorage</code>  -  å¤§å°çº¦ä¸º <code>5M</code>ã€‚</li>
</ul>
<p>è¯·æ³¨æ„ï¼Œå…¶ä¸­ Cookie çš„ç©ºé—´å¤§å°æŒ‡çš„æ˜¯ <code>name</code>ã€<code>value</code> ä»¥åŠ <code>=</code> å·ã€‚</p>
<p>å¦å¤–ï¼Œè¿™ä¸‰ä¸ªä¸åŒæµè§ˆå™¨ä¸‹å¯èƒ½ä¼šæœ‰ç»†å¾®çš„å·®å¼‚ï¼Œå¯å¿½ç•¥ã€‚</p>
<blockquote>
<p>åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­ï¼Œè‹¥ Cookie å¤§å°å·²è¶…å‡ºç©ºé—´é™åˆ¶ï¼Œåç»­è®¾ç½®çš„æ–° Cookie å°±ä¼šè¢«å¿½ç•¥ã€‚</p>
</blockquote>
<h2>æ•°é‡é™åˆ¶</h2>
<ul>
<li><code>sessionStorage</code> å’Œ <code>localStorage</code> æ— æ•°é‡é™åˆ¶ä¸€è¯´ã€‚</li>
<li><code>Cookie</code> æ˜¯æœ‰æ•°é‡é™åˆ¶çš„ã€‚</li>
</ul>
<p>ä¸‹è¡¨ä¸ºç½‘ä¸Šæ”¶é›†ï¼ˆéå½“å‰å®æµ‹ç»“è®ºï¼‰ï¼Œçœ‹ä¸€çœ¼çŸ¥é“æœ‰é™åˆ¶è¿™å›äº‹å°±å¥½ã€‚</p>
<table>
<thead>
<tr>
<th>æµè§ˆå™¨</th>
<th>å¤§å°</th>
<th>æ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE6</td>
<td>4095 ä¸ªå­—èŠ‚</td>
<td>æ¯ä¸ªåŸŸ 20 ä¸ª</td>
</tr>
<tr>
<td>IE7/8</td>
<td>4095 ä¸ªå­—èŠ‚</td>
<td>æ¯ä¸ªåŸŸ 50 ä¸ª</td>
</tr>
<tr>
<td>Opera</td>
<td>4096 ä¸ªå­—èŠ‚</td>
<td>æ¯ä¸ªåŸŸ 30 ä¸ª</td>
</tr>
<tr>
<td>FireFox</td>
<td>4097 ä¸ªå­—èŠ‚</td>
<td>æ¯ä¸ªåŸŸ 50 ä¸ª</td>
</tr>
<tr>
<td>Safari</td>
<td>4097 ä¸ªå­—èŠ‚</td>
<td>æ²¡æœ‰æ•°é‡é™åˆ¶</td>
</tr>
<tr>
<td>Chrome</td>
<td>4097 ä¸ªå­—èŠ‚</td>
<td>æ¯ä¸ªåŸŸ 53 ä¸ª</td>
</tr>
</tbody>
</table>
<blockquote>
<p>è‹¥æœ‰å…´è¶£ï¼Œå®æµ‹å¯ä»¥çœ‹è¿™ä¸ªç½‘ç«™ï¼š<a href="http://browsercookielimits.iain.guru/">Browser Cookie Limits</a>ã€‚ä½œè€…ç®€å•è·‘äº†ä¸‹ï¼ŒChrome æ¯ä¸ªåŸŸæ˜¯ 180 ä¸ªï¼›Firefox å¾ˆå¿«å¡ä½äº†ï¼Œé£æ‰‡å—¡å—¡å“...... æµ‹è¯•ç»“æœ Firefox å’Œ Safari éƒ½ N/Aï¼ˆæ²¡æ•°æ®ï¼‰ï¼Œåº”è¯¥æ˜¯æ²¡æ•°é‡é™åˆ¶å§ã€‚</p>
</blockquote>
<p>é‰´äºå„æµè§ˆå™¨å¯¹ <code>Cookie</code> çš„ç©ºé—´ã€æ•°é‡é™åˆ¶ä¸å®Œå…¨ç›¸åŒï¼Œä¸ºäº†è¾ƒå¥½åœ°å…¼å®¹ï¼Œå»ºè®®å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ€»å…± 300 ä¸ª Cookie</li>
<li>æ¯ä¸ª Cookie å¤§å°ä¸º 4096 ä¸ªå­—èŠ‚</li>
<li>æ¯ä¸ªåŸŸ 20 ä¸ª Cookie</li>
<li>æ¯ä¸ªåŸŸ 81920 ä¸ªå­—èŠ‚ï¼ˆ20 Ã— 4096ï¼‰ ã€‚</li>
</ul>
<p>æ²¡é”™ï¼Œé¢è¯•å®˜é—®åˆ°è¿™ä¹ˆè¯´å§ï¼Œåº”è¯¥å°± OK äº†ã€‚</p>
<p>å¦å¤–ï¼Œä¸è¶…å‡ºç©ºé—´é™åˆ¶ä¸åŒçš„æ˜¯ï¼Œè¶…å‡ºæ•°é‡é™åˆ¶ä¹‹åï¼Œæ˜¯å¯ä»¥ç»§ç»­æ·»åŠ  <code>Cookie</code> çš„ï¼Œä½†ä¸åŒæµè§ˆå™¨æœ‰ä¸åŒçš„ç­–ç•¥ï¼šä¸€äº›æ˜¯æ›¿æ¢æ‰æœ€å…ˆï¼ˆè€ï¼‰çš„ <code>Cookie</code>ï¼Œæœ‰äº›åˆ™æ˜¯éšæœºæ›¿æ¢ã€‚ä½œç®€å•äº†è§£å°±å¥½ï¼Œä¸€èˆ¬é¡¹ç›®ä¸ä¼šè®¾é‚£ä¹ˆå¤šçš„ï¼Œè€Œä¸” <code>Cookie</code> è¿‡æœŸæµè§ˆå™¨æ˜¯ä¼šè‡ªåŠ¨æ¸…é™¤çš„ã€‚</p>
<h2>æœ‰æ•ˆæœŸ</h2>
<ul>
<li><code>Cookie</code> - æœ‰æ•ˆæœŸæ˜¯ç”± Max-Age æˆ– Expires å†³å®šçš„ã€‚å½“ <code>Cookie</code> è¿‡æœŸæˆ–å¤±æ•ˆï¼Œç”±æµè§ˆå™¨è‡ªåŠ¨åˆ é™¤ã€‚
<ul>
<li>è‹¥åœ¨è®¾ç½® <code>Cookie</code> æ—¶ä¸å†™å…¥è¿™ä¸¤ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå®ƒçš„å°±æ˜¯ä¼šè¯çº§åˆ«çš„ï¼Œå³é€€å‡ºæµè§ˆå™¨ä¼šè¢«é”€æ¯ã€‚</li>
<li>è‹¥åŒæ—¶å­˜åœ¨æ—¶ï¼Œ<code>Max-Age</code> ä¼˜å…ˆçº§æ›´é«˜ã€‚</li>
</ul>
</li>
<li><code>SessionStorage</code> - åœ¨æµè§ˆå™¨æ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰å…³é—­ä¹‹å‰å‡æœ‰æ•ˆã€‚åˆ·æ–°é¡µé¢ä¸å½±å“ã€‚</li>
<li><code>localStorage</code> - è‹¥ä¸ä¸»åŠ¨æ¸…é™¤ï¼Œæ°¸ä¹…æœ‰æ•ˆï¼ˆâ€œä¸»åŠ¨â€æ˜¯æŒ‡ç”±æµè§ˆå™¨æˆ–è„šæœ¬æ¸…é™¤ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>è¯·æ³¨æ„ï¼š</p>
<p>è®²é“ç†çš„è¯ï¼Œä¼šè¯çº§çš„ <code>Cookie</code> åœ¨æµè§ˆå™¨é€€å‡ºæ—¶å°±ä¼šè¢«åˆ é™¤ã€‚ä½†æ˜¯æœ‰äº›æµè§ˆå™¨ä¸è®²æ­¦å¾·ï¼Œæ¯”å¦‚ Chromeã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå…³é—­æµè§ˆå™¨é‡æ–°è¿›å…¥ï¼Œä¼šè¯çº§åˆ«çš„ Cookie å¹¶ä¸ä¼šåˆ é™¤ï¼Œåœ¨ Application é€‰é¡¹çš„ Cookie æ è¿˜èƒ½çœ‹åˆ°ã€‚</p>
<p>åŸå› å¯èƒ½æ˜¯ï¼š<strong>Chrome - è®¾ç½® - å¯åŠ¨æ—¶</strong> é€‰æ‹©äº† <strong>æ‰“å¼€æ–°æ ‡ç­¾</strong> ä¹‹å¤–çš„é€‰é¡¹ã€‚åˆ‡æ¢è¿‡æ¥å°±å¥½äº†...</p>
</blockquote>
<h2>ä½œç”¨åŸŸ</h2>
<h3>åŒæºä¸åŒç«™</h3>
<p>åŒæºå’ŒåŒç«™çš„åŒºåˆ«ï¼š</p>
<ul>
<li><strong>åŒæº</strong>ï¼ˆSame-Originï¼‰ï¼šåè®®ï¼ˆprotocolï¼‰+ ä¸»æœºåï¼ˆhostnameï¼‰+ ç«¯å£ï¼ˆportï¼‰å®Œå…¨ä¸€è‡´ã€‚</li>
<li><strong>åŒç«™</strong>ï¼ˆSame-Siteï¼‰ï¼š<code>eTLD + 1</code> å®Œå…¨ä¸€è‡´ã€‚</li>
</ul>
<p>é¡¶çº§åŸŸåå’ŒäºŒçº§åŸŸåï¼š</p>
<ul>
<li><strong>é¡¶çº§åŸŸå</strong>ï¼šä¹Ÿç§°ä¸ºâ€œä¸€çº§åŸŸåâ€ï¼Œå¸¸è§çš„æœ‰ <code>.com</code>ã€<code>.cn</code>ã€<code>.org</code>ã€<code>.net</code> ç­‰ç­‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åƒ <code>.com.cn</code>ã€<code>.com.hk</code> ä¹Ÿå±äºé¡¶çº§åŸŸåã€‚</li>
<li><strong>äºŒçº§åŸŸå</strong>ï¼šå°±æ˜¯é¡¶çº§åŸŸåçš„ä¸‹ä¸€çº§åŸŸåã€‚</li>
</ul>
<blockquote>
<p>åœ¨å›½å†…ï¼Œå¾ˆå¤šèµ„æ–™è®¤ä¸ºï¼Œé¡¶çº§åŸŸå’Œä¸€çº§åŸŸæ˜¯åˆ†å¼€çš„ã€‚æ¯”å¦‚ <code>.baidu.com</code>ï¼Œå¦‚æœæŒ‰ç…§è¿™ç§æ–¹å¼åˆ’åˆ†ï¼Œé‚£ä¹ˆ<code>.com</code> æ˜¯é¡¶çº§åŸŸåï¼Œ<code>.baidu.com</code> å°±æ˜¯ä¸€çº§åŸŸåã€‚å¥½åƒé˜¿é‡Œäº‘å°±æ˜¯è¿™æ ·å®šä¹‰çš„ã€‚</p>
</blockquote>
<blockquote>
<p>è€Œæˆ‘æ›´åå‘äºè®¤ä¸ºï¼Œ<code>.baidu.com</code> å±äºäºŒçº§åŸŸåã€‚ä¸ç”¨è¿‡åˆ†çº ç»“ï¼Œåœ¨å›¢é˜Ÿå†…ç»Ÿä¸€å³å¯ã€‚</p>
</blockquote>
<p><a href="https://publicsuffix.org/list/public_suffix_list.dat"><code>eTLD</code></a>ï¼ˆTop-Level Domainsï¼‰è¡¨ç¤ºæœ‰æ•ˆé¡¶çº§åŸŸåï¼Œé‚£ä¹ˆ <code>eTLD + 1</code> å°±è¡¨ç¤ºäºŒçº§åŸŸåã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-text">https://www.example.com.cn
</code></pre>
<p>å…¶ä¸­ <code>eTLD</code> æ˜¯ <code>.com.cn</code>ï¼Œé‚£ä¹ˆ <code>eTLD + 1</code> å°±æ˜¯ <code>.example.com.cn</code>ã€‚</p>
<blockquote>
<p>å…³äº eTLD æ›´å¤šè¯·çœ‹<a href="https://juejin.cn/post/6877496781505200142">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<p>å®Œæ•´çš„ URLï¼ˆç½‘å€ï¼‰æ„æˆå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0db9113c11791883.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç®€å•æ¥è¯´ï¼Œåªè¦äºŒçº§åŸŸåç›¸åŒï¼Œå°±å±äºåŒç«™ã€‚åŒæºåˆ™è¦æ±‚æ›´ä¸¥æ ¼ã€‚å› æ­¤åŒæºä¸€å®šåŒç«™ï¼Œåä¹‹åˆ™ä¸ä¸€å®šã€‚</p>
<p>ä»¥ä¸‹ä¾‹å­ï¼ŒåŒç«™ï¼Œä½†ä¸åŒæºã€‚</p>
<pre><code class="language-text">http://a.example.com:80
http://b.example.com:80
</code></pre>
<h3>ä¸‰è€…çš„ä½œç”¨åŸŸ</h3>
<ul>
<li><code>localStorage</code> - è¿™ä¸ªæœ€ç®€å•ï¼Œå¿…é¡»<strong>åŒæº</strong>æ‰èƒ½è®¿é—®ï¼Œåœ¨ä¸åŒæ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰ä¹‹é—´å¯å…±äº«ã€‚</li>
<li><code>sessionStorage</code> - <strong>å¿…é¡»åŒæºï¼Œä¸”ä¸åŒæ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰ä¹‹é—´æ˜¯ä¸èƒ½å…±äº«çš„</strong>ï¼ˆè¿™ç‚¹ä¸Šç›²çŒœæŒºå¤šäººä¼šç†è§£é”™çš„ï¼Œæˆ‘å½“åˆä¹Ÿç†è§£é”™äº†ï¼‰ã€‚</li>
<li><code>Cookie</code> - <strong>åŒç«™</strong>æ˜¯å‰æï¼Œå®ƒè¿˜å—é™äºå…·ä½“çš„ <code>Domain</code> å’Œ <code>Path</code>ã€‚</li>
</ul>
<p>ç†è§£è¿™äº›å¾ˆé‡è¦ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p>
<h3>ä½œç”¨åŸŸå¼•å‘çš„é—®é¢˜</h3>
<p>å¾ˆå¤šå…¬å¸ï¼Œä¸æ˜¯æ¯ä¸ª Web é¡¹ç›®å¯¹åº”ä¸€ä¸ªä¸‰çº§åŸŸåã€‚</p>
<pre><code class="language-text">// ä¸»è¥ä¸šåŠ¡ã€è¾ƒä¸ºé‡è¦çš„ä¸šåŠ¡ï¼Œå¯èƒ½ä¼šè¿™æ ·å»åŒºåˆ†ï¼š
https://project-a.company.com
https://project-b.company.com

// ä½†ä¸€äº›éä¸šåŠ¡æ€§ã€æˆ–è€…ä¸€äº›å°é¡¹ç›®ï¼Œå¾ˆå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š
https://sub.company.com/project-a/index.html
https://sub.company.com/project-b/index.html
</code></pre>
<p>è¿™äº›éƒ½å¾ˆå¸¸è§ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ã€‚å®ƒä»¬å¾ˆå¤šéƒ½æ˜¯åŒæºã€åŒç«™çš„ã€‚å‡è®¾æŒ‰å°é¡¹ç›®åˆ’åˆ†åœºæ™¯ï¼Œæˆ‘åœ¨ <code>a</code> é¡¹ç›®ä¸­è®¾ç½®äº†ä¸€ä¸ª <code>sessionStorage</code> ä¼šè¯çº§ç¼“å­˜ï¼Œé‚£ä¹ˆå½“å‰ä» <code>a</code> é¡¹ç›®è·³è½¬è‡³ <code>b</code> é¡¹ç›®æ—¶ï¼Œ<code>b</code> æ˜¯å¯ä»¥è·å–åˆ° <code>a</code> é¡¹ç›®çš„æ‰€æœ‰ <code>sessionStorage</code> çš„ï¼Œåä¹‹ä¹Ÿæˆç«‹ã€‚å¦‚æœ <code>a</code> å’Œ <code>b</code> é¡¹ç›®ä¸­æŸä¸ª <code>sessionStorage</code> çš„ <code>key</code> ä¸å°å¿ƒè®¾ç½®æˆç›¸åŒçš„è¯ï¼Œé‚£å¾ˆå¯èƒ½å°±ä¼šå½±å“åˆ°å¯¹æ–¹ã€‚<code>localStorage</code> åŒç†ã€‚è‡³äº <code>Cookie</code> çš„è¯ï¼Œç”±äºå®ƒçš„ç©ºé—´é™åˆ¶æœ€å¤§åªå…è®¸ 4Kï¼Œå› æ­¤ä¸é€‚å®œå­˜è¿‡å¤šæ•°æ®ï¼Œä¸€èˆ¬ä¼šå­˜ä¸€äº›åƒé‰´æƒä¿¡æ¯ç­‰æ¯”è¾ƒå¤šã€‚åŒä¸ªå…¬å¸ï¼Œä¸šåŠ¡çš„ç”¨æˆ·é‰´æƒç­‰æ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥ <code>Cookie</code> çš„è®¿é—®æœºåˆ¶ä¹Ÿä¸ä¼šæœ‰å¤ªå¤§çš„å½±å“ã€‚</p>
<p>é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œå»ºè®®æ˜¯éå¿…è¦çš„è¯ï¼Œå°†æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯”å¦‚ç”¨ Vuexã€Reduxã€MobX ç­‰çŠ¶æ€ç®¡ç†å·¥å…·æ¥ç»´æŠ¤åº”ç”¨çš„çŠ¶æ€ã€‚ä¸€æ˜¯ä¿¡æ¯æ›´ä¸å®¹æ˜“æš´éœ²ï¼Œè€Œæ˜¯å¯ä»¥å‡å°‘ IO çš„è¯»å†™ã€‚ä½†æ˜¯ï¼Œè¿™æ ·çš„è¯ï¼Œå°±è¦è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨å†…å­˜ä¸­çš„è¯ï¼Œåªè¦åˆ·æ–°é¡µé¢å°±ä¼šä¸¢å¤±ã€‚æ€ä¹ˆè§£å†³ï¼Ÿ</p>
<p>ä»¥ Redux ä¸ºä¾‹ï¼Œåœ¨åˆ›å»º Store æ—¶ï¼Œæ˜¯å¯ä»¥ä¼ å…¥ä¸€ä¸ªåˆå§‹çŠ¶æ€çš„ï¼Œå®ƒçš„å€¼å–ä¸‹é¢è¿™ä¸ªä¼šè¯ç¼“å­˜å³å¯ã€‚åªè¦ç›‘å¬åˆ°çŠ¶æ€å‘ç”Ÿå˜åŒ–å˜åŒ–ï¼Œå¹¶è®¾ç½®æˆ–æ›´æ–° <code>sessionStorage</code> çº§åˆ«çš„ç¼“å­˜ï¼Œå°†çŠ¶æ€ç¼“å­˜èµ·æ¥å³å¯ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">import { createStore } from 'redux'

// å®šä¹‰ä¸€ä¸ªå¯æŒ‰é¡¹ç›®åˆ’åˆ†çš„ key
const { host, pathname } = window.location
const stateCacheKey = `cache_state_${host}_${pathname}`

// è®¾ç½® store çš„åˆå§‹å€¼ï¼Œå– stateCacheKey ç¼“å­˜çš„å€¼ï¼Œé¦–æ¬¡ä¸ºç©ºå¯¹è±¡
const initialState = JSON.parse(sessionStorage.getItem(stateCacheKey)) || {}

// åˆ›å»º Storeï¼ˆreducersã€middlewares éæœ¬æ–‡è®¨è®ºé‡ç‚¹çœç•¥...ï¼‰
const reducers = (state = {}, action) =&gt; { /* some reducers... */ }
const store = createStore(reducers, initialState) // è¿™é‡Œçœç•¥äº†ä¸­é—´ä»¶

// ç›‘å¬çŠ¶æ€ï¼Œæ¯æ¬¡çŠ¶æ€å˜åŒ– stateCacheKey éƒ½å¾—ä»¥æ›´æ–°
const unsubscribe = store.subscribe(() =&gt; {
  const currentStateStr = JSON.stringify(store.getState())
  window.sessionStorage.setItem(stateCacheKey, currentStateStr)
})

// è§£é™¤ç›‘å¬ï¼Œè¿™æ · store.unsubscribe() è°ƒç”¨å³å¯
store.unsubscribe = unsubscribe

// ä¸ªäººä¹ æƒ¯ï¼Œä¹Ÿå°† store æŒ‚è½½å…¨å±€ï¼Œä»¥å¤‡ç‰¹æ®Šæƒ…å†µè°ƒç”¨
window.store = store

// ä½œä¸ºæ¨¡å—å¯¼å‡ºï¼Œå¹¶ä¼ å…¥ react-redux çš„ Provider ç»„ä»¶
export default store
</code></pre>
<h3>sessionStorage é²œä¸ºäººçŸ¥çš„ç‚¹ï¼ˆå†·é—¨ï¼‰</h3>
<blockquote>
<p>ä¸‹é¢ä¾‹å­ï¼Œå‡åœ¨åŒæºæƒ…å†µä¸‹ã€‚</p>
</blockquote>
<p>å‡è®¾æœ‰ä¸¤ä¸ªåŒæºé¡µé¢ï¼š A é¡µé¢ã€B é¡µé¢å¯¹åº” URL ä¸º <code>page_a_url</code>ã€<code>page_b_url</code>ã€‚</p>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<pre><code class="language-js">// 1. åœ¨ A é¡µé¢ï¼Œè®¾ç½®ä¸€ä¸ªä¼šè¯ç¼“å­˜ï¼škeyA
sessionStorage.setItem('keyA', '123')

// 2. è‹¥ A æœ‰ä¸€ä¸ªé“¾æ¥ï¼Œå¯è·³è½¬è‡³ B é¡µé¢ï¼ˆå°†ä¼šä»¥æ–°çª—å£çš„å½¢å¼æ‰“å¼€ B é¡µé¢ï¼‰
&lt;a target=&quot;_blank&quot; href=&quot;page_b_url&quot;&gt;To Page B&lt;/a&gt;

// 3. ç‚¹å‡»é“¾æ¥ï¼Œè·³è½¬åˆ° B é¡µé¢
sessionStorage.getItem('keyA') // â“ æ‰“å°ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

// 4. æ¥ç€ï¼Œåœ¨ B é¡µé¢ä¸­ï¼Œè®¾ç½®å¦ä¸€ä¸ªä¼šè¯ç¼“å­˜ï¼škeyB
sessionStorage.setItem('keyB', '456')

// 5. åˆ‡æ¢è‡³ A é¡µé¢ï¼Œæ‰“å°ä¸€ä¸‹ï¼š
sessionStorage.getItem('keyB') // â“ æ‰“å°ç»“æœåˆæ˜¯ä»€ä¹ˆï¼Ÿ

// 6. åœ¨ A é¡µé¢ä¸­å†æ¬¡è®¾ç½®ä¸€ä¸ªç¼“å­˜ï¼škeyB
sessionStorage.setItem('keyB', '789')

// 7. å†æ¬¡åˆ‡æ¢è‡³ B é¡µé¢çš„çª—å£ï¼Œ
sessionStorage.getItem('keyB') // â“ æ‰“å°ç»“æœæ˜¯ &quot;456&quot; è¿˜æ˜¯ &quot;789&quot; å‘¢ï¼Ÿ
</code></pre>
<p>ç¤ºä¾‹äºŒï¼šå°†ä¸Šè¿°ç¬¬äºŒæ­¥æ”¹æˆä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-html">&lt;a onclick=&quot;window.open('page_b_url', 'DescriptiveWindowName')&quot;&gt;To Page B&lt;/a&gt;
</code></pre>
<p>ç»“æœåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç›´æ¥çœ‹ä¸‹ç»“æœï¼š</p>
<pre><code class="language-text">ç¤ºä¾‹ä¸€ï¼Œä¾æ¬¡æ‰“å°å‡ºï¼šnullã€nullã€&quot;456&quot;

ç¤ºä¾‹äºŒï¼Œä¾æ¬¡æ‰“å°å‡ºï¼š&quot;123&quot;ã€nullã€&quot;456&quot;
</code></pre>
<p>ç»“è®ºï¼š</p>
<ul>
<li>
<p>åŒä¸€æ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰ä¸‹ï¼Œæ‰€æœ‰åŒæºé¡µé¢å°†å…±äº« <code>sessionStorage</code>ï¼ŒåŒæ ·åœ°ï¼Œåœ¨æŸä¸ªé¡µé¢ä¿®æ”¹ï¼Œå°†å½±å“å…¶ä»–é¡µé¢ã€‚</p>
</li>
<li>
<p>é€šè¿‡ <code>&lt;a target=&quot;_blank&quot; href=&quot;page_b_url&quot;&gt;&lt;/a&gt;</code> æˆ– <code>window.open('page_b_url', 'windowName')</code> æ–¹å¼æ‰“å¼€å…¶ä»–åŒæºé¡µé¢ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸¤ä¸ª Tab ä¹‹é—´çš„ <code>sessionStorage</code> æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“ã€‚</li>
<li>åŒºåˆ«ç‚¹åœ¨äºï¼Œæ‰“å¼€æ–°çª—å£æ—¶ï¼Œåˆå§‹ç¼“å­˜ä¸ä¸€æ ·ï¼šå‰è€…çš„åˆå§‹ <code>sessionStorage</code> ç¼“å­˜ä¸ºç©ºã€‚åè€…åŸºäºåŸ Tab çš„ <code>sessionStorage</code> æ‹·è´ä¸€ä»½ï¼Œä½œä¸ºæ–°çª—å£çš„åˆå§‹ <code>sessionStorage</code> ç¼“å­˜ã€‚</li>
<li>å‰è€…è¡¨ç°ä¸æ‰‹åŠ¨åˆ›å»ºæ–°çª—å£æ˜¯ä¸€è‡´çš„ã€‚</li>
</ul>
</li>
<li>
<p>éœ€è¦å¦å¤–ä¸€ç§æƒ…å†µï¼Œå½“åœ¨æŸé¡µé¢å†…åµŒå¥—äº†ä¸€ä¸ªåŒæºçš„ <code>iframe</code>ï¼Œå®ƒä»¬ä¹‹é—´ <code>sessionStorage</code> æ˜¯å…±äº«çš„ã€‚è‹¥éåŒæºé¡µé¢åˆ™ä¸å…±äº«ã€‚ï¼ˆè¿™ä¸€ç‚¹ä¸å®Œå…¨ä¸¥è°¨ï¼Œå…·ä½“åŸå› è¯·å¾€ä¸‹çœ‹ï¼‰</p>
</li>
</ul>
<h3>æ€»ç»“</h3>
<ul>
<li><code>Cookie</code> ä½œç”¨åŸŸå‰ææ˜¯åŒç«™ï¼ŒåŒæ—¶è¿˜å—é™äº <code>Domain</code> å’Œ <code>Path</code>ã€‚è‹¥ä¸¤è€…ä¸€è‡´ï¼Œå³å¯ç†è§£ä¸ºåŒç«™å…±äº«ã€‚</li>
<li><code>sessionStorage</code> å’Œ <code>localStorage</code> å‰æå¿…é¡»æ˜¯åŒæºï¼Œå…¶æ¬¡å‰è€…åœ¨ä¸åŒæ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰ç›¸äº’ç‹¬ç«‹ï¼›åè€…åœ¨æ‰€æœ‰æ ‡ç­¾ä¹‹é—´å…±äº«ã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸åŒæ–¹å¼åˆ›å»ºæ–°æ ‡ç­¾ï¼ˆæˆ–çª—å£ï¼‰ï¼Œå®ƒçš„ <code>sessionStorage</code> åˆå§‹å€¼ä¼šæœ‰æ‰€å·®å¼‚ã€‚é€šè¿‡ <code>window.open()</code> æ–¹å¼ï¼Œä¼šå°†åŸæ¥å…ˆçš„ <code>sessionStorage</code> å€¼æ‹·è´è¿‡æ¥ï¼Œä½œä¸ºå…¶åˆå§‹å€¼ï¼›å…¶ä»–æ–¹å¼åˆå§‹ç¼“å­˜ä¸ºç©ºã€‚ä½†æ³¨æ„ï¼Œåç»­çš„ <code>sessionStorage</code> è¯»å†™æ“ä½œéƒ½æ˜¯ç‹¬ç«‹å¯¹ã€‚</li>
</ul>
<h2>ä¸æœåŠ¡å™¨é€šä¿¡çš„å·®å¼‚</h2>
<p><code>sessionStorage</code> å’Œ <code>localStorage</code> ä¸ä¼šä¸»åŠ¨å‚ä¸ä¸æœåŠ¡å™¨çš„é€šä¿¡ã€‚</p>
<p>Cookie æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸Šçš„ä¸€å°å‹æ–‡æœ¬æ–‡ä»¶ã€‚åœ¨æ¯æ¬¡ä¸æœåŠ¡å™¨çš„é€šä¿¡ä¸­éƒ½ä¼šæºå¸¦åœ¨ HTTP è¯·æ±‚å¤´ä¹‹ä¸­ã€‚</p>
<blockquote>
<p>ä½†æ˜¯ä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œå¦èµ·ä¸€æ–‡ï¼Œè¯·ç¨ç­‰...</p>
</blockquote>
<h2>å…¶ä»–</h2>
<h3>storage äº‹ä»¶çš„è¿·æƒ‘è¡Œä¸º</h3>
<p>é¦–å…ˆï¼Œæ³¨å†Œ <code>storage</code> äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒ<strong>åªèƒ½</strong>ç›‘å¬<strong>å…¶ä»–åŒæºé¡µé¢</strong>çš„ç¼“å­˜<strong>å‘ç”Ÿæ”¹å˜</strong>æ—¶ï¼Œå®ƒæ‰ä¼šè¢«è§¦å‘ã€‚</p>
<p>å¾—å‡ºå‡ ä¸ªç»“è®ºï¼š</p>
<ul>
<li>ç”¨äºç›‘å¬å…¶ä»–é¡µé¢çš„ç¼“å­˜å˜åŒ–ï¼Œè€ŒåŒä¸€é¡µé¢å†…çš„ç¼“å­˜å˜åŒ–ï¼Œéƒ½ä¸èµ·ä½œç”¨ã€‚ï¼ˆå¥‡è‘©å§ï¼‰</li>
<li>ç”±äºä¸åŒ Tab ä¹‹é—´ <code>sessionStorage</code> æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤æ— æ³•ç›‘å¬ <code>sessionStorage</code> çš„å˜åŒ–ï¼Œå³åªèƒ½ç›‘å¬ <code>localStorage</code> çš„å˜åŒ–ã€‚</li>
<li>â€œå‘ç”Ÿæ”¹å˜â€åŒ…æ‹¬ï¼šåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€‚ä½†é‡å¤è®¾ç½®ç›¸åŒçš„ key-value ä¸ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå®ƒè‡³å¤šåœ¨é¦–æ¬¡åˆ›å»ºæ—¶è§¦å‘ã€‚</li>
</ul>
<pre><code class="language-js">const listener = function (e) {
  // key: å¯¹åº”ç¼“å­˜ key
  // newValue: è¯¥ key æ–°è®¾ç½®çš„ç¼“å­˜å€¼
  // oldValue: è¯¥ key å¯¹åº”çš„æ—§ç¼“å­˜å€¼
  // storageArea: å¯¹åº”ä¸º window.localStorage å¯¹è±¡
  // storageArea: è§¦å‘è¯¥äº‹ä»¶æ‰€å¯¹åº”çš„ URL
}
window.addEventListener('storage', listener)
</code></pre>
<h3>å½“ localStorage è¶…è¿‡ 5M çš„ç©ºé—´é™åˆ¶ä¹‹åï¼Œè‹¥å†æ¬¡ setItem ä¼šæ€æ ·ï¼Ÿ</h3>
<p>ç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼Œè¿™æ¬¡ <code>setItem()</code> å°†ä¼šå¤±è´¥ï¼Œä¸”ä¼šæŠ›å‡ºé”™è¯¯ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚æ¸…ç©ºå†é‡æ–°è®°å½•ç­‰...</p>
<pre><code class="language-js">for (let i = 0; i &lt; 2; i++) {
  try {
    localStorage.setItem('key', 'value')
    break
  } catch (e) {
    // æ¸…ç©ºï¼Œå¹¶é‡è¯•
    // QuotaExceededError: The quota has been exceeded. localStorageç¼“å­˜è¶…å‡ºé™åˆ¶
    localStorage.clear()
  }
}
</code></pre>
<h3>åœ¨ Safari æ— ç—•æ¨¡å¼ä¸‹ï¼Œå¯¹ sessionStorage æ“ä½œå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸</h3>
<p>è¯·çœ‹ï¼š<a href="https://stackoverflow.com/questions/14555347/html5-localstorage-error-with-safari-quota-exceeded-err-dom-exception-22-an">html5 localStorage error with Safari: &quot;QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to add something to storage that exceeded the quota.&quot;</a></p>
<h3>sessionStorage åœ¨ iframe çš„é—®é¢˜</h3>
<blockquote>
<p>å»ºè®®å°‘ç”¨ <code>iframe</code>ï¼Œå°½ç®¡ç›®å‰å¾ˆå¤šå¤§ç½‘ç«™ä»ç„¶ä½¿ç”¨å®ƒã€‚</p>
</blockquote>
<p>å‰é¢æåˆ°é¡¶çº§çª—å£å’Œ iframe çª—å£çš„é¡µé¢éƒ½æ˜¯åŒæºçš„æƒ…å†µä¸‹ï¼ŒsessionStorage æ˜¯å¯å…±äº«çš„ã€‚ä½†ä¸å®Œå…¨æ˜¯ï¼Œæ¯”å¦‚å— <code>iframe</code> çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe">sandbox</a> å±æ€§å½±å“ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<pre><code class="language-html">// 1ï¸âƒ£
&lt;iframe sandbox&gt;

// 2ï¸âƒ£
&lt;iframe sandbox=&quot;allow-same-origin&quot;&gt;
</code></pre>
<p>å‡è®¾ä¸¤ä¸ªé¡µé¢åŒæºï¼›æƒ…å†µä¸€ <code>sessionStorage</code> ä¸å…±äº«ï¼Œåœ¨ <code>iframe</code> ä¸­æ˜¯ä¸€ä¸ªå…¨æ–°çš„ <code>sessionStorage</code> å¯¹è±¡ã€‚æƒ…å†µäºŒåˆ™å…±äº« <code>sessionStorage</code>ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage">Web Storage API</a></li>
<li><a href="http://caibaojian.com/web-storage.html">Web Storage çš„ä½¿ç”¨å’Œè¿›é˜¶çŸ¥è¯†</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[HTTP çŠ¶æ€ç ]]></title>
            <link>https://github.com/toFrankie/blog/issues/274</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/274</guid>
            <pubDate>Sun, 26 Feb 2023 12:38:00 GMT</pubDate>
            <description><![CDATA[<p>STATUS_CODES å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{
  '100': 'Continue',
  '101': 'Switching Protocols',
  '102': 'Processing',
  '103': 'Early Hints',
  ']]></description>
            <content:encoded><![CDATA[<p>STATUS_CODES å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{
  '100': 'Continue',
  '101': 'Switching Protocols',
  '102': 'Processing',
  '103': 'Early Hints',
  '200': 'OK',
  '201': 'Created',
  '202': 'Accepted',
  '203': 'Non-Authoritative Information',
  '204': 'No Content',
  '205': 'Reset Content',
  '206': 'Partial Content',
  '207': 'Multi-Status',
  '208': 'Already Reported',
  '226': 'IM Used',
  '300': 'Multiple Choices',
  '301': 'Moved Permanently',
  '302': 'Found',
  '303': 'See Other',
  '304': 'Not Modified',
  '305': 'Use Proxy',
  '307': 'Temporary Redirect',
  '308': 'Permanent Redirect',
  '400': 'Bad Request',
  '401': 'Unauthorized',
  '402': 'Payment Required',
  '403': 'Forbidden',
  '404': 'Not Found',
  '405': 'Method Not Allowed',
  '406': 'Not Acceptable',
  '407': 'Proxy Authentication Required',
  '408': 'Request Timeout',
  '409': 'Conflict',
  '410': 'Gone',
  '411': 'Length Required',
  '412': 'Precondition Failed',
  '413': 'Payload Too Large',
  '414': 'URI Too Long',
  '415': 'Unsupported Media Type',
  '416': 'Range Not Satisfiable',
  '417': 'Expectation Failed',
  '418': &quot;I'm a Teapot&quot;,
  '421': 'Misdirected Request',
  '422': 'Unprocessable Entity',
  '423': 'Locked',
  '424': 'Failed Dependency',
  '425': 'Unordered Collection',
  '426': 'Upgrade Required',
  '428': 'Precondition Required',
  '429': 'Too Many Requests',
  '431': 'Request Header Fields Too Large',
  '451': 'Unavailable For Legal Reasons',
  '500': 'Internal Server Error',
  '501': 'Not Implemented',
  '502': 'Bad Gateway',
  '503': 'Service Unavailable',
  '504': 'Gateway Timeout',
  '505': 'HTTP Version Not Supported',
  '506': 'Variant Also Negotiates',
  '507': 'Insufficient Storage',
  '508': 'Loop Detected',
  '509': 'Bandwidth Limit Exceeded',
  '510': 'Not Extended',
  '511': 'Network Authentication Required'
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[History å¯¹è±¡åŠäº‹ä»¶ç›‘å¬è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/273</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/273</guid>
            <pubDate>Sun, 26 Feb 2023 12:36:17 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-95034fbc69e1d1af.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-95034fbc69e1d1af.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>ç†è®ºä¸Šè¯´ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ URL éƒ½æŒ‡å‘ä¸€ä¸ªå”¯ä¸€çš„èµ„æºã€‚è¿™ä¸ªèµ„æºå¯ä»¥æ˜¯ä¸€ä¸ª HTML é¡µé¢ï¼Œä¸€ä¸ª CSS æ–‡æ¡£ï¼Œä¸€å¹…å›¾åƒç­‰ã€‚åœ¨åœ°å€æ é”®å…¥å®Œæ•´çš„ URL åœ°å€ï¼Œæµè§ˆå™¨å°±ä¼šå°†å¯¹åº”èµ„æºå±•ç¤ºå‡ºæ¥ã€‚</p>
<p>ä¸ºäº†åœ¨å¤šä¸ª URL ä¹‹é—´å¾€è¿”ï¼Œæµè§ˆå™¨å‚å•†å®šä¹‰äº†ä¸€ç§å¯å­˜å‚¨æµè§ˆå™¨ä¼šè¯å†å²ï¼ˆä¸‹ç§°â€œå†å²è®°å½•â€ï¼‰çš„æœºåˆ¶ï¼Œæ¯è®¿é—®æ–°çš„ URL å°±ä¼šåœ¨å†å²è®°å½•ä¸­å¢åŠ ä¸€ä¸ªæ–°çš„å†å²è®°å½•æ¡ç›®ã€‚å½“å‰â€œå†å²æ¡ç›®â€å¯é€šè¿‡ History å¯¹è±¡ï¼ˆå³ <code>window.history</code>ï¼‰è·å–ï¼Œè¯¥å¯¹è±¡åŒ…æ‹¬äº† <code>back()</code>ã€<code>forward()</code>ã€<code>go()</code> ç­‰æ–¹æ³•ã€‚</p>
<p>åœ¨å¾ˆæ—©ä»¥å‰ï¼Œä¸åŒ URL ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œéƒ½æ˜¯éœ€è¦é‡æ–°åŠ è½½èµ„æºçš„ã€‚ç›´åˆ° Ajax çš„å‡ºç°ï¼Œæ‰“ç ´äº†è¿™ç§é™åˆ¶ã€‚Ajax æŠ€æœ¯å…è®¸é€šè¿‡ JavaScript è„šæœ¬å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå°†æ•°æ®è¿”å›å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼Œç„¶åæ ¹æ®å“åº”æ•°æ®æŒ‰éœ€æ“ä½œ DOM ä»¥å®ç°å±€éƒ¨åˆ·æ–°ã€‚è¿™ä¸ªè¿‡ç¨‹é¡µé¢å¹¶ä¸ä¼šé‡æ–°åŠ è½½ï¼Œåªä¼šæ›´æ–° DOM çš„å±€éƒ¨ï¼Œå› æ­¤ URL å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚ä½†æ˜¯ Ajax å±€éƒ¨åˆ·æ–°çš„èƒ½åŠ›ï¼Œä¼¼ä¹ä¸ä¸€ä¸ª URL å¯¹åº”ä¸€ä¸ªèµ„æºç›¸æ‚–ã€‚äºæ˜¯......å°±å‡ºç°äº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ—¢å¯ä»¥å®ç°é¡µé¢å±€éƒ¨åˆ·æ–°ï¼Œä¹Ÿä¼šä¿®æ”¹ URLã€‚</p>
<p>é‚£å°±æ˜¯ URL ä¸­çš„ <code>#</code> æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-text">http://www.example.com/index.html#user
</code></pre>
<p><code>#</code> å·è¡¨ç¤ºç½‘é¡µçš„ä¸€ä¸ªä½ç½®ï¼Œè·Ÿåœ¨ <code>#</code> å·åé¢çš„å­—ç¬¦ä¸²ç§°ä¸ºâ€œé”šâ€ã€‚å½“é”šå‘ç”Ÿå˜åŒ–ï¼Œè‹¥é¡µé¢ä¸­å­˜åœ¨è¿™æ ·ä¸€ä¸ªä½ç½®ï¼ˆå¯é€šè¿‡é”šç‚¹æˆ–æ ‡ç­¾å…ƒç´  <code>id</code> å±æ€§è®¾ç½®ï¼‰ï¼Œæµè§ˆå™¨ä¼šä½¿é¡µé¢è‡ªåŠ¨æ»šåŠ¨è‡³å¯¹åº”ä½ç½®ã€‚è¿™ç§æœºåˆ¶çš„å¥½å¤„æ˜¯ï¼Œä»…ç”¨äºæŒ‡å¯¼æµè§ˆå™¨çš„åŠ¨ä½œï¼Œè€Œå¯¹æœåŠ¡å™¨æ˜¯å®Œå…¨æ— ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚ä¸Šè¿°ç½‘å€ï¼ŒHTTP è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€æ˜¯ï¼š<code>http://www.example.com/index.html</code>ï¼ˆä¸ä¼šåŒ…å« <code>#user</code>ï¼‰ã€‚</p>
<p>ç›¸æ¯” <code>http://www.example.com/index.html/user</code> è¿™ç§å½¢å¼ï¼ŒURL ä¸Šå¸¦ <code>#</code> å·é™¤äº†çœ‹ç€ä¸é¡ºçœ¼ä¹‹å¤–ï¼Œå¯¹äºåˆ†äº« URL æˆ– SEO æ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼ˆå¯¹æ­¤ Google è¿˜æå‡ºäº†ä¸€ç§ä¼˜åŒ– SEO çš„æ–¹æ¡ˆï¼Œå³ URL ä¸­å¸¦ä¸Š <code>&quot;#!&quot;</code>ï¼Œ<a href="http://www.ruanyifeng.com/blog/2011/03/url_hash.html">è¯¦è§</a>ï¼‰ã€‚åæ¥ HTML5 ä¸­æä¾›äº†å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å®ƒåŒæ ·æ˜¯å¯ä»¥ä¿®æ”¹ URL ä¸”ä¸è§¦å‘é¡µé¢é‡è½½ï¼Œè€Œä¸”å¯ä»¥ä¿®æ”¹ URL ä¸­ <code>Origin</code> åé¢çš„ä»»æ„è·¯å¾„ï¼ˆå³ <code>/index.html/user</code>ï¼‰ï¼Œè¿™ç‚¹ <code>#</code> æ¨¡å¼æ˜¯åšä¸åˆ°çš„ã€‚ä»–ä»¬å°†è¿™ç§èƒ½åŠ›å†…ç½®åœ¨ History å¯¹è±¡ä¸‹ï¼ŒåŒ…å« <code>history.pushState()</code>ã€<code>history.replaceState()</code> æ–¹æ³•ã€‚</p>
<p>ä¸Šé¢æåˆ°äº†ä¸€äº›è¯è¯­ï¼Œæœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>
<p><strong>å†å²è®°å½•</strong>
æ˜¯æŒ‡åœ¨æµè§ˆå™¨ä¸­<strong>æ¯ä¸ªæ ‡ç­¾</strong>ï¼ˆçª—å£ï¼‰çš„ä¼šè¯å†å²ï¼ˆä¸‹ç§°â€œ<strong>å†å²è®°å½•</strong>â€ï¼‰ã€‚å®ƒç”±æµè§ˆå™¨æŸä¸ªçº¿ç¨‹ç»´æŠ¤ç€ï¼Œè€Œä¸”æ ‡ç­¾ä¹‹é—´çš„å†å²è®°å½•æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸”æ— æ³•é€šè¿‡ JavaScript è„šæœ¬è¯»å–ã€‚</p>
<p>å½“æ ‡ç­¾å…³é—­æˆ–è€…é€€å‡ºæµè§ˆå™¨ï¼Œä¼šè¯ç»“æŸï¼Œå†å²è®°å½•ä¹Ÿéšä¹‹è¢«é”€æ¯ï¼ˆæ²¡é”™ï¼Œè¿™é‡Œçš„â€œå†å²è®°å½•â€ï¼Œå¹¶ä¸æ˜¯æŒ‡æµè§ˆå™¨åº”ç”¨çš„â€œå†å²è®°å½•â€åŠŸèƒ½ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å†å²æ¡ç›®</strong>
æµè§ˆå™¨æ¯è®¿é—®ä¸€ä¸ª<strong>æ–°çš„ URL</strong>ï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¡<strong>è®°å½•</strong>ï¼ˆä¸‹ç§°â€œ<strong>è®°å½•</strong>â€ï¼‰ï¼Œå¹¶ä¿å­˜è‡³â€œå†å²è®°å½•â€ã€‚è¿™æ¡è®°å½•ï¼Œä»…èƒ½åœ¨å½“å‰é¡µé¢çš„ <code>window.history</code> å¯¹è±¡è¯»å–åˆ°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å½“å‰å†å²è®°å½•é‡Œæœ‰ 3 æ¡ä¸åŒé¡µé¢çš„è®°å½•ï¼ˆå‡è®¾ç”¨æ•°ç»„ <code>[A, B, C]</code> è¡¨ç¤ºï¼ŒçœŸæ­£å¦‚ä½•è¡¨ç¤ºä¸å»æ·±ç©¶ï¼Œéæœ¬æ–‡è®¨è®ºèŒƒå›´ï¼‰ï¼Œè‹¥å½“å‰å¤„äº <code>C</code> é¡µé¢ï¼Œé‚£ä¹ˆé€šè¿‡ <code>window.history</code> è¯»å–åˆ°æ•°æ®ï¼Œæ˜¯æŒ‡ <code>C</code> é¡µé¢çš„è®°å½•ä¿¡æ¯ã€‚è€Œ <code>A</code>ã€<code>B</code> é¡µé¢çš„ä¿¡æ¯æ˜¯è·å–ä¸å¯¹çš„ï¼Œé™¤éåé€€å¹¶åœ¨å¯¹åº”é¡µé¢å†…æ‰§è¡Œè„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>æ–°çš„ URL</strong>
è¯·æ³¨æ„ï¼Œ<strong>è¿™ä¸ªâ€œæ–°â€æ˜¯ç›¸å¯¹çš„</strong>ã€‚ç”±äºä¸‹æ–‡ç»å¸¸æåˆ°ï¼Œå› æ­¤æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ã€‚</p>
<p>å‡è®¾åœ¨ <code>A</code> é¡µé¢è·³è½¬åˆ° <code>B</code> é¡µé¢ï¼Œè¿™ä¸ª <code>B</code> å°±æ˜¯â€œæ–°çš„ URLâ€ã€‚è‹¥åœ¨ <code>B</code> ä¸­ä¹Ÿæœ‰ä¸€ä¸ªé“¾æ¥æŒ‡å‘ <code>A</code> é¡µé¢ï¼Œç‚¹å‡»çš„æ—¶å€™ï¼Œè¿™ä¸ª <code>A</code> ä¹Ÿæ˜¯â€œæ–°çš„ URLâ€ï¼Œå› ä¸ºå®ƒæ˜¯ç›¸è¾ƒäºå½“å‰é¡µé¢ URL æ‰€å¾—å‡ºæ¥çš„ç»“è®ºã€‚å› æ­¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿ 3 æ¡è®°å½•ï¼Œæ‰€ä»¥å†å²è®°å½•å°†ä¼šæ˜¯ <code>[A, B, A]</code>ã€‚</p>
</li>
</ul>
</blockquote>
<p>ä¸‹é¢å°†æŒ‰å†å²é¡ºåºä¸€ä¸€ä»‹ç»...</p>
<h2>äºŒã€URL çš„ # å·</h2>
<p>å…¶å®å‰é¢åˆšæåˆ°ï¼Œ<code>#</code> è¡¨ç¤ºé¡µé¢ä¸­çš„ä¸€ä¸ªä½ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-text">https://github.com/toFrankie/csscomb-mini#usage
</code></pre>
<p>ä¸Šè¿° URL ä¸­ï¼Œ<code>#usage</code> è¡¨ç¤º <a href="https://github.com/toFrankie/csscomb-mini"><code>https://github.com/toFrankie/csscomb-mini</code></a> é¡µé¢çš„ <code>usage</code> ä½ç½®ã€‚</p>
<p>URL ä¸Šè·Ÿåœ¨ <code>#</code> åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œè¢«ç§°ä¸º <strong>Fragment</strong>ï¼ˆ<strong>é”š</strong>ï¼Œæˆ–<strong>ç‰‡æ®µæ ‡è¯†ç¬¦</strong>ï¼‰ï¼Œæ‰€ä»¥æ­¤ URL çš„é”šä¸º <code>usage</code>ã€‚</p>
<h4>1. location.hash å±æ€§</h4>
<p>æ‰“å° <code>window.location</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{
  hash: '#usage'
  host: 'github.com'
  hostname: 'github.com'
  href: 'https://github.com/toFrankie/csscomb-mini#usage'
  origin: 'https://github.com'
  pathname: '/toFrankie/csscomb-mini'
  port: ''
  protocol: 'https:'
  search: ''
}
</code></pre>
<p>å…¶ä¸­ <code>location.hash</code> å€¼ä¸º <code>#usage</code>ï¼Œå®ƒæ˜¯ç”± <code># + Fragment</code> ç»„æˆçš„å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>å¦‚æœ URL ä¸­ä¸å­˜åœ¨ Fragmentï¼Œ<code>location.hash</code> ä¼šè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ˆ<code>''</code>ï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">// 1. https://github.com/toFrankie/csscomb-mini
window.location.hash // &quot;&quot;

// 2. https://github.com/toFrankie/csscomb-mini#
window.location.hash // &quot;&quot;

// 3. https://github.com/toFrankie/csscomb-mini#/
window.location.hash // &quot;#/&quot;

// 4. https://github.com/toFrankie/csscomb-mini#usage
window.location.hash // &quot;#usage&quot;
</code></pre>
<h4>2. ä¿®æ”¹ URL hash å€¼</h4>
<p>ä¿®æ”¹ <code>hash</code> å€¼å°±ä¼šç›´æ¥ä½“ç°åœ¨åœ°å€æ ä¸Šï¼Œå¹¶ä¸”åœ¨å†å²è®°å½•ä¸­ä¼šäº§ç”Ÿä¸€æ¡æ–°è®°å½•ã€‚æ¯”å¦‚ï¼Œæ‰§è¡Œ <code>history.length</code> å¯ä»¥çœ‹åˆ° <code>length</code> çš„å˜åŒ–ã€‚<code>history.length</code> è¡¨ç¤ºå†å²è®°å½•ä¸­çš„è®°å½•ä¸ªæ•°ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å»ä¿®æ”¹ï¼š</p>
<pre><code class="language-js">// 1. ç›´æ¥ç»™è¯¥å±æ€§èµ‹å€¼
window.location.hash = '#usage' // # å·å¯çœç•¥

// 2. ç»™ window.location èµ‹å€¼ï¼Œè¯·æ³¨æ„ # æ˜¯ä¸èƒ½çœç•¥ï¼Œå¦åˆ™ä¸ä»…æ˜¯ä¿®æ”¹ Fragment äº†
window.location = '#usage'
window.location.href = '#usage'

// 3. è¯·æ³¨æ„ï¼Œåªä¿®æ”¹ Fragment éƒ¨åˆ†ï¼Œå¦åˆ™ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚ç±»ä¼¼ history.replaceState ä½œç”¨
window.location.replace('https://github.com/toFrankie/csscomb-mini#/usage')

// 4. é€šè¿‡ &lt;a&gt; æ ‡ç­¾è®¾ç½® href å±æ€§ï¼Œä¸”ä¸èƒ½çœç•¥ # å·
&lt;a href=&quot;#usage&quot;&gt;&lt;/a&gt;
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå¤šæ¬¡è®¾ç½®åŒä¸€ä¸ª Fragment æ—¶ï¼Œä»…é¦–æ¬¡æœ‰æ•ˆï¼Œé‡å¤çš„éƒ¨åˆ†å¯ä»¥ç†è§£ä¸ºæ˜¯æ— æ•ˆçš„ã€‚</p>
</blockquote>
<h4>3. location.hashã€location.href ä¸ location.replace()</h4>
<p>å‰é¢ä¸¤ä¸ªæ–¹æ³•éƒ½<strong>å¯è¯»å¯å†™</strong>ï¼Œå…¶ä¸­ <code>location.hash</code> ç»å¯¹ä¸ä¼šé‡è½½é¡µé¢ã€‚è¿™è·Ÿå®ƒçš„è®¾è®¡åˆè¡·æœ‰å…³ï¼Œå‰é¢æè¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚è€Œ <code>location.href</code> å’Œ <code>location.replace()</code> è‹¥åªæ˜¯ URL çš„ Fragment éƒ¨åˆ†å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé‡è½½é¡µé¢ï¼Œè€Œå…¶ä»–æƒ…å†µæ€»ä¼šé‡è½½é¡µé¢ã€‚</p>
<p>é€šè¿‡ <code>location.href</code>ã€<code>location.hash</code> æ–¹å¼å»â€œä¿®æ”¹â€ URLï¼Œå†å²è®°å½•éƒ½ä¼šæ–°å¢ä¸€æ¡æ–°è®°å½•ã€‚ç”±äº <code>history.length</code> æ˜¯å†å²è®°å½•æ•°é‡çš„ä½“ç°ï¼Œå› æ­¤ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚è€Œ <code>location.replace()</code> åˆ™æ˜¯ç”¨æ–°è®°å½•è¦†ç›–å½“å‰è®°å½•ï¼Œå› æ­¤ <code>history.length</code> ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>
<p>ä»¥ä¸Šä¸‰ç§æ–¹å¼ï¼ˆåŒ…æ‹¬ <code>&lt;a&gt;</code> æ ‡ç­¾å½¢å¼ï¼‰å»ä¿®æ”¹ URLï¼Œ<strong>åªæœ‰</strong>åœ¨æ–°æ—§ URL ä¸ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ–°å¢ä¸€æ¡è®°å½•ã€‚</p>
</li>
<li>
<p>å…¶ä¸­ <code>location.href</code> ä¸ <code>location.replace()</code> æ–¹æ³•ï¼Œè‹¥ URL ä¸­åŒ…å« Fragment éƒ¨åˆ†ï¼Œä¸”æ–°æ—§ URL ä¹‹é—´ä»… Fragment éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸ä¼šé‡è½½é¡µé¢ã€‚</p>
</li>
<li>
<p>ä¸ç®¡æ–°æ—§ URL æ˜¯å¦ä¸€è‡´ï¼ˆURL ä¸å« Fragment æ—¶ï¼‰ï¼Œ<code>location.href</code> æ€»ä¼šé‡è½½é¡µé¢ã€‚</p>
</li>
<li>
<p>å½“æ–°æ—§ URL ç›¸åŒæ—¶ï¼Œ<code>location.href</code> ä½œç”¨ç­‰åŒäº <code>location.reload()</code>ã€<code>history.go(0)</code>ã€‚è™½è¯´æ˜¯é‡æ–°åŠ è½½é¡µé¢ï¼Œä½†å¤šæ•°æ˜¯ä»æµè§ˆå™¨ç¼“å­˜ä¸­åŠ è½½ï¼Œé™¤éé¡µé¢ç¼“å­˜å¤±æ•ˆæˆ–è¿‡æœŸäº†ã€‚</p>
</li>
<li>
<p>å¯¹äº <code>location.href</code> æˆ‘ä»¬é€šå¸¸ä¼šèµ‹äºˆä¸€ä¸ªå®Œæ•´çš„ URL åœ°å€ï¼Œä½†å®ƒæ˜¯æ”¯æŒâ€œç›¸å¯¹è·¯å¾„â€å½¢å¼çš„ URL çš„ã€‚ï¼ˆè¯¦è§ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/What_is_a_URL#%E7%BB%9D%E5%AF%B9url%E5%92%8C%E7%9B%B8%E5%AF%B9url">ç»å¯¹ URL å’Œç›¸å¯¹ URL</a>ï¼‰</p>
</li>
<li>
<p>ä¸Šé¢æ˜¯æŒ‡å†™æ“ä½œï¼Œå¹¶ä¸æ˜¯è¯»æ“ä½œå“ˆã€‚</p>
</li>
</ul>
</blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼š<strong>è‹¥æ–°æ—§ URL ä¹‹é—´ä»…ä»… Fragment éƒ¨åˆ†å‘ç”Ÿæ”¹å˜ï¼Œä»¥ä¸Šå‡ ç§æ–¹æ³•éƒ½ä¼šåœ¨å†å²è®°å½•æ–°å¢ä¸€æ¡è®°å½•ï¼Œä¸”ä¸ä¼šé‡è½½é¡µé¢ã€‚</strong></p>
<h4>4. Fragment çš„ä½ç½®</h4>
<p>å‰é¢æåˆ°ï¼Œ<code># + Fragment</code> è¡¨ç¤ºç½‘é¡µçš„ä¸€ä¸ªä½ç½®ï¼Œç”¨äºæŒ‡å¯¼æµè§ˆå™¨çš„è¡Œä¸ºã€‚å½“ Fragment çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œé¡µé¢ä¼šæ»šåŠ¨è‡³å¯¹åº”ä½ç½®ã€‚å½“ç„¶ï¼Œå‰ææ˜¯è¿™ä¸ªä½ç½®å­˜åœ¨äºé¡µé¢ä¸­ï¼Œå¦åˆ™ä¹Ÿæ˜¯ä¸ä¼šå‘ç”Ÿæ»šåŠ¨çš„ã€‚</p>
<p><strong>é‚£ä¹ˆè¿™ä¸ªâ€œä½ç½®â€ï¼Œå¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ</strong></p>
<p>è®²çœŸçš„ï¼Œå¤©å¤©ç”¨æ¡†æ¶å†™é¡µé¢ï¼Œæœ€åŸå§‹çš„åè€Œå¿˜äº†ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<blockquote>
<ul>
<li>ä½¿ç”¨é”šç‚¹ï¼Œå³åˆ©ç”¨ <code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>name</code> å±æ€§ï¼ˆä¸æ¨èï¼‰</li>
<li>ä½¿ç”¨æ ‡ç­¾ <code>id</code> å±æ€§ï¼ˆæ¨èï¼‰</li>
</ul>
</blockquote>
<p><strong>è¯·æ³¨æ„ï¼Œ<code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>name</code> å±æ€§åœ¨ HTML5 ä¸­<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#attr-name">å·²åºŸå¼ƒ</a>ï¼Œè¯·ä½¿ç”¨ HTML å…¨å±€å±æ€§ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes"><code>id</code></a> æ¥ä»£æ›¿</strong>ã€‚åè€…åœ¨æ•´ä¸ª DOM ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¸¸ç”¨äºæŸ¥è¯¢èŠ‚ç‚¹ã€æ ·å¼é€‰æ‹©å™¨ã€ä½œä¸ºé¡µé¢ Fragment çš„ä½ç½®ã€‚</p>
<pre><code class="language-html">&lt;!-- 1. é”šç‚¹ --&gt;
&lt;a name=&quot;usage&quot;&gt;&lt;/a&gt;

&lt;!-- 2. è®¾ç½® id å±æ€§ --&gt;
&lt;div id=&quot;usage&quot;&gt;&lt;/div&gt;

&lt;!-- è¿™ç§ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†è¿™ç§ä¸ç§°ä¸ºé”šç‚¹ --&gt;
&lt;a id=&quot;usage&quot;&gt;&lt;/a&gt;
</code></pre>
<p>å†çœ‹ä¸€ä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;!-- 1. åœ¨ç‚¹å‡» a æ ‡ç­¾æ—¶ï¼Œä¼šä¿®æ”¹ hash å±æ€§ä¸º #usageï¼Œä½†ä¸ä¼šæ»šåŠ¨è‡³ a æ ‡ç­¾ --&gt;
&lt;a href=&quot;#usage&quot;&gt;&lt;/a&gt;

&lt;!-- 2. ä»¥ä¸‹æƒ…å†µï¼Œé™¤äº†ä¿®æ”¹ hash å€¼ï¼Œé¡µé¢ä¹Ÿä¼šéšä¹‹æ»šåŠ¨è‡³ a æ ‡ç­¾ --&gt;
&lt;a name=&quot;usage&quot; href=&quot;#usage&quot;&gt;&lt;/a&gt;
&lt;a id=&quot;usage&quot; href=&quot;#usage&quot;&gt;&lt;/a&gt;
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œä½œè€…æœ¬äººä¼šç»å¸¸æ··æ·†ï¼ˆå¸Œæœ›ä½ ä»¬ä¸ä¼šï¼‰ï¼Œé¡ºé“æä¸€ä¸‹ã€‚ç®€å•æ¥è¯´ï¼Œ<code>href=&quot;usage&quot;</code> æ˜¯ä¸ºäº†ä¿®æ”¹ URLï¼Œå½“ URL çš„ <code>hash</code> å˜æˆ <code>#usage</code>ï¼Œæµè§ˆå™¨å°±ä¼šæ»šåŠ¨è‡³å¯¹åº”ä½ç½®ï¼ˆå³é”šç‚¹ä¸º <code>usage</code> æˆ– <code>id</code> å±æ€§ä¸º <code>usage</code> çš„å…ƒç´ æ‰€åœ¨ä½ç½®ï¼‰ã€‚</p>
<h4>5. hashchange äº‹ä»¶</h4>
<p>è‹¥åœ¨å…¨å±€æ³¨å†Œäº† <code>hashchange</code> äº‹ä»¶ç›‘å¬å™¨ï¼Œåªè¦ URL çš„ Fragment å‘ç”Ÿå˜åŒ–ï¼Œå°†ä¼šè¢«äº‹ä»¶å¤„ç†ç¨‹åºæ•è·åˆ°ï¼Œäº‹ä»¶å¯¹è±¡åŒ…å«äº† <code>newURL</code> å’Œ <code>oldURL</code> ç­‰è¯¥äº‹ä»¶ç‰¹æœ‰çš„å±æ€§ã€‚å…¶ä½™çš„ï¼Œåœ¨ä¸‹æ–‡å¯¹æ¯” <code>popstate</code> äº‹ä»¶æ—¶å†è¯¦ç»†ä»‹ç»ã€‚</p>
<h2>ä¸‰ã€History å¯¹è±¡</h2>
<p>å‰é¢æåˆ°ï¼Œæ¯ä¸ªæ ‡ç­¾éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å†å²è®°å½•ï¼Œé‡Œé¢ç»´æŠ¤ç€ä¸€æ¡æˆ–å¤šæ¡è®°å½•ã€‚æ¯æ¡è®°å½•ä¿å­˜äº†å¯¹åº” URL çš„ä¸€äº›çŠ¶æ€ï¼Œä»…èƒ½åœ¨å½“å‰é¡µé¢çš„ <code>window.history</code> å¯¹è±¡è¯»å–åˆ°ã€‚ï¼ˆè¿™é‡Œä¸å†èµ˜è¿°ï¼Œè‹¥æ¦‚å¿µæœ‰æ··æ·†çš„ï¼Œè¯·å›åˆ°å¼€å¤´å†çœ‹ä¸€éï¼‰</p>
<p>åœ¨ HTML5 ä¹‹å‰ï¼ŒHistory å¯¹è±¡ä¸»è¦åŒ…å«ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š</p>
<blockquote>
<ul>
<li><code>history.length</code></li>
<li><code>history.back()</code></li>
<li><code>history.forward()</code></li>
<li><code>history.go()</code></li>
</ul>
</blockquote>
<h4>1. history.length</h4>
<p><strong>åªè¯»</strong>ï¼Œè¯¥å±æ€§è¿”å›å½“å‰ä¼šè¯çš„å†å²è®°å½•ä¸ªæ•°ã€‚ç”±äº <code>history.length</code> æ˜¯å†å²è®°å½•æ•°é‡çš„ä½“ç°ï¼Œé‚£ä¹ˆå½“å†å²è®°å½•å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒæ‰ä¼šéšä¹‹æ”¹å˜ã€‚</p>
<p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>
<p>è‹¥â€œä¸»åŠ¨â€æ‰“å¼€æµè§ˆå™¨çš„æ–°æ ‡ç­¾ï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¡è®°å½•ï¼Œå°½ç®¡å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç©ºæ ‡ç­¾é¡µï¼Œå³ <code>history.length</code> ä¸º <code>1</code>ã€‚å½“é”®å…¥æ–° URL å¹¶å›è½¦ï¼Œæ­¤æ—¶ <code>history.length</code> å°±ä¼šå˜ä¸º <code>2</code>ã€‚</p>
</li>
<li>
<p>è‹¥æµè§ˆå™¨çš„æ ‡ç­¾æ˜¯é€šè¿‡ç±»ä¼¼ <code>&lt;a target=&quot;_blank&quot;&gt;</code> å½¢å¼è‡ªåŠ¨åˆ›å»ºçš„è¯ï¼Œæ–°æ ‡ç­¾çš„ <code>history.length</code> æ˜¯ <code>1</code>ï¼ˆä¸æ˜¯ <code>2</code> å“¦ï¼‰ã€‚æ­¤æ—¶åŸæ ‡ç­¾çš„å†å²è®°å½•ä¸ä¼šå—åˆ°å½±å“ï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿™ç§æƒ…å†µå°±ç±»ä¼¼äºåœ¨å¾®ä¿¡é‡Œæ‰“å¼€ä¸€ä¸ªé“¾æ¥ï¼Œè¿›å…¥é¡µé¢çš„ <code>history.length</code> ä¸º <code>1</code>ã€‚</p>
</li>
<li>
<p>ä¸ç®¡ä»¥ä»»ä½•æ–¹å¼åˆ·æ–°é¡µé¢ï¼Œå†å²è®°å½•å’Œ <code>history.length</code> éƒ½ä¸ä¼šæ”¹å˜ã€‚</p>
</li>
<li>
<p>åœ¨åœ°å€æ é”®å…¥æ–°çš„ URLï¼Œå†å²è®°å½•ä¼šå¢åŠ  <code>1</code>ã€‚</p>
</li>
<li>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè‹¥æ–°æ—§ URL ç›¸åŒï¼Œæ­¤æ—¶å†å²è®°å½•ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œ<code>history.length</code> ä¹Ÿä¸ä¼šã€‚ç‰¹æ®Šæƒ…å†µæ˜¯ï¼Œ<code>history.pushState()</code> å’Œ <code>history.replaceState()</code> æ–¹æ³•æ€»ä¼šäº§ç”Ÿä¸€æ¡æ–°è®°å½•ï¼Œå³ä½¿æ–°æ—§ URL ç›¸åŒä¹Ÿä¼šã€‚</p>
</li>
<li>
<p>ç‚¹å‡»æµè§ˆå™¨å‰è¿›/åé€€/åˆ·æ–°æŒ‰é’®ï¼Œæˆ–è€…è°ƒç”¨ <code>history.back()</code>ã€<code>history.forward()</code>ã€<code>history.go()</code> æ–¹æ³•ï¼Œä¸ä¼šä½¿å†å²è®°å½•å’Œ <code>history.length</code> å€¼å‘ç”Ÿå˜åŒ–ã€‚è¿™äº›æ“ä½œåªä¼šé€€å›/å‰å¾€å†å²è®°å½•ä¸­æŸä¸ªå…·ä½“çš„é¡µé¢ã€‚ä½†ä¼šè§¦å‘ <code>popstate</code> æˆ– <code>hashchange</code> äº‹ä»¶ï¼ˆè‹¥æœ‰æ³¨å†Œçš„è¯ï¼‰ã€‚</p>
</li>
</ul>
</blockquote>
<p>è¿™é‡Œæè¿°çš„åœºæ™¯å¾ˆå¤šï¼ŒåŸå› æ˜¯æ­¤å‰å¯¹æŸäº›åœºæ™¯æ²¡æœ‰å®Œå…¨å¼„æ¸…æ¥šï¼ˆå¦‚æœä½ æ²¡æœ‰è¿™ä¸ªå›°æ‰°ï¼Œç®€å•ç•¥è¿‡å³å¯ï¼‰ã€‚</p>
<p>æ—¢ç„¶ <code>history.length</code> æ˜¯åªè¯»çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬æ— æ³•â€œç›´æ¥â€æ“ä½œå†å²è®°å½•ï¼ˆæ¯”å¦‚åˆ é™¤æŸä¸ªå†å²è®°å½•ï¼‰ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¹Ÿè®¿é—®ä¸åˆ°ã€‚</p>
<h4>2. history.back()</h4>
<p>å®ƒçš„ä½œç”¨åŒæµè§ˆå™¨çš„<strong>åé€€</strong>æŒ‰é’®ï¼Œé€šä¿—åœ°è®²å°±æ˜¯åé€€è‡³ä¸Šä¸€é¡µã€‚ç­‰ä»·äº <code>history.go(-1)</code>ã€‚</p>
<blockquote>
<p>è‹¥å½“å‰é¡µé¢æ˜¯å†å²è®°å½•çš„ç¬¬ä¸€ä¸ªé¡µæ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚æ­¤æ—¶æµè§ˆå™¨åé€€æŒ‰é’®ä¹Ÿæ˜¯ç½®ç°çš„ï¼Œæ˜¯ä¸å¯æ“ä½œçš„ã€‚æ¢å¥è¯è¯´ï¼Œæ­¤æ–¹æ³•ä»…åœ¨ <code>history.length &gt; 1</code> æ—¶æœ‰æ•ˆã€‚</p>
</blockquote>
<h4>3. history.forward()</h4>
<p>å®ƒçš„ä½œç”¨åŒæµè§ˆå™¨çš„<strong>å‰è¿›</strong>æŒ‰é’®ï¼Œé€šä¿—åœ°è®²å°±æ˜¯å‰å¾€ä¸‹ä¸€é¡µã€‚ç­‰ä»·äº <code>history.go(1)</code>ã€‚</p>
<blockquote>
<p>è‹¥å½“å‰é¡µé¢æ˜¯å†å²è®°å½•é‡Œæœ€é¡¶ç«¯çš„é¡µé¢æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚æ­¤æ—¶æµè§ˆå™¨å‰è¿›æŒ‰é’®ä¹Ÿæ˜¯ç½®ç°çš„ï¼Œæ˜¯ä¸å¯æ“ä½œçš„ã€‚</p>
</blockquote>
<h4>4. history.go()</h4>
<p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>delta</code> å‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œé€šè¿‡å½“å‰é¡µé¢çš„ç›¸å¯¹ä½ç½®åŠ è½½æŸä¸ªé¡µé¢ã€‚</p>
<pre><code class="language-js">window.history.go(delta)
</code></pre>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå‚æ•°å¯ç¼ºçœã€ä¸º <code>0</code>ã€ä¸ºè´Ÿæ•´æ•°ï¼ˆè¡¨ç¤ºåé€€ï¼‰ã€æ­£æ•´æ•°ï¼ˆè¡¨ç¤ºå‰è¿›ï¼‰ã€‚</p>
<ul>
<li>
<p>æ¯”å¦‚è¯´ï¼Œ<code>history.go(-2)</code> ä¼šå†å²è®°å½•é‡Œåé€€ä¸¤ä¸ªé¡µé¢ã€‚ç›¸åº”åœ°ï¼Œ<code>history.go(2)</code> ä¼šå‰è¿›ä¸¤ä¸ªé¡µé¢ã€‚</p>
</li>
<li>
<p>å…¶ä¸­ <code>history.go(1)</code> ä½œç”¨åŒ <code>history.forward()</code>ï¼Œ<code>history.go(-1)</code> ä½œç”¨åŒ <code>history.back()</code>ã€‚</p>
</li>
<li>
<p>è‹¥ç¼ºçœ <code>delta</code> æˆ–è€… <code>delta</code> ä¸º <code>0</code>ï¼Œä¼š<strong>é‡æ–°åŠ è½½</strong>å½“å‰é¡µé¢ã€‚æ­¤æ—¶ä½œç”¨åŒ <code>location.reload()</code> æˆ–è€…æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®ã€‚</p>
</li>
<li>
<p>è‹¥ <code>delta</code> æ•°å€¼éƒ¨åˆ†è¶…å‡ºäº†å†å²è®°å½•çš„èŒƒå›´ï¼Œä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚æ—¢ä¸ä¼šåé€€è‡³å†å²è®°å½•çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œä¹Ÿä¸ä¼šå‰å¾€å†å²è®°å½•é‡Œæœ€é¡¶ç«¯çš„é¡µé¢ã€‚å®ƒä¼šé»˜é»˜åœ°å¤±è´¥ï¼Œä¸”ä¸ä¼šæŠ¥é”™ã€‚å‡è®¾å†å²è®°å½•åªæœ‰ 5 æ¡ï¼Œç„¶åä½ è¯•å›¾åé€€/å‰è¿› 10 ä¸ªé¡µé¢ï¼Œè¿™å°±å±äºè¶…å‡ºèŒƒå›´ã€‚</p>
</li>
<li>
<p>è‹¥ <code>delta</code> ä¸æ˜¯ <code>Number</code> ç±»å‹ï¼Œå†…éƒ¨å…ˆè¿›è¡Œéšå¼ç±»å‹è½¬æ¢æˆå¯¹åº”çš„ <code>Number</code> å€¼ï¼Œå†æ‰§è¡Œ <code>go()</code> æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œ<code>history.go(true)</code> ç›¸å½“äº <code>history.go(1)</code>ï¼Œ<code>history.go(NaN)</code> ç›¸å½“äº <code>history.go(0)</code>ã€‚</p>
</li>
</ul>
<h4>5. å°ç»“</h4>
<p>å°± <code>back()</code>ã€<code>forward()</code>ã€<code>go()</code> ä¸‰ä¸ªæ–¹æ³•ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>
<p>ä»…è°ƒç”¨ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•ï¼Œä¸ä¼šä½¿å¾—å†å²è®°å½•æˆ– <code>history.length</code> å‘ç”Ÿæ”¹å˜ã€‚</p>
</li>
<li>
<p>è°ƒç”¨ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•ï¼Œé€šå¸¸æ˜¯ä»æµè§ˆå™¨ç¼“å­˜ä¸­åŠ è½½é¡µé¢ã€‚åœ¨ Network é€‰é¡¹å¡ä¸­å¾€å¾€å¯ä»¥çœ‹åˆ°ç±»ä¼¼ <code>from disk cache</code> çš„å­—æ ·ã€‚</p>
</li>
<li>
<p>å½“è¶…å‡ºäº†å½“å‰æ ‡ç­¾çš„å†å²è®°å½•èŒƒå›´ï¼Œè°ƒç”¨ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•éƒ½ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œé»˜é»˜åœ°å¤±è´¥ä¸”ä¸æŠ¥é”™ã€‚</p>
</li>
<li>
<p>è¯·æ³¨æ„ï¼Œè‹¥åé€€/å‰è¿›æ—¶ï¼Œåªæ˜¯é”šç‚¹å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯ä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ã€‚</p>
</li>
</ul>
</blockquote>
<h2>å››ã€HTML5 History API</h2>
<p>History API ä½œä¸º HTML5 çš„æ–°ç‰¹æ€§ä¹‹ä¸€ï¼Œè§£å†³äº† Fragment çš„ä¸€äº›ç—›ç‚¹ï¼ŒåŒ…æ‹¬ URL åˆ†äº«ï¼ŒSEO ä¼˜åŒ–ç­‰éƒ½å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ã€‚è¿™äº›æ–°ç‰¹æ€§éƒ½å†…ç½®äº History å¯¹è±¡ä¹‹ä¸­ï¼š</p>
<blockquote>
<ul>
<li><code>history.state</code></li>
<li><code>history.scrollRestoration</code></li>
<li><code>history.pushState()</code></li>
<li><code>history.replaceState()</code></li>
</ul>
</blockquote>
<h4>1. history.state</h4>
<p><strong>åªè¯»</strong>ï¼Œè¯¥å±æ€§è¿”å›å½“å‰é¡µé¢çš„çŠ¶æ€å€¼ã€‚</p>
<pre><code class="language-js">const currentState = history.state
</code></pre>
<p>åªæœ‰é€šè¿‡ <code>pushState()</code> å’Œ <code>replaceState()</code> æ–¹æ³•äº§ç”Ÿçš„å†å²è®°å½•ï¼Œè¿™ä¸ªå±æ€§æ‰ä¼šæœ‰ç›¸åº”çš„å€¼ï¼Œå¦åˆ™ä¸º <code>null</code>ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œ<code>history.state</code> çš„è¿”å›å€¼æ˜¯ä¸€ä»½<strong>æ‹·è´å€¼</strong>ã€‚</p>
</blockquote>
<h4>2. history.scrollRestoration</h4>
<p><strong>å¯è¯»å†™</strong>ï¼Œè¯¥å±æ€§å…è®¸ Web åº”ç”¨ç¨‹åºåœ¨å†å²å¯¼èˆªä¸Šæ˜¾å¼åœ°è®¾ç½®é»˜è®¤æ»šåŠ¨æ¢å¤è¡Œä¸ºã€‚æ­¤å±æ€§å¯ä»¥æ˜¯è‡ªåŠ¨çš„ï¼ˆ<code>auto</code>ï¼‰æˆ–è€…æ‰‹åŠ¨çš„ï¼ˆ<code>manual</code>ï¼‰ã€‚</p>
<h4>3. history.pushState()</h4>
<p>åœ¨å½“å‰ä½ç½®ï¼Œ<strong>æ€»ä¼š</strong>äº§ç”Ÿä¸€æ¡æ–°çš„è®°å½•ï¼Œå¹¶ä¿å­˜åœ¨å†å²è®°å½•é‡Œé¢ï¼Œè€Œä¸” <code>history.length</code> ä¹Ÿä¼šå¢åŠ ã€‚è‹¥æ–°æ—§ URL ä¸ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼´éšç€ URL çš„å˜åŒ–ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå®ƒå¹¶ä¸ä¼šé‡è½½é¡µé¢ã€‚åŒæ ·çš„è¿˜æœ‰ <code>history.pushState()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<p>ä¼ªä»£ç ï¼š</p>
<pre><code class="language-js">// å‡è®¾å†å²è®°å½•ï¼ˆç§°ä¸º historiesï¼‰æœ‰ 5 ä¸ªé¡µé¢ï¼Œå½“å‰å¤„äºæœ€åä¸€ä¸ªé¡µé¢ï¼Œå³ 5 ä½ç½®ã€‚
const histories = [1, 2, 3, 4, 5]

// è‹¥åé€€ 2 é¡µ
history.go(-2) // æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„é¡µé¢å¤„äºå†å²è®°å½•ä¸­çš„ 3 ä½ç½®ã€‚

// æ’å…¥ä¸€ä¸ªæ–°è®°å½•ï¼Œå‡è®¾æ–°è®°å½•ç§°ä¸º 6
history.pushState(
  { state: 'new' },      // é€šå¸¸æ˜¯å¯¹è±¡ï¼Œå¯é€šè¿‡ history.state è·å–
  'custom title',        // å‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šå¿½ç•¥æ­¤å‚æ•°ï¼Œæ‰€ä»¥æ˜¯æ²¡ç”¨çš„
  'https://xxx.com'      // è¯¥ URL å¿…é¡»è·Ÿå½“å‰ç½‘é¡µæ˜¯åŒæºçš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
)

// æ‰§è¡Œ pushState() æ–¹æ³•åï¼Œä¸ä¼šåŠ è½½é¡µé¢
window.location.href     // &quot;https://xxx.com&quot;
window.document.URL      // &quot;https://xxx.com&quot;
window.document.title    // è¿™è¿˜æ˜¯åŸæ¥çš„æ ‡é¢˜ï¼Œè€Œä¸æ˜¯ &quot;custom title&quot;
window.history.state     // { state: 'new' }
window.history.length    // 4
histories                // [1, 2, 3, 6]
</code></pre>
<p><strong>è¯­æ³•</strong></p>
<pre><code class="language-js">history.pushState(state, title[, url])
</code></pre>
<ul>
<li>
<p><code>state</code> - å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œé€šå¸¸ä¸ºï¼ˆå¯åºåˆ—åŒ–ï¼‰å¯¹è±¡ã€‚å®ƒå¯ä»¥é€šè¿‡ <code>history.state</code> è·å–åˆ°ï¼Œæˆ–è€…åœ¨ <code>popstate</code> äº‹ä»¶çš„äº‹ä»¶å¯¹è±¡ä¸­ä½“ç°ã€‚</p>
</li>
<li>
<p><code>title</code> - è¯·å¿½è§†è¯¥å‚æ•°çš„ä½œç”¨ï¼Œå®ƒå‡ ä¹è¢«æ‰€æœ‰æµè§ˆå™¨æ‰€å¿½ç•¥ï¼Œä½†ä¸å¾—ä¸ä¼ ã€‚é€šå¸¸ï¼Œä¼šä¼ é€’ <code>''</code>ã€<code>null</code> æˆ– <code>undefined</code>ã€‚</p>
</li>
<li>
<p><code>url</code> - ï¼ˆå¯é€‰ï¼‰æ–° URLï¼Œå®ƒæœ€ç»ˆä½“ç°åœ¨åœ°å€æ çš„ URL ä¸Šã€‚è¯·æ³¨æ„ï¼Œæ–° URL ä¸å½“å‰é¡µé¢ URL å¿…é¡»æ˜¯åŒæºçš„ï¼ˆå³ <code>location.origin</code> ç›¸åŒï¼‰ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
</li>
</ul>
<p><strong>æ³¨æ„ç‚¹</strong></p>
<p>å‚æ•° <code>state</code> æ˜¯å¯åºåˆ—åŒ–å¯¹è±¡ï¼Œæ€ä¹ˆç†è§£ï¼Ÿ</p>
<p>ä¸ªäººçŒœæµ‹æ˜¯é‚£äº›å¯ä½œç”¨åŸŸ <code>JSON.stringify()</code> æ–¹æ³•çš„åŸå§‹å€¼æˆ–å¼•ç”¨å€¼ï¼Œå…·ä½“æ²¡å»æ·±ç©¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢è¿™ä¸ªå°†ä¼šæŠ›å‡ºé”™è¯¯ï¼š</p>
<pre><code class="language-js">history.pushState(
  { fn: function () {} }, 
  '', 
  location.href + 'abc'
)
// DOMException: Failed to execute 'pushState' on 'History': 
// function() {} could not be cloned.
</code></pre>
<p>è¾ƒä¸ºå†·é—¨çš„ä¸œè¥¿ï¼Œå‚æ•° <code>url</code> ä¹Ÿæ”¯æŒ <a href="https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/What_is_a_URL#%E7%BB%9D%E5%AF%B9url%E5%92%8C%E7%9B%B8%E5%AF%B9url">ç»å¯¹ URL å’Œç›¸å¯¹ URL</a>ã€‚ä¸¾äº›ä¾‹å­ï¼š</p>
<pre><code class="language-js">// å‡è®¾å½“å‰ URL å¦‚ä¸‹ï¼Œå®ƒçš„ Origin æ˜¯ https://developer.mozilla.org
// https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState

// 1ï¸âƒ£ å®Œæ•´ç½‘ç«™ï¼Œå¯ç†è§£ä¸ºç»å¯¹è·¯å¾„ï¼Œå°†ä¼šå˜æˆï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript
history.pushState({}, '', 'https://developer.mozilla.org/zh-CN/docs/Web/JavaScript')

// 2ï¸âƒ£ å« / å¯ç†è§£ä¸ºç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºå½“å‰ Originï¼Œå°†ä¼šå˜æˆ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript
history.pushState({}, '', '/zh-CN/docs/Web/JavaScript')

// 3ï¸âƒ£ è‹¥ä¸º ../xxx å½¢å¼ï¼Œç›¸å¯¹äºå½“å‰ URLï¼Œå°†ä¼šå˜æˆ https://developer.mozilla.org/zh-CN/docs/Web/API/History/go
history.pushState({}, '', '../History/go')

// 4ï¸âƒ£ è‹¥ä¸ºå­—ç¬¦ä¸²ï¼Œå°†ä¼šå˜æˆ https://developer.mozilla.org/zh-CN/docs/Web/API/History/hhh
history.pushState({}, '', 'hhh')
</code></pre>
<p>å¦å¤–ï¼Œä½¿ç”¨ <code>history.pushState()</code> å¯ä»¥æ”¹å˜ <code>referrer</code>ã€‚</p>
<h4>4. history.replaceState()</h4>
<p>å‚æ•°çº¦å®šä¸ <code>pushState()</code> å®Œå…¨ä¸€è‡´ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">history.replaceState(stateObj, title[, url])
</code></pre>
<p><code>replaceState()</code> ä¹Ÿæ€»ä¼šäº§ç”Ÿä¸€æ¡æ–°è®°å½•ï¼Œå¹¶ç”¨æ–°è®°å½•<strong>æ›¿æ¢</strong>æ‰å½“å‰é¡µé¢å¯¹åº”çš„å†å²è®°å½•ã€‚</p>
<p>ä¼ªä»£ç ...</p>
<pre><code class="language-js">const histories = [1, 2, 3, 4, 5] // å½“å‰å¤„äº 5 ä½ç½®

history.replaceState({}, '', 'new-url') // åˆ›å»ºä¸€ä¸ªæ–°è®°å½•ï¼Œå‡è®¾ç§°ä¸º 6

// æ–°è®°å½• 6 ä¼šæ›¿æ¢è®°å½• 5
histories // å†å²è®°å½•ï¼Œå°†ä¼šå˜ä¸º [1, 2, 3, 4, 6]
history.length // 5ï¼Œæœªå‘ç”Ÿå˜åŒ–
</code></pre>
<h4>5. pushState ä¸ replaceState åŒºåˆ«</h4>
<p>è¿˜æ˜¯ä¼ªä»£ç å“ˆï¼š</p>
<pre><code class="language-js">// å‡è®¾å†å²è®°å½•é‡Œï¼Œæœ‰ 5 æ¡è®°å½•ï¼Œå¹¶å¤„äºå†å²è®°å½•çš„é¡¶ç«¯ï¼Œå³ç¬¬äº”ä¸ªä½ç½®
const histories = [1, 2, 3, 4, 5]

// åé€€ 2 ä¸ªé¡µé¢ï¼Œå³å½“å‰å¤„äºç¬¬ä¸‰ä¸ªä½ç½®
history.go(-2)

// ä½¿ç”¨ replaceState äº§ç”Ÿä¸€æ¡æ–°è®°å½•ï¼ˆå‡è®¾ç§°ä¸º 6ï¼‰ï¼Œ
// å®ƒçš„ä½œç”¨æ˜¯ç”¨æ–°è®°å½•æ›¿æ¢å½“å‰è®°å½•ï¼Œå› æ­¤è®°å½• 3 è¢«æ–°è®°å½• 6 æ‰€æ›¿æ¢
// ä½†ä»å¤„äºå†å²è®°å½•çš„ç¬¬ä¸‰ä¸ªä½ç½®
history.replace('6', '', 'new-url-6')
histories // [1, 2, 6, 4, 5]
history.length // 5

// ä½¿ç”¨ pushState äº§ç”Ÿä¸€æ¡æ–°è®°å½•ï¼ˆå‡è®¾ç§°ä¸º 7ï¼‰ï¼Œ
// å®ƒçš„ä½œç”¨æ˜¯åœ¨å½“å‰è®°å½•åé¢æ·»åŠ ä¸€æ¡æ–°è®°å½•ï¼Œ
// å®ƒä¼šåˆ é™¤å½“å‰è®°å½•åé¢çš„æ‰€æœ‰è®°å½•ï¼Œç„¶åå†å¾€åè¿½åŠ ä¸€æ¡ï¼Œ
// åŒæ—¶ï¼Œå®ƒçš„ä½ç½®ä¹Ÿä¼šå‰å¾€è‡³å†å²è®°å½•é¡¶ç«¯ï¼Œå³ç¬¬å››ä¸ªä½ç½®ã€‚
history.replace('7', '', 'new-url-7')
histories // [1, 2, 6, 7]
history.length // 4
</code></pre>
<p>å¦‚æœç”¨ <code>Array.prototype.splice()</code> æ¥ç±»æ¯”çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-js">const arr = [1, 2, 3, 4, 5]

// pushState ç±»ä¼¼äº
arr.splice(curIndex + 1, 1000, newItem)

// replaceState ç±»ä¼¼äº
arr.splice(curIndex, 1, newItem)

// æ³¨é‡Šï¼š
// arr è¡¨ç¤ºå†å²è®°å½•
// curIndex è¡¨ç¤ºå½“å‰è®°å½•çš„ä½ç½®ï¼Œ
// 1000 åªæ˜¯ä¸ºäº†è¡¨è¾¾åˆ é™¤å®Œ curIndex + 1 åé¢çš„æ‰€æœ‰é¡¹ï¼Œå¯ç”¨ arr.length ç­‰æ›¿ä»£
// newItem è¡¨ç¤ºæ–°è®°å½•
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œ<code>pushState()</code> å’Œ <code>replaceState()</code> åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>ä¸¤è€…éƒ½ä¼šäº§ç”Ÿæ–°çš„è®°å½•ã€‚</li>
<li>å‰è€…ä¼šå…ˆç§»é™¤å½“å‰è®°å½•åé¢çš„æ‰€æœ‰è®°å½•ï¼Œå¹¶å°†æ–°è®°å½•è¿½åŠ åˆ°å†å²è®°å½•é¡¶ç«¯ã€‚è€Œåè€…ä»…ä¼šç”¨æ–°è®°å½•æ›¿æ¢å½“å‰è®°å½•ï¼Œåé¢çš„è®°å½•å¹¶ä¸å—å½±å“ï¼ˆè‹¥æœ‰ï¼‰ã€‚</li>
<li>ä¸¤è€…éƒ½ä¼šä½¿å¾—å†å²è®°å½•å‘ç”Ÿå˜åŒ–ã€‚åè€…ä¸ä¼šä½¿å¾— <code>history.length</code> å‘ç”Ÿæ”¹å˜ã€‚</li>
</ul>
</blockquote>
<p>å¦å¤–ï¼Œå¯¹äºå†å²è®°å½•åŠå…¶æ•°é‡ï¼Œ<code>history.replaceState()</code> ä¸ <code>location.replace()</code> è¡¨ç°æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åè€…æœ‰å¯èƒ½ä¼šé‡è½½é¡µé¢ã€‚</p>
<h4>6. popstate äº‹ä»¶</h4>
<p>è°ƒç”¨ <code>pushState()</code>ã€<code>replaceState()</code> æ–¹æ³•çš„è¯ï¼Œæ—¢ä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ç›‘å¬å™¨ï¼Œä¹Ÿä¸ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ç›‘å¬å™¨ï¼ˆå³ä½¿æ–°æ—§ URL åªæ˜¯ Fragment éƒ¨åˆ†ä¸åŒï¼‰ã€‚è¿™ä¸ªä¹Ÿæ˜¯ History API çš„ä¼˜ç‚¹ä¹‹ä¸€ã€‚</p>
<p>å…¶ä½™çš„ä¸‹ä¸€èŠ‚ä»‹ç»...</p>
<h2>äº”ã€hashchange å’Œ popstate äº‹ä»¶</h2>
<h4>1. hashchange äº‹ä»¶</h4>
<p>IE8 åŠä»¥ä¸Šæµè§ˆå™¨éƒ½æ”¯æŒ <code>hashchange</code> äº‹ä»¶ã€‚æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function listener(e) {
  // å¯é€šè¿‡ e.newURL å’Œ e.oldURL è·å–å®Œæ•´çš„æ–°æ—§ URL å€¼ï¼ˆåªè¯»ï¼‰
  // do something...
}

// é€šè¿‡ DOM2 æ³¨å†Œï¼ˆæ›´æ¨èï¼‰
window.addEventListener('hashchange', listener)

// é€šè¿‡ DOM0 æ³¨å†Œ
window.onhashchange = listener
</code></pre>
<blockquote>
<p>å¯¹äºäº‹ä»¶ç›‘å¬å™¨çš„å…¼å®¹æ€§ï¼Œå¯çœ‹ï¼š<a href="https://www.jianshu.com/p/16aa6b6f934f">ç»†è¯» JavaScript äº‹ä»¶è¯¦è§£</a>ã€‚</p>
</blockquote>
<p>é™¤äº†é€šè¿‡è°ƒç”¨ <code>pushState()</code>ã€<code>replaceState()</code> ä½¿ URL çš„ Fragment éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ï¼Œä¸ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ä¹‹å¤–ï¼Œå…¶ä»–ä»»ä½•æ–¹å¼è‡´ä½¿ Fragment å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼ŒåŒ…æ‹¬ <code>history.forward()</code>ã€<code>history.back()</code>ã€<code>location.hash</code>ã€<code>&lt;a href=&quot;#anchor&quot;&gt;</code>ã€æ“ä½œæµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®ã€ä¿®æ”¹åœ°å€æ  Fragment å€¼ç­‰æ–¹å¼ã€‚</p>
<blockquote>
<p>æœ¬æ–‡æåˆ°çš„ Fragment å‡æŒ‡ URL ä¸Šè·Ÿåœ¨ <code>#</code> åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<h4>2. popstate äº‹ä»¶</h4>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨ <code>history.pushState()</code> æˆ– <code>history.replaceState()</code> ä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ã€‚</p>
</blockquote>
<p><strong>åªæœ‰é€šè¿‡ç‚¹å‡»æµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®ï¼Œæˆ–è€…é€šè¿‡è„šæœ¬è°ƒç”¨ <code>history.back()</code>ã€<code>history.forward()</code>ã€<code>history.go()</code> ï¼ˆ<code>go(0)</code> é™¤å¤–ï¼‰æ–¹æ³•ï¼Œ<code>popstate</code> äº‹ä»¶æ‰ä¼šè¢«è§¦å‘ã€‚</strong></p>
<pre><code class="language-js">function listener(e) {
  // é€šè¿‡ e.state å¯ä»¥è·å–å½“å‰è®°å½•çš„çŠ¶æ€å¯¹è±¡å¯¹åº”çš„æ‹·è´å€¼ã€‚
  // é pushStateã€replaceState äº§ç”Ÿçš„è®°å½•ï¼Œè¯¥å±æ€§å€¼éƒ½ä¸º nullã€‚
}

// é€šè¿‡ DOM2 æ³¨å†Œï¼ˆæ›´æ¨èï¼‰
window.addEventListener('popstate', listener)

// é€šè¿‡ DOM0 æ³¨å†Œ
window.onpopstate = listener
</code></pre>
<p>å¦å¤–ï¼Œä¸åŒæµè§ˆå™¨åœ¨åŠ è½½é¡µé¢æ—¶å¤„ç† <code>popstate</code> äº‹ä»¶çš„å½¢å¼å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚</p>
<h4>3. å°ç»“</h4>
<p>ä¸‹é¢æ€»ç»“äº†å¾ˆå¤šæ¡ï¼Œå¾ˆå¤§å¯èƒ½ä¼šè®°ä¸ä½ï¼Œæ²¡å…³ç³»ï¼š</p>
<blockquote>
<ul>
<li>
<p>é€šè¿‡ <code>back()</code>ã€<code>forward()</code>ã€<code>go()</code> æˆ–æµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œä¸€å®šä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ã€‚è‹¥ä¼´éšç€ Fragment çš„å˜åŒ–ï¼Œä¹Ÿä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ã€‚ï¼ˆä¸è®°å½•äº§ç”Ÿçš„æ–¹å¼æ— å…³ï¼‰</p>
</li>
<li>
<p>åœ¨è°ƒç”¨ <code>pushState()</code>ã€<code>replaceState()</code> æ—¶ï¼Œæ—¢ä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ï¼Œä¹Ÿä¸ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ï¼ˆå³ä½¿åŒ…æ‹¬ Fragment å‘ç”Ÿæ”¹å˜ï¼‰ã€‚</p>
</li>
<li>
<p>é™¤äº† <code>pushState()</code>ã€<code>replaceState()</code>ï¼Œå…¶ä»–ä»»ä½•æ–¹å¼è‡´ä½¿ Fragment å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ã€‚</p>
</li>
<li>
<p>é€šè¿‡ <code>location.hash = 'foo'</code> æ–¹å¼è‡´ä½¿ Fragment å‘ç”Ÿæ”¹å˜ï¼Œä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ï¼Œè€Œä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ã€‚</p>
</li>
<li>
<p>è€Œé€šè¿‡ <code>window.location = '#foo'</code> æˆ– <code>&lt;a href=&quot;#foo&quot;&gt;</code> å½¢å¼è‡´ä½¿ Fragment å‘ç”Ÿæ”¹å˜ï¼ŒåŒæ—¶è§¦å‘ <code>hashchange</code> å’Œ <code>popstate</code> äº‹ä»¶ã€‚</p>
</li>
</ul>
</blockquote>
<p><strong>ç®€åŒ–è®°å¿†ï¼š</strong></p>
<p>å…¶å®å¸¸ç”¨çš„æ–¹æ³•åªæœ‰ä¸‰ä¸ªï¼š<code>history.pushState()</code>ã€<code>history.replaceState()</code>ã€<code>location.hash</code>ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œé€šå¸¸ä¸€ä¸ªé¡¹ç›®ä¸ä¼šä¸¤è€…æ··ç”¨ï¼Œä¸ç„¶å¾—å¤šä¹±å•Šã€‚ä¾‹å¦‚ React ã€Vue æä¾›çš„è·¯ç”±ç³»ç»Ÿåªèƒ½äºŒé€‰ä¸€ï¼š</p>
<blockquote>
<ul>
<li><strong>History æ¨¡å¼</strong>ï¼šä½¿ç”¨ HTML5 History APIï¼Œæ›´ç¬¦åˆæœªæ¥å‘å±•çš„æ–¹å‘</li>
<li><strong>Hash æ¨¡å¼</strong>ï¼šåˆ©ç”¨ <code>location.hash</code> å’Œ <code>hashchange</code> äº‹ä»¶å®ç°ï¼Œå…¼å®¹æ€§è¾ƒå¥½ï¼Œä¸”æœåŠ¡ç«¯æ— éœ€é¢å¤–çš„é…ç½®ã€‚</li>
</ul>
</blockquote>
<p>æ‰€ä»¥ï¼Œå°±ç®€åŒ–æˆä¸¤æ¡ï¼š</p>
<ul>
<li>è°ƒç”¨ <code>pushState()</code>ã€<code>replaceState()</code> æ—¶ï¼Œä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ã€‚å…¶ä»– URL çš„å˜åŒ–éƒ½ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</li>
<li>å½“ URL çš„ Fragment éƒ¨åˆ†å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ã€‚</li>
</ul>
<h2>å…­ã€æ¯”è¾ƒ</h2>
<p>History æ¨¡å¼å’Œ Hash æ¨¡å¼ï¼Œåœ¨ä¸é‡è½½é¡µé¢çš„å‰æä¸‹ï¼Œå®ç°äº†å±€éƒ¨åˆ·æ–°çš„èƒ½åŠ›ã€‚</p>
<p>ä»æŸç§ç¨‹åº¦æ¥è¯´, è°ƒç”¨Â <code>pushState()</code>Â å’ŒÂ <code>window.location= &quot;#foo&quot;</code> åŸºæœ¬ä¸Šä¸€æ ·, ä»–ä»¬éƒ½ä¼šåœ¨å½“å‰çš„å†å²è®°å½•ä¸­åˆ›å»ºå’Œæ¿€æ´»ä¸€ä¸ªæ–°çš„å†å²æ¡ç›®ã€‚ä½†æ˜¯Â <code>pushState()</code>Â æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>
<p>æ–°çš„ URL å¯ä»¥æ˜¯ä»»ä½•å’Œå½“å‰ URL åŒæºçš„ URLã€‚ä½†æ˜¯è®¾ç½®Â <code>window.location</code>Â åªä¼šåœ¨ä½ åªè®¾ç½® Fragment çš„æ—¶å€™æ‰ä¼šä½¿å½“å‰çš„ URLã€‚</p>
</li>
<li>
<p>éå¼ºåˆ¶ä¿®æ”¹ URLã€‚ç›¸åï¼Œè®¾ç½®Â <code>window.location = '#foo'</code>Â ä»…ä»…ä¼šåœ¨é”šçš„å€¼ä¸æ˜¯ <code>#foo</code> æƒ…å†µä¸‹åˆ›å»ºä¸€æ¡æ–°çš„å†å²è®°å½•ã€‚</p>
</li>
<li>
<p>å¯ä»¥åœ¨æ–°çš„å†å²è®°å½•ä¸­å…³è”ä»»ä½•æ•°æ®ã€‚<code>window.location = &quot;#foo&quot;</code> å½¢å¼çš„æ“ä½œï¼Œä½ åªå¯ä»¥å°†æ‰€éœ€æ•°æ®å†™å…¥é”šçš„å­—ç¬¦ä¸²ä¸­ã€‚</p>
</li>
</ul>
<p>æ³¨æ„ï¼šÂ <code>pushState()</code>Â ä¸ä¼šé€ æˆÂ <code>hashchange</code> äº‹ä»¶è°ƒç”¨ï¼Œå³ä½¿æ–°æ—§ URL åªæ˜¯ Fragment ä¸åŒã€‚</p>
<blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState#%E6%8F%8F%E8%BF%B0" title="Permalink to æè¿°">æ›´å¤š...</a></p>
</blockquote>
<h2>ä¸ƒã€React Router</h2>
<p>åœ¨ React çš„è·¯ç”±ç³»ç»Ÿä¸­ï¼Œä¿®æ”¹è·¯ç”±ã€ç›‘å¬è·¯ç”±å®é™…ä¸Šæ˜¯ç”± <a href="https://github.com/ReactTraining/react-history">history</a> åº“ä¸­ <code>createBrowserHistory()</code> æˆ– <code>createHashHistory()</code> æ–¹æ³•æ‰€æ„é€ çš„ <code>history</code> å¯¹è±¡ï¼ˆæœ‰åˆ«äº <code>window.history</code> å¯¹è±¡ï¼‰å»æ“ä½œçš„ã€‚</p>
<p>åœ¨ React ä¸­ï¼Œè·¯ç”±æ“ä½œæœ‰è¿™å‡ ç§æ–¹æ³•ã€‚</p>
<blockquote>
<ul>
<li>
<p><code>props.history.push()</code> - æ–°å¢ä¸€æ¡å†å²è®°å½•</p>
</li>
<li>
<p><code>props.history.replace()</code> - æ–°å¢ä¸€æ¡è®°å½•ï¼Œå¹¶æ›¿æ¢å½“å‰è®°å½•</p>
</li>
<li>
<p><code>props.history.go()</code> - åé€€/å‰è¿›</p>
</li>
<li>
<p><code>props.history.goBack()</code> - å³ <code>props.history.go(-1)</code></p>
</li>
<li>
<p><code>props.history.goForward()</code> - å³ <code>props.history.go(1)</code></p>
</li>
</ul>
</blockquote>
<p>å…¶ä¸­ï¼Œ<code>props.history.go()</code> å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº† <code>window.history.go()</code> æ–¹æ³•ã€‚å‰é¢ä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨ä¸åŒè·¯ç”±æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨çš„èƒ½åŠ›æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p>åœ¨ <code>BrowserRouter</code> æ¨¡å¼ä¸‹ï¼Œå¯¹åº” <code>window.history.pushState()</code> å’Œ <code>window.history.replaceState()</code> æ–¹æ³•ã€‚</p>
<p>åœ¨ <code>HashRouter</code> æ¨¡å¼ä¸‹ï¼Œå¯¹åº” <code>window.location.hash</code> å’Œ <code>window.location.replace()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<p>åœ¨ React Router ä¸­ï¼Œè·¯ç”±æ›´æ–°ä»¥åŠ è½½ä¸åŒçš„ç»„ä»¶ï¼Œæ˜¯é€šè¿‡ React <code>Context</code> å®ç°çš„ï¼Œå³ <code>Provider/Consumer</code> çš„æ¨¡å¼ã€‚å½“è·¯ç”±æ›´æ–°æ—¶ï¼Œ<code>Provider</code> çš„ <code>value</code> å±æ€§ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½¿å¾—å¯¹åº”æ¶ˆè´¹ <code>Consumer</code> çš„ç»„ä»¶å¾—ä»¥æ›´æ–°ã€‚</p>
<p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œè°ƒç”¨ <code>history.pushState()</code> æˆ– <code>history.replaceState()</code> å¹¶ä¸ä¼šè§¦å‘ popstate äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚é‚£ä¹ˆ React Router æ˜¯æ€ä¹ˆçŸ¥é“ URL å‘ç”Ÿå˜åŒ–çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆåœ¨é€‰æ‹©ä½¿ç”¨ <code>&lt;BrowserRouter&gt;</code> æˆ– <code>&lt;HashHistory&gt;</code> ç»„ä»¶æ—¶ï¼Œå®ƒå†…éƒ¨è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨çš„å›è°ƒå‡½æ•°é‡Œé¢æœ‰ä¸€ä¸ª <code>setState()</code> æ–¹æ³•ã€‚å½“æˆ‘ä»¬åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ <code>props.history.push()</code> æ–¹æ³•å»è·³è½¬é¡µé¢æ—¶ï¼Œå®ƒé™¤äº†ä¼šæ‰§è¡Œ <code>window.history.pushState()</code> ä½¿å¾— URL å‘ç”Ÿæ”¹å˜ä¹‹å¤–ï¼Œè¿˜ä¼šæ‰§è¡Œå‰é¢æåˆ°çš„ç›‘å¬å™¨ï¼Œé‚£ä¹ˆç›‘å¬å™¨çš„å›è°ƒå‡½æ•°ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œæ—¢ç„¶é‡Œé¢æœ‰ <code>setState()</code> æ“ä½œï¼Œå°±ä¼šä½¿å¾— <code>&lt;BrowserRouter&gt;</code> æˆ– <code>&lt;HashHistory&gt;</code> ç»„ä»¶æ‰§è¡Œä¸€æ¬¡æ›´æ–°ï¼Œé‚£ä¹ˆè¯¥ç»„ä»¶çš„ <code>Provider</code> å°±ä¼šæ›´æ–°ï¼ŒReact Router çš„ <code>Consumer</code> ä»¬æ ¹æ® URL æ¥åŒ¹é…å¯¹åº”çš„è·¯ç”±ï¼Œä»¥åŠ è½½ç›¸åº”çš„ç»„ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ° URL çš„å˜åŒ–ä»¥åŠé¡µé¢çš„è·³è½¬ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº sliceã€splice è®°å¿†å’ŒåŒºåˆ†]]></title>
            <link>https://github.com/toFrankie/blog/issues/272</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/272</guid>
            <pubDate>Sun, 26 Feb 2023 12:35:20 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cc16f04767b7034f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cc16f04767b7034f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½ ä»¬ä¼šä¸ä¼šæœ‰è¿™äº›å›°æ‰°ï¼Œè®°ä¸ä½ <code>slice()</code> å’Œ <code>splice()</code> çš„ç”¨æ³•ï¼Œéš”ä¸€æ®µæ—¶é—´ï¼Œå†ç”¨æ—¶å°±å¾—ç¿»æ–‡æ¡£ã€‚æ¯”å¦‚è¯´ï¼š</p>
<ul>
<li>å“ªä¸ªä¼šæ”¹å˜åŸæ•°ç»„ï¼Œå“ªä¸ªä¸ä¼šï¼Ÿ</li>
<li>å¯¹æ•°ç»„è¿›è¡Œæ“ä½œï¼ŒåŒ…ä¸åŒ…æ‹¬è¦ä¿®æ”¹çš„æœ€åä¸€é¡¹å‘¢ï¼Ÿ</li>
<li>æ€æ ·åŒºåˆ†ä¼šæ›´å®¹æ˜“è®°å¿†ï¼Ÿ</li>
</ul>
<h2>Array.prototype.slice</h2>
<blockquote>
<p><code>slice()</code> ä¸ä¼šâ€œæ”¹å˜â€åŸæ•°ç»„ã€‚</p>
</blockquote>
<h3>è¯­æ³•</h3>
<pre><code class="language-js">array.slice([begin[, end])
</code></pre>
<p><code>begin</code> å’Œ <code>end</code> éƒ½æ˜¯å¯é€‰çš„ã€‚è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ˜¯ç”± <code>begin</code> å’Œ <code>end</code> å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ <code>begin</code>ï¼Œä¸åŒ…æ‹¬ <code>end</code> ï¼‰ã€‚<strong>é€šä¿—åœ°è®²ï¼Œå°±æ˜¯æˆªå–åŸæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶è¿”å›æˆªå–éƒ¨åˆ†ï¼Œä¸”â€œä¸æ”¹å˜â€åŸæ•°ç»„</strong>ã€‚</p>
<h3>æ€»ç»“</h3>
<ul>
<li>
<p>è¿”å›æ–°æ•°ç»„ï¼Œä¸”ä¸æ”¹å˜åŸå§‹å€¼ï¼Œä½†æ³¨æ„å¼•ç”¨å€¼çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>è¿”å›ç»“æœä¸º <code>[begin, end)</code>ï¼Œç”¨æ•°å­¦è¯æœ¯å°±æ˜¯å·¦é—­å³å¼€åŒºé—´ï¼Œå³å« <code>begin</code>ï¼Œä½†ä¸åŒ…æ‹¬ <code>end</code>ã€‚</p>
</li>
<li>
<p><code>begin</code>ã€<code>end</code> çš„å€¼å¯ä¸º <code>è´Ÿæ•°</code>ã€<code>0</code>ã€<code>æ­£æ•°</code>ã€‚å…¶ä¸­ <code>0</code> å’Œæ­£æ•°ä¸å¤šè¯´ï¼Œè‹¥ä¸ºè´Ÿæ•°ï¼Œä»æ•°ç»„æœ«å°¾å¼€å§‹ç¡®å®šç´¢å¼•å€¼ï¼Œå…¶ä¸­ <code>-1</code> ä¸ºæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚è‹¥è´Ÿæ•°å°äº <code>-length</code>ï¼Œåˆ™ç´¢å¼•å€¼ä¸º <code>0</code>ï¼ˆå¯åœ¨å†…å¿ƒè½¬æ¢ä¸ºæ­£å‘ç´¢å¼•å€¼ï¼‰ã€‚</p>
</li>
<li>
<p>è‹¥ <code>begin â‰¥ arr.length</code>ï¼ˆè¶…å‡ºæ•°ç»„èŒƒå›´ï¼‰æˆ– <code>begin â‰¥ end</code>ï¼ˆä¸¤è€…ç¿»è¯‘æˆæ­£å‘ç´¢å¼•åå†æ¯”è¾ƒï¼‰ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä¼šè¿”å›ç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰ã€‚</p>
</li>
<li>
<p>è‹¥å‚æ•° <code>begin</code> æˆ– <code>end</code> ä¸ä¸ºæ•°å€¼ï¼Œä¼šè‡ªåŠ¨éšå¼ç±»å‹è½¬æ¢ä¸º <code>Number</code> ç±»å‹ï¼Œå†æˆªå–ã€‚</p>
</li>
<li>
<p><code>Array.prototype.slice()</code> å¯ç”¨æ¥å°†ä¸€ä¸ªç±»æ•°ç»„ï¼ˆarray-likeï¼‰è½¬æ¢ä¸ºæ–°æ•°ç»„ã€‚</p>
</li>
</ul>
<h3>ç¤ºä¾‹</h3>
<pre><code class="language-js">const arr = [1, 2, 3, 4, 5]
const arr2 = [1, 2, { num: 3 }, 4, 5]

// 1ï¸âƒ£ å½“ begin å’Œ end åŒæ—¶ç¼ºçœæ—¶ï¼Œä¼šâ€œæµ…æ‹·è´â€ä¸€ä¸ªå®Œæ•´çš„æ•°ç»„
//    1ï¼‰é€‚åˆæ‹·è´ä¸€ä¸ªå®Œæ•´æ— å¼•ç”¨å€¼çš„æ•°ç»„
//    2ï¼‰å°†ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¦‚ arguments -&gt; array
arr !== arr.slice() // trueï¼Œæµ…æ‹·è´æ•ˆæœ
function foo() {
  // ç±»æ•°ç»„ä¸å…·æœ‰æ•°ç»„çš„ä»»ä½•æ–¹æ³•ï¼Œè½¬æ¢å arr å°±å˜æˆäº†çœŸæ­£çš„æ•°ç»„
  // Tips: ä½†ç°åœ¨ç”¨å¾—æ›´å¤šçš„å¯èƒ½æ˜¯ rest å‚æ•°
  const arr = Array.prototype.slice.call(arguments) // æˆ– [].slice.call(arguments)
}


// 2ï¸âƒ£ è¿”å›æ•°ç»„çš„ä¸€éƒ¨åˆ†
arr.slice(4) // [5]
arr.slice(1, 3) // [2, 3]
arr.slice(-2, -1) // [4]


// 3ï¸âƒ£ è¿”å›ç©ºæ•°ç»„
arr.slice(1, 1) // []ï¼Œå±äº begin = endï¼Œä½†ä¸åŒ…å« end
arr.slice(3, -4) // []ï¼Œå±äº begin â‰¥ end çš„æƒ…å†µ
arr.slice(5) // []ï¼Œå±äºè¶…å‡ºæ•°ç»„èŒƒå›´çš„æƒ…å†µ


// 4ï¸âƒ£ æµ…æ‹·è´å¼•ç”¨å€¼çš„é—®é¢˜ï¼Œå…¶å®éå¸¸ç®€å•ï¼Œé¡ºä¾¿æä¸€ä¸‹è€Œå·²
const newArr = arr2.slice(2) // [{ num: 3 }, 4, 5]
newArr[0].num = 6 // ä¿®æ”¹æ–°æ•°ç»„çš„å¼•ç”¨å€¼
arr2[2] // { num: 6 }ï¼Œä¼šå½±å“åŸæ•°ç»„


// 5ï¸âƒ£ è‹¥å‚æ•°ä¸ä¸ºæ•°å€¼ï¼Œå°†ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œå†æˆªå–
arr.slice(true) // [2, 3, 4, 5]ï¼Œtrue ä¼šè½¬æ¢ä¸º Number ç±»å‹ä¸º 1
arr.slice(false) // [1, 2, 3, 4, 5]ï¼ŒåŒç†
arr.slice('str') // [1, 2, 3, 4, 5]ï¼Œå­—ç¬¦ä¸² 'str' ä¼šè¢«è½¬æ¢ä¸º NaNï¼Œæ•ˆæœåŒ arr.slice(NaN)


// 6ï¸âƒ£ è‹¥å‚æ•°ä¸ºå°æ•°ï¼Œåº”è¯¥æ˜¯é‡‡ç”¨ parseInt() å–æ•´æ•°éƒ¨åˆ†
arr.slice(1, 3.6) // [2, 3]
arr.slice(-2.3) // [4, 5]
</code></pre>
<h3>å…¶ä»–</h3>
<p>å­—ç¬¦ä¸²ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/slice"><code>String.prototype.slice()</code></a>ï¼Œå®ƒç”¨æ¥æå–å­—ç¬¦ä¸²çš„æŸä¸€éƒ¨åˆ†ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œä¸”ä¸ä¼šæ”¹å˜åŸå­—ç¬¦ä¸²ã€‚</p>
<p>è¯­æ³•ï¼š</p>
<pre><code class="language-js">// ä»åŸå­—ç¬¦ä¸²ä¸­ï¼Œæˆªå– [beginIndex, endIndex) çš„å­—ç¬¦ä¸²
string.slice(beginIndex, endIndex)
</code></pre>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<pre><code class="language-js">const str = 'string'
// 1ï¸âƒ£ æˆªå–å­—ç¬¦ä¸²
str.slice(1, 3) // &quot;tr&quot;

// 2ï¸âƒ£ ç›¸ä¿¡ä½ ä¹Ÿè§è¿‡ä»¥ä¸‹ç”¨æ³•ï¼Œå¸¸ç”¨æ¥ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
const randomKey = Math.random().toString(36).slice(2)
</code></pre>
<h2>Array.prototype.splice</h2>
<p>è®²çœŸçš„ï¼Œå®ƒè·Ÿ <code>slice()</code> é•¿å¾—åƒä¸è¯´ï¼Œè¿˜å®¹æ˜“æ··æ·†ï¼Œéš”ä¸€æ®µæ—¶é—´ä¸ç”¨ï¼Œéƒ½å¾—ç¿»ä¸€ä¸‹æ–‡æ¡£ç¡®è®¤ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>ä¸ <code>slice()</code> ä¸åŒï¼Œ<code>splice()</code> ä¼šæ”¹å˜åŸæ•°ç»„ã€‚</p>
</blockquote>
<h3>è¯­æ³•</h3>
<pre><code class="language-js">array.splice([start[, deleteCount[, item1[, item2[, ...]]]]])
</code></pre>
<p>æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚ä» <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice#%E8%AF%AD%E6%B3%95">MDN</a> ä¸Šçš„è¡¨è¿°çœ‹ï¼Œå‚æ•° <code>start</code> åº”è¯¥ä¸èƒ½ç¼ºçœçš„ï¼Œä½†å®é™…å¹¶ä¸ä¼šæŠ¥é”™ï¼Œå› æ­¤å¯è®¤ä¸ºæ˜¯å…¨å¯é€‰çš„ã€‚<code>splice()</code> è¿”å›è¢«åˆ é™¤çš„å…ƒç´ æ‰€ç»„æˆçš„ä¸€ä¸ªæ–°æ•°ç»„ï¼Œè‹¥æ²¡æœ‰åˆ é™¤ï¼Œåˆ™è¿”å›ç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰</p>
<ul>
<li>
<p><code>start</code> - å¼€å§‹ä½ç½®ï¼ˆä» <code>0</code> è®¡æ•°ï¼‰</p>
<ul>
<li>è‹¥ <code>start â‰¥ length</code>ï¼Œå³è¶…å‡ºæ•°ç»„é•¿åº¦ï¼Œåˆ™ä»æ•°ç»„æœ«å°¾æ·»åŠ å†…å®¹ï¼›</li>
<li>è‹¥ <code>start ï¼œ 0</code>ï¼Œå³ä¸ºè´Ÿæ•°ï¼Œåˆ™ä»æ•°ç»„æœ«å°¾å¼€å§‹çš„ç¬¬å‡ ä½å¼€å§‹ï¼Œè´Ÿæ•°å°äº <code>-length</code> æ—¶ï¼Œä» <code>0</code> å¼€å§‹ã€‚è®¡æ•°æ–¹å¼ä¸ <code>slice()</code> ç›¸åŒã€‚</li>
</ul>
</li>
<li>
<p><code>deleteCount</code> - æ•´æ•°ï¼Œè¡¨ç¤ºè¦ç§»é™¤çš„æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚</p>
<ul>
<li>è‹¥ç¼ºçœ <code>deleteCount</code> æˆ–è€… <code>deleteCount</code> å¤§äº <code>start</code> ä¹‹åæ‰€æœ‰å…ƒç´ æ•°é‡ï¼Œåˆ™åˆ é™¤ <code>start</code> åé¢çš„æ‰€æœ‰å…ƒç´ ï¼Œå« <code>start</code>ã€‚</li>
<li>è‹¥ <code>deleteCount â‰¤ 0</code>ï¼Œæ­¤æ—¶ä¸ç§»é™¤å…ƒç´ ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¸¸ç”¨æ¥æ’å…¥æ–°å…ƒç´ ã€‚</li>
</ul>
</li>
<li>
<p><code>item1, item2, ...</code> - è¦æ·»åŠ è¿›æ•°ç»„çš„å…ƒç´ ï¼Œä» <code>start</code> ä½ç½®å¼€å§‹ã€‚
è‹¥ä¸æŒ‡å®šï¼Œåˆ™ <code>splice()</code> å°†åªåˆ é™¤æ•°ç»„å…ƒç´ ã€‚</p>
</li>
</ul>
<h3>æ€»ç»“</h3>
<ul>
<li>
<p><code>splice()</code> ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¢«åˆ é™¤å…ƒç´ ç»„æˆçš„æ•°ç»„ã€‚</p>
</li>
<li>
<p><code>splice()</code> å‚æ•° start æ¥å—è´Ÿæ•°ã€<code>0</code>ã€æ­£æ•°ï¼Œè®¡ç®—èµ·å§‹ä½ç½®ä¸ <code>slice()</code> æ–¹æ³•ä¸€è‡´ã€‚</p>
</li>
<li>
<p>å½“ <code>deleteCount</code> ä¸ºæ­£æ•°æ—¶ï¼Œ<code>splice(start, deleteCount)</code> æ‰€åˆ é™¤çš„å…ƒç´ åŒ…å« <code>[start, start + deleteCount)</code>ï¼Œè¿™é‡Œçš„ <code>start</code> æ˜¯æŒ‡è½¬æ¢åæ­£å‘ç´¢å¼•å€¼ã€‚</p>
</li>
<li>
<p>å½“ <code>deleteCount</code> ä¸ºè´Ÿæ•°æˆ–é›¶ï¼Œåˆ™ä¸åˆ é™¤å…ƒç´ ã€‚å¸¸ç”¨äºä¸åˆ é™¤åŸæ•°ç»„å…ƒç´ ï¼Œå¹¶æ’å…¥æ–°å…ƒç´ çš„åœºæ™¯ã€‚</p>
</li>
<li>
<p>è¯·æ³¨æ„ï¼Œ<code>deleteCount</code> æ˜¯æŒ‡åˆ é™¤çš„ä¸ªæ•°ï¼Œè€Œéç´¢å¼•å€¼ã€‚æˆ‘æƒ³è¿™ä¹Ÿå°±æ˜¯ <code>slice()</code> ä¸ <code>splice()</code> å®¹æ˜“æ··æ·†çš„åŸå› æ‰€åœ¨ã€‚</p>
</li>
<li>
<p><code>splice()</code> ä¸­çš„ <code>start</code> å’Œ <code>delectCount</code> ä¹Ÿæ˜¯ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢çš„ã€‚</p>
</li>
</ul>
<h3>ç¤ºä¾‹</h3>
<pre><code class="language-js">const arr = [1, 2, 3, 4, 5]

// 1ï¸âƒ£ å…è®¸ç¼ºçœæ‰€æœ‰å‚æ•°ï¼Œä½†æ²¡æœ‰çœŸæ­£çš„æ„ä¹‰
arr.splice() // []ï¼ŒåŸæ•°ç»„ä¹Ÿæ²¡æœ‰æ”¹å˜


// 2ï¸âƒ£ åˆ é™¤ï¼Œå¹¶æ’å…¥æ–°å…ƒç´ 
arr.splice(1, 2, 6) // [2, 3]ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º [1, 6, 4, 5]
arr.splice(-2, 3, 6) // [4, 5]ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º [1, 2, 3, 6]


// 3ï¸âƒ£ åˆ é™¤ start åé¢æ‰€æœ‰å…ƒç´ 
arr.splice(1) // [2, 3, 4, 5]ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º [1]
arr.splice(-100) // [1, 2, 3, 4, 5]ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º []

// 4ï¸âƒ£ ä¸åˆ é™¤åŸæ•°ç»„å…ƒç´ ï¼Œå¹¶æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–°å…ƒç´ 
//    è¿™ä¸ªåº”è¯¥å°±æ˜¯ splice() ç”¨å¾—æœ€å¤šçš„åœºæ™¯å§ï¼
arr.splice(1, 0, 6) // []ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º [1, 6, 2, 3, 4, 5]
arr.splice(1, 0, 6, true) // []ï¼Œæ­¤æ—¶ arr è¢«ä¿®æ”¹ä¸º [1, 6, true, 2, 3, 4, 5]

// 5ï¸âƒ£ éšå¼ç±»å‹è½¬æ¢
arr.splice(true, true) // [2]ï¼Œç›¸å½“äº arr.splice(1, 1)

// âš ï¸ è¯·æ³¨æ„ï¼Œä»¥ä¸Šæ¯æ¡è¯­å¥æ˜¯åŸºäº arr ä¸º [1, 2, 3, 4, 5] å¾—å‡ºçš„ç»“æœï¼Œ
// å¹¶ä¸æ˜¯æŒ‰é¡ºåºæ‰§è¡Œå¾—å‡ºçš„ç»“æœï¼Œå°±æ€•æœ‰äººè¯¯è§£ã€‚å› ä¸º splice() æ–¹æ³•æ˜¯ä¼šä¿®æ”¹åŸæ•°ç»„çš„ã€‚
</code></pre>
<h2>String.prototype.split</h2>
<p>é¡ºé“æä¸€ä¸‹ï¼Œå…¶å® <code>split()</code> è¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œå¸¸ç”¨äºå­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„ã€è§£æ URL å‚æ•°ç­‰åœºæ™¯ã€‚</p>
<p>åœ¨å­—ç¬¦ä¸²ä¸æ•°å­—åˆ‡æ¢ï¼Œå¸¸ç”¨åˆ° <code>String.prototype.split()</code>ã€<code>Array.prototype.join()</code>ã€<code>Array.prototype.reverse()</code> æ–¹æ³•ã€‚</p>
<h3>è¯­æ³•</h3>
<pre><code class="language-js">str.split([separator[, limit]])
</code></pre>
<p>å‚æ•° <code>separator</code> å’Œ <code>limit</code> éƒ½æ˜¯å¯é€‰çš„ã€‚è‹¥ç¼ºçœ <code>separator</code> æ—¶ï¼Œè¿”å›çš„æ•°ç»„åŒ…å«ä¸€ä¸ªç”±æ•´ä¸ªå­—ç¬¦ä¸²ç»„æˆçš„å…ƒç´ ã€‚è€Œ <code>limit</code> çš„ä½œç”¨æ˜¯è¿”å›åˆ†å‰²ç‰‡æ®µçš„æ•°é‡ã€‚</p>
<pre><code class="language-js">const str = 'hello'

// å­—ç¬¦ä¸²åˆ†å‰²
str.split() // [&quot;hello&quot;]
str.split('') // [&quot;h&quot;, &quot;e&quot;, &quot;l&quot;, &quot;l&quot;, &quot;o&quot;]
str.split('', 2) // [&quot;h&quot;, &quot;e&quot;]

// å­—ç¬¦ä¸²ä¸æ•°å­—è½¬æ¢
str.split('').join(',') // &quot;h,e,l,l,o&quot;

// ä¹Ÿå¸¸ç”¨æ¥åè½¬å­—ç¬¦ä¸²
str.split('').reverse().join('') // &quot;olleh&quot;
</code></pre>
<p><code>separator</code> å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒé€‚åˆæå–ä¸€äº›ä¸å¤ªè§„åˆ™çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å‡è®¾æœ‰ä»¥ä¸‹ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¦æŠŠæœˆä»½æå–å‡ºæ¥ï¼Œå¹¶è¿”å›æ•°ç»„ï¼š</p>
<pre><code class="language-js">const str1 = 'Jan; March; April; June'
const str2 = 'Jan ;March ; April; June'

// å¯¹äº str1 æ˜¯ç›¸å¯¹æ¯”è¾ƒè§„å¾‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥
str1.split('; ') // [&quot;Jan&quot;, &quot;March&quot;, &quot;April&quot;, &quot;June&quot;]

// è€Œ str2 å°±ä¸èƒ½é€šè¿‡ä¸Šè¿°æ–¹å¼å»æå–äº†ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä½œä¸º separator å‚æ•°
const re = /\s*;\s*/g
str2.split(re) // [&quot;Jan&quot;, &quot;March&quot;, &quot;April&quot;, &quot;June&quot;]
</code></pre>
<h2>ç»“è®º</h2>
<p>æœ¬æ–‡ï¼Œä¸»è¦æ˜¯è®²è§£ <code>slice()</code> å’Œ <code>splice()</code> æ–¹æ³•åŠå…¶åŒºåˆ«ã€‚å¥½å§ï¼Œé¢è¯•å®˜ä¹Ÿå–œæ¬¢é—®è¿™ä¿©è´§ã€‚</p>
<ol>
<li>
<p>ä»å‚æ•°ä¸ŠåŒºåˆ†ï¼š<code>slice(begin, end)</code> å’Œ <code>splice(start, deleteCount, ...item)</code> ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>
<p>åœ¨ <code>slice()</code> ä¸­ <code>begin</code> å’Œ <code>end</code> éƒ½æŒ‡åŸæ•°ç»„å¯¹åº”çš„ç´¢å¼•å€¼ã€‚</p>
</li>
<li>
<p>åœ¨ <code>splice()</code> ä¸­åªæœ‰ <code>start</code> æ˜¯æŒ‡åŸæ•°ç»„å¯¹åº”çš„ç´¢å¼•å€¼ï¼Œ<code>deleteCount</code> æ˜¯è¦åˆ é™¤çš„æ•°é‡ã€‚å¦‚æœè¦è½¬åŒ–ä¸º <code>[begin, end)</code> çš„å½¢å¼ï¼Œå…ˆå°† <code>start</code> è½¬ä¸ºæ­£å‘ç´¢å¼•å€¼ï¼ˆå¦‚ <code>-1</code> è½¬ä¸ºåŸå§‹å€¼æœ€åä¸€é¡¹çš„ç´¢å¼•å€¼ï¼‰ï¼Œç„¶åè¦åˆ é™¤çš„åŒºé—´è‡ªç„¶å°±æ˜¯ <code>[start, start + deleteCount)</code>ã€‚</p>
</li>
<li>
<p>å½“ <code>slice()</code> ç¼ºçœ <code>end</code> å’Œ <code>splice()</code> ç¼ºçœ <code>deleteCount</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ä¼šæˆªå–æˆ–åˆ é™¤ <code>start</code> ä¹‹åçš„æ‰€æœ‰å…ƒç´ ï¼Œä¸”åŒ…å« <code>begin</code> æˆ– <code>start</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p>ä»æ˜¯å¦æ”¹å˜åŸæ•°ç»„æ¥åŒºåˆ†ï¼š<code>slice()</code> ä¸ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œè€Œ <code>splice()</code> ä¼šæ”¹å˜åŸæ•°ç»„ã€‚ä»è¿™ç‚¹ä¸Šçœ‹ï¼Œå®ƒä»¬é€‚åˆåº”ç”¨ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><code>slice()</code> é€‚åˆç”¨äºæµ…æ‹·è´æ•°ç»„ï¼Œåœ¨ä¸æ”¹å˜åŸæ•°ç»„çš„å‰æä¸‹ï¼Œæ‹·è´åŸæ•°ç»„çš„ä¸€éƒ¨åˆ†æˆ–æ•´ä¸ªæ•°ç»„ã€‚</li>
<li><code>splice()</code> é€‚åˆåœ¨æ•°ç»„ä¸­æ’å…¥æ–°å…ƒç´ ã€‚</li>
</ul>
</li>
<li>
<p>æ˜¯å¦æˆªå–ï¼ˆæˆ–åˆ é™¤ï¼‰èµ·å§‹é¡¹ã€ç»ˆæ­¢é¡¹çš„é—®é¢˜ï¼Œæ¢ä¸ªè§’åº¦èµ·å§‹å¾ˆå®¹æ˜“åŒºåˆ†ã€‚</p>
<p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œèµ·å§‹é¡¹æˆ–ç»ˆæ­¢é¡¹è®¾ä¸º <code>è´Ÿæ•°</code>ï¼Œä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚æˆ‘ä»¬åªè¦åœ¨å†…å¿ƒå°†å…¶ç¿»è¯‘ä¸ºâ€œæ­£å‘â€çš„ç´¢å¼•å€¼å³å¯ï¼Œæ¯”å¦‚ <code>-1</code> è¡¨ç¤ºæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£å®ƒçš„ç´¢å¼•å€¼å°±æ˜¯ <code>length - 1</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å½“ <code>è´Ÿæ•°</code> å€¼è¶…å‡º <code>-length</code> æˆ– <code>æ­£æ•°</code> å€¼è¶…å‡º <code>length</code> æ—¶ï¼Œè¦ä¹ˆä» <code>0</code> å¼€å§‹æˆ– <code>æ•°å€¼æœ«å°¾</code> å¼€å§‹ã€‚</p>
<ul>
<li><code>slice()</code> ä¼šæˆªå– <code>[begin, end)</code> åŒºé—´çš„å…ƒç´ ã€‚</li>
<li><code>splice()</code> ä¼šåˆ é™¤ <code>[start, start + deleteCount)</code> åŒºé—´çš„å…ƒç´ ã€‚</li>
</ul>
<p>ä»æ•°å­¦çš„åŒºé—´è§’åº¦å»çœ‹ï¼Œè¿™ä¸ªå°±å¾ˆå®¹æ˜“åŒºåˆ†äº†ã€‚</p>
</li>
</ol>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">Array.prototype.slice()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice">Array.prototype.splice()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/slice">String.prototype.slice()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/split">String.prototype.split()</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Node èŠ‚ç‚¹å¸¸ç”¨ API è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/271</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/271</guid>
            <pubDate>Sun, 26 Feb 2023 12:34:30 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7704774d7571cf8f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7704774d7571cf8f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>Node ä¸ Element çš„å…³ç³»</h2>
<p><code>Node</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆåŸºç±»ï¼‰ï¼Œæœ¬èº«ç»§æ‰¿è‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget">EventTargent</a> æ¥å£ï¼Œæœ‰è®¸å¤šæ¥å£éƒ½ä» <code>Node</code> ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ï¼š<code>Document</code>ã€<code>Element</code>ã€<code>Attr</code>ã€<code>CharacterData</code>ï¼ˆwhich <code>Text</code>ã€<code>Comment</code> and <code>CDATASection</code> inheritï¼‰<code>ProcessingInstruction</code>ã€<code>DocumentFragment</code>ã€<code>DocumentType</code>ã€<code>Notation</code>ã€<code>Entity</code>ã€<code>EntityReference</code>ã€‚</p>
<blockquote>
<p><code>Element</code> ç»§æ‰¿äº <code>Node</code>ï¼Œå…·æœ‰ <code>Node</code> çš„æ–¹æ³•ï¼ŒåŒæ—¶åˆæ‹“å±•äº†å¾ˆå¤šè‡ªå·±çš„ç‰¹æœ‰æ–¹æ³•ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼Œéƒ½æ˜æ˜¾åŒºåˆ†äº† <code>Node</code> å’Œ <code>Element</code>ã€‚</p>
<table>
<thead>
<tr>
<th>Node</th>
<th>Element</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>childNodes</code></td>
<td><code>children</code></td>
</tr>
<tr>
<td><code>parentNode</code>ã€<code>parentElement</code></td>
<td></td>
</tr>
<tr>
<td><code>nextSibling</code></td>
<td><code>nextElementSibling</code></td>
</tr>
<tr>
<td><code>previousSibling</code></td>
<td><code>previousElementSibling</code></td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å¸¸è¯´çš„ã€ŒDOM èŠ‚ç‚¹ã€å°±æ˜¯æŒ‡ <code>Node</code>ï¼Œè€Œã€ŒDOM å…ƒç´ ã€æ˜¯æŒ‡ <code>Element</code>ã€‚DOM èŠ‚ç‚¹åŒ…æ‹¬äº† <code>Element</code>ã€<code>Document</code>ã€<code>Comment</code>ã€<code>Text</code> ç­‰ã€‚</p>
<p>å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹ç±»å‹ï¼ˆ<code>nodeType</code>ï¼‰æ¥è¡¨ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>å¸¸é‡</th>
<th>å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Node.ELEMENT_NODE</code></td>
<td><code>1</code></td>
<td>ä¸€ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element" title="å…ƒç´ ">å…ƒç´ </a>èŠ‚ç‚¹ï¼Œä¾‹å¦‚Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/p"><code>&lt;p&gt;</code></a>Â å’ŒÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a>ã€‚</td>
</tr>
<tr>
<td><code>Node.TEXT_NODE</code></td>
<td><code>3</code></td>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element"><code>Element</code></a>Â æˆ–è€…Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Attr"><code>Attr</code></a>Â ä¸­å®é™…çš„Â Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Text" title="æ–‡å­—"><code>æ–‡å­—</code></a></td>
</tr>
<tr>
<td><code>Node.COMMENT_NODE</code></td>
<td><code>8</code></td>
<td>ä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Comment"><code>Comment</code></a>Â èŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td><code>Node.DOCUMENT_NODE</code></td>
<td><code>9</code></td>
<td>ä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>Â èŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td><code>Node.DOCUMENT_TYPE_NODE</code></td>
<td><code>10</code></td>
<td>æè¿°æ–‡æ¡£ç±»å‹çš„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentType"><code>DocumentType</code></a>Â èŠ‚ç‚¹ã€‚ä¾‹å¦‚Â <code>&lt;!DOCTYPE html&gt;</code>Â  å°±æ˜¯ç”¨äº HTML5 çš„ã€‚</td>
</tr>
<tr>
<td><code>Node.DOCUMENT_FRAGMENT_NODE</code></td>
<td><code>11</code></td>
<td>ä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DocumentFragment"><code>DocumentFragment</code></a>Â èŠ‚ç‚¹</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éƒ¨åˆ†ä¸å¸¸ç”¨æˆ–è€…å·²åºŸå¼ƒçš„ï¼Œæ­¤å¤„æœªåˆ—ä¸¾ï¼Œè¯¦è§ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType#%E5%B8%B8%E9%87%8F">Node.nodeType</a>ã€‚</p>
</blockquote>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;Root&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const element = document.getElementById('root')

element.nodeType // 1ï¼Œä¸€ä¸ª Element èŠ‚ç‚¹
element.children // HTMLCollection []
element.childNodes // NodeList [text]
element.childNodes[0].nodeType // 3ï¼Œä¸€ä¸ª Text èŠ‚ç‚¹
element.parentElement // Element body
element.parentNode // Element body
</code></pre>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>Node</code> èŠ‚ç‚¹æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ <code>Element</code>ã€<code>Document</code>ã€<code>Text</code>ã€<code>Comment</code> ç­‰ï¼Œè€Œ <code>Element</code> èŠ‚ç‚¹åªæ˜¯å…¶ä¸­ä¸€ç§è€Œå·²ã€‚</li>
<li><code>Element</code> æ˜¯ <code>Node</code> çš„æ´¾ç”Ÿç±»ï¼Œå› æ­¤ <code>Element</code> èŠ‚ç‚¹å¯ä»¥è®¿é—® <code>Node</code> çš„å±æ€§å’Œæ–¹æ³•ï¼Œåä¹‹ä¸å¯ã€‚</li>
<li><code>Element</code> èŠ‚ç‚¹å¸¸è¢«ç§°ä¸ºâ€œå…ƒç´ â€ã€‚</li>
<li>æ³¨æ„ï¼Œå¸¸è§çš„ <code>document</code> å¯¹è±¡æ˜¯ ä¸ <code>Element</code> ä¸æ˜¯åŒä¸€ç±»å‹çš„èŠ‚ç‚¹ï¼Œå› æ­¤ç§°ä¸º <code>Document</code> èŠ‚ç‚¹æ¯”è¾ƒåˆé€‚ã€‚</li>
</ul>
<h2>Node å¸¸è§å±æ€§</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯»å†™</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Node.nodeType</code></td>
<td>åªè¯»</td>
<td>è¿”å›èŠ‚ç‚¹ç±»å‹ï¼Œå¦‚ä¸Šè¡¨ã€‚</td>
</tr>
<tr>
<td><code>Node.nodeName</code></td>
<td>åªè¯»</td>
<td>è¿”å›èŠ‚ç‚¹åå­—çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString">DOMString</a>ã€‚è‹¥æ˜¯ <code>Element</code> èŠ‚ç‚¹è·Ÿå®ƒç®¡ç†çš„æ ‡ç­¾å¯¹åº”ï¼Œå¦‚ <code>'DIV'</code>ã€<code>'SPAN'</code>ï¼ˆä¸€èˆ¬éƒ½æ˜¯å¤§å†™çš„ï¼‰ã€‚è‹¥æ˜¯ <code>Text</code> èŠ‚ç‚¹å¯¹åº”çš„æ˜¯ <code>'#text'</code>ã€‚è‹¥æ˜¯ <code>Document</code> èŠ‚ç‚¹å¯¹åº”æ˜¯ <code>'#document'</code>ã€‚ï¼ˆè‹¥æ˜¯ <code>Element</code> èŠ‚ç‚¹ï¼Œæœ‰ä¸ªç±»ä¼¼çš„ <code>Element.tagName</code> å±æ€§è¿”å›ï¼‰</td>
</tr>
<tr>
<td><code>Node.nodeValue</code></td>
<td>å¯è¯»å†™</td>
<td>è¿”å›æˆ–è®¾ç½®å½“å‰èŠ‚ç‚¹çš„å€¼ã€‚ä¸€èˆ¬ç”¨äº <code>Text</code>ã€<code>Comment</code> èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ã€‚è€Œåƒ <code>Element</code>ã€<code>Document</code> èŠ‚ç‚¹å…¶è¿”å›å€¼ä¸º <code>null</code>ã€‚è‹¥ <code>nodeValue</code> çš„å€¼ä¸º <code>null</code>ï¼Œåˆ™å¯¹å®ƒèµ‹å€¼ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚</td>
</tr>
<tr>
<td><code>Node.parentNode</code></td>
<td>åªè¯»</td>
<td>è¿”å›ä¸€ä¸ªå½“å‰èŠ‚ç‚¹Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node"><code>Node</code></a>çš„çˆ¶èŠ‚ç‚¹ ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚è¯´åƒè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ ‘ç»“æ„çš„é¡¶ç«¯æˆ–è€…æ²¡æœ‰æ’å…¥ä¸€æ£µæ ‘ä¸­ï¼Œ è¿™ä¸ªå±æ€§è¿”å› <code>null</code>ã€‚</td>
</tr>
<tr>
<td><code>Node.childNodes</code></td>
<td>åªè¯»</td>
<td>è¿”å›ä¸€ä¸ªåŒ…å«äº†è¯¥èŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„å®æ—¶çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList"><code>NodeList</code></a>ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList"><code>NodeList</code></a>Â æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚å¦‚æœè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å‘ç”Ÿäº†å˜åŒ–ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList"><code>NodeList</code></a>å¯¹è±¡å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</td>
</tr>
</tbody>
</table>
<h2>æ·»åŠ èŠ‚ç‚¹</h2>
<p>ä¸€èˆ¬æƒ…å†µï¼Œå¾€ DOM ä¸­æ·»åŠ èŠ‚ç‚¹ï¼Œä¼šä½¿ç”¨ <code>Node.appendChild()</code> æ–¹æ³•å’Œ <code>Element.append()</code> æ–¹æ³•ã€‚å®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯ï¼š<strong>å°†èŠ‚ç‚¹é™„åŠ åˆ°æŒ‡å®šçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨çš„æœ«å°¾å¤„</strong>ã€‚</p>
<p>ä½†æœ‰äº›å·®å¼‚ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><code>Element.append()</code> æ–¹æ³•æ¥å— <code>Node</code> å¯¹è±¡å’Œ <code>DOMString</code> å¯¹è±¡ï¼Œè€Œ <code>Node.appendChild()</code> åªæ¥å— <code>Node</code> å¯¹è±¡ã€‚</p>
</li>
<li>
<p><code>Element.append()</code> æ²¡æœ‰è¿”å›å€¼ï¼Œè€Œ <code>Node.appendChild()</code> è¿”å›è¿½åŠ çš„ Node å¯¹è±¡ã€‚</p>
</li>
<li>
<p><code>Element.append()</code> å¯ä»¥è¿½åŠ å¤šä¸ªèŠ‚ç‚¹å’Œå­—ç¬¦ä¸²ï¼Œè€Œ <code>Node.appendChild()</code> åªèƒ½è¿½åŠ ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
</li>
</ul>
<blockquote>
<p><code>Element.append()</code> æ¥å—å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå…¶å®æ˜¯å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸º <code>Text</code> èŠ‚ç‚¹å†é™„åŠ ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;Root&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const root = document.getElementById('root')

const p = document.createElement('p') // åˆ›å»º p å…ƒç´ 
p.append('paragraph') // å¾€ p å…ƒç´ æ·»åŠ  Text èŠ‚ç‚¹
root.appendChild(p) // appendChild æ¯æ¬¡åªèƒ½æ·»åŠ ä¸€ä¸ª
root.append('123', 'abc') // append å¯ä»¥æ¯æ¬¡å¯æ·»åŠ å¤šä¸ª
</code></pre>
<p>è¿™æ—¶ DOM å˜æˆäº†ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;
  &quot;Root&quot;
  &lt;p&gt;paragraph&lt;/p&gt;
  &quot;123&quot;
  &quot;abc&quot;
&lt;/div&gt;
</code></pre>
<h3>æ³¨æ„ç‚¹</h3>
<ol>
<li><code>Element.append()</code> å‚æ•°è‹¥æ˜¯éå­—ç¬¦ä¸²çš„åŸå§‹å€¼ï¼Œä¼šå…ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ã€‚</li>
</ol>
<pre><code class="language-js">root.append(true) // æˆåŠŸæ·»åŠ ä¸€ä¸ªå€¼ä¸º &quot;true&quot; çš„æ–‡æœ¬èŠ‚ç‚¹
root.append(Symbol('desc')) // å°†ä¼šæŠ›å‡º TypeErrorï¼Œå› ä¸º Symbol å€¼æ— æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Symbol</code> åŸå§‹å€¼ä¸èƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œåªèƒ½å°†å…¶è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œå†è°ƒç”¨ <code>Symbol.prototype.toString()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<ol start="2">
<li>å¦‚æœå°†è¢«æ’å…¥çš„èŠ‚ç‚¹å·²ç»å­˜åœ¨äº DOM ä¸­ï¼Œé‚£ä¹ˆ <code>appendChild()</code> å’Œ <code>append()</code> åªä¼šå°†å®ƒä»åŸå…ˆçš„ä½ç½®ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚</li>
</ol>
<pre><code class="language-html">&lt;div id=&quot;modal&quot;&gt;Modal&lt;/div&gt;
&lt;div id=&quot;root&quot;&gt;Root&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const root = document.getElementById('root')
const modal = document.getElementById('modal')

root.appendChild(modal) // ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ
</code></pre>
<p>DOM å°†ä¼šå˜æˆè¿™æ ·ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;
  &quot;Root&quot;
  &lt;div id=&quot;modal&quot;&gt;Modal&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ç§æƒ…å†µä¸‹åŸæœ‰èŠ‚ç‚¹çš„äº‹ä»¶ç›‘å¬å™¨ä¹Ÿä¼šéšä¹‹ç§»åŠ¨ã€‚</p>
</blockquote>
<ol start="3">
<li><code>Node.appendChild()</code> ä¼ å…¥å¤šä¸ª <code>Node</code> èŠ‚ç‚¹ä¸ä¼šæŠ¥é”™ï¼Œä½†ä»…ç¬¬ä¸€ä¸ªæœ‰æ•ˆã€‚</li>
</ol>
<pre><code class="language-js">const root = document.getElementById('root')
const span1 = document.createElement('span')
span1.append('span1')
const span2 = document.createElement('span')
span2.append('span2')

root.appendChild(span1, span2) // ä»… span1 èŠ‚ç‚¹æ·»åŠ æˆåŠŸ
root.appendChild('string') // ä½†æ˜¯è¿™æ ·ä¼šæŠ¥é”™ï¼ŒTypeError: Failed to execute 'appendChild' on 'Node': parameter 1 is not of type 'Node'.
</code></pre>
<h2>ç§»é™¤èŠ‚ç‚¹</h2>
<p>ç§»é™¤èŠ‚ç‚¹ï¼Œå¯¹åº”çš„æ–¹æ³•æ˜¯ <code>Node.removeChild()</code> å’Œ <code>Element.remove()</code>ã€‚</p>
<ul>
<li><code>Node.removeChild()</code> æ–¹æ³•æ˜¯ä» DOM ä¸­ç§»é™¤ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶è¿”å›åˆ é™¤çš„èŠ‚ç‚¹ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Node èŠ‚ç‚¹ã€‚</li>
<li><code>Element.remove()</code> æ˜¯ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ— è¿”å›å€¼ã€‚</li>
</ul>
<blockquote>
<p>ç”±äº <code>Node.removeChild()</code> ä¼šè¿”å›è¢«ç§»é™¤çš„å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¯¥å­èŠ‚ç‚¹ä»å­˜åœ¨äºå†…å­˜ä¸­ï¼Œå› æ­¤ä½ å¯ä»¥æŠŠè¿™ä¸ªèŠ‚ç‚¹é‡æ–°æ·»åŠ å› DOM ä¸­ã€‚è‹¥æ²¡æœ‰å¯¹è¢«ç§»é™¤èŠ‚ç‚¹ä¿æŒå¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå®ƒå·²ç»æ²¡æœ‰ç”¨äº†ï¼ŒçŸ­æ—¶é—´å†…å°†ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;
  &lt;p id=&quot;p&quot;&gt; p å…ƒç´ èŠ‚ç‚¹&lt;/p&gt;
  &lt;span id=&quot;span&quot;&gt;span å…ƒç´ èŠ‚ç‚¹&lt;/span&gt;
  æ–‡æœ¬èŠ‚ç‚¹
&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const root = document.getElementById('root')
const p = document.getElementById('p')
const span = document.getElementById('span')

p.remove() // &lt;p&gt; èŠ‚ç‚¹ä» DOM ä¸­åˆ é™¤
root.removeChild(span) // &lt;div&gt; çš„å­èŠ‚ç‚¹ &lt;span&gt; è¢«ç§»é™¤ï¼Œä¸å­˜åœ¨å¼•ç”¨ï¼Œå› æ­¤å¾ˆå¿« span å¯¹è±¡å°†ä¼šè¢«å›æ”¶æ‰ã€‚

// ï¸ æ­¤æ—¶ root.childNodes å¯ä¸åªæœ‰ä¸€ä¸ª Node å­èŠ‚ç‚¹ï¼Œå‰é¢ HTML çš„å†™æ³•ï¼Œä¼šäº§ç”Ÿä¸€äº›ç©ºç™½ç¬¦çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚
root.childNodes // NodeList(3)Â [text, text, text]ï¼Œè€Œä¸”æœ€åä¸€ä¸ªæ‰æ˜¯ &quot;\n    æ–‡æœ¬èŠ‚ç‚¹\n  &quot; å¯¹åº”çš„æ–‡æœ¬èŠ‚ç‚¹
</code></pre>
<h2>æ›¿æ¢èŠ‚ç‚¹</h2>
<p><code>Node.replaceChild()</code> æ–¹æ³•ç”¨æŒ‡å®šçš„èŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹çš„ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶è¿”å›è¢«æ›¿æ¢æ‰çš„èŠ‚ç‚¹ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">parentNode.replaceChild(newChild, oldChild)
</code></pre>
<p>è¯·æ³¨æ„ï¼Œç¬¬äºŒä¸ªå‚æ•° oldChild å¿…é¡»æ˜¯ parentNode èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<code>DOMException: Failed to execute 'replaceChild' on 'Node': The node to be replaced is not a child of this node.</code></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;modal&quot;&gt;Modal&lt;/div&gt;
&lt;div id=&quot;root&quot;&gt;Root&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const root = document.getElementById('root')
const modal = document.getElementById('modal')

root.replaceChild(modal, root.childNodes[0]) // å°† modal èŠ‚ç‚¹æ›¿æ¢äº† root èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆå½“ç„¶æœ¬ç¤ºä¾‹ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼‰
</code></pre>
<p>å› æ­¤ï¼ŒDOM å˜æˆäº†ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;
  &lt;div id=&quot;modal&quot;&gt;Modal&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h2>æ’å…¥èŠ‚ç‚¹</h2>
<p>æ’å…¥èŠ‚ç‚¹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ—¶ Node.insertBefore() æ–¹æ³•ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">var insertedNode = parentNode.insertBefore(newNode, referenceNode)
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œè‹¥ç¬¬ä¸€ä¸ªå‚æ•° <code>newNode</code> æ˜¯ DOM ä¸­æŸä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä½¿ç”¨ <code>Node.insertBefore()</code> ä¼šå°†å…¶ä»åŸæ¥çš„ä½ç½®ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚è¿™ç‚¹ä¹Ÿ <code>Node.appendChild()</code> ä¸€è‡´ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;Root&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const root = document.getElementById('root')

// æ–°èŠ‚ç‚¹
const p = document.createElement('p')
p.append('paragraph')

// å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ° root ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹çš„å‰é¢
root.insertBefore(p, root.childNodes[0])
</code></pre>
<p>å› æ­¤ï¼ŒDOM å˜æˆäº†ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;root&quot;&gt;
  &lt;p&gt;paragraph&lt;/p&gt;
  &quot;Root&quot;
&lt;/div&gt;
</code></pre>
<p>æ³¨æ„ä¸¤ç§æƒ…å†µï¼š</p>
<pre><code class="language-js">root.insertBefore(p) // ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šå¾€ root å†…æ’å…¥ä»»ä½•èŠ‚ç‚¹
root.insertBefore(p, null) // å½“å¼•ç”¨èŠ‚ç‚¹ä¸º nullï¼Œp å°†ä¼šè¢«æ’å…¥åˆ° root å­èŠ‚ç‚¹åˆ—è¡¨æœ«å°¾ï¼ˆç±»ä¼¼ appendChild çš„ä½œç”¨ï¼‰
</code></pre>
<p>è¿˜è®°å¾—ä»¥å‰é¡¹ç›®é‡Œé¢ï¼ŒåŠ¨æ€åŠ è½½è„šæœ¬ï¼Œå°±æ˜¯ä½¿ç”¨ <code>insertBefore</code> æ’å…¥åˆ° DOM ä¸­çš„ã€‚</p>
<pre><code class="language-js">const script = document.createElement('script')
script.src = 'https://res.wx.qq.com/open/js/jweixin-1.6.0.js'
script.onload = () =&gt; { /* do something, such as event listener */ }
script.onerror = err =&gt; { /* handle error */ }

const s0 = document.getElementsByTagName('script')[0]
if (s0 &amp;&amp; s0.parentNode) {
  s0.parentNode.insertBefore(script, s0)
}
</code></pre>
<p>æ¯”å¦‚ï¼ŒåŠ¨æ€åŠ è½½å¾®ä¿¡ JSSDKï¼Œç„¶ååœ¨è„šæœ¬åŠ è½½å®Œæˆè°ƒç”¨ <code>wx.config({ ... })</code> æ¥å£æ³¨å…¥æƒé™éªŒè¯é…ç½®ã€‚</p>
<p>The end.</p>
<blockquote>
<p>å‘ç°ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/6844903604445249543">JavaScript æ“ä½œ DOM å¸¸ç”¨çš„ API</a>ï¼Œé‡Œé¢éå¸¸å…¨é¢ï¼Œå¯ç§»æ­¥å‰å¾€ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | let çœŸçš„ä¸ä¼šæå‡å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/270</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/270</guid>
            <pubDate>Sun, 26 Feb 2023 12:33:37 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-36e829cac8b3bae4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-36e829cac8b3bae4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬å°†ä¼šä» ES5 ä¸­ä¸€äº›æ€ªè¯çš„è¡Œä¸ºå‡ºå‘ï¼Œç„¶åå†åˆ° ES6 ä¸­çš„ <code>let</code>ã€<code>const</code> æ˜¯å¦ä¼šã€Œæå‡ã€çš„è®¨è®ºã€‚</p>
<h2>å‰èœ</h2>
<p>å…ˆä¸Šä¸ªå‰èœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{
  var a = 2
  function b() { }
  let c = 1
}
console.log(a) // 2
console.log(b) // Æ’ b()
console.log(c) // ReferenceError: c is not defined
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œç›¸ä¿¡è¿™ä¸ªè°éƒ½æ‡‚ã€‚å†çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">console.log(foo)
{
  function foo() { }
  console.log(foo)
}
console.log(foo)
// è¿™ä¸‰ä¸ª foo å°†ä¼šæ‰“å°ä»€ä¹ˆå‘¢ï¼Ÿ
</code></pre>
<blockquote>
<p>è¯·ä¸è¦çŠ¹ç–‘ï¼Œå¿«é€Ÿç»™å‡ºè„‘æµ·ä¸­â€œç¬¬ä¸€æ„Ÿè§‰â€çš„ç­”æ¡ˆã€‚</p>
</blockquote>
<p>æˆ‘æƒ³å¾ˆå¤šäººçš„ç­”æ¡ˆéƒ½æ˜¯æ‰“å°å‡ºä¸‰ä¸ª <code>Æ’ foo()</code>ï¼Œå¯¹å§ã€‚è®²å®è¯ï¼Œåœ¨å†™ä¸‹æ–‡ç« ä¹‹å‰ï¼Œæˆ‘çš„ç­”æ¡ˆä¹Ÿæ˜¯è¿™ä¸ªã€‚å› ä¸ºä½¿ç”¨ <code>var</code>ã€<code>function</code> å…³é”®å­—çš„å£°æ˜è¯­å¥ä¼šæå‡å•Šï¼Œå› è€Œæœ‰æ­¤ç­”æ¡ˆ...</p>
<p>å…ˆä¸è®ºç­”æ¡ˆå¯¹ä¸é”™ï¼Œæˆ‘ä»¬çœ‹çœ‹å„å¤§æµè§ˆå™¨çš„ç»“æœæ˜¯ä»€ä¹ˆï¼š</p>
<pre><code>1. Safari 14 ä¾æ¬¡æ‰“å°å‡ºï¼ˆJavaScriptCore å¼•æ“ï¼‰
  Æ’ foo()
  Æ’ foo()
  Æ’ foo()

2. Chrome 92ã€Edge 92 (Chromium)ã€Node 14.16.0 ä¾æ¬¡æ‰“å°å‡ºï¼ˆV8 å¼•æ“ï¼‰
  undefined
  Æ’ foo()
  Æ’ foo()

3. Firefox 92 ä¾æ¬¡æ‰“å°å‡ºï¼ˆSpiderMonkey å¼•æ“ï¼‰
  undefined
  Æ’ foo()
  Æ’ foo()
</code></pre>
<p>ä»ç»“æœçœ‹ï¼Œä¸»è¦åŒºåˆ«åœ¨äºç¬¬ä¸€ä¸ª <code>foo</code> æ‰“å°çš„æ˜¯ <code>undefined</code> æˆ– <code>Æ’ foo()</code>ã€‚å¯èƒ½ Safari æµè§ˆå™¨çš„ç»“æœæ›´ç¬¦åˆå¤šæ•°äººçš„è®¤çŸ¥ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„ç»“æœï¼Œç•™ä¸ªæ‚¬å¿µï¼ŒåŸå› ä¸‹é¢ä¼šä»‹ç»...</p>
<h2>ES5 çš„æå‡</h2>
<p>å…ˆæ˜ç¡®ä¸€ç‚¹ï¼š</p>
<blockquote>
<p>ES5ï¼ˆæˆ–æ›´æ—©ï¼‰è§„å®šï¼Œå‡½æ•°åªèƒ½åœ¨é¡¶å±‚ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸé¡¶å±‚å£°æ˜ï¼Œä¸èƒ½åœ¨ä»£ç å—ä¸­å£°æ˜ã€‚</p>
</blockquote>
<p>åŸæ¥ï¼Œä¸Šé¢ç¤ºä¾‹åœ¨ ES5 è§„èŒƒä¸­æ˜¯ä¸åˆæ³•çš„ã€‚ä½†ç”±äºæµè§ˆå™¨å‚å•†éƒ½æ”¯æŒè¿™ä¸ªä¸åˆæ³•çš„è¯­æ³•ï¼Œåªä¸è¿‡å„ JS å¼•æ“çš„å®ç°ç»†èŠ‚ä¸Šå­˜åœ¨å·®å¼‚ï¼Œå› æ­¤æ‰å‡ºç°äº†å‰é¢çš„å·®å¼‚ã€‚</p>
<p>å°±æ¯”å¦‚ <code>__proto__</code> ä»æ¥å°±ä¸æ˜¯ ECMAScript è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼Œåº†å¹¸çš„æ˜¯ <code>__proto__</code> åœ¨å„å¼•æ“è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚ä¹‹å‰æ–‡ç« ã€Š<a href="https://github.com/toFrankie/blog/issues/260">å…³äº Awaitã€Promise æ‰§è¡Œé¡ºåºå·®å¼‚é—®é¢˜</a>ã€‹æåˆ°çš„æƒ…å†µï¼Œä¹Ÿæ˜¯ JS å¼•æ“å®ç°å·®å¼‚æ‰€è‡´ã€‚</p>
<p><strong>è¯·åœ¨ä¸è¦åœ¨å—çº§ä½œç”¨åŸŸä¸‹å£°æ˜å‡½æ•°ï¼Œå¯ç”¨å‡½æ•°è¡¨è¾¾å¼æ›¿ä»£ã€‚</strong></p>
<pre><code class="language-js">function foo() { } // åˆæ³•

{
  function bar() { } // ä¸åˆæ³•ï¼Œä¸”ä¸è¢«æ¨è
  var fn = function () { } // åˆæ³• &amp; åˆç†
}

function baz() {
  function fn() { } // åˆæ³•
}
</code></pre>
<p>åœ¨ ESLint ä¸­è§„åˆ™ <a href="https://alloyteam.github.io/eslint-config-alloy/?language=zh-CN#no-inner-declarations">no-inner-declarations</a> å°±æ˜¯ä¸“é—¨æ£€æŸ¥è¿™ç§æƒ…å†µçš„ï¼Œè‹¥å¯ç”¨å‡½æ•°å£°æ˜å¤„ä¼šå‘å‡ºè­¦å‘Šï¼š<code>Move function declaration to program root.</code></p>
<p>åœ¨ ES5 ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¯¹å‡½æ•°å£°æ˜çš„æŸäº›è¡Œä¸ºåšäº†é™åˆ¶ã€‚</p>
<ol>
<li>åœ¨æ—©äº›ç‰ˆæœ¬ä¸­ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å«å‡½æ•°å£°æ˜è¯­å¥ï¼Œä¼šç›´æ¥æŠ›å‡º <code>SyntaxError </code>ã€‚è€Œåœ¨å½“å‰ç‰ˆæœ¬ï¼ˆå¦‚ Chrome 92ï¼‰æ˜¯ä¸ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯çš„ã€‚</li>
</ol>
<pre><code class="language-js">'use strict'
{
  function fn() { } // SyntaxError: in strict mode code, functions may be declared only at top level or immediately within another function
  console.log(fn)
}

// âš ï¸ è€Œå½“å‰æœ€æ–°ç‰ˆæœ¬æµè§ˆå™¨ä¸­ï¼Œä»¥ä¸Šä»£ç æ˜¯ä¸ä¼šæŠ›å‡ºé”™è¯¯çš„ã€‚
</code></pre>
<ol start="2">
<li>åœ¨ä»£ç å—å†…å‡½æ•°å£°æ˜ï¼Œä¸èƒ½åœ¨ä»£ç å—å¤–éƒ¨ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚åŸå› æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>fn</code> è¢«æå‡è‡³ä»£ç å—çš„é¡¶å±‚ï¼Œè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸé¡¶å±‚ã€‚è¿™ç‚¹å„æµè§ˆå™¨è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚</li>
</ol>
<pre><code class="language-js">'use strict'
console.log(fn) // ReferenceError: fn is not defined
{
  function fn() { }
}
</code></pre>
<blockquote>
<p><a href="https://github.com/toFrankie/blog/issues/232">JavaScript ä¸¥æ ¼æ¨¡å¼è¯¦è§£</a></p>
</blockquote>
<p>å›åˆ°å‰é¢çš„ç¤ºä¾‹ï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰ï¼š</p>
<pre><code class="language-js">console.log(foo)
{
  function foo() { }
  console.log(foo)
}
console.log(foo)
</code></pre>
<p>ä¸ºä»€ä¹ˆè¡Œä¸ºé‚£ä¹ˆæ€ªï¼Œæˆ‘ä»¬æ‰“ä¸ªæ–­ç‚¹å§ï¼ˆä»¥ Firefox ä¸ºä¾‹ï¼Œç”±äº Chrome é‚£ä¸ª <code>window</code> å¯¹è±¡å±•å¼€å¤ªå¤šå±æ€§äº†ï¼Œæˆªå›¾å¤ªå½±å“ç¯‡å¹…äº†ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-78e467933055aa3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>çœ‹åˆ°æ²¡æœ‰ï¼Œä»£ç å—ä¸­ <code>foo</code> çš„å˜é‡æ˜¯æœ‰æå‡è‡³å…¨å±€ä½œç”¨åŸŸé¡¶å±‚çš„ï¼Œå¯......åˆå§‹å€¼æ˜¯ <code>undefined</code> è€Œä¸æ˜¯ <code>Æ’ foo()</code>ï¼ŒChrome æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å½“ä»£ç å¾€ä¸‹æ‰§è¡Œåˆ° <code>function foo() { }</code> ä¼šæ›´æ–° <code>window.foo</code>ï¼Œå› è€Œç»“æœå°±æ˜¯ <code>undefined</code>ã€<code>Æ’ foo()</code>ã€<code>Æ’ foo()</code>ã€‚</p>
<p>è€Œ Safari ä¸­ï¼Œä¸€å¼€å§‹ <code>function foo() {}</code> æå‡è‡³å…¨å±€é¡¶å±‚æ—¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸ Chromeã€Firefox ç»“æœä¸åŒã€‚</p>
<blockquote>
<p>ä¸å¦¨ç”¨ <a href="https://www.babeljs.cn/repl#?browsers=&amp;build=&amp;builtIns=false&amp;corejs=3.6&amp;spec=false&amp;loose=false&amp;code_lz=MYewdgziA2CmB00QHMAUAzEICUAoA3rgARHoCuYwALgJbilarZH5EC-xRokMCSamHLg7cocRCgxZsQA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Creact%2Cstage-0&amp;prettier=true&amp;targets=&amp;version=7.15.3&amp;externalPlugins=">Babel</a> è½¬æ¢ä¸€ä¸‹ã€‚</p>
</blockquote>
<p>ç•™ä¸¤ä¸ªç¤ºä¾‹ï¼Œä½ ä»¬å¯ä»¥å»çœ‹çœ‹éƒ½æ‰“å°äº›ä»€ä¹ˆï¼Œæ˜¯å¦è·Ÿä½ ä»¬é¢„æœŸä¸­çš„ä¸€è‡´ã€‚å°¤å…¶æ˜¯ç¬¬äºŒä¸ªç¤ºä¾‹ã€‚</p>
<pre><code class="language-js">if (true) {
  function foo() { console.log(1) }
} else {
  function foo() { console.log(2) }
}
foo()
</code></pre>
<pre><code class="language-js">var a = 0
if (true) {
  console.log(a)
  a = 1
  function a() { }
  a = 21
  console.log(a)
}
console.log(a)
</code></pre>
<p>è‹¥ç¬¬äºŒä¸ªç¤ºä¾‹çœ‹ä¸æ‡‚ï¼Œè¯·çœ‹<a href="https://stackoverflow.com/questions/61191014/why-does-block-assigned-value-change-global-variable">åˆ†æ</a>ã€‚</p>
<h2>ES6 ä¼šæå‡ï¼Ÿ</h2>
<p>æˆ‘ä»¬çŸ¥é“ ES6 ä¸­å¼•å…¥äº†å—çº§ä½œç”¨åŸŸï¼Œè‡ªæ­¤ JavaScript å°±æ‹¥æœ‰äº†å…¨å±€ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸã€‚</p>
<p><strong>åªè¦é€šè¿‡ <code>let</code>ã€<code>const</code>ã€<code>class</code> å…³é”®å­—å£°æ˜çš„å˜é‡æˆ–ç±»ï¼Œéƒ½å…·æœ‰å—çº§ä½œç”¨åŸŸ</strong>ã€‚è€Œä¸”ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆå£°æ˜ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>ReferenceError</code>ï¼Œè¿™ä¸ªé”™è¯¯ä¸â€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼ˆTemporal Dead Zoneï¼ŒTDZï¼‰æœ‰å…³ã€‚</p>
<pre><code class="language-js">let foo = true

if (true) { // enter new scope, TDZ starts
  // Uninitialized binding for `foo` is created
  console.log(foo) // ReferenceError

  let foo // TDZ ends, `foo` is initialized with `undefined`
  console.log(foo) // undefined

  foo = 1
  console.log(foo) // 1
}

console.log(foo) // true
</code></pre>
<p>å³åœ¨ TDZ starts ä¸  TDZ ends çš„æ—¶é—´è·¨åº¦ï¼Œç§°ä¸ºâ€œæš‚æ—¶æ€§æ­»åŒºâ€ã€‚è¿™ç§æœºåˆ¶ä¹Ÿä½¿å¾— <code>typeof</code> å˜å¾—ä¸å†å®‰å…¨ï¼Œåœ¨æ­¤åŒºé—´å†…å¼•ç”¨å˜é‡ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚å…³äºæ›´å¤š TDZï¼Œè¯·çœ‹ï¼š</p>
<ul>
<li><a href="https://2ality.com/2015/10/why-tdz.html">Why is there a â€œtemporal dead zoneâ€ in ES6?</a></li>
<li><a href="https://exploringjs.com/es6/ch_variables.html#sec_temporal-dead-zone">The temporal dead zone </a></li>
</ul>
<h3>let/const ä¼šæå‡å—ï¼Ÿ</h3>
<p>å…¶å®ï¼Œæ°‘é—´å¯¹äº <code>let</code> ç­‰æ˜¯å¦æå‡çš„é—®é¢˜ï¼Œåˆ†ä¸ºä¸¤æ´¾ï¼š</p>
<ul>
<li>ä¸€æ´¾è®¤ä¸º <code>let</code> æ²¡æœ‰æå‡è¡Œä¸º</li>
<li>å¦ä¸€æ´¾åˆ™è®¤ä¸º <code>let</code> è¿˜æ˜¯æœ‰æå‡è¡Œä¸ºçš„</li>
</ul>
<p>æ— è®ºæå‡ä¸å¦ï¼Œä½†æˆ‘è®¤ä¸ºåœ¨å®é™…ç¼–å†™ä»£ç ä¸­ï¼Œå¤§å®¶å¯¹ <code>let/const</code> çš„ä½¿ç”¨æ˜¯æ¯«æ— ç–‘é—®çš„ã€‚å› ä¸ºå¤§å®¶å¯¹â€œ<strong>ä½¿ç”¨å‰å…ˆå£°æ˜</strong>â€çš„è®¤çŸ¥æ˜¯ç»Ÿä¸€çš„ã€‚ä¹Ÿç›¸ä¿¡å¾ˆå¤šäººæ—©å°±å¼€å§‹ç”¨ <code>let/const</code> å…¨é¢ä»£æ›¿ <code>var</code> äº†ã€‚</p>
<blockquote>
<p>ä¹Ÿå»ºè®®åœ¨é¡¹ç›® ESLint ä¸­å¯ç”¨ <code>no-var</code> è§„åˆ™ã€‚</p>
</blockquote>
<p>æ— è®º <code>let/const</code> æå‡ä¸å¦ï¼Œå‡ ä¹ä¸ä¼šå½±å“å¤§å®¶åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œè€Œä¸”ä¸ä¼šé€ æˆæ··ä¹±ï¼Œå®ƒä»¬æ¯” <code>var/function</code> çš„â€œæå‡â€è¡Œä¸ºæ›´å®¹æ˜“åŒºåˆ†ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯æå‡ï¼Ÿ</h3>
<p>å…³äºâ€œæå‡â€è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå¤§å®¶éƒ½çŸ¥é“ã€‚</p>
<p>ä½†æˆ‘æƒ³è¯´ï¼Œåœ¨ ECMAScript è§„èŒƒä¸­ï¼Œå°½ç®¡æ–‡æ¡£ä¸­ä¸ä¹ç±»ä¼¼ <code>hoisting</code> çš„å•è¯ï¼Œä½†å°±æ˜¯æ²¡æœ‰å¯¹ â€œHoistingâ€ ä¸€è¯ä½œä¸“é—¨å®šä¹‰ã€‚</p>
<p>ä½†åœ¨å‰ç«¯ç¤¾åŒºä¸­ï¼Œ<code>Hoisting</code> çš„è¯´æ³•ç¡®å®å¾ˆå¤šã€‚æˆ‘æƒ³å¯èƒ½æ˜¯å› ä¸ºï¼ŒECMAScript å°± <code>var</code>ã€<code>function</code> å£°æ˜è¯­å¥å°†ä¼šå‰ç½®åˆ°æ‰€åœ¨ä½œç”¨åŸŸé¡¶å±‚çš„è¡Œä¸ºæˆ–ç°è±¡ï¼Œä½¿ç”¨äº† <code>hoisting</code>ã€<code>hoisted</code> ç­‰è¯å»æè¿°ï¼Œç„¶ååœ¨åŠé—´äº’ä¼ æ—¶ï¼Œåœ¨è¯­è¨€è¡¨è¿°æˆ–è®¤çŸ¥ç†è§£ä¸Šæ€»ä¼šå­˜åœ¨åå·®ï¼Œä¹…è€Œä¹…ä¹‹å½¢æˆäº† <code>Hoisting</code> çš„è¯´æ³•ã€‚</p>
<p>ç»¼ä¸Šï¼š<strong>Hoisting ä¸æ˜¯ä¸€ä¸ª ECMAScript è§„èŒƒçš„æœ¯è¯­ï¼Œå®ƒåªæ˜¯æè¿°äº†ä¸€ç§è¡Œä¸ºæˆ–ç°è±¡ã€‚</strong></p>
<h3>åŠé—´å¯¹æå‡çš„ç†è§£</h3>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æˆ‘ä»¬çœ¼é‡Œå®ƒåªæ˜¯ä¸€ä¸ªå†ç®€å•ä¸è¿‡çš„å£°æ˜è¯­å¥è€Œå·²ã€‚</p>
<pre><code class="language-js">var a = 1
</code></pre>
<p>é‚£ä¹ˆ JS å¼•æ“æ˜¯æ€ä¹ˆç†è§£çš„å‘¢ã€‚å°±è¿™æ¡ç®€å•çš„è¯­å¥ï¼Œå¤§æ¦‚ä¼šç»å†è¿™äº›æ­¥éª¤ï¼š</p>
<pre><code class="language-text">ç¼–è¯‘é˜¶æ®µ
  è¯æ³•åˆ†æ
      æ‹†åˆ†æˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„ token

  è¯­æ³•åˆ†æ
      æ£€æŸ¥èƒ½å¦æ„æˆåˆæ³•çš„è¯­å¥ï¼Œå¦‚æ— è¯­æ³•é”™è¯¯ï¼Œå°† tokens å½¢æˆ AST

  ä»£ç ç”Ÿæˆ
      ç”Ÿæˆ JS å¼•æ“çœ‹å¾—æ‡‚çš„ä»£ç 

æ‰§è¡Œé˜¶æ®µ
  åˆ›å»ºå…¨å±€ä¸Šä¸‹æ–‡
      åœ¨æ­¤ä¹‹å‰ JS å¼•æ“è¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå»ç®¡ç†å„ç§ä¸Šä¸‹æ–‡ã€‚ï¼ˆéé‡ç‚¹ä¸å±•å¼€ï¼‰

  è¿›å…¥å…¨å±€ä¸Šä¸‹æ–‡
      ä¸»è¦æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ–çš„ä¸€äº›å·¥ä½œï¼š
          JS å¼•æ“è¯†åˆ«åˆ°`var a` çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå£°æ˜æ“ä½œã€‚
          é¦–å…ˆä»¥ a ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªç©ºé—´ï¼ˆå°†ç”¨äºå­˜å®é™…çš„å€¼ï¼‰ã€‚
          ç„¶åæ ¹æ® ECMAScript å®ç°è¦æ±‚ï¼Œ
          è¿™ä¸ª a å°†ä¼šä½œä¸ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¯ç†è§£ä¸ºä¸€ä¸ª JS å¯¹è±¡ï¼‰
          ä¸­å˜é‡å¯¹è±¡ï¼ˆVOï¼‰çš„ä¸€ä¸ªå±æ€§åï¼Œå¹¶é»˜è®¤å­˜å€¼ä¸º undefinedã€‚
          å°±æ˜¯è¯´ï¼Œåœ¨å‰é¢åˆ†é…çš„å†…å­˜ç©ºé—´ä¸­å­˜å…¥ undefined å€¼ã€‚
          åˆå§‹åŒ–è¿˜æœ‰å…¶ä»–ä¸€äº›å·¥ä½œï¼Œå¦‚ç¡®å®šä½œç”¨åŸŸé“¾ç­‰ã€‚

  æ‰§è¡Œå…¨å±€ä¸Šä¸‹æ–‡
      å‰é¢åˆå§‹åŒ–å·¥ä½œå®Œæˆä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ï¼Œ
      æŒ‰é¡ºåºé€æ¡æ‰§è¡Œä»£ç ï¼ˆè¿™é‡Œè¯´çš„é¡ºåºï¼Œä¸ä¸€æ ·ä¸æºä»£ç ç¼–å†™é¡ºåºä¸€è‡´ï¼Œä½ æ‡‚çš„ï¼‰
      å½“æ‰§è¡Œåˆ° `var a = 1` è¿™è¡Œçš„æ—¶å€™ï¼ŒJS å¼•æ“çœ¼é‡Œå…¶å®æ˜¯ `a = 1` èµ‹å€¼æ“ä½œã€‚
      äºæ˜¯æ ¹æ®æ ‡è¯†ç¬¦ a æ‰¾åˆ°å®ƒåœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œå¹¶å°†çœŸå®å€¼ 1 å­˜å…¥åˆ°è¯¥ç©ºé—´ä¸‹ï¼Œ
      ä»¥è¦†ç›–åŸå…ˆçš„ undefined å€¼ã€‚
      è¿˜æœ‰ä¸€äº›å¦‚å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ this æŒ‡å‘ä¹Ÿæ˜¯åœ¨è¿™è¿‡ç¨‹ç¡®å®šçš„ã€‚
  
      å½“ä»£ç éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡Œæ ˆå°±ä¼šç©ºé—²ä¸‹æ¥ï¼Œæ‘¸ä¼šé±¼ã€‚ç­‰å¾…åé¢æœ‰æ‰§è¡Œä»»åŠ¡å†è¿›å…¥å·¥ä½œçŠ¶æ€ã€‚
</code></pre>
<p>ä¸ºä»€ä¹ˆåˆé‡æ–°æä¸€éè¿™ä¸ªè¿‡ç¨‹ï¼ŒåŸå› æ˜¯ï¼š</p>
<ul>
<li>ä¸€æ´¾äººï¼Œå°†åˆ†é…å†…å­˜ç©ºé—´çš„è¿‡ç¨‹ï¼Œç§°ä¸ºæå‡ã€‚</li>
<li>å¦ä¸€æ´¾äººï¼Œå°†åˆ†é…å†…å­˜åä¼šé»˜è®¤å­˜å€¼çš„è¿‡ç¨‹ï¼Œç§°ä¸ºæå‡ã€‚</li>
</ul>
<p>æ ¹æ®ç¤¾åŒºä¸Šçš„æ™®éè¯´æ³•ï¼Œ<code>let</code> ä¸ <code>var</code> çš„åŒºåˆ«åœ¨äºåˆ†é…å†…å­˜ç©ºé—´åæ˜¯å¦é»˜è®¤å­˜å€¼ï¼Œè‹¥ä½¿ç”¨ <code>let</code> ä¸ä¼šé»˜è®¤å­˜ä¸€ä¸ª <code>undefined</code> å€¼ã€‚<strong>ä½†æˆ‘å¯¹è¿™å¥è¯æ˜¯æœ‰æ‰€ä¿ç•™çš„ã€‚</strong></p>
<p>åŸå› å¦‚ä¸‹ï¼š</p>
<p>åœ¨ ECMAScript è§„èŒƒä¸­å…³äº <a href="http://262.ecma-international.org/#sec-let-and-const-declarations">#14.3.1 Let and Const Declarations</a> æœ‰ä¸€æ®µè¯æ˜¯è¿™ä¹ˆè¯´çš„ï¼ˆåŸæ–‡ç•¥é•¿ï¼Œè¿™é‡Œåˆ†æˆä¸¤æ®µï¼‰ï¼š</p>
<blockquote>
<p><code>let</code> and <code>const</code> declarations define variables that are scoped to the running execution context's LexicalEnvironment. The variables are created when their containing Environment Record is instantiated but may not be accessed in any way until the variable's <em>LexicalBinding</em> is evaluated.</p>
<p>A variable defined by a <em>LexicalBinding</em> with an <em>Initializer</em> is assigned the value of its <em>Initializer's</em> <em>AssignmentExpression</em> when the <em>LexicalBinding</em> is evaluated, not when the variable is created. If a <em>LexicalBinding</em> in a <code>let</code> declaration does not have an <em>Initializer</em> the variable is assigned the value <code>undefined</code> when the <em>LexicalBinding</em> is evaluated.</p>
</blockquote>
<p>ä»¥ <code>let a = 1</code> ä¸ºä¾‹ï¼Œç®€å•è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>ç¬¬ä¸€éƒ¨åˆ†å¤§è‡´æ„æ€ï¼šé€šè¿‡ <code>let/const</code> å£°æ˜çš„å˜é‡ï¼Œå®ƒä¼šè®°å½•å½“å‰è¯æ³•ç¯å¢ƒä¿¡æ¯ï¼Œä¸”åœ¨ <a href="http://262.ecma-international.org/#prod-LexicalBinding">LexicalBinding</a> ä¹‹å‰ï¼Œä¸èƒ½ä»¥è®¿é—®ä»»ä½•æ–¹å¼è®¿é—®ã€‚<code>LexicalBinding</code> æ˜¯è§„åˆ™æè¿°ä¸­çš„ä¸€ä¸ªæŠ½è±¡æ“ä½œï¼Œç”¨ JS ä»£ç æ¯”å–»å°±æ˜¯ <code>let a = 1</code> ä¸­èµ‹å€¼æ“ä½œã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯å½“æ‰§è¡Œä»£ç  <code>let a = 1</code> æ—¶ï¼Œå°†èµ‹å€¼æ“ä½œç¬¦å³è¾¹çš„è¡¨è¾¾å¼çš„å€¼ <code>1</code> ç»‘å®šåˆ°å˜é‡ <code>a</code> ä¸Šã€‚è‹¥æ˜¯ <code>let a</code> è¿™ç§å½¢å¼çš„ï¼Œé‚£ä¹ˆå°† <code>undefined</code> å€¼ï¼ˆæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„çœŸå®å€¼ï¼‰ç»‘å®šåˆ°å˜é‡ <code>a</code> ä¸Šã€‚è¿™å°±æ˜¯å‰ä¸€éƒ¨åˆ†æåˆ°çš„ <code>LexicalBinding</code> è¿‡ç¨‹ã€‚</p>
<p>è¿™æ®µè¯é‡Œï¼Œç”±å§‹è‡³ç»ˆæ²¡æœ‰æåŠæ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ–æ—¶ï¼Œè¦ä¸è¦ä¸ºå˜é‡é»˜è®¤å­˜ä¸€ä¸ª <code>undefined</code> çš„å€¼ã€‚è¿™å°±æ˜¯æˆ‘è¯´æœ‰æ‰€ä¿ç•™çš„åŸå› ã€‚</p>
<h3>JS å¼•æ“çœ¼ä¸­çš„ TDZ</h3>
<p>å¾ˆå¤šäººéƒ½çŸ¥é“ TDZ æ˜¯ä»€ä¹ˆå›äº‹ã€‚</p>
<p>ä½†æˆ‘è¿˜æ˜¯é‚£å¥è¯ï¼šTDZ æ˜¯ ECMAScript è§„èŒƒä¸­çš„ä¸€ä¸ªæœ¯è¯­å—ï¼Ÿ</p>
<p>æŒ‰å…³é”®è¯é€šç¯‡æœç´¢ ECMAScript æ–‡æ¡£å¯çŸ¥ï¼ŒTDZ å¹¶ä¸æ˜¯ ECMAScript è§„èŒƒçš„æœ¯è¯­ã€‚æ®è¯´ TDZ çš„è¯´æ³•æœ€æ—©å‡ºç°åœ¨ ES Discussion çš„è®¨è®ºå¸–ã€‚å› è€Œï¼Œæˆ‘è®¤ä¸º TDZ è·Ÿ Hoisting ä¸€æ ·ï¼Œå®ƒåªæ˜¯æè¿°äº†ä¸€ç§è¡Œä¸ºæˆ–ç°è±¡ã€‚è¿™ç§ç°è±¡å°±æ˜¯ï¼š</p>
<blockquote>
<p>é€šè¿‡ <code>let</code>ã€<code>const</code>ã€<code>class</code> å…³é”®å­—å£°æ˜çš„å˜é‡æˆ–ç±»ï¼Œå®ƒä¸èƒ½åœ¨å£°æ˜ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚</p>
</blockquote>
<p>å‰é¢æåˆ° <code>LexicalBinding</code> ä¹‹å‰ä¸å…è®¸è®¿é—®ï¼Œé‚£ä¹ˆ JS å¼•æ“æ€»è¦å‘Šè¯‰æˆ‘ä»¬ä¸èƒ½è®¿é—®å§ï¼Œäºæ˜¯å°±æŠ›å‡ºä¸€ä¸ª <code>ReferenceError</code> æ¥æé†’æˆ‘ä»¬ï¼šå°ä¼™å­ä½ ä¸èƒ½è¿™ä¹ˆä½¿ç”¨ã€‚</p>
<h3>ä»æµè§ˆå™¨çš„è§’åº¦çœ‹æ˜¯å¦ä¼šæå‡ï¼Ÿ</h3>
<p>å…ˆçœ‹ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">console.log(a) // ReferenceError: a is not defined
let a = 1
</code></pre>
<p>ä¸Šé¢è¿™ä¸¤è¡Œä»£ç ï¼Œé—®è°éƒ½çŸ¥é“å°†ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚ä½†æˆ‘å‘ç°è¿™ä¸ªæŠ¥é”™çš„ Message æ˜¯ä¸åŒçš„ï¼š</p>
<ul>
<li>æŸæ—§ç‰ˆ Chromeï¼š<code>ReferenceError: Cannot access 'a' before initialization</code></li>
<li>æœ€æ–° Chrome 92ï¼š<code>ReferenceError: a is not defined</code></li>
<li>æœ€æ–° Safari 14: <code>ReferenceError: Cannot access 'a' before initialization</code></li>
</ul>
<p>è‡ªä» ES6 å‘å¸ƒ <code>let</code>ã€<code>const</code> ç›¸å…³æ ‡å‡†åï¼Œåç»­è¿™å—å†…å®¹åº”è¯¥æ²¡æœ‰è°ƒæ•´è¿‡äº†ã€‚ä»æç¤ºä¿¡æ¯æ¥çœ‹ï¼Œ<strong>æˆ‘åå‘è®¤ä¸º JS å¼•æ“åœ¨å®ç°æ—¶è¿˜æ˜¯ä¼šå­˜åœ¨â€œæå‡â€è¡Œä¸ºçš„ã€‚</strong></p>
<p>å†çœ‹å¦ä¸€ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function foo() {
  console.log('')
  let a = 1
}
foo()
</code></pre>
<p>æˆ‘ä»¬åˆ†åˆ«ä» Chromeã€Firefoxã€Safari ä¸­è§‚å¯Ÿä»¥ä¸Šç¤ºä¾‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-59c731d7eeed70da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Chrome 92"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-58def866b03ec7be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Firefox 92"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-26325e4325da42df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Safari 14"></p>
<p>æˆ‘åœ¨ <code>let a = 1</code> å‰ä¸€è¡Œè¯­å¥æ·»åŠ äº†æ–­ç‚¹ï¼Œä»ç»“æœä¸Šçœ‹ä¸å®Œå…¨ç›¸åŒã€‚Chromeã€Safari ä¸­ <code>a</code> çš„å€¼æ˜¯ <code>undefined</code>ï¼Œè€Œ FireFox ä¸­ <code>a</code> ä¸º <code>uninitialized</code>ã€‚ä½†æ˜¯å®ƒä»¬éƒ½åœ¨ <code>let a = 1</code> ä¹‹å‰å°±å­˜åœ¨äº†å˜é‡ <code>a</code>ï¼Œå³ä½¿åœ¨ä¸‹ä¸€è¡Œä¸­éƒ½å°†ä¼šæŠ¥é”™ã€‚</p>
<p>ä¹Ÿå†æ¬¡ä½è¯äº† <code>let/const/class</code> å£°æ˜è¯­å¥æ˜¯ä¼šäº§ç”Ÿæå‡è¡Œä¸ºã€‚</p>
<blockquote>
<p><strong>å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯å¿…é¡»åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œå®šä¹‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</strong></p>
</blockquote>
<h3>è‹¥æå‡ï¼Œå®ƒè¢«æå‡åˆ°å“ªï¼Ÿ</h3>
<p>è¯·çœ‹ç¤ºä¾‹</p>
<pre><code class="language-js">if (true) {
  let a = 1
  console.log(a) // 1
}
console.log(a) // ReferenceError: a is not defined
</code></pre>
<p>å°½ç®¡ä¼šæå‡ï¼Œå®ƒåªä¼šæå‡è‡³å½“å‰ä»£ç å—çš„é¡¶å±‚ï¼Œæ‰€ä»¥åœ¨ <code>if</code> è¯­å¥å¤–éƒ¨æ— æ³•è®¿é—® <code>a</code> å˜é‡ï¼Œå› è€ŒæŠ¥é”™ã€‚</p>
<h2>æ€»ç»“</h2>
<p>å°±æœ¬æ–‡å†…å®¹ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>è·Ÿ let/const æ— å…³ï¼Œè·Ÿæ˜¯å¦ä¸¥æ ¼æ¨¡å¼ç›¸å…³ã€‚</p>
<blockquote>
<p>é‰´äºå„æµè§ˆå™¨å®ç°å·®å¼‚ï¼Œæ— è®ºæ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œè¯·ä¸è¦åœ¨å—çº§ä½œç”¨åŸŸä¸­å£°æ˜å‡½æ•°ã€‚</p>
</blockquote>
<p>let/const ä¼šæå‡å—ï¼Ÿ</p>
<ul>
<li>ä»æµè§ˆå™¨è§’åº¦çœ‹ï¼Œ<code>let/const/class</code> ç¡®å®æ˜¯å­˜åœ¨æå‡è¡Œä¸ºçš„ã€‚</li>
<li>ä»ä½¿ç”¨è§’åº¦çœ‹ï¼Œä¸éœ€è¦å…³å¿ƒ <code>let/const/class</code> æ˜¯å¦ä¼šæå‡ï¼Œå®ƒå¿…é¡»åœ¨ä½¿ç”¨å‰è¿›è¡Œå®šä¹‰ã€‚</li>
<li>ä»é¢è¯•å®˜è§’åº¦ï¼Œæˆ‘è®¤ä¸ºä»–æƒ³å¬åˆ°çš„ç­”æ¡ˆæ˜¯ï¼š<code>let/const/class</code> æ˜¯ä¼šæå‡çš„â€ã€‚è‹¥ä½ ç®€å•ä» ECMAScript è§„èŒƒã€æµè§ˆå™¨è°ƒè¯•ç»“æœå»å›ç­”ï¼Œè¿™é¢˜å°±åŸºæœ¬èƒ½æ‹¿æ»¡åˆ†ã€‚</li>
<li>å¦‚æœæœ¬æ–‡æ‰€è¯´çš„â€œæå‡â€ä¼šè®©ä½ æ„Ÿåˆ°å›°æƒ‘çš„è¯ï¼Œè¯·åšå®šä¸ç§»åœ°ç›¸ä¿¡ <code>let/const/class</code> æ˜¯ä¸å­˜åœ¨æå‡è¡Œä¸ºçš„ã€‚</li>
</ul>
<p>è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸å¿…è¿‡åˆ†å…³æ³¨ <code>let/const/class</code> ç­‰å£°æ˜çš„å˜é‡æˆ–ç±»æ˜¯å¦å­˜åœ¨â€œæå‡â€ç°è±¡ã€‚ä½†å¦‚æœä½œä¸ºåŸºç¡€æ‹“å±•ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹çš„...</p>
<p><strong>å»ºè®®</strong></p>
<p>åœ¨é‡åˆ°ä¸€äº›ä¸å¤ªç†è§£çš„ ES6 è¯­æ³•çš„æ—¶å€™ï¼Œä¸å¦¨ä½¿ç”¨ <a href="https://www.babeljs.cn/repl#?browsers=&amp;build=&amp;builtIns=false&amp;corejs=3.6&amp;spec=false&amp;loose=false&amp;code_lz=MYewdgziA2CmB00QHMAUAzEICUAoA3rgARHoCuYwALgJbilarZH5EC-xRokMCSamHLg7cocRCgxZsQA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Creact%2Cstage-0&amp;prettier=true&amp;targets=&amp;version=7.15.3&amp;externalPlugins=">Babel</a> è½¬æ¢ä¸€ä¸‹ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¯´ä¸å®šä¼šæœ‰çµå…‰ä¸€ç°çš„æ„Ÿè§‰ã€‚</p>
<p>æ¯”å¦‚å¼€å¤´çš„ç¤ºä¾‹ Babel è½¬æ¢ä¹‹åï¼Œå°±å˜æˆä¸‹é¢è¿™æ ·ï¼Œç„¶åç»“åˆè‡ªå·±çš„ç†è§£ï¼Œæƒ³æƒ³ä¸ºä»€ä¹ˆå®ƒè¦è¿™ä¹ˆåšã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;
console.log(foo);
{
  var _foo = function _foo() {};
  console.log(_foo);
}
console.log(foo);
</code></pre>
<p>è¿™ä¸€æ‹›æ˜¯æˆ‘çœ‹æŸç¯‡æ–‡ç« çš„æ—¶å€™å­¦åˆ°çš„...</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Arguments å¯¹è±¡ä¸ç®€æ˜“æŸ¯é‡ŒåŒ–]]></title>
            <link>https://github.com/toFrankie/blog/issues/269</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/269</guid>
            <pubDate>Sun, 26 Feb 2023 12:31:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-41d0c7b82d1a5a3c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-41d0c7b82d1a5a3c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ç®€è¿°</h2>
<p><code>arguments</code> æ˜¯å‡½æ•°å®å‚å¯¹è±¡ï¼Œå¸¸è¢«ç§°ä¸ºâ€œç±»æ•°ç»„â€ï¼ˆarray-likeï¼‰ã€‚å½¢å¦‚ï¼š</p>
<pre><code class="language-js">arguments = {
  0: xx,
  1: xx,
  ...,
  n - 1: xx,
  length: n // n å–å†³äºå®å‚çš„æ•°é‡
}
</code></pre>
<p><code>arguments</code> çš„ä¸€äº›ç‰¹æ€§ï¼š</p>
<pre><code class="language-js">function foo() {
  // 1. arguments ä¸æ˜¯æ•°ç»„ï¼Œè‡ªç„¶ä¹Ÿä¸å…·å¤‡æ•°ç»„ forEach ç­‰æ–¹æ³•
  Object.prototype.toString.call(arguments) // &quot;[object Arguments]&quot;
  arguments instanceof Array // false

  // 2. arguments å¯¹è±¡å…·æœ‰æ•°å­—ç´¢å¼•å±æ€§
  arguments[0] // &quot;a&quot;
  arguments[1] // &quot;b&quot;
  
  // 3. arguments å¯¹è±¡æœ‰ length å±æ€§ï¼Œåæ˜ å®å‚ä¸ªæ•°ã€‚
  //    ä½†ä¸å‡½æ•°çš„ length å±æ€§ä¸åŒï¼Œfoo.length åæ˜ å½¢å‚ä¸ªæ•°ã€‚å¯åœ¨ ES6 ä¹‹åç”±äºå‚æ•°é»˜è®¤å€¼ã€REST å‚æ•°ç­‰æ–°ç‰¹æ€§ï¼Œä½¿ foo.length å˜å¾—ä¸å¯é 
  arguments.length // 2
  foo.length // 0
}

foo('a', 'b')
</code></pre>
<p>ç±»æ•°ç»„å¯¹è±¡çš„ç‰¹å¾ï¼šå«æœ‰ <code>length</code> å±æ€§ã€ç´¢å¼•å…ƒç´ å±æ€§ï¼Œä½†ä¸åŒ…å«æ•°ç»„ä»»ä½•æ–¹æ³•ã€‚</p>
<p>å¸¸è§çš„ç±»æ•°ç»„ï¼Œé™¤äº† <code>arguments</code> ä¹‹å¤–ï¼Œè¿˜æœ‰ <code>HTMLCollection</code>ï¼ˆé€šè¿‡ <code>getElementsByName()</code> ç­‰è¿”å›çš„ DOM åˆ—è¡¨ï¼‰ã€<code>NodeList</code>ï¼ˆé€šè¿‡ <code>querySelectorAll()</code> è¿”å›çš„èŠ‚ç‚¹åˆ—è¡¨ï¼‰ã€‚</p>
<h2>arguments ä½¿ç”¨</h2>
<p><code>arguments</code> é€šå¸¸ç”¨äºä¸èƒ½ç¡®å®šå®å‚ä¸ªæ•°çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚å‡½æ•°æŸ¯é‡ŒåŒ–ç­‰ã€‚</p>
<p>å®ƒè¿˜ç»å¸¸è¢«è½¬æ¢ä¸ºæ•°ç»„ä½¿ç”¨ã€‚</p>
<pre><code class="language-js">// ES5
function foo() {
  // æ–¹æ³•ä¸€ï¼šä¼šé˜»æ­¢æŸäº› JS å¼•æ“çš„ä¼˜åŒ–ï¼Œå¦‚ V8
  // è¯·çœ‹ï¼šhttps://github.com/petkaantonov/bluebird/wiki/Optimization-killers#3-managing-arguments
  var args = Array.prototype.slice.call(arguments) 
  // var args = [].slice.call(arguments)

  // æ–¹æ³•äºŒï¼ˆæ¨èï¼Œå°½ç®¡ä¸‘äº†ç‚¹ï¼‰
  var args = arguments.length === 1 ? [arguments[0]] : Array.apply(null, arguments)
}

// ES6
function foo() {
  // åˆ©ç”¨ arguments çš„ Iterator æ¥å£ï¼Œå¯ä»¥å¿«é€Ÿè½¬åŒ–ä¸ºæ•°ç»„
  const args = [...arguments]
  // const args = Array.from(arguments)
}
function foo(...args) {
  // ç›´æ¥ä½¿ç”¨ REST å‚æ•°ï¼Œargs å¤©ç”Ÿå°±æ˜¯æ•°ç»„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Array çš„æ–¹æ³•
}
</code></pre>
<p>åƒ <code>Function.prototype.apply()</code>ã€<code>Array.prototype.slice()</code> ç­‰æ–¹æ³•ä¹Ÿå¯æ¥å—ç±»æ•°ç»„ï¼Œæ— éœ€è½¬æ¢ä¸ºæ•°ç»„å†è¿›è¡Œæ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">// æ±‚æœ€å¤§æ•°
function getMax() {
  return Math.max.apply(null, arguments)
}

getMax(1, 2, 3) // 3
</code></pre>
<p>éƒ½ 2021 å¹´äº†ï¼Œæ›´è¢«æ¨èæŒ‰ ES6 çš„å†™æ³•ã€‚</p>
<h2>æ³¨æ„ç‚¹</h2>
<p>å…³äº <code>arguments</code> åªèƒ½åœ¨æ‰€æœ‰ï¼ˆéç®­å¤´ï¼‰å‡½æ•°å†…éƒ¨å¯ç”¨çš„å±€éƒ¨å˜é‡ã€‚</p>
<blockquote>
<ul>
<li>
<p>å­˜åœ¨äºæ‰€æœ‰ï¼ˆéç®­å¤´ï¼‰å‡½æ•°å†…éƒ¨ã€‚å‡½æ•°ä¸Šä¸‹æ–‡çš„ <code>AO</code> å¯¹è±¡å°±åŒ…æ‹¬ <code>arguments</code> å±æ€§ã€‚</p>
</li>
<li>
<p>ç®­å¤´å‡½æ•°ä¸å­˜åœ¨ <code>arguments</code> å¯¹è±¡ã€‚æœ‰æ—¶å€™ç®­å¤´å‡½æ•°å†…å¯ä»¥ä½¿ç”¨ <code>arguments</code> æ˜¯â€œè§†è§‰â€è®¤çŸ¥é”™è¯¯ã€‚</p>
</li>
<li>
<p>ES6 çš„ç®­å¤´å‡½æ•°ä¸­ï¼Œè¦è·å–å®å‚å¯¹è±¡ï¼Œå¯é€šè¿‡ REST å‚æ•°è·å¾—ã€‚</p>
</li>
<li>
<p>éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>arguments</code> å…è®¸é‡æ–°èµ‹å€¼ã€‚è€Œä¸”å½¢å‚çš„æ›´æ–°ï¼Œä¹Ÿä¼šä¼´éšç€ <code>arguments</code> å¯¹è±¡ç›¸åº”å±æ€§å€¼çš„æ›´æ–°ã€‚</p>
</li>
<li>
<p>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ™ä¸å…è®¸å¯¹ <code>arguments</code> å¯¹è±¡èµ‹å€¼ï¼Œä¸”ä¸ä¼šæœ€ç»ˆå‚æ•°çš„å˜åŒ–ã€‚ä¹Ÿä¸å…è®¸ä½¿ç”¨ <code>arguments.callee</code> æ–¹æ³•ï¼ˆå…³äºä¸¥æ ¼æ¨¡å¼å¯¹ arguments å¯¹è±¡çš„é™åˆ¶ï¼Œå¯çœ‹è¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/232">æ–‡ç« </a>ï¼‰ã€‚</p>
</li>
</ul>
</blockquote>
<p>åœ¨å‡½æ•°å¤–ä½¿ç”¨ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚æ­¤æ—¶å®ƒå°±æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦è€Œå·²ã€‚</p>
<pre><code class="language-js">// 1. ç›¸å½“äºä¸€ä¸ªå˜é‡ argumentsï¼Œå› æ­¤ä¼šæŠ›å‡ºå¼•ç”¨é”™è¯¯
console.log(arguments) // ReferenceError: arguments is not defined

// 2. éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¯å°†å…¶ä½œä¸ºå˜é‡
let arguments = 1 // or arguments = 'any'
console.log(arguments) // 1

// 3. ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿˜æ˜¯å°†å…¶å£°æ˜å˜é‡æˆ–å¯¹å…¶è¿›è¡Œèµ‹å€¼æ“ä½œ
'use strict'
arguments = 1 // Wrong, SyntaxError: 'arguments' can't be defined or assigned to in strict mode code
</code></pre>
<p>åœ¨ç®­å¤´å‡½æ•°å†…ï¼Œæ²¡æœ‰ <code>arguments</code> å˜é‡ã€‚ä¾‹å¦‚ä»¥ä¸‹è¿™æ ·ä½¿ç”¨åŒæ ·ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">const foo = () =&gt; {
  console.log(arguments) // ReferenceError: arguments is not defined
}

foo()
</code></pre>
<p>ä½†è¿™æ ·ç”¨ä¸ä¼šæŠ¥é”™ï¼Œè¿™å°±æ˜¯å‰é¢æåˆ°çš„â€œè§†è§‰è®¤çŸ¥â€é”™è¯¯ã€‚</p>
<pre><code class="language-js">function foo() {
  const bar = () =&gt; {
    console.log(arguments) 
    // ç”±äºç®­å¤´å‡½æ•° bar æ²¡æœ‰ argumentsï¼Œ
    // è¿™é‡Œå¼•ç”¨çš„ arguments å¯¹è±¡å…¶å®æ˜¯å‡½æ•° foo çš„å®å‚å¯¹è±¡ã€‚
  }
  bar('b')
}

foo('a') // { 0: 'a', length: 1 }
</code></pre>
<p>éä¸¥æ ¼æ¨¡å¼ä¸ä¸¥æ ¼æ¨¡å¼ï¼Œå¯¹ <code>arguments</code> å¯¹è±¡çš„æ“ä½œã€‚</p>
<pre><code class="language-js">function foo(x) {
  x = 10
  console.log(x) // 10
  console.log(arguments[0]) // 10
}

function bar(x) {
  'use strict'
  x = 10
  console.log(x) // 10
  console.log(arguments[0]) // 1

  // ä»¥ä¸‹è¿™æ ·å°†ä¼šç›´æ¥æŠ›å‡ºè¯­æ³•é”™è¯¯ï¼šSyntaxError: Unexpected eval or arguments in strict mode
  // arguments = {}
}

foo(1)
bar(1)
</code></pre>
<h2>æ±‚å’Œå‡½æ•°ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ±‚å’Œå‡½æ•° <code>sum()</code>ï¼Œè¦å®ç°ä¸‹é¢çš„éœ€æ±‚ï¼š</p>
<pre><code class="language-js">sum(1, 2, 3) // 6
sum(1, 2)(3)(4) // 10
sum(1)(2, 3)(4, 5, 6) // 21
// ...
</code></pre>
<p>å…¶å®ä¸Šé¢çš„éœ€æ±‚æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒæ²¡æœ‰å‡ºå£ï¼Œå¯¼è‡´ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ±‚å’Œã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®æ”¹ä¸‹éœ€æ±‚ï¼š</p>
<pre><code class="language-js">sum(1, 2, 3).value() // 6
sum(1, 2)(3)(4).value() // 10
sum(1)(2, 3)(4, 5, 6).value() // 21
// ...
</code></pre>
<p>å°±æ˜¯è¯´ <code>sum()</code> å‡½æ•°çš„ç»“æŸæ—¶æœºï¼ˆå‡ºå£ï¼‰æ˜¯è°ƒç”¨ <code>value()</code> æ–¹æ³•çš„æ—¶å€™ã€‚</p>
<pre><code class="language-js">function sum(...args) {
  const arr = [...args]
  function repeat(...nextArgs) {
    ;[].push.apply(arr, nextArgs)
    return repeat
  }
  repeat.value = () =&gt; {
    if (!arr.length) return 0
    return arr.reduce((a, b) =&gt; a + b)
  }
  return repeat
}
</code></pre>
<p>ä¹Ÿå¯ä»¥æ”¹æˆè°ƒç”¨ <code>sum(1, 2)(3)(4)()</code> æ—¶è¿›è¡Œæ±‚å’Œï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">function sum(...args) {
  if (!args.length) return 0
  const arr = [...args]
  function repeat(...nextArgs) {
    if (!nextArgs.length) {
      return arr.reduce((a, b) =&gt; a + b)
    }
    ;[].push.apply(arr, nextArgs)
    return repeat
  }
  return repeat
}

sum() // 0
sum(1, 2, 3)() // 6
sum(1, 2)(3)(4)() // 10
sum(1)(2, 3)(4, 5, 6)() // 21
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ä½œç”¨åŸŸé“¾ç®€è¿°]]></title>
            <link>https://github.com/toFrankie/blog/issues/268</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/268</guid>
            <pubDate>Sun, 26 Feb 2023 12:29:33 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-86abe817fb23b4d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-86abe817fb23b4d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç»§ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://github.com/toFrankie/blog/issues/266">JavaScript è„šæœ¬ç¼–è¯‘ä¸æ‰§è¡Œè¿‡ç¨‹ç®€è¿°</a>ï¼Œå†æ¥ä»‹ç»ä¸€ä¸‹ JavaScript ä¸­çš„ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰ã€‚</p>
<p>å‡½æ•°çš„ <code>[[scope]]</code> ä¹Ÿæ˜¯ä¸é—­åŒ…ç›´æ¥ç›¸å…³ã€‚å¹¶æ¨èä¸“é¢˜ï¼š</p>
<blockquote>
<ul>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/17">JavaScript æ·±å…¥ç³»åˆ— 15 ç¯‡ï¼ˆå†´ç¾½ï¼‰</a></li>
<li><a href="http://www.nowamagic.net/librarys/veda/detail/1579">JavaScript ä¸“é¢˜ï¼ˆVedaï¼‰</a></li>
</ul>
</blockquote>
<h4>ä½œç”¨åŸŸé“¾çš„å½¢æˆ</h4>
<p>ä½œç”¨åŸŸé“¾ï¼ˆä»¥ä¸‹ç®€ç§° <code>Scope</code>ï¼‰ä¸æ‰§è¡Œä¸Šä¸‹æ–‡ç›¸å…³ã€‚</p>
<pre><code class="language-js">å…¨å±€ä¸Šä¸‹æ–‡ï¼š
  å…¶ Scope å°±æ˜¯ GlobalContext.VOï¼Œå³ window å¯¹è±¡ã€‚

å‡½æ•°ä¸Šä¸‹æ–‡ï¼š
  å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡çš„ Scope è¢«åˆ›å»ºï¼ŒåŒ…æ‹¬ AO å’Œè¿™ä¸ªå‡½æ•°å†…éƒ¨çš„ [[scope]] å±æ€§ã€‚
</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´å½“å‰ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ï¼š<code>Scope =  AO + function.[[scope]]</code>ã€‚</p>
<h4>å‡½æ•°å†…éƒ¨ [[scope]] å±æ€§çš„å½¢æˆ</h4>
<p>å½“å‡½æ•°è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå±æ€§ <code>[[scope]]</code> ä¼šä¿å­˜æ‰€æœ‰çš„çˆ¶çº§å˜é‡å¯¹è±¡ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function foo() {
  // some statements...
}
</code></pre>
<p>ä¸Šè¿°ä¾‹å­ï¼Œå‡½æ•° <code>foo</code> å¤„äºå…¨å±€ä¸Šä¸‹æ–‡ã€‚è€Œå…¨å±€ä¸Šä¸‹æ–‡ä¸­æ‰€å£°æ˜çš„å‡½æ•°ï¼Œå®ƒä»¬çš„ <code>[[scope]]</code> æ˜¯ <code>GlobalContext.VO</code>ï¼Œå³ <code>window</code> å¯¹è±¡ã€‚å› æ­¤ <code>foo.[[scope]] = [ GlobalContext.VO ]</code>ã€‚</p>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-js">function foo() {
  function bar() {
    // some statements...
  }
}
</code></pre>
<p>åŒæ ·åœ°ï¼Œå‡½æ•° <code>foo</code> çš„ <code>[[scope]]</code> å±æ€§ä¸º <code>GlobalContext.VO</code>ã€‚ç„¶åè°ƒç”¨ <code>foo</code> å‡½æ•°ï¼Œè¿›å…¥ <code>foo</code> å‡½æ•°ä¸Šä¸‹æ–‡å¹¶è¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒ…æ‹¬ä»¥ä¸‹è¿‡ç¨‹ï¼š</p>
<ol>
<li>ä»¥å½“å‰å‡½æ•° <code>foo.[[scope]]</code> ä¸ºåŸºç¡€åˆå§‹åŒ–å‡½æ•°ä¸Šä¸‹æ–‡çš„ <code>Scope</code>ã€‚</li>
<li>åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„ <code>AO</code> å¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>Arguments</code>ã€å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ã€‚
è¯¥è¿‡ç¨‹è‹¥æœ‰å‡½æ•°å£°æ˜ï¼Œå¯¹åº”å‡½æ•°çš„ <code>[[scope]]</code> ä¹Ÿå°†ä¼šè¢«ç¡®å®šï¼Œå…¶å€¼å°±æ˜¯ <code>Scope</code>ã€‚</li>
<li>å½“ <code>AO</code> åˆå§‹åŒ–å®Œæˆåï¼Œå°† <code>AO</code> æ’å…¥ä¸Šä¸‹æ–‡çš„ <code>Scope</code> ä¸­ã€‚</li>
</ol>
<p>å› æ­¤æœ‰ä¸¤ä¸ªç»“è®ºï¼š</p>
<blockquote>
<ul>
<li>å½“å‰ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ <code>Scope = AO + foo.[[scope]]</code>ã€‚</li>
<li>å½“å‰ä¸Šä¸‹æ–‡å†…å®šä¹‰çš„å‡½æ•° <code>bar</code>ï¼Œå…¶ <code>[[scope]]</code> å±æ€§å€¼ä¸ºä¸Šä¸‹æ–‡çš„ <code>Scope</code>ï¼Œå³ <code>AO + foo.[[scope]]</code>ã€‚</li>
</ul>
</blockquote>
<p>æ³¨æ„ï¼Œå³ä¾¿æ˜¯å‡½æ•°è¡¨è¾¾å¼ï¼Œå®ƒåœ¨ä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰ä¼šç¡®å®šå…¶ <code>[[scope]]</code>ï¼Œç”±äºæ‰§è¡Œè¿‡ç¨‹ä¸­ <code>AO</code> ä¹Ÿä¼šè·Ÿç€æ›´æ–°ï¼Œä¸”å®ƒä»¬æ˜¯å¼•ç”¨å…³ç³»ï¼Œå› æ­¤æ€»èƒ½ç¡®ä¿ï¼Œå½“å‰ä½œç”¨åŸŸå†…çš„å‡½æ•°ï¼ˆå‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼ï¼‰çš„ <code>[[scope]]</code> æ€»æ˜¯ <code>AO + å„çˆ¶çº§ä¸Šä¸‹æ–‡çš„ AO/VO</code>ã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨ <code>Function</code> æ„é€ å™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ <code>[[scope]]</code> åªæœ‰ <code>GlobalContext.VO</code>ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰§è¡Œ <code>bar</code> å‡½æ•°ä¼šå»ä½œç”¨åŸŸé“¾ä¸ŠæŸ¥æ‰¾ <code>a</code> å˜é‡ï¼Œå¯å®ƒçš„ä½œç”¨åŸŸé“¾åªå«å…¨å±€å¯¹è±¡ï¼Œå¯¼è‡´æ‰¾ä¸åˆ° <code>a</code> å˜é‡è€ŒæŠ›å‡º <code>ReferenceError</code>ã€‚</p>
<pre><code class="language-js">function foo() {
  var a = 1
  var bar = new Function('console.log(a)')
  bar() // ReferenceError: a is not defined
}

foo()
</code></pre>
<p>å› æ­¤ï¼Œå°½é‡ä¸è¦ä½¿ç”¨æ„é€ å‡½æ•°çš„æ–¹å¼æ¥åˆ›å»ºå‡½æ•°ã€‚</p>
<h4>å½±å“ä½œç”¨åŸŸé“¾çš„ä¸€äº›ä¾‹å­</h4>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªä½œç”¨åŸŸé“¾ <code>Scope</code> åŒ…æ‹¬çˆ¶çº§å˜é‡å¯¹è±¡ã€å‡½æ•°ä¸Šä¸‹æ–‡çš„æ´»åŠ¨å¯¹è±¡ <code>AO</code>ï¼Œå¹¶ä»å½“å‰ä¸Šä¸‹æ–‡é€çº§å¾€ä¸ŠæŸ¥è¯¢ã€‚</p>
<blockquote>
<p>æé†’ä¸€ä¸‹ï¼šå½“æˆ‘ä»¬ä»å¯¹è±¡ä¸ŠæŸ¥è¯¢æŸä¸ªå±æ€§ï¼Œé¦–å…ˆä»å¯¹è±¡è‡ªèº«å±æ€§ä¸ŠæŸ¥æ‰¾ï¼Œå½“æ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šå¾€åŸå‹ä¸ŠæŸ¥æ‰¾......ç›´è‡³åŸå‹é“¾çš„é¡¶ç«¯ <code>Object.prototype</code> å†æŸ¥è¯¢ä¸åˆ°å°±è¿”å› <code>undefined</code>ã€‚</p>
</blockquote>
<p>å…¶å®ä½œç”¨åŸŸé“¾çš„åŸç†è·ŸåŸå‹é“¾å¾ˆç±»ä¼¼ï¼Œå½“å‰å¦‚æœè¿™ä¸ªå˜é‡åœ¨è‡ªå·±çš„ä½œç”¨åŸŸä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆå®ƒä¼šå¾€çˆ¶çº§æŸ¥æ‰¾ï¼Œç›´è‡³æœ€é¡¶å±‚ï¼ˆå…¨å±€å¯¹è±¡ï¼‰ï¼Œå†æŸ¥æ‰¾ä¸åˆ°å°±ä¼šæŠ›å‡º <code>ReferenceError</code>ã€‚</p>
<p>å‰é¢è®²è¿‡ï¼Œå½“å‰ä¸Šä¸‹æ–‡ï¼ˆä½œç”¨åŸŸï¼‰å†…å£°æ˜çš„å˜é‡æˆ–å‡½æ•°ï¼Œæ˜¯ä»¥å±æ€§çš„å½¢å¼ï¼Œæ”¾åˆ°ä¸€ä¸ªå˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼‰ä¸Šçš„ã€‚ä½†ç”±äº <code>VO</code> æ˜¯æ— æ³•é€šè¿‡ä»£ç è®¿é—®çš„ï¼Œå› æ­¤åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ <code>VO</code> è¢«æ¿€æ´»å½¢æˆä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼ˆActivation Objectï¼‰ï¼Œå®ƒæ˜¯å¯ä»¥è¢«è®¿é—®åˆ°çš„ï¼ˆå¯ä»¥ç®€å•çš„ç†è§£ä¸º <code>AO</code> æ˜¯ <code>VO</code> æµ…æ‹·è´çš„ä¸€ä¸ªå¼•ç”¨ï¼‰ã€‚</p>
<p><strong>ä½†æ˜¯ï¼ŒAO æ˜¯æ²¡æœ‰åŸå‹çš„</strong>ã€‚å‡è®¾æˆ‘ä»¬åœ¨å½“å‰ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾ä¸€ä¸ªå˜é‡ <code>a</code>ï¼Œç›¸å½“äºä» <code>AO</code> ä¸ŠæŸ¥æ‰¾ <code>a</code> å±æ€§ã€‚å‡è®¾ <code>AO</code> æœ¬èº«æ²¡æœ‰è¯¥å±æ€§ï¼Œè‡ªç„¶ä¼šå¾€ <code>AO</code> åŸå‹ä¸ŠæŸ¥æ‰¾ï¼Œä½†å¾ˆé—æ†¾ <code>AO</code> æ²¡æœ‰åŸå‹ï¼Œå³å½“å‰ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾ä¸åˆ°è¯¥å˜é‡ï¼ˆæˆ–ç§°ä¸ºå±æ€§ï¼‰ã€‚ç„¶åå¾€ä½œç”¨åŸŸé“¾çš„ä¸Šä¸€çº§ <code>AO</code> ä¸­æŸ¥æ‰¾......æŸ¥æ‰¾è§„å¾‹åŒç†......ç›´åˆ°å…¨å±€ä½œç”¨åŸŸï¼ˆå…¶ <code>VO</code> å°±æ˜¯ <code>window</code> å¯¹è±¡ï¼‰ä¸‹çš„ <code>window</code> å¯¹è±¡æŸ¥æ‰¾ã€‚ç”±äº <code>window</code> å¯¹è±¡æ˜¯æœ‰åŸå‹çš„ï¼Œå¦‚æœè‡ªèº«æ‰¾ä¸åˆ° <code>a</code> å±æ€§ï¼Œå°±ä¼šå¾€ <code>window</code> çš„åŸå‹ä¸ŠæŸ¥æ‰¾ï¼ŒæŸ¥åˆ°å°±è¿”å›ï¼ŒæŸ¥ä¸åˆ°å°±æŠ›å‡º <code>ReferenceError</code>ã€‚</p>
<p>è¯´é‚£ä¹ˆå¤šï¼Œè¿˜ä¸å¦‚çœ‹ä¸ªä¾‹å­æ›´æ¸…æ™°ï¼š</p>
<pre><code class="language-js">Object.prototype.a = 'proto'

function foo() {
  console.log(a)
}

foo() // &quot;proto&quot;
</code></pre>
<p>ä»ä¾‹å­å¯ä»¥çœ‹å‡º <code>foo</code> å‡½æ•°ä¸Šä¸‹æ–‡ä¸‹å¹¶æ²¡æœ‰å£°æ˜ <code>a</code> å˜é‡ï¼Œäºæ˜¯å¾€ä¸Šä¸€çº§æŸ¥æ‰¾ï¼ˆå³å…¨å±€ä¸Šä¸‹æ–‡ï¼‰ï¼Œé‚£ä¹ˆä» <code>window</code> è‡ªèº«æŸ¥æ‰¾ï¼Œæ˜¯æ²¡æœ‰çš„ã€‚ä½†æ˜¯ <code>window</code> æ˜¯åŸºäº <code>Object</code> åˆ›å»ºçš„ï¼ˆ<code>window instanceof Object</code> ç»“æœä¸º <code>true</code>ï¼‰ï¼Œäºæ˜¯ä» <code>Object.prototype</code> ä¸ŠæŸ¥æ‰¾ï¼Œå¹¶æ‰¾åˆ° <code>a</code> å±æ€§ï¼Œå±æ€§å€¼ä¸º <code>&quot;proto&quot;</code>ã€‚</p>
<p><strong>å¦‚ä½•è¯æ˜ AO æ˜¯æ²¡æœ‰åŸå‹çš„ï¼Ÿ</strong></p>
<pre><code class="language-js">Object.prototype.a = 'proto'

function foo() {
  var a = 'inner'
  function bar() {
    console.log(a)
  }
  bar()
}

foo() // &quot;inner&quot;
</code></pre>
<p>è¿‡ç¨‹å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œå‡è®¾ <code>AO</code> æ˜¯æœ‰åŸå‹çš„ï¼Œé‚£ä¹ˆ <code>bar</code> å‡½æ•°ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ <code>a</code> å˜é‡æ˜¯ï¼Œåº”è¯¥ä¼šå–åˆ° <code>AO</code> å¯¹è±¡åŸå‹ä¸Šçš„ <code>a</code> å±æ€§ <code>&quot;proto&quot;</code>ï¼Œä½†å®é™…æƒ…å†µ <code>a</code> å–åˆ°çš„ç»“æœæ˜¯ <code>&quot;inner&quot;</code>ã€‚å› æ­¤å¯ä»¥è¯æ˜ï¼šæ´»åŠ¨å¯¹è±¡ AO æ˜¯æ²¡æœ‰åŸå‹çš„ã€‚</p>
<p><strong>å…¨å±€å’Œ eval ä¸Šä¸‹æ–‡ä¸­çš„ä½œç”¨åŸŸé“¾</strong></p>
<p>å…¨å±€ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ä»…åŒ…å«å…¨å±€å¯¹è±¡ã€‚è€Œ eval ä¸Šä¸‹æ–‡ä¸å½“å‰çš„è°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆcalling contextï¼‰æ‹¥æœ‰åŒæ ·çš„ä½œç”¨åŸŸé“¾ã€‚</p>
<pre><code>GlobalContext.Scope = [ window ]
 
EvalContext.Scope === CallingContext.Scope;
</code></pre>
<p><strong>ä»£ç æ‰§è¡Œæ—¶å¯¹ä½œç”¨åŸŸé“¾çš„å½±å“</strong></p>
<p>æœ‰äº›æƒ…å†µä¸‹ä¹Ÿä¼šåŒ…å«å…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚æ‰§è¡ŒæœŸé—´ï¼ŒåŠ¨æ€åŠ å…¥ä½œç”¨åŸŸé“¾ä¸­çš„ï¼Œä¾‹å¦‚ <code>with</code> è¯­å¥æˆ–è€… <code>catch</code> è¯­å¥ã€‚æ­¤æ—¶ä½œç”¨åŸŸé“¾å¦‚ä¸‹ï¼š</p>
<pre><code>Scope = (withObject | catchObject)  +  (AO | VO)  +  [[Scope]]

withObject
  è¡¨ç¤º with è¯­å¥äº§ç”Ÿçš„ä¸´æ—¶ä½œç”¨åŸŸå¯¹è±¡ã€‚å¦‚ with({ name }) ä¸­çš„ { name } å¯¹è±¡ï¼›
catchObject
  è¡¨ç¤º catch ä»å¥äº§ç”Ÿçš„å¼‚å¸¸å¯¹è±¡ã€‚å¦‚ catch(e) ä¸­çš„ e å¯¹è±¡ã€‚
</code></pre>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">var foo = { x: 1, y: 2 }

with (foo) {
  console.log(x) // 1
  console.log(y) // 2
}
</code></pre>
<p>å®ƒçš„ä½œç”¨åŸŸé“¾å˜æˆäº†ï¼š<code>Scope = foo  +  (AO | VO)  +  [[Scope]]</code>ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­å¯èƒ½æ²¡æœ‰ä½“ç°å‡ºæ¥ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">var x = 1, y = 2
var foo = { x: 2 }

with (foo) {
  var x = 3, y = 4
  console.log(x) // 3
  console.log(y) // 4
}

console.log(x) // 1
console.log(y) // 4
console.log(foo) // { x: 3 }
</code></pre>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<ol>
<li>è¿›å…¥å…¨å±€ä¸Šä¸‹æ–‡çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå£°æ˜ <code>x</code>ã€<code>y</code>ã€<code>foo</code> å˜é‡ã€‚</li>
<li>æ‰§è¡Œåˆ° <code>with</code> è¯­å¥ï¼Œä¼šå°† <code>foo</code> å¯¹è±¡æ·»åŠ è‡³ä½œç”¨åŸŸé“¾é¡¶ç«¯ã€‚</li>
<li><code>with</code> å†…éƒ¨çš„ <code>x</code>ã€<code>y</code> å‰é¢å·²è¢«è§£ææ·»åŠ ï¼Œå› æ­¤å®ƒåªæ˜¯ä¸€ä¸ªèµ‹å€¼è¯­å¥ï¼Œå¹¶ä¸ä¼šé‡æ–°èµ‹å€¼è¯­å¥ã€‚</li>
<li>å…³é”®åœ¨äº <code>with</code> å†…éƒ¨ï¼Œç»™ xã€y èµ‹å€¼ï¼Œç©¶ç«Ÿæ˜¯å¯¹åº”å“ªä¸ªå˜é‡ã€‚å‰é¢æåˆ°é‡åˆ° <code>with</code> è¯­å¥ä¼šå¾€ä½œç”¨åŸŸé“¾é¡¶ç«¯æ’å…¥è¯¥å¯¹è±¡ <code>foo</code>ï¼ˆæ³¨æ„ä¸ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ä½œç”¨åŸŸä¸Šä¸‹æ–‡ï¼Œåªæ˜¯ä¿®æ”¹äº†ä½œç”¨åŸŸé“¾è€Œå·²ï¼‰ã€‚</li>
<li>å› æ­¤ï¼Œå½“ <code>console.log(x)</code> æŸ¥æ‰¾ <code>x</code> å˜é‡æ—¶ï¼Œä» <code>foo</code> å¯¹è±¡ä¸ŠæŸ¥æ‰¾ <code>x</code> å±æ€§ï¼Œå¹¶æ‰¾åˆ°ï¼Œå› æ­¤ <code>foo.x</code> è¢«ä¿®æ”¹ä¸º <code>3</code>ã€‚</li>
<li>æ¥ç€ï¼ŒæŸ¥æ‰¾ y å˜é‡ï¼Œè€Œ <code>foo</code> å¯¹è±¡ä¸Šæ²¡æœ‰ï¼ˆå…¶åŸå‹ä¹Ÿæ²¡æœ‰ï¼‰ï¼Œå› æ­¤å¾€ä¸Šä¸€çº§ä½œç”¨åŸŸæŸ¥æ‰¾ï¼ˆå³å…¨å±€ä½œç”¨åŸŸï¼‰ï¼Œå› æ­¤å…¨å±€ä½œç”¨åŸŸä¸‹çš„ <code>y</code> è¢«ä¿®æ”¹ä¸º  <code>4</code>ã€‚</li>
<li>å› æ­¤ <code>with</code> å†…éƒ¨çš„ <code>x</code>ã€<code>y</code> åˆ†åˆ«æ‰“å°å‡ºï¼š<code>3</code> å’Œ <code>4</code>ã€‚</li>
<li>å½“ <code>with</code> æ‰§è¡Œå®Œï¼Œä½œç”¨åŸŸé“¾ä¸Šçš„ <code>foo</code> å¯¹è±¡ä¼šè¢«ç§»é™¤ã€‚å³ä½œç”¨åŸŸé“¾ä¸Šåªå‰©ä¸‹ <code>window</code> å¯¹è±¡ã€‚</li>
<li>åé¢æŸ¥æ‰¾ <code>x</code>ã€<code>y</code>ã€<code>foo</code> å˜é‡éƒ½æ˜¯ä»å…¨å±€ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾çš„ï¼Œå› æ­¤ä¼šåˆ†åˆ«æ‰“å°å‡º <code>1</code> å’Œ <code>4</code>ã€‚</li>
<li>æœ€åæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° <code>foo</code> å¯¹è±¡æ˜¯æ›´æ–°å˜ä¸ºï¼š<code>{ x: 3 }</code>ã€‚</li>
</ol>
<blockquote>
<p>ç»“åˆå‰é¢çš„åŸå‹çš„å†…å®¹ï¼Œå‡è®¾å°† <code>foo</code> å¯¹è±¡çš„åŸå‹ä¸Šæ·»åŠ  <code>y</code> å±æ€§ï¼Œé‚£ä¹ˆ <code>y = 4</code> è¢«ä¿®æ”¹çš„æ˜¯ <code>foo.__proto__</code> ä¸Šçš„å±æ€§ï¼Œè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸä¸‹çš„ <code>y</code> å˜é‡ã€‚ï¼ˆæœ‰å…´è¶£çš„è‡ªè¡Œå°è¯•ä¸€ä¸‹ï¼‰</p>
</blockquote>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript é—­åŒ…è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/267</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/267</guid>
            <pubDate>Sun, 26 Feb 2023 12:26:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-12ead1ff9a235842.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-12ead1ff9a235842.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç»§ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://github.com/toFrankie/blog/issues/266">JavaScript è„šæœ¬ç¼–è¯‘ä¸æ‰§è¡Œè¿‡ç¨‹ç®€è¿°</a>ï¼Œå†æ¥ä»‹ç»ä¸€ä¸‹ JavaScript ä¸­ç¥å¥‡çš„â€œé—­åŒ…â€ï¼ˆClosureï¼‰ã€‚</p>
<blockquote>
<p><strong>é—­åŒ…æ˜¯åŸºäºè¯æ³•ä½œç”¨åŸŸä¹¦å†™ä»£ç æ—¶æ‰€äº§ç”Ÿçš„è‡ªç„¶ç»“æœã€‚</strong></p>
</blockquote>
<p>JavaScript è¯­è¨€æ˜¯é‡‡ç”¨äº†è¯æ³•ä½œç”¨åŸŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°ã€å˜é‡çš„ä½œç”¨åŸŸåœ¨ç¼–å†™çš„æ—¶å€™å·²ç»ç¡®å®šä¸”ä¸å¯æ”¹å˜çš„ã€‚é™¤äº† <code>eval</code>ã€<code>with</code> ä¹‹å¤–ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡Œçš„æ—¶å€™â€œä¿®æ”¹â€è¯æ³•ä½œç”¨åŸŸï¼Œä½†å®é™…é¡¹ç›®ä¸­ï¼Œå‡ ä¹å¾ˆå°‘ç”¨åˆ°å®ƒä»¬ï¼Œæ¬ºéª—è¯æ³•ä½œç”¨åŸŸä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥ã€‚</p>
<p>è¿˜æœ‰ï¼Œåƒä¸‡åˆ«æŠŠ <code>this</code> è·Ÿä½œç”¨åŸŸæ··æ·†åœ¨ä¸€èµ·ï¼Œ<code>this</code> ä¸å‡½æ•°è°ƒç”¨æœ‰å…³ï¼Œå¯ä»¥è¯´æ˜¯â€œåŠ¨æ€â€çš„ã€‚è€Œä½œç”¨åŸŸæ˜¯é™æ€çš„ï¼Œè·Ÿå‡½æ•°æ€æ ·è°ƒç”¨æ²¡å…³ç³»ã€‚è¯æ³•ä½œç”¨åŸŸä¹Ÿè¢«å«åšâ€œé™æ€ä½œç”¨åŸŸâ€ã€‚</p>
<p>è‹¥å¯¹è¯æ³•ä½œç”¨åŸŸã€æ‰§è¡Œä¸Šä¸‹æ–‡ã€å˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ç­‰å†…å®¹ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®å…ˆå­¦ä¹ ç›¸å…³çŸ¥è¯†ã€‚åˆ°æ—¶å›æ¥å†çœ‹é—­åŒ…çš„æ—¶å€™ï¼Œå°±éå¸¸å®¹æ˜“ç†è§£äº†ã€‚</p>
<ul>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/17">JavaScript æ·±å…¥ç³»åˆ— 15 ç¯‡ï¼ˆå†´ç¾½ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/blob/main/docs/js/00-%E5%AF%BC%E8%AF%BB.md">JavaScript ç³»åˆ—ä¸“é¢˜ï¼ˆgoddyZhaoï¼‰</a></li>
</ul>
<h2>æ¦‚å¿µ</h2>
<p>æ— è®ºç½‘ä¸Šæ–‡ç« ï¼Œè¿˜æ˜¯å„ç±»ä¹¦ç±ï¼Œå¯¹é—­åŒ…çš„å®šä¹‰éƒ½ä¸å°½ç›¸åŒã€‚åˆ—ä¸¾å‡ ä¸ªï¼š</p>
<ul>
<li>MDNï¼šé—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚</li>
<li>JavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼šé—­åŒ…æŒ‡çš„æ˜¯é‚£äº›å¼•ç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚</li>
<li>ä½ ä¸çŸ¥é“çš„ JavaScriptï¼šé—­åŒ…æ˜¯ä»£ç å—å’Œåˆ›å»ºè¯¥ä»£ç å—çš„ä¸Šä¸‹æ–‡ä¸­æ•°æ®çš„ç»“åˆã€‚</li>
</ul>
<p>è®²å®è¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä»¥ä¸Šå“ªä¸ªè¯´æ³•æ›´è´´åˆ‡ã€æ›´ç¬¦åˆã€‚å½“äº†è§£<a href="https://github.com/toFrankie/blog/issues/268">ä½œç”¨åŸŸé“¾</a>ä¹‹åï¼Œå°±å¾ˆå®¹æ˜“ç†è§£é—­åŒ…äº†ã€‚</p>
<p>ä¸Šé¢æåˆ°äº†<strong>è‡ªç”±å˜é‡</strong>ä¸€è¯ï¼Œ</p>
<blockquote>
<p>è‡ªç”±å˜é‡ï¼ˆFree Variableï¼‰ï¼šæ˜¯æŒ‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„ï¼Œä½†æ—¢ä¸æ˜¯å‡½æ•°å‚æ•°ï¼Œä¹Ÿä¸æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡çš„å˜é‡ã€‚</p>
</blockquote>
<pre><code class="language-js">var a = 1
function foo() {
  var b = 2 // b ä¸æ˜¯è‡ªç”±å˜é‡
  console.log(a) //  a æ˜¯è‡ªç”±å˜é‡
}
foo()
</code></pre>
<p>åœ¨ ECMAScript ä¸­ï¼Œé—­åŒ…æŒ‡çš„æ˜¯ï¼š</p>
<ul>
<li>
<p>ä»ç†è®ºè§’åº¦ï¼šæ‰€æœ‰çš„å‡½æ•°ã€‚å› ä¸ºå®ƒä»¬éƒ½åœ¨åˆ›å»ºçš„æ—¶å€™å°±å°†ä¸Šå±‚ä¸Šä¸‹æ–‡çš„æ•°æ®ä¿å­˜èµ·æ¥äº†ã€‚å“ªæ€•æ˜¯ç®€å•çš„å…¨å±€å˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå‡½æ•°ä¸­è®¿é—®å…¨å±€å˜é‡å°±ç›¸å½“äºæ˜¯åœ¨è®¿é—®è‡ªç”±å˜é‡ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨æœ€å¤–å±‚çš„ä½œç”¨åŸŸã€‚</p>
</li>
<li>
<p>ä»å®è·µè§’åº¦ï¼šä»¥ä¸‹å‡½æ•°æ‰ç®—æ˜¯é—­åŒ…ï¼š</p>
<ul>
<li>å³ä½¿åˆ›å»ºå®ƒçš„ä¸Šä¸‹æ–‡å·²ç»é”€æ¯ï¼Œå®ƒä»ç„¶å­˜åœ¨ï¼ˆæ¯”å¦‚ï¼Œå†…éƒ¨å‡½æ•°ä»çˆ¶å‡½æ•°ä¸­è¿”å›ï¼‰ã€‚</li>
<li>åœ¨ä»£ç ä¸­å¼•ç”¨äº†è‡ªç”±å˜é‡ã€‚</li>
</ul>
</li>
</ul>
<p>å°±æˆ‘ä¸ªäººè®¤ä¸ºï¼Œé—­åŒ…ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨äºè®¿é—®è‡ªç”±å˜é‡ã€‚é—­åŒ…ä¸æ˜¯ JavaScript ä¸­ä¸“æœ‰æœ¯è¯­ï¼Œåœ¨ä¸Šä¸–çºªå¾ˆæ—©å°±è¢«æå‡ºæ¥äº†ï¼Œåœ¨å…¶ä»–è¯­è¨€ï¼ˆå¦‚ Ruby è¯­è¨€ï¼‰ä¸­ï¼Œé—­åŒ…å¯ä»¥æ˜¯ä¸€ä¸ªè¿‡ç¨‹å¯¹è±¡ï¼Œä¸€ä¸ª Lambda è¡¨è¾¾å¼æˆ–è€…æ˜¯ä»£ç å—ã€‚</p>
<h2>Chrome çœ¼ä¸­çš„é—­åŒ…</h2>
<p>å…¶å®ä¸Šé¢æ¦‚å¿µå¯èƒ½å¾ˆå¤šäººéƒ½ä¸ç†è§£ï¼Œä½†é—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ Chrome çœ¼ä¸­çš„é—­åŒ…æ˜¯é•¿æ€ä¹ˆæ ·çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function foo() {
  var a = 1
  function bar() {
    console.log(a)
  }
  return bar
}

var f = foo()
f() // 1
</code></pre>
<p>ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“ï¼Œå‡½æ•° <code>foo</code> å°±æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé€šè¿‡ Chrome æ–­ç‚¹è°ƒè¯•å¯ä»¥ä»è§†è§’æ„ŸçŸ¥ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-734e2c2902ccfd3a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½†æ˜¯æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼Œ</p>
<pre><code class="language-js">var a = 1
function foo() {
  function bar() {
    console.log(a)
  }
  return bar
}

var f = foo()
f()
</code></pre>
<p>æ­¤æ—¶ <code>a</code> æ˜¯å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡ï¼Œå°½ç®¡å¯¹äºå‡½æ•° <code>bar</code> æ¥è¯´ <code>a</code> å±äºè‡ªç”±å˜é‡ï¼Œä½†å®ƒä¸æ˜¯ <code>foo</code> å‡½æ•°ä¸Šä¸‹æ–‡å†…å£°æ˜çš„å˜é‡ï¼Œå› æ­¤ <code>foo</code> å°±ä¸æ˜¯é—­åŒ…ã€‚</p>
<blockquote>
<p><a href="https://www.zhihu.com/question/653156035/answer/3469481157">å‡½æ•°å†…è®¿é—®å…¨å±€å˜é‡ç®—æ˜¯é—­åŒ…å—?</a></p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1bb0a84efe05f896.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>æ€»ç»“ï¼šåœ¨å‡½æ•° <code>A</code>ï¼ˆå¦‚ <code>foo</code>ï¼‰ä¸­å­˜åœ¨æŸä¸ªå‡½æ•° <code>B</code>ï¼ˆå¦‚ <code>bar</code>ï¼Œä¸”å¿…é¡»æ˜¯åœ¨ <code>A</code> ä¸­å®šä¹‰çš„ï¼‰ï¼Œä¸” <code>B</code> å†…è‡³å°‘å¼•ç”¨äº† <code>A</code> ä¸­çš„ä¸€ä¸ªâ€œå˜é‡â€ï¼Œé‚£ä¹ˆå‡½æ•° <code>A</code> å°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</strong></p>
<p>è¯·æ³¨æ„ï¼Œä¸å‡½æ•° <code>B</code> çš„è°ƒç”¨æ–¹å¼æ²¡å…³ç³»ã€‚æ— è®º <code>B</code> æ˜¯åœ¨ <code>foo</code> å†…éƒ¨è¢«è°ƒç”¨ï¼Œè¿˜æ˜¯ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œç„¶ååœ¨åˆ«å¤„è°ƒç”¨ã€‚</p>
<p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function foo() {
  var b = () =&gt; {
    // ç”±äº b æ˜¯ç®­å¤´å‡½æ•°ï¼Œå†…éƒ¨æ²¡æœ‰ arguments å¯¹è±¡ï¼Œ
    // æ‰€ä»¥è¿™ä¸ª arguments å¯¹è±¡æ˜¯ foo ä¸­å˜é‡å¯¹è±¡çš„ä¸€å‘˜ï¼Œ
    // å› æ­¤ foo ä¹Ÿæ˜¯ä¸€ä¸ªé—­åŒ…ã€‚
    console.log(arguments)
  }
  return b
}

var f = foo('foo')
f() // { 0: 'foo', length: 1 }
</code></pre>
<p>ä¸Šè¿°è¿™ä¸ªç¤ºä¾‹ï¼Œæ˜¯ä¸ºäº†æé†’ <code>B</code> å¯¹ <code>A</code> ä¸­çš„æŸä¸ªâ€œå˜é‡â€ï¼ˆæŒ‡å˜é‡ã€å‡½æ•°ã€<code>arguments</code>ã€å½¢å‚ç­‰ï¼‰çš„å¼•ç”¨ï¼Œä¸ä»…ä»…æ˜¯é€šè¿‡ <code>var</code>ã€<code>function</code>ã€<code>let</code>ã€<code>const</code>ã€<code>class</code> ç­‰å…³é”®å­—æ˜¾å¼å£°æ˜çš„ï¼Œè¿˜å¯ä»¥æ˜¯ <code>arguments</code> å¯¹è±¡ã€å½¢å‚ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ AO ä¸­çš„æ‰€æœ‰å˜é‡ã€‚</p>
<p>å†çœ‹ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ <code>foo</code> æ˜¯é—­åŒ…å—ï¼Ÿ</p>
<pre><code class="language-js">function foo(fn) {
  var a = 'local'
  fn()
}

function bar() {
  console.log(a)
}

var a = 'global'

foo(bar) // &quot;global&quot;
</code></pre>
<p>ç­”æ¡ˆæ˜¯ NOã€‚å‰é¢æ€»ç»“è¿‡ä¸€ä¸ªå‡½æ•°è¦æˆä¸ºé—­åŒ…ï¼Œè¯¥å‡½æ•°ï¼ˆ<code>foo</code>ï¼‰å†…éƒ¨å¿…é¡»å­˜åœ¨å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼ˆ<code>fn</code>ï¼‰ï¼Œä¸” <code>fn</code> å†…éœ€è¦ <code>foo</code> ä¸­çš„æŸä¸ªå˜é‡ã€‚é‚£ä¸æ­£å¥½å¼•ç”¨äº† <code>foo</code> ä¸­çš„å˜é‡ <code>a</code> å—ï¼Ÿæ˜¾ç„¶ï¼Œè¿™ç†è§£æ˜¯é”™è¯¯çš„ã€‚</p>
<p>æ ¹æ®è¯æ³•ä½œç”¨åŸŸå¯çŸ¥ï¼Œå‡½æ•° <code>bar</code> çš„ä½œç”¨åŸŸé“¾ <code>[[scope]]</code> åœ¨å£°æ˜æ—¶å°±å·²ç¡®å®šä¸”ä¸å¯å˜ï¼Œåªå« <code>GlobalContext.VO</code>ï¼Œå› æ­¤å½“æŸ¥æ‰¾è‡ªç”±å˜é‡ <code>a</code> æ—¶ï¼Œå½“ <code>bar</code> çš„ AO å†…æŸ¥ä¸åˆ°ï¼Œä¸‹ä¸€æ­¥æ˜¯å‰å¾€å…¨å±€å¯¹è±¡ä¸‹æŸ¥æ‰¾ï¼Œäºæ˜¯å°±æ‰¾åˆ°äº† <code>a</code> å…¶å€¼ä¸º <code>&quot;global&quot;</code>ã€‚æ‰€ä»¥ <code>fn</code> å†…éƒ¨å¯¹ <code>foo</code> æ„æˆä¸äº†å¼•ç”¨ï¼Œå› æ­¤ <code>foo</code> å°±ä¸æ˜¯é—­åŒ…ã€‚</p>
<blockquote>
<p>è‹¥åˆ°è¿™é‡Œï¼Œå¯¹é—­åŒ…è¿˜æ˜¯æ‡µæ‡µæ‡‚æ‡‚çš„ï¼Œè¿™å—å¼•ç”¨çš„å†…å®¹ï¼Œè¯·è·³è¿‡ã€‚</p>
<p>çªç„¶é—´ï¼Œæˆ‘å¥½åƒæ˜ç™½äº†ä¸ºä»€ä¹ˆå‡½æ•°å†…éƒ¨ç¼ºçœå£°æ˜å…³é”®å­—çš„å˜é‡ï¼ˆå¦‚ <code>a = 1</code>ï¼‰ï¼Œåœ¨æ‰§è¡Œæ—¶æ‰å°†å…¶è§†ä¸ºå…¨å±€å˜é‡ã€‚</p>
<p>å‡è®¾å°†å…¶ä½œä¸ºå‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡ï¼Œè¦æ€ä¹ˆåšï¼š</p>
<ul>
<li>å‡è®¾å°†å…¶è§†ä¸ºå½“å‰å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ JS å¼•æ“åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œåˆå§‹åŒ–å·¥ä½œé‡å®åœ¨å¤ªå¤šäº†ï¼Œè¦é€šç¯‡æ‰«æå½“å‰ä¸Šä¸‹æ–‡çš„å£°æ˜è¯­å¥å’Œèµ‹å€¼è¯­å¥ï¼Œè¿˜è¦åˆ¤åˆ«èµ‹å€¼è¯­å¥æ˜¯å•çº¯åœ°ç»™å·²æœ‰å˜é‡èµ‹å€¼ï¼Œè¿˜æ˜¯ä¸Šé¢æåˆ°çš„ç¼ºçœå£°æ˜æƒ…å†µã€‚æ˜¾ç„¶å¾ˆå½±å“æ•ˆç‡å’Œæ€§èƒ½ã€‚</li>
<li>å¦‚æœä¸é€šç¯‡æ‰«æï¼Œåœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å†æ›´æ–°åˆ° AO ä¸Šï¼Œé‚£ä¹ˆåˆä¼šç ´å JavaScript çš„è¯æ³•ä½œç”¨åŸŸã€‚ä¼¼ä¹å°±å˜æˆäº†â€œåŠ¨æ€ä½œç”¨åŸŸâ€ã€‚</li>
</ul>
<p>ä½†å¦‚æœå°†å…¶è§†ä¸ºå…¨å±€ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå˜é‡ï¼Œä¸Šé¢çš„é¢å¤–çš„å·¥ä½œéƒ½çœäº†ã€‚ä½†æ³¨æ„ï¼Œå®ƒä¸å…¨å±€å£°æ˜çš„å˜é‡æœ‰äº›åŒºåˆ«ï¼Œå‰è€…å¯ä»¥è¢«åˆ é™¤ï¼Œè€Œåè€…æ— æ³•åˆ é™¤ï¼ˆåŸå› å¯çœ‹<a href="https://www.jianshu.com/p/d674f94b7fe2">è¿™é‡Œ</a>ï¼‰ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¯¹è¿™ç§â€œéšå¼â€å£°æ˜å…¨å±€å˜é‡çš„è¡Œä¸ºä½œä¸ºç¦æ­¢ï¼Œå¹¶æŠ›å‡º <code>SyntaxError</code>ã€‚ä¸ç¡®å®šæ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸ªåŸå› è€Œè¢«ç¦çš„ã€‚</p>
<p>è¿™ä¸ªæ˜¯çªç„¶çµå…‰ä¸€é—ªçš„ï¼Œæ‰€ä»¥ä¹Ÿ Mark ä¸‹æ¥äº†ã€‚</p>
</blockquote>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒChrome æµè§ˆå™¨çœ¼ä¸­çš„é—­åŒ…åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><strong>åœ¨æŸä¸ªå‡½æ•° <code>A</code> ä¸­å­˜åœ¨å¦ä¸€ä¸ªå‡½æ•° <code>B</code>ï¼ˆå‡½æ•° <code>B</code> å¿…é¡»æ˜¯åœ¨å‡½æ•° <code>A</code> ä¸­å®šä¹‰çš„ï¼‰ï¼Œè€Œä¸” <code>B</code> å†…è‡³å°‘å¼•ç”¨äº† <code>A</code> ä¸­çš„ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆå½“ <code>B</code> åœ¨ä»»æ„åœ°æ–¹è¢«è°ƒç”¨æ—¶ï¼Œå‡½æ•° <code>A</code> å°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</strong></p>
<p>å…¶å®ï¼Œæˆ‘è®¤ä¸ºæ¦‚å¿µä¸æ˜¯å¾ˆé‡è¦çš„...</p>
<h2>æ›´å¤šç¤ºä¾‹</h2>
<p>å‰é¢çš„ç¤ºä¾‹ï¼Œéƒ½ç›¸å¯¹æ¯”è¾ƒç®€å•å’Œæ¸…æ™°çš„ã€‚å†çœ‹å¤šå‡ ä¸ªå§ã€‚</p>
<p>å…³äº Chrome æµè§ˆå™¨è°ƒè¯•ï¼Œåœ¨ Source é€‰é¡¹å¡è¿›è¡Œæ–­ç‚¹è°ƒè¯•æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä½œç”¨åŸŸã€é—­åŒ…çš„å˜åŒ–ã€‚</p>
<pre><code class="language-js">CallStack: è°ƒç”¨æ ˆ
Scope: å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾
  Local   // å½“å‰ AO/VO å¯¹è±¡ï¼Œä½†ä¸å®Œå…¨æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° this æŒ‡å‘
  Block   // åŒ…å«å—çº§ä½œç”¨åŸŸ letã€constã€class çš„å˜é‡
  Closure // é—­åŒ…
  modules // ESM æ¨¡å—
  Script  // &lt;script&gt; å†…æ‰€æœ‰ letã€constã€class å£°æ˜çš„å˜é‡
  Global  // å³ windowï¼Œé€šè¿‡ var function å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¼šæ”¾åœ¨è¿™é‡Œ
</code></pre>
<h3>ç¤ºä¾‹ä¸€</h3>
<p>è¯·é—®ä»¥ä¸‹ç¤ºä¾‹ä¼šä¸ä¼šäº§ç”Ÿé—­åŒ…?ï¼ˆè¿™é“é¢˜ä¸æ˜¯è€ƒä½  <code>this</code> æŒ‡å‘å“ˆï¼Œåˆ«æé”™äº†ï¼‰</p>
<pre><code class="language-js">var name = 'Frankie'
var obj = {
  name: 'Mandy',
  sayHi: function () {
    return function () {
      console.log(this.name)
    }
  }
}

obj.sayHi()()
</code></pre>
<p>ç­”æ¡ˆæ˜¯ NOã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e23e0c9a5bffa066.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç„¶åå†ä¿®æ”¹ä¸‹ï¼Œå½“ <code>obj.sayHi()</code> è¿”å›çš„åŒ¿åå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå­˜åœ¨å¯¹ <code>obj.sayHi</code> æ–¹æ³•çš„å¼•ç”¨ã€‚å› æ­¤ <code>obj.sayHi</code> å°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</p>
<pre><code class="language-js">var name = 'Frankie'
var obj = {
  name: 'Mandy',
  sayHi: function () {
    var _this = this
    return function () {
      console.log(_this.name)
    }
  }
}

obj.sayHi()()
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b96d2ed0c8de77a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬çŸ¥é“ç®­å¤´å‡½æ•°å†…éƒ¨ä¸å­˜åœ¨ <code>this</code>ï¼Œå› æ­¤æ— è®º <code>obj.sayHi()</code> è¿”å›çš„åŒ¿åç®­å¤´å‡½æ•°æ€æ ·è°ƒç”¨ï¼Œæœ€ç»ˆ <code>this</code> éƒ½æŒ‡å‘ <code>obj</code> å¯¹è±¡ã€‚ä½†æˆ‘çš„ç–‘é—®åœ¨äºï¼Œä»¥ä¸‹ç¤ºä¾‹ä¼šä¸ä¼šäº§ç”Ÿé—­åŒ…ï¼Ÿ</p>
<pre><code class="language-js">var name = 'Frankie'
var obj = {
  name: 'Mandy',
  sayHi: function () {
    return () =&gt; {
      console.log(this.name)
      // console.log(arguments) // arguments ä¼šäº§ç”Ÿé—­åŒ…ï¼Œè€Œ this æ˜¯ä¸ä¼šçš„
    }
  }
}

obj.sayHi()()
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-984a8534c335e17b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç­”æ¡ˆè¿˜æ˜¯ NOã€‚å…¶å®æˆ‘è¿™é‡Œæ˜¯æœ‰ä¸ªç–‘é—®çš„ï¼ŒæŒ‰é“ç†ç®­å¤´å‡½æ•°ä¸å­˜åœ¨ <code>arguments</code> å’Œ <code>this</code> å¯¹è±¡ï¼Œè‹¥åœ¨ç›‘å¬å‡½æ•°å†…è®¿é—®è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œéƒ½åº”è¯¥äº§ç”Ÿé—­åŒ…ã€‚<strong>ä½†äº‹å®æ˜¯ï¼Œ<code>this</code> å¼•ç”¨ä¸ä¼šä½¿å¾— <code>sayHi</code> ç§°ä¸ºé—­åŒ…ã€‚ä½†æ˜¯è‹¥ç®­å¤´å‡½æ•°å†…å¼•ç”¨äº† <code>arguments</code> å¯¹è±¡ï¼Œåˆ™ä¼šäº§ç”Ÿé—­åŒ…</strong>ã€‚è¿™ä¸€ç‚¹è¦æ³¨æ„ä¸‹ï¼</p>
<h3>ç¤ºä¾‹äºŒ</h3>
<p>ç»å…¸é¢è¯•é¢˜ï¼Œå“ˆå“ˆï¼</p>
<pre><code class="language-js">for (var i = 1; i &lt;= 3; i++) {
  setTimeout(function timer() {
    console.log(i)
  }, i * 1000)
}
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹æ‰“å°ç»“æœæ˜¯ï¼š<code>3ã€3ã€3</code>ï¼ˆæ—¶é—´é—´éš”ä¸€ç§’ï¼‰ã€‚å¦‚æœè¦æ¯é—´éš”ä¸€ç§’åˆ†åˆ«è¾“å‡ºï¼š<code>1ã€2ã€3</code>ï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿè§£å†³æ–¹æ¡ˆå¾ˆç®€å•ã€‚</p>
<p>è§£å†³æ–¹æ³•ä¸€ï¼š</p>
<p>ç»™ <code>setTimeout</code> æŠ«ä¸€ä¸ªå‡½æ•°ï¼Œå³å¤šä¸€å±‚ä½œç”¨åŸŸã€‚</p>
<pre><code class="language-js">for (var i = 1; i &lt;= 3; i++) {
  (function fn(i) {
    setTimeout(function timer() {
      console.log(i)
    }, i * 1000)
  })(i)
}
</code></pre>
<p>æˆ‘å°±ä¸æ‰“æ–­ç‚¹äº†ï¼Œç›´æ¥ä»æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š</p>
<pre><code>1. å…¨å±€ä»£ç å¼€å§‹æ‰§è¡Œ
  ECStack = [ GlobalContext.VO ]

2. å¼€å§‹æ‰§è¡Œ for å¾ªç¯ï¼Œfn çš„å‡½æ•°ä¸Šä¸‹æ–‡åˆå§‹åŒ–å¦‚ä¸‹ï¼Œ

  FunctionalContext&lt;fn&gt; = {
    AO: {
      arguments: {
        0: 1,
        length: 1
      }
      i: 1,
      timer: Æ’ timer()
    },
    Scope: [ GlobalContext.VO, AO ],
    this: undefined
  }

  å½“ timer å£°æ˜çš„æ—¶å€™ï¼Œå®ƒçš„ [[scope]] å°±ç¡®å®šäº†ï¼Œå³ FunctionalContext&lt;fn&gt;.Scope
  ç”±äº fn å†…éƒ¨å­˜åœ¨ä¸€ä¸ªå‡½æ•° timerï¼Œä¸” timer ä¸­çš„ i å¼•ç”¨äº† fn ä¸­çš„ AO å˜é‡ï¼Œ
  å› æ­¤ fn å½¢æˆé—­åŒ…ã€‚

3. åé¢ä¸¤æ¬¡å¾ªç¯åŒç†...

4. ä¸€ç§’åï¼Œä¼šè°ƒç”¨ timer å‡½æ•°ï¼Œç„¶åè¿›å…¥ timer å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶åˆå§‹åŒ–ï¼š

  FunctionalContext&lt;timer&gt; = {
    AO: {
      arguments: {
        length: 0
      }
    },
    Scope: [ GlobalContext.VO, FunctionalContext&lt;fn&gt;.AO, AO ],
    this: undefined
  }

  æ‰§è¡Œ timer å†…éƒ¨ä»£ç æ—¶ï¼Œè¦æŸ¥æ‰¾ a å˜é‡ï¼Œé¦–å…ˆå½“å‰ AO æ²¡æœ‰ï¼Œ
  æ¥ç€å¾€ FunctionalContext&lt;fn&gt;.AO ä¸Šé¢æ‰¾ï¼Œäºæ˜¯å°±æ‰¾åˆ°äº† a ä¸º 1ã€‚
  ç„¶å timer æ‰§è¡Œå®Œæ¯•ã€‚

5. åˆè¿‡äº†ä¸€ç§’ï¼Œåˆä¼šè§¦å‘ timer å‡½æ•°ï¼Œè¿‡ç¨‹åŒä¸Šã€‚

6. ä½†æ³¨æ„æ¯æ¬¡å¾ªç¯æ‰§è¡Œçš„ fn å‡½æ•°éƒ½ä¸æ˜¯åŒä¸€ä¸ªå‡½æ•°å“¦ï¼Œå®ƒä»¬åŸå…ˆæ‰§è¡Œä¸Šä¸‹æ–‡çš„ AO å¯¹è±¡
   è¢«ä¿å­˜è‡³ timer å‡½æ•° [[scope]] é‡Œé¢äº†ã€‚
   å› æ­¤ï¼Œæ¯æ¬¡æ‰§è¡Œ timer å‡½æ•°çš„æ—¶å€™ï¼Œi éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚

7. æ‰€ä»¥æŒ‰ç…§è¿™æ ·å»æ”¹é€ çš„è¯ï¼Œå°±èƒ½æ¯é—´éš”ä¸€ç§’åˆ†åˆ«è¾“å‡ºï¼š1ã€2ã€3
</code></pre>
<p>è§£å†³æ–¹æ³•äºŒï¼šä½¿ç”¨ <code>let</code> æ¥å£°æ˜å˜é‡ <code>i</code>ã€‚</p>
<p>é¦–å…ˆè¯·æ³¨æ„ <code>for</code> è¯­å¥ä¸¤ç§æ–¹å¼çš„åŒºåˆ«ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/* å…¨å±€ä½œç”¨åŸŸ */
for (let i = 1; ;/* å—çº§ä½œç”¨åŸŸ 1 */) {
  /* å—çº§ä½œç”¨åŸŸ 2 */
}

/* å…¨å±€ä½œç”¨åŸŸ */
for (var j = 1; ;/* å…¨å±€ä½œç”¨åŸŸ */) {
  /* å…¨å±€ä½œç”¨åŸŸ */
}
</code></pre>
<pre><code class="language-js">for (let i = 1; i &lt;= 3; i++) {
  setTimeout(function timer() {
    console.log(i)
  }, i * 1000)
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b614042a3b7b1907.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸‰ä¸ªä½œç”¨åŸŸçš„ä½“ç°ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-32309e056299e237.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>æˆ‘è®¤ä¸ºçš„é—­åŒ…</h2>
<blockquote>
<p>åœ¨æˆ‘çš„ç†è§£é‡Œï¼Œ æ¯ä¸ª JavaScript å‡½æ•°éƒ½æ˜¯é—­åŒ…ã€‚æˆ–è€…è¯´æŸä¸ªå‡½æ•°å¼•ç”¨äº†å…¶ä½œç”¨åŸŸå¤–çš„å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¯ä»¥è¢«è®¤ä¸ºæ˜¯é—­åŒ…ã€‚</p>
</blockquote>
<p>å°½ç®¡ Chrome æµè§ˆå™¨ä¸è®¤åŒæˆ‘çš„è¯´æ³•ï¼Œä¹Ÿä¸ä¼šå½±å“æˆ‘ç†è§£å’Œä½¿ç”¨é—­åŒ…ï¼Œå› ä¸ºæˆ‘å·²ç»çŸ¥é“äº†ä½œç”¨åŸŸé“¾ä¸é—­åŒ…ç›´æ¥ç›¸å…³ã€‚</p>
<blockquote>
<p>æ’ä¸€æ®µåºŸè¯ï¼Œä¸æƒ³çœ‹çš„è¯ç›´æ¥è·³åˆ°ä¸‹ä¸€èŠ‚ã€‚</p>
</blockquote>
<p>æˆ‘åœ¨å­¦ä¹ é—­åŒ…çš„ä¹‹å‰ï¼Œå…ˆæ•´ä½“äº† JS æ•´ä¸ªåŠ è½½ã€ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚å…¶å®å­¦ä¹ è¿˜æ˜¯å…¶ä»–ï¼Œéƒ½åº”è¯¥ä»å®è§‚å’Œå¾®è§‚çš„è§’åº¦åˆ†æã€‚å®ƒä»¬çš„è¿‡ç¨‹æ˜¯å¾ªåºæ¸è¿›çš„ã€‚</p>
<p>æˆ‘çŒœï¼Œå¯èƒ½è¿˜æœ‰æŒºå¤šæœ‰ä¸€å®šç»éªŒçš„ JSer ä¸çŸ¥é“ JS è„šæœ¬æ˜¯æŒ‰å—åŠ è½½çš„ã€‚æŒ‰å—åŠ è½½ä»€ä¹ˆæ„æ€ï¼Ÿæ¯”å¦‚æˆ‘ä»¬çš„ç½‘é¡µæœ‰ä¸¤ä¸ª JS è„šæœ¬ï¼ˆå³ä¸¤å¯¹ <code>&lt;script&gt;</code> æ ‡ç­¾ï¼‰ã€‚JS å¼•æ“ä¼šå…ˆå¯¹å…¶ä¸­ä¸€å—è¿›è¡Œç¼–è¯‘ä¸æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œå®Œæˆä¹‹åï¼Œæ‰å¼€å§‹å¯¹ä¸‹ä¸€ä¸ªè„šæœ¬è¿›è¡Œç¼–è¯‘ä¸æ‰§è¡Œã€‚å‡è®¾ä½ ä¸äº†è§£ï¼Œå¯èƒ½è¯¯ä»¥ä¸º JS å¼•æ“ä¼šé€šç¯‡æ‰«ææ‰€æœ‰è„šæœ¬çš„è¯­æ³•ï¼Œç„¶åå†æŒ‰é¡ºåºï¼ˆæˆ–ä¸æŒ‰é¡ºåºï¼‰æ‰§è¡Œã€‚è¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<p>å› æ­¤å­¦ä¹ é—­åŒ…ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œè¯·å…ˆäº†è§£ JavaScript ä»£ç ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p>
<pre><code class="language-text">ç¼–è¯‘é˜¶æ®µï¼š
  è¯æ³•åˆ†æ
  è¯­æ³•åˆ†æ
  ä»£ç ç”Ÿæˆ

æ‰§è¡Œé˜¶æ®µï¼š
  æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ
    å‡ºæ ˆ/å…¥æ ˆ
  åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡
  åˆå§‹åŒ–æ‰§è¡Œä¸Šä¸‹æ–‡ï¼š
    å˜é‡å¯¹è±¡/æ´»åŠ¨å¯¹è±¡ï¼ˆVO/AOï¼‰ï¼š
      åˆ›å»ºæ—¶å°±ç¡®å®šå‡½æ•°çš„ [[scope]]ï¼ˆè¦å­¦å¥½é—­åŒ…ï¼Œè¿™ç©æ„è¦å¼„æ˜ç™½ï¼‰
    ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰
    This
  ä»£ç æ‰§è¡Œï¼š
    é—­åŒ…

è¯æ³•ä½œç”¨åŸŸï¼š
  ä»€ä¹ˆæ˜¯è¯æ³•ä½œç”¨åŸŸï¼Ÿ
  ä»€ä¹ˆæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Ÿ
</code></pre>
<p>ç­‰è¿™äº›å†…å®¹éƒ½å±æ€§ä¹‹åï¼Œå†ç»“åˆæœ¬æ–‡æˆ–å…¶ä»–å¤§ä½¬çš„æ–‡ç« ï¼Œé—­åŒ…å°±è‡ªç„¶è€Œç„¶å°±æ‡‚äº†ã€‚å¦‚æœè·³è¿‡ä»¥ä¸Šå†…å®¹ï¼Œç›´æ¥çœ‹é—­åŒ…ï¼Œæˆ‘è®¤ä¸ºæ˜¯å¾ˆéš¾ç†è§£çš„ï¼Œå³ä½¿å¥½åƒå½“æ—¶çœ‹æ‡‚äº†ï¼Œä½†å¾ˆå¿«å°±ä¼šå¿˜äº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript è„šæœ¬ç¼–è¯‘ä¸æ‰§è¡Œè¿‡ç¨‹ç®€è¿°]]></title>
            <link>https://github.com/toFrankie/blog/issues/266</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/266</guid>
            <pubDate>Sun, 26 Feb 2023 12:23:29 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f2b4d0d3a4df1679.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f2b4d0d3a4df1679.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç”±äº<a href="https://github.com/toFrankie/blog/issues/263">ä¸Šä¸€ç¯‡æ–‡ç« </a>å¯¹ä½œç”¨åŸŸã€æ‰§è¡Œä¸Šä¸‹æ–‡ç­‰å†™å¾—è¿‡äºè¯¦ç»†ï¼Œè€Œä¸”å‚æ‚äº†å¾ˆå¤šå†…å®¹ï¼Œçœ‹èµ·æ¥å¹¶ä¸å¥½ç†è§£ï¼Œå› æ­¤å°±ç®€åŒ–ä¸€ä¸‹ã€‚</p>
<p>åœ¨ç½‘é¡µé‡Œï¼ŒJavaScript è„šæœ¬æ˜¯æ’å…¥åœ¨ <code>&lt;script&gt;</code> æ ‡ç­¾å†…çš„ï¼ˆå†…è”æˆ–å¤–éƒ¨å¼•å…¥ï¼‰ã€‚</p>
<pre><code class="language-html">&lt;script&gt;
  // some JavaScript code...
&lt;/script&gt;

&lt;script&gt;
  // some JavaScript code...
&lt;/script&gt;

&lt;script src=&quot;xxx&quot;&gt;&lt;/script&gt;
</code></pre>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè„šæœ¬æ˜¯æŒ‰é¡ºåºä¸€å—ä¸€å—åœ°æ‰§è¡Œçš„ï¼ˆä¸€ä¸ª <code>&lt;script&gt;</code> æ ‡ç­¾ä¸ºä¸€å—ï¼‰ã€‚åªæœ‰æ‰§è¡Œå®Œä¸€å—ï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€å—çš„ã€‚å¦‚æœå½“å‰å—æœ‰è¯­æ³•é”™è¯¯æˆ–å…¶ä»–é”™è¯¯å¯¼è‡´å½“å‰å—ç»ˆæ­¢æ‰§è¡Œï¼Œä¸ä¼šå½±å“ä¸‹ä¸€å—çš„æ‰§è¡Œã€‚</p>
<blockquote>
<p>å¯¹äºå¤–éƒ¨å¼•å…¥çš„ JavaScript è„šæœ¬ï¼Œè‹¥è®¾ç½® <code>&lt;script&gt;</code> æ ‡ç­¾çš„ <code>defer</code>ã€<code>async</code> å±æ€§ä¼šå½±å“è„šæœ¬çš„åŠ è½½é¡ºåºï¼Œä¸ä¼šæŒ‰ç€ç¼–å†™é¡ºåºæ‰§è¡Œã€‚è€Œè¿™äº›å±æ€§å¯¹äºå†…è”è„šæœ¬æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚</p>
</blockquote>
<p>è¦è®© JavaScript ä»£ç è¿è¡Œèµ·æ¥ï¼ŒåŒ…æ‹¬<strong>ç¼–è¯‘é˜¶æ®µ</strong>å’Œ<strong>æ‰§è¡Œé˜¶æ®µ</strong>ã€‚æ¯ä¸€å—è„šæœ¬çš„è¿è¡Œéƒ½åŒ…å«è¿™ä¸¤ä¸ªè¿‡ç¨‹ã€‚è¯·æ³¨æ„ï¼Œä¸æ˜¯å°†â€œæ‰€æœ‰å—â€ç¼–è¯‘å®Œå†æ‰§è¡Œçš„ã€‚</p>
<pre><code>ç¼–è¯‘é˜¶æ®µï¼š
  è¯æ³•åˆ†æï¼šå°†æºç åˆ†è§£æˆå¾ˆå¤šä¸ªæœ‰æ„ä¹‰çš„ token
  è¯­æ³•åˆ†æï¼šé€šç¯‡æ£€æŸ¥å½“å‰å—çš„è¯­æ³•æ˜¯å¦æœ‰è¯¯ï¼Œè‹¥æ— ï¼Œå°† tokens è½¬æ¢ä¸º AST
  ä»£ç ç”Ÿæˆï¼šå°† AST è½¬æ¢ä¸º JS å¼•æ“å¯æ‰§è¡Œä»£ç 

æ‰§è¡Œé˜¶æ®µï¼š
  åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡
  åˆå§‹åŒ–æ‰§è¡Œä¸Šä¸‹æ–‡
  ä»£ç æ‰§è¡Œ
</code></pre>
<p>JS å¼•æ“çš„ä¼˜åŒ–å·¥ä½œæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„ï¼Œä¾‹å¦‚ V8 å¼•æ“ã€‚è‹¥ç¼–è¯‘é˜¶æ®µæ£€æŸ¥å‡ºè¯­æ³•æœ‰è¯¯ï¼Œå°†ä¼šç»ˆæ­¢å½“å‰å—çš„åç»­é˜¶æ®µã€‚</p>
<p>å¾…ç¼–è¯‘é˜¶æ®µå®Œæˆåï¼Œæ¥ç€è¿›å…¥æ‰§è¡Œé˜¶æ®µã€‚è€Œæ‰§è¡Œé˜¶æ®µå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<blockquote>
<ol>
<li>è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>ä»£ç æ‰§è¡Œ</li>
</ol>
</blockquote>
<p>è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ­¥éª¤ï¼Œå¯ä»¥ç†è§£ä¸ºï¼ŒçœŸæ­£ä¸€è¡Œä¸€è¡Œæ‰§è¡Œä»£ç çš„å‰æœŸå‡†å¤‡å·¥ä½œï¼š</p>
<blockquote>
<ol>
<li>
<p>JS å¼•æ“åˆ›å»ºä¸€ä¸ªå«åšï¼šæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼ˆExecution Context Stackï¼ŒECSï¼‰çš„ä¸œè¥¿ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨äº†ç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡çš„ã€‚</p>
</li>
<li>
<p>æœ€å…ˆè¿›å…¥çš„è‚¯å®šæ˜¯å…¨å±€ä»£ç ï¼Œè¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡è¢«ç§°ä¸ºï¼šå…¨å±€ä¸Šä¸‹æ–‡ã€‚é¦–å…ˆæ’å…¥ ECSï¼Œå› æ­¤ ECS æ ˆåº•æ°¸è¿œæ˜¯å…¨å±€ä¸Šä¸‹æ–‡ã€‚åé¢è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šè¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œè¯¥ä¸Šä¸‹æ–‡ä¹Ÿä¼šæ’å…¥ ECSã€‚</p>
</li>
<li>
<p>æ¯è¿›å…¥ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œéƒ½ä¼šåšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</p>
</li>
</ol>
</blockquote>
<p>å¾…å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œå°±ä¼šè¿›å…¥ä»£ç æ‰§è¡Œæ­¥éª¤ï¼Œå³ä¸€è¡Œä¸€è¡Œåœ°å»æ‰§è¡Œä»£ç ã€‚</p>
<p>å¤§å®¶å¯èƒ½ç–‘æƒ‘çš„åœ°æ–¹ï¼Œåº”è¯¥æ˜¯â€œå‰æœŸå‡†å¤‡å·¥ä½œâ€çš„å…·ä½“è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<h3>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</h3>
<p>è¿›å…¥å…¨å±€ä»£ç ï¼ŒECS æ’å…¥ GlobalContextï¼Œåé¢æ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°å°±å¾€ ECS æ ˆé¡¶æ’å…¥ FunctionalContextï¼Œå‡½æ•°æ‰§è¡Œå®Œ FunctionalContext åˆä¼šä»æ ˆé¡¶åˆ é™¤......å‘¨è€Œå¤å§‹çš„è¿‡ç¨‹ã€‚ESC æ ˆåº•æ°¸è¿œä¿ç•™ç€ GlobalContextã€‚ç›´åˆ°é¡µé¢é”€æ¯ï¼Œå®ƒæ‰ä¼šè¢«åˆ é™¤ï¼ŒESC çš„ä½¿å‘½ä¹Ÿå°±ç»“æŸäº†ï¼Œè¢« JS å¼•æ“æ¸…ç©ºã€‚</p>
<pre><code class="language-js">ECS = [
  FunctionalContext // æ ˆé¡¶
  ...
  FunctionalContext
  GlobalContext  // æ ˆåº•
]
</code></pre>
<p>å‰é¢æåˆ°ä¸Šä¸‹æ–‡ï¼šGlobalContextï¼ˆå…¨å±€ä¸Šä¸‹æ–‡ï¼‰ã€FunctionalContextï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰ã€‚</p>
<h3>æ‰§è¡Œä¸Šä¸‹æ–‡</h3>
<p>å…¶å® JavaScript ä¸­æœ‰ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡ï¼š</p>
<pre><code>å…¨å±€ä¸Šä¸‹æ–‡ï¼š
  å…¨å±€ä¸‹éƒ½æ˜¯å±äºå…¨å±€ä¸Šä¸‹æ–‡ã€‚

å‡½æ•°ä¸Šä¸‹æ–‡ï¼š
  é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ JavaScript å‡½æ•°å†…çš„æ‰§è¡Œä¸Šä¸‹æ–‡

eval ä¸Šä¸‹æ–‡ï¼š
  å°±æ˜¯ eval('some code...')ï¼Œå°½å¯èƒ½ä¸è¦ç”¨ï¼Œä¼šå½±å“æ€§èƒ½ã€æ¬ºéª—è¯æ³•ä½œç”¨åŸŸ
</code></pre>
<p>æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå®ƒæœ‰ä¸‰ä¸ªé‡è¦å±æ€§ï¼š</p>
<pre><code>Variable Object: 
  å³å˜é‡å¯¹è±¡ï¼Œç®€ç§° VOã€‚æˆ‘ä»¬å£°æ˜çš„å˜é‡ã€å‡½æ•°å°±æ˜¯æ”¾åœ¨ VO ä¸­çš„ã€‚

Scope Chain: 
  å³ä½œç”¨åŸŸé“¾ï¼Œç®€ç§° Scopeã€‚å®ƒåŒ…å«äº†å½“å‰ä¸Šä¸‹æ–‡ VOï¼Œä»¥åŠå„çˆ¶çº§çš„ VOã€‚æŸ¥æ‰¾å˜é‡å°±æ˜¯æ ¹æ®è¿™é“¾æ¡å»æŸ¥è¯¢çš„ã€‚

This: 
  å³ this å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„å¯¹è±¡ï¼Œè·Ÿå‡½æ•°è°ƒç”¨ç›¸å…³ã€‚
}
</code></pre>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–å·¥ä½œï¼Œå°±æ˜¯ç¡®å®šè¿™äº›å±æ€§çš„ä¸€äº›å€¼ã€‚è¿™ä¸ªâ€œåˆå§‹åŒ–â€çš„è¿‡ç¨‹ä¹Ÿå¸¸è¢«ç§°ä¸ºâ€œé¢„ç¼–è¯‘â€ï¼Œç½‘ä¸Šå¾ˆå¤šæ–‡ç« éƒ½æœ‰è¿™ä¸ªè¯´æ³•ã€‚</p>
<h3>ä¸¾ä¾‹</h3>
<p>ä¸Šé¢çš„æ‰§è¡Œé˜¶æ®µçš„è¿‡ç¨‹ï¼Œä¸¾ä¾‹ä¼šæ›´å¥½åœ°è¯´æ˜ã€‚</p>
<pre><code class="language-js">var a = 'global'
function foo() {
  var a = 'local'
  function bar() {
    console.log(a)
  }
  bar()
}
foo() // &quot;local&quot;
</code></pre>
<p>å½“ç¼–è¯‘è¿‡ç¨‹ä¹‹åï¼Œè¿›å…¥æ‰§è¡Œé˜¶æ®µã€‚JS åˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ ECStackï¼Œæ€»æ˜¯å…ˆè¿›å…¥å…¨å±€ä¸Šä¸‹æ–‡ï¼Œå…¨å±€ä¸Šä¸‹æ–‡è¢«æ’å…¥åˆ°æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼š</p>
<pre><code class="language-js">ECStack = [ GlobalContext ]
</code></pre>
<p>æ¥ç€å¯¹ GlobalContext è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<pre><code class="language-js">GlobalContext = {
  VO: window, 
  Scope: [ GlobalContext.VO ],
  this: GlobalContext.VO
}
// æ³¨æ„ï¼Œä¸åŒå®¿ä¸»ç¯å¢ƒé¡¶å±‚å¯¹è±¡æ˜¯ä¸ä¸€æ ·çš„ã€‚
// æµè§ˆå™¨ä¸‹ä¸º window å¯¹è±¡ï¼ŒNode ä¸­ä¸º global å¯¹è±¡ã€‚
// æœ¬æ–‡ä»¥æµè§ˆå™¨ä¸ºä¾‹ï¼Œå› æ­¤ç›´æ¥å†™äº† window å¯¹è±¡ã€‚
</code></pre>
<p>åˆå§‹åŒ–çš„åŒæ—¶ <code>foo</code> å‡½æ•°ä¹Ÿè¢«åˆ›å»ºï¼Œä¼šä¿å­˜å½“å‰ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾åˆ°å‡½æ•°å†…éƒ¨çš„ <code>[[scope]]</code> å±æ€§ä¸­ã€‚è¯¥å±æ€§å¯ä»¥é€šè¿‡ <code>console.dir(foo)</code> æŸ¥çœ‹ã€‚</p>
<pre><code class="language-js">foo.[[scope]] = [ GlobalContext.VO ]
</code></pre>
<p>å½“å…¨å±€ä¸Šä¸‹æ–‡åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå¼€å§‹æ‰§è¡Œå…¨å±€ä»£ç ï¼Œå½“è¿›è¡Œåˆ° <code>foo()</code> æ—¶ï¼ŒJS å¼•æ“åˆä¼šåˆ›å»º <code>foo</code> å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶æ’å…¥ ECStack æ ˆé¡¶ã€‚</p>
<pre><code class="language-ts">ECStack = [ GlobalContext, FunctionalContext&lt;foo&gt; ]
</code></pre>
<p>è·Ÿç€ï¼Œä¼šè¿›å…¥ <code>foo</code> å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œè¯¥ä¸Šä¸‹æ–‡ä¹Ÿä¼šè¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼š</p>
<blockquote>
<ol>
<li>å¤åˆ¶ <code>foo</code> å‡½æ•° <code>[[scope]]</code> å±æ€§åˆ›å»ºä½œç”¨åŸŸé“¾ã€‚</li>
<li>ç”¨ <code>arguments</code> åˆ›å»ºæ´»åŠ¨å¯¹è±¡ AOã€‚</li>
<li>åˆå§‹åŒ–æ´»åŠ¨å¯¹è±¡ï¼Œå³ AO æŒ‰é¡ºåºåŠ å…¥ï¼šå½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ã€‚è‹¥å­˜åœ¨åŒåæƒ…å†µï¼Œå‡½æ•°å£°æ˜ä¼šè¦†ç›–å½¢å‚ï¼Œå˜é‡å£°æ˜ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>å°† AO å¯¹è±¡åŠ å…¥ <code>foo</code> ä½œç”¨åŸŸé“¾é¡¶ç«¯ã€‚</li>
</ol>
</blockquote>
<pre><code class="language-js">FunctionalContext&lt;foo&gt; = {
  AO: {
    arguments: {
      length: 0
    },
    a: undefined,
    bar: Æ’ bar()
  },
  Scope: [ GlobalContext.VO, AO ],
  this: undefined // this æ˜¯åœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™æ‰ç¡®å®šä¸‹æ¥çš„ï¼Œfoo å‡½æ•°çš„ this çš„å€¼è·Ÿä½œç”¨åŸŸé“¾æ²¡æœ‰å…³ç³»
}
</code></pre>
<p>åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œ <code>foo</code> å‡½æ•°ä½“ä»£ç ï¼ŒAO å¯¹è±¡ä¹Ÿä¼šæ›´æ–°ã€‚å½“æ‰§è¡Œåˆ° <code>bar()</code> å‡½æ•°æ—¶ï¼Œåˆå°†ä¼šè¿›å…¥ <code>bar</code> å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼š</p>
<pre><code class="language-ts">ECStack = [ GlobalContext, FunctionalContext&lt;foo&gt;, FunctionalContext&lt;bar&gt; ]
</code></pre>
<pre><code class="language-js">FunctionalContext&lt;bar&gt; = {
  AO: {
    arguments: {
      length: 0
    }
  },
  Scope: [ GlobalContext.VO, FunctionalContext&lt;foo&gt;.VO, AO ],
  this: undefined
}
</code></pre>
<p>åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œ <code>bar</code> å‡½æ•°ä»£ç ï¼Œåœ¨ <code>console.log(a)</code> ä¸­ï¼Œä¼šæŸ¥æ‰¾ <code>a</code> å˜é‡ã€‚</p>
<blockquote>
<p>æŒ‰ä½œç”¨åŸŸé“¾é¡ºåºæŸ¥æ‰¾ï¼Œå…ˆä»å½“å‰ä¸Šä¸‹æ–‡çš„ AO ä¸­æŸ¥æ‰¾ï¼Œè‹¥æŸ¥æ‰¾ä¸åˆ°å†å¾€ä¸Šä¸€å±‚ AO ä¸­æŸ¥æ‰¾...ç›´åˆ°å…¨å±€ä¸Šä¸‹æ–‡çš„ VO ä¸­æŸ¥æ‰¾ï¼Œè‹¥å†æŸ¥æ‰¾ä¸åˆ°å°±ä¼šæŠ›å‡ºå¼•ç”¨é”™è¯¯ï¼ˆReferenceErrorï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">AO -&gt; FunctionContext&lt;foo&gt;.AO -&gt; GlobalContext.VO
</code></pre>
<p>å¾ˆæ˜æ˜¾ï¼Œ<code>a</code> å˜é‡å°†ä¼šåœ¨ <code>FunctionContext&lt;foo&gt;.AO</code> ä¸­æŸ¥æ‰¾åˆ°ï¼Œå…¶å€¼ä¸º <code>&quot;local&quot;</code>ï¼Œå› æ­¤æ‰“å°ç»“æœå°±æ˜¯ <code>&quot;local&quot;</code>ã€‚</p>
<p>å¾… <code>bar()</code> æ‰§è¡Œå®Œæ¯•ï¼Œ<code>bar</code> å‡½æ•°ä¸Šä¸‹æ–‡ä¼šè¢«ä»æ ˆé¡¶åˆ é™¤ã€‚</p>
<pre><code class="language-js">ECStack.pop(FunctionalContext&lt;bar&gt;)
</code></pre>
<p>åˆå°†æ‰§è¡Œæƒäº¤è¿˜ç»™ <code>foo</code> å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œå®ƒä¹Ÿå°†ä¼šæ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä¼šä»æ ˆé¡¶ç§»é™¤ã€‚</p>
<pre><code class="language-js">ECStack.pop(FunctionalContext&lt;foo&gt;)
</code></pre>
<p>ç„¶ååˆäº¤è¿˜ç»™å…¨å±€ä¸Šä¸‹æ–‡</p>
<pre><code class="language-js">ECStack = [ GlobalContext ]
</code></pre>
<p>è‡³æ­¤ï¼Œè¿™ä¸ªç¨‹åºæ‰§è¡Œå®Œæ¯•ã€‚å½“é¡µé¢é”€æ¯æ—¶ï¼ŒECStack æ‰ä¼šè¢«æ¸…ç©ºã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript å˜é‡ä¸èƒ½è¢« delete çš„åŸå› ]]></title>
            <link>https://github.com/toFrankie/blog/issues/265</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/265</guid>
            <pubDate>Sun, 26 Feb 2023 12:22:26 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-99f1a3b86c0e0d28.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-99f1a3b86c0e0d28.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¯·è®°ä½ï¼š</p>
<blockquote>
<p>ä»»ä½•æ—¶å€™ï¼Œå˜é‡åªèƒ½é€šè¿‡ä½¿ç”¨ <code>var</code>ã€<code>let</code>ã€<code>const</code> å…³é”®å­—æ‰èƒ½è¢«å£°æ˜ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ æ— è®ºåœ¨å…¨å±€ä¸Šä¸‹æ–‡ï¼Œè¿˜æ˜¯å…¶ä»–ä»»ä½•ä¸Šä¸‹æ–‡ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡çœç•¥å˜é‡å£°æ˜å…³é”®å­—çš„å½¢å¼ï¼ˆç±»ä¼¼ <code>a = 1</code> ï¼‰ç»™å…¨å±€å¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–°â€œ<strong>å±æ€§</strong>â€ã€‚è¯·æ³¨æ„ï¼Œä¸¥æ ¼æ¥è¯´è¿™ä¸ª <code>a</code> ä¸èƒ½ç§°ä½œâ€œå˜é‡â€ï¼ŒåŸå› æ˜¯å®ƒä¸ç¬¦åˆ ECMAScript è§„èŒƒä¸­å˜é‡çš„æ¦‚å¿µã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">var a = 1
b = 2

delete a
delete b

console.log(a) // 1
console.log(b) // ReferenceError: b is not defined
</code></pre>
<blockquote>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œç¤ºä¾‹ä¸­ <code>b</code> ä¸èƒ½è¢«ç§°ä¸ºå˜é‡ã€‚å®ƒåªæ˜¯å…¨å±€å¯¹è±¡ä¸‹çš„ä¸€ä¸ªå±æ€§ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ä¸­ï¼Œå˜é‡ <code>a</code> å¹¶æ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Œè€Œ <code>b</code> å´è¢«åˆ é™¤äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé—®é¢˜å…ˆæ”¾ä¸€æ”¾</p>
<h2>delete æ“ä½œç¬¦</h2>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ <code>delete</code> æ“ä½œç¬¦æ˜¯æ€æ ·å·¥ä½œçš„ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">delete object.property
delete object['property']
</code></pre>
<p>å®ƒçš„ä½œç”¨æ˜¯åˆ é™¤å¯¹è±¡çš„æŸä¸ªå±æ€§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å®ƒçš„è¿”å›å€¼éƒ½æ˜¯ <code>true</code>ï¼Œè¡¨ç¤ºå¯¹è±¡æŸä¸ªå±æ€§è¢«ç§»é™¤æˆåŠŸã€‚è‹¥è¯¥å±æ€§æ˜¯ä¸€ä¸ª<strong>è‡ªèº«çš„ä¸å¯é…ç½®</strong>çš„å±æ€§ï¼Œè¿™æ—¶éä¸¥æ ¼æ¨¡å¼ä¸‹è¿”å› <code>false</code>ï¼ˆå³å±æ€§ç§»é™¤å¤±è´¥ï¼‰ï¼Œè€Œä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º <code>TypeError</code>ã€‚</p>
<p>ä¸Šé¢è¿™å¥è¯æœ‰ä¸¤ä¸ªå…³é”®è¯ï¼šâ€œè‡ªèº«â€ã€â€œä¸å¯é…ç½®â€ã€‚</p>
<blockquote>
<ul>
<li><strong>è‡ªèº«</strong>ï¼šæ˜¯æŒ‡å¯¹è±¡æœ¬èº«çš„å±æ€§ï¼Œè€ŒéåŸå‹ä¸Šçš„ã€‚å¯é€šè¿‡ <code>Object.prototype.hasOwnProperty()</code> åˆ¤æ–­ã€‚</li>
<li><strong>ä¸å¯é…ç½®</strong>ï¼šå…¶å®å¯¹è±¡å±æ€§éƒ½æœ‰ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡ï¼Œå±æ€§æè¿°å¯¹è±¡å…¶ä¸­åŒ…å«ä¸€ä¸ª <code>configurable</code> å±æ€§ï¼Œè‹¥ä¸º <code>false</code>ï¼Œåˆ™è¡¨ç¤ºè¯¥å±æ€§ä¸å¯é…ç½®ã€‚å¯é€šè¿‡ <code>Object.getOwnPropertyDescriptor()</code> è·å–ã€‚</li>
</ul>
</blockquote>
<pre><code class="language-js">var a = 1
b = 2

window.hasOwnProperty('a') // true
window.hasOwnProperty('b') // true

Object.getOwnPropertyDescriptor(window, 'a') // { configurable: false, ... }
Object.getOwnPropertyDescriptor(window, 'b') // { configurable: true, ... }
</code></pre>
<pre><code class="language-js">var obj = {}
obj.__proto__.prop = 'proto'
delete obj.prop // trueï¼Œå°½ç®¡ obj æœ¬èº«æ²¡æœ‰ prop å±æ€§ï¼Œä»ä¼šè¿”å› true
obj.prop // &quot;proto&quot;ï¼Œdelete ä¸ä¼šåˆ é™¤åŸå‹ä¸Šçš„å±æ€§
</code></pre>
<h2>åŒºåˆ«</h2>
<p>å›åˆ°æ–‡ä¸­å¼€å¤´çš„é—®é¢˜ï¼šå˜é‡ <code>a</code> ä¸ºä»€ä¹ˆæ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Ÿ</p>
<p>å°½ç®¡ <code>var a = 1</code> å’Œ <code>b = 2</code> éƒ½ä¼šå¾€ <code>window</code> å¯¹è±¡ä¸‹æ·»åŠ å¯¹åº”å±æ€§ï¼Œä½†æ˜¯å˜é‡ç›¸æ¯”äºç®€å•å±æ€§æ¥è¯´ï¼Œå˜é‡æœ‰ä¸€ä¸ªç‰¹æ€§ï¼š<code>DontDelete</code>ï¼Œè¿™ä¸ªç‰¹æ€§çš„å«ä¹‰å°±æ˜¯ä¸èƒ½é€šè¿‡ <code>delete</code> æ“ä½œç¬¦ç›´æ¥åˆ é™¤å˜é‡å±æ€§ã€‚</p>
<h2>eval</h2>
<p>å¦å¤–è¿˜è¦æ³¨æ„ï¼Œ<code>eval</code> ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜æ²¡æœ‰ <code>DontDelete</code> ç‰¹æ€§ï¼Œå› æ­¤æ˜¯å¯ä»¥åˆ é™¤çš„ã€‚</p>
<pre><code class="language-js">eval('var a = 1; function foo() {}')
delete a // true
delete foo // true
</code></pre>
<p>ä½†æ˜¯ <code>eval</code> ä¸Šä¸‹æ–‡å†…çš„å‡½æ•°ä½“å†…éƒ¨çš„å˜é‡æˆ–å‡½æ•°æ˜¯ä¸èƒ½åˆ é™¤çš„ã€‚</p>
<pre><code class="language-js">eval('function foo() { var inner = 2; console.log(delete inner); console.log(inner) }')
foo() // false
</code></pre>
<h2>æ€»ç»“</h2>
<ul>
<li>å…¨å±€ä¸Šä¸‹æ–‡æˆ–å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œå˜é‡å£°æ˜æˆ–å‡½æ•°å£°æ˜æ€»å«æœ‰ DontDelete ç‰¹æ€§ã€‚</li>
<li>eval ä¸Šä¸‹æ–‡çš„å˜é‡å£°æ˜æˆ–å‡½æ•°å£°æ˜ä¸å« DontDelete ç‰¹æ€§ï¼Œå› æ­¤å¯ä»¥è¢« delete åˆ é™¤ã€‚</li>
<li>ä¸è¦ç›¸ä¿¡å…¨å±€å¯¹è±¡ä¸‹çš„ <code>delete</code> æ“ä½œã€‚</li>
<li><strong>ç¼–å†™ä»£ç æ—¶ï¼Œä¸è¦å†™å‡ºç±»ä¼¼ <code>a = 1</code> çœç•¥å£°æ˜å…³é”®å­—çš„è¯­å¥ã€‚</strong></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | äº‹ä»¶è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/264</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/264</guid>
            <pubDate>Sun, 26 Feb 2023 12:19:06 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-df5c278213c2b6a7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-df5c278213c2b6a7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡å°†ä¼šä»‹ç»äº‹ä»¶ã€äº‹ä»¶æµã€äº‹ä»¶å¯¹è±¡ã€äº‹ä»¶å¤„ç†ç¨‹åºã€äº‹ä»¶å§”æ‰˜ã€ä»¥åŠå…¼å®¹ IE æµè§ˆå™¨ç­‰å†…å®¹ã€‚</p>
<h2>ä¸€ã€æ¦‚å¿µ</h2>
<p>å°±æœ¬æ–‡ä¸€äº›â€œæœ¯è¯­â€ä½œç®€å•ä»‹ç»ï¼Œåç»­ç« èŠ‚å†è¯¦è¿°ã€‚</p>
<h3>1. äº‹ä»¶</h3>
<p>äº‹ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨æˆ·ä¸æµè§ˆå™¨ï¼ˆç½‘é¡µï¼‰äº¤äº’äº§ç”Ÿçš„ä¸€ä¸ªåŠ¨ä½œã€‚æ¯”å¦‚ç‚¹å‡»ï¼ˆclickï¼‰ã€åŒå‡»ï¼ˆdblclickï¼‰ã€èšç„¦ï¼ˆfocusï¼‰ã€é¼ æ ‡æ‚¬åœï¼ˆmouseoverï¼‰ã€æ¾å¼€é”®ç›˜ï¼ˆkeyupï¼‰ç­‰åŠ¨ä½œã€‚æµè§ˆå™¨å†…éƒ¨åŒ…å«äº†éå¸¸å¤æ‚çš„äº‹ä»¶ç³»ç»Ÿï¼Œäº‹ä»¶ç§ç±»éå¸¸å¤šï¼ŒJavaScript ä¸ HTML çš„äº¤äº’å°±æ˜¯é€šè¿‡äº‹ä»¶å®ç°çš„ã€‚å‰é¢åˆ—ä¸¾è¿™äº›ä»…ä»…æ˜¯å†°å±±ä¸€è§’ã€‚</p>
<h3>2. äº‹ä»¶å¯¹è±¡</h3>
<p>åœ¨äº§ç”Ÿäº‹ä»¶ä¹‹åï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ªå¯¹è±¡å¹¶å­˜å‚¨èµ·æ¥ï¼Œå®ƒåŒ…å«äº†å½“å‰äº‹ä»¶çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ¯”å¦‚å‘ç”Ÿäº‹ä»¶çš„ç±»å‹ã€å¯¼è‡´äº‹ä»¶çš„å…ƒç´ ä»¥åŠå…¶ä»–ä¸äº‹ä»¶ç›¸å…³çš„æ•°æ®ã€‚ä¾‹å¦‚é¼ æ ‡æ“ä½œï¼Œè¯¥å¯¹è±¡è¿˜ä¼šè®°å½•äº‹ä»¶äº§ç”Ÿæ—¶é¼ æ ‡çš„ä½ç½®ç­‰ä¿¡æ¯ã€‚å¾…äº‹ä»¶å®Œæˆä½¿å‘½ï¼ˆå³äº‹ä»¶å®Œç»“ï¼‰ä¹‹åï¼Œå®ƒå°†ä¼šè¢«é”€æ¯ã€‚è¿™ä¸ªå¯¹è±¡ï¼Œè¢«ç§°ä¸ºâ€œ<strong>äº‹ä»¶æµ</strong>â€ã€‚</p>
<h3>3. äº‹ä»¶æµ</h3>
<p>äº‹ä»¶å¯¹è±¡åœ¨ DOM ä¸­çš„ä¼ æ’­è¿‡ç¨‹ï¼Œè¢«ç§°ä¸ºâ€œ<strong>äº‹ä»¶æµ</strong>â€ã€‚</p>
<p>ç»å¸¸èƒ½çœ‹åˆ°ç±»ä¼¼ IE äº‹ä»¶æµã€æ ‡å‡†äº‹ä»¶æµï¼ˆDOM äº‹ä»¶æµï¼‰çš„è¯´æ³•ï¼Œä¸»è¦åŸå› æ˜¯æ—©æœŸæµè§ˆå™¨å‚å•†å„å¹²å„çš„ï¼Œæ²¡æœ‰ä¸€ä¸ªâ€œä¸­é—´äººâ€å»è¿›è¡Œç»Ÿä¸€ã€‚éšç€ Web çš„é£é€Ÿå‘å±•ï¼Œç›¸å…³æ ‡å‡†å°±ç”±ç‰¹å®šæœºæ„åˆ¶å®šï¼Œæµè§ˆå™¨å‚å•†è´Ÿè´£æŒ‰ç…§æ ‡å‡†å»å®ç°ã€‚ä¾‹å¦‚ W3Cã€WHATWGã€ECMAScript ç­‰ã€‚ä½†ç”±äºå†å²é—ç•™åŸå› ï¼Œä¸å¾—ä¸å†™å‡ºä¸€å¤§å †çš„å…¼å®¹æ–¹æ³•ä»¥é€‚é…æ‰€æœ‰çš„æµè§ˆå™¨ã€‚</p>
<p>è¯´åˆ°äº‹ä»¶æµï¼Œå°±ä¸å¾—ä¸æâ€œäº‹ä»¶å†’æ³¡â€å’Œâ€œäº‹ä»¶æ•è·â€äº†ã€‚å®ƒä»¬åˆ†åˆ«ç”±å¾®è½¯ã€ç½‘æ™¯å›¢é˜Ÿæå‡ºï¼Œæ˜¯ä¸¤ç§å‡ ä¹å®Œå…¨ç›¸åçš„äº‹ä»¶æµæ–¹æ¡ˆã€‚å‰è€…è¢«æ‰€æœ‰æµè§ˆå™¨æ”¯æŒï¼Œåè€…åˆ™æ˜¯è¢«æ‰€æœ‰çš„ç°ä»£æµè§ˆå™¨æ‰€æ”¯æŒï¼ˆåŒ…æ‹¬ IE9 åŠä»¥ä¸Šï¼‰ã€‚</p>
<p>ç”±äºäº‹ä»¶æ•è·ä¸è¢«æ—§ç‰ˆæœ¬æµè§ˆå™¨ï¼ˆIE8 åŠä»¥ä¸‹ï¼‰æ”¯æŒï¼Œå› æ­¤å®é™…ä¸­é€šå¸¸åœ¨å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
<p><strong>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ï¼Œå°† IE8 åŠä»¥ä¸‹æµè§ˆå™¨çš„äº‹ä»¶æµå¤„ç†æ–¹æ¡ˆç§°ä¸ºâ€œIE äº‹ä»¶æµâ€ï¼Œå…¶ä½™çš„ç§°ä¸ºæ ‡å‡†äº‹ä»¶æµï¼ˆæˆ– DOM äº‹ä»¶æµï¼‰ã€‚</strong></p>
<h3>4. äº‹ä»¶å¤„ç†ç¨‹åº</h3>
<p>ä¸ºå“åº”äº‹ä»¶è€Œè°ƒç”¨çš„å‡½æ•°è¢«ç§°ä¸º**â€œäº‹ä»¶å¤„ç†ç¨‹åºâ€**ï¼ˆä¹Ÿå¯ç§°ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ã€äº‹ä»¶ç›‘å¬å™¨ã€ç›‘å¬å™¨ï¼‰ã€‚é€šå¸¸æˆ‘ä»¬ä¼šåœ¨å‘ç”Ÿäº‹ä»¶ä¹‹å‰ï¼Œéœ€æå‰ä¸ºæŸä¸ª DOM å…ƒç´ ç¼–å†™äº‹ä»¶å¤„ç†ç›‘å¬å™¨å¹¶è¿›è¡Œç»‘å®šã€‚å¾…ç”¨æˆ·ä¸æµè§ˆå™¨äº§ç”Ÿäº¤äº’åï¼Œäº‹ä»¶å¯¹è±¡ä¼šé€šè¿‡äº‹ä»¶æµæœºåˆ¶åœ¨ DOM ä¸­è¿›è¡Œä¼ æ’­ï¼Œä¸€æ—¦å‘½ä¸­ç›®æ ‡ï¼Œäº‹ä»¶ç›‘å¬å™¨å°±è¢«è°ƒç”¨ï¼Œå¹¶æ¥æ”¶äº‹ä»¶å¯¹è±¡ä½œä¸ºå…¶å”¯ä¸€çš„å‚æ•°ã€‚ï¼ˆæ³¨æ„ï¼ŒIE8 éœ€è¦é€šè¿‡ <code>window.event</code> å…¨å±€å¯¹è±¡æ¥è·å–äº‹ä»¶å¯¹è±¡ï¼‰</p>
<h3>5. äº‹ä»¶å§”æ‰˜</h3>
<p>äº‹ä»¶å§”æ‰˜ï¼Œå®ƒæ˜¯åˆ©ç”¨äº‹ä»¶æµæœºåˆ¶æ¥æé«˜é¡µé¢æ€§èƒ½çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿè¢«ç§°ä¸ºäº‹ä»¶ä»£ç†ã€‚</p>
<h3>6. å…¶ä»–</h3>
<p>æ–‡ä¸­è¿˜ä¼šæåˆ°<strong>äº‹ä»¶ç›®æ ‡</strong>ä¸€è¯ï¼Œæ˜¯æŒ‡è§¦å‘äº‹ä»¶çš„ DOM å…ƒç´ ï¼Œä½†ä¸ä¸€å®šæ˜¯äº‹ä»¶å¤„ç†ç¨‹åºæ‰€åœ¨çš„ DOM å…ƒç´ ã€‚å½“ç”Ÿæˆäº‹ä»¶å¯¹è±¡ä¹‹åï¼Œäº‹ä»¶ç›®æ ‡ï¼ˆåœ¨ JavaScript å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰å°†ä¼šè¢«å­˜å‚¨åœ¨äº‹ä»¶å¯¹è±¡çš„ <code>target</code> å±æ€§ï¼ˆåªè¯»ï¼ŒIE8 åˆ™æ˜¯ <code>srcElement</code> å±æ€§ï¼‰ã€‚</p>
<p>è¿˜æœ‰ï¼Œæœ¬æ–‡å°†å¤§é‡ä½¿ç”¨åˆ°â€œç°ä»£æµè§ˆå™¨â€ã€â€œä¸»æµæµè§ˆå™¨â€ã€â€œæ ‡å‡†æµè§ˆå™¨â€ã€â€œIE æµè§ˆå™¨â€ç­‰è¯è¯­ã€‚è‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œå‰ä¸‰ä¸ªæŒ‡çš„æ˜¯åŒ…æ‹¬ IE9 ~ IE11 åŠå…¶ä»–å¸¸è§çš„æµè§ˆå™¨ã€‚è€Œâ€œIE æµè§ˆå™¨â€é€šå¸¸æŒ‡ IE8 åŠæ›´ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ã€‚</p>
<h2>äºŒã€äº‹ä»¶æµ</h2>
<p>å‰é¢æåˆ°ï¼Œäº‹ä»¶æµå°±æ˜¯äº‹ä»¶å¯¹è±¡åœ¨ DOM ä¸­çš„ä¼ æ’­è¿‡ç¨‹ã€‚æ ‡å‡†äº‹ä»¶æµè¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">æ•è·é˜¶æ®µ -&gt; ç›®æ ‡é˜¶æ®µ -&gt; å†’æ³¡é˜¶æ®µ

Captruing Phase -&gt; Target Phase -&gt; Bubbling Phase
</code></pre>
<blockquote>
<p>å…¶ä¸­ IE8 åŠä»¥ä¸‹æµè§ˆå™¨ï¼Œä¸æ”¯æŒäº‹ä»¶æ•è·ã€‚å³ IE8 äº‹ä»¶æµåˆ™ä¸å«æ•è·é˜¶æ®µã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;div id=&quot;div&quot;&gt;
  Division
  &lt;p id=&quot;p&quot;&gt;Paragraph&lt;/p&gt;
&lt;/div&gt;
</code></pre>
<p>ç»“åˆäº‹ä»¶æµï¼Œå½“æˆ‘ä»¬ç‚¹å‡» <code>&lt;p&gt;</code> å…ƒç´ ï¼Œäº§ç”Ÿä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚äº‹ä»¶å¯¹è±¡çš„æ•è·é˜¶æ®µçš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">window -&gt; document -&gt; html -&gt; body -&gt; div -&gt; p

æ³¨ï¼šåˆ°è¾¾ p ä¹‹å‰æ˜¯æ•è·é˜¶æ®µçš„æ‰€æœ‰è¿‡ç¨‹ï¼Œåˆ°è¾¾ p å¤„äºç›®æ ‡é˜¶æ®µã€‚
</code></pre>
<p>ç›®æ ‡é˜¶æ®µè¿‡åï¼Œæ˜¯å†’æ³¡é˜¶æ®µçš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">p -&gt; div -&gt; body -&gt; html -&gt; document -&gt; window
</code></pre>
<p>å› æ­¤ï¼Œäº‹ä»¶æµè¿‡ç¨‹å¯ä»¥ç®€å•ç»˜æˆå¦‚ä¸‹è¡¨æ ¼ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-480bc41dde14de5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<!--

```text

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                               DOM_EVENT                                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                           â”‚                  IE_EVENT                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚              CAPTURING_PHASE              â”‚   AT_TARGET   â”‚               BUBBLING_PHASE               â”‚
    â”‚                                           â”‚               â”‚                                            â”‚
    â”‚                                           â”‚               â”‚                                            â”‚
    â”‚                                           â”‚               â”‚                                            â”‚
    " window -> document -> html -> body -> div ->      p       -> div -> body -> html -> document -> window "
    â”‚                                           â”‚               â”‚                                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (DOM_EVENT è¡¨ç¤ºæ ‡å‡†äº‹ä»¶æµï¼›IE_EVENT è¡¨ç¤º IE äº‹ä»¶æµã€‚)
    (CAPTURING_PHASE è¡¨ç¤ºæ•è·é˜¶æ®µï¼›AT_TARGET è¡¨ç¤ºç›®æ ‡é˜¶æ®µï¼›BUBBLING_PHASE è¡¨ç¤ºå†’æ³¡é˜¶æ®µã€‚)
    
```

-->
<h3>1. äº‹ä»¶æ•è·ã€äº‹ä»¶å†’æ³¡</h3>
<p>ä¸Šé¢æåˆ°çš„æ•è·é˜¶æ®µå’Œå†’æ³¡é˜¶æ®µï¼Œæ‰€å¯¹åº”çš„å°±æ˜¯äº‹ä»¶æ•è·ã€äº‹ä»¶å†’æ³¡ã€‚</p>
<p>äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·ï¼Œåˆ†åˆ«ç”±å¾®è½¯å’Œç½‘æ™¯å›¢é˜Ÿæå‡ºï¼Œè¿™æ˜¯å‡ ä¹å®Œå…¨ç›¸åçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œæ˜¯ä¸ºäº†è§£å†³é¡µé¢ä¸­äº‹ä»¶æµè€Œæå‡ºçš„ã€‚</p>
<ul>
<li><strong>äº‹ä»¶å†’æ³¡ï¼ˆEvent Bubblingï¼‰</strong></li>
</ul>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šæ°”æ³¡ä»æ°´ä¸­å†’å‡ºæ°´é¢çš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ä»é‡Œï¼ˆåº•ï¼‰åˆ°å¤–çš„ã€‚äº‹ä»¶å†’æ³¡è·Ÿè¿™ä¸ªè¿‡ç¨‹å¾ˆç›¸ä¼¼ï¼Œäº‹ä»¶å¯¹è±¡ä¼šä»æœ€å†…å±‚çš„å…ƒç´ å¼€å§‹ï¼Œä¸€ç›´å‘ä¸Šä¼ æ’­ï¼Œç›´åˆ° <code>window</code> å¯¹è±¡ã€‚å› æ­¤å†’æ³¡è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">p -&gt; div -&gt; body -&gt; html -&gt; document -&gt; window
</code></pre>
<p>æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡è¡Œä¸ºï¼Œæ¯”å¦‚ <code>onblur</code>ã€<code>onfocus</code> ç­‰äº‹ä»¶ã€‚</p>
<ul>
<li><strong>äº‹ä»¶æ•è·ï¼ˆEvent Captureï¼‰</strong></li>
</ul>
<p>æ—¢ç„¶äº‹ä»¶æ•è·ä¸äº‹ä»¶å†’æ³¡æ˜¯ç›¸åçš„ï¼Œæ•è·è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">window -&gt; document -&gt; html -&gt; body -&gt; div -&gt; p
</code></pre>
<p>æ€»çš„æ¥è¯´ï¼Œå¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼šå†’æ³¡è¿‡ç¨‹æ˜¯ç”±é‡Œåˆ°å¤–ï¼Œè€Œæ•è·è¿‡ç¨‹åˆ™æ˜¯ç”±å¤–åˆ°é‡Œã€‚ä¸¤è€…åˆšå¥½ç›¸åã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œç°ä»£æµè§ˆå™¨éƒ½æ˜¯ä» <code>window</code> å¯¹è±¡å¼€å§‹æ•è·äº‹ä»¶çš„ï¼Œå†’æ³¡æœ€åä¸€ç«™ä¹Ÿæ˜¯ <code>window</code> å¯¹è±¡ã€‚è€Œ IE8 åŠä»¥ä¸‹æµè§ˆå™¨ï¼Œåªä¼šå†’æ³¡åˆ° <code>document</code> å¯¹è±¡ã€‚</p>
</blockquote>
<h3>2. ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬åˆ†åˆ«ç»™ <code>div</code> å’Œ <code>p</code> å…ƒç´ æ·»åŠ äº†ä¸¤ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const elem1 = document.getElementById('div')
const elem2 = document.getElementById('p')

// æ•è·é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†ç¨‹åº
elem1.addEventListener('click', () =&gt; console.log('div capturing'), true)
elem2.addEventListener('click', () =&gt; console.log('p capturing'), true)

// å†’æ³¡é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†ç¨‹åº
elem1.addEventListener('click', () =&gt; console.log('div bubbling'), false)
elem2.addEventListener('click', () =&gt; console.log('p bubbling'), false)

// æ³¨æ„ï¼Œæœ¬ç¤ºä¾‹åœ¨ç°ä»£æµè§ˆå™¨ä¸­å¯æ­£å¸¸æ‰§è¡Œã€‚
</code></pre>
<pre><code class="language-text">1. ç‚¹å‡» div å…ƒç´ åŒºåŸŸï¼ˆä¸åŒ…å« p å…ƒç´ åŒºåŸŸï¼‰ï¼Œå…ˆåæ‰“å°ï¼š

div capturing
div bubbling

2. ç‚¹å‡» p å…ƒç´ åŒºåŸŸï¼Œå…ˆåæ‰“å°ï¼š

div capturing
p capturing
p bubbling
div bubbling
</code></pre>
<h3>3. æ³¨æ„ç‚¹</h3>
<p>é€šè¿‡ DOM2 Event æä¾›çš„ <code>addEventListener()</code> æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ•è·é˜¶æ®µè§¦å‘äº‹ä»¶ç›‘å¬å™¨ã€‚åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­ï¼Œé™¤äº†å¯ä»¥å†™ä¸šåŠ¡é€»è¾‘å¤–ï¼Œè¿˜ç»å¸¸åšé˜»æ­¢äº‹ä»¶å†’æ³¡ã€å–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸ºç­‰å¤„ç†ã€‚</p>
<p>å¦‚æœä¸æ”¯æŒæŸä¸ªé˜¶æ®µï¼Œæˆ–äº‹ä»¶å¯¹è±¡å·²åœæ­¢ä¼ æ’­ï¼Œåˆ™å°†è·³è¿‡è¯¥é˜¶æ®µã€‚ä¾‹å¦‚ï¼Œå°† <code>addEventListener()</code> æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•° <code>useCapture</code> è®¾ä¸º <code>true</code>ï¼Œåˆ™å°†è·³è¿‡å†’æ³¡é˜¶æ®µï¼ˆä½†æ³¨æ„å®ƒæ˜¯ä¼šåˆ°è¾¾ç›®æ ‡é˜¶æ®µçš„ï¼‰ã€‚å¦‚æœäº‹ä»¶ç›‘å¬å™¨ä¸­è°ƒç”¨äº† <code>stopPropagation()</code>ï¼Œåˆ™å°†è·³è¿‡åç»­çš„æ‰€æœ‰é˜¶æ®µã€‚</p>
<p>è¿˜æœ‰ï¼Œæˆ‘ä»¬ç»™æŸä¸ª DOM å…ƒç´ æ³¨å†Œä¸€ä¸ªç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œå‡è®¾å…¶åä»£å…ƒç´ æœªé˜»æ­¢å†’æ³¡è¡Œä¸ºï¼Œåªè¦ç‚¹å‡»è¯¥å…ƒç´ æœ¬èº«æˆ–å…¶åä»£ä»»æ„å­å…ƒç´ ï¼Œæœ€åéƒ½ä¼šè§¦å‘è¯¥äº‹ä»¶ç›‘å¬å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼š<strong>äº‹ä»¶ç›‘å¬å‡½æ•°çš„ä½œç”¨èŒƒå›´ï¼ŒåŒ…å«å…ƒç´ æœ¬èº«æ‰€å ç©ºé—´åŠå…¶åä»£å…ƒç´ æ‰€å ç©ºé—´</strong>ã€‚ä¸è®ºåä»£å…ƒç´ æ˜¯å¦æº¢å‡ºå½“å‰å…ƒç´ èŒƒå›´ï¼ˆé•¿å®½ï¼‰ï¼Œæˆ–è€…æ˜¯å¦è„±ç¦»æ–‡æ¡£æµï¼ˆæŒ‡ç»å¯¹å¸ƒå±€ç­‰ï¼‰ã€‚</p>
<h2>å››ã€äº‹ä»¶å¯¹è±¡</h2>
<p>å‰é¢æåˆ°ï¼Œå½“ç”¨æˆ·ä¸æµè§ˆå™¨å‘ç”Ÿäº¤äº’ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œæ¥ç€ä¼šåˆ›å»ºç”Ÿæˆä¸€ä¸ªäº‹ä»¶å¯¹è±¡ã€‚</p>
<h3>1. è·å–äº‹ä»¶å¯¹è±¡</h3>
<p>åœ¨æ ‡å‡†æµè§ˆå™¨ä¸­ï¼Œæ— è®ºæ˜¯ä»¥å“ªç§æ–¹å¼ï¼ˆDOM0 æˆ– DOM2ï¼‰æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œäº‹ä»¶å¯¹è±¡éƒ½æ˜¯ä¼ ç»™äº‹ä»¶å¤„ç†ç¨‹åºçš„å”¯ä¸€å‚æ•°ã€‚ä½†æ˜¯åœ¨ IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸‹äº‹ä»¶å¯¹è±¡åªèƒ½é€šè¿‡ <code>window.event</code> è·å–ã€‚</p>
<pre><code class="language-js">target.onclick = function (e) {
  // ä»¥ä¸‹æ–¹å¼å¯å…¼å®¹æ‰€æœ‰æµè§ˆå™¨
  var ev = e || window.event
}

// âš ï¸ ä»¥ä¸‹è¿™å—å†…å®¹ï¼Œçº¯å±æ»¡è¶³ä¸ªäººå¼ºè¿«ç—‡ï¼Œå»ºè®®è·³è¿‡ï¼ï¼ï¼
//
// å…³äº e å’Œ window.event çš„å¼‚åŒï¼ˆäº²æµ‹ï¼‰ï¼š
//
// 1. åœ¨æ ‡å‡†æµè§ˆå™¨, å¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹å¤„ç†ï¼ŒåŒæ ·æ”¯æŒ window.event å¯¹è±¡ï¼Œå®é™…ä¸­æˆ‘ä»¬ä»äº‹ä»¶ç›‘å¬å‡½æ•°å‚æ•° e å–å€¼å³å¯ã€‚
//    äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ e === window.eventã€‚å½“äº‹ä»¶ç»“æŸåï¼Œwindow.event çš„å€¼å˜ä¸º undefinedã€‚
//    è¿™ç‚¹ IE11 ä¸æ ‡å‡†æµè§ˆå™¨è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚
//
// 2. åœ¨ IE9ã€IE10 ä¸­ï¼Œe å¯èƒ½æ˜¯ MouseEvent ç­‰å®ä¾‹å¯¹è±¡ï¼Œ
//    è€Œ window.event æ˜¯ MSEventObj å®ä¾‹å¯¹è±¡ï¼Œ
//    å› æ­¤ï¼Œe !== window.eventï¼Œä½†é—®é¢˜ä¸å¤§ã€‚
//
// 3. åœ¨ IE8 åŠä»¥ä¸‹ï¼ŒDOM0 äº‹ä»¶å¤„ç†ç¨‹åºä¸­å°†ä¸ä¼šæ¥æ”¶åˆ°äº‹ä»¶å¯¹è±¡ï¼Œå³ e ä¸º undefinedã€‚
//    æ­¤æ—¶è¦è·å–äº‹ä»¶å¯¹è±¡ï¼Œåªèƒ½é€šè¿‡å…¨å±€ window.event è·å–ã€‚
//    è€Œä¸” window.event æ˜¯ Object çš„å®ä¾‹ï¼ŒIE8 ä¸‹å¹¶æ²¡æœ‰ MSEventObj å¯¹è±¡ï¼Œä¸ IE9 ~ 10 æœ‰ç»†å¾®å·®åˆ«ã€‚
//    åŒæ ·åœ°ï¼Œwindow.event åªåœ¨äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹æœ‰æ•ˆï¼Œå…¶ä»–æ—¶å€™å–åˆ°çš„å€¼ä¸º nullã€‚
//    è¿˜æœ‰å¶ç„¶å‘ç°ï¼Œåœ¨ IE8 ä¸‹ç«Ÿç„¶ Object.prototype.toString.call(null) === '[object Object]'ï¼Œæ— è¯­ï¼
//
// 4. ç»¼ä¸Šï¼Œæƒ³è¦åœ¨äº‹ä»¶ç›‘å¬å‡½æ•°ä¸­å–åˆ°äº‹ä»¶å¯¹è±¡ï¼Œåªéœ€é€šè¿‡ï¼š
//    var ev = e || window.event 
//    ä»¥ä¸Šè¿™æ¡è¯­å¥ï¼Œå¯ä»¥å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œå¹¶æ­£ç¡®è·å–åˆ°äº‹ä»¶å¯¹è±¡ã€‚
//    è‡³äº IE9 ~ 10 ä¸­ e ä¸ window.event çš„ç»†å¾®å·®å¼‚ï¼Œå®é™…ä¸­æ— éœ€å…³å¿ƒï¼Œæ²¡æœ‰å½±å“ã€‚
//
// 5. That's all.
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>äº‹ä»¶å¯¹è±¡ä»…åœ¨äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹æœ‰æ•ˆï¼Œä¸€æ—¦äº‹ä»¶å®Œæ¯•ï¼Œå°±ä¼šè¢«é”€æ¯</strong>ã€‚è¿™ä¸€ç‚¹æ‰€æœ‰æµè§ˆå™¨è¡¨ç°ä¸€è‡´ã€‚</p>
</blockquote>
<p>åœ¨æ ‡å‡†æµè§ˆå™¨é‡Œï¼Œå¯ä»¥é€šè¿‡ <code>window.event</code> æˆ–è€…äº‹ä»¶å¯¹è±¡çš„ <code>eventPhase</code> å±æ€§æ¥éªŒè¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">target.onclick = function (e) {
  console.log(e === window.event) // true

  setTimeout(() =&gt; {
    console.log(e.eventPhase) // 0
    console.log(window.event) // undefined
  })
}

// âš ï¸ è§£é‡Šï¼š
// 1. åœ¨æ ‡å‡†æµè§ˆå™¨ï¼Œäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ç›‘å¬å™¨å‚æ•° e ä¸å…¨å±€å¯¹è±¡ window.event æ˜¯ä¸€è‡´çš„
// 2. äº‹ä»¶å¯¹è±¡ eventPhase å±æ€§ä¸º 0 è¡¨ç¤ºç›®å‰æ²¡æœ‰äº‹ä»¶æ­£åœ¨æ‰§è¡Œã€‚
</code></pre>
<h3>2. å†…ç½®äº‹ä»¶ç±»å‹</h3>
<p>åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œå†…ç½®äº†å¾ˆå¤šäº‹ä»¶ç±»å‹ï¼š</p>
<ul>
<li>ç”¨æˆ·ç•Œé¢äº‹ä»¶ï¼ˆUIEventï¼‰</li>
<li>é¼ æ ‡äº‹ä»¶ï¼ˆMouseEventï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event#%E5%9F%BA%E4%BA%8E_event_%E7%9A%84%E6%8E%A5%E5%8F%A3">è¿˜æœ‰å¾ˆå¤šå†…ç½®äº‹ä»¶ç±»å‹ï¼Œè¯·çœ‹...</a></li>
</ul>
<p>ä»¥ä¸Šè¿™äº›éƒ½æ˜¯åŸºäº <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event">Event</a> æ¥å£çš„æ´¾ç”Ÿç±»ï¼Œè€Œäº‹ä»¶å¯¹è±¡ä¸€èˆ¬æ˜¯æ´¾ç”Ÿç±»çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">target.onclick = function (e) {
  var ev = e || window.event
  console.log(ev instanceof Event) // true
  console.log(ev instanceof MouseEvent) // true
}

// âš ï¸ 
// æ³¨æ„ IE8 ä¸å« MouseEvent ç­‰æ´¾ç”Ÿç±»ï¼Œåªæœ‰ Event åŸºç±»ï¼Œ
// å› æ­¤ IE8 ä¸­ç¬¬ 4 è¡Œä¼šæŠ›å‡ºé”™è¯¯ã€‚
</code></pre>
<blockquote>
<p>å†å•°å—¦ä¸€å¥ï¼Œ<code>window.event</code> æœ€åˆæ˜¯ç”± IE å¼•å…¥çš„å…¨å±€å±æ€§ï¼Œä¸”åªæœ‰äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹æœ‰æ•ˆã€‚ç°ä»£æµè§ˆå™¨ä¸ºäº†å…¼å®¹ï¼Œä¹Ÿå®ç°äº†è¿™ä¸ªå…¨å±€å±æ€§ã€‚</p>
</blockquote>
<h3>3. Event å¯¹è±¡</h3>
<p>å‰é¢æåˆ°ï¼Œæ‰€æœ‰äº‹ä»¶å¯¹è±¡éƒ½æºè‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event">Event</a> åŸºç±»ï¼Œæ„å‘³ç€ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event">Event</a> åŸºç±»ï¼ˆå¯¹è±¡ï¼‰æœ¬èº«åŒ…å«é€‚ç”¨äºæ‰€æœ‰äº‹ä»¶ç±»å‹å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ã€‚ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚</p>
<ul>
<li>æ ‡å‡†æµè§ˆå™¨ä¸­ Event å¯¹è±¡å¸¸ç”¨å±æ€§ï¼š</li>
</ul>
<pre><code class="language-js">Event = {
  bubbles        // ï¼ˆåªè¯»ï¼Œå¸ƒå°”å€¼ï¼‰è¡¨ç¤ºå½“å‰äº‹ä»¶æ˜¯å¦ä¼šå†’æ³¡ã€‚

  eventPhase     // ï¼ˆåªè¯»ï¼Œæ•°å€¼èŒƒå›´ 0 ~ 3ï¼‰è¡¨ç¤ºäº‹ä»¶æµæ­£è¢«å¤„ç†åˆ°äº†å“ªä¸ªé˜¶æ®µã€‚
                 // 0 è¡¨ç¤ºå½“å‰æ²¡æœ‰äº‹ä»¶æ­£åœ¨è¢«å¤„ç†ï¼Œ
                 // 1 ~ 3 åˆ†åˆ«è¡¨ç¤ºäº‹ä»¶å¯¹è±¡å¤„äºæ•è·ã€ç›®æ ‡ã€å†’æ³¡é˜¶æ®µã€‚

  cancelable     // ï¼ˆåªè¯»ï¼Œå¸ƒå°”å€¼ï¼‰è¡¨ç¤ºäº‹ä»¶æ˜¯å¦å¯ä»¥å–æ¶ˆå…ƒç´ çš„é»˜è®¤è¡Œä¸ºã€‚
                 // è‹¥ä¸º true å¯ä»¥ä½¿ç”¨ preventDefault() æ¥å–æ¶ˆå…ƒç´ çš„é»˜è®¤è¡Œä¸ºã€‚
                 // è‹¥ä¸º false è°ƒç”¨ preventDefault() æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚

  cancelBubble   // ï¼ˆå¸ƒå°”å€¼ï¼‰å¦‚æœè®¾ä¸º trueï¼Œç›¸å½“äºæ‰§è¡Œ stopPropagation()ï¼Œäº‹ä»¶å¯¹è±¡å°†ä¼šåœæ­¢ä¼ æ’­ã€‚
                 // æ ‡å‡†æµè§ˆå™¨ä¸­ï¼Œè¯·ä½¿ç”¨ stopPropagation()ï¼›
                 // IE8 æµè§ˆå™¨ä¸­ï¼Œåªèƒ½ä½¿ç”¨ cancelBubble = true æ¥é˜»æ­¢ä¼ æ’­ï¼›

  currentTarget   // ï¼ˆåªè¯»ï¼‰è¿”å›å½“å‰äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»‘å®šçš„èŠ‚ç‚¹ï¼ˆä¸ä¸€å®šæ˜¯äº‹ä»¶è§¦å‘èŠ‚ç‚¹ï¼‰ã€‚
                  // æ ‡å‡†æµè§ˆå™¨ï¼Œthis === currentTarget æ€»ä¸º trueã€‚
                  // IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸æ”¯æŒè¯¥å±æ€§ã€‚

  target          // ï¼ˆåªè¯»ï¼‰è¿”å›äº‹ä»¶è§¦å‘èŠ‚ç‚¹ï¼ˆå³äº‹ä»¶ç›®æ ‡ï¼‰ã€‚
                  // å½“äº‹ä»¶è§¦å‘èŠ‚ç‚¹ä¸äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»‘å®šèŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œtarget === currentTarget ç»“æœä¸º trueã€‚
                  // IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸­ä¸æ”¯æŒè¯¥å±æ€§ï¼Œè¯·ä½¿ç”¨ srcElement å±æ€§ï¼ˆç›¸å½“äº target å±æ€§ï¼‰ã€‚

  type            // ï¼ˆåªè¯»ï¼Œå­—ç¬¦ä¸²ï¼‰è¡¨ç¤ºäº‹ä»¶ç±»å‹

  isTrusted       // ï¼ˆåªè¯»ï¼Œå¸ƒå°”å€¼ï¼‰true è¡¨ç¤ºäº‹ä»¶æ˜¯ç”±æµè§ˆå™¨ç”Ÿæˆçš„ã€‚
                  // false è¡¨ç¤ºç”± JavaScript åˆ›å»ºï¼Œä¸€èˆ¬æŒ‡è‡ªå®šä¹‰äº‹ä»¶ã€‚

  detail          // æ•°å€¼ã€‚è¯¥å±æ€§åªæœ‰æµè§ˆå™¨çš„ UI äº‹ä»¶æ‰å…·æœ‰ï¼Œè¡¨ç¤ºäº‹ä»¶çš„æŸç§ä¿¡æ¯ã€‚
                  // ä¾‹å¦‚ï¼Œå•å‡»ä¸º 1ï¼ŒåŒå‡»ä¸º 2ï¼Œä¸‰å‡»ä¸º 3ã€‚

  composed        // ï¼ˆåªè¯»ï¼Œå¸ƒå°”å€¼ï¼‰è¡¨ç¤ºäº‹ä»¶æ˜¯å¦å¯ä»¥ç©¿è¿‡ Shadow DOM å’Œå¸¸è§„ DOM ä¹‹é—´çš„éš”é˜‚è¿›è¡Œå†’æ³¡ã€‚
                  // æ›¿ä»£å·²åºŸå¼ƒçš„æ˜¯ scoped å±æ€§ã€‚
}
</code></pre>
<ul>
<li>æ ‡å‡†æµè§ˆå™¨ä¸­ Event å¯¹è±¡å¸¸ç”¨æ–¹æ³•ï¼š</li>
</ul>
<pre><code class="language-js">Event = {
  preventDefault()    // å–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸º
                      // ä»…å½“ cancelable ä¸º true æ—¶ï¼Œè°ƒç”¨ preventDefault() æ‰æœ‰æ•ˆã€‚
                      // IE8 åŠä»¥ä¸‹æµè§ˆå™¨ï¼Œè¯·è®¾ç½® returnValue = false æ¥å–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸º

  stopPropagation()   // åœæ­¢äº‹ä»¶å¯¹è±¡çš„ä¼ æ’­ï¼Œåç»­äº‹ä»¶æµå…¶ä»–é˜¶æ®µå°†ä¼šè¢«å–æ¶ˆã€‚
                      // IE8 åŠä»¥ä¸‹æµè§ˆå™¨ï¼Œè¯·è®¾ç½® cancelBubble = trueï¼Œæ¥é˜»æ­¢å†’æ³¡è¡Œä¸º
                      // æ³¨æ„ IE8 åŠä»¥ä¸‹æµè§ˆå™¨â€œæœ‰ä¸”ä»…æœ‰â€äº‹ä»¶å†’æ³¡è¿‡ç¨‹ã€‚

  stopImmediatePropagation() // ç”¨æ¥é˜»æ­¢åŒä¸€æ—¶é—´çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨ã€‚
                             // å½“åŒä¸€èŠ‚ç‚¹åŒä¸€äº‹ä»¶æŒ‡å®šå¤šä¸ªç›‘å¬å‡½æ•°æ—¶ï¼Œè¿™äº›å‡½æ•°
                             // ä¼šæ ¹æ®æ·»åŠ æ¬¡åºä¾æ¬¡è°ƒç”¨ã€‚ä½†åªè¦å…¶ä¸­ä¸€ä¸ªç›‘å¬å‡½æ•°è°ƒç”¨äº†
                             // stopImmediatePropagation() æ–¹æ³•ï¼Œå…¶ä»–ç›‘å¬å‡½æ•°å°±ä¸ä¼šæ‰§è¡Œäº†ã€‚
                             // DOM3 Event æ–°å¢æ–¹æ³•
}
</code></pre>
<ul>
<li>IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸­ Event å¯¹è±¡å¸¸ç”¨å±æ€§ï¼š</li>
</ul>
<pre><code class="language-js">Event = {
  cancelBubble   // ï¼ˆå¯è¯»å†™ï¼Œå¸ƒå°”å€¼ï¼‰è®¾ç½®ä¸º true å¯ä»¥é˜»æ­¢å†’æ³¡è¡Œä¸ºã€‚
                 // ä½œç”¨åŒæ ‡å‡†æµè§ˆå™¨ä¸­çš„ stopPropagation() æ–¹æ³•ã€‚

  returnValue    // ï¼ˆå¯è¯»å†™ï¼Œå¸ƒå°”å€¼ï¼‰é»˜è®¤ä¸º trueã€‚
                 // è®¾ç½®ä¸º false å¯ä»¥å–æ¶ˆå…ƒç´ çš„é»˜è®¤è¡Œä¸º
                 // ä½œç”¨åŒæ ‡å‡†æµè§ˆå™¨ä¸­çš„ preventDefault() æ–¹æ³•ã€‚

  srcElement     // ï¼ˆåªè¯»ï¼‰è¿”å›äº‹ä»¶è§¦å‘èŠ‚ç‚¹ï¼ˆå³äº‹ä»¶ç›®æ ‡ï¼‰ã€‚
                 // ä½œç”¨åŒæ ‡å‡†æµè§ˆå™¨ä¸­çš„ target å±æ€§ã€‚

  type           // ï¼ˆåªè¯»ï¼Œå­—ç¬¦ä¸²ï¼‰è¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼ˆåŒæ ‡å‡†æµè§ˆå™¨çš„ type å±æ€§ï¼‰ã€‚
}
</code></pre>
<p>ä»¥ä¸Šè¿™äº›æ–¹æ³•ï¼ˆåŒ…æ‹¬æ ‡å‡†æµè§ˆå™¨ã€IE æµè§ˆå™¨ï¼‰åˆ—ä¸¾å‡ºæ¥æ˜¯ä¸ºäº†æ–¹ä¾¿ä¸‹æ–‡å°è£…æ–¹æ³•æ—¶ï¼Œæ³¨æ„å…¼å®¹å¤„ç†ã€‚</p>
<h2>äº”ã€äº‹ä»¶å†’æ³¡ä¸é»˜è®¤è¡Œä¸º</h2>
<p>å‰é¢æåˆ°ï¼Œå¹¶éæ‰€æœ‰äº‹ä»¶éƒ½æ”¯æŒå†’æ³¡è¡Œä¸ºã€‚å› æ­¤ï¼Œè‹¥ç»™ä¸æ”¯æŒå†’æ³¡è¡Œä¸ºçš„äº‹ä»¶å» <code>stopPropagation()</code> æ˜¯å¤šæ¬¡ä¸€ä¸¾ï¼Œä¸”æ²¡æœ‰æ„ä¹‰ã€‚å–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸ºåŒç†ã€‚</p>
<p>é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œå…ƒç´ é»˜è®¤è¡Œä¸ºç»å¸¸æ”¾åœ¨ä¸€èµ·è®¨è®ºã€‚ä¸Šä¸€ç« èŠ‚å·²ç»æ¸…æ¥šä»‹ç»äº†æ ‡å‡†æµè§ˆå™¨ä¸ IE æµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// é˜»æ­¢å†’æ³¡
ev.stopPropagation() // æ ‡å‡†æµè§ˆå™¨
ev.cancelBubble = true // IE8 åŠä»¥ä¸‹æµè§ˆå™¨

// å–æ¶ˆé»˜è®¤è¡Œä¸º
ev.preventDefault() // æ ‡å‡†æµè§ˆå™¨
ev.returnValue = false // IE8 åŠä»¥ä¸‹æµè§ˆå™¨

// âš ï¸ ev è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­çš„äº‹ä»¶å¯¹è±¡
</code></pre>
<p>è¿˜æœ‰ï¼Œåœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ…ç”¨ <code>return false</code> è¯­å¥ï¼Œä¸åŒç¯å¢ƒä¸‹ä¼šå‘ç”Ÿéé¢„æœŸè¡Œä¸ºã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">// åŸç”Ÿ JSï¼Œåªä¼šå–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸ºï¼Œä¸ä¼šé˜»æ­¢äº‹ä»¶å†’æ³¡è¡Œä¸º
target.onclick = function (e) {
  return false
}

// JQueryï¼Œæ—¢ä¼šå–æ¶ˆå…ƒç´ é»˜è®¤è¡Œä¸ºï¼Œä¹Ÿä¼šé˜»æ­¢äº‹ä»¶å†’æ³¡è¡Œä¸º
$(target).on('click', function (e) {
  return false
})
</code></pre>
<blockquote>
<p>å› æ­¤ï¼Œæ— è®ºä½¿ç”¨ JQuery åº“æˆ–å…¶ä»–åº“ï¼Œè¿˜æ˜¯åŸç”Ÿ JS å»ç¼–å†™äº‹ä»¶å¤„ç†ç¨‹åºï¼Œéƒ½å°½é‡é¿å…ä½¿ç”¨ <code>return</code> è¯­å¥ã€‚</p>
<p>å…¶å® JQuery å·²ç»ç»™æˆ‘ä»¬å°è£…äº† <code>stopPropagation()</code> å’Œ <code>preventDefault()</code> æ–¹æ³•ï¼Œå®ƒæ˜¯å…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„ï¼Œå› æ­¤æŒ‰ç…§æ ‡å‡†æµè§ˆå™¨çš„æ–¹å¼æ¥å»é˜»æ­¢å†’æ³¡æˆ–å–æ¶ˆé»˜è®¤è¡Œä¸ºå³å¯ã€‚å¯å‚è€ƒ<a href="https://www.cnblogs.com/mizzle/archive/2012/09/13/2683377.html">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h2>å…­ã€äº‹ä»¶å¤„ç†ç¨‹åº</h2>
<p>äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä¹Ÿå¸¸ç§°ä¸ºäº‹ä»¶ç›‘å¬å™¨æˆ–ç›‘å¬å™¨ã€‚å¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ç»™ DOM å…ƒç´ æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼š</p>
<ul>
<li>HTML äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆä¸æ¨èï¼‰</li>
<li>DOM0 äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆä¹Ÿä¸å¤ªæ¨èï¼‰</li>
<li>DOM2 äº‹ä»¶å¤„ç†ç¨‹åº</li>
<li>IE äº‹ä»¶å¤„ç†ç¨‹åº</li>
</ul>
<p>å‰ä¸¤ç§æ–¹å¼ä¸æ¨èï¼Œåä¸¤ç§å°±èƒ½è¦†ç›– 99.9% çš„æµè§ˆå™¨äº†ã€‚å¦‚æœä¸ç”¨å…¼å®¹ IEï¼Œé‚£ä¹ˆ DOM2 å°±æ›´é¦™äº†ï¼Œè‡³å°‘å¯ä»¥å‡å°‘ 70% çš„ä»£ç é‡...</p>
<h3>1. HTML äº‹ä»¶å¤„ç†ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</h3>
<p>è¿™æ˜¯æœ€æ—©çš„äº‹ä»¶å¤„ç†æ–¹å¼ï¼Œè¯´å®è¯åœ¨é¡¹ç›®ä¸­æ²¡è§è¿‡è¿™ç§å†™æ³•ã€‚ç®€å•äº†è§£ä¸‹å³å¯ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p>
<pre><code class="language-html">&lt;div&gt;
  Division
  &lt;p onclick=&quot;inner()&quot;&gt;Paragraph&lt;/p&gt;
  &lt;p onclick=&quot;inner(event)&quot;&gt;Paragraph&lt;/p&gt;
  &lt;p onclick=&quot;console.log('inner')&quot;&gt;Paragraph&lt;/p&gt;
&lt;/div&gt;

&lt;script&gt;
  function inner() {
    // äº‹ä»¶å¤„ç†ç¨‹åºä¸­ this æŒ‡å‘ window å¯¹è±¡
    console.log('inner')
  }
&lt;/script&gt;

&lt;!--
  âš ï¸ æ³¨æ„ç‚¹ï¼š
  1. å†…è”å¼äº‹ä»¶å¤„ç†ç¨‹åºï¼Œthis æ‰§è¡Œ window å¯¹è±¡ï¼›
  2. ä¸è¦ä½¿ç”¨å…¨å±€å†…ç½®çš„æ–¹æ³•ï¼Œä¾‹å¦‚ onclick=&quot;open()&quot;ï¼Œå®ƒä¼šè§¦å‘ window.open() è€Œä¸æ˜¯è‡ªå®šä¹‰çš„ open() æ–¹æ³•ï¼›
  3. æµè§ˆå™¨ä¸ä¼šç»™ä½ ä¼ å…¥äº‹ä»¶å¯¹è±¡ï¼Œåªèƒ½æ‰‹åŠ¨ä¼ å…¥ï¼šå¯ä»¥æ˜¯ window.event æˆ– eventï¼ˆæ¨èå‰è€…ï¼Œåè€…ä¹Ÿå¯ï¼Œå› ä¸ºå¤„äº window ç¯å¢ƒï¼‰
  4. HTML äº‹ä»¶å¤„ç†ç¨‹åºä¼šè¢« DOM0 äº‹ä»¶å¤„ç†ç¨‹åºè¦†ç›–ã€‚
  5. ä»¥ä¸Šç§ç§åŸå› ï¼Œä¸æ¨èä½¿ç”¨ã€‚äº‹å®ä¸Šä¹Ÿæ²¡è§è¿‡é¡¹ç›®è¿™ä¹ˆç”¨äº†ã€‚
--&gt;
</code></pre>
<h3>2. DOM0 äº‹ä»¶å¤„ç†ç¨‹åº</h3>
<p>ä½¿ç”¨æ–¹æ³•ç®€å•ï¼Œä¹Ÿå¾ˆå¸¸è§ã€‚å°±æ˜¯å°†ä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ª DOM å…ƒç´ çš„äº‹ä»¶å±æ€§ã€‚å…¶ä¸­å…ƒç´ çš„äº‹ä»¶å±æ€§é€šå¸¸æ˜¯ <code>on + type</code>ï¼ˆäº‹ä»¶ç±»å‹ï¼‰ï¼Œæ¯”å¦‚ <code>onclick</code>ã€<code>ondblclick</code>ã€<code>onfocus</code>ã€<code>onload</code> ç­‰ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">// æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
target.onclick = function (e) {
  // this å°†ä¼šæŒ‡å‘äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»‘å®šçš„å…ƒç´ 
  // do something...
}

// ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åº
target.onclick = null
</code></pre>
<blockquote>
<p>è¿™ç§æ–¹å¼åªèƒ½å¤Ÿæ³¨å†Œä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚è‹¥å¤šæ¬¡ç»‘å®šï¼Œåè€…ä¼šè¦†ç›–å‰è€…ã€‚</p>
</blockquote>
<h3>3. DOM2 äº‹ä»¶å¤„ç†ç¨‹åº</h3>
<p>åœ¨ DOM2 Event æ ‡å‡†ä¸­ï¼Œæ–°å¢äº† <code>addEventListener()</code> å’Œ <code>removeEventListener()</code> æ–¹æ³•æ¥æ³¨å†Œæˆ–ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åºã€‚å®ƒçš„ä¼˜åŠ¿æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥ä¸ºåŒä¸€å…ƒç´ åŒä¸€äº‹ä»¶æ³¨å†Œå¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚</li>
<li>äº‹ä»¶å¤„ç†ç¨‹åºå¯ä»¥åœ¨â€œæ•è·é˜¶æ®µâ€è¢«è§¦å‘ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰<strong>å”¯ä¸€</strong>å¯ä»¥åœ¨æ•è·é˜¶æ®µå‘½ä¸­äº‹ä»¶å¤„ç†ç¨‹åºçš„æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>è¯¥ç‰¹æ€§ä»…åœ¨ç°ä»£æµè§ˆå™¨ä¸­è¢«æ”¯æŒï¼ŒIE8 åŠä»¥ä¸‹ä¸æ”¯æŒã€‚</p>
</blockquote>
<p><strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="language-js">target.addEventListener(type, listener, useCapture)
target.removeEventListener(type, listener, useCapture)
</code></pre>
<ul>
<li><code>type</code>ï¼šè¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚æ¯”å¦‚ <code>click</code>ã€‚</li>
<li><code>listener</code>ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå³äº‹ä»¶å¤„ç†ç¨‹åºã€‚è¢«è§¦å‘æ—¶å°†ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</li>
<li><code>useCapture</code>ï¼šå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º <code>false</code>ã€‚è¯¥å‚æ•°å†³å®šäº† <code>listener</code> æ˜¯å¦åœ¨â€œæ•è·é˜¶æ®µâ€è¢«è§¦å‘ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function handler(e) {
  // this å°†ä¼šæŒ‡å‘äº‹ä»¶å¤„ç†ç¨‹åºæ‰€ç»‘å®šçš„å…ƒç´ 
  // do something...
}
// æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
target.addEventListener('click', handler, false)
// ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åº
target.removeEventListener('click', handler, false)


// âš ï¸ æ³¨æ„ç‚¹ï¼š
// 1. ä¿ç•™äº‹ä»¶å¤„ç†ç¨‹åºçš„å¼•ç”¨ï¼Œæ˜¯ç§»é™¤ç›‘å¬äº‹ä»¶çš„å”¯ä¸€æ–¹æ³•ã€‚
// 2. æ¢å¥è¯è¯´ï¼Œè‹¥ä½¿ç”¨åŒ¿åå‡½æ•°ä½œä¸ºäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°†æ— æ³•ç§»é™¤ç›‘å¬äº‹ä»¶ã€‚
// 3. è‹¥å¤šæ¬¡æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¯¹åº”åœ°éœ€è¦å¤šæ¬¡ç§»é™¤äº‹ä»¶ã€‚
// 4. addEventListener() æ˜¯ç›®å‰å”¯ä¸€ä¸€ä¸ªå¯åœ¨â€œæ•è·é˜¶æ®µâ€è§¦å‘äº‹ä»¶ç›‘å¬çš„æ–¹æ³•ã€‚
// 5. åœ¨æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºæ—¶ï¼Œå³ä½¿ listener å¼•ç”¨ç›¸åŒï¼Œè‹¥ useCapture å‚æ•°ä¸åŒï¼Œ
//    ä¹Ÿä¼šè¢«æ³¨å†Œå¤šä¸ªã€‚
// 6. å¤šæ¬¡é‡å¤ï¼ˆæŒ‡ä¸‰ä¸ªå‚æ•°éƒ½å®Œå…¨ç›¸ç­‰æ—¶ï¼‰æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»…ç¬¬ä¸€æ¬¡æœ‰æ•ˆã€‚
//    è¿™ç‚¹ä¸ DOM0 äº‹ä»¶å¤„ç†ç¨‹åºçš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚
// 7. é™¤äº† DOM å…ƒç´ ï¼Œå…¶ä»–å¯¹è±¡ä¹Ÿæœ‰è¿™ä¸ªæ¥å£ï¼Œæ¯”å¦‚ windowã€XMLHttpRequest ç­‰ã€‚
// 8. IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸æ”¯æŒï¼Œå¯¹åº”çš„è§£å†³æ–¹æ³•æ˜¯ attachEvent() å’Œ detachEvent() æ–¹æ³•ï¼Œ
//    è¿™æ˜¯ IE æµè§ˆå™¨ç‰¹æœ‰çš„ã€‚
</code></pre>
<h3>4. IE äº‹ä»¶å¤„ç†ç¨‹åº</h3>
<p>å°½ç®¡ IE8 åŠä»¥ä¸‹æµè§ˆå™¨ä¸æ”¯æŒ <code>addEventListener()</code> å’Œ <code>removeEventListener()</code> æ–¹æ³•ï¼Œä½†å®ƒæœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ–¹æ³•æ¥æ³¨å†Œæˆ–ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åºï¼Œé‚£å°±æ˜¯  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#compatibility"><code>attachEvent()</code></a> å’Œ <code>detachEvent()</code>ã€‚åŒºåˆ«æ˜¯ä¸æ”¯æŒåœ¨äº‹ä»¶æ•è·é˜¶æ®µè§¦å‘ï¼Œå› ä¸º IE8 äº‹ä»¶æµåªå«äº‹ä»¶å†’æ³¡ã€‚</p>
<p><strong>è¯­æ³•å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="language-js">// åªæ¥å—ä¸¤ä¸ªå‚æ•°
target.attachEvent(ontype, listener)
target.detachEvent(ontype, listener)
</code></pre>
<ul>
<li><code>ontype</code>ï¼šè¡¨ç¤ºäº‹ä»¶å±æ€§ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œå³ <code>on + type</code>ï¼Œæ¯”å¦‚ <code>onclick</code>ã€‚è¿™ç‚¹ä¸ <code>addEventListener()</code> ä¸­çš„ <code>type</code> å‚æ•°æ˜¯ä¸åŒçš„ã€‚</li>
<li><code>listener</code>ï¼šåŒæ ·æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºäº‹ä»¶å¤„ç†ç¨‹åºã€‚è¯·æ³¨æ„ <code>listener</code> å‡½æ•°å†…éƒ¨ <code>this</code> å°†æŒ‡å‘ <code>window</code> å¯¹è±¡ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function handler(e) {
  // this å°†ä¼šæŒ‡å‘ window å¯¹è±¡
  // è¦å¤„ç† this æŒ‡å‘é—®é¢˜å¾ˆç®€å•ï¼Œä¾‹å¦‚ Function.prototype.bind() ç­‰
  // do something...
}
// æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
target.attachEvent('onclick', handler)
// ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åº
target.detachEvent('onclick', handler)


// âš ï¸ æ³¨æ„ç‚¹ï¼š
// 1. æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ on + type çš„å½¢å¼ï¼Œè¿™ç‚¹ä¸ DOM2 æ˜¯ä¸åŒçš„ã€‚
// 2. è‹¥æ— ç‰¹æ®Šå¤„ç†ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå†… this æŒ‡å‘ window å¯¹è±¡ï¼Œè¿™ç‚¹ä¸ DOM0ã€DOM2 æ˜¯ä¸åŒçš„ã€‚
// 3. è‹¥ Function.prototype.bind() å»å¤„ç† this é—®é¢˜ï¼Œæ³¨æ„ä¿æŒäº‹ä»¶å¤„ç†ç¨‹åºå¼•ç”¨é—®é¢˜ã€‚
// 4. attachEvent() ä¸æ”¯æŒåœ¨æ•è·é˜¶æ®µè§¦å‘äº‹ä»¶å¤„ç†ç¨‹åºã€‚
</code></pre>
<h3>5. è·¨æµè§ˆå™¨äº‹ä»¶å¤„ç†ç¨‹åº</h3>
<p>è·¨æµè§ˆå™¨ï¼Œå°±æ˜¯è¯´è¦åŒæ—¶å…¼å®¹ IE æµè§ˆå™¨å’Œç°ä»£æµè§ˆå™¨ã€‚å…¶å®ä¸Šé¢å·²ç»å°†æ‰€æœ‰æ–¹å¼éƒ½ä»‹ç»äº†ä¸€éï¼Œå†™èµ·æ¥å°±å¾ˆç®€å•äº†ã€‚</p>
<pre><code class="language-js">// æ³¨å†Œ
function addHandler(el, type, fn) {
  if (el.addEventListener) {
    el.addEventListener(type, fn, false)
  } else if (el.attachEvent) {
    el.attachEvent('on' + type, fn)
  } else {
    el['on' + type] = listener
  }
}

// ç§»é™¤
function removeHandler(el, type, fn) {
  if (el.removeEventListener) {
    el.removeEventListener(type, fn, false)
  } else if (el.detachEvent) {
    el.detachEvent('on' + type, fn)
  } else {
    el['on' + type] = null
  }
}
</code></pre>
<h3>6. DOM3 è‡ªå®šä¹‰äº‹ä»¶ï¼ˆæ‰©å±•å†…å®¹ï¼‰</h3>
<p>å‰é¢ä»‹ç»çš„ï¼Œå…¨éƒ½æ˜¯æµè§ˆå™¨å†…ç½®äº‹ä»¶ï¼Œå½“ç”¨æˆ·ä¸æµè§ˆå™¨å‘ç”Ÿäº¤äº’æ—¶ï¼Œäº‹ä»¶ï¼ˆå¯¹è±¡ï¼‰å°±è¯ç”Ÿäº†ï¼Œå®ƒæ¥ç€ä¼šåœ¨ DOM ä¸­è¿›è¡Œä¼ æ’­ï¼Œå‘½ä¸­ç›®æ ‡åä¼šè§¦å‘ç›¸åº”çš„æ—¶é—´å¤„ç†å‡½æ•°ã€‚</p>
<p>åœ¨ DOM3 Event æ ‡å‡†ä¸Šï¼Œé™¤äº†åœ¨ DOM2 Event çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†å¾ˆå¤šäº‹ä»¶ç±»å‹ï¼Œè€Œä¸”å®ƒè¿˜å…è®¸è‡ªå®šä¹‰äº‹ä»¶ã€‚ä½†æ˜¯è‡ªå®šä¹‰äº‹ä»¶ï¼Œéœ€è¦â€œæ‰‹åŠ¨â€è§¦å‘ï¼Œå³ä¸»åŠ¨è°ƒç”¨ <code>dispatchEvent()</code> æ–¹æ³•æ‰å¯ä»¥ã€‚</p>
<p>è‡³äºç”¨å¤„å˜›ï¼Œå‡è®¾åŠ¨æ€åŠ è½½è„šæœ¬ï¼Œéœ€åœ¨åŠ è½½å®Œæˆåæ‰èƒ½åšä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚é…ç½®ä»€ä¹ˆçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç›‘å¬è„šæœ¬ä»€ä¹ˆæ—¶å€™åŠ è½½å®Œï¼Œè¿™æ—¶å€™è‡ªå®šä¹‰äº‹ä»¶å°±èƒ½å‘æŒ¥å…¶ä½œç”¨äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">// åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶
const customEvent = new CustomEvent('ready')

// åˆ›å»ºå…ƒç´ 
const el = document.createElement('script')
el.src = 'https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js'
el.onload = () =&gt; el.dispatchEvent(customEvent) // æ´¾å‘äº‹ä»¶
el.onerror = err =&gt; { /* è„šæœ¬åŠ è½½å¤±è´¥... */ }

// æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
el.addEventListener('ready', e =&gt; {
  // è„šæœ¬åŠ è½½å®Œæˆåï¼Œå¯ä»¥åšäº›é…ç½®ä»€ä¹ˆçš„...
})

// æ’å…¥ document
const s = document.getElementsByTagName('script')[0]
if (s &amp;&amp; s.parentNode) s.parentNode.insertBefore(el, s)
</code></pre>
<p>å…³äº <code>CustomEvent</code> çš„ä¸€äº›è¯­æ³•æ³¨æ„ç‚¹ï¼š</p>
<pre><code class="language-js">// 1. ä¸º watch äº‹ä»¶æ·»åŠ ç›‘å¬äº‹ä»¶å‡½æ•°
target.addEventListener('watch', function () { /* ... */ }, false)

// 2. åˆ›å»º watch äº‹ä»¶ï¼Œè‹¥æ— éœ€ä¼ å…¥æŒ‡å®šæ•°æ®ï¼Œå¯ç›´æ¥ä½¿ç”¨ new Event('watch')
var watchEvent = new CustomEvent('watch', 
    detail: { /* ... */ }, // å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œé€šå¸¸æ˜¯ä¸æœ¬äº‹ä»¶ç›¸å…³çš„ä¸€äº›ä¿¡æ¯
    bubbles: false, // æ˜¯å¦å†’æ³¡
    cancelable: false // æ˜¯å¦å–æ¶ˆé»˜è®¤è¡Œä¸º
)

// 3. æ‰‹åŠ¨è§¦å‘äº‹ä»¶
target.dispatchEvent(watchEvent)


// âš ï¸ æ³¨æ„ç‚¹ï¼š
// 1. å‰é¢ 1 å’Œ 2 çš„é¡ºåºå¯ä»¥è°ƒæ¢è¿‡æ¥ï¼Œæ²¡å…³ç³»çš„ã€‚
// 2. ä¸Šè¿°æˆ‘ä»¬ç»™äº‹ä»¶ç›®æ ‡ targetï¼ˆDOM å…ƒç´ ï¼‰æ³¨å†Œäº† watch äº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œ
//    æ˜¯æ— æ³•é€šè¿‡é¼ æ ‡ç‚¹å‡»æˆ–è§¦æ§ç­‰å½¢å¼å»è§¦å‘äº‹ä»¶ç›‘å¬å‡½æ•°çš„ï¼Œ
//    éœ€è¦ä¸»åŠ¨è§¦å‘ï¼Œå³è°ƒç”¨ dispatchEvent() æ–¹æ³•ã€‚
// 3. è¿˜æœ‰ CustomEvent æ˜¯æœ‰å…¼å®¹æ€§çš„ï¼ŒIE æ˜¯ä¸æ”¯æŒçš„ï¼Œ
// 4. è‡³äºå…¼å®¹æ€§å¦‚ä½•å¤„ç†ï¼Œæš‚æ—¶ä¸å±•å¼€è®²è¿°ã€‚åé¢æœ‰ç©ºå†å¦èµ·ä¸€æ–‡å§ã€‚
</code></pre>
<h3>7. å°ç»“</h3>
<ul>
<li>
<p>å¯èƒ½æœ‰äººä¼šå¥½å¥‡ä¸ºä»€ä¹ˆä¸ä»‹ç» DOM1ï¼ŒåŸå› æ˜¯ DOM1 æ²¡æœ‰å…³äºäº‹ä»¶çš„æ–°å¢æˆ–æ”¹åŠ¨ï¼Œå› è€Œæ²¡æåŠã€‚</p>
</li>
<li>
<p>è‹¥åŒæ—¶å­˜åœ¨ HTML äº‹ä»¶å¤„ç†ç¨‹åºå’Œ DOM0 å¤„ç†å‡½æ•°ï¼Œåè€…ä¼šè¦†ç›–æ‰å‰è€…ã€‚
DOM2 ä¸ä¼šè¦†ç›– HTML äº‹ä»¶å¤„ç†ç¨‹åºæˆ– DOM0 äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
</li>
<li>
<p>ä¸ºåŒä¸€äº‹ä»¶ç›®æ ‡æ³¨å†Œå¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºæ—¶ï¼Œæ‰§è¡Œæ¬¡åºä¸ºï¼š<strong>HTML äº‹ä»¶å¤„ç†ç¨‹åºæˆ– DOM0 &gt; DOM2 æˆ– IE äº‹ä»¶å¤„ç†ç¨‹åº</strong>ã€‚è·Ÿäº‹ä»¶æ³¨å†Œå…ˆåé¡ºåºæ— å…³ã€‚</p>
</li>
</ul>
<p>è‹¥æœ‰å…´è¶£æƒ³äº†è§£ DOM0 ~ DOM3 æ–°å¢äº†å“ªäº›å†…å®¹ï¼Œå¯çœ‹<a href="http://c.biancheng.net/view/5887.html">æ–‡ç« </a>ã€‚å¦å¤–é™„ä¸Š WHATWG çš„ DOM æ ‡å‡†ï¼š<a href="https://dom.spec.whatwg.org/">DOM Living Standard</a>ã€‚</p>
<h2>ä¸ƒã€æ€»ç»“ï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰</h2>
<p>å°±å‰é¢å…³äºäº‹ä»¶å¤„ç†ç¨‹åºæ‰€æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¿›ä¸€æ­¥å°è£…ä¸‹ã€‚</p>
<blockquote>
<p>ç”±äºè¦å…¼å®¹ IE8 çš„åŸå› ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ <code>class</code> ç±»çš„å†™æ³•ã€‚å› ä¸ºç»è¿‡ Babel å¤„ç†ï¼Œç±»ä¼¼ <code>Object.assgin()</code>ã€<code>Object.defindProperty()</code> ç­‰ ES5 æ–¹æ³•åœ¨ IE8 åŠæ›´ä½ç‰ˆæœ¬æµè§ˆå™¨å‹æ ¹ä¸æ”¯æŒã€‚</p>
</blockquote>
<p>å…ˆå†™ä¸ªæ„é€ å‡½æ•°å§ï¼š</p>
<pre><code class="language-js">function CreateMyEvent({ type, el, fn }) {
  this.el = el
  this.type = type
  this.fn = fn
  this.listener = function (e) {
    // IE8 DOM0 éœ€è¦ä» window.event è·å–äº‹ä»¶å¯¹è±¡
    const ev = e || window.event

    // ä¸º IE8 çš„äº‹ä»¶å¯¹è±¡æ·»åŠ ä»¥ä¸‹å±æ€§å’Œæ–¹æ³•ï¼š
    // targetã€currentTargetã€stopPropagation()ã€preventDefault()
    if (!ev.stopPropagation) {
      ev.target = ev.srcElement
      ev.currentTarget = el
      ev.stopPropagation = () =&gt; {
        ev.cancelBubble = true
      }
      ev.preventDefault = () =&gt; {
        ev.returnValue = false
      }
    }

    // ç»Ÿä¸€ this æŒ‡å‘
    fn.call(el, ev)
  }
}

CreateMyEvent.prototype.addEventListener = function () {
  const { type, el, listener } = this
  if (el.addEventListener) {
    // ä¸ºäº†å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œè¿™é‡Œå°† useCapture è®¾ä¸º false
    el.addEventListener(type, listener, false)
  } else if (el.attachEvent) {
    el.attachEvent('on' + type, listener)
  } else {
    el['on' + type] = listener
  }
}

CreateMyEvent.prototype.removeEventListener = function () {
  const { type, el, listener } = this
  if (el.removeEventListener) {
    el.removeEventListener(type, listener, false)
  } else if (el.detachEvent) {
    el.detachEvent('on' + type, listener)
  } else {
    el['on' + type] = null
  }
}
</code></pre>
<p>ä¸€äº›æ³¨æ„ç‚¹åœ¨æ³¨é‡Šæœ‰æ ‡æ³¨ä½“ç°ï¼Œç„¶åè¿›è¡Œå®ä¾‹åŒ–å¹¶è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// åˆ›å»ºå®ä¾‹å¯¹è±¡
const myEvent = new CreateMyEvent({
  el: document.getElementById('directory'),
  type: 'click',
  fn: e =&gt; {
    // è§£å†³ä»¥ä¸‹ç—›ç‚¹ï¼š
    // 1. this æ€»æŒ‡å‘ç›‘å¬äº‹ä»¶å‡½æ•°æ‰€ç»‘å®šèŠ‚ç‚¹
    // 2. e æ€»ä¼šå¾—åˆ°äº‹ä»¶å¯¹è±¡
    // 3. IE8 ä¹Ÿå¯ä»¥è½»æ¾ä½¿ç”¨ targetã€currentTargetã€stopPropagation()ã€preventDefault()
    // do something...
  }
})

// æ³¨å†Œ/ç§»é™¤ç›‘å¬å™¨
myEvent.addEventListener()
setTimeout(() =&gt; {
  myEvent.removeEventListener()
}, 5000)
</code></pre>
<blockquote>
<p>ä»¥ä¸Šç¤ºä¾‹éƒ¨åˆ†ä½¿ç”¨äº† ES6 çš„è¯­æ³•ï¼Œéƒ½ 2021 å¹´äº†ï¼Œå¦‚éœ€å…¼å®¹ ES5 è¯·æ”¾å¿ƒäº¤ç»™ Babel å§ã€‚ï¼ˆäº²æµ‹ IE8 ä¸‹å¯æ­£å¸¸è¿è¡Œï¼‰</p>
</blockquote>
<h2>å…«ã€äº‹ä»¶å§”æ‰˜</h2>
<p>é™¤äº†é¢è¯•ä¸­å¸¸è¢«é—®åŠï¼Œå®é™…åº”ç”¨åœºæ™¯é‡Œä¹Ÿæ˜¯ä¼˜åŒ–æ€§èƒ½çš„ä¸€ç§æ‰‹æ®µã€‚</p>
<p>å‰é¢æåˆ°ï¼Œäº‹ä»¶æµçš„ä¼ æ’­è·¯å¾„ï¼š<strong>æ•è·é˜¶æ®µ -&gt; ç›®æ ‡é˜¶æ®µ -&gt; å†’æ³¡é˜¶æ®µ</strong>ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒäº‹ä»¶å†’æ³¡ï¼Œä½†äº‹ä»¶æ•è·å¹¶ä¸æ˜¯éƒ½æ”¯æŒçš„ï¼Œä¾‹å¦‚ IE8ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šæ•°æƒ…å†µä¸‹åˆ©ç”¨äº‹ä»¶å†’æ³¡è¡Œä¸ºå®ç°â€œäº‹ä»¶å§”æ‰˜â€ï¼ˆæˆ–ç§°ä¸ºäº‹ä»¶ä»£ç†ï¼‰ã€‚<strong>ä½†å…¶å®ï¼Œæ•è·é˜¶æ®µä¹Ÿæ˜¯å¯ä»¥å®ç°äº‹ä»¶å§”æ‰˜çš„</strong>ã€‚å¯èƒ½ä¸ºäº†å…¼å®¹ï¼Œé€‰æ‹©å‰è€…å±…å¤šã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦äº‹ä»¶å§”æ‰˜ï¼Ÿ</p>
<p>æƒ³è±¡ä¸€ä¸ªç”Ÿæ´»åœºæ™¯ï¼šä¸€æœ¬ä¹¦çš„ç›®å½•åŒ…å«å¤§ç« èŠ‚ã€å°ç« èŠ‚ï¼Œæ¯ä¸ªå°ç« èŠ‚éƒ½ä¼šå¯¹åº”ä¸€ä¸ªé¡µç ï¼Œç„¶åæ ¹æ®é¡µç å°±å¯ä»¥ç¿»åˆ°å¯¹åº”çš„å†…å®¹ã€‚</p>
<p>å¦‚æœç”¨ç¨‹åºå®ç°çš„è¯ï¼Œâ€œæœ€ç¬¨â€çš„åšæ³•æ˜¯ï¼šç»™æ¯ä¸ªå°ç« èŠ‚æ³¨å†Œä¸€ä¸ªç‚¹å‡»ç›‘å¬å™¨å¹¶å®ç°è·³è½¬ã€‚ä¼¼ä¹ä¹Ÿæ²¡å¤ªå¤§é—®é¢˜ï¼Œæ˜¯å—ï¼Ÿå¦‚æœè¿™æœ¬ä¹¦æœ‰ 1000 ä¸ªå°ç« èŠ‚ï¼Œæ„å‘³ç€è¦æ³¨å†Œ 1000 ä¸ªäº‹ä»¶ç›‘å¬å‡½æ•°ã€‚å…ˆä¸è¯´æ€§èƒ½é—®é¢˜ï¼Œå†™ä»£ç çš„æ˜¯ä¸æ˜¯å¾—ç–¯æ‰ã€‚å‡è®¾è¿˜æ²¡ç–¯ï¼Œå“ªå¤©äº§å“ç»ç†åˆæ–°å¢ 500 ç« èŠ‚ï¼Œæ˜¯ä¸æ˜¯åˆå¾—æ”¹ï¼Œæ€»æœ‰ä¸€å¤©ä¼šé€¼ç–¯ä½ çš„ï¼</p>
<p>å¦‚æœç”¨â€œäº‹ä»¶å§”æ‰˜â€æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘æŠŠç›‘å¬å™¨æ³¨å†Œåˆ°ç›®å½•ä¸Šã€‚å½“ç‚¹å‡»æŸç« èŠ‚æ—¶ï¼Œåˆ©ç”¨ç‚¹å‡»äº‹ä»¶çš„å†’æ³¡è¡Œä¸ºï¼Œäº‹ä»¶ä¼šè¢«ä¼ é€’åˆ°ç›®å½•å¹¶å‘½ä¸­æ¥è§¦å‘ç›‘å¬å™¨ã€‚è€Œä¸”ï¼Œè¿™æ˜¯ä¸€åŠ³æ°¸é€¸çš„äº‹æƒ…ï¼Œæ— è®ºäº§å“ç»ç†å¦‚ä½•å¢åˆ ç« èŠ‚ï¼Œéƒ½æ— éœ€å†æ”¹åŠ¨äº†ã€‚è¿™ä¸å°±æœ‰æ—¶é—´æ‘¸é±¼äº†å¯¹å§ã€‚</p>
<blockquote>
<p>åœ¨ JavaScript ä¸­ï¼Œé¡µé¢ä¸­äº‹ä»¶å¤„ç†ç¨‹åºçš„æ•°é‡ä¸é¡µé¢æ•´ä½“æ€§èƒ½ç›´æ¥ç›¸å…³ã€‚åŸå› æœ‰å¾ˆå¤šã€‚é¦–å…ˆæ¯ä¸ªå‡½æ•°éƒ½æ˜¯å¯¹è±¡ï¼Œéƒ½å ç”¨å†…å­˜ç©ºé—´ï¼Œå¯¹è±¡è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚å…¶æ¬¡ï¼Œä¸ºæŒ‡å®šäº‹ä»¶å¤„ç†ç¨‹åºæ‰€éœ€è®¿é—® DOM çš„æ¬¡æ•°ä¼šå…ˆæœŸé€ æˆæ•´ä¸ªé¡µé¢äº¤äº’çš„å»¶è¿Ÿã€‚åªè¦åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæ—¶å¤šæ³¨æ„ä¸€äº›æ–¹æ³•ï¼Œå°±å¯ä»¥æ”¹å–„é¡µé¢æ€§èƒ½ã€‚(è¿™æ®µè¯æ‘˜è‡ªã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹)</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-html">&lt;!-- é€šå¸¸å°†ä¸æ¸²æŸ“æ— å…³çš„ä¿¡æ¯æ”¾åˆ° dataset é‡Œé¢ï¼Œå³ data-* çš„å½¢å¼  --&gt;
&lt;div id=&quot;directory&quot;&gt;
  Directory
  &lt;ol&gt;
    &lt;div class=&quot;chapter&quot;&gt;Chapter1&lt;/div&gt;
    &lt;li data-page=&quot;10&quot;&gt;section1&lt;/li&gt;
    &lt;li data-page=&quot;20&quot;&gt;section2&lt;/li&gt;
  &lt;/ol&gt;
  &lt;ol&gt;
    &lt;div class=&quot;chapter&quot;&gt;Chapter2&lt;/div&gt;
    &lt;li data-page=&quot;30&quot;&gt;section1&lt;/li&gt;
    &lt;li data-page=&quot;40&quot;&gt;section2&lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæœ‰å¤šç»„ <code>&lt;ol&gt;</code>ã€<code>&lt;li&gt;</code> çš„ç›®å½•ï¼Œæƒ³è¦ç‚¹å‡» <code>&lt;li&gt;</code>ï¼ˆå³ <code>section</code> éƒ¨åˆ†ï¼‰çš„æ—¶å€™ï¼Œæ‰“å¼€ä¹¦æœ¬å¯¹åº”é¡µé¢ã€‚</p>
<p>æ ¹æ®ä¸Šè¿°ç»™å‡ºçš„ HTML ç¤ºä¾‹ï¼Œäº‹ä»¶å§”æ‰˜æœ€ç²—ç³™ã€æœ€ä¸çµæ´»ã€æœ€ç®€å•çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function delegate() {
  const el = document.getElementById('directory')
  el.addEventListener('click', e =&gt; {
    const { page } = e.target.dataset
    if (page === undefined) return
    // do something...
    // å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ï¼š
    console.log(`Please turn to page ${page} of the book.`)
  })
}
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œåªè¦ç‚¹å‡» <code>&lt;div id=&quot;directory&quot;&gt;</code> åŠå…¶åä»£å…ƒç´ éƒ½ä¼šå‘½ä¸­äº‹ä»¶å¤„ç†ç¨‹åºï¼ŒæŒ‰éœ€æ±‚æ˜¯ç‚¹å‡» <code>&lt;li&gt;</code> æ‰è¦æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚åƒç‚¹å‡» <code>&lt;div class=&quot;chapter&quot;&gt;</code> å…¶å®æ˜¯æ²¡æœ‰å®é™…æ„ä¹‰çš„ã€‚è€Œä¸”æ˜æ˜¾ä¸Šé¢çš„æ–¹æ³•å¹¶ä¸çµæ´»ã€‚</p>
<p>æˆ‘ä»¬å†æ”¹ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * äº‹ä»¶å§”æ‰˜
 *
 * @param {Element} el äº‹ä»¶å§”æ‰˜çš„ç›®æ ‡å…ƒç´ 
 * @param {string} type äº‹ä»¶ç±»å‹
 * @param {Function} fn ç›‘å¬å™¨
 * @param {string} selectors CSS é€‰æ‹©å™¨
 */
function delegate({ el, type, fn, selectors }) {
  el.addEventListener(type, e =&gt; {
    if (!selectors) {
      fn.call(el, e)
      return // è¯·æ³¨æ„ä¸è¦ return false é¿å…å–æ¶ˆé»˜è®¤è¡Œä¸º
    }

    // myClosest() ä½œç”¨ï¼šå‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ selectors å…ƒç´ ã€‚
    // 1. å†…ç½® closest() æ–¹æ³•å…¼å®¹æ€§è¾ƒå·®ï¼Œä¸æ”¯æŒ IE æµè§ˆå™¨ï¼›
    // 2. å†…ç½® closest() æ–¹æ³•å†…éƒ¨ä» Document å¼€å§‹æ£€ç´¢çš„ï¼Œè‹¥ç»“åˆäº‹ä»¶å§”æ‰˜åœºæ™¯ï¼Œ
    //    å¦‚æœä»äº‹ä»¶ç»‘å®šå…ƒç´ ï¼ˆå«ï¼‰å¼€å§‹æ£€ç´¢ï¼Œæ•ˆæœæ›´ä¼˜ã€‚
    // 3. å› è€Œï¼ŒåŸºäº Element.closest() ç¨ä½œä¿®æ”¹ï¼Œå¹¶æ·»åŠ åˆ° Element åŸå‹ä¸Šã€‚
    if (!Element.prototype.myClosest) {
      ;(() =&gt; {
        Element.prototype.myClosest = function (s, root) {
          let el = this
          let i
          // å…¶å®æ”¹æˆ root.querySelectorAll(s) ä¹Ÿè¡Œï¼Œ
          // ç›®å‰è¿™ç§å†™æ³•æ˜¯ä¸ºäº†è®© root === el ä¹Ÿæ­£å¸¸åŒ¹é…åˆ°ï¼Œ
          // ä½†æ˜¯å›å¤´æƒ³ä¸€ä¸‹ï¼Œè¿™ç§æƒ…å†µè¿˜æœ‰å¿…è¦äº‹ä»¶å§”æ‰˜å—ï¼Œå¯¹å§ï¼è‡ªä¸ªçœ‹ç€åŠå§ï¼Œé—®é¢˜ä¹Ÿä¸å¤§
          const matches = root.parentElement.querySelectorAll(s)

          do {
            i = matches.length
            // eslint-disable-next-line no-empty
            while (--i &gt;= 0 &amp;&amp; matches.item(i) !== el) {}
          } while (i &lt; 0 &amp;&amp; (el = el.parentElement))

          return el
        }
      })()
    }

    // è‹¥åŒ¹é…ä¸åˆ° selectors åˆ™è¿”å› null
    const matchEl = e.target.myClosest(selectors, el)

    matchEl &amp;&amp; fn.call(matchEl, e)
    // å¦‚æœåƒè¿™æ ·ç»‘å®š thisï¼Œè¯·æ³¨æ„ï¼š
    // 1. fn çš„ this æŒ‡å‘ selectors å¯¹åº”çš„å…ƒç´ 
    // 2. e.target ä»æŒ‡å‘äº‹ä»¶ç›®æ ‡
    // 3. e.currentTarget ä»æŒ‡å‘ç›‘å¬å™¨ç»‘å®šå…ƒç´ ã€‚
    // 4. ç”±äºäº‹ä»¶å¯¹è±¡çš„ targetã€currentTarget å±æ€§åªè¯»ï¼Œå”¯æœ‰æ”¹å˜ this æ¥æŒ‡å‘å¼•ç”¨ selectors å…ƒç´ 
  })
}
</code></pre>
<p>æŒ‰ä¸Šè¿°æ–¹å¼å°è£…çš„å¥½å¤„æ˜¯æ–¹ä¾¿çµæ´»ï¼Œä¸€äº›å®ç°æ€è·¯æˆ–æ³¨æ„äº‹é¡¹ï¼Œåœ¨ç›¸åº”ä½ç½®çš„æ³¨é‡Šå·²æ ‡æ³¨ã€‚</p>
<pre><code class="language-js">delegate({
  el: document.getElementById('directory'),
  type: 'click',
  selectors: 'li',
  fn: e =&gt; {
    const { page } = e.target.dataset
    console.log(`Please turn to page ${page} of the book.`)
    // other statements...
  }
})
</code></pre>
<p>æ€è·¯å°±è¿™æ ·ï¼Œå…¶å®å¾ˆç®€å•ï¼Œéº»çƒ¦åœ¨äºå…¼å®¹å„æµè§ˆå™¨è€Œå·²ã€‚è‹¥ä¸éœ€è¦å…¼å®¹ IE æµè§ˆå™¨ï¼Œé‚£ç®€ç›´ä¸èƒ½å¤ªçˆ½äº†ï¼Œåé¢ä¼šç»™å‡ºä¸€ä¸ªç®€åŒ–ç‰ˆã€‚</p>
<blockquote>
<p>å½“ç„¶ä¸Šé¢è¿˜ä¸æ”¯æŒ IE8 æµè§ˆå™¨ã€‚å› ä¸º <code>e.target</code>ã€<code>el.addEventListener</code> è¿˜æ²¡å…¼å®¹å¤„ç†ã€‚è¯·ç¨ç­‰ï¼Œä¸‹ä¸€ç« èŠ‚ç»“åˆå‰é¢çš„å†…å®¹å†æ•´åˆä¸€ä¸‹ã€‚</p>
</blockquote>
<h2>ä¹ã€æœ€ç»ˆæ€»ç»“</h2>
<p>è¿™é‡Œä¼šå°†æœ¬æ–‡æ‰€æœ‰çš„å†…å®¹éƒ½å°è£…åœ¨ä¸€èµ·ï¼ŒåŒ…æ‹¬ <code>addEventListener()</code>ã€<code>attachEvent()</code>ã€äº‹ä»¶å§”æ‰˜ä»¥åŠå…¼å®¹é—®é¢˜ç­‰ç­‰ã€‚</p>
<h3>1. å…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ IE8ï¼‰</h3>
<p>å…ˆç»™ä¸€ä¸ª<strong>å¯å…¼å®¹ IE8 çš„ç‰ˆæœ¬</strong>ã€‚å¯ä»¥è½»æ¾åœ°æŒ‰ç°ä»£æµè§ˆå™¨çš„æ–¹å¼å»æ³¨å†Œã€ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œä»¥åŠæ–¹ä¾¿å¤„ç†å†’æ³¡ã€é»˜è®¤è¡Œä¸ºç­‰ã€‚</p>
<blockquote>
<p>ä½†å‰ææ˜¯ï¼Œä½¿ç”¨ Babel è½¬æ¢ä¸€ä¸‹ä»¥å…¼å®¹ ES5ã€‚</p>
</blockquote>
<pre><code class="language-js">function CreateMyEvent({ el, type, fn }) {
  this.el = el
  this.type = type
  this.fn = fn
  this.listener = function (e) {
    // ä½¿å¾— IE8 ä¸­ï¼Œæ­£å¸¸ç”¨ä¸Š targetã€stopPropagation() ç­‰å±æ€§æˆ–æ–¹æ³•
    const ev = CreateMyEvent.eventPolyfill(e, el)
    // ç»Ÿä¸€ this æŒ‡å‘
    fn.call(el, ev)
  }
  this.added = false // æ˜¯å¦å·²æ·»åŠ ç›‘å¬å™¨
}

CreateMyEvent.eventPolyfill = function (e, currentTarget) {
  // å¤„ç† IE8 å…¼å®¹æ€§é—®é¢˜
  const ev = e || window.event
  if (!ev.stopPropagation) {
    ev.target = ev.srcElement
    ev.currentTarget = currentTarget
    ev.stopPropagation = () =&gt; {
      ev.cancelBubble = true
    }
    ev.preventDefault = () =&gt; {
      ev.returnValue = false
    }
  }
  return ev
}

CreateMyEvent.closestPolyfill = function () {
  Element.prototype.myClosest = function (s, root) {
    let el = this
    let i
    const matches = root.parentElement.querySelectorAll(s)

    do {
      i = matches.length
      // eslint-disable-next-line no-empty
      while (--i &gt;= 0 &amp;&amp; matches.item(i) !== el) {}
    } while (i &lt; 0 &amp;&amp; (el = el.parentElement))

    return el
  }
}

CreateMyEvent.prototype.addEventListener = function () {
  if (this.added) {
    console.warn('Please note that you have added event handler before and will not be added again.')
    return
  }

  const { type, el, listener } = this
  if (el.addEventListener) {
    // ä¸ºäº†å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œè¿™é‡Œå°† useCapture è®¾ä¸º false
    el.addEventListener(type, listener, false)
  } else if (el.attachEvent) {
    el.attachEvent('on' + type, listener)
  } else {
    el['on' + type] = listener
  }

  this.added = true
}

CreateMyEvent.prototype.removeEventListener = function () {
  const { type, el, listener } = this
  if (el.removeEventListener) {
    el.removeEventListener(type, listener, false)
  } else if (el.detachEvent) {
    el.detachEvent('on' + type, listener)
  } else {
    el['on' + type] = null
  }

  this.added = false
}

CreateMyEvent.prototype.delegate = function (selectors) {
  const { el, fn } = this

  if (!selectors) {
    this.addEventListener()
    return
  }

  // åœ¨é‡å†™ listener ç›‘å¬å™¨ä¹‹å‰ï¼Œç¡®ä¿ç§»é™¤æ­¤å‰çš„ç›‘å¬å™¨
  if (this.added) console.warn('Please note that the previously registered event handler will be deleted and a new event handler will be added.')
  this.removeEventListener()

  // é‡å†™ç›‘å¬å™¨
  this.listener = function (e) {
    const ev = CreateMyEvent.eventPolyfill(e)
    // åœ¨ Element åŸå‹ä¸Šæ·»åŠ  myClosest æ–¹æ³•
    if (!Element.prototype.myClosest) CreateMyEvent.closestPolyfill()
    const matchEl = ev.target.myClosest(selectors, el)
    matchEl &amp;&amp; fn.call(matchEl, ev)
  }

  // é‡æ–°æ³¨å†Œç›‘å¬å™¨
  this.addEventListener()
}

</code></pre>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// åˆ›å»ºå®ä¾‹å¯¹è±¡
const myEvent = new CreateMyEvent({
  type: 'click',
  el: document.getElementById('directory'),
  fn: e =&gt; {
    // 1. e æ€»æ˜¯èƒ½è·å–åˆ°äº‹ä»¶å¯¹è±¡ã€‚
    // 2. é˜»æ­¢å†’æ³¡ï¼še.stopPropagation()
    // 3. å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼še.preventDefault()
    // 4. å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼š
    //    å½“ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ—¶ï¼Œthis æŒ‡å‘ selectors å¯¹åº”å…ƒç´ ï¼›
    //    å…¶ä»–çš„å‡æŒ‡å‘äº‹ä»¶ç›‘å¬å™¨æ‰€ç»‘å®šçš„å…ƒç´ ï¼Œå³ e.currentTargetã€‚
  }
})

// æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
myEvent.addEventListener() // æœ‰æ•ˆ

// é‡å¤æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œä¼šè¢«é˜»æ­¢ï¼ˆå®é™…ä¸Šæ³¨å†ŒåŒä¸€ä¸ªä¹Ÿæ˜¯æ— æ•ˆçš„ï¼‰ã€‚
myEvent.addEventListener() // æ— æ•ˆ

// ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
myEvent.removeEventListener() // æœ‰æ•ˆ

// ç§»é™¤åï¼Œé‡æ–°æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
myEvent.addEventListener() // æœ‰æ•ˆ

// äº‹ä»¶å§”æ‰˜ï¼Œå¯ä¼ å…¥ selectors ä½œä¸ºå‚æ•°ï¼ˆå®è´¨ä¸Šä¹Ÿå°±æ˜¯æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºï¼‰
// ä¸ä¼ å…¥ selectors å‚æ•°æ—¶ï¼Œç›¸å½“äº myEvent.addEventListener() æ‰€ä»¥æ— æ•ˆ
myEvent.delegate() // æ— æ•ˆ

// äº‹ä»¶å§”æ‰˜ï¼šå†…éƒ¨ä¼šå…ˆç§»é™¤ä¸Šä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œåœ¨é‡æ–°æ³¨å†Œ
myEvent.delegate('li') // æœ‰æ•ˆ

// äº‹ä»¶å§”æ‰˜ï¼Œè¿™å°†ä¼šæ³¨å†Œå…¨æ–°çš„ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼ˆåŒæ ·çš„ä¸Šä¸€ä¸ªä¼šè¢«ç§»é™¤ï¼‰
myEvent.delegate('li') // æœ‰æ•ˆ
</code></pre>
<p>å“ï¼Œä¸‘é™‹çš„ä»£ç ......ç”±äº IE8 ä¸æ”¯æŒç±»ä¼¼ <code>Object.assgin()</code>ã€<code>Object.defindProperty()</code> ç­‰ ES5 æ–¹æ³•ï¼Œä¸Šé¢åªèƒ½ä½¿ç”¨æœ€åŸå§‹çš„æ„é€ å‡½æ•°å»å†™äº†ã€‚</p>
<blockquote>
<p>âš ï¸ æš‚ä¸æ”¯æŒæ·»åŠ å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå®é™…ä¸­æˆ‘æš‚æ—¶æƒ³ä¸åˆ°éœ€è¦æ·»åŠ å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨çš„åœºæ™¯ã€‚å®ç°å€’æ˜¯ä¸éš¾ï¼Œå¤„ç†èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½†æˆ‘æ„Ÿè§‰æ²¡å¿…è¦ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œå‰é¢ç¤ºä¾‹æ˜¯å°†é¡µé¢æ•°æ®å®šä¹‰åœ¨ <code>data-*</code> ä¸Šçš„ï¼Œä½†ç”±äº IE10 åŠæ›´ä½ç‰ˆæœ¬æµè§ˆå™¨å¹¶ä¸æ”¯æŒ <code>Element.prototype.dataset</code> å±æ€§ï¼Œå› æ­¤ä¹Ÿè¦å¤„ç†ä¸€ä¸‹ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">// ä¹Ÿè¦ç”¨ Babel è½¬æ¢ä¸€ä¸‹
function getDataset(el) {
  if (el.dataset) return el.dataset

  const attrs = el.attributes
  const dataset = {}

  for (let i = 0, re1 = /^data-(.+)/, re2 = /-([a-z\d])/gi, len = attrs.length; i &lt; len; i++) {
    // data-camel-case to camel-case
    const matchName = re1.exec(attrs[i].name)
    if (!matchName) continue
    // camel-case to camelCase
    const name = matchName[1].replace(re2, (...args) =&gt; {
      return args[1].toUpperCase()
    })
    // add to dataset
    dataset[name] = attrs[i].value
  }

  return dataset
}
</code></pre>
<p>ä¸éœ€è¦å…¼å®¹ IE8 çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼Œå°†ä¼šä½¿ç”¨ <code>class</code> å†™æ³•ï¼Œä¼šç®€æ´å¾ˆå¤šã€‚è¾£é¸¡ IE...</p>
<h3>2. å…¼å®¹ç°ä»£æµè§ˆå™¨ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ IE9 ~ IE11ï¼‰</h3>
<pre><code class="language-js">class CreateMyEvent {
  constructor({ el, type, fn }) {
    this.el = el
    this.type = type
    this.fn = fn
    this.listener = fn.bind(el)
    this.added = false // æ˜¯å¦å·²æ·»åŠ ç›‘å¬å™¨
  }

  static closestPolyfill() {
    Element.prototype.myClosest = function (s, root) {
      let el = this
      let i
      const matches = root.parentElement.querySelectorAll(s)

      do {
        i = matches.length
        // eslint-disable-next-line no-empty
        while (--i &gt;= 0 &amp;&amp; matches.item(i) !== el) {}
      } while (i &lt; 0 &amp;&amp; (el = el.parentElement))

      return el
    }
  }

  addEventListener() {
    if (this.added) {
      console.warn('Please note that you have added event handler before and will not be added again.')
      return
    }
    const { type, el, listener } = this
    el.addEventListener(type, listener, false)
    this.added = true
  }

  removeEventListener() {
    const { type, el, listener } = this
    el.removeEventListener(type, listener, false)
    this.added = false
  }

  delegate(selectors) {
    const { el, fn } = this

    if (!selectors) {
      this.addEventListener()
      return
    }

    // åœ¨é‡å†™ listener ç›‘å¬å™¨ä¹‹å‰ï¼Œç¡®ä¿ç§»é™¤æ­¤å‰çš„ç›‘å¬å™¨
    if (this.added) console.warn('Please note that the previously registered event handler will be deleted and a new event handler will be added.')
    this.removeEventListener()

    // é‡å†™ç›‘å¬å™¨
    this.listener = function (e) {
      // åœ¨ Element åŸå‹ä¸Šæ·»åŠ  myClosest æ–¹æ³•
      if (!Element.prototype.myClosest) CreateMyEvent.closestPolyfill()
      const matchEl = e.target.myClosest(selectors, el)
      matchEl &amp;&amp; fn.call(matchEl, e)
    }

    // é‡æ–°æ³¨å†Œç›‘å¬å™¨
    this.addEventListener()
  }
}
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œå¥½åƒå°±å®Œäº†ï¼Œæ”¹äº†å¥½å‡ ç‰ˆï¼Œæƒ³åè¡€...</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | æ‰§è¡Œä¸Šä¸‹æ–‡ã€ä½œç”¨åŸŸ]]></title>
            <link>https://github.com/toFrankie/blog/issues/263</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/263</guid>
            <pubDate>Sun, 26 Feb 2023 12:17:32 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0051bdd2297fb470.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0051bdd2297fb470.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯æ·±å…¥ JavaScript æ‰§è¡Œè¿‡ç¨‹ï¼Œè¦†ç›–äº†æ‰§è¡Œä¸Šä¸‹æ–‡ã€å˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€Thisã€é—­åŒ…ç­‰å†…å®¹ã€‚</p>
<p>ä½†æ–‡ä¸­å¯èƒ½å‚æ‚äº†å¾ˆå¤šå…¶ä»–å†…å®¹ï¼Œçœ‹èµ·æ¥æ²¡æœ‰é‚£ä¹ˆåœ°æ¸…æ™°ã€‚å†…å®¹ä¸»è¦æ•´åˆäº†ï¼šã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬å››ç‰ˆï¼‰ã€‹ã€å†´ç¾½å¤§ä½¬çš„ JavaScript ä¸“é¢˜ç³»åˆ—ã€Veda ä¸“é¢˜ã€ä»¥åŠæœ¬äººæ­¤å‰å†™è¿‡çš„ä¸€äº›æ–‡ç« ã€‚</p>
<p>å…¶å®æˆ‘å»ºè®®ä½ ä»¬ä»¥ä¸‹ä¸“é¢˜ä¼šæ›´å¥½ï¼š</p>
<blockquote>
<ul>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/17">JavaScript æ·±å…¥ç³»åˆ— 15 ç¯‡ï¼ˆå†´ç¾½ï¼‰</a></li>
<li><a href="http://www.nowamagic.net/librarys/veda/detail/1579">JavaScript ä¸“é¢˜ï¼ˆVedaï¼‰</a></li>
</ul>
</blockquote>
<h2>ä¸€ã€JavaScript</h2>
<blockquote>
<p>å…ˆè®²ä¸€äº›ä¸æ˜¯å¾ˆé‡è¦çš„â€œåºŸè¯â€ï¼Œå¯ç›´æ¥è·³åˆ°ç¬¬äºŒèŠ‚ã€‚</p>
</blockquote>
<p>å°±ä¸ªäººè€Œè¨€ï¼Œè‡ªä»å–œæ¬¢ä¸Šå†™æ–‡ç« ä¹‹åï¼Œæˆ‘ç»å¸¸ä¼šåœ¨ä¸€äº›æ¦‚å¿µæ€§ä¸Šçš„ä¸œè¥¿çº ç»“ï¼Œæœ¬ç€è®¤çœŸè´Ÿè´£ä»»çš„æ€åº¦ï¼Œç†åº”å¦‚æ­¤ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒJavaScript æ˜¯ä»€ä¹ˆç±»å‹çš„è¯­è¨€ï¼Ÿ</p>
<ul>
<li>JavaScript æ˜¯è§£æå‹è¯­è¨€ï¼Ÿ</li>
<li>è¿˜æ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Ÿ</li>
</ul>
<p><strong>è¯´å®è¯ï¼Œè™½ç„¶ä½œä¸ºä¸€ä¸ª JSerï¼Œæˆ‘è‡³ä»Šä¹Ÿæ²¡å¼„æ˜ç™½ JavaScript æ˜¯ä»€ä¹ˆè¯­è¨€</strong>ã€‚æˆ‘ä¸çŸ¥é“ä½ ä»¬ä¼šä¸ä¼šæœ‰è¿™äº›çº ç»“ç‚¹ï¼Œåæ­£æˆ‘ä¼šï¼Œæˆ‘æƒ³è¦ä¸€ä¸ªå®˜æ–¹ä¸”æƒå¨çš„è§£é‡Šï¼Œå¹¶å°†å®ƒä½œä¸ºæˆ‘æ­¤åçš„è§‚ç‚¹ã€‚å‡è®¾å°†æ¥æŸä¸€å¤©æœ‰äººé—®æˆ‘ï¼šJavaScript æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘å¯ä»¥åªå­—ä¸å·®åœ°è·Ÿä»–è¯´é“ã€‚</p>
<p><strong>JavaScript ä¸ ECMAScript çš„å†å²å…³ç³»</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒJavaScript è¯­è¨€çš„åˆ›é€ è€…æ˜¯ Brendan Eichï¼Œä¹Ÿè¢«ç§°ä¸º JavaScript ä¹‹çˆ¶ã€‚1995 å¹´ä»»èŒäº Netscape å…¬å¸çš„ Brendan Eich æ¥åˆ°ä¸€é¡¹ä»»åŠ¡ï¼šè´Ÿè´£å¼€å‘ä¸€ä¸ªåœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ç¼–ç¨‹è¯­è¨€ã€‚æ²¡é”™ï¼Œé‚£å°±æ˜¯â€œåæ¥â€çš„ JavaScript è¯­è¨€ã€‚</p>
<p>å…¶å®ï¼Œèµ·åˆ JavaScript è¯­è¨€çš„åç§°æ˜¯ â€œLiveScriptâ€ã€‚ç”±äºå½“æ—¶ Java è¯­è¨€å¦‚æ—¥ä¸­å¤©ï¼Œä¸ºäº†è¹­çƒ­åº¦è€Œæ›´åä¸º JavaScriptã€‚åŸæœ¬ JavaScript è¿™ä¸ªé¡¹ç›®å°±æ˜¯ Netscape å…¬å¸å’Œ  Sun å…¬å¸åˆä½œå¼€å‘ï¼Œç”¨è¿™ä¸ªåå­—ä¹Ÿæ— å¯åšéã€‚</p>
<p>åœ¨ 1996 å¹´ Netscape å…¬å¸å†³å®šå°† JavaScript æäº¤ç»™è¡Œä¸šæ ‡å‡†ç»„ç»‡ ECMAï¼Œå¸Œæœ›è¿™ç§è¯­è¨€èƒ½å¤Ÿæˆä¸ºå›½é™…æ ‡å‡†ã€‚æ¬¡å¹´ 6 æœˆå‘å¸ƒç¬¬ä¸€ç‰ˆï¼Œå³ ECMA-262 å·æ ‡å‡†ã€‚å…¶ä¸­ ECMA-262 æ˜¯ä¸€ä¸ªç¼–å·ï¼Œå¯¹åº”çš„æ ‡å‡†åç§°ä¸º ECMAScriptï¼Œæ¢å¥è¯è¯´ ECMA-262 å’Œ ECMAScript æ˜¯åŒä¸€ä¸ªä¸œè¥¿çš„ä¸¤ç§ä¸åŒè¡¨è¾¾æ–¹å¼ã€‚å°±å¥½æ¯”å¦‚èº«ä»½è¯å·ç å’Œå§“åçš„å…³ç³»ï¼Œåªæ˜¯ EMCA ç»„ç»‡çš„æ ‡å‡†åç§°ä¸ä¼šé‡åç½¢äº†ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒECMAScript æ˜¯ä¸€ç§è§„èŒƒå’Œæ ‡å‡†ï¼Œè€Œä¸æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚åªæ˜¯æˆ‘ä»¬ä¹ æƒ¯å°†ç¬¦åˆ ECMAScript æ ‡å‡†çš„è¯­è¨€ç»Ÿç§°ä¸º â€œJavaScriptâ€ ç½¢äº†ã€‚ä¸¥è°¨åœ°çš„è¯´æ³•åº”è¯¥æ˜¯ï¼šJavaScript æ˜¯ ECMAScript çš„ä¸€ç§å®ç°ã€‚</p>
<p><strong>æ‰¯äº†é‚£ä¹ˆå¤šï¼Œé‚£ JavaScript ç©¶ç«Ÿæ˜¯ä»€ä¹ˆç±»å‹çš„è¯­è¨€ï¼Ÿ</strong></p>
<p>ç”±äº JavaScript ç¼–ç¨‹è¯­è¨€å¹¶æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šçš„å®˜ç½‘ï¼Œå› æ­¤å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„è¯´æ³•ã€‚ç›¸å¯¹æ¥è¯´ï¼Œç”± Mozilla åŸºé‡‘ä¼šç»´æŠ¤çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">MDN Web Docs</a> ç›¸å¯¹æƒå¨ä¸€äº›ã€‚</p>
<blockquote>
<ul>
<li>
<p>JavaScriptÂ (JS) æ˜¯ä¸€ç§å…·æœ‰å‡½æ•°ä¼˜å…ˆçš„è½»é‡çº§ï¼Œè§£é‡Šå‹æˆ–å³æ—¶ç¼–è¯‘å‹çš„ç¼–ç¨‹è¯­è¨€ã€‚ï¼ˆæºè‡ª MDNï¼‰</p>
</li>
<li>
<p>é€šå¸¸å°† JavaScript å½’ç±»ä¸ºâ€œåŠ¨æ€â€æˆ–â€œè§£é‡Šæ‰§è¡Œâ€è¯­è¨€ï¼Œä½†äº‹å®ä¸Šå®ƒæ˜¯ä¸€é—¨ç¼–è¯‘è¯­è¨€ã€‚ï¼ˆæºè‡ªã€Šä½ ä¸çŸ¥é“çš„ JavaScriptã€‹ä¹¦æœ¬ï¼‰</p>
</li>
</ul>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘å°†ä¼šç†è§£ä¸ºï¼š<strong>JavaScript æ˜¯ä¸€é—¨ç¼–è¯‘å‹çš„è¯­è¨€</strong>ã€‚å½“ä½ å¯¹ JavaScript æœ‰åŸºç¡€çš„è®¤çŸ¥ä¹‹åï¼Œè‡ªç„¶å°±æƒ³ç€æ·±å…¥åœ°äº†è§£è¿™é—¨è¯­è¨€ï¼Œäºæ˜¯ç¬¬ä¸€ç«™æ¥åˆ°äº† JavaScript å¼•æ“ã€‚</p>
<p><strong>JavaScript æ˜¯æ€æ ·è§£æä»£ç çš„å‘¢ï¼Ÿ</strong></p>
<p>ç”±äºè¹©è„šçš„è‹±è¯­æ°´å¹³ï¼Œæ²¡åŠæ³•ç›´æ¥å»çœ‹ç±»ä¼¼ V8 å¼•æ“ç­‰å®˜ç½‘ï¼Œæœ‰ç‚¹åƒåŠ›ã€‚äºæ˜¯å…¨ç½‘æœç´¢å„ç±»æ–‡ç« ï¼Œäºæ˜¯åˆå‡ºç°äº†å¾ˆå¤šåè¯/æœ¯è¯­ï¼Œæ¯”å¦‚ï¼šè§£æå™¨ã€ç¼–è¯‘å™¨ã€é¢„ç¼–è¯‘ã€è¯æ³•åˆ†æç­‰ç­‰ç­‰...</p>
<p>ç”±äºå„ç±»æ–‡ç« å‚å·®ä¸é½ï¼Œè€Œä¸”ä»è‹±æ–‡ç¿»è¯‘æˆä¸­æ–‡ï¼Œå¯èƒ½è¯­ä¹‰ä¸Šä¹Ÿä¼šæœ‰åå·®ã€‚åŠ ä¹‹æ¯ä¸ªäººå¯¹ JavaScript ç›¸å…³æœ¯è¯­çš„ç†è§£æˆ–è®¤çŸ¥æ°´å¹³åˆä¸ä¸€æ ·ï¼Œæœ‰æ—¶å€™çœŸçš„å¾ˆéš¾å»è€ƒç©¶è°å¯¹è°é”™ï¼Œå”¯æœ‰æ›´ç›¸ä¿¡ä¸€äº›å¤§ä½¬çš„æ–‡ç« ã€‚<strong>ä»è¿™ä¸ªå¿ƒè·¯å†ç¨‹æ¥çœ‹ï¼Œå­¦å¥½è‹±æ–‡çœŸçš„å¾ˆé‡è¦ã€‚</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘çœ‹åˆ°å¾ˆå¤šæ–‡ç« æè¿° JS å¼•æ“å»æ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œæœ‰çš„è¯´æ˜¯è§£æå™¨ã€æœ‰çš„åˆç§°ä¸ºç¼–è¯‘å™¨ã€‚å½“åˆçœ‹åˆ°è¿™äº›çœŸçš„å¥½çƒ¦ï¼Œç©¶ç«Ÿè°å¯¹è°é”™å‘¢ï¼Ÿè°æ›´ä¸¥è°¨å‘¢ï¼Ÿç”±äºæˆ‘åˆæ˜¯å¼ºè¿«ç—‡ï¼Œåˆç‰¹æƒ³ææ¸…æ¥šã€‚</p>
<p>äºæ˜¯æˆ‘ä¸åœåœ°æ‰¾ç­”æ¡ˆ......ç»ˆäºæ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.nowamagic.net/librarys/veda/detail/1579">æˆ‘ä»¬åº”è¯¥å¦‚ä½•å»äº†è§£ JavaScript å¼•æ“çš„å·¥ä½œåŸç†</a>ï¼Œå¹¶æˆªå–æ–‡ä¸­ä¸€æ®µè¯ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7c7c1aca2b8ce998.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å› æ­¤ï¼Œæˆ‘ä¹Ÿä¼šå¼€å§‹è®¤åŒï¼š<strong>ä¸éœ€è¦è¿‡åˆ†å»å¼ºè°ƒ JavaScript è§£æå¼•æ“åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œäº†è§£å®ƒç©¶ç«Ÿåšäº†ä»€ä¹ˆäº‹æƒ…å°±å¯ä»¥äº†</strong>ã€‚ç”±äºå‰é¢æŠŠ JavaScript æ›´å€¾å‘äºå®šä¹‰ä¸ºç¼–è¯‘å‹è¯­è¨€ï¼Œå› æ­¤ï¼Œä¸‹æ–‡å°†æ¶‰åŠçš„ç›¸å…³å†…å®¹ç§°ä¸ºâ€œç¼–è¯‘â€ã€â€œç¼–è¯‘å™¨â€ã€â€œç¼–è¯‘è¿‡ç¨‹â€ç­‰ã€‚å½“ç„¶ç”¨â€œè§£æâ€ä¹Ÿä¸èƒ½è¯´å®ƒé”™ã€‚</p>
<h2>äºŒã€JavaScript ç¼–è¯‘ä¸æ‰§è¡Œ</h2>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå†ç®€å•ä¸è¿‡äº†ã€‚</p>
<pre><code class="language-js">var a = 1;
</code></pre>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹ æƒ¯å°† <code>var a = 1;</code> çœ‹ä½œä¸€ä¸ªå£°æ˜ï¼Œè€Œå®é™…ä¸Š JS å¼•æ“å¹¶ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å®ƒå°† <code>var a</code> å’Œ <code>a = 1</code> å½“ä½œä¸¤ä¸ªå•ç‹¬çš„å£°æ˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç¼–è¯‘é˜¶æ®µçš„ä»»åŠ¡ï¼Œè€Œç¬¬äºŒä¸ªåˆ™æ˜¯æ‰§è¡Œé˜¶æ®µçš„ä»»åŠ¡ã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œç¼–è¯‘é˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µåŒ…æ‹¬ä»¥ä¸‹è¿‡ç¨‹ï¼š</p>
<pre><code class="language-text">è¯æ³•åˆ†æ -&gt; è¯­æ³•åˆ†æ -&gt; ä»£ç ç”Ÿæˆ -&gt; è§£é‡Šæ‰§è¡Œ
</code></pre>
<h4>1. ç¼–è¯‘é˜¶æ®µ</h4>
<p>ç®€å•åœ°è¯´ï¼Œç¼–è¯‘é˜¶æ®µå°±æ˜¯å°†æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œä»£ç ã€‚å¤§è‡´åŒ…æ‹¬ä»¥ä¸‹è¿‡ç¨‹ï¼š</p>
<pre><code class="language-text">è¯æ³•åˆ†æ -&gt; è¯­æ³•åˆ†æ -&gt; ä»£ç ç”Ÿæˆ
</code></pre>
<ul>
<li>
<p><strong>è¯æ³•åˆ†æ</strong>ï¼šå°†æºä»£ç ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰æ‹†åˆ†æˆæœ‰æ„ä¹‰çš„ä»£ç å—ï¼Œè¿™äº›ä»£ç å—è¢«ç§°ä¸ºè¯æ³•å•å…ƒï¼ˆtokenï¼‰ã€‚ä¾‹å¦‚ <code>var a = 1;</code> è¢«åˆ†è§£æˆï¼š<code>var</code>ã€<code>a</code>ã€<code>=</code>ã€<code>1</code>ã€<code>;</code> ã€‚</p>
</li>
<li>
<p><strong>è¯­æ³•åˆ†æ</strong>ï¼šå°†è¯æ³•å•å…ƒæµï¼ˆæ•°ç»„å½¢å¼ï¼‰è½¬æ¢æˆä¸€ä¸ªè¡¨ç¤ºç¨‹åºç»“æ„çš„æ ‘ï¼Œç§°ä¸ºâ€œæŠ½è±¡è¯­æ³•æ ‘â€ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰ã€‚ä¸Šè¿°ç¤ºä¾‹ç»è¿‡è½¬æ¢ä¹‹åçš„æŠ½è±¡è¯­æ³•æ ‘å¦‚ä¸‹ï¼š</p>
</li>
<li>
<p><strong>ä»£ç ç”Ÿæˆ</strong>ï¼šå°† AST è½¬æ¢ä¸ºå¯æ‰§è¡Œä»£ç ï¼ˆä¸€ç»„æœºå™¨æŒ‡ä»¤ï¼‰çš„è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå«ä½œ <code>a</code> çš„å˜é‡ï¼ˆåŒ…æ‹¬åˆ†é…å†…å­˜ï¼‰ï¼Œå¹¶å°†å€¼ <code>1</code> å­˜å‚¨åœ¨ <code>a</code> ä¸­ã€‚</p>
</li>
</ul>
<p>é¦–å…ˆï¼Œåœ¨è¯æ³•åˆ†æé˜¶æ®µå°†æºä»£ç  <code>var a = 1;</code> è½¬æ¢ä¸º <code>tokens</code> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">[
  {
    &quot;type&quot;: &quot;Keyword&quot;,
    &quot;value&quot;: &quot;var&quot;
  },
  {
    &quot;type&quot;: &quot;Identifier&quot;,
    &quot;value&quot;: &quot;a&quot;
  },
  {
    &quot;type&quot;: &quot;Punctuator&quot;,
    &quot;value&quot;: &quot;=&quot;
  },
  {
    &quot;type&quot;: &quot;Numeric&quot;,
    &quot;value&quot;: &quot;1&quot;
  },
  {
    &quot;type&quot;: &quot;Punctuator&quot;,
    &quot;value&quot;: &quot;;&quot;
  }
]
</code></pre>
<p>æ¥ç€è¯­æ³•åˆ†æé˜¶æ®µï¼Œå°† <code>tokens</code> è½¬æ¢ä¸º ASTï¼ˆ<a href="https://esprima.org/demo/parse.html?code=var%20a%20%3D%201%3B%0A">Esprima Parser</a>ï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;body&quot;: [
    {
      &quot;type&quot;: &quot;VariableDeclaration&quot;,
      &quot;declarations&quot;: [
        {
          &quot;type&quot;: &quot;VariableDeclarator&quot;,
          &quot;id&quot;: {
            &quot;type&quot;: &quot;Identifier&quot;,
            &quot;name&quot;: &quot;a&quot;
          },
          &quot;init&quot;: {
            &quot;type&quot;: &quot;Literal&quot;,
            &quot;value&quot;: 1,
            &quot;raw&quot;: &quot;1&quot;
          }
        }
      ],
      &quot;kind&quot;: &quot;var&quot;
    }
  ],
  &quot;sourceType&quot;: &quot;script&quot;
}
</code></pre>
<p>å‡è®¾åœ¨è¯­æ³•åˆ†æé˜¶æ®µï¼Œè‹¥ tokens æ— æ³•æ„æˆåˆæ³•çš„è¯­å¥æ—¶ï¼Œå°†ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">var a = () // SyntaxError: Unexpected token ')'
</code></pre>
<p>ç„¶åï¼Œå¦‚æœå‰é¢çš„è¿‡ç¨‹éƒ½æ²¡æœ‰é—®é¢˜ï¼Œå°†ä¼šä»£ç ç”Ÿæˆé˜¶æ®µï¼Œæ¥ç”Ÿæˆå¯æ‰§è¡Œä»£ç ã€‚</p>
<p>ä¸Šè¿°ä¸‰ä¸ªè¿‡ç¨‹æ˜¯ä¼ ç»Ÿç¼–è¯‘è¯­è¨€åœ¨æ‰§è¡Œæºä»£ç ä¹‹å‰ç»å†çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œç»Ÿç§°ä¸ºâ€œç¼–è¯‘â€ã€‚è€Œ JS å¼•æ“è¦å¤æ‚å¾—å¤šï¼Œä¾‹å¦‚åœ¨è¯­æ³•åˆ†æå’Œä»£ç ç”Ÿæˆé˜¶æ®µæœ‰ç‰¹å®šçš„æ­¥éª¤æ¥å¯¹è¿è¡Œæ€§èƒ½è¿›è¡Œä¼˜åŒ–ã€‚å¯¹æ­¤ï¼Œå°±æœ¬æ–‡è®¨è®ºèŒƒå›´æœ‰ä¸ªå¤§è‡´çš„è®¤çŸ¥å°±è¡Œã€‚å¦‚æœ‰å…´è¶£å¦è¡Œæœç´¢ V8 æ€§èƒ½ä¼˜åŒ–çš„ç­–ç•¥ã€‚</p>
<blockquote>
<p>JavaScript çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå®ƒå‘ç”Ÿåœ¨ä»£ç è¿è¡Œä¹‹å‰ï¼Œå®ƒä¸»è¦åšçš„äº‹æƒ…æœ‰è¿™äº›ï¼š</p>
<ul>
<li>ç¡®å®šå‡½æ•°ã€å˜é‡çš„è¯æ³•ä½œç”¨åŸŸï¼ˆç”±ç¼–å†™çš„ä½ç½®æ¥å†³å®šï¼‰ã€‚é™¤äº† evalã€with ä¼šæ¬ºéª—è¯æ³•ä½œç”¨åŸŸä¹‹å¤–ï¼Œå…¶ä»–æƒ…å†µè¯æ³•åˆ†æå™¨ä¼šä¿æŒå…¶ä½œç”¨åŸŸä¸å˜ã€‚</li>
<li>æ£€æŸ¥è¯­æ³•æ˜¯å¦æœ‰è¯¯</li>
<li>ä¸ºå˜é‡å£°æ˜ã€å‡½æ•°å£°æ˜åˆ†é…å†…å­˜ç©ºé—´ã€‚</li>
</ul>
</blockquote>
<p>è¯´é‚£ä¹ˆå¤šï¼Œå¤§å®¶æ›´å…³å¿ƒçš„å¯èƒ½æ˜¯è¿™å¥è¯ï¼š<strong>åŒ…æ‹¬å˜é‡å’Œå‡½æ•°åœ¨å†…çš„æ‰€æœ‰å£°æ˜éƒ½ä¼šåœ¨ä»»ä½•ä»£ç è¢«æ‰§è¡Œå‰é¦–å…ˆè¢«å¤„ç†</strong>ã€‚</p>
<p>å¦å¤–ï¼ŒJavaScript æ˜¯æŒ‰å—ï¼ˆ<code>&lt;script&gt;</code>ï¼‰ç¼–è¯‘çš„ï¼Œå…¶ä¸­<strong>è¯­æ³•åˆ†ææ˜¯å¯¹å½“å‰å—è¿›è¡Œé€šç¯‡çš„è¯­æ³•æ£€æŸ¥</strong>ï¼Œè‹¥æœ‰è¯¯åˆ™æŠ›å‡ºè¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰ï¼Œå› æ­¤ä¹Ÿä¸ä¼šæ‰§è¡Œå½“å‰å—çš„ä»»ä½•ä»£ç äº†ã€‚æ¥ç€å†å¯¹ä¸‹ä¸€ä¸ª <code>&lt;script&gt;</code> è¿›è¡Œç¼–è¯‘æ‰§è¡Œã€‚</p>
<pre><code class="language-html">&lt;script&gt;
  console.log('script1')
  if (true) else false // è¿™é‡Œè¯­æ³•æœ‰è¯¯
&lt;/script&gt;
&lt;script&gt;
  console.log('script2')
&lt;/script&gt;
</code></pre>
<p>æœ€ç»ˆçš„æ‰“å°ç»“æœæ˜¯ <code>&quot;script2&quot;</code>ã€‚ä½†ç¼–è¯‘å™¨å¯¹ç¬¬ä¸€ä¸ª <code>&lt;script&gt;</code> å—è¯­æ³•åˆ†æé˜¶æ®µå°±æŠ›å‡ºé”™è¯¯ï¼š<code>SyntaxError: Unexpected token 'else'</code>ã€‚æ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªå—ï¼Œäºæ˜¯æ‰“å°å‡º <code>&quot;script2&quot;</code>ã€‚</p>
<pre><code class="language-html">&lt;script&gt;
  function fn1() {
    console.log('fn1')
  }
  fn2() // ReferenceError: fn2 is not defined
&lt;/script&gt;
&lt;script&gt;
  function fn2() {
    console.log('fn2')
  }
  fn1() // &quot;fn1&quot;
&lt;/script&gt;
</code></pre>
<p>ä¸Šè¿°è¿™ä¸ªä¾‹å­ï¼Œä¹Ÿå¯ä»¥è¯æ˜ <code>&lt;script&gt;</code> æ˜¯æŒ‰å—ç¼–è¯‘æ‰§è¡Œçš„ã€‚</p>
<h4>2. æ‰§è¡Œé˜¶æ®µ</h4>
<p>ç¼–è¯‘é˜¶æ®µå®Œæˆä¹‹åï¼Œæ¥ç€å°±åˆ°ä»£ç æ‰§è¡Œé˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦æ¶‰åŠåˆ°æ‰§è¡Œä¸Šä¸‹æ–‡çš„å†…å®¹ã€‚ä¸‹åˆå†è¯¦è¯´...</p>
<h2>ä¸‰ã€JavaScript ä½œç”¨åŸŸ</h2>
<h4>1. ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>åœ¨ç¼–å†™ JavaScript ç¨‹åºæ—¶ï¼Œä¾‹å¦‚ä¸€ä¸ªç®€å•çš„å£°æ˜è¯­å¥ï¼š</p>
<pre><code class="language-js">var a = 1
</code></pre>
<p>æˆ‘ä»¬å¯èƒ½ä¼šé—®è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>JS å¼•æ“å¦‚ä½•å£°æ˜ä¸€ä¸ªæ ‡è¯†ç¬¦åç§°ä¸º <code>a</code> çš„å˜é‡ï¼Ÿ</li>
<li>å˜é‡ <code>a</code> å°†ä¼šè¢«å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</li>
<li>å‡è®¾å¯¹å˜é‡ <code>a</code> è¿›è¡Œèµ‹å€¼æ“ä½œï¼ŒJS å¼•æ“åˆæ˜¯æ€æ ·æ ¹æ®æ ‡è¯†ç¬¦ <code>a</code> æ‰¾åˆ°å¯¹åº”å˜é‡çš„ï¼Ÿ</li>
</ul>
<p>ç–‘é—®å…ˆä¿ç•™ç€ï¼Œå†çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">var a = 1

function foo() {
  var a = 'local'
  consol.log(a)
}

foo()
</code></pre>
<p>å¦‚æœå‡½æ•° <code>foo</code> å†…éƒ¨æœ‰ä¸€ä¸ªåŒåå˜é‡ <code>a</code>ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>foo()</code> æ—¶ï¼Œè¯­å¥ <code>console.log(a)</code> ä¸­çš„æ ‡è¯†ç¬¦ <code>a</code> æ˜¯æŒ‡å“ªä¸€ä¸ªï¼Ÿ</p>
<p>ä¸Šè¿°ç¤ºä¾‹éå¸¸ç®€å•ï¼Œä½†å¾€å¾€åœ¨å†™é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå®šä¹‰å¾ˆå¤šå˜é‡å’Œå‡½æ•°ï¼Œä»¥åŠåµŒå¥—ä½¿ç”¨ç­‰åœºæ™¯ã€‚é‚£ä¹ˆè¿™ä¸€è¿ä¸²çš„å¤æ‚é—®é¢˜ï¼ŒJS å¼•æ“æ˜¯æ€ä¹ˆå»å¤„ç†å®ƒä»¬çš„å‘¢ï¼Ÿå®ƒè‚¯å®šéœ€è¦çº¦å®šå¥½ä¸€å¥—è§„åˆ™ï¼Œå¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå”¯æœ‰è€è€å®å®åœ°æŒ‰ç…§è¿™å¥—è§„åˆ™å»ç¼–å†™ç¨‹åºï¼Œæ‰ä¼šå¾—åˆ°é¢„æœŸç»“æœã€‚</p>
<p>è¿™å¥—è§„åˆ™è¢«ç§°ä¸º**â€œä½œç”¨åŸŸâ€**ï¼Œå®ƒçº¦å®šäº†å¦‚ä½•å­˜å‚¨å˜é‡ä»¥åŠæŸ¥æ‰¾å˜é‡ã€‚ç„¶åå„å®¶ JS å¼•æ“å°†ä¼šæŒ‰ç…§è¿™å¥—è§„åˆ™å»å®ç°ï¼Œæ‰€ä»¥åŒä¸€ä»½ä»£ç åœ¨å„æµè§ˆå™¨ä¸‹éƒ½å¯ä»¥å¾—åˆ°ç›¸åŒçš„æ•ˆæœã€‚</p>
<h3>2. äº†è§£ä½œç”¨åŸŸ</h3>
<p>æˆ‘ä»¬å°†â€œä½œç”¨åŸŸâ€å®šä¹‰ä¸ºä¸€å¥—è§„åˆ™ï¼Œè¿™å¥—è§„åˆ™ç”¨æ¥ç®¡ç†å¼•æ“å¦‚ä½•åœ¨å½“å‰ä½œç”¨åŸŸä»¥åŠåµŒå¥—çš„å­ä½œç”¨åŸŸä¸­æ ¹æ®æ ‡è¯†ç¬¦åç§°è¿›è¡Œå˜é‡æŸ¥æ‰¾ã€‚</p>
<p>ä½œç”¨åŸŸçš„æ¦‚å¿µï¼Œä¸æ˜¯ JavaScript è¯­è¨€ç‰¹æœ‰çš„ï¼Œæ¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€éƒ½å­˜åœ¨çš„ï¼Œåªæ˜¯è§„åˆ™ä¸ä¸€æ ·è€Œå·²ã€‚ä½œç”¨åŸŸæœ‰ä¸¤ç§å·¥ä½œæ¨¡å‹ï¼šä¸€æ˜¯â€œè¯æ³•ä½œç”¨åŸŸâ€ï¼ŒäºŒæ˜¯â€œåŠ¨æ€ä½œç”¨åŸŸâ€ã€‚å‰è€…ä¹Ÿç§°ä¸ºâ€œé™æ€ä½œç”¨åŸŸâ€ï¼Œè¢«å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬ JavaScriptï¼‰æ‰€é‡‡ç”¨ã€‚<strong>è¯æ³•ä½œç”¨åŸŸæ˜¯åœ¨ç¼–å†™ä»£ç æˆ–è€…è¯´å®šä¹‰æ—¶ç¡®å®šçš„ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸæ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ã€‚</strong></p>
<blockquote>
<p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒJavaScript åªæœ‰è¯æ³•ä½œç”¨åŸŸï¼Œå¹¶ä¸å…·æœ‰åŠ¨æ€ä½œç”¨åŸŸã€‚è¯·æ³¨æ„ <code>this</code> æœºåˆ¶åªæ˜¯â€œåƒâ€åŠ¨æ€ä½œç”¨åŸŸè€Œå·²ã€‚</p>
</blockquote>
<p>è¯æ³•ä½œç”¨åŸŸå…³æ³¨å‡½æ•°åœ¨ä½•å¤„å£°æ˜ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸå…³æ³¨å‡½æ•°ä»ä½•å¤„è°ƒç”¨ã€‚<code>this</code> ä¹Ÿæ˜¯å…³æ³¨å‡½æ•°å¦‚ä½•è°ƒç”¨çš„ï¼Œæ‰€ä»¥è¯´å®ƒåƒåŠ¨æ€ä½œç”¨åŸŸã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">var a = 1

function foo() {
  console.log(a)
}

function bar() {
  var a = 2
  foo()
}

bar() // æ‰“å° 1
</code></pre>
<p>å› æ­¤ï¼Œæ— è®ºå‡½æ•° <code>foo</code> åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼Œéƒ½ä¼šæ‰“å°å‡º <code>1</code>ã€‚æ‰§è¡Œ <code>foo()</code> æ—¶ï¼Œé¦–å…ˆåœ¨å‡½æ•°å†…éƒ¨æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ï¼ˆå±€éƒ¨ï¼‰å˜é‡ <code>a</code>ï¼Œå¦‚æ— ï¼Œå†å¾€ä¸Šä¸€å±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç»“æœæ‰¾åˆ°äº†ä¸”å€¼ä¸º <code>1</code>ï¼Œå› æ­¤ä¼šæ‰“å°å‡º <code>1</code>ã€‚å‡è®¾ä¸€å±‚ä¸€å±‚å¾€ä¸ŠæŸ¥æ‰¾ï¼Œç›´è‡³å…¨å±€ä½œç”¨åŸŸä¹Ÿæ‰¾ä¸åˆ°å˜é‡æ—¶ï¼Œå°±ä¼šæŠ›å‡º <code>ReferenceType</code> é”™è¯¯ã€‚</p>
<blockquote>
<p>æ— è®ºå‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼Œä¹Ÿæ— è®ºå®ƒå¦‚ä½•è¢«è°ƒç”¨ï¼Œå®ƒçš„è¯æ³•ä½œç”¨åŸŸéƒ½åªç”±å‡½æ•°è¢«å£°æ˜æ—¶æ‰€å¤„çš„ä½ç½®å†³å®šã€‚</p>
</blockquote>
<h2>å››ã€æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</h2>
<p>æˆ‘ä»¬ä¹¦å†™çš„ï¼ˆæºï¼‰ä»£ç ä¼šè¢«ç¼–è¯‘å™¨è¿›è¡Œå¤„ç†ï¼Œå¹¶ç”Ÿæˆâ€œå¯æ‰§è¡Œä»£ç â€ï¼Œæ¥ç€å»æ‰§è¡Œå®ƒä»¬ã€‚æ•´ä¸ª JavaScript ç¨‹åºçš„ç¼–è¯‘åŠæ‰§è¡Œè¿‡ç¨‹ï¼Œéƒ½ç”± JS å¼•æ“æ¥åè°ƒå¤„ç†ã€‚</p>
<p>å‰é¢æåˆ°ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯ç”±å…¶å£°æ˜çš„ä½ç½®å†³å®šçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®ä¸­ç¼–å†™çš„å‡½æ•°ä¼šéå¸¸å¤šï¼Œé‚£ä¹ˆ JS å¼•æ“å¦‚ä½•ç®¡ç†å®ƒä»¬å‘¢ï¼Ÿ</p>
<blockquote>
<p>JS å¼•æ“åœ¨æ‰§è¡Œä»£ç ä¹‹å‰ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œå°†ç”¨äºç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>åè¯è¯´æ˜ï¼š</p>
<ul>
<li>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œè‹±æ–‡ Execution Context Stackï¼ŒECSã€‚æœ‰äº›æ–‡ç« ç§°ä¸ºâ€œè°ƒç”¨æ ˆâ€ã€‚</li>
<li>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼ŒECï¼‰ï¼Œç®€ç§°ä¸Šä¸‹æ–‡ã€‚æ‰§è¡Œä¸Šä¸‹æ–‡ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ä¸ªæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆç®€ç§°å…¨å±€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆç®€ç§°å‡½æ•°ä¸Šä¸‹æ–‡ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ ˆçš„ç‰¹ç‚¹æ˜¯å…ˆè¿›åå‡ºã€åè¿›å…ˆå‡ºï¼Œè€Œä¸”æ ˆåªèƒ½åœ¨æ ˆé¡¶è¿›è¡Œæ’å…¥ï¼ˆpushï¼‰ã€åˆ é™¤ï¼ˆpopï¼‰æ“ä½œã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œä»£ç æ‰§è¡ŒåŠæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰å½“ JS å¼•æ“å¼€å§‹æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œæ€»ä¼šæœ€å…ˆé‡åˆ°å…¨å±€ä»£ç ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ï¼ˆGlobalContextï¼Œæµè§ˆå™¨ç¯å¢ƒä¸º <code>window</code> å¯¹è±¡ï¼‰ï¼Œå¹¶åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„æ ˆé¡¶æ’å…¥ã€‚</p>
<p>ï¼ˆ2ï¼‰æ¥ç€ï¼Œæ¯æ‰§è¡Œä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°ä¸Šä¸‹æ–‡ï¼ˆFunctionalContextï¼‰ï¼Œå¹¶æ’å…¥æ ˆé¡¶ã€‚</p>
<p>ï¼ˆ3ï¼‰å½“ä¸€ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¯¥å‡½æ•°ä¸Šä¸‹æ–‡å°±ä¼šä»æ ˆé¡¶åˆ é™¤ã€‚</p>
<p>ï¼ˆ4ï¼‰å¾€åä»£ç æ‰§è¡Œå°±æ˜¯ 2ã€3 æ­¥éª¤å‘¨è€Œå¤å§‹çš„è¿‡ç¨‹...</p>
<p>ï¼ˆ5ï¼‰è¯·æ³¨æ„ï¼Œåœ¨é¡µé¢é”€æ¯ä¹‹å‰ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆæ ˆåº•æ°¸è¿œä¼šä¿ç•™ç€ä¸€ä¸ª GlobalContextã€‚ç›´è‡³é¡µé¢é”€æ¯ï¼ˆå…³é—­é¡µé¢æˆ–é€€å‡ºæµè§ˆå™¨ï¼‰æ‰ä¼šè¢«åˆ é™¤ï¼Œè‡ªç„¶æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¹Ÿæ¶ˆå¤±äº†ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š</p>
<pre><code class="language-js">function baz() {
  console.log('baz')
}

function bar() {
  console.log('bar')
  baz()
}

function foo() {
  console.log('foo')
  bar()
}

foo()
</code></pre>
<p>ç„¶åä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå˜åŒ–å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// è¯·æ³¨æ„ï¼Œå¦‚ä¸‹æ˜¯ä¼ªä»£ç ï¼Œæ ˆè·Ÿæ•°ç»„æ˜¯ä¸¤ç§ä¸åŒçš„ç»“æ„ã€‚
// å‡è®¾ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹ä¸ºæ ˆåº•ï¼Œæœ€åä¸€é¡¹ä¸ºæ ˆé¡¶ã€‚
// æ°å¥½æ•°ç»„çš„ push()ã€pop() æ–¹æ³•åˆ†åˆ«æ˜¯åœ¨æœ«å°¾æ·»åŠ ä¸€é¡¹ã€åˆ é™¤æœ€åä¸€é¡¹ã€‚åˆšå¥½ç¬¦åˆæ ˆæ“ä½œç‰¹ç‚¹ã€‚

// 1. ä»£ç æ‰§è¡Œä¹‹å‰ï¼ŒJS å¼•æ“åˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼ˆç”¨ ECStack è¡¨ç¤ºï¼‰
ECStack = []

// 2. æ‰§è¡Œå…¨å±€ä»£ç ï¼Œåœ¨ ECStack æ’å…¥å…¨å±€ä¸Šä¸‹æ–‡
ECStack.push({ &lt;GlobalContext&gt;: window })

// 3. å½“è°ƒç”¨å‡½æ•° foo()ï¼Œå¾€ ECStack æ’å…¥ foo å‡½æ•°ä¸Šä¸‹æ–‡
ECStack.push({ &lt;FunctionalContext&gt;: foo })

// 4. æ‰§è¡Œ foo() å‡½æ•°ï¼Œé‡Œé¢åˆä¼šè°ƒç”¨å‡½æ•° bar()ï¼Œåˆæ’å…¥ bar å‡½æ•°ä¸Šä¸‹æ–‡
ECStack.push({ &lt;FunctionalContext&gt;: bar })

// 5. æ‰§è¡Œ bar() å‡½æ•°ï¼Œé‡Œé¢åˆè°ƒç”¨äº†å‡½æ•° baz()ï¼Œåˆæ’å…¥ baz å‡½æ•°ä¸Šä¸‹æ–‡
ECStack.push({ &lt;FunctionalContext&gt;: baz })

// 6. ç”±äº baz å†…æ²¡æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°äº†ï¼Œå½“å®ƒæ‰§è¡Œå®Œåï¼Œå®ƒçš„å‡½æ•°ä¸Šä¸‹æ–‡ä¼šè¢«ä»æ ˆé¡¶åˆ é™¤
ECStack.pop({ &lt;FunctionalContext&gt;: baz })

// 7. åŒä¸Š
ECStack.pop({ &lt;FunctionalContext&gt;: bar })

// 8. åŒä¸Š
ECStack.pop({ &lt;FunctionalContext&gt;: foo })

// 9. å½“å‡½æ•° foo ä¹Ÿæ‰§è¡Œå®Œä¹‹åï¼Œå…¨å±€ä¸Šä¸‹æ–‡å¹¶ä¸ä¼šè¢«åˆ é™¤ï¼ŒECStack æ°¸è¿œä¿ç•™ç€å…¨å±€ä¸Šä¸‹æ–‡
ECStack = [{ &lt;GlobalContext&gt;: window }]

// 10. ç›´åˆ°å°†æ¥æŸä¸ªæ—¶åˆ»é¡µé¢é”€æ¯ï¼Œå…¨å±€ä¸Šä¸‹æ–‡ä»æ ˆé¡¶åˆ é™¤ï¼ŒECStack ä¹Ÿä¼šè¢« JS å¼•æ“å›æ”¶ã€‚
</code></pre>
<p>ç›¸ä¿¡ä»¥ä¸Šè¿‡ç¨‹å¤§å®¶ç†è§£èµ·æ¥éƒ½åº”è¯¥å¾ˆè½»æ¾ã€‚è®©å¤§å®¶å›°æƒ‘çš„å¯èƒ½æ˜¯è¿™äº› ECStack æ ˆæœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸æ€¥ï¼Œä¸€æ­¥ä¸€æ­¥æ¥...</p>
<h2>ä¸‰ã€æ‰§è¡Œä¸Šä¸‹æ–‡</h2>
<p>å‰é¢æåˆ°ï¼Œä»£ç æ‰§è¡Œçš„æ—¶å€™ä¼šåœ¨æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­æ’å…¥æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡å…·ä½“åšäº†ä»€ä¹ˆå·¥ä½œå‘¢ï¼Ÿ</p>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåˆ†ä¸ºå…¨å±€ä¸Šä¸‹æ–‡å’Œå‡½æ•°ä¸Šä¸‹æ–‡ä¸¤ç±»ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰ä¸€ç³»åˆ—çš„å±æ€§ï¼ˆç§°ä¸ºä¸Šä¸‹æ–‡çŠ¶æ€ï¼‰ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªå±æ€§ï¼š</p>
<blockquote>
<ul>
<li>å˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼ŒVOï¼‰</li>
<li>ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰</li>
<li>this</li>
</ul>
</blockquote>
<h4>1. å˜é‡å¯¹è±¡</h4>
<p>åœ¨å˜é‡å¯¹è±¡ä¸Šï¼Œå­˜å‚¨äº†å½“å‰ä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å˜é‡æˆ–å‡½æ•°ã€‚å…¨å±€ä¸Šä¸‹æ–‡ä¸å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼Œç¨æœ‰ä¸åŒã€‚</p>
<p><strong>å…¨å±€ä¸Šä¸‹æ–‡</strong></p>
<p>å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼Œå°±æ˜¯å®¿ä¸»ç¯å¢ƒçš„é¡¶å±‚å¯¹è±¡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis">globalThis</a>ã€‚æ¯”å¦‚ï¼Œæµè§ˆå™¨ä¸­ä¸º <code>window</code> å¯¹è±¡ï¼ŒNode.js ä¸­æ˜¯ <code>global</code> å¯¹è±¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ˜¯å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸å« <code>arguments</code> å±æ€§ã€‚äºŒæ˜¯é€šè¿‡ <code>var</code>ã€<code>function</code> å…³é”®å­—å£°æ˜çš„å˜é‡æˆ–å‡½æ•°ï¼Œéƒ½ä¼šæˆä¸º <code>globalThis</code> å¯¹è±¡çš„å±æ€§ï¼Œè€Œ <code>let</code> æˆ– <code>const</code> åˆ™ä¸ä¼šã€‚</p>
<p>ç”±äº <code>let</code> æˆ– <code>const</code> å…¨å±€ä¸‹çš„ç‰¹æ€§ï¼Œæˆ‘å¯¹â€œå…¨å±€çš„å˜é‡å¯¹è±¡ç­‰äºé¡¶å±‚å¯¹è±¡â€è¿™å¥è¯æœ‰æ‰€ä¿ç•™ã€‚ä½†æˆ‘ä»¬åªè¦çŸ¥é“ï¼Œæ— è®ºé€šè¿‡ <code>var</code>ã€<code>let</code> è¿˜æ˜¯ <code>const</code> å£°æ˜çš„å˜é‡ï¼Œéƒ½åŒ…å«åœ¨å…¶å˜é‡å¯¹è±¡ä¸­å³å¯ã€‚</p>
<p><strong>å‡½æ•°ä¸Šä¸‹æ–‡</strong></p>
<p>åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ´»åŠ¨å¯¹è±¡ï¼ˆActivation Objectï¼ŒAOï¼‰æ¥è¡¨ç¤ºå˜é‡å¯¹è±¡ã€‚å…¶å®å˜é‡å¯¹è±¡æ˜¯æ— æ³•é€šè¿‡ä»£ç æ¥è®¿é—®çš„ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ‰ä¼šè¢«æ¿€æ´»ï¼Œä¹Ÿåªæœ‰æ´»åŠ¨å¯¹è±¡ä¸Šçš„å„ç§å±æ€§æ‰èƒ½è¢«è®¿é—®ã€‚å¯ä»¥ç†è§£ä¸º AO å°±æ˜¯ VO çš„ä¸€ä¸ªåˆ«åã€‚</p>
<p>æ´»åŠ¨å¯¹è±¡æ˜¯åœ¨è¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºçš„ï¼Œå®ƒé€šè¿‡å‡½æ•°çš„ <code>arguments</code> å±æ€§è¿›è¡Œåˆå§‹åŒ–ï¼Œ<code>arguments</code> å±æ€§å€¼æ˜¯ <code>Arguments</code> å¯¹è±¡ã€‚</p>
<p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†æˆä¸¤ä¸ªé˜¶æ®µè¿›è¡Œå¤„ç†ï¼š</p>
<blockquote>
<ol>
<li>è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>ä»£ç æ‰§è¡Œ</li>
</ol>
</blockquote>
<p>å½“è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œè¿™æ—¶è¿˜æ²¡æ‰§è¡Œä»£ç ã€‚å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå®ƒåŒ…æ‹¬ï¼š</p>
<pre><code>AO = {
  1. å‡½æ•°çš„æ‰€æœ‰å½¢å‚ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰ï¼š
    * ç”±å½¢å‚åç§°å’Œå¯¹åº”å€¼ç»„æˆçš„ä¸€ä¸ªå˜é‡å¯¹è±¡çš„å±æ€§è¢«åˆ›å»º
    * è‹¥æ²¡æœ‰å®å‚ï¼Œå¯¹åº”å±æ€§å€¼è®¾ä¸º undefined

  2. å‡½æ•°å£°æ˜
    * ç”±å‡½æ•°åç§°å’Œå¯¹åº”å€¼ç»„æˆä¸€ä¸ªå˜é‡å¯¹è±¡çš„å±æ€§è¢«åˆ›å»º
    * è‹¥å‡½æ•°åç§°ä¸å½¢å‚åç§°é‡åï¼Œé‚£ä¹ˆå‡½æ•°å£°æ˜åˆ›å»ºçš„å±æ€§å°†ä¼šè¦†ç›–å½¢å‚æ‰€åˆ›å»ºçš„å±æ€§

  3. å˜é‡å£°æ˜
    * ç”±å˜é‡åç§°ä¸å¯¹åº”å€¼ï¼ˆundefinedï¼‰ç»„æˆçš„ä¸€ä¸ªå˜é‡å¯¹è±¡çš„å±æ€§è¢«åˆ›å»º
    * è‹¥å˜é‡åç§°ä¸å½¢å‚åç§°æˆ–å‡½æ•°åç§°å­˜åœ¨é‡åï¼Œé‚£ä¹ˆæ­¤å˜é‡å£°æ˜å°†ä¼šè¢«å¿½ç•¥ã€‚
}
</code></pre>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">function foo(a) {
  var b = 2
  function c() { }
  var d = 3
}

foo(1)
</code></pre>
<p>è¿›å…¥ <code>foo()</code> çš„æ‰§è¡Œä¸Šä¸‹æ–‡åï¼Œè¿™æ—¶ AO å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">AO = {
  arguments: {
    0: 1,
    length: 1
  },
  a: 1,
  b: undefined,
  c: Æ’ c(),
  d: undefined
}
</code></pre>
<p>â€œè¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡â€çš„è¿‡ç¨‹å®Œæˆä¹‹åï¼Œæ¥ç€å¼€å§‹æŒ‰é¡ºåºæ‰§è¡Œä»£ç ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚å½“å‡½æ•° <code>foo()</code> æ‰§è¡Œå®Œä¹‹åï¼Œè¿™æ—¶ AO å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">AO = {
  arguments: {
    0: 1,
    length: 1
  },
  a: 1,
  b: 2,
  c: Æ’ c(),
  d: 3
}
</code></pre>
<p>è¯·æ³¨æ„ï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>arguments</code> ä¼šè¿½è¸ªå˜é‡çš„å˜åŒ–ï¼Œè€Œä¸¥æ ¼æ¨¡å¼ä¸‹åˆ™ä¸ä¼šã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">function foo(a) {
  a = 2
}
foo(1)
// å½“ foo æ‰§è¡Œå®Œä¹‹åï¼Œarguments ä¸º { 0: 2, length: 1 }
// å‡è®¾ foo å¤„äºä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œarguments å§‹ç»ˆä¸º { 0: 1, length: 1 }
</code></pre>
<p><strong>å˜é‡å¯¹è±¡å°ç»“</strong></p>
<ol>
<li>è¿›å…¥å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ˜¯é¡¶å±‚å¯¹è±¡ã€‚</li>
<li>è¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼ˆæˆ–æ´»åŠ¨å¯¹è±¡ï¼‰åˆå§‹åŒ–åªåŒ…æ‹¬ <code>Arguments</code> å¯¹è±¡ã€‚</li>
<li>åœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œä¼šç»™æ´»åŠ¨å¯¹è±¡æ·»åŠ å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ç­‰åˆå§‹çš„å±æ€§ã€‚</li>
<li>åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œä¼šå†æ¬¡ä¿®æ”¹æ´»åŠ¨å¯¹è±¡çš„å±æ€§å€¼ã€‚</li>
</ol>
<h4>2. ä½œç”¨åŸŸé“¾</h4>
<!--
```js
Execution Context = {
  Variable Object: "åŒ…å«é€šè¿‡ varã€letã€const å£°æ˜çš„å˜é‡ã€å‡½æ•°å£°æ˜ã€arguments ç­‰"
  Scope Chain: "å³ VO + all parent scopes"
  thisValue: "å³ context object"
}
```

* **Variable Object**ï¼ˆVOï¼‰ï¼šå³å˜é‡å¯¹è±¡ã€‚æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å˜é‡å¯¹è±¡ï¼Œè€Œè¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½å­˜åœ¨äºè¿™ä¸ªå¯¹è±¡ä¸Šã€‚è¯¥å¯¹è±¡æ— æ³•é€šè¿‡ä»£ç è®¿é—®å¾—åˆ°ã€‚

  

  ä¸å…¨å±€ä¸Šä¸‹æ–‡ä¸åŒçš„æ˜¯ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼ŒåŒ…å«å˜é‡ï¼ˆå«å½¢å‚ï¼‰ã€å‡½æ•°ã€`arguments` å±æ€§ã€‚æ³¨æ„ï¼Œå½¢å‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚

* **Scope Chain**ï¼šå³ä½œç”¨åŸŸé“¾ã€‚å½“ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå˜é‡å¯¹è±¡çš„ä½œç”¨åŸŸé“¾ã€‚

* **thisValue**ï¼šå³ `this` å…³é”®å­—ã€‚

-->
<!--

### å¾…æ•´ç†

å¯¹äºå‡½æ•°ï¼Œæ‰§è¡Œå‰çš„åˆå§‹åŒ–é˜¶æ®µå«å˜é‡å¯¹è±¡ï¼Œæ‰§è¡Œä¸­å°±å˜æˆäº†æ´»åŠ¨å¯¹è±¡ã€‚

AO = VO + function parameters + arguments

å½“JavaScriptå¼•æ“è§£æè„šæœ¬æ—¶ï¼Œå®ƒä¼šåœ¨é¢„ç¼–è¯‘æœŸå¯¹æ‰€æœ‰å£°æ˜çš„å˜é‡å’Œå‡½æ•°è¿›è¡Œå¤„ç†ã€‚å¹¶ä¸”æ˜¯å…ˆé¢„å£°æ˜å˜é‡ï¼Œå†é¢„å®šä¹‰å‡½æ•°ã€‚

åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒJavaScript å¼•æ“æ˜¯ä¸¥æ ¼æŒ‰ç€ä½œç”¨åŸŸæœºåˆ¶ï¼ˆscopeï¼‰æ¥æ‰§è¡Œçš„ï¼Œå¹¶ä¸” JavaScript çš„å˜é‡å’Œå‡½æ•°ä½œç”¨åŸŸæ˜¯åœ¨å®šä¹‰æ—¶å†³å®šçš„ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ—¶å†³å®šçš„ã€‚JavaScript ä¸­çš„å˜é‡ä½œç”¨åŸŸåœ¨å‡½æ•°ä½“å†…æœ‰æ•ˆï¼Œæ— å—ä½œç”¨åŸŸï¼›

å…¨å±€å¯¹è±¡(Global object) æ˜¯åœ¨è¿›å…¥ä»»ä½•æ‰§è¡Œä¸Šä¸‹æ–‡ä¹‹å‰å°±å·²ç»åˆ›å»ºäº†çš„å¯¹è±¡ã€‚

![a = 0 ä¸åº”ç§°ä¸ºå˜é‡](https://upload-images.jianshu.io/upload_images/5128488-ac41e3e5c493d5be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


<hr>

LexicalEnvironment
VariableEnvironment

1. æ³¨æ„ï¼š

JavaScript ä¸æ˜¯å…¨æ–‡ç¼–è¯‘å®Œå†æ‰§è¡Œï¼Œè€Œæ˜¯å—ç¼–è¯‘ï¼Œå³ä¸€ä¸ª script å—ä¸­é¢„ç¼–è¯‘ç„¶åæ‰§è¡Œï¼Œå†æŒ‰é¡ºåºé¢„ç¼–è¯‘ä¸‹ä¸€ä¸ª script å—å†æ‰§è¡Œã€‚ä½†æ˜¯æ­¤æ—¶ä¸Šä¸€ä¸ª script å—ä¸­çš„æ•°æ®éƒ½æ˜¯å¯ç”¨çš„ï¼Œè€Œä¸‹ä¸€ä¸ª script å—ä¸­çš„å‡½æ•°å’Œå˜é‡åˆ™æ˜¯ä¸å¯ç”¨çš„ã€‚

https://www.jianshu.com/p/bdf4b035c4a1

-->
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript è·å– URL å‚æ•°]]></title>
            <link>https://github.com/toFrankie/blog/issues/262</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/262</guid>
            <pubDate>Sun, 26 Feb 2023 12:09:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2ed97fec2d6273c0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2ed97fec2d6273c0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å‰é¢ä¼šä»‹ç»ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œè¯·å¿è€ä¸€ä¸‹ã€‚</p>
<h2>URIã€URLã€URN</h2>
<p>æåˆ°è¿™ä¸‰ä¸ªè´§ï¼Œå¾ªä¾‹ä¸¢ä¸€å¼ è¡¨å‡ºæ¥ï¼Œéº»çƒ¦ç”¨ä½™å…‰ä¸€æ‰«è€Œè¿‡å°±ç®—äº†ã€‚</p>
<table>
<thead>
<tr>
<th>ç®€ç§°</th>
<th>å…¨ç§°</th>
<th>ä¸­æ–‡åç§°</th>
</tr>
</thead>
<tbody>
<tr>
<td>URI</td>
<td>Universal Resource Identifier</td>
<td>ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦</td>
</tr>
<tr>
<td>URL</td>
<td>Universal Resource Locator</td>
<td>ç»Ÿä¸€èµ„æºå®šä½ç¬¦</td>
</tr>
<tr>
<td>URN</td>
<td>Universal Resource Name</td>
<td>ç»Ÿä¸€èµ„æºåç§°</td>
</tr>
</tbody>
</table>
<p>ç½‘ä¸Šå……æ–¥ç€ç±»ä¼¼ä¸Šé¢è¡¨æ ¼ä¸­çš„åè¯è§£é‡Šï¼Œè¿˜æœ‰è¯¸å¦‚ä»¥ä¸‹çš„è¨€è®ºï¼š</p>
<ul>
<li>URI åŒ…æ‹¬ URL å’Œ URNã€‚</li>
<li>URL å¯ä»¥æ˜¯ URIï¼Œä½† URI ä¸ä¸€å®šæ˜¯ URLï¼Œå®ƒå¯èƒ½æ˜¯ URNã€‚</li>
</ul>
<p>è¯´çœŸçš„ï¼Œè¿™äº›è§£é‡Šè¯´äº†è·Ÿæ²¡è¯´ä¸€æ ·ï¼Œæˆ‘ç›¸ä¿¡ 99% çš„äººéƒ½çŸ¥é“ä½†æ²¡ç”¨ã€‚è¿˜è®°å¾—æ­¤å‰å†™è¿‡ä¸€ç¯‡<a href="https://www.jianshu.com/p/04b3c0df1911">æ–‡ç« </a>ä»‹ç»ä¸‰è€…çš„å®šä¹‰åŠåŒºåˆ«ï¼Œç°åœ¨å†å›å¤´çœ‹æ„Ÿè§‰ç®€ç›´æ˜¯æµªè´¹æ—¶é—´äº†ã€‚</p>
<p>ä»¥ä¸‹è¿™å¥è¯ï¼Œä»æŸä¹çœ‹åˆ°çš„ï¼Œæˆ‘è§‰å¾—ç®€å•æ˜äº†ï¼š</p>
<blockquote>
<p>åŸæ¥ URI åŒ…æ‹¬ URL å’Œ URN ï¼Œåæ¥ URN æ²¡æµè¡Œèµ·æ¥ï¼Œå¯¼è‡´å‡ ä¹ç›®å‰æ‰€æœ‰çš„ URI éƒ½æ˜¯ URLã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œåœ¨ 99.9% çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ URI å…¨éƒ½æ˜¯ URLï¼Œæ²¡å¿…è¦ç†ä¼š URN äº†ã€‚<strong>è€Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„ Web åœ°å€ï¼ŒæŒ‡çš„å°±æ˜¯ URL</strong>ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Identifying_resources_on_the_Web">Identifying resources on the Web</a>ï¼‰ã€‚</p>
<h2>URL</h2>
<blockquote>
<p>ç”±äºæœ¬èŠ‚éƒ¨åˆ†å†…å®¹èŠ‚é€‰è‡ª <a href="https://github.com/nodejs/node/blob/master/doc/api/url.md">Node.js API ä¹‹ URL</a>ï¼Œå› æ­¤ä¼šå¤šäº†ä¸€äº›é¢å¤–çš„å†…å®¹ã€‚</p>
</blockquote>
<p>ç½‘å€å­—ç¬¦ä¸²æ˜¯åŒ…å«å¤šä¸ªæœ‰æ„ä¹‰ç»„ä»¶çš„ç»“æ„åŒ–å­—ç¬¦ä¸²ã€‚ ä¸‹é¢æä¾›äº† WHATWG å’Œ æ—§ç‰ˆ API ä¹‹é—´çš„æ¯”è¾ƒã€‚ åœ¨ç½‘å€ <code>'https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash'</code> ä¸Šæ–¹æ˜¾ç¤ºçš„æ˜¯ç”±æ—§ç‰ˆ <code>url.parse()</code> è¿”å›çš„å¯¹è±¡çš„å±æ€§ã€‚ ä¸‹æ–¹åˆ™æ˜¯ WHATWG <code>URL</code> å¯¹è±¡çš„å±æ€§ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-618f50f51daa965a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å›¾ä¸­ <code>&quot;&quot;</code> è¡Œä¸­çš„æ‰€æœ‰ç©ºæ ¼éƒ½åº”è¢«å¿½ç•¥ã€‚å®ƒä»¬çº¯ç²¹æ˜¯ä¸ºäº†æ ¼å¼åŒ–ã€‚</p>
<p>å¯¹äºæµè§ˆå™¨ï¼ˆå‰ç«¯ï¼‰è€Œè¨€ï¼Œæ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>åœ¨ Web æµè§ˆå™¨ä¸­åº”ä»¥ WHATWG ç½‘ç«™æ ‡å‡†ä¸ºå‡†ã€‚</li>
<li>WHATWG ç½‘å€çš„ <code>origin</code> å±æ€§åŒ…æ‹¬ <code>protocol</code> å’Œ <code>host</code>ï¼Œä½†ä¸åŒ…æ‹¬ <code>username</code> æˆ– <code>password</code>ã€‚</li>
<li>å…³äº <code>username</code> æˆ– <code>password</code> è™½ç„¶ä¸€äº›æµè§ˆå™¨å¯èƒ½ä»ç„¶æ”¯æŒå®ƒï¼Œä½†å®ƒå¯èƒ½å·²ç»ä»ç›¸å…³çš„ Web æ ‡å‡†ä¸­åˆ é™¤ï¼Œå¯èƒ½æ­£åœ¨è¢«åˆ é™¤ï¼Œæˆ–è€…å¯èƒ½åªæ˜¯ä¸ºäº†å…¼å®¹æ€§ç›®çš„è€Œä¿ç•™ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a50cbffcb34c86b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<!--
æºæ–‡ä»¶

```text
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                              href                                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ protocol â”‚  â”‚        auth         â”‚          host          â”‚           path            â”‚ hash  â”‚
    â”‚          â”‚  â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
    â”‚          â”‚  â”‚                     â”‚    hostname     â”‚ port â”‚ pathname â”‚     search     â”‚       â”‚
    â”‚          â”‚  â”‚                     â”‚                 â”‚      â”‚          â”œâ”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
    â”‚          â”‚  â”‚                     â”‚                 â”‚      â”‚          â”‚ â”‚    query     â”‚       â”‚
    "  https:   //    user   :   pass   @ sub.example.com : 8080   /p/a/t/h  ?  query=string   #hash "
    â”‚          â”‚  â”‚          â”‚          â”‚    hostname     â”‚ port â”‚          â”‚                â”‚       â”‚
    â”‚          â”‚  â”‚          â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¤          â”‚                â”‚       â”‚
    â”‚ protocol â”‚  â”‚ username â”‚ password â”‚          host          â”‚          â”‚                â”‚       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚                â”‚       â”‚
    â”‚   origin    â”‚                     â”‚         origin         â”‚ pathname â”‚     search     â”‚ hash  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                              href                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (All spaces in the "" line should be ignored. They are purely for formatting.)

```

```text

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                              href                                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   origin    â”‚                     â”‚         origin         â”‚ pathname â”‚     search     â”‚ hash  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚                â”‚       â”‚
    â”‚ protocol â”‚  â”‚ username â”‚ password â”‚          host          â”‚          â”‚                â”‚       â”‚
    â”‚          â”‚  â”‚          â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”‚          â”‚                â”‚       â”‚
    â”‚          â”‚  â”‚          â”‚          â”‚    hostname     â”‚ port â”‚          â”‚                â”‚       â”‚
    â”‚          â”‚  â”‚          â”‚          â”‚                 â”‚      â”‚          â”‚                â”‚       â”‚
    "  https:   //    user   :   pass   @ sub.example.com : 8080   /p/a/t/h    ?query=string   #hash "
    â”‚          â”‚  â”‚          â”‚          â”‚                 â”‚      â”‚          â”‚                â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
    (All spaces in the "" line should be ignored. They are purely for formatting.)

```
-->
<h2>ä¸‰ã€è·å– URL å‚æ•°</h2>
<p>å‰é¢é“ºå«äº†é‚£ä¹ˆå¤šï¼Œå…¶å®æœ¬æ–‡çš„è¯é¢˜æ˜¯è·å– URL ä¸Šçš„å‚æ•°ï¼Œä¸åºŸè¯äº†ã€‚</p>
<p>å‚æ•°é€šå¸¸å­˜åœ¨äº <code>window.location.search</code> å’Œ <code>window.location.hash</code> ä¸Šï¼Œè€ƒè™‘ä¸€äº›ç‰¹æ®Šæƒ…å†µå°±å¥½äº†ï¼š</p>
<pre><code class="language-js">const queryUrlValue = key =&gt; {
  if (!key) return ''

  // è€ƒè™‘åˆ° URL ä¸Šå­˜åœ¨ä¸­æ–‡ç¼–ç é—®é¢˜ï¼Œ
  // ä¾‹å¦‚ï¼šhttp%3A%2F%2Fui.cn%3F%E4%BD%9C%E8%80%85%3D%E8%B6%8A%E5%89%8D%E5%90%9B
  const url = decodeURIComponent(window.location.href)

  // åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
  const re = new RegExp(`[?|&amp;]${key}=([^&amp;]+)`, 'g')
  const matchResult = re.exec(url)
  if (!matchResult) return ''

  let value = matchResult[1]
  if (value.includes('#')) {
    // è€ƒè™‘åˆ°åŒ¹é…ç»“æœå¯èƒ½å« hash å€¼ï¼Œæ¯”å¦‚ï¼š
    // http://ui.cn?state=1#/mine
    // http://ui.cn?state=1/#/mine
    const separator = value.includes('/#') ? '/#' : '#'
    value = value.split(separator)[0]
  }

  return value
}
</code></pre>
<p>åˆ æ‰æ³¨é‡Šéƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const queryUrlValue = key =&gt; {
  if (!key) return ''

  const url = decodeURIComponent(window.location.href)
  const re = new RegExp(`[?|&amp;]${key}=([^&amp;]+)`, 'g')
  const matchResult = re.exec(url)

  if (!matchResult) return ''

  let value = matchResult[1]
  if (value.includes('#')) {
    const separator = value.includes('/#') ? '/#' : '#'
    value = value.split(separator)[0]
  }

  return value
}
</code></pre>
<p>å·²æ”¶å½•åœ¨ <a href="https://github.com/toFrankie/javascript-utils">toFrankie/javascript-utils</a>ï¼Œé‡Œé¢è¿˜æœ‰å…¶ä»–ä¸€äº›å®ç”¨çš„æ–¹æ³•å“¦ï¼</p>
<h2>æ›´æ–°ï¼ˆ2023.02.26ï¼‰</h2>
<p>éƒ½ 2023 å¹´äº†ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams">URLSearchParams</a> äº†ã€‚</p>
<pre><code class="language-js">// https://example.com/?name=Jonathan&amp;age=18
const params = new URLSearchParams(document.location.search.substring(1))
const name = params.get('name') // is the string &quot;Jonathan&quot;
const age = parseInt(params.get('age'), 10) // is the number 18
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Thunk å‡½æ•°ä¸ Generator å‡½æ•°]]></title>
            <link>https://github.com/toFrankie/blog/issues/261</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/261</guid>
            <pubDate>Sun, 26 Feb 2023 12:04:20 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7f3328e628c8518b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…³äº T]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7f3328e628c8518b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…³äº Thunk è¿™ä¸ªè¯ï¼Œå…¶å®ç¬¬ä¸€æ¬¡çœ‹åˆ°æ˜¯ <a href="https://github.com/reduxjs/redux-thunk">redux-thunk</a> åº“ã€‚è¿˜é•¿æ—¶é—´å†…éƒ½æ²¡æœ‰ç†è§£ â€œThunkâ€ æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå½“åˆæƒ³å¯èƒ½åªæ˜¯ç±»ä¼¼ Fooã€Bar ç­‰ï¼Œå°±ä¸€ä¸ªåç§°ç½¢äº†ã€‚</p>
<h3>ä¸€ã€Thunk</h3>
<p>æ—©åœ¨ä¸Šä¸–çºª 60 å¹´ä»£ Thunk å‡½æ•°å°±è¯ç”Ÿäº†ã€‚é‚£æ—¶å€™ï¼Œç¼–ç¨‹è¯­è¨€åˆšèµ·æ­¥ï¼Œè®¡ç®—æœºå­¦å®¶è¿˜åœ¨ç ”ç©¶ï¼Œç¼–è¯‘å™¨æ€ä¹ˆå†™æ¯”è¾ƒå¥½ã€‚å…¶ä¸­ä¸€ä¸ªäº‰è®ºçš„ç„¦ç‚¹æ˜¯**â€œæ±‚å€¼ç­–ç•¥â€**ï¼Œå³å‡½æ•°çš„å‚æ•°åˆ°åº•åº”ä½•æ—¶æ±‚å€¼ï¼Ÿ</p>
<p>å­˜åœ¨ä¸¤æ´¾æ„è§ï¼š</p>
<blockquote>
<ul>
<li><strong>ä¼ å€¼è°ƒç”¨</strong>ï¼ˆcall by valueï¼‰</li>
<li><strong>ä¼ åè°ƒç”¨</strong>ï¼ˆcall by nameï¼‰</li>
</ul>
</blockquote>
<p>æ¯”å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">var x = 1

function fn(m) {
  return m * 2
}

fn(x + 4)
</code></pre>
<p>å¯¹äº**â€œä¼ å€¼è°ƒç”¨â€**çš„è¯ï¼Œåœ¨è¿›å…¥å‡½æ•°ä½“ä¹‹å‰ï¼Œè®¡ç®— <code>x + 4</code> çš„å€¼ï¼ˆç­‰äº <code>5</code>ï¼‰ï¼Œå†å°†è¿™ä¸ªå€¼ä¼ å…¥å‡½æ•° <code>fn</code>ã€‚JavaScriptã€C è¯­è¨€å°±æ˜¯é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚</p>
<p>è‹¥å¯¹äº**â€œä¼ åè°ƒç”¨â€**çš„è¯ï¼Œç›´æ¥å°†è¡¨è¾¾å¼ <code>x + 4</code> ä¼ å…¥å‡½æ•°ä½“ï¼Œåªåœ¨ç”¨åˆ°å®ƒçš„æ—¶å€™æ±‚å€¼ã€‚Haskell è¯­è¨€é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚</p>
<p><strong>è‡³äºâ€œä¼ å€¼è°ƒç”¨â€å’Œâ€œä¼ åè°ƒç”¨â€ï¼Œå“ªä¸€ç§æ¯”è¾ƒå¥½ï¼Ÿ</strong></p>
<p>å›ç­”æ˜¯å„æœ‰åˆ©å¼Šã€‚ä¼ å€¼è°ƒç”¨æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹å‚æ•°æ±‚å€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ²¡ç”¨åˆ°è¿™ä¸ªå‚æ•°ï¼Œæœ‰å¯èƒ½é€ æˆæ€§èƒ½æŸå¤±ã€‚</p>
<pre><code class="language-js">var x = 5

function fn(m, n) {
  return n
}

fn(8 * x * x - 3 * x -1, x)
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå¦‚æœé‡‡ç”¨â€œä¼ å€¼è°ƒç”¨â€çš„ç­–ç•¥ï¼Œå‡½æ•° <code>fn</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯å‡½æ•°ä½“å†…æ ¹æœ¬æ²¡ç”¨åˆ°ï¼Œå¯¹è¿™ä¸ªå‚æ•°æ±‚å€¼ï¼Œå®é™…ä¸Šæ˜¯æ²¡å¿…è¦çš„ã€‚å› æ­¤ï¼Œæœ‰äº›è®¡ç®—æœºç§‘å­¦å®¶å€¾å‘äºâ€œä¼ åè°ƒç”¨â€ã€‚</p>
<h3>äºŒã€Thunk å‡½æ•°çš„å«ä¹‰</h3>
<p>ç¼–è¯‘å™¨çš„â€œä¼ åè°ƒç”¨â€å®ç°ï¼Œå¾€å¾€æ˜¯å°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å‡½æ•°ä¸­ï¼Œå†å°†è¿™ä¸ªä¸´æ—¶å‡½æ•°ä¼ å…¥å‡½æ•°ä½“ã€‚è¿™ä¸ªä¸´æ—¶å‡½æ•°å°±è¢«å«åš <strong>Thunk å‡½æ•°</strong>ã€‚</p>
<pre><code class="language-js">var x = 1
function fn(m) {
  return m * 2
}
fn(x + 4)

// ç›¸å½“äº
var thunk = function() {
  return x + 4
}
function fn(thunk) {
  return thunk() * 2
}
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡½æ•° <code>fn</code> çš„å‚æ•° <code>x + 4</code> è¢«ä¸€ä¸ªå‡½æ•°æ›¿æ¢äº†ã€‚å‡¡æ˜¯ç”¨åˆ°åŸå‚æ•°çš„åœ°æ–¹ï¼Œå¯¹äº Thunk å‡½æ•°æ±‚å€¼å³å¯ã€‚</p>
<p><strong>ä»¥ä¸‹è¿™ä¸ªæ˜¯æˆ‘çš„ç–‘é—®ï¼Ÿ</strong></p>
<p>å…¶å®æˆ‘è®¤ä¸ºï¼Œâ€œä¼ åè°ƒç”¨â€ä¹Ÿæ˜¯æœ‰æ€§èƒ½å½±å“çš„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">var x = 1
function fn(m) {
  return m * m * 2 // è¿™é‡Œæˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ï¼Œè°ƒç”¨ä¸¤æ¬¡å‚æ•° m
}
fn(x + 4)

// æŒ‰å‰é¢çš„å®šä¹‰ï¼Œè‡ªç„¶å°±å˜æˆå¦‚ä¸‹è¿™æ ·
var thunk = function() {
  return x + 4
}
function fn(thunk) {
  return thunk() * thunk() * 2 // æ‰§è¡Œäº†ä¸¤é thunk å‡½æ•°
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>fn</code> å‡½æ•°çš„å‚æ•° <code>m</code> è¢«ä¸æ­¢ä¸€æ¬¡åœ°ä½¿ç”¨ï¼Œé‚£ä¸æ˜¯ä¼šæ‰§è¡Œå¤šæ¬¡ <code>thunk</code> å‡½æ•°å—ï¼Ÿå¦‚æœè¿™æ ·åŒæ ·ä¼šæœ‰æ€§èƒ½é—®é¢˜å§ã€‚è¿˜æ˜¯è¯´ï¼Œä½¿ç”¨â€œä¼ åè°ƒç”¨â€çš„ç­–ç•¥çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å†…éƒ¨åœ¨ç¬¬ä¸€æ¬¡è®¡ç®—å¾—åˆ°ç»“æœåï¼Œä¼šè®°å½•èµ·æ¥ã€‚è‹¥å†æœ‰å¼•ç”¨ï¼Œç›´æ¥å–ä¸Šä¸€æ¬¡çš„è®¡ç®—ç»“æœï¼Œè€Œä¸æ˜¯é‡å¤æ‰§è¡Œ Thunk å‡½æ•°ï¼Ÿæ±‚è§£ï¼Œè°¢è°¢ï¼ï¼ï¼</p>
<h3>ä¸‰ã€JavaScript è¯­è¨€çš„ Thunk å‡½æ•°</h3>
<p><strong>JavaScript æ˜¯ä¼ å€¼è°ƒç”¨ï¼Œå®ƒçš„ Thunk å‡½æ•°å«ä¹‰æœ‰æ‰€ä¸åŒã€‚</strong></p>
<p>åœ¨ JavaScript è¯­è¨€ä¸­ï¼ŒThunk å‡½æ•°æ›¿æ¢çš„ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¤šå‚æ•°å‡½æ•°ï¼Œå°†å…¶æ›¿æ¢æˆä¸€ä¸ªåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°çš„å•å‚æ•°å‡½æ•°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Node.js ä¸­ <code>fs</code> æ¨¡å—çš„ <code>readFile</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°ã€‚</p>
<pre><code class="language-js">fs.readFile('data.json', {}, (err, data) =&gt; {
  // do something...
})
</code></pre>
<p>é‚£ä¹ˆ <code>Thunk</code> ç‰ˆçš„ <code>readFile</code> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function thunk(path, options) {
  return function (callback) {
    return fs.readFile(path, options, callback)
  }
}

var readFileThunk = thunk('data.json', {})
readFileThunk((err, data) =&gt; {
  // do something...
})
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç»è¿‡ <code>thunk</code> å‡½æ•°è½¬æ¢å¤„ç†ï¼Œå®ƒå˜æˆäº†å•ä¸€å‚æ•°å‡½æ•°ï¼Œåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ª <code>thunk</code> å‡½æ•°å°±è¢«å«åš Thunk å‡½æ•°ã€‚</p>
<p>ä»»ä½•å‡½æ•°ï¼Œåªè¦å‚æ•°æœ‰å›è°ƒå‡½æ•°ï¼Œå°±èƒ½å†™æˆ Thunk å‡½æ•°çš„å½¢å¼ã€‚</p>
<pre><code class="language-js">const thunk = function(fn) {
  return function(...args) {
    return function(callback) {
      fn.apply(this, ...args, callback)
    }
  }
}
</code></pre>
<p>ä½¿ç”¨ä¸Šé¢çš„è½¬æ¢å™¨ï¼Œç”Ÿæˆ <code>fs.readFile</code> çš„ Thunk å‡½æ•°ã€‚</p>
<pre><code class="language-js">const readFileThunk = thunk(fs.readFile)
readFileThunk('data.json', {})((err, data) =&gt; {
  // do something...
})
</code></pre>
<blockquote>
<p>çœ‹åˆ°è¿™é‡Œï¼Œè¿˜æ˜¯æ²¡æ‡‚è¿™ä¹ˆåšæ„ä¹‰åœ¨å“ªï¼Œæ„Ÿè§‰å¤šæ­¤ä¸€ä¸¾å¯¹å§ã€‚åº”ç”¨åœºæ™¯åé¢ä¼šè®²åˆ°ã€‚</p>
</blockquote>
<h3>å››ã€Thunkify æ¨¡å—</h3>
<p><a href="https://github.com/tj/node-thunkify"><code>thunkify</code></a> æ¨¡å—ï¼Œå°†å¸¸è§„ Node å‡½æ•°è½¬æ¢ä¸ºè¿”å› Thunk çš„å‡½æ•°ï¼Œè¿™å¯¹äºåŸºäºç”Ÿæˆå™¨çš„æµç¨‹æ§åˆ¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å°†å…¶åº”ç”¨äº <code>co</code>ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼éå¸¸åœ°ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ npm i thunkify
</code></pre>
<pre><code class="language-js">var thunkify = require('thunkify')
var fs = require('fs')
 
var read = thunkify(fs.readFile)
read('data.json', {})((err, data) =&gt; {
  // do something...
})
</code></pre>
<p>åŒæ · <code>thunkify</code> çš„<a href="https://github.com/tj/node-thunkify/blob/master/index.js">æºç </a>ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * Wrap a regular callback `fn` as a thunk.
 *
 * @param {Function} fn
 * @return {Function}
 * @api public
 */
function thunkify(fn) {
  return function () {
    var args = new Array(arguments.length);
    var ctx = this;

    for (var i = 0; i &lt; args.length; ++i) {
      args[i] = arguments[i];
    }

    return function (done) {
      var called;

      args.push(function () {
        if (called) return; // ç¡®ä¿å›è°ƒå‡½æ•° done åªä¼šæ‰§è¡Œä¸€é
        called = true;
        done.apply(null, arguments);
      });

      try {
        fn.apply(ctx, args);
      } catch (err) {
        done(err);
      }
    }
  }
};
</code></pre>
<p>æ€è·¯è·Ÿå‰é¢çš„å¤§è‡´ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå®ƒé’ˆå¯¹å›è°ƒå‡½æ•°å¤šäº†ä¸€ä¸ªæ£€æŸ¥æœºåˆ¶ï¼Œç¡®ä¿å›è°ƒå‡½æ•°ï¼ˆå³æºç ä¸­çš„ <code>done</code>ï¼‰æœ€å¤šåªä¼šæ‰§è¡Œä¸€éã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-js">function fn(x, y, cb) {
  const sum = x + y
  cb(sum)
  cb(sum)
}

const testThunk = thunkify(fn)
testThunk(1, 2)(sum =&gt; {
  console.log(sum) // 3ï¼Œä¸”åªä¼šæ‰“å°ä¸€æ¬¡
})
</code></pre>
<blockquote>
<p>è¿™ä¸ªæ£€æŸ¥æœºåˆ¶ï¼Œåƒç»™å‰é¢æå‡ºçš„å…³äºâ€œä¼ åè°ƒç”¨â€å¯èƒ½å­˜åœ¨æ€§èƒ½æŸè€—é—®é¢˜ï¼Œæä¾›äº†ä¸€ç§æ€è·¯ã€‚ä½†åœ¨ JavaScript ä¸­ Thunk çš„ç†è§£ï¼Œè·Ÿå¼€å¤´æåˆ°çš„ Thunk å‡½æ•°æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæ‰€ä»¥ç–‘é—®ç‚¹è¿˜åœ¨ï¼</p>
</blockquote>
<h3>äº”ã€Generator ä¸ Thunk</h3>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ Generator å‡½æ•°ï¼Œéœ€è¦è‡ªå·±å®ç°æ‰§è¡Œå™¨ï¼Œè‡ªåŠ¨å»æ‰§è¡Œç”Ÿæˆå™¨ã€‚</p>
<p>åœ¨æˆ‘è®¤ä¸º Generator å‡½æ•°ï¼Œä¸»è¦ç”¨é€”æ˜¯è‡ªå®šä¹‰è¿­ä»£å™¨ã€å¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨æˆ‘å°è±¡ä¸­ï¼Œå®é™…é¡¹ç›®é‡Œå‡ ä¹æ²¡é‡åˆ°éœ€è¦è‡ªå®šä¹‰è¿­ä»£å™¨çš„ã€‚è·Ÿå¤šçš„æ˜¯å¼‚æ­¥ç¼–ç¨‹ä¸­ç”¨åˆ° Generator å‡½æ•°å»æ§åˆ¶ã€‚</p>
<blockquote>
<p>ä½†åé¢ ES2017 æ ‡å‡†ä¸­ï¼Œåˆå¼•å…¥äº†è¯­æ³•ã€è¯­ä¹‰æ›´å¥½çš„ Async/Awaitï¼Œä½†å°½ç®¡å¦‚æ­¤ï¼Œä¹Ÿä¸å½±å“ Generator çš„å¼ºå¤§å’Œé‡è¦æ€§ã€‚å› ä¸º Async å‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–è€Œå·²ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<pre><code class="language-js">const thunkify = require('thunkify')
const fs = require('fs')
const readFileThunk = thunkify(fs.readFile)

function* generatorFn() {
  const data1 = yield readFileThunk('./js/data.json', 'utf-8')
  console.log('data1', data1)
  const data2 = yield readFileThunk('./js/data.json', 'utf-8')
  console.log('data2', data2)
}
</code></pre>
<p>åˆ©ç”¨ Thunk å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€ä¸ª Generator æ‰§è¡Œå™¨äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function runAuto(genFn) {
  const gen = genFn()
  const step = iteratorResult =&gt; {
    const { done, value } = iteratorResult

    if (done) return

    // iteratorResult.value å°±æ˜¯ Thunk å‡½æ•°ï¼Œ
    // å³ readFileThunk('data.json', 'utf-8') è¿”å›å€¼ï¼Œå®ƒè¿”å›ä¸€ä¸ª Thunk å‡½æ•°ã€‚
    value((err, data) =&gt; {
      // åªè¦åœ¨å…¶å›è°ƒä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œå°±èƒ½è¾¾åˆ°æŒ‰â€œé¡ºåºâ€æ‰§è¡Œçš„æ•ˆæœï¼Œ
      // ä¸ºäº†ä½¿ yield å¾—åˆ°å¯¹åº”çš„å€¼ï¼Œéœ€è¦åœ¨ next æ–¹æ³•ä¸­ä¼ å…¥ dataã€‚
      step(gen.next(data))
    })
  }

  step(gen.next())
  // æ³¨æ„ï¼Œè‹¥ Generator å‡½æ•°ä¸­å­˜åœ¨å¼‚æ­¥æ“ä½œæ˜¯ä¸èƒ½ä½¿ç”¨ç±»ä¼¼ while ç­‰è¯­å¥å»è¿­ä»£å…¶å®ä¾‹çš„ï¼Œ
  // ä¾‹å¦‚æœ¬å®ä¾‹ä¸­ï¼Œè‹¥ä½¿ç”¨ while è¯­å¥å°±ä¼šä¸æ–­åœ°è°ƒç”¨ fs.readFile è¯»å–æ–‡ä»¶ï¼Œå¯¼è‡´æŠ¥é”™ï¼
}
</code></pre>
<p>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">runAuto(generatorFn)
// ä¾æ¬¡æ‰“å°å‡º
// data1 &quot;data.json's value&quot;
// data2 &quot;data.json's value&quot;
</code></pre>
<p>ä¸€èˆ¬å‡½æ•°å†…å«æœ‰ <code>yield</code> å…³é”®å­—è¡¨ç¤ºå«æœ‰å¼‚æ­¥æ“ä½œï¼Œç¤ºä¾‹ä¸­ <code>readFileThunk</code> å°±æ˜¯å¼‚æ­¥æ“ä½œã€‚è‹¥ä¸€ä¸ªå‡½æ•°å†…æ²¡æœ‰å¼‚æ­¥æ“ä½œï¼Œæ²¡å¿…è¦ç”¨ <code>yield</code> è¡¨è¾¾å¼ï¼Œæ›´æ²¡å¿…è¦ä½¿ç”¨ Generator å‡½æ•°ï¼ˆè‡ªå®šä¹‰è¿­ä»£å™¨é™¤å¤–ï¼‰ã€‚</p>
<p>Thunk å‡½æ•°ä¸ Generator èƒ½è”ç³»åœ¨ä¸€èµ·çš„æŒˆæœºï¼Œå°±æ˜¯å› ä¸º Thunk å‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚åˆšå¥½ Generator å‡½æ•°æŸä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœä¸å¾€åçš„ä»£ç æœ‰å…³è”ï¼Œéœ€è¦åœ¨å¼‚æ­¥æ“ä½œçš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œç”Ÿæˆå™¨çš„ <code>next()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆ <code>yield</code> å…³é”®å­—åé¢è·Ÿç€ä¸€ä¸ª Thunk å‡½æ•°ï¼Œå°±èƒ½è¾¾åˆ°æŒ‰ç¼–å†™â€œé¡ºåºâ€å»æ‰§è¡Œä»£ç çš„æ•ˆæœäº†ã€‚</p>
<p>å‰é¢çš„ <code>runAuto</code> æ–¹æ³•è¿˜æœ‰å†ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">function runAuto(genFn) {
  const gen = genFn()

  const step = (err, data) =&gt; {
    const { done, value } = gen.next(data)

    if (done) return

    // æ€•æœ‰äººä¸ç†è§£ï¼Œè¯´æ˜ä¸€ä¸‹ï¼š
    // æ³¨æ„ value å°±æ˜¯ä¸€ä¸ª Thunk å‡½æ•°ï¼Œå³å‰é¢çš„ readFileThunk()ï¼Œ
    // å®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠ step ä¼ è¿›å»å°±å¥½äº†ã€‚
    value(step)
  }

  step()
}

// è¿™é‡Œæ²¡æœ‰å»æ•è· Generator å†…éƒ¨çš„å¼‚å¸¸å“ˆï¼Œ
// è‹¥æœ‰éœ€è¦åœ¨ step å†…éƒ¨ä½¿ç”¨ try...catch æ•è·ï¼Œ
// å¹¶ä½¿ç”¨ gen.throw() æŠ›å‡ºå¯¹åº”åŸå› å³å¯ã€‚
</code></pre>
<blockquote>
<p>âš ï¸ è¯·æ³¨æ„ï¼Œå¦‚æœæŒ‰ç…§ä¸Šè¿° <code>runAuto</code> å»è¿­ä»£ Generator å‡½æ•°ï¼Œå…¶å‡½æ•°ä½“å†…çš„ <code>yield</code> å…³é”®å­—åé¢å¿…é¡»æ˜¯ Thunk å‡½æ•°ã€‚å¦åˆ™å°†å¯èƒ½ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<p><code>thunkify</code> æ¨¡å—çš„ä½œè€… TJ Holowaychuk å¼€æºäº†å¦ä¸€æ¨¡å—ï¼š <a href="https://github.com/tj/co#readme"><code>co</code></a>ã€‚å®ƒå…è®¸ <code>yield</code> åé¢è·Ÿç€ä¸€ä¸ª Thunk å‡½æ•°æˆ–è€…æ˜¯ <code>Promise</code> å¯¹è±¡ã€‚å› ä¸ºä¸¤ç§æ€è·¯æ˜¯ç›¸ä¼¼çš„ï¼ŒThunk æ˜¯åˆ©ç”¨å…¶å›åˆ°ï¼Œè€Œ <code>Promise</code> å¯¹è±¡åˆ™æ˜¯åˆ©ç”¨äº†å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¼šè§¦å‘ <code>then</code> æˆ– <code>catch</code> æ–¹æ³•çš„æœºåˆ¶ã€‚</p>
<p>å¦‚æœä½¿ç”¨ <code>co</code> æ¨¡å—ï¼Œå¯ä»¥è¿™æ ·ç”¨ï¼š</p>
<pre><code class="language-shell">$ npm i co
</code></pre>
<pre><code class="language-js">const fs = require('fs')
const co = require('co')
const thunkify = require('thunkify')
const readFileThunk = thunkify(fs.readFile)

function* generatorFn() {
  const data1 = yield readFileThunk('./js/data.json', 'utf-8')
  console.log('data1', data1)
  const data2 = yield readFileThunk('./js/data.json', 'utf-8')
  console.log('data2', data2)
}

co(generatorFn)

// ä¾æ¬¡æ‰“å°å‡º
// data1 &quot;data.json's value&quot;
// data2 &quot;data.json's value&quot;
</code></pre>
<p>æ³¨æ„ï¼Œä½¿ç”¨ <code>co</code> åŒ…è£…çš„ Generator å‡½æ•°çš„ yield è¡¨è¾¾å¼æ¥å— <strong>Thunk å‡½æ•°</strong>æˆ– <strong><code>Promise</code> å¯¹è±¡</strong>ã€‚å½“ä½¿ç”¨ <code>Promise</code> å¯¹è±¡çš„å½¢å¼ï¼Œ<code>co</code> å°±å……å½“äº†ç±»ä¼¼ Async å‡½æ•°å†…éƒ¨æ‰§è¡Œå™¨çš„è§’è‰²ã€‚</p>
<p>åæ­£è‡ªä» Async/Await é¢ä¸–ä¹‹åï¼Œæˆ‘æ¥è§¦åˆ°çš„é¡¹ç›®ï¼Œå‡ ä¹æ²¡æœ‰äººä½¿ç”¨ Generator å‡½æ•°å»å°è£…å¼‚æ­¥æµç¨‹äº†ï¼Œéƒ½æ˜¯å…¨é¢æ‹¥æŠ¤ Async äº†ã€‚æˆ‘çŒœè¿™ä¸ªæ˜¯ä¸æ˜¯ <code>co</code> ä¸å†æ›´æ–°çš„åŸå› ï¼Œæ˜¯ä¸æ˜¯å®ƒçš„ä½¿å‘½å®Œæˆäº†ï¼Œå“ˆå“ˆã€‚</p>
<p>è‡³äº Async å‡½æ•°å†…éƒ¨æ‰§è¡Œå™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œç»“åˆä¸Šé¢çš„ <code>runAuto</code> æ–¹æ³•ï¼Œå†åŠ¨ä¸‹è„‘å­å°±åº”è¯¥èƒ½å¤§è‡´æƒ³åˆ°äº†ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹æˆ‘çš„å¦å¤–ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/259">æ–‡ç« </a>ï¼Œæ–‡ä¸­æœ«å°¾æœ‰ä»‹ç»ã€‚</p>
<p>æœ¬æ–‡åˆ°è¿™é‡Œï¼Œå¥½åƒå°±è¦å®Œäº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº Awaitã€Promise æ‰§è¡Œé¡ºåºå·®å¼‚é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/260</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/260</guid>
            <pubDate>Sun, 26 Feb 2023 12:02:42 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2579b46ceb6de72c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2579b46ceb6de72c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>ç¼˜èµ·ã€Š<a href="https://segmentfault.com/a/1190000017224799">8 å¼ å›¾å¸®ä½ ä¸€æ­¥æ­¥çœ‹æ¸… async/await å’Œ promise çš„æ‰§è¡Œé¡ºåº</a>ã€‹ä¸€æ–‡æ‰€æŠ›å‡ºçš„è¯é¢˜ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è€ƒå¯Ÿæ˜¯å¦å®Œå…¨æŒæ¡äº† JavaScript çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ç½¢äº†ã€‚</p>
<blockquote>
<p>ä¸åŒå®¿ä¸»ç¯å¢ƒï¼ˆæ¯”å¦‚æµè§ˆå™¨ã€Nodeï¼‰ï¼ŒJS çš„äº‹ä»¶å¾ªç¯ä¼šç¨æœ‰ä¸åŒã€‚æœ¬æ–‡åŸºäºæµè§ˆå™¨ç¯å¢ƒå±•å¼€è®¨è®ºã€‚</p>
</blockquote>
<p>å‰é¢æ–‡ç« æœ«å°¾æˆ–è¯„è®ºåŒºæåˆ°çš„ï¼ŒåŒæ ·ä¸€æ®µä»£ç åœ¨ä¸åŒæµè§ˆå™¨ã€æˆ–åŒä¸€æµè§ˆå™¨çš„ä¸åŒç‰ˆæœ¬ï¼Œæ‰§è¡Œé¡ºåºå­˜åœ¨å·®å¼‚ï¼ˆä»£ç å°±ä¸è´´ä¸Šæ¥äº†ï¼‰ã€‚</p>
<p>æœ¬äººäº²æµ‹ç»“æœï¼Œåœ¨ <strong>Chrome 92</strong> å’Œ <strong>Safari 14.1.2</strong> æ‰§è¡Œé¡ºåºä»æœ‰å·®å¼‚ï¼ˆ2021.08ï¼‰ã€‚</p>
<p>è¿™ç§å·®å¼‚ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p>
<ul>
<li>å®é™…åº”ç”¨åœºæ™¯å‡ ä¹æ²¡æœ‰å½±å“ã€‚å¦‚æœæœ‰äººåœ¨é¡¹ç›®ä¸­å†™å‡ºè¿™æ ·çš„ä»£ç ï¼Œä½ å¯ä»¥å»å¹²ä»–äº†ã€‚è¯·ä¸è¦è¿‡åˆ†ä¾èµ–å¼‚æ­¥æ“ä½œçš„é¡ºåºã€‚</li>
<li><strong>ä¸€èˆ¬æ¥è¯´ï¼Œè‹¥å†é‡åˆ° JavaScript è¿è¡Œæ–¹é¢çš„å·®å¼‚ï¼Œåº”ä»¥æœ€æ–° Chrome æµè§ˆå™¨çš„è¡Œä¸ºä¸ºå‡†</strong>ï¼ˆè·Ÿ Chrome æµè§ˆå™¨çš„ V8 å¼•æ“æ›´æ–°ç­–ç•¥æœ‰å…³ï¼‰ã€‚</li>
</ul>
<h2>æ‰¾åŸå› </h2>
<p>æœ¬ç€å¯»æ ¹é—®åº•å»æ‰¾ç­”æ¡ˆã€‚</p>
<p>é˜…è¯» ECMAScript æ ‡å‡†æ˜¯æœ€ç›´æ¥ã€æœ€æƒå¨çš„ï¼ˆ<a href="https://262.ecma-international.org/#await">Await</a>ï¼‰ã€‚ä½†ç”±äºåŠŸåŠ›ä¸å¤Ÿï¼Œæ²¡åŠæ³•å®Œå…¨çœ‹æ‡‚ã€‚äºæ˜¯æœäº†å¥½ä¹…ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ä¸ªç›¸å…³çš„é—®é¢˜ï¼š</p>
<ul>
<li><a href="https://www.zhihu.com/question/268007969">async/await åœ¨ Chrome ç¯å¢ƒå’Œ Node ç¯å¢ƒçš„æ‰§è¡Œç»“æœä¸ä¸€è‡´ï¼Œæ±‚è§£ï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/268007969/answer/339811998">è´ºè€å›ç­”</a></li>
</ul>
<p>è¯¥é—®é¢˜ä¸­çš„ç¤ºä¾‹ï¼ˆç•¥å¾®ä¿®æ”¹ï¼‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">async function foo() {
  console.log('a')
  await bar()
  console.log('b')
}

async function bar() {
  console.log('c')
}

foo()

new Promise(resolve =&gt; {
  console.log('d')
  resolve()
}).then(() =&gt; {
  console.log('e')
})
</code></pre>
<p>ç›¸ä¿¡å¾ˆå¤šåŒå­¦ä¸€ä¸‹å°±å†™å‡ºäº†â€œ<strong>æ­£ç¡®</strong>â€çš„æ‰“å°é¡ºåºï¼š<code>aã€cã€dã€bã€e</code>ã€‚</p>
<p>æˆ‘ä»¬æ‰§è¡Œä»£ç å¹¶æ‰“å°å‡ºæ¥çœ‹ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e912814033b6b38b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Chrome 92"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-547d753d970cfb5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Safari 14.1.2"></p>
<p><strong>å¯¹æ¯”å‘ç°ï¼Œä¸åŒæµè§ˆå™¨ä¸‹è¿è¡Œç»“æœç«Ÿç„¶ä¸ä¸€æ ·ï¼ŒWhy?</strong></p>
<ul>
<li>æœ€æ–°ç‰ˆ Chrome æµè§ˆå™¨æ‰“å°ç»“æœä¸ºï¼š<code>aã€cã€dã€bã€e</code>ã€‚</li>
<li>æœ€æ–°ç‰ˆ Safari æµè§ˆå™¨æ‰“å°ç»“æœä¸ºï¼š<code>aã€cã€dã€eã€b</code>ã€‚</li>
<li>åœ¨ Node 14.16.0 ç¯å¢ƒä¸‹ï¼Œè¿è¡Œç»“æœåŒ Chrome æµè§ˆå™¨ã€‚</li>
</ul>
<p>é€ æˆä»¥ä¸Šå·®å¼‚çš„æ ¹æœ¬åŸå› æ˜¯ï¼ŒECMAScript å°± Await æ ‡å‡†æœ‰æ‰€è°ƒæ•´ï¼Œæœ€æ–°è§„å®šæ˜¯ <code>await</code> å°†ç›´æ¥ä½¿ç”¨ <code>Promise.resolve()</code> ç›¸åŒçš„è¯­ä¹‰ã€‚æ­£æ˜¯å› ä¸ºæ­¤æ¬¡è°ƒæ•´ï¼Œå¯¼è‡´äº†ä¸åŒ JS å¼•æ“æˆ–è€…åŒä¸€ JS å¼•æ“çš„ä¸åŒç‰ˆæœ¬ï¼Œåœ¨è§£æåŒä¸€è„šæœ¬ä¼šå‡ºç°ç»“æœçš„å·®å¼‚ã€‚</p>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ <code>await bar()</code> çš„è®¡ç®—ç»“æœï¼ˆæŒ‡ <code>bar()</code> è¿”å›å€¼ï¼‰å°±æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ã€‚æ ¹æ® <code>Promise.resolve()</code> çš„è¯­æ³•ï¼Œè‹¥å‚æ•°æ˜¯ä¸€ä¸ª <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œå°†ä¼šä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¯¥å®ä¾‹ã€‚</p>
<pre><code class="language-js">const p1 = new Promise(resolve =&gt; resolve(1))
const p2 = Promise.resolve(p1)
console.log(p1 === p2) // true
// âš ï¸ æ³¨æ„ï¼Œå…³äº Promise.resolve() åœ¨ Chrome ä¸ Safari è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚
</code></pre>
<blockquote>
<p>å…¶å®æ— éœ€è¿‡åˆ†æ‹…å¿ƒè¿™ç§å·®å¼‚ï¼Œå¯¹å¹³æ—¶å†™é¡¹ç›®æœ‰ä»€ä¹ˆå½±å“ï¼Œå¦‚æœåœ¨çœŸæ­£é¡¹ç›®å†™å‡ºç±»ä¼¼çš„é€»è¾‘ï¼Œç¡®å®è¯¥åæ€ä¸€ä¸‹ã€‚ä½†æ˜¯......é¢è¯•å®˜å¯èƒ½ä¼šé—®å“¦ï¼Œå‰é¢æ–‡ç« æåˆ°çš„é‚£é“é¢˜å¥½åƒå°±æ˜¯å¤´æ¡çš„é¢è¯•é¢˜ã€‚</p>
</blockquote>
<h2>åŸå› å‰–æ</h2>
<p>è¿™ç§å·®å¼‚ï¼Œæ˜¯ JavaScript å¼•æ“åœ¨å®ç°æ—¶æ²¡æœ‰ä¸¥æ ¼éµå¾ª ECMAScript æ ‡å‡†å¯¼è‡´çš„ã€‚</p>
<p>å…ˆæ˜ç¡®å‡ ç‚¹ï¼š</p>
<ul>
<li><code>Promise</code> å¯¹è±¡çš„æ„é€ æ–¹æ³•å†…å±äºåŒæ­¥ä»»åŠ¡ï¼Œè€Œ <code>Promise.prototype.then()</code> æ‰å±äºå¼‚æ­¥ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ï¼Œå®ƒçš„æ‰§è¡Œé¡ºåºåäºåŒæ­¥ä»»åŠ¡ï¼‰</li>
<li><code>Promise.resolve()</code> æ–¹æ³•ï¼Œè‹¥å‚æ•°ä¸º <code>Promise</code> å¯¹è±¡ï¼Œå°†ä¼šç›´æ¥è¿”å›è¯¥å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„ <code>Promise</code> å¯¹è±¡ã€‚</li>
<li>åªæœ‰å½“ <code>Promise</code> å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰ä¼šè¢«æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
</ul>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ <code>a</code>ã€<code>c</code>ã€<code>d</code> çš„é¡ºåºéƒ½æ²¡æœ‰äº‰è®®ï¼Œå› æ­¤æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// å…¶ä¸­ p1ã€p2 éƒ½æ˜¯çŠ¶æ€ä¸º fulfilled çš„ Promise å¯¹è±¡
async function foo() {
  await p1
  console.log('b')
}

foo()

p2.then(() =&gt; {
  console.log('e')
})
</code></pre>
<p>å…³é”®ç‚¹åœ¨äº <code>await p1</code> çš„è¯­ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠï¼š</p>
<pre><code class="language-js">async function foo() {
  await p1
  console.log('b')
}
</code></pre>
<p>ç†è§£ä¸ºï¼š</p>
<pre><code class="language-js">function foo() {
  return RESOLVE(p1).then(() =&gt; {
    console.log('b')
  })
}
</code></pre>
<p>æŒ‰ç›®å‰çš„æ ‡å‡†å®šä¹‰ <code>RESOLVE(p1)</code> ç­‰åŒäº <code>Promise.resolve(p1)</code>ï¼Œå› æ­¤ <code>RESOLVE(p1)</code> ç»“æœå°±æ˜¯ <code>p1</code>ã€‚æ ¹æ®ä»£ç é€»è¾‘å¯çŸ¥ <code>p1</code> æ¯” <code>p2</code> æ›´æ—©åœ°æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æœ¬ç€å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œä¼šå…ˆæ‰§è¡Œå¾®ä»»åŠ¡ <code>p1</code>ï¼Œåæ‰§è¡Œå¾®ä»»åŠ¡ <code>p2</code>ï¼Œå› æ­¤å…ˆåæ‰“å°å‡º <code>b</code>ã€<code>e</code>ã€‚</p>
<p>ä½†æ˜¯æ—§ç‰ˆçš„ JS å¼•æ“åœ¨å®ç° <code>RESOLVE(p1)</code> çš„é—®é¢˜ä¸Šï¼Œä¸å½“å‰æ ‡å‡†æœ‰å¾®å¦™è€Œé‡è¦çš„åŒºåˆ«ã€‚åŒºåˆ«åœ¨äºï¼Œå³ä½¿ <code>p1</code> æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œ<code>RESOLVE(p1)</code> ä»ä¼šè¿”å›ä¸€ä¸ª<strong>å…¨æ–°</strong>çš„ <code>Promise</code> å¯¹è±¡ï¼ˆå‡è®¾ä¸º <code>p3</code>ï¼‰ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ‰§è¡Œ <code>p1.then()</code> æ—¶ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªå¾®ä»»åŠ¡ <code>p3</code>ï¼Œå¹¶æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿˜æ˜¯æœ¬ç€å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œæ¥ç€æ‰§è¡Œå¾®ä»»åŠ¡ <code>p2</code> å¹¶æ‰“å° <code>e</code>ã€‚ç­‰ <code>p2</code> æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€æ‰§è¡Œå¾®ä»»åŠ¡ <code>p3</code>ï¼Œç„¶åæ‰“å°å‡º <code>b</code>ã€‚å› æ­¤å…ˆåé¡ºåºæ˜¯ <code>e</code>ã€<code>b</code>ã€‚</p>
<pre><code class="language-js">function foo() {
  return RESOLVE(p1).then(() =&gt; {
    console.log('b')
  })
}

// ç›¸å½“äº
function foo() {
  return new Promise(resolve =&gt; resolve(p1)) // ç›¸å½“äºå¾®ä»»åŠ¡ p1
    .then(() =&gt; { // ç›¸å½“äºå¾®ä»»åŠ¡ p3
      console.log('b')
    })
}
</code></pre>
<blockquote>
<p>è™½ç„¶æˆ‘è®¤ä¸ºè‡ªå·±æ‡‚ Async å†…éƒ¨æ‰§è¡Œå™¨çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘è‡ªè®¤ä¸ºå¯¹æœ¬æ¡ˆä¾‹è§£é‡Šå¾—ä¸å¤Ÿå¥½ã€‚å°±æ˜¯é‚£ç§â€œæ‡‚ä½†ä¸çŸ¥é“æ€ä¹ˆè¡¨è¾¾å‡ºæ¥â€çš„æ„Ÿè§‰ã€‚å¦‚æœçœ‹æ‡µäº†çš„è¯ï¼Œå»ºè®®ç›´æ¥çœ‹è´ºè€çš„<a href="https://www.zhihu.com/question/268007969/answer/339811998">å›ç­”</a>ã€‚</p>
</blockquote>
<h2>ç»“è®º</h2>
<p>ç»¼ä¸Šï¼Œä¸åŒæµè§ˆå™¨ä¸‹æ‰§è¡Œé¡ºåºä¸ä¸€æ ·ï¼Œåº”è¯¥å°±æ˜¯ JS å¼•æ“ï¼ˆå…¶ä¸­ Chromeã€Node æ˜¯ V8 å¼•æ“ï¼Œè€Œ Safari æ˜¯ JavaScriptCore å¼•æ“ã€‚ï¼‰åº•å±‚å®ç° <code>await</code> è¯­æ³•çš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚è‹¥ä¸¥æ ¼éµå¾ª ECMAScript æ ‡å‡†çš„è¯ï¼Œ æ‰§è¡Œç»“æœä¸æœ€æ–°çš„ Chrome æµè§ˆå™¨åº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å‰é¢æåˆ°è‹¥æœ‰å·®å¼‚ï¼Œä¸€èˆ¬ä»¥æœ€æ–°ç‰ˆæœ¬çš„ Chrome ä¸ºå‡†ï¼ŒåŸå› æ˜¯ï¼šChrome æµè§ˆå™¨æ¯æ¬¡å‡çº§éƒ½ä¼šåŒæ—¶æ›´æ–°åˆ° V8 çš„æœ€æ–°ç‰ˆã€‚è€Œ Node æ›´æ–°å°ç‰ˆæœ¬æ—¶ï¼ŒV8 ä¹Ÿåªæ›´æ–°å°ç‰ˆæœ¬ï¼Œåªæœ‰ Node æ›´æ–°å¤§ç‰ˆæœ¬æ—¶æ‰ä¼šæ›´æ–° V8 å¤§ç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œç»å¤§éƒ¨åˆ†æ—¶å€™ Node çš„ V8 ä¼šæ¯”åŒæ—¶æœŸçš„ Chrome çš„ V8 è¦è½åã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://segmentfault.com/q/1010000016147496">async await å’Œ promise å¾®ä»»åŠ¡æ‰§è¡Œé¡ºåºé—®é¢˜</a></li>
<li><a href="https://www.zhihu.com/question/268007969/answer/339811998">async/await åœ¨ Chrome ç¯å¢ƒå’Œ Node ç¯å¢ƒçš„æ‰§è¡Œç»“æœä¸ä¸€è‡´ï¼Œæ±‚è§£ï¼Ÿ</a></li>
<li><a href="https://v8.dev/blog/fast-async">Faster async functions and promises</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | async/await]]></title>
            <link>https://github.com/toFrankie/blog/issues/259</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/259</guid>
            <pubDate>Sun, 26 Feb 2023 11:59:49 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2f4b4b5a3e9580c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2f4b4b5a3e9580c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨<a href="https://github.com/toFrankie/blog/issues/258">å‰ä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæœ€åæåˆ° Generator çš„åº”ç”¨ï¼Œå¾ˆå®é™…åœºæ™¯å¯èƒ½éœ€è¦è‡ªå®ç°ä¸€ä¸ª Generator å‡½æ•°æ‰§è¡Œå™¨ã€‚å› æ­¤ï¼Œç”¨èµ·æ¥è¿˜æ˜¯å¾ˆéº»çƒ¦çš„ã€‚</p>
<p>ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªæ›¿ä»£æ–¹æ³•ï¼Œé‚£å°±æ˜¯ ES7 æ ‡å‡†ä¸­å¼•å…¥çš„ async å‡½æ•°ï¼Œå®ƒä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p>Async å‡½æ•°ï¼Œå…¶å®å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p>
<h3>ä¸€ã€è¯­æ³•</h3>
<p>å®šä¹‰ä¸€ä¸ª Async å‡½æ•°è¯­æ³•éå¸¸ç®€å•ï¼Œåœ¨å‡½æ•°åç§°ä¹‹å‰åŠ ä¸Š <code>async</code> å…³é”®å­—å³å¯ã€‚</p>
<pre><code class="language-js">async function foo {
  // å†…éƒ¨çš„ await è¯­å¥æ˜¯å¯é€‰çš„
}

// âš ï¸ Async å‡½æ•°æ³¨æ„ç‚¹ï¼š
// 1. å‡½æ•°ä½“å†…éƒ¨çš„ await è¯­å¥æ˜¯å¯é€‰çš„ï¼›
// 2. å½“å†…éƒ¨å«æœ‰ await è¯­å¥æ—¶ï¼Œè¡¨ç¤ºæœ‰å¼‚æ­¥æ“ä½œï¼›
// 3. é’ˆå¯¹ç±»ä¼¼ let a = await 1 çš„è¯­å¥ï¼Œè¯­æ³•ä¸Šæ˜¯å…è®¸çš„ï¼Œä½†è¿™é‡Œä½¿ç”¨ await æ˜¯æ— æ„ä¹‰çš„ï¼›
// 4. é’ˆå¯¹åŒæ­¥ä»£ç ï¼Œåªè¦ç±»ä¼¼ let a = 1 è¿™æ ·å†™å³å¯ï¼Œæ— éœ€ä½¿ç”¨ await å…³é”®å­—ã€‚
</code></pre>
<p>ä¹Ÿå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼å»å®šä¹‰ï¼š</p>
<pre><code class="language-js">// å‡½æ•°å£°æ˜å½¢å¼
async function foo {}

// å‡½æ•°è¡¨è¾¾å¼å½¢å¼ï¼ˆåŒ¿åæˆ–å…·åå‡å¯ï¼‰
const bar = async function () {}

// ç®­å¤´å‡½æ•°å½¢å¼
const baz = async () =&gt; {}

// Class çš„æ–¹æ³•
class Foo {
  async sayHi() {}
  getName = async () =&gt; {}
  // è¯­æ³•æ²¡é—®é¢˜ï¼Œä½†ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼š
  // sayHi æ–¹æ³•æŒ‚è½½åˆ° Foo åŸå‹ä¸Šï¼Œè€Œ getName æ–¹æ³•åˆ™æ˜¯æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Š
}
</code></pre>
<blockquote>
<p>Async å‡½æ•°æ€»è¿”å›ç»™ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œè°ƒç”¨æ–¹å¼ä¹Ÿå¾ˆå¿’ç®€å•ã€‚ç›¸æ¯” Generator å‡½æ•°ï¼Œç®€ç›´ä¸è¦å¤ªçˆ½äº†ã€‚</p>
<pre><code class="language-js">foo()
  .then(res =&gt; { /* res ä¸º foo å‡½æ•°çš„ return å€¼ */ })
  .catch(err =&gt; { /* err ä¸º foo å‡½æ•°çš„å¼‚å¸¸åŸå›  */ })
</code></pre>
<p><code>async</code> å‡½æ•°å†…éƒ¨ <code>return</code> è¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸º <code>then()</code> æ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œå³ <code>Promise</code> å¯¹è±¡çš„çŠ¶æ€å˜ä¸º <code>fulfilled</code>ã€‚è‹¥æ— æ˜¾å¼çš„ return è¯­å¥ï¼Œç›¸å½“äº <code>return undefined</code>ï¼Œè‡ªç„¶ <code>then()</code> æ–¹æ³•æ¥æ”¶åˆ°çš„å‚æ•°ä¹Ÿå°±æ˜¯ <code>undefined</code>ã€‚</p>
<p>è‹¥å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œä¼šå¯¼è‡´è¿”å›çš„ <code>Promise</code> å¯¹è±¡å˜ä¸º <code>rejected</code> çŠ¶æ€ï¼Œä»è€Œè¢« <code>Promise</code> å¯¹è±¡çš„ <code>catch()</code>  æ–¹æ³•æ•è·åˆ°ã€‚</p>
<h3>äºŒã€ç‰¹ç‚¹</h3>
<p>Async å‡½æ•°æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ï¼Œå®ƒå¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å››ç‚¹ï¼š</p>
<ul>
<li><strong>å†…ç½®æ‰§è¡Œå™¨</strong></li>
</ul>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒGenerator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»ä¾èµ–æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨å†…éƒ¨å°±æ˜¯ä¸æ–­æ‰§è¡Œç”Ÿæˆå™¨çš„ <code>next()</code> æ–¹æ³•çš„è¿‡ç¨‹ã€‚æ‰€ä»¥æ‰æœ‰äº† <a href="https://github.com/tj/co#readme"><code>co</code></a> æ¨¡å—ã€‚è€Œ <code>async</code> å‡½æ•°åˆ™å†…ç½®äº†æ‰§è¡Œå™¨ã€‚è°ƒç”¨æ–¹æ³•ä¹Ÿåªéœ€è¦è·Ÿæ™®é€šå‡½æ•°é‚£æ ·ï¼Œä¸€è¡Œå°±è¡Œã€‚</p>
<pre><code class="language-js">// Async å‡½æ•°
async function foo() { /* do something... */ }
foo()

// Generator å‡½æ•°
function* bar() { /* do something... */ }
const gen = bar()
gen.next() // è¿™æ‰å¼€å§‹æ‰§è¡Œ Generator å‡½æ•°ä½“å†…çš„ä»£ç 
// ...
</code></pre>
<ul>
<li><strong>æ›´å¥½çš„è¯­ä¹‰</strong></li>
</ul>
<p><code>async</code> å’Œ <code>await</code>ï¼Œæ¯”èµ·æ˜Ÿå· <code>*</code> å’Œ <code>yield</code>ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ã€‚<code>async</code> è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œ<code>await</code> è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</p>
<pre><code class="language-js">// Async å‡½æ•°
async function foo() {
  let a = await 1
  let b = await 2
  return b
  // ç›´æ¥è°ƒç”¨ foo() ä¸” aã€b çš„å€¼å¯¹åº”ä¸º 1ã€2
}
foo() // PromiseÂ { &lt;fulfilled&gt;: 2 }

// Generator å‡½æ•°
function* bar() {
  let a = yield 1
  let b = yield 2
  return b
  // è‹¥æŒ‰å¦‚ä¸‹æ–¹å¼è°ƒç”¨ï¼Œaã€b çš„å€¼å‡ä¸º undefinedï¼Œè€Œéå¯¹åº”ä¸º 1ã€2
}
const gen = bar()
gen.next() // { done: false, value: 1 }
gen.next() // { done: false, value: 2 }
gen.next() // { done: true, value: undefined }
</code></pre>
<ul>
<li><strong>æ›´å¹¿çš„é€‚ç”¨æ€§</strong></li>
</ul>
<p><code>co</code> æ¨¡å—çº¦å®šï¼Œ<code>yield</code> å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– <code>Promise</code> å¯¹è±¡ï¼Œè€Œ <code>async</code> å‡½æ•°çš„ <code>await</code> å‘½ä»¤åé¢ï¼Œå¯ä»¥æ˜¯ <code>Promise</code> å¯¹è±¡æˆ–é <code>Promise</code> çš„å€¼ï¼ˆåŸå§‹å€¼æˆ–å¼•ç”¨å€¼å‡å¯ï¼Œä½†è¿™æ—¶å†…éƒ¨ä¼šè‡ªåŠ¨ä½¿ç”¨ <code>Promise.resolve()</code> è½¬æ¢ä¸º <code>Promise</code> å¯¹è±¡ï¼‰ã€‚</p>
<ul>
<li><strong>è¿”å›å€¼æ˜¯ Promise å¯¹è±¡</strong></li>
</ul>
<p><code>async</code> å‡½æ•°çš„è¿”å›å€¼æ€»æ˜¯ <code>Promise</code> å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iteratorï¼ˆè¿­ä»£å™¨ï¼‰å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨ <code>Promise.prototype.then()</code> æ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p>
<h3>ä¸‰ã€åŸºæœ¬ç”¨æ³•</h3>
<p><code>async</code> å‡½æ•°è¿”å›çš„ <code>Promise</code> å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨<strong>æ‰€æœ‰</strong>çš„ <code>await</code> å‘½ä»¤åé¢çš„ <code>Promise</code> å¯¹è±¡æ‰§è¡Œå®Œï¼ˆå³çŠ¶æ€å˜ä¸º <code>fullfilled</code>ï¼‰ï¼Œä¸”å†…éƒ¨ä¸å‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆ <code>async</code> å‡½æ•°è¿”å›çš„ <code>Promise</code> å¯¹è±¡æ‰ä¼šå˜æˆ <code>fulfilled</code> çŠ¶æ€ï¼Œä»è€Œè§¦å‘ <code>Promise</code> å¯¹è±¡çš„ <code>then()</code> æ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>è‹¥å‡½æ•°å†…éƒ¨ <code>await</code> åé¢çš„æŸä¸ª <code>Promise</code> å¯¹è±¡å˜ä¸º <code>rejected</code> çŠ¶æ€ï¼ˆä¸”å‡½æ•°å†…æœªä½¿ç”¨ <code>try...catch</code> æ•è·å¤„ç†ï¼‰ï¼Œæˆ–è€…å‡½æ•°å†…éƒ¨å‡ºç°æŠ›å‡ºé”™è¯¯ï¼Œå°†ä¼šåœæ­¢æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„ä»£ç ï¼Œå¹¶ä½¿å¾—æœ€ç»ˆ <code>async</code> å‡½æ•°è¿”å›çš„ <code>Promise</code> å¯¹è±¡ä¼šå˜æˆ <code>rejected</code> çŠ¶æ€ï¼Œä»è€Œè§¦å‘ <code>catch()</code> çš„å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>çœ‹ç€æœ‰ç‚¹åƒ <code>Promise.all()</code> æ–¹æ³•ï¼Œä½†ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™é‡Œå…ˆä¸å±•å¼€ï¼Œä¸‹æ–‡å†è¯¦è¯´ã€‚</p>
</blockquote>
<p>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="language-js">async function request() {
  const response = await fetch('/user/1')
  const res = await response.json()
  return res
}

// å¦‚æœä½¿ç”¨ Promise æ˜¯è¿™æ ·çš„ï¼Œæ— è®ºåœ¨è¯­ä¹‰å’Œå†™æ³•ä¸Šéƒ½ä¸å¦‚ async å‡½æ•°æ¸…æ™°ã€ç®€æ´ã€‚
// è€Œä¸”è¿™ä¾‹å­åªæœ‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè‹¥å­˜åœ¨å¤šä¸ªï¼Œé‚£ then æ–¹æ³•çœŸçš„ä¸å¿ç›´è§†ã€‚
// function request() {
//   return fetch('/user/1')
//     .then(response =&gt; response.json())
//     .then(res =&gt; res)
// }
</code></pre>
<p>ç„¶åæŒ‰ç…§ä¸‹é¢é‚£æ ·å»è°ƒç”¨å³å¯ã€‚</p>
<pre><code class="language-js">request()
  .then(res =&gt; {
    console.log(res)
    // do something...
  })
  .catch(err =&gt; {
    console.warn(err)
    // å¤„ç†å¼‚å¸¸
    // ä¾‹å¦‚ç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´ fetch è¯·æ±‚å‡ºé”™äº†ï¼Œè‡ªç„¶ response ï¼ˆå®ƒæ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼‰çš„ç»“æœ
    // å°±ä¸æ˜¯ä¸€ä¸ª JSON æ•°æ®ï¼Œé‚£ä¹ˆè°ƒç”¨ response.json() è§£æå°±ä¼šå‡ºé”™ã€‚ï¼ˆè¿™æ—¶å¯ä½¿ç”¨ response.text() è¿›è¡Œè§£æï¼‰
    // ä½¿å¾— request å‡½æ•°åœæ­¢å¾€ä¸‹æ‰§è¡Œï¼Œä¸”è¿”å›çš„ Promise çŠ¶æ€å˜ä¸º rejectedï¼Œ
    // è‡ªç„¶å°±ä¼šè¢«è¿™é‡Œçš„ catch æ•è·åˆ°ã€‚é”™è¯¯ä¿¡æ¯å¯èƒ½æ˜¯ï¼šSyntaxError: Unexpected token &lt; in JSON at position 0
  })
</code></pre>
<h5>1. await å‘½ä»¤</h5>
<blockquote>
<p>å…¶ä¸­ <code>await</code> å…³é”®å­—ï¼Œç›®å‰åªèƒ½åœ¨ <code>async</code> å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚</p>
<p>ä½†æœªæ¥å°±ä¸ä¸€å®šäº†ã€‚ç°åœ¨æœ‰ä¸€ä¸ª<a href="https://github.com/tc39/proposal-top-level-await">è¯­æ³•ææ¡ˆ</a>ï¼Œå…è®¸åœ¨æ¨¡å—é¡¶å±‚ç‹¬ç«‹ä½¿ç”¨ <code>await</code> å‘½ä»¤ï¼Œç›®å‰ä»¥è¿›å…¥ Stage-4 é˜¶æ®µï¼Œç›¸ä¿¡åœ¨ä¸ä¹…çš„å°†æ¥å°±èƒ½æ­£å¼çº³å…¥ ECMAScript æ ‡å‡†äº†ã€‚å…³äºå®ƒçš„ç”¨æ³•å¯çœ‹ï¼š<a href="https://es6.ruanyifeng.com/#docs/async#%E9%A1%B6%E5%B1%82-await">Top-level await</a>ã€‚</p>
</blockquote>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>await</code> å…³é”®å­—åé¢åº”è¯¥æ¥ç€ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ <code>Promise</code> å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚</p>
<pre><code class="language-js">async function foo() {
  return await 1
  // ç›¸å½“äº return 1
  // 
  // å¯¹äº `await 1` å‡½æ•°å†…éƒ¨çš„æ‰§è¡Œå™¨ï¼Œå…¶å®åšçš„äº‹æƒ…æ˜¯ Promise.resolve(1)ï¼Œ
  // è€Œ Promise.resolve() çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªå€¼è½¬åŒ–ä¸º Promise å¯¹è±¡ã€‚
  // å…³äº Promise.resolve() å¯çœ‹æ–‡ç« ï¼šhttps://www.jianshu.com/p/1f2db76fd8d8
}

// âš ï¸ å¯¹äºé `Promise` å¯¹è±¡ï¼Œæ²¡å¿…è¦ä½¿ç”¨ `await` å…³é”®å­—ã€‚
</code></pre>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ <code>await</code> å…³é”®å­—åé¢æ¥äº†ä¸€ä¸ª <code>thenable</code> å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>await</code> ä¼šå°†å…¶å½“åšæ˜¯ <code>Promise</code> å¯¹è±¡ã€‚<code>thenable</code> å¯¹è±¡æ˜¯æŒ‡è¯¥å¯¹è±¡ä¸Šå®ç°äº† <code>then()</code> æ–¹æ³•ï¼ˆæœ¬èº«æˆ–åŸå‹ä¸Šå‡å¯ï¼‰ã€‚</p>
<pre><code>const thenable = {
  then(resolve, reject) {
    resolve('abc')
    // æ³¨æ„ï¼Œthen æ–¹æ³•ä¸­è¦ä½¿ç”¨ resolve æˆ– reject å»æ”¹å˜çŠ¶æ€ï¼Œ
    // å¦åˆ™ await thenable çš„çŠ¶æ€ä¸€ç›´ä¼šæ˜¯ pendingï¼Œ
    // ç”±äº await ä¸€ç›´æœªç­‰åˆ° thenable å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œ
    // å› æ­¤ foo() è¿”å›çš„ Promise å¯¹è±¡ä¹Ÿå°†æ°¸è¿œåœç•™åœ¨ pending çŠ¶æ€ï¼Œ
    // å®ƒåªèƒ½è‹¦è‹¦åœ°ç­‰å¾…æœ‰æœä¸€æ—¥ thenable çŠ¶æ€èƒ½å‘ç”Ÿæ”¹å˜
  }
}

async function foo() {
  return await thenable // await ä¼šæŠŠ thenable å½“ä½œä¸€ä¸ª Promise å¯¹è±¡å»å¤„ç†
}

foo().then(res =&gt; {
  console.log(res) // &quot;abc&quot;
})
</code></pre>
<p>ä¸€æ—¦é‡åˆ° <code>await</code> åé¢çš„ <code>Promise</code> å¯¹è±¡ä¸º <code>rejected</code> çŠ¶æ€çš„æƒ…å†µï¼Œä¼šç»ˆæ­¢åé¢ä»£ç çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">async function foo() {
  await Promise.reject('some errors...')
  let a = 'any' // è¿™ä¸€è¡ŒåŠåé¢çš„ä»£ç ï¼Œå¹¶ä¸ä¼šè¢«æ‰§è¡Œ
  return a
}

foo().catch(err =&gt; {
  console.warn(err) // &quot;some errors...&quot;
})
</code></pre>
<p>è¿™äº›å¼‚å¸¸éƒ½å¯ä»¥ä½¿ç”¨ <code>try...catch</code> å»æ•è·ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚</p>
<h5>2. é”™è¯¯å¤„ç†</h5>
<p><code>async</code> å‡½æ•°çš„è¯­æ³•è§„åˆ™æ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œéš¾ç‚¹æ˜¯é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<p>å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œä¸€æ—¦ <code>async</code> å‡½æ•°å†…éƒ¨æŸä¸ª <code>Promise</code> å¯¹è±¡çŠ¶æ€å˜ä¸º <code>rejected</code>ï¼Œæˆ–è€…å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæˆ–è€…ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œä¼šåœæ­¢æ‰§è¡Œå‡½æ•°ä½“å†…éƒ¨çš„ä½™ä¸‹ä»£ç ï¼Œå¹¶ä½¿å¾— <code>async</code> å‡½æ•°è¿”å›çš„ <code>Promise</code> å¯¹è±¡æ”¹å˜çŠ¶æ€ <code>rejected</code>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">async function foo() {
  await Promise.reject('error') // è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œ
  let a = 'any'
  return a
}

// å¦‚ä½•ä½¿å…¶æ­£å¸¸è°ƒç”¨ then æ–¹æ³•
foo().then(res =&gt; {
  console.log(res) // &quot;any&quot;
})
</code></pre>
<p>å‡è®¾å¼‚æ­¥æ“ä½œçš„ç»“æœæˆåŠŸä¸å¦ï¼Œä¸å½±å“å‡½æ•°æœ€ç»ˆçš„ç»“æœï¼Œä½¿å…¶æ­£å¸¸æ‰§è¡Œåˆ°æœ€åå¹¶è¿”å›ç»“æœï¼Œæœ‰å‡ ç§å¤„ç†æ–¹å¼ï¼š</p>
<pre><code class="language-js">// æ–¹å¼ä¸€ï¼šåˆ©ç”¨ try...catch è¯­å¥
async function foo() {
  try {
    await Promise.reject('error')
  } catch (e) {
    console.warn(e) // &quot;error&quot;
    // é”™è¯¯å¤„ç†...
  }
  let a = 'any'
  return a
}
</code></pre>
<pre><code class="language-js">// æ–¹å¼äºŒï¼šå¦‚æœæ˜¯ Promise å¯¹è±¡ï¼Œå¯ä»¥ç”¨ catch æ–¹æ³•æ•è·
async function foo() {
  await Promise.reject('error').catch(err =&gt; {
    console.warn(err) // &quot;error&quot;
    // é”™è¯¯å¤„ç†...
    // åªè¦è¿™é‡Œé¢ä¸å†æŠ›å‡ºé”™è¯¯ï¼Œawait æ‹¿åˆ°çš„ Promise å¯¹è±¡çŠ¶æ€ä¸º fulfilled
  })
  let a = 'any'
  return a
}
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç›´æ¥é‡‡ç”¨ <code>Promise</code> çš„å†™æ³•å»å¤„ç†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨åˆ° <code>async/await</code> çš„å†™æ³•ï¼Œè¡¨ç¤ºå‡½æ•°ä½“å†…éƒ¨ä¼šå­˜åœ¨å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œé€šå¸¸çš„é”™è¯¯å¤„ç†æ–¹å¼æ˜¯ï¼šåˆ©ç”¨ä¸€ä¸ª <code>try...catch</code> è¯­å¥å°†æ•´ä¸ªå‡½æ•°ä½“åŒ…è£¹èµ·æ¥ã€‚</p>
<pre><code class="language-js">async function request() {
  try {
    await fetch('/user/1')
    await fetch('/user/2')
    await fetch('/user/3')
  } catch (e) {
    // æ•è·å¼‚å¸¸ï¼Œå¹¶åšé”™è¯¯å¤„ç†
  }
}
</code></pre>
<h3>å››ã€Async å‡½æ•°åº”ç”¨</h3>
<h5>1. å®ç°é‡å¤è¯·æ±‚</h5>
<p>æ­¤å‰<a href="https://www.jianshu.com/p/fefc9d64f0a1">å¦ä¸€ç¯‡æ–‡ç« </a>æåˆ°è¿‡ï¼Œå¯ä»¥ <code>async</code> å‡½æ•°ç»“åˆ <code>for</code> å¾ªç¯ã€<code>try...catch</code> å¯ä»¥å®ç°å¤šæ¬¡é‡å¤å°è¯•çš„æ•ˆæœã€‚</p>
<pre><code class="language-js">async function request(url) {
  let res
  let err
  const MAX_NUM_RETRIES = 3

  for (let i = 0; i &lt; MAX_NUM_RETRIES; i++) {
    try {
      res = await fetch(url).then(response =&gt; response.json())
      break
    } catch (e) {
      err = e
      // Do nothing and make it continue.
    }
  }

  if (res) return res
  throw err
}

request('/user/1')
  .then(res =&gt; {
    console.log('success')
  })
  .catch(err =&gt; {
    console.log('fail')
  })
</code></pre>
<h5>2. ä¸è¦åœ¨ forEach ä¸­ä½¿ç”¨ async/await</h5>
<p>å®ƒå¯èƒ½å¾—ä¸åˆ°é¢„æœŸç»“æœï¼Œåœ¨<a href="https://www.jianshu.com/p/17600665a51d">å¦ä¸€ç¯‡æ–‡ç« </a>ä¹Ÿè¯¦ç»†åœ°åˆ†æè¿‡äº†ã€‚</p>
<blockquote>
<p>å¦‚æœä½¿ç”¨ <code>promise</code> æˆ– <code>async</code> å‡½æ•°ä½œä¸º <code>forEach()</code> ç­‰ç±»ä¼¼æ–¹æ³•çš„ <code>callback</code> å‚æ•°ï¼Œæœ€å¥½å¯¹é€ æˆçš„æ‰§è¡Œé¡ºåºå½±å“å¤šåŠ è€ƒè™‘ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°é”™è¯¯ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ‰“å° <code>sum</code> å¹¶ä¸ä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœ <code>6</code>ï¼Œè€Œæ˜¯ <code>3</code>ã€‚</p>
<pre><code class="language-js">// PSï¼šå®é™…åœºæ™¯è‚¯å®šä¸ä¼šè¿™æ ·å»æ±‚å’Œï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œä¸¾ä¾‹
function foo() {
  let sum = 0
  const arr = [1, 2, 3]
  const sumFn = (a, b) =&gt; a + b

  arr.forEach(async item =&gt; {
    sum = await sumFn(sum, item)
  })

  setTimeout(() =&gt; {
    console.log(sum) // 3
    // æ³¨æ„ï¼Œè¿™é‡Œæ‰“å°ä¸èƒ½å»æ‰ setTimeoutï¼Œå¦åˆ™æ‰“å°ç»“æœæ°¸è¿œæ˜¯ 0ã€‚
  })
}

foo()
</code></pre>
<p>ç”±äº <code>await anything</code> è¡¨è¾¾å¼ï¼ˆè¿™é‡Œ <code>anything</code> è¡¨ç¤ºä»»æ„å€¼ï¼‰ç›¸å½“äºä½¿ç”¨äº† <code>Promise.resolve()</code> å°† <code>anything</code> åŒ…è£¹èµ·æ¥ï¼Œå…¶ä¸­ <code>Promise</code> å±äºå¼‚æ­¥ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ï¼‰ï¼Œå®ƒä¼šåœ¨åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åæ‰ä¼šå»æ‰§è¡Œã€‚</p>
<p>å½“æ‰§è¡Œç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œå…ˆæ‰§è¡Œ <code>forEach</code> çš„å›è°ƒå‡½æ•°ï¼Œé‡åˆ° <code>await sumFn(sum, 1)</code>ï¼Œä¼šæ‰§è¡Œ <code>sumFn</code> å‡½æ•°è®¡ç®—ç»“æœï¼Œæ‰€ä»¥å˜æˆäº† <code>sum = await 1</code>ã€‚ç”±äºæ˜¯å¼‚æ­¥ï¼Œä¼šæš‚æ—¶ Hold å°†å…¶æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå› æ­¤ <code>sum</code> æš‚æ—¶ä¸ä¼šè¢«é‡æ–°èµ‹å€¼ï¼Œå®ƒä»æ˜¯ <code>0</code>ï¼›æ¥ç€æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼ŒåŒç†å˜æˆ <code>sum = await 2</code>ï¼Œåˆè¢« Hold ä½ï¼›å†ä¸‹ä¸€æ¬¡å¾ªç¯åŒç†å˜æˆ <code>sum = await 3</code>ã€‚è‡³æ­¤ <code>forEach</code> çš„ä¸‰æ¬¡å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€ç»§ç»­å¾€ä¸‹èµ°ï¼Œé‡åˆ° <code>setTimeout</code>ï¼ˆå±äºå¼‚æ­¥ä»»åŠ¡ä¸­çš„å®ä»»åŠ¡ï¼‰ï¼Œç”±äºå»¶è¿Ÿæ—¶é—´ä¸º <code>0</code> ä¼šç›´æ¥æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå®ƒå°†ä¼šåœ¨ä¸‹ä¸€æ¬¡å®ä»»åŠ¡ä¸­æ‰§è¡Œã€‚</p>
<p>è‡³æ­¤ï¼ŒåŒæ­¥ä»»åŠ¡å·²æ‰§è¡Œå®Œæ¯•ï¼Œç´§æ¥ç€ï¼Œä¼šä¾æ¬¡æ‰§è¡Œåˆšåˆšè¢« Hold ä½çš„ä¸‰ä¸ªå¾®ä»»åŠ¡ï¼ˆåˆ†åˆ«æ˜¯ <code>sum = 1</code>ã€<code>sum = 2</code>ã€<code>sum = 3</code>ï¼‰ï¼Œå› æ­¤ <code>sum</code> å˜æˆäº† <code>3</code>ã€‚å¾®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œï¼ˆç”±äºæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ UI Renderï¼‰ç«‹åˆ»ä¼šæ‰§è¡Œä¸‹ä¸€æ¬¡å®ä»»åŠ¡ï¼Œå³ <code>console.log(sum)</code>ï¼Œå› æ­¤æ‰“å°ç»“æœä¸º <code>3</code>ã€‚</p>
<p>å…¶å®ç†è§£åŸç†ä¹‹åï¼Œåˆ†æè¿™é“é¢˜å°±å¾ˆç®€å•äº†ã€‚é‚£ä¹ˆæ›¿ä»£æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ <code>for...of</code> è¯­å¥ï¼š</p>
<pre><code class="language-js">async function foo() {
  let sum = 0
  const arr = [1, 2, 3]
  const sumFn = (a, b) =&gt; a + b

  for (let item of arr) {
    sum = await sumFn(sum, item)
  }

  setTimeout(() =&gt; {
    console.log(sum) // 6
    // æ”¹æˆ for...of ä¹‹åï¼Œè¿™é‡Œå¯ä»¥å»æ‰ setTimeout äº†ï¼Œ
    // ç›´æ¥å°† console è¯­å¥æ”¾åˆ°å¤–é¢ï¼Œä¹Ÿå¯ä»¥æŒ‰é¡ºåºæ‰§è¡Œäº†
  })
}

foo()
</code></pre>
<p>é‚£ä¸ºä»€ä¹ˆ <code>for...of</code> å°±å¯ä»¥ï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª <code>while</code> å¾ªç¯ã€‚</p>
<pre><code class="language-js">async function foo() {
  let sum = 0
  const arr = [1, 2, 3]
  const sumFn = (a, b) =&gt; a + b

  // for (let item of arr) {
  //   sum = await sumFn(sum, item)
  // }

  // ç›¸å½“äº
  const iterator = arr[Symbol.iterator]()
  let iteratorResult = iterator.next()
  while (!iteratorResult.done) {
    sum = await sumFn(sum, iteratorResult.value)
    iteratorResult = iterator.next()
  }

  setTimeout(() =&gt; {
    console.log(sum) // 6
  })
}

foo()
</code></pre>
<h5>3. ç»§å‘å…³ç³»</h5>
<p>æ–‡ç« å‰é¢éƒ¨åˆ†æåˆ°è¿‡ Async å‡½æ•°ä¸­ä½¿ç”¨ <code>await</code> å»æ§åˆ¶å¼‚æ­¥æ“ä½œï¼Œçœ‹èµ·æ¥åƒ <code>Promise.all()</code>ï¼Œä½†åˆæœ‰åŒºåˆ«ã€‚</p>
<p>å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">async function request() {
  // å‡è®¾ fetchUser1ã€fetchUser2ã€fetchUser3 è¡¨ç¤ºå¼‚æ­¥è¯·æ±‚
  let user1 = await fetchUser1()
  let user2 = await fetchUser2()
  let user3 = await fetchUser3()
  return 'abc'
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>request()</code> å‡½æ•°çš„è¿”å›å€¼ä¸ä¾èµ–äº <code>fetchUser</code> çš„ç»“æœï¼Œè€Œä¸”ä¸‰ä¸ª <code>fetchUser</code> è¯·æ±‚æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å¦‚æœæŒ‰ä¸Šé¢çš„å†™æ³•ï¼Œç›´æ¥å½±å“ç¨‹åºçš„æ‰§è¡Œæ—¶é—´ã€‚</p>
<p>å› ä¸ºç›®å‰ç»§å‘å¼å†™æ³•ï¼Œ<code>fetchUser2</code> è¯·æ±‚åªæœ‰åœ¨ <code>fetchUser1</code> è¯·æ±‚å®Œæˆå¹¶è¿”å›æ•°æ®åæ‰ä¼šè¢«å‘å‡ºï¼ˆ<code>fetchUser3</code> åŒç†ï¼‰ã€‚ä½†æ ¹æ®ä»£ç é€»è¾‘æ¥çœ‹ï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰å…³è”å…³ç³»çš„ï¼Œä¸ºä»€ä¹ˆä¸ä¸€æ¬¡æ€§è¿ç»­å‘å‡ºä¸‰ä¸ªè¯·æ±‚ä»¥å‡å°‘æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæ—¶é—´å‘¢ï¼Ÿ</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ã€‚</p>
<pre><code class="language-js">// å†™æ³•ä¸€ï¼ˆæ¨èï¼‰
async function request() {
  // è¿™æ · fetchUser1ã€fetchUser2ã€fetchUser3 å°†ä¼šåŒæ—¶å‘å‡ºè¯·æ±‚
  // è¿™ä¹Ÿæ˜¯æ–‡ä¸­æ‰€è¯´ await ä¸ Promise.all() çš„ä¸åŒç‚¹ã€‚
  let [user1, user2, user3] = await Promise.all([
    fetchUser1(),
    fetchUser2(),
    fetchUser3()
  ])
  return 'abc'
}

// å†™æ³•äºŒ
async function request() {
  let p1 = fetchUser1()
  let p2 = fetchUser2()
  let p3 = fetchUser3()
  let user1 = await p1
  let user2 = await p2
  let user3 = await p3
  return 'abc'
}
</code></pre>
<h3>äº”ã€Async å‡½æ•°çš„å®ç°åŸç†</h3>
<p>Async å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ã€‚</p>
<blockquote>
<p>å¦‚æœå¯¹ Generator å‡½æ•°ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/7ee993ec1a80">ç»†è¯» ES6 ä¹‹ Generator ç”Ÿæˆå™¨</a>ï¼Œå†å›æ¥çœ‹æœ¬èŠ‚å†…å®¹ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢ <code>request</code> æ˜¯ <code>async</code> å‡½æ•°ã€‚</p>
<pre><code class="language-js">function delay(time) {
  return new Promise(resolve =&gt; setTimeout(resolve, time))
}

async function request() {
  let response = await fetch('http://192.168.1.117:7701/config')
  let result = await response.json()
  await delay(1000)
  await delay(2000)
  await delay(3000)
  return result
}
</code></pre>
<p>æ—¢ç„¶ Async å‡½æ•°æ˜¯ Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨çš„ç»“åˆï¼Œé‚£ä¹ˆç›¸å½“äºå°†ä¸Šé¢ Async å‡½æ•°ä¸­çš„ <code>async</code> å’Œ <code>await</code> å…³é”®å­—ï¼Œå°±æ›¿æ¢æˆ Generator å‡½æ•°çš„ <code>*</code> å’Œ <code>yield</code>ï¼Œå¤–åŠ ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œå™¨ã€‚</p>
<p>äºæ˜¯å˜æˆäº†è¿™æ ·ï¼š</p>
<pre><code class="language-js">function* request() {
  let response = yield fetch('http://192.168.1.117:7701/config')
  let result = yield response.json()
  yield delay(1000)
  yield delay(2000)
  yield delay(3000)
  return result
}
</code></pre>
<p>é‚£ä¹ˆæ€æ ·å®ç°æ‰§è¡Œå™¨ï¼Œæ‰èƒ½è¾¾åˆ° Async å‡½æ•°çš„è¯­ä¹‰å‘¢ï¼Ÿ</p>
<p>å…¶å®æ²¡é‚£ä¹ˆéš¾ï¼Œåªè¦å¼„æ¸…æ¥š <code>Generator.prototype.next()</code> å’Œ <code>Generator.prototype.throw()</code> ä¸¤ä¸ªæ–¹æ³•å°±æ²¡å¤ªå¤§é—®é¢˜äº†ã€‚å½“ç„¶å‰æè¿˜æ˜¯è¦çŸ¥é“ç”Ÿæˆå™¨çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function executor(genFn, ...args) {
  return new Promise((resolve, reject) =&gt; {
    if (Object.prototype.toString.call(genFn) !== '[object GeneratorFunction]') {
      return reject(new Error('Must be a generator function!'))
    }

    const gen = genFn(...args)

    const step = iteratorResult =&gt; {
      console.count('æ¬¡æ•°')
      const { done, value } = iteratorResult

      if (done) {
        return resolve(value)
      }

      Promise
        .resolve(value)
        .then(res =&gt; {
          // å…³äºæ•è·å¼‚å¸¸ï¼Œæ€•æœ‰äººä¸æ‡‚ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼š
          // å‡è®¾è°ƒç”¨ next æ–¹æ³•åï¼ŒGenerator å†…éƒ¨æŠ¥é”™ï¼Œä¸”å†…éƒ¨æœªè¿›è¡Œæ•è·é”™è¯¯æ—¶ï¼Œ
          // å†…éƒ¨çš„é”™å°†ä¼šè¢« Generator å¤–éƒ¨çš„ try...catch æ•è·åˆ°ï¼ˆå³è¿™é‡Œçš„ then å›è°ƒå‡½æ•°ï¼‰ï¼Œ
          // ä½†æ˜¯è¿™é‡Œä¸è¿›è¡Œæ•è·çš„åŸå› æ˜¯ï¼šä½¿å…¶ä¼ é€’å‡ºå»ï¼Œè®©åé¢çš„ Promise.prototype.catch() æ–¹æ³•æ•è·ï¼Œ
          // è¿›è€Œåœ¨ catch() çš„å›è°ƒå‡½æ•°å†…è°ƒç”¨ Generator.prototype.throw() ä¸»åŠ¨ä½¿å¾—ç”Ÿæˆå™¨ç»“æŸï¼Œå¹¶ reject é”™è¯¯ã€‚
          step(gen.next(res))
        })
        .catch(err =&gt; {
          try {
            gen.throw(err)
          } catch (e) {
            reject(e)
          }
        })
    }

    step(gen.next())
  })
}
</code></pre>
<p>è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function* request() {
  let response = yield fetch('http://192.168.1.117:7701/config')
  let result = yield response.json()
  yield delay(1000)
  yield delay(2000)
  yield delay(3000)
  return result
}

// è¯­æ³•ï¼šexecutor(generatorFunction[, param[, ... param]])
// å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Œè‹¥ç”Ÿæˆå™¨å‡½æ•°éœ€è¦ä¼ é€’å‚æ•°ï¼Œå¾€åé¢æ·»åŠ å³å¯
executor(request)
  .then(res =&gt; {
    console.log(res)
  })
  .catch(err =&gt; {
    console.warn(err)
  })
</code></pre>
<blockquote>
<p>å¤§è‡´å®ç°å¦‚ä¸Šã€‚å¦‚æœè¿˜æ˜¯ä¸å¤ªæ‡‚çš„ï¼Œåº”è¯¥æ˜¯ Generator å‡½æ•°è¿™å—çŸ¥è¯†ç‚¹è¿˜ä¸å¤Ÿç†Ÿæ‚‰ã€‚</p>
<p>å¦‚æœè¿™æ ·ï¼Œè¿˜æ˜¯å…ˆè¦çœ‹ä¸‹è¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/258">æ–‡ç« </a>ç†Ÿæ‚‰ç›¸å…³çŸ¥è¯†ï¼Œè€Œä¸”æ–‡ç« æœ«å°¾å¾ˆç›¸ä¼¼çš„è‡ªåŠ¨æ‰§è¡Œå™¨çš„å®ç°ç¤ºä¾‹ã€‚</p>
</blockquote>
<h3>å…­ã€æ€»ç»“</h3>
<p>å‰é¢å†™è¿‡å…³äº <a href="https://github.com/toFrankie/blog/issues/257">Iterator</a> ã€<a href="https://github.com/toFrankie/blog/issues/255">Promise</a>ã€<a href="https://github.com/toFrankie/blog/issues/258">Generator</a> ç›¸å…³å†…å®¹çš„æ–‡ç« ï¼Œå†åˆ°æœ¬æ–‡çš„ Async å‡½æ•°ï¼Œå…¶å®éƒ½æ˜¯ç¯ç¯ç›¸æ‰£çš„ï¼Œå› æ­¤åº”æŒ‰é¡ºåºæ¥å­¦ä¹ ï¼Œæ‰èƒ½äº‹åŠåŠŸå€ã€‚</p>
<p>å…¶ä¸­ Promise è™½ç„¶è§£å†³äº†â€œæ¨ªå‘â€å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰çš„é—®é¢˜ï¼Œä½†æ˜¯åˆå‡ºç°äº†â€œçºµå‘â€ä¸æ–­ <code>then</code>ã€<code>catch</code> çš„å¤„ç†ã€‚</p>
<p>è€Œ Generator å‡½æ•°æå‡ºäº†ä¸€ç§å…¨æ–°çš„å¼‚æ­¥æ§åˆ¶çš„æ–¹æ¡ˆï¼Œè°ƒç”¨ Generator å‡½æ•°ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œå…¶å‡½æ•°ä½“å†…éƒ¨çš„ä»£ç ï¼Œä»…è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•ä»¥æ‰§è¡Œå†…éƒ¨çš„ä»£ç ã€‚å°½ç®¡ç”Ÿæˆå™¨å¯¹è±¡å®ç°äº† Iterator æ¥å£ï¼Œå› è€Œå¯ä¾› for...of ç­‰ä½¿ç”¨ï¼Œä½†æ˜¯å¾€å¾€ç»“åˆç½‘ç»œè¯·æ±‚ç­‰å¼‚æ­¥æ“ä½œæ—¶ï¼Œç”¨ for...of ç­‰è¯­å¥å‡ ä¹æ˜¯ä¸èƒ½æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„ã€‚è¿™ç§å‰æä¸‹ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå®ç°ä¸€ä¸ªæ‰§è¡Œå™¨æ¥è‡ªåŠ¨è°ƒç”¨ Generator å‡½æ•°å®ä¾‹ã€‚ä½†è¦æˆ‘ä»¬è‡ªä¸ªå®ç°ï¼Ÿï¼Ÿï¼Ÿè¿™å°±æ˜¯æœ€å¤§çš„é—®é¢˜äº†ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚</p>
<p>åŸºäºè¿™ç§çŠ¶å†µä¸‹ï¼Œè‘—åçš„ <code>co</code> æ¨¡å—å°±å®ç°äº† Generator æ‰§è¡Œå™¨ï¼Œä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ä½†è¦å¦å¤–å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™æœ¬èº«ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œå“ˆå“ˆ...ğŸ˜„</p>
<p>åŸºäºä»¥ä¸Šç§ç§ä¸å°½äººæ„ï¼Œäºæ˜¯ TC39 è¢«å¼€å‘è€…å„ç§éª‚ï¼Œè¯´èƒ½ä¸èƒ½åŸç”Ÿå®ç°ä¸€ä¸ª Generator çš„æ‰§è¡Œå™¨å•Šï¼Œç°åœ¨ç”¨å¾—å¾ˆä¸çˆ½å•Šï¼TC39 å§”å‘˜ä¼šé‚£æ³¢äººç»ˆç©¶æ‰¿å—ä¸ä½å„æ–¹å‹åŠ›ï¼Œäºæ˜¯åªèƒ½åŠ ç­å¸®æˆ‘ä»¬å®ç°äº†...</p>
<p>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œç»ˆäºåœ¨ ES2017 æ ‡å‡†ä¸­å¼•å…¥äº† Async å‡½æ•°ï¼Œå®ƒå°±æ˜¯å®æ‰“å®çš„ Generator è¯­æ³•ç³–å•Šã€‚é™¤äº†å°† Generator ä¸­çš„ <code>*</code> å’Œ <code>yield</code> æ¢æˆäº† <code>async</code> å’Œ <code>await</code> ä¹‹å¤–ï¼Œè¿˜ç»“åˆäº† Promiseã€‚æ—¢è§£å†³äº† Generator çš„æ‰§è¡Œé—®é¢˜ï¼ŒPromise çš„â€œçºµå‘å‘å±•â€é—®é¢˜ã€‚çš†å¤§æ¬¢å–œäº†ï¼ŒTC39 å§”å‘˜ä¼šå¤§ä½¬ä»¬å¿ƒæƒ³ï¼Œç»ˆäºå¯ä»¥æ¶ˆåœäº†ï¼Œåˆå¯ä»¥æ—¥å¸¸æ‘¸é±¼äº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Generator ç”Ÿæˆå™¨]]></title>
            <link>https://github.com/toFrankie/blog/issues/258</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/258</guid>
            <pubDate>Sun, 26 Feb 2023 11:57:48 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5fe667f10b893bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5fe667f10b893bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ ES6 æ ‡å‡†ä¸­ï¼Œæä¾›äº† Generator å‡½æ•°ï¼ˆå³â€œç”Ÿæˆå™¨å‡½æ•°â€ï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨å‰é¢ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/257">æ–‡ç« </a>ä¸­ä¹Ÿæåˆ°ä¸€äºŒã€‚</p>
<h2>ä¸€ã€Generator ç®€è¿°</h2>
<p>é¿å…æœ‰äººæ··æ·†æ¦‚å¿µï¼Œå…ˆè¯´æ˜ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>ç”Ÿæˆå™¨å¯¹è±¡å¸¸è¢«æˆ‘ä»¬ç§°ä¸ºâ€œ<strong>ç”Ÿæˆå™¨</strong>â€ï¼ˆGeneratorï¼‰ï¼Œè€Œ Generator å‡½æ•°å¸¸ç§°ä¸ºâ€œ<strong>ç”Ÿæˆå™¨å‡½æ•°</strong>â€ï¼ˆGenerator Functionï¼‰ã€‚</p>
<p>ç”±äºç”Ÿæˆå™¨å¯¹è±¡æ˜¯å®ç°äº†<strong>å¯è¿­ä»£åè®®</strong>å’Œ<strong>è¿­ä»£å™¨åè®®</strong>çš„ï¼Œ<strong>å› æ­¤ç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</strong>ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡æœ‰æ—¶å€™ç›´æ¥ç§°ä¸ºè¿­ä»£å™¨ï¼Œå…¶å®æŒ‡çš„å°±æ˜¯ç”Ÿæˆå™¨å¯¹è±¡ã€‚</p>
</blockquote>
<pre><code class="language-js">// ç”Ÿæˆå™¨å‡½æ•°
function* genFn() {}

// ç”Ÿæˆå™¨å¯¹è±¡
const gen = genFn()

// ç”Ÿæˆå™¨å¯¹è±¡åŒ…å« @@iterator æ–¹æ³•ï¼Œå› æ­¤æ»¡è¶³å¯è¿­ä»£åè®®
gen[Symbol.iterator] // Æ’ [Symbol.iterator]() { [native code] }

// ç”Ÿæˆå™¨å¯¹è±¡å« next æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿæ˜¯æ»¡è¶³è¿­ä»£å™¨åè®®çš„
gen.next // Æ’ next() { [native code] }

// ç”Ÿæˆå™¨å¯¹è±¡çš„ @@iterator æ–¹æ³•è¿”å›è‡ªèº«ï¼ˆå³è¿­ä»£å™¨ï¼‰
gen === gen[Symbol.iterator]() // true
</code></pre>
<p><strong>æ€æ ·ç†è§£ Generator å‡½æ•°ï¼Ÿ</strong></p>
<ul>
<li>
<p>Generator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚</p>
</li>
<li>
<p>Generator å‡½æ•°è¿”å›ä¸€ä¸ª<strong>ç”Ÿæˆå™¨å¯¹è±¡</strong>ï¼Œè¯¥å¯¹è±¡ä¹Ÿå®ç°äº† Iterator æ¥å£ï¼ˆä¹Ÿå¯ä¾› <code>for...of</code> ç­‰æ¶ˆè´¹ä½¿ç”¨ï¼‰ï¼Œæ‰€ä»¥å…·æœ‰äº† <code>next()</code> æ–¹æ³•ã€‚å› æ­¤ï¼Œä½¿å¾—ç”Ÿæˆå™¨å¯¹è±¡æ‹¥æœ‰äº†å¼€å§‹ã€æš‚åœå’Œæ¢å¤ä»£ç æ‰§è¡Œçš„èƒ½åŠ›ã€‚</p>
</li>
<li>
<p>ç”Ÿæˆå™¨å¯¹è±¡å¯ä»¥ç”¨äºè‡ªå®šä¹‰è¿­ä»£å™¨å’Œå®ç°åç¨‹ï¼ˆcoroutineï¼‰ã€‚</p>
</li>
<li>
<p>Generator å‡½æ•°ä»å­—é¢ç†è§£ï¼Œå½¢å¼ä¸æ™®é€šå‡½æ•°å¾ˆç›¸ä¼¼ã€‚åœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸€ä¸ªæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚å°½ç®¡è¯­æ³•ä¸Šä¸æ™®é€šå‡½æ•°ç›¸ä¼¼ï¼Œä½†è¯­æ³•è¡Œä¸ºå´å®Œå…¨ä¸åŒã€‚</p>
</li>
<li>
<p>Generator å‡½æ•°å¼ºå¤§ä¹‹å¤„ï¼Œæ„Ÿè§‰å¾ˆå¤šäººæ²¡ GET åˆ°ã€‚å®ƒå¯ä»¥åœ¨ä¸åŒé˜¶æ®µä»å¤–éƒ¨ç›´æ¥å‘å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼æ¥è°ƒæ•´å‡½æ•°çš„è¡Œä¸ºã€‚</p>
</li>
</ul>
<p>ç”Ÿæˆå™¨å¯¹è±¡ï¼Œæ˜¯ç”± Generator å‡½æ•°è¿”å›çš„ï¼Œå¹¶ä¸”å®ƒè¿”å›å¯è¿­ä»£åè®®å’Œè¿­ä»£å™¨åè®®ï¼Œå› æ­¤ç”Ÿæˆå™¨å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p>
<blockquote>
<p>å€˜è‹¥å¯¹è¿­ä»£å™¨ Iterator ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/257">ç»†è¯» ES6 ä¹‹ Iterator è¿­ä»£å™¨</a>ï¼Œä»¥ç†Ÿæ‚‰ç›¸å…³å†…å®¹ã€‚</p>
</blockquote>
<h2>äºŒã€Generator å‡½æ•°è¯­æ³•</h2>
<h3>1. Generator å‡½æ•°</h3>
<p>ä¸æ™®é€šå‡½æ•°å£°æ˜ç±»ä¼¼ï¼Œä½†æœ‰ä¸¤ä¸ªç‰¹æœ‰ç‰¹å¾ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯ <code>function</code> å…³é”®å­—ä¸å‡½æ•°åç§°ä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå· <code>*</code>ï¼›</li>
<li>äºŒæ˜¯å‡½æ•°ä½“å†…ä½¿ç”¨ <code>yield</code> è¡¨è¾¾å¼ï¼Œä»¥å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ã€‚</li>
</ul>
<blockquote>
<p>æ˜Ÿå· <code>*</code> ä½ç½®æ²¡æœ‰æ˜ç¡®é™åˆ¶ï¼Œåªè¦å¤„äºå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´å³å¯ï¼Œç©ºæ ¼å¯æœ‰å¯æ— ï¼Œä¸å½±å“ã€‚è¿˜æœ‰ï¼Œè¿™é‡Œ <code>yield</code> æ˜¯â€œäº§å‡ºâ€çš„æ„æ€ã€‚</p>
</blockquote>
<p>å®é™…ä¸­ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨å­—é¢é‡å½¢å¼å»å£°æ˜ä¸€ä¸ª Generator å‡½æ•°ï¼Œå¾ˆå°‘ç”¨åˆ°æ„é€ å‡½æ•° <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/GeneratorFunction">GeneratorFunction</a> æ¥å£°æ˜çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå…ˆæ¥ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ã€‚</p>
<pre><code class="language-js">// generatorFn æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°
function* generatorFn() {
  console.log('do something...')
  // other statements
}

// è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚
const gen = generatorFn()

// æ³¨æ„ï¼Œä¸Šé¢åƒå¹³å¸¸ä¸€æ ·è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œå‡½æ•°ä½“å†…éƒ¨çš„é€»è¾‘/è¯­å¥ã€‚
// éœ€è¦ï¼ˆä¸æ–­åœ°ï¼‰è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ next() æ–¹æ³•ï¼Œæ‰ä¼šå¼€å§‹ï¼ˆç»§ç»­ï¼‰æ‰§è¡Œå†…éƒ¨çš„è¯­å¥ã€‚
// å…·ä½“å¦‚ä½•æ‰§è¡Œï¼Œè¯·çœ‹ä¸‹ä¸€ä¸ªç¤ºä¾‹ã€‚
gen.next()
// æ‰§è¡Œåˆ°è¿™é‡Œï¼Œæ‰ä¼šæ‰“å°å‡ºï¼š&quot;do something...&quot;
// ä¸” gen.next() çš„è¿”å›å€¼æ˜¯ï¼š{ value: undefined, done: true }
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œè°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°è¢«è°ƒç”¨ï¼Œå¹¶ä¸ä¼šç«‹å³ç«‹å³æ‰§è¡Œå‡½æ•°ä½“å†…éƒ¨çš„è¯­å¥ã€‚å¦å¤–ï¼Œ<strong>å‡½æ•°ä½“å†…çš„ <code>yield</code> è¡¨è¾¾å¼æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä¸å†™</strong>ï¼Œä½†è¿™å°±å¤±å»äº†ç”Ÿæˆå™¨å‡½æ•°æœ¬èº«çš„æ„ä¹‰äº†ã€‚</p>
<p>å†çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* generatorFn() {
  console.log(1)
  yield '100'
  console.log(2)
  yield '200'
  console.log(3)
  return '300'
}

const gen = generatorFn()
</code></pre>
<p>å‰é¢æåˆ°ï¼ŒGenerator å‡½æ•°è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚å› æ­¤ç”Ÿæˆå™¨å†…éƒ¨å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘æ¯æ¬¡éå†ç»“æŸçš„ä½ç½®ã€‚æ¯è°ƒç”¨ç”Ÿæˆå™¨çš„ <code>next()</code> æ–¹æ³•ï¼ŒæŒ‡é’ˆå¯¹è±¡ä¼šä»å‡½æ•°å¤´éƒ¨ï¼ˆé¦–æ¬¡è°ƒç”¨æ—¶ï¼‰æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼ï¼ˆæˆ– <code>return</code> è¯­å¥ï¼‰ä¸ºæ­¢ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-782dc4d63acb7554.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸Šé¢ä¸€å…±è°ƒç”¨äº†å››æ¬¡ <code>next()</code> æ–¹æ³•ï¼Œä»ç»“æœåˆ†æï¼š</p>
<p>å½“é¦–æ¬¡è°ƒç”¨ <code>gen.next()</code> æ–¹æ³•ï¼Œä»£ç æ‰§è¡Œåˆ° <code>yield '100'</code> ä¼šåœä¸‹æ¥ï¼ˆæŒ‡é’ˆå¯¹è±¡æŒ‡å‘æ­¤å¤„ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>IteratorResult</code> å¯¹è±¡ï¼š<code>{ value: '100', done: false }</code>ï¼ŒåŒ…å« <code>done</code> å’Œ <code>value</code> å±æ€§ã€‚å…¶ä¸­ <code>value</code> å±æ€§å€¼å°±æ˜¯ <code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼ <code>'100'</code>ï¼Œ<code>done</code> ä¸º <code>false</code> è¡¨ç¤ºéå†è¿˜æ²¡ç»“æŸã€‚</p>
<p>ç¬¬äºŒæ¬¡è°ƒç”¨ <code>next()</code> æ–¹æ³•ï¼Œå®ƒä¼šä»ä¸Šæ¬¡ <code>yield</code> è¡¨è¾¾å¼åœä¸‹çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼ï¼ˆæŒ‡é’ˆå¯¹è±¡ä¹Ÿä¼šæŒ‡å‘æ­¤å¤„ï¼‰ï¼Œå¹¶è¿”å› <code>IteratorResult</code> å¯¹è±¡ï¼š<code>{ value: '200', done: false }</code></p>
<p>ç¬¬ä¸‰æ¬¡è°ƒç”¨ <code>next()</code> æ–¹æ³•ï¼Œæ‰§è¡Œè¿‡ç¨‹åŒç†ã€‚å®ƒé‡åˆ° <code>return</code> è¯­å¥éå†å°±ç»“æŸäº†ã€‚è¿”å› <code>IteratorResult</code> å¯¹è±¡ä¸ºï¼š<code>{ value: '300', done: true }</code>ï¼Œå…¶ä¸­ <code>value</code> å¯¹åº” <code>return</code> è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚å¦‚æœ Generator å‡½æ•°å†…æ²¡æœ‰ <code>return</code> è¯­å¥ï¼Œé‚£ä¹ˆ <code>value</code> å±æ€§å€¼ä¸º <code>undefined</code>ï¼Œå› æ­¤è¿”å› <code>{ value: undefined, done: true }</code>ã€‚</p>
<p>ç¬¬å››æ¬¡è°ƒç”¨ next() æ–¹æ³•ï¼Œè¿”å› <code>{ value: undefined, done: true }</code>ï¼ŒåŸå› æ˜¯ç”Ÿæˆå™¨å¯¹è±¡ <code>gen</code> å·²éå†ç»“æŸã€‚å½“è¿­ä»£å™¨å·²éå†ç»“æŸï¼Œæ— è®ºä½ å†è°ƒç”¨å¤šå°‘æ¬¡ <code>next()</code> æ–¹æ³•ï¼Œéƒ½æ˜¯è¿”å›è¿™ä¸ªå€¼ã€‚</p>
<h3>2. yield è¡¨è¾¾å¼</h3>
<p>ç”Ÿæˆå™¨å‡½æ•°è¿”å›çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨ <code>next()</code> æ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒæä¾›äº†ä¸€ç§å¯ä»¥æš‚åœæ‰§è¡Œçš„å‡½æ•°ã€‚è€Œ <code>yield</code> è¡¨è¾¾å¼å°±æ˜¯æš‚åœæ ‡å¿—ã€‚</p>
<p>éå†å™¨å¯¹è±¡çš„ <code>next()</code> æ–¹æ³•çš„è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰é‡åˆ° <code>yield</code> è¡¨è¾¾å¼ï¼Œå°±æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†ç´§è·Ÿåœ¨ <code>yield</code> åé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„ <code>value</code> å±æ€§å€¼ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸‹ä¸€æ¬¡è°ƒç”¨<code>next()</code>æ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼ã€‚</p>
<p>ï¼ˆ3ï¼‰å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„ <code>yield</code> è¡¨è¾¾å¼ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ° <code>return</code> è¯­å¥ä¸ºæ­¢ï¼Œå¹¶å°† <code>return</code> è¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„ <code>value</code> å±æ€§å€¼ã€‚</p>
<p>ï¼ˆ4ï¼‰å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰ <code>return</code> è¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„ <code>value</code> å±æ€§å€¼ä¸º <code>undefined</code>ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>yield</code> è¡¨è¾¾å¼åé¢çš„è¡¨è¾¾å¼ï¼Œåªæœ‰åœ¨è°ƒç”¨ <code>next()</code> æ–¹æ³•ï¼Œä¸”å†…éƒ¨æŒ‡é’ˆæŒ‡å‘è¯¥è¯­å¥æ—¶æ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤ç›¸å½“äºä¸º JavaScript æä¾›äº†æ‰‹åŠ¨çš„â€œæƒ°æ€§æ±‚å€¼â€ï¼ˆLazy Evaluationï¼‰çš„è¯­æ³•åŠŸèƒ½ã€‚</p>
<pre><code class="language-js">function* generatorFn() {
  // è¯·æ³¨æ„ yield å…³é”®å­—åé¢çš„è¡¨è¾¾å¼ï¼Œæ˜¯æƒ°æ€§æ±‚å€¼çš„ï¼
  // ä¸ºäº†æ›´æ˜æ˜¾åœ°è¯´æ˜é—®é¢˜ï¼Œè¿™é‡Œä½¿ç”¨ IIFEã€‚
  yield (function () {
    console.log('here here')
    return 1
  })()
}

const gen = generatorFn()
gen.next() // è°ƒç”¨ next æ–¹æ³•æ‰ä¼šæ‰“å°å‡ºï¼š&quot;here here&quot;
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>yield</code> åé¢çš„ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼Œä¸ä¼šåœ¨è°ƒç”¨ <code>generatorFn()</code> åç«‹å³æ±‚å€¼ï¼Œåªä¼šåœ¨è°ƒç”¨ <code>gen.next()</code> æ–¹æ³•æ‰ä¼šè¿›è¡Œæ±‚å€¼ã€‚</p>
<h3>3. yield ä¸ return çš„ç‰¹ç‚¹åŠå¼‚åŒç‚¹</h3>
<blockquote>
<ul>
<li>
<p>æ— è®ºæ™®é€šå‡½æ•°è¿˜æ˜¯ Generator å‡½æ•°ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª <code>return</code> è¯­å¥ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°çš„ç»ˆæ­¢ã€‚è‹¥æ²¡æœ‰æ˜¾å¼å£°æ˜ï¼Œç›¸å½“äºåœ¨å‡½æ•°ä½“æœ€å <code>return undefined</code>ã€‚</p>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼ï¼Œåªèƒ½åœ¨ Generator å‡½æ•°å†…ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ª Generator å‡½æ•°ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª <code>yield</code> è¯­å¥ã€‚æ¯ä¸ª <code>yield</code> è¯­å¥å¯¹åº”ç”Ÿæˆå™¨çš„ä¸€ä¸ªçŠ¶æ€ã€‚</p>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼å…·å¤‡â€œè®°å¿†â€åŠŸèƒ½ï¼Œè€Œ <code>return</code> æ˜¯ä¸å…·å¤‡çš„ã€‚æ¯å½“é‡åˆ° <code>yield</code>ï¼Œå‡½æ•°æš‚åœæ‰§è¡Œï¼Œä¸‹ä¸€æ¬¡å†ä»è¯¥ä½ç½®ç»§ç»­å‘åæ‰§è¡Œã€‚å®ƒæ˜¯ç”±è¿­ä»£å™¨å†…éƒ¨ç”±ä¸€ä¸ªï¼ˆæŒ‡é’ˆï¼‰å¯¹è±¡å»ç»´æŠ¤çš„ï¼Œæˆ‘ä»¬æ— éœ€å…³å¿ƒã€‚</p>
</li>
<li>
<p>Generator å‡½æ•°å†…éƒ¨å¯ä»¥ä¸ç”¨ <code>yield</code> è¡¨è¾¾å¼ã€‚ä½†å¦‚æœè¿™æ ·ä½¿ç”¨ Generator å‡½æ•°å°±æ²¡æ„ä¹‰äº†ï¼Œä¸å¦‚è€ƒè™‘ä½¿ç”¨æ™®é€šå‡½æ•°ã€‚</p>
</li>
<li>
<p>ç†è®ºä¸Šï¼Œ<code>yield</code> è¡¨è¾¾å¼å¯ä»¥è¿”å›ä»»ä½•å€¼ã€‚è‹¥è¯­å¥ä»…æœ‰ <code>yield;</code>ï¼Œç›¸å½“äº <code>yield undefined;</code>ã€‚</p>
</li>
</ul>
</blockquote>
<h3>4. yield æ³¨æ„ç‚¹</h3>
<p>è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°è¯­æ³•é”™è¯¯ã€‚</p>
<pre><code class="language-js">// ï¸ 1. yield åªèƒ½ç”¨åœ¨ Generator å‡½æ•°é‡Œé¢
function* foo() {
  [1].map(item =&gt; {
    yield item // SyntaxError
    // è¿™é‡Œ Array.prototype.map() çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°
  })
}

// ï¸ 2. å½“ yield è¡¨è¾¾å¼ä½œç”¨äºå¦å¤–ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¿…é¡»æ”¾å…¥åœ†æ‹¬å·é‡Œé¢
function* foo() {
  // Wrong
  // console.log('Hello' + yield) // SyntaxError
  // console.log('Hello' + yield 'World') // SyntaxError

  // Correct
  console.log('Hello ' + (yield))
  console.log('Hello ' + (yield 'World'))
  // ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œï¼ˆå¤šæ¬¡ï¼‰è°ƒç”¨ç”Ÿæˆå™¨å®ä¾‹çš„ next() æ–¹æ³•
  // ä»¥ä¸Šä¸¤ä¸ªéƒ½ä¼šæ‰“å°å‡º &quot;Hello undefined&quot;ï¼Œå¹¶ä¸æ˜¯æƒ³è±¡ä¸­çš„ &quot;Hello World&quot;ã€‚
  // yield è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å› undefinedï¼Œ
  // yield å…³é”®å­—åé¢çš„è¡¨è¾¾å¼ç»“æœï¼Œåªä¼šä½œä¸º IteratorResult å¯¹è±¡çš„ value å€¼ã€‚
}

// ï¸ yield è¡¨è¾¾å¼å¯ä»¥ç”¨ä½œå‡½æ•°å‚æ•°ï¼Œæˆ–æ”¾åœ¨è¡¨è¾¾å¼çš„å³è¾¹ï¼Œå¯ä»¥ä¸åŠ æ‹¬å·
function* foo() {
  const bar = (a, b) =&gt; {
    console.log('paramA:', a)
    console.log('paramB:', b)
  }
  bar(yield 'AAA', yield 'BBB')

  let input = yield
  return input
  // å¤šæ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œbar å‡½æ•°ä¸­ï¼Œåªä¼šæ‰“å°å‡ºï¼š&quot;paramA: undefined&quot;ã€&quot;paramB: undefined&quot;
  // åŸå› ç¬¬ 2 ç‚¹æåˆ°è¿‡äº†
}
</code></pre>
<p>Generator å‡½æ•°è¿˜å¯ä»¥è¿™æ ·ç”¨ï¼š</p>
<pre><code class="language-js">// å‡½æ•°å£°æ˜å½¢å¼
function* generatorFn() {}

// å‡½æ•°è¡¨è¾¾å¼å½¢å¼
const generatorFn = function* () {}

// ä½œä¸ºå¯¹è±¡å±æ€§
const obj = {
  * generatorFn() {} // or
  // generatorFn: function* () {}
}

// ä½œä¸ºç±»çš„å®ä¾‹æ–¹æ³•ï¼Œæˆ–ç±»çš„é™æ€æ–¹æ³•
class Foo {
  static * generatorFn() {}
  * generatorFn() {}
}
</code></pre>
<h2>ä¸‰ã€Generator åº”ç”¨è¯¦è§£</h2>
<p>å‰é¢æåˆ°çš„åªæ˜¯ç”Ÿæˆå™¨å‡½æ•°çš„è¯­æ³•ä¸ç®€å•ç”¨æ³•ï¼Œå¹¶æ²¡æœ‰ä½“ç°å…¶å¼ºå¤§ä¹‹å¤„ã€‚</p>
<h3>1. Generator ä¸ Iterator</h3>
<p>ç”Ÿæˆå™¨é‡Œé¢æ˜¯éƒ¨ç½²äº† Iterator æ¥å£ï¼Œå› æ­¤å¯ä»¥æŠŠå®ƒå½“åšè¿­ä»£å™¨ä¾› <code>for...of</code> ç­‰ä½¿ç”¨ã€‚å‰é¢ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/257">æ–‡ç« </a>æåˆ°ï¼Œä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°æ¥å®ç°è‡ªå®šä¹‰è¿­ä»£å™¨ã€‚</p>
<p>çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  *[Symbol.iterator]() {
    let point = this.min
    const end = this.max
    while (point &lt;= end) {
      yield point++
    }
  }
}

const counter = new Counter([0, 3])
const gen = counter[Symbol.iterator]() // gen æ—¢æ˜¯ç”Ÿæˆå™¨ï¼Œåˆæ˜¯è¿­ä»£å™¨
for (const x of gen) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š0ã€1ã€2ã€3
</code></pre>
<h3>2. next æ–¹æ³•ä¼ å‚</h3>
<p><code>yield</code> è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å› <code>undefined</code>ã€‚<code>next()</code> æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°è¢«ä½œä¸ºä¸Šä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚</p>
<pre><code class="language-js">function* generatorFn() {
  let str = 'Hello ' + (yield 'World')
  console.log(str)
  return str
}
const gen1 = generatorFn()
const gen2 = generatorFn()
</code></pre>
<p>ä¸ä¼ é€’å‚æ•°æ—¶ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// ç¬¬ä¸€æ¬¡è°ƒç”¨ next()
console.log(gen1.next())
// æ‰“å°å‡ºï¼š{ done: false, value: 'World' }

// ç¬¬äºŒæ¬¡è°ƒç”¨ next()
console.log(gen1.next())
// &quot;Hello undefined&quot;
// { done: true, value: 'Hello undefined' }
</code></pre>
<p>ç›¸ä¿¡åˆšå¼€å§‹å­¦ Generator çš„ç«¥é‹ï¼Œä¼šè®¤ä¸ºåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨ <code>gen1.next()</code> æ–¹æ³•æ—¶ï¼Œ<code>str</code> å˜é‡çš„å€¼ä¼šå˜æˆ <code>'Hello World'</code>ï¼Œå½“åˆæˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼Œä½†è¿™æ˜¯é”™è¯¯çš„ï¼Œ<code>str</code> çš„å€¼ <code>'Hello undefined'</code>ã€‚</p>
<p><code>yield</code> å…³é”®å­—åé¢çš„è¡¨è¾¾å¼ç»“æœï¼Œä»…ä½œä¸º <code>next()</code> æ–¹æ³•çš„è¿”å›å¯¹è±¡ <code>IteratorResult</code> çš„ <code>value</code> å±æ€§å€¼ï¼Œå³ï¼š<code>{ done: false, value: 'World' }</code>ã€‚</p>
<p><strong>ä½†å¦‚æœæˆ‘ä»¬åœ¨ <code>next()</code> æ–¹æ³•è¿›è¡Œä¼ å‚å‘¢ï¼Ÿ</strong></p>
<pre><code class="language-js">// ç¬¬ä¸€æ¬¡è°ƒç”¨ next()
console.log(gen2.next('Invalid'))
// æ‰“å°å‡ºï¼š{ done: false, value: 'World' }

// ç¬¬äºŒæ¬¡è°ƒç”¨ next()
console.log(gen2.next('JavaScript'))
// &quot;Hello JavaScript&quot;
// { done: true, value: 'Hello JavaScript' }
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº <code>next()</code> æ–¹æ³•è¡¨ç¤ºä¸Šä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå› æ­¤åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ <code>next()</code> æ–¹æ³•æ—¶ï¼Œä¼ é€’çš„å‚æ•°æ˜¯æ— æ•ˆçš„ã€‚<strong>åªæœ‰ç¬¬äºŒæ¬¡ï¼ˆèµ·ï¼‰è°ƒç”¨ <code>next()</code> æ–¹æ³•ï¼Œå‚æ•°æ‰æœ‰æ•ˆ</strong>ã€‚ä»è¯­ä¹‰ä¸Šè®²ï¼Œç¬¬ä¸€ä¸ª <code>next()</code> æ–¹æ³•ç”¨äºå¯åŠ¨éå†å™¨å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ç”¨å¸¦æœ‰å‚æ•°ã€‚</p>
</blockquote>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>gen2.next('Invalid')</code> æ—¶ï¼Œå‚æ•° <code>'Invalid'</code> æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥ç»“æœè¿˜æ˜¯ <code>{ done: false, value: 'World' }</code>ã€‚</p>
<p>å½“ç¬¬äºŒæ¬¡è°ƒç”¨ <code>gen2.next('JavaScript')</code> æ—¶ï¼Œç”±äºè¯¥å‚æ•°å°†ä½œä¸ºä¸Šä¸€æ¬¡ <code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚æ‰€ä»¥ <code>let str = 'Hello ' + (yield 'World')</code> å°±ç›¸å½“äº <code>let str = 'Hello ' + 'JavaScript'</code>ï¼Œå› æ­¤ <code>str</code> å°±å˜æˆäº† <code>'Hello JavaScript'</code>ï¼Œè‡ªç„¶ <code>gen2.next()</code> çš„è¿”å›å€¼å°±æ˜¯ <code>{ done: true, value: 'Hello JavaScript' }</code>ã€‚</p>
<blockquote>
<p>è¿™ä¸ªåŠŸèƒ½æœ‰å¾ˆé‡è¦çš„è¯­æ³•æ„ä¹‰ã€‚Generator å‡½æ•°ä»æš‚åœçŠ¶æ€åˆ°æ¢å¤è¿è¡Œï¼Œå®ƒçš„ä¸Šä¸‹æ–‡çŠ¶æ€ï¼ˆcontextï¼‰æ˜¯ä¸å˜çš„ã€‚é€šè¿‡ç»™ <code>next()</code> æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œå°±æœ‰åŠæ³•åœ¨ Generator å‡½æ•°å¼€å§‹è¿è¡Œä¹‹åï¼Œç»§ç»­å‘å‡½æ•°ä½“å†…éƒ¨æ³¨å…¥å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨ Generator å‡½æ•°è¿è¡Œçš„ä¸åŒé˜¶æ®µï¼Œä»å¤–éƒ¨å‘å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œè°ƒæ•´å‡½æ•°è¡Œä¸ºã€‚</p>
</blockquote>
<p>å¦‚æœè¿˜æ²¡å¼„æ‡‚ï¼Œå†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* foo(x) {
  const y = 2 * (yield (x + 1))
  const z = yield (y / 3)
  return (x + y + z)
}

const f1 = foo(5)
f1.next()     // { done: false, value: 6 }
f1.next()     // { done: false, value: NaN }
f1.next()     // { done: true, value: NaN }

const f2 = foo(5)
f2.next()     // { done: false, value: 6 }
f2.next(12)   // { done: false, value: 8 }
f2.next(13)   // { done: true, value: 42 }

// è‹¥ç»“æœè·Ÿä½ å†…å¿ƒé¢„æœŸçš„ä¸€æ ·ï¼Œé‚£è¯´æ˜ä½ å¼„æ˜ç™½äº†ï¼
</code></pre>
<p>å¦‚æœæƒ³åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>next()</code> æ–¹æ³•æ—¶ä¼ å…¥å‚æ•°å¹¶ä½¿å…¶æœ‰æ•ˆã€‚æ¢ä¸ªæ€è·¯å°±è¡Œï¼šåœ¨ Generator å‡½æ•°å¤–é¢åŒ…è£¹ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ­¤å‡½æ•°å†…éƒ¨è°ƒç”¨ç¬¬ä¸€æ¬¡ï¼Œå¹¶è¿”å›ç”Ÿæˆå™¨å³å¯ã€‚</p>
<pre><code class="language-js">function genWrapper(genFn) {
  return function (...args) {
    const g = genFn(...args)
    g.next() // å…¶å®æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†çœŸæ­£æ„ä¹‰ä¸Šçš„ç¬¬ä¸€æ¬¡ next æ–¹æ³•ã€‚
    return g
  }
}

function* generatorFn() {
  let str = 'Hello ' + (yield 'World')
  console.log(str)
  return str
}

const gen = genWrapper(generatorFn)(5)

// è¿™æ ·åœ¨å¤–éƒ¨è°ƒç”¨ next() å°±ç®—æ˜¯â€œç¬¬ä¸€æ¬¡â€
gen.next('JavaScript') // { done: true, value: 'Hello JavaScript' }
</code></pre>
<h3>3. for...of è¯­å¥</h3>
<p><code>for...of</code> è¯­å¥æ˜¯ ES6 æ ‡å‡†æ–°å¢çš„ä¸€ç§å¾ªç¯éå†çš„çš„æ–¹å¼ï¼Œä¸ºäº† Iterator è€Œç”Ÿçš„ã€‚åªæœ‰ä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥éå†ã€‚</p>
<p><strong>é‚£ for...of ä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢å¾ªç¯å‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ <code>for...of</code> å†…éƒ¨å…¶å®æ˜¯ä¸æ–­è°ƒç”¨è¿­ä»£å™¨ <code>next()</code> çš„è¿‡ç¨‹ï¼Œå½“ <code>next()</code> æ–¹æ³•è¿”å›çš„ <code>IteratorResult</code> å¯¹è±¡çš„ <code>done</code> å±æ€§ä¸º <code>true</code> æ—¶ï¼Œå¾ªç¯å°±ä¼šä¸­æ­¢ï¼Œ<strong>ä¸”ä¸åŒ…å«è¿”å›å¯¹è±¡</strong>ã€‚</p>
<p>è¯·çœ‹ç¤ºä¾‹å’Œæ³¨é‡Šï¼š</p>
<pre><code class="language-js">function* generatorFn() {
  yield 1
  yield 2
  yield 3
  yield 4
  yield 5
  return 6 // ä¸€èˆ¬ä¸æŒ‡å®š return è¯­å¥
}

const gen = generatorFn()
for (const x of gen) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š1ã€2ã€3ã€4ã€5

console.log([...gen]) // æ‰“å°ç»“æœä¸ºï¼š[]

// ï¸
// ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿­ä»£å™¨æ˜¯ä¸æŒ‡å®š return è¯­å¥çš„ï¼Œå³è¿”å› return undefinedï¼Œ
// å› ä¸ºé‡åˆ° return æ—¶ï¼Œè°ƒç”¨ next ä¼šè¿”å›ï¼š{ done: true, value: 'å¯¹åº”returnçš„ç»“æœ' }
// è¿™æ—¶æ— è®ºä½¿ç”¨ for...ofï¼Œè¿˜æ˜¯æ•°ç»„è§£æ„æˆ–å…¶ä»–ï¼Œå®ƒä»¬çœ‹åˆ°çŠ¶æ€ done ä¸º trueï¼ˆè¡¨ç¤ºéå†ç»“æŸï¼‰ï¼Œ
// å®ƒä»¬å°±åœæ­¢å¾€ä¸‹éå†äº†ï¼Œè€Œä¸”ä¸ä¼šéå† { done: true } çš„è¿™ä¸€æ¬¡å“¦ï¼
// æ‰€ä»¥ï¼Œç¤ºä¾‹ä¸­ for...of åªä¼šæ‰“å°å‡º 0 ~ 5ï¼Œè€Œä¸åŒ…æ‹¬ 6ã€‚
// åŒç†ï¼Œæ‰§è¡Œåˆ° [...gen] æ—¶ï¼Œç”±äºæ­¤å‰è¿­ä»£å™¨å·²ç»æ˜¯ done: true ç»“æŸçŠ¶æ€ï¼Œ
// å› æ­¤è§£æ„ç»“æœå°±æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼š[]
</code></pre>
<p>æ­¤å‰çš„<a href="https://github.com/toFrankie/blog/issues/257">æ–‡ç« </a>æåˆ°è¿‡ï¼Œè¿­ä»£å™¨æ˜¯ä¸€æ¬¡æ€§å¯¹è±¡ï¼Œè€Œä¸”ä¸åº”è¯¥é‡ç”¨ç”Ÿæˆå™¨ã€‚ä¾‹å¦‚ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå·²ç»ä½¿ç”¨ <code>for...of</code> å»éå†å®Œ <code>gen</code> å¯¹è±¡äº†ï¼Œç„¶åè¿˜ä½¿ç”¨è§£æ„å»éå† <code>gen</code> å¯¹è±¡ï¼Œç”±äºè§£æ„ä¹‹å‰ <code>gen</code> å¯¹è±¡å·²ç»“æŸï¼Œå†å»ä½¿ç”¨å°±æ²¡æ„ä¹‰äº†ã€‚</p>
<p>å†çœ‹ç¤ºä¾‹ï¼Œä½ å°±æ˜ç™½äº†ï¼š</p>
<pre><code class="language-js">function* foo() {
  yield 1
  yield 2
  return 3
  yield 4
}

[...foo()] // [1, 2]
Array.from(foo()) // [1, 2]
const [x, y] = foo() // x ä¸º 1, y ä¸º 2
for (const x of foo()) { console.log(x) } // ä¾æ¬¡æ‰“å°ï¼š1ã€2
</code></pre>
<p>æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ <code>for...of</code> æˆ–æ˜¯è§£æ„æ“ä½œï¼Œé‡åˆ°çŠ¶æ€ <code>done</code> ä¸º <code>true</code> å°±ä¼šä¸­æ­¢ï¼Œ<strong>ä¸”ä¸åŒ…å«è¿”å›å¯¹è±¡</strong>ã€‚</p>
<p><code>for...of</code> æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª <code>while</code> å¾ªç¯ã€‚</p>
<pre><code class="language-js">const arr = [1, 2, 3]
for (const x of arr) {
  console.log(x)
}

// ç›¸å½“äº
const iter = arr[Symbol.iterator]() // è¿­ä»£å™¨
let iterRes = iter.next() // IteratorResult
while (!iterRes.done) { // å½“ done ä¸º true æ—¶é€€å‡ºå¾ªç¯
  console.log(iterRes.value)
  iterRes = iter.next()
}
</code></pre>
<blockquote>
<p>å»ºè®®ï¼šåŒä¸€ä¸ªè¿­ä»£å™¨æœ€å¥½ä¸è¦é‡å¤ä½¿ç”¨ã€‚</p>
</blockquote>
<h3>4. Generator.prototype.return()</h3>
<p>æ­¤å‰çš„<a href="https://github.com/toFrankie/blog/issues/257">æ–‡ç« </a>æåˆ°è¿‡ï¼Œè¿­ä»£å™¨è¦æå‰é€€å‡ºï¼Œå¹¶â€œå…³é—­â€è¿­ä»£å™¨ï¼ˆå³çŠ¶æ€ <code>done</code> å˜ä¸º <code>true</code>ï¼‰ï¼Œéœ€è¦å®ç°è¿­ä»£å™¨åè®®çš„ <code>return()</code> æ–¹æ³•ã€‚</p>
<p>ä¹Ÿæåˆ°è¿‡ï¼Œç”Ÿæˆå™¨å¯¹è±¡æœ¬èº«å®ç°äº† <code>return()</code> æ–¹æ³•ã€‚å› æ­¤ï¼Œå› åº”ä¸åŒåœºæ™¯ï¼Œä½¿ç”¨ <code>break</code>ã€<code>continue</code>ã€<code>return</code>ã€<code>throw</code> æˆ–æ•°ç»„è§£æ„æœªæ¶ˆè´¹æ‰€æœ‰å€¼æ—¶ï¼Œéƒ½ä¼šæå‰å…³é—­çŠ¶æ€ã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 1
  yield 2
  console.log('here')
  yield 3
}

// æƒ…å†µä¸€ï¼šå±äºæœªæ¶ˆè´¹æ‰€æœ‰å€¼ï¼Œä¹Ÿä¼šæå‰å…³é—­ã€‚å…¶ä¸­ x ä¸º 1, y ä¸º 2ã€‚
const [x, y] = foo()

// æƒ…å†µäºŒï¼šä½¿ç”¨ break æå‰é€€å‡ºï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œåˆ° console.log('here') è¿™æ¡è¯­å¥ã€‚
for (const x of foo()) {
  console.log(x)
  if (x === 2) break
}
// ä¾æ¬¡æ‰“å°ï¼š1ã€2

// æƒ…å†µä¸‰ï¼šå±äºä»å¼€å§‹åˆ°ç»“å°¾ï¼Œè¿­ä»£å®Œå…¨
for (const x of foo()) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š1ã€2ã€&quot;here&quot;ã€3
</code></pre>
<p>å¯¹äºç”Ÿæˆå™¨å¯¹è±¡ï¼Œé™¤äº†é€šè¿‡ä»¥ä¸Šæ–¹å¼â€œæå‰å…³é—­â€ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ª <code>Generator.prototype.return()</code> æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 1
  yield 2
  yield 3
}

const gen = foo()
gen.next() // { done: false, value: 1 }
gen.return('closed') // { done: true, value: 'closed' } // è‹¥ return ä¸ä¼ å‚æ—¶ï¼Œvalue ä¸º undefinedã€‚
gen.next() // { done: true, value: undefined }
</code></pre>
<p>æ³¨æ„ï¼Œ<code>return()</code> æ–¹æ³•çš„å‚æ•°æ˜¯å¯é€‰çš„ã€‚å½“ä¼ é€’æŸä¸ªå‚æ•°æ—¶ï¼Œå®ƒå°†ä½œä¸º <code>{ done: true, value: 'å‚æ•°å¯¹åº”çš„å€¼' }</code>ã€‚è‹¥ä¸ä¼ å‚ï¼Œé‚£ä¹ˆ <code>value</code> çš„å€¼ä¸º <code>undefined</code>ã€‚</p>
<p>ä½†å¦‚æœ Generator å‡½æ•°ä½“å†…ï¼ŒåŒ…å« <code>try...finally</code> ä»£ç å—ï¼Œä¸”æ­£åœ¨æ‰§è¡Œ <code>try</code> ä»£ç å—ï¼Œé‚£ä¹ˆ <code>return()</code> æ–¹æ³•ä¼šå¯¼è‡´ç«‹å³è¿›å…¥ <code>finally</code> ä»£ç å—ï¼Œæ‰§è¡Œå®Œä»¥åï¼Œæ•´ä¸ªå‡½æ•°æ‰ä¼šç»“æŸã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 1

  try {
    yield 2
    yield 3
  } finally {
    yield 4
    yield 5
  }

  yield 6
}

// ï¸ æ³¨æ„æ‰§è¡Œé¡ºåºåŠç»“æœ
const gen = foo()
gen.next()             // { done: false, value: 1 }
gen.next()             // { done: false, value: 2 }
gen.return('closed')   // { done: false, value: 4 }
gen.next()             // { done: false, value: 5 }
gen.next()             // { done: true, value: 'closed' }
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨ <code>return()</code> æ–¹æ³•åï¼Œå°±å¼€å§‹æ‰§è¡Œ <code>finally</code> ä»£ç å—ï¼Œä¸æ‰§è¡Œ <code>try</code> é‡Œé¢å‰©ä¸‹çš„ä»£ç äº†ï¼Œç„¶åç­‰åˆ° <code>finally</code> ä»£ç å—æ‰§è¡Œå®Œï¼Œå†è¿”å› <code>return()</code> æ–¹æ³•æŒ‡å®šçš„è¿”å›å€¼ã€‚</p>
<h3>5. Generator.prototype.throw()</h3>
<p>ç”Ÿæˆå™¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>throw()</code> æ–¹æ³•ï¼ˆæ³¨æ„ï¼Œå®ƒè·Ÿå…¨å±€çš„ <code>throw</code> å…³é”®å­—æ˜¯ä¸¤å›äº‹ï¼‰ï¼Œå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨ Generator å‡½æ•°ä½“å†…æ•è·ã€‚</p>
<blockquote>
<p>å½“ç”Ÿæˆå™¨<strong>æœªå¼€å§‹ä¹‹å‰</strong>æˆ–è€…<strong>å·²ç»“æŸï¼ˆå·²å…³é—­ï¼‰ä¹‹å</strong>ï¼Œè°ƒç”¨ç”Ÿæˆå™¨çš„ <code>throw()</code> æ–¹æ³•ã€‚å®ƒçš„é”™è¯¯ä¿¡æ¯ä¼šè¢«ç”Ÿæˆå™¨å‡½æ•°å¤–éƒ¨çš„ <code>try...catch</code> æ•è·åˆ°ã€‚è‹¥å¤–éƒ¨æ²¡æœ‰ <code>try...catch</code> è¯­å¥ï¼Œåˆ™ä¼šæŠ¥é”™ä¸”ä»£ç å°±ä¼šåœæ­¢æ‰§è¡Œã€‚</p>
<ul>
<li>
<p><strong>æœªå¼€å§‹</strong>ï¼Œæ˜¯æŒ‡è°ƒç”¨ Generator å‡½æ•°è¿”å›ç”Ÿæˆå™¨å¯¹è±¡ä¹‹åï¼Œç¬¬ä¸€æ¬¡å°±è°ƒç”¨äº† <code>throw()</code> æ–¹æ³•ã€‚æ­¤æ—¶ç”±äº Generator å‡½æ•°è¿˜æ²¡å¼€å§‹æ‰§è¡Œï¼Œ<code>throw()</code> æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯åªèƒ½æŠ›å‡ºåˆ° Generator å‡½æ•°å¤–ã€‚</p>
</li>
<li>
<p><strong>å·²ç»“æŸ</strong>ï¼Œæ˜¯æŒ‡ç”Ÿæˆå™¨å¯¹è±¡çš„çŠ¶æ€æ˜¯ <code>{ done: true }</code>ã€‚æ­¤åå†è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡ <code>throw()</code> æ–¹æ³•ï¼Œé”™è¯¯åªèƒ½åœ¨ Generator å‡½æ•°å¤–è¢«æ•è·ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šä¸¤ç§æƒ…å†µå‡ä¸ä¼šè¢« Generator å‡½æ•°å†…éƒ¨çš„ <code>try...catch</code> æ•è·åˆ°ã€‚</p>
</blockquote>
<p>çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* generatorFn() {
  try {
    yield
  } catch (e) {
    console.log('Generator Inner:', e)
  }
}

const gen = generatorFn()
gen.next()

try {
  console.log(gen.throw('a'))
  console.log(gen.throw('b'))
} catch (e) {
  console.log('Generator Outer:', e)
}

// ä¾æ¬¡æ‰“å°å‡ºï¼š
// &quot;Generator Inner: a&quot;
// { value: undefined, done: true }
// &quot;Generator Outer: b&quot;
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå½“ä»£ç æ‰§è¡Œåˆ° <code>gen.throw('a')</code> æ—¶ï¼ˆæ­¤å‰å·²è°ƒç”¨è¿‡ä¸€æ¬¡ <code>gen.next()</code> äº†ï¼‰ï¼Œç”±äº Generator å‡½æ•°ä½“å†…éƒ¨ç½²äº† <code>try...catch</code> è¯­å¥å—ï¼Œå› æ­¤åœ¨å¤–éƒ¨çš„ <code>gen.throw('a')</code> ä¼šè¢«å†…éƒ¨çš„ <code>catch</code> æ•è·åˆ°ï¼Œè€Œä¸”å‚æ•° <code>'a'</code> å°†ä½œä¸º <code>catch</code> è¯­å¥å—çš„å‚æ•°ï¼Œæ‰€ä»¥æ‰“å°å‡º <code>'Generator Inner: a'</code>ã€‚</p>
<p><strong>è¯·æ³¨æ„ï¼Œå½“ <code>throw()</code> æ–¹æ³•è¢«æ•è·åˆ°ä¹‹åï¼Œä¼šâ€œè‡ªåŠ¨â€æ‰§è¡Œä¸‹ä¸€æ¡ <code>yield</code> è¡¨è¾¾å¼ï¼Œç›¸å½“äºè°ƒç”¨ä¸€æ¬¡ <code>next()</code> æ–¹æ³•</strong>ã€‚ç”±äº Generator å‡½æ•°ä½“å†…åœ¨æ‰§è¡Œ <code>catch</code> ä¹‹åï¼Œå·²ç»æ²¡æœ‰å…¶ä»–è¯­å¥ï¼Œç›¸å½“äºæœ‰ä¸€ä¸ªéšå¼çš„ <code>return undefined</code>ï¼Œå³ <code>gen</code> å¯¹è±¡ä¼šå˜æˆ <code>done</code> ä¸º <code>true</code> è€Œå…³é—­ã€‚æ‰€ä»¥ <code>console.log(gen.throw('a'))</code> å°±ä¼šæ‰“å°å‡º <code>{ value: undefined, done: true }</code>ã€‚</p>
<p>å®Œäº†ç»§ç»­æ‰§è¡Œ <code>gen.throw('b')</code> æ–¹æ³•ï¼Œç”±äº <code>gen</code> å·²ç»æ˜¯â€œç»“æŸçŠ¶æ€â€ï¼Œæ‰€ä»¥ <code>throw()</code> æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯å°†ä¼šåœ¨ Generator å‡½æ•°å¤–éƒ¨è¢«æ•è·åˆ°ã€‚æ‰€ä»¥å°±æ˜¯æ‰“å°å‡ºï¼š<code>'Generator Outer: b'</code>ã€‚</p>
<p>æ€•æœ‰äººè¿˜æ²¡å®Œå…¨ç†è§£ï¼Œå†ç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* generatorFn() {
  try {
    yield 1
  } catch (e) {
    console.log('Generator Inner:', e)
  }
  yield 2
}

const gen = generatorFn()
console.log(gen.next())
console.log(gen.throw(new Error('Oops')))
console.log(gen.next())
// ä¾æ¬¡æ‰“å°å‡ºï¼š
// { value: 1, done: false }
// &quot;Generator Inner: Error: Oops&quot;
// { value: 2, done: false }
// { value: undefined, done: true }
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œ<code>gen.throw()</code> ä¹‹åï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ <code>next()</code> æ–¹æ³•ï¼Œå³æ‰§è¡Œåˆ° <code>yield 2</code>ï¼Œå› æ­¤è¿”å›çš„ <code>IteratorResult</code> å¯¹è±¡ä¸ºï¼š<code>{ value: 2, done: false }</code>ã€‚æ¥ç€å†æ‰§è¡Œä¸€æ¬¡ <code>gen.next()</code> æ–¹æ³•ç”Ÿæˆå™¨å°±ä¼šå˜æˆå…³é—­çŠ¶æ€ã€‚</p>
<blockquote>
<p>è¿™ç§å‡½æ•°ä½“å†…æ•è·é”™è¯¯çš„æœºåˆ¶ï¼Œå¤§å¤§æ–¹ä¾¿äº†å¯¹é”™è¯¯çš„å¤„ç†ã€‚å¤šä¸ª <code>yield</code> è¡¨è¾¾å¼ï¼Œå¯ä»¥åªç”¨ä¸€ä¸ª <code>try...catch</code> ä»£ç å—æ¥æ•è·é”™è¯¯ã€‚å¦‚æœä½¿ç”¨å›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œæƒ³è¦æ•è·å¤šä¸ªé”™è¯¯ï¼Œå°±ä¸å¾—ä¸ä¸ºæ¯ä¸ªå‡½æ•°å†…éƒ¨å†™ä¸€ä¸ªé”™è¯¯å¤„ç†è¯­å¥ï¼Œç°åœ¨åªåœ¨ Generator å‡½æ•°å†…éƒ¨å†™ä¸€æ¬¡ <code>try...catch</code> è¯­å¥å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<p>è¿˜æœ‰ï¼Œå½“ Generator å‡½æ•°å†…æŠ¥é”™ï¼Œä¸”æœªè¢«æ•è·ï¼Œç”Ÿæˆå™¨å°±ä¼šå˜æˆâ€œå…³é—­â€çŠ¶æ€ã€‚è‹¥åç»­å†æ¬¡è°ƒç”¨æ­¤ç”Ÿæˆå™¨çš„ <code>next()</code> æ–¹æ³•ï¼Œåªä¼šè¿”å› <code>{ done: true, value: undefined }</code> ç»“æœã€‚</p>
<h3>6. nextã€returnã€throw çš„å…±åŒç‚¹</h3>
<p>å…¶å® <code>next()</code>ã€<code>return()</code>ã€<code>throw()</code> ä¸‰ä¸ªæ–¹æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯åŒä¸€äº‹ä»¶ï¼Œå¯ä»¥æ”¾åœ¨ä¸€èµ·ç†è§£ã€‚å®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯è®© Generator å‡½æ•°æ¢å¤æ‰§è¡Œï¼Œå…µå™¨ä½¿ç”¨ä¸åŒçš„è¯­å¥æ›¿æ¢ <code>yield</code> è¡¨è¾¾å¼ã€‚</p>
<pre><code class="language-js">const gen = function* (x, y) {
  const result = yield x + y
  return result
}(1, 2)

gen.next() // { done: false, value: 3 }
</code></pre>
<p><code>next()</code> æ–¹æ³•æ˜¯å°† <code>yield</code> è¡¨è¾¾å¼æ›¿æ¢æˆä¸€ä¸ªå€¼ã€‚æ³¨æ„ï¼Œé¦–æ¬¡è°ƒç”¨ <code>next()</code> æ–¹æ³•è¿›è¡Œä¼ å‚æ˜¯æ— æ•ˆçš„ï¼Œä»ç¬¬äºŒæ¬¡èµ·æ‰æœ‰æ•ˆã€‚</p>
<pre><code class="language-js">gen.next(10) // { done: true, value: 10 }
// å¦‚æœç¬¬äºŒæ¬¡è°ƒç”¨ next æ–¹æ³•ï¼Œä¸”ä¸ä¼ å‚æ—¶ï¼Œyield è¡¨è¾¾å¼è¿”å›å€¼ä¸º undefinedã€‚å› æ­¤ï¼Œ
// gen.next() // { done: true, value: undefined }
</code></pre>
<p><code>return()</code> æ–¹æ³•æ˜¯å°† <code>yield</code> è¡¨è¾¾å¼æ›¿æ¢æˆä¸€ä¸ª <code>return</code> è¯­å¥</p>
<pre><code class="language-js">gen.return('closed') // { done: true, value: 'closed' }
// è¿™æ ·çš„è¯ `let result = yield x + y` ç›¸å½“äºå˜æˆ `let result = return 'closed'`
</code></pre>
<p><code>throw()</code> æ–¹æ³•æ˜¯å°† <code>yield</code> è¡¨è¾¾å¼æ›¿æ¢æˆä¸€ä¸ª <code>throw</code> è¯­å¥ï¼Œä»¥ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ã€‚</p>
<pre><code class="language-js">gen.throw(new Error('exception')) // æŠ¥é”™ï¼šUncaught Error: exception
// è¿™æ ·çš„è¯ `let result = yield x + y` ç›¸å½“äºå˜æˆ `let result = throw new Error('exception')`
</code></pre>
<h3>7. yield* è¡¨è¾¾å¼</h3>
<p>å¦‚æœåœ¨ Generator å‡½æ•°å†…éƒ¨è°ƒç”¨å¦å¤–ä¸€ä¸ª Generator å‡½æ•°ï¼Œéœ€è¦å‰è€…çš„å‡½æ•°ä½“å†…éƒ¨â€œæ‰‹åŠ¨â€å®Œæˆéå†ã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 'foo1'
  yield 'foo2'
  // return 'something'
  // å‡è®¾æŒ‡å®šä¸€ä¸ª return è¯­å¥ï¼Œ
  // ä½¿ç”¨ yield* foo() è¿­ä»£æ—¶å°†ä¸ä¼šè¢«è¿­ä»£åˆ°ï¼Œ
  // å› æ­¤å¯ä»¥ç†è§£æˆ yield* å†…éƒ¨æ‰§è¡Œäº†ä¸€é for...of å¾ªç¯ã€‚
  // è¿”å›å€¼ somethingï¼Œä»…å½“ let result = yield* foo() ä½¿ç”¨æ—¶ï¼Œä½œä¸º result çš„ç»“æœã€‚
}

function* bar() {
  yield 'bar1'
  for (let x of foo()) {
    console.log(x)
  }
  yield 'bar2'
}

for (let x of bar()) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š
// &quot;foo1&quot;
// &quot;bar1&quot;
// &quot;bar2&quot;
// &quot;foo2&quot;
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>foo</code> å’Œ <code>bar</code> éƒ½æ˜¯Generator å‡½æ•°ï¼Œåœ¨ <code>bar</code> å†…éƒ¨è°ƒç”¨ <code>foo</code>ï¼Œéœ€è¦â€œæ‰‹åŠ¨â€è¿­ä»£ <code>foo</code> çš„ç”Ÿæˆå™¨å®ä¾‹ã€‚å¦‚æœå­˜åœ¨å¤šä¸ª Generator å‡½æ•°åµŒå¥—æ—¶ï¼Œå†™èµ·æ¥å°±ä¼šéå¸¸éº»çƒ¦ã€‚</p>
<p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒES6 æä¾›äº† <code>yield*</code> è¡¨è¾¾å¼ï¼Œç”¨äºåœ¨ä¸€ä¸ª Generator å‡½æ•°é‡Œé¢æ‰§è¡Œå¦å¤–ä¸€ä¸ª Generator å‡½æ•°ã€‚</p>
<p>å› æ­¤ï¼Œä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥åˆ©ç”¨ <code>yield*</code> æ”¹å†™æˆï¼š</p>
<pre><code class="language-js">function* foo() {
  yield 'foo1'
  yield 'foo2'
}

function* bar() {
  yield 'bar1'
  yield* foo()
  yield 'bar2'
}

for (let x of bar()) {
  console.log(x)
}
</code></pre>
<blockquote>
<p>å…³äº <code>yield</code> ä¸ <code>yield*</code> çš„åŒºåˆ«ï¼š</p>
<ul>
<li>
<p><code>yield</code> å…³é”®å­—åé¢ï¼Œå¯ä»¥è·Ÿç€ä¸€ä¸ªå€¼æˆ–è¡¨è¾¾å¼ï¼Œå…¶ç»“æœå°†ä½œä¸º <code>next()</code> æ–¹æ³•è¿”å›å€¼çš„ <code>value</code> å±æ€§å€¼ã€‚</p>
</li>
<li>
<p><code>yield*</code> åé¢ï¼Œåªèƒ½è·Ÿç€ä¸€ä¸ª<strong>å¯è¿­ä»£å¯¹è±¡</strong>ï¼ˆå³å…·æœ‰ Iterator æ¥å£çš„ä»»æ„å¯¹è±¡ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ç”Ÿæˆå™¨æœ¬èº«å°±æ˜¯è¿­ä»£å™¨ï¼Œä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚</p>
</li>
</ul>
</blockquote>
<p>å› æ­¤ï¼Œ<code>yield*</code> åé¢é™¤äº†ç”Ÿæˆå™¨å¯¹è±¡ï¼Œè¿˜å¯ä»¥æ˜¯ä»¥ä¸‹è¿™äº›å¯è¿­ä»£å¯¹è±¡ç­‰ç­‰ã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 'foo1'
  yield* [1, 2] // æ•°ç»„ã€å­—ç¬¦ä¸²å‡å±äºå¯è¿­ä»£å¯¹è±¡
  yield [3, 4] // æœªä½¿ç”¨æ˜Ÿå·æ—¶ï¼Œå°†ä¼šè¿”å›æ•°ç»„
  yield 'foo2'
  yield* 'Hi'
  yield 'JSer' // åŒç†ï¼Œæœªä½¿ç”¨æ˜Ÿå·å°†ä¼šè¿”å›æ•´ä¸ªå­—ç¬¦ä¸²
  // yield 100 // è‹¥ yield* åé¢è·Ÿä¸€ä¸ªä¸å¯è¿­ä»£å¯¹è±¡ï¼Œå°†ä¼šæŠ¥é”™ï¼šTypeError: undefined is not a function
}

for (const x of foo()) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š&quot;foo1&quot;ã€1ã€2ã€[3, 4]ã€&quot;foo2&quot;ã€&quot;H&quot;ã€&quot;i&quot;ã€&quot;JSer&quot;
</code></pre>
<h3>8. Generator å‡½æ•°ä¸­çš„ this</h3>
<p>åœ¨æ™®é€šå‡½æ•°ä¸­ <code>this</code> æŒ‡å‘å½“å‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œç®­å¤´å‡½æ•°åˆ™ä¸å­˜åœ¨ <code>this</code>ï¼Œé‚£ä¹ˆ Generator å‡½æ•°ä¸­ <code>this</code> æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<pre><code class="language-js">function* foo() {}
const gen = foo()
foo.prototype.sayHi = function () { console.log('Hi~') }

console.log(gen instanceof foo) // true
gen.sayHi() // &quot;Hi~&quot;
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ä¾‹ <code>gen</code> ç»§æ‰¿äº† <code>foo.prototype</code>ã€‚Generator å‡½æ•°ç®—æ˜¯æ„é€ å‡½æ•°ï¼Œä½†å®ƒæ˜¯â€œç‰¹æ®Šâ€çš„æ„é€ å‡½æ•°ï¼Œå®ƒä¸è¿”å› <code>this</code> å®ä¾‹ï¼Œè€Œæ˜¯ç”Ÿæˆå™¨å®ä¾‹ã€‚</p>
<pre><code class="language-js">function* foo() {
  this.a = 1
}
const gen = foo()
gen.next()
console.log(gen.a) // undefined

// å…¶å®æˆ‘ä»¬é€šè¿‡æ‰“å° this å¯çŸ¥ï¼Œthis ä»æŒ‡å‘å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒã€‚
// æ­¤å¤„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯å…¨å±€ï¼Œå› æ­¤ this æ˜¯ window å¯¹è±¡ã€‚
// å¦‚æœæ‰§è¡Œ gen.next() æ—¶æ‰€å¤„çš„ä¸Šä¸‹æ–‡æ˜¯æŸä¸ªå¯¹è±¡ï¼ˆå‡è®¾ä¸º objï¼‰ï¼Œ
// é‚£ä¹ˆ this å°±ä¼šæŒ‡å‘ objï¼Œè€Œä¸æ˜¯ gen å¯¹è±¡ã€‚

// çœ‹ç€æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒä»¥ä¸‹è¿™ä¸ªï¼š
// function Bar() {
//   this.a = 1
//   return {} // ä¸è¿”å› thisï¼Œè¿”å›å¦ä¸€ä¸ªå¯¹è±¡
// }
// const bar = new Bar()
// console.log(bar.a) // undefined
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>gen.next()</code> æ–¹æ³•ï¼Œä¼šç»™ <code>this.a</code> èµ‹å€¼ä¸º <code>1</code>ï¼Œæ¥ç€æ‰“å° <code>gen.a</code> çš„ç»“æœå´æ˜¯ <code>undefined</code>ï¼Œè¯´æ˜ <code>this</code> å¹¶ä¸æ˜¯æŒ‡å‘ <code>gen</code> ç”Ÿæˆå™¨å®ä¾‹ã€‚æ‰€ä»¥ï¼ŒGenerator å‡½æ•°è·Ÿå¹³å¸¸çš„æ„é€ å‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>è€Œä¸”ï¼Œä¸èƒ½ä½¿ç”¨ <code>new</code> å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ–ï¼Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">const gen2 = new foo() // TypeError: foo is not a constructor
</code></pre>
<h3>9. Generator ä¸ä¸Šä¸‹æ–‡</h3>
<p>JavaScript ä»£ç è¿è¡Œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå…¨å±€çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆcontextï¼Œåˆç§°è¿è¡Œç¯å¢ƒï¼‰ï¼ŒåŒ…å«äº†å½“å‰æ‰€æœ‰çš„å˜é‡å’Œå¯¹è±¡ã€‚ç„¶åï¼Œæ‰§è¡Œå‡½æ•°ï¼ˆæˆ–å—çº§ä»£ç ï¼‰çš„æ—¶å€™ï¼Œåˆä¼šåœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒçš„ä¸Šå±‚ï¼Œäº§ç”Ÿä¸€ä¸ªå‡½æ•°è¿è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå˜æˆå½“å‰ï¼ˆactiveï¼‰çš„ä¸Šä¸‹æ–‡ï¼Œç”±æ­¤å½¢æˆä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒçš„å †æ ˆï¼ˆcontext stackï¼‰ã€‚</p>
<p>è¿™ä¸ªå †æ ˆæ˜¯â€œ<strong>åè¿›å…ˆå‡º</strong>â€çš„æ•°æ®ç»“æ„ï¼Œæœ€åäº§ç”Ÿçš„ä¸Šä¸‹æ–‡ç¯å¢ƒé¦–å…ˆæ‰§è¡Œå®Œæˆï¼Œé€€å‡ºå †æ ˆï¼Œç„¶åå†æ‰§è¡Œå®Œæˆå®ƒä¸‹å±‚çš„ä¸Šä¸‹æ–‡ï¼Œç›´è‡³æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæˆï¼Œå †æ ˆæ¸…ç©ºã€‚</p>
<p>Generator å‡½æ•°ä¸æ˜¯è¿™æ ·ï¼Œå®ƒæ‰§è¡Œäº§ç”Ÿçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¸€æ—¦é‡åˆ° <code>yield</code> å‘½ä»¤ï¼Œå°±ä¼šæš‚æ—¶é€€å‡ºå †æ ˆï¼Œä½†æ˜¯å¹¶ä¸æ¶ˆå¤±ï¼Œé‡Œé¢çš„æ‰€æœ‰å˜é‡å’Œå¯¹è±¡ä¼šå†»ç»“åœ¨å½“å‰çŠ¶æ€ã€‚ç­‰åˆ°å¯¹å®ƒæ‰§è¡Œ <code>next</code> å‘½ä»¤æ—¶ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒåˆä¼šé‡æ–°åŠ å…¥è°ƒç”¨æ ˆï¼Œå†»ç»“çš„å˜é‡å’Œå¯¹è±¡æ¢å¤æ‰§è¡Œã€‚</p>
<pre><code class="language-js">function* foo() {
  yield 1
  return 2
}

let gen = foo()

console.log(
  gen.next().value,
  gen.next().value
)
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>gen.next()</code>æ—¶ï¼ŒGenerator å‡½æ•° <code>foo </code> çš„ä¸Šä¸‹æ–‡ä¼šåŠ å…¥å †æ ˆï¼Œå³å¼€å§‹è¿è¡Œ <code>foo</code> å†…éƒ¨çš„ä»£ç ã€‚ç­‰é‡åˆ° <code>yield 1</code>æ—¶ï¼Œ<code>foo</code> ä¸Šä¸‹æ–‡é€€å‡ºå †æ ˆï¼Œå†…éƒ¨çŠ¶æ€å†»ç»“ã€‚ç¬¬äºŒæ¬¡æ‰§è¡Œ <code>gen.next()</code> æ—¶ï¼Œ<code>foo</code> ä¸Šä¸‹æ–‡é‡æ–°åŠ å…¥å †æ ˆï¼Œå˜æˆå½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œé‡æ–°æ¢å¤æ‰§è¡Œã€‚</p>
<h2>å››ã€Generator çš„åº”ç”¨</h2>
<p>Generator ä¸ Promise éƒ½æ˜¯ ES6 é€šè¿‡çš„å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚å°½ç®¡ Promise æœ‰æ•ˆè§£å†³äº† ES6 ä¹‹å‰çš„â€œå›è°ƒåœ°ç‹±â€ï¼ˆCallback Hellï¼‰ï¼Œä½†å®ƒä»ç„¶éœ€è¦å†™ä¸€å †çš„ <code>then()</code> æˆ– <code>catch()</code> çš„å¤„ç†ã€‚</p>
<p>å¦‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// è¿™é‡Œ delay è¡¨ç¤ºå„ç§å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ç­‰
// ä¸€ä¸‹å­æƒ³ä¸åˆ°è¦åˆ—ä¸¾å“ªäº›å¼‚æ­¥æ“ä½œï¼Œå°±ç”¨ setTimeout è¡¨ç¤ºå§
// é—®é¢˜ä¸å¤§ï¼Œä¸¾ä¾‹è€Œå·²
function delay(time) {
  return new Promise(resolve =&gt; setTimeout(resolve, time))
}

function requestByPromise(url) {
  let result = null
  window.fetch(url)
    .then(respone =&gt; respone.json())
    .then(res =&gt; {
      result = res
    })
    .then(() =&gt; {
      return delay(1000)
    })
    .then(() =&gt; {
      return delay(2000)
    })
    .then(() =&gt; {
      return delay(3000)
    })
    .then(() =&gt; {
      console.log('Done', result)
      // do something...
    })
    .catch(err =&gt; {
      console.warn('Exception', err)
    })
}

requestByPromise('/config/user')
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå½“æˆ‘ä»¬å­˜åœ¨å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œæƒ³åˆ©ç”¨ Promise å°è£…çš„è¯ï¼Œé¿å…ä¸äº†è¦å†™ä¸€ç³»åˆ—çš„ <code>then()</code> æˆ– <code>catch()</code> æ–¹æ³•ï¼Œå‡è®¾ <code>requestByPromise()</code> æ–¹æ³•ï¼Œè¿›è¡Œç½‘ç»œè¯·æ±‚ä¹‹åï¼Œè¿˜æœ‰å¾ˆå¤šä¸ªå¼‚æ­¥æ“ä½œè¦æ‰§è¡Œï¼Œç­‰å®ƒä»¬å®Œæˆä¹‹åï¼Œè¿™é‡Œå°è£…çš„ <code>requestPromise</code>ï¼ˆè¯·æ±‚æ“ä½œï¼‰æ‰ä¼šå®Œç»“ã€‚æ•´ä¸ªä»£ç çš„å®ç°èµ·æ¥ä»£ç é‡Œè¿˜æ˜¯å¾ˆé•¿ã€‚</p>
<blockquote>
<p>è™½ç„¶åˆ©ç”¨ <code>async...await</code> å¯ä»¥å†™å‡ºå¾ˆç®€æ´çš„ç»“æ„ï¼Œä½†æ˜¯æœ¬æ–‡çš„ä¸»è§’ä¸æ˜¯å®ƒã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œåˆ©ç”¨ <code>Promise.all()</code> ç­‰æ–¹æ³•ä¹Ÿå¯ä»¥ç®€åŒ–ä»¥ä¸Šæµç¨‹ã€‚å¦‚æœåˆ©ç”¨ Generator è¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³å†™å‡ºå¦‚ä¸‹è¿™æ ·æ›´ç›´è§‚çš„â€œåŒæ­¥â€æ–¹å¼ï¼š</p>
<pre><code class="language-js">function* requestByGenerator(url) {
  let response = yield window.fetch(url)
  let result = yield response.json()
  yield delay(1000)
  yield delay(2000)
  yield delay(3000)
  return result
}
</code></pre>
<p>å¦‚æœåƒä¸‹é¢é‚£æ ·ï¼Œç›´æ¥å»ï¼ˆå¤šæ¬¡ï¼‰è°ƒç”¨ <code>next()</code> æ–¹æ³•ï¼Œæ˜¾ç„¶ä¸ä¼šå¾—åˆ°æˆ‘ä»¬é¢„æœŸç»“æœï¼Œä¸”ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">const gen = requestByGenerator('/config/user')
gen.next()
gen.next() // è¿™ä¸€æ­¥å°±ä¼šæŠ¥é”™ï¼ŒTypeError: Cannot read property 'json' of undefined
// ...
</code></pre>
<p>åŸå› å¾ˆç®€å•ï¼Œ<code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼æ€»æ˜¯ <code>undefined</code>ã€‚å¦‚æœ <code>response</code> è¦å¾—åˆ°é¢„æœŸå€¼ï¼Œåœ¨è°ƒç”¨ <code>gen.next()</code> æ–¹æ³•æ—¶ï¼Œåº”ä¼ å…¥ <code>window.fetch(url)</code> çš„ç»“æœï¼Œåœ¨ä¸‹ä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼æ‰ä¼šæ­£ç¡®è§£æã€‚è€Œä¸”è¿˜æœ‰ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜ï¼Œç”±äºå®ä¾‹åŒ– <code>gen</code> å¯¹è±¡ï¼Œä»¥åŠè°ƒç”¨ <code>gen.next()</code> éƒ½æ˜¯åŒæ­¥çš„ï¼Œå½“æˆ‘ä»¬å¦‚ä¸Šè¿°ç¤ºä¾‹è°ƒç”¨ç¬¬äºŒæ¬¡ <code>next()</code> æ–¹æ³•æ—¶ï¼ŒFetch è¯·æ±‚è¿˜æ²¡æœ‰å¾—åˆ°ç»“æœã€‚å³ä½¿å·²ç»è¯·æ±‚åˆ°æ•°æ®ï¼Œä½†ç”±äº Event Loop æœºåˆ¶ï¼Œå®ƒçš„å¤„ç†ä¹Ÿåäº <code>next()</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå°½ç®¡ Generator å‡½æ•°æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒå¹¶ä¸æ˜¯å¼‚æ­¥çš„ï¼Œè€Œæ˜¯åŒæ­¥çš„ã€‚åªæ˜¯ Generator å‡½æ•°åœ¨è°ƒç”¨ä¹‹åï¼Œä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ä½“å†…çš„ä»£ç ï¼Œè€Œæ˜¯æä¾›äº† <code>next()</code> ç­‰æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å»æ§åˆ¶å¼‚æ­¥æµç¨‹ç½¢äº†ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œåƒå‰ä¸€ä¸ªç¤ºä¾‹çš„ <code>requestByGenerator</code> å‡½æ•°ï¼Œå®ƒå¹¶ä¸ä¼šæŒ‰ç¼–å†™é¡ºåºâ€œåŒæ­¥â€åœ°å¤„ç†è¿™äº›å¼‚æ­¥æ“ä½œï¼Œè¿˜éœ€è¦æˆ‘ä»¬è¿›ä¸€æ­¥å»å°è£…ï¼Œæ‰èƒ½æŒ‰ç…§é¢„æœŸçš„â€œåŒæ­¥â€æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œã€‚</p>
<p>Generator è¿˜æœ‰ä¸€ä¸ªå¾ˆè›‹ç–¼çš„é—®é¢˜ï¼Œéœ€è¦ä¸»åŠ¨è°ƒç”¨ <code>next()</code> æ‰ä¼šå»æ‰§è¡Œ Generator å‡½æ•°ä½“å†…çš„ä»£ç ã€‚å¦‚æœåˆ©ç”¨ <code>for...of</code> ç­‰è¯­å¥å»éå†ï¼Œé‡åˆ° <code>done</code> ä¸º <code>true</code> çš„åˆä¸æ‰§è¡Œã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å®ç°ä¸€ä¸ª Generator æ‰§è¡Œå™¨ã€‚</p>
<pre><code class="language-js">/**
 * æ€è·¯ï¼š
 * 1. å°è£…æ–¹æ³•å¹¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼›
 * 2. Promise å¯¹è±¡çš„è¿”å›å€¼å°±æ˜¯ Generator å‡½æ•°çš„ return ç»“æœï¼›
 * 3. å°è£…çš„æ–¹æ³•å†…éƒ¨ï¼Œè¦è‡ªåŠ¨è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•ï¼Œåœ¨ç”Ÿæˆå™¨ç»“æŸæ—¶ï¼Œå°†ç»“æœè¿”å› Promise å¯¹è±¡ï¼ˆfulfilledï¼‰ï¼›
 * 4. è¿™é‡Œå°† Generator å†…éƒ¨çš„å¼‚å¸¸æƒ…å†µï¼Œåœ¨ Generator å¤–éƒ¨ä½¿ç”¨ try...catch è¡¥æ¢ï¼Œå¹¶è¿”å› Promise å¯¹è±¡ï¼ˆrejectedï¼‰ï¼›
 * 5. é’ˆå¯¹ Generator å‡½æ•°å†… yield å…³é”®å­—åçš„å¼‚æ­¥æ“ä½œï¼Œè‹¥é Promise çš„è¯ï¼Œè¯·ä½¿ç”¨ Promise åŒ…è£…ä¸€å±‚ï¼›
 * 6. ç”±äºå°è£…æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨ next() æ–¹æ³•ï¼Œåœ¨ Generator å‡½æ•°å†…è‹¥ä¸æ˜¯å¼‚æ­¥æ“ä½œï¼Œæ²¡å¿…è¦ä½¿ç”¨ yield å…³é”®å­—å»åˆ›å»ºä¸€ä¸ªçŠ¶æ€ï¼Œç›´æ¥åŒæ­¥å†™æ³•å³å¯ã€‚
 *
 * @param {GeneratorFunction} genFn ç”Ÿæˆå™¨å‡½æ•°
 * @param  {...any} args ä¼ é€’ç»™ç”Ÿæˆå™¨å‡½æ•°çš„å‚æ•°
 * @returns {Promise}
 */
function generatorExecutor(genFn, ...args) {
  const getType = obj =&gt; {
    const type = Object.prototype.toString.call(obj)
    return /^\[object (.*)\]$/.exec(type)[1]
  }

  if (getType(genFn) !== 'GeneratorFunction') {
    throw new TypeError('The first parameter of generatorExecutor must be a generator function!')
  }

  // ä¸‹é¢å°±æ˜¯ä¸æ–­è°ƒç”¨ next() æ–¹æ³•çš„è¿‡ç¨‹ï¼Œç›´è‡³ç»“æŸæˆ–æŠ¥é”™
  return new Promise((resolve, reject) =&gt; {
    const gen = genFn(...args)
    let iterRes = gen.next()

    const goNext = iteratorResult =&gt; {
      const { done, value } = iteratorResult

      // Generator ç»“æŸæ—¶é€€å‡º
      if (done) return resolve(value)

      if (getType(value) !== 'Promise') {
        const nextRes = gen.next(value)
        goNext(nextRes)
        return
      }

      // å¤„ç† yield ä¸º Promise çš„æƒ…å†µ
      value.then(res =&gt; {
        const nextRes = gen.next(res)
        goNext(nextRes)
      }).catch(err =&gt; {
        try {
          // åˆ©ç”¨ Generator.prototype.throw() æŠ›å‡ºå¼‚å¸¸ï¼ŒåŒæ—¶ä½¿å¾— gen ç»“æŸ
          gen.throw(err)
        } catch (e) {
          reject(e)
        }
      })
    }

    goNext(iterRes)
  })
}
</code></pre>
<p>ç„¶åï¼Œåƒä¸‹é¢é‚£æ ·å»è°ƒç”¨å³å¯ã€‚</p>
<pre><code class="language-js">function* requestByGenerator(url) {
  let response = yield window.fetch(url)
  let result = yield response.json()
  yield delay(1000)
  yield delay(2000)
  yield delay(3000)
  return result
}

generatorExecutor(requestByGenerator, '/config/user')
  .then(res =&gt; {
    // do something...
    // res å°†ä¼šé¢„æœŸåœ°å¾—åˆ° fetch çš„å“åº”ç»“æœ
  })
  .catch(err =&gt; {
    // do something...
    // å¤„ç†å¼‚å¸¸æƒ…å†µ
  })
</code></pre>
<p>å°½ç®¡ Generator å‡½æ•°æå‡ºäº†ä¸€ç§å…¨æ–°çš„å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨å‡½æ•°å¤–éƒ¨æ³¨å…¥å€¼å–å¹²é¢„å‡½æ•°å†…éƒ¨çš„è¡Œä¸ºï¼Œè¿™ç§æ€æƒ³æä¾›äº†æå¤§çš„åˆ›é€ æ€§ï¼Œå¼ºå¤§ä¹‹å¤„ä¸æ˜¯ Promise èƒ½æ¯”çš„ã€‚ä½†æ˜¯åœ¨ç»“åˆå®é™…åœºæ™¯æ—¶ï¼Œå¾ˆå¤§å¯èƒ½éœ€è¦è‡ªå®ç°ä¸€ä¸ª Generator æ‰§è¡Œå™¨ï¼Œä½¿å…¶è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆå™¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè‘—åçš„ <a href="https://github.com/tj/co#readme">co</a> å‡½æ•°åº“å°±æ˜¯å»åšäº†è¿™ä»¶äº‹æƒ…ã€‚å¦‚æœæƒ³äº†è§£ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡<a href="http://www.ruanyifeng.com/blog/2015/05/co.html">æ–‡ç« </a>ï¼Œæˆ–ç›´æ¥çœ‹<a href="https://github.com/tj/co#readme">å®˜æ–¹æ–‡æ¡£</a>ã€‚ä½†çœ‹äº†ä¸‹ GitHub ä¸Šæœ€æ–°ä¸€æ¬¡æäº¤å·²ç»æ˜¯ 5 å¹´å‰ï¼Œå¤§æ¦‚éƒ½å»ç”¨ <code>async/await</code> äº†å§ã€‚</p>
<p>æ¥ä¸‹æ¥å°±ä»‹ç» <code>async/await</code> äº†ã€‚</p>
<!--

èµåŒ [@Cyandev](//www.zhihu.com/people/73dea43918ac6edf7b152eea6eb87cd4) çš„å›ç­”ï¼Œå†ç»™ä½ å‡ ç¯‡æ–‡ç« ï¼Œçœ‹å®ŒåŸºæœ¬å°±æ‡‚äº†ã€‚
æ–‡ç« æœ‰é¡ºåºå…³ç³»ï¼Œè¯·ä»¥æ¬¡é˜…è¯»ã€‚

1\. [Generatorå‡½æ•°çš„å«ä¹‰ä¸ç”¨æ³•](https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2015/04/generator.html)
2\. [Thunkå‡½æ•°çš„å«ä¹‰ä¸ç”¨æ³•](https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2015/05/thunk.html)
3\. [coå‡½æ•°åº“çš„å«ä¹‰ä¸ç”¨æ³•](https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2015/05/co.html)
4\. [async å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³•](https://link.zhihu.com/?target=http%3A//www.ruanyifeng.com/blog/2015/05/async.html)

æ¶‰åŠçŸ¥è¯†ç‚¹ ï¼š
JS ç”Ÿæˆå™¨å‡½æ•°ï¼ˆGeneratorã€yieldï¼‰ã€‚
co.js åº“ GitHub åœ°å€ [https://github.com/tj/co](https://link.zhihu.com/?target=https%3A//github.com/tj/co)ï¼Œä»£ç å¾ˆçŸ­å°ï¼Œå¯ä»¥è‡ªå·±çœ‹ä¸€éã€‚

* [Javascript ä¸­é€šè¿‡ yield å’Œ promise ä½¿å¼‚æ­¥å˜åŒæ­¥](https://www.jianshu.com/p/c1b8b89c4905)
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Iterator è¿­ä»£å™¨]]></title>
            <link>https://github.com/toFrankie/blog/issues/257</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/257</guid>
            <pubDate>Sun, 26 Feb 2023 11:56:13 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-12c76e9cc812118f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-12c76e9cc812118f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿­ä»£çš„è‹±æ–‡æ˜¯ â€œiterationâ€ï¼Œæºè‡ªæ‹‰ä¸æ–‡ â€œiteroâ€ï¼Œæ˜¯â€œé‡å¤â€æˆ–â€œå†æ¥â€çš„æ„æ€ã€‚åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œâ€œè¿­ä»£â€çš„æ„æ€æ˜¯æŒ‰ç…§é¡ºåºåå¤å¤šæ¬¡æ‰§è¡Œä¸€æ®µç¨‹åºï¼Œé€šå¸¸ä¼šæœ‰æ˜ç¡®çš„ç»ˆæ­¢æ¡ä»¶ã€‚ES6 è§„èŒƒæ–°å¢äº†ä¸¤ä¸ªé«˜çº§ç‰¹æ€§ï¼š<strong>è¿­ä»£å™¨</strong>å’Œ<strong>ç”Ÿæˆå™¨</strong>ã€‚ä½¿ç”¨è¿™ä¸¤ä¸ªç‰¹æ€§ï¼Œèƒ½å¤Ÿæ›´æ¸…æ™°ã€é«˜æ•ˆã€æ–¹ä¾¿åœ°å®ç°è¿­ä»£ã€‚</p>
<h2>ä¸€ã€è¿­ä»£å™¨ç®€è¿°</h2>
<p>è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œæ˜¯ä¸€ç§æ¥å£ã€‚ä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›äº†ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚</p>
<blockquote>
<p>æœ‰äº›ä¹¦ç±æˆ–æ–‡ç« è¯‘ä¸ºâ€œéå†å™¨â€ï¼Œå…¶ä»–è¯­è¨€å¤šç§°ä¸ºâ€œè¿­ä»£å™¨â€ã€‚</p>
</blockquote>
<h3>1. ä¸ºä»€ä¹ˆ ECMAScript è¦å¼•å…¥â€œè¿­ä»£å™¨â€ï¼Ÿ</h3>
<p>åœ¨ ES6 ä¹‹å‰ï¼Œæœ€å¸¸è§çš„æ•°æ®ç»“æ„æœ‰æ•°ç»„å’Œå¯¹è±¡ã€‚</p>
<p>éå†è¿™äº›æ•°æ®ç»“æ„é€šå¸¸ä½¿ç”¨ <code>for</code> è¯­å¥ã€‚ä¾‹å¦‚æ•°ç»„ï¼Œé™¤äº†æœ€åŸå§‹çš„ <code>for</code> å¾ªç¯ï¼Œè¿˜æœ‰ <code>Array.prototype.forEach()</code> ç­‰æ–¹æ³•ã€‚è€Œæ™®é€šå¯¹è±¡åˆ™ä½¿ç”¨ <code>for...in</code> è¯­å¥ã€‚<strong>é‚£ä¹ˆï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨å“ªä¸€ç§æ–¹æ³•ä¹‹å‰ï¼Œæ˜¯ä¸æ˜¯è¦æå‰çŸ¥é“å®ƒä»¬å†…éƒ¨ç»“æ„æ˜¯æ€æ ·çš„ï¼Œæ‰èƒ½æ­£ç¡®åœ°å†™å‡ºè¿­ä»£çš„ç¨‹åºï¼Œå¯¹å§ã€‚</strong></p>
<p>è€Œåœ¨ ES6 æ ‡å‡†ä¸­ï¼Œæ–°å¢äº† <code>Map</code> å’Œ <code>Set</code> ä¸¤ç§ä¸åŒçš„æ•°æ®ç»“æ„ã€‚å®ƒä»¬çš„å†…éƒ¨ç»“æ„ä¸åŸæœ¬å°±å­˜åœ¨çš„ <code>Array</code> å’Œ <code>Object</code> åˆä¸ä¸€æ ·ã€‚å‡è®¾æˆ‘ä»¬è¦å»éå†å®ƒä»¬ï¼Œæ˜¯ä¸æ˜¯è¦å®ç°ä¸€ä¸ªç±»ä¼¼ <code>Array.prototype.forEach()</code> çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œéå†ä»¥ä¸Šä¸¤ç§ç»“æ„çš„æ–¹æ³•å« <code>Map.prototype.forEach()</code> å’Œ <code>Set.prototype.forEach()</code>ï¼ˆå½“ç„¶è¿™ä¸¤ä¸ªæ˜¯æˆ‘çç¼–äº†ï¼‰ã€‚é‚£ä¹ˆè¿™æ ·æ˜¯ä¸æ˜¯åˆå¤šäº†ä¸¤ç§è¿­ä»£æ–¹å¼ï¼Œæ— è®ºå¯¹è´Ÿè´£åˆ¶å®šæ ‡å‡†çš„ TC39 å§”å‘˜ä¼šï¼Œè¿˜æ˜¯ JavaScript å¼€å‘è€…æ¥è¯´ï¼Œéƒ½å¢åŠ äº†å·¥ä½œé‡ã€‚å§”å‘˜ä¼šè¦è´Ÿè´£å®ç°ï¼Œå¼€å‘è€…è¦äº†è§£å­¦ä¹ ï¼Œéƒ½éœ€è¦æˆæœ¬ã€‚</p>
<p>çœ‹åˆ°è¿™ç§è‹—å¤´ï¼ŒTC39 å§”å‘˜ä¼šé‚£äº›å¤§ä½¬å°±å†…å¿ƒå¼€å§‹éª‚è¡—äº†ã€‚æ¯å¢åŠ ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±è¦å®ç°ä¸€ç§å…¨æ–°çš„æ–¹æ³•å»éå†å®ƒï¼Œé‚£åŠ³èµ„ä¸å¹²äº†ï¼Œéƒ½ä¸èƒ½å¥½å¥½æ‘¸é±¼äº†ã€‚</p>
<p>äºæ˜¯å®ƒä»¬å°±æƒ³å‡ºä¸€ä¸ªâ€œå·æ‡’â€çš„æ–¹æ³•ï¼š<strong>å®ç°ä¸€ç§é€šç”¨çš„è¿­ä»£æœºåˆ¶ï¼Œå¹¶åˆ¶å®šç›¸å…³æ ‡å‡†ã€‚å®ƒä¸€å®šè¦æ”¯æŒåŸæœ‰çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸”æœªæ¥æ–°å¢çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿè¦æ»¡è¶³è¿™ç§æ¨¡å¼ï¼ˆæœºåˆ¶ï¼‰æ‰è¡Œã€‚å› æ­¤ï¼Œåœ¨ ECMAScript ä¸­å°±å‡ºç°äº†â€œè¿­ä»£å™¨â€ï¼ˆIteratorï¼‰çš„æ¦‚å¿µã€‚</strong></p>
<p>è¿™æ ·çš„è¯ï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘è€…æ¥è¯´ï¼Œæ— éœ€çŸ¥é“æŸç§å¯¹è±¡çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼Œå°±å¯ä»¥åˆ©ç”¨ <code>for...of</code> ç­‰è¯­å¥ï¼Œæ–¹ä¾¿ã€å¿«é€Ÿã€å®‰å…¨åœ°å†™å‡ºè¿­ä»£ç¨‹åºã€‚å‡è®¾åœ¨æœªæ¥çš„ ES2050 æ ‡å‡†ä¸­ï¼Œæ–°å¢äº†ä¸€ç§åä¸º <code>Record</code> çš„æ•°æ®ç»“æ„ï¼Œåªè¦ç¬¦åˆè¿­ä»£å™¨æœºåˆ¶çš„ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ <code>for...of</code> å»éå†å®ƒä»¬ã€‚</p>
<h3>2. JavaScript å†…ç½®çš„å¯è¿­ä»£å¯¹è±¡</h3>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰ Iterator æ¥å£ï¼Œæˆ‘ä»¬å°†å®ƒç§°ä¸ºâ€œå¯è¿­ä»£å¯¹è±¡â€ï¼ˆIterableï¼‰ã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œç›®å‰å†…ç½®çš„å¯è¿­ä»£å¯¹è±¡æœ‰ï¼š<code>String</code>ã€<code>Array</code>ã€<code>TypedArray</code>ã€<code>Map</code>ã€ <code>Set</code>ã€<code>Arguments</code> å’Œ <code>NodeList</code>ã€‚å®ƒä»¬çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code>ï¼‰éƒ½å®ç°äº† <code>@@iterator </code>æ–¹æ³•ã€‚ï¼ˆå³å¯¹è±¡å«æœ‰ <code>Symbol.iterator</code> å±æ€§ï¼‰ã€‚</p>
<p>é™¤äº†å†…ç½®çš„å¯è¿­ä»£å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è‡ªå·±çš„å¯è¿­ä»£å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">const myIterable = {
  [Symbol.iterator]: function* () {
    yield 1
    yield 2
    yield 3
    // ç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡
  }
}

console.log([...myIterable]) // [1, 2, 3]
</code></pre>
<h3>3. Iterator æ¥å£</h3>
<p>è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¸¦æœ‰ç‰¹æ®Šçš„æ¥å£ã€‚ä¸€ä¸ªå…·æœ‰ Iterator æ¥å£çš„å¯¹è±¡ï¼Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>å¯è¿­ä»£åè®®</strong>å’Œ<strong>è¿­ä»£å™¨åè®®</strong>ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li>
<p>å¯è¿­ä»£åè®®ï¼Œæ˜¯æŒ‡å¯¹è±¡å®ç°äº† <code>@@iterator</code> æ–¹æ³•ï¼ˆä¸ç®¡æ˜¯æœ¬èº«å±æ€§ï¼Œè¿˜æ˜¯å¯¹è±¡åŸå‹é“¾ä¸Šçš„å±æ€§éƒ½å¯ä»¥ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¯é€šè¿‡å¸¸é‡ <code>Symbol.iterator</code> è®¿é—®è¯¥å±æ€§ã€‚</p>
</li>
<li>
<p>è¿­ä»£å™¨åè®®ï¼Œæ˜¯æŒ‡ <code>@@iterator</code> æ–¹æ³•è¿”å›çš„è¿­ä»£å™¨å®ç°äº† <code>next</code> æ–¹æ³•ã€‚è°ƒç”¨ <code>next</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>IteratorResult</code> å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå±æ€§ï¼š<code>{ done: true/false, value: '...' }</code>ï¼Œå…¶ä¸­ <code>done</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸï¼›<code>value</code> è¡¨ç¤ºå½“å‰æˆå‘˜çš„å€¼ã€‚</p>
</li>
</ul>
<p>æŸä¸ªå¯¹è±¡åªæœ‰å®ç°äº†ä»¥ä¸Šä¸¤ä¸ªåè®®ï¼Œæ‰ç®—æ˜¯ä¸€ä¸ªå®Œæ•´ã€åˆæ ¼çš„è¿­ä»£å™¨ã€‚</p>
<h2>äºŒã€ç”Ÿæˆå™¨ç®€è¿°</h2>
<p>è¯´åˆ°ç”Ÿæˆå™¨ï¼Œä½ ä»¬ä¸€å®šçŸ¥é“ Generator å‡½æ•°ï¼ˆå³â€œç”Ÿæˆå™¨å‡½æ•°â€ï¼‰ï¼Œå®ƒæ˜¯ ES6 ä¸­æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç”Ÿæˆå™¨çš„å½¢å¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸€ä¸ªæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚å°½ç®¡è¯­æ³•ä¸Šä¸æ™®é€šå‡½æ•°ç›¸ä¼¼ï¼Œä½†è¯­æ³•è¡Œä¸ºå´å®Œå…¨ä¸åŒã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œç®­å¤´å‡½æ•°ä¸èƒ½ç”¨æ¥å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ã€‚</p>
</blockquote>
<p>å¦‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* generatorFn() {} // generatorFn è¡¨ç¤ºä¸€ä¸ªç”Ÿæˆå™¨
const gen = generatorFn() // è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªâ€œç”Ÿæˆå™¨å¯¹è±¡â€

console.log(gen) // generatorFnÂ {&lt;suspended&gt;}
console.log(gen.next()) // {value: undefined, done: true}

// ç”Ÿæˆå™¨å¯¹è±¡ï¼Œä¸€å¼€å§‹ä¼šå¤„äºæš‚åœæ‰§è¡Œï¼ˆsuspendedï¼‰çš„çŠ¶æ€
// è°ƒç”¨ next() æ–¹æ³•ä¼šè®©ç”Ÿæˆå™¨å¼€å§‹æˆ–æ¢å¤æ‰§è¡Œ
// ç”±äºç”Ÿæˆå™¨å‡½æ•°ä½“ä¸ºç©ºï¼Œå› æ­¤è°ƒç”¨ä¸€æ¬¡ next() æ–¹æ³•å°±ä¼šè®©ç”Ÿæˆå™¨åˆ°è¾¾ done: true çš„çŠ¶æ€
</code></pre>
<p>æœ¬æ–‡ä¸ä¼šè¯¦ç»†ä»‹ç»ç”Ÿæˆå™¨å‡½æ•°ç›¸å…³è¯­æ³•ï¼Œåé¢å¦èµ·<a href="https://github.com/toFrankie/blog/issues/258">ä¸€æ–‡</a>ã€‚æœ¬æ–‡æåˆ°å®ƒçš„ç¼˜ç”±æ˜¯ï¼š<strong>Generator å‡½æ•°ä¼šäº§ç”Ÿä¸€ä¸ªâ€œç”Ÿæˆå™¨å¯¹è±¡â€ï¼Œè¯¥å¯¹è±¡ä¹Ÿå®ç°äº† Iterator æ¥å£ã€‚</strong></p>
<p>å› æ­¤ï¼Œç”Ÿæˆå™¨æ ¼å¤–åˆé€‚ä½œä¸ºé»˜è®¤è¿­ä»£å™¨ã€‚åœ¨å®ç°è‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§å®ç°ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">class Foo {
  constructor(value) {
    this.value = value
  }

  *[Symbol.iterator]() {
    yield* this.value
  }
}

// foo å®ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå› ä¸ºå®ƒçš„åŸå‹ä¸Šå®ç°äº† @@iterator æ–¹æ³•
const foo = new Foo([1, 2, 3])

// è®¿é—®è¿­ä»£å™¨
for (const x of foo) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š1ã€2ã€3
</code></pre>
<h2>ä¸‰ã€Iterator è¯¦è§£</h2>
<blockquote>
<p>è¿­ä»£å™¨æ˜¯æŒ‰éœ€åˆ›å»ºçš„ä¸€æ¬¡æ€§å¯¹è±¡ã€‚æ¯ä¸ªè¿­ä»£å™¨éƒ½ä¼šå…³è”ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p>
</blockquote>
<p>è¿™å¥è¯æ€ä¹ˆç†è§£ï¼Œçœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const num = 1
const obj = {}
const arr = [1, 2, 3]

// é€šè¿‡è®¿é—® Symbol.iterator å±æ€§å¯åˆ¤æ–­å¯¹è±¡æ˜¯å¦å®ç°äº†å¯è¿­ä»£åè®®ï¼Œ
// è¿”å›å€¼ä¸ºå‡½æ•°ï¼Œåˆ™è¡¨ç¤ºå®ç°äº†ï¼Œå¦åˆ™æœªå®ç°ï¼Œ
// å› æ­¤ numã€obj ä¸å¯è¿­ä»£ï¼Œarr æ˜¯å¯è¿­ä»£çš„ã€‚
console.log(num[Symbol.iterator]) // undefined
console.log(obj[Symbol.iterator]) // undefined
console.log(arr[Symbol.iterator]) // Æ’ values() { [native code] }

// è°ƒç”¨ @@iterator æ–¹æ³•ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œ
// iter1ã€iter2 è¡¨ç¤ºä¸¤ä¸ªä¸åŒçš„è¿­ä»£å™¨ï¼Œ
// ä½†å®ƒä»¬ç›¸å…³è”çš„å¯è¿­ä»£å¯¹è±¡éƒ½æ˜¯ arr
const iter1 = arr[Symbol.iterator]()
const iter2 = arr[Symbol.iterator]()

console.log(iter1 === iter2) // false
for (const x of iter1) {
  console.log(x)
}
// for...of è¯­å¥ä¾æ¬¡æ‰“å°ï¼š1ã€2ã€3
</code></pre>
<p>åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­ï¼Œç»“è®ºä¸åˆ†æè¯·çœ‹æ³¨é‡Šéƒ¨åˆ†ã€‚</p>
<p>å¦‚ä½•ç†è§£â€œä¸€æ¬¡æ€§â€å¯¹è±¡ï¼Œçœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// ç¤ºä¾‹ä¸€ï¼š
const gen = (function* () {
  yield 1
  yield 2
  yield 3
})()

for (let x of gen) {
  console.log(x)
  break // å…³é—­ç”Ÿæˆå™¨
}

// ç”Ÿæˆå™¨ä¸åº”è¯¥é‡ç”¨ï¼Œä»¥ä¸‹æ²¡æœ‰æ„ä¹‰ï¼
for (let x of gen) {
  console.log(x)
}

// ç”±å§‹è‡³ç»ˆï¼Œä»…æ‰“å°å‡º 1
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸€ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œå®ƒå®ç°äº† Iterator æ¥å£ï¼‰ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>for...of</code> å¾ªç¯éå†å®ƒï¼Œå¹¶ä½¿ç”¨äº† <code>break</code> å…³é”®å­—æå‰ç»ˆæ­¢ã€‚åœ¨é€€å‡ºå¾ªç¯åï¼Œç”Ÿæˆå™¨å…³é—­ã€‚è‹¥å°è¯•å†æ¬¡è¿­ä»£ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•è¿›ä¸€æ­¥çš„ç»“æœã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸åº”è¯¥é‡ç”¨ç”Ÿæˆå™¨ã€‚</p>
<p>å†çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// ç¤ºä¾‹äºŒ
const arr = [1, 2, 3, 4, 5]
const iter = arr[Symbol.iterator]()

// ç¬¬ä¸€æ¬¡è¿­ä»£
for (const x of iter) {
  console.log(x)
  if (x &gt; 2) break
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š1ã€2ã€3

// å†æ¬¡è¿­ä»£
for (const x of iter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š4ã€5
</code></pre>
<p>è§‚å¯Ÿç¤ºä¾‹äºŒï¼Œæ•°ç»„çš„è¿­ä»£å™¨è·Ÿç”Ÿæˆå™¨å‡½æ•°è¿”å›çš„è¿­ä»£å™¨åˆç¨æœ‰ä¸åŒã€‚å°½ç®¡æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£çš„æ—¶å€™ï¼Œæå‰è·³å‡ºå¾ªç¯äº†ï¼Œä½†æ˜¯è¿­ä»£å™¨ <code>iter</code> å¹¶æ²¡æœ‰å…³é—­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç»§ç»­ä»ä¸Šä¸€æ¬¡ç¦»å¼€çš„åœ°æ–¹ç»§ç»­è¿­ä»£ï¼Œè¿™ä¸ªç¦»å¼€çš„åœ°æ–¹ç”±è¿­ä»£å™¨å†…éƒ¨ç»´æŠ¤ã€‚å› æ­¤ï¼Œæ•°ç»„çš„è¿­ä»£å™¨æ˜¯ä¸èƒ½ä¸»åŠ¨å…³é—­çš„ï¼Œå½“å®ƒè¿­ä»£è‡³æœ€åä¸€ä¸ªæˆå‘˜æ‰ä¼šå…³é—­ã€‚</p>
<blockquote>
<p>ç»“åˆä¸¤ä¸ªç¤ºä¾‹ï¼ŒåŒä¸€ä¸ªè¿­ä»£å™¨æœ€å¥½ä¸è¦é‡å¤ä½¿ç”¨ï¼Œå› æ­¤æ‰è¯´æ˜¯ä¸€æ¬¡æ€§å¯¹è±¡ã€‚</p>
</blockquote>
<p>è¿­ä»£å™¨çš„æ¦‚å¿µå¾ˆå®¹æ˜“æ··æ·†ï¼Œæ‰€ä»¥è¦æ³¨æ„äº†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ•°ç»„ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆIteratorï¼‰ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰ã€‚åœ¨è°ƒç”¨æ•°ç»„å®ä¾‹çš„ <code>@@iteator</code> æ–¹æ³•ï¼Œæ‰ä¼šç”Ÿæˆä¸€ä¸ªä¸æ•°ç»„å®ä¾‹ç›¸å…³è”çš„è¿­ä»£å™¨ã€‚</p>
<blockquote>
<p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿­ä»£å™¨ç»´æŠ¤ç€ä¸€ä¸ªæ‰§è¡Œå¯è¿­ä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œå› æ­¤è¿­ä»£å™¨ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ç¨‹åºå›æ”¶å¯è¿­ä»£å¯¹è±¡ã€‚</p>
</blockquote>
<h3>Iterator éå†è¿‡ç¨‹</h3>
<p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿­ä»£å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚
ï¼ˆ2ï¼‰ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ <code>next()</code> æ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆå¯¹è±¡æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚
ï¼ˆ3ï¼‰ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ <code>next()</code> æ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆå¯¹è±¡æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ã€‚
ï¼ˆ4ï¼‰ä¸æ–­è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ <code>next()</code> æ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ã€‚</p>
<p>æ¯ä¸€æ¬¡è°ƒç”¨è¿­ä»£å™¨çš„ <code>next()</code> æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›æ•°æ®ç»“æ„çš„å½“å‰æˆå‘˜çš„ä¿¡æ¯ï¼Œå³å‰é¢æåˆ°çš„ <code>IteratorResult</code> å¯¹è±¡ã€‚å®ƒæœ‰åŒ…å« <code>done</code> å’Œ <code>value</code> ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­ <code>done</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸï¼›<code>value</code> è¡¨ç¤ºå½“å‰æˆå‘˜çš„å€¼ã€‚</p>
<p>æˆ‘ä»¬åŸºäºæ•°ç»„çš„ç»“æ„ç‰¹ç‚¹ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„ <code>next()</code> æ–¹æ³•ï¼ˆè¿­ä»£å™¨åè®®ï¼‰ï¼š</p>
<pre><code class="language-js">function createIterator(array) {
  let nextIndex = 0
  return {
    next: function () {
      return nextIndex &lt; array.length
        ? { done: false, value: array[nextIndex++] }
        : { done: true, value: undefined }

      // å¯¹è¿­ä»£å™¨å¯¹è±¡æ¥è¯´ï¼Œ`done: false` å’Œ `value: undefined` éƒ½æ˜¯å¯ä»¥çœç•¥çš„ï¼Œ
      // å› æ­¤å¯ä»¥ç®€å†™æˆï¼š
      // return nextIndex &lt; array.length
      //   ? { value: array[nextIndex++] }
      //   : { done: true }
    }
  }
}

const iter = createIterator([1, 2, 3])
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª <code>createIterator</code> å‡½æ•°ï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å½“æˆ‘ä»¬å¯¹æ•°ç»„ <code>[1, 2, 3]</code> æ‰§è¡Œ <code>createIterator()</code>ï¼Œå°±ä¼šè¿”å›ä¸è¯¥æ•°ç»„ç›¸å…³è”çš„éå†å™¨å¯¹è±¡ <code>iter</code>ï¼ˆå³ä¸Šæ–‡æåˆ°çš„æŒ‡é’ˆå¯¹è±¡ï¼‰ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡ <code>iter</code> çš„ <code>next()</code> æ–¹æ³•ï¼ŒæŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„å¼€å§‹ä½ç½®ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>IteratorResult</code> å¯¹è±¡ <code>{done: false, value: 1}</code>ï¼Œå®ƒåŒ…å«äº†å½“å‰æ•°æ®æˆå‘˜çš„ä¿¡æ¯ã€‚è‹¥ <code>done</code> ä¸º <code>false</code> è¡¨ç¤ºéå†æœªç»“æŸï¼Œå³å¯ç»§ç»­è°ƒç”¨ <code>next()</code> æ–¹æ³•è®¿é—®ä¸‹ä¸€ä¸ªæˆå‘˜ä¿¡æ¯......ç›´åˆ° <code>done</code> ä¸º <code>true</code> éå†ç»“æŸã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1bc7314ff63367b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶å®è¿­ä»£å™¨ï¼ˆIteratorï¼‰ä¸å¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰æ˜¯åˆ†å¼€çš„ï¼Œè¿­ä»£å™¨æ— éœ€äº†è§£ä¸å…¶å…³è”çš„å¯è¿­ä»£å¯¹è±¡ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•å–å¾—è¿ç»­çš„å€¼ã€‚</p>
<h2>å››ã€é»˜è®¤è¿­ä»£å™¨</h2>
<p>è¿­ä»£å™¨çš„ç›®çš„å°±æ˜¯æä¾›ä¸€ç§ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚å¯ä¾›ç»™ JavaScript æ‰€æœ‰æ¥æ”¶å¯è¿­ä»£å¯¹è±¡çš„è¯­å¥æˆ–æ–¹æ³•ä½¿ç”¨ã€‚</p>
<pre><code class="language-text">ç›®å‰æ”¯æŒä»¥ä¸‹è¿™äº›ï¼š
for...of è¯­å¥
æ•°ç»„è§£æ„
æ‰©å±•è¿ç®—ç¬¦
Array.from()
new Set()
new Map()
Promise.all()
Promise.race()
Promise.allSettled()
Promise.any()
yield* æ“ä½œç¬¦
</code></pre>
<p>å‰é¢æåˆ°ï¼Œåªè¦æŸç§æ•°æ®ç»“æ„ï¼ˆå¯¹è±¡ï¼‰éƒ¨ç½²äº† Iterator æ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç§°è¿™ç§æ•°æ®ç»“æ„æ˜¯â€œå¯è¿­ä»£çš„â€ã€‚</p>
<p>ES6 è§„å®šï¼Œé»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨å¯¹è±¡çš„ <code>Symbol.iterator</code> å±æ€§ä¸Šã€‚è¯¥å±æ€§æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å½“å‰å¯¹è±¡çš„è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°ã€‚è°ƒç”¨æ­¤æ–¹æ³•å°±ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>
<blockquote>
<p>æ’ä¸ªè¯ï¼š</p>
<p>åƒä¸‡ä¸è¦è¢« <code>Symbol.iterator</code> å±æ€§å“åˆ°äº†ï¼Œæ ‡å‡†è§„å®šç”¨å®ƒæŒ‡å‘å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•è€Œå·²ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨å†…å¿ƒæŠŠå®ƒå½“æˆåç§°ä¸º <code>iterator</code> çš„å±æ€§ã€‚é‚£ä¹ˆ <code>arr[Symbol.iterator]()</code>ï¼Œå°±ç›¸å½“äº <code>arr.iterator()</code> æˆ– <code>arr['iterator']()</code>ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªé”®åï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ä½¿ç”¨ Symbol ç±»å‹å»è¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚åŒæ ·çš„ï¼Œå½“ä½¿ç”¨ Symbol å€¼ä½œä¸ºå¯¹è±¡çš„é”®åï¼Œå°±èƒ½ä¿è¯ä¸ä¼šå‡ºç°åŒåå±æ€§ã€‚å‡è®¾æˆ‘ä»¬çš„é»˜è®¤è¿­ä»£å™¨éƒ¨ç½²åœ¨ä¸€ä¸ªåç§°ä¸º <code>iterator</code>ï¼ˆæˆ–å…¶ä»–ï¼‰çš„å±æ€§ä¸Šï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“è¢«æˆ‘ä»¬æ”¹å†™æˆ–è¦†ç›–æ‰ã€‚å› æ­¤æŒ‡å®šæ ‡å‡†çš„é‚£å¸®å®¶ä¼™æ‰ä¼šä½¿ç”¨ Symbol å€¼ä½œä¸ºé”®åï¼Œå¹¶è§„å®šå®ƒçš„ç‰¹æ®Šå«ä¹‰ï¼Œè¿™æ ·å¼€å‘è€…å°±ä¸ä¼šéšæ„è¦†ç›–å®ƒäº†ã€‚</p>
<p>ç”±äº Symbol å€¼æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ç‚¹è¿ç®—ç¬¦ï¼ˆ<code>.</code>ï¼‰å»è®¿é—®ï¼Œéœ€é€šè¿‡æ–¹æ‹¬å·ï¼ˆ<code>[]</code>ï¼‰çš„å½¢å¼æ‰èƒ½è®¿é—®ã€‚</p>
<p>é™¤äº† <code>Symbol.iterator</code>ï¼Œè¿˜æœ‰å¾ˆå¤šå†…ç½®çš„ Symbol å€¼ã€‚ä¾‹å¦‚ <code>Symbol. hasInstance</code>ã€<code>Symbol.toPrimitive</code>ã€<code>Symbol.toStringTag</code> ç­‰ç­‰ï¼Œå®ƒä»¬éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚æœ‰æ—¶å€™ä¹Ÿä¼šå¯¹åº”ç§°ä½œ <code>@@iterator</code>ã€<code>@@toPrimitive</code> ç­‰ã€‚</p>
</blockquote>
<p>åœ¨ JavaScript ä¸­ï¼Œæœ‰ä»¥ä¸‹è¿™äº›æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡ Iterator æ¥å£ï¼š</p>
<pre><code class="language-text">Stringã€Arrayã€TypedArrayã€Mapã€ Setã€Arguments å’Œ NodeListã€‚
</code></pre>
<p>å› æ­¤æˆ‘ä»¬ä¸ç”¨ä»»ä½•å¤„ç†ï¼Œæ— éœ€è‡ªå·±ç¼–å†™è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ <code>for...of</code> è¯­å¥å»éå†å®ƒä»¬ã€‚<code>for...of</code> å†…éƒ¨ä¼šè‡ªåŠ¨è®¿é—®é»˜è®¤ Iterator æ¥å£ <code>Symbol.iterator</code>ã€‚</p>
<p>è€Œæ™®é€šå¯¹è±¡å¹¶æ²¡æœ‰é»˜è®¤éƒ¨ç½² Iterator æ¥å£ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ for...of å»è¿­ä»£æ™®é€šå¯¹è±¡ã€‚ä½†æˆ‘ä»¬å¯ä»¥ä¸ºå®ƒå®ç°è‡ªå®šä¹‰è¿­ä»£å™¨æ¥å£ã€‚</p>
<blockquote>
<p>å®ç°è¿­ä»£å™¨æ¥å£ï¼Œæœ€ç®€å•çš„æ–¹æ³•åº”è¯¥æ˜¯ä½¿ç”¨ Generator å‡½æ•°ã€‚</p>
</blockquote>
<p>å¦‚ä½•åˆ¤æ–­æŸç§æ•°æ®ç»“æ„æ˜¯å¦å®ç°äº† Iterator æ¥å£ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-js">// Symbol.iterator å±æ€§å€¼ä¸º undefinedï¼Œè¡¨ç¤ºæœªå®ç° Iterator æ¥å£
console.log(1[Symbol.iterator]) // undefined
console.log({}[Symbol.iterator]) // undefined
console.log('abc'[Symbol.iterator]) // Æ’ [Symbol.iterator]() { [native code] }
console.log([][Symbol.iterator]) // Æ’ values() { [native code] }
</code></pre>
<h2>äº”ã€è‡ªå®šä¹‰è¿­ä»£å™¨</h2>
<p>æ™®é€šå¯¹è±¡ï¼Œä¸ºä»€ä¹ˆä¸å®ç°é»˜è®¤ Iterator æ¥å£ã€‚ä¸»è¦æ˜¯å› ä¸ºå¯¹è±¡çš„å±æ€§æ˜¯æ— åºçš„ï¼Œå…ˆéå†å“ªä¸ªå±æ€§ï¼Œåéå†å“ªä¸ªå±æ€§æ˜¯ä¸ç¡®å®šçš„ã€‚è‹¥éœ€è¦æœ‰åºçš„å¯¹è±¡ç»“æ„ï¼Œé‚£ä¸å°± <code>Map</code> å¯¹è±¡å˜›ã€‚å› æ­¤ï¼Œæ™®é€šå¯¹è±¡å¥½åƒæ²¡å¿…è¦é»˜è®¤éƒ¨ç½²è¿­ä»£å™¨æ¥å£äº†ã€‚</p>
<p>å°½ç®¡åŸç”Ÿæœªéƒ¨ç½² Iterator æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å•Šï¼Œæ ‡å‡†åˆæ²¡æœ‰é™åˆ¶æˆ‘ä»¬ä¸èƒ½è‡ªå®šä¹‰å¯¹å§ã€‚</p>
<p>æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ª <code>Counter</code> ç±»ï¼Œå¹¶å®ç° Iterator æ¥å£ã€‚</p>
<h3>1. ç²—ç•¥ç‰ˆæœ¬</h3>
<p>å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  // å®ç°è¿­ä»£å™¨åè®®
  next() {
    const isDone = this.min &gt; this.max
    return {
      done: isDone,
      value: isDone ? undefined : this.min++
    }
    // è¿­ä»£å™¨çš„ next() æ–¹æ³•ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ
    // å¯¹è±¡åŒ…æ‹¬ { done, value } å±æ€§ï¼Œ
    // å…¶ä¸­ done ä¸º falseï¼Œæˆ– value ä¸º undefined æ—¶ï¼Œè¿”å›å€¼å¯çœç•¥è¯¥å±æ€§ã€‚
    // è¿™é‡Œè¿”å› thisï¼ˆå³å®ä¾‹å¯¹è±¡ï¼‰ï¼Œå®ƒçš„åŸå‹ä¸Šå®ç°äº† next() æ–¹æ³•
  }

  // å®ç°å¯è¿­ä»£åè®®
  [Symbol.iterator]() {
    return this
    // @@iterator æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚
    // ä¸èƒ½è¿”å›ç±»ä¼¼ return 1 ç­‰æ— æ„ä¹‰çš„å€¼ï¼Œå¦åˆ™è¿›è¡Œè¿­ä»£æ“ä½œæ—¶ä¼šæŠ¥é”™ã€‚
  }
}
</code></pre>
<p>ä»¥ä¸Š <code>Counter</code> ç±»å®ç°äº†å¯è¿­ä»£åè®®å’Œè¿­ä»£å™¨åè®®ï¼Œå› æ­¤å…¶å®ä¾‹å¯¹è±¡å°±å…·å¤‡äº† Iterator æ¥å£ï¼Œå¯ä½¿ç”¨ <code>for...of</code> è¿›è¡Œè¿­ä»£ã€‚</p>
<pre><code class="language-js">const counter = new Counter([0, 3]) // { min: 0, max: 3 }
for (const x of counter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š0ã€1ã€2ã€3
</code></pre>
<p>å°½ç®¡å®ç°äº† Iterator æ¥å£ï¼Œä½†ä¸ç†æƒ³ã€‚åŸå› æ˜¯æ¯ä¸ªå®ä¾‹åªèƒ½è¢«è¿­ä»£ä¸€æ¬¡ï¼Œè€Œä¸”å®ä¾‹çš„ <code>min</code> å±æ€§å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<pre><code class="language-js">// ä¸Šä¸€ä¸ªä»£ç å—é‡Œé¢ï¼Œcounter å®ä¾‹å¯¹è±¡å·²è¿­ä»£è¿‡ä¸€æ¬¡
// ç°åœ¨å°è¯•å†è¿­ä»£ä¸€æ¬¡ï¼Œä»¥ä¸‹ä»£ç å¹¶ä¸ä¼šæ‰“å°å‡ºä»€ä¹ˆ
for (const x of counter) {
  console.log(x)
}

// åŸå› å¾ˆç®€å•ï¼š
// å½“æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ for...of ä¹‹å‰ï¼Œcounter å®ä¾‹å·²ç»å˜æˆï¼š{ mix: 4, max: 3 }
// ç„¶åæ‰§è¡Œåˆ° for...of çš„æ—¶å€™ï¼Œå†…éƒ¨åšäº†ä»¥ä¸‹è¿™äº›æ­¥éª¤ï¼š
// 1) é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå³è®¿é—®å®ä¾‹çš„ @@iterator æ–¹æ³•ï¼Œ
//    è¿”å›çš„è¿­ä»£å™¨å°±æ˜¯ thisï¼Œå€¼ä¸º { mix: 4, max: 3 }ã€‚
// 2) æ¥ç€å¾ªç¯ï¼Œå…¶å®å°±æ˜¯ä¸åœè°ƒç”¨è¿­ä»£å™¨çš„ next() æ–¹æ³•ï¼Œå³ this.next()
//    é‚£ä¹ˆå¾ªç¯ä»€ä¹ˆæ—¶å€™ç»ˆæ­¢å‘¢ï¼Œé‚£å°±æ˜¯ done ä¸º true æ—¶ï¼Œè¡¨ç¤ºéå†ç»“æŸã€‚
//    æ­¤æ—¶ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ next() æ–¹æ³•ï¼Œè¿”å›å€¼ done å°±æ˜¯ä¸º trueï¼Œå³ç»“æŸäº†ã€‚
//    å› æ­¤ï¼Œå‹æ ¹ä¸ä¼šæ‰§è¡Œ for...of çš„å¾ªç¯ä½“ï¼Œä¹Ÿå°±ä¸ä¼šæ‰“å°ç›¸å…³å€¼äº†ã€‚
//
// å¯é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹å»éªŒè¯ï¼š
// for (const x of counter) {
//   console.log(x)
//   if (x === 1) break
// }
// ä¾æ¬¡æ‰“å°ï¼š0ã€1
// for (const x of counter) {
//   console.log(x)
// }
// ä¾æ¬¡æ‰“å°ï¼š2ã€3
</code></pre>
<h3>2. æ”¹è¿›ç‰ˆæœ¬</h3>
<p>é‰´äºä»¥ä¸ŠåŸå› ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¹è¿›ä¸€ä¸‹ã€‚</p>
<p>ä¸ºäº†è®©ä¸€ä¸ªå®ä¾‹å¯¹è±¡èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªè¿­ä»£å™¨ï¼Œå¿…é¡»æ¯åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨å°±å¯¹åº”ä¸€ä¸ªæ–°è®¡ç®—å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè®¡ç®—å™¨å˜é‡æ”¾åˆ°é—­åŒ…é‡Œï¼Œç„¶åé€šè¿‡é—­åŒ…è¿”å›è¿­ä»£å™¨ã€‚</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  [Symbol.iterator]() {
    let point = this.min
    const end = this.max
    return {
      next: () =&gt; {
        const isDone = point &gt; end
        return {
          done: isDone,
          value: isDone ? undefined : point++
        }
      }
    }
  }
}

const counter = new Counter([0, 3])
for (const x of counter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š0ã€1ã€2ã€3
for (const x of counter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š0ã€1ã€2ã€3
</code></pre>
<p>ä»¥ä¸Šè¿™ç§æ”¹è¿›å†™æ³•ï¼Œä¸æ•°ç»„è¿­ä»£çš„è¡¨ç°æ˜¯ç›¸ä¼¼çš„ã€‚</p>
<h3>3. å®Œå–„ç‰ˆæœ¬</h3>
<p>ä½†ç›®å‰è·Ÿæ•°ç»„ï¼Œè¿˜å­˜åœ¨ä¸€ç‚¹åŒºåˆ«ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>// âœ… æ•°ç»„å¯ä»¥è¿™æ ·ä½¿ç”¨
const arr = [0, 1, 2, 3]
const iter = arr[Symbol.iterator]()
for (const x of iter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š0ã€1ã€2ã€3


// âŒ ä½†æ˜¯å¦‚æœ Counter è¿™æ ·å»ä½¿ç”¨
const counter = new Counter([0, 3])
const iter = counter[Symbol.iterator]()
// å½“ä»£ç æ‰§è¡Œåˆ° for...of è¿™è¡Œçš„æ—¶å€™ï¼Œå‘ç°å°±ä¼šæŠ¥é”™ï¼šTypeError: iter is not iterable
for (const x of iter) {
  console.log(x)
}
// åŸå› åˆ†æï¼š
// å…¶å®å¾ˆç®€å•ï¼Œä½¿ç”¨ for...of çš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨è®¿é—® iter[Symbol.iterator]ï¼Œ
// ä½† iter æ˜¯ä»…å«æœ‰ next å±æ€§ï¼ˆä¸è®¡åŸå‹ï¼‰çš„æ™®é€šå¯¹è±¡ï¼Œå¹¶æ²¡æœ‰ Symbol.iterator å±æ€§ï¼Œ
// å› æ­¤åˆ¤æ–­ iter ä¸æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ‰€ä»¥æŠ¥é”™ï¼šTypeError: iter is not iterable
</code></pre>
<p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦æˆ‘ä»¬ç»™ <code>iter</code> æ·»åŠ ä¸€ä¸ª <code>Symbol.iterator</code> å±æ€§ï¼Œå¹¶è¿”å›å…¶æœ¬èº«å³å¯ã€‚</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  [Symbol.iterator]() {
    let point = this.min
    const end = this.max
    return {
      [Symbol.iterator]() {
        // ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™ this æŒ‡å‘å°±ä¸å¯¹äº†
        // å› æ­¤ï¼Œæˆ‘ä¹ŸæŠŠä¸‹é¢ next æ–¹æ³•ï¼Œå°†åŸæ¥çš„ç®­å¤´å‡½æ•°æ”¹å›æ™®é€šå‡½æ•°
        return this
      },
      next() {
        const isDone = point &gt; end
        return {
          done: isDone,
          value: isDone ? undefined : point++
        }
      }
    }
  }
}
</code></pre>
<p>å†æ¬¡æ‰§è¡Œï¼Œå°±å¯ä»¥äº†ã€‚</p>
<pre><code class="language-js">const counter = new Counter([0, 3])
const iter = counter[Symbol.iterator]()
for (const x of iter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š0ã€1ã€2ã€3
</code></pre>
<h3>4. æ›´å®Œå–„ç‰ˆæœ¬</h3>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬åœ¨ <code>for...of</code> å¾ªç¯ä½¿ç”¨ <code>break</code>ã€<code>continue</code>ã€<code>return</code> æˆ– <code>throw</code> æå‰é€€å‡ºï¼Œæˆ–è€…ä½¿ç”¨è§£æ„æ“ä½œæœªæ¶ˆè´¹æ‰€æœ‰å€¼æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å°±æ­¤â€œå…³é—­â€è¿­ä»£å™¨ï¼ˆå³ <code>done</code> å˜ä¸º <code>true</code>ï¼‰ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆå™¨å¯¹è±¡è‹¥æå‰é€€å‡ºï¼Œå®ƒçš„çŠ¶æ€å°±ä¼šå…³é—­ã€‚</p>
</blockquote>
<p><strong>æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</strong></p>
<p>ECMAScript æ ‡å‡†ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªâ€œå¯é€‰â€çš„ <code>return()</code> æ–¹æ³•ï¼Œå®ƒå±äºè¿­ä»£å™¨åè®®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>ç”±äº <code>return()</code> æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œå› æ­¤å¹¶éæ‰€æœ‰æ•°æ®ç»“æ„çš„é»˜è®¤è¿­ä»£å™¨éƒ½æ˜¯å¯å…³é—­çš„ã€‚æ¯”å¦‚ï¼Œæ•°ç»„çš„è¿­ä»£å™¨å°±æ˜¯ä¸å¯å…³é—­çš„ã€‚è€Œç”Ÿæˆå™¨å¯¹è±¡å°±æ˜¯å¯å…³é—­çš„ã€‚</p>
<p>æ•°ç»„è¿­ä»£å™¨ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const arr = [1, 2, 3, 4, 5]
const iter = arr[Symbol.iterator]()

for (const x of iter) {
  console.log(x)
  if (x &gt; 3) break
}
// ä¾æ¬¡æ‰“å°ï¼š1ã€2ã€3

for (const x of iter) {
  console.log(x)
}
// ä¾æ¬¡æ‰“å°ï¼š4ã€5

// éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
// `for (const x of arr) {}` ä¸ `for (const x of iter) {}` æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ
// å‰è€…æ¯æ¬¡è°ƒç”¨ï¼Œå†…éƒ¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„è¿­ä»£å™¨ï¼Œå› æ­¤æ¯æ¬¡è¿­ä»£ï¼Œéƒ½ä¼šè¾“å‡º 0 ~ 5ï¼›
// è€Œåè€…åˆ™åŒä¸€ä¸ªè¿­ä»£å™¨ï¼Œå› æ­¤å†æ¬¡è¿­ä»£æ—¶ï¼Œä¼šæ¥ç€éå†ä¸‹ä¸€ä¸ªæˆå‘˜ã€‚
// æ‰€ä»¥ï¼Œä¸ç”¨è¯¯ä»¥ä¸ºæ•°ç»„çš„è¿­ä»£å™¨æ˜¯â€œå¯å…³é—­çš„â€ã€‚
</code></pre>
<p>ç”Ÿæˆå™¨å¯¹è±¡ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">function* generatorFn() {
  yield 0
  yield 1
  yield 2
  yield 3
}

// ç”Ÿæˆå™¨å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚
const gen = generatorFn() // generatorFnÂ {&lt;suspended&gt;}
for (const x of gen) {
  console.log(x)
  if (x === 1) break
}
console.log(gen) // generatorFnÂ {&lt;closed&gt;}
// è¿­ä»£å™¨â€œå…³é—­â€ä¹‹åï¼Œå†æ¬¡å»è¿­ä»£çš„è¯å°±æ²¡æ„ä¹‰äº†ï¼Œå®ƒä¸ä¼šæ‰“å°ä»»ä½•ä¸œè¥¿ã€‚
for (const x of gen) {
  // do something...
}
</code></pre>
<p>å…¶å® <code>return()</code> çš„å®ç°è¦æ±‚ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒå¿…é¡»è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ <code>IteratorResult</code> å¯¹è±¡ã€‚ä¸€èˆ¬æƒ…å†µï¼Œå¯ä»¥åªè¿”å› <code>{ done: true }</code>ã€‚å› ä¸ºè¿™ä¸ªè¿”å›å€¼åªä¼šç”¨åœ¨ç”Ÿæˆå™¨çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<p>æˆ‘ä»¬åŸºäºå‰é¢çš„ <code>Counter</code> ç±»ï¼Œä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  [Symbol.iterator]() {
    let point = this.min
    const end = this.max
    let isDone
    return {
      [Symbol.iterator]() {
        return this
      },
      next() {
        isDone = isDone || (point &gt; end)
        return {
          done: isDone,
          value: isDone ? undefined : point++
        }
      },
      return() {
        console.log('Exiting early')
        isDone = true
        return { done: true }
        // åªä¼šåœ¨â€œæå‰é€€å‡ºâ€æ‰ä¼šè§¦å‘æ­¤æ–¹æ³•ï¼Œ
        // æ­£å¸¸éå†ç»“æŸï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œæ­¤æ–¹æ³•çš„ã€‚
      }
    }
  }
}
</code></pre>
<p>ä¸Šé¢é™¤äº†å®ç°äº† <code>return()</code> æ–¹æ³•ï¼Œä¸”åœ¨è§¦å‘ <code>return()</code> æ–¹æ³•æ—¶ï¼Œè¿­ä»£å™¨ä¹Ÿä¼šâ€œå…³é—­â€ï¼Œåªè¦å°†åŸå…ˆè¡¨ç¤ºæ˜¯å¦ç»“æŸçš„ <code>isDone</code> å˜é‡æåˆ°å¤–é¢ä¸€å±‚ï¼Œåˆ©ç”¨é—­åŒ…å³å¯å®ç°ã€‚</p>
<p>ä»¥ä¸‹ä¸ºâ€œæå‰é€€å‡ºâ€çš„æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°éƒ½è§¦å‘äº†æ­¤æ–¹æ³•ã€‚</p>
<pre><code class="language-js">const counter = new Counter([0, 3])
for (const x of counter) {
  console.log(x)
  if ( x === 1 ) break // æˆ– throw 'xxx' æˆ– return éƒ½è¡Œ
}
// ä¾æ¬¡æ‰“å°å‡ºï¼š0ã€1ã€&quot;Exiting early&quot;

const [a, b] = counter
// &quot;Exiting early&quot;
</code></pre>
<p>åˆ©ç”¨è¿­ä»£å™¨å®ä¾‹çš„ <code>return</code> å±æ€§ï¼Œå°±å¯ä»¥åˆ¤æ–­ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æ˜¯å¦å…·å¤‡å¯å…³é—­çš„ Iterator æ¥å£ã€‚ä½†æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½ç»™ä¸€ä¸ªä¸å¯å…³é—­çš„è¿­ä»£å™¨ä»…å¢åŠ  <code>return()</code> æ–¹æ³•ï¼Œä½¿å…¶å˜æˆå¯å…³é—­çš„ã€‚é™¤éè‡ªå®šä¹‰ Iterator æ¥å£å»è¦†ç›–åŸç”Ÿçš„ <code>Symbol.iterator</code> æ–¹æ³•ã€‚</p>
<h3>5. æœ€ç»ˆç‰ˆæœ¬</h3>
<p>æ—¢ç„¶åˆè¦æå‰å…³é—­ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥åˆ©ç”¨ Generator å‡½æ•°å‘¢ï¼Œç®€å•åˆå¿«æ·ã€‚</p>
<pre><code class="language-js">class Counter {
  constructor([min = 0, max = 10]) {
    this.min = min
    this.max = max
  }

  *[Symbol.iterator]() {
    let point = this.min
    const end = this.max
    while (point &lt;= end) {
      yield point++
    }
  }
}
</code></pre>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒGenerator å‡½æ•°æ˜¯å®ç°è‡ªå®šä¹‰è¿­ä»£å™¨çš„ä¸€ç§é€‰æ‹©ã€‚å®ƒéå¸¸å¼ºå¤§ï¼Œè¯­æ³•ä¸Šæ›´ä¸ºç®€ç»ƒã€‚ä½†å¦‚æœè¦å®ç°ç±»ä¼¼æ•°ç»„é»˜è®¤è¿­ä»£å™¨é‚£æ ·çš„è¯ï¼Œå°±ä¸èƒ½ç”¨å®ƒäº†ã€‚</p>
<blockquote>
<p>è‹¥å¯¹ Generator å‡½æ•°ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯çœ‹è¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/258">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h2>å…­ã€Iterator åº”ç”¨åœºæ™¯</h2>
<p>æ— è®ºæ˜¯é»˜è®¤çš„è¿­ä»£å™¨æ¥å£ï¼Œè¿˜æ˜¯è‡ªå®šä¹‰è¿­ä»£å™¨æ¥å£ï¼Œå®ƒä»¬ä¸»è¦ä¾›ä»¥è¯­æ³•æˆ–æ–¹æ³•æ¶ˆè´¹ã€‚ç›®å‰æœ‰ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼š</p>
<ul>
<li><code>for...of</code> å¾ªç¯</li>
<li>æ•°ç»„è§£æ„</li>
<li>æ‰©å±•è¿ç®—ç¬¦</li>
<li><code>Array.from()</code></li>
<li><code>new Set()</code></li>
<li><code>new Map()</code></li>
<li><code>Promise.all()</code></li>
<li><code>Promise.race()</code></li>
<li><code>Promise.allSettled()</code></li>
<li><code>Promise.any()</code></li>
<li><code>yield*</code> æ“ä½œç¬¦</li>
</ul>
<p>è¿™äº›è¯­æ³•ï¼ˆæ–¹æ³•ï¼‰å†…éƒ¨éƒ½ä¼šå»è®¿é—®ï¼ˆå¯è¿­ä»£ï¼‰å¯¹è±¡çš„ <code>@@iterator</code> æ–¹æ³•ï¼Œæˆ–å«ä½œ <code>Symbol.iterator</code> æ–¹æ³•ã€‚</p>
<p>The end.</p>
<!--

### å‚è€ƒ

* [https://my.oschina.net/u/3320818/blog/4283846](https://my.oschina.net/u/3320818/blog/4283846)
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Promise ä¸‹ç¯‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/256</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/256</guid>
            <pubDate>Sun, 26 Feb 2023 11:52:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0a856962074bceea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0a856962074bceea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ¥<a href="https://github.com/toFrankie/blog/issues/255">ä¸Šä¸€ç¯‡</a>ï¼Œç»§ç»­ä»‹ç»äº† Promise ç›¸å…³ APIã€‚</p>
<h3>ä¸€ã€Promise.resolve()</h3>
<p><code>Promise.resolve()</code> æ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªå€¼ï¼ˆé <code>Promise</code> å¯¹è±¡å®ä¾‹ï¼‰è½¬æ¢ä¸º <code>Promise</code> å¯¹è±¡å®ä¾‹ã€‚</p>
<pre><code class="language-js">const promise = Promise.resolve('foo')
// ç›¸å½“äº
const promise = new Promise(resolve =&gt; resolve('foo'))
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒä»ç„¶ä¼šéµå¾ª Event Loop æœºåˆ¶ï¼ŒåŒ…æ‹¬åé¢ä»‹ç»çš„å…¶ä»– APIã€‚å…·ä½“æ‰§è¡Œé¡ºåºæœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚</p>
</blockquote>
<p><code>Promise.resolve()</code> æ–¹æ³•çš„å‚æ•°åˆ†ä¸ºå››ç§æƒ…å†µï¼š</p>
<h5>1. ä¸å¸¦ä»»ä½•å‚æ•°</h5>
<p>å®ƒè¿”å›ä¸€ä¸ªçŠ¶æ€ä¸º <code>fulfilled</code>ï¼Œå€¼ä¸º <code>undefined</code> çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚</p>
<pre><code class="language-js">const promise = Promise.resolve()

// promise ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;fulfilled&quot;,
//   [[PromiseResult]]: undefined
// }
</code></pre>
<h5>2. å‚æ•°æ˜¯ä¸€ä¸ª Promise å®ä¾‹å¯¹è±¡</h5>
<p>è¿™æ—¶ï¼Œ<code>Promise.resolve()</code> å°†ä¼šä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¯¥å®ä¾‹ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå³ä½¿å‚æ•°æ˜¯ä¸€ä¸ª <code>rejected</code> çŠ¶æ€çš„ <code>Promise</code> å®ä¾‹ï¼Œè¿”å›çš„å®ä¾‹ä¹Ÿä¸ä¼šå˜æˆ <code>fulfilled</code> çŠ¶æ€ï¼Œä¸è¦è¢«è¿™ä¸ª <code>resolve</code> å­—é¢æ„æ€è¯¯è§£äº†ã€‚</p>
<pre><code class="language-js">const p1 = new Promise(resolve =&gt; resolve({ name: 'Frankie' })) // &quot;fulfilled&quot;
const p2 = new Promise((resolve, reject) =&gt; reject({ name: 'Frankie' })) // &quot;rejected&quot;
const p3 = Promise.resolve(p1)
const p4 = Promise.resolve(p2)

console.log(p1 === p3) // true
console.log(p2 === p4) // true

// p3 ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;fulfilled&quot;,
//   [[PromiseResult]]: { name: 'Frankie' }
// }

// p4 ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;rejected&quot;,
//   [[PromiseResult]]: { name: 'Frankie' }
// }
</code></pre>
<p>å…¶å®è¿™ç§æƒ…å†µï¼Œå°±æ˜¯<a href="https://www.jianshu.com/p/c96fbf1c8e58">ä¸Šä¸€ç¯‡</a>æåˆ°è¿‡çš„ã€‚</p>
<pre><code class="language-js">const p5 = new Promise(resolve =&gt; resovle(1))
const p6 = new Promise(resolve =&gt; {
  reslove(p5)
  // æ³¨æ„ï¼Œä¸è¦å°è¯•åœ¨æ­¤å¤„è°ƒç”¨ Promise.resolve()ï¼Œä¼šå¯¼è‡´æ— é™é€’å½’ã€‚
})
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>p6</code> çš„çŠ¶æ€å–å†³äº <code>p5</code> çš„çŠ¶æ€ã€‚</p>
<h5>3. å‚æ•°æ˜¯ä¸€ä¸ª thenable å¯¹è±¡</h5>
<p><code>thenable</code> å¯¹è±¡ï¼Œæ˜¯æŒ‡å…·æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">const obj = {
  then: function(resolve, reject) {
    resolve('foo')
  }
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>obj</code> å¯¹è±¡å°±æ˜¯ä¸€ä¸ª <code>thenable</code> å¯¹è±¡ã€‚<code>Promise.resolve()</code> æ–¹æ³•ä¼šå°†è¿™ä¸ª <code>thenable</code> å¯¹è±¡è½¬ä¸º <code>Promise</code> å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œ <code>thenable</code> å¯¹è±¡çš„ <code>then()</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-js">const obj = {
  then: function (resolve, reject) {
    console.log(2)
    resolve('foo')
    // reject('foo') // å¦‚æœæ˜¯è¿™æ ·ï¼Œæœ€ç»ˆ promise å¯¹è±¡å°†ä¼šå˜æˆäº† rejected çŠ¶æ€ã€‚
  }
}
const promise = Promise.resolve(obj)

promise.then(res =&gt; {
  console.log(3)
  console.log(res) // &quot;foo&quot;
})

console.log(1)
// æ‰“å°ç»“æœåˆ†åˆ«æ˜¯ 1ã€2ã€3ã€&quot;foo&quot;

// promise ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;fulfilled&quot;,
//   [[PromiseResult]]: &quot;foo&quot;
// }
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>obj</code> å¯¹è±¡çš„ <code>then()</code> æ–¹æ³•æ‰§è¡Œåï¼Œå¯¹è±¡ <code>promise</code> çš„çŠ¶æ€å˜æˆäº† <code>fulfilled</code>ï¼Œæ¥ç€æ‰§è¡Œæœ€åçš„é‚£ä¸ª <code>promise.then()</code> æ–¹æ³•ï¼Œæ‰“å°å‡º <code>&quot;foo&quot;</code>ã€‚</p>
<h5>4. å‚æ•°æ˜¯ä¸€ä¸ªä¸å…·æœ‰ then() æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–è€…å‹æ ¹ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯åŸå§‹å€¼ã€‚</h5>
<p>å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œ<code>Promise.resolve()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å¯¹è±¡ï¼ŒçŠ¶æ€ä¸º <code>fulfilled</code>ï¼Œä¸”è¯¥å®ä¾‹å¯¹è±¡çš„å€¼ï¼Œå°±æ˜¯è¯¥å‚æ•°å€¼ã€‚</p>
<pre><code class="language-js">const p1 = Promise.resolve('foo')
const p2 = Promise.resolve({})

// p1 ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;fulfilled&quot;,
//   [[PromiseResult]]: &quot;foo&quot;
// }

// p2 ç»“æœï¼š
// {
//   [[Prototype]]: Promise,
//   [[PromiseState]]: &quot;fulfilled&quot;,
//   [[PromiseResult]]: {}
// }
</code></pre>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬æ˜¯ç¬¬ 4 ç§æƒ…å†µå±…å¤šï¼Œæˆ‘ä¼¼ä¹çœŸçš„æ²¡è§è¿‡å‰ä¸‰ç§æƒ…å†µçš„ã€‚</p>
<h3>äºŒã€Promise.reject()</h3>
<p><code>Promise.reject()</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€æ€»æ˜¯ä¸º <code>rejected</code>ã€‚</p>
<pre><code class="language-js">const promise = Promise.reject('foo')

// ç›¸å½“äº
const promise = new Promise((resolve, reject) =&gt; reject('foo'))
</code></pre>
<p>è·Ÿ <code>Promise.resolve()</code> ä¸åŒçš„æ˜¯ï¼Œ<code>Promise.reject()</code> æ–¹æ³•çš„å‚æ•°ï¼ˆæ— è®ºæ˜¯åŸå§‹å€¼ã€æ™®é€šå¯¹è±¡ã€è¿˜æ˜¯ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼‰ï¼Œå°†ä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸ºè¿”å›å®ä¾‹å¯¹è±¡çš„å€¼ã€‚</p>
<pre><code class="language-js">Promise.reject('Oops').catch(err =&gt; {
  console.log(err === 'Oops') // true
  // do something...
})
</code></pre>
<h3>ä¸‰ã€Promise.all()</h3>
<p><code>Promise.all()</code> æ–¹æ³•ç”¨äºå°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚</p>
<pre><code class="language-js">const promise = Promise.all([p1, p2, p3])
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Promise.all()</code> æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­ <code>p1</code>ã€<code>p2</code>ã€<code>p3</code> éƒ½æ˜¯ <code>Promise</code> å®ä¾‹ã€‚å¦‚æœæ•°ç»„ä¸­åŒ…å«é <code>Promise</code> å®ä¾‹ï¼Œå®ƒä»¬ä¼šä½¿ç”¨ <code>Promise.resolve()</code> çš„æ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º <code>Promise</code> å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–ï¼Œ<code>Promise.all()</code> æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ <code>Promise</code> å®ä¾‹ã€‚</p>
<p>å…¶ä¸­ <code>promise</code> çš„çŠ¶æ€ç”± <code>p1</code>ã€<code>p2</code>ã€<code>p3</code> å†³å®šï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚</p>
<ul>
<li>
<p>åªæœ‰å½“ <code>p1</code>ã€<code>p2</code>ã€<code>p3</code> çš„çŠ¶æ€éƒ½å˜æˆ <code>fulfilled</code>ï¼Œ<code>promise</code> çš„çŠ¶æ€æ‰ä¼šå˜æˆ <code>fulfilled</code>ï¼Œæ­¤æ—¶ <code>p1</code>ã€<code>p2</code>ã€<code>p3</code> å®ä¾‹çš„å€¼ï¼Œä¼šç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¼ é€’ç»™ <code>promise</code>ã€‚</p>
</li>
<li>
<p>åªè¦  <code>p1</code>ã€<code>p2</code>ã€<code>p3</code>  ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢« <code>rejected</code>ï¼Œ<code>promise</code> çš„çŠ¶æ€å°±ä¼šå˜æˆ <code>rejected</code>ã€‚æ­¤æ—¶ç¬¬ä¸€ä¸ª <code>rejected</code> å®ä¾‹çš„å€¼ï¼ˆæ³¨æ„ï¼Œä¸ä¼šåƒä¸Šé¢ä¸€æ ·ç»„æˆæ•°ç»„å“¦ï¼‰ï¼Œä¼šä¼ é€’ç»™ <code>promise</code>ã€‚</p>
</li>
</ul>
<p>çœ‹ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">const userIds = [1, 3, 5]
const promiseArr = userIds.map(id =&gt; {
  return window.fetch(`/config/user/${id}`) // å‡è®¾æ˜¯è¯·æ±‚ç”¨æˆ·é…ç½®
})

Promise
  .all(promiseArr)
  .then(res =&gt; {
    // res æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€é¡¹å¯¹åº”æ¯ä¸ªå®ä¾‹çš„å€¼ï¼Œå³ [[PromiseResult]]
    // å¸¸è§åšæ³•æ˜¯å°† res è¿›è¡Œè§£æ„ï¼Œå³ Promise.all(promiseArr).then(([a, b, c]) =&gt; { /* do something... */ })
    // å‡è®¾ promiseArr æ˜¯ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œä¾‹å¦‚ç©ºæ•°ç»„ï¼ŒPromise.all([]) å®ä¾‹çŠ¶æ€ä¸º fulfilledï¼Œå€¼ä¸º []ã€‚
    // do something...
  })
  .catch(err =&gt; {
    // err ä¸º Promise.all() è¢« rejected çš„åŸå› ï¼ˆreasonï¼‰
  })
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>promiseArr</code> æ˜¯åŒ…å« 3 ä¸ª <code>Promise</code> å®ä¾‹çš„æ•°ç»„ï¼Œåªæœ‰è¿™ 3 ä¸ªå®ä¾‹çš„çŠ¶æ€éƒ½å˜æˆ <code>fulfilled</code>ï¼Œæˆ–å…¶ä¸­ä¸€ä¸ªå˜ä¸º <code>rejected</code>ï¼Œæ‰ä¼šè°ƒç”¨ <code>Promise.all()</code> æ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚</p>
<h3>å››ã€Promise.race()</h3>
<p><code>Promise.race()</code> æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚</p>
<pre><code class="language-js">const promise = Promise.race([p1, p2, p3])
</code></pre>
<p><code>Promise.race()</code> æ–¹æ³•åŒæ ·æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œåªè¦  <code>p1</code>ã€<code>p2</code>ã€<code>p3</code>  ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼ˆ<code>fulfiled</code> æˆ– <code>rejected</code>ï¼‰ï¼Œ<code>promise</code> çš„çŠ¶æ€å°±ä¼šè·Ÿç€æ”¹å˜ï¼Œè€Œä¸” <code>promise</code> å®ä¾‹çš„å€¼å°±æ˜¯ç‡å…ˆæ”¹å˜çš„å®ä¾‹çš„è¿”å›å€¼ã€‚è‹¥å¯è¿­ä»£å¯¹è±¡ä¸­çš„æŸä¸€é¡¹ä¸æ˜¯ <code>Promise</code> å®ä¾‹ï¼Œä»ä¼šä½¿ç”¨ <code>Promise.resolve()</code> è¿›è¡Œè½¬æ¢ã€‚</p>
<p>å½“ä¼ é€’ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>Promise.race()</code> å®ä¾‹çš„çŠ¶æ€å°†ä¼šä¸€ç›´åœç•™åœ¨ <code>pending</code>ã€‚è¿™ç‚¹è·Ÿ <code>Promise.all()</code> æ˜¯ä¸åŒçš„ã€‚</p>
<pre><code class="language-js">const p1 = Promise.all([])
const p2 = Promise.race([])

setTimeout(() =&gt; {
  console.log(p1) // PromiseÂ {&lt;fulfilled&gt;: Array(0)}
  console.log(p2) // PromiseÂ {&lt;pending&gt;}
})
</code></pre>
<h3>äº”ã€Promise.allSettled()</h3>
<p><code>Promise.allSettled()</code> æ˜¯ ES11 æ ‡å‡†å¼•å…¥çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒåŒæ ·è¿˜æ˜¯å°†å¤šä¸ª <code>Promise</code> å®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚åªæœ‰ç­‰æ‰€æœ‰å®ä¾‹éƒ½è¿”å›ç»“æœï¼ˆæ— è®ºæ˜¯ <code>fulfilled</code> è¿˜ <code>rejected</code>ï¼‰ï¼ŒåŒ…è£…å®ä¾‹çš„çŠ¶æ€æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>æˆ‘è®¤ä¸ºï¼Œè¿™ç®—æ˜¯å¯¹ <code>Promise.all()</code> å­˜åœ¨ <code>rejected</code> å®ä¾‹æƒ…å†µçš„ä¸€ç§è¡¥å…¨å§ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œ<code>Promise.allSettled()</code> çš„çŠ¶æ€ï¼Œåªå¯èƒ½æ˜¯ <code>pending</code> æˆ– <code>fulfilled</code> çŠ¶æ€ï¼Œä¸å¯èƒ½å­˜åœ¨ <code>rejected</code> çŠ¶æ€ã€‚å³åªä¼šä» <code>pending -&gt; fulfilled</code> çš„å˜åŒ–ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼Œå„ç§æƒ…å†µçš„ç»“æœå§ï¼š</p>
<pre><code class="language-js">const p1 = Promise.reject(1)
const p2 = Promise.resolve(2)
const p3 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; { reject(3) }, 1000)
})
const p4 = new Promise(() =&gt; { }) // p4 çŠ¶æ€å°†ä¼šä¸€ç›´åœç•™åœ¨ pending

const p5 = Promise.allSettled([]) // å‚æ•°ä¸ºç©ºè¿­ä»£å¯¹è±¡
const p6 = Promise.allSettled([p4])
const p7 = Promise.allSettled([p1, p2, p3])


setTimeout(() =&gt; {
  console.log('p1:', p1)
  console.log('p2:', p2)
  console.log('p3:', p3)
  console.log('p4:', p4)
  console.log('p5:', p5)
  console.log('p6:', p6)
  console.log('p7:', p7)

  p5.then(res =&gt; {
    console.log('p5 then:', res)
  })
  p6.then(res =&gt; {
    // è¿™é‡Œå°†ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º p6 ä¸€ç›´å¤„äº pending çŠ¶æ€
    console.log('p6 then:', res)
  })
  p7.then(res =&gt; {
    console.log('p7 then:', res)
  })
}, 2000)
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c10cf8e0ac76254f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>åˆ—ä¸¾ä»¥ä¸Šç¤ºä¾‹ï¼Œæ˜¯ä¸ºäº†å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</strong></p>
<ul>
<li>
<p><code>Promise.allSettled()</code> ä¸€å®šè¦ç­‰åˆ°å‚æ•°ä¸­æ¯ä¸€ä¸ª <code>Promise</code> çŠ¶æ€å®šå‹åï¼Œå®ƒè¿”å›çš„å®ä¾‹å¯¹è±¡æ‰ä¼šå®šå‹ä¸º <code>fulfilled</code> çŠ¶æ€ã€‚å¦åˆ™åªä¼šæ˜¯ <code>pending</code> çŠ¶æ€ã€‚</p>
</li>
<li>
<p>ç±»ä¼¼ <code>Promise.allSettled([])</code> æŠŠä¸€ä¸ªç©ºæ•°ç»„ï¼ˆç©ºçš„è¿­ä»£å¯¹è±¡ï¼‰ä½œä¸ºå‚æ•°ï¼Œæœ€åå®ä¾‹çš„çŠ¶æ€ä¸º <code>fulfilled</code>ï¼Œä¸”å®ä¾‹çš„å€¼ä¸ºç©ºæ•°ç»„ <code>[]</code>ã€‚</p>
</li>
<li>
<p>æ³¨æ„ <code>Promise.allSettled()</code> è¿”å›çš„å®ä¾‹çš„å€¼ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ•°ç»„æ¯é¡¹éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å±æ€§å–å†³äºå¯¹åº”å‚æ•° <code>Promise</code> å®ä¾‹çš„çŠ¶æ€ã€‚</p>
<p>ä¾‹å¦‚ <code>p1</code> çš„çŠ¶æ€ä¸º <code>rejected</code>ï¼Œ<code>p2</code> çš„çŠ¶æ€ä¸º <code>fulfilled</code>ã€‚å› æ­¤åŒ…è£…å®ä¾‹çš„å‰ä¸¤é¡¹çš„å¯¹è±¡åˆ†åˆ«ä¸º <code>{ status: &quot;rejected&quot;, reason: 1 }</code>ã€<code>{ status: &quot;fulfilled&quot;, value: 2 }</code>ï¼Œå…¶ä»–é¡¹åŒç†ã€‚å…¶ä¸­ <code>status</code> å±æ€§åªä¼šæ˜¯ <code>fulfilled</code> æˆ– <code>rejected</code> ä¸¤ä¸ªå­—ç¬¦ä¸²å€¼ã€‚ä¸»è¦åŒºåˆ«åœ¨äº <code>value</code> å±æ€§å’Œ <code>reason</code> å±æ€§ï¼Œå³ <code>fulfilled</code> çŠ¶æ€å¯¹åº” <code>value</code> å±æ€§ï¼Œè€Œ <code>rejected</code> çŠ¶æ€å¯¹åº” <code>reason</code> å±æ€§ã€‚</p>
</li>
</ul>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œåªå…³å¿ƒè¿™äº›æ“ä½œæœ‰æ²¡æœ‰ç»“æŸã€‚è¿™æ—¶ï¼Œä½¿ç”¨ <code>Promise.allSettled()</code> æ–¹æ³•å°±å¾ˆæœ‰ç”¨äº†ã€‚è€Œ <code>Promise.all()</code> æ˜¯æ²¡åŠæ³•ç¡®ä¿è¿™ä¸€ç‚¹çš„ã€‚</p>
<h3>å…­ã€Promise.any()</h3>
<p>åœ¨ ES12 æ ‡å‡†ä¸­ï¼Œå¼•å…¥äº† <code>Promise.any()</code> æ–¹æ³•ï¼Œå®ƒç”¨äºå°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚</p>
<p><code>Promise.any()</code> æ¥å—ä¸€ä¸ª <code>Promise</code> å¯è¿­ä»£å¯¹è±¡ï¼Œåªè¦å‚æ•°å®ä¾‹ä¸­æœ‰ä¸€ä¸ªå˜æˆ <code>fulfilled</code> çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ <code>fulfilled</code> çŠ¶æ€ï¼Œå…¶å€¼å°±æ˜¯å‚æ•°å®ä¾‹çš„å€¼ã€‚</p>
<p><code>Promise.any()</code> ä¸ <code>Promise.race()</code> å¾ˆåƒï¼Œåªæœ‰ä¸€ä¸ªä¸åŒç‚¹ï¼Œå°±æ˜¯ <code>Promise.any()</code> ä¸ä¼šå› ä¸ºæŸä¸ªå‚æ•° <code>Promise</code> å®ä¾‹å˜æˆ <code>rejected</code> çŠ¶æ€è€Œæ¥å—ï¼Œå¿…é¡»è¦ç­‰åˆ°æ‰€æœ‰å‚æ•°å®ä¾‹çš„çŠ¶æ€éƒ½å˜ä¸º <code>rejected</code>ï¼ŒåŒ…è£…å®ä¾‹çš„çŠ¶æ€æ‰ä¼šæ˜¯ <code>rejected</code>ã€‚</p>
<pre><code class="language-js">const p1 = Promise.reject(1)
const p2 = Promise.resolve(2)
const p3 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; { reject(3) }, 1000)
})
const p4 = new Promise(() =&gt; { }) // p4 çŠ¶æ€å°†ä¼šä¸€ç›´åœç•™åœ¨ pending

const p5 = Promise.any([]) // p5 ä¼šå˜æˆ rejected çŠ¶æ€
const p6 = Promise.any([p4])
const p7 = Promise.any([p1, p2, p3])
const p8 = Promise.any([p1, p3])


setTimeout(() =&gt; {
  console.log('p1:', p1)
  console.log('p2:', p2)
  console.log('p3:', p3)
  console.log('p4:', p4)
  console.log('p5:', p5)
  console.log('p6:', p6)
  console.log('p7:', p7)
  p5.then(res =&gt; {
    console.log('p5 then:', res)
  }).catch(err =&gt; {
    // p5 çš„çŠ¶æ€ä¼šå˜æˆ rejectedï¼Œå› æ­¤ä¼šæ‰§è¡Œåˆ°è¿™é‡Œã€‚
    console.log('p5 catch:', err)
  })
  p6.then(res =&gt; {
    // p6 çš„çŠ¶æ€ä¸€ç›´ä¼šæ˜¯ pendingï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œå›è°ƒã€‚
    console.log('p6 then:', res)
  })
  p7.then(res =&gt; {
    console.log('p7 then:', res)
  })
  p8.then(res =&gt; {
    console.log('p8 then:', res)
  }).catch(err =&gt; {
    // æ³¨æ„ err æ˜¯ä¸€ä¸ªå¯¹è±¡
    console.log('p8 catch:', err)
    console.dir(err)
  })
}, 2000)
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-dae47cea41aed79a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“ <code>Promise.any()</code> è¿”å›çš„å®ä¾‹å˜æˆ <code>rejected</code> æ—¶ï¼Œå…¶å®ä¾‹çš„å€¼æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/AggregateError">AggregateError</a> å®ä¾‹ã€‚ä½†ä¼ é€’ä¸€ä¸ªç©ºçš„è¿­ä»£å¯¹è±¡ï¼Œ<code>Promise.any()</code> åŒ…è£…å®ä¾‹ä¹Ÿä¼šå˜æˆ <code>rejected</code> çŠ¶æ€ï¼Œå¦‚ <code>p5</code>ã€‚</p>
<h3>ä¸ƒã€æ€»ç»“</h3>
<p>å…³äº <code>Promise.all()</code>ã€<code>Promise.race()</code>ã€<code>Promise.allSettled()</code>ã€<code>Promise.any()</code> æ–¹æ³•ï¼Œæ€»ç»“ä»¥ä¸‹ç‰¹ç‚¹ã€‚</p>
<blockquote>
<ul>
<li>
<p>å®ƒä»¬çš„ç”¨å¤„éƒ½æ˜¯å°†å¤šä¸ª <code>Promise</code> å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚</p>
</li>
<li>
<p>å®ƒä»¬éƒ½æ¥å—ä¸€ä¸ªå…·æœ‰ Iterator æ¥å£çš„å¯è¿­ä»£å¯¹è±¡ï¼Œé€šå¸¸ä¸ºæ•°ç»„ã€‚ä¸”ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚</p>
</li>
<li>
<p>å®ƒä»¬å¤„ç†å‚æ•°ä¸ºç©ºçš„å¯è¿­ä»£å¯¹è±¡çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œæœ¬æ¥å°±æ˜¯è¦å¤„ç†å¤šä¸ª <code>Promise</code> å¯¹è±¡ï¼Œæ‰ä¼šç”¨åˆ°å®ƒä»¬ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µæ— éœ€ç†ä¼šã€‚çœŸé‡åˆ°å†å›æ¥ç¿»é˜…æ–‡æ¡£å³å¯ï¼Œç°åœ¨æˆ‘å†™åˆ°è¿™é‡Œéƒ½è®°ä¸å¤ªæ¸…æ¥šå…¶ä¸­çš„åŒºåˆ«äº†ï¼Œä½†é—®é¢˜ä¸å¤§ã€‚</p>
</li>
<li>
<p><code>Promise.all()</code> å½“æ‰€æœ‰å®ä¾‹å‡ä¸º <code>fulfilled</code> çŠ¶æ€ï¼Œæœ€ç»ˆçš„åŒ…è£…å®ä¾‹æ‰ä¼šæ˜¯ <code>fulfilled</code>ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å¦åˆ™å°†ä¼šæ˜¯ <code>rejected</code> çŠ¶æ€ï¼›</p>
<p><code>Promise.race()</code> åˆ™æ˜¯æŸä¸ªå®ä¾‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæœ€ç»ˆåŒ…è£…å®ä¾‹å°†å¯¹åº”ç‡å…ˆå˜åŒ–å®ä¾‹æ‰€å¯¹åº”çš„å€¼å’ŒçŠ¶æ€ã€‚â€œå‘ç”Ÿå˜åŒ–â€æ˜¯æŒ‡ <code>pending -&gt; fulfilled</code> æˆ– <code>pending -&gt; rejected</code>ã€‚</p>
<p><code>Promise.allSettled()</code> å•ä»å‘½åä¸Šæ¥çŒœæµ‹ï¼Œå°±çŸ¥é“å®ƒéœ€è¦ç­‰æ‰€æœ‰å‚æ•°å®ä¾‹ç¡®å®šçŠ¶æ€åï¼ŒåŒ…è£…å®ä¾‹çš„çŠ¶æ€æ‰ä¼šå˜æˆ <code>fulfilled</code> çŠ¶æ€ï¼Œæ³¨æ„å®ƒä¸å­˜åœ¨ <code>rejected</code> çŠ¶æ€çš„æƒ…å†µã€‚åŒ…è£…å®ä¾‹çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ¯é¡¹å¯èƒ½æ˜¯ <code>{ status: &quot;fulfilled&quot;, value: /* å¯¹åº” fulfilled çš„å€¼ */ }</code> æˆ– <code>{ status: &quot;rejected&quot;, reason: /* å¯¹åº” rejected çš„åŸå›  */ }</code>ï¼Œå–å†³äºæ¯ä¸ªå‚æ•°å®ä¾‹çš„çŠ¶æ€ã€‚</p>
<p><code>Promise.any()</code> å½“æŸä¸ªå‚æ•°å®ä¾‹çš„çŠ¶æ€å˜ä¸º <code>fulfilled</code>ï¼Œé‚£ä¹ˆåŒ…è£…å®ä¾‹å°±å®šå‹äº†ï¼Œå¯¹åº”è¯¥å‚æ•°å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚å¦åˆ™å®ƒå¿…é¡»ç­‰åˆ°æ‰€æœ‰å‚æ•°å®ä¾‹å˜ä¸º <code>rejected</code> çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹çš„çŠ¶æ€æ‰ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå˜ä¸º <code>rejected</code>ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ª <code>AggregateError</code> å®ä¾‹ã€‚</p>
</li>
</ul>
</blockquote>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Promise ä¸Šç¯‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/255</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/255</guid>
            <pubDate>Sun, 26 Feb 2023 11:52:17 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-18ec261b8fe65955.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-18ec261b8fe65955.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘è®¤ä¸º Promise åº”è¯¥ç®—æ˜¯ ES6 æ ‡å‡†æœ€å¤§çš„äº®ç‚¹ï¼Œå®ƒæä¾›äº†å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚æ¯”ä¼ ç»Ÿçš„å›è°ƒå‡½æ•°å’Œäº‹ä»¶è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ›´åˆç†ã€æ›´å¼ºå¤§ã€‚</p>
<h3>ä¸€ã€ç®€ä»‹</h3>
<p>Promise æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆä¸€èˆ¬ä¸ºå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šæ¥è¯´ï¼Œ<code>Promise</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
<p><strong><code>Promise</code> å¯¹è±¡çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><code>Promise</code> å¯¹è±¡æœ‰ä¸”åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ã€<code>fulfilled</code>ã€<code>rejected</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿›è¡Œä¸­ã€å·²æˆåŠŸã€å·²å¤±è´¥ã€‚</p>
</li>
<li>
<p>ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ã€‚çŠ¶æ€çš„æ”¹å˜åªæœ‰ä¸¤ç§å¯èƒ½ï¼š<code>pending -&gt; fulfilled</code> æˆ– <code>pending -&gt; rejected</code>ã€‚è‹¥å‘ç”Ÿäº†å…¶ä¸­ä¸€ç§æƒ…å†µï¼ŒçŠ¶æ€å°±ä¼šä¸€ç›´ä¿å­˜è¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±æˆä¸º <code>resolved</code>ï¼ˆå·²å®šå‹ï¼‰ã€‚</p>
</li>
</ul>
<p>è¿™ç§ä»¥â€œåŒæ­¥çš„æ–¹å¼â€å»è¡¨è¾¾å¼‚æ­¥æµç¨‹ï¼Œå¯ä»¥é¿å…å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œé¿å…å‡ºç°â€œå›è°ƒåœ°ç‹±â€ï¼ˆCallback Hellï¼‰ã€‚</p>
<blockquote>
<p>BTWï¼Œç½‘ä¸Šæœ‰äº›æ–‡ç« æŠŠ <code>fulfilled</code> çŠ¶æ€ï¼Œå«æˆ <code>resolved</code>ï¼Œå°½ç®¡æˆ‘ä»¬å¯èƒ½çŸ¥é“ä»–æƒ³è¡¨è¾¾çš„æ„æ€ï¼Œä½†å…¶å®æ˜¯ä¸å¯¹çš„ã€‚</p>
</blockquote>
<p><strong><code>Promise</code> å¯¹è±¡çš„ç¼ºç‚¹ï¼š</strong></p>
<p>ä¸€æ˜¯æ— æ³•å–æ¶ˆ <code>Promise</code>ï¼Œä¸€æ—¦åˆ›å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆï¼›äºŒæ˜¯è‹¥ä¸è®¾ç½®å›è°ƒå‡½æ•°æƒ…å†µä¸‹ï¼Œ<code>Promise</code> å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œä¸ä¼šåé¦ˆåˆ°å¤–éƒ¨ï¼›ä¸‰æ˜¯å½“å¤„äº <code>pending</code> çŠ¶æ€ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸ªé˜¶æ®µã€‚</p>
<h3>äºŒã€Promise ç”¨æ³•</h3>
<p>æ ¹æ®è§„å®šï¼Œ<code>Promise</code> æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚</p>
<h5>1. åˆ›å»º Promise å¯¹è±¡</h5>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const handler = (resolve, reject) =&gt; {
  // some statements...

  // æ ¹æ®å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œé€šè¿‡ resolve æˆ– reject å‡½æ•°å»æ”¹å˜ Promise å¯¹è±¡çš„çŠ¶æ€
  if (true) {
    // pending -&gt; fulfilled
    resolve(...)
  } else {
    // pending -&gt; rejected
    reject(...)
  }

  // éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
  // 1. åœ¨ä¸Šé¢ Promise çŠ¶æ€å·²ç»å®šå‹ï¼ˆfulfilled æˆ– rejectedï¼‰ï¼Œ
  //    å› æ­¤ï¼Œæˆ‘ä»¬å†ä½¿ç”¨ resolve() æˆ– reject() æˆ–ä¸»åŠ¨/è¢«åŠ¨æŠ›å‡ºé”™è¯¯çš„æ–¹å¼ï¼Œ
  //    è¯•å›¾å†æ¬¡ä¿®æ”¹çŠ¶æ€ï¼Œæ˜¯æ²¡ç”¨çš„ï¼ŒçŠ¶æ€ä¸ä¼šå†å‘ç”Ÿæ”¹å˜ã€‚
  // 2. å½“ Promise å¯¹è±¡çš„çŠ¶æ€â€œå·²å®šå‹â€åï¼Œè‹¥æœªä½¿ç”¨ return ç»ˆæ­¢ä»£ç å¾€ä¸‹æ‰§è¡Œï¼Œ
  //    åé¢ä»£ç å‡ºç°çš„é”™è¯¯ï¼ˆä¸»åŠ¨æŠ›å‡ºæˆ–è¯­æ³•é”™è¯¯ç­‰ï¼‰ï¼Œåœ¨å¤–éƒ¨éƒ½ä¸å¯è§ï¼Œæ— æ³•æ•è·åˆ°ã€‚
  // 3. hander å‡½æ•°çš„è¿”å›å€¼æ˜¯æ²¡æ„ä¹‰çš„ã€‚æ€ä¹ˆç†è§£ï¼Ÿ
  //    å‡è®¾å†…éƒ¨ä¸åŒ…æ‹¬ resolve() æˆ– reject() æˆ–å†…éƒ¨ä¸å‡ºç°è¯­æ³•é”™è¯¯ï¼Œ
  //    æˆ–ä¸ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œä»…æœ‰ç±»ä¼¼ `return 'anything'` è¯­å¥ï¼Œ
  //    é‚£ä¹ˆ promise å¯¹è±¡æ°¸è¿œéƒ½æ˜¯ pending çŠ¶æ€ã€‚
}

const promise = new Promise(handler)
</code></pre>
<p><code>Promie</code> æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ <code>resolve</code> å’Œ <code>reject</code>ã€‚è€Œ <code>resolve</code> å’Œ <code>rejeact</code> ä¹Ÿæ˜¯å‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯æ”¹å˜ <code>Promise</code> å¯¹è±¡çš„çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ <code>pending -&gt; fulfilled</code> å’Œ <code>pending -&gt; rejected</code>ã€‚</p>
<p>å‡è®¾æ„é€ å‡½æ•°å†…ä¸æŒ‡å®š <code>resolve</code> æˆ– <code>reject</code> å‡½æ•°ï¼Œé‚£ä¹ˆ <code>Promise</code> çš„å¯¹è±¡ä¼šä¸€ç›´ä¿æŒç€ <code>pending</code> å¾…å®šçš„çŠ¶æ€ã€‚</p>
<h4>2. Promise å®ä¾‹</h4>
<p><code>Promise</code> å®ä¾‹ç”Ÿæˆä»¥åï¼Œå½“ <code>Promise</code> å†…éƒ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ <code>Promise.prototype.then()</code> æ–¹æ³•è·å–åˆ°ã€‚</p>
<pre><code class="language-js">const success = res =&gt; {
  // å½“çŠ¶æ€ä» pending åˆ° fulfilled æ—¶ï¼Œæ‰§è¡Œæ­¤å‡½æ•°
  // some statements...
}

const fail = err =&gt; {
  // å½“çŠ¶æ€ä» pending åˆ° rejected æ—¶ï¼Œæ‰§è¡Œæ­¤å‡½æ•°
  // some statements...
}

promise.then(success, fail)
</code></pre>
<p><code>then()</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°åœ¨ <code>Promise</code> å¯¹è±¡çŠ¶æ€å˜ä¸º <code>fulfilled</code> æ—¶è¢«è°ƒç”¨ã€‚ç¬¬äºŒå›è°ƒå‡½æ•°åœ¨çŠ¶æ€å˜ä¸º <code>rejected</code> æ—¶è¢«è°ƒç”¨ã€‚<code>then()</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œç”±äº <code>Promise</code> å®ä¾‹å¯¹è±¡çš„ <code>Promise.prototype.then()</code>ã€<code>Promise.prototype.catch()</code>ã€<code>Promise.prototype.finally()</code> æ–¹æ³•å±äºå¼‚æ­¥ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡ã€‚æ³¨æ„å®ƒä»¬çš„æ‰§è¡Œæ—¶æœºï¼Œä¼šåœ¨å½“å‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œä¸”åœ¨ä¸‹ä¸€æ¬¡å®ä»»åŠ¡æ‰§è¡Œä¹‹å‰ï¼Œè¢«æ‰§è¡Œã€‚</p>
<p>è¿˜æœ‰ï¼Œ<code>Promise</code> æ„é€ å‡½æ•°ï¼ˆå³ä¸Šè¿°ç¤ºä¾‹çš„ <code>handler</code> å‡½æ•°ï¼‰å†…éƒ¨ï¼Œä»å±äºåŒæ­¥ä»»åŠ¡ï¼Œè€Œéå¼‚æ­¥ä»»åŠ¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œé‚£ä¸ªç»å…¸çš„é¢è¯•é¢˜å°±æ˜¯ï¼ŒåŒ…æ‹¬ <code>setTimeout</code>ã€<code>Promise</code> ç­‰ï¼Œç„¶åé—®è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿæœ¬è´¨å°±æ˜¯è€ƒå¯Ÿ JavaScript çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆEvent Loopï¼‰å˜›ã€‚è¿™å—å†…å®¹å¯ä»¥çœ‹ä¸‹æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/350a054c9562">JavaScript äº‹ä»¶å¾ªç¯</a>ã€‚</p>
</blockquote>
<p>æ’äº†ä¸ªè¯é¢˜ï¼Œå›æ¥</p>
<p><code>then()</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•° <code>success()</code>ã€<code>fail()</code>ï¼Œå®ƒä»¬æ¥æ”¶çš„å®å‚å°±æ˜¯ä¼ é€’ç»™ <code>resolve()</code> å’Œ <code>reject()</code> çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">function timeout(delay, status = true) {
  const promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      // ä¸€èˆ¬ reject åº”è¿”å›ä¸€ä¸ª Error å®ä¾‹å¯¹è±¡ï¼Œå¦‚ï¼šnew Error('Oops')
      status ? resolve('Success') : reject('Oops')
    })
  }, delay)
  return promise
}

// åˆ›å»ºä¸¤ä¸ª Promise å®ä¾‹å¯¹è±¡
const p1 = timeout(1000)
const p2 = timeout(1000, false)

// pending -&gt; fulfilled
p1.then(res =&gt; {
  console.log(res) // &quot;Success&quot;
})

// pending -&gt; rejected
p2.then(null, err =&gt; {
  console.warn(err) // &quot;Oops&quot;
})
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œæ ¹æ® <code>timeout</code> å‡½æ•°çš„é€»è¾‘ï¼Œ<code>p1</code> å®ä¾‹çš„ <code>Promise</code> çŠ¶æ€ä¼šä» <code>pending -&gt; fulfilled</code>ï¼Œè€Œ <code>p2</code> å®ä¾‹åˆ™æ˜¯ä» <code>pending -&gt; rejected</code>ã€‚å› æ­¤ä¼šåˆ†åˆ«æ‰“å°å‡º <code>&quot;Success&quot;</code>ã€<code>&quot;Oops&quot;</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„ä¾‹å­ã€‚</p>
<pre><code class="language-js">function loadImage(url) {
  return new Promise((resolve, reject) =&gt; {
    const image = new Image()
    image.onload = function () {
      resolve(image)
    }
    image.onerror = function () {
      reject(new Error(`Could not load image at ${url}.`))
    }
    image.src = url
  })
}

loadImage('https://jquery.com/jquery-wp-content/themes/jquery/images/logo-jquery@2x.png')
  .then(
    res =&gt; {
      console.log('Image loaded successfully:', res)
    },
    err =&gt; {
      console.warn(err)
    }
  )
</code></pre>
<p>å› æ­¤ï¼Œ<code>Promise</code> çš„ç”¨æ³•è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ˜¯é¢„æœŸç»“æœçš„è¯ï¼Œä½¿ç”¨ <code>resolve()</code> ä¿®æ”¹çŠ¶æ€ä¸º <code>fulfilled</code>ï¼Œéé¢„æœŸç»“æœä½¿ç”¨ <code>reject()</code> ä¿®æ”¹çŠ¶æ€ä¸º <code>rejected</code>ã€‚å…·ä½“è¿”å›å€¼æ ¹æ®å®é™…åœºæ™¯è¿”å›å°±å¥½ã€‚</p>
<h5>3. Promise æ³¨æ„äº‹é¡¹</h5>
<p>åœ¨æ„å»º <code>Promise</code> å¯¹è±¡çš„å†…éƒ¨ï¼Œä½¿ç”¨ <code>resolve()</code> æˆ– <code>reject()</code> å»æ”¹å˜ <code>Promise</code> çš„çŠ¶æ€ï¼Œå¹¶ä¸ä¼šç»ˆæ­¢ <code>resolve</code> æˆ– <code>reject</code> åé¢ä»£ç çš„æ‰§è¡Œã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  resolve(1)
  // ä»¥ä¸‹ä»£ç ä»ä¼šæ‰§è¡Œï¼Œä¸”ä¼šåœ¨ then ä¹‹å‰æ‰§è¡Œã€‚
  // reject() åŒç†ã€‚
  console.log(2)
})

promise.then(res =&gt; { console.log(res) }) // å…ˆåæ‰“å°å‡º 2ã€1
</code></pre>
<p>è‹¥è¦ç»ˆæ­¢åé¢çš„æ‰§è¡Œï¼Œåªè¦ä½¿ç”¨ <code>return</code> å…³é”®å­—å³å¯ï¼Œç±»ä¼¼ <code>return resolve(1)</code> æˆ– <code>return reject(1)</code>ã€‚ä½†å¦‚æœè¿™æ ·ï¼Œå…¶å®åé¢çš„ä»£ç å°±æ²¡æ„ä¹‰ï¼Œå› æ­¤ä¹Ÿå°±æ²¡å¿…è¦å†™äº†ã€‚åƒä¸‡åˆ«åœ¨å·¥ä½œä¸­å†™å‡ºè¿™æ ·çš„ä»£ç ï¼Œæˆ‘æ€•ä½ è¢«æ‰“ã€‚è¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜ <code>resolve</code> æˆ– <code>reject</code> ä¸ä¼šç»ˆæ­¢åé¢çš„ä»£ç æ‰§è¡Œè€Œå·²ã€‚</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨ <code>resolve()</code> æˆ– <code>reject()</code> è¯´æ˜å¼‚æ­¥æ“ä½œæœ‰äº†ç»“æœï¼Œé‚£ä¹ˆ <code>Promise</code> çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»­çš„æ“ä½œåº”è¯¥æ˜¯æ”¾åˆ° <code>then()</code> æ–¹æ³•é‡Œé¢ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ <code>resolve()</code> æˆ– <code>reject()</code> åé¢ã€‚</p>
</blockquote>
<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>resolve()</code> æˆ– <code>reject()</code> éƒ½æ˜¯è¿”å›ä¸€ä¸ªâ€œæ™®é€šå€¼â€ã€‚<strong>å¦‚æœæˆ‘ä»¬è¿”å›ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œå®ƒæ˜¯å…è®¸è¿”å›ä¸€ä¸ª <code>Promise</code> å¯¹è±¡çš„ï¼Œä½†æ˜¯æœ‰äº›åŒºåˆ«ã€‚</p>
<pre><code class="language-js">const p1 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; {
    resolve('p1 success')
    // reject('p1 fail')
  }, 3000)
})

const p2 = new Promise((resolve, reject) =&gt; {
  // è¿™æ—¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡
  // âš ï¸ æ³¨æ„ï¼Œè¿™é‡Œ resolve(p1) æˆ– reject(p1) æ‰§è¡Œçš„é€»è¾‘ä¼šæœ‰æ‰€ä¸åŒã€‚
  resolve(p1)
  // reject(p1)
})

p2.then(
  res =&gt; {
    console.log('p2 then:', res)
  },
  err =&gt; {
    console.log('p2 catch:', err)
  }
)
</code></pre>
<p>åˆ†æå¦‚ä¸‹ï¼š</p>
<pre><code class="language-md">1. è‹¥ p2 å†…é‡Œé¢ `resolve(p1)` æ—¶ï¼š

   å½“ä»£ç æ‰§è¡Œåˆ° `resolve(p1)` æ—¶ï¼Œç”±äº p1 çš„çŠ¶æ€ä»æ˜¯ pendingï¼Œ
   è¿™æ—¶ p1 çš„çŠ¶æ€ä¼šä¼ é€’ç»™ p2ï¼Œä¹Ÿå°±æ˜¯è¯´ p1 çš„çŠ¶æ€å†³å®šäº† p2 çš„çŠ¶æ€ï¼Œ
   å› æ­¤ `p2.then()` éœ€è¦ç­‰ p1 çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰ä¼šè¢«è°ƒç”¨ï¼Œ
   ä¸” `p2.then()` è·å–åˆ°çš„çŠ¶æ€å°±æ˜¯ p1 çš„çŠ¶æ€

   å‡è®¾ä»£ç æ‰§è¡Œåˆ° `resolve(p1)` æ—¶ï¼Œè‹¥ p1 çš„çŠ¶æ€å·²å®šå‹ï¼Œå³ fulfilled æˆ– rejectedï¼Œ
   ä¼šç«‹å³è°ƒç”¨ `p2.then()` æ–¹æ³•ã€‚
   PSï¼šè¿™é‡Œâ€œç«‹å³â€æ˜¯æŒ‡ï¼Œå½“å‰åŒæ­¥ä»»åŠ¡å·²æ‰§è¡Œå®Œæ¯•çš„å‰æä¸‹ã€‚ç¬¬ 2 ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
  
2. è‹¥ p2 å†…æ˜¯ `reject(p1)` æ—¶ï¼Œæƒ…å†µä¼šæœ‰æ‰€ä¸åŒï¼š

   å½“ä»£ç æ‰§è¡Œåˆ° `reject(p1)` æ—¶ï¼Œç”±äº p2 çš„çŠ¶æ€ä¼šå˜æ›´ä¸º rejectedï¼Œ
   æ¥ç€ä¼šç«‹å³è°ƒç”¨ `p2.then()` æ–¹æ³•ï¼Œç”±äºæ˜¯ rejected çŠ¶æ€ï¼Œ
   å› æ­¤ï¼Œä¼šè§¦å‘ `p2.then()` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ­¤æ—¶ err çš„å€¼å°±æ˜¯ p1ï¼ˆä¸€ä¸ª Promise å¯¹è±¡ï¼‰ã€‚

   å‡è®¾ p1 çš„çŠ¶æ€æœ€ç»ˆå˜æˆäº† rejectedï¼Œé‚£ä¹ˆ err è¿˜è¦æ•è·å¼‚å¸¸ï¼Œ
   ä¾‹å¦‚ `err.catch(err =&gt; { /* do something... */ })`ï¼Œ
   å¦åˆ™çš„è¯ï¼Œåœ¨æ§åˆ¶å°ä¼šæŠ¥é”™ï¼Œç±»ä¼¼ï¼š&quot;Uncaught (in promise) p1 fail&quot;ï¼Œ
   åŸå› å°±æ˜¯ Promise å¯¹è±¡çš„ rejected çŠ¶æ€æœªå¤„ç†ï¼Œå¯¼è‡´çš„ã€‚

   å‡è®¾ p1 çš„çŠ¶æ€æœ€ç»ˆå˜æˆ fulfilledï¼Œé‚£ä¹ˆä¸éœ€è¦åšä¸Šä¸€æ­¥ç±»ä¼¼çš„å¤„ç†ã€‚
</code></pre>
<p>ä¸Šé¢ä¸¤ç§æƒ…å†µï¼Œå…¶å®ç›¸å½“äº <code>Promise.resolve(p1)</code>ã€<code>Promise.reject(p1)</code>ã€‚æˆ‘ä»¬æ¥æ‰“å°ä¸€ä¸‹ä¸¤ç§ç»“æœï¼š</p>
<p>å½“ <code>p1</code> çŠ¶æ€ä¸º <code>fulfilled</code> æ—¶ï¼Œ<code>p2</code> çŠ¶æ€å¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e858edcf254c6d2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“ <code>p1</code> çŠ¶æ€ä¸º <code>rejected</code> æ—¶ï¼Œ<code>p2</code> çŠ¶æ€å¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-39c1d0be9d98341b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>ä¸‰ã€Promise.prototype.then()</h3>
<p><code>Promise</code> çš„å®ä¾‹å…·æœ‰ <code>then()</code> æ–¹æ³•ï¼Œå®ƒæ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡ <code>Promise.prototype</code> ä¸Šçš„ã€‚å½“ <code>Promise</code> å®ä¾‹å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ–¹æ³•å°±ä¼šè¢«è§¦å‘è°ƒç”¨ã€‚</p>
<p>å‰é¢æåˆ° <code>Promise.prototype.then()</code> æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸¤è€…å‡å¯é€‰ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<p><code>then()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ª <code>Promise</code> å®ä¾‹ï¼‰ï¼Œä¹Ÿå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³ <code>then()</code> æ–¹æ³•åé¢å¯ä»¥å†è°ƒç”¨å¦ä¸€ä¸ª <code>then()</code> æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API</a> è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼š</p>
<pre><code class="language-js">window.fetch('/config')
  .then(response =&gt; response.json())
  .then(
    res =&gt; {
      // do something...
    },
    err =&gt; {
      // do something...
    }
  )
  // .then() // ...
</code></pre>
<p>ä»¥ä¸Šé“¾å¼è°ƒç”¨ï¼Œä¼šæŒ‰ç…§é¡ºåºè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œåä¸€ä¸ª <code>then()</code> çš„æ‰§è¡Œï¼Œéœ€ç­‰åˆ°å‰ä¸€ä¸ª <code>Promise</code> å¯¹è±¡çš„çŠ¶æ€å®šå‹ã€‚</p>
<h3>å››ã€Promise.prototype.catch()</h3>
<p><code>Promise.prototype.catch()</code> æ–¹æ³•æ˜¯ <code>then(null, rejection)</code> æˆ– <code>then(undefined, rejection)</code> çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>åŒæ ·åœ°ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚</p>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  reject('Oops') // æˆ–é€šè¿‡ throw æ–¹å¼ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œä½¿å…¶å˜æˆ rejected çŠ¶æ€
  // ä½†æ³¨æ„çš„æ˜¯ï¼Œå‰é¢çŠ¶æ€â€œå®šå‹â€ä¹‹åï¼ŒçŠ¶æ€æ˜¯ä¸ä¼šå†å˜çš„ã€‚
  // è¿™åé¢è¯•å›¾æ”¹å˜çŠ¶æ€ï¼Œæˆ–ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œæˆ–å‡ºç°å…¶ä»–è¯­æ³•é”™è¯¯ï¼Œ
  // ä¸ä¼šè¢«å¤–éƒ¨æ•è·åˆ°ï¼Œå³æ— æ„ä¹‰ã€‚
})

promise.catch(err =&gt; {
  console.log(err) // &quot;Oops&quot;
})

// ç›¸å½“äº
promise.then(
  null,
  err =&gt; {
    console.log(err) // &quot;Oops&quot;
  }
)
</code></pre>
<p>é€šè¿‡ <code>throw</code> ç­‰æ–¹å¼ä½¿å…¶å˜æˆ <code>rejected</code> çŠ¶æ€ï¼Œç›¸å½“äºï¼š</p>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  try {
    throw 'Oops' 
    // ä¸€èˆ¬åœ°ï¼Œæ˜¯æŠ›å‡ºä¸€ä¸ª Errorï¼ˆæˆ–æ´¾ç”Ÿï¼‰å®ä¾‹å¯¹è±¡ï¼Œå¦‚ throw new Error('Oops')
  } catch (e) {
    reject(e)
  }
})
</code></pre>
<h3>äº”ã€æ•è· rejected çŠ¶æ€çš„ä¸¤ç§æ–¹å¼æ¯”è¾ƒ</h3>
<p>å‰é¢æåˆ°æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥æ•è· <code>Promise</code> å¯¹è±¡çš„ <code>rejected</code> çŠ¶æ€ã€‚é‚£ä¹ˆå­°ä¼˜å­°åŠ£å‘¢ï¼Ÿ</p>
<p>å»ºè®®å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å°½é‡ä¸è¦åœ¨ <code>Promise.prototype.then()</code> æ–¹æ³•é‡Œé¢å®šä¹‰ <code>onRejection</code> å›è°ƒå‡½æ•°ï¼ˆå³ <code>then()</code> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œæ€»ä½¿ç”¨ <code>Promise.prototype.catch()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  // some statements
})

// bad
promise.then(
  res =&gt; { /* some statements */ },
  err =&gt; { /* some statements */ }
)

// good
promise
  .then(res =&gt; { /* some statements */ })
  .catch(err =&gt; { /* some statements */ })
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œç¬¬äºŒç§å†™æ³•è¦å¥½äºç¬¬ä¸€ç§å†™æ³•ã€‚ç†ç”±æ˜¯ç¬¬äºŒç§å†™æ³•å¯ä»¥æ•è·å‰é¢ <code>then()</code> æ–¹æ³•ä¸­çš„å¼‚å¸¸æˆ–é”™è¯¯ï¼Œä¹Ÿæ›´æ¥è¿‘åŒæ­¥å†™æ³•ï¼ˆ<code>try...catch</code>ï¼‰ã€‚å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨ <code>Promise.prototype.catch()</code> æ–¹æ³•ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ <code>try...catch</code> ä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå³ä½¿ Promise å†…éƒ¨å‡ºç°é”™è¯¯ï¼Œä¹Ÿä¸ä¼šå½±å“ Promise å¤–éƒ¨ä»£ç çš„æ‰§è¡Œã€‚</p>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  say() // è¿™è¡Œä¼šæŠ¥é”™ï¼šReferenceError: say is not defined
})

promise.then(res =&gt; { /* some statements */ })

setTimeout(() =&gt; {
  console.log(promise) // è¿™é‡Œä»ä¼šæ‰§è¡Œï¼Œæ‰“å°å‡º promise å®ä¾‹å¯¹è±¡
})
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5a24f7c1c05023d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œåœ¨ Promise å†…éƒ¨å°±ä¼šå‘ç”Ÿå¼•ç”¨é”™è¯¯ï¼Œå› ä¸º <code>say</code> å‡½æ•°å¹¶æ²¡æœ‰å®šä¹‰ï¼Œä½†å¹¶æœªç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚æ¥ç€è¿˜ä¼šè¾“å‡º <code>promise</code> å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPromise å†…éƒ¨çš„é”™è¯¯å¹¶ä¸ä¼šå½±å“åˆ° Promise å¤–éƒ¨ä»£ç ï¼Œé€šä¿—çš„è¯´æ³•å°±æ˜¯â€œPromise ä¼šåƒæ‰é”™è¯¯â€ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœè„šæœ¬æ”¾åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œé€€å‡ºç å°±æ˜¯ <code>0</code>ï¼ˆè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼‰ã€‚ä¸è¿‡ Node.js æœ‰ä¸€ä¸ª <code>unhandledRejection</code> äº‹ä»¶ï¼Œå®ƒä¸“é—¨ç›‘å¬æœªæ•è·çš„ <code>reject</code> é”™è¯¯ï¼Œè„šæœ¬ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå¯ä»¥åœ¨ç›‘å¬å‡½æ•°é‡Œé¢æŠ›å‡ºé”™è¯¯ã€‚å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2429ba9484f40f5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ³¨æ„ï¼ŒNode.js æœ‰è®¡åˆ’åœ¨æœªæ¥åºŸé™¤ <code>unhandledRejection</code> äº‹ä»¶ã€‚å¦‚æœ Promise å†…éƒ¨ç”±æœªæ•è·çš„é”™è¯¯ï¼Œä¼šç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œå¹¶ä¸”è¿›ç¨‹çš„é€€å‡ºç ä¸ä¸º <code>0</code>ã€‚</p>
<p>åœ¨ <code>catch()</code> æ–¹æ³•ä¸­ï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºé”™è¯¯ã€‚è€Œä¸”ç”±äº <code>then()</code> å’Œ <code>catch()</code> æ–¹æ³•å‡è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå†™å‡ºä¸€ç³»åˆ—çš„...</p>
<pre><code>const promise = new Promise((resolve, reject) =&gt; {
  reject('Oops')
})

promise
  .then(res =&gt; { /* some statements */ })
  .catch(err =&gt; { throw new Error('Oh...') })
  .catch(err =&gt; { /* è¿™é‡Œå¯ä»¥æ•è·ä¸Šä¸€ä¸ª rejected çŠ¶æ€ */ })
  // ... è¿˜å¯ä»¥å†™ä¸€ç³»åˆ—çš„ thenã€catch æ–¹æ³•
</code></pre>
<h3>å…­ã€Promise.prototype.finally()</h3>
<p>åœ¨ ES9 æ ‡å‡†ä¸­ï¼Œå¼•å…¥äº† <code>Promise.prototype.finally()</code> æ–¹æ³•ï¼Œç”¨äºæŒ‡å®š <code>Promise</code> å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼ˆä¸ç®¡ <code>fulfilled</code> è¿˜æ˜¯ <code>rejected</code>ï¼‰åï¼Œéƒ½ä¼šè§¦å‘æ­¤æ–¹æ³•ã€‚</p>
<pre><code class="language-js">const promise = new Promise((resolve, reject) =&gt; {
  // some statements
})

promise
  .then(res =&gt; { /* some statements */ })
  .catch(err =&gt; { /* some statements */ })
  .finally(() =&gt; {
    // do something...
    // æ³¨æ„ï¼Œfinally ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè‡ªç„¶ä¹Ÿæ— æ³•å¾—çŸ¥ Promise å¯¹è±¡çš„çŠ¶æ€ã€‚
  })
</code></pre>
<blockquote>
<p>è‹¥ Promise å†…éƒ¨ä¸å†™ä»»ä½• <code>resovle()</code>ã€æˆ– <code>rejected()</code>ã€æˆ–æ— ä»»ä½•è¯­æ³•é”™è¯¯ï¼ˆå¦‚ä¸Šè¿°ç¤ºä¾‹ï¼‰ï¼Œ<code>Promise</code> å®ä¾‹å¯¹è±¡çš„çŠ¶æ€å¹¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå³ä¸€ç›´éƒ½æ˜¯ <code>pending</code> çŠ¶æ€ï¼Œå®ƒéƒ½ä¸ä¼šè§¦å‘ <code>then()</code>ã€<code>catch()</code>ã€<code>finally()</code> æ–¹æ³•ã€‚è¿™ç‚¹å°±æ€•æœ‰äººä¼šè¯¯è§£ï¼ŒçŠ¶æ€ä¸å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿä¼šè§¦å‘ <code>finally()</code> æ–¹æ³•ï¼Œè¿™æ˜¯é”™çš„ã€‚</p>
</blockquote>
<p><code>Promise.prototype.finally()</code> ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”è¯¥å®ä¾‹å¯¹è±¡çš„å€¼ï¼Œå°±æ˜¯å‰é¢ä¸€ä¸ª <code>Promise</code> å®ä¾‹å¯¹è±¡çš„å€¼ã€‚</p>
<pre><code class="language-js">const p1 = new Promise(resolve =&gt; resolve(1))
const p2 = p1.then().finally()
const p3 = p1.then(() =&gt; { }).finally()
const p4 = p1.then(() =&gt; { return true }).finally()
const p5 = p1.then(() =&gt; { throw 'Oops' /* å½“ç„¶è¿™é‡Œæ²¡å¤„ç† rejected çŠ¶æ€ */ }).finally()
const p6 = p1.then(() =&gt; { throw 'Oh...' }).catch(err =&gt; { return 'abc' }).finally()
const p7 = p1.finally(() =&gt; { return 'finally' })
const p8 = p1.finally(() =&gt; { throw 'error' })

setTimeout(() =&gt; {
  console.log('p1:', p1)
  console.log('p2:', p2)
  console.log('p3:', p3)
  console.log('p4:', p4)
  console.log('p5:', p5)
  console.log('p6:', p6)
  console.log('p7:', p7)
  console.log('p8:', p8)
})

// è§£é‡Šä¸€ä¸‹ `p1` å’Œ `p1.then()`ï¼š
// å½“ `then()` æ–¹æ³•ä¸­ä¸å†™å›è°ƒå‡½æ•°æ—¶ï¼Œä¼šå‘ç”Ÿå€¼çš„ç©¿é€ï¼Œ
// å³ `p1.then()` è¿”å›çš„æ–°å®ä¾‹å¯¹è±¡ï¼ˆå‡è®¾ä¸º `x`ï¼‰çš„å€¼è·Ÿ p1 å®ä¾‹çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œ
// ä½†æ³¨æ„ `p1` å’Œ `x` æ˜¯ä¸¤ä¸ªä¸åŒçš„ Promise å®ä¾‹å¯¹è±¡ã€‚
// å…³äºå€¼ç©¿é€çš„é—®é¢˜ï¼Œåé¢ä¼šç»™å‡ºç¤ºä¾‹ã€‚
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fcdada29d32920c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ ¹æ®æ‰“å°ç»“æœå¯ä»¥éªŒè¯ï¼š <code>finally()</code> æ–¹æ³•è¿”å›çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡çš„å€¼ä¸å‰ä¸€ä¸ª <code>Promise</code> å®ä¾‹å¯¹è±¡çš„å€¼æ˜¯ç›¸ç­‰çš„ï¼Œä½†å°½ç®¡å¦‚æ­¤ï¼Œä¸¤è€…æ˜¯ä¸¤ä¸ªä¸åŒçš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚å¯ä»¥æ‰“å°ä¸€ä¸‹ <code>p1 === p7</code>ï¼Œæ¯”è¾ƒç»“æœä¸º <code>false</code>ã€‚</p>
<p>å…³äº <code>Promise.prototype.finally()</code> çš„å®ç°ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">Promise.prototype.finally = function (callback) {
  let P = this.constructor
  return this.then(
    value =&gt; P.resolve(callback &amp;&amp; callback()).then(() =&gt; value),
    reason =&gt; P.resolve(callback &amp;&amp; callback()).then(() =&gt; { throw reason })
  )
}
</code></pre>
<h3>ä¸ƒã€æ€»ç»“</h3>
<p>å…³äº <code>Promise.prototype.then()</code>ã€<code>Promise.prototype.catch()</code>ã€<code>Promise.prototype.finally()</code> æ–¹æ³•ï¼Œæ€»ç»“ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>
<p>ä¸‰è€…å‡è¿”å›ä¸€ä¸ªå…¨æ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ã€‚</p>
</li>
<li>
<p>å³ä½¿ <code>then()</code>ã€<code>catch()</code>ã€<code>finally()</code> æ–¹æ³•åœ¨ä¸æŒ‡å®šå›è°ƒå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œä»ä¼šè¿”å›ä¸€ä¸ªå…¨æ–°çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œä½†æ­¤æ—¶ä¼šå‡ºç°**â€œå€¼ç©¿é€â€**çš„æƒ…å†µï¼Œå³å®ä¾‹å€¼ä¸ºå‰ä¸€ä¸ªå®ä¾‹çš„å€¼ã€‚</p>
</li>
<li>
<p>å‡è®¾ä¸‰è€…çš„å›è°ƒå‡½æ•°ä¸­æ— è¯­æ³•é”™è¯¯ï¼ˆåŒ…æ‹¬ä¸ä½¿ç”¨ <code>throw</code> å…³é”®å­—ï¼‰ æ—¶ï¼Œ<code>then()</code> å’Œ <code>catch()</code> æ–¹æ³•è¿”å›çš„å®ä¾‹å¯¹è±¡çš„å€¼ï¼Œä¾é  <code>return</code> å…³é”®å­—æ¥æŒ‡å®šï¼Œå¦åˆ™ä¸º <code>undefined</code>ã€‚</p>
<p>è€Œ <code>finally()</code> æ–¹æ³•ç¨æœ‰ä¸åŒï¼Œå³ä½¿ä½¿ç”¨äº† <code>return</code> ä¹Ÿæ˜¯æ— æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒè¿”å›çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡çš„å€¼æ€»æ˜¯å‰ä¸€ä¸ª <code>Promise</code> å®ä¾‹çš„å€¼ã€‚</p>
<p>ä¸‰ä¸ªæ–¹æ³•çš„è¿”å›æ“ä½œ <code>return any</code>ï¼Œç›¸å½“äº <code>Promise.resolve(any)</code>ï¼ˆè¿™é‡Œ <code>any</code> æ˜¯æŒ‡ä»»ä½•å€¼ï¼‰ã€‚</p>
</li>
<li>
<p>å½“ <code>then()</code>ã€<code>catch()</code>ã€<code>finally()</code> æ–¹æ³•ä¸­å‡ºç°è¯­æ³•é”™è¯¯æˆ–è€…åˆ©ç”¨ <code>throw</code> å…³é”®å­—ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œå®ƒä»¬è¿”å›çš„ <code>Promise</code> å®ä¾‹å¯¹è±¡çš„çŠ¶æ€ä¼šå˜æˆ <code>rejected</code>ï¼Œè€Œä¸”å®ä¾‹å¯¹è±¡çš„å€¼å°±æ˜¯æ‰€æŠ›å‡ºçš„é”™è¯¯åŸå› ã€‚</p>
</li>
<li>
<p><code>Promise</code> å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª <code>catch()</code> æ–¹æ³•æ•è·ã€‚</p>
</li>
</ul>
</blockquote>
<p>å…³äºå€¼çš„<strong>ç©¿é€</strong>ï¼Œè¯·çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const person = { name: 'Frankie' } // ä½¿ç”¨å¼•ç”¨å€¼æ›´èƒ½è¯´æ˜é—®é¢˜
const p1 = new Promise(resolve =&gt; resolve(person))
const p2 = new Promise((resolve, reject) =&gt; reject(person))

// æƒ…å†µä¸€ï¼šfulfilled
p1.then(res =&gt; {
  console.log(res === person) // true
})

// æƒ…å†µäºŒï¼šfulfilled
p1
  .then()
  .then(res =&gt; {
    console.log(res === person) // true
  })

// æƒ…å†µä¸‰ï¼šrejected
p2
  .catch()
  .then(res =&gt; { /* ä¸ä¼šè§¦å‘ then */ })
  .catch(err =&gt; {
    console.log(err === person) // true
  })

// æƒ…å†µå››ï¼šfulfilled
p1
  .finally()
  .then(res =&gt; {
    console.log(res === person) // true
  })
</code></pre>
<p>ä»ç»“æœä¸Šçœ‹ï¼Œå°½ç®¡ä¸‰è€…åœ¨ä¸æŒ‡å®šå›è°ƒå‡½æ•°çš„æƒ…å½¢ä¸‹ï¼Œâ€œä¼¼ä¹â€æ˜¯ä¸å½±å“ç»“æœçš„ã€‚ä½†å‰é¢æåˆ° <code>p1</code> è·Ÿ <code>p1.then()</code>ã€<code>p1.catch()</code>ã€<code>p1.finally()</code> éƒ½æ˜¯ä¸¤ä¸ªä¸åŒçš„ <code>Promise</code> å®ä¾‹å¯¹è±¡ï¼Œå°½ç®¡è¿™äº›å®ä¾‹å¯¹è±¡çš„å€¼æ˜¯ç›¸ç­‰çš„ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…å†™å‡ºè¿™äº›â€œæ— æ„ä¹‰â€çš„ä»£ç ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨å»å­¦ä¹ å®ƒä»¬çš„æ—¶å€™ï¼Œåº”è¯¥è¦çŸ¥é“ã€‚å°±æ˜¯â€œç”¨ä¸ç”¨â€å’Œâ€œä¼šä¸ä¼šâ€æ˜¯ä¸¤å›äº‹ã€‚</p>
<p><a href="https://github.com/toFrankie/blog/issues/256">ä¸‹ä¸€ç¯‡</a>æ¥ç€ä»‹ç» <code>Promise.all()</code>ã€<code>Promise.race()</code> ç­‰ï¼Œæœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åœ¨ forEach ä½¿ç”¨ async/await çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/254</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/254</guid>
            <pubDate>Sun, 26 Feb 2023 11:50:18 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a01830932b98fedc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a01830932b98fedc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€<a href="https://github.com/toFrankie/blog/issues/253">for è¯­å¥è¯¦è§£</a>ã€‘æåˆ°äº†åœ¨å¾ªç¯ä¸­åº”ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await">async/await</a> çš„ä¾‹å­ã€‚</p>
<p>äºæ˜¯ï¼Œé¡ºé“æä¸€ä¸‹åœ¨ <code>Array.prototype.forEach()</code> ä½¿ç”¨ <code>async/await</code> çš„é—®é¢˜ã€‚å…¶å®ï¼Œåœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#%E9%92%88%E5%AF%B9_promise_%E6%88%96_async_%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A4%87%E6%B3%A8">MDN</a> ä¸Šå°±æœ‰æé†’ï¼š</p>
<blockquote>
<p>å¦‚æœä½¿ç”¨ <code>promise</code> æˆ– <code>async</code> å‡½æ•°ä½œä¸º <code>forEach()</code> ç­‰ç±»ä¼¼æ–¹æ³•çš„ <code>callback</code> å‚æ•°ï¼Œæœ€å¥½å¯¹é€ æˆçš„æ‰§è¡Œé¡ºåºå½±å“å¤šåŠ è€ƒè™‘ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°é”™è¯¯ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">let sum = 0
const arr = [1, 2, 3]

async function sumFn(a, b) {
  return a + b
}

// ä¸ºäº†æ–¹ä¾¿åç»­ä¿®æ­£æ”¹é€ ï¼Œå°† forEach é€»è¾‘æ”¾åˆ°å‡½æ•° main ä¸­æ‰§è¡Œäº†ã€‚
function main(array) {
  array.forEach(async item =&gt; {
    sum = await sumFn(sum, item)
  })

  console.log(sum) // 0, Why?
}

main(arr)
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆ <code>sum</code> æ‰“å°ç»“æœæ˜¯ <code>0</code>ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„ <code>6</code> å‘¢ï¼Ÿ</strong></p>
<blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç†è§£ <code>async</code> å‡½æ•°çš„è¯­ä¹‰ï¼Œå®ƒè¡¨ç¤ºå‡½æ•°ä¸­æœ‰å¼‚æ­¥æ“ä½œï¼Œ<code>await</code> åˆ™è¡¨ç¤ºå…¶åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœï¼Œå‡½æ•°æœ€ç»ˆè¿”å›ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ã€‚</p>
</blockquote>
<p>å½“ä»£ç æ‰§è¡Œåˆ° <code>forEach</code> æ—¶ï¼š</p>
<pre><code class="language-text">1. é¦–å…ˆé‡åˆ° `sum = await sumFn(sum, item)` è¯­å¥ï¼ˆæ³¨æ„ï¼Œå®ƒæ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„ï¼‰
   å› æ­¤ï¼Œå®ƒä¼šæ‰§è¡Œ `sumFn(0, 1)`ï¼Œé‚£ä¹ˆè¯¥å‡½æ•° `return 1`ï¼Œ
   ç”±äº async å‡½æ•°å§‹ç»ˆä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå³ `return Promise.resolve(1)`ã€‚

2. ç”±äº await çš„åŸå› ï¼Œå®ƒå…¶å®ç›¸å½“äºæ‰§è¡Œ `Promise.resolve(3).then()` æ–¹æ³•ï¼Œ
   å®ƒå±äºå¾®ä»»åŠ¡ï¼Œä¼šæš‚æ—¶ Hold ä½ï¼Œè¢«æ”¾å…¥å¾®ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œå¾…æœ¬æ¬¡åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œ
   æ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤å¹¶ä¸ä¼šç«‹å³èµ‹å€¼ç»™ sumï¼ˆæ‰€ä»¥ sum ä»ä¸º 0ï¼‰ã€‚

3. é‚£ JS å¼•æ“ä¸»çº¿ç¨‹ä¸ä¼šé—²ç€çš„ï¼Œå®ƒä¼šç»§ç»­æ‰§è¡Œâ€œåŒæ­¥ä»»åŠ¡â€ï¼Œå³ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚
   åŒç†ï¼Œåˆå°† `return Promise.resolve(2)` æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
   ç›´åˆ°æœ€åä¸€æ¬¡å¾ªç¯ï¼ŒåŒæ ·çš„çš„è¿˜æ˜¯ `return Promise.resolve(3)`ã€‚
   å…¶å®åˆ°è¿™é‡Œï¼ŒforEach å…¶å®ç®—æ˜¯æ‰§è¡Œå®Œäº†ã€‚
   ä»¥ä¸Šç¤ºä¾‹ï¼ŒforEach çš„çœŸæ­£æ„ä¹‰æ˜¯åˆ›å»ºäº† 3 ä¸ªå¾®ä»»åŠ¡ã€‚

4. ç”±äºä¸»çº¿ç¨‹ä¼šä¸€ç›´æ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼Œå¾…åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„å¾®ä»»åŠ¡ã€‚
   å¾… forEach å¾ªç¯ç»“æŸä¹‹åï¼Œè‡ªç„¶ä¼šæ‰§è¡Œ `console.log(sum)`ï¼Œ
   ä½†æ³¨æ„ï¼Œç”±äº await çš„åŸå› ï¼Œsum ä¸€ç›´æœªè¢«é‡æ–°èµ‹å€¼ï¼Œå› æ­¤ sum è¿˜æ˜¯ä¸º 0 ï¼Œ
   æ‰€ä»¥æ§åˆ¶å°è¾“å‡ºäº† 0ã€‚

5. ç­‰ `console.log(sum)` æ‰§è¡Œå®Œæ¯•ï¼Œæ‰å¼€å§‹æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å¾®ä»»åŠ¡ï¼Œ
   å…¶ä¸­ `await Promise.resolve(0)` çš„ç»“æœï¼Œ
   ç›¸å½“äº `Promise.resolve(0)` çš„ then æ–¹æ³•çš„è¿”å›å€¼ï¼Œ
   æ‰€ä»¥æ­¤å‰çš„ä¸‰ä¸ªå¾®ä»»åŠ¡ï¼Œç›¸å½“äºï¼š
   `sum = 1`
   `sum = 2`
   `sum = 3`
   å®ƒä»¬è¢«ä¾æ¬¡æ‰§è¡Œã€‚

6. å› æ­¤ sum æœ€ç»ˆçš„å€¼å˜æˆäº† 3ï¼ˆæ³¨æ„ä¸æ˜¯ 6 å“¦ï¼‰ã€‚
</code></pre>
<p>æ‰€ä»¥ï¼Œåœ¨ <code>forEach</code> ä¸­ä½¿ç”¨ <code>async/await</code> å¯èƒ½æ²¡åŠæ³•åˆ°è¾¾é¢„æœŸç›®çš„å“¦ã€‚</p>
<p><strong>å¦‚ä½•è§£å†³ä»¥ä¸Šé—®é¢˜å‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...of">for...of</a> æ¥æ›¿ä»£ï¼š</p>
<pre><code class="language-js">let sum = 0
const arr = [1, 2, 3]

async function sumFn(a, b) {
  return a + b
}

// await è¦æ”¾åœ¨ async å‡½æ•°ä¸­
async function main(array) {
  for (let item of array) {
    sum = await sumFn(sum, item)
  }

  console.log(sum) // 6
}

main(arr)
</code></pre>
<p>è¿™æ ·å°±èƒ½è¾“å‡ºé¢„æœŸç»“æœ <code>6</code> äº†ã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆ <code>for...of</code> å°±å¯ä»¥å‘¢ï¼Ÿå› ä¸ºå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª <code>while</code> å¾ªç¯ã€‚</p>
<pre><code class="language-js">let sum = 0
const arr = [1, 2, 3]

async function sumFn(a, b) {
  return a + b
}

// await è¦æ”¾åœ¨ async å‡½æ•°ä¸­
async function main(array) {
  // for (let item of array) {
  //   sum = await sumFn(sum, item)
  // }

  // ç›¸å½“äº
  const iterator = array[Symbol.iterator]()
  let iteratorResult = iterator.next()
  while (!iteratorResult.done) {
    sum = await sumFn(sum, iteratorResult.value)
    iteratorResult = iterator.next()
  }

  console.log(sum) // 6
}

main(arr)
</code></pre>
<p>åªè¦äº†è§£äº† <code>async/await</code> å’Œ <code>for...of</code> çš„å†…éƒ¨è¿è¡Œæœºåˆ¶ï¼Œåˆ†æèµ·æ¥å°±ä¸éš¾äº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | for è¯­å¥è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/253</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/253</guid>
            <pubDate>Sun, 26 Feb 2023 11:48:04 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-880bd425782fc506.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»Šå¤©æ¥çœ‹]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-880bd425782fc506.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»Šå¤©æ¥çœ‹çœ‹ä¸€ä¸ªæœ€æœ€æœ€åŸºç¡€çš„ <code>for</code> è¯­å¥å§ï¼</p>
<p>æœ‰ä»€ä¹ˆå¥½è¯´çš„å‘¢ï¼Ÿè¯·å¾€ä¸‹çœ‹å§...</p>
<h3>ä¸€ã€è¯­æ³•</h3>
<p><code>for</code> è¯­å¥ç”¨äºåˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œå®ƒåŒ…å«äº†ä¸‰ä¸ª<strong>å¯é€‰</strong>çš„è¡¨è¾¾å¼ï¼ˆåŒ…å›´åœ¨åœ†æ‹¬å·ä¹‹ä¸­ï¼Œä½¿ç”¨åˆ†å· <code>;</code> åˆ†éš”ï¼‰ï¼Œåè·Ÿä¸€ä¸ªç”¨äºåœ¨å¾ªç¯ä¸­æ‰§è¡Œçš„è¯­å¥ï¼ˆé€šå¸¸ä¸º<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/block">å—è¯­å¥</a>ï¼‰ã€‚</p>
<pre><code class="language-js">for ([initialization]; [condition]; [final-expression])
  statement
</code></pre>
<ul>
<li>
<p><code>initialization</code>
ä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆåŒ…å«èµ‹å€¼è¯­å¥ï¼‰æˆ–å˜é‡å£°æ˜ã€‚å¯ä½¿ç”¨ <code>var</code> æˆ– <code>let</code> å£°æ˜å˜é‡ï¼ˆä½†ä¸èƒ½ä½¿ç”¨ <code>const</code> å…³é”®å­—å£°æ˜ï¼‰ã€‚ä½†ä¸¤è€…å£°æ˜çš„å˜é‡ä½œç”¨åŸŸä¸åŒï¼Œå‰è€… <code>var</code> ä¸ <code>for</code> å¾ªç¯å¤„äºåŒæ ·çš„ä½œç”¨åŸŸä¸­ï¼Œè€Œåè€… <code>let</code> åˆ™æ˜¯è¯­å¥çš„å±€éƒ¨å˜é‡ã€‚è¯¥è¡¨è¾¾å¼çš„ç»“æœæ— æ„ä¹‰ã€‚</p>
</li>
<li>
<p><code>condition</code>
ä¸€ä¸ªè¡¨è¾¾å¼è¢«ç”¨äºç¡®å®šæ¯ä¸€æ¬¡å¾ªç¯æ˜¯å¦èƒ½è¢«æ‰§è¡Œã€‚å¦‚æœè¡¨è¾¾å¼ç»“æœä¸º <code>true</code>ï¼Œ<code>statement</code> å°†è¢«æ‰§è¡Œã€‚è¯¥è¡¨è¾¾å¼æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¢«å¿½ç•¥ï¼Œé‚£ä¹ˆè¢«è®¤ä¸ºæ°¸è¿œä¸ºè¯ã€‚å¦‚æœè¡¨è¾¾å¼ç»“æœä¸º <code>false</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œæµç¨‹å°†è¢«è·³åˆ° <code>for</code> è¯­å¥ç»“æ„åé¢çš„ç¬¬ä¸€æ¡è¯­å¥ã€‚</p>
</li>
<li>
<p><code>final-expression</code>
æ¯æ¬¡å¾ªç¯çš„æœ€åéƒ½è¦æ‰§è¡Œçš„è¡¨è¾¾å¼ã€‚æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸‹ä¸€æ¬¡ <code>condition</code> çš„è®¡ç®—ä¹‹å‰ã€‚é€šå¸¸è¢«ç”¨äºæ›´æ–°æˆ–é€’å¢è®¡æ•°å™¨å˜é‡ã€‚</p>
</li>
<li>
<p><code>statement</code>
åªè¦ <code>condition</code> çš„ç»“æœä¸º <code>true</code>ï¼Œå°±ä¼šè¢«æ‰§è¡Œçš„è¯­å¥ã€‚è¦åœ¨å¾ªç¯ä½“å†…æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œä½¿ç”¨ä¸€ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/block">å—è¯­å¥</a>æ¥åŒ…æ‹¬è¦æ‰§è¡Œçš„è¯­å¥ã€‚æ²¡æœ‰ä»»ä½•è¯­å¥è¦æ‰§è¡Œï¼Œä½¿ç”¨ä¸€ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/Empty">ç©ºè¯­å¥</a>ï¼ˆ<code>;</code>ï¼‰</p>
</li>
</ul>
<p>ç±»ä¼¼ä¸‹é¢çš„å¾ªç¯è¯­å¥ï¼Œå†ç†Ÿæ‚‰å†å¸¸è§ä¸è¿‡äº†ã€‚</p>
<pre><code class="language-js">for (var i = 0; i &lt; 10; i++) {
  // statements
}
</code></pre>
<h3>äºŒã€ç¤ºä¾‹</h3>
<p>ç”±äº <code>for</code> è¯­å¥å¤´éƒ¨åœ†æ‹¬å·ä¸­çš„æ‰€æœ‰ä¸‰ä¸ªè¡¨è¾¾å¼éƒ½æ˜¯å¯é€‰çš„ï¼Œå› æ­¤ä¸‹é¢åˆ—ä¸¾ä¸€äº›ç›¸å¯¹æ²¡é‚£ä¹ˆâ€œå¸¸è§â€çš„ç¤ºä¾‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œçœç•¥ <code>initialization</code> åˆå§‹åŒ–å—ä¸­çš„è¡¨è¾¾å¼ï¼š</p>
<pre><code class="language-js">var i = 0
for (; i &lt; 10; i++) {
  console.log(i)
  // more statements
}
</code></pre>
<p>ä¾‹å¦‚ï¼Œçœç•¥ <code>condition</code> è¡¨è¾¾å¼ï¼Œä½†å¿…é¡»åœ¨ <code>statement</code> å¾ªç¯ä½“å†…è·³å‡ºå¾ªç¯ï¼Œé¿å…æ­»å¾ªç¯ã€‚</p>
<pre><code class="language-js">for (var i = 0; ; i++) {
  console.log(i)
  if (i &gt; 3) break
  // more statements
}
</code></pre>
<p>ç”šè‡³ï¼Œä½ å¯ä»¥å¿½ç•¥æ‰€æœ‰çš„è¡¨è¾¾å¼ã€‚åŒæ ·çš„ï¼Œè¦ç¡®ä¿ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/break"><code>break</code></a> è¯­å¥æ¥è·³å‡ºå¾ªç¯ï¼Œå¹¶ä¸”è¿˜è¦ä¿®æ”¹ï¼ˆå¢åŠ ï¼‰ä¸€ä¸ªå˜é‡ï¼Œä½¿å¾— <code>break</code> è¯­å¥çš„æ¡ä»¶åœ¨æŸä¸ªæ—¶å€™ä¸ºçœŸã€‚</p>
<pre><code class="language-js">var i = 0
for (; ;) {
  if (i &gt; 3) break
  console.log(i)
  i++
}
</code></pre>
<p>ä½†æœ‰ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå½“å¾ªç¯ä½“ <code>statement</code> ä¸æ‰§è¡Œä»»ä½•è¯­å¥æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªç©ºè¯­å¥ï¼ˆå³ <code>;</code>ï¼Œä¸”åˆ†å·æ˜¯ä¸èƒ½çœç•¥çš„ï¼‰ã€‚</p>
<pre><code class="language-js">for (var i = 0; i &lt; 10; i++)/* empty statement */;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„åˆ†å· <code>;</code> æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæ˜¯ JavaScript ä¸­çš„å°‘æ•°å‡ ç§å¼ºåˆ¶åˆ†å·çš„æƒ…å†µã€‚è‹¥æ²¡æœ‰åˆ†å·ï¼Œå¾ªç¯å£°æ˜ä¹‹åçš„è¡Œå°†è¢«è§†ä¸ºå¾ªç¯è¯­å¥ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">for (var i = 0; i &lt; 10; i++)
  console.log('loop') // è¿™ä¸ªè¢«å½“ä½œ for è¯­å¥çš„ statement å¾ªç¯ä½“
console.log('no loop') // ä½†è¿™ä¸ªä¸å±äºå¾ªç¯ä½“å“¦
</code></pre>
<h3>ä¸‰ã€BTW</h3>
<p>å…³äºèƒ½å¦çœç•¥åˆ†å·çš„é—®é¢˜ï¼Œé¡ºä¾¿ä¸€ä¸‹ã€‚</p>
<ol>
<li>åœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/if...else">if...else</a> è¯­å¥ä¸­ï¼Œæ ¹æ® ASI æœºåˆ¶ï¼Œç”±äº <code>)</code> å’Œ <code>else</code> æ— æ³•æ„æˆåˆæ³•çš„è¯­å¥ï¼Œä¸” JavaScript è§£æå™¨ä¸ä¼šåœ¨ <code>else</code> ä¹‹å‰è‡ªåŠ¨æ’å…¥åˆ†å· <code>; </code>ï¼Œå¯¼è‡´è¯æ³•åˆ†æé˜¶æ®µå°±å‡ºé”™äº†ã€‚</li>
</ol>
<pre><code class="language-js">// SyntaxError: Unexpected token 'else'
if (true) else console.log('...')

// Correct, but this &quot;if&quot; does nothing!
if (true); else console.log('...')
</code></pre>
<p>æ­£ç¡®åšæ³•æ˜¯ï¼Œéœ€ä¸»åŠ¨åœ¨ <code>else</code> ä¹‹å‰é”®å…¥åˆ†å· <code>;</code>ï¼ˆä¸å¯çœç•¥ï¼‰ï¼Œè¡¨ç¤º <code>if</code> æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œäº†ä¸€ä¸ªç©ºè¯­å¥ã€‚</p>
<ol start="2">
<li>åœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/do...while">do...while</a> è¯­å¥ä¸­ï¼Œä»¥ä¸‹å½¢å¼æ˜¯å…è®¸çš„å“¦ï¼Œè¯­æ³•ä¸ä¼šå‡ºé”™ã€‚</li>
</ol>
<pre><code class="language-js">do statement while(condition) out-of-loop-statement

// æ ¹æ® ASI æœºåˆ¶ï¼ŒJavaScript è§£æå™¨çœ‹åˆ°çš„å…¶å®æ˜¯é•¿è¿™æ ·çš„ï¼š
do statement; while(condition); out-of-loop-statement;
</code></pre>
<ol start="3">
<li>åœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for">for</a> è¯­å¥ä¸­ï¼Œå³ä½¿æŠŠ <code>initialization</code>ã€<code>condition</code>ã€<code>final-expression</code> è¡¨è¾¾å¼éƒ½çœç•¥äº†ï¼Œä½†æ˜¯åˆ†å· <code>;</code> å´ä¸€ä¸ªéƒ½ä¸èƒ½çœç•¥ã€‚å½“å¾ªç¯ä½“ä¸æ‰§è¡Œä»»ä½•è¯­å¥æ—¶ï¼Œåˆ†å· <code>;</code> ä¹Ÿä¸èƒ½çœç•¥ã€‚</li>
</ol>
<pre><code class="language-js">// Correct
for (; ;); // å½“ç„¶è¿™æ ·æ˜¯æ²¡æ„ä¹‰ï¼Œè€Œä¸”ä¼šé™·å…¥æ­»å¾ªç¯ã€‚ä½†è¯­æ³•æ˜¯æ­£ç¡®çš„ï¼Œä¸ºäº†ä¸¾ä¾‹ç½¢äº†ã€‚

// SyntaxError
for (;);

// Bad, å®¹æ˜“äº§ç”Ÿéé¢„æœŸç»“æœ
for (;;)
</code></pre>
<blockquote>
<p>å…³äº<strong>è‡ªåŠ¨åˆ†å·æ’å…¥</strong>ï¼ˆASIï¼ŒAutomatic Semicolon Insertionï¼‰ï¼Œè¯·çœ‹æ–‡ç«  <a href="https://github.com/toFrankie/blog/issues/223">JavaScript ASI æœºåˆ¶è¯¦è§£</a>ï¼ŒåŒ…æ‹¬ä¸Šè¿°ç¤ºä¾‹éƒ½æœ‰è¯¦ç»†æè¿°ã€‚</p>
</blockquote>
<h3>å››ã€è¢«å¿½ç•¥çš„åœ°æ–¹</h3>
<ol>
<li><code>for</code> è¯­å¥çš„ <code>initialization</code>ã€<code>condition</code>ã€<code>final-expression</code> é™¤äº†è¡¨è¾¾å¼å½¢å¼ï¼Œè¿˜å¯ä»¥æ˜¯å‡½æ•°å½¢å¼ã€‚è‹¥ <code>initialization</code>ã€ <code>final-expression</code> ä»¥å‡½æ•°å½¢å¼å­˜åœ¨ï¼Œå®ƒä»¬çš„è¿”å›å€¼æ˜¯æ— å®é™…æ„ä¹‰çš„ã€‚ä½†æ˜¯ <code>condition</code> åˆ™å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
</ol>
<pre><code class="language-js">for (var i = 0; i &lt; 10; i++) {
  console.log(i)
}

// ç›¸å½“äº
function compare(number) {
  // è‹¥ condition æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„è¡¨è¾¾å¼ï¼Œä½¿ç”¨å‡½æ•°å½¢å¼æˆ–è®¸å¯ä»¥ä½¿å¾—ä»£ç æ›´æ¸…æ™°ã€‚
  return number &lt; 10
}
for (var i = 0; compare(i); i++) {
  console.log(i)
}
</code></pre>
<h3>äº”ã€ç»å…¸é¢è¯•é¢˜</h3>
<p>åœ¨ <code>initialization</code> è¡¨è¾¾å¼ä¸­ä½¿ç”¨ <code>var</code> å’Œ <code>let</code> å£°æ˜å˜é‡æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<p>ä¸Šé¢æåˆ°ä½¿ç”¨ <code>var</code> å£°æ˜çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸä¸ <code>for</code> å¾ªç¯å¤„äºåŒæ ·çš„ä½œç”¨åŸŸä¸­ï¼Œè€Œä½¿ç”¨ <code>let</code> åˆ™æ˜¯ <code>for</code> å¾ªç¯å†…éƒ¨çš„å—çº§ä½œç”¨åŸŸã€‚</p>
<p>çœ‹çœ‹ä»¥ä¸‹ä¸¤ä¸ªç¤ºä¾‹çš„å¼‚åŒï¼Œä¸åŒç‚¹åœ¨äº <code>var</code> å’Œ <code>let</code>ï¼š</p>
<pre><code class="language-js">// ç¤ºä¾‹ä¸€
var arr = []
for (var i = 0; i &lt; 10; i++) {
  arr[i] = function () {
    console.log(i)
  }
}
arr[6]() // 10
</code></pre>
<pre><code class="language-js">// ç¤ºä¾‹äºŒ
var arr = []
for (let i = 0; i &lt; 10; i++) {
  arr[i] = function () {
    console.log(i)
  }
}
arr[6]() // 6
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸ºä»€ä¹ˆç»“æœä¼šæœ‰å·®å¼‚å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<blockquote>
<p>ç¤ºä¾‹ä¸€åˆ†æï¼š</p>
<p>åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript çš„å˜é‡æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ï¼Œåªæœ‰å‡½æ•°ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸã€‚æ‰€ä»¥ï¼Œåœ¨ç¤ºä¾‹ä¸€ä¸­ï¼Œå˜é‡ <code>i</code> ä¸ å˜é‡ <code>arr</code> åŒå±å…¨å±€ä½œç”¨åŸŸã€‚å½“å¾ªç¯æ‰§è¡Œå®Œæ¯•ï¼Œ<code>i</code> å·²ç»å¢åŠ åˆ° <code>10</code>ã€‚æ¥ç€æ‰§è¡Œ <code>arr[6]()</code>ï¼Œç”±äºåŒ¿åå‡½æ•° <code>function () { console.log(i) }</code> å†…éƒ¨å¹¶æ²¡æœ‰å£°æ˜ <code>i</code> å˜é‡ï¼Œäºæ˜¯ä»ä¸Šä¸€çº§ä½œç”¨åŸŸï¼ˆè¿™é‡Œçš„ä¸Šä¸€çº§ä½œç”¨åŸŸæ˜¯å…¨å±€ä½œç”¨åŸŸï¼‰ä¸­æŸ¥æ‰¾ <code>i</code>ï¼Œå¹¶æ‰¾åˆ°å…¶å€¼ä¸º <code>10</code>ï¼Œå› æ­¤æ‰“å°ç»“æœä¸º <code>10</code>ã€‚</p>
<p>æ³¨æ„ï¼Œåœ¨ç¤ºä¾‹ä¸€ä¸­ï¼Œç”±å§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸã€‚</p>
</blockquote>
<blockquote>
<p>ç¤ºä¾‹äºŒåˆ†æï¼š</p>
<p>åœ¨ç¤ºä¾‹äºŒä¸­ï¼Œä½¿ç”¨äº† <code>let</code> æ¥å£°æ˜å˜é‡ <code>i</code>ï¼Œæ­¤æ—¶ <code>i</code> ä¸å†ä¸ <code>arr</code> åŒå±å…¨å±€ä½œç”¨åŸŸäº†ã€‚</p>
<p>æ­¤æ—¶ï¼Œå…¶å®å­˜åœ¨ä¸‰ä¸ªä½œç”¨åŸŸï¼šåŒ…æ‹¬ <code>arr</code> æ‰€åœ¨çš„å…¨å±€ä½œç”¨åŸŸã€<code>i</code> æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸã€ä»¥åŠ <code>for</code> è¯­å¥å¾ªç¯ä½“å†…çš„å—çº§ä½œç”¨åŸŸã€‚ä¸ºä»€ä¹ˆæœ‰ä¸‰ä¸ªä¸åŒçš„ä½œç”¨åŸŸï¼Ÿçœ‹ç¤ºä¾‹ï¼š</p>
</blockquote>
<pre><code class="language-js">/* å…¨å±€ä½œç”¨åŸŸ */
for (let i = 0 /* å—çº§ä½œç”¨åŸŸ 1 */; i &lt; 10; i++) {
  /* å—çº§ä½œç”¨åŸŸ 2 */
  let i = 'abc'
  console.log(i) // ç»“æœæ˜¯æ‰“å°äº† 10 é &quot;abc&quot;ï¼Œè€Œä¸æ˜¯ 0 ~ 10 å“¦
}

// ç†ç”±ï¼š
// å‡è®¾ 1 å’Œ 2 æ˜¯åŒçº§ä½œç”¨åŸŸä¸‹ï¼Œæˆ‘ä»¬é‡å¤ä½¿ç”¨ let å…³é”®å­—æ¥å£°æ˜ i å˜é‡ï¼Œ
// ç†åº”æŠ›å‡ºè¯­æ³•é”™è¯¯ï¼Œå¦‚ï¼šSyntaxError: Identifier 'i' has already been declared
// ä½†äº‹å®ä¸Šè¿è¡Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œè¯´æ˜é€šè¿‡äº†è¯æ³•åˆ†æã€‚
// å†è€…ï¼Œå‡è®¾æˆ‘ä»¬åœ¨å¾ªç¯ä½“å†…å£°æ˜ let j = 'temp'ï¼Œç„¶ååœ¨ final-expression è¡¨è¾¾å¼å†…æ˜¯æ— æ³•è®¿é—®å˜é‡ j çš„ã€‚
// ç»¼ä¸Šï¼Œå¯çŸ¥å®ƒä¿©ä½œç”¨åŸŸæ˜¯ä¸ä¸€æ ·çš„ã€‚

// åŸºäºä»¥ä¸Šåè¯ç»“è®ºï¼Œæˆ‘ä»¬æœ‰ç†ç”±è®¤ä¸ºï¼š
// è‹¥åœ¨ for è¯­å¥çš„åœ†æ‹¬å·å’Œå¾ªç¯ä½“å†…ä½¿ç”¨äº† let æ¥å£°æ˜å˜é‡ï¼Œå®ƒä»¬æ‰€å¤„çš„ä½œç”¨åŸŸæ˜¯ä¸ä¸€æ ·çš„ã€‚
// è€Œåœ¨ for å¾ªç¯çš„åœ†æ‹¬å·çš„ä¸‰ä¸ªè¡¨è¾¾å¼ï¼Œå…¶ä½œç”¨åŸŸæ˜¯åŒä¸€ä¸ªã€‚
// æ³¨æ„ï¼Œåªèƒ½åœ¨å¾ªç¯ä½“å†…éƒ¨è®¿é—®åœ†æ‹¬å·å†…çš„å˜é‡ï¼Œåä¹‹ä¸è¡Œã€‚
</code></pre>
<p>æˆ‘ä»¬æ‰“ä¸ªæ–­ç‚¹çœ‹ä¸‹å°±æ¸…æ¥šäº†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e0f78debd0eb078c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>æ¥ç€åˆ†æç¤ºä¾‹äºŒï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>let</code> æ—¶ï¼Œæ¯æ¬¡å¾ªç¯ JavaScript å¼•æ“ä¼šé‡æ–°åˆ›å»ºç¯å¢ƒï¼Œå¤§è‡´æ˜¯æ‹·è´ä¸Šä¸€æ¬¡çš„å˜é‡åŠå…¶å€¼åˆ°æœ¬æ¬¡å¾ªç¯ä¸­ï¼ˆè¯¦æƒ…çœ‹æ ‡å‡†ï¼š<a href="https://262.ecma-international.org/#sec-createperiterationenvironment">CreatePerIterationEnvironment</a>ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé‡æ–°åˆ›å»ºç¯å¢ƒï¼Œ<code>i</code> è¿˜èƒ½å–åˆ°ä¸Šä¸€æ¬¡å€¼çš„åŸå› ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>initialization</code> è¡¨è¾¾å¼ä»…åœ¨é¦–æ¬¡æ‰§è¡Œ <code>for</code> å¾ªç¯çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸‹ä¸€æ¬¡åˆ›å»ºç¯å¢ƒçš„æ—¶å€™å¹¶ä¸ä¼šæ‰§è¡Œå®ƒï¼Œå› æ­¤ <code>i</code> ä¸ä¼šé‡ç½®ä¸º <code>0</code>ã€‚</p>
<p>è€Œæ¯æ¬¡å¾ªç¯ï¼Œå¾ªç¯ä½“ <code>statement</code> å†…éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå—çº§ä½œç”¨åŸŸï¼Œå¯¹åº”ä½œç”¨åŸŸå†…çš„ <code>i</code> å€¼å°±æ˜¯æœ¬æ¬¡å¾ªç¯çš„ <code>i</code> çš„å€¼ã€‚è€Œä¸”ï¼Œç”±äºæˆ‘ä»¬å¾ªç¯ä½“å†…å«æœ‰ <code>arr[i] = function () { console.log(i) }</code>ï¼Œä¼šå½¢æˆé—­åŒ…ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ€åæ‰§è¡Œ <code>arr[6]()</code> æ—¶ï¼Œå…ˆä»å—çº§ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾ï¼Œå¹¶æŸ¥æ‰¾åˆ°ä¸º <code>6</code>ï¼Œå› æ­¤å®ƒä¸ä¼šç»§ç»­å¾€ä¸Šä¸€çº§å—çº§ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šå†å¾€å…¨å±€ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾äº†ã€‚</p>
</blockquote>
<p>å¯ä»¥æ–­ç‚¹è°ƒè¯•çœ‹ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-81a780bfd051693c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è€Œç¤ºä¾‹ä¸€æ–­ç‚¹è°ƒè¯•å¯çŸ¥ï¼Œç”±å§‹è‡³ç»ˆå°±ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸã€‚ï¼ˆä¸è´´å›¾äº†ï¼‰</p>
<p>å…³äºç¤ºä¾‹äºŒï¼Œç›¸å½“äºä»¥ä¸‹è¿™æ ·ï¼Œé‚£ä½œç”¨åŸŸå°±æ›´åŠ åœ°æ¸…æ™°äº†ï¼š</p>
<pre><code class="language-js">var arr = []
{
  let i
  for (i = 0; i &lt; 10; i++) {
    let _i = i
    arr[_i] = function () {
      console.log(_i)
    }
  }
}
arr[6]() // 6
</code></pre>
<p>æˆ‘ä»¬å†çœ‹ä¸‹ï¼Œ<a href="https://www.babeljs.cn/repl#?browsers=&amp;build=&amp;builtIns=false&amp;corejs=3.6&amp;spec=false&amp;loose=false&amp;code_lz=G4QwTgBOkLwQ2gXQFADMD2kAUAbApgC4QCWEcADANwkQA8EAjFSQNQsCUEA3shFGGHjFEZCKgCuAOwDGBYukkQsnHnz7SFAZ3T4AdDnQBzLMXa8IAX2RXo8AGyJlQA&amp;debug=false&amp;forceAllTransforms=false&amp;modules=false&amp;shippedProposals=false&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Cstage-0&amp;prettier=true&amp;targets=&amp;version=7.25.5&amp;externalPlugins=&amp;assumptions=%7B%7D">Babel</a> æ˜¯å¦‚ä½•è½¬æ¢çš„ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-66f2bcb7bbdbbe42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>çœ‹åˆ°è¿™ä¸ªï¼Œé‚£ä¸å°±æƒ³èµ·é‚£ä¸ªç»å…¸é¢è¯•é¢˜ï¼šå¦‚ä½•ä¿®æ”¹ä»£ç ä½¿å…¶æ‰“å°å‡º 0 ~ 9 å—ï¼Ÿ</p>
<h3>å…­ã€ä¸ºä»€ä¹ˆ for...of é‡Œå¯ä»¥ç”¨ const å£°æ˜å˜é‡</h3>
<p>å‰é¢æåˆ°ï¼Œ<code>for</code> è¯­å¥é‡Œçš„ <code>initialization</code> éƒ¨åˆ†ä¸èƒ½ç”¨ <code>const</code> å£°æ˜å˜é‡ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">for (const i = 0; i &lt; 10; i++) {
  console.log(i)
}
</code></pre>
<p>æ‰§è¡Œä¼šæŠ›å‡º Uncaught TypeError: Assignment to constant variable å¼‚å¸¸ã€‚</p>
<p>åŸå› å¾ˆç®€å•ï¼Œ<code>(const i = 0; i &lt; 10; i++)</code> è¿™éƒ¨åˆ†æœ‰ä¸€ä¸ªä½œç”¨åŸŸï¼Œæ¯æ¬¡å¾ªç¯ä½“æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡Œ <code>i++</code> æ˜¯å¯¹æ­¤ä½œç”¨åŸŸé‡Œçš„ <code>i</code> å˜é‡é‡æ–°èµ‹å€¼ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚</p>
<p>ä½†æˆ‘ä»¬å¯ä»¥ç»å¸¸çœ‹åˆ°è¿™æ ·çš„ä»£ç ï¼Œæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼š</p>
<pre><code class="language-js">const arr = [0, 1, 2]

for (const i of arr) {
  console.log(i)
}
</code></pre>
<p>å®ƒç›¸å½“äº</p>
<pre><code class="language-js">const arr = [0, 1, 2]

const iterator = arr[Symbol.iterator]()
let result
while (result = iterator.next() &amp;&amp; !result.done) {
  console.log(result.value)
}
</code></pre>
<h3>ä¸ƒã€async åœ¨ for è¯­å¥ä¸­çš„åº”ç”¨</h3>
<p>ä¾‹å¦‚ï¼Œå®ç°ä¼‘çœ æ•ˆæœã€‚</p>
<pre><code class="language-js">function sleep(delay) {
  return new Promise(resolve =&gt; setTimeout(resolve, delay))
}

async function traverse() {
  for (let i = 1; i &lt;= 5; i++) {
    console.log(i)
    await sleep(1000)
  }
}

traverse() // é—´éš” 1 ç§’ï¼Œä¾æ¬¡è¾“å‡º 1 ~ 5
</code></pre>
<p>ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå¯ä»¥å®ç°å¤šæ¬¡é‡å¤å°è¯•ã€‚</p>
<pre><code class="language-js">async function request(url) {
  let res
  let err
  const MAX_NUM_RETRIES = 3

  for (let i = 0; i &lt; MAX_NUM_RETRIES; i++) {
    try {
      res = await fetch(url).then(res =&gt; res.json())
      break
    } catch (e) {
      err = e
      // Do nothing and make it continue.
    }
  }

  if (res) return res
  throw err
}

request('http://192.168.1.102:7701/config')
  .then(res =&gt; {
    console.log('success')
  })
  .catch(err =&gt; {
    console.log('fail')
  })
</code></pre>
<blockquote>
<p>BTWï¼Œåœ¨ <code>Array.prototype.forEach()</code> ä½¿ç”¨ <code>async/await</code> å¯èƒ½å¾—ä¸åˆ°é¢„æœŸç»“æœå“¦ï¼Œè¯¦æƒ…çœ‹<a href="https://github.com/toFrankie/blog/issues/254">æ–‡ç« </a>åˆ†æã€‚</p>
</blockquote>
<h3>å…«ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://262.ecma-international.org/#sec-for-statement">The for Statementï¼ˆECMAScriptï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/223">JavaScript ASI æœºåˆ¶è¯¦è§£</a></li>
<li><a href="https://es6.ruanyifeng.com/#docs/let">let å’Œ const å‘½ä»¤</a></li>
<li><a href="https://stackoverflow.com/questions/31987465/ecmascript-2015-const-in-for-loops">ECMAScript 2015: const in for loops</a></li>
</ul>
<!--
* [JavaScriptä¸­3ç§é£æ ¼çš„Forå¾ªç¯ï¼Œè¯¥æ€ä¹ˆç”¨ä½ çœŸçš„æ¸…æ¥šå—ï¼Ÿçœ‹å®Œå†ä¹Ÿä¸ä¼šæ··æ·†](https://zhuanlan.zhihu.com/p/96463659)
* [æ€ä¹ˆç†è§£ for å¾ªç¯ä¸­ç”¨letå£°æ˜çš„è¿­ä»£å˜é‡æ¯æ¬¡æ˜¯æ–°çš„å˜é‡ï¼Ÿ](https://segmentfault.com/q/1010000007541743)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Class ä¸‹ç¯‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/252</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/252</guid>
            <pubDate>Sun, 26 Feb 2023 11:45:29 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b9bb99494042c338.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b9bb99494042c338.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç»§<a href="https://github.com/toFrankie/blog/issues/251">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº† Class çš„è¯­æ³•ï¼Œä»Šå¤©æ¥çœ‹çœ‹ ES6 ä¸­çš„ç»§æ‰¿ã€‚</p>
<p>åœ¨ ES5 å¤§æ¦‚æœ‰ 6 ç§ç»§æ‰¿æ–¹å¼ï¼šç±»å¼ç»§æ‰¿ã€æ„é€ å‡½æ•°ç»§æ‰¿ã€ç»„åˆå¼ç»§æ‰¿ã€åŸå‹ç»§æ‰¿ã€å¯„ç”Ÿå¼ç»§æ‰¿ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼Œè€Œè¿™äº›æ–¹å¼éƒ½æœ‰ä¸€äº›å„è‡ªçš„ç¼ºç‚¹ï¼Œå¯çœ‹æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/213">æ·±å…¥ JavaScript ç»§æ‰¿åŸç†</a>ã€‚</p>
<p>è€Œ ES6 æ ‡å‡†æä¾›äº† Classï¼ˆç±»ï¼‰çš„è¯­æ³•æ¥å®šä¹‰ç±»ï¼Œè¯­æ³•å¾ˆåƒä¼ ç»Ÿçš„é¢å‘å¯¹è±¡å†™æ³•ã€‚æœ¬è´¨ä¸Šä»ç„¶æ˜¯é€šè¿‡åŸå‹å®ç°ç»§æ‰¿çš„ï¼Œå¯ä»¥ç†è§£ä¸º <code>class</code> åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œè·Ÿä¼ ç»Ÿé¢å‘å¯¹è±¡çš„ç±»åˆä¸ä¸€æ ·ã€‚åºŸè¯è¯´å®Œäº†ï¼Œå…¥æ­£é¢˜...</p>
<p><strong>é‚£ Class æ˜¯æ€æ ·å®ç°ç»§æ‰¿çš„å‘¢ï¼Ÿ</strong></p>
<h3>ä¸€ã€ç®€ä»‹</h3>
<p>é€šè¿‡ <code>extends</code> å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œæ¯” ES5 å†™ä¸€é•¿ä¸²çš„åŸå‹é“¾ï¼Œæ–¹ä¾¿æ¸…æ™°å¾ˆå¤šï¼Œå¯¹å§ã€‚</p>
<pre><code class="language-js">class Person {}

class Student extends Person {} // æ²¡é”™ï¼Œè¿™æ ·å°±å®ç°äº†ç»§æ‰¿
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª <code>Student</code>ï¼ˆå­ï¼‰ç±»ï¼Œè¯¥ç±»é€šè¿‡ <code>extends</code> å…³é”®å­—ç»§æ‰¿äº† <code>Person</code>ï¼ˆçˆ¶ï¼‰ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚ä½†ç”±äºä¸¤ä¸ªç±»ä¸­å¹¶æ²¡æœ‰å®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Œç›¸å½“äº <code>Student</code> å¤åˆ¶äº†ä¸€ä¸ª <code>Person</code> ç±»è€Œå·²ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥å­ç±»è‡ªå®ç°äº† <code>constructor</code> æ–¹æ³•ï¼Œéœ€åœ¨å…¶å†…éƒ¨ä½¿ç”¨ <code>super</code> å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦åˆ™å½“å­ç±»è¿›è¡Œå®ä¾‹åŒ–æ—¶ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<pre><code class="language-js">class Person {}

class Student extends Person {
  constructor() {
    super()
    // ç›¸å½“äºè°ƒç”¨çˆ¶ç±» Person çš„æ„é€ æ–¹æ³•ï¼Œ
    // ç›¸å½“äº Person.prototype.constructor.call(this)ï¼Œ
    // è€Œä¸”ï¼Œè‹¥ constructor å†…ä½¿ç”¨äº† this å…³é”®å­—ï¼Œ
    // super() ä¸€å®šè¦åœ¨ this ä¹‹å‰è¿›è¡Œè°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
  }
}

const stu = new Student() // ReferenceError: Must call super constructor in derived class before accessing 'this' or returning from derived constructor

// è‡³äºä¸ºä»€ä¹ˆä¸Šä¸€ä¸ªç¤ºä¾‹ï¼Œå®ä¾‹åŒ–æ—¶å¹¶ä¸ä¼šæŠ¥é”™ï¼ŒåŸå› å¦‚ä¸‹ï¼š
// å½“ constructor ç¼ºçœæ—¶ï¼ŒJS å¼•æ“ä¼šé»˜è®¤æ·»åŠ ä¸€ä¸ª constructor æ–¹æ³•ï¼Œç›¸å½“äºï¼š
// 
// class Person {}
// class Student extends Person {
//   constructor(...args) {
//     super(...args)
//   }
// }
</code></pre>
<p><strong>åŸå› æ˜¯ï¼ŒES5 çš„ç»§æ‰¿å®è´¨æ˜¯å…ˆåˆ›å»ºå­ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆå³ <code>this</code>ï¼‰ï¼Œç„¶åå†å°†çˆ¶ç±»çš„æ–¹æ³•æ·»åŠ åˆ°å®ä¾‹å¯¹è±¡ <code>this</code> ä¸Šï¼ˆç±»ä¼¼ <code>Parent.apply(this)</code>ï¼‰ã€‚è€Œ ES6 ç»§æ‰¿æœºåˆ¶å®Œå…¨ä¸åŒï¼Œå®ƒå…ˆå°†çˆ¶ç±»çš„å®ä¾‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ”¾åˆ° <code>this</code> ä¸Šï¼Œç„¶åå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°ä¿®æ”¹ <code>this</code>ã€‚å› æ­¤ï¼Œåœ¨å­ç±»ä½¿ç”¨ <code>this</code> ä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨ <code>super()</code> æ–¹æ³•æ‰§è¡Œçˆ¶ç±»çš„ <code>constructor()</code> æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡ <code>this</code>ã€‚</strong></p>
<p>æˆ‘ä»¬æ¥æ”¹ä¸‹ï¼š</p>
<pre><code class="language-js">class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }

  sayHi() {
    console.log(`Hi, my name is ${this.name}.`)
  }
}

class Student extends Person {
  constructor(name, age, stuNo) {
    super(name, age)
    this.stuNo = stuNo // this åªèƒ½åœ¨è°ƒç”¨ super() åä½¿ç”¨
  }
}

const stu = new Student('Frankie', 20, 2021001)
stu.sayHi() // &quot;Hi, my name is Frankie.&quot;
</code></pre>
<p>å®ä¾‹å¯¹è±¡ <code>stu</code> åŒæ—¶æ˜¯ <code>Student</code>ã€<code>Person</code> ç±»çš„å®ä¾‹ï¼Œè¿™ç‚¹ä¸ ES5 è¡¨ç°ä¸€è‡´ã€‚</p>
<pre><code class="language-js">stu instanceof Student // true
stu instanceof Person // true
</code></pre>
<h3>äºŒã€Object.getPrototypeOf()</h3>
<p>ä½¿ç”¨ <code>Object.getPrototypeOf()</code> å¯ä»¥é€šè¿‡å­ç±»è·å–å…¶ç›´æ¥çˆ¶ç±»ã€‚</p>
<pre><code class="language-js">Object.getPrototypeOf(stu) === Student // true
Object.getPrototypeOf(Student) === Person // true

// ä¹Ÿå¯ä»¥ä½¿ç”¨éæ ‡å‡†çš„ __proto__ è®¿é—®åŸå‹
stu.__proto__.constructor === Student // true
stu.__proto__ === Student.prototype // true
</code></pre>
<p>æä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto"><code>Object.prototype.__proto__</code></a> å¹¶ä¸æ˜¯ ECMAScript æ ‡å‡†ï¼Œåªæ˜¯è¢«å„å¤§æµè§ˆå™¨å‚å•†æ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨ã€‚ç°åœ¨è¢«æ¨èä½¿ç”¨çš„æ˜¯ï¼Œæ ‡å‡†æ”¯æŒçš„ <code>Objec.getPrototypeOf()</code>ã€<code>Object.setPrototypeOf()</code> æ–¹æ³•ã€‚</p>
<h3>ä¸‰ã€super å…³é”®å­—</h3>
<p>å…³é”®å­— <code>super</code> å¯ä»¥ä½œä¸º<strong>å‡½æ•°</strong>ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸º<strong>å¯¹è±¡</strong>ä½¿ç”¨ï¼Œä¸¤ç§æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<h5>1. super ä½œä¸ºå‡½æ•°</h5>
<p>å½“ <code>super</code> ä½œä¸ºå‡½æ•°ï¼Œåªèƒ½åœ¨ï¼ˆå­ç±»ï¼‰æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œè‹¥åœ¨éå­ç±»æˆ–ç±»çš„å…¶ä»–æ–¹æ³•ä¸­è°ƒç”¨ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚</p>
<pre><code class="language-js">class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
    console.log(new.target.name)
    // super() // è‹¥åœ¨æ­¤è°ƒç”¨ï¼Œä¼šæŠ¥é”™ï¼šSyntaxError: 'super' keyword unexpected here
  }

  sayHi() {
    console.log(`Hi, my name is ${this.name}.`)
  }
}

class Student extends Person {
  constructor(name, age, stuNo) {
    // super(name, age)
    console.log(super(name, age) === this) // true
    this.stuNo = stuNo // this åªèƒ½åœ¨è°ƒç”¨ super() åä½¿ç”¨
  }

  getStuNo() {
    // super() // è‹¥åœ¨æ­¤è°ƒç”¨ï¼Œä¼šæŠ¥é”™ï¼šSyntaxError: 'super' keyword unexpected here
    return this.stuNo
  }
}

const stu = new Student('Frankie', 20, 2021001) // æ‰“å°ï¼š&quot;Student&quot;
const person = new Person('Mandy', 18) // æ‰“å°ï¼š&quot;Person&quot;
</code></pre>
<p>åœ¨æ„é€ æ–¹æ³•å½“ä½œå‡½æ•°è°ƒç”¨ <code>super()</code>ï¼Œå®ƒä»£è¡¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚æ ¹æ® ES6 è§„å®šï¼Œå­ç±»çš„æ„é€ å‡½æ•°å¿…é¡»æ‰§è¡Œä¸€æ¬¡ <code>super</code> å‡½æ•°ã€‚å½“ç¼ºçœ <code>constructor()</code> æ–¹æ³•æ—¶ï¼ŒJS å¼•æ“ä¼šå¸®æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ï¼Œé‡Œé¢ä¹ŸåŒ…æ‹¬ <code>super()</code> çš„è°ƒç”¨ã€‚</p>
<p><strong>å°ç»“ï¼š</strong></p>
<ul>
<li>
<p><code>super()</code> åªèƒ½åœ¨å­ç±»çš„ <code>constructor()</code> æ–¹æ³•å†…è°ƒç”¨ï¼Œåœ¨ <code>getStuNo()</code> æ–¹æ³•å†…è°ƒç”¨ä¼šæŠ¥é”™ã€‚ä¾‹å¦‚ï¼Œç¤ºä¾‹ä¸­çˆ¶ç±» <code>Person</code> å¹¶æ²¡æœ‰ç»§æ‰¿è‡ªå…¶ä»–ç±»ï¼Œå› æ­¤åœ¨çˆ¶ç±» <code>Person</code> çš„ <code>constructor()</code>  æ–¹æ³•å†…è°ƒç”¨æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p>
</li>
<li>
<p>è°ƒç”¨ <code>super()</code> è¿”å›å½“å‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œå³ <code>this</code>ã€‚</p>
</li>
<li>
<p><code>new.target</code> æŒ‡å‘ç›´æ¥è¢« <code>new</code> æ‰§è¡Œçš„ç±»ã€‚å› æ­¤é€šè¿‡ <code>new Student()</code> å’Œ <code>new Person()</code> è¿›è¡Œå®ä¾‹åŒ–æ—¶ï¼Œ<code>new.target</code> åˆ†åˆ«æŒ‡å‘ <code>Student</code> ç±»å’Œ <code>Person</code> ç±»ã€‚</p>
</li>
</ul>
<h5>2. super ä½œä¸ºå¯¹è±¡</h5>
<p>å½“ <code>super</code> ä½œä¸ºå¯¹è±¡ä½¿ç”¨æ—¶ï¼Œåœ¨æ™®é€šæ–¹æ³•å†…ï¼ˆåŒ…æ‹¬ <code>constructor()</code> åœ¨å†…çš„éé™æ€æ–¹æ³•ï¼‰ï¼Œå®ƒæŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼ˆå³ <code>Parent.prototype</code>ï¼‰ï¼›è€Œåœ¨é™æ€æ–¹æ³•å†…ï¼Œå®ƒæŒ‡å‘çˆ¶ç±»ï¼ˆå³ <code>Parent</code>ï¼‰ã€‚</p>
<pre><code class="language-js">// çˆ¶ç±»
class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }

  sayHi() {
    console.log(`Hi, my name is ${this.name}.`)
  }

  printAge() {
    console.log(this.age)
  }

  static classMethodParent() {
    console.log(Person.name)
  }
}

Object.assign(Person.prototype, {
  prop: 'hhh'
})

// å­ç±»
class Student extends Person {
  constructor(name, age, stuNo) {
    super(name, age)
    this.stuNo = stuNo

    // ä½œä¸ºå¯¹è±¡ super ç›¸å½“äº Person.prototype
    super.sayHi() // &quot;Hi, my name is Frankie.&quot;
    console.log(super.name) // undefined
    console.log(super.prop) // &quot;hhh&quot;
  
    // å¦å¤–ï¼Œè¦æ³¨æ„ï¼š
    super.tmp = 'temporary' // ç›¸å½“äº this.tmp = 'temporary'
    console.log(super.tmp) // undefined
    console.log(this.tmp) // &quot;temporary&quot;
  }

  getStuNo() {
    return this.stuNo
  }

  getAge() {
    // æ™®é€šæ–¹æ³•å†…ï¼Œsuper æŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼Œ
    // å³ç›¸å½“äº Person.prototype.printAge.call(this)
    super.printAge()
  }

  static classMethod() {
    // é™æ€æ–¹æ³•å†…ï¼Œsuper æŒ‡å‘çˆ¶ç±»
    // ç›¸å½“äº Person.classMethodParent()
    super.classMethodParent()
  }
}

const stu = new Student('Frankie', 20, 2021001)
stu.getAge() // 20
Student.classMethod() // &quot;Person&quot;
</code></pre>
<p><strong>å°ç»“ï¼š</strong></p>
<ul>
<li>
<p>åœ¨æ™®é€šæ–¹æ³•å†…ï¼Œç±»ä¼¼ <code>super.xxx</code> ç­‰<strong>å–å€¼</strong>æ“ä½œï¼Œ<code>super</code> å‡æŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°å­ç±»æ„é€ æ–¹æ³•å†… <code>super.name</code> æ‰“å°ç»“æœä¸º <code>undefined</code>ï¼ŒåŸå› æ˜¯å±æ€§ <code>name</code> æ˜¯æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Šçš„ï¼Œè€Œä¸æ˜¯å®ä¾‹çš„åŸå‹å¯¹è±¡ä¸Šçš„ã€‚å³ <code>super.name</code> ç›¸å½“äº <code>Person.prototype.name</code>ã€‚</p>
</li>
<li>
<p>åœ¨æ™®é€šæ–¹æ³•å†…ï¼Œç±»ä¼¼ <code>super.xxx = 'xxx'</code> ç­‰<strong>èµ‹å€¼</strong>æ“ä½œï¼Œç›¸å½“äº <code>this.xxx = 'xxx'</code>ï¼Œå› æ­¤å±æ€§ <code>xxx</code> ä¼šè¢«æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Šï¼Œè€Œä¸æ˜¯çˆ¶ç±»åŸå‹å¯¹è±¡ã€‚</p>
</li>
<li>
<p>æ™®é€šæ–¹æ³•å†…ï¼Œé€šè¿‡ <code>super.xxx()</code> è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œç›¸å½“äº <code>Person.prototype.xxx.call(this)</code>ã€‚</p>
</li>
<li>
<p>åœ¨é™æ€æ–¹æ³•å†…ï¼Œ<code>super</code> æŒ‡å‘çˆ¶ç±»ï¼Œå› æ­¤ <code>super.xxx()</code> ç›¸å½“äº <code>Person.classMethodParent()</code>ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä»¥ä¸Šæåˆ°çš„æ™®é€šæ–¹æ³•ï¼Œæ˜¯æŒ‡éé™æ€æ–¹æ³•ã€‚</p>
</blockquote>
<h5>3. æ³¨æ„äº‹é¡¹</h5>
<p>æ— è®º super æ˜¯ä½œä¸ºå‡½æ•°ï¼Œè¿˜æ˜¯å¯¹è±¡ä½¿ç”¨ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">class Person {}

class Student extends Person {
  constructor() {
    super()
    console.log(super) // SyntaxError: 'super' keyword unexpected here
  }
}
</code></pre>
<h5>4. å…³äº super æ€»ç»“</h5>
<ul>
<li>
<p>ä½œä¸ºå‡½æ•°æ—¶ï¼Œä»…å¯åœ¨<strong>å­ç±»</strong>çš„ <code>constructor()</code> å†…ä½¿ç”¨ã€‚è‹¥ <code>constructor()</code> å†…åŒ…æ‹¬ <code>this</code> çš„ä½¿ç”¨ï¼Œåˆ™ <code>super()</code> å¿…é¡»åœ¨ <code>this</code> ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚</p>
</li>
<li>
<p>ä½œä¸ºå¯¹è±¡æ—¶ï¼Œè‹¥åœ¨<strong>éé™æ€æ–¹æ³•</strong>å†…ä½¿ç”¨ï¼Œ<code>super.xxx</code>ï¼ˆ<code>super.xxx()</code>ï¼‰ç›¸å½“äº <code>Parent.prototype.xxx</code>ï¼ˆ<code>Parent.prototype.xxx.call(this)</code>ï¼‰ã€‚</p>
</li>
<li>
<p>ä½œä¸ºå¯¹è±¡æ—¶ï¼Œè‹¥åœ¨<strong>é™æ€æ–¹æ³•</strong>å†…ä½¿ç”¨ï¼Œ<code>super.xxx</code>ï¼ˆ<code>super.xxx()</code>ï¼‰ç›¸å½“äº <code>Parent.xxx</code>ï¼ˆ<code>Parent.xxx()</code>ï¼‰ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ JavaScript è®¿é—®å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼ˆæˆ–æ–¹æ³•ï¼‰ï¼Œå…ˆä»å¯¹è±¡æœ¬èº«å»æŸ¥æ‰¾æ˜¯å¦æœ‰æ­¤å±æ€§ï¼Œå†ä»åŸå‹ä¸Šä¸€å±‚ä¸€å±‚çš„æŸ¥æ‰¾ï¼Œè‹¥æœ€ç»ˆæŸ¥æ‰¾ä¸åˆ°ä¼šè¿”å› <code>undefined</code>ï¼ˆæˆ–æŠ›å‡º TypeError é”™è¯¯ï¼‰ã€‚</p>
<p>åŒæ ·åœ°ï¼Œåœ¨ Class ç»§æ‰¿ä¸­ï¼Œè‹¥å­ç±»ã€çˆ¶ç±»å­˜åœ¨åŒåæ–¹æ³•ï¼Œä½¿ç”¨å®ä¾‹å¯¹è±¡è¿›è¡Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè‹¥å­ç±»æŸ¥æ‰¾åˆ°äº†ï¼Œè‡ªç„¶ä¸ä¼šå†å»çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚ä½†æˆ‘ä»¬åœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œå¯èƒ½ä»éœ€è¦æ‰§è¡Œçˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œé‚£ä¹ˆæ€ä¹ˆè°ƒç”¨å‘¢ï¼Ÿ</p>
<p>æ˜¾ç„¶é€šè¿‡ <code>çˆ¶ç±»å.æ–¹æ³•å()</code> çš„æ–¹å¼è°ƒç”¨æ˜¯ä¸åˆç†ã€ä¸çµæ´»çš„ï¼Œé“ç†å°±è·Ÿ JavaScript è¦è®¾è®¡ <code>this</code> å…³é”®å­—ä¸€æ ·ã€‚äºæ˜¯ <code>super</code> å°±è¯ç”Ÿäº†ï¼ˆæœ€åè¿™å¥æ˜¯æˆ‘çŒœçš„ï¼Œå“ˆå“ˆï¼‰ã€‚</p>
</li>
</ul>
<h3>å››ã€ç±»çš„ prototype å±æ€§å’Œ __proto__ å±æ€§</h3>
<p>åœ¨ ES5 ä¹‹ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼Œå®ƒæŒ‡å‘å¯¹è±¡çš„æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§ã€‚</p>
<p>å…³äºå¯¹è±¡å¯åˆ†ä¸ºï¼šæ™®é€šå¯¹è±¡å’Œå‡½æ•°å¯¹è±¡ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡ç±»å‹</th>
<th>prototypeï¼ˆåŸå‹å¯¹è±¡ï¼‰</th>
<th>__proto__ï¼ˆåŸå‹ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šå¯¹è±¡</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>å‡½æ•°å¯¹è±¡</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼Œè€Œåªæœ‰å‡½æ•°å¯¹è±¡æ‰å…·æœ‰ <code>prototype</code> å±æ€§ã€‚å…¶ä¸­æ„é€ å‡½æ•°å±äºå‡½æ•°å¯¹è±¡ï¼Œè€Œå®ä¾‹å¯¹è±¡åˆ™å±äºæ™®é€šå¯¹è±¡ï¼Œå› æ­¤å®ä¾‹å¯¹è±¡æ˜¯æ²¡æœ‰ <code>prototype</code> å±æ€§çš„ã€‚</p>
</blockquote>
<p>è€Œ ES6 çš„ <code>class</code> ä½œä¸ºæ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶æœ‰ <code>prototype</code> å±æ€§å’Œ <code>__proto__</code>ï¼Œå› æ­¤åŒæ—¶å­˜åœ¨ä¸¤æ¡ç»§æ‰¿é“¾ã€‚</p>
<ul>
<li>å­ç±»çš„ <code>__proto__</code> å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ã€‚</li>
<li>å­ç±»çš„ <code>prototype</code> å±æ€§çš„ <code>__proto__</code> å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»çš„ <code>prototype</code> å±æ€§ã€‚</li>
</ul>
<pre><code class="language-js">class Person { }

class Student extends Person { }

Student.__proto__ === Person // true
Student.prototype.__proto__ === Student.prototype // true
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå­ç±» <code>Student</code> çš„ <code>__proto__</code> æŒ‡å‘çˆ¶ç±» <code>Person</code>ï¼Œå­ç±»çš„ <code>Student</code> çš„ <code>prototype</code> å±æ€§çš„ <code>__proto__</code> å±æ€§æŒ‡å‘çˆ¶ç±» <code>Person</code> çš„ <code>prototype</code> å±æ€§ã€‚</p>
<p>å› ä¸ºç±»çš„ç»§æ‰¿ï¼Œæ˜¯æŒ‰ç…§ä»¥ä¸‹æ¨¡å¼å®ç°çš„ï¼š</p>
<pre><code class="language-js">class Person { }
class Student extends Person { }

// ç›¸å½“äº
class Person { }
class Student { }
Object.setPrototypeOf(Student, Person)
Object.setPrototypeOf(Student.prototype, Person.prototype)

// -------------------------------------------------------
// å…³äº Object.setPrototypeOf() å†…éƒ¨æ˜¯è¿™æ ·å®ç°çš„ï¼š
// Object.setPrototypeOf = functon(obj, proto) {
//   obj.__proto__ = proto
//   return obj
// }
//
// å› æ­¤ï¼Œç›¸å½“äºï¼š
// Student.__proto__ = Person
// Student.prototype.__proto__ = Person.prototype
// -------------------------------------------------------
</code></pre>
<p>è¿™æ ·å»ç†è§£ï¼š</p>
<ul>
<li>ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå­ç±» <code>Student</code> çš„åŸå‹ï¼ˆ<code>__proto__</code>ï¼‰æ˜¯çˆ¶ç±» <code>Person</code>ï¼›</li>
<li>ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå­ç±» <code>Student</code> çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code>ï¼‰æ˜¯çˆ¶ç±» <code>Person</code> çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code>ï¼‰çš„å®ä¾‹ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œç†è®ºä¸Š <code>extends</code> å…³é”®å­—åé¢çš„ï¼ˆå‡½æ•°ï¼‰å¯¹è±¡ï¼Œåªè¦å«æœ‰ <code>prototype</code> å±æ€§å°±å¯ä»¥äº†ï¼Œä½† <code>Function.prototype</code> é™¤å¤–ã€‚ä½†åœ¨åšé¡¹ç›®çš„æ—¶å€™åº”è¯¥ä»å®é™…åº”ç”¨åœºæ™¯è€ƒè™‘ï¼Œè¿™æ ·å»åšæ˜¯å¦æœ‰æ„ä¹‰ã€‚</p>
<!--
```js
// ï¼ˆå…¨å±€å¯¹è±¡ï¼‰Object æ˜¯ ï¼ˆæ„é€ å™¨ï¼‰Function çš„å®ä¾‹
// ï¼ˆå…¨å±€å¯¹è±¡ï¼‰Function ä¹Ÿæ˜¯ ï¼ˆæ„é€ å™¨ï¼‰Function çš„å®ä¾‹
Object.__proto__ === Function.prototype // true
Function.__proto__ === Function.prototype // true

// ï¼ˆæ„é€ å™¨ï¼‰Function ä¹Ÿæ˜¯ï¼ˆæ„é€ å™¨ï¼‰Object çš„å®ä¾‹
Function.prototype.__proto__ === Object.prototype // true

// ç«™åœ¨åŸå‹é“¾é¡¶ç«¯çš„ç”·äººï¼Œæ˜¯å®ƒ
Object.prototype.__proto__ // null
```
-->
<pre><code class="language-js">// 1. Student ç±»ç»§æ‰¿ Object ç±»
class Student extends Object { }
Student.__proto__ === Object // true
Student.prototype.__proto__ === Object.prototype // true

// 2. Student ä¸ç»§æ‰¿
class Student { }
Student.__proto__ === Function.prototype
Student.prototype.__proto__ === Object.prototype
// å› æ­¤ï¼Œç›¸å½“äºï¼š
// Object.setPrototypeOf(Student, Function.prototype)
// Object.setPrototypeOf(Student.prototype, Object.prototype)
</code></pre>
<!--
### äº”ã€åŸç”Ÿæ„é€ å‡½æ•°çš„ç»§æ‰¿

åŸç”Ÿæ„é€ å‡½æ•°ï¼Œæ˜¯æŒ‡ JavaScript å†…ç½®çš„æ„é€ å‡½æ•°ï¼Œé€šå¸¸ç”¨æ¥ç”Ÿæˆæ•°æ®ç»“æ„ã€‚å¤§è‡´æœ‰ä»¥ä¸‹è¿™äº›ï¼š

* `Boolean()`
* `Number()`
* `String()`
* `Array()`
* `Date()`
* `Function()`
* `RegExp()`
* `Error()`
* `Object()`

ä½†å®ƒä»¬æ˜¯æ— æ³•ç»§æ‰¿çš„ï¼Œå› ä¸ºåŸç”Ÿæ„é€ å‡½æ•°çš„ this æ— æ³•ç»‘å®šï¼Œå¯¼è‡´å–ä¸åˆ°å†…éƒ¨å±æ€§ã€‚
-->
<h3>äº”ã€Mixin æ¨¡å¼çš„å®ç°</h3>
<p>Mixin æŒ‡çš„æ˜¯å¤šä¸ªå¯¹è±¡åˆæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ–°å¯¹è±¡å…·å¤‡å„ä¸ªç»„æˆæˆå‘˜çš„æ¥å£ã€‚å®ƒçš„æœ€ç®€å•å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const a = { a: 1 }
const b = { b: 2 }
const c = { ...a, ...b }
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ï¼Œå¯¹è±¡ <code>c</code> æ˜¯å¯¹è±¡ <code>a</code> å’Œå¯¹è±¡ <code>b</code> çš„åˆæˆï¼Œå…·å¤‡ä¸¤è€…çš„æ¥å£ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´å®Œå¤‡çš„å®ç°ï¼Œå°†å¤šä¸ªç±»çš„æ¥å£â€œæ··å…¥â€å¦ä¸€ä¸ªç±»ã€‚</p>
<pre><code class="language-js">function mix(...mixins) {
  class Mix {
    constructor() {
      for (let mixin of mixins) {
        copyProperties(this, new mixin()) // æ‹·è´å®ä¾‹å±æ€§
      }
    }
  }

  for (let mixin of mixins) {
    copyProperties(Mix, mixin) // æ‹·è´é™æ€å±æ€§
    copyProperties(Mix.prototype, mixin.prototype) // æ‹·è´åŸå‹å±æ€§
  }

  return Mix
}

function copyProperties(target, source) {
  for (let key of Reflect.ownKeys(source)) {
    if (
      key !== 'constructor'
      &amp;&amp; key !== 'prototype'
      &amp;&amp; key !== 'name'
    ) {
      let desc = Object.getOwnPropertyDescriptor(source, key)
      Object.defineProperty(target, key, desc)
    }
  }
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„çš„ <code>mix</code> å‡½æ•°ï¼Œå¯ä»¥å°†å¤šä¸ªå¯¹è±¡åˆæˆä¸ºä¸€ä¸ªç±»ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œåªè¦ç»§æ‰¿è¿™ä¸ªç±»å³å¯ã€‚</p>
<pre><code class="language-js">class DistributedEdit extends mix(Loggable, Serializable) {
  // ...
}
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | Class ä¸Šç¯‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/251</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/251</guid>
            <pubDate>Sun, 26 Feb 2023 11:41:50 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bfe2652d59b37149.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bfe2652d59b37149.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ¥æŒç»­å­¦ä¹ å§ï¼</p>
<p>æ­¤å‰å†™äº†ä¸¤ç¯‡å…³äº JavaScript åŸå‹ä»¥åŠç»§æ‰¿çš„æ–‡ç« ï¼ˆæºè‡ª <a href="https://juejin.cn/user/1609340751972941/posts">ULIVZ</a>ï¼‰ã€‚</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/212">JavaScript åŸå‹è¯¦è§£</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/213">æ·±å…¥ JavaScript ç»§æ‰¿åŸç†</a></li>
</ul>
<p>ç„¶åï¼Œä»Šå¤©ä»”ç»†çœ‹ä¸‹ ES6 ä¸­çš„ Class è¯­æ³•ã€‚</p>
<h3>ä¸€ã€ç®€ä»‹</h3>
<h5>1. ç±»çš„ç”±æ¥</h5>
<p>åœ¨ JavaScript ä¸­ï¼Œç”Ÿæˆå®ä¾‹å¯¹è±¡çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯é€šè¿‡æ„é€ å‡½æ•°ã€‚</p>
<pre><code class="language-js">function Point(x, y) {
  this.x = x
  this.y = y
}

Point.prototype.toString = function() {
  return '(' + this.x + ', ' + this.y + ')'
}

var p = new Point(1, 2)
</code></pre>
<p>ä¸Šé¢è¿™ç§å†™æ³•ï¼Œè·Ÿä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆæ¯”å¦‚ C++ã€Javaï¼‰å·®å¼‚å¾ˆå¤§ï¼Œå¾ˆå®¹æ˜“è®©æ–°å­¦ä¹ è¿™é—¨è¯­è¨€çš„ç¨‹åºå‘˜æ„Ÿåˆ°å›°æƒ‘ã€‚</p>
<p>åœ¨ ES6 æä¾›äº†æ›´æ¥è¿‘ä¼ ç»Ÿè¯­è¨€çš„å†™æ³•ï¼Œå¼•å…¥äº† <strong>Class</strong>ï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œä½œä¸ºå¯¹è±¡çš„æ¨¡æ¿ã€‚é€šè¿‡ <code>class</code> å…³é”®å­—ï¼Œå¯ä»¥å®šä¹‰ç±»ã€‚</p>
<p><strong>åŸºæœ¬ä¸Šï¼ŒES6 çš„ <code>class</code> å¯ä»¥çœ‹ä½œåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒES5 éƒ½å¯ä»¥åšåˆ°ï¼Œå…¨æ–°çš„ <code>class</code> å†™æ³•åªæ˜¯è®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•è€Œå·²ã€‚</strong></p>
<p>ä¸Šé¢ç¤ºä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ ES6 çš„ <code>class</code> æ”¹å†™ä¸ºï¼š</p>
<pre><code class="language-js">class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
  }

  toString() {
    return '(' + this.x + ', ' + this.y + ')'
  }
}
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªâ€œç±»â€ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ª <code>constructor()</code> æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ„é€ æ–¹æ³•ï¼Œè€Œ <code>this</code> å…³é”®å­—åˆ™ä»£è¡¨å®ä¾‹å¯¹è±¡ã€‚è¿™ç§å…¨æ–°çš„ Class å†™æ³•ï¼Œæœ¬è´¨ä¸Šä¸å¼€å¤´çš„ ES5 çš„æ„é€ å‡½æ•° <code>Point</code> æ˜¯ä¸€è‡´çš„ã€‚</p>
<p><code>Point</code> ç±»é™¤äº†æ„é€ æ–¹æ³•ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ª <code>toString()</code> æ–¹æ³•ã€‚æ³¨æ„ï¼Œå®šä¹‰äº† <code>toString()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œå‰é¢ä¸éœ€è¦åŠ ä¸Š <code>function</code> è¿™ä¸ªå…³é”®å­—ï¼Œç›´æ¥æŠŠå‡½æ•°å®šä¹‰æ”¾è¿›å»å°±å¯ä»¥äº†ã€‚å¦å¤–ï¼Œæ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´ä¸éœ€è¦é€—å· <code>,</code> åˆ†éš”ï¼ŒåŠ äº†ä¼šæŠ¥é”™ã€‚</p>
<p>ES6 çš„ç±»ï¼Œå®Œå…¨å¯ä»¥çœ‹ä½œæ„é€ å‡½æ•°çš„å¦ä¸€ç§å†™æ³•ã€‚</p>
<pre><code class="language-js">class Point {
  // ...
}

console.log(typeof Point) // &quot;function&quot;
Point.prototype.constructor === Point // true
// ä¸Šé¢ä»£ç è¡¨æ˜ï¼Œç±»çš„æ•°æ®ç±»å‹å°±æ˜¯å‡½æ•°ï¼Œç±»æœ¬èº«å°±æŒ‡å‘æ„é€ å‡½æ•°ã€‚
</code></pre>
<p>ä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ç›´æ¥å¯¹ç±»ä½¿ç”¨ <code>new</code> å…³é”®å­—ï¼Œè·Ÿæ„é€ å‡½æ•°çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ã€‚è¿˜æœ‰ï¼Œå½“å®ä¾‹åŒ–ä¸æŒ‡å®šå‚æ•°åˆ—è¡¨æ—¶ï¼Œ<code>new Point()</code> ç­‰åŒäº <code>new Point</code>ã€‚</p>
<blockquote>
<p>ä¸ ES5 æœ‰ä¸€ç‚¹åŒºåˆ«çš„æ˜¯ï¼Œç±»ä¸èƒ½ç›´æ¥å½“ä½œå‡½æ•°ä¸€æ ·è°ƒç”¨ï¼Œå³ <code>Point()</code> æ˜¯ä¼šæŠ›å‡ºé”™è¯¯çš„ï¼š<code>TypeError: Class constructor Point cannot be invoked without 'new'</code>ã€‚è€Œ ES5 ä¸­ï¼Œè‹¥æ„é€ å‡½æ•°ä¸ä½¿ç”¨ <code>new</code> å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ–ï¼Œè€Œæ˜¯ç›´æ¥å½“ä½œå‡½æ•°è°ƒç”¨æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
</blockquote>
<pre><code class="language-js">class Bar {
  doStuff() {
    console.log('stuff')
  }
}

const b = new Bar()
b.doStuff() // &quot;stuff&quot;
</code></pre>
<p>æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§ï¼Œåœ¨ ES6 çš„â€œç±»â€ä¸Šä¾ç„¶å­˜åœ¨ã€‚äº‹å®ä¸Šï¼Œç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½å®šä¹‰åœ¨ç±»çš„ <code>prototype</code> å±æ€§ä¸Šé¢ã€‚æˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸‹ <code>point</code> å®ä¾‹å¯¹è±¡ï¼š</p>
<pre><code class="language-js">class Point {
  constructor() {}

  toString() {}

  toValue() {}
}

const point = new Point()
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>constructor()</code>ã€<code>toString()</code>ã€<code>toValue()</code> è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶å®éƒ½æ˜¯å®šä¹‰åœ¨ <code>Point.prototype</code> ä¸Šé¢ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b631078d2be9ca04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-js">point.constructor === Point.prototype.constructor // true
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>point</code> æ˜¯ <code>Point</code> ç±»çš„å®ä¾‹ï¼Œå®ƒçš„ <code>constructor()</code> æ–¹æ³•å°±æ˜¯ <code>Point</code> ç±»åŸå‹çš„ <code>constructor()</code> æ–¹æ³•ã€‚</p>
<p><strong>å°ç»“ï¼š</strong></p>
<blockquote>
<ul>
<li>åœ¨ Class å†…éƒ¨å®šä¹‰çš„<strong>æ–¹æ³•</strong>ï¼Œå°½ç®¡ä¸ ES5 ä¸€æ ·æœ€ç»ˆéƒ½æ˜¯æŒ‚è½½åœ¨ <code>prototype</code> ä¸Šçš„ï¼Œä½†è¿™äº›æ–¹æ³•æ˜¯ä¸å¯æšä¸¾çš„ã€‚è¿™ä¸€ç‚¹ä¸ ES5 çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚</li>
<li>åœ¨ Class å†…éƒ¨å®šä¹‰çš„<strong>å±æ€§</strong>ï¼Œåˆ™æ˜¯æŒ‚è½½åœ¨å®ä¾‹å¯¹è±¡ä¸Šçš„ã€‚</li>
</ul>
</blockquote>
<h3>äºŒã€constructor</h3>
<p><code>constructor()</code> æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•ï¼Œé€šè¿‡ <code>new</code> å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡æ˜¯ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä¸€ä¸ªç±»å¿…é¡»æœ‰ <code>constructor()</code> æ–¹æ³•ã€‚å½“ä½ å®šä¹‰ä¸€ä¸ªç±»æ—¶ï¼Œè‹¥æ— æ˜¾å¼å®šä¹‰ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç©ºçš„é»˜è®¤ <code>constructor()</code> æ–¹æ³•ï¼ˆç”± JS å¼•æ“è‡ªåŠ¨æ·»åŠ ï¼‰ï¼Œå³ï¼š</p>
<pre><code class="language-js">class Point {}

// ç›¸å½“äº
class Point {
  constructor() {}
}
</code></pre>
<p><code>constructor()</code> æ–¹æ³•é»˜è®¤è¿”å›å®ä¾‹å¯¹è±¡ï¼ˆå³ <code>this</code>ï¼‰ï¼Œäº¦å¯è¿”å›ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼ˆå¼•ç”¨ç±»å‹çš„å€¼ï¼‰ã€‚</p>
<pre><code class="language-js">class Point() {
  constructor() {
    return Object.create(null)
    // 1. è‹¥ä¸æ˜¾å¼ return çš„è¯ï¼Œé»˜è®¤è¿”å› this
    // 2. æ˜¾å¼è¿”å›åªèƒ½æ˜¯å¼•ç”¨å€¼ï¼ˆå³å¯¹è±¡ï¼‰ï¼Œè‹¥æ˜¯åŸå§‹å€¼æ˜¯æ— æ•ˆçš„ï¼Œæ­¤æ—¶ä»ç„¶æ˜¯è¿”å› thisã€‚
    // 3. ä»¥ä¸Šä¸¤ç‚¹ï¼Œè·Ÿ ES5 å®ç°æ„é€ æ–¹æ³•è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚
    // 4. ä¸€èˆ¬æƒ…å†µï¼Œæ— éœ€å®šä¹‰æ˜¾å¼ returnã€‚
  }
}

const point = new Point()
console.log(point instanceof Point) // false
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>constructor()</code> è¿”å›äº†ä¸€ä¸ªå…¨æ–°å¯¹è±¡ï¼Œå¯¼è‡´äº† <code>point</code> å¯¹è±¡å¹¶ä¸æ˜¯ <code>Point</code> çš„å®ä¾‹å¯¹è±¡ã€‚</p>
<h3>ä¸‰ã€ç±»çš„å®ä¾‹</h3>
<p>ä¸Šé¢æåˆ°ï¼ŒClass ä¸èƒ½å½“åšå‡½æ•°ç›´æ¥è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯çš„ã€‚æ­£ç¡®åœ°ï¼Œåº”ä½¿ç”¨ <code>new</code> å…³é”®å­—è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<pre><code class="language-js">class Point {}

// æ­£ç¡®
const p1 = new Point()
// é”™è¯¯
const p2 = Point() // Uncaught TypeError: Class constructor Point cannot be invoked without 'new'
</code></pre>
<p><strong>åœ¨ Class ä¸­ï¼Œå¦‚ä½•å®šä¹‰å±æ€§å’Œæ–¹æ³•ï¼Ÿé‚£å®ƒä»¬æ˜¯æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ï¼Œè¿˜æ˜¯ç±»çš„åŸå‹ä¸Šï¼Ÿ</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å§ï¼š</p>
<pre><code class="language-js">class Point {
  // è¿™æ ·å®šä¹‰å±æ€§ï¼Œä¹Ÿæ˜¯æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡çš„ï¼Œå¹¶éæŒ‚è½½åˆ° Point.prototype ä¸Šçš„å“¦
  z = 0

  constructor(x, y) {
    // é€šè¿‡å¦‚ä¸‹ this.xxx çš„å½¢å¼ï¼Œå¯ä»¥æ˜¾å¼åœ°ä¸ºå®ä¾‹å¯¹è±¡å¢åˆ å±æ€§å’Œæ–¹æ³•
    this.x = x // 
    this.y = y
    this.show = () =&gt; {
      return `The point is (${this.x}, ${this.y}).`
    }
    this.tmp = &quot;It's temporary property.&quot;
    delete this.tmp
  }

  // ç±»ä¼¼å¦‚ä¸‹ setXã€setYã€setZ ç­‰å®šä¹‰ç±»çš„æ–¹æ³•ï¼Œå®ƒä»¬æœ€ç»ˆæ˜¯æŒ‚è½½åˆ° Point.prototypeï¼Œå¹¶éå®ä¾‹å¯¹è±¡
  setX(x) {
    this.x = x
  }

  setY(y) {
    this.y = y
  }

  setZ(z) {
    this.z = z
  }
}

// æ—¢ç„¶ä¸Šé¢çš„æ–¹å¼å®šä¹‰å±æ€§ï¼Œéƒ½æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Šï¼Œ
// é‚£æ€æ ·ç»™ Point.prototype æ·»åŠ â€œå±æ€§â€å‘¢ï¼Ÿ
// åªèƒ½åˆ©ç”¨ Point.prototype.xxx äº†ï¼Œåƒè¿™æ ·ï¼š
Object.assign(Point.prototype, {
  prop: 'haha',
  method: function () {}
})

const point = new Point(1, 10)
</code></pre>
<p>æˆ‘ä»¬æ¥æ‰“å°ä¸€ä¸‹ <code>point</code> å®ä¾‹å¯¹è±¡ï¼Œä¸€ç›®äº†ç„¶ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0aab10952b84a4b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸ ES5 ä¸€æ ·ï¼Œç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å¯¹è±¡ã€‚</p>
<pre><code class="language-js">const p1 = new Point(1, 1)
const p2 = new Point(2, 2)

Object.getPrototypeOf(p1) === Object.getPrototypeOf(p2) // true
</code></pre>
<p>å› æ­¤ï¼Œä¸å»ºè®®åœ¨å®ä¾‹ä¸­ï¼Œåˆ©ç”¨ <code>__proto__</code> å»æ”¹å†™åŸå‹ï¼Œå®ƒä¼šæ”¹å˜ç±»çš„å®šä¹‰ï¼Œè¿›è€Œå½±å“åˆ°è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹ã€‚</p>
<pre><code class="language-js">// âŒ ä»¥ä¸‹åšæ³•ä¸è¢«æ¨è
const p1 = new Point(1, 1)
const p2 = new Point(2, 2)

p1.__proto__.print = function () {
 console.log('Oops')
}

p2.print() // &quot;Oops&quot;
</code></pre>
<p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹è¿™ç§å†™æ³•åŠå…¶ç»“æœã€‚</p>
<pre><code class="language-js">class Point {
  fn() {
    console.log(1)
  }
}

// åœ¨æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ class å†…éƒ¨çš„ fn å·²ç»å®ŒæˆæŒ‚è½½åˆ° Point.prototype ä¸Šï¼Œ
// å› æ­¤ä¸‹é¢ä¼šæŠŠåŸå…ˆåŸå‹ä¸Šçš„ fn æ–¹æ³•è¦†ç›–
Point.prototype.fn = function() {
  console.log(2)
}

const p = new Point()
p.fn() // 2
</code></pre>
<h3>å››ã€setterã€getter</h3>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <code>setter</code> å’Œ <code>getter</code> è¯­æ³•ï¼Œä»¥å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚ä½¿ç”¨ <code>getter</code> å¯ä»¥è®¿é—®å±æ€§å€¼ï¼Œè€Œ <code>setter</code> å¯ä»¥ä¿®æ”¹å±æ€§å€¼ã€‚</p>
<pre><code class="language-js">// æœ¬ä¾‹çš„ setterã€getter è®¾è®¡åœ¨å®é™…ä¸­å¹¶æ— æ„ä¹‰ï¼Œ
// è¿™é‡Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œä¸¾ä¾‹ç½¢äº†ã€‚
class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
  }

  set prop(x) {
    console.log('setter:', x)
    this.x = x
  }

  get prop() {
    console.log('getter:', this.x)
    return this.x
  }
}

const point = new Point(1, 10)
point.prop = 100 // setter: 100
point.prop // gettter: 100
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>prop</code> å±æ€§æœ‰å¯¹åº”çš„å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°ï¼Œå› æ­¤å­˜å–è¡Œä¸ºéƒ½è¢«è‡ªå®šä¹‰äº†ã€‚è¿˜æœ‰ <code>getter</code>ã€<code>setter</code> æ–¹æ³•æ˜¯è®¾ç½®åœ¨å±æ€§çš„ Descripter å¯¹è±¡ä¸Šçš„ã€‚</p>
<h3>äº”ã€å±æ€§è¡¨è¾¾å¼</h3>
<p>ç±»çš„å±æ€§åï¼Œå¯ä»¥é‡‡ç”¨è¡¨è¾¾å¼ï¼Œå³è®¡ç®—å±æ€§åã€‚</p>
<pre><code class="language-js">let methodName = 'getX'

class Point {
  [methodName]() {
    // ...
  }
}

// è®¿é—®
const point = new Point()
point[methodName] // or point.getX
</code></pre>
<h3>å…­ã€ç±»çš„è¡¨è¾¾æ–¹å¼</h3>
<blockquote>
<p>ç±»å†…éƒ¨æ˜¯åœ¨<a href="https://www.jianshu.com/p/55e369a811b7">ä¸¥æ ¼æ¨¡å¼</a>ä¸‹è¿è¡Œçš„ã€‚</p>
</blockquote>
<p>ç±»å¯ä»¥è¿™æ ·å®šä¹‰ï¼š</p>
<pre><code class="language-js">// 1ï¸âƒ£ ç±»å£°æ˜
class Foo {
  constructor() {}
}


// 2ï¸âƒ£ åŒ¿åç±»è¡¨è¾¾å¼ï¼ˆåŒ¿åç±»ï¼Œå°±åƒåŒ¿åå‡½æ•°è¡¨è¾¾å¼ä¸€æ ·ï¼‰
const Foo = class {
  constructor() {}
}


// 3ï¸âƒ£ å…·åç±»è¡¨è¾¾å¼
const Foo = class NamedFoo {
  constructor() {
    // åœ¨å†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ NamedFoo æˆ– Foo è®¿é—®ç±»çš„å±æ€§æˆ–ï¼ˆé™æ€ï¼‰æ–¹æ³•ã€‚
    // ä½†æ˜¯ï¼Œåœ¨ç±»çš„å¤–éƒ¨åªèƒ½ä½¿ç”¨ Fooï¼Œä¸èƒ½ä½¿ç”¨ NamedFooã€‚
    // è‹¥å†…éƒ¨æ— éœ€ä½¿ç”¨åˆ° NamedFooï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŒ¿åçš„æ–¹å¼ã€‚
    console.log(NamedFoo.name) // &quot;NamedFoo&quot;
    console.log(Foo.name) // &quot;NamedFoo&quot;
  }
}

Foo.name // &quot;NamedFoo&quot;
NamedFoo.name // ReferenceError: NamedFoo is not defined
</code></pre>
<p>ä»¥ä¸Šä¸‰ç§ç±»çš„è¡¨è¾¾æ–¹å¼ï¼Œå¯ä»¥å¯¹åº”ä¸Šï¼šå‡½æ•°å£°æ˜ã€åŒ¿åå‡½æ•°è¡¨è¾¾å¼ã€ï¼ˆå…·åï¼‰å‡½æ•°è¡¨è¾¾å¼ï¼Œè¿™ç‚¹æ˜¯ç›¸åŒçš„ã€‚</p>
<p>è¿˜æœ‰ï¼Œåˆ©ç”¨â€œç±»è¡¨è¾¾å¼â€çš„å½¢å¼ï¼Œå¯ä»¥å†™å‡ºç«‹å³æ‰§è¡Œçš„ Classï¼Œè¿™ç‚¹ä¸å‡½æ•°è¡¨è¾¾å¼æ˜¯ç›¸åŒçš„ã€‚</p>
<pre><code class="language-js">// æ­¤æ—¶ foo å°±æ˜¯ç±»çš„å®ä¾‹å¯¹è±¡
const foo = new class {
  constructor(name) {
    this.name = name
  }
}('Frankie')

foo.name // &quot;Frankie&quot;
</code></pre>
<p>ä»¥ä¸Šä¸‰ç§æ–¹å¼éƒ½å¯ä»¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<pre><code class="language-js">// 1. é‡å¤å£°æ˜ä¸€ä¸ªç±»ä¼šæŠ›å‡ºç±»å‹é”™è¯¯ã€‚
// åœ¨è¿™ç‚¹ä¸Šï¼Œclass ä¸ letã€const è¡¨ç°æ˜¯ä¸€è‡´çš„ï¼Œå‡ä¸å¯é‡å¤å£°æ˜ã€‚
class Foo {}
class Foo {} // Uncaught TypeError: Identifier 'Foo' has already been declared

// 2. class åŒæ ·ä¸ä¼šâ€œæå‡â€ï¼ˆHoistingï¼‰ï¼Œ
// å› æ­¤å®ä¾‹åŒ–ä¹‹å‰ï¼Œä¸€å®šè¦å…ˆå£°æ˜ç±»ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼•ç”¨é”™è¯¯ã€‚
const foo = new Foo() // ReferenceError: Cannot access 'Foo' before initialization
class Foo {}
</code></pre>
<h3>ä¸ƒã€æ³¨æ„ç‚¹</h3>
<ol>
<li>
<p>ä¸¥æ ¼æ¨¡å¼
åœ¨ç±»å’Œæ¨¡å—çš„å†…éƒ¨ï¼Œé»˜è®¤å°±æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæ— éœ€é€šè¿‡ <code>use strict</code> æ¥æŒ‡å®šï¼Œä¹Ÿä»…æœ‰ä¸¥æ ¼æ¨¡å¼å¯ç”¨ã€‚</p>
</li>
<li>
<p>æå‡é—®é¢˜
åˆšæ‰æåˆ°ä½¿ç”¨ <code>class</code> å…³é”®å­—å£°æ˜çš„ç±»ï¼Œä¸å­˜åœ¨â€œæå‡â€ ï¼ˆHoistingï¼‰é—®é¢˜ã€‚è¿™ç§è§„å®šçš„åŸå› ä¸ç±»çš„ç»§æ‰¿æœ‰å…³ï¼Œå¿…é¡»ä¿è¯å­ç±»åœ¨çˆ¶ç±»ä¹‹åå®šä¹‰ã€‚</p>
</li>
<li>
<p>name å±æ€§
æœ¬è´¨ä¸Šï¼ŒES6 çš„ç±»åªæ˜¯ ES5 çš„æ„é€ å‡½æ•°çš„ä¸€å±‚åŒ…è£…ï¼Œæ‰€ä»¥å‡½æ•°çš„è®¸å¤šç‰¹æ€§éƒ½è¢« <code>class</code> ç»§æ‰¿ï¼ŒåŒ…æ‹¬ <code>name</code> å±æ€§ã€‚å®ƒæ€»æ˜¯è¿”å› <code>class</code> å…³é”®å­—åé¢çš„ç±»åï¼Œè‹¥æ˜¯åŒ¿åç±»è¡¨è¾¾å¼å£°æ˜ï¼Œåˆ™è¿”å›å˜é‡åã€‚</p>
</li>
</ol>
<pre><code class="language-js">class Foo {}
const Bar = class {}
const B = class Baz {}

console.log(Foo.name) // &quot;Foo&quot;
console.log(Bar.name) // &quot;Bar&quot;
console.log(B.name) // &quot;Baz&quot;
</code></pre>
<ol start="4">
<li>
<p>Generator æ–¹æ³•
å¦‚æœåœ¨æŸä¸ªæ–¹æ³•ä¹‹å‰åŠ ä¸Šæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ï¼Œåˆ™è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ª Generator å‡½æ•°ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ<code>Foo</code> ç±»çš„ <code>Symbol.iterator</code> æ–¹æ³•å°±æ˜¯ä¸€ä¸ª Generator å‡½æ•°ã€‚<code>Symbol.iterator</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>Foo</code> ç±»çš„é»˜è®¤éå†å™¨ï¼Œ<code>for...of </code>å¾ªç¯ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªéå†å™¨ã€‚</p>
</li>
</ol>
<pre><code class="language-js">class Foo {
  constructor(...args) {
    this.args = args
  }

  *[Symbol.iterator]() {
    for (let arg of this.args) {
      yield arg
    }
  }
}

const foo = new Foo('Hello', 'World')
for (let x of foo) {
  console.log(x)
}
// &quot;Hello&quot;
// &quot;World&quot;
</code></pre>
<ol start="5">
<li>this æŒ‡å‘
ç±»çš„æ–¹æ³•å†…éƒ¨å¦‚æœå«æœ‰ <code>this</code>ï¼Œå®ƒé»˜è®¤æŒ‡å‘ç±»çš„å®ä¾‹ã€‚ä½†æ˜¯ï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼Œä¸€æ—¦å•ç‹¬ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¾ˆå¯èƒ½ä¼šæŠ¥é”™ã€‚æ³¨æ„ï¼Œå¦‚æœæ˜¯é™æ€æ–¹æ³•å†…ï¼Œ<code>this</code> æŒ‡å‘ç±»æœ¬èº«ã€‚</li>
</ol>
<pre><code class="language-js">class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
  }

  // static classMethod() {
  //   return this // this æŒ‡å‘ Point æœ¬èº«
  // }

  getX() {
    return this.x
  }
}

const point = new Point(1, 10)
console.log(point.getX()) // 1

const { getX } = point
getX() // TypeError: Cannot read property 'x' of undefined
</code></pre>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>getX</code> æ–¹æ³•çš„ <code>this</code> é»˜è®¤æŒ‡å‘ <code>Point</code> å®ä¾‹å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†è¿™ä¸ªæ–¹æ³•æå–å‡ºæ¥å•ç‹¬ä½¿ç”¨ï¼Œ<code>this</code> ä¼šæŒ‡å‘è¯¥æ–¹æ³•è¿è¡Œæ—¶æ‰€åœ¨çš„ç¯å¢ƒï¼ˆç”±äº <code>class</code> å†…éƒ¨æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€ä»¥ <code>this</code> å®é™…æŒ‡å‘çš„æ˜¯ <code>undefined</code>ï¼‰ï¼Œå¯¼è‡´æ‰¾ä¸åˆ° <code>getX</code> æ–¹æ³•è€ŒæŠ¥é”™ã€‚</p>
<p>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// è§£å†³æ–¹æ³•ä¸€
class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
    this.getX = this.getX.bind(this) // æ„é€ å‡½æ•°ä¸­ç»‘å®šå®ä¾‹å¯¹è±¡
  }

  getX() {
    return this.x
  }
}

// è§£å†³æ–¹æ³•äºŒ
class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
  }

  // è¿™å†™æ³•ï¼Œç›¸å½“äºåœ¨ constructor ä¸­å®šä¹‰äº†ï¼š
  // this.getX = () =&gt; { /* ... */ }
  getX = () =&gt; {
    return this.x
  }
}

// æ³¨æ„ï¼Œä¸¤è€…è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š
// 1. ä¸¤ç§è§£å†³æ–¹æ³•ï¼Œéƒ½ä¼šåœ¨ Point çš„å®ä¾‹å¯¹è±¡ä¸Šï¼Œå®šä¹‰äº†ä¸€ä¸ª getX æ–¹æ³•ã€‚
// 2. è§£å†³æ–¹æ³•ä¸€ï¼Œé™¤äº†åœ¨å®ä¾‹å¯¹è±¡ä¸Šå«æœ‰ getX æ–¹æ³•ï¼Œåœ¨å…¶å®ä¾‹å¯¹è±¡çš„åŸå‹ä¸Šä¹Ÿæœ‰ä¸€ä¸ª getX æ–¹æ³•ã€‚
// 3. è€Œè§£å†³æ–¹æ¡ˆäºŒï¼Œå…¶å®åªä¼šå°† getX æŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Šï¼Œè€ŒåŸå‹ä¸Šæ˜¯æ²¡æœ‰çš„ã€‚
// 4. ä»¥ä¸Šçš„åŒºåˆ«ï¼Œå…¶å®ä¸Šé¢çš„å†…å®¹éƒ½æœ‰æåˆ°ï¼Œå¦‚è¿˜ä¸å¤ªæ¸…æ¥šï¼Œå»ºè®®å›å¤´å†çœ‹çœ‹ã€‚
</code></pre>
<h3>å…«ã€é™æ€æ–¹æ³•</h3>
<p>ç±»ç›¸å½“äºå®ä¾‹çš„åŸå‹ï¼Œæ‰€æœ‰åœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«å®ä¾‹ç»§æ‰¿ã€‚å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒåŠ ä¸Š <code>static</code> å…³é”®å­—ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™ä¸ªå°±è¢«ç§°ä¸º**â€œé™æ€æ–¹æ³•â€**ã€‚</p>
<pre><code class="language-js">class Foo {
  static classMethod() {
    console.log('Hello World!')
  }
}

// Correct
Foo.classMethod() // &quot;Hello World!&quot;

// Wrong
const foo = new Foo()
foo.classMethod() // TypeError: foo.classMethod is not a function
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>Foo</code> ç±»çš„ <code>classMethod</code> æ–¹æ³•å‰æœ‰ <code>static</code> å…³é”®å­—ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åœ¨ <code>Foo</code> ç±»ä¸Šè°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨ <code>Foo</code> ç±»çš„å®ä¾‹å¯¹è±¡ä¸Šè°ƒç”¨ã€‚è‹¥é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨é™æ€æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºå®ä¾‹å¯¹è±¡ä¸Šå¹¶æ²¡æœ‰ <code>classMethod</code> æ–¹æ³•ã€‚</p>
<p>æ³¨æ„ï¼Œé™æ€æ–¹æ³•å†… <code>this</code> æŒ‡å‘ç±»æœ¬èº«ï¼Œè€Œéå®ä¾‹å¯¹è±¡ã€‚</p>
<pre><code class="language-js">class Foo {
  static bar() {
    ths.baz() // this æŒ‡å‘ Foo æœ¬èº«
  }

  static baz() {
    console.log('baz')
  }

  // è¿™æ˜¯æ²¡é—®é¢˜çš„ï¼Œå…è®¸é™æ€æ–¹æ³•ä¸éé™æ€æ–¹æ³•é‡å
  // static qux() {
  //   // ...
  // }

  // è¯¥æ–¹æ³•åªä¼šåœ¨å®ä¾‹åŒ–æ—¶æ‰ä¼šæŒ‚è½½åˆ°å®ä¾‹å¯¹è±¡ä¸Š
  // è€Œ Foo ç±»æœ¬èº«æ˜¯ä¸å«æ­¤æ–¹æ³•çš„
  // å› æ­¤ï¼Œé™æ€æ–¹æ³•ä¸éé™æ€æ–¹æ³•æ˜¯å¯ä»¥é‡åçš„ã€‚
  qux() {
    console.log('qux')
  }
}

Foo.bar() // &quot;baz&quot;
Foo.qux() // TypeError: Foo.qux is not a function
</code></pre>
<p>çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥è¢«å­ç±»ç»§æ‰¿ã€‚</p>
<pre><code class="language-js">class Foo {
  static classMethod() {
    console.log('The static method of the parent class.')
  }
}

class Bar extends Foo {}

// å¯ä»¥åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„ classMethod é™æ€æ–¹æ³•
Bar.classMethod() // &quot;The static method of the parent class.&quot;
</code></pre>
<p>è‹¥å­ç±»ä¹Ÿå®šä¹‰äº† <code>classMethod</code> é™æ€æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ <code>super</code> å¯¹è±¡è°ƒç”¨çˆ¶ç±»çš„ <code>classMethod</code> é™æ€æ–¹æ³•ã€‚</p>
<pre><code class="language-js">class Foo {
  static classMethod() {
    console.log('The static method of the parent class.')
  }
}

class Bar extends Foo {
  static classMethod() {
    super.classMethod() // è°ƒç”¨çˆ¶ç±»é™æ€æ–¹æ³•
    console.log('Static method of subclass.')
  }
}

Bar.classMethod()
// &quot;The static method of the parent class.&quot;
// &quot;Static method of subclass.&quot;
</code></pre>
<h3>ä¹ã€é™æ€å±æ€§</h3>
<p>é™æ€å±æ€§æŒ‡çš„æ˜¯ Class æœ¬èº«çš„å±æ€§ï¼Œå³ <code>Class.propName</code>ï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡ä¸Šçš„å±æ€§ã€‚</p>
<p><strong>ç›®å‰ï¼Œæ ¹æ® ECMAScript è§„å®šï¼ŒClass å†…éƒ¨åªæœ‰é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰é™æ€å±æ€§</strong>ã€‚é™æ€å±æ€§åªèƒ½é€šè¿‡åœ¨ Class å¤–éƒ¨å®šä¹‰ã€‚</p>
<pre><code class="language-js">class Foo {}
Foo.prop = 1 // é™æ€å±æ€§ prop
const foo = new Foo()

console.log(foo.prop) // undefined
console.log(Foo.prop) // 1
</code></pre>
<p>ç°åœ¨æœ‰ä¸€ä¸ª<a href="https://github.com/tc39/proposal-class-fields">ææ¡ˆ</a>æä¾›äº†ç±»çš„é™æ€å±æ€§ï¼Œå†™æ³•æ˜¯åœ¨å±æ€§ç­¾ååŠ ä¸Š <code>static</code> å…³é”®å­—ã€‚</p>
<pre><code class="language-js">class Foo {
  static prop = 1
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šæ–¹å¼æ¥å®šä¹‰é™æ€å±æ€§ï¼Œæ˜¾ç„¶è¦æ¯”è€å¼å†™æ³•æ›´å¥½åœ°ç»„ç»‡ä»£ç ï¼Œå…¶è¯­ä¹‰æ›´å¥½ã€‚è€Œè€å¼å†™æ³•å¾€å¾€å¾ˆå®¹æ˜“è®©äººå¿½ç•¥è¿™ä¸ªé™æ€å±æ€§ã€‚</p>
<h3>åã€ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§</h3>
<p>åœ¨ç›®å‰ï¼Œåœ¨ Class å†…éƒ¨å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œåœ¨ç±»çš„å¤–éƒ¨éƒ½æ˜¯å¯ä»¥è®¿é—®åˆ°çš„ã€‚</p>
<p>è€Œç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§çš„ç›®çš„åœ¨äºï¼Œå®ƒä»¬åªå…è®¸åœ¨ Class å†…éƒ¨è®¿é—®ï¼Œè€Œå¤–éƒ¨æ˜¯ä¸èƒ½è®¿é—®çš„ã€‚ä½†ç”±äºç›®å‰ ECMAScript æ ‡å‡†å¹¶æœªæä¾›ï¼Œåªèƒ½é€šè¿‡å˜é€šçš„æ–¹å¼æ¨¡æ‹Ÿå®ç°ã€‚</p>
<ol>
<li>é€šè¿‡å‘½ååŠ ä»¥åŒºåˆ«</li>
</ol>
<pre><code class="language-js">class Foo {
  // å…¬æœ‰æ–¹æ³•
  bar() {
    this._baz()
  }

  // ç§æœ‰æ–¹æ³•ï¼Œé€šè¿‡åœ¨å˜é‡æ–¹æ³•åä¹‹å‰æ·»åŠ ä¸‹åˆ’çº¿ &quot;_&quot; åŒºåˆ†
  _baz() {
    // do something...
  }
}
</code></pre>
<p>ä½†æ˜¾ç„¶è¿™ä»ç„¶å¯åœ¨ <code>Foo</code> å®ä¾‹å¯¹è±¡ä¸­è®¿é—®åˆ° <code>instance._baz()</code>ã€‚</p>
<ol start="2">
<li>å°†ç§æœ‰æ–¹æ³•ç§»å‡ºç±»</li>
</ol>
<pre><code class="language-js">class Foo {
  // å…¬æœ‰æ–¹æ³•
  bar(...args) {
    baz.apply(this, args)
  }
}

// ç›¸å½“äºç§æœ‰æ–¹æ³•
function baz() {
  // do something...
}
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œé—´æ¥ä½¿å¾— <code>baz</code> æˆäº†ç±»çš„â€œç§æœ‰æ–¹æ³•â€ï¼Œå®ƒå¯¹ç±»çš„å®ä¾‹æ˜¯ä¸å¯è§çš„ã€‚</p>
<ol start="3">
<li>åˆ©ç”¨ <code>Symbol</code> çš„å”¯ä¸€æ€§ï¼Œå°†ç§æœ‰æ–¹æ³•çš„åç§°å‘½åä¸º <code>Symbol</code> å€¼ã€‚</li>
</ol>
<pre><code class="language-js">const _baz = Symbol('baz')

class Foo {
  // å…¬æœ‰æ–¹æ³•
  bar(...args) {
    this[_baz].apply(this, args)
  }

  // ç§æœ‰æ–¹æ³•
  [_baz]() {
    // do something...
  }
}
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œ<code>_bar</code> æ˜¯ <code>Symbol</code> å€¼ï¼Œä¸€èˆ¬åœ¨å°è£…ç±»æ—¶ä¸è®©å…¶åœ¨è·å–åˆ°ï¼Œä»¥è¾¾åˆ°ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§çš„æ•ˆæœã€‚ä½†æ˜¯ä»ç„¶å¯é€šè¿‡ <code>Reflect.ownKeys()</code> ä¾ç„¶å¯ä»¥è·å–åˆ°ã€‚</p>
<pre><code class="language-js">Reflect.ownKeys(Foo.prototype) // [&quot;constructor&quot;, &quot;bar&quot;, Symbol(baz)]
</code></pre>
<h5>ç§æœ‰å±æ€§çš„ææ¡ˆ</h5>
<p>ç›®å‰ï¼Œæœ‰ä¸€ä¸ª<a href="https://github.com/tc39/proposal-private-methods">ææ¡ˆ</a>ä¸º Class æ·»åŠ ç§æœ‰å±æ€§ã€‚åœ¨å±æ€§åä¹‹å‰ï¼Œä½¿ç”¨ <code>#</code> è¡¨ç¤ºã€‚</p>
<pre><code class="language-js">class Foo {
  // å…¬ç”¨å±æ€§
  prop = 'public property'

  // å…¬æœ‰æ–¹æ³•
  bar(...args) {
    this.#bar.apply(this, args)
  }

  // ç§æœ‰å±æ€§
  #prop = 'private property'

  // ç§æœ‰æ–¹æ³•
  #bar() {
    // do something...
  }
}

const foo = new Foo()
foo.bar('bar') // Correct
foo.prop // Correct
Reflect.ownKeys(Foo.prototype) // [&quot;constructor&quot;, &quot;bar&quot;]

// å¤–éƒ¨ä¸å¯è®¿é—®ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼Œä¼šæŠ¥é”™ã€‚
// foo.#prop // Wrong, SyntaxError: Private field '#prop' must be declared in an enclosing class
// foo.#bar() // Wrong
</code></pre>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>#prop</code>ã€<code>#bar</code> å°±æ˜¯ç§æœ‰å±æ€§å’Œç§æœ‰å±æ€§ï¼Œä¸” <code>#</code> æ˜¯å±æ€§åçš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨æ—¶ä¹Ÿå¿…é¡»å¸¦æœ‰ <code>#</code>ï¼Œå› æ­¤ <code>#prop</code> å’Œ <code>prop</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„å±æ€§ã€‚</p>
<p>å¦å¤–ï¼Œç§æœ‰å±æ€§ä¹Ÿå¯ä»¥è®¾ç½® <code>setter</code> å’Œ <code>getter</code> æ–¹æ³•ã€‚</p>
<p>è¿˜æœ‰ï¼Œç§ç”¨å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼Œå‰é¢ä¹Ÿå¯ä»¥åŠ ä¸Š <code>static</code> å…³é”®å­—ï¼Œä½¿å…¶æˆä¸ºé™æ€çš„ç§æœ‰å±æ€§æˆ–æ–¹æ³•ã€‚</p>
<pre><code class="language-js">class Foo {
  // é™æ€å±æ€§
  static prop = 'private property'

  // é™æ€ç§æœ‰å±æ€§
  static #prop = 'static private property'

  // é™æ€æ–¹æ³•
  static bar() {
    console.log(Foo.prop)
    console.log(Foo.#prop)
  }

  // é™æ€ç§æœ‰æ–¹æ³•
  static #bar() {
    console.log(Foo.prop)
    console.log(Foo.#prop)
  }
}

// æ­£å¸¸è®¿é—®
Foo.prop // &quot;private property&quot;
Foo.bar() // &quot;private property&quot;ã€&quot;static private property&quot;

// ä»¥ä¸‹æŠ¥é”™
Foo.#prop // Private field '#prop' must be declared in an enclosing class
Foo.#bar()
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>#prop</code> æ˜¯é™æ€ç§æœ‰å±æ€§ï¼Œ<code>#bar</code> æ˜¯é™æ€ç§æœ‰æ–¹æ³•ï¼Œåœ¨ Class å¤–éƒ¨æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œåªèƒ½åœ¨å†…éƒ¨ä½¿ç”¨ã€‚</p>
<p>è¿˜æœ‰ï¼Œé™æ€çš„ç§æœ‰å±æ€§æˆ–æ–¹æ³•ï¼Œéƒ½æ˜¯å¯ä»¥è¢«å­ç±»ç»§æ‰¿çš„ã€‚</p>
<pre><code class="language-js">class Bar extends Foo {}

Bar.prop // Correct
Bar.bar() // Correct
</code></pre>
<h3>åä¸€ã€new.target å±æ€§</h3>
<p><code>new</code> è¿ç®—ç¬¦æ˜¯ä»æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹å¯¹è±¡çš„å…³é”®å­—ã€‚åœ¨æ„é€ å‡½æ•°æ˜¯é€šè¿‡ <code>new</code> æˆ– <code>Reflect.constructor()</code> è°ƒç”¨çš„ï¼Œé‚£ä¹ˆ <code>new.target</code> æŒ‡å‘è¢«è¢«è°ƒç”¨çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™è¿”å› <code>undefined</code>ã€‚</p>
<p>å› æ­¤ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç¡®ä¿æ„é€ å‡½æ•°åªèƒ½é€šè¿‡ <code>new</code> å…³é”®å­—æ¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">function Point(x, y) {
  // ä¹Ÿå¯ä»¥è¿™æ ·åˆ¤æ–­ï¼š`new.target === Point`
  if (new.target !== undefined) {
    this.x = x
    this.y = y
  } else {
    throw new TypeError('Point() must be called with new.')
  }
}

const p1 = new Point(1, 2) // æ­£ç¡®ä½¿ç”¨æ–¹å¼
const p2 = Point(3, 4) // TypeError: Point() must be called with new.
</code></pre>
<p>è€Œåœ¨ç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œ<code>new.target</code> æŒ‡å‘**â€œç›´æ¥â€**è¢« <code>new</code> æ‰§è¡Œçš„æ„é€ å‡½æ•°ã€‚é‚£ä¹ˆï¼Œå½“å­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œåœ¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ä¸­ new.target æŒ‡å‘å­ç±»ã€‚</p>
<pre><code class="language-js">class Point {
  constructor(x, y) {
    this.x = x
    this.y = y
    // è‹¥å­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œnew.target æŒ‡å‘å­ç±»ã€‚
    console.log(new.target === Point)

    // if (new.target === Point) {
    //   throw new TypeError('The Point class cannot be instantiated.')
    // }
  }
}

class P extends Point {
  constructor(x, y, z) {
    super(x, y)
    this.z = z
  }
}

const point = new Point(1, 2) // ä¼šæ‰“å° true
const p = new P(1, 2, 3) // ä¼šæ‰“å° false
</code></pre>
<p>åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œå¯ä»¥å†™å‡ºä¸å¯ç‹¬ç«‹ä½¿ç”¨ï¼Œå¿…é¡»ç»§æ‰¿åæ‰ä¼šä½¿ç”¨çš„çˆ¶ç±»ã€‚å¦‚æ³¨é‡Šéƒ¨åˆ†ã€‚</p>
<p>è‹¥åœ¨å‡½æ•°å¤–éƒ¨ä½¿ç”¨ <code>new.target</code> ä¼šæŠ›å‡ºé”™è¯¯ï¼š</p>
<pre><code class="language-js">new.target // SyntaxError: new.target expression is not allowed here
</code></pre>
<p>æœªå®Œï¼Œ<a href="https://github.com/toFrankie/blog/issues/252">ä¸‹ä¸€ç¯‡</a>æ¥ç€ä»‹ç» Class ç»§æ‰¿...</p>
<h3>åäºŒã€å‚è€ƒ</h3>
<ul>
<li><a href="https://es6.ruanyifeng.com/#docs/class">Class è¯­æ³•ï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/217">å…³äº ES6 Class ç±»</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ this]]></title>
            <link>https://github.com/toFrankie/blog/issues/250</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/250</guid>
            <pubDate>Sun, 26 Feb 2023 11:39:25 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-90f60200ddd57852.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-90f60200ddd57852.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ JavaScript ä¸­ï¼Œ<code>this</code> æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å…³é”®å­—ã€‚æ­¤å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/7d13893530de">JavaScriptä¸­ çš„ this çœŸæ²¡é‚£ä¹ˆéš¾ç†è§£</a>ã€‚æœ¬æ–‡å†…å®¹ä¸»è¦æ˜¯ï¼Œé’ˆå¯¹äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¦‚ä½•ä½¿ç”¨ <code>this</code> çš„å‡ ç§æ–¹æ³•åŠåŒºåˆ«ã€‚</p>
<h3>ä¸€ã€Owner</h3>
<p>æˆ‘ä»¬å°†åœ¨æœ¬æ–‡è®¨è®ºçš„é—®é¢˜æ˜¯ï¼šåœ¨å‡½æ•° <code>doSomething()</code> ä¸­ <code>this</code> æŒ‡å‘çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>æ³¨æ„ï¼Œæœ¬æ–‡é€šç¯‡å‡åœ¨<strong>éä¸¥æ ¼æ¨¡å¼</strong>ä¸‹è¿›è¡Œã€‚</p>
</blockquote>
<pre><code class="language-html">&lt;script&gt;
  function doSomething() {
    this.style.color = '#c00'
  }
&lt;/script&gt;
</code></pre>
<p>åœ¨ JavaScript ä¸­ï¼Œ <code>this</code> æ€»æ˜¯æŒ‡æˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„â€œownerâ€ï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯æŒ‡å‡½æ•°ä½œä¸ºå…¶æ–¹æ³•çš„å¯¹è±¡ã€‚å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸­å®šä¹‰æˆ‘ä»¬å‡½æ•° <code>doSomething()</code> æ—¶ï¼Œå®ƒçš„â€œownerâ€æ˜¯é¡µé¢ï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ JavaScript çš„ <code>window</code> å¯¹è±¡ï¼ˆæˆ–å…¨å±€å¯¹è±¡ï¼‰ã€‚ä½†æ˜¯ï¼Œ<code>onclick</code> å±æ€§å½’å®ƒæ‰€å±çš„ HTML å…ƒç´ æ‰€æœ‰ã€‚</p>
<p>è¿™ç§â€œownershipâ€æ˜¯ JavaScript é¢å‘å¯¹è±¡æ–¹æ³•çš„ç»“æœã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://www.quirksmode.org/js/associative.html">ä½œä¸ºå…³è”æ•°ç»„çš„å¯¹è±¡</a>é¡µé¢ã€‚</p>
<pre><code class="language-text">------------ window --------------------------------------
|                                          / \           |
|                                           |            |
|                                          this          |
|   ----------------                        |            |
|   | HTML element | &lt;-- this         -----------------  |
|   ----------------      |           | doSomething() |  |
|               |         |           -----------------  |
|          --------------------                          |
|          | onclick property |                          |
|          --------------------                          |
|                                                        |
----------------------------------------------------------
</code></pre>
<p>å¦‚æœæˆ‘ä»¬åœ¨æ²¡æœ‰ä»»ä½•å‡†å¤‡çš„æƒ…å†µä¸‹æ‰§è¡Œ <code>doSomething()</code>ï¼Œåˆ™ <code>this</code> å…³é”®å­—æŒ‡å‘ <code>window</code> å¯¹è±¡ï¼Œè¯¥å‡½æ•°ä¼šå°è¯•æ›´æ”¹ <code>window</code> å¯¹è±¡çš„ <code>style.color</code>ã€‚ç”±äº <code>window</code> æ²¡æœ‰ <code>style</code> å¯¹è±¡ï¼Œè¯¥å‡½æ•°ä¼šå¤±è´¥å¹¶äº§ç”Ÿ JavaScript é”™è¯¯ï¼ˆTypeErrorï¼‰ã€‚</p>
<h3>äºŒã€Copying</h3>
<p>å¦‚æœæˆ‘ä»¬æƒ³å……åˆ†åˆ©ç”¨ <code>this</code>ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨æ„ä½¿ç”¨å®ƒçš„å‡½æ•°æ˜¯ç”±æ­£ç¡®çš„ HTML å…ƒç´ â€œæ‹¥æœ‰â€çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»å°†å‡½æ•°å¤åˆ¶åˆ°æˆ‘ä»¬çš„ <code>onclick</code> å±æ€§ã€‚<a href="https://www.quirksmode.org/js/events_tradmod.html">ä¼ ç»Ÿçš„äº‹ä»¶æ³¨å†Œ</a>ä¼šå¤„ç†å®ƒã€‚</p>
<pre><code class="language-js">element.onclick = doSomething
</code></pre>
<p>è¯¥å‡½æ•°è¢«å®Œæ•´åœ°å¤åˆ¶åˆ° <code>onclick</code> å±æ€§ï¼ˆç°åœ¨å˜æˆäº†ä¸€ä¸ªæ–¹æ³•ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæ‰§è¡Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œ<code>this</code> ä¼šæŒ‡å‘ HTML å…ƒç´ ï¼Œå¹¶ä¸”å®ƒçš„ <code>color</code> ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<pre><code class="language-text">------------ window --------------------------------------
|                                                        |
|                                                        |
|                                                        |
|   ----------------                                     |
|   | HTML element | &lt;-- this         -----------------  |
|   ----------------      |           | doSomething() |  |
|               |         |           -----------------  |
|          -----------------------          |            |
|          |copy of doSomething()|  &lt;-- copy function    |
|          -----------------------                       |
|                                                        |
----------------------------------------------------------
</code></pre>
<p>å½“ç„¶æ˜¯æˆ‘ä»¬å¯ä»¥å°†å‡½æ•°å¤åˆ¶åˆ°å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚æ¯æ¬¡ <code>this</code> å°†æŒ‡å‘æ­£ç¡®çš„ HTML å…ƒç´ ï¼š</p>
<pre><code class="language-text">------------ window --------------------------------------
|                                                        |
|                                                        |
|                                                        |
|   ----------------                                     |
|   | HTML element | &lt;-- this         -----------------  |
|   ----------------      |           | doSomething() |  |
|               |         |           -----------------  |
|          -----------------------          |            |
|          |copy of doSomething()|  &lt;-- copy function    |
|          -----------------------          |            |
|                                           |            |
|   -----------------------                 |            |
|   | another HTML element| &lt;-- this        |            |
|   -----------------------     |           |            |
|               |               |           |            |
|          -----------------------          |            |
|          |copy of doSomething()|  &lt;-- copy function    |
|          -----------------------                       |
|                                                        |
----------------------------------------------------------
</code></pre>
<p>å› æ­¤ï¼Œä½ å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨å®ƒã€‚æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œ <code>this</code> æŒ‡çš„æ˜¯å½“å‰æ­£åœ¨å¤„ç†äº‹ä»¶çš„ HTML å…ƒç´ ï¼Œå³â€œæ‹¥æœ‰â€ <code>doSomething()</code> å‰¯æœ¬çš„ HTML å…ƒç´ ã€‚</p>
<h3>ä¸‰ã€Referring</h3>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨<a href="https://www.quirksmode.org/js/events_early.html">å†…è”äº‹ä»¶æ³¨å†Œ</a>ï¼š</p>
<pre><code class="language-html">&lt;element onclick=&quot;doSomething()&quot;&gt;doSomething...&lt;/element&gt;
</code></pre>
<p>ä½ ä¸è¦å¤åˆ¶åŠŸèƒ½ï¼ç›¸åï¼Œä½ æŒ‡å‘å®ƒï¼Œå·®å¼‚è‡³å…³é‡è¦ã€‚<code>onclick</code> å±æ€§ä¸åŒ…å«å®é™…çš„å‡½æ•°ï¼Œè€Œåªæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼š</p>
<pre><code class="language-js">doSomething()
</code></pre>
<p>æ‰€ä»¥è¿™ç›¸å½“äºï¼Œå‰å¾€ <code>doSomething()</code> å¹¶æ‰§è¡Œå®ƒã€‚å½“æˆ‘ä»¬åˆ°è¾¾ <code>doSomething()</code> æ—¶ï¼Œ<code>this</code> å…³é”®å­—å†æ¬¡æŒ‡å‘å…¨å±€ <code>window</code> å¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å‡½æ•°è¿”å›é”™è¯¯æ¶ˆæ¯ï¼ˆTypeErrorï¼‰ã€‚</p>
<pre><code class="language-text">------------ window --------------------------------------
|                                          / \           |
|                                           |            |
|                                          this          |
|   ----------------                        |            |
|   | HTML element | &lt;-- this         -----------------  |
|   ----------------      |           | doSomething() |  |
|               |         |           -----------------  |
|          -----------------------         / \           |
|          | go to doSomething() |          |            |
|          | and execute it      | ---- reference to     |
|          -----------------------       function        |
|                                                        |
----------------------------------------------------------
</code></pre>
<h3>å››ã€The difference</h3>
<p>å¦‚æœä½ æƒ³ä½¿ç”¨ <code>this</code> æ¥è®¿é—®æ­£åœ¨å¤„ç†äº‹ä»¶çš„ HTML å…ƒç´ ï¼Œä½ å¿…é¡»ç¡®ä¿ <code>this</code> å…³é”®å­—å®é™…ä¸Šå·²å†™å…¥ <code>onclick</code> å±æ€§ã€‚åªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>this</code> æ‰æŒ‡å‘äº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œåˆ°çš„ HTML å…ƒç´ ã€‚å› æ­¤ï¼Œå¦‚æœä½ è¿™æ ·å¤„ç†ï¼š</p>
<pre><code class="language-js">element.onclick = doSomething
alert(element.onclick)
</code></pre>
<p>ä½ å°†ä¼šå¾—åˆ°ï¼š</p>
<pre><code class="language-js">function doSomething() {
  this.style.color = '#c00'
}
</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œ<code>this</code> å…³é”®å­—å­˜åœ¨äº <code>onclick</code> æ–¹æ³•ä¸­ã€‚å› æ­¤ <code>this</code> æŒ‡å‘ HTML å…ƒç´ ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ è¿™æ ·å¤„ç†ï¼š</p>
<pre><code class="language-html">&lt;element onclick=&quot;doSomething()&quot;&gt;doSomething...&lt;/element&gt;
alert(element.onclick)
</code></pre>
<p>ä½ å¾—åˆ°çš„æ˜¯ï¼š</p>
<pre><code class="language-js">function onclick(event) {
  doSomething()
}
</code></pre>
<p>è¿™ä»…ä»…æ˜¯å¯¹å‡½æ•° <code>doSomething()</code> çš„å¼•ç”¨ã€‚<code>onclick</code> æ–¹æ³•ä¸­ä¸å­˜åœ¨ <code>this</code> å…³é”®å­—ï¼Œå› æ­¤ <code>this</code> ä¸æŒ‡å‘ HTML å…ƒç´ ã€‚</p>
<h3>äº”ã€Examples - copying</h3>
<p>ä»¥ä¸‹æƒ…å†µ  <code>this</code> ä¼šå†™å…¥ <code>onclick</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-js">element.onclick = doSomething

element.addEventListener('click', doSomething, false)

element.onclick = function () { this.style.color = '#c00' }

&lt;element onclick=&quot;this.style.color = '#c00'&quot;&gt;doSomething...&lt;/element&gt;
</code></pre>
<h3>å…­ã€Examples - referring</h3>
<p>ä»¥ä¸‹æƒ…å†µ <code>this</code> æŒ‡å‘ <code>window</code> å¯¹è±¡ï¼š</p>
<pre><code class="language-js">element.onclick = function () { doSomething() }

element.attachEvent('onclick', doSomething)

&lt;element onclick=&quot;doSomething()&quot;&gt;doSomething...&lt;/element&gt;
</code></pre>
<p>è¯·æ³¨æ„ <code>attachEvent()</code> çš„å­˜åœ¨ã€‚ <a href="https://www.quirksmode.org/js/events_advanced.html">Microsoft äº‹ä»¶æ³¨å†Œæ¨¡å‹</a>çš„ä¸»è¦ç¼ºç‚¹æ˜¯ <code>attachEvent()</code> åˆ›å»ºå¯¹å‡½æ•°çš„å¼•ç”¨è€Œä¸å¤åˆ¶å®ƒã€‚å› æ­¤ï¼Œæœ‰æ—¶æ— æ³•çŸ¥é“å½“å‰æ˜¯å“ªä¸ª HTML å¤„ç†è¯¥äº‹ä»¶ã€‚</p>
<h3>ä¸ƒã€Combination</h3>
<p>ä½¿ç”¨å†…è”äº‹ä»¶æ³¨å†Œæ—¶ï¼Œä½ è¿˜å¯ä»¥å°† <code>this</code> å‘é€åˆ°è¯¥å‡½æ•°ï¼Œä»¥ä¾¿ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="language-html">&lt;element onclick=&quot;doSomething(this)&quot;&gt;doSomething...&lt;/element&gt;

function doSomething(obj) {
  // `this` is present in the event handler and is sent to the function
  // `obj` now refers to the HTML element, so we can do
  obj.style.color = '#c00'
}
</code></pre>
<h3>å…«ã€TODO List</h3>
<ul>
<li><a href="https://www.quirksmode.org/js/introevents.html">Introduction to Events</a></li>
<li><a href="https://www.quirksmode.org/js/associative.html">Objects as associative arrays</a></li>
<li><a href="https://www.quirksmode.org/js/events_tradmod.html">Traditional event registration model</a></li>
<li><a href="https://www.quirksmode.org/js/events_early.html">Early event handlers</a></li>
<li><a href="https://www.quirksmode.org/js/events_advanced.html">Advanced event registration models</a></li>
</ul>
<!--

1. æ€è€ƒï¼šä¸ºä»€ä¹ˆ React æ˜¯ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸ç”¨æ‹¬å·
2. addEventListenerã€removeEventListener ç»‘å®šä¸è§£é™¤
3. DOM Level 0 å’ŒDOM Level 2

-->
<h3>ä¹ã€References</h3>
<ul>
<li><a href="https://www.quirksmode.org/js/this.html">The this keyword</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½¿ç”¨ Nginx æ­å»ºé™æ€ç½‘ç«™]]></title>
            <link>https://github.com/toFrankie/blog/issues/249</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/249</guid>
            <pubDate>Sun, 26 Feb 2023 11:36:21 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3c10faf568e25f0d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3c10faf568e25f0d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¼€å§‹å»ºç«™äº†ï¼Œæš‚æ—¶è¿˜æ²¡æƒ³è¦åšäº›ä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>Anywayï¼Œå…ˆæä¸ªäº‘æœåŠ¡å™¨å§ï¼Œé‚£è¦æ€ä¹ˆæ­å»ºå‘¢ï¼Ÿå…ˆæ¥ä¸ªæœ€ç®€å•çš„ã€‚</p>
<blockquote>
<p>ä»¥é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸ºä¾‹ï¼Œå‡è®¾å…¬ç½‘ IP ä¸º <code>100.2.3.4</code>ï¼ˆéšä¾¿ä¹±å†™çš„ï¼‰ã€‚</p>
</blockquote>
<h2>ç™»å½•äº‘æœåŠ¡</h2>
<pre><code class="language-shell">$ ssh root@100.2.3.4
</code></pre>
<h2>å®‰è£… Nginx åŠç›¸å…³å‘½ä»¤</h2>
<pre><code class="language-shell"># å®‰è£…
$ yum install nginx -y

# å¯åŠ¨
$ nginx

# å…³é—­
$ nginx -s stop

# é‡å¯
$ nginx -s reload
</code></pre>
<h2>Nginx é»˜è®¤é…ç½®</h2>
<p>Nginx é…ç½®æ–‡ä»¶ç›®å½•ä¸€èˆ¬åœ¨ <code>/etc/nginx/</code> ä¸‹ï¼Œæ‰“å¼€ <code>nginx.conf</code> æ–‡ä»¶å¯ä»¥çœ‹åˆ°é…ç½®ï¼š</p>
<pre><code class="language-nginx">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80 default_server;
        listen       [::]:80 default_server;
        server_name  _;
        root         /usr/share/nginx/html;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
        }

        error_page 404 /404.html;
        location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
}
</code></pre>
<p>å½“å¤–ç½‘ç”¨æˆ·è®¿é—®æœåŠ¡å™¨ Web æœåŠ¡ç”± Nginx æä¾›ï¼ŒNginx éœ€è¦é…ç½®é™æ€èµ„æºçš„è·¯å¾„ä¿¡æ¯æ‰èƒ½é€šè¿‡ URL æ­£ç¡®è®¿é—®åˆ°æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¹¶å¯åŠ¨ Nginx ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ <code>http://&lt;åŸŸåæˆ–IP&gt;</code> è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µäº†ã€‚æ‰€ä»¥ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <code>http://100.2.3.4</code> å³å¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d4f99a8697fcc167.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬è§‚å¯Ÿåˆ°æµè§ˆå™¨çš„åœ°å€å˜æˆäº† <code>http://100.2.3.4/index.html</code>ï¼Œè¿™é¡µé¢æ˜¯å®‰è£… Nginx çš„é»˜è®¤ç«™ç‚¹ï¼Œå¯ä»¥åœ¨ <code>/usr/share/nginx/html</code> ç›®å½•ä¸‹æ‰¾åˆ°ã€‚åœ¨ <code>nginx.conf</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€é¡¹ <code>root /usr/share/nginx/html</code> çš„é…ç½®ï¼Œæ„æ€æ˜¯å½“å¤–ç½‘è®¿é—®æœåŠ¡å™¨<strong>è·Ÿç›®å½•</strong>æ—¶ï¼ŒNginx ä¼šå°†èµ„æºæŒ‡å‘ <code>/usr/share/nginx/html</code> çš„ç«™ç‚¹ã€‚</p>
<p>ä½†å¦‚æœè¾“å…¥åœ°å€ï¼Œæ— æ³•æ‰“å¼€ï¼ˆå¦‚ä¸‹æˆªå›¾ï¼‰ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a4072593f84180c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œéœ€è¦åœ¨äº‘æœåŠ¡å™¨æ·»åŠ <strong>å®‰å…¨ç»„è§„åˆ™</strong>ï¼Œæ·»åŠ å¹¶ä¿å­˜ï¼Œé‡æ–°åˆ·æ–°é¡µé¢å°±èƒ½æ‰“å¼€äº†ã€‚</p>
<blockquote>
<p>å…³äºé˜¿é‡Œäº‘æœåŠ¡å™¨å®‰å…¨ç»„è§„åˆ™è¯´æ˜ï¼Œæ¨èè¿™ç¯‡<a href="https://blog.csdn.net/weixin_46628200/article/details/108918934">æ–‡ç« </a>ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a367e935442b825.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>ä¿®æ”¹ Nginx é…ç½®</h2>
<p>æˆ‘ä¹ æƒ¯å°†å‰ç«¯é™æ€èµ„æºæ”¾ç½®åˆ°æœåŠ¡å™¨çš„ <code>/data/www</code> ä¸‹ï¼Œå› æ­¤å°†é…ç½®ä¿®æ”¹ä¸º <code>root /data/www</code>ã€‚æ­¤æ—¶è®¿é—® <code>http://100.2.3.4</code> ä¼šæŒ‡å‘ <code>/data/www/index.html</code>ï¼ˆåœ¨ä¸é…ç½® <code>location</code> çš„ <code>index</code> æƒ…å†µä¸‹ï¼ŒNginx é»˜è®¤é…ç½®æ˜¯ <code>index.html</code>ï¼‰ã€‚</p>
<pre><code>server {
    listen       80;
    server_name  _;
    root         /data/www;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
    location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
    }
}
</code></pre>
<blockquote>
<p>ä¿®æ”¹é…ç½®åï¼Œè®°å¾—æ‰§è¡Œ <code>ngnix -s reload</code> é‡å¯ Nginx æœåŠ¡ã€‚</p>
</blockquote>
<h2>å°† Webpack æ‰“åŒ…çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡å™¨</h2>
<p>ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac æœºå™¨ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åœ¨ç³»ç»Ÿç»ˆç«¯ä½¿ç”¨ <code>scp</code> å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ã€‚</p>
<pre><code class="language-shell"># scp [å‚æ•°] [åŸè·¯å¾„] [ç›®æ ‡è·¯å¾„]
$ scp -r /Users/frankie/Desktop/Web/react-demo/dist/* root@100.2.3.4:/data/www
</code></pre>
<p><code>scp</code>ï¼ˆsecure copyï¼‰ç”¨äºåœ¨ Linux ä¸‹è¿›è¡Œè¿œç¨‹æ‹·è´æ–‡ä»¶çš„å‘½ä»¤ã€‚ç±»ä¼¼äº <code>cp</code>ï¼Œåªä¸è¿‡ <code>cp</code> åªèƒ½åœ¨æœ¬æœºè¿›è¡Œæ‹·è´ï¼Œä¸èƒ½è·¨æœåŠ¡å™¨ã€‚<code>-r</code> è¡¨ç¤ºé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚</p>
<blockquote>
<p>å…³äº scp æ›´å¤šç»†èŠ‚ï¼Œè¯·çœ‹<a href="https://www.cnblogs.com/exmyth/p/9074722.html">æ–‡ç« </a>ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸‹é¢ä¸¤ç§çš„åŒºåˆ«ï¼š</p>
<pre><code class="language-shell"># 1ï¸âƒ£
$ scp -r /xxx/dist /data/www

# 2ï¸âƒ£
$ scp -r /xxx/dist/* /data/www
</code></pre>
<p>å…¶ä¸­ 1ï¸âƒ£ å¾—åˆ°çš„æ˜¯ <code>/data/www/dist</code>ï¼Œè€Œ 2ï¸âƒ£ å¾—åˆ°çš„æ˜¯ <code>/data/www</code>ã€‚å‰è€…è¡¨ç¤ºå°† <code>dist</code> æ•´ä¸ªç›®å½•æ‹·è´è‡³ <code>/data/www</code> ä¸‹ã€‚åè€…æ˜¯æŠŠ <code>dist</code> ç›®å½•ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶å’Œå­ç›®å½•éƒ½æ‹·è´è‡³ <code>/data/www</code>ã€‚</p>
<p>æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå‰è€…é…ç½® <code>root</code> çš„è·¯å¾„åº”è¯¥æ˜¯ <code>/data/www/dist</code>ï¼Œåè€…åˆ™ä¸º <code>/data/www</code>ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ scp -r /Users/frankie/Desktop/Web/react-demo/dist/* root@100.2.3.4:/data/www/
root@100.2.3.4's password: 
bundle.2b1a17.js                              100% 1580   120.1KB/s   00:00    
favicon.ico                                   100% 9662   724.9KB/s   00:00    
index.html                                    100% 2045   149.9KB/s   00:00    
vendors.chunk.7fb171.js                       100%  625KB 409.8KB/s   00:01
</code></pre>
<pre><code>[root@ali-ecs www]# ls
bundle.2b1a17.js  favicon.ico  index.html  vendors.chunk.7fb171.js
</code></pre>
<h2>æ•ˆæœ</h2>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://100.2.3.4</code> å³å¯çœ‹åˆ°æˆ‘ä»¬é…ç½®çš„ç½‘é¡µäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-847c8fa6105b2570.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœ€ç®€å•çš„ Nginx éƒ¨ç½²é™æ€ç½‘é¡µå°±å®Œäº†ï¼Œå…¶ä»–çš„ä¸‹æ¬¡å†è®²...</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ä¹‹å‡½æ•°é˜²æŠ–ã€èŠ‚æµ]]></title>
            <link>https://github.com/toFrankie/blog/issues/248</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/248</guid>
            <pubDate>Sun, 26 Feb 2023 11:33:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6a3fda1bfa7ab6ff.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6a3fda1bfa7ab6ff.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å†™åœ¨å‰é¢ï¼Œå®é™…é¡¹ç›®åº”ä½¿ç”¨ Lodash ç­‰ä¸»æµå·¥å…·åº“ï¼Œå®ƒä»¬ç»è¿‡ç¤¾åŒºçš„åå¤éªŒè¯ï¼Œè‚¯å®šæ¯”è‡ªå·±å†™çš„è¦å®Œå–„å¾ˆå¤šã€‚</p>
<h2>å‰è¨€</h2>
<p>ç›¸ä¿¡æ— è®ºåœ¨å®é™…åº”ç”¨åœºæ™¯ã€äº¦æˆ–æ˜¯é¢è¯•ï¼Œéƒ½ä¼šç»å¸¸é‡å¾—åˆ°å‡½æ•°é˜²æŠ–ã€å‡½æ•°èŠ‚æµç­‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥èŠä¸€èŠå§ã€‚</p>
<p>å…ˆæ”¾å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ede57838721a5c53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-jsx">import React, { useEffect, useRef } from 'react'
import debounce from '../../utils/debounce'
import throttle from '../../utils/throttle'
import style from './index.scss'

export default function Demo(props) {
  const inputElem1 = useRef()
  const inputElem2 = useRef()
  const inputElem3 = useRef()

  useEffect(() =&gt; {
    inputElem1.current.addEventListener('keyup', request)
    inputElem2.current.addEventListener('keyup', debounce(request, 1000))
    inputElem3.current.addEventListener('keyup', throttle(request, 3000))
  }, [])

  function request(event) {
    const { value } = event.target
    console.log(`Http request: ${value}.`)
  }

  return (
    &lt;div className={style.container}&gt;
      &lt;div className={style.list}&gt;
        &lt;label htmlFor=&quot;input1&quot;&gt;æ™®é€šè¾“å…¥æ¡†ï¼š&lt;/label&gt;
        &lt;input name=&quot;input1&quot; ref={inputElem1} defaultValue=&quot;&quot; /&gt;
      &lt;/div&gt;

      &lt;div className={style.list}&gt;
        &lt;label htmlFor=&quot;input2&quot;&gt;é˜²æŠ–è¾“å…¥æ¡†ï¼š&lt;/label&gt;
        &lt;input name=&quot;input2&quot; ref={inputElem2} defaultValue=&quot;&quot; /&gt;
      &lt;/div&gt;

      &lt;div className={style.list}&gt;
        &lt;label htmlFor=&quot;input3&quot;&gt;èŠ‚æµè¾“å…¥æ¡†ï¼š&lt;/label&gt;
        &lt;input name=&quot;input3&quot; ref={inputElem3} defaultValue=&quot;&quot; /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p>ä»¥ä¸Š Demo åªæœ‰ä¸‰ä¸ªè¾“å…¥æ¡†ï¼Œå¾ˆç®€å•ã€‚æˆ‘ç»™æ¯ä¸ªè¾“å…¥æ¡†ç»‘å®šäº†ä¸€ä¸ª <code>keyup</code> é”®ç›˜äº‹ä»¶ï¼Œè¯¥äº‹ä»¶æ‰§è¡Œä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼ˆä¸ºäº†æ›´ç®€æ´ï¼Œè¿™é‡Œåªæ˜¯æ‰“å°ä¸€ä¸‹è€Œå·²ï¼‰ï¼Œè€Œå¯¹åº”é˜²æŠ–ã€èŠ‚æµè¾“å…¥æ¡†åˆ™ç»è¿‡ç›¸åº”çš„å¤„ç†ã€‚</p>
<h2>å‡½æ•°é˜²æŠ–ï¼ˆdebounceï¼‰</h2>
<p>å¦‚æœæˆ‘ä»¬åœ¨<strong>æ™®é€šè¾“å…¥æ¡†</strong>å¿«é€Ÿé”®å…¥ <code>12345</code>ï¼Œå¯ä»¥ä»æ§åˆ¶å°ä¸Šçš„æ‰“å°ç»“æœçœ‹åˆ°ï¼Œå®ƒä¼šå‘èµ· 5 æ¬¡ç½‘ç»œè¯·æ±‚ï¼ˆå‡è®¾æˆ‘ä»¬è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€å•çš„æœç´¢å¼•æ“ï¼‰ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ebf48f9d8710729d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>è¿˜ä¸çŸ¥é“ç”¨ä»€ä¹ˆæˆªå±/å½•å±è½¯ä»¶å¯ä»¥ç”Ÿæˆ GIF åŠ¨å›¾ï¼Œæœ‰æ—¶é—´å†ç ”ç©¶ä¸‹...</p>
</blockquote>
<p>ä»å®é™…åœºæ™¯è€ƒè™‘ï¼Œå¦‚æœæ¯é”®å…¥ä¸€ä¸ªå­—ç¬¦å°±ç«‹åˆ»å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå»æ£€ç´¢ç»“æœï¼Œè¿™æ˜¯éå¸¸å½±å“ä½“éªŒçš„ã€‚å‡è®¾æˆ‘ä»¬é™åˆ¶ä¸ºï¼š<strong>ç”¨æˆ·åœ¨åœæ­¢è¾“å…¥å 1s åæ‰å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</strong></p>
<p>è¦å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªæœ‰ä½¿ç”¨å‡½æ•°é˜²æŠ–å³å¯ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯å‡½æ•°é˜²æŠ–ï¼Ÿ</h3>
<p>æ¦‚å¿µï¼šåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚è‹¥åœ¨è¯¥æ—¶é—´é—´éš”å†…ï¼ˆå¤šæ¬¡ï¼‰é‡æ–°è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚</p>
<p>æ€ä¹ˆç†è§£ï¼Ÿ</p>
<ul>
<li>å‡è®¾ç”¨æˆ·é”®å…¥å­—æ¯ <code>a</code> åå°±åœæ­¢è¾“å…¥äº†ï¼Œé‚£ä¹ˆç½‘ç»œè¯·æ±‚ä¼šåœ¨åœæ­¢é”®å…¥æ“ä½œçš„ 1s åå‘èµ·ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚</li>
<li>è‹¥ç”¨æˆ·ç»§ç»­é”®å…¥å­—æ¯ <code>b</code> åï¼Œè‹¥æœ‰æ‰€æ€åœ°åœäº†ä¸€ä¼šï¼ˆè¿™ä¸ªæ—¶é—´åœ¨ 1s ä¹‹å†…ï¼Œå‡è®¾ä¸º 800ms å§ï¼‰ï¼Œæ¥ç€é”®å…¥å­—æ¯ <code>c</code>ï¼Œä¹‹åå°±åœæ­¢é”®å…¥äº†ã€‚<strong>ç½‘ç»œè¯·æ±‚ä¼šå‘ç”Ÿåœ¨é”®å…¥å­—æ¯ <code>c</code> çš„ 1s åè¢«å‘èµ·ï¼Œè€Œä¸æ˜¯é”®å…¥å­—æ¯ <code>b</code> ä¹‹åçš„ 1s å‘èµ·</strong>ã€‚å› ä¸ºå‡½æ•°é˜²æŠ–ä¼šåœ¨é”®å…¥ <code>c</code> ä¹‹åé‡æ–°è®¡æ—¶ã€‚</li>
</ul>
<h3>å‡½æ•°é˜²æŠ–å®ç°</h3>
<blockquote>
<p>debounce(func, wait)</p>
</blockquote>
<p>å®ç°æ€è·¯ï¼š</p>
<p>é¦–å…ˆï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•° <code>func</code>ï¼ˆè¦é˜²æŠ–çš„å‡½æ•°ï¼Œä¸€èˆ¬æ˜¯äº‹ä»¶å›è°ƒå‡½æ•°ï¼‰å’Œ <code>wait</code>ï¼ˆéœ€è¦å»¶è¿Ÿçš„æ—¶é—´é—´éš”ï¼Œå•ä½æ¯«ç§’ï¼‰ã€‚ç„¶å <code>func</code> åœ¨ <code>setTimeout</code> ä¸­æ‰§è¡Œï¼Œè€Œ <code>setTimeout</code> çš„å»¶è¿Ÿæ—¶é—´å°±æ˜¯ <code>wait</code>ã€‚è€Œé‡æ–°è®¡æ—¶çš„è¯ï¼Œåˆ™åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ <code>clearTimeout</code> å³å¯å®ç°ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„ä¸‹ï¼Œ<code>func</code> çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆ<code>this</code>ï¼‰åŠå…¶å…¥å‚ã€‚</p>
</blockquote>
<pre><code class="language-js">function debounce(func, wait) {
  let timerId
  
  // ä¸ºç¡®ä¿ this æŒ‡å‘æ­£ç¡®ï¼Œæ­¤å¤„ä¸èƒ½ç”¨ç®­å¤´å‡½æ•°
  return function (...args) {
    // åœ¨ wait æ—¶é—´å†…ï¼Œè‹¥é‡æ–°è§¦å‘ï¼Œæ¸…é™¤ clearTiemoutï¼Œä»¥è¾¾åˆ°é‡æ–°è®¡æ—¶çš„æ•ˆæœ
    if (timerId) clearTimeout(timerId)
    
    timerId = setTimeout(() =&gt; {
      func.apply(this, args)
    }, wait)
  }
}
</code></pre>
<p>ä¾æ¬¡åœ¨å¯¹åº”è¾“å…¥æ¡†å†…é”®å…¥ <code>12345</code>ï¼Œå¯¹æ¯”ä¸‹é˜²æŠ–å‰åçš„ç»“æœï¼š</p>
<blockquote>
<p>ä¸¤æ¬¡é”®å…¥é€Ÿåº¦å·®ä¸å¤šï¼Œè€Œä¸”æ¯ä¸ªå­—ç¬¦é”®å…¥æ—¶é—´é—´éš”å°äº 1sï¼ˆå¯è°ƒå¤§å»¶è¿Ÿæ‰§è¡Œæ—¶é—´ï¼Œæ›´å®¹æ˜“å¯¹æ¯”ï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">// æ™®é€šè¾“å…¥æ¡†
inputElem1.current.addEventListener('keyup', request)
// é˜²æŠ–è¾“å…¥æ¡†
inputElem2.current.addEventListener('keyup', debounce(request, 1000))
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bc20f9a38399e74f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ— é˜²æŠ–å¤„ç†"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e3fc1bdd25c1eedb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é˜²æŠ–å¤„ç†"></p>
<p>å¯¹æ¯”ä»¥ä¸Šæ— é˜²æŠ–å¤„ç†å’Œé˜²æŠ–å¤„ç†çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°å‰è€…æ¯é”®å…¥ä¸€ä¸ªå­—ç¬¦éƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè€Œåè€…åˆ™ä¼šåœ¨æœ€åä¸€æ¬¡è§¦å‘çš„ N æ¯«ç§’ï¼ˆå³ <code>wait</code> å»¶è¿Ÿæ—¶é—´ï¼‰ä¹‹åæ‰ä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>è¿˜æœ‰ä¸€ç§æ˜¯â€œ<strong>ç«‹å³æ‰§è¡Œ</strong>â€çš„å‡½æ•°é˜²æŠ–ï¼šåŒºåˆ«åœ¨äºç¬¬ä¸€æ¬¡è§¦å‘æ—¶ï¼Œæ˜¯å¦ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
</blockquote>
<p>å†ç»“åˆä»¥ä¸Šçš„â€œ<strong>éç«‹å³æ‰§è¡Œ</strong>â€çš„é˜²æŠ–ï¼Œå®Œæ•´æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function debounce(func, wait, immediate = false) {
  let timerId
  return function (...args) {
    if (timerId) clearTimeout(timerId)

    if (immediate &amp;&amp; !timerId) {
      func.apply(this, args)
    }

    timerId = setTimeout(() =&gt; {
      func.apply(this, args)
    }, wait)
  }
}
</code></pre>
<p>å½“æˆ‘ä»¬ä¿®æ”¹æˆï¼š</p>
<pre><code class="language-js">inputElem2.current.addEventListener('keyup', debounce(request, 1000, true))
</code></pre>
<p>ä»ä»¥ä¸‹ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘åœ¨é˜²æŠ–è¾“å…¥æ¡†é”®å…¥ <code>12345</code> çš„æ—¶å€™ï¼Œå®ƒä¼šåœ¨é”®å…¥ <code>1</code> æ—¶ç«‹åˆ»å‘èµ·ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œç”±äºæ¯ä¸ªå­—ç¬¦é”®å…¥çš„æ—¶é—´é—´éš”éƒ½åœ¨ <code>1s</code> ä¹‹å†…ï¼Œå› æ­¤å®ƒåªä¼šåœ¨æœ€ååœæ­¢é”®å…¥çš„ <code>1s</code> åæ‰ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9283f5bf6ffb4897.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>å‡½æ•°èŠ‚æµï¼ˆthrottleï¼‰</h2>
<p>æ¦‚å¿µï¼šåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…åªä¼šè§¦å‘ä¸€æ¬¡å‡½æ•°ã€‚è‹¥åœ¨è¯¥æ—¶é—´é—´éš”å†…è§¦å‘å¤šæ¬¡å‡½æ•°ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆã€‚</p>
<h3>å‡½æ•°èŠ‚æµå®ç°</h3>
<pre><code class="language-js">function throttle(func, wait) {
  // è®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œ func çš„æ—¶é—´
  let prev = 0
  return function (...args) {
    // å½“å‰è§¦å‘çš„æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰
    const now = Number(new Date()) // +new Date()
    
    // å•ä½æ—¶é—´å†…åªä¼šæ‰§è¡Œä¸€æ¬¡
    if (now &gt;= prev + wait) {
      // ç¬¦åˆæ¡ä»¶æ‰§è¡Œ func æ—¶ï¼Œéœ€è¦æ›´æ–° prev æ—¶é—´
      prev = now
      func.apply(this, args)
    }
  }
}
</code></pre>
<h3>å‡½æ•°èŠ‚æµä¼˜åŒ–</h3>
<p>ä»¥ä¸ŠèŠ‚æµæ–¹æ³•æœ‰ä¸ªé—®é¢˜ï¼Œå‡è®¾èŠ‚æµæ§åˆ¶é—´éš”æ—¶é—´ä¸º 1sï¼Œè‹¥æœ€åä¸€æ¬¡è§¦å‘æ—¶é—´åœ¨ 1.5sï¼Œåˆ™æœ€åä¸€æ¬¡è§¦å‘å¹¶ä¸ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œéœ€è¦åœ¨èŠ‚æµä¸­åµŒå…¥é˜²æŠ–æ€æƒ³ï¼Œä»¥ä¿è¯æœ€åä¸€æ¬¡ä¼šè¢«è§¦å‘ã€‚</p>
<pre><code class="language-js">function throttle(func, wait) {
  // è®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œ func çš„æ—¶é—´
  let prev = 0
  let timerId
  return function (...args) {
    // å½“å‰è§¦å‘çš„æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰
    const now = Number(new Date()) // +new Date()

    // ä¿è¯æœ€åä¸€æ¬¡ä¹Ÿä¼šè§¦å‘
    // æˆ‘çœ‹åˆ°å¾ˆå¤šæ–‡ç« ï¼Œå°†æ¸…é™¤å®šæ—¶å™¨çš„æ­¥éª¤æ”¾åˆ° 2ï¸âƒ£ é‡Œé¢
    // æˆ‘è®¤ä¸ºåº”è¯¥æ”¾åœ¨è¿™é‡Œæ‰å¯¹ï¼ŒåŸå› çœ‹æˆ‘ä¸‹é¢ä¸¾ä¾‹çš„åœºæ™¯ã€‚
    if (timerId) clearTimeout(timerId)
    
    if (now &gt;= prev + wait) {
      // 1ï¸âƒ£
      // ç¬¦åˆæ¡ä»¶æ‰§è¡Œ func æ—¶ï¼Œéœ€è¦æ›´æ–° prev æ—¶é—´
      prev = now
      func.apply(this, args)
    } else {
      // 2ï¸âƒ£
      // å•ä½æ—¶é—´å†…åªä¼šæ‰§è¡Œä¸€æ¬¡
      // if (timerId) clearTimeout(timerId) // ä¸åº”è¯¥æ”¾åœ¨è¿™é‡Œ
      timerId = setTimeout(() =&gt; {
        prev = now
        func.apply(this, args)
      }, wait)
    }
  }
}
</code></pre>
<p>å‡è®¾æˆ‘å°† <code>clearTimeout()</code> æ”¾åœ¨äº† 2ï¸âƒ£ é‡Œé¢ï¼Œè€Œä¸æ˜¯åœ¨å¤–å±‚ã€‚åŸºäº <code>throttle(func, 1000)</code> è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p>
<blockquote>
<p>æˆ‘åœ¨ <code>4s</code> æ—¶è§¦å‘äº†ä¸€æ¬¡ï¼Œåº”è¯¥èµ° 1ï¸âƒ£ é€»è¾‘ã€‚ç„¶ååœ¨ <code>4.9s</code> æ—¶åˆè§¦å‘äº†ä¸€æ¬¡ï¼Œè¿™ä¼šèµ°çš„ 2ï¸âƒ£ é€»è¾‘å¹¶è®°å½•äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ã€‚ç„¶åæ—¶é—´åˆ°äº† <code>5s</code>ï¼Œæˆ‘åˆè§¦å‘äº†ä¸€æ¬¡ï¼ˆåé¢å°±åœæ­¢æ“ä½œäº†ï¼‰ï¼Œå®ƒä¼šèµ° 1ï¸âƒ£ é€»è¾‘ä¸€æ¬¡ï¼Œæ¥ç€æ—¶é—´æ¥çš„ <code>5.9s</code>ï¼Œå®ƒè¿˜ä¼šæ‰§è¡Œä¸€é <code>fn.apply(this, args)</code>ï¼Œå› ä¸ºåœ¨ <code>5s</code> è§¦å‘æ—¶ï¼Œæ²¡æœ‰ <code>clearTimeout()</code>ã€‚å› æ­¤ï¼Œæ¸…é™¤å®šæ—¶å™¨çš„æ­¥éª¤åº”è¯¥æ”¾åœ¨å¤–å±‚ï¼Œä»¥ä¿è¯æ¯æ¬¡è¢«è§¦å‘æ˜¯éƒ½æ¸…æ‰æœ€åä¸€æ¬¡çš„å®šæ—¶å™¨ï¼Œé¿å…åœ¨ä¸€äº›è¾¹ç•Œ Case è§¦å‘ä¸¤æ¬¡ã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼Œä»¥ä¸Šåœºæ™¯æ˜¯åœ¨ç†æƒ³çš„çŠ¶æ€ï¼Œå®é™…åœºæ™¯å¯èƒ½å‡ ä¹ç¢°ä¸åˆ°è¿™äº›è¾¹ç•Œã€‚ä½†ä»ä¸¥è°¨çš„è§’åº¦å»çœ‹é—®é¢˜ï¼Œåº”è¯¥ä¹Ÿè¦è€ƒè™‘çš„ã€‚</p>
<blockquote>
<p>å†™åˆ°è¿™é‡Œï¼Œæˆ‘åˆåœ¨æƒ³åˆšåˆšçš„â€œç«‹å³æ‰§è¡Œçš„å‡½æ•°é˜²æŠ–â€ï¼Œè·Ÿè¿™ä¸ªä¼˜åŒ–ç‰ˆçš„èŠ‚æµæ˜¯ä¸æ˜¯æœ‰ç‚¹åƒï¼Œç¬¬ä¸€æ¬¡è§¦å‘éƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚ä½†åŒºåˆ«æ˜¯é˜²æŠ–ä¼šé‡æ–°è®¡æ—¶ï¼Œè€ŒèŠ‚æµåœ¨ç¬¬ä¸€æ¬¡è§¦å‘åé¢çš„æ¯ä¸ªé—´éš”æ—¶é—´ç‚¹éƒ½ä¼šè§¦å‘ï¼Œéé—´éš”ç‚¹çš„æœ€åä¸€æ¬¡è§¦å‘ä¹Ÿå°†ä¼šè¢«æ‰§è¡Œã€‚</p>
</blockquote>
<p>æˆ‘åœ¨èŠ‚æµè¾“å…¥æ¡†å†…ï¼Œä¾æ¬¡é”®å…¥ <code>1234567890</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼šåœ¨é”®å…¥å­—ç¬¦ <code>1</code> æ—¶æ‰§è¡Œäº†å›è°ƒï¼›æ¥ç€é”®å…¥çš„ <code>234</code>ã€<code>67</code> å­—ç¬¦éƒ½å±åœ¨ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”å†…ï¼Œå› æ­¤æ— æ³•æ‰§è¡Œå›è°ƒã€‚å…¶ä¸­é”®å…¥çš„ <code>90</code> å­—ç¬¦åº”å±äº <code>8</code> ä¹‹åçš„ 1s å‘¨æœŸä¹‹å†…ï¼Œç”±äºé”®å…¥ <code>0</code> å­—ç¬¦å±äºæœ€åä¸€æ¬¡çš„éæ—¶é—´é—´éš”å†…çš„è§¦å‘åŠ¨ä½œï¼Œå› æ­¤å›è°ƒä¼šåœ¨é”®å…¥ <code>0</code> çš„ 1s åè¢«æ‰§è¡Œã€‚ï¼ˆå¯æ‰“å°æ—¶é—´æˆ³çš„å½¢å¼ï¼Œæ›´ç²¾ç»†åœ°å¯¹æ¯”ï¼‰</p>
<pre><code class="language-js">inputElem3.current.addEventListener('keyup', throttle(request, 1000))
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677411328715.png" alt="èŠ‚æµå¤„ç†"></p>
<h2>é˜²æŠ–ä¸èŠ‚æµ</h2>
<p>å…¶å®ï¼Œå‡½æ•°é˜²æŠ–å’Œå‡½æ•°èŠ‚æµéƒ½æ˜¯ä¸ºäº†é˜²æ­¢æŸä¸ªæ—¶é—´æ®µé¢‘ç¹è§¦å‘æŸä¸ªäº‹ä»¶ã€‚å®ƒä¿©åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…å¤šæ¬¡é‡å¤è§¦å‘ï¼Œéƒ½åªä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚åŒºåˆ«åœ¨äºå‡½æ•°é˜²æŠ–æœ€åä¸€æ¬¡è§¦å‘æœ‰æ•ˆï¼Œè€Œå‡½æ•°èŠ‚æµåˆ™æ˜¯ç¬¬ä¸€æ¬¡è§¦å‘æœ‰æ•ˆã€‚</p>
<p>è€Œåœ¨ä¸Šé¢ï¼Œéƒ½å¯¹å‡½æ•°é˜²æŠ–å’Œå‡½æ•°èŠ‚æµåšäº†â€œæ‹“å±•â€ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åœ¨å‡½æ•°é˜²æŠ–ä¸­ï¼Œå¢åŠ äº† <code>immediate</code> çš„å‚æ•°ï¼Œç”¨äºæ§åˆ¶ç¬¬ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œå›è°ƒã€‚</li>
<li>åœ¨å‡½æ•°èŠ‚æµä¸­ï¼Œå…è®¸æœ€åä¸€æ¬¡åœ¨éæ—¶é—´é—´éš”çš„è§¦å‘åŠ¨ä½œæœ‰æ•ˆã€‚</li>
</ul>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p>å‡½æ•°é˜²æŠ–ï¼ˆdebounceï¼‰</p>
<ul>
<li>æœç´¢åœºæ™¯ï¼šé˜²æ­¢ç”¨æˆ·ä¸åœåœ°è¾“å…¥ï¼Œæ¥èŠ‚çº¦è¯·æ±‚èµ„æºã€‚</li>
<li>window resizeï¼šè°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°æ—¶ï¼Œåˆ©ç”¨é˜²æŠ–ä½¿å…¶åªè§¦å‘ä¸€æ¬¡ã€‚</li>
</ul>
</li>
<li>
<p>å‡½æ•°èŠ‚æµï¼ˆthrottleï¼‰</p>
<ul>
<li>é¼ æ ‡äº‹ä»¶ã€mousemove æ‹–æ‹½</li>
<li>ç›‘å¬æ»šåŠ¨äº‹ä»¶</li>
</ul>
</li>
</ul>
<p>å¦‚æœè¿˜æ˜¯ä¸å¤ªæ˜ç™½ debounce å’Œ throttle çš„å·®å¼‚ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹è¿™ä¸ª<a href="http://demo.nimius.net/debounce_throttle/">é¡µé¢</a>ï¼Œå¯è§†åŒ–ä½“éªŒã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-330d7d9d8983b0ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<!--
**TODO List:**

* è¯¦ç»†é˜…è¯» Lodash çš„[é˜²æŠ–](https://github.com/lodash/lodash/blob/master/debounce.js)å’Œ[èŠ‚æµ](https://github.com/lodash/lodash/blob/master/throttle.js)æºç ã€‚
* [window.requestAnimationFrame](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame)
-->
<h2>ç±»å‹æ ‡æ³¨</h2>
<pre><code class="language-ts">function debounce&lt;A extends any[], R&gt;(
  func: (...args: A) =&gt; R,
  wait: number = 0,
  immediate: boolean = false
): (...args: A) =&gt; void {
  let timerId: number | undefined

  return function (this: any, ...args) {
    if (timerId) clearTimeout(timerId)

    if (immediate &amp;&amp; !timerId) {
      func.apply(this, args)
    }

    timerId = setTimeout(() =&gt; {
      func.apply(this, args)
    }, wait)
  }
}
</code></pre>
<pre><code class="language-ts">function throttle&lt;A extends any[], R&gt;(func: (...args: A) =&gt; R, wait: number): (...args: A) =&gt; void {
  let prev = 0
  let timerId: number | undefined

  return function (this: any, ...args) {
    const now = Number(new Date())

    if (timerId) clearTimeout(timerId)

    if (now &gt;= prev + wait) {
      prev = now
      func.apply(this, args)
    } else {
      timerId = setTimeout(() =&gt; {
        prev = now
        func.apply(this, args)
      }, wait)
    }
  }
}
</code></pre>
<p>çœ‹åˆ°æœ‰äº›åº“åƒä¸‹é¢è¿™æ ·æ ‡æ³¨ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ debounce æˆ– throttle é‡Œ return çš„å‡½æ•°æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç†åº”è¿”å› <code>(...args: A) =&gt; void</code>ï¼Œä½†å®é™…è¿”å›äº† <code>(...args: A) =&gt; R</code>ï¼Œè¿™æ ·åšå…¶å®ä¸å¤ªå¯¹ã€‚ä½†è¿™æ ·ä½“éªŒä¸Šæœ‰ä¸€ä¸ªå¥½å¤„ï¼šåœ¨è°ƒç”¨ throttledFn æ—¶å¯ä»¥çœ‹åˆ°åŸå‡½æ•°è¿”å›å€¼æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<pre><code class="language-ts">function throttle&lt;T&gt;(func: T, wait: number): T {
  // ...
}

const throttledFn = throttle(function doSomething() {}, 100)
</code></pre>
<p>ä½¿ç”¨ JSDoc æ³¨é‡Šï¼ˆèŠ‚æµåŒç†ï¼‰</p>
<pre><code class="language-js">/**
 * å‡½æ•°é˜²æŠ–
 * @template A, R
 * @param {(...args: A) =&gt; R} func è¦é˜²æŠ–çš„å‡½æ•°
 * @param {number} wait é˜²æŠ–æ—¶é—´
 * @param {boolean} [immediate=false] ç«‹å³æ‰§è¡Œ
 * @returns {(...args: A) =&gt; void} è¿”å›è¢«é˜²æŠ–å¤„ç†çš„å‡½æ•°
 */
export const debounce = (func, wait, immediate = false) =&gt; {
  let timerId
  return function (...args) {
    if (timerId) clearTimeout(timerId)

    if (immediate &amp;&amp; !timerId) {
      func.apply(this, args)
    }

    timerId = setTimeout(() =&gt; {
      func.apply(this, args)
    }, wait)
  }
}
</code></pre>
<h2>å‚è€ƒ</h2>
<ul>
<li><a href="https://github.com/lodash/lodash/blob/master/debounce.js">Lodash debounce</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38313717">å‡½æ•°é˜²æŠ–ä¸å‡½æ•°èŠ‚æµï¼ˆå¸å¾’æ­£ç¾å¤§ä½¬ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é’ˆå¯¹ Chrome 80 å’Œ Chrome 91 å¯¹ Cookie SameSite é™åˆ¶çš„è§£å†³æ–¹æ¡ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/247</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/247</guid>
            <pubDate>Sun, 26 Feb 2023 11:32:37 GMT</pubDate>
            <description><![CDATA[<h2>èƒŒæ™¯</h2>
<p>ç”±äºæ­¤å‰æˆ‘çš„ Chrome æµè§ˆå™¨ä¸€ç›´éƒ½æ˜¯å®‰è£…æœ€æ–° Beta ç‰ˆæœ¬ï¼Œä½†æ˜¯æœ‰ä¸€å¤©å› ä¸ºè¯¥æµè§ˆå™¨  Cookie çš„ SameSite å±æ€§çš„é™åˆ¶ï¼ˆChrome 80 ç‰ˆæœ¬ä»¥åï¼‰ï¼Œå¯¼è‡´è·¨åŸŸè¯·æ±‚æ— æ³•æºå¸¦ä¸Š Cookie äº†ï¼Œå¯¼è‡´åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡é˜»äº†ã€‚</p>
<h2>è§£å†³æ–¹æ³•</h2>
<p>è‡ª C]]></description>
            <content:encoded><![CDATA[<h2>èƒŒæ™¯</h2>
<p>ç”±äºæ­¤å‰æˆ‘çš„ Chrome æµè§ˆå™¨ä¸€ç›´éƒ½æ˜¯å®‰è£…æœ€æ–° Beta ç‰ˆæœ¬ï¼Œä½†æ˜¯æœ‰ä¸€å¤©å› ä¸ºè¯¥æµè§ˆå™¨  Cookie çš„ SameSite å±æ€§çš„é™åˆ¶ï¼ˆChrome 80 ç‰ˆæœ¬ä»¥åï¼‰ï¼Œå¯¼è‡´è·¨åŸŸè¯·æ±‚æ— æ³•æºå¸¦ä¸Š Cookie äº†ï¼Œå¯¼è‡´åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡é˜»äº†ã€‚</p>
<h2>è§£å†³æ–¹æ³•</h2>
<p>è‡ª Chrome 80 ç‰ˆæœ¬èµ·ï¼ŒChrome æ›´æ–°äº† SameSite å±æ€§çš„é»˜è®¤å€¼ï¼Œç”± <code>None</code> æ”¹æˆäº† <code>Lax</code>ï¼Œä¸»è¦ç”¨äºé™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œå‡å°‘å®‰å…¨é£é™©å’Œç”¨æˆ·è¿½è¸ªã€‚åŒæ—¶ï¼ŒåŸºäº Chromium çš„ Edge æµè§ˆå™¨ï¼Œåœ¨å¯¹åº”ç‰ˆæœ¬ä¹Ÿä¼šæœ‰æ­¤é™åˆ¶å“¦ã€‚</p>
<h3><s>æ–¹æ¡ˆä¸€ï¼ˆä¸æ¨èï¼‰</s></h3>
<p>å®‰è£… Chrome 80 ä»¥ä¸‹ç‰ˆæœ¬ã€‚</p>
<h3>æ–¹æ¡ˆäºŒï¼šé’ˆå¯¹ Chrome 80 ä»¥ä¸Šï¼ŒChrome 91 ä»¥ä¸‹çš„æµè§ˆå™¨</h3>
<p>æµè§ˆå™¨åœ°å€è¾“å…¥ <code>chrome://flags/</code> å¹¶å‰å¾€ ï¼Œæœç´¢ <a href="chrome://flags/#same-site-by-default-cookies"><code>SameSite by default cookies</code></a> å’Œ <a href="chrome://flags/#cookies-without-same-site-must-be-secure"><code>Cookies without SameSite must be secure</code></a>ï¼Œå°†è¿™ä¸¤é¡¹è®¾ç½®ä¸º <code>Disabled</code>ï¼Œç„¶å<strong>é‡å¯æµè§ˆå™¨</strong>ã€‚</p>
<h3>æ–¹æ¡ˆä¸‰ï¼šé’ˆå¯¹ Chrome 91 åŠæ›´æ–°ç‰ˆæœ¬</h3>
<p>è¿‘æœŸå°† Google Chrome å‡çº§åˆ° 91 ç‰ˆæœ¬ä¹‹åï¼Œå°†ä¸Šè¿°æåˆ°çš„ <code>SameSite by default cookies</code> å’Œ <code>Cookies without SameSite must be secure</code> ç›´æ¥å±è”½å¹¶è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ˆ<code>Default</code>ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åŸæ¥çš„é…ç½®å¤±æ•ˆäº†ï¼Œä¸”å†ä¹Ÿæ— æ³•é€šè¿‡ä¸Šè¿°æ–¹å¼å»ä¿®æ”¹é…ç½®äº†ã€‚</p>
<p><s>å…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼Œè¿˜æ˜¯é™çº§åˆ° Chrome 91 ä»¥ä¸‹ï¼ˆä»ç„¶ä¸æ¨èï¼‰ã€‚</s></p>
<p>Windows å¹³å°ï¼š</p>
<p>åœ¨å®Œå…¨å…³é—­ Chrome æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€ Chrome æµè§ˆå™¨å¿«æ·æ–¹å¼ï¼Œåœ¨ç›®æ ‡åæ·»åŠ  <code>--disable-features=SameSiteByDefaultCookies</code> ä¿å­˜ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-daf2645542ccaa23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>Win å¹³å°æœªäº²æµ‹ï¼Œæ–¹æ¡ˆå’Œé…å›¾æºè‡ªï¼š<a href="https://juejin.cn/post/6967695146322247716">NgZaamPaang</a>ã€‚</p>
</blockquote>
<p>macOS å¹³å°ï¼š</p>
<p>å‰æè¿˜æ˜¯å®Œå…¨å…³é—­æµè§ˆå™¨ï¼Œæ ¹æ®ä¸åŒçš„æµè§ˆå™¨ï¼Œé€‰æ‹©ä¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤æ‰“å¼€ã€‚</p>
<pre><code class="language-shell"># Google Chrome
$ open -a &quot;Google Chrome&quot; --args --disable-features=SameSiteByDefaultCookies

# Microsoft Edge by Chromium
$ open -a &quot;Microsoft Edge&quot; --args --disable-features=SameSiteByDefaultCookies
</code></pre>
<h3>æ–¹æ¡ˆå››ï¼šé’ˆå¯¹æœªæ¥ç‰ˆæœ¬ï¼ˆ94 ç‰ˆæœ¬ï¼‰</h3>
<p>Chromium é¡¹ç›®å®˜ç½‘æåˆ°åœ¨ 94 ç‰ˆæœ¬é€šè¿‡å‘½ä»¤è¡Œç¦ç”¨è®¾ç½® SameSite é»˜è®¤å€¼çš„æ–¹å¼ä¼šè¢«ç§»é™¤ï¼Œå±Šæ—¶æ–¹æ¡ˆäºŒå’Œæ–¹æ¡ˆä¸‰çš„æ–¹å¼éƒ½å°†æ— æ³•ä½¿ç”¨ï¼Œåç»­å¯é€šè¿‡ Nginx ç­‰ä»£ç†å·¥å…·æˆ–è½¯ä»¶å°†è·¨åŸŸè¯·æ±‚è½¬ä¸ºéè·¨åŸŸè¯·æ±‚æ¥è§£å†³æ”¹é—®é¢˜ã€‚</p>
<p><a href="https://www.chromium.org/updates/same-site">å®˜æ–¹æè¿°å¦‚ä¸‹</a>ï¼š</p>
<blockquote>
<p>The flags <code>#same-site-by-default-cookies</code> and <code>#cookies-without-same-site-must-be-secure</code> have been removed from <code>chrome://flags</code> as of Chrome 91, as the behavior is now enabled by default. In Chrome 94, the command-line flag <code>--disable-features=SameSiteByDefaultCookies,CookiesWithoutSameSiteMustBeSecure</code> will be removed.</p>
</blockquote>
<h2>ä¸‹è½½</h2>
<h3>Chrome æµè§ˆå™¨</h3>
<ul>
<li><a href="https://www.google.cn/intl/zh-CN/chrome/">æ­£å¼ç‰ˆ</a></li>
<li><a href="https://www.google.com/intl/zh-CN/chrome/beta/?standalone=1&amp;extra=betachannel">æµ‹è¯•ç‰ˆ</a></li>
<li><a href="https://www.google.com/intl/zh-CN/chrome/browser/?standalone=1&amp;extra=devchannel">å¼€å‘ç‰ˆ</a></li>
<li><a href="https://www.google.com/chrome/canary">Canary ç‰ˆæœ¬</a></li>
</ul>
<blockquote>
<p><s>ä¹Ÿå¯è®¿é—® <a href="https://www.chromedownloads.net/">Chrome Downloads</a> ä¸‹è½½å…¶ä»–å†å²ç‰ˆæœ¬ï¼ŒMac/Win ç‰ˆéƒ½æŒºå…¨çš„ã€‚</s></p>
</blockquote>
<!--

è¿™é‡Œæœ‰ä¸ªé€šç”¨çš„ä¸‹è½½åœ°å€ï¼Œä½†æ˜¯å‰ææ˜¯ï¼Œä½ éœ€è¦çŸ¥é“æƒ³è¦ä¸‹è½½çš„å†å²ç‰ˆæœ¬çš„ç‰ˆæœ¬å·ï¼ŒæŒºè›‹ç–¼çš„æ˜¯å¯¹å§ã€‚

> ä¸‹è½½åœ°å€æ˜¯ï¼š`http://dl.google.com/chrome/install/[ç‰ˆæœ¬å·åä¸¤ä½]/chrome_installer.exe`
>
> å‡å¦‚è¦ä¸‹è½½çš„ç‰ˆæœ¬å·æ˜¯ `15.0.874.102`ï¼Œé‚£ä¹ˆåä¸¤ä½å°±æ˜¯ `874.102`ï¼Œè¾“å…¥åœ°å€ï¼š`http://dl.google.com/chrome/install/874.102/chrome_installer.exe` å³å¯ä¸‹è½½ã€‚
> 
> è¯¥æ–¹æ³•ä»…é™äº Win ç‰ˆï¼Œè‡³äº Mac ç‰ˆæ²¡æ‰¾åˆ°æ–¹æ³•ï¼Œæ— å¥ˆã€‚

-->
<h3>Firefox æµè§ˆå™¨</h3>
<ul>
<li><a href="https://www.mozilla.org/zh-CN/firefox/">ç¨³å®šç‰ˆ</a></li>
<li><a href="https://www.mozilla.org/zh-CN/firefox/developer/">å¼€å‘è€…ä¸­æ–‡ç‰ˆæœ¬</a></li>
<li><a href="https://www.mozilla.org/zh-CN/firefox/channel/desktop/#beta">Beta ç‰ˆæœ¬ã€Nightly ç‰ˆæœ¬</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://blog.csdn.net/weixin_46146313/article/details/117707199">Chrome 91 ç‰ˆæœ¬ SameSite by default cookies è¢«ç§»é™¤åçš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="https://juejin.cn/post/6967695146322247716">Chrome ä¸­è·¨åŸŸ POST è¯·æ±‚æ— æ³•æºå¸¦ Cookie çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="https://gadzan.com/chrome-edge-91hou">Chrome/Edge 91 ç‰ˆæœ¬ SameSite by default cookies è¢«ç§»é™¤åçš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html">Cookie çš„ SameSite å±æ€§ï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NDAzMjE5NQ%3D%3D&amp;chksm=ce6eccfff91945e990e0b21e777f5a85f3f0699f7d51e45a1dd83d0bf36eaf926f7e90fbe3ff&amp;idx=1&amp;lang=zh_CN&amp;mid=2247485523&amp;scene=21&amp;sn=e7f3989448f5ff1e8905fc6596268e33&amp;token=379611469#wechat_redirect">å½“æµè§ˆå™¨å…¨é¢ç¦ç”¨ä¸‰æ–¹ Cookie</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è¶…è¯¦ç»†çš„ JavaScript æ·±æ‹·è´å®ç°]]></title>
            <link>https://github.com/toFrankie/blog/issues/246</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/246</guid>
            <pubDate>Sun, 26 Feb 2023 11:27:14 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d1a19225ff7a1391.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Feepik"><]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d1a19225ff7a1391.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Feepik"></p>
<h2>ä¸€ã€JSON.stringify() çš„ç¼ºé™·</h2>
<p>åˆ©ç”¨å†…ç½®çš„ JSON é™æ€æ–¹æ³•ï¼Œå¯ä»¥å®ç°ç®€æ˜“çš„æ·±æ‹·è´ï¼š</p>
<pre><code class="language-js">const obj = {
  // ...
}
JSON.parse(JSON.stringify(obj)) // åºåˆ—åŒ–ä¸ååºåˆ—åŒ–
</code></pre>
<p>å®ƒå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ï¼Œæ¯•ç«Ÿå¾ˆå°‘å»æ‹·è´å‡½æ•°ä¹‹ç±»çš„ã€‚</p>
<pre><code class="language-js">JSON.stringify(value[, replacer[, space]])
</code></pre>
<p>ç®€å•æ€»ç»“ï¼š</p>
<ul>
<li>
<p>å¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²å¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¼šè‡ªåŠ¨è½¬æ¢æˆå…¶åŸå§‹å€¼ã€‚</p>
</li>
<li>
<p><code>undefined</code>ã€ä»»æ„å‡½æ•°ã€<code>Symbol</code> å€¼ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹æœ‰ä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚</p>
<ul>
<li>è‹¥å‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­ï¼Œä¼šè¢«å¿½ç•¥ã€‚</li>
<li>è‹¥å‡ºç°åœ¨æ•°ç»„ä¸­ï¼Œä¼šè½¬æ¢æˆ <code>null</code>ã€‚</li>
</ul>
</li>
<li>
<p><code>ä»»æ„å‡½æ•°</code>ã€<code>undefined</code> è¢«å•ç‹¬è½¬æ¢æ—¶ï¼Œä¼šè¿”å› <code>undefined</code>ã€‚</p>
</li>
<li>
<p>æ‰€æœ‰ä»¥ <code>Symbol</code> ä¸ºå±æ€§é”®çš„å±æ€§éƒ½ä¼šè¢«å¿½ç•¥ï¼Œå³ä¾¿åœ¨ç¬¬äºŒä¸ªå‚æ•° <code>replacer</code> ä¸­æŒ‡å®šäº†è¯¥å±æ€§ã€‚</p>
</li>
<li>
<p><code>Date</code> è°ƒç”¨äº†å…¶å†…ç½®çš„ <code>toJSON()</code> æ–¹æ³•è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå› æ­¤ä¼šè¢«å½“åˆå­—ç¬¦ä¸²å¤„ç†ã€‚</p>
</li>
<li>
<p><code>NaN</code> å’Œ <code>Infinity</code> çš„æ•°å€¼åŠ <code>null</code> éƒ½ä¼šå½“åš <code>null</code>ã€‚</p>
</li>
<li>
<p>è¿™äº›å¯¹è±¡ <code>Map</code>ã€<code>Set</code>ã€<code>WeakMap</code>ã€<code>WeakSet</code> ä»…ä¼šåºåˆ—åŒ–å¯æšä¸¾çš„å±æ€§ã€‚</p>
</li>
<li>
<p>è¢«è½¬æ¢å€¼å¦‚æœå«æœ‰ <code>toJSON()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰ä»€ä¹ˆå€¼å°†è¢«åºåˆ—åŒ–ã€‚</p>
</li>
<li>
<p>å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
</li>
</ul>
<p>ä»å‘½åæ¥çœ‹ï¼Œæˆ‘è®¤ä¸ºå®ƒä»¬åªæ˜¯æ–¹ä¾¿æˆ‘ä»¬æ“ä½œç¬¦åˆ JSON æ ¼å¼çš„ JavaScript å¯¹è±¡æˆ–ç¬¦åˆ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>JSON æ˜¯ä¸€ç§æ•°æ®æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§è§„èŒƒã€‚JSON æ˜¯ç”¨äºè·¨å¹³å°æ•°æ®äº¤æµçš„ï¼Œç‹¬ç«‹äºè¯­è¨€å’Œå¹³å°ã€‚è€Œ JavaScript å¯¹è±¡æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå­˜åœ¨äºå†…å­˜ä¸­ã€‚JavaScript å¯¹è±¡æ˜¯æ²¡åŠæ³•ä¼ è¾“çš„ï¼Œåªæœ‰åœ¨è¢«åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åæ‰èƒ½ä¼ è¾“ã€‚</p>
</blockquote>
<p>å®ƒåªæ˜¯æ°å¥½èƒ½æ»¡è¶³ä¸€äº›ç®€å•çš„æ·±æ‹·è´éœ€æ±‚è€Œå·²ã€‚</p>
<h2>äºŒã€è¾¹ç•Œæ¡ä»¶</h2>
<p>å…¶å®å®ç°ä¸€ä¸ªè¾ƒä¸ºå®Œæ•´çš„æ·±æ‹·è´ï¼Œè¦å¤„ç†å¾ˆå¤šè¾¹ç•Œæ¡ä»¶ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>å¾ªç¯å¼•ç”¨</li>
<li>åŒ…è£…å¯¹è±¡</li>
<li>å‡½æ•°</li>
<li>åŸå‹é“¾</li>
<li>ä¸å¯æšä¸¾å±æ€§</li>
<li>Map/WeakMapã€Set/WeakSet</li>
<li>RegExp</li>
<li>Symbol</li>
<li>Date</li>
<li>ArrayBuffer</li>
<li>åŸç”Ÿ DOM/BOM å¯¹è±¡</li>
<li>...</li>
</ul>
<blockquote>
<p>è‡³äºè¦ä¸è¦è€ƒè™‘é‚£ä¹ˆå¤šè¾¹ç•Œæ¡ä»¶ï¼Œè§†å®é™…éœ€æ±‚è€Œå®šã€‚</p>
</blockquote>
<p>ç›®å‰ï¼Œæœ€å®Œå–„çš„æ·±æ‹·è´æ–¹æ³•åº”è¯¥æ˜¯ Lodash çš„ <a href="https://www.lodashjs.com/docs/lodash.cloneDeep"><code>_.cloneDeep()</code></a> æ–¹æ³•ã€‚<s>å®é™…é¡¹ç›®ä¸­ï¼Œå¦‚éœ€å¤„ç† <code>JSON.stringify()</code> æ— æ³•è§£å†³çš„ Caseï¼Œæˆ‘ä¼šæ¨èä½¿ç”¨å®ƒ</s>ã€‚</p>
<p>æœ¬æ–‡æ—¨åœ¨å­¦ä¹ ï¼Œä»¥ä¸Šè¾¹ç•Œæ¡ä»¶éƒ½ä¼šå°½å¯èƒ½å…¼é¡¾åˆ°ã€‚è¿™æ ·ï¼Œæ— è®ºæ—¥åå®ç°ç‰¹æ®Šçš„æ·±æ‹·è´ï¼Œè¿˜æ˜¯é¢è¯•ï¼Œéƒ½å¯ä»¥ä»å®¹åº”å¯¹ã€‚</p>
<h2>ä¸‰ã€å®ç°</h2>
<blockquote>
<p>ä»¥ä¸‹å°†ä¼šé€æ­¥å®ç°ï¼Œå®Œæ•´ç¤ºä¾‹æ”¾åœ¨æ–‡æœ«ã€‚</p>
</blockquote>
<p>ä½¿ç”¨é€’å½’æ€è·¯å®ç°ã€‚å…ˆå†™ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; Object.prototype.toString.call(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    const output = isArray(input) ? [] : {}
    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>ä»¥ä¸Šç®€æ˜“ç‰ˆæœ¬è¿˜å­˜åœ¨å¾ˆå¤šæƒ…å†µè¦ç‰¹æ®Šå¤„ç†ï¼Œæ¥ä¸‹æ¥é’ˆå¯¹ <code>JSON.stringify()</code> çš„ç¼ºé™·ï¼Œä¸€ç‚¹ä¸€ç‚¹å»å®Œå–„å®ƒã€‚</p>
<h3>3.1 é’ˆå¯¹å¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡çš„å¤„ç†</h3>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä» ES6 å¼€å§‹å›´ç»•åŸå§‹æ•°æ®ç±»å‹åˆ›å»ºä¸€ä¸ªæ˜¾å¼åŒ…è£…å™¨å¯¹è±¡ä¸å†è¢«æ”¯æŒã€‚ä½†ç”±äºé—ç•™åŸå› ï¼Œç°æœ‰çš„åŸå§‹åŒ…è£…å™¨å¯¹è±¡ï¼ˆå¦‚ <code>new Boolean</code>ã€<code>new Number</code>ã€<code>new String</code>ï¼‰ä»å¯ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ ES6+ æ–°å¢çš„ <code>Symbol</code>ã€<code>BigInt</code> æ•°æ®ç±»å‹æ— æ³•é€šè¿‡ <code>new</code> å…³é”®å­—åˆ›å»ºå®ä¾‹å¯¹è±¡çš„åŸå› ã€‚</p>
</blockquote>
<p>ç”±äº <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in">for...in</a> æ— æ³•éå†<strong>ä¸å¯æšä¸¾</strong>çš„å±æ€§ã€‚ä¾‹å¦‚ï¼ŒåŒ…è£…å¯¹è±¡çš„ <code>[[PrimitiveValue]]</code> å†…éƒ¨å±æ€§ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬ç‰¹æ®Šå¤„ç†ä¸€ä¸‹ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-78fa536df61e8c06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»¥ä¸Šç»“æœï¼Œæ˜¾ç„¶ä¸æ˜¯é¢„æœŸç»“æœã€‚åŒ…è£…å¯¹è±¡çš„ <code>[[PrimitiveValue]]</code> å±æ€§å¯é€šè¿‡ <code>valueOf()</code> æ–¹æ³•è·å–ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // è·å–æ•°æ®ç±»å‹ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const getClass = x =&gt; Object.prototype.toString.call(x)

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      case '[object Boolean]':
        return Object(Boolean.prototype.valueOf.call(obj))
      case '[object Number]':
        return Object(Number.prototype.valueOf.call(obj))
      case '[object String]':
        return Object(String.prototype.valueOf.call(obj))
      case '[object Symbol]':
        return Object(Symbol.prototype.valueOf.call(obj))
      case '[object BigInt]':
        return Object(BigInt.prototype.valueOf.call(obj))
      default:
        return undefined
    }
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // å¤„ç†åŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    // å…¶ä½™éƒ¨åˆ†æ²¡å˜ï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…ï¼Œçœç•¥ä¸€ä¸‡å­—...
  }

  return copy(source)
}
</code></pre>
<p>æˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç¬¦åˆé¢„æœŸç»“æœçš„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5a779a6b1676347c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>3.2 é’ˆå¯¹å‡½æ•°çš„å¤„ç†</h3>
<p>ç›´æ¥è¿”å›å°±å¥½äº†ï¼Œä¸€èˆ¬ä¸ç”¨å¤„ç†ã€‚åœ¨å®é™…åº”ç”¨åœºæ™¯éœ€è¦æ‹·è´å‡½æ•°å¤ªå°‘äº†...</p>
<pre><code class="language-js">const copy = input =&gt; {
  if (typeof input === 'function' || !isObject(input)) return input
}
</code></pre>
<h3>3.3 é’ˆå¯¹ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å¤„ç†</h3>
<p>ç”±äºä»¥ä¸Š <code>for...in</code> æ–¹æ³•æ— æ³•éå† <code>Symbol</code> çš„å±æ€§é”®ï¼Œå› æ­¤ï¼š</p>
<pre><code class="language-js">const sym = Symbol('desc')
const obj = {
  [sym]: 'This is symbol value'
}
console.log(deepCopy(obj)) // {}ï¼Œæ‹·è´ç»“æœæ²¡æœ‰ [sym] å±æ€§
</code></pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols()</a>
å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡è‡ªèº«çš„æ‰€æœ‰ Symbol å±æ€§çš„æ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾çš„å±æ€§ã€‚</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable">Object.prototype.propertyIsEnumerable()</a>
å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŒ‡å®šçš„å±æ€§æ˜¯å¦å¯æšä¸¾ã€‚</p>
</li>
</ul>
<pre><code class="language-js">const copy = input =&gt; {
  // å…¶å®ƒä¸å˜
  for (let key in input) {
    // ...
  }

  // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const symbolArr = Object.getOwnPropertySymbols(input)
  if (symbolArr.length) {
    for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
      if (input.propertyIsEnumerable(symbolArr[i])) {
        const value = input[symbolArr[i]]
        output[symbolArr[i]] = copy(value)
      }
    }
  }

  // ...
}
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬å¯¹ <code>source</code> å¯¹è±¡åšæ‹·è´æ“ä½œï¼š</p>
<pre><code class="language-js">const source = {}
const sym1 = Symbol('1')
const sym2 = Symbol('2')
Object.defineProperties(source,
  {
    [sym1]: {
      value: 'This is symbol value.',
      enumerable: true
    },
    [sym2]: {
      value: 'This is a non-enumerable property.',
      enumerable: false
    }
  }
)
</code></pre>
<p>æ‰“å°ç»“æœï¼Œä¹Ÿç¬¦åˆé¢„æœŸç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-17ed4f9fd1744951.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>3.4 é’ˆå¯¹ Date å¯¹è±¡çš„å¤„ç†</h3>
<p>å…¶å®ï¼Œå¤„ç† <code>Date</code> å¯¹è±¡ï¼Œè·Ÿä¸Šé¢æåˆ°çš„åŒ…è£…å¯¹è±¡çš„å¤„ç†æ˜¯å·®ä¸å¤šçš„ã€‚æš‚æ—¶å…ˆæ”¾åˆ° <code>isWrapperObject()</code> å’Œ <code>handleWrapperObject()</code> ä¸­å¤„ç†ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜...

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      // å…¶ä»– case ä¸å˜
      // ...
      case '[object Date]':
        return new Date(obj.valueOf()) // new Date(+obj)
      default:
        return undefined
    }
  }

  // å…¶ä»–ä¸å˜...
}
</code></pre>
<h3>3.5 é’ˆå¯¹  Mapã€Set å¯¹è±¡çš„å¤„ç†</h3>
<p>åŒæ ·çš„ï¼Œæš‚æ—¶å…ˆæ”¾åˆ° <code>isWrapperObject()</code> å’Œ <code>handleWrapperObject()</code> ä¸­å¤„ç†ã€‚</p>
<p>åˆ©ç”¨ Mapã€Set å¯¹è±¡çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols">Iterator</a> ç‰¹æ€§å’Œè‡ªèº«çš„æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿè§£å†³ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜...

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      // å…¶ä»– case ä¸å˜
      // ...
      case '[object Map]': {
        const map = new Map()
        obj.forEach((item, key) =&gt; {
          // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ key ä¸èƒ½æ·±æ‹·è´ï¼Œå¦åˆ™å°±ä¼šå¤±å»å¼•ç”¨äº†
          // å…·ä½“åŸå› å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œä¸éš¾ã€‚æƒ³ä¸æ˜ç™½å†è¯„è®ºåŒºå§
          map.set(key, copy(item))
        })
        return map
      }
      case '[object Set]': {
        const set = new Set()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // å…¶ä»–ä¸å˜...
}
</code></pre>
<p>æ‰“å°ä¸‹ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e419985b0e2a6f04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>3.6 é’ˆå¯¹å¾ªç¯å¼•ç”¨çš„é—®é¢˜</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼ˆcircular referenceï¼‰çš„å¯¹è±¡ï¼š</p>
<pre><code class="language-js">const foo = { name: 'Frankie' }
foo.bar = foo
</code></pre>
<p>ä¸Šé¢æåˆ° <code>JSON.stringify()</code> æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d8445e9dd56ce04c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“å¯¹å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å¤„ç†æ—¶ï¼Œä¼šæŠ›å‡ºç±»å‹é”™è¯¯ï¼š<code>Uncaught TypeError: Converting circular structure to JSON</code>ã€‚</p>
<p>æ¥ç€ï¼Œä½¿ç”¨è‡ªè¡Œå®ç°çš„ <code>deepCopy()</code> æ–¹æ³•ï¼Œçœ‹ä¸‹ç»“æœæ˜¯ä»€ä¹ˆï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6ef50a132b4f42c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨æ‹·è´å¾ªç¯å¼•ç”¨çš„ <code>foo</code> å¯¹è±¡æ—¶ï¼Œå‘ç”Ÿæ ˆæº¢å‡ºäº†ã€‚</p>
<blockquote>
<p>åœ¨å¦ä¸€ç¯‡<a href="https://www.jianshu.com/p/a07e746fd9db">æ–‡ç« </a>ï¼Œæˆ‘æåˆ°è¿‡ä½¿ç”¨ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fdouglascrockford%2FJSON-js">JSON-js</a> å¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå…·ä½“ç”¨æ³•æ˜¯ï¼Œå…ˆå¼•å…¥å…¶ä¸­çš„Â <code>cycle.js</code>Â è„šæœ¬ï¼Œç„¶åÂ <code>JSON.stringify(JSON.decycle(foo))</code>Â å°± OK äº†ã€‚ä½†ç©¶å…¶æ ¹æœ¬ï¼Œå®ƒä½¿ç”¨äº† <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a> å»å¤„ç†ã€‚</p>
</blockquote>
<p>é‚£æˆ‘ä»¬å»å®ç°ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const weakmap = new WeakMap()

  // ä¸­é—´è¿™å—ä¸å˜ï¼Œçœç•¥ä¸€ä¸‡å­—...

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆæœ¬æ¬¡æ–°å¢ï¼Œä»¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : {}

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
    const symbolArr = Object.getOwnPropertySymbols(input)
    if (symbolArr.length) {
      for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
        if (input.propertyIsEnumerable(symbolArr[i])) {
          output[symbolArr[i]] = input[symbolArr[i]]
        }
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>å…ˆçœ‹çœ‹æ‰“å°ç»“æœï¼Œä¸ä¼šåƒä¹‹å‰ä¸€æ ·æº¢å‡ºäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-abeca5a06a104739.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a> è€Œæ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a> çš„åŸå› ï¼š</p>
<p>é¦–å…ˆï¼ŒMap çš„é”®å±äºå¼ºå¼•ç”¨ï¼Œè€Œ WeakMap çš„é”®åˆ™å±äºå¼±å¼•ç”¨ã€‚ä¸” WeakMap çš„é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼ŒWeakMap çš„å€¼åˆ™æ˜¯ä»»æ„çš„ã€‚</p>
<p>ç”±äºå®ƒä»¬çš„é”®ä¸å€¼çš„å¼•ç”¨å…³ç³»ï¼Œå†³å®šäº† Map ä¸èƒ½ç¡®ä¿å…¶å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¼•ç”¨ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„ Mapï¼Œé‚£ä¹ˆå›¾ä¸­çš„ <code>foo</code> å¯¹è±¡å’Œæˆ‘ä»¬æ·±æ‹·è´å†…éƒ¨çš„ <code>const map = new Map()</code> åˆ›å»ºçš„ <code>map</code> å¯¹è±¡ä¸€ç›´éƒ½æ˜¯å¼ºå¼•ç”¨å…³ç³»ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºç»“æŸä¹‹å‰ï¼Œ<code>foo</code> ä¸ä¼šè¢«å›æ”¶ï¼Œå…¶å ç”¨çš„å†…å­˜ç©ºé—´ä¸€ç›´ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŸç”Ÿçš„ WeakMap æŒæœ‰çš„æ˜¯æ¯ä¸ªé”®å¯¹è±¡çš„â€œå¼±å¼•ç”¨â€ï¼Œè¿™æ„å‘³ç€åœ¨æ²¡æœ‰å…¶ä»–å¼•ç”¨å­˜åœ¨æ—¶åƒåœ¾å›æ”¶èƒ½æ­£ç¡®è¿›è¡Œã€‚åŸç”Ÿ WeakMap çš„ç»“æ„æ˜¯ç‰¹æ®Šä¸”æœ‰æ•ˆçš„ï¼Œå…¶ç”¨äºæ˜ å°„çš„ key åªæœ‰åœ¨å…¶æ²¡æœ‰è¢«å›æ”¶æ—¶æ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚</p>
<blockquote>
<p>å¯çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap#why_weakmap">Why WeakMap?</a></p>
</blockquote>
<p>æˆ‘ä»¬ç†ŸçŸ¥çš„ Lodash åº“çš„æ·±æ‹·è´æ–¹æ³•ï¼Œè‡ªå®ç°äº†ä¸€ä¸ªç±»ä¼¼ WeakMap ç‰¹æ€§çš„æ„é€ å‡½æ•°å»å¤„ç†å¾ªç¯å¼•ç”¨çš„ã€‚ï¼ˆ<a href="https://github.com/lodash/lodash/blob/master/.internal/baseClone.js#L199-L205">è¯¦çœ‹</a>ï¼‰</p>
<p>è¿™é‡Œæä¾›å¦ä¸€ä¸ªæ€è·¯ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸€æ ·ï¼Œçœç•¥ä¸€ä¸‡å­—...

  // åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå°†æ¯æ¬¡æ‹·è´çš„å¯¹è±¡æ”¾è¿›å»
  const copiedArr = []

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // å¾ªç¯éå†ï¼Œè‹¥æœ‰å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œåˆ™ç›´æ¥æ”¾å›ï¼Œä»¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜
    for (let i = 0, len = copiedArr.length; i &lt; len; i++) {
      if (input === copiedArr[i].key) return copiedArr[i].value
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : {}

    // è®°å½•æ¯ä¸€æ¬¡çš„å¯¹è±¡
    copiedArr.push({ key: input, value: output })

    // åé¢çš„æµç¨‹ä¸å˜...
  }

  return copy(source)
}
</code></pre>
<blockquote>
<p>æ­¤å‰å®ç°æœ‰ä¸ª bugï¼Œæ„Ÿè°¢è™¾è™¾ç±³æŒ‡å‡ºï¼Œç°å·²æ›´æ­£ã€‚</p>
</blockquote>
<p>è¯·åœ¨å®ç°æ·±æ‹·è´ä¹‹åæµ‹è¯•ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const foo = { name: 'Frankie' }
foo.bar = foo

const cloneObj = deepCopy(foo) // è‡ªå®ç°æ·±æ‹·è´
const lodashObj = _.cloneDeep(foo) // Lodash æ·±æ‹·è´

// æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜æ˜¯æ­£ç¡®çš„
console.log(lodashObj.bar === lodashObj) // true
console.log(lodashObj.bar === foo) // false
console.log(cloneObj.bar === cloneObj) // true
console.log(cloneObj.bar === foo) // false
</code></pre>
<h3>3.7 é’ˆå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†</h3>
<p>æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„å±æ€§ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/source">RegExp.prototype.source</a>
è¿”å›å½“å‰æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ¨¡å¼æ–‡æœ¬çš„å­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ ES6 æ–°å¢çš„å±æ€§ã€‚</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/flags">RegExp.prototype.flags</a>
è¿”å›å½“å‰æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡æ ‡å¿—ã€‚</li>
</ul>
<pre><code class="language-js">const { source, flags } = /\d/g
console.log(source) // &quot;\\d&quot;
console.log(flags) // &quot;g&quot;
</code></pre>
<p>æœ‰äº†ä»¥ä¸Šä¸¤ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>new RegExp(pattern, flags)</code> æ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼äº†ã€‚</p>
<pre><code class="language-js">const { source, flags } = /\d/g
const newRegex = new RegExp(source, flags) // /\d/g
</code></pre>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/lastIndex"><code>lastIndex</code></a> å±æ€§ï¼Œè¯¥å±æ€§å¯è¯»å¯å†™ï¼Œå…¶å€¼ä¸ºæ•´å‹ï¼Œç”¨æ¥æŒ‡å®šä¸‹ä¸€æ¬¡åŒ¹é…çš„èµ·å§‹ç´¢å¼•ã€‚åœ¨è®¾ç½®äº†Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/global"><code>global</code></a>Â æˆ–Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky"><code>sticky</code></a>Â æ ‡å¿—ä½çš„æƒ…å†µä¸‹ï¼ˆå¦‚Â <code>/foo/g</code>ã€<code>/foo/y</code>ï¼‰ï¼ŒJavaScriptÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp"><code>RegExp</code></a>Â å¯¹è±¡æ˜¯<strong>æœ‰çŠ¶æ€</strong>çš„ã€‚ä»–ä»¬ä¼šå°†ä¸Šæ¬¡æˆåŠŸåŒ¹é…åçš„ä½ç½®è®°å½•åœ¨Â <code>lastIndex</code>Â å±æ€§ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œä¸Šè¿°æ‹·è´æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æ˜¯æœ‰ç¼ºé™·çš„ã€‚çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const re1 = /foo*/g
const str = 'table football, foosball'
let arr

while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}

// ä»¥ä¸Šè¯­å¥ä¼šè¾“å‡ºï¼Œä»¥ä¸‹ç»“æœï¼š
// &quot;Found foo. Next starts at 9.&quot;
// &quot;Found foo. Next starts at 19.&quot;


// å½“æˆ‘ä»¬ä¿®æ”¹ re1 çš„ lastIndex å±æ€§æ—¶ï¼Œè¾“å‡ºä»¥ä¸‹ç»“æœï¼š
re1.lastIndex = 9
while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}
// &quot;Found foo. Next starts at 19.&quot;

// ä»¥ä¸Šè¿™äº›ç›¸ä¿¡ä½ ä»¬éƒ½éƒ½æ‡‚ã€‚
</code></pre>
<p>æ‰€ä»¥ï¼Œä½ å¯ä»¥å‘ç°ä»¥ä¸‹ç¤ºä¾‹ï¼Œæ‰“å°ç»“æœæ˜¯ä¸ä¸€è‡´çš„ï¼ŒåŸå› å°±æ˜¯ä½¿ç”¨ <code>RegExp</code> æ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œ<code>lastIndex</code> ä¼šé»˜è®¤è®¾ä¸º <code>0</code>ã€‚</p>
<pre><code class="language-js">const re1 = /foo*/g
const str = 'table football, foosball'
let arr

// ä¿®æ”¹ lastIndex å±æ€§
re1.lastIndex = 9

// åŸºäº re1 æ‹·è´ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼
const re2 = new RegExp(re1.source, re1.flags)

console.log('re1:')
while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}

console.log('re2:')
while ((arr = re2.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re2.lastIndex}.`)
}

// re1:
// expected output: &quot;Found foo. Next starts at 19.&quot;
// re2:
// expected output: &quot;Found foo. Next starts at 9.&quot;
// expected output: &quot;Found foo. Next starts at 19.&quot;
</code></pre>
<p>å› æ­¤ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜ï¼Œçœç•¥...

  // å¤„ç†æ­£åˆ™è¡¨è¾¾å¼
  const handleRegExp = regex =&gt; {
    const { source, flags, lastIndex } = regex
    const re = new RegExp(source, flags)
    re.lastIndex = lastIndex
    return re
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // æ­£åˆ™è¡¨è¾¾å¼
    if (getClass(input) === '[object RegExp]') {
      return handleRegExp(input)
    }

    // åé¢ä¸å˜ï¼Œçœç•¥...
  }

  return copy(source)
}
</code></pre>
<p>æ‰“å°ç»“æœä¹Ÿæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-86b589529c2c4222.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç”±äº <code>RegExp.prototype.flags</code> æ˜¯ ES6 æ–°å¢å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ ES5 æ˜¯å¦‚ä½•å®ç°çš„ï¼ˆæºè‡ª Lodashï¼‰ï¼š</p>
<pre><code class="language-js">/** Used to match `RegExp` flags from their coerced string values. */
var reFlags = /\w*$/;

/**
 * Creates a clone of `regexp`.
 *
 * @private
 * @param {Object} regexp The regexp to clone.
 * @returns {Object} Returns the cloned regexp.
 */
function cloneRegExp(regexp) {
  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
  result.lastIndex = regexp.lastIndex;
  return result;
}
</code></pre>
<p>ä½†è¿˜æ˜¯é‚£å¥è¯ï¼Œéƒ½ 2021 å¹´äº†ï¼Œå…¼å®¹ ES5 çš„é—®é¢˜å°±æ”¾å¿ƒäº¤ç»™ Babel å§ã€‚</p>
<h3>3.8 å¤„ç†åŸå‹</h3>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œåªå®ç°ç±»å‹ä¸º <code>&quot;[object Object]&quot;</code> çš„å¯¹è±¡çš„åŸå‹æ‹·è´ã€‚ä¾‹å¦‚æ•°ç»„ç­‰ä¸å¤„ç†ï¼Œå› ä¸ºè¿™äº›æƒ…å†µå®é™…åœºæ™¯å¤ªå°‘äº†ã€‚</p>
</blockquote>
<p>ä¸»è¦æ˜¯ä¿®æ”¹ä»¥ä¸‹è¿™ä¸€æ­¥éª¤ï¼š</p>
<pre><code class="language-js">const output = isArray(input) ? [] : {}
</code></pre>
<p>ä¸»è¦åˆ©ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create"><code>Object.create()</code></a> æ¥åˆ›å»º <code>output</code> å¯¹è±¡ï¼Œæ”¹æˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">const initCloneObject = obj =&gt; {
  // å¤„ç†åŸºäº Object.create(null) æˆ– Object.create(Object.prototype.__proto__) çš„å®ä¾‹å¯¹è±¡
  // å…¶ä¸­ Object.prototype.__proto__ å°±æ˜¯ç«™åœ¨åŸå‹é¡¶ç«¯çš„ç”·äºº
  // ä½†æˆ‘ç•™æ„åˆ° Lodash åº“çš„ clone æ–¹æ³•å¯¹ä»¥ä¸Šä¸¤ç§æƒ…å†µæ˜¯ä¸å¤„ç†çš„
  if (obj.constructor === undefined) {
    return Object.create(null)
  }

  // å¤„ç†è‡ªå®šä¹‰æ„é€ å‡½æ•°çš„å®ä¾‹å¯¹è±¡
  if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
    const proto = Object.getPrototypeOf(obj)
    return Object.create(proto)
  }

  return {}
}

const output = isArray(input) ? [] : initCloneObject(input)
</code></pre>
<p>æ¥çœ‹ä¸‹æ‰“å°ç»“æœï¼Œå¯ä»¥çœ‹åˆ° <code>source</code> çš„åŸå‹å¯¹è±¡å·²ç»æ‹·è´è¿‡æ¥äº†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4734d18bf71b9eba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å†æ¥çœ‹ä¸‹ <code>Object.create(null)</code> çš„æƒ…å†µï¼Œä¹Ÿæ˜¯é¢„æœŸç»“æœã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-22809d763baeb9e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Lodash çš„ <code>_.cloneDeep(Object.create(null))</code> æ·±æ‹·è´æ–¹æ³•å¹¶æ²¡æœ‰å¤„ç†è¿™ç§æƒ…å†µã€‚å½“ç„¶äº†ï¼Œè¦æ‹·è´è¿™ç§æ•°æ®ç»“æ„åœ¨å®é™…åº”ç”¨åœºæ™¯ï¼ŒçœŸçš„å°‘ä¹‹åˆå°‘...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ec6032b7655ee73e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å…³äº Lodash æ‹·è´æ–¹æ³•ä¸ºä»€ä¹ˆä¸å®ç°è¿™ç§æƒ…å†µï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªç›¸å…³çš„ <a href="https://github.com/lodash/lodash/issues/588">Issue #588</a>ï¼š</p>
<p>A shallow clone won't do that as it's just <code>_.assign({}, object)</code> and a deep clone is loosely based on the structured cloning algorithm and doesn't attempt to clone inheritance or lack thereof.</p>
</blockquote>
<h2>å››ã€ä¼˜åŒ–</h2>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå®Œæ•´ä½†<strong>æœªä¼˜åŒ–</strong>çš„æ·±æ‹·è´æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡
  const weakmap = new WeakMap()

  // è·å–æ•°æ®ç±»å‹
  const getClass = x =&gt; Object.prototype.toString.call(x)

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      case '[object Boolean]':
        return Object(Boolean.prototype.valueOf.call(obj))
      case '[object Number]':
        return Object(Number.prototype.valueOf.call(obj))
      case '[object String]':
        return Object(String.prototype.valueOf.call(obj))
      case '[object Symbol]':
        return Object(Symbol.prototype.valueOf.call(obj))
      case '[object BigInt]':
        return Object(BigInt.prototype.valueOf.call(obj))
      case '[object Date]':
        return new Date(obj.valueOf()) // new Date(+obj)
      case '[object Map]': {
        const map = new Map()
        obj.forEach((item, key) =&gt; {
          map.set(key, copy(item))
        })
        return map
      }
      case '[object Set]': {
        const set = new Set()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // å¤„ç†æ­£åˆ™è¡¨è¾¾å¼
  const handleRegExp = regex =&gt; {
    const { source, flags, lastIndex } = regex
    const re = new RegExp(source, flags)
    re.lastIndex = lastIndex
    return re
  }

  const initCloneObject = obj =&gt; {
    if (obj.constructor === undefined) {
      return Object.create(null)
    }

    if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
      const proto = Object.getPrototypeOf(obj)
      return Object.create(proto)
    }

    return {}
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // æ­£åˆ™è¡¨è¾¾å¼
    if (getClass(input) === '[object RegExp]') {
      return handleRegExp(input)
    }

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : initCloneObject(input)

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
    const symbolArr = Object.getOwnPropertySymbols(input)
    if (symbolArr.length) {
      for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
        if (input.propertyIsEnumerable(symbolArr[i])) {
          const value = input[symbolArr[i]]
          output[symbolArr[i]] = copy(value)
        }
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¼˜åŒ–å·¥ä½œäº†...</p>
<h3>4.1 ä¼˜åŒ–ä¸€</h3>
<p>æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨åˆ°äº† <code>for...in</code> å’Œ <code>Object.getOwnPropertySymbols()</code> æ–¹æ³•å»éå†å¯¹è±¡çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰ï¼Œè¿˜æ¶‰åŠäº†å¯æšä¸¾å±æ€§å’Œä¸å¯æšä¸¾å±æ€§ã€‚</p>
<ul>
<li><a href=""><strong>for...in</strong></a>ï¼šéå†<strong>è‡ªèº«</strong>å’Œ<strong>ç»§æ‰¿è¿‡æ¥</strong>çš„<strong>å¯æšä¸¾</strong>å±æ€§ï¼ˆä¸åŒ…æ‹¬ Symbol å±æ€§ï¼‰ã€‚</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys"><strong>Object.keys</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>æ‰€æœ‰<strong>å¯æšä¸¾</strong>å±æ€§ï¼ˆä¸åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames"><strong>Object.getOwnPropertyNames</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>çš„å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼Œä½†ä¸åŒ…æ‹¬ Symbol å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols"><strong>Object.getOwnPropertySymbols</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>çš„æ‰€æœ‰ Symbol å±æ€§ï¼ˆåŒ…æ‹¬å¯æšä¸¾å’Œä¸å¯æšä¸¾å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys"><strong>Reflect.ownKeys</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>è‡ªèº«æ‰€æœ‰</strong>çš„å±æ€§ï¼ˆåŒ…æ‹¬ Symbol å±æ€§ï¼Œä¸å¯æšä¸¾å±æ€§ä»¥åŠå¯æšä¸¾å±æ€§ï¼‰</li>
</ul>
<blockquote>
<p>ç”±äºæˆ‘ä»¬ä»…æ‹·è´å¯æšä¸¾çš„å­—ç¬¦ä¸²å±æ€§å’Œå¯æšä¸¾çš„ Symbol å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å°† <code>Reflect.ownKeys()</code> å’Œ <code>Object.prototype.propertyIsEnumerable()</code> ç»“åˆä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†ä»¥ä¸‹è¿™éƒ¨åˆ†ï¼š</p>
<pre><code class="language-js">for (let key in input) {
  if (input.hasOwnProperty(key)) {
    const value = input[key]
    output[key] = copy(value)
  }
}

// å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
const symbolArr = Object.getOwnPropertySymbols(input)
if (symbolArr.length) {
  for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
    if (input.propertyIsEnumerable(symbolArr[i])) {
      const value = input[symbolArr[i]]
      output[symbolArr[i]] = copy(value)
    }
  }
}
</code></pre>
<p>ä¼˜åŒ–æˆï¼š</p>
<pre><code class="language-js">// ä»…éå†å¯¹è±¡è‡ªèº«å¯æšä¸¾çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰
Reflect.ownKeys(input).forEach(key =&gt; {
  if (input.propertyIsEnumerable(key)) {
    output[key] = copy(input[key])
  }
})
</code></pre>
<h3>4.2 ä¼˜åŒ–äºŒ</h3>
<p>ä¼˜åŒ– <code>getClass()</code>ã€<code>isWrapperObject()</code>ã€<code>handleWrapperObject()</code>ã€<code>handleRegExp()</code> åŠå…¶ç›¸å…³çš„ç±»å‹åˆ¤æ–­æ–¹æ³•ã€‚</p>
<p>ç”±äº <code>handleWrapperObject()</code> åŸæ„æ˜¯å¤„ç†åŒ…è£…å¯¹è±¡ï¼Œä½†æ˜¯éšç€åé¢è¦å¤„ç†çš„ç‰¹æ®Šå¯¹è±¡è¶Šæ¥è¶Šå¤šï¼Œä¸ºäº†å‡å°‘æ–‡ç« ç¯‡å¹…ï¼Œæš‚æ—¶éƒ½å†™åœ¨é‡Œé¢äº†ï¼Œç¨å¾®æœ‰ç‚¹ä¹±ã€‚</p>
<p>å› æ­¤ä¸‹é¢æˆ‘ä»¬æ¥æ•´åˆä¸€ä¸‹ï¼Œéƒ¨åˆ†å¤„ç†å‡½æ•°å¯èƒ½ä¼šä¿®æ”¹å‡½æ•°åã€‚</p>
<h2>äº”ã€æœ€å</h2>
<p>å…¶å®ï¼Œä¸Šé¢æåˆ°çš„ä¸€äº›è¾¹ç•Œ Caseã€æˆ–è€…å…¶ä»–ä¸€äº›ç‰¹æ®Šå¯¹è±¡ï¼ˆå¦‚ <code>ArrayBuffer</code> ç­‰ï¼‰ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¤„ç†ï¼Œä½†æˆ‘è®¤ä¸ºè¯¥å®Œç»“äº†ï¼Œå› ä¸ºè¿™äº›åœ¨å®é™…åº”ç”¨åœºæ™¯çœŸçš„å¤ªå°‘äº†ã€‚</p>
<p>ä»£ç å·²ä¸¢åˆ° GitHub ğŸ‘‰ <a href="https://github.com/toFrankie/Some-JavaScript-File">toFrankie/Some-JavaScript-File</a>ã€‚</p>
<p>è¿˜æ˜¯é‚£å¥è¯ï¼š</p>
<blockquote>
<p><strong>å¦‚æœç”Ÿäº§ç¯å¢ƒä½¿ç”¨ <code>JSON.stringify()</code> æ— æ³•è§£å†³ä½ çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨ <a href="https://www.lodashjs.com/">Lodash</a> åº“çš„ <a href="https://www.lodashjs.com/docs/lodash.cloneDeep"><code>_.cloneDeep()</code></a> æ–¹æ³•ï¼Œé‚£ä¸ªæ‰å«é¢é¢ä¿±åˆ°ã€‚åƒä¸‡åˆ«ç”¨æˆ‘è¿™æ–¹æ³•ï¼Œåˆ‡è®°ï¼</strong></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦é¢å‘å­¦ä¹ ã€é¢è¯•ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ï¼Œæˆ–è®¸ä¹Ÿå¯ä»¥å¸®åŠ©ä½ ç†Ÿæ‚‰ä¸€äº›å¯¹è±¡çš„ç‰¹æ€§ã€‚å¦‚æœ‰ä¸è¶³ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œä¸‡åˆ†æ„Ÿè°¢ ğŸ‘‹ ~</p>
<p>ç»ˆäºç»ˆäºç»ˆäº......è¦å†™å®Œäº†ï¼Œåäº†ä¸‰æ–¤è¡€...</p>
<p>æœ€ç»ˆç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡
  const weakmap = new WeakMap()

  // è·å–æ•°æ®ç±»å‹ï¼Œè¿”å›å€¼å¦‚ï¼š&quot;Object&quot;ã€&quot;Array&quot;ã€&quot;Symbol&quot; ç­‰
  const getClass = x =&gt; {
    const type = Object.prototype.toString.call(x)
    return /^\[object (.*)\]$/.exec(type)[1]
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === 'Array'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºâ€œç‰¹æ®Šâ€å¯¹è±¡ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰
  const isSepcialObject = obj =&gt; {
    const type = getClass(obj)
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set', 'RegExp'].includes(type)
  }

  // å¤„ç†ç‰¹æ®Šå¯¹è±¡
  const handleSepcialObject = obj =&gt; {
    const type = getClass(obj)
    const Ctor = obj.constructor // å¯¹è±¡çš„æ„é€ å‡½æ•°
    const primitiveValue = obj.valueOf() // è·å–å¯¹è±¡çš„åŸå§‹å€¼

    switch (type) {
      case 'Boolean':
      case 'Number':
      case 'String':
      case 'Symbol':
      case 'BigInt':
        // å¤„ç†åŒ…è£…å¯¹è±¡ Wrapper Object
        return Object(primitiveValue)
      case 'Date':
        return new Ctor(primitiveValue) // new Date(+obj)
      case 'RegExp': {
        const { source, flags, lastIndex } = obj
        const re = new RegExp(source, flags)
        re.lastIndex = lastIndex
        return re
      }
      case 'Map': {
        const map = new Ctor()
        obj.forEach((item, key) =&gt; {
          // æ³¨æ„ï¼Œå³ä½¿ Map å¯¹è±¡çš„ key ä¸ºå¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œä¹Ÿä¸èƒ½ copy(key)ï¼Œå¦åˆ™ä¼šå¤±å»å¼•ç”¨ï¼Œå¯¼è‡´è¯¥å±æ€§æ— æ³•è®¿é—®å¾—åˆ°ã€‚
          map.set(key, copy(item))
        })
        return map
      }
      case 'Set': {
        const set = new Ctor()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // åˆ›å»ºè¾“å‡ºå¯¹è±¡ï¼ˆåŸå‹æ‹·è´å…³é”®å°±åœ¨è¿™ä¸€æ­¥ï¼‰
  const initCloneObject = obj =&gt; {
    if (obj.constructor === undefined) {
      return Object.create(null)
    }

    if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
      const proto = Object.getPrototypeOf(obj)
      return Object.create(proto)
    }

    return {}
  }

  // æ‹·è´æ–¹æ³•ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isSepcialObject(input)) {
      return handleSepcialObject(input)
    }

    // åˆ›å»ºè¾“å‡ºå¯¹è±¡
    const output = isArray(input) ? [] : initCloneObject(input)

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    // ä»…éå†å¯¹è±¡è‡ªèº«å¯æšä¸¾çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰
    Reflect.ownKeys(input).forEach(key =&gt; {
      if (input.propertyIsEnumerable(key)) {
        output[key] = copy(input[key])
      }
    })

    return output
  }

  return copy(source)
}
</code></pre>
<h2>å…­ã€References</h2>
<ul>
<li><a href="https://github.com/lodash/lodash/blob/2f79053d7bc7c9c9561a30dda202b3dcd2b72b90/cloneDeep.js">Lodash</a></li>
<li><a href="https://juejin.cn/post/6844903986479251464">åŸç”Ÿ JS çµé­‚ä¹‹é—®(ä¸­)ï¼Œæ£€éªŒè‡ªå·±æ˜¯å¦çœŸçš„ç†Ÿæ‚‰ JavaScriptï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æµè§ˆå™¨å†…æ ¸åŠæ¸²æŸ“è¿‡ç¨‹æ‚è°ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/245</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/245</guid>
            <pubDate>Sun, 26 Feb 2023 11:26:16 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c29a78f12c9af258.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c29a78f12c9af258.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç½‘é¡µä¾èµ–äºæµè§ˆå™¨è¿™ä¸ªå®¿ä¸»ç¯å¢ƒï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•æ¸²æŸ“ï¼Œæ€æ ·æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å‘¢ï¼Ÿ</p>
<h3>ä¸€ã€æµè§ˆå™¨å†…æ ¸</h3>
<p>æµè§ˆå™¨ä¸»è¦ç”±ç”¨æˆ·ç•Œé¢ã€æµè§ˆå™¨å†…æ ¸ã€æ•°æ®å­˜å‚¨ã€ç½‘ç»œç­‰ç»„æˆã€‚è€Œæµè§ˆå™¨å†…æ ¸åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>æ¸²æŸ“å¼•æ“</strong>ï¼ˆRendering Engineï¼‰å’Œ <strong>JS å¼•æ“</strong>ï¼ˆJavaScript Engineï¼‰ã€‚</p>
<p>æ¸²æŸ“å¼•æ“å¸¸è¢«ç§°ä¸ºâ€œæµè§ˆå™¨å†…æ ¸â€ï¼Œä¸»è¦åŠŸèƒ½æ˜¯è§£æ HTMLã€CSS è¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œæ¸²æŸ“å¼•æ“å†³å®šäº†æµè§ˆå™¨å¦‚ä½•æ˜¾ç¤ºç½‘é¡µçš„å†…å®¹ä»¥åŠé¡µé¢çš„æ ¼å¼ä¿¡æ¯ã€‚æ¸²æŸ“å¼•æ“ä¹Ÿè¢«ç§°ä¸ºæ’ç‰ˆå¼•æ“ï¼ˆLayout Engineï¼‰ã€æµè§ˆå™¨å¼•æ“ï¼ˆBrowser Engineï¼‰ã€‚è€Œ JS å¼•æ“è´Ÿè´£ JavaScript è„šæœ¬çš„è§£æã€ç¼–è¯‘å’Œæ‰§è¡Œã€‚</p>
<p>æ—©æœŸå†…æ ¸çš„æ¦‚å¿µå¹¶æ²¡æœ‰æ˜ç¡®åŒºåˆ†æ¸²æŸ“å¼•æ“å’Œ JS å¼•æ“ï¼Œç°åœ¨ JS å¼•æ“å·²ç»ç‹¬ç«‹å‡ºæ¥ï¼Œè€Œæˆ‘ä»¬å¸¸è¯´çš„æµè§ˆå™¨å†…æ ¸é€šå¸¸æŒ‡çš„æ˜¯æ¸²æŸ“å¼•æ“ã€‚æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯ ECMAScript æ ‡å‡†çš„ä¸€ç§å®ç°ï¼ŒJavaScript åœ¨æµè§ˆå™¨ç«¯å®ç°è¿˜å¿…é¡»åŒ…æ‹¬ DOM å’Œ BOMã€‚</p>
<h4>1.1 æµè§ˆå™¨å†…æ ¸</h4>
<p>ä¸‹é¢åˆ—ä¸¾ä¸€äº›å¸¸è§çš„<a href="https://www.wikiwand.com/en/Browser_engine">æµè§ˆå™¨å¼•æ“</a>ï¼š</p>
<ul>
<li>
<p>Chromeï¼šæ—©æœŸä½¿ç”¨ <a href="https://www.wikiwand.com/zh-hans/WebKit">WebKit</a> å¼•æ“ï¼Œè‡ª 2013 å¹´èµ·ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Blink">Blink</a> å¼•æ“ã€‚Blink æ´¾ç”Ÿè‡ª WebKit çš„ä¸€ä¸ªåˆ†æ”¯ã€‚æ³¨æ„ï¼šiOS ç‰ˆæœ¬çš„ Chrome ä½¿ç”¨äº† iOS å¹³å°çš„æ¸²æŸ“å¼•æ“ï¼Œè€Œé Blinkã€‚</p>
</li>
<li>
<p>FireFoxï¼šä½¿ç”¨ <a href="https://www.wikiwand.com/zh-hans/Gecko">Gecko</a> å†…æ ¸ã€‚</p>
</li>
<li>
<p>Operaï¼šæ—©æœŸé‡‡ç”¨ <a href="https://www.wikiwand.com/zh-hans/Elektra">Elektra</a>ã€<a href="https://www.wikiwand.com/zh-hans/Presto">Presto</a> å¼•æ“ï¼Œè‡ª 2013 å¹´èµ·ä½¿ç”¨ Blink å¼•æ“ã€‚</p>
</li>
<li>
<p>Safariï¼šé‡‡ç”¨ <a href="https://www.wikiwand.com/zh-hans/WebKit">WebKit</a> å¼•æ“ã€‚WebKit æ—©æœŸæºè‡ª <a href="https://www.wikiwand.com/zh-hans/KHTML">KHTML</a> å¼•æ“ã€‚</p>
</li>
<li>
<p>IEï¼šé‡‡ç”¨ <a href="https://www.wikiwand.com/zh-hans/Trident_(%E6%8E%92%E7%89%88%E5%BC%95%E6%93%8E)">Trident</a> å¼•æ“ï¼Œåˆç§°ä¸º MSHTMLã€‚</p>
</li>
<li>
<p>Edgeï¼šè‡ª 2015 å¹´ 1 æœˆ 25 æ—¥å‘å¸ƒ Microsoft Edge æµè§ˆå™¨ï¼Œå…¶å†…æ ¸ä½¿ç”¨ <a href="https://www.wikiwand.com/zh-hans/EdgeHTML">EdgeHTML</a> å¼•æ“ï¼ˆEdgeHTML æ˜¯ Trident çš„ä¸€ä¸ªåˆ†æ”¯ï¼‰ã€‚ä» 2020 å¹´ 1 æœˆ 15 æ—¥å‘å¸ƒåŸºäº <a href="https://www.wikiwand.com/zh-hans/Chromium">Chromium</a> çš„ Edge æµè§ˆå™¨ï¼Œä½¿ç”¨ Blink å¼•æ“ã€‚</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-16f231393a6c546e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Timeline"></p>
<blockquote>
<p>è‹¹æœè¦æ±‚å…¶å¹³å°ä¸‹æµè§ˆå™¨å¿…é¡»ä½¿ç”¨ WebKit æ¸²æŸ“å¼•æ“ï¼Œæ‰€ä»¥ä¸€äº›æµè§ˆå™¨åœ¨ä¸åŒå¹³å°ï¼Œå…¶å†…æ ¸æ˜¯ä¸ä¸€æ ·çš„ã€‚ï¼ˆæŸ¥çœ‹å½“å‰æµè§ˆå™¨å†…æ ¸ï¼š<a href="https://ie.icoa.cn/">æµè§ˆå™¨å†…æ ¸ç‰ˆæœ¬æ£€æµ‹</a>ï¼‰ã€‚</p>
</blockquote>
<h5>1.2 JS å¼•æ“</h5>
<p>ä¸€äº›å¸¸è§çš„ <a href="https://www.wikiwand.com/en/Chakra_(JavaScript_engine)">JS å¼•æ“</a>ï¼š</p>
<ul>
<li>
<p>Chromeï¼šé‡‡ç”¨ <a href="https://www.wikiwand.com/en/V8_(JavaScript_engine)">V8</a> å¼•æ“ã€‚V8 å¼•æ“é™¤äº†åœ¨ Google Chromeã€åŸºäº Chromium çš„æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œä¹Ÿè¢«ä½¿ç”¨äºæœåŠ¡ç«¯ï¼Œå¦‚ <a href="https://nodejs.org/en/">Node.js</a> ç­‰ã€‚</p>
</li>
<li>
<p>FireFoxï¼šå„ç‰ˆæœ¬æ‰€é‡‡ç”¨å¼•æ“çš„æƒ…å†µï¼š<a href="https://www.wikiwand.com/zh-hans/SpiderMonkey">SpiderMonkey</a>ï¼ˆ1.0 ~ 3.0ï¼‰ã€TraceMonkeyï¼ˆ3.5 ~ 3.6ï¼‰ã€JÃ¤gerMonkeyï¼ˆ4.0 ~ï¼‰ã€‚</p>
</li>
<li>
<p>Operaï¼šå„ç‰ˆæœ¬æ‰€é‡‡ç”¨å¼•æ“çš„æƒ…å†µï¼šOpera Linear Aï¼ˆ4.0 ~ 6.1ï¼‰ã€Linear Bï¼ˆ7.0 ~ 9.2ï¼‰ã€Futharkï¼ˆ9.5 ~ 10.2ï¼‰ã€<a href="https://www.wikiwand.com/en/Presto_(browser_engine)">Carakan</a>ï¼ˆ10.5 ~ï¼‰</p>
</li>
<li>
<p>Safariï¼šé‡‡ç”¨ <a href="https://www.wikiwand.com/zh/WebKit#/JavaScriptCore">JavaScriptCore</a> å¼•æ“ã€‚</p>
</li>
<li>
<p>IEï¼šåœ¨ IE3 ~ IE8 é‡‡ç”¨ <a href="https://www.wikiwand.com/zh-hans/JScript">JScript</a> å¼•æ“ï¼ŒIE9 ~ IE11 ä½¿ç”¨ <a href="https://www.wikiwand.com/zh-hans/Chakra_(JScript%E5%BC%95%E6%93%8E)">Chakra</a> å¼•æ“ã€‚</p>
</li>
<li>
<p>Edgeï¼šé‡‡ç”¨ <a href="https://www.wikiwand.com/en/Chakra_(JavaScript_engine)">Chakra</a> å¼•æ“ï¼Œè€ŒåŸºäº Chromium çš„ Edge æµè§ˆå™¨åˆ™ä½¿ç”¨ V8 å¼•æ“ã€‚</p>
</li>
</ul>
<h5>1.3 æµè§ˆå™¨å¼•æ“å‰ç¼€</h5>
<p>æµè§ˆå™¨å‚å•†ä»¬æœ‰æ—¶ä¼šç»™å®éªŒæ€§çš„æˆ–è€…éæ ‡å‡†çš„ CSS å±æ€§å’Œ JavaScript API æ·»åŠ å‰ç¼€ï¼Œè¿™æ ·å¼€å‘è€…å°±å¯ä»¥ç”¨è¿™äº›æ–°çš„ç‰¹æ€§è¿›è¡Œè¯•éªŒã€‚</p>
<p>CSS å‰ç¼€ï¼š</p>
<ul>
<li><code>-webkit-</code>ï¼ˆChromeã€Safariã€æ–°ç‰ˆ Opera æµè§ˆå™¨ï¼Œä»¥åŠå‡ ä¹æ‰€æœ‰ iOS ç³»ç»Ÿä¸­çš„æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ iOS ç³»ç»Ÿä¸­çš„ç«ç‹æµè§ˆå™¨ï¼‰ï¼›åŸºæœ¬ä¸Šæ‰€æœ‰åŸºäº WebKit å†…æ ¸çš„æµè§ˆå™¨ï¼‰ã€‚</li>
<li><code>-moz-</code>ï¼ˆFirefox æµè§ˆå™¨ï¼‰</li>
<li><code>-o-</code>ï¼ˆæ—§ç‰ˆ Opera æµè§ˆå™¨ï¼‰</li>
<li><code>-ms-</code>ï¼ˆIE æµè§ˆå™¨å’Œ æ—§ç‰ˆ Edge æµè§ˆå™¨ï¼‰</li>
</ul>
<pre><code class="language-css">div {
  -webkit-transition: all 4s ease;
  -moz-transition: all 4s ease;
  -ms-transition: all 4s ease;
  -o-transition: all 4s ease;
  transition: all 4s ease;
}
</code></pre>
<p>API å‰ç¼€ï¼š</p>
<p>æ¥å£å‰ç¼€ï¼Œéœ€è¦å¤§å†™çš„å‰ç¼€ä¿®é¥°æ¥å£åï¼š</p>
<ul>
<li><code>WebKit</code>ï¼ˆChromeã€Safariã€æ–°ç‰ˆ Opera æµè§ˆå™¨ï¼Œä»¥åŠå‡ ä¹æ‰€æœ‰ iOS ç³»ç»Ÿä¸­çš„æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ iOS ç³»ç»Ÿä¸­çš„ç«ç‹æµè§ˆå™¨ï¼‰ï¼›åŸºæœ¬ä¸Šæ‰€æœ‰åŸºäº WebKit å†…æ ¸çš„æµè§ˆå™¨ï¼‰ã€‚</li>
<li><code>MOZ</code>ï¼ˆFirefox æµè§ˆå™¨ï¼‰</li>
<li><code>O</code>ï¼ˆæ—§ç‰ˆ Opera æµè§ˆå™¨ï¼‰</li>
<li><code>MS</code>ï¼ˆIE æµè§ˆå™¨å’Œ æ—§ç‰ˆ Edge æµè§ˆå™¨ï¼‰</li>
</ul>
<p>å±æ€§å’Œæ–¹æ³•å‰ç¼€ï¼Œéœ€è¦ä½¿ç”¨å°å†™çš„å‰ç¼€ä¿®é¥°å±æ€§æˆ–è€…æ–¹æ³•ï¼š</p>
<ul>
<li><code>webkit</code>ï¼ˆChromeã€Safariã€æ–°ç‰ˆ Opera æµè§ˆå™¨ï¼Œä»¥åŠå‡ ä¹æ‰€æœ‰ iOS ç³»ç»Ÿä¸­çš„æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ iOS ç³»ç»Ÿä¸­çš„ç«ç‹æµè§ˆå™¨ï¼‰ï¼›åŸºæœ¬ä¸Šæ‰€æœ‰åŸºäº WebKit å†…æ ¸çš„æµè§ˆå™¨ï¼‰ã€‚</li>
<li><code>moz</code>ï¼ˆFirefox æµè§ˆå™¨ï¼‰</li>
<li><code>o</code>ï¼ˆæ—§ç‰ˆ Opera æµè§ˆå™¨ï¼‰</li>
<li><code>ms</code>ï¼ˆIE æµè§ˆå™¨å’Œ æ—§ç‰ˆ Edge æµè§ˆå™¨ï¼‰</li>
</ul>
<pre><code class="language-js">const requestAnimationFrame = window.requestAnimationFrame ||
                              window.mozRequestAnimationFrame ||
                              window.webkitRequestAnimationFrame ||
                              window.oRequestAnimationFrame ||
                              window.msRequestAnimationFrame
</code></pre>
<h3>äºŒã€ç½‘é¡µç”Ÿæˆè¿‡ç¨‹</h3>
<p>é¦–å…ˆï¼Œæ¸²æŸ“å¼•æ“ä»ç½‘ç»œå±‚è¯·æ±‚åˆ° HTML æ–‡æ¡£ï¼Œç„¶åè¿›è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„åŸºæœ¬æµç¨‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5a3b04ea9e4f4413.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Rendering Engine Basic Flow"></p>
<p>ä»¥ WebKit ä¸ºä¾‹ï¼Œä¸»æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-dd2f0bbc5617944f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WebKit Main Flow"></p>
<blockquote>
<p>è‡³äº Mozilla çš„ Geckoï¼Œæ•´ä½“æµç¨‹è·Ÿ WebKit åŸºæœ¬ç›¸åŒï¼Œæœ¯è¯­ç¨æœ‰ä¸åŒã€‚ä¾‹å¦‚ WebKit çš„ <code>Layout</code>ï¼ˆå¸ƒå±€ï¼‰ï¼Œåœ¨ Gecko ä¸Šç§°ä¸º <code>Reflow</code>ï¼ˆé‡æ’ï¼‰ã€‚ç”±äºæœ¬æ–‡å¹¶éä¸¤è€…çš„å·®å¼‚ï¼Œå› æ­¤ä¸å±•å¼€èµ˜è¿°ï¼Œè¯¦æƒ…çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Introduction_to_Layout_in_Mozilla">Introduction to Layout in Mozilla
Overview</a>ã€‚</p>
</blockquote>
<p>å¤§è‡´è¿‡ç¨‹ï¼š</p>
<ol>
<li>æ¸²æŸ“å¼•æ“å¼€å§‹è§£æ HTML æ–‡æ¡£ï¼Œæ„å»ºå‡º <code>DOM Tree</code>ã€‚</li>
<li>åŒæ—¶è§£æå¤–éƒ¨ CSS æ–‡ä»¶ä»¥åŠæ ·å¼å…ƒç´ ä¸­çš„æ ·å¼æ•°æ®ï¼Œæ„å»ºå‡º <code>CSSOM Tree</code>ï¼Œå³ä¸Šå›¾çš„ Style Rulesã€‚</li>
<li>ç»“åˆ <code>DOM Tree</code> å’Œ <code>CSSOM Tree</code>ï¼Œç”Ÿæˆä¸€ä¸ª <code>Render Tree</code>ï¼ˆæ¸²æŸ“æ ‘ï¼‰ã€‚</li>
<li>æ¥ç€è¿›å…¥ <code>Layout</code> ï¼ˆå¸ƒå±€ï¼‰å¤„ç†é˜¶æ®µï¼Œå³å°† <code>Render Tree</code> çš„æ‰€æœ‰èŠ‚ç‚¹åˆ†é…ä¸€ä¸ªåº”å‡ºç°åœ¨å±å¹•ä¸Šçš„ç¡®åˆ‡åæ ‡ã€‚</li>
<li>ä¸‹ä¸€ä¸ªæ˜¯ <code>Painting</code> ï¼ˆç»˜åˆ¶ï¼‰é˜¶æ®µï¼Œæ¸²æŸ“å¼•æ“ä¼šéå† <code>Render Tree</code> å°†æ¯ä¸ªèŠ‚ç‚¹ç»˜åˆ¶å‡ºæ¥ã€‚</li>
</ol>
<p>éœ€è¦ç€é‡æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ã€‚ä¸ºäº†è¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ¸²æŸ“å¼•æ“ä¼šåŠ›æ±‚å°½å¿«å°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒä¸å¿…ç­‰åˆ°æ•´ä¸ª HTML æ–‡æ¡£è§£æå®Œæ¯•ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ„å»º Render Tree å’Œè®¾ç½® Layoutã€‚åœ¨ä¸æ–­æ¥æ”¶å’Œå¤„ç†æ¥è‡ªç½‘ç»œçš„å…¶ä½™å†…å®¹çš„åŒæ—¶ï¼Œæ¸²æŸ“å¼•æ“ä¼šå°†éƒ¨åˆ†å†…å®¹è§£æå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<blockquote>
<p>å…¶ä¸­ <code>DOM</code> æ˜¯ Document Object Model çš„ç®€å†™ï¼Œè€Œ <code>CSSOM</code> åˆ™æ˜¯ CSS Object Model çš„ç®€å†™ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<p><code>Render Tree</code> å’Œ <code>DOM Tree</code> æ˜¯ç›¸å¯¹åº”çš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚éå¯è§†åŒ–çš„å…ƒç´ ä¸ä¼šæ’å…¥ <code>Render Tree</code> ä¸­ï¼Œå¦‚ HTML çš„ <code>head</code> å…ƒç´ ã€‚å¦‚æœå…ƒç´ çš„ <code>display</code> ä¸º <code>none</code>ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šæ˜¾ç¤ºåœ¨ <code>Render Tree</code> ä¸­ï¼Œä½†æ˜¯ <code>visibility</code> ä¸º <code>hidden</code> çš„å…ƒç´ ä»ä¼šæ˜¾ç¤ºã€‚</p>
<h3>ä¸‰ã€è§£æ</h3>
<p><strong>è§£æ</strong>æ˜¯æ¸²æŸ“å¼•æ“ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ã€‚</p>
<h5>3.1 ä»€ä¹ˆæ˜¯è§£æï¼Ÿ</h5>
<p>è§£ææ–‡æ¡£æ˜¯æŒ‡å°†æ–‡æ¡£è½¬åŒ–ä¸ºæœ‰æ„ä¹‰çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å¯è®©ä»£ç ç†è§£å’Œä½¿ç”¨çš„ç»“æ„ã€‚è§£æå¾—åˆ°çš„ç»“æœé€šå¸¸æ˜¯ä»£è¡¨äº†æ–‡æ¡£ç»“æ„çš„èŠ‚ç‚¹æ ‘ï¼Œå®ƒè¢«ç§°ä½œâ€œè§£ææ ‘â€æˆ–â€œè¯­æ³•æ ‘â€ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7357ea6e9014802d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="From source document to parse tree"></p>
<p>è§£æåˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼šè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰å’Œè¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ã€‚</p>
<p>è¯æ³•åˆ†ææ˜¯å°†è¾“å…¥å†…å®¹åˆ†å‰²æˆå¤§é‡æœ‰æ•ˆçš„æ ‡è®°ï¼ˆ<code>token</code>ï¼‰çš„è¿‡ç¨‹ã€‚<code>token</code> æ˜¯è¯­è¨€è¯æ±‡ï¼Œæ˜¯ç»„æˆå†…å®¹æœ€å°çš„å…ƒç´ ã€‚è¯­æ³•åˆ†ææ˜¯æŒ‡åº”ç”¨è¯­è¨€çš„è¯­æ³•è§„åˆ™çš„è¿‡ç¨‹ã€‚</p>
<p>è§£æå™¨æ˜¯è¿™æ ·å·¥ä½œçš„ï¼šè¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰è´Ÿè´£å°†è¾“å…¥å†…å®¹åˆ†å‰²æˆä¸€ä¸ªä¸ªæœ‰æ•ˆçš„ <code>token</code>ï¼›è€Œè§£æå™¨ï¼ˆParserï¼‰è´Ÿè´£æ ¹æ®è¯­è¨€çš„è¯­æ³•è§„åˆ™åˆ†ææ–‡æ¡£ç»“æ„ï¼Œä»è€Œæ„å»ºå‡ºè§£ææ ‘ï¼ˆParse Treeï¼‰ã€‚è¯æ³•åˆ†æå™¨çŸ¥é“å¦‚ä½•å°†æ— å…³çš„å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ï¼‰åˆ†ç¦»å‡ºæ¥ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ <a href="https://astexplorer.net/#/gist/e2d0fc90d6891eee271cacba32c51ee2/ce16e705e3113d6df7298a4d8a9b7336fb99f1e7">AST Explorer</a> ç½‘ç«™å°†ä»¥ä¸‹è¿™æ®µ HTML æ–‡æ¡£è§£ææˆâ€œæ ‘â€ç»“æ„ã€‚</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello,&lt;/h1&gt;
    &lt;p id=&quot;name&quot;&gt;I'm Frankie.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-96cc52fe076483db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬è¦è®¿é—® <code>&lt;p&gt;</code> æ ‡ç­¾çš„ <code>id</code> å±æ€§å€¼ï¼Œå¦‚æœä¸å°†å…¶å…ˆè§£æä¸ºâ€œæ ‘â€çš„è¯ï¼Œåº”è¯¥ä¼šæƒ³åˆ°ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…æºæ–‡æ¡£ï¼Œè‹¥éœ€è¦è·å–çš„å±æ€§å„ç§å„æ ·ï¼Œæ˜¾ç„¶æ­£åˆ™è¡¨è¾¾å¼ä¼šå¾ˆéº»çƒ¦ã€‚ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»ä¼¼ <code>document.html.body.p.attrs.id</code> çš„å½¢å¼æ¥è·å–å…¶å€¼ã€‚</p>
<p>å¦‚æœä½ å¯¹æµè§ˆå™¨å¦‚ä½•å°† HTML ç”Ÿæˆâ€œæŠ½è±¡è¯­æ³•æ ‘â€ï¼ˆASTï¼‰ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ä¸ªåº“ï¼š<a href="https://github.com/inikulin/parse5">parse5</a>ã€‚</p>
</blockquote>
<h5>3.2 ç¿»è¯‘</h5>
<p>å¾ˆå¤šæ—¶å€™ï¼Œè¯­æ³•æ ‘ï¼ˆè§£ææ ‘ï¼‰å¹¶ä¸æ˜¯æœ€ç»ˆçš„äº§å“ã€‚è§£æé€šå¸¸åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œè€Œç¿»è¯‘æ˜¯æŒ‡å°†è¾“å…¥æ–‡æ¡£è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ã€‚ç¼–è¯‘å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚ç¼–è¯‘å™¨å¯ä»¥å°†æºä»£ç ï¼ˆsource codeï¼‰ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼ˆmachine codeï¼‰ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-80719a46ea1128f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Compilation flow"></p>
<h3>å››ã€å¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåº</h3>
<h5>4.1 è„šæœ¬</h5>
<p>ç½‘ç»œçš„æ¨¡å‹æ˜¯åŒæ­¥çš„ã€‚ç½‘é¡µä½œè€…å¸Œæœ›è§£æå™¨é‡åˆ° <code>&lt;script&gt;</code> æ ‡è®°æ—¶ç«‹å³è§£æå¹¶æ‰§è¡Œè„šæœ¬ã€‚æ–‡æ¡£çš„è§£æå°†åœæ­¢ï¼Œç›´åˆ°è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœè„šæœ¬æ˜¯å¤–éƒ¨çš„ï¼Œé‚£ä¹ˆè§£æè¿‡ç¨‹ä¼šåœæ­¢ï¼Œç›´åˆ°ä»ç½‘ç»œåŒæ­¥æŠ“å–èµ„æºå®Œæˆåå†ç»§ç»­ã€‚æ­¤æ¨¡å‹å·²ç»ä½¿ç”¨äº†å¤šå¹´ï¼Œä¹Ÿåœ¨ HTML4 å’Œ HTML5 è§„èŒƒä¸­è¿›è¡Œäº†æŒ‡å®šã€‚ä½œè€…ä¹Ÿå¯ä»¥å°†è„šæœ¬æ ‡æ³¨ä¸º <code>defer</code>ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœæ­¢æ–‡æ¡£è§£æï¼Œè€Œæ˜¯ç­‰åˆ°è§£æç»“æŸæ‰æ‰§è¡Œã€‚HTML5 å¢åŠ äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯å°†è„šæœ¬æ ‡è®°ä¸ºå¼‚æ­¥ï¼ˆ<code>async</code>ï¼‰ï¼Œä»¥ä¾¿ç”±å…¶ä»–çº¿ç¨‹è§£æå’Œæ‰§è¡Œã€‚</p>
<h5>4.2 é¢„è§£æ</h5>
<p>WebKit å’Œ Gecko éƒ½è¿›è¡Œäº†è¿™é¡¹ä¼˜åŒ–ã€‚åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè§£ææ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‰¾å‡ºå¹¶åŠ è½½éœ€è¦é€šè¿‡ç½‘ç»œåŠ è½½çš„å…¶ä»–èµ„æºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œèµ„æºå¯ä»¥å­åœ¨å¹¶è¡Œè¿æ¥ä¸ŠåŠ è½½ï¼Œä»è€Œæé«˜æ€»ä½“é€Ÿåº¦ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¢„è§£æå™¨ä¸ä¼šä¿®æ”¹ DOM Treeï¼Œè€Œæ˜¯å°†è¿™é¡¹å·¥ä½œäº¤ç”±ä¸»è§£æå™¨å¤„ç†ã€‚é¢„è§£æå™¨åªä¼šè§£æå¤–éƒ¨èµ„æºï¼ˆä¾‹å¦‚å¤–éƒ¨è„šæœ¬ã€æ ·å¼è¡¨å’Œå›¾ç‰‡ï¼‰çš„å¼•ç”¨ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<!---

### TODO

1. User-Agent éƒ½å¸¦ Mozilla çš„åŸå› ã€‚[å…³äºæµè§ˆå™¨å†…æ ¸](http://blog.sina.com.cn/s/blog_702183da0102welk.html)
2. load å’Œ DOMContentLoaded
3. async å’Œ deferï¼Œè¿˜æœ‰ä¸€ä¸ª origin

### å‚è€ƒ

* [æµè§ˆå™¨æ¸²æŸ“åŸç† ï¼ˆä¸€ï¼‰åœ¨ç½‘å€ä¸­è¾“å…¥ä¸€ä¸ªç½‘ç«™åé¢éƒ½åšäº†ä»€ä¹ˆ](https://juejin.cn/post/6844903935556190215)
* [æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)
* [æ€§èƒ½ç»Ÿè®¡åˆ†æå·¥å…·](https://github.com/pod4g/hiper/blob/master/README.zh-CN.md)
* [æµè§ˆå™¨æ¸²æŸ“é¡µé¢è¿‡ç¨‹ä¸é¡µé¢ä¼˜åŒ–](https://segmentfault.com/a/1190000010298038)
* [How the browser renders HTML & CSS](https://medium.com/@mustafa.abdelmogoud/how-the-browser-renders-html-css-27920d8ccaa6)
* [How the browsers understand JavaScript](https://medium.com/@mustafa.abdelmogoud/how-the-browsers-understand-javascript-d9699dced89b)
* [Parsing HTML documentsï¼ˆLiving Standardï¼‰](https://html.spec.whatwg.org/multipage/parsing.html)
* [å…³é”®æ¸²æŸ“è·¯å¾„](https://developer.mozilla.org/zh-CN/docs/Web/Performance/Critical_rendering_path)
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ç¼–ç¨‹é£æ ¼ï¼ˆä¹¦å†™ä¹ æƒ¯ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/244</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/244</guid>
            <pubDate>Sun, 26 Feb 2023 11:20:42 GMT</pubDate>
            <description><![CDATA[<p>ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„â€œè¯­æ³•è§„åˆ™â€ï¼ˆgrammarï¼‰åº”è¯¥æ˜¯æ¯ä¸€ä½å¼€å‘è€…éƒ½å¿…é¡»éµå¾ªçš„ï¼›è€Œâ€œç¼–ç¨‹é£æ ¼â€åˆ™å¯è‡ªç”±é€‰æ‹©ã€‚</p>
<p>å‡è®¾å›¢é˜Ÿä¸­æœ‰ 100 ä½æˆå‘˜ï¼Œç„¶åæ¯ä½æˆå‘˜çš„ coding é£æ ¼éƒ½ä¸ä¸€æ ·ï¼Œè€Œä¸”å›¢é˜Ÿä¸­æ²¡æœ‰æ˜ç¡®çš„ç¼–å†™è§„èŒƒï¼Œé‚£ Code Review çš„æ—¶å€™ï¼Œä¸å¾—æ‰“èµ·æ¥ï¼Œæˆ–è€…å†…å¿ƒå£åèŠ¬èŠ³......æ‰€ä»¥ï¼Œç¤¾åŒºä¸­å‡º]]></description>
            <content:encoded><![CDATA[<p>ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„â€œè¯­æ³•è§„åˆ™â€ï¼ˆgrammarï¼‰åº”è¯¥æ˜¯æ¯ä¸€ä½å¼€å‘è€…éƒ½å¿…é¡»éµå¾ªçš„ï¼›è€Œâ€œç¼–ç¨‹é£æ ¼â€åˆ™å¯è‡ªç”±é€‰æ‹©ã€‚</p>
<p>å‡è®¾å›¢é˜Ÿä¸­æœ‰ 100 ä½æˆå‘˜ï¼Œç„¶åæ¯ä½æˆå‘˜çš„ coding é£æ ¼éƒ½ä¸ä¸€æ ·ï¼Œè€Œä¸”å›¢é˜Ÿä¸­æ²¡æœ‰æ˜ç¡®çš„ç¼–å†™è§„èŒƒï¼Œé‚£ Code Review çš„æ—¶å€™ï¼Œä¸å¾—æ‰“èµ·æ¥ï¼Œæˆ–è€…å†…å¿ƒå£åèŠ¬èŠ³......æ‰€ä»¥ï¼Œç¤¾åŒºä¸­å‡ºç°äº†å¾ˆå¤š Lint å·¥å…·æ¥å¸®åŠ©å›¢é˜Ÿå»è§„èŒƒä¹¦å†™ä¹ æƒ¯ï¼Œå¦‚ <a href="https://eslint.org/">ESLint</a>ã€<a href="https://prettier.io/">Prettier</a> ç­‰ç­‰...</p>
<blockquote>
<p>â€œç¼–ç¨‹é£æ ¼â€çš„é€‰æ‹©ä¸åº”è¯¥åŸºäºä¸ªäººçˆ±å¥½ã€ç†Ÿæ‚‰ç¨‹åº¦ã€æ‰“å­—å·¥ä½œé‡ç­‰å› ç´ ï¼Œè€Œè¦è€ƒè™‘å¦‚ä½•å°½é‡ä½¿ä»£ç æ¸…æ™°æ˜“è¯»ã€å‡å°‘å‡ºé”™ã€‚ä½ é€‰æ‹©çš„ï¼Œä¸æ˜¯ä½ å–œæ¬¢çš„é£æ ¼ï¼Œè€Œæ˜¯ä¸€ç§èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾ä½ çš„æ„å›¾çš„é£æ ¼ã€‚</p>
</blockquote>
<p>æ¨è JavaScript æƒå¨ <a href="https://www.crockford.com/sugar.html">Douglas Crockford</a> çš„ä¸€ç¯‡<a href="https://www.youtube.com/watch?v=taaEzHI9xyY&amp;ab_channel=YUILibrary">æ¼”è®²</a>ã€‚</p>
<h2>ä¸€ã€å¤§æ‹¬å·ä½ç½®</h2>
<blockquote>
<p><strong>è§„åˆ™ 1ï¼šè¡¨ç¤ºåŒºå—èµ·é¦–çš„å¤§æ‹¬å·ï¼Œä¸è¦å¦èµ·ä¸€è¡Œã€‚</strong></p>
</blockquote>
<p>ç»å¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½ç”¨å¤§æ‹¬å· <code>{}</code> è¡¨ç¤ºåŒºå—ï¼ˆblockï¼‰ï¼ŒJavaScript ä¹Ÿä¸€æ ·ã€‚</p>
<p>å¸¸è§çš„å†™æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<pre><code class="language-js">// bad
block
{
  // ...
}
</code></pre>
<pre><code class="language-js">// good
block {
  // ...
}
</code></pre>
<p>ç”±äº JavaScript çš„ <a href="https://github.com/toFrankie/blog/issues/223">è‡ªåŠ¨æ’å…¥åˆ†å·</a>ï¼ˆAutomatic Semicolon Insertionï¼Œç®€ç§° ASIï¼‰æœºåˆ¶ï¼Œå¯¼è‡´ä¸€äº›éš¾ä»¥å¯Ÿè§‰çš„é”™è¯¯ã€‚</p>
<p>å› æ­¤ï¼ŒåŸåˆ™ä¸Šæ›´æ¨èåè€…çš„å†™æ³•ï¼š<strong>èµ·é¦–çš„å¤§æ‹¬å·è·Ÿåœ¨å…³é”®å­—çš„åé¢</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">return
{
  key: 'value'
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç åŸæ„æ˜¯è¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½†å®é™…ä¸Šè¿”å›å€¼ä¸º <code>undefined</code>ã€‚å› ä¸º ASI çš„åŸå› ï¼ŒJavaScript è§£æå™¨ä¼šåœ¨<code>return</code> åé¢æ’å…¥åˆ†å· <code>;</code>ï¼Œç”±äºåˆ†å·æ˜¯ç»ˆæ­¢ç¬¦ï¼Œè§£æå™¨å°±è®¤ä¸ºè¿™ä¸ªè¯­å¥ç»“æŸäº†ã€‚</p>
<p>ç±»ä¼¼ <code>return</code> çš„ç‰¹å®šè¯­å¥ï¼Œåœ¨ ASI ä¸­è¢«ç§°ä¸º <code>restricted production</code>ã€‚å®ƒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¯­æ³•ï¼Œå‡ä¸èƒ½æ¢è¡Œï¼š</p>
<blockquote>
<ul>
<li>åç¼€è¡¨è¾¾å¼ <code>++</code> å’Œ <code>--</code></li>
<li><code>return</code></li>
<li><code>continue</code></li>
<li><code>break</code></li>
<li><code>throw</code></li>
<li>ES6 çš„ç®­å¤´å‡½æ•°ï¼ˆå‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œï¼‰</li>
<li><code>yield</code></li>
</ul>
</blockquote>
<p>è¿™äº›æ— éœ€æ­»è®°ï¼Œå› ä¸ºæŒ‰ç…§ä¸€èˆ¬çš„ä¹¦å†™ä¹ æƒ¯ï¼Œå‡ ä¹æ²¡æœ‰äººä¼šè¿™æ ·æ¢è¡Œçš„ã€‚å¦‚æœæœ‰çš„è¯ï¼Œæ‰“ si å®ƒã€‚</p>
<h2>äºŒã€åœ†æ‹¬å·çš„ä½ç½®</h2>
<p>åœ†æ‹¬å·ï¼ˆparenthesesï¼‰åœ¨ JavaScript ä¸­æœ‰ä¸¤ç§ä½œç”¨ï¼Œä¸€ç§æ˜¯è¡¨ç¤ºè°ƒç”¨å‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯è¡¨ç¤ºä¸åŒçš„å€¼çš„ç»„åˆï¼ˆgroupingï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç©ºæ ¼åŒºåˆ†ä¸¤ç§ä¸åŒçš„åœ†æ‹¬å·ã€‚</p>
<blockquote>
<p><strong>è§„åˆ™ 2ï¼šè°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°åä¸å·¦æ‹¬å·ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚</strong></p>
</blockquote>
<pre><code class="language-js">// bad
foo (bar)

// good
foo(bar)
</code></pre>
<blockquote>
<p><strong>è§„åˆ™ 3ï¼šå‡½æ•°åä¸å‚æ•°åºåˆ—ä¹‹é—´ï¼Œæ²¡æœ‰ç©ºæ ¼ã€‚</strong></p>
</blockquote>
<pre><code class="language-js">// bad
function fn (foo) {
  // ...
}

// good
function fn(foo) {
  // ...
}
</code></pre>
<blockquote>
<p><strong>è§„åˆ™ 4ï¼šæ‰€æœ‰å…¶ä»–è¯­æ³•å…ƒç´ ä¸å·¦æ‹¬å·ä¹‹é—´ï¼Œéƒ½æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</strong></p>
</blockquote>
<pre><code>// bad
return(foo + bar)

// good
return (foo + bar)
</code></pre>
<p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ï¼Œå…¶å®æœ€å¥½å»æ‰åœ†æ‹¬å·ï¼Œå…¶å®åœ¨è¿™å¥è¯­å¥é‡Œé¢å®ƒæ˜¯ä¸éœ€è¦åœ†æ‹¬å·çš„ã€‚è¿™é‡Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹è€Œå·²ã€‚</p>
<p>ç›¸ä¿¡å¾ˆå¤šäººå¯¹ä»¥ä¸Šä¸‰æ¡å»ºè®®ï¼Œä¸å±‘ä¸€é¡¾ã€‚2021 å¹´äº†ï¼Œé‚£å°±äº¤ç»™ <a href="https://prettier.io/">Prettier</a> å¤„ç†å§ã€‚</p>
<h2>ä¸‰ã€ä¸è¦çœç•¥åˆ†å·</h2>
<blockquote>
<p><strong>è§„åˆ™ 5ï¼šä¸è¦çœç•¥å¥æœ«çš„åˆ†å·ã€‚</strong></p>
</blockquote>
<p>å…¶å®æˆ‘æ˜¯åå‘ <strong>semicolon-less</strong> é£æ ¼ï¼Œæˆ‘è®¤ä¸ºé€šç¯‡å°‘äº† 99% çš„åˆ†å·ï¼Œçœ‹èµ·æ¥ä¼šç®€æ´å¾ˆå¤šã€‚</p>
<blockquote>
<p>ä¹‹å‰å†™ä¸ªä¸€ç¯‡æ–‡ç« æ˜¯å…³äºè‡ªåŠ¨æ’å…¥åˆ†å·çš„ï¼š<a href="https://github.com/toFrankie/blog/issues/223">JavaScript ASI æœºåˆ¶è¯¦è§£</a></p>
</blockquote>
<p>ä½†æ˜¯è¿™æ—¶å€™ï¼Œæœ‰äººå°±ä¼šä¸¾å‡ºç±»ä¼¼ç¤ºä¾‹ï¼Œæ¥åå¯¹â€œæ— åˆ†å·å…šâ€äº†ï¼š</p>
<pre><code class="language-js">a = b
(function () {
  // ...
})
</code></pre>
<p>ç”±äº ASI æœºåˆ¶ï¼ŒJavaScript è§£æå™¨çœ‹åˆ°çš„ä¼šæ˜¯è¿™è¿™æ ·å­ï¼š</p>
<pre><code class="language-js">a = b(function () {
  // ...
});
</code></pre>
<p>æ˜¯çš„ï¼Œè¿™æ ·å°±å¾—ä¸åˆ°é¢„æœŸçš„ç»“æœã€‚ä½†æ˜¯ä½œä¸ºåˆæ ¼çš„ semicolon-less é£æ ¼çš„ç å†œï¼ˆä¿—ç§° coderï¼‰ï¼Œå¦‚æœä¸€æ¡è¯­å¥æ˜¯ä»¥ <code>(</code>ã€<code>[</code>ã€<code>/</code>ã€<code>+</code>ã€<code>-</code> å¼€å¤´ï¼Œæˆ‘ä»¬ä¼šåœ¨è¯¥è¯­å¥çš„è¡Œé¦–ä¸»åŠ¨é”®å…¥åˆ†å·æ¥é¿å…åˆ†å· <code>;</code> æ¥é¿å… ASI æœºåˆ¶äº§ç”Ÿçš„éé€¾æœŸç»“æœæˆ–æŠ¥é”™ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä»¥ <code>/</code>ã€<code>+</code>ã€<code>-</code> ä½œä¸ºè¡Œé¦–çš„ä»£ç å…¶å®æ˜¯å¾ˆå°‘çš„ï¼Œ<code>(</code>ã€<code>[</code> ä¹Ÿæ˜¯è¾ƒå°‘çš„ã€‚</p>
<p>**å¦‚æœä½ è¯´è¿™å¾ˆå®¹æ˜“å¿˜è®°é”®å…¥åˆ†å·ï¼Œé‚£è¯´æ˜ä½ ä¸æ˜¯åˆæ ¼çš„â€œæ— åˆ†å·å…šâ€ï¼Œé‚£è¿˜æ˜¯ä¹–ä¹–æ•²åˆ†å·å§ï¼**æˆ–è®¸å¤šæ•°äººæ›´å®¹æ˜“å¿˜è®°ï¼Œæ‰€ä»¥æ‰æœ‰äº†â€œä¸è¦çœç•¥å¥æœ«åˆ†å·â€çš„æ¨èå†™æ³•å§ã€‚ï¼ˆç®—æ˜¯å°‘æ•°æœä»å¤šæ•°çš„å¦¥åå§ï¼‰</p>
<blockquote>
<p>å¯¹äºä¸åŠ æ€è€ƒè€Œä¸€å‘³å¦å®š semicolon-less çš„äººï¼Œæˆ‘è¿˜æ˜¯ç»™å‡ºå°¤å¤§é‚£å¥è¯ï¼š<strong>æ‰€æœ‰ç›´è§‰æ€§çš„ â€œå½“ç„¶åº”è¯¥åŠ åˆ†å·â€ éƒ½æ˜¯ä¿å®ˆçš„ã€æœªç»æ·±å…¥æ€è€ƒçš„è‰ç‡ç»“è®ºã€‚</strong></p>
</blockquote>
<h2>å››ã€with è¯­å¥</h2>
<blockquote>
<p><strong>è§„åˆ™ 6ï¼šä¸è¦ä½¿ç”¨ <code>with</code> è¯­å¥ã€‚</strong></p>
</blockquote>
<pre><code class="language-js">with (obj) {
  foo = bar
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå››ç§è¿è¡Œç»“æœï¼š</p>
<pre><code class="language-js">obj.foo = bar

obj.foo = obj.bar

foo = bar

foo = obj.bar
</code></pre>
<p>ä»¥ä¸Šå››ç§ç»“æœéƒ½å¯èƒ½å‘ç”Ÿï¼Œå–å†³äºä¸åŒçš„å˜é‡æ˜¯å¦æœ‰å®šä¹‰ã€‚å› æ­¤ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨ <code>with</code> è¯­å¥ã€‚</p>
<h2>äº”ã€ç›¸ç­‰ä¸ä¸¥æ ¼ç›¸ç­‰</h2>
<blockquote>
<p><strong>è§„åˆ™ 7ï¼šå°½å¯èƒ½ä¸è¦ä½¿ç”¨ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ==ï¼‰ï¼Œè€Œä½¿ç”¨å…¨ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ã€‚</strong></p>
</blockquote>
<p>æ­¤å‰é’ˆå¯¹ç›¸ç­‰è¿ç®—ç¬¦ä¸å…¨ç­‰è¿ç®—ç¬¦ï¼Œå†™äº†ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/240">JavaScript ç›¸ç­‰æ¯”è¾ƒè¯¦è§£</a>ï¼Œæ–‡ç« å¼€å¤´å°±æœ‰å¦‚ä¸‹è¿™å¥è¯ï¼š</p>
<blockquote>
<p>Always use 3 equals unless you have a good reason to use 2.</p>
</blockquote>
<p>ä¸»è¦åŸå› æ˜¯ï¼Œä½¿ç”¨ç›¸ç­‰è¿ç®—ç¬¦å¯¹ä¸¤ä¸ªä¸åŒç±»å‹çš„æ“ä½œæ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒJavaScript å†…éƒ¨ä¼šâ€œå·å·â€è¿›è¡Œäº†ç±»å‹è½¬æ¢ã€‚</p>
<pre><code class="language-js">0 == '' // true
2 == true // false
0 == '0' // true
false == '0' // true
' \t\r\n ' == 0 // true
</code></pre>
<h2>å…­ã€è¯­å¥çš„åˆå¹¶</h2>
<p>æœ‰äº›å¼€å‘è€…è¿½æ±‚â€œè¿‡åˆ†â€ç®€æ´ï¼Œå–œæ¬¢åˆå¹¶ä¸åŒç›®çš„çš„è¯­å¥ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒåŸè¯­å¥æ˜¯ï¼š</p>
<pre><code class="language-js">a = b
if (a) { ... }
</code></pre>
<p>ä»–å–œæ¬¢å†™æˆä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-js">if (a = b) { ... }
</code></pre>
<p>è™½ç„¶è¯­å¥å°‘äº†ä¸€è¡Œï¼Œä½†æ˜¯å¯è¯»æ€§å¤§æ‰“æŠ˜æ‰£ï¼Œè€Œä¸”ä¼šé€ æˆè¯¯è¯»ï¼Œè®©åˆ«äººè¯¯ä»¥ä¸ºè¿™è¡Œä»£ç çš„æ„æ€æ˜¯ï¼š</p>
<pre><code class="language-js">if (a === b) { ... }
</code></pre>
<p>å¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œæœ‰äº›å¼€å‘è€…å–œæ¬¢åœ¨åŒä¸€è¡Œä¸­èµ‹å€¼å¤šä¸ªå˜é‡ï¼š</p>
<pre><code class="language-js">// éä¸¥æ ¼æ¨¡å¼
var a = b = 0
</code></pre>
<p>å®ƒå¯èƒ½è®¤ä¸ºï¼Œä¸Šé¢çš„ä»£ç ç›¸å½“äºï¼š</p>
<pre><code class="language-js">var a = 0, b = 0
</code></pre>
<p>ä½†å®é™…ä¸Šä¸æ˜¯ï¼Œå®ƒçš„çœŸæ­£æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-js">// è¿™é‡ŒæŒ‡éä¸¥æ ¼æ¨¡å¼ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™ï¼Œä¸å…è®¸è¿™ç§é»˜è®¤å…¨å±€å˜é‡çš„å†™æ³•ï¼‰
b = 0
var a = b
</code></pre>
<p>å› æ­¤ï¼Œä¸å»ºè®®å°†ä¸åŒç›®çš„çš„è¯­å¥åˆå¹¶æˆä¸€è¡Œã€‚</p>
<h2>ä¸ƒã€å˜é‡å£°æ˜</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸è‘—åçš„<strong>å˜é‡æå‡</strong>ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Hoisting">Hoisting</a>ï¼‰æ¦‚å¿µï¼Œç›¸ä¿¡éƒ½çŸ¥é“ã€‚</p>
<p>ä¸ç®¡æˆ‘ä»¬å®é™…é¡¹ç›®ä¸­æ€æ ·ï¼Œä½œä¸ºä¸€ä¸ªåˆæ ¼æˆ–ä¸åˆæ ¼çš„ Jserï¼Œéƒ½åº”è¯¥å»äº†è§£æ¸…æ¥šæå‡æ˜¯ä»€ä¹ˆé¬¼ï¼Œå¥½å§ã€‚ä¹‹å‰å†™äº†ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/211">æ·±å…¥äº†è§£ JavaScript ä»é¢„ç¼–è¯‘åˆ°è§£ææ‰§è¡Œçš„è¿‡ç¨‹</a>ã€‚ï¼ˆPSï¼šå½“åˆå†™å¾—ä¸å¥½ï¼Œå»ºè®®çœ‹ MDN æˆ– ECMAScript æ ‡å‡†ï¼‰</p>
<p>å°±ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>å…ˆå£°æ˜ï¼Œåè°ƒç”¨ã€‚</p>
</blockquote>
<p>è¿˜æœ‰éƒ½ 2021 å¹´äº†ï¼Œå°½å¯èƒ½åˆ«ç”¨ <code>var</code> äº†ï¼Œç”¨ <code>let</code>ã€<code>const</code> å§ã€‚è‡³äºå…¼å®¹å°±æ”¾å¿ƒäº¤ç»™ <a href="https://www.babeljs.cn/">Babel</a> å§ï¼</p>
<pre><code class="language-js">// bad
if (!obj) {
  var obj = {}
}

// good
var obj
if (!obj) {
   obj = {}
}
</code></pre>
<p>ä¸ºäº†é¿å…å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œä¸å¦‚æŠŠå˜é‡å£°æ˜éƒ½æ”¾åœ¨ä»£ç å—çš„å¤´éƒ¨ã€‚</p>
<pre><code class="language-js">// bad
for (var i ...) { ... }

// good
var i
for (i ...) { ... }
</code></pre>
<p>å› æ­¤ï¼Œ</p>
<blockquote>
<p><strong>è§„åˆ™ 9ï¼šæ‰€æœ‰å˜é‡å£°æ˜éƒ½æ”¾åœ¨å‡½æ•°çš„å¤´éƒ¨ã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong>è§„åˆ™ 10ï¼šæ‰€æœ‰å‡½æ•°éƒ½åœ¨ä½¿ç”¨ä¹‹å‰å®šä¹‰ã€‚</strong></p>
</blockquote>
<h2>å…«ã€å…¨å±€å˜é‡</h2>
<p>Javascript æœ€å¤§çš„è¯­æ³•ç¼ºç‚¹ï¼Œå¯èƒ½å°±æ˜¯å…¨å±€å˜é‡å¯¹äºä»»ä½•ä¸€ä¸ªä»£ç å—ï¼Œéƒ½æ˜¯å¯è¯»å¯å†™ã€‚è¿™å¯¹ä»£ç çš„æ¨¡å—åŒ–å’Œé‡å¤ä½¿ç”¨ï¼Œéå¸¸ä¸åˆ©ã€‚</p>
<blockquote>
<p><strong>è§„åˆ™ 11ï¼šé¿å…ä½¿ç”¨å…¨å±€å˜é‡ï¼›å¦‚æœä¸å¾—ä¸ä½¿ç”¨ï¼Œç”¨å¤§å†™å­—æ¯è¡¨ç¤ºå˜é‡åï¼Œæ¯”å¦‚ <code>UPPER_CASE</code>ã€‚</strong></p>
</blockquote>
<h2>ä¹ã€new å…³é”®å­—</h2>
<p>JavaScript ä½¿ç”¨ new å…³é”®å­—ï¼Œä»æ„é€ å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p>
<pre><code class="language-js">var obj = new myObject()
</code></pre>
<p>è¿™ç§åšæ³•çš„é—®é¢˜æ˜¯ï¼Œä¸€æ®µä½ å¿˜äº†åŠ ä¸Š <code>new</code> å…³é”®å­—ï¼Œ<code>myObject()</code> å†…éƒ¨çš„ <code>this</code> å…³é”®å­—å°±ä¼šæŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ <code>this</code> ä¸º <code>undefined</code>ï¼‰ï¼Œå¯¼è‡´æ‰€æœ‰ç»‘å®šåœ¨ this ä¸Šçš„å˜é‡ï¼Œéƒ½å˜æˆäº†å…¨å±€å˜é‡ã€‚</p>
<blockquote>
<p><strong>è§„åˆ™ 12ï¼šä¸è¦ä½¿ç”¨ <code>new</code> å…³é”®å­—ï¼Œæ”¹ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create()</a> æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong>è§„åˆ™ 13ï¼šæ„é€ å‡½æ•°çš„å‡½æ•°åï¼Œé‡‡ç”¨é¦–å­—æ¯å¤§å†™ï¼ˆInitialCapï¼‰çš„ä¹¦å†™æ–¹å¼ï¼›å…¶ä»–çš„å‡½æ•°åï¼Œä¸€å¾‹é¦–å­—æ¯å°å†™ã€‚</strong></p>
</blockquote>
<p>å½“ç„¶ï¼Œæ„é€ å‡½æ•°åç§°é¦–å­—æ¯å¤§å†™ï¼Œåªæ˜¯çº¦å®šä¿—æˆçš„ä¸€ç§ä¹¦å†™æ–¹å¼è€Œå·²ï¼Œä¸å½±å“å®é™…è¿è¡Œã€‚åƒ ESLint å°±æœ‰ä¸€ä¸ª <a href="https://github.com/eslint/eslint/blob/master/lib/rules/new-cap.js">new-cap</a> è§„åˆ™å»æ£€æŸ¥è¿™ç§å†™æ³•çš„ã€‚</p>
<h2>åã€è‡ªå¢å’Œè‡ªå‡è¿ç®—ç¬¦</h2>
<p>è‡ªå¢ <code>++</code> å’Œè‡ªå‡ <code>--</code> è¿ç®—ç¬¦ï¼Œæ”¾åœ¨æ“ä½œæ•°çš„å‰é¢æˆ–åé¢ï¼Œè¿”å›å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿé”™è¯¯ã€‚</p>
<p>è¯´å®è¯ï¼Œæˆ‘åˆ°ç°åœ¨è¿˜ç»å¸¸è®°ä¸å¤ªæ¸…è¿™ä¿©ç©æ„ã€‚æœ‰æ—¶å€™é‡åˆ°ï¼Œè¿˜ç‰¹åœ°å»æŸ¥é˜…ä¸€ç•ªä»¥ç¡®è®¤æ˜¯å¦é¢„æœŸè¿è¡Œã€‚</p>
<p>æ‰€ä»¥æˆ‘ä¹Ÿæ˜¯ä½¿ç”¨ <code>+= 1</code> æˆ– <code>-= 1</code> å»æ›¿ä»£å®ƒçš„ã€‚ESLint ä¹Ÿæœ‰ä¸€ä¸ªè§„åˆ™ <a href="https://github.com/eslint/eslint/blob/master/docs/rules/no-plusplus.md">no-plusplus</a> å»é™åˆ¶è¿™ç§å†™æ³•ã€‚</p>
<pre><code class="language-js">//  bad
++i

// good
i += 1
</code></pre>
<p>å¬è¯´æŸ JS åº“æºç å‡ºç°äº†ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="language-js">++i;
++i;

// æ€ä¹ˆçœ‹ï¼Œæ›´åˆç†çš„å†™æ³•åº”è¯¥æ˜¯ï¼š
i += 2
</code></pre>
<p>å› æ­¤ï¼Œ</p>
<blockquote>
<p><strong>è§„åˆ™ 14ï¼šä¸è¦ä½¿ç”¨è‡ªå¢ï¼ˆ<code>++</code>ï¼‰å’Œè‡ªå‡ï¼ˆ<code>--</code>ï¼‰ï¼Œä½¿ç”¨ <code>+=</code> å’Œ <code>-=</code> ä»£æ›¿ã€‚</strong></p>
</blockquote>
<p>å…¶å®æˆ‘çš„ä¹ æƒ¯æ˜¯ï¼Œä»…å…è®¸ <code>for</code> çš„ <code>final-expression</code> ä½¿ç”¨è‡ªå¢æˆ–è‡ªå‡ï¼Œå…¶ä»–çš„ä¸å…è®¸ï¼Œæ‰€ä»¥ ESLint è§„åˆ™å¯ä»¥è¿™æ ·å†™ã€‚</p>
<pre><code class="language-js">/* eslint no-plusplus: [&quot;error&quot;, { &quot;allowForLoopAfterthoughts&quot;: true }] */
for (let i = 0; i &lt; 10; i++) {
  // ä¸Šé¢ final-expression å…è®¸è‡ªå¢ã€è‡ªå‡ï¼Œä½†å¾ªç¯ä½“æœ¬èº«ä¸å…è®¸
}
</code></pre>
<p>è¯¦è§ï¼š<a href="https://github.com/toFrankie/blog/issues/127">no-plusplus</a>ã€‚</p>
<h2>æ€»ç»“</h2>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ€»ç»“æˆä¸€å¥è¯ï¼š<strong>çˆ±å’‹å’‹åœ°</strong>ã€‚</p>
<p>éƒ½ 2021 å¹´äº†ï¼Œé¡¹ç›®éƒ½ç»§æ‰¿ ESLintã€Prettier äº†å§ï¼Œé‚£ä¸Šé¢çš„å¾ˆå¤šæ¯›ç—…ï¼Œå®ƒä»¬åŸºæœ¬ä¸Šéƒ½ç»™ä½ å¤„ç†äº†ã€‚ä½†æˆ‘ä»¬åº”è¯¥è¦äº†è§£ä¸‹èƒŒåçš„åŸå› ï¼Œå¯¹å§ã€‚</p>
<p>å¯¹äºæœ‰å¼ºè¿«ç—‡çš„æˆ‘ï¼Œè¿˜è¦ç»§æ‰¿ <a href="https://github.com/csscomb/csscomb.js">CSScomb</a>ï¼Œå»å¯¹ CSS è¿›è¡Œæ’åºã€‚å¯ä»¥çœ‹ä¸‹æˆ‘ä¸€ä¸ª Demo ğŸ‘‰ <a href="https://github.com/toFrankie/csscomb-mini">csscomb-mini</a>ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2012/04/javascript_programming_style.html">Javascript ç¼–ç¨‹é£æ ¼ï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CORS è¯¦è§£ï¼Œç»ˆäºä¸ç”¨æ‹…å¿ƒè·¨åŸŸé—®é¢˜äº†]]></title>
            <link>https://github.com/toFrankie/blog/issues/243</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/243</guid>
            <pubDate>Sun, 26 Feb 2023 11:19:00 GMT</pubDate>
            <description><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">CORS</a> æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯<strong>è·¨åŸŸèµ„æºå…±äº«</strong>ï¼ˆCross-Origin Resource Sharingï¼‰ï¼Œä¹Ÿæœ‰è¯‘ä¸ºâ€œè·¨æºèµ„æºå…±äº«â€çš„ã€‚</]]></description>
            <content:encoded><![CDATA[<p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">CORS</a> æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯<strong>è·¨åŸŸèµ„æºå…±äº«</strong>ï¼ˆCross-Origin Resource Sharingï¼‰ï¼Œä¹Ÿæœ‰è¯‘ä¸ºâ€œè·¨æºèµ„æºå…±äº«â€çš„ã€‚</p>
<p>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>ï¼ˆXHRï¼‰ æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API</a> è·¨åŸŸ HTTP è¯·æ±‚ï¼Œä»è€Œå…‹æœäº†<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html">åŒæº</a>ä½¿ç”¨çš„é™åˆ¶ã€‚</p>
<blockquote>
<p>æœ¬æ–‡å†…å®¹ä¸»è¦å‚è€ƒäº<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a>å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">MDN ç›¸å…³æ–‡æ¡£</a>ã€‚</p>
</blockquote>
<h2>ä¸€ã€ç®€ä»‹</h2>
<p>CORS æ˜¯ HTTP çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯æ¥æŒ‡å®šå“ªäº›ä¸»æœºå¯ä»¥ä»è¿™ä¸ªæœåŠ¡ç«¯åŠ è½½èµ„æºã€‚</p>
<p>CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIE æµè§ˆå™¨ä¸èƒ½ä½äº IE10ã€‚</p>
<p>æ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸åŒæºçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAX è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„ä»¶çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå¤„ä¸€æ¬¡é™„ä»¶çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚</p>
<p>å› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼ˆå“åº”æŠ¥æ–‡åŒ…æ‹¬äº†æ­£ç¡®çš„ CORS å“åº”å¤´ï¼‰ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</p>
<h2>äºŒã€åŒæºå®‰å…¨ç­–ç•¥</h2>
<p>åŒæºç­–ç•¥æ˜¯ä¸€ä¸ªé‡è¦çš„å®‰å…¨ç­–ç•¥ï¼Œå®ƒç”¨äºé™åˆ¶ä¸€ä¸ª Origin çš„æ–‡æ¡£æˆ–å®ƒåŠ è½½çš„è„šæœ¬å¦‚ä½•èƒ½ä¸å¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚å®ƒèƒ½å¸®åŠ©é˜»éš”æ¶æ„æ–‡æ¡£ï¼Œå‡å°‘å¯èƒ½è¢«æ”»å‡»çš„åª’ä»‹ã€‚</p>
<p><strong>å¦‚æœä¸¤ä¸ª URL çš„<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Protocol">åè®®</a>ï¼ˆProtocolï¼‰ã€<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Host">ä¸»æœº</a>ï¼ˆHostï¼‰ã€<a href="https://developer.mozilla.org/en-US/docs/Glossary/Port">ç«¯å£</a>ï¼ˆPortï¼Œå¦‚æœæœ‰æŒ‡å®šçš„è¯ï¼‰éƒ½ç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª URL æ˜¯åŒæºçš„ï¼Œå¦åˆ™æ˜¯ä¸åŒæºçš„ã€‚</strong></p>
<p>ä¸‹è¡¨ç»™å‡ºäº†ä¸ URL <code>http://store.company.com/dir/page.html</code> çš„æºè¿›è¡Œå¯¹æ¯”çš„ç¤ºä¾‹:</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>ç»“æœ</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://store.company.com/dir2/other.html">http://store.company.com/dir2/other.html</a></td>
<td>åŒæº</td>
<td>åªæœ‰è·¯å¾„ä¸åŒã€‚</td>
</tr>
<tr>
<td><a href="http://store.company.com/dir/inner/another.html">http://store.company.com/dir/inner/another.html</a></td>
<td>åŒæº</td>
<td>åªæœ‰è·¯å¾„ä¸åŒã€‚</td>
</tr>
<tr>
<td><a href="https://store.company.com/secure.html">https://store.company.com/secure.html</a></td>
<td>ä¸åŒæº</td>
<td>åè®®ä¸åŒã€‚</td>
</tr>
<tr>
<td><a href="http://store.company.com:81/dir/etc.html">http://store.company.com:81/dir/etc.html</a></td>
<td>ä¸åŒæº</td>
<td>ç«¯å£ä¸åŒï¼ˆhttp:// é»˜è®¤ç«¯å£æ˜¯ 80ï¼‰ã€‚</td>
</tr>
<tr>
<td><a href="http://news.company.com/dir/other.html">http://news.company.com/dir/other.html</a></td>
<td>ä¸åŒæº</td>
<td>ä¸»æœºä¸åŒã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…³äº IE æµè§ˆå™¨çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy#ie_%E4%B8%AD%E7%9A%84%E7%89%B9%E4%BE%8B">ç‰¹ä¾‹</a>ï¼Œå…¶ä¸­å·®å¼‚ç‚¹æ˜¯ä¸è§„èŒƒçš„ï¼Œå…¶ä»–æµè§ˆå™¨æœªåšå‡ºæ”¯æŒã€‚</p>
</blockquote>
<p>å‡ºäºå®‰å…¨æ€§ï¼Œæµè§ˆå™¨é™åˆ¶è„šæœ¬å†…å‘èµ·çš„è·¨åŸŸ HTTP è¯·æ±‚ï¼Œä¾‹å¦‚å¸¸è§çš„ XHRã€Fetch API éƒ½éµå¾ªåŒæºç­–ç•¥ã€‚</p>
<h2>ä¸‰ã€ä¸¤ç§è¯·æ±‚</h2>
<p>æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼š</p>
<ul>
<li><strong>ç®€å•è¯·æ±‚</strong>ï¼ˆsimple requestï¼‰</li>
<li><strong>éç®€å•è¯·æ±‚</strong>ï¼ˆnot-so-simple requestï¼‰</li>
</ul>
<p>è‹¥æ»¡è¶³ä¸‹è¿°æ‰€æœ‰æ¡ä»¶ï¼Œåˆ™ä¸ºç®€å•è¯·æ±‚ï¼Œå¦åˆ™ä¸ºéç®€å•è¯·æ±‚ã€‚</p>
<ul>
<li>
<p>è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§ä¹‹ä¸€ï¼š</p>
<ul>
<li><code>HEAD</code></li>
<li><code>GET</code></li>
<li><code>POST</code></li>
</ul>
</li>
<li>
<p>HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p>
<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Content-Type</code></li>
<li><code>DPR</code></li>
<li><code>Downlink</code></li>
<li><code>Save-Data</code></li>
<li><code>Viewport-Width</code></li>
<li><code>Width</code></li>
</ul>
</li>
<li>
<p>Content-Type çš„å€¼ä»…é™äºä»¥ä¸‹ä¸‰ç§ä¹‹ä¸€</p>
<ul>
<li><code>text/plain</code></li>
<li><code>multipart/form-data</code></li>
<li><code>application/x-www-form-urlencoded</code></li>
</ul>
</li>
<li>
<p>è¯·æ±‚ä¸­çš„ä»»æ„ <code>XMLHttpRequestUpload</code> å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ã€‚</p>
</li>
<li>
<p>è¯·æ±‚ä¸­æ²¡æœ‰ä½¿ç”¨ <code>ReadableStream</code> å¯¹è±¡ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„: è¿™äº›è·¨ç«™ç‚¹è¯·æ±‚ä¸æµè§ˆå™¨å‘å‡ºçš„å…¶ä»–è·¨ç«™ç‚¹è¯·æ±‚å¹¶æ— äºŒè‡´ã€‚å¦‚æœæœåŠ¡å™¨æœªè¿”å›æ­£ç¡®çš„å“åº”é¦–éƒ¨ï¼Œåˆ™è¯·æ±‚æ–¹ä¸ä¼šæ”¶åˆ°ä»»ä½•æ•°æ®ã€‚å› æ­¤ï¼Œé‚£äº›ä¸å…è®¸è·¨ç«™ç‚¹è¯·æ±‚çš„ç½‘ç«™æ— éœ€ä¸ºè¿™ä¸€æ–°çš„ HTTP è®¿é—®æ§åˆ¶ç‰¹æ€§æ‹…å¿ƒã€‚</p>
</blockquote>
<h2>å››ã€ç®€å•è¯·æ±‚</h2>
<p>ä¸€ä¸ªç®€å•çš„ XHR è¯·æ±‚ç¤ºä¾‹ï¼š</p>
<p>å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼š</p>
<pre><code class="language-js">// Client å®¢æˆ·ç«¯ï¼ˆhttp://192.168.1.105:8080ï¼‰
function xhrRequest() {
  // åˆ›å»º xhr å¯¹è±¡
  const xhr = new XMLHttpRequest()

  // é€šè¿‡ onreadystatechange äº‹ä»¶æ•è·è¯·æ±‚çŠ¶æ€çš„å˜åŒ–
  // å¿…é¡»åœ¨ open ä¹‹å‰æŒ‡å®šè¯¥äº‹ä»¶ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶ readyState 0 å’Œ 1 çš„çŠ¶æ€
  xhr.onreadystatechange = () =&gt; {
    console.log(xhr.status)
    console.log(xhr.readyState)
  }

  // æ•è·é”™è¯¯
  xhr.onerror = err =&gt; {
    console.log('error:', err)
  }

  // åˆå§‹åŒ–è¯·æ±‚
  xhr.open('GET', 'http://192.168.1.105:7701/config', true)

  // å‘é€è¯·æ±‚
  xhr.send(null)
}

xhrRequest()
</code></pre>
<p>æœåŠ¡ç«¯ï¼ˆServerï¼‰ï¼š</p>
<pre><code class="language-js">// Server æœåŠ¡ç«¯ï¼ˆé€šè¿‡ node å‘½ä»¤å³å¯å¯åŠ¨ï¼Œhttp://192.168.1.105:7701ï¼‰
const http = require('http')
const port = 7701
const allowedOrigin = 'http://192.168.1.105:8080' // è¿™ä¸ªæ˜¯æˆ‘æœ¬åœ°å®¢æˆ·ç«¯çš„ Originï¼ˆæºï¼‰

const server = http.createServer((request, response) =&gt; {
  if (request.headers.origin === allowedOrigin) {
    response.setHeader('Access-Control-Allow-Origin', allowedOrigin)
  }
  if (request.url === '/config') {
    response.end(JSON.stringify({ name: 'Frankie', age: 20 }))
  }
})

server.listen(port)
</code></pre>
<p>å‘èµ· XHR HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚ï¼ˆView sourceï¼‰</p>
<h3>1. åŸºæœ¬æµç¨‹</h3>
<p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª <code>Origin</code> å­—æ®µã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šç¤ºä¾‹å‘èµ· <code>HTTP GET</code> è¯·æ±‚ï¼Œè¯·æ±‚æŠ¥æ–‡å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">GET /config HTTP/1.1
Host: 192.168.1.105:7701
Connection: keep-alive
User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1
Accept: */*
Origin: http://192.168.1.105:8080
Referer: http://192.168.1.105:8080/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
</code></pre>
<p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼Œ<code>Origin</code> å­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + ä¸»æœº + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œç»å¯¹æ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚</p>
<p>å¦‚æœ <code>Origin</code> æŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£ç¡®çš„ HTTP å›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å« <code>Access-Control-Allow-Origin</code> å­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢« <code>XMLHttpRequest</code> çš„ <code>onerror</code> å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€è¯†åˆ«ï¼Œå› ä¸º HTTP å›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯ <code>200</code>ã€‚</p>
<p>åœ¨ä¸Šè¿°æœåŠ¡ç«¯ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šçš„æºå°±æ˜¯ <code>http://192.168.1.105:8080</code>ï¼Œå› æ­¤å¯ä»¥æ­£å¸¸å‘èµ·è¯·æ±‚ï¼Œå¹¶æ‹¿åˆ°æ¥å£å“åº”æ•°æ®ï¼š<code>{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20}</code>ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬å°†æœåŠ¡ç«¯ç¤ºä¾‹è®¸å¯çš„ <code>Origin</code> å»æ‰ï¼š</p>
<pre><code class="language-js">// if (request.headers.origin === allowedOrigin) {
//  response.setHeader('Access-Control-Allow-Origin', allowedOrigin)
// }
</code></pre>
<p>æˆ‘ä»¬å†æ¬¡å‘èµ· <code>/config</code> è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æŠ›å‡ºè·¨åŸŸé”™è¯¯äº†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7878ba1c5feedcae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡æ— è®ºä»æ§åˆ¶å°çœ‹åˆ°çš„æŠ¥é”™ã€è¿˜æ˜¯ Network  é€‰é¡¹å¡çš„ Failed to load response dataï¼Œéƒ½å¯ä»¥çŸ¥é“æˆ‘ä»¬çš„è¯·æ±‚å¤±è´¥äº†ã€‚ä½†......å…¶å®æ˜¯è¿™æ ·çš„ï¼š<strong>å°±æœ¬æ–‡æœåŠ¡ç«¯ç¤ºä¾‹è€Œè¨€ï¼Œå³ä½¿æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œä¹Ÿæ˜¯ä¼šè¿”å›å“åº”æ•°æ®çš„ï¼Œåªæ˜¯ JavaScript è„šæœ¬è·å–åˆ°çš„ç»“æœæ˜¯â€œå¤±è´¥â€è€Œå·²ã€‚</strong></p>
<p>é‚£ä¸å¯¹å•Šï¼Œå¦‚æœæœåŠ¡å™¨æ­£å¸¸è¿”å›æ•°æ®ï¼Œè€Œå‰ç«¯å´å¤±è´¥äº†ï¼Œé‚£ä¿¡æ¯ä¸å¯¹ç§°å•Šï¼Œä¸­é—´å•†èµšå·®ä»·äº†ï¼Ÿæ€ä¹ˆå›äº‹å‘¢ï¼ŸåŸå› æ˜¯æµè§ˆå™¨åœ¨ä¸­é—´æé¬¼ï¼Œé‚£æµè§ˆå™¨åœ¨ä¸­é—´æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿ</p>
<p>å½“å‘èµ· CORS è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨é¦–å…ˆä¼šåœ¨è¯·æ±‚æŠ¥æ–‡ä¸Šè‡ªåŠ¨åŠ ä¸Š <code>Origin</code> çš„å­—æ®µï¼ˆå®ƒçš„å€¼ç”±å½“å‰é¡µé¢çš„ Protocol + Host + Port éƒ¨åˆ†ç»„æˆï¼‰ï¼Œåˆ°è¾¾æœåŠ¡ç«¯ä¹‹åï¼Œä¼šåšå‡ºç›¸åº”çš„å¤„ç†å¹¶è¿”å›æ•°æ®ã€‚ç”±äºæœåŠ¡ç«¯å¹¶æ²¡æœ‰ç»™å“åº”æŠ¥æ–‡çš„å¤´éƒ¨è®¾ç½® <code>Access-Control-Allow-Origin</code>ï¼ˆå‰é¢è¯´æŠŠè¿™å—æ³¨é‡Šæ‰äº†ï¼‰ï¼Œè‡ªç„¶æµè§ˆå™¨æ¥æ”¶åˆ°çš„å“åº”æŠ¥æ–‡ä¸­å°±ä¸å« <code>Access-Control-Allow-Origin</code>ï¼Œå½“æµè§ˆå™¨åˆ¤æ–­åˆ°è¯·æ±‚æŠ¥æ–‡ä¸å“åº”æŠ¥æ–‡çš„ <code>Origin</code> ä¸ç›¸ç­‰ï¼Œæ­¤æ—¶å®ƒä¸ä¼šå°†æœåŠ¡å™¨çš„å“åº”æ•°æ® JavaScript è„šæœ¬ï¼Œå³æˆ‘ä»¬çš„ XHR å¯¹è±¡æ— æ³•å¾—åˆ°æœåŠ¡å™¨çš„å“åº”æ•°æ®ï¼Œå¹¶ä¸”ä¼šè§¦å‘ XHR å¯¹è±¡çš„ <code>onerror</code> äº‹ä»¶ï¼Œè®©è„šæœ¬æ¥æ•è·é”™è¯¯ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±çœ‹åˆ°è¯·æ±‚å¤±è´¥äº†ã€‚ï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æŠ“åŒ…å·¥å…·æŸ¥çœ‹æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼‰</p>
<p>è¿˜æœ‰ï¼Œåªæœ‰åœ¨ <code>Origin</code> æŒ‡å®šçš„æºåœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨å“åº”æŠ¥æ–‡æ‰ä¼šå¤šå‡ºè¿™äº› <code>Access-Control-Allow-Origin</code>ã€<code>Access-Control-Allow-Credentials</code>ã€<code>Access-Control-Expose-Headers</code> å¤´ä¿¡æ¯å­—æ®µã€‚ï¼ˆå¯ä»å®¢æˆ·ç«¯ Network é€‰é¡¹å¡è§‚å¯Ÿåˆ°ï¼‰</p>
</blockquote>
<p>ä»¥ä¸‹ä¸ CORS è¯·æ±‚ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µï¼Œéƒ½ä»¥ <code>Access-Control-</code> å¼€å¤´ã€‚</p>
<pre><code class="language-text">Access-Control-Allow-Origin: http://10.16.4.226:8080
Access-Control-Allow-Credentials: true
Access-Control-Expose-Headers: Date
</code></pre>
<ul>
<li><strong>Access-Control-Allow-Origin</strong></li>
</ul>
<p>è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶ <code>Origin</code> å­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª <code>*</code>ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„çš„æºï¼ˆåŸŸåï¼‰çš„è¯·æ±‚ã€‚</p>
<ul>
<li><strong>Access-Control-Allow-Credentials</strong></li>
</ul>
<p>è¿™ä¸ªå­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸º <code>true</code>ï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookie å¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸º <code>true</code>ï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€ Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚</p>
<pre><code class="language-js">// Client
xhr.withCredentials = true

// Server
response.setHeader('Access-Control-Allow-Credentials', true)
</code></pre>
<p>å½“å®¢æˆ·ç«¯æºå¸¦ Cookie å‘èµ·è¯·æ±‚ï¼ŒåŒæ—¶æœåŠ¡ç«¯å…è®¸æºå¸¦ Cookie çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚æŠ¥æ–‡åŒ…å«äº† Cookie ä¿¡æ¯ï¼š</p>
<pre><code class="language-jsx">Cookie: username=Frankie
</code></pre>
<ul>
<li><strong>Access-Control-Expose-Headers</strong></li>
</ul>
<p>è¿™ä¸ªå­—æ®µå¯é€‰ã€‚CORS è¯·æ±‚æ—¶ï¼Œ<code>XMLHttpRequest</code> å¯¹è±¡çš„ <code>getResponseHeader()</code> æ–¹æ³•åªèƒ½æ‹¿åˆ° 6 ä¸ªåŸºæœ¬å­—æ®µï¼š <code>Cache-Control</code>ã€<code>Content-Language</code>ã€<code>Content-Type</code>ã€<code>Expires</code>ã€<code>Last-Modified</code>ã€<code>Pragma</code>ã€‚å¦‚æœæƒ³è¦æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨ <code>Access-Control-Expose-Headers</code> é‡Œé¢æŒ‡å®šã€‚ï¼ˆä½†ç”±äº W3C çš„é™åˆ¶ï¼Œä¸æŒ‡å®šçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è·å–åˆ°çš„å€¼å¯èƒ½ä¸º <code>null</code>ï¼‰</p>
<p>ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯å°† <code>Access-Control-Expose-Headers</code> æŒ‡å®šä¸º <code>&quot;Date,Access-Control-Allow-Origin&quot;</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ XMLHttpRequest å¯¹è±¡çš„ getResponseHeader() æ–¹æ³•è·å–å¯¹åº”å­—æ®µçš„å€¼ã€‚</p>
<pre><code class="language-js">// Client
xhr.onreadystatechange = () =&gt; {
  if (xhr.status === 200 &amp;&amp; xhr.readyState === 4) {
    console.log(xhr.getResponseHeader('Cache-Control')) // null
    console.log(xhr.getResponseHeader('Content-Language')) // null
    console.log(xhr.getResponseHeader('Content-Type')) // null
    console.log(xhr.getResponseHeader('Expires')) // null
    console.log(xhr.getResponseHeader('Last-Modified')) // null
    console.log(xhr.getResponseHeader('Pragma')) // null
    console.log(xhr.getResponseHeader('Date')) // &quot;Sun, 06 Jun 2021 14:34:34 GMT&quot;
    console.log(xhr.getResponseHeader('Access-Control-Allow-Origin')) // &quot;http://192.168.1.105:8080&quot;
    console.log(xhr.getResponseHeader('X-Custom-Header')) // Error: Refused to get unsafe header &quot;X-Custom-Header&quot;
  }
}

// Server
if (request.headers.origin === allowedOrigin) {
  response.setHeader('Access-Control-Allow-Origin', allowedOrigin)
  response.setHeader('Access-Control-Allow-Credentials', true)
  response.setHeader('Access-Control-Expose-Headers', 'Date,Access-Control-Allow-Origin')
}
</code></pre>
<blockquote>
<p>å¦‚æœè¿æ¥æœªå®Œæˆï¼Œå“åº”ä¸­ä¸å­˜åœ¨æŠ¥æ–‡é¡¹ï¼Œæˆ–è€…è¢« W3C é™åˆ¶ï¼Œåˆ™è¿”å› <code>null</code>ã€‚å‡è®¾å¦‚ä¸Šç¤ºä¾‹ï¼Œè‡ªå®šä¹‰å¤´ä¿¡æ¯ <code>X-Custom-Header</code> å­—æ®µï¼Œä¸”æœåŠ¡ç«¯æœªå¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ï¼š<code>Refused to get unsafe header &quot;X-Custom-Header&quot;</code></p>
</blockquote>
<h3>2. withCredentials å±æ€§</h3>
<p>ä¸Šé¢è¯´åˆ°ï¼ŒCORS è¯·æ±‚é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ã€‚å¦‚æœè¦æŠŠ Cookie å‘é€åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®š <code>Access-Control-Allow-Credentials</code> å­—æ®µã€‚</p>
<pre><code>Access-Control-Allow-Credentials: true
</code></pre>
<p>å¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨ AJAX è¯·æ±‚ä¸­æ‰“å¼€ <code>withCredentials</code> å±æ€§ã€‚</p>
<pre><code class="language-js">xhr.withCredentials = true
</code></pre>
<p>å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€ Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…æœåŠ¡å™¨è¦æ±‚è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœçœç•¥ <code>withCredentials</code> è®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€ Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾ç¤ºå…³é—­ <code>withCredentials</code>ã€‚</p>
<pre><code class="language-js">xhr.withCredentials = false
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€ Cookieï¼Œ<code>Access-Control-Allow-Origin</code> å°±ä¸èƒ½è®¾ä¸º <code>*</code>ï¼ˆå¦åˆ™ä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼‰ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookie ä¾ç„¶éµå¾ªåŒæºç­–ç•¥ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ Cookie æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ Cookie å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„ <code>document.cookie</code> ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ Cookieã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eb3855042a1f7a0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>äº”ã€éç®€å•è¯·æ±‚</h2>
<p>è°ƒæ•´ä¸€ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// Client å®¢æˆ·ç«¯
function xhrRequest() {
  // åˆ›å»º xhr å¯¹è±¡
  const xhr = new XMLHttpRequest()

  // é€šè¿‡ onreadystatechange äº‹ä»¶æ•è·è¯·æ±‚çŠ¶æ€çš„å˜åŒ–
  xhr.onreadystatechange = () =&gt; {
    console.log(xhr.status)
    console.log(xhr.readyState)

    if (xhr.status === 200 &amp;&amp; xhr.readyState === 4) {
      console.log(xhr.getResponseHeader('Date'))
      console.log(xhr.getResponseHeader('Access-Control-Allow-Origin'))
    }
  }

  // æ•è·é”™è¯¯
  xhr.onerror = err =&gt; {
    console.log('error:', err)
  }

  // åˆå§‹åŒ–è¯·æ±‚
  xhr.open('PUT', 'http://192.168.1.105:7701/config', true)

    // è®¾ç½®è‡ªå®šä¹‰å¤´éƒ¨ï¼ˆå¿…é¡»åœ¨ open ä¹‹åï¼‰
    xhr.setRequestHeader('X-Custom-Header', 'foo')

  // å‘é€è¯·æ±‚
  xhr.send(null)
}

xhrRequest()
</code></pre>
<pre><code class="language-js">// Server æœåŠ¡ç«¯
const http = require('http')
const port = 7701
const allowedOrigin = 'http://192.168.1.105:8080' // è¿™ä¸ªæ˜¯æˆ‘æœ¬åœ°å®¢æˆ·ç«¯çš„ Originï¼ˆæºï¼‰

const server = http.createServer((request, response) =&gt; {
  if (request.headers.origin === allowedOrigin) {
  response.setHeader('Access-Control-Allow-Origin', allowedOrigin)
  response.setHeader('Access-Control-Allow-Credentials', true)
  response.setHeader('Access-Control-Allow-Methods', 'PUT')
  response.setHeader('Access-Control-Allow-Headers', 'X-Custom-Header')
  response.setHeader('Access-Control-Expose-Headers', 'Date,Access-Control-Allow-Origin')
  }
  if (request.url === '/config') {
    response.end(JSON.stringify({ name: 'Frankie', age: 20 }))
  }
})

server.listen(port)
</code></pre>
<h3>1. é¢„æ£€è¯·æ±‚</h3>
<p>éç®€å•è¯·æ±‚æ—¶é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯ <code>PUT</code> æˆ– <code>DELETE</code>ï¼Œæˆ–è€… <code>Content-Type</code> å­—æ®µçš„ç±»å‹æ˜¯ <code>application/json</code>ã€‚</p>
<p>éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º<strong>é¢„æ£€è¯·æ±‚</strong>ï¼ˆpreflightï¼‰ã€‚</p>
<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº› HTTP åŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„ XMLHttpRequest è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒHTTP è¯·æ±‚çš„æ–¹æ³•æ˜¯ <code>PUT</code>ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯ <code>X-Custom-Header</code>ã€‚</p>
<p>æµè§ˆå™¨å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ªâ€œé¢„æ£€è¯·æ±‚â€ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªâ€œé¢„æ£€è¯·æ±‚â€çš„ HTTP å¤´ä¿¡æ¯ã€‚</p>
<pre><code class="language-text">OPTIONS /config HTTP/1.1
Host: 192.168.1.105:7701
Connection: keep-alive
Accept: */*
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: x-custom-header
Origin: http://192.168.1.105:8080
User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1
Sec-Fetch-Mode: cors
Referer: http://192.168.1.105:8080/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
</code></pre>
<p>â€œé¢„æ£€è¯·æ±‚â€ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ <code>OPTIONS</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ˜¯ <code>Origin</code>ï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚</p>
<p>é™¤äº† <code>Origin</code> å­—æ®µï¼Œâ€œé¢„æ£€è¯·æ±‚â€çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚</p>
<ul>
<li>
<p><strong>Access-Control-Request-Method</strong>
è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³•ï¼Œä¸Šé¢ç¤ºä¾‹æ˜¯ PUTã€‚</p>
</li>
<li>
<p><strong>Access-Control-Request-Headers</strong>
è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªé€—å· <code>,</code> åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šé¢ç¤ºä¾‹æ˜¯ <code>X-Custom-Header</code>ã€‚</p>
</li>
</ul>
<blockquote>
<p>Tipsï¼šé¢„æ£€è¯·æ±‚å¯ä»¥åœ¨è°ƒè¯•å™¨ Network é€‰é¡¹å¡ä¸­æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d210ad9924966b6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>2. é¢„æ£€è¯·æ±‚çš„å›åº”</h3>
<p>æœåŠ¡å™¨æ”¶åˆ°â€œé¢„æ£€è¯·æ±‚â€ä»¥åï¼Œæ£€æŸ¥äº† Originã€Access-Control-Request-Method å’Œ Access-Control-Request-Headers å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨åŸŸè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚</p>
<pre><code class="language-text">HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://192.168.1.105:8080
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: PUT
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Expose-Headers: Date,Access-Control-Allow-Origin
Date: Sun, 06 Jun 2021 15:27:27 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Content-Length: 27
</code></pre>
<p>ä¸Šé¢çš„ HTTP å›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯ <code>Access-Control-Allow-Origin</code> å­—æ®µï¼Œè¡¨ç¤º <code>http://192.168.1.105:8080</code> å¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸º <code>*</code>ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„çš„è·¨æºè¯·æ±‚ã€‚ï¼ˆæœ¬ç¤ºä¾‹æºå¸¦äº† Cookie ä¿¡æ¯ï¼Œä¸å¯è®¾ä¸º <code>*</code>ï¼‰</p>
<pre><code>Access-Control-Allow-Origin: *
</code></pre>
<p>å¦‚æœæœåŠ¡å™¨å¦å®šäº†â€œé¢„æ£€è¯·æ±‚â€ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•çš„ CORS ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ˜¯ï¼Œæµè§ˆå™¨å°±è®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢« <code>XMLHttpRequest</code> å¯¹è±¡çš„ <code>onerror</code> å›è°ƒå‡½æ•°æ•è·ã€‚</p>
<p>å¦‚æœå°†æœåŠ¡ç«¯çš„ <code>Access-Control-Allow-Headers</code> æ³¨é‡Šæ‰ï¼š</p>
<pre><code class="language-js">// response.setHeader('Access-Control-Allow-Headers', 'X-Custom-Header')
</code></pre>
<p>æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5b9df24f1ba09ec0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœåŠ¡å™¨å›åº”çš„å…¶ä»– CORS ç›¸å…³å­—æ®µå¦‚ä¸‹ï¼š</p>
<pre><code>Access-Control-Allow-Methods: PUT
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 1728000
</code></pre>
<ul>
<li>
<p><strong>Access-Control-Allow-Methods</strong>
è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ï¼Œå®ƒçš„å€¼æ˜¯é€—å· <code>,</code> åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯<strong>æ‰€æœ‰</strong>æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€œé¢„æ£€è¯·æ±‚â€ã€‚(æœ¬ç¤ºä¾‹ä»…è®¾ç½®äº†ä¸€ä¸ª <code>PUT</code> æ–¹æ³•ã€‚)</p>
</li>
<li>
<p><strong>Access-Control-Allow-Headers</strong>
å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬ <code>Access-Control-Request-Headers</code> å­—æ®µï¼Œåˆ™ <code>Access-Control-Allow-Headers</code> å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å· <code>,</code> åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨â€œé¢„æ£€è¯·æ±‚â€çš„å­—æ®µã€‚</p>
</li>
<li>
<p><strong>Access-Control-Allow-Credentials</strong>
è¿™ä¸ªå­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚</p>
</li>
<li>
<p><strong>Access-Control-Max-Age</strong>
è¿™ä¸ªå­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯ 20 å¤©ï¼ˆ1728000 ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº” 1728000 ç§’ï¼ˆå³ 20 å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚</p>
</li>
</ul>
<h3>3. æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</h3>
<p>ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€œé¢„æ£€è¯·æ±‚â€ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª <code>Origin</code> å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ª <code>Access-Control-Allow-Origin</code> å¤´ä¿¡æ¯å­—æ®µã€‚</p>
<p>ä¸‹é¢æ˜¯â€œé¢„æ£€è¯·æ±‚â€ä¹‹åï¼Œæµè§ˆå™¨çš„æ­£å¸¸ CORS è¯·æ±‚çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p>
<pre><code>PUT /config HTTP/1.1
Host: 192.168.1.105:7701
Connection: keep-alive
Content-Length: 0
User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1
X-Custom-Header: foo
Accept: */*
Origin: http://192.168.1.105:8080
Referer: http://192.168.1.105:8080/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Cookie: username=Frankie
</code></pre>
<p>ä¸Šé¢çš„å¤´ä¿¡æ¯çš„ <code>Origin</code> å­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å“åº”æŠ¥æ–‡ã€‚</p>
<pre><code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://192.168.1.105:8080
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: PUT
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Expose-Headers: Date,Access-Control-Allow-Origin
Date: Sun, 06 Jun 2021 15:40:11 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Content-Length: 27
</code></pre>
<p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼Œ<code>Access-Control-Allow-Origin</code> å­—æ®µæ˜¯æ¯æ¬¡å›åº”éƒ½å¿…å®šåŒ…å«çš„ã€‚</p>
<h2>å…­ã€ä¸ JSONP çš„æ¯”è¾ƒ</h2>
<p>CORS ä¸ JSONP çš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯” JSONP æ›´å¼ºå¤§ã€‚</p>
<p>JSONP åªæ”¯æŒ <code>GET</code> è¯·æ±‚ï¼ŒCORS æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚JSONP çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒ CORS çš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚</p>
<h2>ä¸ƒã€å…¶ä»–</h2>
<h3>1. Check List</h3>
<p>å¦‚æœæŒ‰ä»¥ä¸Šè®¾ç½®åï¼Œä»ä¼šå‡ºç°è·¨åŸŸæƒ…å†µï¼Œå¯ä»¥ä»”ç»†æ£€æŸ¥ï¼š</p>
<ul>
<li>è¯·æ±‚ URL æ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯</li>
<li>è¯·æ±‚ URL æ˜¯å¦æœ‰ç©ºæ ¼ï¼ˆç‰¹åˆ«æ˜¯å¼€å¤´ç»“å°¾ï¼‰</li>
</ul>
<blockquote>
<p>è¢«å‘è¿‡ï¼Œé”™è¯¯å¾€å¾€å‡ºç°åœ¨è¿™äº›ä¸èµ·çœ¼çš„åœ°æ–¹...</p>
</blockquote>
<h3>2. HTTP headers ä¹‹ Referer</h3>
<p><code>Referer</code> è¯·æ±‚å¤´åŒ…å«äº†å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€ï¼Œå³è¡¨ç¤ºå½“å‰é¡µé¢æ˜¯é€šè¿‡æ­¤æ¥æºé¡µé¢é‡Œçš„é“¾æ¥è¿›å…¥çš„ã€‚æœåŠ¡ç«¯ä¸€èˆ¬ä½¿ç”¨ <code>Referer</code> è¯·æ±‚å¤´è¯†åˆ«è®¿é—®æ¥æºï¼Œå¯èƒ½ä¼šä»¥æ­¤è¿›è¡Œç»Ÿè®¡åˆ†æã€æ—¥å¿—è®°å½•ä»¥åŠç¼“å­˜ä¼˜åŒ–ç­‰ã€‚</p>
<p>æ³¨æ„ï¼Œå¦‚æœç›´æ¥åœ¨åœ°å€æ è¾“å…¥ URL è®¿é—®æŸç½‘é¡µï¼Œè¿™æ—¶ <code>Referer</code> ä¸ºç©ºã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸Šé¢ç¤ºä¾‹ä¸­è¯·æ±‚ <code>/config</code> æ¥å£çš„ç½‘é¡µåœ°å€æ˜¯ <code>http://192.168.1.105:8080/#/about</code>ï¼Œä»è¯·æ±‚æŠ¥æ–‡å¯ä»¥å¤§è‡´çœ‹åˆ°  <code>Origin</code> ä¸ <code>Referer</code> çš„åŒºåˆ«ã€‚</p>
<pre><code class="language-text">Origin: http://192.168.1.105:8080
Referer: http://192.168.1.105:8080/
</code></pre>
<ul>
<li>
<p>Origin
<code>Origin</code> çš„å€¼å¯ä»¥ç½®ç©ºæˆ–è€…æ˜¯ <code>&lt;scheme&gt;://&lt;host&gt; [:&lt;port&gt;]</code>ï¼Œå³åè®® + ä¸»æœº + ç«¯å£ã€‚å…¶ä¸­ä¸»æœºæ˜¯æŒ‡åŸŸåæˆ–è€… IP åœ°å€ï¼›ç«¯å£å·å¯é€‰ï¼Œç¼ºçœæ—¶ä¸ºæœåŠ¡çš„é»˜è®¤ç«¯å£ï¼ˆä¾‹å¦‚ HTTP è¯·æ±‚é»˜è®¤ç«¯å£æ˜¯ <code>80</code>ï¼ŒHTTPS è¯·æ±‚é»˜è®¤ç«¯å£æ˜¯ <code>443</code>ï¼‰</p>
</li>
<li>
<p>Referer
å½“å‰é¡µé¢è¢«é“¾æ¥è€Œè‡³çš„å‰ä¸€é¡µé¢çš„ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„ã€‚ä¸åŒ…å« URL fragments (ä¾‹å¦‚ <code>&quot;#section&quot;</code>) å’Œ userinfo (ä¾‹å¦‚ <code>&quot;https://username:password@example.com/foo/bar/&quot;</code> ä¸­çš„ <code>&quot;username:password&quot;</code> )ã€‚</p>
</li>
</ul>
<p>ä¸Šé¢çš„è§£é‡Šæ¯”è¾ƒå®˜æ–¹ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä» GitHub ä»“åº“ç‚¹å‡»è·³è½¬è‡³ç®€ä¹¦æ–‡ç« ï¼Œå¯ä»¥ä» HTML çš„è¯·æ±‚æŠ¥æ–‡çœ‹åˆ°ï¼š</p>
<pre><code class="language-text">Host: www.jianshu.com
Referer: https://github.com/toFrankie/csscomb-mini
</code></pre>
<p>å‡è®¾æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯ç»Ÿè®¡ä» GitHub è®¿é—®ç®€ä¹¦çš„è®¿é—®é‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ <code>Referer</code> æ¥å®ç°ã€‚ä¹Ÿå¸¸ç”¨äºé˜²ç›—é“¾ç­‰ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Referer</code> çš„æ­£ç¡®è‹±è¯­æ‹¼æ³•æ˜¯ <strong>referrer</strong>ã€‚ç”±äºæ—©æœŸ HTTP è§„èŒƒçš„æ‹¼å†™é”™è¯¯ï¼Œä¸ºä¿æŒ<a href="https://www.wikiwand.com/zh/%E5%90%91%E4%B8%8B%E5%85%BC%E5%AE%B9%22">å‘ä¸‹å…¼å®¹</a>å°±å°†é”™å°±é”™äº†ã€‚ä¾‹å¦‚ <a href="https://www.w3.org/TR/DOM-Level-2-Core/">DOM Level 2</a>ã€<a href="https://w3c.github.io/webappsec-referrer-policy/#directive-referrer">Referrer Policy</a> ç­‰å…¶ä»–ç½‘ç»œæŠ€æœ¯çš„è§„èŒƒæ›¾è¯•å›¾ä¿®æ­£æ­¤é—®é¢˜ï¼Œä½¿ç”¨æ­£ç¡®æ‹¼æ³•ï¼Œå¯¼è‡´ç›®å‰æ‹¼æ³•å¹¶ä¸ç»Ÿä¸€ã€‚</p>
</blockquote>
<!--
### TODO

1. ä»€ä¹ˆæ˜¯ HEAD è¯·æ±‚
2. åŒæºã€è·¨æºæºå¸¦ cookie çš„åŒºåˆ«
3. Access-Control-Allow-Origin èƒ½ä¸èƒ½æŒ‡å®šå¤šä¸ªå…·ä½“çš„æº
-->
<h2>å…«ã€References</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">CORS Glossary</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£ï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS |ï¼ˆéšå¼ï¼‰æ•°æ®ç±»å‹è½¬æ¢è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/242</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/242</guid>
            <pubDate>Sun, 26 Feb 2023 11:15:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fcb4a65abb25c695.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fcb4a65abb25c695.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-5b1cfc0311906dab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p>åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œæ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢æ— å¤„ä¸åœ¨ã€‚å³ä½¿ä½ æ²¡æœ‰ä¸»åŠ¨æ˜¾å¼åœ°å»è½¬æ¢ï¼Œä½† JavaScript åœ¨ç§åº•ä¸‹â€œå·å·åœ°â€å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šç±»å‹è½¬æ¢çš„å·¥ä½œã€‚é‚£ä¹ˆï¼Œå®ƒä»¬ç©¶ç«Ÿæ˜¯æŒ‰ç…§ä»€ä¹ˆè§„åˆ™å»è½¬æ¢çš„å‘¢ï¼Ÿæˆ‘ä»¬è¯•å›¾åœ¨æœ¬æ–‡ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œæ¥è§£å¼€è°œåº•ã€‚</p>
<p>ECMAScript æ˜¯è´Ÿè´£åˆ¶å®šæ ‡å‡†çš„ï¼Œè€Œ JavaScript åˆ™æ˜¯å‰è€…çš„ä¸€ç§å®ç°ã€‚</p>
<p>åœ¨ ECMAScript æ ‡å‡†ä¸­å®šä¹‰ä¸€ç»„è½¬æ¢æŠ½è±¡æ“ä½œï¼Œå¸¸è§çš„æŠ½è±¡æ“ä½œï¼ˆAbstract Operationï¼‰æœ‰ <code>ToPrimitive</code>ã€<code>ToBoolean</code>ã€<code>ToNumber</code>ã€<code>ToString</code>ã€<code>ToObject</code> ç­‰ç­‰ã€‚</p>
<h3>ä¸€ã€ToPrimitive</h3>
<h5>1. ToPrimitive</h5>
<p>åœ¨ ECMAScript æ ‡å‡†ä¸­ï¼Œä½¿ç”¨ ToPrimitive æŠ½è±¡æ“ä½œ<strong>å°†å¼•ç”¨ç±»å‹è½¬æ¢ä¸ºåŸå§‹ç±»å‹</strong>ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-toprimitive">#sec-7.1.1</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a712bfea99847af5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToPrimitive Abstract Operation"></p>
<blockquote>
<p>ToPrimitive(input[, PerferredType])</p>
</blockquote>
<p>å‚æ•° <code>input</code> æ˜¯æ–‡ç« å¼€å¤´æåˆ°çš„ 8 ç§æ•°æ®ç±»å‹çš„å€¼ï¼ˆUndefinedã€Nullã€Booleanã€Stringã€Symbolã€Numberã€BigIntã€Objectï¼‰ã€‚å‚æ•° <code>PreferredType</code> æ˜¯å¯é€‰çš„ï¼Œè¡¨ç¤ºè¦è½¬æ¢åˆ°çš„åŸå§‹å€¼çš„é¢„æœŸç±»å‹ï¼Œå–å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸² <code>&quot;default&quot;</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>&quot;string&quot;</code>ã€<code>&quot;number&quot;</code> ä¹‹ä¸€ã€‚</p>
<p><strong>ToPrimitive æ“ä½œï¼Œå¯æ¦‚æ‹¬å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li><code>input</code> æ˜¯ ECMAScript è¯­è¨€ç±»å‹çš„å€¼ã€‚</li>
<li>å¦‚æœ <code>input</code> æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆ
<ol>
<li>å¦‚æœæ²¡æœ‰ä¼ é€’ <code>PreferredType</code> å‚æ•°ï¼Œä½¿ <code>hint</code> ç­‰äº <code>&quot;default&quot;</code>ã€‚</li>
<li>å¦‚æœå‚æ•° <code>PreferredType</code> æç¤º String ç±»å‹ï¼Œä½¿ <code>hint</code> ç­‰äº <code>&quot;string&quot;</code>ã€‚</li>
<li>å¦åˆ™ï¼Œå‚æ•° <code>PreferredType</code> æç¤º Number ç±»å‹ï¼Œä½¿ <code>hint</code> ç­‰äº <code>&quot;number&quot;</code>ã€‚</li>
<li>ä½¿ <code>exoticToPrim</code> ç­‰äº <code>GetMethod(input, @@toPrimitive)</code> çš„ç»“æœï¼ˆå¤§è‡´æ„æ€æ˜¯ï¼Œè·å– <code>input</code> å¯¹è±¡çš„ <code>@@toPrimitive</code> å±æ€§å€¼ï¼Œå¹¶å°†å…¶èµ‹ç»™ <code>exoticToPrim</code>ï¼‰ã€‚</li>
<li>å¦‚æœ <code>exoticToPrim</code> ä¸ç­‰äº <code>undefined</code>ï¼ˆå³ <code>input</code> å¯¹è±¡å« <code>@@toPrimitive</code> å±æ€§ï¼‰ï¼Œé‚£ä¹ˆ
<ol>
<li>ä½¿ <code>result</code> ç­‰äº <code>Call(exoticToPrim, input, Â« hint Â»)</code> çš„ç»“æœï¼ˆå¤§è‡´æ„æ€æ˜¯ï¼Œæ‰§è¡Œ <code>@@toPrimitive</code> æ–¹æ³•ï¼Œå³ <code>exoticToPrim(hint)</code>ï¼‰ã€‚</li>
<li>å¦‚æœ <code>result</code> ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™è¿”å› <code>result</code>ã€‚</li>
<li>å¦åˆ™æŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚</li>
</ol>
</li>
<li>å¦‚æœ <code>hint</code> æ˜¯ <code>&quot;default&quot;</code>ï¼Œåˆ™å°† <code>hint</code> è®¾ä¸º <code>&quot;number&quot;</code>ã€‚</li>
<li>è¿”å› <code>OrdinaryToPrimitive(input, hint)</code>ã€‚</li>
</ol>
</li>
<li>è¿”å› <code>input</code>ï¼ˆå³åŸå§‹ç±»å‹çš„å€¼ç›´æ¥è¿”å›ï¼‰ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šå½“ä¸å¸¦ <code>hint</code> å»è°ƒç”¨ ToPrimitive æŠ½è±¡æ“ä½œæ—¶ï¼Œé€šå¸¸å®ƒçš„è¡Œä¸ºå°±åƒ <code>hint</code> æ˜¯ <code>Number</code> ç±»å‹ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œï¼ˆæ´¾ç”Ÿï¼‰å¯¹è±¡å¯ä»¥é€šè¿‡å®šä¹‰ <code>@@toPrimitive</code> æ–¹æ³•æ¥æ›¿ä»£æ­¤è¡Œä¸ºã€‚åœ¨æœ¬è§„èŒƒä¸­å®šä¹‰çš„å¯¹è±¡é‡Œï¼Œåªæœ‰ <code>Date</code> å¯¹è±¡ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-date.prototype-@@toprimitive">#sec-20.4.4.45</a>ï¼‰å’Œ <code>Symbol</code> å¯¹è±¡ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-symbol.prototype-@@toprimitive">#sec-19.4.3.5</a>ï¼‰ä¼šè¦†ç›–é»˜è®¤çš„ ToPrimitive è¡Œä¸ºã€‚</p>
</blockquote>
<blockquote>
<p>å…¶ä»–ï¼š</p>
<ol>
<li>ä»¥ä¸Šæåˆ°çš„ <code>@@toPrimitive</code> æ–¹æ³•ï¼Œå³å±æ€§åç§°ä¸º <code>[Symobl.toPrimitive]</code> çš„æ–¹æ³•ã€‚</li>
<li><code>Date</code> å¯¹è±¡çš„ <code>@@toPrimitive</code> æ–¹æ³•å®šä¹‰ï¼šå½“ <code>hint</code> ä¸º <code>&quot;default&quot;</code> æ—¶ï¼Œä¼šä½¿ <code>hint</code> ç­‰äº <code>&quot;string&quot;</code>ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ <code>Date</code> å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹å€¼æ—¶ï¼Œä¼šå…ˆè°ƒç”¨ <code>instance.toString()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>instance.valueOf()</code> æ–¹æ³•çš„åŸå› ã€‚</li>
<li>ç›®å‰ JavaScript çš„å†…ç½®å¯¹è±¡ä¸­ï¼Œå«æœ‰ <code>@@toPrimitive</code> æ–¹æ³•çš„ï¼Œåªæœ‰ <code>Date</code> å’Œ <code>Symbol</code> å¯¹è±¡ã€‚</li>
</ol>
</blockquote>
<p><strong>ç”¨å£æ°´è¯å†æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚ä¸‹ï¼ˆå“ˆå“ˆï¼‰ï¼š</strong></p>
<ol>
<li>å¦‚æœ <code>input</code> æ˜¯åŸå§‹ç±»å‹ï¼Œç›´æ¥è¿”å› <code>input</code>ï¼ˆä¸åšè½¬æ¢æ“ä½œï¼‰ã€‚</li>
<li>å¦‚æœå‚æ•° <code>PreferredType</code> æ˜¯ Stringï¼ˆNumberï¼‰ç±»å‹ï¼Œé‚£ä¹ˆä½¿å¾— <code>hint</code> ç­‰äº <code>&quot;string&quot;</code>ï¼ˆ<code>&quot;number&quot;</code>ï¼‰ï¼Œå¦åˆ™ <code>hint</code> ç­‰äºé»˜è®¤çš„ <code>&quot;default&quot;</code>ã€‚</li>
<li>å¦‚æœ <code>input</code> ä¸­å­˜åœ¨ <code>@@toPrimitive</code> å±æ€§ï¼ˆæ–¹æ³•ï¼‰ï¼Œè‹¥ <code>@@toPrimitive</code> æ–¹æ³•çš„è¿”å›å€¼ä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™ ToPrimitive çš„æ“ä½œç»“æœå°±æ˜¯è¯¥è¿”å›å€¼ï¼Œå¦åˆ™æŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚</li>
<li>å¦‚æœç»è¿‡ä»¥ä¸Šæ­¥éª¤ä¹‹å <code>hint</code> æ˜¯ <code>&quot;default&quot;</code>ï¼Œåˆ™ä½¿ <code>hint</code> ç­‰äº <code>&quot;number&quot;</code>ã€‚</li>
<li>è¿”å› <code>OrdinaryToPrimitive(input, hint)</code> æ“ä½œçš„ç»“æœã€‚</li>
</ol>
<blockquote>
<p>æé†’ï¼š</p>
<ol>
<li>
<p>å…³äº <code>Date</code> å¯¹è±¡çš„ <code>Date.prototype[@@toPrimitive]</code> å†…éƒ¨æ–¹æ³•å®ç°ï¼Œå…¶å®æ˜¯å°† <code>hint</code> ä¸º <code>&quot;default&quot;</code> çš„æƒ…å†µæ”¹ä¸º <code>&quot;string&quot;</code>ï¼Œç„¶åæ‰§è¡Œç¬¬ 5 æ­¥çš„ <code>OrdinaryToPrimitive</code> æ“ä½œã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-date.prototype-@@toprimitive">#sec-20.4.4.45</a>ï¼‰</p>
</li>
<li>
<p>å…³äº <code>Symbol</code> å¯¹è±¡çš„ <code>Symbol.prototype[@@toPrimitive]</code> å†…éƒ¨æ–¹æ³•å®ç°ï¼Œå¦‚æœä¼ é€’ç»™è¯¥æ–¹æ³•çš„æ˜¯ä¸€ä¸ª <code>Symbol</code> ç±»å‹çš„å€¼ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥å€¼ã€‚å¦‚æœè¯¥å€¼æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸”å«æœ‰å±æ€§ <code>[[SymbolData]]</code>ï¼Œè€Œä¸”è¯¥å±æ€§å€¼ä¸º <code>Symbol</code> ç±»å‹ï¼Œåˆ™è¿”å›è¯¥å±æ€§å€¼ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-symbol.prototype-@@toprimitive">#sec-19.4.3.5</a>ï¼‰</p>
</li>
</ol>
</blockquote>
<p>é‚£ä¹ˆ <code>OrdinaryToPrimitive</code> çš„æ“ä½œæ˜¯æ€æ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹...</p>
<h5>2. OrdinaryToPrimitive</h5>
<p>è¯¦æƒ…çœ‹ï¼š<a href="https://262.ecma-international.org/#sec-ordinarytoprimitive">#sec-7.1.11</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cdd7c62fd75b3802.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="OrdinaryToPrimitive Abstract Operation"></p>
<blockquote>
<p>OrdinaryToPrimitive(O, hint)</p>
</blockquote>
<p>å‚æ•° <code>O</code> ä¸ºå¼•ç”¨ç±»å‹ã€‚å‚æ•° <code>hint</code> ä¸º String ç±»å‹ï¼Œå…¶å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸² <code>&quot;string&quot;</code>ã€<code>&quot;number&quot;</code> ä¹‹ä¸€ã€‚</p>
<p><strong>ï¼ˆå®˜è¯ï¼‰OrdinaryToPrimitive æ“ä½œï¼Œå¯æ¦‚æ‹¬å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li><code>O</code> æ˜¯å¼•ç”¨ç±»å‹ã€‚</li>
<li><code>hint</code> æ˜¯ String ç±»å‹ï¼Œä¸” <code>hint</code> çš„å€¼åªèƒ½æ˜¯ <code>&quot;string&quot;</code> æˆ– <code>&quot;number&quot;</code> ä¹‹ä¸€ã€‚</li>
<li>å¦‚æœ <code>hint</code> ä¸º <code>&quot;string&quot;</code>ï¼Œä½¿ <code>methodNames</code> ç­‰äº <code>Â« &quot;toString&quot;, &quot;valueOf&quot; Â»</code>ï¼ˆå…¶ä¸­ <code>Â«Â»</code> è¡¨ç¤ºè§„èŒƒä¸­çš„ <a href="https://262.ecma-international.org/#sec-list-and-record-specification-type">List</a>ï¼Œç±»ä¼¼äºæ•°ç»„ï¼‰ã€‚</li>
<li>å¦‚æœ <code>hint</code> ä¸º <code>&quot;number&quot;</code>ï¼Œä½¿ <code>methodNames</code> ç­‰äº <code>Â« &quot;valueOf&quot;, &quot;toString&quot; Â»</code>ã€‚</li>
<li>éå† <code>methodNames</code>ï¼Œä½¿ <code>name</code> ç­‰äºæ¯ä¸ªè¿­ä»£å€¼ï¼Œå¹¶æ‰§è¡Œï¼š
<ol>
<li>ä½¿ <code>method</code> ç­‰äº <code>Get(O, name)</code>ï¼ˆå³è·å–å¯¹è±¡ <code>O</code> çš„ <code>name</code> å±æ€§ï¼Œç›¸å½“äºè·å–å¯¹è±¡çš„ <code>toString</code> æˆ– <code>valueOf</code> å±æ€§ï¼Œå…·ä½“æ‰§è¡Œé¡ºåºè§† <code>hint</code> è€Œå®šï¼‰ã€‚</li>
<li>å¦‚æœ <code>IsCallable(method)</code> ç»“æœä¸º <code>true</code>ï¼Œé‚£ä¹ˆï¼š
<ol>
<li>ä½¿ <code>result</code> ç­‰äº <code>Call(method, O)</code> ç»“æœï¼ˆå³è°ƒç”¨ <code>method()</code> æ–¹æ³•ï¼‰ã€‚</li>
<li>å¦‚æœ <code>result</code> ä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å› <code>result</code>ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>æŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚</li>
</ol>
<blockquote>
<p>å…¶ä¸­ <code>IsCallable(argument)</code> æ“ä½œï¼Œå¤§è‡´å†…å®¹æ˜¯ï¼šå½“å‚æ•° <code>argument</code> ä¸ºå¼•ç”¨ç±»å‹ä¸” <code>argument</code> å¯¹è±¡åŒ…å«å†…éƒ¨å±æ€§ <code>[[Call]]</code> æ—¶è¿”å› <code>true</code>ï¼Œ å¦åˆ™è¿”å› <code>false</code>ã€‚è¯å¥è¯è¯´ï¼Œå°±æ˜¯ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºå‡½æ•°ã€‚</p>
</blockquote>
<p><strong>ï¼ˆå£æ°´è¯ï¼‰å†æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<ol>
<li>å½“ç»è¿‡ ToPrimitive æ“ä½œï¼Œç„¶åæ‰§è¡Œ <code>OrdinaryToPrimitive(input, hint)</code> æ“ä½œï¼Œé‚£ä¹ˆæ­¥éª¤å¦‚ä¸‹ï¼š</li>
<li>å¦‚æœ <code>hint</code> ä¸º <code>&quot;string&quot;</code>ï¼Œå®ƒä¼šå…ˆè°ƒç”¨ <code>input.toString()</code> æ–¹æ³•ï¼Œ
<ol>
<li>è‹¥ <code>toString()</code>  ç»“æœä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥ç»“æœã€‚</li>
<li>å¦åˆ™ï¼Œç»§ç»­è°ƒç”¨ <code>input.valueOf()</code> æ–¹æ³•ï¼Œè‹¥ç»“æœä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›è¯¥ç»“æœï¼Œå¦åˆ™æŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚</li>
</ol>
</li>
<li>è‹¥ <code>hint</code> ä¸º <code>&quot;number&quot;</code>ï¼Œå®ƒå…ˆè°ƒç”¨ <code>input.valueOf()</code> æ–¹æ³•ï¼Œ
<ol>
<li>è‹¥ <code>valueOf()</code>  ç»“æœä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥ç»“æœã€‚</li>
<li>å¦åˆ™ï¼Œç»§ç»­è°ƒç”¨ <code>input.toString()</code> æ–¹æ³•ï¼Œè‹¥ç»“æœä¸ºåŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›è¯¥ç»“æœï¼Œå¦åˆ™æŠ›å‡º <code>TypeError</code> ç±»å‹é”™è¯¯ã€‚</li>
</ol>
</li>
</ol>
<blockquote>
<p>åˆ°è¿™é‡Œï¼Œå·²ç»å®Œæ•´åœ°è®²è¿°äº† ToPrimitive æ“ä½œçš„å…¨éƒ¨è¿‡ç¨‹ã€‚æ–‡ç¬”ä¸å¤ªå¥½ï¼Œæˆ‘ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡çœ‹æ˜ç™½ï¼Œå€˜è‹¥ä»æœ‰ç–‘æƒ‘ï¼Œè¯·åå¤æ–Ÿé…Œæˆ–ç›´æ¥æŸ¥çœ‹ ECMAScript æ ‡å‡†ã€‚</p>
</blockquote>
<h5>3. ä¸€äº›ç¤ºä¾‹</h5>
<ul>
<li><code>-</code>ã€<code>*</code>ã€<code>/</code>ã€<code>%</code> è¿™å››ç§æ“ä½œç¬¦éƒ½ä¼šæŠŠç¬¦å·ä¸¤è¾¹çš„æ“ä½œæ•°å…ˆè½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—ã€‚</li>
<li><code>+</code> çš„ä½œç”¨å¯ä»¥æ˜¯æ•°å€¼æ±‚å’Œï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ã€‚
<ul>
<li>è‹¥ç¬¦å·ä¸¤è¾¹æ“ä½œæ•°éƒ½æ˜¯æ•°å­—ï¼Œåˆ™è¿›è¡Œæ•°å­—è¿ç®—ã€‚</li>
<li>è‹¥ç¬¦å·ä¸€è¾¹æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šæŠŠå¦ä¸€ç«¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ä¸€å…ƒåŠ è¿ç®—ç¬¦ <code>+</code>ï¼ˆunary plusï¼‰æ˜¯å°†æ“ä½œæ•°è½¬æ¢ä¸ºæ•°å­—çš„æœ€å¿«ä¸”é¦–é€‰çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒä¸å¯¹è¯¥æ•°å­—æ‰§è¡Œä»»ä½•å…¶ä»–è¿ç®—ã€‚</p>
<p>åŒºåˆ†ä¸€å…ƒåŠ è¿ç®—ç¬¦ï¼ˆ<code>+</code>ï¼‰å’Œç®—æœ¯è¿ç®—ç¬¦ï¼ˆ<code>+</code>ï¼‰çš„æ–¹æ³•ï¼Œå°±æ˜¯å‰è€…åªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œè€Œåè€…æ˜¯ä¸¤ä¸ªæ“ä½œæ•°ã€‚</p>
</blockquote>
<pre><code class="language-js">// è¿ç®—ç¬¦: x + y

// Number + Number -&gt; æ•°å­—ç›¸åŠ 
1 + 2 // 3

// Boolean + Number -&gt; æ•°å­—ç›¸åŠ 
true + 1 // 2

// Boolean + Boolean -&gt; æ•°å­—ç›¸åŠ 
false + false // 0

// Number + String -&gt; å­—ç¬¦ä¸²è¿æ¥
5 + 'foo' // &quot;5foo&quot;

// String + Boolean -&gt; å­—ç¬¦ä¸²è¿æ¥
'foo' + false // &quot;foofalse&quot;

// String + String -&gt; å­—ç¬¦ä¸²è¿æ¥
'foo' + 'bar' // &quot;foobar&quot;
</code></pre>
<pre><code class="language-js">const obj = {
  [Symbol.toPrimitive]: hint =&gt; {
    if (hint === 'number') {
      return 1
    } else if (hint === 'string') {
      return 'string'
    } else {
      return 'default'
    }
  }
}

+obj          // 1              hint is &quot;number&quot;
`${obj}`      // &quot;string&quot;       hint is &quot;string&quot;
obj + ''      // &quot;default&quot;      hint is &quot;default&quot;
obj + 1       // &quot;default1&quot;     hint is &quot;default&quot;
Number(obj)   // 1              hint is &quot;number&quot;
String(obj)   // &quot;string&quot;       hint is &quot;string&quot;
</code></pre>
<h3>äºŒã€ToBoolean</h3>
<p>å°†ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œè¿™åº”è¯¥æ˜¯æœ€ç®€å•çš„äº†ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-toboolean">#sec-7.1.2</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e80cf00c3454f6d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToBoolean Abstract Operation"></p>
<p>æ‰€ä»¥æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œæ•°</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>undefined</code>ã€<code>null</code>ã€<code>false</code>ã€<code>+0</code>ã€<code>-0</code>ã€<code>NaN</code>ã€<code>''</code>ã€<code>0n</code></td>
<td>false</td>
</tr>
<tr>
<td>é™¤ä»¥ä¸Šè¿™äº›ï¼ˆfalsyï¼‰å€¼ä¹‹å¤–</td>
<td>true</td>
</tr>
</tbody>
</table>
<p>åœ¨ JavaScript ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ•° <code>argument</code> é€šè¿‡ <code>ToBoolean(argument)</code> æ“ä½œåè¢«è½¬æ¢ä¸º <code>true</code>ï¼Œé‚£ä¹ˆè¿™äº›æ“ä½œæ•°ç§°ä¸º<strong>çœŸå€¼</strong>ï¼ˆtruthyï¼‰ï¼Œå¦åˆ™ä¸º<strong>è™šå€¼</strong>ï¼ˆfalsyï¼‰ã€‚</p>
<pre><code class="language-js">// è½¬æ¢ä¸º Boolean å€¼çš„ä¸¤ç§æ–¹å¼
!!x
Boolean(x)
</code></pre>
<h3>ä¸‰ã€ToNumber</h3>
<p>å°†ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºæ•°å­—å€¼ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-toboolean">#sec-7.1.4</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fcd015a2dece222f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToNumber Abstract Operation"></p>
<table>
<thead>
<tr>
<th>å‚æ•°ç±»å‹</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Undefined</td>
<td><code>NaN</code></td>
</tr>
<tr>
<td>Null</td>
<td><code>+0</code></td>
</tr>
<tr>
<td>Boolean</td>
<td><code>true</code> è½¬æ¢ä¸º <code>1</code>ï¼Œ<code>false</code> è½¬æ¢ä¸º <code>+0</code>ã€‚</td>
</tr>
<tr>
<td>Number</td>
<td>ç›´æ¥è¿”å›ï¼Œä¸åšç±»å‹è½¬æ¢ã€‚</td>
</tr>
<tr>
<td>String</td>
<td>1. çº¯æ•°å­—çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºç›¸åº”çš„æ•°å­—ï¼›<br/>2. ç©ºå­—ç¬¦ä¸² <code>''</code> è½¬ä¸º <code>+0</code>ï¼›<br/>3. å¦åˆ™ä¸º <code>NaN</code>ï¼›<br/><br/>å…¶ä¸­ <code>0x</code> å¼€å¤´çš„å­—ç¬¦ä¸²è¢«å½“æˆ 16 è¿›åˆ¶ã€‚</td>
</tr>
<tr>
<td>Symbol</td>
<td>æ— æ³•è½¬æ¢ï¼ŒæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</td>
</tr>
<tr>
<td>BigInt</td>
<td>æ— æ³•è½¬æ¢ï¼ŒæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</td>
</tr>
<tr>
<td>Object</td>
<td>ä¸¤ä¸ªæ­¥éª¤ï¼š<br/><br/>1. å°†å¼•ç”¨ç±»å‹è½¬åŒ–ä¸ºåŸå§‹å€¼ <code>ToPrimitive(argument, 'number')</code>ï¼›<br/>2. è½¬åŒ–ä¸ºåŸå§‹å€¼åï¼Œè¿›è¡Œ <code>ToNumber(primValue)</code> æ“ä½œï¼Œå³æŒ‰ä¸Šé¢çš„ç±»å‹è½¬æ¢ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯</p>
<ol>
<li><code>Number(undefined)</code> ç»“æœä¸º <code>NaN</code>ï¼Œè€Œ <code>Number(null)</code> ç»“æœä¸º <code>0</code>ã€‚</li>
<li>å«æœ‰å‰å¯¼å’Œå°¾éšç©ºç™½ç¬¦ï¼ˆ<code>\n</code>ã€<code>\r</code>ã€<code>\t</code>ã€<code>\v</code>ã€<code>\f</code>ï¼‰çš„å­—ç¬¦ä¸²ï¼Œåœ¨è½¬æ¢ä¸ºæ•°å­—ç±»å‹çš„æ—¶å€™ç©ºç™½ç¬¦ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>ä¸Šé¢ä¹Ÿæåˆ°è¿‡ï¼Œä½¿ç”¨ä¸€å…ƒåŠ è¿ç®—ç¬¦ï¼ˆ<code>+</code>ï¼‰ æ˜¯å°†å…¶ä»–ç±»å‹è½¬æ¢ä¸ºæ•°å€¼çš„å¸¸ç”¨æ–¹å¼ã€‚</li>
</ol>
</blockquote>
<pre><code class="language-js">Number(undefined) // NaN
Number(null) // 0

'\n  123  \t' == 123 // true

+'string' // NaN
+true // 1
+[] // 0
+{} // NaN
</code></pre>
<h3>å››ã€ToString</h3>
<p>å°†ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-tostring">#sec-7.1.17</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ff19b43bd4016155.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToString Abstract Operation"></p>
<table>
<thead>
<tr>
<th>å‚æ•°ç±»å‹</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Undefined</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td>Null</td>
<td><code>null</code></td>
</tr>
<tr>
<td>Boolean</td>
<td><code>true</code> è½¬æ¢ä¸º <code>&quot;true&quot;</code>ï¼Œ<code>false</code> è½¬æ¢ä¸º <code>&quot;false&quot;</code>ã€‚</td>
</tr>
<tr>
<td>Number</td>
<td>1. <code>NaN</code> è½¬æ¢ä¸º <code>&quot;NaN&quot;</code>ï¼›<br/>2. <code>+0</code> æˆ– <code>-0</code> è½¬æ¢ä¸º <code>&quot;0&quot;</code>ï¼›<br/>3. å…¶ä¸­ <code>Infinity</code> å’Œ <code>-Infinity</code> åˆ†åˆ«è½¬æ¢ä¸º <code>&quot;Infinity&quot;</code>ã€<code>&quot;-Infinity&quot;</code>ï¼›<br/>4. è‹¥ <code>x</code> æ˜¯å°äº <code>0</code> çš„è´Ÿæ•°ï¼Œåˆ™è¿”å› <code>&quot;-x&quot;</code>ï¼›è‹¥ <code>x</code> æ˜¯å¤§äº <code>0</code> çš„æ­£æ•°ï¼Œåˆ™è¿”å› <code>&quot;x&quot;</code>ï¼›<br/>5. å…¶ä»–ä¸å¸¸ç”¨çš„æ•°å€¼ï¼Œè¯·çœ‹ <a href="https://262.ecma-international.org/#sec-numeric-types-number-tostring">#sec-6.1.6.1.20</a>ã€‚</td>
</tr>
<tr>
<td>String</td>
<td>ç›´æ¥è¿”å›ï¼Œä¸åšç±»å‹è½¬æ¢ã€‚</td>
</tr>
<tr>
<td>Symbol</td>
<td>æ— æ³•è½¬æ¢ï¼ŒæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</td>
</tr>
<tr>
<td>BigInt</td>
<td><code>10n</code> è½¬æ¢ä¸º <code>&quot;10&quot;</code>ã€‚</td>
</tr>
<tr>
<td>Object</td>
<td>ä¸¤ä¸ªæ­¥éª¤ï¼š<br/><br/>1. å°†å¼•ç”¨ç±»å‹è½¬åŒ–ä¸ºåŸå§‹å€¼ <code>ToPrimitive(argument, 'string')</code>ï¼›<br/>2. è½¬åŒ–ä¸ºåŸå§‹å€¼åï¼Œè¿›è¡Œ <code>ToString(primValue)</code> æ“ä½œï¼Œå³æŒ‰ä¸Šé¢çš„ç±»å‹è½¬æ¢ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSymbol åŸå§‹å€¼ä¸èƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œåªèƒ½å°†å…¶è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œå†è°ƒç”¨ <code>Symbol.prototype.toString()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<pre><code class="language-js">// ä¸‹é¢ä¼šå¯¼è‡´ Symbol('foo') è¿›è¡Œéšå¼è½¬æ¢ï¼Œå³ ToString(Symbol)ï¼ŒæŒ‰ä»¥ä¸Šè§„åˆ™ï¼Œæ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸çš„
console.log(Symbol('foo') + 'bar' ) // TypeError: Cannot convert a Symbol value to a string

// Symbol('foo') ç»“æœæ˜¯ Symbol çš„åŸå§‹å€¼ï¼Œå†è°ƒç”¨å…¶åŒ…è£…å¯¹è±¡çš„å±æ€§æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºåŒ…è£…å¯¹è±¡å†è°ƒç”¨å…¶ toString() æ–¹æ³•
console.log(Symbol('foo').toString() + 'bar' ) // &quot;Symbol(foo)bar&quot;
</code></pre>
<p>æŠ›ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼š</p>
<pre><code class="language-js">// è¿è¡Œå‡ºé”™
var name = Symbol() // TypeError: Cannot convert a Symbol value to a string

// æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šæŠ›å‡ºé”™è¯¯
let name = Symbol()

// ä¸ºä»€ä¹ˆå‘¢ â“â“â“
</code></pre>
<blockquote>
<p>ç­”æ¡ˆæˆ‘ä¸å†™äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œæœç´¢ã€‚å¯¹æ­¤æœ‰ç–‘é—®çš„å¯ä»¥å…ˆçœ‹ä¸‹æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/43dcc8f36714">å…³äº varã€let çš„é¡¶å±‚å¯¹è±¡çš„å±æ€§</a>ã€‚</p>
</blockquote>
<h3>äº”ã€ToObject</h3>
<p>å°†ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºå¼•ç”¨ç±»å‹çš„å€¼ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-toobject">#sec-7.1.18</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-878ca3140b22b490.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ToObject Abstract Operation"></p>
<table>
<thead>
<tr>
<th>å‚æ•°ç±»å‹</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Undefined</td>
<td>æ— æ³•è½¬æ¢ï¼ŒæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</td>
</tr>
<tr>
<td>Null</td>
<td>æ— æ³•è½¬æ¢ï¼ŒæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</td>
</tr>
<tr>
<td>Boolean</td>
<td>è¿”å› <code>new Boolean(argument)</code>ã€‚</td>
</tr>
<tr>
<td>Number</td>
<td>è¿”å› <code>new Number(argument)</code>ã€‚</td>
</tr>
<tr>
<td>String</td>
<td>è¿”å› <code>new String(argument)</code>ã€‚</td>
</tr>
<tr>
<td>Symbol</td>
<td>è¿”å› <code>Object(Symbol(argument))</code>ã€‚</td>
</tr>
<tr>
<td>BigInt</td>
<td>è¿”å› <code>Object(BigInt(argument))</code>ã€‚</td>
</tr>
<tr>
<td>Object</td>
<td>ç›´æ¥è¿”å›ï¼Œä¸åšç±»å‹è½¬æ¢ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éœ€è¦æ³¨æ„éƒ½æ˜¯ï¼ŒJavaScript å†…ç½®çš„ <code>Symbol</code>ã€<code>BigInt</code> å¯¹è±¡ä¸èƒ½ä½¿ç”¨ <code>new</code> å…³é”®å­—å»åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œåªèƒ½é€šè¿‡ <code>Object()</code> å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼ˆwrapper objectï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">// é”™è¯¯ç¤ºä¾‹
const sym = new Symbol() // TypeError: Symbol is not a constructor

// æ­£ç¡®ç¤ºä¾‹
const sym = Symbol()
console.log(typeof sym) // &quot;symbol&quot;
const symObj = Object(sym)
console.log(typeof symObj) // &quot;object&quot;

// BigInt åŒç†
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä» ES6 å¼€å§‹å›´ç»•åŸå§‹æ•°æ®ç±»å‹åˆ›å»ºä¸€ä¸ªæ˜¾å¼åŒ…è£…å™¨å¯¹è±¡ä¸å†è¢«æ”¯æŒã€‚ä½†ç”±äºé—ç•™åŸå› ï¼Œç°æœ‰çš„åŸå§‹åŒ…è£…å™¨å¯¹è±¡ï¼ˆå¦‚ <code>new Boolean</code>ã€<code>new Number</code>ã€<code>new String</code>ï¼‰ä»å¯ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ ES6+ æ–°å¢çš„ Symbolã€BigInt æ•°æ®ç±»å‹æ— æ³•é€šè¿‡ <code>new</code> å…³é”®å­—åˆ›å»ºå®ä¾‹å¯¹è±¡çš„åŸå› ã€‚</p>
</blockquote>
<h3>å…­ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://262.ecma-international.org/#sec-toprimitive">ToPrimitive Abstract Operation</a></li>
<li><a href="https://262.ecma-international.org/#sec-ordinarytoprimitive">OrdinaryToPrimitive Abstract Operation</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | valueOf å’Œ toString æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/241</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/241</guid>
            <pubDate>Sun, 26 Feb 2023 11:14:53 GMT</pubDate>
            <description><![CDATA[<p>åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/ddc45fab9e55">JavaScript çš„æ•°æ®ç±»å‹ä»¥åŠé‚£äº›äº‹...</a> ä¸­è®²è¿° <code>ToPrimitive</code> å’Œ <code>OrdinaryToPrimitive</code> æ“ä½œæ—¶ï¼Œæ¶‰åŠåˆ°]]></description>
            <content:encoded><![CDATA[<p>åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/ddc45fab9e55">JavaScript çš„æ•°æ®ç±»å‹ä»¥åŠé‚£äº›äº‹...</a> ä¸­è®²è¿° <code>ToPrimitive</code> å’Œ <code>OrdinaryToPrimitive</code> æ“ä½œæ—¶ï¼Œæ¶‰åŠåˆ°è¿™ä¸¤æ–¹æ³•ï¼Œæ‰€ä»¥ä»Šå¤©æ¥ç®€å•å†™ä¸€ä¸‹ã€‚</p>
<p>å…¶å®æˆ‘ä»¬ä¸€èˆ¬å¾ˆå°‘ä¸»åŠ¨å»è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé‚£å®ƒä»¬ä»€ä¹ˆæ—¶å€™ä¼šè¢«ä½¿ç”¨åˆ°å‘¢ï¼Ÿå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå¯¹è±¡ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯ï¼Œå¼•ç”¨ç±»å‹çš„å€¼ï¼‰è½¬åŒ–ä¸ºåŸå§‹å€¼çš„æ—¶å€™ï¼ŒJavaScript å¯èƒ½ä¼šè°ƒç”¨åˆ°å®ƒä»¬ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">const obj = {}
console.log('This is ' + obj) // &quot;This is [object Object]&quot;
</code></pre>
<p>å†…éƒ¨è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-text">1. 'This is ' + obj æ“ä½œï¼Œä½¿å¾— obj ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºåŸå§‹å€¼ã€‚
2. ç”±äº obj å†…éƒ¨æ²¡æœ‰å®šä¹‰ @@toPrimitive å±æ€§ï¼Œæ‰€ä»¥å®ƒä¼šå…ˆè°ƒç”¨ toString æ–¹æ³•æˆ– valueOf æ–¹æ³•ã€‚
3. ç”±äº obj æœ¬èº«æ²¡æœ‰ toString æ–¹æ³•ï¼ŒJavaScript ä¼šä»åŸå‹ä¸Šæ‰¾åˆ° Object.prototype.toString()ï¼Œæ‰§è¡Œç»“æœæ˜¯ [object Object]ã€‚
4. ç”±äº toString æ–¹æ³•å·²ç»è¿”å›åŸå§‹å€¼äº†ï¼Œå°±ä¸ä¼šå†è°ƒç”¨ valueOf æ–¹æ³•äº†ã€‚ï¼ˆå‡è®¾ä¸Šé¢ toString æ²¡æœ‰è¿”å›åŸå§‹å€¼ï¼Œæ¥ç€è°ƒç”¨ valueOf æ–¹æ³•ï¼Œå¦‚æœç»“æœè¿˜ä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™ä¼šæŠ›å‡º TypeError é”™è¯¯ï¼‰
5. æ‰€ä»¥æœ€åæ‰§è¡Œæ‹¼æ¥æ“ä½œçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼š'This is ' + '[object Object]'ï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯å®ƒäº†ã€‚
</code></pre>
<p>æ¥ç€æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">// ç¤ºä¾‹ 1ï¼šéªŒè¯ç¬¬ 2 ç‚¹ã€‚åœ¨ç±»å‹è½¬æ¢æ—¶ï¼Œä¼˜å…ˆå¯»æ‰¾ @@toPrimitive æ–¹æ³•ï¼ˆå³ä¸‹é¢çš„ [Symbol.toPrimitive]ï¼‰
const obj = {
  [Symbol.toPrimitive]: hint =&gt; {
    console.log('æ³¨æ„ï¼šæ ¹æ® ECMAScript æ ‡å‡†ï¼Œè‹¥è¯¥æ–¹æ³•è¿”å›å¼•ç”¨ç±»å‹ï¼Œä¼šæŠ›å‡º TypeError')
    return 'abc'
  }
}
console.log('This is ' + obj) // &quot;This is abc&quot;


// ç¤ºä¾‹ 2ï¼šéªŒè¯ç¬¬ 3 ç‚¹
const obj = {}
Object.prototype.toString = () =&gt; 'rewrite toString method'
console.log('This is ' + obj) // &quot;This is rewrite toString method&quot;


// ç¤ºä¾‹ 3ï¼šéªŒè¯ç¬¬ 4 ç‚¹
const obj = {
  valueOf: hint =&gt; {
    console.log('æ‰§è¡Œ valueOf æ–¹æ³•')
    return {}
  },
  toString: hint =&gt; {
    console.log('æ‰§è¡Œ toString æ–¹æ³•')
    return 'tostring'
  }
}
console.log('This is ' + obj) // &quot;This is tostring&quot;ï¼ˆåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ï¼Œå…ˆåæ‰§è¡Œäº† valueOfã€toString æ–¹æ³•ï¼‰
console.log(String(obj)) // &quot;tostring&quot;
</code></pre>
<h3>ä¸€ã€valueOf</h3>
<p>å½“ <code>OrdinaryToPrimitive(O, hint)</code> æŠ½è±¡æ“ä½œçš„ <code>hint</code> ä¸º <code>&quot;number&quot;</code> æ—¶ï¼ŒJavaScript ä¼šé¦–å…ˆè°ƒç”¨ <code>valueOf()</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>å…³äº <a href="https://262.ecma-international.org/#sec-ordinarytoprimitive">OrdinaryToPrimitive(O, hint)</a> çš„ä»‹ç»å¯ä»¥çœ‹<a href="https://www.jianshu.com/p/ddc45fab9e55">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h5>1. Object.prototype.valueOf</h5>
<p><code>Object.prototype.valueOf()</code> æ–¹æ³•è¿”å›å¯¹è±¡çš„<strong>åŸå§‹å€¼</strong>ã€‚</p>
<pre><code class="language-js">Object.prototype.valueOf.call({}) // {}
Object.prototype.valueOf.call([]) // []
</code></pre>
<p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡ <code>const obj = {}</code>ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>obj.valueOf()</code> æ—¶ï¼Œè®¿é—®çš„å°±æ˜¯ <code>Object.prototype.valueOf()</code> æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯ï¼ŒJavaScript é‡Œé¢å†…ç½®äº†å¾ˆå¤šå…¨å±€æ€§çš„å¯¹è±¡ï¼Œå¦‚ <code>Array</code>ã€<code>Boolean</code>ã€<code>Date</code>ã€<code>Function</code>ã€<code>Number</code>ã€<code>Object</code>ã€<code>String</code>ã€‚å®ƒä»¬éƒ½é‡å†™äº†è‡ªå·±çš„ <code>valueOf</code> æ–¹æ³•ã€‚å…¶ä¸­ <code>Math</code> å’Œ <code>Error</code> å¯¹è±¡æ²¡æœ‰ <code>valueOf</code> æ–¹æ³•ã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼Œå¯ä»¥åˆ¤æ–­ä¸€ä¸ªå†…ç½®å¯¹è±¡æ˜¯å¦æœ‰é‡å†™è‡ªå·±çš„ <code>valueOf</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-js">// ç»“æœä¸º false è¡¨ç¤ºæœ‰é‡å†™ï¼ˆtoString åŒç†ï¼‰
Array.prototype.valueOf === Object.prototype.valueOf // true
Function.prototype.valueOf === Object.prototype.valueOf // true

Boolean.prototype.valueOf === Object.prototype.valueOf // false
Date.prototype.valueOf === Object.prototype.valueOf // false
Number.prototype.valueOf === Object.prototype.valueOf // false
String.prototype.valueOf === Object.prototype.valueOf // false
Symbol.prototype.valueOf === Object.prototype.valueOf // false
BigInt.prototype.valueOf === Object.prototype.valueOf // false

// è¿˜æœ‰å¾ˆå¤šå†…ç½®å¯¹è±¡æ²¡åˆ—å‡ºæ¥ï¼Œå¯è‡ªè¡Œç¿»æŸ¥ MDN æˆ– ECMAScript æ–‡æ¡£...
</code></pre>
<table>
<thead>
<tr>
<th>å¯¹è±¡</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>è¿”å›å¸ƒå°”å€¼ã€‚</td>
</tr>
<tr>
<td>Date</td>
<td>è¿”å›çš„æ—¶é—´æ˜¯ä» 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 å¼€å§‹è®¡çš„æ¯«ç§’æ•°ï¼ˆUTCï¼‰ã€‚</td>
</tr>
<tr>
<td>Number</td>
<td>è¿”å›æ•°å­—å€¼ã€‚</td>
</tr>
<tr>
<td>String</td>
<td>å­—ç¬¦ä¸²å€¼ã€‚</td>
</tr>
<tr>
<td>Object</td>
<td>è¿”å›å¯¹è±¡æœ¬èº«ã€‚è¿™æ˜¯é»˜è®¤æƒ…å†µã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Math</code>ã€<code>Error</code> å¯¹è±¡æ²¡æœ‰ <code>valueOf()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬è‡ªè¡Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è¿™æ ·å»è¦†ç›–é»˜è®¤çš„ <code>Object.prototype.valueOf()</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-js">// æ„é€ å‡½æ•°
function MyObject(my) {
  this.my = my
}

// åœ¨åŸå‹ä¸Šå®šä¹‰ valueOf æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•ä¸åº”ä¼ å…¥å‚æ•°ï¼‰
MyObject.prototype.valueOf = function() {
  return this.my
}

// å®ä¾‹åŒ–
var myObj = new Object('This is myObj.')
console.log('' + myObj) // &quot;This is myObj.&quot;
</code></pre>
<h5>2. å…¶ä»–å†…ç½®å¯¹è±¡çš„ valueOf æ–¹æ³•</h5>
<p>å…¶å®å¥½åƒæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ”¾é“¾æ¥è‡ªå·±çœ‹å§ã€‚</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean/valueOf">Boolean.prototype.valueOf()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/valueOf">Date.prototype.valueOf()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/valueOf">Number.prototype.valueOf()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/valueOf">String.prototype.valueOf()</a></li>
</ul>
<h3>äºŒã€toString</h3>
<p>åŒæ ·çš„ï¼Œä¸€èˆ¬æ¯”è¾ƒå°‘ä¸»åŠ¨å»è°ƒç”¨ <code>toString()</code> æ–¹æ³•ã€‚</p>
<h5>1. Object.prototype.toString()</h5>
<p><code>Object.prototype.toString()</code> è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å®ƒå®é™…è®¿é—®çš„æ˜¯å¯¹è±¡å†…éƒ¨çš„ <code>[[Class]]</code> å±æ€§ï¼Œè¿”å›çš„å½¢å¼å¦‚ï¼š<code>&quot;[object type]&quot;</code>ï¼Œå¸¸ç”¨äºæ£€æµ‹å¯¹è±¡ç±»å‹ã€‚</p>
<pre><code class="language-js">function getClass(x) {
  const { toString } = Object.prototype
  const str = toString.call(x)
  return /^\[object (.*)\]$/.exec(str)[1]
}

getClass(null) // &quot;Null&quot;
getClass(undefined) // &quot;Undefined&quot;
getClass({}) // &quot;Object&quot;
getClass([]) // &quot;Array&quot;
getClass(JSON) // &quot;JSON&quot;
getClass(() =&gt; {}) // &quot;Function&quot;
;(function() { return getClass(arguments) })() // &quot;Arguments&quot;
</code></pre>
<blockquote>
<p>æ›´å¤šè¯¦æƒ…ï¼Œè¯·çœ‹<a href="https://www.jianshu.com/p/ddc45fab9e55">æ–‡ç«  â€” å¯¹è±¡çš„å†…éƒ¨å±æ€§</a>çš„ç« èŠ‚ã€‚</p>
</blockquote>
<pre><code class="language-js">Array.prototype.toString === Object.prototype.toString // false
Function.prototype.toString === Object.prototype.toString // false

Boolean.prototype.toString === Object.prototype.toString // false
Date.prototype.toString === Object.prototype.toString // false
Number.prototype.toString === Object.prototype.toString // false
String.prototype.toString === Object.prototype.toString // false
Symbol.prototype.toString === Object.prototype.toString // false
BigInt.prototype.toString === Object.prototype.toString // false
</code></pre>
<h5>2. Array.prototype.toString()</h5>
<p><code>Array.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«ç”¨é€—å· <code>,</code> åˆ†éš”çš„æ¯ä¸ªæ•°ç»„å…ƒç´ çš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-js">var arr = [1, 2, 3]
console.log(arr.toString()) // &quot;1,2,3&quot;

// ç»“æœç›¸å½“äº Array.prototype.join.call(instance, ',')
arr.join(',') // &quot;1,2,3&quot;
</code></pre>
<h5>3. Function.prototype.toString()</h5>
<p><code>Function.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºå½“å‰å‡½æ•°æºä»£ç çš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-js">function fn() {}
console.log(fn.toString()) // &quot;function fn() {}&quot;
</code></pre>
<h5>4. Boolean.prototype.toString()</h5>
<p><code>Boolean.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›æŒ‡å®šçš„å¸ƒå°”å¯¹è±¡çš„å­—ç¬¦ä¸²å½¢å¼ã€‚</p>
<pre><code class="language-js">console.log(true.toString()) // &quot;true&quot;
console.log(false.toString()) // &quot;false&quot;
</code></pre>
<h5>5. String.prototype.toString()</h5>
<p><code>String.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›æŒ‡å®šå¯¹è±¡çš„å­—ç¬¦ä¸²å½¢å¼ã€‚</p>
<pre><code class="language-js">console.log(new String('foo').toString()) // &quot;foo&quot;
</code></pre>
<h5>6. Symbol.prototype.toString()</h5>
<p><code>Symbol.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›å½“å‰ Symbol å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSymbol åŸå§‹å€¼ä¸èƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œåªèƒ½å°†å…¶è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œå†è°ƒç”¨ <code>toString()</code> æ–¹æ³•ã€‚</p>
</blockquote>
<pre><code class="language-js">console.log(Symbol('foo') + 'bar' ) // TypeError: Cannot convert a Symbol value to a string

// Symbol('foo') ç»“æœæ˜¯ Symbol çš„åŸå§‹å€¼ï¼Œå†è°ƒç”¨å…¶åŒ…è£…å¯¹è±¡çš„å±æ€§æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºåŒ…è£…å¯¹è±¡å†è°ƒç”¨å…¶ toString() æ–¹æ³•
console.log(Symbol('foo').toString() + 'bar' ) // &quot;Symbol(foo)bar&quot;
</code></pre>
<h5>7. BigInt.prototype.toString()</h5>
<p><code>BigInt.prototype.toString()</code> æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåé¢çš„ <code>n</code> ä¸æ˜¯å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚</p>
<pre><code class="language-js">console.log(1024n.toString()) // &quot;1024&quot;
console.log(1024n.toString(2)) // &quot;10000000000&quot;
console.log(1024n.toString(16)) // &quot;400&quot;
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | ç›¸ç­‰æ¯”è¾ƒè¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/240</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/240</guid>
            <pubDate>Sun, 26 Feb 2023 11:10:26 GMT</pubDate>
            <description><![CDATA[<p>è®°ä½ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Always use 3 equals unless you have a good reason to use 2.</p>
</blockquote>
<h3>ä¸€ã€æ¦‚å¿µ</h3>
<p>åœ¨ JavaScript ä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ <code>===</co]]></description>
            <content:encoded><![CDATA[<p>è®°ä½ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>Always use 3 equals unless you have a good reason to use 2.</p>
</blockquote>
<h3>ä¸€ã€æ¦‚å¿µ</h3>
<p>åœ¨ JavaScript ä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ <code>===</code>ï¼ˆStrict equalityï¼Œå…¨ç­‰è¿ç®—ç¬¦ï¼‰å’Œ <code>==</code>ï¼ˆEqualityï¼Œç›¸ç­‰è¿ç®—ç¬¦ï¼‰æ¥æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰ï¼Œå®ƒä¿©éƒ½è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼çš„ç»“æœï¼ˆå¦å®šå½¢å¼åˆ†åˆ«æ˜¯ <code>!==</code> å’Œ <code>!=</code>ï¼‰ã€‚</p>
<p>ä¸¤è€…çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>===</code> æ€»æ˜¯è®¤ä¸ºä¸åŒç±»å‹çš„æ“ä½œæ•°æ˜¯ä¸ç›¸ç­‰çš„ã€‚</li>
<li><code>==</code> ä¸å‰è€…ä¸åŒï¼Œå®ƒä¼šå°è¯•<strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ä¸”æ¯”è¾ƒä¸åŒç±»å‹çš„æ“ä½œæ•°ã€‚ï¼ˆå³å¦‚æœæ“ä½œæ•°çš„ç±»å‹ä¸åŒï¼Œç›¸ç­‰è¿ç®—ç¬¦ä¼šåœ¨æ¯”è¾ƒä¹‹å‰å°è¯•å°†å®ƒä»¬è½¬æ¢ä¸ºç›¸åŒçš„ç±»å‹ï¼‰</li>
</ul>
<p>æ”¾ä¸€å¼ å¾ˆç»å…¸çš„å›¾ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½çœ‹è¿‡äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677410027594.png" alt="ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ==ï¼‰åˆ¤æ–­"></p>
<blockquote>
<p>å›¾ç‰‡å‡ºè‡ª <a href="https://dorey.github.io/JavaScript-Equality-Table/">JavaScript-Equality-Table</a>ã€‚</p>
</blockquote>
<h3>äºŒã€å…¨ç­‰è¿ç®—ç¬¦</h3>
<p>å…¨ç­‰è¿ç®—ç¬¦ï¼ˆ<code>===</code>å’ŒÂ <code>!==</code>ï¼‰ä½¿ç”¨<a href="https://www.ecma-international.org/ecma-262/5.1/#sec-11.9.6">å…¨ç­‰æ¯”è¾ƒç®—æ³•</a>æ¥æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ã€‚</p>
<p>ä» <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Strict_equality">MDN</a> å¯ä»¥çœ‹åˆ°ï¼Œå¤§è‡´æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>å¦‚æœæ“ä½œæ•°çš„ç±»å‹ä¸åŒï¼Œåˆ™è¿”å›Â <code>false</code>ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯å¯¹è±¡ï¼Œåªæœ‰å½“å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰è¿”å›Â <code>true</code>ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºÂ <code>null</code>ï¼Œæˆ–è€…ä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºÂ <code>undefined</code>ï¼Œè¿”å›Â <code>true</code>ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°æœ‰ä»»æ„ä¸€ä¸ªä¸ºÂ <code>NaN</code>ï¼Œè¿”å›Â <code>false</code>ã€‚</li>
<li>å¦åˆ™ï¼Œæ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ï¼š
<ul>
<li>æ•°å­—ç±»å‹å¿…é¡»æ‹¥æœ‰ç›¸åŒçš„æ•°å€¼ã€‚<code>+0</code>Â å’ŒÂ <code>-0</code>Â ä¼šè¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„å€¼ã€‚</li>
<li>å­—ç¬¦ä¸²ç±»å‹å¿…é¡»æ‹¥æœ‰ç›¸åŒé¡ºåºçš„ç›¸åŒå­—ç¬¦ã€‚</li>
<li>å¸ƒå°”è¿ç®—ç¬¦å¿…é¡»åŒæ—¶ä¸ºÂ <code>true</code>Â æˆ–åŒæ—¶ä¸ºÂ <code>false</code>ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<p>åˆ—ä¸¾å‡ ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">console.log(1 === '1') // false
console.log(1 === true) // false
console.log(undefined === null) // false
console.log({} === {}) // false
</code></pre>
<p>ä»¥ä¸Šè¿™äº›ç»“æœç›¸ä¿¡æ˜¯æ¯«æ— ç–‘é—®çš„ã€‚ä½†æ˜¯ï¼Œä»å†™ä¸‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ MDN ä¸Šå…³äº <code>===</code> çš„æè¿°å¹¶æœªæ¶‰åŠ Symbolã€BigInt ç±»å‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ ECMAScript æœ€æ–°æ ‡å‡†å§ã€‚ï¼ˆ<a href="https://262.ecma-international.org/#sec-strict-equality-comparison">#sec-7.2.16</a>ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b88744e5d324278c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>çœ‹èµ·æ¥â€œå¥½åƒâ€åªæ˜¯ç®€å•çš„å‡ å¥è¯å¯¹å§ï¼Œç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://262.ecma-international.org/#sec-ecmascript-data-types-and-values"><code>Type(x)</code></a> æ˜¯ ECMAScript æ ‡å‡†å®šä¹‰çš„æŠ½è±¡æ“ä½œï¼ˆAbstract Operationï¼‰ï¼Œå¹¶éæ˜¯ JavaScript çš„æŸä¸ªè¯­æ³•ï¼Œå®ƒè¿”å›çš„æ˜¯ 8 ç§æ•°æ®ç±»å‹ã€‚å¦‚æœä½ å¤šè¯» ECMAScript æ ‡å‡†ï¼Œå°±ä¼šå‘ç°å¾ˆå¤šæŠ½è±¡æ“ä½œé‡Œéƒ½æœ‰å¼•ç”¨åˆ° <code>Type(x)</code>ï¼Œå‡è®¾æ¯å¤„éƒ½å¯¹ <code>Type(x)</code> è¿›è¡Œæè¿°æ˜¾å¾—å¤šä½™é‡å¤ï¼Œä½•ä¸å°†å®ƒæŠ½å‡ºæ¥å®šä¹‰æˆä¸€ä¸ªæŠ½è±¡æ“ä½œã€‚ï¼ˆæˆ‘çŒœ ECMAScript æ ‡å‡†ä¿®è®¢è€…ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ï¼‰</p>
<blockquote>
<ol>
<li>å¦‚æœ <code>x</code> å’Œ <code>y</code> æ˜¯ä¸¤ç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> å’Œ <code>y</code> çš„ç±»å‹åŒæ—¶æ˜¯ Number æˆ– BigInt ç±»å‹ï¼Œé‚£ä¹ˆ
a. å¯¹åº”è¿”å› <code>Number::equal(x, y)</code> æˆ– <code>BigInt::equal(x, y)</code> çš„æ“ä½œç»“æœã€‚</li>
<li>è¿”å› <code>SameValueNonNumber(x, y)</code> çš„ç»“æœã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šè¯¥ç®—æ³•ä¸ <a href="https://262.ecma-international.org/#sec-samevalue">SameValue</a> ç®—æ³•çš„åŒºåˆ«åœ¨äºå¯¹<strong>æœ‰ç¬¦å·é›¶</strong>å’Œ <code>NaN</code> çš„å¤„ç†ã€‚</p>
</blockquote>
<p>åŸæ¥å®ƒæ˜¯è¿™æ ·çš„ä¸‰å¥è¯ï¼Œå“~</p>
<h5>1. Number::equal(x, y)</h5>
<p><a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">#sec-6.1.6.1.13</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bec07452de93e906.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š</p>
<blockquote>
<ol>
<li>å¦‚æœ <code>x</code> æˆ– <code>y</code> ä»»æ„ä¸€ä¸ªçš„å€¼ä¸º <code>NaN</code>ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> å’Œ <code>y</code> çš„æ•°å­¦é‡ï¼ˆ<a href="https://262.ecma-international.org/#number-value">Number value</a>ï¼‰æ˜¯ç›¸ç­‰çš„ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º <code>+0</code> ä¸” <code>y</code> ä¸º <code>-0</code>ï¼Œåˆ™è¿”å› <code>true</code>ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚</li>
<li>ä»¥ä¸Šå‡ä¸ç¬¦åˆï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>+0</code> ä¸ <code>-0</code> çš„æ•°å­¦é‡æ˜¯ä¸ç›¸ç­‰çš„ã€‚ï¼ˆå°† <strong>Number value</strong> ç¿»è¯‘æˆ<strong>æ•°å­¦é‡</strong>ï¼Œä¸ä¸€å®šå‡†ç¡®å“ˆï¼Œè¿™æ˜¯ Google Translation å‘Šè¯‰æˆ‘çš„ï¼Œæˆ‘æ²¡å»ç»†ç©¶ï¼Œå°±é‚£ä¸ªæ„æ€ï¼Œå“ˆå“ˆï¼‰</p>
</blockquote>
<pre><code class="language-js">1 / +0 // Infinity
1 / -0 // -Infinity
Infinity === -Infinity // false
</code></pre>
<h5>2. BigInt::equal(x, y)</h5>
<p><a href="https://262.ecma-international.org/#sec-numeric-types-bigint-equal">#sec-6.1.6.2.13</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-83e7c5e99665678b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœ <code>x</code> å’Œ <code>y</code> å‡ä¸º BigInt ç±»å‹ï¼Œä¸”å…·æœ‰ç›¸åŒçš„æ•°å­¦æ•´æ•°å€¼ï¼ˆ<a href="https://262.ecma-international.org/#mathematical%20integer">mathematical integer</a>ï¼‰ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p>
<h5>3. SameValueNonNumeric(x, y)</h5>
<p><a href="https://262.ecma-international.org/#sec-samevaluenonnumeric">#sec-7.2.13</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a80f18e087b6f4cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š</p>
<blockquote>
<ol>
<li>æ–­è¨€ï¼š<code>x</code> æ—¢ä¸æ˜¯ Number ç±»å‹ï¼Œä¹Ÿä¸æ˜¯ BigInt ç±»å‹ã€‚</li>
<li>æ–­è¨€ï¼š<code>x</code> ä¸ <code>y</code> çš„æ•°æ®ç±»å‹ç›¸åŒã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Undefined ç±»å‹ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Null ç±»å‹ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ <code>String</code> ç±»å‹ï¼Œé‚£ä¹ˆ
a. å¦‚æœ <code>x</code> å’Œ <code>y</code> æ˜¯å®Œå…¨ç›¸åŒçš„ä»£ç å•å…ƒåºåˆ—ï¼ˆåœ¨ç›¸åº”çš„ç´¢å¼•å¤„å…·æœ‰ç›¸åŒçš„é•¿åº¦å’Œç›¸åŒçš„ä»£ç å•å…ƒï¼‰ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Boolean ç±»å‹ï¼Œé‚£ä¹ˆ
a. å¦‚æœ <code>x</code> å’Œ <code>y</code> åŒæ—¶ä¸º <code>true</code>ï¼Œæˆ–åŒæ—¶ä¸º <code>false</code>ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Symbol ç±»å‹ï¼Œé‚£ä¹ˆ
a. å¦‚æœ <code>x</code> å’Œ <code>y</code> éƒ½æ˜¯ç›¸åŒçš„ Symbol å€¼ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> å’Œ <code>y</code> æ˜¯åŒä¸€ä¸ªå¼•ç”¨å€¼ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>å‡ ä¸ªç‚¹æ³¨æ„ä¸€ä¸‹ï¼š</p>
<ol>
<li>
<p><code>Assert</code> æ˜¯æ–­è¨€ã€‚è‹¥ä»¥ <code>Assert:</code> ä¸ºå¼€å¤´çš„æ­¥éª¤ï¼ˆStepï¼‰ï¼Œæ˜ç¡®äº†å…¶ç®—æ³•çš„ä¸å˜æ¡ä»¶ã€‚ä¾‹å¦‚ä¸Šé¢çš„ <code>SameValueNonNumeric</code> ç®—æ³•ï¼Œç¬¬ 1ã€2 æ­¥éª¤æ˜ç¡®äº† <code>x</code> å’Œ <code>y</code> çš„å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¸”ä¸ä¸º Number æˆ– BigInt ç±»å‹ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œè¿™ä¸¤å¥æ–­è¨€æ˜¯è¯¥ç®—æ³•çš„å‰ææ¡ä»¶ã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œç±»ä¼¼ç¬¬ 5 æ¡æ­¥éª¤ï¼š<code>if Type(x) is String, then...</code>ï¼Œæ¥ç€ä¸‹ä¸€æ¡ä¸æ˜¯ <code>if Type(y) is String, then...</code>ï¼Œå› ä¸ºå®ƒæ²¡å¿…è¦äº†ï¼Œå‰é¢çš„æ­¥éª¤å·²ç»æ˜ç¡®äº†å®ƒçš„ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œå¦‚æœæœ‰åè€Œå¤šä½™äº†ã€‚å›å¤´å†çœ‹ <code>Number::equal(x, y)</code> ç®—æ³•ï¼Œå…¶ä¸­ç¬¬ 1ã€2 æ­¥éª¤åˆ†åˆ«è¯´æ˜äº† <code>x</code> ä¸º <code>NaN</code>ï¼Œ<code>y</code> ä¸º <code>NaN</code> çš„æƒ…å†µï¼Œå› ä¸ºå®ƒå‰ç½®æ¡ä»¶æ²¡æœ‰æ–­è¨€ã€‚ä¸‹æ–‡çš„ç®—æ³•ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µã€‚</p>
</li>
<li>
<p>å¦‚æœç¬¬ 3ã€4 æ­¥éª¤æœ‰äººä¸ç†è§£çš„è¯ï¼Œçœ‹è¿™é‡Œã€‚ç”±äº Undefinedã€Null ç±»å‹å¯¹åº”çš„å€¼åˆ†åˆ«åªæœ‰ <code>undefined</code>ã€<code>null</code>ã€‚å¦‚æœ <code>x</code> ä¸º Undefined ç±»å‹ï¼Œåˆ™å¯ä»¥æ¨æ–­å‡º <code>x</code> å’Œ <code>y</code> çš„å€¼ï¼Œåªèƒ½æ˜¯ <code>undefined</code>ï¼Œå› æ­¤è¿”å› <code>true</code>ã€‚Null åŒç†ã€‚</p>
<p>æ³¨æ„ï¼šæœ¬æ–‡è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œå‡ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä¾‹å¦‚ Undefinedã€String ç­‰ï¼Œè€Œè¡¨ç¤ºæŸç§æ•°æ®ç±»å‹çš„å€¼ï¼Œå‡ä»¥å°å†™å­—æ¯å‡ºç°ï¼Œä¾‹å¦‚ <code>undefined</code>ã€<code>null</code> ç­‰ã€‚å‰è€…ä¸ä½¿ç”¨ä»£ç å—å½¢å¼é«˜äº®å±•ç¤ºï¼Œåè€…åˆ™é«˜äº®å±•ç¤ºã€‚</p>
</li>
</ol>
</blockquote>
<h5>4. æ€»ç»“ä¸€ä¸‹</h5>
<blockquote>
<ul>
<li>å¦‚æœæ“ä½œæ•°çš„æ•°æ®ç±»å‹ä¸åŒï¼Œåˆ™è¿”å›Â <code>false</code>ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„æ•°æ®ç±»å‹ç›¸åŒï¼š
<ul>
<li>å¦‚æœæ“ä½œæ•°å‡ä¸ºå¼•ç”¨ç±»å‹ï¼Œåªæœ‰å½“å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰è¿”å›Â <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœæ“ä½œæ•°æ˜¯ Stringã€Booleanã€Undefinedã€Null ç±»å‹ä¹‹ä¸€ï¼Œå®ƒä»¬çš„å€¼ç›¸ç­‰æ‰è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœæ“ä½œæ•°æ˜¯ Symbol ç±»å‹ï¼Œåªæœ‰å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå€¼æ‰è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚ï¼ˆå•ç‹¬æ‹¿å‡ºæ¥æ˜¯å› ä¸ºå®ƒæœ‰ç‚¹åƒå¼•ç”¨ç±»å‹çš„æ„æ€ï¼ŒSymbol ç±»å‹çš„æœ¬è´¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å­—ç¬¦ä¸²ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨ <code>Symbol()</code> å‡½æ•°åˆ›å»ºäº†è¡¨é¢â€œçœ‹ä¼¼ä¸€æ ·â€çš„å­—ç¬¦ä¸²ï¼Œä½†å®é™…ä¸Šå®ƒä»¬æ˜¯ä¸ç›¸ç­‰çš„ã€‚ä¾‹å¦‚ï¼š<code>Symbol() === Symbol()</code> ç»“æœä¸º <code>false</code>ï¼‰</li>
<li>å¦‚æœæ“ä½œæ•°æ˜¯ Number æˆ– BigInt ç±»å‹ï¼Œï¼ˆé™¤äº†ä¸€ä¸ªä¾‹å¤–ï¼‰å®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„æ•°å­¦å€¼ï¼Œæ‰ä¼šè¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚
<ul>
<li>å½“ <code>x</code>ã€<code>y</code> çš„å€¼ä¹‹ä¸€æ˜¯ <code>NaN</code>ï¼Œè¿”å› <code>false</code>ã€‚</li>
<li>å½“ <code>x</code> ä¸º <code>+0</code>ï¼Œ<code>y</code> ä¸º <code>-0</code>ï¼Œè¿”å› <code>true</code>ï¼Œåä¹‹äº¦ç„¶ã€‚</li>
<li>å½“ <code>x</code> ä¸º <code>+0n</code>ï¼Œ<code>y</code> ä¸º <code>-0n</code>ï¼Œè¿”å› <code>true</code>ï¼Œåä¹‹äº¦ç„¶ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3>ä¸‰ã€å…¨ç­‰è¿ç®—ç¬¦çš„â€œå‘â€</h3>
<p>æ ¹æ®ä»¥ä¸Šçš„æ¯”è¾ƒç®—æ³•ï¼Œæ„Ÿè§‰ <code>===</code> ä¹Ÿå¹¶ä¸æ˜¯æ€»â€œé è°±â€ã€‚ä¾‹å¦‚ä»¥ä¸‹â€œåç›´è§‰â€çš„åˆ¤æ–­ï¼š</p>
<pre><code class="language-js">// PSï¼šNaN æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡çš„å±æ€§ï¼Œä¸ Number.NaN çš„å€¼ä¸€æ ·ï¼Œéƒ½ä¸º NaNï¼ˆNot-A-Numberï¼‰ã€‚
console.log(NaN === NaN) // false
console.log(Number.NaN === NaN) // false

console.log(+0 === -0) // true
</code></pre>
<h5>1. NaN</h5>
<blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a> æ˜¯ JavaScript ä¸­<strong>å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«</strong>çš„å€¼ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œ<code>NaN !== NaN</code> ç»“æœä¸º <code>true</code> ä¼¼ä¹æ²¡æ¯›ç—…ï¼Œåªæ˜¯åäººç±»ã€åç›´è§‰ç½¢äº†ã€‚</p>
<p>ä¸‹é¢æ€»ç»“äº†å‡ ç§æ–¹æ³•ï¼Œæ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸º <code>NaN</code>ã€‚</p>
<pre><code class="language-js">// 1. åˆ©ç”¨ NaN çš„ç‰¹æ€§ï¼ŒJavaScript ä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼
function isnan(v) {
  return v !== v
}

// 2. åˆ©ç”¨ ES5 çš„ isNaN() å…¨å±€æ–¹æ³•
function isnan(v) {
  return typeof v === 'number' &amp;&amp; isNaN(v)
}

// 3. åˆ©ç”¨ ES6 çš„ Number.isNaN() æ–¹æ³•
function isnan(v) {
  return Number.isNaN(v)
}

// 4. åˆ©ç”¨ ES6 çš„ Object.is() æ–¹æ³•
function isnan(v) {
  return Object.is(v, NaN)
}
</code></pre>
<p>å› æ­¤ï¼Œæ— æ³•é€šè¿‡ <code>Array.prototype.indexOf()</code> æ¥ç¡®å®š <code>NaN</code> åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•å€¼ã€‚</p>
<pre><code class="language-js">[NaN].indexOf(NaN) // -1
</code></pre>
<p>å¯ä½¿ç”¨ ES6 çš„ <code>Array.prototype.includes</code> æ–¹æ³•åˆ¤æ–­</p>
<pre><code class="language-js">[NaN].includes(NaN) // true
</code></pre>
<blockquote>
<p><code>Array.prototype.indexOf()</code> å†…éƒ¨åŸºäº <code>Strict Equality Comparison</code> å»æ¯”è¾ƒï¼Œåˆ¤æ–­ä¸¤ä¸ª Number ç±»å‹çš„æ“ä½œæ•°æ˜¯å¦ç›¸ç­‰æ˜¯æ ¹æ® <code>equal</code> ç®—æ³•å®ç°çš„ã€‚è€Œ <code>Array.prototype.includes</code> å†…éƒ¨åˆ™ä½¿ç”¨äº† <code>sameValueZero</code> ç®—æ³•ï¼Œå‰è€…è®¤ä¸º <code>NaN</code> ä¸ <code>NaN</code> æ˜¯ä¸ç›¸ç­‰çš„ï¼Œåè€…åˆ™è®¤ä¸ºç›¸ç­‰çš„ã€‚ï¼ˆè¯¦æƒ…çœ‹ <a href="https://262.ecma-international.org/#sec-numeric-types-number-equal">Number::equal (x, y)</a>ã€<a href="https://262.ecma-international.org/#sec-numeric-types-number-sameValueZero">Number::sameValueZero (x, y)</a>ï¼‰</p>
</blockquote>
<blockquote>
<p>å…³äº <code>NaN</code>ã€<code>isNaN()</code>ã€<code>Number.isNaN()</code> çš„ï¼Œè¯·çœ‹æ–‡ç«  <a href="https://www.jianshu.com/p/99be3be66e13">JavaScript çš„è¿·æƒ‘è¡Œä¸ºå¤§èµ</a> é‡Œé¢æ€»ç»“çš„ç¬¬äºŒã€ç¬¬ä¸‰èŠ‚å†…å®¹ã€‚</p>
</blockquote>
<h5>2. +0 ä¸ -0</h5>
<p>åœ¨ JavaScript ä¸­ï¼Œæ•°å­—ç±»å‹åŒ…æ‹¬æµ®ç‚¹æ•°ã€<code>+Infinity</code>ï¼ˆæ­£æ— ç©·ï¼‰ã€<code>-Infinity</code>ï¼ˆè´Ÿæ— ç©·ï¼‰å’ŒÂ <code>NaN</code>ï¼ˆnot-a-numberï¼Œéæ•°å­—ï¼‰ã€‚</p>
<p>è¿˜æœ‰ ES2021 æ ‡å‡†ä¸­å¢åŠ äº†ä¸€ç§ <code>BigInt</code>ï¼ˆåŸå§‹ï¼‰ç±»å‹ï¼Œè¡¨ç¤ºæå¤§çš„æ•°å­—ï¼ˆéæœ¬æ–‡èŒƒå›´ï¼Œä¸å±•å¼€å™è¿°ï¼‰ã€‚</p>
<p>å…¶å®ï¼Œ<code>+0</code> ä¸ <code>-0</code> æ˜¯ä¸ç›¸ç­‰çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-js">console.log(1 / +0 === Infinity) // true
console.log(1 / -0 === -Infinity) // true
console.log(Infinity === -Infinity) // false

// å› æ­¤ï¼Œ+0 å’Œ -0 æ˜¯ä¸¤ä¸ªä¸ç›¸ç­‰çš„å€¼ã€‚åªæ˜¯â€œå…¨ç­‰æ¯”è¾ƒç®—æ³•â€é‡Œè®¤ä¸ºä»–ä»¬æ˜¯ç›¸å¯¹çš„è€Œå·²ã€‚
</code></pre>
<h5>3. å¤„ç†ä»¥ä¸Šä¸¤ç§ç‰¹æ®Šçš„æƒ…å†µ</h5>
<p>åœ¨ ES6 æ ‡å‡†ä¸­ï¼Œæå‡ºæ¥ä¸€ä¸ªæ–¹æ³• <code>Object.is()</code>ï¼Œå¯¹ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½åšäº†â€œæ­£ç¡®â€çš„å¤„ç†ã€‚</p>
<pre><code class="language-js">Object.is(NaN, NaN) // true
Object.is(+0, -0) // false
</code></pre>
<p>è€Œ ES5 å¯ä»¥è¿™æ ·å»å¤„ç†ï¼š</p>
<pre><code class="language-js">function objectIs(x, y) {
  if (x === y) {
    // x === 0 =&gt; compare via infinity trick
    return x !== 0 || (1 / x === 1 / y)
  }

  // x !== y =&gt; return true only if both x and y are NaN
  return x !== x &amp;&amp; y !== y
}
</code></pre>
<h3>å››ã€ç›¸ç­‰è¿ç®—ç¬¦</h3>
<p>ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ<code>==</code> å’Œ <code>!=</code>ï¼‰ä½¿ç”¨<a href="https://www.ecma-international.org/ecma-262/5.1/#sec-11.9.3">æŠ½è±¡ç›¸ç­‰æ¯”è¾ƒç®—æ³•</a>æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ã€‚</p>
<blockquote>
<p>åœ¨çœ‹è¿™ä¸€èŠ‚ä¹‹å‰ï¼Œå¦‚æœå¯¹ JavaScript çš„ç±»å‹è½¬æ¢ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®å…ˆçœ‹ä¸‹è¿™æ–‡ç«  ğŸ‘‰ <a href="https://www.jianshu.com/p/fcac661bd3ed">Type Conversion è¯¦è§£</a>ã€‚</p>
</blockquote>
<h5>1. ES5 ç›¸ç­‰æ¯”è¾ƒç®—æ³•</h5>
<p>åœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Equality">MDN</a> å¯ä»¥çœ‹åˆ° <code>x == y</code> æ¯”è¾ƒçš„æè¿°ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯å¯¹è±¡ï¼Œåˆ™ä»…å½“ä¸¤ä¸ªæ“ä½œæ•°éƒ½å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯ <code>null</code>ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <code>undefined</code>ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°æ˜¯ä¸åŒç±»å‹çš„ï¼Œå°±ä¼šå°è¯•åœ¨æ¯”è¾ƒä¹‹å‰å°†å®ƒä»¬è½¬æ¢ä¸ºç›¸åŒç±»å‹ï¼š
<ul>
<li>å½“æ•°å­—ä¸å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¼šå°è¯•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—å€¼ã€‚</li>
<li>å¦‚æœæ“ä½œæ•°ä¹‹ä¸€æ˜¯ <code>Boolean</code>ï¼Œåˆ™å°†å¸ƒå°”æ“ä½œæ•°è½¬æ¢ä¸º <code>1</code> æˆ– <code>0</code>ã€‚
<ul>
<li>å¦‚æœæ˜¯ <code>true</code>ï¼Œåˆ™è½¬æ¢ä¸º <code>1</code>ã€‚</li>
<li>å¦‚æœæ˜¯Â <code>false</code>ï¼Œåˆ™è½¬æ¢ä¸º <code>0</code>ã€‚</li>
</ul>
</li>
<li>å¦‚æœæ“ä½œæ•°ä¹‹ä¸€æ˜¯å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼Œä¼šå°è¯•ä½¿ç”¨å¯¹è±¡çš„ <code>valueOf()</code> å’Œ <code>toString()</code> æ–¹æ³•å°†å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹å€¼ã€‚</li>
</ul>
</li>
<li>å¦‚æœæ“ä½œæ•°å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼Œåˆ™å°†å®ƒä»¬è¿›è¡Œå¦‚ä¸‹æ¯”è¾ƒï¼š
<ul>
<li><code>String</code>ï¼š<code>true</code> ä»…å½“ä¸¤ä¸ªæ“ä½œæ•°å…·æœ‰ç›¸åŒé¡ºåºçš„ç›¸åŒå­—ç¬¦æ—¶æ‰è¿”å›ã€‚</li>
<li><code>Number</code>ï¼š<code>true</code> ä»…å½“ä¸¤ä¸ªæ“ä½œæ•°å…·æœ‰ç›¸åŒçš„å€¼æ—¶æ‰è¿”å›ã€‚<code>+0</code> å¹¶è¢« <code>-0</code> è§†ä¸ºç›¸åŒçš„å€¼ã€‚å¦‚æœä»»ä¸€æ“ä½œæ•°ä¸º <code>NaN</code>ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
<li><code>Boolean</code>ï¼š<code>true</code> ä»…å½“æ“ä½œæ•°ä¸ºä¸¤ä¸ª <code>true</code> æˆ–ä¸¤ä¸ª <code>false</code> æ—¶æ‰è¿”å› <code>true</code>ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<p>æˆªæ­¢å‘æ–‡æ—¥æœŸï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒå¹¶æ²¡æœ‰å…³äº Symbol å’Œ BigInt ç±»å‹çš„æè¿°ï¼Œå› æ­¤ä»¥ä¸Šç›¸ç­‰æ¯”è¾ƒå¹¶ä¸æ˜¯æœ€æ–°çš„ã€‚</p>
<blockquote>
<p>ç›®å‰ MDN ä¸Šçš„æ–‡æ¡£ä»å±•ç¤ºçš„æ˜¯ ES5.1 çš„ç®—æ³•ï¼Œè€Œé˜®ä¸€å³°è€å¸ˆç¿»è¯‘çš„ä¸€ç¯‡ä¹Ÿä¸æ˜¯æœ€æ–°çš„<a href="https://es6.ruanyifeng.com/#docs/spec#%E7%9B%B8%E7%AD%89%E8%BF%90%E7%AE%97%E7%AC%A6">ç›¸ç­‰æ¯”è¾ƒç®—æ³•</a>ï¼Œå®ƒé‡Œé¢æ²¡æœ‰ ES2020 æ–°å¢çš„ BigInt ç±»å‹ã€‚</p>
</blockquote>
<h5>2. ES6+ ç›¸ç­‰æ¯”è¾ƒç®—æ³•</h5>
<p>ç›®å‰ ECMAScript æ ‡å‡†æœ€æ–°çš„<a href="https://262.ecma-international.org/#sec-abstract-equality-comparison">æŠ½è±¡ç›¸ç­‰æ¯”è¾ƒç®—æ³•</a>å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3f873c2a71fa6b65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>å¦‚æœ <code>x</code> ä¸ <code>y</code> ç›¸åŒï¼Œåˆ™è¿”å›å…¨ç­‰æ¯”è¾ƒ <code>x === y</code> çš„ç»“æœã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º <code>null</code> ä¸” <code>y</code> ä¸º <code>undefined</code>ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º <code>undefined</code> ä¸” <code>y</code> ä¸º <code>null</code>ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º Number ç±»å‹ï¼Œè€Œ <code>y</code> ä¸º String ç±»å‹ï¼Œé‚£ä¹ˆå…ˆå°† <code>y</code> è½¬æ¢ä¸º Number å†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º String ç±»å‹ï¼Œä¸” <code>y</code> ä¸º Number ç±»å‹ï¼Œé‚£ä¹ˆå…ˆå°† <code>x</code> è½¬æ¢ä¸º Number å†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ BigInt ç±»å‹ï¼Œä¸” <code>y</code> æ˜¯ String ç±»å‹ï¼Œåˆ™
a. å°† <code>y</code> è½¬æ¢ä¸º BigInt ç±»å‹ï¼Œè½¬æ¢ç»“æœæš‚è®°ä¸º <code>n</code>ã€‚
b. å¦‚æœ <code>n</code> ä¸º <code>NaN</code>ï¼Œåˆ™è¿”å› <code>false</code>ã€‚
c. å¦åˆ™ï¼Œè¿”å› <code>x == n</code> çš„æ¯”è¾ƒç»“æœã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º String ç±»å‹ï¼Œ<code>y</code> ä¸º BigInt ç±»å‹ï¼Œåˆ™è¿”å›æ¯”è¾ƒç»“æœ <code>y == x</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> ä¸º Boolean ç±»å‹ï¼Œé‚£ä¹ˆå…ˆå°†  <code>x</code> è½¬æ¢ä¸º Number ç±»å‹ï¼Œå†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>y</code> ä¸º Boolean ç±»å‹ï¼Œé‚£ä¹ˆå…ˆå°†  <code>y</code> è½¬æ¢ä¸º Number ç±»å‹ï¼Œå†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Stringã€Numberã€BigInt æˆ– Symbol ç±»å‹ï¼Œå¹¶ä¸” <code>y</code> æ˜¯Object ç±»å‹ï¼Œé‚£ä¹ˆå°† <code>y</code> è½¬æ¢æˆåŸå§‹ï¼ˆPrimativeï¼‰ç±»å‹å†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ Object ç±»å‹ï¼Œä¸” <code>y</code> æ˜¯Stringã€Numberã€BigInt æˆ–Symbol ç±»å‹ï¼Œé‚£ä¹ˆå°† <code>x</code> è½¬æ¢æˆåŸå§‹ï¼ˆPrimativeï¼‰ç±»å‹å†æ¯”è¾ƒã€‚</li>
<li>å¦‚æœ <code>x</code> æ˜¯ BigInt ç±»å‹ï¼Œä¸” <code>y</code> æ˜¯ Number ç±»å‹ï¼Œæˆ–è€… <code>x</code> æ˜¯ Number ç±»å‹ä¸” <code>y</code> æ˜¯ BigInt ç±»å‹ï¼Œåˆ™
a. å¦‚æœ <code>x</code> æˆ– <code>y</code> ä¸º <code>NaN</code>ã€<code>Infinity</code> æˆ– <code>-Infinity</code> ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™è¿”å› <code>false</code>ã€‚
b. å¦åˆ™è¿”å› <code>x</code> å’Œ <code>y</code> çš„æ¯”è¾ƒç»“æœã€‚</li>
<li>ä»¥ä¸Šéƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè¿”å› <code>false</code>ã€‚ä¾‹å¦‚è§„åˆ™ 10 åœ¨ç±»å‹è½¬æ¢æ—¶å‡ºç° <code>TypeError</code> çŠ¶å†µæ—¶ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡Œè¿”å› <code>false</code>ã€‚</li>
</ol>
</blockquote>
<p>ç›¸ç­‰è¿ç®—ç¬¦ä¸<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Strict_equality">å…¨ç­‰è¿ç®—ç¬¦</a>ï¼ˆ<code>===</code>ï¼‰è¿ç®—ç¬¦ä¹‹é—´æœ€æ˜¾ç€çš„åŒºåˆ«åœ¨äºï¼Œåè€…ä¸å°è¯•ç±»å‹è½¬æ¢ã€‚ç›¸åï¼Œå‰è€…å§‹ç»ˆå°†ä¸åŒç±»å‹çš„æ“ä½œæ•°è§†ä¸ºä¸åŒã€‚</p>
<p>åˆ—ä¸¾å‡ ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// è¿™äº›ä¾‹å­éƒ½æ˜¯å¾ˆç®€å•çš„
console.log(false == undefined) // false
console.log(null == undefined) // true
console.log(null == false) // false
console.log(null == 0) // false
console.log(null == '') // false
console.log('\n  123  \t' == 123) // true, because conversion to number ignores leading and trailing whitespace in JavaScript.
</code></pre>
<p>ç›¸ä¿¡å¾ˆå¤šäººåœ¨æ²¡æœ‰å®Œå…¨å¼„æ¸…æ¥šç›¸ç­‰è¿ç®—ç¬¦æ¯”è¾ƒçš„ã€å¥—è·¯ã€‘ä¹‹å‰ï¼Œä¼šå¾ˆè®©äººæŠ“ç‹‚...</p>
<p>é’ˆå¯¹ä»¥ä¸Š 13 æ¡è§„åˆ™ï¼Œå†æç‚¼æ€»ç»“ä¸€ä¸‹ï¼ˆä½†æ˜¯æ ‡å‡†æè¿°çœŸçš„æ˜¯éå¸¸åœ°ä¸¥è°¨ ğŸ‘ï¼‰ï¼š</p>
<ol>
<li>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°æ˜¯åŒä¸€ç±»å‹ï¼Œè¿”å› <code>x === y</code> çš„ç»“æœã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯ <code>null</code>ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <code>undefined</code>ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯ Number ç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯æ“ä½œæ•° String ç±»å‹ï¼Œé‚£ä¹ˆä¼šå°† String ç±»å‹çš„æ“ä½œæ•°å…ˆè½¬æ¢ä¸º Number ç±»å‹ï¼Œæ¥ç€æŒ‰ç¬¬ 1 ç‚¹å»æ¯”è¾ƒå¹¶è¿”å›ç»“æœã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•° <code>x</code> æ˜¯ BigInt ç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯æ“ä½œæ•° <code>y</code> æ˜¯ String ç±»å‹ï¼Œé‚£ä¹ˆä¼šå°† String ç±»å‹çš„æ“ä½œæ•°å…ˆè½¬æ¢ä¸º BigInt ç±»å‹ï¼ˆå‡è®¾è½¬æ¢ç»“æœä¸º <code>n</code>ï¼‰ã€‚
<ol>
<li>å¦‚æœ <code>n</code> ä¸º <code>NaN</code>ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦åˆ™è¿”å› <code>x == n</code> çš„ç»“æœã€‚</li>
</ol>
</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯ Boolean ç±»å‹ï¼Œåˆ™ä¼šå°†å¸ƒå°”å€¼è½¬æ¢ä¸º Number ç±»å‹ï¼Œå¹¶è¿”å› <code>x == ToNumber(y)</code> çš„ç»“æœã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯åŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆä¼šå°†å¼•ç”¨å€¼è½¬æ¢ä¸ºåŸå§‹å€¼ï¼Œå¹¶è¿”å› <code>ToPrimitive(x) == y</code>ã€‚</li>
<li>å¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯ BigInt ç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯ Number ç±»å‹ï¼Œé‚£ä¹ˆ
<ol>
<li>å¦‚æœå…¶ä¸­ä¸€ä¸ªæ•°æ˜¯ <code>NaN</code>ã€<code>Infinity</code> æˆ– <code>-Infinity</code> ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™è¿”å› <code>false</code>ã€‚</li>
<li>å¦‚æœ <code>x</code> å’Œ <code>y</code> çš„æ•°å­¦å€¼ç›¸ç­‰ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li>
</ol>
</li>
<li>è¿”å› <code>false</code>ï¼ˆåŒ…æ‹¬ä»¥ä¸Šè½¬æ¢è¿‡ç¨‹å‡ºç° <code>TypeError</code> éƒ½ä¼šåœ¨è¿™é‡Œè¿”å› <code>false</code>ï¼‰ã€‚</li>
</ol>
<blockquote>
<p>ä»”ç»†è§‚å¯Ÿå¯ä»¥çœ‹å¾—åˆ°ï¼Œç›¸ç­‰æ¯”è¾ƒéƒ½å‘ç€æ•°å­—ç±»å‹ï¼ˆè¿™é‡ŒæŒ‡ Number å’Œ BigIntï¼‰è½¬åŒ–çš„è¶‹åŠ¿ã€‚</p>
</blockquote>
<h3>äº”ã€ç›¸ç­‰æ¯”è¾ƒå¸¸è§ç¤ºä¾‹</h3>
<p>å…¶å®ç†Ÿæ‚‰ä»¥ä¸Šç®—æ³•ä¹‹åï¼Œé‡åˆ°ä¸€äº›çœ‹ä¼¼å¾ˆâ€œå¥‡è‘©â€çš„æ¯”è¾ƒä¹Ÿä¸è¶³ä¸ºæƒ§äº†ã€‚</p>
<h5>1. 0 == false</h5>
<pre><code class="language-js">0 == null // false
0 == undefined // falseï¼ŒåŒç†
</code></pre>
<p>æ ¹æ® <code>Type(x)</code> æŠ½è±¡æ“ä½œè§„åˆ™ï¼Œ<code>Type(0)</code> ç»“æœä¸º <code>Number</code>ï¼Œ<code>Type(null)</code> ç»“æœä¸º <code>Null</code>ï¼Œå†ç»“åˆæ¯”è¾ƒç®—æ³•ï¼Œå¯ä»¥æ¸…æ¥šåœ°çŸ¥é“å®ƒæŒ‰ç…§ç¬¬ 13 ç‚¹è¿”å› <code>false</code>ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ <code>Type(x)</code> æ˜¯æŒ‡ ECMAScript æ ‡å‡†é‡Œé¢å®šä¹‰çš„ä¸€ä¸ªæ“ä½œï¼Œè¯¥æ“ä½œè¡¨ç¤ºè¿”å› <code>x</code> å¯¹åº”çš„æ•°æ®ç±»å‹ã€‚è€Œä¸æ˜¯å…·ä½“çš„ JavaScript è¯­æ³•ï¼Œä¸ <code>typeof()</code> æœ‰æœ¬è´¨æ„ä¹‰ä¸Šçš„ä¸åŒï¼Œåˆ«æ··æ·†äº†ã€‚</p>
</blockquote>
<h5>2. [] == ![]</h5>
<p>çœ‹åˆ°è¿™ä¸ªå¼å­ï¼Œåƒä¸‡åˆ«æ€¥çœ¼ï¼Œä¸€æ­¥ä¸€æ­¥æ¥......</p>
<pre><code class="language-js">[] == ![] // true
</code></pre>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œæ ¹æ®è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œ<code>!</code> ï¼ˆé€»è¾‘éï¼‰çš„ä¼˜å…ˆçº§é«˜äº <code>==</code>ï¼Œå› æ­¤ä¼˜å…ˆæ‰§è¡Œ <code>![]</code>ã€‚è€Œ <code>[]</code> å±äºçœŸå€¼ï¼ˆTruthyï¼‰ ï¼Œæ‰€ä»¥ <code>![]</code> ç»“æœä¸º <code>false</code>ã€‚</p>
<pre><code class="language-js">[] == false
</code></pre>
<p>æ ¹æ®ç¬¬ 9 æ¡è§„åˆ™ï¼Œå…ˆå°† Boolean ç±»å‹çš„å€¼è½¬æ¢ä¸º Number ç±»å‹ï¼Œæ‰€ä»¥å˜æˆäº†ï¼š</p>
<pre><code class="language-js">[] == 0
</code></pre>
<p>å†æ ¹æ®ç¬¬ 11 æ¡è§„åˆ™ï¼Œå…ˆå°†å¼•ç”¨ç±»å‹è½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œæ•…è¿›è¡Œçš„æ“ä½œæ˜¯ <code>ToPrimitive([])</code>ã€‚</p>
<p>ï¼ˆè¿™æ­¥æ“ä½œå¯èƒ½ç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œä½†åˆ«æ€¥ï¼‰ç”±äºæ•°ç»„å®ä¾‹æœ¬èº«æ²¡æœ‰ <code>@@toPrimitive</code> æ–¹æ³•ï¼Œä¸”æ­¤æ—¶ <code>ToPrimitive</code> æ“ä½œçš„ <code>hint</code> å€¼ä¸º <code>&quot;default&quot;</code>ï¼ˆæ ¹æ® <code>ToPrimitive</code> è§„åˆ™ï¼Œé‡Œé¢çš„å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ä¼šå°† <code>hint</code> è®¾ä¸º <code>&quot;number&quot;</code>ï¼‰ï¼Œç„¶åè¿›è¡Œ <code>OrdinaryToPrimitive</code> æ“ä½œï¼Œå› æ­¤ä¼šå…ˆè°ƒç”¨ <code>valueOf</code> æ–¹æ³•ï¼Œå†è°ƒç”¨ <code>toString</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-js">// ç”±äº
[].valueOf() // ç»“æœä¸ºæ•°ç»„æœ¬èº«ï¼Œå¹¶éåŸå§‹å€¼ï¼Œæ¥ç€è°ƒç”¨ toString æ–¹æ³•
[].toString() // ç»“æœä¸º &quot;&quot;ï¼Œæ‰€ä»¥ [] çš„ ToPrimitive æ“ä½œè¿”å›çš„æ˜¯ç©ºå­—ç¬¦ä¸²

// æ‰€ä»¥å˜æˆäº†
'' == 0
</code></pre>
<p>æ ¹æ®ç¬¬ 5 æ¡è§„åˆ™ï¼Œå°† <code>&quot;&quot;</code> è½¬æ¢ä¸ºæ•°å€¼ <code>0</code>ï¼Œå³</p>
<pre><code class="language-js">0 == 0 // true
</code></pre>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œå…¶å®è¿˜æœ‰ä¸€æ­¥çš„ã€‚æ ¹æ®ç¬¬ 1 æ¡è§„åˆ™ï¼Œè¿”å› <code>0 === 0</code> çš„ç»“æœã€‚</p>
<p>æ•´ä¸ªè½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼Œå› æ­¤ <code>[] == ![]</code> æ¯”è¾ƒç»“æœä¸º <code>true</code>ã€‚</p>
<pre><code class="language-js">[] == ![]
[] == false
[] == 0
'' == 0
0 == 0
0 === 0 // true
</code></pre>
<h5>3. {} == !{}</h5>
<p>å®ƒçœ‹ç€è·Ÿå‰é¢ä¸€ä¸ªä¾‹å­å¾ˆç›¸ä¼¼ï¼Œè½¬æ¢è¿‡ç¨‹åŒç†ï¼Œä½†ç»“æœæ˜¯...</p>
<pre><code class="language-js">{} == !{} // false
</code></pre>
<p>é¦–å…ˆï¼Œæ ¹æ®æ“ä½œç¬¦ä¼˜å…ˆçº§é¡ºåºï¼Œå…ˆå°† <code>!{}</code> è½¬æ¢ä¸º <code>false</code>ã€‚å³å˜æˆäº† <code>{} == false</code> çš„æ¯”è¾ƒï¼Œç„¶åå°† <code>false</code> è½¬æ¢ä¸º <code>0</code>ï¼Œæ‰€ä»¥å˜æˆäº†ã€‚</p>
<pre><code class="language-js">{} == 0
</code></pre>
<p>ç„¶åå°† <code>{}</code> è½¬æ¢ä¸ºåŸå§‹å€¼ï¼Œå³æ‰§è¡Œ <code>ToPrimitive({})</code> æ“ä½œã€‚å…¶ä¸­ <code>hint</code> ä¸º <code>&quot;default&quot;</code>ã€‚æ‰€ä»¥å…ˆæ‰§è¡Œ <code>{}.toString()</code> æ–¹æ³•ï¼Œå¾—åˆ° <code>&quot;[object Object]&quot;</code> ç»“æœï¼Œç”±äºç»“æœå·²ç»æ˜¯åŸå§‹å€¼ï¼Œä¸å†è°ƒç”¨ <code>valueOf()</code> æ–¹æ³•äº†ã€‚</p>
<pre><code class="language-js">&quot;[object Object]&quot; == 0
</code></pre>
<p>æ ¹æ®ç¬¬ 5 æ¡è§„åˆ™ï¼Œå°† <code>&quot;[object Object]&quot;</code> è½¬æ¢ä¸ºæ•°å€¼ï¼Œè¿›è¡Œçš„æ“ä½œæ˜¯ <code>ToNumber(&quot;[object Object]&quot;)</code>ï¼Œå³æ‰§è¡Œæ–¹æ³• <code>Number(&quot;[object Object]&quot;)</code>ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ <code>NaN</code>ã€‚</p>
<pre><code class="language-js">NaN == 0
</code></pre>
<p>ç”±äº <code>NaN</code>ã€<code>0</code> éƒ½æ˜¯ Number ç±»å‹ï¼Œæ ¹æ®ç¬¬ 1 æ¡è§„åˆ™ï¼Œè¿”å› <code>NaN === 0</code> çš„ç»“æœã€‚è€Œ <code>NaN</code> ä¸ä»»ä½•æ“ä½œæ•°ï¼ˆåŒ…æ‹¬å…¶æœ¬èº«ï¼‰è¿›è¡Œå…¨ç­‰æ¯”è¾ƒï¼Œå‡è¿”å› <code>false</code>ã€‚</p>
<p>å› æ­¤ <code>{} == !{}</code> çš„ç»“æœä¸º <code>false</code>ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{} == !{}
{} == false
{} == 0
'[object Object]' == 0
NaN == 0
NaN === 0 // false
</code></pre>
<h5>4. 10 == 10n</h5>
<p>æ¥çœ‹çœ‹ Number ç±»å‹ä¸ BigInt ç±»å‹çš„ç›¸ç­‰æ¯”è¾ƒã€‚</p>
<pre><code class="language-js">10 == 10n // true
</code></pre>
<p>æ ¹æ®è§„åˆ™ç¬¬ 12 æ¡ï¼Œä¸”ä¸¤ä¸ªæ“ä½œæ•°å¹¶éæ˜¯ <code>NaN</code>ã€<code>Infinity</code>ã€<code>-Infinity</code>ï¼Œå› æ­¤æ¯”è¾ƒä¸¤è€…çš„æ•°å­¦å€¼ï¼ˆ<a href="https://262.ecma-international.org/#mathematical-value">mathematical value</a>ï¼‰ï¼Œå…¶æ•°å­¦å€¼æ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ç»“æœä¸º <code>true</code>ã€‚</p>
<h3>äº”ã€å…¶ä»–</h3>
<h5>1. +ã€-ã€*ã€/ã€% çš„éšå¼ç±»å‹è½¬æ¢</h5>
<p>é™¤äº† <code>+</code>ã€<code>-</code> æ—¢å¯ä»¥ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦ã€ä¹Ÿå¯ä»¥æ˜¯ç®—æœ¯è¿ç®—ç¬¦ï¼Œå…¶ä½™çš„å‡ä¸ºç®—æœ¯è¿ç®—ç¬¦ã€‚</p>
<ul>
<li>
<p>å½“ <code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>ã€<code>%</code> å‡ä¸ºç®—æœ¯è¿ç®—ç¬¦æ—¶ï¼Œä¼šå°†è¿ç®—ç¬¦ä¸¤è¾¹çš„æ“ä½œæ•°å…ˆè½¬æ¢ä¸º Number ç±»å‹ï¼ˆè‹¥å·²ç»æ˜¯ Number ç±»å‹åˆ™æ— éœ€å†è½¬æ¢ï¼‰ï¼Œå†è¿›è¡Œç›¸åº”çš„ç®—æœ¯è¿ç®—ã€‚</p>
</li>
<li>
<p>å½“ <code>+</code>ã€<code>-</code> ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦æ—¶ï¼Œå³åªæœ‰ä¸€ä¸ªè¿ç®—ç¬¦å’Œæ“ä½œæ•°ã€‚å‰è€…å°†æ“ä½œæ•°è½¬æ¢ä¸º Number ç±»å‹å¹¶è¿”å›ã€‚åè€…å°†æ“ä½œæ•°è½¬æ¢ä¸º Number ç±»å‹ï¼Œç„¶åå–åå†è¿”å›ã€‚</p>
</li>
</ul>
<p>æœªå®Œå¾…ç»­ï¼Œæ‹¼å‘½æ›´æ–°ä¸­...</p>
<!--
### å››ã€undefined å’Œ null çš„ä½¿ç”¨åŒºåˆ«:

å‡å¦‚ä½ æ‰“ç®—æŠŠä¸€ä¸ªå˜é‡èµ‹äºˆå¯¹è±¡ç±»å‹çš„å€¼ï¼Œä½†æ˜¯ç°åœ¨è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç”¨ `null` è¡¨ç¤ºæ­¤æ—¶çš„çŠ¶æ€(è¯æ®ä¹‹ä¸€å°±æ˜¯ typeof null çš„ç»“æœæ˜¯ 'object' )ï¼›ç›¸åï¼Œå‡å¦‚ä½ æ‰“ç®—æŠŠä¸€ä¸ªå˜é‡èµ‹äºˆåŸå§‹ç±»å‹çš„å€¼ï¼Œä½†æ˜¯ç°åœ¨è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç”¨ `undefined` è¡¨ç¤ºæ­¤æ—¶çš„çŠ¶æ€ã€‚

åœ¨ JavaScript ä¸­é™¤äº† `null` å’Œ `undefined` ä¹‹å¤–çš„ä»»ä½•æ•°æ®ç±»å‹éƒ½å¯ä»¥é€šè¿‡ `.toString()` æ–¹æ³•è½¬æ¢æˆå­—ç¬¦ä¸²

-->
<h3>å…­ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://dorey.github.io/JavaScript-Equality-Table/">JavaScript-Equality-Table</a></li>
<li><a href="https://www.jianshu.com/p/99be3be66e13">JavaScript çš„è¿·æƒ‘è¡Œä¸ºå¤§èµ</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Equality_comparisons_and_sameness">JavaScript ä¸­çš„ç›¸ç­‰æ€§åˆ¤æ–­</a></li>
<li><a href="https://262.ecma-international.org/#sec-strict-equality-comparison">Strict Equality Comparison</a></li>
<li><a href="https://262.ecma-international.org/#sec-abstract-equality-comparison">Abstract Equality Comparison</a></li>
</ul>
<!--
* ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆé˜®ä¸€å³°ï¼‰](https://es6.ruanyifeng.com/#docs/spec#ç›¸ç­‰è¿ç®—ç¬¦)
* [ä¸€å¼ å›¾å½»åº•ææ‡‚ JavaScript çš„ == è¿ç®—](https://zhuanlan.zhihu.com/p/21650547)
* [JavaScript abstract equality comparison](https://ithelp.ithome.com.tw/articles/10251167)
* [ECMAScript7è§„èŒƒä¸­çš„ToPrimitiveæŠ½è±¡æ“ä½œ](https://segmentfault.com/a/1190000016325587)
* [JavaScript å¯¹è±¡è½¬æ¢åˆ°åŸºæœ¬ç±»å‹å€¼ç®—æ³• ToPrimitive](https://juejin.cn/post/6844903555548053511)
-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | æ•°æ®ç±»å‹è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/239</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/239</guid>
            <pubDate>Sun, 26 Feb 2023 11:09:16 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©åˆåˆåˆ...åˆæ•´ç†äº†ä¸€ä¸‹ï¼Œé‚£äº› JavaScript é‡Œä¸æ¸…ä¸æ¥šçš„çŸ¥è¯†ç‚¹ã€‚</p>
<h3>ä¸€ã€æ•°æ®ç±»å‹çš„åˆ†ç±»</h3>
<p>æˆªæ­¢å‘æ–‡æ—¥æœŸï¼ŒECMAScript æ ‡å‡†çš„æ•°æ®ç±»å‹ä»…æœ‰ 8 ç§ï¼ˆ<a href="https://262.ecma-international.org/#sec-ecmascript]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©åˆåˆåˆ...åˆæ•´ç†äº†ä¸€ä¸‹ï¼Œé‚£äº› JavaScript é‡Œä¸æ¸…ä¸æ¥šçš„çŸ¥è¯†ç‚¹ã€‚</p>
<h3>ä¸€ã€æ•°æ®ç±»å‹çš„åˆ†ç±»</h3>
<p>æˆªæ­¢å‘æ–‡æ—¥æœŸï¼ŒECMAScript æ ‡å‡†çš„æ•°æ®ç±»å‹ä»…æœ‰ 8 ç§ï¼ˆ<a href="https://262.ecma-international.org/#sec-ecmascript-language-types">ECMAScript Language Types</a>ï¼‰ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><strong>åŸå§‹ç±»å‹</strong>ï¼ˆPrimitivesï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿç§°ä½œ<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>ã€‚
<ul>
<li>Undefined</li>
<li>Nullï¼ˆä¸€ç§ç‰¹æ®Šçš„åŸå§‹ç±»å‹ï¼Œ<code>typeof(instance) === 'object'</code>ï¼‰</li>
<li>Boolean</li>
<li>String</li>
<li>Symbolï¼ˆ<code>typeof(instance) === 'symbol'</code>ï¼‰</li>
<li>Number</li>
<li>BigIntï¼ˆ<code>typeof(instance) === 'bigint'</code>ï¼‰</li>
</ul>
</li>
<li><strong>å¼•ç”¨ç±»å‹</strong>ï¼ˆObjectsï¼‰
<ul>
<li>Objectï¼ˆåŒ…æ‹¬ä» Object æ´¾ç”Ÿå‡ºæ¥çš„ç»“æ„ç±»å‹ï¼Œå¦‚ Objectã€Arrayã€Mapã€Setã€Date ç­‰ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>å…³äºä½¿ç”¨ <code>typeof</code> åˆ¤æ–­ä»¥ä¸Šæ•°æ®ç±»å‹çš„è¯é¢˜ï¼Œè€ç”Ÿå¸¸è°ˆäº†ã€‚ä¾‹å¦‚ï¼Œä¸ºä»€ä¹ˆ <code>typeof null === 'object'</code>ã€<code>typeof(() =&gt; {}) === 'function'</code> å‘¢ï¼Ÿè¿™é‡Œä¸å±•å¼€èµ˜è¿°äº†ï¼Œè¯·ç§»æ­¥ï¼š<a href="https://www.jianshu.com/p/99be3be66e13">JavaScript çš„è¿·æƒ‘è¡Œä¸ºå¤§èµ</a>ã€‚</p>
</blockquote>
<p>åŸå§‹ç±»å‹çš„æ¯”è¾ƒçš„æ˜¯å€¼ï¼Œåªæœ‰ä¸¤è€…çš„å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œå¦åˆ™ä¸ç›¸ç­‰ã€‚è€Œå¼•ç”¨ç±»å‹æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼Œå½“ä¸¤è€…çš„æ ‡è¯†ç¬¦åŒæ—¶æŒ‡å‘å†…å­˜çš„åŒä¸€ä¸ªåœ°å€ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œå¦åˆ™ä¸ç›¸ç­‰ã€‚</p>
<pre><code class="language-js">console.log({} == {}) // false
console.log([] == []) // false
</code></pre>
<h3>äºŒã€åŸå§‹ç±»å‹ä¸åŸå§‹å€¼</h3>
<p>æ‰€æœ‰åŸºæœ¬ç±»å‹çš„å€¼ï¼ˆå³åŸå§‹å€¼ï¼ŒPrimitive Valuesï¼‰éƒ½æ˜¯<strong>ä¸å¯æ”¹å˜</strong>ï¼ˆimmutableï¼‰çš„ï¼Œè€Œä¸”<strong>ä¸å«ä»»ä½•å±æ€§å’Œæ–¹æ³•</strong>çš„ã€‚</p>
<p><strong>åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰å°ä¼™ä¼´æ‰“é—®å·äº†ï¼Ÿï¼Ÿï¼Ÿ</strong></p>
<p>Q1ï¼šåŸå§‹ç±»å‹ä¸åŸå§‹å€¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<blockquote>
<p>åŸå§‹ç±»å‹çš„å€¼ç§°ä¸ºåŸå§‹å€¼ã€‚ä¾‹å¦‚åŸå§‹ç±»å‹ Boolean æœ‰ä¸¤ä¸ªï¼ˆåŸå§‹ï¼‰å€¼ <code>true</code> å’Œ <code>false</code>ã€‚åŒæ ·çš„åŸå§‹ç±»å‹ Undefinedï¼ˆNullï¼‰ï¼Œåªæœ‰ä¸€ä¸ªåŸå§‹å€¼ <code>undefined</code>ï¼ˆ<code>null</code>ï¼‰ã€‚å…¶ä»–çš„å°±æœ‰å¾ˆå¤šä¸ªäº†...</p>
</blockquote>
<p>Q2ï¼šåŸå§‹å€¼ä¸å¯æ”¹å˜ï¼Ÿè¿™æ ·ä¸æ˜¯æ”¹å˜äº†å—ï¼Ÿ</p>
<pre><code class="language-js">var foo = true
foo = false
console.log(foo) // false
</code></pre>
<blockquote>
<p>å…¶å®ä¸ç„¶ï¼Œä»¥ä¸Šç¤ºä¾‹æ˜¯åŸå§‹ç±»å‹å’Œä¸€ä¸ªèµ‹å€¼ä¸ºåŸå§‹ç±»å‹çš„å˜é‡çš„åŒºåˆ«ã€‚å˜é‡ä¼šè¢«èµ‹äºˆä¸€ä¸ªæ–°å€¼ï¼Œè€ŒåŸå€¼ä¸èƒ½åƒæ•°ç»„ã€å¯¹è±¡ä»¥åŠå‡½æ•°é‚£æ ·è¢«æ”¹å˜ã€‚</p>
</blockquote>
<p>åŸºæœ¬ç±»å‹å€¼å¯ä»¥è¢«æ›¿æ¢ï¼Œä½†ä¸èƒ½è¢«æ”¹å˜ã€‚</p>
<pre><code class="language-js">// ä½¿ç”¨å­—ç¬¦ä¸²æ–¹æ³•ä¸ä¼šæ”¹å˜ä¸€ä¸ªå­—ç¬¦ä¸²
var foo = 'foo'
foo.toUpperCase()
console.log(foo) // &quot;foo&quot;

// èµ‹å€¼è¡Œä¸ºå¯ä»¥ç»™åŸºæœ¬ç±»å‹ä¸€ä¸ªæ–°å€¼ï¼Œè€Œä¸æ˜¯æ”¹å˜å®ƒ
foo = foo.toUpperCase() // &quot;FOO&quot;
</code></pre>
<p>å†æœ‰ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">var num = 1

function add(num) {
  num += 1
  console.log(num)
}

add(num) // 2
console.log(num) // 1

// ************************** åä¸½çš„åˆ†å‰²çº¿ **************************

// å¦‚æœæ²¡æœ‰çœ‹ä¸Šé¢çš„ä¸€äº›æ¦‚å¿µï¼Œå•çº¯åœ°çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ç›¸ä¿¡ç™¾åˆ†ç™¾éƒ½èƒ½å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚
// ä½†çœ‹å®Œä¸Šé¢ä¸€äº›çš„æ¦‚å¿µä¹‹åï¼Œå†ç»“åˆä¾‹å­ï¼Œä¸çŸ¥é“ä¼šä¸ä¼šæœ‰äººå¯¹ â€œåŸå§‹ç±»å‹çš„å€¼ä¸å¯æ”¹å˜â€ è¿™å¥è¯äº§ç”Ÿæ€€ç–‘ï¼Ÿ
// å¦‚æœæœ‰æ€€ç–‘å°±ç»§ç»­å¾€ä¸‹çœ‹ ğŸ‘‡ğŸ‘‡ğŸ‘‡ï¼Œå¦åˆ™å¯ç›´æ¥è·³åˆ° Q3 äº†ã€‚

// ************************** åä¸½çš„åˆ†å‰²çº¿ **************************

// JS è¿è¡Œçš„ä¸‰ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æã€é¢„ç¼–è¯‘ã€è§£ææ‰§è¡Œã€‚
// å…¶ä¸­é¢„ç¼–è¯‘ï¼Œä¸ä»…ä»…å‘ç”Ÿåœ¨ script ä»£ç å—æ‰§è¡Œä¹‹å‰ï¼Œè¿˜å‘ç”Ÿåœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰ã€‚
// 
// å‡½æ•°é¢„ç¼–è¯‘çš„è¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š
// 1. é¦–å…ˆæŸ¥æ‰¾å½¢å‚å’Œå˜é‡å£°æ˜ï¼ˆæ­¤æ—¶å¹¶èµ‹äºˆå€¼ undefinedï¼‰
// 2. æ¥ç€å°†å®å‚èµ‹å€¼ç»™å½¢å‚
// 3. æ¥ç€æŸ¥æ‰¾å‡½æ•°ä½“å†…çš„å‡½æ•°å£°æ˜ï¼ˆèµ‹äºˆå‡½æ•°æœ¬èº«ï¼‰ã€‚
//
// å‡½æ•° add åœ¨å®å‚èµ‹å€¼ç»™å½¢å‚çš„è¿‡ç¨‹ï¼Œä¼šå°†ä¼ é€’è¿›æ¥çš„å‚æ•°ï¼ˆåŸºæœ¬ç±»å‹çš„å€¼ï¼‰å¤åˆ¶ä¸€ä»½ï¼Œ
// åˆ›å»ºä¸€ä¸ªæœ¬åœ°å‰¯æœ¬ï¼Œè¯¥å‰¯æœ¬åªå­˜åœ¨äºè¯¥å‡½æ•°çš„ä½œç”¨åŸŸä¸­ã€‚ï¼ˆåŸæœ¬çš„å€¼ä¸å‰¯æœ¬æ˜¯å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°çš„ï¼‰
</code></pre>
<p>Q3ï¼šåŸå§‹å€¼æ²¡æœ‰ä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼Ÿé‚£è¿™ä¸ªæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p>
<pre><code class="language-js">var foo = 'foo'
console.log(foo.length) // 3
console.log(foo.toUpperCase()) // &quot;FOO&quot;

// è¯•å›¾æ”¹å˜ length å±æ€§
foo.length = 4
console.log(foo.length) // 3
</code></pre>
<blockquote>
<p>å…¶å®è¿™æ˜¯ JavaScript åŒ…è£…ç±»çš„å†…å®¹äº†ã€‚</p>
</blockquote>
<p>åœ¨ JavaScript ä¸­é™¤äº† <code>null</code> å’Œ <code>undefined</code> ä¹‹å¤–ï¼Œæ‰€æœ‰çš„åŸºæœ¬ç±»å‹éƒ½æœ‰å…¶å¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼ˆWrapper Objectï¼‰ã€‚å› æ­¤ï¼Œè®¿é—® <code>null</code> æˆ– <code>undefined</code> çš„ä»»ä½•å±æ€§å’Œæ–¹æ³•éƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<ul>
<li><code>String</code>Â ä¸ºå­—ç¬¦ä¸²åŸºæœ¬ç±»å‹ã€‚</li>
<li><code>Number</code> ä¸ºæ•°å€¼åŸºæœ¬ç±»å‹ã€‚</li>
<li><code>BigInt</code> ä¸ºå¤§æ•´æ•°åŸºæœ¬ç±»å‹ã€‚</li>
<li><code>Boolean</code> ä¸ºå¸ƒå°”åŸºæœ¬ç±»å‹ã€‚</li>
<li><code>Symbol</code> ä¸ºå­—é¢é‡åŸºæœ¬ç±»å‹ã€‚</li>
</ul>
<p>è¿™äº›åŒ…è£…å¯¹è±¡çš„ <code>valueOf </code>æ–¹æ³•è¿”å›å…¶å¯¹åº”çš„åŸå§‹å€¼ã€‚</p>
<blockquote>
<p>å†æ¬¡æ˜ç¡®ä¸€ç‚¹ï¼ŒåŸå§‹å€¼æ˜¯æ²¡æœ‰ä»»ä½•å±æ€§å’Œæ–¹æ³•çš„ã€‚</p>
</blockquote>
<p>ä¸æ˜¯è¯´å¥½çš„ï¼ŒåŸå§‹å€¼ä¸å«ä»»ä½•çš„å±æ€§å’Œæ–¹æ³•å—ï¼Ÿé‚£ <code>foo.length</code> å’Œ <code>foo.toUpperCase()</code> æ˜¯å’‹å›äº‹å•Šï¼Ÿï¼Ÿï¼Ÿ</p>
<p>å…¶å®å®ƒå†…éƒ¨æ˜¯è¿™æ ·å®ç°çš„ï¼š<strong>å½“å­—ç¬¦ä¸²å­—é¢é‡è°ƒç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ‰æœ‰çš„æ–¹æ³•æˆ–å±æ€§æ—¶ï¼ŒJavaScript ä¼šè‡ªåŠ¨å°†åŸºæœ¬å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å¯¹è±¡å¹¶ä¸”è°ƒç”¨ç›¸åº”çš„æ–¹æ³•æˆ–å±æ€§ã€‚</strong>ï¼ˆBoolean å’Œ Number ä¹ŸåŒæ ·å¦‚æ­¤ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å°è¯•åœ¨æ§åˆ¶å°ä¸Šæ‰“å°ä¸€ä¸‹ <code>new String('foo')</code>ï¼Œå¯ä»¥çœ‹åˆ°è¯¥å®ä¾‹å¯¹è±¡æœ‰ä¸€ä¸ª <code>length</code> å±æ€§ï¼Œå…¶å€¼ä¸º <code>3</code>ï¼Œå®ä¾‹å¯¹è±¡æœ¬èº«æ²¡æœ‰ <code>toUpperCase()</code> æ–¹æ³•ï¼Œæ‰€ä»¥æ¥ç€å¾€åŸå‹ä¸ŠæŸ¥æ‰¾ï¼Œæœç„¶æ‰¾åˆ°äº†ã€‚ï¼ˆç”±äºåŸå‹ä¸Šæ–¹æ³•å¤ªå¤šï¼Œæˆªå›¾é‡Œæ²¡æœ‰å±•å¼€ï¼Œå¦åˆ™å½±å“æ–‡ç« ç¯‡å¹…ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7e31081bc5ea336c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å› æ­¤</p>
<pre><code class="language-js">var foo = 'foo'
console.log(foo.length) // 3
console.log(foo.toUpperCase()) // &quot;FOO&quot;

// ç›¸å½“äº
var foo = 'foo'
console.log(new String(foo).length) // 3
console.log(new String(foo).toUpperCase()) // &quot;FOO&quot;
</code></pre>
<p>å¯ä¸‹é¢ä¸ºä»€ä¹ˆ <code>length</code> è¿˜æ˜¯ <code>3</code> å‘¢ï¼Ÿ</p>
<pre><code class="language-js">foo.length = 4
console.log(foo.length) // 3

// æ€æ ·ç†è§£å‘¢ï¼Ÿ
//
//
// æ‰§è¡Œç¬¬ä¸€è¡Œä»£ç 
// foo.length = 4 å¯ä»¥æ‹†åˆ†æˆä¸¤éƒ¨åˆ†å»ç†è§£ï¼š
var temp = new String(foo) // åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯æ²¡æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆå˜é‡ï¼‰æŒ‡å‘å®ƒè€Œå·²ï¼ˆä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘è¿™é‡Œå‡è£…æœ‰ä¸€ä¸ª temp å˜é‡æŒ‡å‘å®ƒï¼‰
temp.length = 4 // ä¿®æ”¹åŒ…è£…å¯¹è±¡çš„ length å±æ€§ï¼Œå…¶å®æ˜¯ä¿®æ”¹æˆåŠŸçš„
// ç”±äºè¯¥å¯¹è±¡å¹¶æ²¡æœ‰è¢«å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œä¸‹ä¸€å¥ä»£ç ä¹‹å‰å°±è¢«å›æ”¶é”€æ¯äº†
//
//
// 2. æ‰§è¡Œç¬¬äºŒè¡Œä»£ç 
// console.log(foo.length) ç›¸å½“äº
console.log(new String(foo).length) // foo è¿˜æ˜¯ &quot;foo&quot;ï¼Œè‡ªç„¶ç»“æœå°±æ˜¯ 3 äº†ã€‚
</code></pre>
<h3>ä¸‰ã€å¯¹è±¡</h3>
<p>åœ¨ JavaScript ä¸­ï¼Œé™¤äº†ä»¥ä¸Šçš„åŸå§‹å€¼ï¼Œå…¶ä½™éƒ½å±äºå¯¹è±¡ã€‚</p>
<p>ä¸åŸå§‹ç±»å‹ä¸åŒçš„æ˜¯ï¼Œå¯¹è±¡æ˜¯å¯å˜ï¼ˆmutableï¼‰çš„ã€‚</p>
<h5>1. å¯¹è±¡çš„åˆ†ç±»</h5>
<p>æˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡åˆ’åˆ†ä¸º<strong>æ™®é€šå¯¹è±¡</strong>ï¼ˆordinary objectï¼‰å’Œ<strong>å‡½æ•°å¯¹è±¡</strong>ï¼ˆfunction objectï¼‰ã€‚</p>
<p>é‚£æ€æ ·åŒºåˆ†å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå®šä¹‰ä¸€äº› <code>Function</code> å®ä¾‹å’Œ <code>Object</code> å®ä¾‹ï¼š</p>
<pre><code class="language-js">// Function å®ä¾‹
function fn1() {}
var fn2 = function() {}
var fn3 = new Function('console.log(&quot;Hi, everyone&quot;)') // ä¸€èˆ¬ä¸ä½¿ç”¨ Function æ„é€ å™¨å»ç”Ÿæˆ Function å¯¹è±¡ï¼Œç›¸æ¯”å‡½æ•°å£°æ˜æˆ–è€…å‡½æ•°è¡¨è¾¾å¼ï¼Œå®ƒè¡¨ç°æ›´ä¸ºä½æ•ˆã€‚

// Object å®ä¾‹
var obj1 = {}
var obj2 = new Object()
var obj3 = new fn1()
</code></pre>
<p>æˆ‘ä»¬æ¥æ‰“å°ä¸€ä¸‹ç»“æœï¼š</p>
<pre><code class="language-js">typeof Object     // &quot;function&quot;
typeof Function   // &quot;function&quot;

typeof fn1        // &quot;function&quot;
typeof fn2        // &quot;function&quot;
typeof fn3        // &quot;function&quot;

typeof obj1       // &quot;object&quot;
typeof obj2       // &quot;object&quot;
typeof obj3       // &quot;object&quot;
</code></pre>
<p><code>Object</code> å’Œ <code>Function</code> æœ¬èº«å°±æ˜¯ JavaScript ä¸­è‡ªå¸¦çš„å‡½æ•°å¯¹è±¡ã€‚å…¶ä¸­ <code>obj1</code>ã€<code>obj2</code>ã€<code>obj3</code> ä¸ºæ™®é€šå¯¹è±¡ï¼ˆå‡ä¸º <code>Object</code> çš„å®ä¾‹ï¼‰ï¼Œè€Œ <code>fn1</code>ã€<code>fn2</code>ã€<code>fn3</code> ä¸ºå‡½æ•°å¯¹è±¡ï¼ˆå‡æ˜¯ <code>Function</code> çš„å®ä¾‹ï¼‰ã€‚</p>
<p>è®°ä½ä»¥ä¸‹è¿™å¥è¯ï¼š</p>
<blockquote>
<p>æ‰€æœ‰ <code>Function</code> çš„å®ä¾‹éƒ½æ˜¯<strong>å‡½æ•°å¯¹è±¡</strong>ï¼Œè€Œå…¶ä»–çš„éƒ½æ˜¯<strong>æ™®é€šå¯¹è±¡</strong>ã€‚</p>
</blockquote>
<h5>2. å¯¹è±¡çš„åŸå‹</h5>
<p>æ¥ç€ï¼Œå¼•å…¥ä¸¤ä¸ªå¾ˆå®¹æ˜“è®©äººæŠ“ç‹‚ã€æ··æ·†çš„ä¸¤å…„å¼Ÿ <code>prototype</code> ï¼ˆåŸå‹å¯¹è±¡ï¼‰å’Œ <code>__proto__</code>ï¼ˆåŸå‹ï¼‰ã€‚è¿™ä¿©å…„å¼Ÿçš„ä¸»è¦æ˜¯ä¸ºäº†æ„é€ <strong>åŸå‹é“¾</strong>è€Œå­˜åœ¨çš„ã€‚</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡ç±»å‹</th>
<th>prototype</th>
<th>__proto__</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šå¯¹è±¡</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>å‡½æ•°å¯¹è±¡</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<p>å› æ­¤æœ‰ä»¥ä¸‹ç»“è®ºï¼š</p>
<blockquote>
<p>æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼Œè€Œåªæœ‰å‡½æ•°å¯¹è±¡æ‰å…·æœ‰ <code>prototype</code> å±æ€§ã€‚</p>
</blockquote>
<p>å†ä¸Šå‡ ä¸ªèœï¼Œè¯·æ…¢æ…¢å“å°ï¼š</p>
<pre><code class="language-js">// æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª constructor å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘å®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•°
Object.prototype.constructor === Object // true
Function.prototype.constructor === Function // true


// ï¼ˆå…¨å±€å¯¹è±¡ï¼‰Object æ˜¯ ï¼ˆæ„é€ å™¨ï¼‰Function çš„å®ä¾‹
// ï¼ˆå…¨å±€å¯¹è±¡ï¼‰Function ä¹Ÿæ˜¯ ï¼ˆæ„é€ å™¨ï¼‰Function çš„å®ä¾‹
Object.__proto__ === Function.prototype // true
Function.__proto__ === Function.prototype // true


// ï¼ˆæ„é€ å™¨ï¼‰Function ä¹Ÿæ˜¯ï¼ˆæ„é€ å™¨ï¼‰Object çš„å®ä¾‹
Function.prototype.__proto__ === Object.prototype // true


// ä»åŸå‹ä¸ŠæŸ¥æ‰¾å±æ€§ï¼Œä¸å¯èƒ½æ— ç»ˆæ­¢åœ°æŸ¥æ‰¾ä¸‹å»ï¼Œé‚£åŸå‹çš„å°½å¤´åœ¨å“ªå‘¢ï¼Ÿ
// ç«™åœ¨åŸå‹é¡¶ç«¯çš„ç”·äººï¼Œæ˜¯å®ƒã€‚
// å‡è®¾æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œå¦‚è‹¥å‰é¢çš„åŸå‹ä¸Šå‡æ— æ³•æŸ¥æ‰¾åˆ°ï¼Œæœ€ç»ˆä¼šæ­¢æ­¥äºæ­¤ï¼Œå¹¶è¿”å› undefinedã€‚
Object.prototype.__proto__ // null
</code></pre>
<p>åœ¨ JavaScript ä¸­è®¿é—®ä¸€ä¸ªå¯¹è±¡å±æ€§ï¼Œå®ƒåœ¨åŸå‹ä¸Šæ˜¯æ€æ ·æŸ¥æ‰¾çš„å‘¢ï¼Ÿ</p>
<pre><code class="language-js">function Person() {} // æ„é€ å‡½æ•°
var person = new Person() // å®ä¾‹åŒ–å¯¹è±¡
console.log(person.name);  // undefined

// è¿‡ç¨‹å¦‚ä¸‹ï¼š
person // æ˜¯å¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person['name'] // ä¸å­˜åœ¨å±æ€§ nameï¼Œç»§ç»­æŸ¥æ‰¾
person.__proto__ // æ˜¯å¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person.__proto__['name'] // ä¸å­˜åœ¨å±æ€§ nameï¼Œç»§ç»­æŸ¥æ‰¾
person.__proto__.__proto__ // æ˜¯å¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person.__proto__.__proto__['name'] // ä¸å­˜åœ¨å±æ€§ nameï¼Œç»§ç»­æŸ¥æ‰¾
person.__proto__.__proto__.__proto__ // ä¸æ˜¯å¯¹è±¡ï¼Œæ˜¯ null å€¼ã€‚åœæ­¢æŸ¥æ‰¾ï¼Œè¿”å› undefined
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Object.prototype.__proto__</code> ä»æœªè¢«åŒ…æ‹¬åœ¨ ECMAScript è¯­è¨€è§„èŒƒä¸­æ ‡å‡†åŒ–ï¼Œä½†å®ƒè¢«å¤§å¤šæ•°æµè§ˆå™¨å‚å•†æ‰€æ”¯æŒã€‚è¯¥ç‰¹æ€§å·²ä» Web æ ‡å‡†ä¸­åˆ é™¤ï¼Œè¯¦æƒ…å¯çœ‹ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto">Object.prototype.__proto__</a>ã€‚</p>
<p>åœ¨æ ‡å‡†ä¸­ï¼Œå‡ ä¹ï¼ˆä¾‹å¤–æ˜¯ <code>Object.create(null)</code> ï¼Œä¸‹é¢æœ‰è¯´æ˜ï¼‰æ¯ä¸ªå®ä¾‹å¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª <code>[[Prototype]]</code> å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘å¯¹è±¡çš„åŸå‹ï¼Œè€Œä¸”è¯¥å±æ€§å€¼åªä¼šæ˜¯<strong>å¯¹è±¡</strong>æˆ–è€… <code>null</code>ã€‚</p>
<p>åœ¨éæ ‡å‡†ä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>Object.prototype.__proto__</code> è®¿é—®ï¼ˆæˆ–è®¾ç½®ï¼‰å®ä¾‹å¯¹è±¡å†…éƒ¨çš„ <code>[[Prototype]]</code>ï¼Œè¿™ç§æ–¹å¼å…¶å®æ˜¯ä¸è¢«æ¨èä½¿ç”¨çš„ã€‚ç°åœ¨æ›´è¢«æ¨èä½¿ç”¨çš„æ–¹å¼æ˜¯ <code>Objec.getPrototypeOf()</code>/<code>Object.setPrototypeOf()</code>ã€‚</p>
</blockquote>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä»¥ä¸Šï¼ˆåŒ…æ‹¬ä¸‹æ–‡ï¼‰æ‰€æŒ‡å¯¹è±¡å‡ä¸æ˜¯é€šè¿‡ <code>Object.create(null)</code> å®ä¾‹åŒ–çš„ï¼ˆé™¤ç‰¹æ„è¯´æ˜å¤–ï¼‰ã€‚<code>Object.create(null)</code> å®ä¾‹åŒ–çš„å¯¹è±¡æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå†…éƒ¨æ²¡æœ‰ <code>[[Prototype]]</code> å±æ€§ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å…¶ä»–å†…éƒ¨å±æ€§ã€‚ï¼ˆ<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create()</a>ï¼‰</p>
</blockquote>
<pre><code class="language-js">var obj = Object.create(null)

var obj1 = Object.create(null)
var obj2 = {}

obj.__proto__ === undefined // true
obj.getPrototypeOf() // æŠ›å‡ºé”™è¯¯ TypeError: obj.getPrototypeOf is not a function
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ï¼Œçœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2a156e0f6acfa069.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>JavaScript å¸¸è¢«æè¿°ä¸ºä¸€ç§åŸºäºåŸå‹çš„è¯­è¨€ â€”â€” æ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŸå‹ï¼ˆ<code>[[Prototype]]</code>ï¼‰ï¼Œå¯¹è±¡ä»¥å…¶åŸå‹ä¸ºæ¨¡æ¿ã€ä»åŸå‹ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ã€‚åŸå‹å¯¹è±¡ä¹Ÿå¯èƒ½æ‹¥æœ‰åŸå‹ï¼Œå¹¶ä»ä¸­ç»§æ‰¿æ–¹æ³•å’Œå±æ€§ï¼Œä¸€å±‚ä¸€å±‚ã€ä»¥æ­¤ç±»æ¨ã€‚è¿™ç§å…³ç³»å¸¸è¢«ç§°ä¸ºåŸå‹é“¾ï¼ˆprototype chainï¼‰ã€‚</p>
<h5>3. ç»§æ‰¿</h5>
<p>å…³äºç»§æ‰¿å†…å®¹ï¼Œå¯çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/213">æ·±å…¥ JavaScript ç»§æ‰¿åŸç†</a>ã€‚</p>
<h5>4. å¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼ˆInternal propertiesï¼‰</h5>
<p>åœ¨è§„èŒƒä¸­ï¼Œå¯¹è±¡çš„å†…éƒ¨æ–¹æ³•å’Œå†…éƒ¨æ’æ§½ä½¿ç”¨åŒæ–¹æ‹¬å· <code>[[]]</code> ä¸­åŒ…å«çš„åç§°æ ‡è¯†ï¼Œä¸”é¦–å­—æ¯ä¸ºå¤§å†™ã€‚ä¾‹å¦‚ <code>[[Prototype]]</code>ã€<code>[[Class]]</code>ã€<code>[[Extensible]]</code>ã€<code>[[Call]]</code>ã€<code>[[Scopes]]</code>ã€<code>[[FunctionLocation]]</code> ç­‰ç­‰ã€‚</p>
<p>ä¸‹é¢æŒ‘å‡ ä¸ªæ¥è®²ä¸€ä¸‹ï¼š</p>
<p>4.1 [[Class]]</p>
<p><code>[[Class]]</code> æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œå…¶å€¼ä¸ºä»¥ä¸‹<strong>å­—ç¬¦ä¸²</strong>ä¹‹ä¸€ï¼š</p>
<ul>
<li>å¸¸è§çš„æœ‰ï¼š<code>Function</code>ã€<code>Object</code>ã€<code>Array</code>ã€<code>Boolean</code>ã€<code>Number</code>ã€<code>String</code>ã€<code>Symbol</code>ã€<code>RegExp</code>ã€<code>JSON</code>ã€<code>Date</code>ã€<code>Math</code>ã€<code>Error</code>ã€<code>Arguments</code> ç­‰ã€‚</li>
<li>æ¯”è¾ƒå°‘ç”¨çš„æœ‰ï¼š<code>BigInt</code>ã€<code>Set</code>ã€<code>WeakSet</code>ã€<code>Map</code>ã€<code>WeakMap</code>ã€<code>Reflect</code>ã€<code>Promise</code>ã€<code>GeneratorFunction</code>ã€<code>AsyncFunction</code>ã€<code>Window</code>ã€<code>Intl</code>ã€<code>WebAssembly</code>ï¼Œä»¥åŠæ´¾ç”Ÿäº <code>HTMLElement</code> çš„ï¼ˆå¦‚ <code>HTMLScriptElement</code> ï¼‰ç­‰ç­‰ã€‚</li>
<li>å‡ ä¹æ‰€æœ‰<a href="">æ ‡å‡†å†…ç½®å¯¹è±¡</a>ï¼Œéƒ½æœ‰ç‰¹å®šçš„ç±»å‹ã€‚å®åœ¨å¤ªå¤šäº†...</li>
</ul>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ <code>typeof</code> æ— æ³•åˆ¤æ–­å¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œæ— è®ºæ˜¯ <code>typeof {}</code>ã€<code>typeof []</code>ã€è¿˜æ˜¯ <code>typeof Math</code>  éƒ½è¿”å› <code>&quot;object&quot;</code>ã€‚ä½†æœ‰äº† <code>[[Class]]</code> å±æ€§ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒæ¥åˆ¤æ–­å¯¹è±¡çš„ç±»å‹äº†ã€‚è®¿é—® <code>[[Class]]</code> çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡é»˜è®¤çš„ <code>toString()</code> æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•æ˜¯é€šç”¨çš„ï¼‰ï¼š</p>
<blockquote>
<p>Object.prototye.toString()</p>
<ul>
<li>å¦‚æœå‚æ•° <code>undefined</code>ï¼Œåˆ™è¿”å› <code>[object Undefined]</code> å­—ç¬¦ä¸²ï¼›</li>
<li>å¦‚æœå‚æ•° <code>null</code>ï¼Œåˆ™è¿”å› <code>[object Null]</code> å­—ç¬¦ä¸²ï¼›</li>
<li>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å› <code>&quot;[object &quot; + obj.[[Class]] + &quot;]&quot;</code> å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ <code>[object Array]</code>ï¼›</li>
<li>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œåˆ™ä¼šå…ˆå°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„å¯¹è±¡ï¼Œç„¶åæŒ‰ç…§ä»¥ä¸Šçš„è§„åˆ™è¾“å‡ºã€‚</li>
</ul>
</blockquote>
<p>ä»¥ä¸‹å°è£…äº†è·å–å¯¹è±¡ç±»å‹çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-js">function getClass(x) {
  const { toString } = Object.prototype
  const str = toString.call(x)
  return /^\[object (.*)\]$/.exec(str)[1]
}

getClass(null) // &quot;Null&quot;
getClass(undefined) // &quot;Undefined&quot;
getClass({}) // &quot;Object&quot;
getClass([]) // &quot;Array&quot;
getClass(JSON) // &quot;JSON&quot;
getClass(() =&gt; {}) // &quot;Function&quot;
;(function() { return getClass(arguments) })() // &quot;Arguments&quot;
</code></pre>
<p>4.2 [[Construct]]</p>
<p>ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œå¦‚è‹¥æ²¡æœ‰ <code>[[construct]]</code> å±æ€§ï¼Œæ˜¯æ— æ³•ä½¿ç”¨ <code>new</code> å…³é”®å­—è¿›è¡Œæ„é€ çš„ã€‚</p>
<h3>å››ã€ç±»å‹è½¬æ¢</h3>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ<code>==</code>ï¼‰å»æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰ã€‚å½“ä¸¤ä¸ªæ“ä½œæ•°ä¸€ä¸ªæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯åŸå§‹ç±»å‹çš„æ—¶å€™ï¼Œå‰è€…ä¼šå…ˆè½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œå†æ¯”è¾ƒã€‚</p>
<p>é‚£ä¹ˆï¼Œå¼•ç”¨ç±»å‹æ˜¯å¦‚ä½•è½¬æ¢ä¸ºåŸå§‹ç±»å‹çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>å…³äº JavaScript ç±»å‹è½¬æ¢çš„å†…å®¹ï¼Œå·²ç»å•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« è¯¦ç»†åœ°ä»‹ç»äº†ï¼Œè¯·çœ‹ ğŸ‘‰ <a href="https://github.com/toFrankie/blog/issues/242">Type Conversion è¯¦è§£</a>ã€‚</p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://2ality.com/2013/09/types.html">JavaScriptâ€™s type system</a></li>
<li><a href="https://2ality.com/2013/01/categorizing-values.html">Categorizing values in JavaScript</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive">Primitive MDN</a></li>
<li><a href="https://262.ecma-international.org/#sec-toprimitive">ToPrimitive Abstract Operation</a></li>
<li><a href="https://262.ecma-international.org/#sec-ordinarytoprimitive">OrdinaryToPrimitive Abstract Operation</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³å®‰å“æ”¶èµ·é”®ç›˜æ— æ³•è§¦å‘å¤±ç„¦äº‹ä»¶çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/238</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/238</guid>
            <pubDate>Sun, 26 Feb 2023 11:06:46 GMT</pubDate>
            <description><![CDATA[<h2>èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨åšä¸€ä¸ªç§»åŠ¨ç«¯ Web é¡¹ç›®ï¼Œåœ¨é¦–é¡µåº•éƒ¨æ˜¯æœ‰ä¸€ä¸ªç±»ä¼¼äº APP å¯¼èˆªæ ï¼ˆä»¥ä¸‹ç§° <code>FootNav</code>ï¼‰ï¼Œé‡‡ç”¨çš„ <code>fixed</code> å¸ƒå±€å›ºå®šäºåº•éƒ¨ã€‚åŒæ—¶é¡µé¢æœ‰ä¸€äº› <code>&lt;input&gt;</code> è¾“å…¥æ¡†ï¼ˆä»¥ä¸‹ç§° <code>I]]></description>
            <content:encoded><![CDATA[<h2>èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨åšä¸€ä¸ªç§»åŠ¨ç«¯ Web é¡¹ç›®ï¼Œåœ¨é¦–é¡µåº•éƒ¨æ˜¯æœ‰ä¸€ä¸ªç±»ä¼¼äº APP å¯¼èˆªæ ï¼ˆä»¥ä¸‹ç§° <code>FootNav</code>ï¼‰ï¼Œé‡‡ç”¨çš„ <code>fixed</code> å¸ƒå±€å›ºå®šäºåº•éƒ¨ã€‚åŒæ—¶é¡µé¢æœ‰ä¸€äº› <code>&lt;input&gt;</code> è¾“å…¥æ¡†ï¼ˆä»¥ä¸‹ç§° <code>Input</code>ï¼‰ã€‚</p>
<p>å½“èšç„¦äº <code>Input</code> æ—¶ï¼Œåœ¨ iOS é¢„æœŸæ•ˆæœæ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯åœ¨æ€åƒåˆ€çš„ Android ä¸Šï¼Œé¡µé¢é«˜åº¦å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´ <code>FootNav</code> å›ºå®šåœ¨æ‰‹æœºé”®ç›˜ä¸Šé¢ï¼ŒåŒæ—¶ <code>FootNav</code> ä¹Ÿç›´æ¥æŒ¡ä½äº†è¾“å…¥æ¡†ï¼Œäº¤äº’ä½“éªŒéå¸¸çš„ç³Ÿç³•ã€‚</p>
<p>çƒ¦æ­»äº†...</p>
<h2>iOS ä¸ Android é”®ç›˜å¼¹å‡ºæ”¶èµ·çš„è¡¨ç°</h2>
<p>å…ˆäº†è§£ä¸‹èƒŒæ™¯ï¼Œé”®ç›˜çš„å¼¹å‡ºæ”¶èµ·ï¼Œåœ¨ iOS ç«¯ä¸ Android ç«¯çš„ WebView ä¸­è¡¨ç°å¹¶éä¸€è‡´çš„ã€‚</p>
<h3>é”®ç›˜å¼¹å‡º</h3>
<ul>
<li>
<p>iOS
åœ¨ iOS ç³»ç»Ÿçš„é”®ç›˜å¤„äºçª—å£çš„æœ€ä¸Šå±‚ã€‚å½“é”®ç›˜å¼¹å‡ºæ—¶ï¼ŒWebView çš„é«˜åº¦ <code>height</code> å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåªæ˜¯ <code>scrollTop</code> å‘ç”Ÿæ”¹å˜ã€‚é¡µé¢å¯ä»¥æ»šåŠ¨ï¼Œä¸”é¡µé¢å¯æ»šåŠ¨çš„æœ€å¤§é™åº¦ä¸ºå¼¹å‡ºé”®ç›˜çš„é«˜åº¦ï¼Œè€Œåªæœ‰é”®ç›˜å¼¹å‡ºæ—¶é¡µé¢æ°å¥½ä¹Ÿæ»šåŠ¨åˆ°æœ€åº•éƒ¨æ—¶ï¼Œ<code>scrollTop</code> çš„å˜åŒ–å€¼ä¸ºé”®ç›˜é«˜åº¦ã€‚</p>
</li>
<li>
<p>Android
åœ¨ Android ç³»ç»Ÿä¸­ï¼Œé”®ç›˜ä¹Ÿæ˜¯å¤„äºçª—å£çš„æœ€ä¸Šå±‚ã€‚é”®ç›˜å¼¹å‡ºæ—¶ï¼Œé¡µé¢é«˜åº¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœè¾“å…¥æ¡†åœ¨é è¿‘åº•éƒ¨çš„è¯ï¼Œå°±ä¼šè¢«é”®ç›˜æŒ¡ä½ï¼Œåªæœ‰ä½ è¾“å…¥çš„æ—¶å€™æ‰ä¼šæ»šåŠ¨åˆ°å¯è§†åŒ–åŒºåŸŸã€‚</p>
</li>
</ul>
<h3>é”®ç›˜æ”¶èµ·</h3>
<ul>
<li>
<p>iOS
å½“è§¦å‘é”®ç›˜ä¸ŠæŒ‰é’®æ”¶èµ·é”®ç›˜æˆ–è€…è¾“å…¥æ¡†ä»¥å¤–çš„åŒºåŸŸæ—¶ï¼Œè¾“å…¥æ¡†ä¼šå¤±å»ç„¦ç‚¹ï¼Œå› æ­¤ä¼šè§¦å‘è¾“å…¥æ¡†çš„ <code>blur</code> å¤±ç„¦äº‹ä»¶ã€‚</p>
</li>
<li>
<p>Android
å½“è§¦å‘é”®ç›˜ä¸Šçš„æŒ‰é’®æ”¶èµ·é”®ç›˜æ—¶ï¼Œè¾“å…¥æ¡†å¹¶ä¸ä¼šå¤±å»ç„¦ç‚¹ï¼Œå› æ­¤ä¸ä¼šè§¦å‘è¾“å…¥æ¡†çš„ <code>blur</code> äº‹ä»¶ï¼›è§¦å‘è¾“å…¥æ¡†ä»¥å¤–çš„åŒºåŸŸæ—¶ï¼Œè¾“å…¥æ¡†ä¼šå¤±å»ç„¦ç‚¹ï¼Œè§¦å‘è¾“å…¥æ¡†çš„ <code>blur</code> äº‹ä»¶ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç”±äºæˆ‘å¹¶æ²¡æœ‰è¿‡å¤šçš„æ·±å…¥äº†è§£ä¸¤è€…çš„å·®å¼‚è¡¨ç°ï¼Œä»¥ä¸Šå†…å®¹æ¥è‡ª<a href="https://www.cnblogs.com/xiaonian8/p/13740210.html">æ­¤å¤„</a>ã€‚</p>
</blockquote>
<h2>å¯»æ‰¾è§£å†³æ–¹æ¡ˆ</h2>
<p>é’ˆå¯¹ Android è®¾å¤‡åšå¤„ç†å°±è¡Œäº†ï¼ŒiOS æ— éœ€å¤„ç†ã€‚</p>
<h3>æ–¹æ¡ˆä¸€</h3>
<p>å¤„ç†æ–¹å¼ï¼š<strong><code>Input</code> èšç„¦éšè— <code>FootNav</code>ï¼Œå¤±ç„¦æ—¶å†å°†å…¶æ˜¾ç¤ºå‡ºæ¥</strong>ã€‚ï¼ˆåŒç†ï¼Œä¿®æ”¹å¸ƒå±€æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰</p>
<p>é¦–å…ˆè¿™ç§å¤„ç†æ€è·¯æ˜¯æ²¡æ¯›ç—…çš„ï¼Œä½†æ˜¯...</p>
<blockquote>
<p>æŸäº›æœºå‹ã€æŸäº›è¾“å…¥æ³•ï¼Œæ”¶èµ·é”®ç›˜å¹¶ä¸ä¼šè§¦å‘è¾“å…¥æ¡†çš„ <code>blur</code> å¤±ç„¦äº‹ä»¶ï¼Œå¯¼è‡´è¯¥æ–¹æ¡ˆç›´æ¥æµäº§ã€‚</p>
</blockquote>
<h3>æ–¹æ¡ˆäºŒ</h3>
<p>ç›‘å¬é¡µé¢é«˜åº¦çš„å˜åŒ–ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬å°±å¯ä»¥å¤„ç† FootNav çš„éšè—/æ˜¾ç¤ºäº†ã€‚</p>
<h2>å®ç°</h2>
<p>æ€è·¯å¾ˆç®€å•ï¼šé¦–å…ˆè¿›å…¥é¡µé¢æ—¶ï¼Œå…ˆè®°å½•çª—å£çš„åŸå§‹é«˜åº¦ã€‚æ¯å½“ <code>Input</code> èšç„¦æ—¶ï¼Œè®¾ç½® <code>window.onresize</code> å‡½æ•°ï¼Œå½“çª—å£å®½é«˜å‘ç”Ÿæ”¹å˜æ—¶ä¾¿ä¼šè§¦å‘ã€‚</p>
<p>ä»¥ React ä¸ºä¾‹ï¼š</p>
<pre><code class="language-jsx">class Home extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      showFootNav: true,
      initClientHeight: document.documentElement.clientHeight // è®°å½•åˆå§‹é«˜åº¦
    }
  }

  // åˆ¤æ–­ Android è®¾å¤‡
  isAndroid() {
    const ua = navigator.userAgent.toLowerCase()
    return ua.includes('android') || ua.includes('linux')
  }

  // ç›‘å¬çª—å£å˜åŒ–
  listenWindowResize() {
    let that = this

    if (this.isAndroid()) {
      window.onresize = () =&gt; {
        const { initClientHeight } = that.state
        const curClientHeight = document.documentElement.clientHeight // å½“å‰é¡µé¢é«˜åº¦

        if (curClientHeight &lt; initClientHeight) {
          // é”®ç›˜å¼¹å‡º
          that.setState({ showFootNav: false })
        } else {
          // é”®ç›˜æ”¶èµ·
          that.setState({ showFootNav: true }, () =&gt; {
            window.onresize = null // æ¸…ç©º onresize
          })
        }
      }
    }
  }

  render() {
    const { showFootNav } = this.state

    // ä»¥ä¸‹ Inputã€FootNav ä¸ºè‡ªå®šä¹‰å°è£…çš„ç»„ä»¶
    return (
      &lt;div&gt;
        &lt;Input onFocus={this.listenWindowResize.bind(this)} /&gt;
        {showFootNav ? &lt;FootNav /&gt; : null}
      &lt;/div&gt;
    )
  }
}
</code></pre>
<blockquote>
<p>æœ¬æ–‡ä¹‹å¤–çš„ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼ŒiOS ä¹Ÿæœ‰ä¸€äº› bug çš„ï¼Œæ¯”å¦‚å¾®ä¿¡æµè§ˆå™¨é‡Œæ”¶èµ·é”®ç›˜ä¹‹åï¼Œé¡µé¢ä¸å›å¼¹ï¼Œå¯å‚è€ƒ<a href="https://github.com/toFrankie/blog/issues/158">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://www.cnblogs.com/xiaonian8/p/13740210.html">h5 æ‰‹æœºé”®ç›˜å¼¹å‡ºæ”¶èµ·çš„å¤„ç†</a></li>
<li><a href="https://juejin.cn/post/6859545317378490376">å¯èƒ½è¿™äº›æ˜¯ä½ æƒ³è¦çš„ H5 é”®ç›˜å…¼å®¹æ–¹æ¡ˆ</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/158">å¾®ä¿¡æµè§ˆå™¨ä¸­ Input çš„å…¼å®¹æ€§å¤„ç†</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³è·¨åŸŸé—®é¢˜ Response to preflight request doesn't pass access control check]]></title>
            <link>https://github.com/toFrankie/blog/issues/237</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/237</guid>
            <pubDate>Sun, 26 Feb 2023 11:06:25 GMT</pubDate>
            <description><![CDATA[<p>å¯¹äºå‰åç«¯åˆ†ç¦»ï¼Œè·¨åŸŸé—®é¢˜è€ç”Ÿå¸¸è°ˆäº†ï¼Œé—®é¢˜æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>Access to fetch at '<a href="https://xxx/api/user">https://xxx/api/user</a>' from origin '<a href="http://h5.xx]]></description>
            <content:encoded><![CDATA[<p>å¯¹äºå‰åç«¯åˆ†ç¦»ï¼Œè·¨åŸŸé—®é¢˜è€ç”Ÿå¸¸è°ˆäº†ï¼Œé—®é¢˜æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>Access to fetch at '<a href="https://xxx/api/user">https://xxx/api/user</a>' from origin '<a href="http://h5.xxx.com">http://h5.xxx.com</a>' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: The 'Access-Control-Allow-Origin' header contains multiple values '<a href="http://h5.xxx.com">http://h5.xxx.com</a>, *', but only one is allowed. Have the server send the header with a valid value, or, if an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.</p>
</blockquote>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š</p>
<blockquote>
<p>ä»æº <code>http://h5.xxx.com</code> è®¿é—® <code>https://xxx/api/user</code> å¤„çš„è®¿å­˜å·²è¢« CORS ç­–ç•¥é˜»æ­¢ï¼šå¯¹é¢„æ£€è¯·æ±‚çš„å“åº”æœªé€šè¿‡è®¿é—®æ§åˆ¶æ£€æŸ¥ï¼š<code>Access-Control-Allow-Origin</code> æ ‡å¤´åŒ…å«å¤šä¸ªå€¼ <code>http://h5.xxx.com, *</code>ï¼Œä½†ä»…å…è®¸ä¸€ä¸ªã€‚ è®©æœåŠ¡å™¨å‘é€å¸¦æœ‰æœ‰æ•ˆå€¼çš„æ ‡å¤´ï¼Œæˆ–è€…ï¼Œå¦‚æœä¸é€æ˜çš„å“åº”æ»¡è¶³æ‚¨çš„éœ€è¦ï¼Œè¯·å°†è¯·æ±‚çš„æ¨¡å¼è®¾ç½®ä¸º <code>no-cors</code>ï¼Œä»¥åœ¨ç¦ç”¨ CORS çš„æƒ…å†µä¸‹è·å–èµ„æºã€‚</p>
</blockquote>
<p>åŸå› æ˜¯å°±æ˜¯åœ¨æœåŠ¡å™¨è®¾ç½®äº†å…è®¸è·¨åŸŸï¼ŒåŒæ—¶åˆåœ¨ Nginx ä»£ç†åˆè®¾ç½®äº†ä¸€æ¬¡ã€‚</p>
<p>åªè¦ç§»é™¤å…¶ä¸€å³å¯è§£å†³ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | this è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/236</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/236</guid>
            <pubDate>Sun, 26 Feb 2023 11:04:35 GMT</pubDate>
            <description><![CDATA[<p>æˆ‘ç›¸ä¿¡å¾ˆå¤šäººä¼šå°† <code>this</code> å’Œä½œç”¨åŸŸæ··æ·†åœ¨ä¸€èµ·ç†è§£ï¼Œå…¶å®å®ƒä»¬å®Œå…¨æ˜¯ä¸¤å›äº‹ã€‚</p>
<p>ä¾‹å¦‚ <code>this.xxx</code> å’Œ <code>console.log(xxx)</code> æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿå‰è€…æ˜¯æŸ¥æ‰¾å½“å‰ <code>this</code> æ‰€æŒ‡å¯¹è±¡ä¸Šçš„ <c]]></description>
            <content:encoded><![CDATA[<p>æˆ‘ç›¸ä¿¡å¾ˆå¤šäººä¼šå°† <code>this</code> å’Œä½œç”¨åŸŸæ··æ·†åœ¨ä¸€èµ·ç†è§£ï¼Œå…¶å®å®ƒä»¬å®Œå…¨æ˜¯ä¸¤å›äº‹ã€‚</p>
<p>ä¾‹å¦‚ <code>this.xxx</code> å’Œ <code>console.log(xxx)</code> æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿå‰è€…æ˜¯æŸ¥æ‰¾å½“å‰ <code>this</code> æ‰€æŒ‡å¯¹è±¡ä¸Šçš„ <code>xxx</code> å±æ€§ï¼Œåè€…æ˜¯åœ¨å½“å‰ä½œç”¨åŸŸé“¾ä¸ŠæŸ¥æ‰¾å˜é‡ <code>xxx</code>ã€‚</p>
<pre><code class="language-js">var foo = {
  bar: 'property', // å±æ€§
  fn: function () {
    var bar = 'variable' // å˜é‡
    console.log(this.bar)
    // è¿™é‡Œçš„ this.bar æ°¸è¿œä¸ä¼šå–åˆ° bar å˜é‡ï¼Œ
    // å¯èƒ½ä» foo å¯¹è±¡æˆ– window å¯¹è±¡ä¸ŠæŸ¥æ‰¾ bar å±æ€§ï¼ˆè§†ä¹å‡½æ•°è°ƒç”¨æ–¹å¼ï¼‰
  }
}
foo.fn() // &quot;property&quot;
</code></pre>
<p>ä½œç”¨åŸŸä¸å‡½æ•°çš„è°ƒç”¨æ–¹å¼æ— å…³ï¼Œè€Œ <code>this</code> åˆ™ä¸å‡½æ•°è°ƒç”¨æ–¹å¼ç›¸å…³ã€‚</p>
<p>å°± <code>this</code> é—®é¢˜å†™äº†ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/7d13893530de">ç»†è¯» JS ä¹‹ this è¯¦è§£ï¼ˆæœ¬æ–‡ï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/93e545ea4eb3">åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ this
</a></li>
</ul>
</blockquote>
<h3>ä¸€ã€this æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨ <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Basics#what_is_this">MDN</a> ä¸ŠåŸè¯æ˜¯ï¼š</p>
<blockquote>
<p>The <code>this</code> keyword refers to the current object the code is being written inside.</p>
</blockquote>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šåœ¨ JavaScript ä¸­ï¼Œå…³é”®å­— <code>this</code> æŒ‡å‘äº†å½“å‰ä»£ç è¿è¡Œæ—¶çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æœæˆ‘æ˜¯åˆšæ¥è§¦ JavaScript çš„è¯ï¼Œçœ‹åˆ°è¿™å¥è¯åº”è¯¥ä¼šæœ‰å¾ˆå¤šé—®å·ï¼Ÿï¼Ÿï¼Ÿ</p>
<h3>äºŒã€ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡ thisï¼Ÿ</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>person</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰ä¸€ä¸ª <code>name</code> å±æ€§å’Œ <code>sayHi()</code> æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬çš„éœ€æ±‚æ˜¯ï¼Œ<code>sayHi()</code> æ–¹æ³•è¦æ‰“å°å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function() {
    // è‹¥è¯¥æ–¹æ³•çš„åŠŸèƒ½æ˜¯ï¼Œæ‰“å°å‡ºï¼šHi, my name is Frankie.
    // è¦å¦‚ä½•å®ç°ï¼Ÿ
  }
}
</code></pre>
<ol>
<li>æ–¹æ¡ˆä¸€</li>
</ol>
<p>æœ€æ„šè ¢çš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function(name) {
    console.log('Hi, my name is ' + name + '.')
  }
}

person.sayHi(person.name) // Hi, my name is Frankie.
</code></pre>
<ol start="2">
<li>æ–¹æ¡ˆäºŒ</li>
</ol>
<p>æ–¹æ¡ˆä¸€åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•éƒ½éœ€è¦ä¼ å…¥ <code>person.name</code> å‚æ•°ï¼Œè¿˜ä¸å¦‚ä¼ å…¥ä¸€ä¸ª <code>person</code> å‚æ•°ã€‚è¯•å›¾ä¼˜åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function(context) {
    console.log('Hi, my name is ' + context.name + '.')
  }
}

person.sayHi(person) // Hi, my name is Frankie.
</code></pre>
<p>å…ˆå–ä¸ªå…³å­ï¼Œè¿™ç§æ–¹æ¡ˆçœ‹ç€æ˜¯ä¸æ˜¯è·Ÿ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call">Function.prototype.call()</a> æœ‰ç‚¹ç›¸ä¼¼?</p>
<ol start="3">
<li>æ–¹æ¡ˆä¸‰</li>
</ol>
<p>åœ¨æ–¹æ¡ˆäºŒé‡Œæ–¹æ³•çš„è°ƒç”¨æ–¹å¼ï¼Œçœ‹ç€è¿˜æ˜¯æœ‰ç‚¹ä¸é›…ã€‚èƒ½ä¸èƒ½æŠŠå½¢å‚ <code>context</code> ä¹Ÿçœç•¥æ‰ï¼Œç„¶åé€šè¿‡ <code>person.sayHi()</code> ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Ÿ</p>
<p>å½“ç„¶å¯ä»¥ï¼Œä½†æ­¤æ—¶çš„å½¢å‚ <code>context</code> è¦æ¢æˆ JavaScript ä¸­çš„ä¿ç•™å…³é”®å­— <code>this</code>ã€‚</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function() {
    console.log('Hi, my name is ' + this.name + '.')
  }
}

person.sayHi() // Hi, my name is Frankie.
</code></pre>
<p>ä½†æ˜¯ä¸ºä»€ä¹ˆ <code>this.name</code> çš„å€¼ç­‰äº <code>person.name</code> çš„å±æ€§å€¼å‘¢ï¼Ÿè¿˜æœ‰ <code>this</code> å“ªæ¥çš„ï¼Ÿ</p>
<blockquote>
<p>åŸæ¥ <strong><code>this</code> æŒ‡å‘å‡½æ•°<a href="">è¿è¡Œæ—¶</a>æ‰€åœ¨çš„ç¯å¢ƒï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ã€‚</strong></p>
</blockquote>
<p>å®é™…ä¸Šï¼Œ<code>this</code> å¯ä»¥ç†è§£ä¸ºå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå½¢å‚ï¼ˆ<strong>çœ‹ä¸è§çš„å½¢å‚</strong>ï¼‰ï¼Œåœ¨ä½ è°ƒç”¨ <code>person.sayHi()</code> çš„æ—¶å€™ï¼ŒJavaScript å¼•æ“ä¼šè‡ªåŠ¨å¸®ä½ æŠŠ <code>person</code> ç»‘å®šåˆ° <code>this</code> ä¸Šã€‚æ‰€ä»¥å½“ä½ é€šè¿‡ <code>this.name</code> è®¿é—®å±æ€§æ—¶ï¼Œå…¶å®å°±æ˜¯ <code>person.name</code>ã€‚</p>
<h3>ä¸‰ã€äº†è§£ this</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¥½åƒ <code>this</code> ä¹Ÿæ²¡é‚£ä¹ˆç¥ç§˜ï¼Œæ²¡é‚£ä¹ˆéš¾ç†è§£å˜›ï¼</p>
<blockquote>
<p>æ³¨æ„ï¼Œæœ¬å°èŠ‚ç¤ºä¾‹å‡åœ¨<strong>éä¸¥æ ¼æ¨¡å¼</strong>ä¸‹ï¼Œé™¤éæœ‰ç‰¹æ®Šè¯´æ˜ã€‚</p>
</blockquote>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function() {
    console.log('Hi, my name is ' + this.name + '.')
  }
}

var name = 'Mandy'
var sayHi = person.sayHi

// å†™æ³•ä¸€
person.sayHi() // Hi, my name is Frankie.

// å†™æ³•äºŒï¼ŒWhy???
sayHi() // Hi, my name is Mandy.
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>person.sayHi</code> å’Œ <code>sayHi</code> æ˜æ˜éƒ½æŒ‡å‘åŒä¸€ä¸ªå‡½æ•°ï¼Œä½†ä¸ºä»€ä¹ˆæ‰§è¡Œç»“æœä¸ä¸€æ ·å‘¢ï¼Ÿ</p>
<p>åŸå› å°±æ˜¯å‡½æ•°å†…éƒ¨ä½¿ç”¨äº† <code>this</code> å…³é”®å­—ã€‚ä¸Šé¢æåˆ° <code>this</code> æŒ‡çš„æ˜¯å‡½æ•°è¿è¡Œæ—¶æ‰€åœ¨çš„ç¯å¢ƒã€‚å¯¹äº <code>person.sayHi()</code> æ¥è¯´ï¼Œ<code>sayHi</code> è¿è¡Œåœ¨ <code>person</code> ç¯å¢ƒï¼Œæ‰€ä»¥ <code>this</code> æŒ‡å‘äº† <code>person</code>ï¼›å¯¹äº <code>sayHi()</code> æ¥è¯´ï¼Œ<code>sayHi</code> è¿è¡Œåœ¨å…¨å±€ç¯å¢ƒï¼Œæ‰€ä»¥ <code>this</code> æŒ‡å‘äº†å…¨å±€ç¯å¢ƒã€‚ï¼ˆå¯åœ¨ <code>sayHi</code> å‡½æ•°ä½“å†…æ‰“å° <code>this</code> æ¥å¯¹æ¯”ï¼‰</p>
<p><strong>é‚£ä¹ˆï¼Œå‡½æ•°çš„è¿è¡Œç¯å¢ƒæ˜¯æ€ä¹ˆå†³å®šçš„å‘¢ï¼Ÿ</strong></p>
<h5>å†…å­˜çš„æ•°æ®ç»“æ„</h5>
<p>ä¸‹é¢å…ˆäº†è§£ä¸€ä¸‹ JavaScript å†…å­˜çš„æ•°æ®ç»“æ„ã€‚JavaScript ä¹‹æ‰€ä»¥æœ‰ <code>this</code> çš„è®¾è®¡ï¼Œè·Ÿå†…å­˜é‡Œé¢çš„æ•°æ®ç»“æ„æœ‰å…³ç³»ã€‚</p>
<pre><code class="language-js">var person = { name: 'Frankie' }
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹å°†ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™å˜é‡ <code>person</code>ã€‚JavaScript å¼•æ“ä¼šå…ˆåœ¨å†…å­˜é‡Œé¢ï¼Œç”Ÿæˆä¸€ä¸ªå¯¹è±¡ <code>{ name: 'Frankie' }</code>ï¼Œç„¶åæŠŠè¿™ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€èµ‹å€¼ç»™å˜é‡ <code>person</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-18487772f7fc5381.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡ <code>person</code> æ˜¯ä¸€ä¸ªåœ°å€ï¼ˆreferenceï¼‰ã€‚åé¢å¦‚æœè¦è¯»å– <code>person.name</code>ï¼ŒJavaScript å¼•æ“å…ˆä» <code>person</code> æ‹¿åˆ°å†…å­˜åœ°å€ï¼Œç„¶åå†ä»è¯¥åœ°å€è¯»å‡ºåŸå§‹çš„å¯¹è±¡ï¼Œè¿”å›å®ƒçš„ <code>name</code> å±æ€§ã€‚</p>
<p>åŸå§‹çš„å¯¹è±¡ä»¥å­—å…¸ç»“æ„ä¿å­˜ï¼Œæ¯ä¸€ä¸ªå±æ€§åéƒ½å¯¹åº”ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šé¢çš„ä¾‹å­ <code>name</code> å±æ€§ï¼Œå®é™…ä¸Šæ˜¯ä»¥ä¸‹é¢çš„å½¢å¼ä¿å­˜çš„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2250ccaa51f6ddcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-js">{
  name: {
    [[value]]: 'Frankie',
    [[writable]]: true,
    [[enumerable]]: true,
    [[configurable]]: true
  }
}
</code></pre>
<p>è¿™æ ·çš„ç»“æ„æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œé—®é¢˜åœ¨äºå±æ€§çš„å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</p>
<pre><code class="language-js">var person = {
  sayHi: function() {}
}
</code></pre>
<p>è¿™æ—¶ï¼ŒJavaScript å¼•æ“ä¼šå°†å‡½æ•°å•ç‹¬ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç„¶åå†å°†å‡½æ•°çš„åœ°å€èµ‹å€¼ç»™ <code>sayHi</code> å±æ€§çš„ <code>value</code> å±æ€§ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5b758f89159dbe07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-js">{
  name: {
    [[value]]: å‡½æ•°çš„åœ°å€,
    [[writable]]: true,
    [[enumerable]]: true,
    [[configurable]]: true
  }
}
</code></pre>
<p>ç”±äºå‡½æ•°æ˜¯ä¸€ä¸ªå•ç‹¬çš„å€¼ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰æ‰§è¡Œã€‚</p>
<pre><code class="language-js">var fn = function() {}
var obj = { fn: fn }

// å•ç‹¬æ‰§è¡Œ
fn()

// obj ç¯å¢ƒæ‰§è¡Œ
obj.fn()
</code></pre>
<h5>ç¯å¢ƒå˜é‡</h5>
<p>JavaScript å…è®¸åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼Œå¼•ç”¨å½“å‰ç¯å¢ƒçš„å…¶ä»–å˜é‡ã€‚</p>
<pre><code class="language-js">var sayHi = function() {
  console.log('Hi, my name is ' + name + '.')
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå‡½æ•°ä½“é‡Œé¢ä½¿ç”¨äº†å˜é‡ <code>name</code>ã€‚è¯¥å˜é‡ç”±è¿è¡Œç¯å¢ƒæä¾›ã€‚</p>
<p>ç°åœ¨é—®é¢˜æ¥äº†ï¼Œç”±äºå‡½æ•°å¯ä»¥åœ¨ä¸åŒçš„è¿è¡Œç¯å¢ƒæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨å‡½æ•°ä½“å†…éƒ¨è·å–å½“å‰çš„è¿è¡Œç¯å¢ƒï¼ˆcontextï¼‰ã€‚æ‰€ä»¥ï¼Œ <code>this</code> å°±å‡ºç°äº†ï¼Œå®ƒçš„è®¾è®¡ç›®çš„å°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨ï¼ŒæŒ‡ä»£å‡½æ•°å½“å‰çš„è¿è¡Œç¯å¢ƒã€‚</p>
<pre><code class="language-js">var sayHi = function() {
  console.log('Hi, my name is ' + this.name + '.')
}
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡½æ•°ä½“å†…éƒ¨çš„ <code>this.name</code> å°±æ˜¯æŒ‡å½“å‰è¿è¡Œç¯å¢ƒçš„ ã€‚</p>
<pre><code class="language-js">var sayHi = function() {
  console.log('Hi, my name is ' + this.name + '.')
}

var name = 'Mandy'
var person = {
  name: 'Frankie',
  sayHi: sayHi
}

// å•ç‹¬æ‰§è¡Œ
sayHi() // Hi, my name is Mandy.

// person ç¯å¢ƒæ‰§è¡Œ
person.sayHi() // Hi, my name is Frankie.
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡½æ•° <code>sayHi</code> åœ¨å…¨å±€ç¯å¢ƒæ‰§è¡Œï¼Œ<code>this.name</code> æŒ‡å‘å…¨å±€ç¯å¢ƒçš„ <code>name</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-950b120d45b802f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ <code>person</code> ç¯å¢ƒæ‰§è¡Œï¼Œ<code>this.name</code> æŒ‡å‘ <code>person.name</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e3641235596e7b9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å›åˆ°æœ¬å°èŠ‚å¼€å¤´çš„ç¤ºä¾‹ä¸­ï¼š</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function() {
    console.log('Hi, my name is ' + this.name + '.')
  }
}

var name = 'Mandy'
var sayHi = person.sayHi

// å†™æ³•ä¸€
person.sayHi() // Hi, my name is Frankie.

// å†™æ³•äºŒï¼ŒWhy???
sayHi() // Hi, my name is Mandy.
</code></pre>
<p><code>person.sayHi()</code> æ˜¯é€šè¿‡ <code>person</code> æ‰¾åˆ° <code>sayHi</code>ï¼Œæ‰€ä»¥å°±æ˜¯åœ¨ <code>person</code> ç¯å¢ƒæ‰§è¡Œã€‚ä¸€æ—¦ <code>var sayHi = person.sayHi</code>ï¼Œå˜é‡ <code>sayHi</code> å°±ç›´æ¥æŒ‡å‘å‡½æ•°æœ¬èº«ï¼Œæ‰€ä»¥ <code>sayHi()</code> å°±å˜æˆåœ¨å…¨å±€ç¯å¢ƒæ‰§è¡Œã€‚</p>
<p>åœ¨ JavaScript ä¸­ï¼Œ<code>this</code> çš„å››ç§ç»‘å®šè§„åˆ™ï¼Œè€Œä»¥ä¸Šçš„ç¤ºä¾‹ <code>this</code> å‡å±äºé»˜è®¤ç»‘å®šçš„ã€‚</p>
<h3>å››ã€å‡½æ•°è°ƒç”¨</h3>
<p>ä¸Šé¢æœ‰æåˆ° <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call">Function.prototype.call()</a>ï¼Œä¸‹é¢å…ˆèŠèŠè¿™ä¸ªæ–¹æ³•ã€‚</p>
<blockquote>
<p>é¡ºä¾¿æä¸€ä¸‹ï¼Œ<code>call()</code> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply"><code>apply()</code></a> æ–¹æ³•ç±»ä¼¼ï¼ŒåŒºåˆ«åªæœ‰ä¸€ä¸ªï¼Œ<code>call()</code> æ–¹æ³•æ¥å—çš„æ˜¯<strong>å‚æ•°åˆ—è¡¨</strong>ï¼Œè€Œ <code>apply()</code> æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ª<strong>å‚æ•°æ•°ç»„</strong>ã€‚</p>
</blockquote>
<p><code>call()</code> å…è®¸ä¸ºä¸åŒçš„å¯¹è±¡åˆ†é…å’Œè°ƒç”¨å±äºä¸€ä¸ªå¯¹è±¡çš„å‡½æ•°/æ–¹æ³•ã€‚</p>
<h5>1. call è¯­æ³•</h5>
<blockquote>
<p>function.call(thisArg, arg1, arg2, ...)</p>
</blockquote>
<ul>
<li>thisArgï¼ˆå¯é€‰ï¼‰
åœ¨ function å‡½æ•°è¿è¡Œæ—¶ä½¿ç”¨çš„ <code>this</code> å€¼ã€‚è¯·æ³¨æ„ï¼Œ<code>this</code> å¯èƒ½ä¸æ˜¯è¯¥æ–¹æ³•çœ‹åˆ°çš„å®é™…å€¼ã€‚
åœ¨<strong>éä¸¥æ ¼æ¨¡å¼</strong>ä¸‹ï¼Œè‹¥å‚æ•°æŒ‡å®šä¸º <code>null</code> æˆ– <code>undefined</code>ï¼Œ<code>this</code> ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis">å…¨å±€å¯¹è±¡</a>ã€‚</li>
<li>arg1, arg2, ...
æŒ‡å®šçš„å‚æ•°åˆ—è¡¨ã€‚</li>
</ul>
<h5>2. ä½¿ç”¨ call æ–¹æ³•è°ƒç”¨å‡½æ•°ï¼Œä¸”ä¸æŒ‡å®šç¬¬ä¸€å‚æ•°</h5>
<p>æ­¤æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ï¼Œä¸¤è€…åœ¨ <code>this</code> çš„ç»‘å®šä¸Šæœ‰åŒºåˆ«ã€‚</p>
<pre><code class="language-js">// éä¸¥æ ¼æ¨¡å¼ä¸‹
var thing = 'world'

function hello(thing) {
  console.log('hello ' + this.thing)
}

hello.call() // hello world
// ç­‰ä»·äºä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼Œå‡æ‰“å°å‡º hello world
hello()
hello.call(null)
hello.call(undefined)
</code></pre>
<blockquote>
<p>ä½†åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>this</code> çš„å€¼å°†ä¼šæ˜¯ <code>undefined</code>ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ä¸‹é¢ç¤ºä¾‹ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">// ä¸¥æ ¼æ¨¡å¼ä¸‹
'use strict'

var thing = 'world'

function hello(thing) {
  console.log('hello ' + this.thing)
}

hello.call() // TypeError: Cannot read property 'thing' of undefined
</code></pre>
<h5>3. æ™®é€šå‡½æ•°è°ƒç”¨ï¼ˆå°ç»“ï¼‰</h5>
<p>åœ¨ JavaScript ä¸­ï¼Œå…¶å®æ‰€æœ‰çš„å‡½æ•°åŸå§‹çš„è°ƒç”¨æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>function.call(thisArg, arg1, arg2, ...)</p>
</blockquote>
<pre><code class="language-js">function fn() { }

// åŠ ç³–è°ƒç”¨
fn()
fn(x)

// è„±ç³–è°ƒç”¨ï¼ˆdesugarï¼‰&amp; ä¸¥æ ¼æ¨¡å¼
fn.call(undefined)
fn.call(undefined, x)

// è„±ç³–è°ƒç”¨ï¼ˆdesugarï¼‰&amp; éä¸¥æ ¼æ¨¡å¼
fn.call(window)
fn.call(window, x)
</code></pre>
<p><code>fn()</code> å…¶å®å°±æ˜¯ <code>fn.call()</code> çš„è¯­æ³•ç³–å½¢å¼ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œå½“å‡½æ•°<strong>è¢«è°ƒç”¨æ—¶</strong>ï¼Œå‡½æ•°çš„ <code>this</code> å€¼æ‰ä¼šè¢«ç»‘å®šã€‚</p>
</blockquote>
<p>æ™®é€šå‡½æ•°è°ƒç”¨å¯ä»¥æ€»ç»“æˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">fn(...args)
// ç­‰ä»·äº
fn.call(window [ES5-strict: undefined], ...args)


(function() {})()
// ç­‰ä»·äº
(function() {}).call(window [ES5-strict: undefined])
</code></pre>
<h5>4. æˆå‘˜å‡½æ•°è°ƒç”¨ï¼ˆæ–¹æ³•ï¼‰</h5>
<p>è¿™ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„è°ƒç”¨æ–¹å¼ï¼Œåˆå›åˆ°å¼€å¤´çš„é‚£ä¸ªç¤ºä¾‹ã€‚</p>
<pre><code class="language-js">var person = {
  name: 'Frankie',
  sayHi: function() {
    console.log('Hi, my name is ' + this.name + '.')
  }
}

person.sayHi() // Hi, my name is Frankie.
// ç­‰ä»·äº
person.sayHi.call(person) // Hi, my name is Frankie.
</code></pre>
<p>æ ¹æ®å‰é¢è®²è¿°çš„å‡½æ•°åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼Œä»¥ä¸Šç¤ºä¾‹è·Ÿä¸‹é¢åŠ¨æ€åœ°å°† <code>sayHi</code> æ–¹æ³•ç»‘å®šåˆ° <code>person</code> ä¸Šæ˜¯ä¸€è‡´çš„ã€‚</p>
<pre><code class="language-js">function sayHi() {
  console.log('Hi, my name is ' + this.name + '.')
}
var person = { name: 'Frankie' }
var name = 'Mandy'

// åŠ¨æ€æ·»åŠ åˆ° person ä¸Š
person.sayHi = sayHi

person.sayHi() // Hi, my name is Frankie.
sayHi() // Hi, my name is Mandy.
</code></pre>
<p>ä»¥ä¸Šä¸¤è€…åŒºåˆ«æ˜¯ï¼Œå‰ä¸€ä¸ªä¾‹å­çš„ <code>sayHi</code> å‡½æ•°åªèƒ½é€šè¿‡å˜é‡ <code>person</code> åœ¨å†…å­˜ä¸­æ ¹æ®å˜é‡å­˜æ”¾çš„å¯¹è±¡åœ°å€æ‰¾åˆ°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸‹æœ‰ä¸€ä¸ª <code>sayHi</code> å±æ€§ï¼Œè¯¥å±æ€§çš„ <code>[[value]]</code> å­˜æ”¾çš„å‡½æ•°åœ°å€ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ <code>person.sayHi()</code> è¿›è¡Œè°ƒç”¨ã€‚è€Œåä¸€ä¸ªä¾‹å­ä¸­ <code>sayHi</code> å‡½æ•°é™¤äº†å‰é¢æåˆ°çš„è°ƒç”¨æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥é€šè¿‡å˜é‡ <code>sayHi</code> å»è°ƒç”¨è¯¥å‡½æ•°ï¼ˆ<code>sayHi()</code>ï¼‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œ<code>sayHi</code> å‡½æ•°å¹¶æ²¡æœ‰åœ¨ç¼–å†™ä»£ç æ—¶ç¡®å®š <code>this</code> çš„æŒ‡å‘ã€‚<code>this</code> æ€»æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œæ ¹æ®å…¶è°ƒç”¨çš„ç¯å¢ƒè¿›è¡Œè®¾ç½®ã€‚</p>
</blockquote>
<h3>å››ã€this çš„ç»‘å®šæ–¹å¼</h3>
<p><code>this</code> æ˜¯ JavaScript çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒæ˜¯å‡½æ•°è¿è¡Œæ—¶ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œåªèƒ½åœ¨å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨ã€‚</p>
<pre><code class="language-js">function fn() {
  this.x = 1
}
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå‡½æ•° <code>fn</code> è¿è¡Œæ—¶ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨æœ‰ä¸€ä¸ª <code>this</code> å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>å‡½æ•°çš„ä¸åŒä½¿ç”¨åœºæ™¯ï¼Œ<code>this</code> ä¼šæœ‰ä¸åŒçš„å€¼ã€‚<strong>æ€»çš„æ¥è¯´ï¼Œ<code>this</code> å°±æ˜¯å‡½æ•°è¿è¡Œæ—¶æ‰€åœ¨çš„ç¯å¢ƒå¯¹è±¡ã€‚</strong></p>
<h5>1. æ™®é€šå‡½æ•°è°ƒç”¨ï¼ˆé»˜è®¤ç»‘å®šï¼‰</h5>
<p>è¿™æ˜¯å‡½æ•°æœ€å¸¸ç”¨çš„ç”¨æ³•äº†ï¼Œå±äºå…¨å±€æ€§è°ƒç”¨ï¼Œå› æ­¤ <code>this</code> å°±ä»£è¡¨å…¨å±€å¯¹è±¡ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œå…¨å±€å¯¹è±¡åœ¨ä¸åŒå®¿ä¸»ç¯å¢ƒä¸‹æ˜¯æœ‰åŒºåˆ«çš„ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹å…¨å±€å¯¹è±¡æ˜¯ <code>window</code>ï¼Œè€Œåœ¨ Node ç¯å¢ƒä¸‹ï¼Œå…¨å±€å¯¹è±¡æ˜¯ <code>global</code>ã€‚</p>
</blockquote>
<pre><code class="language-js">var x = 1

function fn() {
  console.log(this.x)
}

fn() // 1
</code></pre>
<p>æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨äº† ES6 çš„ <code>let</code> æˆ– <code>const</code> å»å£°æ˜å˜é‡ <code>x</code> æ—¶ï¼Œç»“æœåˆç¨å¾®æœ‰ç‚¹ä¸åŒäº†ï¼</p>
<pre><code class="language-js">let x = 1

function fn() {
  // æ³¨æ„ï¼Œè‹¥ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis ä¸º undefinedï¼Œæ‰€ä»¥æ‰§è¡Œ this.x å°±ä¼šæŠ¥é”™
  console.log(this.x)
}

fn() // undefined
</code></pre>
<p>åŸå› å¾ˆç®€å•ã€‚é¦–å…ˆåœ¨ <code>fn</code> è¿è¡Œæ—¶ï¼Œ<code>this</code> ä»ç„¶æŒ‡å‘ <code>window</code>ï¼Œåªä¸è¿‡ <code>window</code> å¯¹è±¡ä¸‹æ²¡æœ‰ <code>x</code> å±æ€§ï¼Œæ‰€ä»¥æ‰“å°äº† <code>undefined</code>ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p>
<pre><code class="language-js">// ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼Œå…¶å®éƒ½å¾€ window å¯¹è±¡æ·»åŠ äº† xã€y å±æ€§ï¼Œå¹¶èµ‹å€¼ã€‚
x = 1
var y = 2

// ä½†åœ¨ ES6 ä¹‹åï¼Œåšå‡ºäº†æ”¹å˜
// ä½¿ç”¨äº† letã€const æˆ–è€… class æ¥å®šä¹‰å˜é‡æˆ–ç±»ï¼Œéƒ½ä¸ä¼šå¾€é¡¶å±‚å¯¹è±¡æ·»åŠ å¯¹åº”å±æ€§
let x = 1
const y = 2
class Fn {}
</code></pre>
<blockquote>
<p>å…³äºè¿™å—å†…å®¹ï¼Œå¯ä»¥çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/43dcc8f36714">å…³äº varã€let çš„é¡¶å±‚å¯¹è±¡çš„å±æ€§</a>ã€‚</p>
</blockquote>
<h5>2. ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼ˆéšå¼ç»‘å®šï¼‰</h5>
<p>å‡½æ•°è¿˜ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™æ—¶ <code>this</code> å°±æŒ‡å‘è¿™ä¸ªä¸Šçº§å¯¹è±¡ã€‚</p>
<pre><code class="language-js">function fn() {
  console.log(this.x)
}

var obj = {
  x: 1,
  fn: fn
}

obj.fn() // 1

// è¿™é‡Œæˆ‘åˆå†æ¬¡æä¸€ä¸‹ï¼Œä½†ä¸è§£é‡Šäº†ã€‚å¦‚æœè¿˜ä¸æ‡‚ï¼Œä»å¤´å†çœ‹ä¸€éã€‚
fn() // undefined
</code></pre>
<h5>3. é€šè¿‡ callã€apply è°ƒç”¨ï¼ˆæ˜¾å¼ç»‘å®šï¼‰</h5>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°ä»¥åŠåŒºåˆ«ä¸å†èµ˜è¿°ï¼Œä¸Šé¢å·²ç»è®²è¿‡äº†ã€‚</p>
<pre><code class="language-js">var x = 0

function fn() {
  console.log(this.x)
}

var obj = {
  x: 1,
  fn: fn
}

obj.fn.call() // 0ï¼Œæ­¤æ—¶ this æŒ‡å‘å…¨å±€å¯¹è±¡
obj.fn.call(obj) // 1ï¼Œæ­¤æ—¶ this æŒ‡å‘ obj å¯¹è±¡
</code></pre>
<h5>4. ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨ï¼ˆnew ç»‘å®šï¼‰</h5>
<p>æ‰€è°“æ„é€ å‡½æ•°ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ã€‚è¿™æ—¶ï¼Œ<code>this</code> å°±æŒ‡å‘è¿™ä¸ªæ–°å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰ã€‚</p>
<pre><code class="language-js">function Fn() {
  this.x = 1
}

var obj = new Fn()
console.log(obj.x) // 1
</code></pre>
<p>ä¸ºäº†è¡¨æ˜è¿™æ—¶ <code>this</code> ä¸æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-js">var x = 'global'

function Fn() {
  this.x = 'local'
}

var obj = new Fn()

console.log(obj.x) // &quot;local&quot;
console.log(x) // &quot;global&quot;
</code></pre>
<p>æ ¹æ®ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¨å±€å˜é‡ <code>x</code> æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p>
<blockquote>
<p>ä»¥ä¸Šå‡ ç§ç»‘å®šæ–¹å¼ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p>
<ol>
<li>åªè¦ä½¿ç”¨ <code>new</code> å…³é”®å­—è°ƒç”¨ï¼Œæ— è®ºæ˜¯å¦è¿˜æœ‰ <code>call</code>ã€<code>apply</code> ç»‘å®šï¼Œ<code>this</code> å‡æŒ‡å‘å®ä¾‹åŒ–å¯¹è±¡ã€‚</li>
<li>é€šè¿‡ <code>call</code>ã€<code>apply</code> æˆ–è€… <code>bind</code> æ˜¾å¼ç»‘å®šï¼Œ<code>this</code> æŒ‡å‘è¯¥ç»‘å®šå¯¹è±¡ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ç¼ºçœæ—¶ï¼Œæ ¹æ®æ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œ<code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡æˆ–è€… <code>undefined</code>ï¼‰ã€‚</li>
<li>å‡½æ•°é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡è°ƒç”¨ï¼Œ<code>this</code> æŒ‡å‘ï¼ˆæœ€åï¼‰è°ƒç”¨å®ƒçš„å¯¹è±¡ã€‚</li>
<li>å¦‚ä»¥ä¸Šå‡æ²¡æœ‰ï¼Œåˆ™ä¼šé»˜è®¤ç»‘å®šã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>this</code> æŒ‡å‘ <code>undefined</code>ï¼Œå¦åˆ™æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚</li>
</ol>
</blockquote>
<h3>äº”ã€å…¶ä»–</h3>
<h5>1. ç®­å¤´å‡½æ•°</h5>
<p>ç®­å¤´å‡½æ•°ï¼Œæ²¡æœ‰è‡ªå·±çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this"><code>this</code></a>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/arguments"><code>arguments</code></a>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/super"><code>super</code></a> æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new.target"><code>new.target</code></a>ï¼Œå¹¶ä¸”å®ƒä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚ç”±äºæ²¡æœ‰ <code>this</code>ï¼Œå› æ­¤å®ƒä¸èƒ½ç»‘å®š <code>this</code>ã€‚</p>
<pre><code class="language-js">const obj = {
  x: 1,
  fn1: () =&gt; console.log(this.x, this),
  fn2: function() {
    console.log(this.x, this)
  }
}

obj.fn1() // undefined, Window{...}
obj.fn1.call(obj) // undefined, Window{...}
obj.fn2() // 1, Object{...}
</code></pre>
<h5>2. äº‹ä»¶å¤„ç†å‡½æ•°</h5>
<p>åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼Œä¼šå¯¼è‡´ <code>this</code> æŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œä½ çŸ¥é“å—ï¼Ÿ</p>
<blockquote>
<p>è¯¦è§ï¼š<a href="https://www.jianshu.com/p/93e545ea4eb3">åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ this</a></p>
</blockquote>
<h3>å…­ï¼šæ€è€ƒé¢˜</h3>
<p>æŠ›ä¸‹ä¸¤ä¸ªé¢˜ï¼Œå¯ä»¥åˆ†æåˆ†æä¸ºä»€ä¹ˆç»“æœä¸ä¸€æ ·ã€‚</p>
<p>ä¾‹ä¸€ï¼š</p>
<pre><code class="language-js">var length = 1

function foo() {
  console.log(this.length)
}

const obj = {
  length: 2,
  bar: function (cb) {
    cb()
  }
}

obj.bar(foo, 'p1', 'p2') // 1
</code></pre>
<p>ä¾‹äºŒï¼š</p>
<pre><code class="language-js">var length = 1

function foo() {
  console.log(this.length)
}

const obj = {
  length: 2,
  bar: function (cb) {
    arguments[0]()
  }
}

obj.bar(foo, 'p1', 'p2') // 3
</code></pre>
<h3>ä¸ƒã€å‚è€ƒ</h3>
<ul>
<li><a href="https://2ality.com/2011/11/uncurrying-this.html">Uncurrying â€œthisâ€ in JavaScript</a></li>
<li><a href="https://2ality.com/2017/12/alternate-this.html">A different way of understanding this in JavaScript</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2018/06/javascript-this.html">JavaScript çš„ this åŸç†</a></li>
<li><a href="https://yehudakatz.com/2011/08/11/understanding-javascript-function-invocation-and-this/">Understanding JavaScript Function Invocation and &quot;this&quot;</a></li>
<li><a href="https://www.quirksmode.org/js/this.html">The this keyword</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» ES6 | è§£æ„èµ‹å€¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/235</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/235</guid>
            <pubDate>Sun, 26 Feb 2023 11:03:04 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ ES6 ä¸­ï¼Œå…è®¸æŒ‰ç…§ä¸€å®šçš„æ¨¡å¼ï¼Œä»<strong>æ•°ç»„</strong>å’Œ<strong>å¯¹è±¡</strong>ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸º<strong>è§£æ„</strong>ï¼ˆDestructuringï¼‰ã€‚</p>
<p>è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦è¢«è§£æ„çš„å€¼ï¼ˆç­‰å·å³è¾¹çš„å€¼ï¼‰ä¸ä¸ºå¯¹è±¡æˆ–è€…æ•°ç»„ï¼ˆå¦‚å­—ç¬¦]]></description>
            <content:encoded><![CDATA[<p>åœ¨ ES6 ä¸­ï¼Œå…è®¸æŒ‰ç…§ä¸€å®šçš„æ¨¡å¼ï¼Œä»<strong>æ•°ç»„</strong>å’Œ<strong>å¯¹è±¡</strong>ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸º<strong>è§£æ„</strong>ï¼ˆDestructuringï¼‰ã€‚</p>
<p>è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦è¢«è§£æ„çš„å€¼ï¼ˆç­‰å·å³è¾¹çš„å€¼ï¼‰ä¸ä¸ºå¯¹è±¡æˆ–è€…æ•°ç»„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å€¼ã€å¸ƒå°”å€¼ï¼‰ï¼Œå°±å…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡ã€‚ä½† <code>undefined</code> å’Œ <code>null</code> é™¤å¤–ï¼Œå› ä¸ºå®ƒä¿©æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥è¿›è¡Œè§£æ„èµ‹å€¼ä¼šæŠ¥é”™ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ•°ç»„çš„è§£æ„èµ‹å€¼</li>
<li>å¯¹è±¡çš„è§£æ„èµ‹å€¼</li>
<li>å­—ç¬¦ä¸²çš„è§£æ„èµ‹å€¼</li>
<li>æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼</li>
<li>å‡½æ•°å‚æ•°çš„è§£æ„èµ‹å€¼</li>
<li>åœ†æ‹¬å·é—®é¢˜</li>
<li>ç”¨é€”</li>
</ul>
<h3>ä¸€ã€æ•°ç»„çš„è§£æ„èµ‹å€¼</h3>
<p>åªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰ Iterator æ¥å£ï¼ˆå¯éå†ç»“æ„ï¼‰ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°ç»„å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚JavaScript ä¸­åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>Array</li>
<li>Map</li>
<li>Set</li>
<li>String</li>
<li>TypredArray</li>
<li>å‡½æ•°çš„ arguments å¯¹è±¡</li>
<li>NodeList å¯¹è±¡</li>
</ul>
<h5>1. åŸºæœ¬ç”¨æ³•</h5>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä¸ºå˜é‡è¿›è¡Œèµ‹å€¼ï¼š</p>
<pre><code class="language-js">// åœ¨ ES5 æˆ‘ä»¬åªèƒ½ç›´æ¥æŒ‡å®šå€¼
var a = 1
var b = 2
var c = 3

// åœ¨ ES6 å…è®¸è¿™æ ·ä¸ºå˜é‡èµ‹å€¼
let [a, b, c] = [1, 2, 3]
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹è¡¨ç¤ºï¼Œå¯ä»¥ä»æ•°ç»„ä¸­æå–å€¼ï¼ŒæŒ‰ç…§å¯¹åº”ä½ç½®å¯¹å˜é‡èµ‹å€¼ã€‚</p>
<blockquote>
<p>æœ¬è´¨ä¸Šï¼Œè¿™ç§å†™æ³•å±äº**â€œæ¨¡å¼åŒ¹é…â€**ï¼Œåªè¦ç­‰å·ä¸¤è¾¹çš„æ¨¡å¼ç›¸åŒï¼Œå·¦è¾¹çš„å˜é‡å°±ä¼šè¢«èµ‹äºˆå¯¹åº”çš„å€¼ã€‚</p>
</blockquote>
<p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨åµŒå¥—æ•°ç»„è¿›è¡Œè§£æ„çš„ä¾‹å­ï¼š</p>
<pre><code class="language-js">let [foo, [[bar], baz]] = [1, [[2], 3]]
foo // 1
bar // 2
baz // 3

let [ , , third] = [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]
third // &quot;baz&quot;

let [x, , y] = [1, 2, 3]
x // 1
y // 3

let [head, ...tail] = [1, 2, 3, 4]
head // 1
tail // [2, 3, 4]

let [x, y, ...z] = ['a']
x // &quot;a&quot;
y // undefined
z // []
</code></pre>
<p>å¦‚æœè§£æ„ä¸æˆåŠŸï¼Œå˜é‡çš„å€¼å°±ç­‰äº <code>undefined</code>ã€‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µéƒ½å±äºè§£æ„ä¸æˆåŠŸï¼Œ<code>foo</code> çš„å€¼éƒ½ä¼šç­‰äº <code>undefined</code>ã€‚</p>
<pre><code class="language-js">let [foo] = []
foo // undefined

let [bar, foo] = [1]
foo // undefined
</code></pre>
<blockquote>
<p>å½“ç­‰å·å·¦è¾¹çš„æ¨¡å¼ï¼ŒåªåŒ¹é…ä¸€éƒ¨åˆ†ç­‰å·å³è¾¹çš„æ•°ç»„ï¼Œä¾ç„¶å¯ä»¥è§£æ„æˆåŠŸï¼Œè¿™ç§æƒ…å†µå±äºä¸å®Œå…¨è§£æ„ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­ï¼Œéƒ½å±äºä¸å®Œå…¨è§£æ„ï¼Œä½†æ˜¯å¯ä»¥æˆåŠŸã€‚</p>
<pre><code class="language-js">let [x, y] = [1, 2, 3];
x // 1
y // 2

let [a, [b], d] = [1, [2, 3], 4];
a // 1
b // 2
d // 4
</code></pre>
<p>å¦‚æœç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯æ•°ç»„ï¼ˆæˆ–è€…ä¸¥æ ¼åœ°è¯´ï¼Œä¸æ˜¯å¯éå†çš„ç»“æœï¼‰ï¼Œå°†ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">let [foo] = 1
let [foo] = false
let [foo] = NaN
let [foo] = undefined
let [foo] = null
let [foo] = {}

// TypeError: xxx is not iterable
</code></pre>
<p>ä¸Šé¢çš„è¯­å¥éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºç­‰å·å³è¾¹çš„å€¼ï¼Œè¦ä¹ˆè½¬ä¸ºå¯¹è±¡ä»¥åä¸å…·å¤‡ Iterator æ¥å£ï¼ˆå‰äº”ä¸ªè¡¨è¾¾å¼ï¼‰ï¼Œè¦ä¹ˆæœ¬èº«å°±ä¸å…·å¤‡ Iterator æ¥å£ï¼ˆæœ€åä¸€ä¸ªè¡¨è¾¾å¼ï¼‰ã€‚</p>
<p>ä¸Šé¢æåˆ°ï¼Œåªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰ Iterator æ¥å£ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°ç»„å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚æ¯”å¦‚ Set ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„çš„è§£æ„èµ‹å€¼ã€‚</p>
<pre><code class="language-js">let [x, y, z] = new Set(['a', 'b', 'c'])
x // &quot;a&quot;
</code></pre>
<p>ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œ<code>gen</code> æ˜¯ä¸€ä¸ª Generator å‡½æ•°ï¼ŒåŸç”Ÿå…·æœ‰ Iterator æ¥å£ã€‚è§£æ„èµ‹å€¼ä¼šä¾æ¬¡ä»è¿™ä¸ªæ¥å£è·å–å€¼ã€‚</p>
<pre><code class="language-js">function* gen() {
  let a = 0
  let b = 1
  while (true) {
    yield a
    ;[a, b] = [b, a + b]
  }
}

let [first, second, third, fourth, fifth, sixth] = gen()
sixth // 5
</code></pre>
<h5>2. é»˜è®¤å€¼</h5>
<p>è§£æ„èµ‹å€¼å…è®¸æŒ‡å®šé»˜è®¤å€¼ã€‚</p>
<pre><code class="language-js">let [foo = true] = []
foo // true

let [x, y = 'b'] = ['a']
x // &quot;a&quot;
y // &quot;b&quot;

let [x, y = 'b'] = ['a', undefined]
x // &quot;a&quot;
y // &quot;b&quot;
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒES6 å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ<code>===</code>ï¼‰åˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦æœ‰å€¼ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“ä¸€ä¸ªæ•°ç»„æˆå‘˜<strong>ä¸¥æ ¼ç­‰äº</strong> <code>undefined</code>ï¼Œé»˜è®¤å€¼æ‰ä¼šç”Ÿæ•ˆã€‚</p>
</blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„æˆå‘˜æ˜¯ <code>null</code>ï¼Œé»˜è®¤å€¼å°±ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸º <code>null</code> ä¸ä¸¥æ ¼ç­‰äº <code>undefined</code>ã€‚</p>
<pre><code class="language-js">let [x = 1] = [undefined]
x // 1

let [x = 1] = [null]
x // null
</code></pre>
<p>å¦‚æœé»˜è®¤å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼æ˜¯æƒ°æ€§æ±‚å€¼çš„ï¼Œå³åªæœ‰åœ¨ç”¨åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šæ±‚å€¼ã€‚ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œå› ä¸º <code>x</code> èƒ½å–åˆ°å€¼ï¼Œæ‰€ä»¥å‡½æ•° <code>fn</code> æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚</p>
<pre><code class="language-js">function fn() {
  return 'aaa'
}
let [x = f()] = [1]


// ç­‰ä»·äº
let x
if ([1][0] === undefined) {
  x = fn()
} else {
  x = [1][0]
}
</code></pre>
<p>æ³¨æ„ï¼Œ<strong>é»˜è®¤å€¼å¯ä»¥å¼•ç”¨è§£æ„èµ‹å€¼çš„å…¶ä»–å˜é‡ï¼Œä½†è¯¥å˜é‡å¿…é¡»å·²ç»å£°æ˜ã€‚</strong></p>
<pre><code class="language-js">let [x = 1, y = x] = [] // x=1; y=1

let [x = 1, y = x] = [2] // x=2; y=2

let [x = 1, y = x] = [1, 2] // x=1; y=2

let [x = y, y = 1] = [] // ReferenceError: Cannot access 'y' before initialization
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œæœ€åä¸€ä¸ªè¡¨è¾¾å¼ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºå°† <code>y</code> ç”¨åš <code>x</code> çš„é»˜è®¤å€¼æ—¶ï¼Œ<code>y</code> è¿˜æ²¡æœ‰å£°æ˜ã€‚</p>
<h3>äºŒã€å¯¹è±¡çš„è§£æ„èµ‹å€¼</h3>
<p>è§£æ„ä¸ä»…å¯ä»¥ç”¨äºæ•°ç»„ï¼Œè¿˜å¯ä»¥ç”¨äºå¯¹è±¡ã€‚</p>
<h5>1. åŸºæœ¬ç”¨æ³•</h5>
<pre><code class="language-js">let { foo, bar } = { foo: 'aaa', bar: 'bbb' }
foo // &quot;aaa&quot;
bar // &quot;bbb&quot;
</code></pre>
<p>å¯¹è±¡çš„è§£æ„ä¸æ•°ç»„æœ‰ä¸€ä¸ªé‡è¦çš„çš„ä¸åŒã€‚æ•°ç»„çš„å…ƒç´ æ˜¯æŒ‰æ¬¡åºæ’åˆ—çš„ï¼Œå˜é‡çš„å–å€¼ç”±å®ƒçš„ä½ç½®å†³å®šï¼›è€Œå¯¹è±¡çš„å±æ€§æ˜¯æ²¡æœ‰æ¬¡åºçš„ï¼Œå˜é‡å¿…é¡»ä¸å±æ€§åŒåï¼Œæ‰èƒ½å–åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<pre><code class="language-js">let { bar, foo } = { foo: 'aaa', bar: 'bbb' }
foo // &quot;aaa&quot;
bar // &quot;bbb&quot;

let { baz } = { foo: 'aaa', bar: 'bbb' }
baz // undefined
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¾‹å­ç­‰å·å·¦è¾¹çš„ä¸¤ä¸ªå˜é‡çš„æ¬¡åºï¼Œä¸ç­‰å·å³è¾¹ä¸¤ä¸ªåŒåå±æ€§çš„æ¬¡åºä¸ä¸€è‡´ï¼Œä½†æ˜¯å¯¹å–å€¼å®Œå…¨æ²¡æœ‰å½±å“ã€‚ç¬¬äºŒä¸ªä¾‹å­çš„å˜é‡æ²¡æœ‰å¯¹åº”çš„åŒåå±æ€§ï¼Œå¯¼è‡´å–ä¸åˆ°å€¼ï¼Œæœ€åç­‰äº <code>undefined</code>ã€‚</p>
<p>å¦‚æœè§£æ„å¤±è´¥ï¼Œå˜é‡çš„å€¼ç­‰äº <code>undefined</code>ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç­‰å·å³è¾¹çš„å¯¹è±¡ä¸­æ²¡æœ‰ <code>foo</code> å±æ€§ï¼Œæ‰€ä»¥å˜é‡ <code>foo</code> å–ä¸åˆ°å€¼ï¼Œæ‰€ä»¥ç­‰äº <code>undefined</code>ã€‚</p>
<pre><code class="language-js">let { foo } = { bar: 'baz' }
foo // undefined
</code></pre>
<p>å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç°æœ‰å¯¹è±¡çš„æ–¹æ³•ï¼Œèµ‹å€¼åˆ°æŸä¸ªå˜é‡ã€‚</p>
<pre><code class="language-js">// ä¾‹ä¸€ï¼Œå°† Math å¯¹è±¡çš„å¯¹æ•°ã€æ­£å¼¦ã€ä½™å¼¦æ–¹æ³•èµ‹å€¼åˆ°å¯¹åº”çš„å˜é‡ä¸Š
let { log, sin, cos } = Math

// ä¾‹äºŒï¼Œå°† console.log èµ‹å€¼åˆ° log å˜é‡ä¸Š
const { log } = console
log('Hello World') // &quot;Hello World&quot;
</code></pre>
<p>å¦‚æœå˜é‡åä¸å±æ€§åä¸ä¸€è‡´ï¼Œå¿…é¡»å†™æˆä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-js">let { foo: baz } = { foo: 'aaa', bar: 'bbb' };
baz // &quot;aaa&quot;

let obj = { first: 'hello', last: 'world' };
let { first: f, last: l } = obj;
f // &quot;hello&quot;
l // &quot;world&quot;
</code></pre>
<p>è¿™å®é™…ä¸Šè¯´æ˜ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼æ˜¯ä¸‹é¢å½¢å¼çš„ç®€å†™ï¼ˆå¯¹è±¡å±æ€§çš„ç®€å†™å½¢å¼ï¼‰ï¼š</p>
<pre><code class="language-js">let { foo: foo, bar: bar } = { foo: 'aaa', bar: 'bbb' }
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼çš„å†…éƒ¨æœºåˆ¶ï¼Œæ˜¯å…ˆæ‰¾åˆ°åŒåå±æ€§ï¼Œç„¶åå†èµ‹å€¼ç»™å¯¹åº”çš„å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„åè€…ï¼Œè€Œä¸æ˜¯å‰è€…ã€‚</p>
<pre><code class="language-js">let { foo: baz } = { foo: 'aaa', bar: 'bbb' }
baz // &quot;aaa&quot;
foo // ReferenceError: foo is not defined
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>foo</code> æ˜¯åŒ¹é…çš„æ¨¡å¼ï¼Œ<code>baz</code> æ‰æ˜¯å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯å˜é‡ <code>baz</code>ï¼Œè€Œä¸æ˜¯æ¨¡å¼ <code>foo</code>ã€‚</p>
<p>ä¸æ•°ç»„ä¸€æ ·ï¼Œè§£æ„ä¹Ÿå¯ä»¥ç”¨äºåµŒå¥—ç»“æ„çš„å¯¹è±¡ã€‚</p>
<pre><code class="language-js">let obj = {
  p: [
    'Hello',
    { y: 'World' }
  ]
}

let { p: [x, { y }] } = obj
x // &quot;Hello&quot;
y // &quot;World&quot;
</code></pre>
<p>æ³¨æ„ï¼Œæ­¤æ—¶ <code>p</code> æ˜¯æ¨¡å¼ï¼Œä¸æ˜¯å˜é‡ï¼Œå› æ­¤ä¹Ÿä¸ä¼šè¢«èµ‹å€¼ã€‚å¦‚æœ <code>p</code> ä¹Ÿè¦ä½œä¸ºå˜é‡èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚</p>
<pre><code class="language-js">let obj = {
  p: [
    'Hello',
    { y: 'World' }
  ]
};

let { p, p: [x, { y }] } = obj
x // &quot;Hello&quot;
y // &quot;World&quot;
p // [&quot;Hello&quot;, {y: &quot;World&quot;}]
</code></pre>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œç¤ºä¾‹ä¸­æœ‰ä¸‰æ¬¡è§£æ„èµ‹å€¼ï¼Œåˆ†åˆ«å¯¹ <code>loc</code>ã€<code>start</code>ã€<code>line</code> ä¸‰ä¸ªå±æ€§çš„è§£æ„èµ‹å€¼ã€‚æ³¨æ„ï¼Œæœ€åä¸€æ¬¡å¯¹ <code>line</code> å±æ€§çš„ç»“æ„èµ‹å€¼ä¹‹ä¸­ï¼Œåªæœ‰ <code>line</code> æ˜¯å˜é‡ï¼Œ<code>loc</code> å’Œ <code>start</code> éƒ½æ˜¯æ¨¡å¼ï¼Œä¸æ˜¯å˜é‡ã€‚</p>
<pre><code class="language-js">const node = {
  loc: {
    start: {
      line: 1,
      column: 5
    }
  }
};

let { loc, loc: { start }, loc: { start: { line }} } = node
line // 1
loc  // Object {start: Object}
start // Object {line: 1, column: 5}
</code></pre>
<p>ä¸‹é¢æ˜¯åµŒå¥—èµ‹å€¼çš„ä¾‹å­ã€‚</p>
<pre><code class="language-js">let obj = {}
let arr = []

;({ foo: obj.prop, bar: arr[0] } = { foo: 123, bar: true })

obj // {prop: 123}
arr // [true]
</code></pre>
<p>å¦‚æœè§£æ„æ¨¡å¼æ˜¯åµŒå¥—çš„å¯¹è±¡ï¼Œè€Œä¸”å­å¯¹è±¡æ‰€åœ¨çš„çˆ¶å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚
ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç­‰å·å·¦è¾¹å¯¹è±¡çš„ <code>foo</code> å±æ€§ï¼Œå¯¹åº”ä¸€ä¸ªå­å¯¹è±¡ã€‚è¯¥å­å¯¹è±¡çš„ <code>bar</code> å±æ€§ï¼Œè§£æ„æ˜¯ä¼šæŠ¥é”™ã€‚åŸå› å¾ˆç®€å•ï¼Œå› ä¸º <code>foo</code> è¿™æ—¶ç­‰äº <code>undefined</code>ï¼Œå†å–å­å±æ€§å°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">// TypeError: Cannot read property 'bar' of undefined
let { foo: { bar } } = { baz: 'baz' }
</code></pre>
<p>æ³¨æ„ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼å¯ä»¥å–åˆ°ç»§æ‰¿çš„å±æ€§ã€‚</p>
<pre><code class="language-js">const obj1 = {}
const obj2 = {}
Object.setPrototypeOf(obj1, obj2)

const { foo } = obj1
foo // &quot;bar&quot;
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¯¹è±¡ <code>obj1</code> çš„åŸå‹å¯¹è±¡æ˜¯ <code>obj2</code>ã€‚<code>foo</code> å±æ€§ä¸æ˜¯ <code>obj1</code> è‡ªèº«çš„å±æ€§ï¼Œè€Œæ˜¯ç»§æ‰¿è‡ª <code>obj2</code> çš„å±æ€§ï¼Œè§£æ„èµ‹å€¼å¯ä»¥å–åˆ°è¿™ä¸ªå±æ€§ã€‚</p>
<h5>2. é»˜è®¤å€¼</h5>
<p>å¯¹è±¡çš„è§£æ„ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ã€‚</p>
<pre><code class="language-js">let { x = 3 } = {}
x // 3

let { x, y = 5 } = { x: 1 }
x // 1
y // 5

let { x: y = 3 } = {}
y // 3

let { x: y = 3 } = { x: 5 }
y // 5

let { message: msg = 'Something went wrong' } = {}
msg // &quot;Something went wrong&quot;
</code></pre>
<p>é»˜è®¤å€¼ç”Ÿæ•ˆçš„æ¡ä»¶æ˜¯ï¼Œå¯¹è±¡çš„å±æ€§å€¼ä¸¥æ ¼ç­‰äº <code>undefined</code>ã€‚</p>
<pre><code class="language-js">let { x = 3 } = { x: undefined }
x // 3

let { x = 3 } = { x: null }
x // null
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå±æ€§ <code>x</code> ç­‰äº <code>nullï¼Œå› ä¸º </code>null<code>ä¸</code>undefined<code>ä¸ä¸¥æ ¼ç›¸ç­‰ï¼Œæ‰€ä»¥æ˜¯ä¸ªæœ‰æ•ˆçš„èµ‹å€¼ï¼Œå¯¼è‡´é»˜è®¤å€¼</code>3` ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<h5>3. æ³¨æ„ç‚¹</h5>
<p>(1) å¦‚æœè¦å°†ä¸€ä¸ªå·²ç»å£°æ˜çš„å˜é‡ç”¨äºè§£æ„èµ‹å€¼ï¼Œå¿…é¡»éå¸¸å°å¿ƒã€‚</p>
<pre><code class="language-js">// é”™è¯¯çš„å†™æ³•
let x
{ x } = { x: 1 }
// SyntaxError: Unexpected token '='
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹çš„å†™æ³•ä¼šæŠ¥é”™ï¼Œå› ä¸º JavaScript å¼•æ“ä¼šå°† <code>{ x }</code> ç†è§£æˆä¸€ä¸ªä»£ç å—ï¼Œä»è€Œå‘ç”Ÿè¯­æ³•é”™è¯¯ã€‚åªæœ‰ä¸å°†å¤§æ‹¬å·å†™åœ¨è¡Œé¦–ï¼Œé¿å… JavaScript å°†å…¶è§£æä¸ºä»£ç å—ï¼Œæ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// æ­£ç¡®çš„å†™æ³•
let x
;({ x } = { x: 1 })

// æ³¨æ„ä¸€ä¸‹ï¼Œç”±äºæˆ‘å¹³å¸¸çš„ç¼–ç¨‹åå‘äº semicolon-less é£æ ¼ï¼Œæ‰€ä»¥æˆ‘è¡Œå°¾æ˜¯ä¸å†™åˆ†å·çš„ï¼Œ
// ä½†æ˜¯æ­¤æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥è¡Œé¦–æ˜¯ä»¥ (ã€[ã€/ã€+ã€- å¼€å¤´çš„æ—¶å€™ä¸ºäº†é¿å…å‡ºç°éé¢„æœŸç»“æœæˆ–è¯­æ³•é”™è¯¯ï¼Œéœ€è¦æ‰‹åŠ¨æ’å…¥åˆ†å·ï¼ˆ;ï¼‰
// æ‰€ä»¥ç›¸å½“äºï¼š
let x;
({ x } = { x: 1 });
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹å°†æ•´ä¸ªè§£æ„èµ‹å€¼è¯­å¥ï¼Œæ”¾åœ¨ä¸€ä¸ªåœ†æ‹¬å·é‡Œé¢ï¼Œå°±å¯ä»¥æ­£ç¡®æ‰§è¡Œï¼ˆå…³äºåœ†æ‹¬å·ä¸è§£æ„èµ‹å€¼çš„å…³ç³»ï¼Œä¸‹æ–‡ä¼šæåˆ°ï¼‰ã€‚</p>
<p>(2) è§£æ„èµ‹å€¼å…è®¸ç­‰å·å·¦è¾¹çš„æ¨¡å¼ä¹‹ä¸­ï¼Œä¸æ”¾ç½®ä»»ä½•å˜é‡åã€‚å› æ­¤ï¼Œå¯ä»¥å†™å‡ºéå¸¸å¤æ€ªçš„èµ‹å€¼è¡¨è¾¾å¼ã€‚</p>
<pre><code class="language-js">;({} = [true, false])
;({} = 'abc')
;({} = [])
</code></pre>
<p>ä»¥ä¸Šçš„è¡¨è¾¾å¼è™½ç„¶æ¯«æ— æ„ä¹‰ï¼Œä½†æ˜¯è¯­æ³•æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</p>
<p>(3) ç”±äºå±æ€§æœ¬è´¨æ˜¯ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œå¯¹è±¡å±æ€§çš„è§£æ„ã€‚</p>
<pre><code class="language-js">let arr = [1, 2, 3]
let { 0: first, [arr.length - 1]: last } = arr
first // 0
lst // 3
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¯¹æ•°ç»„è¿›è¡Œå¯¹è±¡è§£æ„ã€‚æ•°ç»„ <code>arr</code> çš„ <code>0</code> é”®å¯¹åº”çš„å€¼æ˜¯ <code>1</code>ï¼Œ<code>[arr.length - 1]</code> å°±æ˜¯ <code>2</code> é”®ï¼Œå¯¹åº”çš„å€¼æ˜¯ <code>3</code>ã€‚æ–¹æ‹¬å·çš„è¿™ç§å†™æ³•å±äºâ€œå±æ€§åè¡¨è¾¾å¼â€çš„è¡¨è¾¾æ–¹å¼ã€‚</p>
<h3>ä¸‰ã€å­—ç¬¦ä¸²çš„è§£æ„èµ‹å€¼</h3>
<p>å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è§£æ„èµ‹å€¼ï¼Œè¿™æ˜¯å› ä¸ºå­—ç¬¦ä¸²è¢«è½¬æ¢æˆäº†ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚</p>
<pre><code class="language-js">const  [a, b, c, d, e] = 'hello'
a // &quot;h&quot;
b // &quot;e&quot;
c // &quot;l&quot;
d // &quot;l&quot;
e // &quot;o&quot;
</code></pre>
<p>ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>length</code> å±æ€§ï¼Œå› æ­¤è¿˜å¯ä»¥å¯¹è¿™ä¸ªå±æ€§è§£æ„èµ‹å€¼ã€‚</p>
<pre><code class="language-js">const { length: len } = 'hello'
len // 5
</code></pre>
<h3>å››ã€æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼</h3>
<p>è§£æ„èµ‹å€¼æ—¶ï¼Œå¦‚æœç­‰å·å³è¾¹æ˜¯æ•°å€¼å’Œå¸ƒå°”å€¼ï¼Œåˆ™ä¼šè½¬ä¸ºå¯¹è±¡ã€‚</p>
<pre><code class="language-js">let { toString: s } = 123
s === Number.prototype.toString // true

let { toString: s } = true
s === Boolean.prototype.toString // true
</code></pre>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œæ•°å€¼å’Œå¸ƒå°”å€¼çš„åŒ…è£…å¯¹è±¡éƒ½æœ‰ <code>toString</code> å±æ€§ï¼Œå› æ­¤å˜é‡ <code>s</code> éƒ½èƒ½å–åˆ°å€¼ã€‚</p>
<p>è§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å¯¹è±¡æˆ–æ•°å€¼ï¼Œå°±å…ˆå…¶è½¬ä¸ºå¯¹è±¡ã€‚ç”±äº <code>undefined</code> å’Œ <code>null</code> æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">let { prop: x } = undefined // TypeError: Cannot destructure property 'prop' of 'undefined' as it is undefined.
let { prop: y } = null // TypeError: Cannot destructure property 'prop' of 'null' as it is null.
</code></pre>
<h3>äº”ã€å‡½æ•°å‚æ•°çš„è§£æ„èµ‹å€¼</h3>
<p>å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡½æ•° <code>add</code> çš„å‚æ•°è¡¨é¢ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†åœ¨ä¼ å…¥å‚æ•°çš„é‚£ä¸€åˆ»ï¼Œæ•°ç»„å‚æ•°å°±è¢«è§£æ„æˆå˜é‡ <code>x</code> å’Œ <code>y</code>ã€‚å¯¹äºå‡½æ•°å†…éƒ¨çš„ä»£ç æ‹‰è¯´ï¼Œå®ƒä»¬èƒ½æ„Ÿå—åˆ°çš„å‚æ•°å°±æ˜¯ <code>x</code> å’Œ <code>y</code>ã€‚</p>
<pre><code class="language-js">function add([x, y]) {
  return x + y
}

add([1, 2]) // 3
</code></pre>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="language-js">;[[1, 2], [3, 4]].map(([a, b]) =&gt; a + b) // [3, 7]
</code></pre>
<p>å‡½æ•°å‚æ•°çš„è§£æ„ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<pre><code class="language-js">function move({x = 0, y = 0} = {}) {
  return [x, y]
}

move({x: 3, y: 8}) // [3, 8]
move({x: 3}) // [3, 0]
move({}) // [0, 0]
move() // [0, 0]
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå‡½æ•° <code>move</code> çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„ï¼Œå¾—åˆ°å˜é‡ <code>x</code> å’Œ <code>y</code> çš„å€¼ã€‚å¦‚æœè§£æ„å¤±è´¥ï¼Œ<code>x</code> å’Œ <code>y</code> ç­‰äºé»˜è®¤å€¼ã€‚</p>
<p>æ³¨æ„ï¼Œä¸‹é¢çš„å†™æ³•ä¼šå¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœã€‚</p>
<pre><code class="language-js">function move({x, y} = { x: 0, y: 0 }) {
  return [x, y]
}

move({x: 3, y: 8}) // [3, 8]
move({x: 3}) // [3, undefined]
move({}) // [undefined, undefined]
move() // [0, 0]
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæ˜¯ä¸ºå‡½æ•° <code>move</code> çš„å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯ä¸ºå˜é‡ <code>x</code> å’Œ <code>y</code> æŒ‡å®šé»˜è®¤å€¼ï¼Œæ‰€ä»¥ä¼šå¾—åˆ°ä¸å‰ä¸€ç§å†™æ³•ä¸åŒçš„ç»“æœã€‚</p>
<p><code>undefined</code> å°±ä¼šè§¦å‘å‡½æ•°æ‰èƒ½ä¸Šçš„é»˜è®¤å€¼ã€‚</p>
<pre><code class="language-js">;[1, undefined, 3].map((x = 'yes') =&gt; x) // [1, 'yes', 3]
</code></pre>
<h3>å…­ã€åœ†æ‹¬å·çš„é—®é¢˜</h3>
<p>è§£æ„èµ‹å€¼è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯è§£æèµ·æ¥å¹¶ä¸å®¹æ˜“ã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œä¸€ä¸ªå¼å­åˆ°åº•æ˜¯æ¨¡å¼ï¼Œè¿˜æ˜¯è¡¨è¾¾å¼ï¼Œæ²¡æœ‰åŠæ³•ä»ä¸€å¼€å§‹å°±çŸ¥é“ï¼Œå¿…é¡»è§£æåˆ°ï¼ˆæˆ–è§£æä¸åˆ°ï¼‰ç­‰å·æ‰èƒ½çŸ¥é“ã€‚</p>
<p>ç”±æ­¤å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœæ¨¡å¼ä¸­å‡ºç°åœ†æ‹¬å·æ€ä¹ˆå¤„ç†ï¼Ÿ<strong>ES6 çš„è§„åˆ™æ˜¯ï¼Œåªè¦æœ‰å¯èƒ½å¯¼è‡´è§£æ„çš„æ­§ä¹‰ï¼Œå°±ä¸å¾—ä½¿ç”¨åœ†æ‹¬å·ã€‚</strong></p>
<p>ä½†æ˜¯ï¼Œè¿™æ¡è§„åˆ™å®é™…ä¸Šä¸é‚£ä¹ˆå®¹æ˜“è¾¨åˆ«ï¼Œå¤„ç†èµ·æ¥ç›¸å¯¹éº»çƒ¦ã€‚å› æ­¤ï¼Œå»ºè®®åªè¦æœ‰å¯èƒ½ï¼Œå°±ä¸è¦åœ¨æ¨¡å¼ä¸­æ”¾ç½®åœ†æ‹¬å·ã€‚</p>
<p><strong>ä¸èƒ½ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µï¼š</strong></p>
<p>ä»¥ä¸‹ä¸‰ç§è§£æ„èµ‹å€¼ä¸å¾—ä½¿ç”¨åœ†æ‹¬å·ã€‚</p>
<h5>1. å˜é‡å£°æ˜è¯­å¥</h5>
<p>ä¸‹é¢ 6 ä¸ªè¯­å¥éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å˜é‡å£°æ˜è¯­å¥ï¼Œæ¨¡å¼ä¸èƒ½ä½¿ç”¨åœ†æ‹¬å·ã€‚</p>
<pre><code class="language-js">let [(a)] = [1]

let {x: (c)} = {}
let ({x: c}) = {}
let {(x: c)} = {}
let {(x): c} = {}

let { o: ({ p: p }) } = { o: { p: 2 } }
</code></pre>
<h5>2. å‡½æ•°å‚æ•°</h5>
<p>å‡½æ•°å‚æ•°ä¹Ÿå±äºå˜é‡å£°æ˜ï¼Œå› æ­¤ä¸èƒ½å¸¦æœ‰åŸæ‹¬å·ã€‚</p>
<pre><code class="language-js">// æŠ¥é”™ï¼šUnexpected token
function fn([(z)]) { return z }

// æŠ¥é”™ï¼šUnexpected token
function fn([z, (x)]) { return x }
</code></pre>
<h5>3. èµ‹å€¼è¯­å¥çš„æ¨¡å¼</h5>
<pre><code class="language-js">// å…¨éƒ¨æŠ¥é”™ï¼šParenthesized pattern
;({ p: a }) = { p: 42 }
;([a]) = [5]
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹å°†æ•´ä¸ªæ¨¡å¼æ”¾åœ¨åœ†æ‹¬å·ä¹‹ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ã€‚</p>
<pre><code class="language-js">;[({ p: a }), { x: c }] = [{}, {}]
</code></pre>
<p>ä¸Šé¢ä»£ç å°†ä¸€éƒ¨åˆ†æ¨¡å¼æ”¾åœ¨åœ†æ‹¬å·ä¹‹ä¸­ï¼Œå¯¼è‡´æŠ¥é”™ã€‚</p>
<p><strong>å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µï¼š</strong></p>
<p>å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·çš„æƒ…å†µåªæœ‰ä¸€ç§ï¼šèµ‹å€¼è¯­å¥çš„éæ¨¡å¼éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨åœ†æ‹¬å·ã€‚</p>
<pre><code class="language-js">;[(b)] = [3] // æ­£ç¡®
;({ p: (d) } = {}) // æ­£ç¡®
;[(parseInt.prop)] = [3] // æ­£ç¡®
</code></pre>
<p>ä»¥ä¸Šä¸‰è¡Œè¯­å¥éƒ½å¯ä»¥æ­£ç¡®æ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯èµ‹å€¼è¯­å¥ï¼Œè€Œä¸æ˜¯å£°æ˜è¯­å¥ï¼›å…¶æ¬¡ï¼Œå®ƒä»¬çš„åœ†æ‹¬å·éƒ½ä¸å±äºæ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚ç¬¬ä¸€è¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯å–æ•°ç»„çš„ç¬¬ä¸€æˆå‘˜ï¼Œè·Ÿåœ†æ‹¬å·æ— å…³ï¼›ç¬¬äºŒè¡Œè¯­å¥ä¸­ï¼Œæ¨¡å¼æ˜¯ <code>p</code>ï¼Œè€Œä¸æ˜¯ <code>d</code>ï¼›ç¬¬ä¸‰è¡Œè¯­å¥ä¸ç¬¬ä¸€è¡Œè¯­å¥çš„æ€§è´¨ä¸€è‡´ã€‚ï¼ˆå¦‚æœåˆ°è¿™é‡Œå¯¹æ¨¡å¼æ²¡å®Œå…¨å¼„æ¸…æ¥šçš„ï¼Œå»ºè®®å¾€å›å†ç»†çœ‹ä¸€ä¸‹ï¼‰</p>
<h3>ä¸ƒã€ç”¨é€”</h3>
<p>å˜é‡çš„è§£æ„èµ‹å€¼ç”¨é€”å¾ˆå¤šã€‚</p>
<h5>1. äº¤æ¢å˜é‡çš„å€¼</h5>
<p>ä¸‹é¢ç¤ºä¾‹äº¤æ¢å˜é‡ <code>x</code> å’Œ <code>y</code> çš„å€¼ï¼Œè¿™æ ·çš„å†™æ³•ä¸ä»…ç®€æ´ï¼Œè€Œä¸”æ˜“è¯»ï¼Œè¯­ä¹‰éå¸¸æ¸…æ™°ã€‚</p>
<pre><code class="language-js">let x = 1
let y = 1

;[x, y] = [y, x]
</code></pre>
<h5>2. ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼</h5>
<p>å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦è¿”å›å¤šä¸ªå€¼ï¼Œåªèƒ½å°†å®ƒä»¬æ”¾åœ¨æ•°ç»„æˆ–è€…å¯¹è±¡é‡Œè¿”å›ã€‚æœ‰äº†ç»“æ„èµ‹å€¼ï¼Œå–å‡ºè¿™äº›å€¼å°±éå¸¸æ–¹ä¾¿ã€‚</p>
<pre><code class="language-js">// è¿”å›ä¸€ä¸ªæ•°ç»„
function fn1() {
  return [1, 2, 3]
}
let [a, b, c] = fn1()

// è¿”å›ä¸€ä¸ªå¯¹è±¡
function fn2() {
  return { foo: 1, bar: 2 }
}
let { foo, bar } = fn2()
</code></pre>
<h5>3. å‡½æ•°å‚æ•°çš„å®šä¹‰</h5>
<p>è§£æ„èµ‹å€¼å¯ä»¥æ–¹ä¾¿åœ°å°†ä¸€ç»„å‚æ•°ä¸å˜é‡åå¯¹åº”èµ·æ¥ã€‚</p>
<pre><code class="language-js">// å‚æ•°æ˜¯ä¸€ç»„æœ‰æ¬¡åºçš„å€¼
function fn1([x, y, z]) { ... }
fn1([1, 2, 3])

// å‚æ•°æ˜¯ä¸€ç»„æ— æ¬¡åºçš„å€¼
function fn2({x, y, z}) { ... }
fn2({z: 3, y: 2, x: 1})
</code></pre>
<h5>4. æå– JSON  æ•°æ®</h5>
<p>è§£æ„èµ‹å€¼å¯¹æå– JSON å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œå°¤å…¶æœ‰ç”¨ã€‚</p>
<pre><code class="language-js">let jsonData = {
  id: 42,
  status: &quot;OK&quot;,
  data: [867, 5309]
}

let { id, status, data: number } = jsonData

console.log(id, status, number) // 42, &quot;OK&quot;, [867, 5309]
</code></pre>
<h5>5. å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼</h5>
<p>æŒ‡å®šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå°±é¿å…äº†åœ¨å‡½æ•°ä½“å†…éƒ¨å†å†™ <code>var foo = config.foo || 'default foo';</code> è¿™æ ·çš„è¯­å¥ã€‚</p>
<pre><code class="language-js">jQuery.ajax = function(url, {
  async = true,
  beforeSend = function() {},
  cache = true,
  complete = function() {},
  crossDomain = false,
  global = true,
  // ... more config
} = {}) {
  // ... do stuff
}
</code></pre>
<h5>6. éå† Map ç»“æ„</h5>
<p>ä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨ for...of å¾ªç¯éå†ã€‚Map è§£æ„åŸç”Ÿæ”¯æŒ Iterator æ¥å£ï¼Œé…åˆå˜é‡çš„è§£æ„èµ‹å€¼ï¼Œè·å–é”®åå’Œé”®å€¼å°±éå¸¸æ–¹ä¾¿ã€‚</p>
<pre><code class="language-js">const map = new Map()
map.set('first', 'hello')
map.set('second', 'world')

for (let [key, value] of map) {
  console.log(key + ' is ' + value)
}
// first is hello
// second is world
</code></pre>
<p>å¦‚æœåªæ˜¯æƒ³è·å–é”®åï¼ˆæˆ–è€…é”®å€¼ï¼‰ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚</p>
<pre><code class="language-js">// è·å–é”®å
for (let [key] of map) {
  // ...
}

// è·å–é”®å€¼
for (let [,value] of map) {
  // ...
}
</code></pre>
<h5>7. è¾“å…¥æ¨¡å—çš„æŒ‡å®šæ–¹æ³•</h5>
<p>åŠ è½½æ¨¡å—æ—¶ï¼Œå¾€å¾€éœ€è¦æŒ‡å®šå“ªäº›æ–¹æ³•ã€‚è§£æ„èµ‹å€¼ä½¿å¾—è¾“å…¥è¯­å¥éå¸¸æ¸…æ™°ã€‚</p>
<pre><code class="language-js">const { SourceMapConsumer, SourceNode } = require(&quot;source-map&quot;)
</code></pre>
<h3>å…«ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://es6.ruanyifeng.com/">é˜®ä¸€å³° ES6 å…¥é—¨æ•™ç¨‹</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript çš„è¿·æƒ‘è¡Œä¸ºå¤§èµ]]></title>
            <link>https://github.com/toFrankie/blog/issues/234</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/234</guid>
            <pubDate>Sun, 26 Feb 2023 11:00:53 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©æ¥èŠä¸€èŠ JavaScript ä¸­è®©äººæ‘¸ä¸ç€å¤´çš„è®¾è®¡å¤±è¯¯ã€‚</p>
<p>Brendan Eich åœ¨ 1995 å¹´åŠ å…¥ Netscape å…¬å¸ï¼Œå½“æ—¶ Netscape å’Œ Sun åˆä½œå¼€å‘ä¸€ä¸ªå¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šçš„ç¼–ç¨‹è¯­è¨€ï¼Œå½“æ—¶ JavaScript çš„å¼€å‘ä»£å·æ˜¯ Mochaã€‚Brendan Eich èŠ±äº† 1]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©æ¥èŠä¸€èŠ JavaScript ä¸­è®©äººæ‘¸ä¸ç€å¤´çš„è®¾è®¡å¤±è¯¯ã€‚</p>
<p>Brendan Eich åœ¨ 1995 å¹´åŠ å…¥ Netscape å…¬å¸ï¼Œå½“æ—¶ Netscape å’Œ Sun åˆä½œå¼€å‘ä¸€ä¸ªå¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šçš„ç¼–ç¨‹è¯­è¨€ï¼Œå½“æ—¶ JavaScript çš„å¼€å‘ä»£å·æ˜¯ Mochaã€‚Brendan Eich èŠ±äº† 10 å¤©å®Œæˆäº†ç¬¬ä¸€ç‰ˆçš„ JavaScriptã€‚</p>
<p>ç”±äºè®¾è®¡æ—¶é—´å¤ªçŸ­ï¼Œè¯­è¨€çš„ä¸€äº›ç»†èŠ‚è€ƒè™‘å¾—ä¸å¤Ÿä¸¥è°¨ï¼Œä¸€äº›å› ä¸å¯æŠ—å› ç´ è€Œæ— æ³•ä¿®å¤çš„ bugï¼ŒåŠ ä¹‹åæ¥å¡«å‘è¿‡ç¨‹ä¸­æ–°æŒ–çš„å‘ï¼Œæ€»ä¹‹å¼€å‘è€…è¡¨ç¤ºå¾ˆçƒ¦...</p>
<p>ä¸€èµ·çœ‹ä¸‹ JavaScript è®¾è®¡çš„ã€Œå‘ã€æœ‰å“ªäº›ï¼Ÿ</p>
<h2>ä¸€ã€typeof null === 'object'</h2>
<p>è¿™æ˜¯ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„å¤±è¯¯ã€‚</p>
<p>å¯¹äºåˆšæ¥è§¦ JavaScript çš„æœ‹å‹ï¼Œæœ‰å¯èƒ½ä¼šç›´è§‰æ€§åœ°ã€é”™è¯¯åœ°è®¤ä¸º <code>typeof null === 'null'</code>ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<blockquote>
<p><code>typeof null === 'object'</code> çš„ â€œbugâ€ å…¶å®æ˜¯ç¬¬ä¸€ç‰ˆ JavaScript å°±å­˜åœ¨äº†ï¼Œéšç€ JavaScript çš„æµè¡Œï¼Œå¾ˆå¤šäººæè®®ä¿®å¤è¿™ä¸ª bugï¼Œä½†è¢«æ‹’ç»äº†ï¼Œå› ä¸ºä¿®æ”¹å®ƒæ„å‘³ç€ä¼šç ´åç°æœ‰çš„ä»£ç ã€‚å†å²åŸå› å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://2ality.com/2013/10/typeof-null.html">The history of â€œtypeof nullâ€</a>ã€‚</p>
</blockquote>
<p>åœ¨ JavaScript ä¸­ï¼Œæ•°æ®ç±»å‹åœ¨åº•å±‚éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºçš„ã€‚åœ¨åˆç‰ˆ JavaScript ä¸­ï¼Œä»¥ 32 ä½ä¸ºå•ä½å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªç±»å‹æ ‡è®°ï¼ˆ1-3 ä½ï¼‰å’Œè¯¥å€¼çš„å®é™…æ•°æ®ã€‚ç±»å‹æ ‡è®°å­˜å‚¨åœ¨å•å…ƒçš„ä½ä½ã€‚å…¶ä¸­æœ‰äº”ä¸ªï¼š</p>
<ul>
<li><code>000</code>ï¼šobjectï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li><code>1</code>ï¼šintï¼Œæ•°æ®æ˜¯ä¸€ä¸ª 31 ä½æœ‰ç¬¦å·æ•´æ•°ã€‚</li>
<li><code>010</code>ï¼šdoubleï¼Œæ•°æ®æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</li>
<li><code>100</code>ï¼šstringï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</li>
<li><code>110</code>ï¼šbooleanï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ä½ä½å¦‚æœæ˜¯ 1ï¼Œé‚£ä¹ˆç±»å‹æ ‡è®°é•¿åº¦åªæœ‰ 1 ä½ï¼›å¦‚æœæœ€ä½ä½æ˜¯ 0ï¼Œé‚£ä¹ˆç±»å‹æ ‡è®°é•¿åº¦ä¸º 3 ä½ï¼Œä¸ºå››ç§ç±»å‹æä¾›ä¸¤ä¸ªé™„åŠ ä½ã€‚</p>
<p>æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å€¼ï¼š</p>
<ul>
<li><code>undefined</code>ï¼ˆJSVAL_VOIDï¼‰æ˜¯æ•´æ•° âˆ’2^30^ï¼ˆæ•´æ•°èŒƒå›´ä¹‹å¤–çš„æ•°å­—ï¼‰</li>
<li><code>null</code>ï¼ˆJSVAL_NULLï¼‰æ˜¯æœºå™¨ç ç©ºæŒ‡é’ˆã€‚æˆ–ï¼šä¸€ä¸ªå¯¹è±¡ç±»å‹æ ‡è®°åŠ ä¸Šä¸€ä¸ªé›¶çš„å¼•ç”¨ã€‚(<code>null</code> äºŒè¿›åˆ¶è¡¨ç¤ºå…¨æ˜¯ 0)</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“ä¸ºä»€ä¹ˆ <code>typeof</code> ä¼šè®¤ä¸º <code>null</code> æ˜¯ä¸€ä¸ªå¯¹è±¡äº†ï¼Œå®ƒæ£€æŸ¥äº† <code>null</code> çš„ç±»å‹æ ‡è®°ï¼Œä¸”ç±»å‹æ ‡è®°è¡¨ç¤º <code>object</code>ã€‚ä»¥ä¸‹æ˜¯è¯¥å¼•æ“çš„ <code>typeof</code> ä»£ç ã€‚</p>
<pre><code class="language-c">JS_PUBLIC_API(JSType)
JS_TypeOfValue(JSContext *cx, jsval v)
{
  JSType type = JSTYPE_VOID;
  JSObject *obj;
  JSObjectOps *ops;
  JSClass *clasp;

  CHECK_REQUEST(cx);
  if (JSVAL_IS_VOID(v)) { // (1)
    type = JSTYPE_VOID;
  } else if (JSVAL_IS_OBJECT(v)) { // (2)
    obj = JSVAL_TO_OBJECT(v);
    if (obj &amp;&amp;
      (ops = obj -&gt; map -&gt; ops,
        ops == &amp; js_ObjectOps
          ? (clasp = OBJ_GET_CLASS(cx, obj),
            clasp -&gt; call || clasp == &amp; js_FunctionClass) // (3,4)
          : ops -&gt; call != 0)) { // (3)
      type = JSTYPE_FUNCTION;
    } else {
      type = JSTYPE_OBJECT;
    }
  } else if (JSVAL_IS_NUMBER(v)) {
    type = JSTYPE_NUMBER;
  } else if (JSVAL_IS_STRING(v)) {
    type = JSTYPE_STRING;
  } else if (JSVAL_IS_BOOLEAN(v)) {
    type = JSTYPE_BOOLEAN;
  }
  return type;
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æ‰§è¡Œçš„æ­¥éª¤æ˜¯ï¼š</p>
<ul>
<li>åœ¨ï¼ˆ1ï¼‰é¦–å…ˆæ£€æŸ¥å€¼ <code>v</code> æ˜¯å¦ <code>undefined</code>ï¼ˆVOIDï¼‰ã€‚é€šè¿‡ <code>==</code> æ¯”è¾ƒå€¼æ˜¯å¦ç›¸åŒï¼š</li>
</ul>
<pre><code class="language-c">#define JSVAL_IS_VOID(v)  ((v) == JSVAL_VOID)
</code></pre>
<ul>
<li>ä¸‹ä¸€ä¸ªæ£€æŸ¥ï¼ˆ2ï¼‰æ˜¯è¯¥å€¼æ˜¯å¦å…·æœ‰å¯¹è±¡æ ‡è®°ã€‚å¦‚æœå®ƒå¦å¤–å¯ä»¥è°ƒç”¨ï¼ˆ3ï¼‰æˆ–å®ƒçš„å†…éƒ¨å±æ€§ <code>[[Class]]</code> å°†å…¶æ ‡è®°ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆ4ï¼‰ï¼Œåˆ™ <code>v</code> æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å¦åˆ™ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ˜¯ç”± <code>typeof null</code> äº§ç”Ÿçš„ç»“æœã€‚</li>
<li>éšåçš„æ£€æŸ¥æ˜¯æ•°å­—ï¼Œå­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ã€‚ç”šè‡³æ²¡æœ‰æ˜¾å¼çš„ <code>null</code> æ£€æŸ¥ï¼Œå¯ä»¥ç”±ä»¥ä¸‹ C å®æ‰§è¡Œã€‚</li>
</ul>
<pre><code class="language-c">#define JSVAL_IS_NULL(v)  ((v) == JSVAL_NULL)
</code></pre>
<p>è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„é”™è¯¯ï¼Œä½†è¯·ä¸è¦å¿˜è®°ï¼Œåªæœ‰å¾ˆå°‘çš„æ—¶é—´æ¥å®Œæˆ JavaScript çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>Brendan Eich åœ¨ Twitter è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <a href="https://twitter.com/BrendanEich/status/617450289889607681">abstraction leak</a>ï¼Œå¯ç†è§£ä¸ºå˜ç›¸æ‰¿è®¤è¿™æ˜¯ä»£ç çš„ bugã€‚</p>
<p>null means &quot;no object&quot;, undefined =&gt;&quot;no value&quot;. Really it's an abstraction leak: null and objects shared a Mocha type tag.</p>
</blockquote>
<p>ä¸‹é¢åˆ—å‡ºå„ç§æ•°æ®ç±»å‹ <code>typeof</code> å¯¹åº”çš„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Operand</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">undefinded</td>
<td style="text-align:center">&quot;undefined&quot;</td>
</tr>
<tr>
<td style="text-align:center">null</td>
<td style="text-align:center">&quot;object&quot;</td>
</tr>
<tr>
<td style="text-align:center">Boolean value</td>
<td style="text-align:center">&quot;boolean&quot;</td>
</tr>
<tr>
<td style="text-align:center">Number value</td>
<td style="text-align:center">&quot;number&quot;</td>
</tr>
<tr>
<td style="text-align:center">BigInt value (ES11)</td>
<td style="text-align:center">&quot;bigint&quot;</td>
</tr>
<tr>
<td style="text-align:center">String value</td>
<td style="text-align:center">&quot;string&quot;</td>
</tr>
<tr>
<td style="text-align:center">Symbol value (ES6)</td>
<td style="text-align:center">&quot;symbol&quot;</td>
</tr>
<tr>
<td style="text-align:center">å®¿ä¸»å¯¹è±¡ï¼ˆç”± JS ç¯å¢ƒæä¾›ï¼‰</td>
<td style="text-align:center">å–å†³äºå…·ä½“å®ç°</td>
</tr>
<tr>
<td style="text-align:center">Function</td>
<td style="text-align:center">&quot;function&quot;</td>
</tr>
<tr>
<td style="text-align:center">All other values</td>
<td style="text-align:center">&quot;object&quot;</td>
</tr>
</tbody>
</table>
<blockquote>
<p>typeof returning &quot;object&quot; for null is a bug. It canâ€™t be fixed, because that would break existing code. Note that a function is also an object, but typeof makes a distinction. Arrays, on the other hand, are considered objects by it.</p>
</blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/143590829">æŸæ–‡ç« </a>è¡¨ç¤ºï¼š</p>
<p>åœ¨ JavaScript V8 å¼•æ“ä¸­ï¼Œé’ˆå¯¹ <code>typeof null === 'object'</code> è¿™ç§â€œä¸è§„èŒƒâ€æƒ…å†µï¼Œå¯¹ <code>null</code> æå‰åšäº†ä¸€å±‚åˆ¤æ–­ã€‚å‡è®¾åœ¨ V8 ä¸­æŠŠè¿™è¡Œä»£ç åˆ æ‰ï¼Œ <code>typeof null</code> ä¼šè¿”å› <code>undefined</code>ã€‚</p>
<pre><code>GotoIf(InstanceTypeEqual(instance_type, ODDBALL_TYPE), &amp;if_oddball);
</code></pre>
<p>å¥½äº†ï¼Œå…³äº <code>typeof null === 'object'</code> çš„è¯é¢˜å‘Šä¸€æ®µè½ã€‚</p>
<h2>äºŒã€typeof NaN === 'number'</h2>
<p>ä¸ç¡®å®šè¿™ä¸ªç®—ä¸ç®—ä¸€ä¸ªè®¾è®¡å¤±è¯¯ï¼Œä½†æ¯«æ— ç–‘é—®è¿™æ˜¯åç›´è§‰çš„ã€‚</p>
<blockquote>
<p>å…³äº NaNï¼Œè¿˜æœ‰ä¸€äº›å¾ˆæœ‰è¶£çš„çŸ¥è¯†ç‚¹ï¼Œæ¨èä¸€ä¸ª Slideï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ï¼š<a href="https://speakerdeck.com/lewisjellis/idiosyncrasies-of-nan-v2">Idiosyncrasies of NaN v2</a>ã€‚</p>
</blockquote>
<h2>ä¸‰ã€NaNã€isNaN()ã€Number.isNaN()</h2>
<p>åœ¨ JavaScript ä¸­ï¼ŒNaN æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆè«åå…¶å¦™çš„å­˜åœ¨ã€‚å½“ç„¶ NaN ä¸æ˜¯åªæœ‰ JavaScript æ‰å­˜åœ¨çš„ã€‚å…¶ä»–è¯­è¨€ä¹Ÿæ˜¯æœ‰çš„ã€‚</p>
<blockquote>
<p>æˆ‘è§‰å¾—åº”è¯¥æ˜¯è¿™æ ·ï¼š&quot;NaN&quot; actually stands for &quot;Not a NaN&quot;.</p>
</blockquote>
<h3>1. NaN</h3>
<p><code>NaN</code> æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡å±æ€§ï¼Œå…¶å±æ€§çš„åˆå§‹å€¼å°±æ˜¯ <code>NaN</code>ï¼Œå’ŒÂ <code>Number.NaN</code>çš„å€¼ä¸€æ ·ã€‚</p>
<p><strong><code>NaN</code> æ˜¯ JavaScript ä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼</strong>ã€‚è™½ç„¶è¿™ä¸ªè®¾è®¡å…¶å®ç†ç”±å¾ˆå……åˆ†ï¼ˆå‚ç…§å‰é¢æ¨èçš„é‚£ä¸ª Slideï¼Œåœ¨ IEEE 754 è§„èŒƒä¸­æœ‰éå¸¸å¤šçš„äºŒè¿›åˆ¶åºåˆ—éƒ½å¯ä»¥è¢«å½“åš <code>NaN</code>ï¼Œæ‰€ä»¥ä»»æ„è®¡ç®—å‡ºä¸¤ä¸ª <code>NaN</code>ï¼Œå®ƒä»¬åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸Šå¾ˆå¯èƒ½ä¸åŒï¼‰ï¼Œä½†ä¸ç®¡æ€æ ·ï¼Œè¿™ä¸ªè¿˜æ˜¯éå¸¸å€¼å¾—åæ§½...</p>
<pre><code class="language-js">NaN == NaN // false
NaN === NaN // false
Number.NaN === NaN // false
</code></pre>
<h3>2. isNaN()</h3>
<p><code>isNaN()</code> æ˜¯å…¨å±€å¯¹è±¡æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„å‘½åå’Œè¡Œä¸ºéå¸¸è®©äººè´¹è§£ï¼š</p>
<ul>
<li>å®ƒå¹¶ä¸åªæ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸º <code>NaN</code>ï¼Œå› ä¸ºæ‰€æœ‰å¯¹äºæ‰€æœ‰éæ•°å­—ç±»å‹çš„å€¼å®ƒä¹Ÿè¿”å› <code>true</code>ï¼›</li>
<li>ä½†ä¹Ÿä¸èƒ½è¯´å®ƒæ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºæ•°å€¼çš„ï¼Œå› ä¸ºæ ¹æ®å‰æ–‡ï¼Œ<code>NaN</code> çš„ç±»å‹æ˜¯ <code>number</code>ï¼Œåº”å½“è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ•°å€¼ã€‚</li>
</ul>
<p><code>isNaN()</code> æ–¹æ³•ï¼Œå½“å‚æ•°å€¼æ˜¯ <code>NaN</code> æˆ–è€…å°†å‚æ•°è½¬æ¢ä¸ºæ•°å­—çš„ç»“æœä¸º <code>NaN</code>ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚å› æ­¤ï¼Œå®ƒä¸èƒ½ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸¥æ ¼ç­‰äº <code>NaN</code>ã€‚</p>
<pre><code class="language-js">isNaN(NaN) // true
isNaN('hello world') // true
</code></pre>
<h3>3. Number.isNaN()</h3>
<p>ES6 æä¾›äº† <code>Number.isNaN()</code> æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç­‰äº <code>NaN</code>ï¼Œç»ˆäºæ˜¯æ‹¨ä¹±åæ­£äº†ã€‚</p>
<p>å’Œå…¨å±€å‡½æ•° <code>isNaN()</code> ç›¸æ¯”ï¼Œ<code>Number.isNaN()</code> ä¸ä¼šè‡ªè¡Œå°†å‚æ•°è½¬æ¢æˆæ•°ç»„ï¼Œå®ƒä¼šå…ˆåˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºæ•°å­—ç±»å‹ï¼Œå¦‚ä¸æ˜¯æ•°å­—ç±»å‹åˆ™ç›´æ¥è¿”å› <code>false</code>ï¼Œæ¥ç€åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ä¸º <code>NaN</code>ï¼Œè‹¥æ˜¯åˆ™è¿”å› <code>true</code>ã€‚</p>
<pre><code class="language-js">Number.isNaN(NaN) // true
Number.isNaN(Number.NaN) // true
Number.isNaN(0 / 0) // true
Number.isNaN('hello world') // false
Number.isNaN(undefined) // false
</code></pre>
<h3>4. æ€»ç»“å‡ ç§åˆ¤æ–­å€¼æ˜¯å¦ä¸º NaN çš„æ–¹æ³•</h3>
<pre><code class="language-js">// 1. åˆ©ç”¨ NaN çš„ç‰¹æ€§ï¼ŒJavaScript ä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼
function myIsNaN(v) {
  return v !== v
}

// 2. åˆ©ç”¨ ES5 çš„ isNaN() å…¨å±€æ–¹æ³•
function myIsNaN(v) {
  return typeof v === 'number' &amp;&amp; isNaN(v)
}

// 3. åˆ©ç”¨ ES6 çš„ Number.isNaN() æ–¹æ³•
function myIsNaN(v) {
  return Number.isNaN(v)
}

// 4. åˆ©ç”¨ ES6 çš„ Object.is() æ–¹æ³•
function myIsNaN(v) {
  return Object.is(v, NaN)
}
</code></pre>
<h2>å››ã€==ã€=== ä¸ <a href="http://Object.is">Object.is</a>()</h2>
<p>JavaScript æ˜¯ä¸€ç§å¼±ç±»å‹è¯­è¨€ï¼Œå­˜åœ¨éšå¼ç±»å‹è½¬æ¢ã€‚å› æ­¤ï¼Œ<code>==</code> çš„è¡Œä¸ºéå¸¸ä»¤äººè´¹è§£ã€‚</p>
<pre><code class="language-js">[] == ![] // true
2 == '2' // true
</code></pre>
<p>æ‰€ä»¥ï¼Œå„ç§ JavaScript ä¹¦ç±éƒ½æ¨èä½¿ç”¨ <code>===</code> æ›¿ä»£ <code>==</code>ï¼ˆä»…åœ¨ null checking ä¹‹ç±»çš„æƒ…å†µé™¤å¤–ï¼‰ã€‚</p>
<p>ä½†äº‹å®ä¸Šï¼Œ <code>===</code> ä¹Ÿå¹¶ä¸æ€»æ˜¯é è°±ï¼Œå®ƒè‡³å°‘å­˜åœ¨ä¸¤ç±»ä¾‹å¤–æƒ…å†µã€‚ï¼ˆ<a href="https://2ality.com/2012/03/stricter-equality.html">Stricter equality in JavaScript</a>ï¼‰</p>
<pre><code class="language-js">// 1. å‰æ–‡æåˆ°çš„ NaN
NaN === NaN // false

// 2. +0 ä¸ -0 ä¸¤è€…å…¶å®æ˜¯ä¸ç›¸ç­‰çš„å€¼ ğŸ‘‡
+0 === -0 // true
// å› ä¸º
1 / +0 === Infinity // true
1 / -0 === -Infinity // true
Infinity === -Infinity // false


// ES6 æ˜¯æä¾›çš„æ–¹æ³•
Object.is(NaN, NaN) // true
Object.is(+0, -0) // false
</code></pre>
<p>ç›´åˆ° ES6 æ‰æœ‰ä¸€ä¸ªå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰çš„æ–¹æ³•ï¼š<code>Object.is()</code>ï¼Œå®ƒå¯¹äº <code>===</code> çš„è¿™ä¸¤è€…ä¾‹å¤–éƒ½åšäº†æ­£ç¡®çš„å¤„ç†ã€‚</p>
<p>å¦‚æœ ES6 ä»¥ä¸‹ï¼Œè¿™æ ·å®ç° <code>Object.is()</code>ï¼š</p>
<pre><code class="language-js">function myObjectIs (x, y) {
  if (x === y) {
    // x === 0 =&gt; compare via infinity trick
    return x !== 0 || (1 / x === 1 / y)
  }

  // x !== y =&gt; return true only if both x and y are NaN
  return x !== x &amp;&amp; y !== y
}
</code></pre>
<blockquote>
<p>å…³äº <code>==</code> å’Œ <code>===</code> éƒ¨åˆ†å€¼çš„æ¯”è¾ƒï¼Œå¯ä»¥çœ‹ä¸‹ <a href="https://dorey.github.io/JavaScript-Equality-Table/">JavaScript-Equality-Table</a>ã€‚</p>
<p>Always use 3 equals unless you have a good reason to use 2.ï¼ˆé™¤éæ‚¨æœ‰å……åˆ†çš„ç†ç”± <code>==</code>ï¼Œå¦åˆ™å§‹ç»ˆä½¿ç”¨ <code>===</code>ï¼‰</p>
</blockquote>
<h2>äº”ã€åˆ†å·è‡ªåŠ¨æ’å…¥æœºåˆ¶ï¼ˆASIï¼‰</h2>
<blockquote>
<p>æ­¤å‰è¿˜ä¸“é—¨é’ˆå¯¹ ASI å†…å®¹å†™äº†ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/05cd9981dc56">JavaScript ASI æœºåˆ¶è¯¦è§£ï¼Œä¸ç”¨å†çº ç»“åˆ†å·é—®é¢˜</a>ã€‚</p>
</blockquote>
<h3>1. Restricted Productions</h3>
<p>æ® Brendan Eich ç§°ï¼ŒJavaScript æœ€åˆè¢«è®¾è®¡å‡ºæ¥æ—¶ï¼Œ<a href="https://brendaneich.com/2008/04/popularity/">ä¸Šçº§è¦æ±‚è¿™ä¸ªè¯­è¨€çš„è¯­æ³•å¿…é¡»åƒ Java</a>ã€‚æ‰€ä»¥è·Ÿ Java ä¸€æ ·ï¼ŒJavaScript çš„è¯­å¥åœ¨è§£ææ—¶ï¼Œæ˜¯<strong>éœ€è¦åˆ†å·</strong>åˆ†éš”çš„ã€‚ä½†æ˜¯åæ¥å‡ºäºé™ä½å­¦ä¹ æˆæœ¬ï¼Œæˆ–è€…æé«˜è¯­è¨€çš„å®¹é”™æ€§çš„è€ƒè™‘ï¼Œä»–åœ¨è¯­æ³•è§£æä¸­åŠ å…¥äº†åˆ†å·è‡ªåŠ¨æ’å…¥çš„çº æ­£æœºåˆ¶ã€‚</p>
<p>è¿™ä¸ªåšæ³•çš„æœ¬æ„å½“ç„¶æ˜¯å¥½çš„ï¼Œæœ‰ä¸å°‘å…¶ä»–è¯­è¨€ä¹Ÿæ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼ˆæ¯”å¦‚ Swiftï¼‰ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºï¼ŒJavaScript çš„è¯­æ³•è®¾è®¡å¾—ä¸å¤Ÿå®‰å…¨ï¼Œå¯¼è‡´ ASI æœ‰ä¸å°‘ç‰¹æ®Šæƒ…å†µæ— æ³•å¤„ç†åˆ°ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šé”™è¯¯åœ°åŠ ä¸Šåˆ†å·ï¼ˆåœ¨æ ‡å‡†æ–‡æ¡£é‡Œè¿™äº›è¢«ç§°ä¸ºÂ <a href="https://tc39.github.io/ecma262/#sec-rules-of-automatic-semicolon-insertion">Restricted Productions</a>ï¼‰ã€‚</p>
<p>æœ€å…¸å‹çš„æ˜¯ <code>return</code> è¯­å¥ï¼š</p>
<pre><code class="language-js">// returns undefined
return
{
  name: 'Frankie'
}

// returns { name: 'Frankie' }
return {
  name: 'Frankie'
}
</code></pre>
<p>è¿™å¯¼è‡´äº† JavaScript ç¤¾åŒºå†™ä»£ç æ—¶èŠ±æ‹¬å·éƒ½ä¸æ¢è¡Œï¼Œè¿™åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ç¤¾åŒºæ˜¯æ— æ³•æƒ³è±¡çš„ã€‚</p>
<h3>2. æ¼åŠ åˆ†å·çš„é—®é¢˜</h3>
<p>æœ‰å¥½å‡ ç§æƒ…å†µè¦æ³¨æ„ï¼ˆæ›´å¤š ASI è¯¦æƒ…çœ‹ä¸Šé¢æ¨èçš„æ–‡ç« ï¼‰ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">// å‡è®¾æºç æ˜¯è¿™æ ·çš„
var a = function (x) { console.log(x) }
(function () {
  console.log('do something')
})()

// åœ¨ JS è§£æå™¨çš„çœ¼é‡Œå´æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥è¿™æ®µä»£ç ä¼šæŠ¥é”™
var a = function (x) { console.log(x) }(function () {
  console.log('do something')
})()
</code></pre>
<h3>3. semicolon-less</h3>
<p>ç”±äºä»¥ä¸Šè¿™äº›å·²ç»æ˜¯è¯­è¨€ç‰¹æ€§äº†ï¼Œå¹¶ä¸”æ— æ³•ç»•å¼€ï¼Œæ— è®ºæ€æ ·æˆ‘ä»¬éƒ½éœ€è¦å»å­¦ä¹ æŒæ¡ã€‚</p>
<blockquote>
<p>å¯¹äºä½¿ç”¨ semicolon-less é£æ ¼çš„æœ‹å‹ï¼Œæ³¨æ„ä¸€ä¸‹ 5 ç§æƒ…å†µå°±å¯ä»¥äº†ï¼š</p>
<p>å¦‚æœä¸€æ¡è¯­å¥æ˜¯ä»¥ <code>(</code>ã€<code>[</code>ã€<code>/</code>ã€<code>+</code>ã€<code>-</code> å¼€å¤´ï¼Œé‚£ä¹ˆå°±è¦æ³¨æ„äº†ã€‚æ ¹æ® JavaScript è§£æå™¨çš„è§„åˆ™ï¼Œå°½å¯èƒ½è¯»å–æ›´å¤š <code>token</code> æ¥æ„æˆä¸€ä¸ªå®Œæ•´çš„è¯­å¥ï¼Œè€Œä»¥ä¸Šè¿™äº› <code>token</code> ææœ‰å¯èƒ½ä¸å‰ä¸€ä¸ª <code>token</code> å¯ç»„æˆä¸€ä¸ªåˆæ³•çš„è¯­å¥ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè‡ªåŠ¨æ’å…¥åˆ†å·ã€‚</p>
<p>å®é™…é¡¹ç›®ä¸­ï¼Œä»¥ <code>/</code>ã€<code>+</code>ã€<code>- </code>ä½œä¸ºè¡Œé¦–çš„ä»£ç å…¶å®æ˜¯å¾ˆå°‘çš„ï¼Œ<code>(</code>ã€<code>[</code> ä¹Ÿæ˜¯è¾ƒå°‘çš„ã€‚**å½“é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œé€šè¿‡åœ¨è¡Œé¦–æ‰‹åŠ¨é”®å…¥åˆ†å· <code>;</code> æ¥é¿å… ASI è§„åˆ™äº§ç”Ÿçš„éé¢„æœŸç»“æœæˆ–æŠ¥é”™ã€‚**è¿™æ ·çš„è®°å¿†æˆæœ¬å’Œå‡ºé”™æ¦‚ç‡è¿œä½äºå¼ºåˆ¶åˆ†å·é£æ ¼ã€‚</p>
<p>è¿˜æœ‰ï¼ŒESLint ä¸­æœ‰ä¸€æ¡è§„åˆ™ <code>no-unexpected-multiline</code> å“¦ï¼Œè¿™æ ·å°±å‡ ä¹æ²¡æœ‰ä»€ä¹ˆè´Ÿæ‹…äº†ã€‚</p>
</blockquote>
<h2>å…­ã€Falsy values</h2>
<p>åœ¨ JavaScript ä¸­è‡³å°‘æœ‰ä¸ƒç§å‡å€¼ï¼ˆåœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä¸ <code>false</code> ç­‰ä»·ï¼‰ï¼š<code>0</code>ã€<code>0n</code>ã€<code>null</code>ã€<code>undefined</code>ã€<code>false</code>ã€<code>''</code> ä»¥åŠ <code>NaN</code>ã€‚ï¼ˆå…¶ä¸­ <code>0n</code> æ˜¯ BigInt ç±»å‹çš„å€¼ï¼‰</p>
<blockquote>
<p>ä»¥ä¸Šå…­ç§å‡å€¼å‡å¯é€šè¿‡ Double Not è¿ç®—ç¬¦ï¼ˆ<code>!!</code>ï¼‰æ¥æ˜¾ç¤ºè½¬æ¢æˆ <code>Boolean</code> ç±»å‹çš„ <code>false</code> å€¼ã€‚</p>
</blockquote>
<h2>ä¸ƒã€+ã€- æ“ä½œç¬¦ç›¸å…³çš„éšå¼ç±»å‹è½¬æ¢</h2>
<p>å¤§è‡´å¯ä»¥è¿™æ ·è®°ï¼šä½œä¸ºäºŒå…ƒæ“ä½œç¬¦çš„ <code>+</code> ä¼šå°½å¯èƒ½åœ°æŠŠä¸¤è¾¹çš„å€¼è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œ <code>-</code> å’Œä½œä¸ºä¸€å…ƒæ“ä½œç¬¦çš„ <code>+</code> åˆ™ä¼šå°½å¯èƒ½åœ°æŠŠå€¼è½¬ä¸ºæ•°å­—ã€‚</p>
<pre><code class="language-js">('foo' + + 'bar') === 'fooNaN' // true
'3' + 1 // '31'
'3' - 1 // 2
'222' - - '111' // 333
</code></pre>
<blockquote>
<p>æ³¨æ„: <code>+</code> ä¸¤ä¾§åªè¦æœ‰ä¸€ä¾§æ˜¯å­—ç¬¦ä¸²ï¼Œå¦ä¸€ä¾§çš„æ•°å­—åˆ™ä¼šè‡ªåŠ¨è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå› ä¸ºå…¶ä¸­å­˜åœ¨éšå¼è½¬æ¢ã€‚</p>
</blockquote>
<h2>å…«ã€nullã€undefined ä»¥åŠæ•°ç»„çš„ â€œholesâ€</h2>
<p>åœ¨ä¸€ä¸ªè¯­è¨€ä¸­åŒæ—¶æœ‰Â <code>null</code>Â å’ŒÂ <code>undefined</code>Â ä¸¤ä¸ªè¡¨ç¤ºç©ºå€¼çš„åŸç”Ÿç±»å‹ï¼Œä¹çœ‹èµ·æ¥å¾ˆéš¾ç†è§£ï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸€äº›è®¨è®ºå¯ä»¥ä¸€çœ‹ï¼š</p>
<ul>
<li><a href="https://twitter.com/BrendanEich/status/330775086208524288">Java has null but only for reference types. With untyped JS, the uninitialized value should not be reference-y or convert to 0</a>.</li>
<li><a href="https://github.com/DavidBruant/ECMAScript-regrets/issues/26#issue-13943504">GitHub ä¸Šçš„ä¸€äº›è®¨è®º</a>Â -Â <a href="https://twitter.com/BrendanEich/status/652442934151938048">Null for Objects and undefined for primitives</a></li>
</ul>
<p>ä¸è¿‡æ•°ç»„é‡Œçš„ &quot;holes&quot; å°±éå¸¸éš¾ä»¥ç†è§£äº†ã€‚</p>
<p>äº§ç”Ÿ holes çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸€æ˜¯å®šä¹‰æ•°ç»„å­—é¢é‡æ—¶å†™ä¸¤ä¸ªè¿ç»­çš„é€—å·ï¼š<code>var a = [1, , 2]</code>ï¼›äºŒæ˜¯ä½¿ç”¨Â <code>Array</code>Â å¯¹è±¡çš„æ„é€ å™¨ï¼š<code>new Array(3)</code>ã€‚</p>
<p>æ•°ç»„çš„å„ç§æ–¹æ³•å¯¹äº holes çš„å¤„ç†éå¸¸éå¸¸éå¸¸ä¸ä¸€è‡´ï¼Œæœ‰çš„ä¼šè·³è¿‡ï¼ˆ<code>forEach</code>ï¼‰ï¼Œæœ‰çš„ä¸å¤„ç†ä½†æ˜¯ä¿ç•™ï¼ˆ<code>map</code>ï¼‰ï¼Œæœ‰çš„ä¼šæ¶ˆé™¤æ‰ holesï¼ˆ<code>filter</code>ï¼‰ï¼Œè¿˜æœ‰çš„ä¼šå½“æˆ <code>undefined</code> æ¥å¤„ç†ï¼ˆ<code>join</code>ï¼‰ã€‚è¿™å¯ä»¥è¯´æ˜¯ JavaScript ä¸­æœ€å¤§çš„å‘ä¹‹ä¸€ï¼Œä¸çœ‹æ–‡æ¡£å¾ˆéš¾è‡ªå·±ç†æ¸…æ¥šã€‚</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« ï¼š
*Â <a href="http://www.2ality.com/2013/07/array-iteration-holes.html">Array iteration and holes in JavaScript</a>Â 
*Â <a href="http://www.2ality.com/2015/09/holes-arrays-es6.html">ECMAScript 6: holes in Arrays</a></p>
<h2>ä¹ã€ Array-like objects</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œç±»æ•°ç»„ä½†ä¸æ˜¯æ•°ç»„çš„å¯¹è±¡ä¸å°‘ï¼Œè¿™ç±»å¯¹è±¡å¾€å¾€æœ‰ <code>length</code> å±æ€§ã€å¯ä»¥è¢«éå†ï¼Œä½†ç¼ºä¹ä¸€äº›æ•°ç»„åŸå‹ä¸Šçš„æ–¹æ³•ï¼Œç”¨èµ·æ¥éå¸¸ä¸ä¾¿ã€‚æ¯”å¦‚åœ¨ä¸ºäº†èƒ½è®© <code>arguments</code> å¯¹è±¡ç”¨ä¸Š <code>Array.prototype.shift()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å…ˆå†™è¿™æ ·ä¸€æ¡è¯­å¥ï¼Œéå¸¸ä¸ä¾¿ã€‚</p>
<pre><code class="language-js">var args = Array.prototype.slice.apply(arguments)
</code></pre>
<p>åœ¨ ES6 ä¸­ï¼Œarguments å¯¹è±¡ä¸å†è¢«å»ºè®®ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨  <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Rest_parameters">Rest parameters</a>ï¼ˆ<code>const fn = (...args) =&gt; {}</code>ï¼‰ï¼Œè¿™æ ·æ‹¿åˆ°çš„å¯¹è±¡ï¼ˆ<code>args</code>ï¼‰å°±ç›´æ¥æ˜¯æ•°ç»„äº†ã€‚</p>
<p>ä¸è¿‡åœ¨è¯­è¨€æ ‡å‡†ä¹‹å¤–ï¼ŒDOM æ ‡å‡†ä¸­ä¹Ÿå®šä¹‰äº†ä¸å°‘ Array-like çš„å¯¹è±¡ï¼Œæ¯”å¦‚ NodeList å’Œ HTMLCollectionã€‚å¯¹äºè¿™äº›å¯¹è±¡ï¼Œåœ¨ ES6 ä¸­æˆ‘ä»¬å¯ä»¥ç”¨ spread operator å¤„ç†ï¼š</p>
<pre><code class="language-js">const nodeList = document.querySelectorAll('div')
const nodeArray = [...nodeList]

console.log(Object.prototype.toString.call(nodeList))   // [object NodeList]
console.log(Object.prototype.toString.call(nodeArray))   // [object Array]
</code></pre>
<h3>arguments</h3>
<p>åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ˆsloppy modeï¼‰ä¸‹ï¼Œå¯¹ argument èµ‹å€¼ä¼šæ”¹å˜å¯¹åº”çš„<strong>å½¢å‚</strong>ã€‚</p>
<blockquote>
<p>å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/55e369a811b7">JavaScript ä¸¥æ ¼æ¨¡å¼è¯¦è§£ï¼ˆ8-2 å°èŠ‚ï¼‰</a></p>
</blockquote>
<pre><code class="language-js">function foo(x) {
  console.log(x === 1) // true
  arguments[0] = 2
  console.log(x === 2) // true
}

function bar(x) {
  'use strict'
  console.log(x === 1) // true
  arguments[0] = 2
  console.log(x === 2) // false
}

foo(1)
bar(1)
</code></pre>
<h2>åã€å‡½æ•°ä½œç”¨åŸŸä¸å˜é‡æå‡ï¼ˆVariable hoistingï¼‰</h2>
<h3>å‡½æ•°ä½œç”¨åŸŸ</h3>
<p>è´è¶ä¹¦ä¸Šçš„ä¾‹å­æƒ³å¿…å¤§å®¶éƒ½çœ‹è¿‡ï¼š</p>
<pre><code class="language-js">// The closure in loop problem
for (var i = 0; i !== 10; ++i) {
  setTimeout(function() { console.log(i) }, 0)
}
</code></pre>
<p>å‡½æ•°çº§ä½œç”¨åŸŸæœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåªèƒ½ä½¿ç”¨å‡½æ•°çº§ä½œç”¨åŸŸçš„è¯ï¼Œåœ¨å¾ˆå¤šä»£ç ä¸­å®ƒä¼šæ˜¾å¾—éå¸¸<strong>åç›´è§‰</strong>ã€‚æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªå¾ªç¯ä¾‹å­ï¼Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæ ¹æ®èŠ±æ‹¬å·çš„è¿ç« ç¡®å®šå˜é‡ä½œç”¨åŸŸè¿œæ¯”æ‰¾åˆ°å¤–å±‚å‡½æ•°å®¹æ˜“å¾—å¤šã€‚</p>
<p>åœ¨ä»¥å‰ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨é—­åŒ… + IIFE äº§ç”Ÿä¸€ä¸ªæ–°ä½œç”¨åŸŸï¼Œä»£ç éå¸¸éš¾çœ‹ï¼ˆå…¶å® <code>with</code> ä»¥åŠ <code>catch</code> è¯­å¥åé¢è·Ÿçš„ä»£ç å—ä¹Ÿç®—æ˜¯å—çº§ä½œç”¨åŸŸï¼Œä½†è¿™å¹¶ä¸é€šç”¨ï¼‰ã€‚</p>
<p>å¹¸è€Œç°åœ¨ ES2015 å¼•å…¥äº† <code>let</code> / <code>const</code>ï¼Œè®©æˆ‘ä»¬ç»ˆäºå¯ä»¥ç”¨ä¸ŠçœŸæ­£çš„å—çº§ä½œç”¨åŸŸã€‚</p>
<h3>å˜é‡æå‡</h3>
<p>JavaScript å¼•æ“åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œä¼šå…ˆå¤„ç†ä½œç”¨åŸŸå†…æ‰€æœ‰çš„å˜é‡å£°æ˜ï¼Œç»™å˜é‡åˆ†é…ç©ºé—´ï¼ˆåœ¨æ ‡å‡†é‡Œå« bindingï¼‰ï¼Œç„¶ååœ¨å†æ‰§è¡Œä»£ç ã€‚</p>
<p>è¿™æœ¬æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ <code>var</code> å£°æ˜åœ¨è¢«åˆ†é…ç©ºé—´çš„åŒæ—¶ä¹Ÿä¼šè¢«åˆå§‹åŒ–æˆ <code>undefined</code>ï¼ˆES5 ä¸­çš„ <a href="https://es5.github.io/#x10.2.1.1.2">CreateMutableBinding</a>ï¼‰ï¼Œè¿™å°±ç›¸å½“äºæŠŠ var å£°æ˜çš„å˜é‡æå‡åˆ°äº†å‡½æ•°ä½œç”¨åŸŸçš„å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ â€œhoistingâ€ã€‚</p>
<p>ES6 ä¸­å¼•å…¥çš„ <code>let</code>ã€<code>const</code> åˆ™å®ç°äº† temporal dead zoneï¼Œè™½ç„¶è¿›å…¥ä½œç”¨åŸŸæ—¶ç”¨ <code>let</code> å’Œ <code>const</code> å£°æ˜çš„å˜é‡ä¹Ÿä¼šè¢«åˆ†é…ç©ºé—´ï¼Œä½†ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚åœ¨åˆå§‹åŒ–è¯­å¥ä¹‹å‰ï¼Œå¦‚æœå‡ºç°å¯¹å˜é‡çš„å¼•ç”¨ï¼Œä¼šæŠ›å‡º <code>ReferenceError</code> é”™è¯¯ã€‚</p>
<pre><code class="language-js">// without TDZ
console.log(a) // undefined
var a = 1

// with TDZ
console.log(b) // ReferenceError
let b = 2
</code></pre>
<p>åœ¨æ ‡å‡†å±‚é¢ï¼Œè¿™æ˜¯é€šè¿‡æŠŠ CreateMutableBing å†…éƒ¨æ–¹æ³•åˆ†æ‹†æˆ CreateMutableBinding å’Œ InitializeBinding ä¸¤æ­¥å®ç°çš„ï¼Œåªæœ‰ VarDeclaredNames æ‰ä¼šæ‰§è¡Œ InitializeBinding æ–¹æ³•ã€‚</p>
<h3>letã€const</h3>
<p>ç„¶è€Œï¼Œ<code>let</code> å’Œ <code>const</code> çš„å¼•å…¥ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå‘ã€‚ä¸»è¦æ˜¯è¿™ä¸¤ä¸ªå…³é”®è¯çš„å‘½åä¸å¤Ÿç²¾ç¡®åˆç†ã€‚</p>
<p><code>const</code> å…³é”®è¯æ‰€å®šä¹‰çš„æ˜¯ä¸€ä¸ª immutable bindingï¼ˆç±»ä¼¼äº Java çš„ <code>final</code> å…³é”®è¯ï¼‰ï¼Œè€ŒéçœŸæ­£çš„å¸¸é‡ï¼ˆconstantï¼‰ï¼Œè¿™ä¸€ç‚¹å¯¹äºå¾ˆå¤šäººæ¥è¯´ä¹Ÿæ˜¯åç›´è§‰çš„ã€‚</p>
<p>ES6 è§„èŒƒçš„ä¸»ç¬” Allen Wirfs-Brock åœ¨ ESDiscuss çš„ä¸€ä¸ª<a href="https://esdiscuss.org/topic/should-const-be-favored-over-let#content-6">å¸–å­</a>é‡Œè¡¨ç¤ºï¼Œå¦‚æœå¯ä»¥ä»å¤´å†æ¥çš„è¯ï¼Œä»–ä¼šæ›´å€¾å‘äºé€‰æ‹© <code>let var</code> / <code>let</code> æˆ–è€… <code>mut</code> / <code>let</code> æ›¿ä»£ç°åœ¨çš„è¿™ä¸¤ä¸ªå…³é”®è¯ï¼Œå¯æƒœè¿™åªèƒ½æ˜¯ä¸€ä¸ªç¾å¥½çš„ç©ºæƒ³äº†ã€‚</p>
<h3>for...in</h3>
<p><code>for...in</code> çš„é—®é¢˜åœ¨äºå®ƒä¼šéå†åˆ°åŸå‹é“¾ä¸Šçš„å±æ€§ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥éƒ½çŸ¥é“çš„ï¼Œä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Š <code>obj.hasOwnProperty(key)</code> åˆ¤æ–­æ‰å®‰å…¨ã€‚</p>
<p>åœ¨ ES6+ ä¸­ï¼Œä½¿ç”¨ <code>for(const key of Object.keys(obj))</code> æˆ–è€… <code>for(const [key, value] of Object.entries())</code> å¯ä»¥ç»•å¼€è¿™ä¸ªé—®é¢˜ã€‚</p>
<blockquote>
<p>é¡ºä¾¿æä¸€ä¸‹ <code>Object.keys()</code>ã€<code>Object.getOwnPropertyNames()</code>ã€<code>Reflect.ownKeys()</code> çš„åŒºåˆ«ï¼šæˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€èˆ¬æ˜¯ <code>Object.keys()</code> æ–¹æ³•ï¼Œ<code>Object.getOwnPropertyNames()</code> ä¼šæŠŠ <code>enumerable: false</code> çš„å±æ€§åä¹Ÿä¼šåŠ è¿›æ¥ï¼Œè€Œ <code>Reflect.ownKeys()</code> åœ¨æ­¤åŸºç¡€ä¸Šè¿˜ä¼šåŠ ä¸Š <code>Symbol</code> ç±»å‹çš„é”®ã€‚</p>
</blockquote>
<h3>with</h3>
<p>æœ€ä¸»è¦çš„é—®é¢˜åœ¨äºå®ƒä¾èµ–è¿è¡Œæ—¶è¯­ä¹‰ï¼Œå½±å“ä¼˜åŒ–ã€‚</p>
<p>æ­¤å¤–è¿˜ä¼šé™ä½ç¨‹åºå¯è¯»æ€§ã€æ˜“å‡ºé”™ã€æ˜“æ³„éœ²å…¨å±€å˜é‡ã€‚</p>
<pre><code class="language-js">function fn(foo, length) {
  with(foo) {
    console.log(length)
  }
}
fn([1, 2, 3], 222) // 3
</code></pre>
<h3>eval</h3>
<p><code>eval</code> çš„é—®é¢˜ä¸åœ¨äºå¯ä»¥åŠ¨æ€æ‰§è¡Œä»£ç ï¼Œè¿™ç§èƒ½åŠ›æ— è®ºå¦‚ä½•ä¹Ÿä¸èƒ½ç®—æ˜¯è¯­è¨€çš„ç¼ºé™·ã€‚</p>
<h3>Scope</h3>
<p>å®ƒçš„ç¬¬ä¸€ä¸ªå‘åœ¨äºä¼ ç»™ eval ä½œä¸ºå‚æ•°çš„ä»£ç æ®µèƒ½å¤Ÿæ¥è§¦åˆ°å½“å‰è¯­å¥æ‰€åœ¨çš„é—­åŒ…ã€‚</p>
<p>è€Œç”¨ <code>new Function</code> åŠ¨æ€æ‰§è¡Œçš„ä»£ç å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚å› ä¸º <code>new Function</code> æ‰€ç”Ÿæˆçš„å‡½æ•°æ˜¯ç¡®ä¿æ‰§è¡Œåœ¨æœ€å¤–å±‚ä½œç”¨åŸŸä¸‹çš„ï¼ˆ<a href="http://perfectionkills.com/global-eval-what-are-the-options/#new_function">ä¸¥æ ¼æ¥è¯´æ ‡å‡†é‡Œä¸æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œä½†å®é™…æ•ˆæœåŸºæœ¬å¯ä»¥çœ‹ä½œç­‰åŒï¼Œé™¤äº†Â <code>new Function</code>Â ä¸­å¯ä»¥è·å–åˆ°Â <code>arguments</code>Â å¯¹è±¡</a>ï¼‰ã€‚</p>
<pre><code class="language-js">function test1() {
  var a = 11
  eval('(a = 22)')
  console.log(a) // 22
}

function test2() {
  var a = 11
  new Function('return (a = 22)')()
  console.log(a) // 11
}
</code></pre>
<h3>ç›´æ¥è°ƒç”¨ vs é—´æ¥è°ƒç”¨ï¼ˆDirect Call vs Indirect Callï¼‰</h3>
<p>ç¬¬äºŒä¸ªå‘æ˜¯ç›´æ¥è°ƒç”¨Â <code>eval</code>Â å’Œé—´æ¥è°ƒç”¨çš„åŒºåˆ«ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä½†æ˜¯ã€Œç›´æ¥è°ƒç”¨ã€çš„æ¦‚å¿µå°±è¶³ä»¥è®©äººè¿·ç³Šäº†ã€‚</p>
<p>é¦–å…ˆï¼Œ<a href="https://es5.github.io/#x15.1.2"><code>eval</code>Â æ˜¯å…¨å±€å¯¹è±¡ä¸Šçš„ä¸€ä¸ªæˆå‘˜å‡½æ•°</a>ï¼›</p>
<p>ä½†æ˜¯ï¼Œ<a href="https://esdiscuss.org/topic/double-checking-if-window-eval-is-an-indirect-call-to-eval#content-1"><code>window.eval()</code>Â è¿™æ ·çš„è°ƒç”¨Â <strong>ä¸ç®—æ˜¯</strong>Â ç›´æ¥è°ƒç”¨ï¼Œå› ä¸ºè¿™ä¸ªè°ƒç”¨çš„ base æ˜¯å…¨å±€å¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ª &quot;environment record&quot;</a>ã€‚</p>
<p>æ¥ä¸‹æ¥çš„å°±æ˜¯å†å²é—®é¢˜äº†ã€‚</p>
<ul>
<li>åœ¨ ES1 æ—¶ä»£ï¼Œ<code>eval</code>Â è°ƒç”¨å¹¶æ²¡æœ‰ç›´æ¥å’Œé—´æ¥çš„åŒºåˆ†ï¼›</li>
<li>ç„¶ååœ¨ ES2 ä¸­ï¼ŒåŠ å…¥äº†ç›´æ¥è°ƒç”¨ï¼ˆdirect callï¼‰çš„æ¦‚å¿µã€‚æ ¹æ®Â <a href="http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/#indirect-eval-call">Dmitry Soshnikov åæ¥çš„è¯´æ³•</a>ï¼ŒåŒºåˆ†è¿™ä¸¤ç§è°ƒç”¨å¯èƒ½æ˜¯å¤„äºå®‰å…¨è€ƒè™‘ã€‚æ­¤æ—¶å”¯ä¸€åˆæ³•çš„Â <code>eval</code>Â ä½¿ç”¨æ–¹å¼æ˜¯Â <strong>ç›´æ¥è°ƒç”¨</strong>ï¼Œå¦‚æœÂ <code>eval</code>Â è¢«é—´æ¥è°ƒç”¨äº†æˆ–è€…è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡äº†ï¼ŒJavaScript å¼•æ“Â <strong>å¯ä»¥é€‰æ‹©</strong>Â æŠ¥ä¸€ä¸ª Runtime Errorï¼ˆ<a href="https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%202nd%20edition,%20August%201998.pdf">ECMA-262 2nd Edition</a>, p.63ï¼‰ã€‚</li>
<li>ä½†æ˜¯æµè§ˆå™¨å‚å•†ä»¬åœ¨è¯•å›¾å®ç°è¿™ä¸ªç‰¹æ€§æ—¶ï¼Œå‘ç°è¿™ä¼šè®©ä¸€äº›æ—§ç½‘ç«™ä¸å…¼å®¹ã€‚</li>
<li>è€ƒè™‘åˆ°è¿™æ¯•ç«Ÿæ˜¯å¯é€‰çš„ç‰¹æ€§ï¼Œä»–ä»¬æœ€åå°±é€‰æ‹©äº†ä¸æŠ¥é”™ï¼Œè½¬è€Œè®©æ‰€æœ‰é—´æ¥è°ƒç”¨çš„Â <code>eval</code>Â éƒ½åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹æ‰§è¡Œã€‚ è¿™æ ·ä¸€æ¥ï¼Œæ—¢ä¿æŒäº†å¯¹æ—§ç½‘ç«™çš„å…¼å®¹æ€§ï¼Œä¹Ÿä¿è¯äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§ã€‚</li>
<li><a href="https://mail.mozilla.org/pipermail/es-discuss/2011-February/012852.html">åˆ°äº† ES5 æ—¶æœŸï¼Œæ ‡å‡†åˆ¶å®šè€…ä»¬å¸Œæœ›èƒ½å¤Ÿå’Œå½“å‰çº¦å®šä¿—æˆçš„å®ç°ä¿æŒä¸€ç›´å¹¶è§„èŒƒåŒ–ï¼Œæ‰€ä»¥å»æ‰äº†ä¹‹å‰æ ‡å‡†é‡Œçš„å¯é€‰å®ç°ï¼Œè½¬è€Œè§„å®šäº†é—´æ¥è°ƒç”¨Â <code>eval</code>Â æ—¶çš„è¡Œä¸º</a></li>
</ul>
<p>ç›´æ¥è°ƒç”¨å’Œé—´æ¥è°ƒç”¨æœ€å¤§çš„åŒºåˆ«åœ¨äºä»–ä»¬çš„ä½œç”¨åŸŸä¸åŒï¼š<code>javascript function test() { var x = 2, y = 4 console.log(eval(&quot;x + y&quot;)) // Direct call, uses local scope, result is 6 var geval = eval; console.log(eval(&quot;x + y&quot;)) // Indirect call, uses global scope, throws ReferenceError because </code>x<code> is undefined }</code></p>
<p>é—´æ¥è°ƒç”¨Â <code>eval</code>Â æœ€å¤§çš„ç”¨å¤„ï¼ˆå¯èƒ½ä¹Ÿæ˜¯å”¯ä¸€çš„å®é™…ç”¨å¤„ï¼‰æ˜¯åœ¨ä»»æ„åœ°æ–¹è·å–åˆ°å…¨å±€å¯¹è±¡ï¼ˆç„¶è€Œ Function('return this')() ä¹Ÿèƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼‰ï¼šÂ <code>javascript // å³ä½¿æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¹Ÿèƒ½èµ·ä½œç”¨ var global = (&quot;indirect&quot;, eval)(&quot;this&quot;);</code></p>
<p>æœªæ¥ï¼Œå¦‚æœ Jordan Harband çš„Â <a href="https://github.com/tc39/proposal-global"><code>System.global</code>Â ææ¡ˆ</a>èƒ½è¿›å…¥åˆ°æ ‡å‡†çš„è¯ï¼Œè¿™æœ€åä¸€ç‚¹ç”¨å¤„ä¹Ÿç”¨ä¸åˆ°äº†â€¦â€¦</p>
<h2>åä¸€ã€éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œèµ‹å€¼ç»™æœªå£°æ˜çš„å˜é‡ä¼šå¯¼è‡´äº§ç”Ÿä¸€ä¸ªæ–°çš„å…¨å±€å˜é‡</h2>
<h3>Value Properties of the Global Object</h3>
<p>å¹³å¸¸æˆ‘ä»¬ä½¿ç”¨åˆ°çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN">NaN</a>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Infinity">Infinity</a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined">undefined</a> å¹¶ä¸æ˜¯ä½œä¸ºåŸå§‹å€¼è¢«ä½¿ç”¨çš„ï¼Œ<a href="https://es5.github.io/#x15.1.1">è€Œæ˜¯å®šä¹‰åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„å±æ€§å</a>ã€‚</p>
<p>åœ¨ ES5 ä¹‹å‰ï¼Œè¿™å‡ ä¸ªå±æ€§ç”šè‡³å¯ä»¥è¢«è¦†ç›–ï¼Œç›´åˆ° ES5 ä¹‹åå®ƒä»¬æ‰è¢«æ”¹æˆ non-configurableã€non-writableã€‚</p>
<p>ç„¶è€Œï¼Œå› ä¸ºè¿™å‡ ä¸ªå±æ€§åéƒ½ä¸æ˜¯ JavaScript çš„ä¿ç•™å­—ï¼Œæ‰€ä»¥å¯ä»¥è¢«ç”¨æ¥å½“åšå˜é‡åä½¿ç”¨ã€‚å³ä½¿å…¨å±€å˜é‡ä¸Šçš„è¿™å‡ ä¸ªå±æ€§ä¸å¯è¢«æ›´æ”¹ï¼Œæˆ‘ä»¬ä»å¯ä»¥åœ¨è‡ªå·±çš„ä½œç”¨åŸŸé‡Œé¢å¯¹è¿™å‡ ä¸ªåå­—è¿›è¡Œè¦†ç›–ã€‚</p>
<pre><code class="language-js">(function () {
  var undefined = 'foo'
  console.log(undefined, typeof undefined) // &quot;foo&quot; &quot;string&quot;
})()
</code></pre>
<h3>Stateful RegExps</h3>
<p>JavaScript ä¸­ï¼Œæ­£åˆ™å¯¹è±¡ä¸Šçš„å‡½æ•°æ˜¯æœ‰çŠ¶æ€çš„ï¼š</p>
<pre><code class="language-js">const re = /foo/g
console.log(re.test('foo bar')) // true
console.log(re.test('foo bar')) // false
</code></pre>
<p>è¿™ä½¿å¾—è¿™äº›æ–¹æ³•éš¾ä»¥è°ƒè¯•ï¼Œæ— æ³•åšåˆ°çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>Brendan Eich çš„è¯´æ³•æ˜¯<a href="https://twitter.com/BrendanEich/status/231066800304046080">è¿™äº›æ–¹æ³•æ¥è‡ªäº 90 å¹´ä»£çš„ Perl 4ï¼Œé‚£æ—¶å€™å¹¶æ²¡æœ‰æƒ³åˆ°è¿™ä¹ˆå¤š</a>ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<h2>References</h2>
<ul>
<li><a href="https://sodatea.blog/zh/2016/javascript-design-regrets">JavaScript çš„è®¾è®¡å¤±è¯¯</a></li>
<li><a href="https://2ality.com/2013/10/typeof-null.html">The history of â€œtypeof nullâ€</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof MDN</a></li>
<li><a href="https://2ality.com/2012/03/stricter-equality.html">Stricter equality in JavaScript</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[éšæœºæ‰“ä¹±æ•°ç»„]]></title>
            <link>https://github.com/toFrankie/blog/issues/233</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/233</guid>
            <pubDate>Sun, 26 Feb 2023 11:00:09 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1707274165665.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡ä»‹ç»ä¸‰ç§æ•°ç»„ä¹±åºçš„æ–¹å¼ï¼š</p>
<ul>
<li>Array.proto]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/2/1707274165665.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ¬æ–‡ä»‹ç»ä¸‰ç§æ•°ç»„ä¹±åºçš„æ–¹å¼ï¼š</p>
<ul>
<li>Array.prototype.sort</li>
<li>Fisherâ€“Yates Shuffle</li>
<li>Knuth-Durstenfeld Shuffle</li>
</ul>
<p>è‹¥è¦å®ç°éšæœºæ‰“ä¹±æ•°ç»„çš„éœ€æ±‚ï¼Œä¸å»ºè®®ä½¿ç”¨ <code>arr.sort(() =&gt; Math.random() - 0.5)</code> ã€‚ç›®å‰ç”¨å¾—è¾ƒå¤šçš„æ˜¯ Knuth-Durstenfeld Shuffle ç®—æ³•ï¼ˆæ´—ç‰Œç®—æ³•ï¼‰ï¼Œå‰ç«¯å¸¸ç”¨çš„ Lodash åº“é‡Œé¢çš„ <a href="https://www.lodashjs.com/docs/lodash.shuffle"><code>_.shuffle()</code></a> ä¹Ÿæ˜¯ä½¿ç”¨äº†è¿™ç§ç®—æ³•ã€‚</p>
<h2>Array.prototype.sort æ’åº</h2>
<p>æœ€ç®€å•çš„ä¹±åºå®ç°ï¼š</p>
<pre><code class="language-js">function randomShuffle(arr) {
  return arr.sort(() =&gt; Math.random() - 0.5)
}
</code></pre>
<p>ä½†å®é™…ä¸Š<strong>è¿™ç§æ–¹æ³•å¹¶ä¸èƒ½çœŸæ­£çš„éšæœºæ‰“ä¹±æ•°ç»„</strong>ã€‚åœ¨å¤šæ¬¡æ‰§è¡Œåï¼Œæ¯ä¸ªå…ƒç´ æœ‰å¾ˆå¤§å‡ ç‡è¿˜åœ¨å®ƒåŸæ¥çš„ä½ç½®é™„è¿‘å‡ºç°ã€‚è¯¦è§ï¼š<a href="https://www.cnblogs.com/macq/p/6650586.html">å¸¸ç”¨çš„ sort æ‰“ä¹±æ•°ç»„æ–¹æ³•çœŸçš„æœ‰ç”¨ï¼Ÿ</a></p>
<h2>Fisherâ€“Yates Shuffleï¼ˆFisher and Yates' original methodï¼‰</h2>
<p>ç”± Ronald FisherÂ å’ŒÂ Frank YatesÂ æå‡ºçš„ <a href="https://www.wikiwand.com/en/Fisher%E2%80%93Yates_shuffle#/Fisher_and_Yates'_original_method">Fisherâ€“Yates shuffle</a> ç®—æ³•æ€æƒ³ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å‡è®¾æœ‰ä¸€ä¸ªé•¿åº¦ä¸º N çš„æ•°ç»„</p>
<ol>
<li>ä»ç¬¬ 1 ä¸ªåˆ°å‰©ä½™çš„æœªåˆ é™¤é¡¹ï¼ˆåŒ…å«ï¼‰ä¹‹é—´é€‰æ‹©ä¸€ä¸ªéšæœºæ•° kã€‚</li>
<li>ä»å‰©ä½™çš„å…ƒç´ ä¸­å°†ç¬¬ k ä¸ªå…ƒç´ åˆ é™¤å¹¶å–å‡ºï¼Œæ”¾åˆ°æ–°æ•°ç»„ä¸­ã€‚</li>
<li>é‡å¤ç¬¬ 1ã€2 æ­¥ç›´åˆ°æ‰€æœ‰å…ƒç´ éƒ½è¢«åˆ é™¤ã€‚</li>
<li>æœ€ç»ˆå°†æ–°æ•°ç»„è¿”å›</li>
</ol>
</blockquote>
<h3>å®ç°</h3>
<pre><code class="language-js">function shuffle(arr) {
  let random
  const newArr = []

  while (arr.length) {
    random = Math.floor(Math.random() * arr.length)
    newArr.push(arr[random])
    arr.splice(random, 1)
  }

  return newArr
}
</code></pre>
<h3>ä¸¾ä¾‹</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ 1 ~ 8 çš„æ•°å­—</p>
<blockquote>
<p>è¡¨æ ¼æ¯åˆ—åˆ†åˆ«è¡¨ç¤ºï¼šèŒƒå›´ã€éšæœºæ•°ï¼ˆè¢«ç§»é™¤æ•°çš„ä½ç½®ï¼‰ã€å‰©ä½™æœªåˆ é™¤çš„æ•°ã€å·²éšæœºæ’åˆ—çš„æ•°ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:center">Scratch</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">1 2 3 4 5 6 7 8</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä» 1 ~ 8 ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°ï¼Œå¾—åˆ°éšæœºæ•° <em>k</em> ä¸º 3ï¼Œç„¶ååœ¨ Scratch ä¸Šåˆ é™¤ç¬¬ <em>k</em> ä¸ªæ•°å­—ï¼ˆå³æ•°å­— 3ï¼‰ï¼Œå¹¶å°†å…¶æ”¾åˆ° Result ä¸­ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:center">Scratch</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 - 8</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1 2 <s>3</s> 4 5 6 7 8</td>
<td style="text-align:center"><strong>3</strong></td>
</tr>
</tbody>
</table>
<p>ç°åœ¨æˆ‘ä»¬ä» 1 ~ 7 é€‰æ‹©ç¬¬äºŒä¸ªéšæœºæ•° <em>k</em> ä¸º 4ï¼Œç„¶ååœ¨ Scratch ä¸Šåˆ é™¤ç¬¬ <em>k</em> ä¸ªæ•°å­—ï¼ˆå³æ•°å­— 5ï¼‰ï¼Œå¹¶å°†å…¶æ”¾åˆ° Result ä¸­ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:center">Scratch</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 - 7</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1 2 <s>3</s> 4 <s>5</s> 6 7 8</td>
<td style="text-align:center">3 <strong>5</strong></td>
</tr>
</tbody>
</table>
<p>ç°åœ¨æˆ‘ä»¬ä» 1 ~ 6 é€‰æ‹©ä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åä» 1 ~ 5 é€‰æ‹©ä¾æ­¤ç±»æ¨ï¼Œæ€»æ˜¯é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:center">Scratch</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1â€“6</td>
<td style="text-align:center">5</td>
<td style="text-align:center">1 2Â <s>3</s>Â 4Â <s>5</s>Â 6Â <s>7</s>Â 8</td>
<td style="text-align:center">3 5 <strong>7</strong></td>
</tr>
<tr>
<td style="text-align:center">1â€“5</td>
<td style="text-align:center">3</td>
<td style="text-align:center">1 2Â <s>3</s>Â <s>4</s>Â <s>5</s>Â 6Â <s>7</s>Â 8</td>
<td style="text-align:center">3 5 7 <strong>4</strong></td>
</tr>
<tr>
<td style="text-align:center">1â€“4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">1 2Â <s>3</s>Â <s>4</s>Â <s>5</s>Â 6Â <s>7</s>Â <s>8</s></td>
<td style="text-align:center">3 5 7 4 <strong>8</strong></td>
</tr>
<tr>
<td style="text-align:center">1â€“3</td>
<td style="text-align:center">1</td>
<td style="text-align:center"><s>1</s>Â 2Â <s>3</s>Â <s>4</s>Â <s>5</s>Â 6Â <s>7</s>Â <s>8</s></td>
<td style="text-align:center">3 5 7 4 8 <strong>1</strong></td>
</tr>
<tr>
<td style="text-align:center">1â€“2</td>
<td style="text-align:center">2</td>
<td style="text-align:center"><s>1</s>Â 2Â <s>3</s>Â <s>4</s>Â <s>5</s>Â <s>6</s>Â <s>7</s>Â <s>8</s></td>
<td style="text-align:center">3 5 7 4 8 1 <strong>6</strong></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"><s>1</s>Â <s>2</s>Â <s>3</s>Â <s>4</s>Â <s>5</s>Â <s>6</s>Â <s>7</s>Â <s>8</s></td>
<td style="text-align:center">3 5 7 4 8 1 6 <strong>2</strong></td>
</tr>
</tbody>
</table>
<h2>Knuth-Durstenfeld Shuffleï¼ˆThe modern algorithmï¼‰</h2>
<p>Richard Durstenfeld äº 1964 å¹´æ¨å‡ºäº†ç°ä»£ç‰ˆæœ¬çš„ <a href="https://www.wikiwand.com/en/Fisher%E2%80%93Yates_shuffle#citenotecacm2">Fisherâ€“Yates shuffle</a>ï¼Œå¹¶ç”± Donald E. Knuth åœ¨ <a href="https://www.wikiwand.com/en/The_Art_of_Computer_Programming">The Art of Computer Programming</a> ä»¥ â€œAlgorithm P (Shuffling)â€ è¿›è¡Œäº†æ¨å¹¿ã€‚Durstenfeld æ‰€æè¿°çš„ç®—æ³•ä¸ Fisher å’Œ Yates æ‰€ç»™å‡ºçš„ç®—æ³•æœ‰å¾ˆå°çš„å·®å¼‚ï¼Œä½†æ„ä¹‰é‡å¤§ã€‚</p>
<pre><code class="language-text">-- To shuffle an array a of n elements (indices 0..n-1):  
for i from nâˆ’1 downto 1 do  // æ•°ç»„ä» n-1 åˆ° 0 å¾ªç¯æ‰§è¡Œ n æ¬¡
  j â† random integer such that 0 â‰¤ j â‰¤ i  // ç”Ÿæˆä¸€ä¸ª 0 åˆ° n-1 ä¹‹é—´çš„éšæœºç´¢å¼•
  exchange a[j] and a[i] // å°†äº¤æ¢ä¹‹åå‰©ä½™çš„åºåˆ—ä¸­æœ€åä¸€ä¸ªå…ƒç´ ä¸éšæœºé€‰å–çš„å…ƒç´ äº¤æ¢
</code></pre>
<p>Durstenfeld çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†â€œ<strong>åˆ é™¤</strong>â€çš„æ•°å­—ç§»è‡³æ•°ç»„<strong>æœ«å°¾</strong>ï¼Œå³<strong>å°†æ¯ä¸ªè¢«åˆ é™¤æ•°å­—ä¸æœ€åä¸€ä¸ªæœªåˆ é™¤çš„æ•°å­—è¿›è¡Œäº¤æ¢</strong>ã€‚</p>
<h3>å®ç°</h3>
<pre><code class="language-js">function shuffle(arr) {
  let i = arr.length

  while (--i) {
    let j = Math.floor(Math.random() * i)
    ;[arr[j], arr[i]] = [arr[i], arr[j]]
  }

  return arr
}
</code></pre>
<p>Knuth-Durstenfeld Shuffle å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° <code>O(n)</code>ï¼Œè€Œ Fisherâ€“Yates shuffle çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n2)</code>ã€‚åè€…åœ¨è®¡ç®—æœºå®ç°è¿‡ç¨‹ä¸­ï¼Œå°†èŠ±è´¹ä¸å¿…è¦çš„æ—¶é—´æ¥è®¡ç®—æ¯æ¬¡å‰©ä½™çš„æ•°å­—ï¼ˆå¯ä»¥ç†è§£æˆæ•°ç»„é•¿åº¦ï¼‰ã€‚</p>
<h3>ä¸¾ä¾‹</h3>
<p>åŒæ ·ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ 1 ~ 8 çš„æ•°å­—</p>
<blockquote>
<p>è¡¨æ ¼æ¯åˆ—åˆ†åˆ«è¡¨ç¤ºï¼šèŒƒå›´ã€å½“å‰éšæœºæ•°ï¼ˆå³éšæœºäº¤äº’çš„ä½ç½®ï¼‰ã€å‰©ä½™æœªäº¤æ¢çš„æ•°ã€å·²éšæœºæ’åˆ—çš„æ•°ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:right">Scratch</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:right">1 2 3 4 5 6 7 8</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬ä» 1 ~ 8 ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°ï¼Œå¾—åˆ°éšæœºæ•° <em>k</em> ä¸º 6ï¼Œç„¶åäº¤æ¢ Scratch ä¸­çš„ç¬¬ 6 å’Œç¬¬ 8 ä¸ªæ•°å­—ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:right">Scratch</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 - 8</td>
<td style="text-align:center">6</td>
<td style="text-align:right">1 2 3 4 5 <strong>8</strong> 7</td>
<td style="text-align:left"><strong>6</strong></td>
</tr>
</tbody>
</table>
<p>æ¥ç€ï¼Œä» 1 ~ 7 ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°ï¼Œå¾—åˆ°éšæœºæ•° <em>k</em> ä¸º 2ï¼Œç„¶åäº¤æ¢ Scratch ä¸­çš„ç¬¬ 2 å’Œç¬¬ 7 ä¸ªæ•°å­—ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:right">Scratch</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 - 7</td>
<td style="text-align:center">6</td>
<td style="text-align:right">1 <strong>7</strong> 3 4 5 8</td>
<td style="text-align:left"><strong>2</strong> 6</td>
</tr>
</tbody>
</table>
<p>ç»§ç»­ï¼Œä¸‹ä¸€ä¸ªéšæœºæ•°æ˜¯1 ~ 6ï¼Œå¾—åˆ°çš„éšæœºæ•°æ°å¥½æ˜¯ 6ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†åˆ—è¡¨ä¸­çš„ç¬¬ 6 ä¸ªæ•°å­—ä¿ç•™ä¸‹æ¥ï¼ˆç»è¿‡ä¸Šé¢çš„äº¤æ¢ï¼Œç°åœ¨æ˜¯ 8ï¼‰ï¼Œç„¶åç§»åˆ°ä¸‹ä¸€ä¸ªæ­¥ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œæ“ä½œï¼Œç›´åˆ°å®Œæˆæ’åˆ—ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Range</th>
<th style="text-align:center">Roll</th>
<th style="text-align:right">Scratch</th>
<th style="text-align:left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1 - 6</td>
<td style="text-align:center">6</td>
<td style="text-align:right">1 7 3 4 5</td>
<td style="text-align:left"><strong>8</strong> 2 6</td>
</tr>
<tr>
<td style="text-align:center">1 - 5</td>
<td style="text-align:center">1</td>
<td style="text-align:right"><strong>5</strong> 7 3 4</td>
<td style="text-align:left"><strong>1</strong> 8 2 6</td>
</tr>
<tr>
<td style="text-align:center">1 - 4</td>
<td style="text-align:center">3</td>
<td style="text-align:right">5 7 <strong>4</strong></td>
<td style="text-align:left"><strong>3</strong> 1 8 2 6</td>
</tr>
<tr>
<td style="text-align:center">1 - 3</td>
<td style="text-align:center">3</td>
<td style="text-align:right">5 7</td>
<td style="text-align:left"><strong>4</strong> 3 1 8 2 6</td>
</tr>
<tr>
<td style="text-align:center">1 - 2</td>
<td style="text-align:center">1</td>
<td style="text-align:right"><strong>7</strong></td>
<td style="text-align:left"><strong>5</strong> 4 3 1 8 2 6</td>
</tr>
</tbody>
</table>
<p>å› æ­¤ï¼Œç»“æœæ˜¯ <code>7 5 4 3 1 8 2 6</code>ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://www.cnblogs.com/macq/p/6650586.html">å¸¸ç”¨çš„ sort æ‰“ä¹±æ•°ç»„æ–¹æ³•çœŸçš„æœ‰ç”¨ï¼Ÿ</a></li>
<li><a href="https://bost.ocks.org/mike/shuffle/">Fisherâ€“Yates Shuffle å¯è§†åŒ–</a></li>
<li><a href="https://www.wikiwand.com/en/Fisher%E2%80%93Yates_shuffle">Fisherâ€“Yates shuffle wiki</a></li>
<li><a href="https://github.com/ccforward/cc/issues/44">æ´—ç‰Œç®—æ³•ï¼ˆshuffleï¼‰çš„ js å®ç°</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ä¸¥æ ¼æ¨¡å¼è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/232</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/232</guid>
            <pubDate>Sun, 26 Feb 2023 10:58:07 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€æ¦‚å¿µ</h3>
<p>é™¤äº†æ­£å¸¸è¿è¡Œæ¨¡å¼ï¼Œ<a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">ECMAScript 5</a> æ·»åŠ äº†ç¬¬äºŒç§è¿è¡Œæ¨¡å¼ï¼š<a href="https]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€æ¦‚å¿µ</h3>
<p>é™¤äº†æ­£å¸¸è¿è¡Œæ¨¡å¼ï¼Œ<a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">ECMAScript 5</a> æ·»åŠ äº†ç¬¬äºŒç§è¿è¡Œæ¨¡å¼ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode">ä¸¥æ ¼æ¨¡å¼</a>ï¼ˆstrict modeï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ç§æ¨¡å¼ä½¿å¾— JavaScript åœ¨æ›´ä¸¥æ ¼çš„æ¡ä»¶ä¸‹è¿è¡Œã€‚</p>
<blockquote>
<p>ä¸ä¹‹ç›¸åçš„<strong>éä¸¥æ ¼æ¨¡å¼</strong>ï¼Œè¢«ç§°ä¸ºâ€œ<strong><a href="https://developer.mozilla.org/docs/Glossary/Sloppy_mode">sloppy mode</a></strong>â€ï¼Œä¹Ÿç§°ä¹‹ä¸ºâ€œæ­£å¸¸æ¨¡å¼â€ã€‚å› ä¸ºç¿»è¯‘åŸå› ï¼Œæ­£å¸¸æ¨¡å¼ä¹Ÿè¢«ç¿»è¯‘ä¸º â€”â€” é©¬è™æ¨¡å¼/ç¨€æ¾æ¨¡å¼/æ‡’æ•£æ¨¡å¼ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®˜æ–¹æœ¯è¯­ï¼Œä½†æ˜¯ä½ ä¼šç»å¸¸è§åˆ°å¦‚ä¸Šçš„ä¸€äº›è¯´æ³•ï¼Œå…¶æ„ä¹‰å°±æ˜¯æŒ‡ä»£éä¸¥æ ¼æ¨¡å¼ï¼Œå³æ­£å¸¸æ¨¡å¼ã€‚</p>
</blockquote>
<p>è®¾ç«‹ä¸¥æ ¼æ¨¡å¼çš„ç›®çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<blockquote>
<ul>
<li>
<p>æ¶ˆé™¤ JavaScript è¯­æ³•çš„ä¸€äº›ä¸åˆç†ã€ä¸ä¸¥è°¨ä¹‹å¤„ï¼Œå‡å°‘ä¸€äº›æ€ªå¼‚è¡Œä¸º;</p>
</li>
<li>
<p>æ¶ˆé™¤ä»£ç è¿è¡Œçš„ä¸€äº›ä¸å®‰å…¨ä¹‹å¤„ï¼Œä¿è¯ä»£ç è¿è¡Œçš„å®‰å…¨ï¼›</p>
</li>
<li>
<p>æé«˜ç¼–è¯‘å™¨æ•ˆç‡ï¼Œå¢åŠ è¿è¡Œé€Ÿåº¦ï¼›</p>
</li>
<li>
<p>ä¸ºæœªæ¥æ–°ç‰ˆæœ¬çš„ JavaScript åšå¥½é“ºå«ã€‚</p>
</li>
</ul>
</blockquote>
<p><strong>ä¸¥æ ¼æ¨¡å¼</strong>ä½“ç°äº† JavaScript æ›´åˆç†ã€æ›´å®‰å…¨ã€æ›´ä¸¥è°¨çš„å‘å±•æ–¹å‘ï¼ŒåŒ…æ‹¬ IE10 åœ¨å†…çš„ä¸»æµæµè§ˆå™¨éƒ½å·²ç»<a href="https://kangax.github.io/compat-table/es5/">æ”¯æŒ</a>å®ƒï¼Œè®¸å¤šå¤§é¡¹ç›®å·²ç»å¼€å§‹å…¨é¢æ‹¥æŠ±å®ƒã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼ŒåŒæ ·çš„ä»£ç ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸ä¸€æ ·çš„è¿è¡Œç»“æœï¼›ä¸€äº›åœ¨æ­£å¸¸æ¨¡å¼ä¸‹å¯ä»¥è¿è¡Œçš„è¯­å¥ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å°†ä¸èƒ½è¿è¡Œã€‚</p>
<h3>äºŒã€å¯ç”¨ä¸¥æ ¼æ¨¡å¼</h3>
<p>å¯ç”¨ä¸¥æ ¼æ¨¡å¼å¾ˆç®€å•ï¼Œå°±ä¸€è¡Œè¯­å¥ã€‚ï¼ˆåˆ†å·å¯ä»¥æ˜¾å¼æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªåŠ¨åˆ†å·æ’å…¥ã€‚ï¼‰</p>
<pre><code class="language-js">&quot;use strict&quot;;

// æˆ–è€…
'use strict';

// æˆ–è€…ï¼ˆç”±äº ASI æœºåˆ¶ï¼Œç¼–å†™ä»£ç æ—¶å¯çœç•¥åˆ†å·ï¼‰
'use strict'
</code></pre>
<p>ä¸æ”¯æŒè¯¥æ¨¡å¼çš„æµè§ˆå™¨ï¼Œä¼šæŠŠå®ƒå½“ä½œä¸€è¡Œæ™®é€šå­—ç¬¦ä¸²ï¼ŒåŠ ä»¥å¿½ç•¥ã€‚</p>
<h3>ä¸‰ã€è°ƒç”¨ä¸¥æ ¼æ¨¡å¼</h3>
<p>ä¸¥æ ¼æ¨¡å¼å¯ä»¥åº”ç”¨åˆ°<strong>æ•´ä¸ªè„šæœ¬</strong>æˆ–<strong>ä¸ªåˆ«å‡½æ•°</strong>ä¸­ã€‚ä¸è¦åœ¨å°é—­å¤§æ‹¬å¼§ <code>{}</code> å†…è¿™æ ·åšï¼Œåœ¨è¿™æ ·çš„ä¸Šä¸‹æ–‡ä¸­è¿™ä¹ˆåšæ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚</p>
<p>ä¸¥æ ¼æ¨¡å¼æœ‰ä¸¤ç§è°ƒç”¨æ–¹æ³•ï¼Œé€‚ç”¨äºä¸åŒçš„åœºåˆã€‚</p>
<h5>1. é’ˆå¯¹æ•´ä¸ªè„šæœ¬æ–‡ä»¶</h5>
<p>å°† <code>&quot;use strict&quot;;</code> æ”¾åœ¨è„šæœ¬æ–‡ä»¶çš„<strong>ç¬¬ä¸€è¡Œ</strong>ï¼Œåˆ™æ•´ä¸ªè„šæœ¬éƒ½å°†ä»¥<strong>ä¸¥æ ¼æ¨¡å¼</strong>è¿è¡Œã€‚å¦‚æœè¿™è¡Œè¯­å¥ä¸åœ¨ç¬¬ä¸€è¡Œï¼Œåˆ™æ— æ•ˆï¼Œæ•´ä¸ªè„šæœ¬ä»¥æ­£å¸¸æ¨¡å¼è¿è¡Œã€‚</p>
<blockquote>
<p>å¦‚æœä¸åŒæ¨¡å¼çš„ä»£ç æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
</blockquote>
<pre><code class="language-html">&lt;script&gt;
  &quot;use strict&quot;;
  console.log(&quot;è¿™æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼&quot;);
&lt;/script&gt;

&lt;script&gt;
  console.log(&quot;è¿™æ˜¯æ­£å¸¸æ¨¡å¼ï¼&quot;);
&lt;/script&gt;
</code></pre>
<p>ä¸Šè¿°ä»£ç è¡¨ç¤ºï¼Œä¸€ä¸ªç½‘é¡µä¸­ä¾æ¬¡æœ‰ä¸¤æ®µ JavaScript ä»£ç ã€‚å‰ä¸€ä¸ª <code>&lt;script&gt;</code> æ ‡ç­¾æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œåä¸€ä¸ªæ˜¯éä¸¥æ ¼æ¨¡å¼ã€‚</p>
<h5>2. é’ˆå¯¹å•ä¸ªå‡½æ•°</h5>
<p>å°† <code>&quot;use strict&quot;;</code> æ”¾åœ¨å‡½æ•°ä½“çš„ç¬¬ä¸€è¡Œï¼Œåˆ™æ•´ä¸ªå‡½æ•°ä»¥ä¸¥æ ¼æ¨¡å¼è¿è¡Œã€‚</p>
<pre><code class="language-js">function strict() {
  &quot;use strict&quot;;
  return &quot;è¿™æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼&quot;;
}

function notStrict() {
  return &quot;è¿™æ˜¯æ­£å¸¸æ¨¡å¼ï¼&quot;;
}
</code></pre>
<h5>3. è„šæœ¬æ–‡ä»¶çš„å˜é€šå†™æ³•</h5>
<p>å› ä¸ºç¬¬ä¸€ç§è°ƒç”¨æ–¹æ³•ä¸åˆ©äºæ–‡ä»¶åˆå¹¶ï¼Œæ‰€ä»¥æ›´å¥½çš„åšæ³•æ˜¯å€Ÿç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå°†æ•´ä¸ªè„šæœ¬æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ä¹‹ä¸­ã€‚</p>
<pre><code class="language-js">(function () {
  &quot;use strict&quot;;
  // ...
})();
</code></pre>
<h5>4. å…³äº &quot;use strict&quot; æ”¾åœ¨ Program æˆ– FunctionBody çš„ç¬¬ä¸€è¡Œé—®é¢˜</h5>
<blockquote>
<p>ä¸¥æ ¼åœ°è¯´ï¼Œåªè¦å‰é¢ä¸æ˜¯äº§ç”Ÿå®é™…è¿è¡Œç»“æœçš„è¯­å¥ï¼Œ<code>&quot;use strict&quot;;</code> å¯ä»¥ä¸åœ¨ç¬¬ä¸€è¡Œï¼Œæ¯”å¦‚å‰é¢åŒ…æ‹¬ä¸€äº›æ³¨é‡Šã€æˆ–è€…æ˜¯ä¸€äº› JS å¼•æ“æ— æ³•è¯†åˆ«çš„<a href="https://262.ecma-international.org/5.1/#sec-14.1">æŒ‡ä»¤åºè¨€</a>ç­‰ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">function fn() {
  &quot;use bar&quot;;
  &quot;abc&quot;;
  &quot;use strict&quot;; // å› ä¸ºè¿™å®Œå…¨ç¬¦åˆæŒ‡ä»¤åºè¨€ â€” å¤šæŒ‡ä»¤å…±å­˜çš„è¯­æ³•. æ‰€è¢«åº”ç”¨çš„ä»£ç ä»ç„¶ä¼šè¿›å…¥ä¸¥æ ¼æ¨¡å¼ã€‚
}
</code></pre>
<p>ES5 ä¼šæŠŠ <code>&quot;use bar&quot;</code> å’Œ <code>&quot;abc&quot;</code> ä¹Ÿä½œä¸ºæŒ‡ä»¤åºè¨€çš„æŸä¸ªæŒ‡ä»¤å¤„ç†ï¼Œç”±äº JS å¼•æ“ä¸è®¤è¯†è¯¥æŒ‡ä»¤ï¼Œåªè®¤è¯†  <code>&quot;use strict&quot;</code> æŒ‡ä»¤ï¼Œåˆ™åŒæ ·ä¼šè¿›å…¥ä¸¥æ ¼æ¨¡å¼.</p>
<h3>å››ã€ä¸¥æ ¼æ¨¡å¼å¯¹äºè¯­æ³•å’Œè¡Œä¸ºçš„æ”¹å˜</h3>
<p>ä¸¥æ ¼æ¨¡å¼å¯¹ JavaScript çš„è¯­æ³•å’Œè¡Œä¸ºï¼Œéƒ½åšäº†ä¸€äº›æ”¹å˜ã€‚</p>
<h5>1. å…¨å±€å˜é‡æ˜¾å¼å£°æ˜</h5>
<p>åœ¨æ­£å¸¸æ¨¡å¼ä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰å£°æ˜å°±èµ‹å€¼ï¼Œé»˜è®¤æ˜¯å…¨å±€å˜é‡ã€‚ä¸¥æ ¼æ¨¡å¼ç¦æ­¢è¿™ç§ç”¨æ³•ï¼Œå…¨å±€å˜é‡å¿…é¡»æ˜¾å¼å£°æ˜ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

name = &quot;Frankie&quot;; // Uncaught ReferenceError: name is not defined

for (i = 0; i &lt; 2; i++) { // Uncaught ReferenceError: i is not defined
  // ...
}

// ä¸Šè¿°ä»£ç åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œè€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å°±ä¼šæŠ¥é”™ï¼ˆå¼•ç”¨ç±»å‹é”™è¯¯ï¼‰
</code></pre>
<p>å› æ­¤ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹å˜é‡éƒ½å¿…é¡»<strong>å…ˆå£°æ˜å†ä½¿ç”¨</strong>ã€‚æŠ›å¼€ JavaScript è®¾è®¡çš„ä¸åˆç†ã€ç¼ºé™·ã€ç”šè‡³æ˜¯ Bugï¼Œæˆ–è€…æ˜¯å…¶ä»–çœ‹èµ·æ¥å¾ˆåäººç±»çš„ä¸œè¥¿ï¼Œåœ¨äº†è§£å†å²åŸå› å’Œå…¶ä¸­åŸç†ä¹‹åï¼Œä¸ºäº†ä»£ç å¯è¯»æ€§éƒ½ç†åº”å¦‚æ­¤ã€‚</p>
<h5>2. é™æ€ç»‘å®š</h5>
<p>JavaScript è¯­è¨€çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å…è®¸â€œåŠ¨æ€ç»‘å®šâ€ï¼Œå³æŸäº›å±æ€§å’Œæ–¹æ³•åˆ°åº•å±äºå“ªä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç¡®å®šçš„ã€‚</p>
<p>ä¸¥æ ¼æ¨¡å¼å¯¹åŠ¨æ€ç»‘å®šåšäº†ä¸€äº›é™åˆ¶ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œåªå…è®¸é™æ€ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå±æ€§å’Œæ–¹æ³•åˆ°åº•å½’å±å“ªä¸ªå¯¹è±¡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šã€‚è¿™æ ·åšæœ‰åˆ©äºç¼–è¯‘æ•ˆç‡çš„æé«˜ï¼Œä¹Ÿä½¿å¾—ä»£ç æ›´å®¹æ˜“é˜…è¯»ï¼Œæ›´å°‘å‡ºç°æ„å¤–ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢ã€‚</p>
<p>ï¼ˆ1ï¼‰ç¦æ­¢ä½¿ç”¨ with è¯­å¥</p>
<p>å› ä¸º  <code>with</code> è¯­å¥æ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šï¼Œå±æ€§åˆ°åº•å½’å±å“ªä¸ªå¯¹è±¡ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var obj = {
  name: &quot;Frankie&quot;
}

// è¯­æ³•é”™è¯¯ï¼ŒUncaught SyntaxError: Strict mode code may not include a with statement
with (obj) {
  name = &quot;Mandy&quot;;
}
</code></pre>
<p>ï¼ˆ2ï¼‰åˆ›è®¾ eval ä½œç”¨åŸŸ</p>
<p>æ­£å¸¸æ¨¡å¼ä¸‹ï¼ŒJavaScript è¯­è¨€æœ‰ä¸¤ç§å˜é‡ä½œç”¨åŸŸï¼ˆscopeï¼‰ï¼š<strong>å…¨å±€ä½œç”¨åŸŸ</strong>å’Œ<strong>å‡½æ•°ä½œç”¨åŸŸ</strong>ã€‚ä¸¥æ ¼æ¨¡å¼åˆ›è®¾äº†ç¬¬ä¸‰ç§ä½œç”¨åŸŸï¼š<strong>eval ä½œç”¨åŸŸ</strong>ã€‚</p>
<p>æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œ<code>eval</code> è¯­å¥çš„ä½œç”¨åŸŸï¼Œå–å†³äºå®ƒå¤„äºå…¨å±€ä½œç”¨åŸŸï¼Œè¿˜æ˜¯å¤„äºå‡½æ•°ä½œç”¨åŸŸã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>eval</code> è¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªä½œç”¨åŸŸï¼Œä¸å†èƒ½å¤Ÿç”Ÿæˆå…¨å±€å˜é‡äº†ï¼Œå®ƒæ‰€ç”Ÿæˆçš„å˜é‡åªèƒ½ç”¨äº eval å†…éƒ¨ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var name = &quot;Frankie&quot;;
console.log(eval(&quot;var name = 'Mandy'; name&quot;)); // &quot;Mandy&quot;
console.log(name); // &quot;Frankie&quot;
</code></pre>
<h5>3. å¢å¼ºçš„å®‰å…¨æªæ–½</h5>
<p>ï¼ˆ1ï¼‰ç¦æ­¢ this å…³é”®å­—æŒ‡å‘å…¨å±€å¯¹è±¡</p>
<pre><code class="language-js">function fn1() {
  // è¿”å› falseï¼Œå› ä¸º &quot;this&quot; æŒ‡å‘å…¨å±€å¯¹è±¡ 
  return !this;
}

function fn2() {
  &quot;use strict&quot;;
  // è¿”å› trueï¼Œå› ä¸ºä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis çš„å€¼ä¸º undefinedã€‚
  return !this;
}
</code></pre>
<p>å› æ­¤ï¼Œä½¿ç”¨æ„é€ å‡½æ•°æ—¶ï¼Œå¦‚æœå¿˜åŠ  <code>new</code> å…³é”®å­—æ—¶ï¼Œ<code>this</code> ä¸å†æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè€Œæ˜¯æŠ¥é”™ã€‚</p>
<pre><code class="language-js">// æ„é€ å‡½æ•°
function Fn() {
  &quot;use strict&quot;;
  this.name = &quot;Frankie&quot;; // Uncaught TypeError: Cannot set property 'name' of undefined
};

// ç›´æ¥å½“ä½œæ™®é€šå‡½æ•°è°ƒç”¨å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ­¤æ—¶ this ä¸º undefinedã€‚
Fn();
</code></pre>
<p>ï¼ˆ2ï¼‰ç¦æ­¢åœ¨å‡½æ•°å†…éƒ¨éå†è°ƒç”¨æ ˆ</p>
<pre><code class="language-js">function fn() {
  &quot;use strict&quot;;
  fn.arguments; // æŠ¥é”™
  fn.caller; // æŠ¥é”™
  // Uncaught TypeError: 'caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them
}

fn();
</code></pre>
<h5>4. ç¦æ­¢åˆ é™¤å˜é‡</h5>
<p>ä¸¥æ ¼æ¨¡å¼ä¸‹æ— æ³•åˆ é™¤å˜é‡ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var name;
delete name; // è¯­æ³•é”™è¯¯ï¼ŒUncaught SyntaxError: Delete of an unqualified identifier in strict mode.
</code></pre>
<p>åªæœ‰ <code>configurable</code> è®¾ç½®ä¸º <code>true</code> çš„å¯¹è±¡å±æ€§ï¼Œæ‰èƒ½è¢«åˆ é™¤ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var obj = Object.create(null, {
  &quot;name&quot;: {
    value: &quot;Frankie&quot;,
    configurable: true
  }
});

delete obj.name; // åˆ é™¤æˆåŠŸ
</code></pre>
<h5>5. æ˜¾å¼æŠ¥é”™</h5>
<p>æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡çš„åªè¯»å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œä¸ä¼šæŠ¥é”™ï¼Œåªä¼šé»˜é»˜åœ°å¤±è´¥ã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°†æŠ¥é”™ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var obj = {};

Object.defineProperty(obj, &quot;name&quot;, { value: &quot;Frankie&quot;, writable: false });

obj.name = &quot;Mandy&quot;; // æŠ¥é”™ï¼ŒUncaught TypeError: Cannot assign to read only property 'name' of object '#&lt;Object&gt;'
</code></pre>
<p>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¯¹ä¸€ä¸ªä½¿ç”¨ <code>getter</code> æ–¹æ³•è¯»å–çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var obj = {
  get name() {
    return &quot;Frankie&quot;;
  }
};

obj.name = &quot;Mandy&quot;; // æŠ¥é”™ï¼ŒUncaught TypeError: Cannot set property name of #&lt;Object&gt; which has only a getter
</code></pre>
<p>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¯¹ç¦æ­¢æ‰©å±•çš„å¯¹è±¡æ·»åŠ æ–°å±æ€§ï¼Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var obj = {};

Object.preventExtensions(obj);

obj.name = &quot;Frankie&quot;; // æŠ¥é”™ï¼ŒUncaught TypeError: Cannot add property name, object is not extensible
</code></pre>
<p>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ é™¤ä¸€ä¸ªä¸å¯åˆ é™¤çš„å±æ€§ï¼Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

// æŠ¥é”™ï¼ŒUncaught TypeError: Cannot delete property 'prototype' of function Object() { [native code] }
delete Object.prototype;
</code></pre>
<h5>6. é‡åé”™è¯¯</h5>
<p>ä¸¥æ ¼æ¨¡å¼æ–°å¢äº†ä¸€äº›è¯­æ³•é”™è¯¯ã€‚</p>
<p>ï¼ˆ1ï¼‰å¯¹è±¡ä¸èƒ½æœ‰é‡åçš„å±æ€§</p>
<p>åœ¨ Gecko ç‰ˆæœ¬ 34 ä¹‹å‰ï¼Œä¸¥æ ¼æ¨¡å¼è¦æ±‚ä¸€ä¸ªå¯¹è±¡å†…çš„æ‰€æœ‰å±æ€§ååœ¨å¯¹è±¡å†…å¿…é¡»å”¯ä¸€ã€‚æ­£å¸¸æ¨¡å¼ä¸‹é‡åå±æ€§æ˜¯å…è®¸çš„ï¼Œæœ€åä¸€ä¸ªé‡åçš„å±æ€§å†³å®šå…¶å±æ€§å€¼ã€‚å› ä¸ºåªæœ‰æœ€åä¸€ä¸ªå±æ€§èµ·ä½œç”¨ï¼Œå½“ä»£ç è¦å»æ”¹å˜å±æ€§å€¼è€Œä¸æ˜¯ä¿®æ”¹æœ€åä¸€ä¸ªé‡åå±æ€§çš„æ—¶å€™ï¼Œå¤åˆ¶è¿™ä¸ªå¯¹è±¡å°±äº§ç”Ÿä¸€è¿ä¸²çš„ bugã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œé‡åå±æ€§è¢«è®¤ä¸ºæ˜¯è¯­æ³•é”™è¯¯ï¼š</p>
<blockquote>
<p>è¿™ä¸ªé—®é¢˜åœ¨ ECMAScript 6 ä¸­å·²ç»ä¸å¤å­˜åœ¨ï¼ˆ<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1041128">bugÂ 1041128</a>ï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">&quot;use strict&quot;;

// è¯­æ³•é”™è¯¯ï¼šSyntaxError: property name age appears more than once in object literal
var obj = {
  age: 18,
  age: 20
}
</code></pre>
<p>ï¼ˆ2ï¼‰å‡½æ•°ä¸èƒ½æœ‰é‡åçš„å‚æ•°</p>
<p>æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå¦‚æœå‡½æ•°æœ‰å¤šä¸ªé‡åçš„å‚æ•°ï¼Œæœ€åä¸€ä¸ªé‡åå‚æ•°åä¼šæ©ç›–ä¹‹å‰çš„é‡åå‚æ•°ï¼Œä¹‹å‰çš„å‚æ•°ä»ç„¶å¯ä»¥é€šè¿‡ <code>arguments[i]</code> æ¥è®¿é—®ã€‚ç„¶è€Œï¼Œè¿™ç§éšè—æ¯«æ— æ„ä¹‰è€Œä¸”å¯èƒ½æ˜¯æ„æ–™ä¹‹å¤–çš„ (æ¯”å¦‚å®ƒå¯èƒ½æœ¬æ¥æ˜¯æ‰“é”™äº†)ï¼Œæ‰€ä»¥åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹é‡åå‚æ•°è¢«è®¤ä¸ºæ˜¯è¯­æ³•é”™è¯¯ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

// è¯­æ³•é”™è¯¯ï¼šUncaught SyntaxError: Duplicate parameter name not allowed in this context
function fn(x, x, y) {
  return;
}
</code></pre>
<h5>7. ç¦æ­¢å…«è¿›åˆ¶è¡¨ç¤ºæ³•</h5>
<p>ECMAScript å¹¶ä¸åŒ…å«å…«è¿›åˆ¶è¯­æ³•ï¼Œä½†æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒè¿™ç§ä»¥é›¶ï¼ˆ<code>0</code>ï¼‰å¼€å¤´çš„å…«è¿›åˆ¶è¯­æ³•ï¼š<code>0100 === 64</code>ï¼Œè¿˜æœ‰ <code>&quot;\045&quot; === &quot;%&quot;</code>ã€‚åœ¨ ECMAScript 6 ä¸­æ”¯æŒä¸ºä¸€ä¸ªæ•°å­—åŠ  <code>&quot;0o&quot;</code> çš„å‰ç¼€æ¥è¡¨ç¤ºå…«è¿›åˆ¶æ•°.</p>
<pre><code class="language-js">&quot;use strict&quot;;

var n = 0100; // è¯­æ³•é”™è¯¯ï¼šUncaught SyntaxError: Octal literals are not allowed in strict mode.
</code></pre>
<pre><code class="language-js">var n = 0o100; // ES6 å…«è¿›åˆ¶æ•°è¡¨ç¤ºæ³•
</code></pre>
<h5>8. arguments å¯¹è±¡çš„é™åˆ¶</h5>
<p>arguments æ˜¯å‡½æ•°çš„å‚æ•°å¯¹è±¡ï¼Œä¸¥æ ¼æ¨¡å¼å¯¹å®ƒçš„ä½¿ç”¨åšäº†é™åˆ¶ã€‚</p>
<p>ï¼ˆ1ï¼‰ä¸å…è®¸å¯¹argumentsèµ‹å€¼</p>
<pre><code class="language-js">&quot;use strict&quot;;

arguments++; // è¯­æ³•é”™è¯¯ï¼šUncaught SyntaxError: Unexpected eval or arguments in strict mode

var obj = { set p(arguments) { } }; // è¯­æ³•é”™è¯¯ï¼ŒåŒä¸Š

try { } catch (arguments) { } // è¯­æ³•é”™è¯¯ï¼ŒåŒä¸Š

function arguments() { } // è¯­æ³•é”™è¯¯ï¼ŒåŒä¸Š

var fn = new Function(&quot;arguments&quot;, &quot;'use strict'; return 17;&quot;); // è¯­æ³•é”™è¯¯ï¼ŒåŒä¸Š
</code></pre>
<p>ï¼ˆ2ï¼‰argumentsä¸å†è¿½è¸ªå‚æ•°çš„å˜åŒ–</p>
<pre><code class="language-js">function fn1(x) {
  x = 2;
  return [x, arguments[0]];
}

fn1(1); // æ­£å¸¸æ¨¡å¼ä¸º [2, 2]

function fn2(x) {
  &quot;use strict&quot;;
  x = 2;
  return [x, arguments[0]];
}

fn2(1); // ä¸¥æ ¼æ¨¡å¼ä¸º [2, 1]
</code></pre>
<p>ï¼ˆ3ï¼‰ç¦æ­¢ä½¿ç”¨ arguments.callee</p>
<p>è¿™æ„å‘³ç€ï¼Œä½ æ— æ³•åœ¨åŒ¿åå‡½æ•°å†…éƒ¨è°ƒç”¨è‡ªèº«äº†ã€‚</p>
<pre><code class="language-js">&quot;use strict&quot;;

var fn = function () { return arguments.callee; };

fn(); // æŠ¥é”™ï¼šUncaught TypeError: 'caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them
</code></pre>
<h5>9. å‡½æ•°å¿…é¡»å£°æ˜åœ¨é¡¶å±‚</h5>
<p>å°†æ¥ JavaScript çš„æ–°ç‰ˆæœ¬ä¼šå¼•å…¥&quot;å—çº§ä½œç”¨åŸŸ&quot;ã€‚ä¸ºäº†ä¸æ–°ç‰ˆæœ¬æ¥è½¨ï¼Œä¸¥æ ¼æ¨¡å¼åªå…è®¸åœ¨å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°ä½œç”¨åŸŸçš„é¡¶å±‚å£°æ˜å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸åœ¨éå‡½æ•°çš„ä»£ç å—å†…å£°æ˜å‡½æ•°ã€‚</p>
<p><a href="http://whereswalden.com/2011/01/24/new-es5-strict-mode-requirement-function-statements-not-at-top-level-of-a-program-or-function-are-prohibited/">ä¸¥æ ¼æ¨¡å¼ç¦æ­¢äº†ä¸åœ¨è„šæœ¬æˆ–è€…å‡½æ•°å±‚é¢ä¸Šçš„å‡½æ•°å£°æ˜</a>ã€‚åœ¨æµè§ˆå™¨çš„æ™®é€šä»£ç ä¸­ï¼Œåœ¨â€œæ‰€æœ‰åœ°æ–¹â€çš„å‡½æ•°å£°æ˜éƒ½æ˜¯åˆæ³•çš„ã€‚è¿™å¹¶ä¸åœ¨ ES5 è§„èŒƒä¸­ï¼ˆç”šè‡³æ˜¯ ES3ï¼‰ï¼è¿™æ˜¯ä¸€ç§é’ˆå¯¹ä¸åŒæµè§ˆå™¨ä¸­ä¸åŒè¯­ä¹‰çš„ä¸€ç§å»¶ä¼¸ã€‚æœªæ¥çš„ ECMAScript ç‰ˆæœ¬å¾ˆæœ‰å¸Œæœ›åˆ¶å®šä¸€ä¸ªæ–°çš„ï¼Œé’ˆå¯¹ä¸åœ¨è„šæœ¬æˆ–è€…å‡½æ•°å±‚é¢è¿›è¡Œå‡½æ•°å£°æ˜çš„è¯­æ³•ã€‚<a href="http://wiki.ecmascript.org/doku.php?id=conventions:no_non_standard_strict_decls">åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ç¦æ­¢è¿™æ ·çš„å‡½æ•°å£°æ˜</a>å¯¹äºå°†æ¥ ECMAScript ç‰ˆæœ¬çš„æ¨å‡ºæ‰«æ¸…äº†éšœç¢ï¼š</p>
<pre><code class="language-js">&quot;use strict&quot;;
if (true) {
  function f() { } // !!! è¯­æ³•é”™è¯¯ï¼ŒSyntaxError: in strict mode code, functions may be declared only at top level or immediately within another function
  f();
}

for (var i = 0; i &lt; 5; i++) {
  function f2() { } // !!! è¯­æ³•é”™è¯¯ï¼ŒSyntaxError: in strict mode code, functions may be declared only at top level or immediately within another function
  f2();
}

function baz() { // åˆæ³•
  function eit() { } // åŒæ ·åˆæ³•
}
</code></pre>
<blockquote>
<p>å…³äºè¿™å—å†…å®¹ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« æˆ–è®¨è®ºï¼š</p>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html#comment-268200">franky's comment</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode#%E4%B8%BA%E6%9C%AA%E6%9D%A5%E7%9A%84ecmascript%E7%89%88%E6%9C%AC%E9%93%BA%E5%B9%B3%E9%81%93%E8%B7%AF">Paving the way for future ECMAScript versions</a></li>
<li><a href="http://whereswalden.com/2011/01/24/new-es5-strict-mode-requirement-function-statements-not-at-top-level-of-a-program-or-function-are-prohibited/">New ES5 strict mode requirement: function statements not at top level of a program or function are prohibited</a></li>
</ul>
</blockquote>
<h5>10. ä¿ç•™å­—</h5>
<p>ä¸ºäº†å‘å°†æ¥ JavaScript çš„æ–°ç‰ˆæœ¬è¿‡æ¸¡ï¼Œä¸¥æ ¼æ¨¡å¼æ–°å¢äº†ä¸€äº›ä¿ç•™å­—ï¼š<code>implements</code>ã€<code>interface</code>ã€<code>let</code>ã€<code>package</code>ã€<code>private</code>ã€<code>protected</code>ã€<code>public</code>ã€<code>static</code>ã€<code>yield</code>ã€‚ä½¿ç”¨è¿™äº›è¯ä½œä¸ºå˜é‡åå°†ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">function package(protected) { // è¯­æ³•é”™è¯¯ï¼ŒUncaught SyntaxError: Unexpected strict mode reserved word
  &quot;use strict&quot;;
  var implements; // è¯­æ³•é”™è¯¯
}
</code></pre>
<p>æ­¤å¤–ï¼ŒECMAScript 5 æœ¬èº«è¿˜è§„å®šäº†å¦ä¸€äº›ä¿ç•™å­—ï¼ˆ<code>class</code>ã€<code>enum</code>ã€<code>export</code>ã€<code>extends</code>ã€<code>import</code>ã€<code>super</code>ï¼‰ï¼Œä»¥åŠå„å¤§æµè§ˆå™¨è‡ªè¡Œå¢åŠ çš„ <code>const</code> ä¿ç•™å­—ï¼Œä¹Ÿæ˜¯ä¸èƒ½ä½œä¸ºå˜é‡åçš„ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<!--
<hr>

```
// æµ‹è¯•æ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼çš„å‡½æ•°ã€‚
// åŸç†æ˜¯ï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å†…thiså¹¶ä¸ä¼šæŒ‡å‘window,è€Œæ˜¯undefined.
// æ­£å¸¸æƒ…å†µä¸‹å¼€å¯ä¸¥æ ¼ï¼Œåªéœ€åœ¨jså¤´éƒ¨å£°æ˜ 'use strict'
var hasStrictMode = function() {
  "use strict";
  return this === undefined
}
```

-->
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode">Strict Mode MDN</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html">JavaScript ä¸¥æ ¼æ¨¡å¼è¯¦è§£ï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/231</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/231</guid>
            <pubDate>Sun, 26 Feb 2023 10:56:20 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1734115011967.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionsï¼‰æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²ä¸­å­—ç¬¦ç»„]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1734115011967.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionsï¼‰æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²ä¸­å­—ç¬¦ç»„åˆçš„æ¨¡å¼ã€‚åœ¨ JavaScript ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯¹è±¡ã€‚è¿™äº›æ¨¡å¼è¢«ç”¨äºÂ <code>RegExp</code>Â çš„Â <code>exec</code>Â å’ŒÂ <code>test</code> æ–¹æ³•, ä»¥åŠÂ <code>String</code>Â çš„Â <code>match</code>ã€<code>matchAll</code>ã€<code>replace</code>ã€<code>search</code>Â å’ŒÂ <code>split</code>Â æ–¹æ³•ã€‚</p>
<p>åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<pre><code>// æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡
const re = /ab+c/

// ä½¿ç”¨ RegExp å¯¹è±¡çš„æ„é€ å‡½æ•°
const re = new RegExp(&quot;ab+c&quot;)
</code></pre>
<h2>æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦</h2>
<ul>
<li><code>\</code> ä¸ºè½¬ä¹‰ï¼Œé€šå¸¸åœ¨ <code>\</code> åé¢çš„å­—ç¬¦ä¸æŒ‰åŸæœ¬çš„æ„ä¹‰è§£é‡Šã€‚å¦‚ <code>/b/</code> åŒ¹é…å­—ç¬¦ <code>&quot;b&quot;</code>ï¼Œå½“ b å‰é¢æ·»åŠ åæ–œæ  <code>/\b/</code>ï¼Œè½¬ä¹‰ä¸ºåŒ¹é…ä¸€ä¸ªå•è¯çš„è¾¹ç•Œã€‚ä¹Ÿå¯ä»¥å¯¹æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½å­—ç¬¦çš„è¿˜åŸï¼Œ<code>/a*/</code> å°†åŒ¹é… <code>&quot;a&quot;</code>ã€<code>&quot;aa&quot;</code>ã€<code>&quot;aaa&quot;</code>ç­‰å­—ç¬¦ï¼ˆ<code>*</code> åŒ¹é…å®ƒå‰é¢å…ƒå­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ï¼Œï¼‰ï¼ŒåŠ äº†åæ–œæ å <code>/a\*/</code> å°†åªåŒ¹é… <code>&quot;a*&quot;</code>ã€‚</li>
<li><code>^</code> åŒ¹é…ä¸€ä¸ªè¾“å…¥æˆ–ä¸€è¡Œçš„å¼€å¤´ï¼Œ<code>/^a/</code> åŒ¹é… <code>&quot;an A&quot;</code> å­—ç¬¦ï¼Œè€Œä¸åŒ¹é… <code>&quot;An a&quot;</code> å­—ç¬¦ã€‚</li>
<li><code>$</code> åŒ¹é…ä¸€ä¸ªè¾“å…¥æˆ–ä¸€è¡Œçš„ç»“å°¾ï¼Œ<code>/a$/</code> åŒ¹é… <code>&quot;An a&quot;</code> å­—ç¬¦ï¼Œè€Œä¸åŒ¹é… <code>&quot;an A&quot;</code> å­—ç¬¦ã€‚</li>
<li><code>*</code> åŒ¹é…å‰é¢å…ƒå­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ï¼Œ<code>/ba*/</code> åŒ¹é… <code>&quot;b&quot;</code>ã€<code>&quot;ba&quot;</code>ã€<code>&quot;baa&quot;</code>ã€<code>&quot;baaa&quot;</code> ç­‰å­—ç¬¦ã€‚</li>
<li><code>+</code> åŒ¹é…å‰é¢å…ƒå­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡ï¼Œ<code>/ba+/</code> åŒ¹é… <code>&quot;ba&quot;</code>ã€<code>&quot;baa&quot;</code>ã€<code>&quot;baaa&quot;</code> ç­‰å­—ç¬¦ã€‚</li>
<li><code>?</code> åŒ¹é…å‰é¢å…ƒå…ƒå­—ç¬¦ 0 æ¬¡æˆ– 1 æ¬¡ï¼Œ<code>/ba?/</code> åŒ¹é… <code>&quot;b&quot;</code>ã€<code>&quot;ba&quot;</code> å­—ç¬¦ã€‚</li>
<li><code>(x)</code> åŒ¹é… <code>x</code>ï¼Œä¿å­˜ <code>x</code> åœ¨ <code>$1...$9</code> çš„å˜é‡ä¸­ã€‚</li>
<li><code>x|y</code> åŒ¹é… <code>x</code> æˆ– <code>y</code>ã€‚</li>
<li><code>{n}</code> ç²¾ç¡®åŒ¹é… n æ¬¡ã€‚</li>
<li><code>{n,}</code> ç²¾ç¡®åŒ¹é… n æ¬¡åŠä»¥ä¸Šã€‚</li>
<li><code>{m,n}</code> ç²¾ç¡®åŒ¹é… <code>m ~ n</code> æ¬¡ã€‚</li>
<li><code>[xyz]</code> å­—ç¬¦é›†ï¼ŒåŒ¹é…è¿™ä¸ªé›†åˆä¸­çš„ä»»ä¸€ä¸€ä¸ªå­—ç¬¦ï¼ˆæˆ–å…ƒå­—ç¬¦ï¼‰ã€‚</li>
<li><code>[^xyz]</code> ä¸åŒ¹é…è¿™ä¸ªé›†åˆä¸­çš„ä»»ä¸€ä¸€ä¸ªå­—ç¬¦ã€‚</li>
<li><code>[\b]</code> åŒ¹é…ä¸€ä¸ªé€€æ ¼ç¬¦ã€‚</li>
<li><code>\b</code> åŒ¹é…ä¸€ä¸ªå•è¯çš„è¾¹ç•Œã€‚</li>
<li><code>\B</code> åŒ¹é…ä¸€ä¸ªå•è¯çš„éè¾¹ç•Œã€‚</li>
<li><code>\cX</code> è¿™é‡Œçš„ <code>X</code> æ˜¯ä¸€ä¸ªæ§åˆ¶ç¬¦ï¼Œ<code>\cM/</code> åŒ¹é… <code>Ctrl-M</code>ã€‚</li>
<li><code>\d</code> åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ï¼Œ<code>/\d/</code> ç›¸å½“äº <code>/[0-9]/</code>ã€‚</li>
<li><code>\D</code> åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ï¼Œ<code>/\D/</code> ç›¸å½“äº <code>/[^0-9]/</code>ã€‚</li>
<li><code>\n</code> åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚</li>
<li><code>\r</code> åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚</li>
<li><code>\s</code> åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ <code>\n</code>ã€<code>\r</code>ã€<code>\f</code>ã€<code>\t</code>ã€<code>\v</code> ç­‰ï¼Œç›¸å½“äº <code>/[\n\r\f\t\v]/</code>ã€‚</li>
<li><code>\S</code> åŒ¹é…ä¸€ä¸ªéç©ºç™½å­—ç¬¦ï¼Œç›¸å½“äº <code>/[^\n\r\f\t\v]/</code>ã€‚</li>
<li><code>\t</code> åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚</li>
<li><code>\v</code> åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚</li>
<li><code>\w</code> åŒ¹é…ä¸€ä¸ªå¯ä»¥ç»„æˆå•è¯çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬å­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ï¼‰ã€‚å¦‚ <code>[\w]</code> åŒ¹é… <code>&quot;$5.28&quot;</code> ä¸­çš„ <code>5</code>ï¼Œç›¸å½“äº <code>[a-zA-Z0-9]</code>ã€‚</li>
<li><code>\W</code> åŒ¹é…ä¸€ä¸ªä¸å¯ä»¥ç»„æˆå•è¯çš„å­—ç¬¦ï¼Œå¦‚ <code>[\W]</code> åŒ¹é… <code>&quot;$5.28&quot;</code> ä¸­çš„ <code>$</code>ï¼Œç›¸å½“äº <code>[^a-zA-Z0-9]</code>ã€‚</li>
</ul>
<h2>ç›´æ¥é‡å­—ç¬¦</h2>
<p>å¦‚æœæƒ³åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ç‰¹æ®Šçš„æ ‡ç‚¹ç¬¦å·ï¼Œå¿…é¡»åœ¨ä»–ä»¬ä¹‹å‰åŠ ä¸Šä¸€ä¸ª <code>\</code> è¿›è¡Œè½¬ä¹‰ã€‚</p>
<ul>
<li><code>\/</code> è¡¨ç¤ºä¸€ä¸ª <code>/</code> ç›´æ¥é‡ã€‚</li>
<li><code>\\</code> è¡¨ç¤ºä¸€ä¸ª <code>\</code> ç›´æ¥é‡ã€‚</li>
<li><code>\.</code> è¡¨ç¤ºä¸€ä¸ª <code>.</code> ç›´æ¥é‡ã€‚</li>
<li><code>\*</code> è¡¨ç¤ºä¸€ä¸ª <code>*</code> ç›´æ¥é‡ã€‚</li>
<li><code>+</code> è¡¨ç¤ºä¸€ä¸ª <code>+</code> ç›´æ¥é‡ã€‚</li>
<li><code>?</code> è¡¨ç¤ºä¸€ä¸ª <code>?</code> ç›´æ¥é‡ã€‚</li>
<li><code>\|</code> è¡¨ç¤ºä¸€ä¸ª <code>|</code> ç›´æ¥é‡ã€‚</li>
<li><code>\(</code> è¡¨ç¤ºä¸€ä¸ª <code>(</code> ç›´æ¥é‡ã€‚</li>
<li><code>\)</code> è¡¨ç¤ºä¸€ä¸ª <code>)</code> ç›´æ¥é‡ã€‚</li>
<li><code>\[</code> è¡¨ç¤ºä¸€ä¸ª <code>[</code> ç›´æ¥é‡ã€‚</li>
<li><code>\]</code> è¡¨ç¤ºä¸€ä¸ª <code>]</code> ç›´æ¥é‡ã€‚</li>
<li><code>\{</code> è¡¨ç¤ºä¸€ä¸ª <code>{</code> ç›´æ¥é‡ã€‚</li>
<li><code>\}</code> è¡¨ç¤ºä¸€ä¸ª <code>}</code> ç›´æ¥é‡ã€‚</li>
</ul>
<h2>å­—ç¬¦ç±»</h2>
<p>å°†å•ç‹¬çš„ç›´æ¥å¤æ”¾è¿›ä¸­æ‹¬å·ï¼ˆ<code>[...]</code>ï¼‰å†…å°±å¯ä»¥ç»„åˆæˆå­—ç¬¦ç±»ã€‚ä¸€ä¸ªå­—ç¬¦ç±»å’Œå®ƒæ‰€åŒ…å«çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦éƒ½åŒ¹é…ã€‚æ­£å¼è¡¨è¾¾å¼ <code>/[abc]/</code> å’Œå­—æ¯ <code>&quot;a&quot;</code>ã€<code>&quot;b&quot;</code>ã€<code>&quot;c&quot;</code> ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½åŒ¹é…ï¼Œå¦å¤–è¿˜å¯ä»¥å®šä¹‰å¦å®šå­—ç¬¦ç±»ï¼Œè¿™äº›ç±»åŒ¹é…çš„æ˜¯é™¤é‚£äº›åŒ…å«åœ¨ä¸­æ‹¬å·ä¹‹å†…çš„å­—ç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦ã€‚å®šä¹‰å¦å®šå­—ç¬¦å°–ï¼ˆ<code>^</code>ï¼‰æ—¶ï¼Œè¦å°†ä¸€ä¸ª <code>^</code> ç¬¦å·ä½œä¸ºä»å·¦ä¸­æ‹¬å·ç®—èµ·çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<p>ç”±äºæŸäº›å­—ç¬¦ç±»éå¸¸å¸¸ç”¨ï¼Œæ‰€ä»¥ JavaScript çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•åŒ…å«ä¸€äº›ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰åºåˆ—æ¥è¡¨ç¤ºè¿™äº›å¸¸ç”¨çš„ç±»ã€‚æ¯”å¦‚ <code>\s</code> åŒ¹é…çš„æ˜¯ç©ºç™½ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ç¬¦ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ç©ºç™½ç¬¦ï¼‰ï¼Œ<code>\S</code> åŒ¹é…çš„æ˜¯é™¤ç©ºç™½ç¬¦ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ã€‚</p>
<ul>
<li><code>[...]</code> åŒ¹é…ä½äºæ‹¬å·ä¹‹å†…çš„ä»»æ„å­—ç¬¦ã€‚</li>
<li><code>[^...]</code> åŒ¹é…ä¸åœ¨æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ã€‚</li>
<li><code>.</code> åŒ¹é…é™¤æ¢è¡Œç¬¦ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ï¼Œç›¸å½“äº <code>[^\n]</code>ã€‚</li>
<li><code>\w</code> åŒ¹é…ä»»ä½•å•å­—å­—ç¬¦ï¼Œç›¸å½“äº <code>[a-zA-Z0-9_]</code>ã€‚</li>
<li><code>\W</code> åŒ¹é…ä»»ä½•éå•å­—å­—ç¬¦ï¼Œç›¸å½“äº <code>[^a-zA-Z0-9_]</code>ã€‚</li>
<li><code>\s</code> åŒ¹é…ä»»æ„ç©ºç™½ç¬¦ï¼Œç›¸å½“äº <code>/[\n\r\f\t\v]/</code>ã€‚</li>
<li><code>\S</code> åŒ¹é…ä»»æ„éç©ºç™½ç¬¦ï¼Œç›¸å½“äº <code>/[^\n\r\f\t\v]/</code>ã€‚</li>
<li><code>\d</code> åŒ¹é…ä»»æ„æ•°å­—ï¼Œç›¸å½“äº <code>[0-9]</code>ã€‚</li>
<li><code>\D</code> åŒ¹é…é™¤æ•°å­—ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ï¼Œç›¸å½“äº <code>[^0-9]</code>ã€‚</li>
<li><code>\b</code> åŒ¹é…ä¸€ä¸ªé€€æ ¼ç›´æ¥é‡ï¼ˆç‰¹ä¾‹ï¼‰ã€‚</li>
</ul>
<h2>å¤åˆ¶</h2>
<p>ç”¨ä»¥ä¸Šçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼Œå¯ä»¥æŠŠä¸¤ä½æ•°æè¿°æˆ <code>/\d\d/</code>ï¼ŒæŠŠå››ä½æ•°æè¿°æˆ <code>/\d\d\d\d/</code>ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç”¨æ¥æè¿°å…·æœ‰ä»»æ„å¤šä½æ•°çš„æ•°å­—æˆ–è€…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”±ä¸‰ä¸ªå­—ç¬¦ä»¥åŠè·Ÿéšåœ¨å­—æ¯åçš„ä¸€ä½æ•°å­—æ„æˆã€‚è¿™äº›å¤æ‚çš„æ¨¡å¼ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•æŒ‡å®šäº†æ”¹è¡¨è¾¾å¼ä¸­æ¯ä¸ªå…ƒç´ è¦é‡å¤å‡ºç°çš„æ¬¡æ•°ã€‚</p>
<p>æŒ‡å®šå¤åˆ¶çš„å­—ç¬¦æ€»æ˜¯å‡ºç°åœ¨å®ƒä»¬æ‰€ä½œç”¨çš„æ¨¡å¼åé¢ã€‚ç”±äºæŸç§å¤åˆ¶ç±»å‹ç›¸å¯¹å¸¸ç”¨ã€‚æ‰€ä»¥æœ‰ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ä¸“é—¨ç”¨äºè¡¨ç¤ºå®ƒä»¬ã€‚æ¯”å¦‚ <code>+</code> åŒ¹é…çš„å°±æ˜¯å¤åˆ¶å‰ä¸€æ¨¡å¼ä¸€æ¬¡æˆ–å¤šæ¬¡çš„æ¨¡å¼ä¸‹ã€‚</p>
<p>å…ˆçœ‹å†™ä¾‹å­ï¼š</p>
<ul>
<li><code>/\d{2,4}/</code> è¡¨ç¤ºåŒ¹é… 2 ~ 4 ä¸ªçš„æ•°å­—å­—ç¬¦ã€‚</li>
<li><code>/\w{3}\d?/</code> è¡¨ç¤ºåŒ¹é…ä¸‰ä¸ªå•å­—å­—ç¬¦å’Œä¸€ä¸ªä»»æ„çš„æ•°å­—ã€‚</li>
<li><code>\s+java\s+</code> è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸² <code>&quot;java&quot;</code>ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ä¸²å‰åå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ã€‚</li>
<li><code>/[^&quot;]*/</code> è¡¨ç¤ºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªéå¼•å·å­—ç¬¦ã€‚</li>
</ul>
<p>å¤åˆ¶å­—ç¬¦çš„å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>{m,n}</code> åŒ¹é…å‰ä¸€é¡¹è‡³å°‘ m æ¬¡ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡ n æ¬¡ã€‚</li>
<li><code>{n,}</code> åŒ¹é…å‰ä¸€é¡¹ n æ¬¡åŠä»¥ä¸Šã€‚</li>
<li><code>{n}</code> åŒ¹é…å‰ä¸€é¡¹æ°å¥½ n æ¬¡ã€‚</li>
<li><code>?</code> åŒ¹é…å‰ä¸€é¡¹ 0 æ¬¡æˆ– 1 æ¬¡ï¼Œå°±æ˜¯è¯´å‰ä¸€é¡¹æ˜¯å¯é€‰çš„ï¼Œç›¸å½“äº <code>{0,1}</code>ã€‚</li>
<li><code>+</code> åŒ¹é…å‰ä¸€é¡¹ 1 æ¬¡æˆ–å¤šæ¬¡ï¼Œç›¸å½“äº <code>{1,}</code>ã€‚</li>
<li><code>*</code> åŒ¹é…å‰ä¸€é¡¹ 0 æ¬¡æˆ–å¤šæ¬¡ï¼Œç›¸å½“äº <code>{0,}</code>ã€‚</li>
</ul>
<h2>é€‰æ‹©ã€åˆ†ç»„ã€å¼•ç”¨</h2>
<p>æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•è¿˜åŒ…æ‹¬æŒ‡å®šé€‰æ‹©é¡¹ï¼Œå¯¹å­è¡¨è¾¾å¼åˆ†ç»„å’Œå¼•ç”¨å‰ä¸€å­è¡¨è¾¾å¼çš„ç‰¹æ®Šå­—ç¬¦ã€‚å­—ç¬¦ <code>|</code> ç”¨äºåˆ†éš”ä¾›é€‰æ‹©çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>/ab|cd|ef/</code> åŒ¹é…çš„æ˜¯ <code>&quot;ab&quot;</code> æˆ–è€…æ˜¯ <code>&quot;cd&quot;</code> åˆæˆ–è€…æ˜¯ <code>&quot;ef&quot;</code> å­—ç¬¦ä¸²ã€‚å†æ¯”å¦‚ï¼š<code>/\d{3}|[a-z]{4}/</code> åŒ¹é…çš„æ˜¯è¦ä¹ˆæ˜¯ä¸€ä¸ªä¸‰ä½æ•°å­—ï¼Œè¦ä¹ˆæ˜¯å››ä¸ªå°å†™å­—æ¯ã€‚</p>
<p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæ‹¬å·ï¼ˆ<code>(...)</code>ï¼‰å…·æœ‰å‡ ç§ä½œç”¨ï¼š</p>
<ol>
<li>
<p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æŠŠå•ç‹¬çš„é¡¹ç›®åˆ†ç»„æˆå­è¡¨è¾¾å¼ï¼Œä»¥ä¾¿å¯ä»¥åƒå¤„ç†ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒé‚£ç§ç”¨ <code>*</code>ã€<code>+</code> æˆ– <code>?</code> æ¥å¤„ç†é‚£äº›é¡¹ç›®ã€‚ä¾‹å¦‚ï¼š<code>/java(script)?/</code> åŒ¹é…çš„æ˜¯å­—ç¬¦ä¸² <code>&quot;java&quot;</code>ï¼Œå…¶åçš„æ—¢å¯ä»¥æœ‰ <code>&quot;script&quot;</code>ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚å†æ¯”å¦‚ï¼Œ<code>/(ab|cd)+|ef/</code> åŒ¹é…çš„æ—¢å¯ä»¥æ˜¯å­—ç¬¦ä¸² <code>&quot;ef&quot;</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸² <code>&quot;ab&quot;</code> æˆ–è€… <code>&quot;cd&quot;</code> çš„ä¸€æ¬¡æˆ–å¤šæ¬¡é‡å¤ã€‚</p>
</li>
<li>
<p>æ‹¬å·çš„ç¬¬äºŒä¸ªç”¨é€”æ˜¯ï¼Œåœ¨å®Œæ•´çš„æ¨¡å¼ä¸­å®šä¹‰å­æ¨¡å¼ã€‚å½“ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆåŠŸåœ°å’Œç›®æ ‡å­—ç¬¦ä¸²ç›¸åŒ¹é…æ˜¯ï¼Œå¯ä»¥ä»ç›®æ ‡ä¸²ä¸­æŠ½å‡ºå’Œæ‹¬å·ä¸­çš„å­æ¨¡å¼ç›¸åŒ¹é…çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå‡å®šæˆ‘ä»¬æ­£åœ¨æ£€ç´¢çš„æ¨¡å¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯åé¢è·Ÿéšä¸€ä½æˆ–å¤šä½æ•°ç»„ï¼Œä½ ä»¬æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼ <code>/[a-z]+\d+/</code>ã€‚ä½†æ˜¯ç”±äºå‡å®šæˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„æ˜¯æ¯ä¸ªåŒ¹é…å°¾éƒ¨çš„æ•°å­—ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†æ¨¡å¼çš„æ•°å­—éƒ¨åˆ†æ”¾åœ¨æ‹¬å·ä¸­ <code>/[a-z]+(\d+)/</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æ‰€æ£€ç´¢åˆ°çš„ä»»ä½•åŒ¹é…ä¸­æŠ½å–æ•°å­—äº†ï¼Œä¹‹åæˆ‘ä»¬ä¼šå¯¹æ­¤è¿›è¡Œè§£æçš„ã€‚</p>
</li>
<li>
<p>ä»£æ‹¬å·çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œå…è®¸æˆ‘ä»¬åœ¨åŒä¸€æ­£åˆ™è¡¨è¾¾å¼çš„åé¢å¼•ç”¨å‰é¢çš„å­è¡¨è¾¾å¼ã€‚è¿™æ˜¯é€šè¿‡åœ¨å­—ç¬¦ä¸² <code>\</code> ååŠ ä¸€ä½æˆ–å¤šä½æ•°å­—æ¥å®ç°çš„ã€‚æ•°å­—æŒ‡çš„æ˜¯ä»£æ‹¬å·çš„å­è¡¨è¾¾å¼åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼š<code>\1</code> å¼•ç”¨çš„çš„æ˜¯ç¬¬ä¸€ä¸ªä»£æ‹¬å·çš„å­è¡¨è¾¾å¼ï¼Œ<code>\3</code> å¼•ç”¨çš„æ˜¯ç¬¬ä¸‰ä¸ªä»£æ‹¬å·çš„å­è¡¨è¾¾å¼ã€‚æ³¨æ„ï¼Œç”±äºå­è¡¨è¾¾å¼å¯ä»¥åµŒå¥—åœ¨å…¶ä»–å­è¡¨è¾¾å¼ä¸­ï¼Œæ‰€ä»¥å®ƒçš„ä½ç½®æ˜¯è¢«è®¡æ•°çš„å·¦æ‹¬å·çš„ä½ç½®ã€‚</p>
</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼è¢«æŒ‡å®šä¸º <code>\2</code>ï¼š<code>/([Jj]ava[Ss]cript)\sis\s(fun\w*)/</code>ï¼Œå¯¹æ­£åˆ™è¡¨è¾¾å¼ä¸­å‰ä¸€å­è¡¨è¾¾å¼çš„å¼•ç”¨æ‰€æŒ‡å®šçš„å¹¶ä¸æ˜¯é‚£ä¸ªå­è¡¨è¾¾å¼ï¼Œè€Œæ˜¯ä¸é‚£ä¸ªæ¨¡å¼ç›¸åŒ¹é…çš„æ–‡æœ¬ã€‚è¿™æ ·ï¼Œå¼•ç”¨å°±ä¸åªæ˜¯å¸®åŠ©ä½ è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼çš„é‡å¤éƒ¨åˆ†çš„å¿«æ·æ–¹å¼äº†ï¼Œå®ƒè¿˜å®æ–½äº†ä¸€æ¡è§„çº¦ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å„ä¸ªåˆ†ç¦»çš„éƒ¨åˆ†åŒ…å«çš„æ˜¯å®Œå…¨ç›¸åŒçš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼š<code>/['&quot;][^'&quot;]['&quot;]/</code> åŒ¹é…çš„å°±æ˜¯ä½äºå•å¼•å·æˆ–è€…åŒå¼•å·ä¹‹å†…çš„æ‰€æœ‰å­—ç¬¦ã€‚ä½†æ˜¯å®ƒè¦æ±‚å¼€å§‹å’Œç»“æŸçš„å¼•å·åŒ¹é…ã€‚ï¼ˆä¾‹å¦‚ä¸¤ä¸ªéƒ½æ˜¯åŒå¼•å·æˆ–è€…éƒ½æ˜¯ä½†å¼•å·ï¼‰
å¦‚æœè¦æ±‚å¼€å§‹å’Œç»“æŸçš„å¼•å·åŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å¼•ç”¨ï¼š<code>/(['&quot;])[^'&quot;]*\1/</code>ï¼Œ<code>\1</code> åŒ¹é…çš„æ˜¯ç¬¬ä¸€ä¸ªä»£æ‹¬å·çš„å­è¡¨è¾¾å¼æ‰€åŒ¹é…çš„æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒå®æ–½äº†ä¸€ç§è§„çº¦ï¼Œé‚£å°±æ˜¯å¼€å§‹çš„å¼•å·å¿…é¡»å’Œç»“æŸçš„å¼•å·ç›¸åŒ¹é…ã€‚æ³¨æ„ï¼Œå¦‚æœåæ–œæ åè·Ÿéšçš„æ•°å­—æ¯”ä»£æ‹¬å·çš„å­è¡¨è¾¾å¼æ•°å¤šï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«è§£æä¸ºä¸€ä¸ªåè¿›åˆ¶çš„è½¬ä¹‰åºåˆ—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚ä½ å¯ä»¥åšæŒä½¿ç”¨å®Œæ•´çš„ä¸‰ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºè½¬ä¹‰åºåˆ—ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ··æ·†äº†ã€‚ä¾‹å¦‚ <code>\044</code>ï¼Œè€Œä¸æ˜¯ <code>\44</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„é€‰æ‹©ã€åˆ†ç»„å’Œå¼•ç”¨å­—ç¬¦ï¼š</p>
<ul>
<li><code>|</code> é€‰æ‹©ï¼šåŒ¹é…çš„è¦ä¹ˆæ˜¯è¯¥ç¬¦å·å·¦è¾¹çš„å­è¡¨è¾¾å¼ï¼Œè¦ä¹ˆæ˜¯å®ƒå³è¾¹çš„å­è¡¨è¾¾å¼ã€‚</li>
<li><code>(...)</code> åˆ†ç»„ï¼šå°†å‡ ä¸ªé¡¹ç›®åˆ†ä¸ºä¸€ä¸ªå•å…ƒï¼Œè¿™ä¸ªå•å…ƒå¯ç”± <code>*</code>ã€<code>+</code>ã€<code>?</code> å’Œ <code>|</code> ç­‰ç¬¦å·ä½¿ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥è®°ä½å’Œè¿™ä¸ªç»„åŒ¹é…çš„å­—ç¬¦ä»¥ä¾›æ­¤åå¼•ç”¨ä½¿ç”¨ <code>\n</code> å’Œç¬¬ <code>n</code> ä¸ªï¼ˆæ³¨æ„è¿™é‡Œçš„ <code>n</code> æ˜¯æŒ‡æ•°å­—ï¼‰åˆ†ç»„æ‰€åŒ¹é…çš„å­—ç¬¦ç›¸åŒ¹é…ã€‚åˆ†ç»„æ˜¯æ‹¬å·ä¸­çš„å­è¡¨è¾¾å¼ã€‚ï¼ˆå¯èƒ½æ˜¯åµŒå¥—çš„ï¼‰åˆ†ç»„å·æ˜¯ä»å·¦åˆ°å³è®¡æ•°çš„å·¦æ‹¬å·æ•°ã€‚</li>
</ul>
<h2>é€šè¿‡æ ‡å¿—è¿›è¡Œé«˜çº§æœç´¢</h2>
<p>æ­£åˆ™è¡¨è¾¾å¼æœ‰å…­ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions#%E9%80%9A%E8%BF%87%E6%A0%87%E5%BF%97%E8%BF%9B%E8%A1%8C%E9%AB%98%E7%BA%A7%E6%90%9C%E7%B4%A2">å¯é€‰å‚æ•°</a>ï¼ˆ<code>flags</code>ï¼‰å…è®¸å…¨å±€å’Œä¸åˆ†å¤§å°å†™æœç´¢ç­‰ã€‚è¿™äº›å‚æ•°æ—¢å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿèƒ½ä»¥ä»»æ„é¡ºåºä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”è¢«åŒ…å«åœ¨æ­£åˆ™è¡¨è¾¾å¼å®ä¾‹ä¸­ã€‚</p>
<ul>
<li><code>g</code> å…¨å±€æœç´¢</li>
<li><code>i</code> ä¸åŒºåˆ†å¤§å°å†™æœç´¢</li>
<li><code>m</code> å¤šè¡Œæœç´¢ã€‚</li>
<li><code>s</code> å…è®¸ <code>.</code> åŒ¹é…æ¢è¡Œç¬¦ã€‚</li>
<li><code>u</code> ä½¿ç”¨ unicode ç çš„æ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚</li>
<li><code>y</code> æ‰§è¡Œâ€œç²˜æ€§ï¼ˆstickyï¼‰â€æœç´¢,åŒ¹é…ä»ç›®æ ‡å­—ç¬¦ä¸²çš„å½“å‰ä½ç½®å¼€å§‹ã€‚</li>
</ul>
<pre><code>// æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡
var re = /pattern/flags;
// RegExp æ„é€ å‡½æ•°
var re = new RegExp(&quot;pattern&quot;, &quot;flags&quot;);
</code></pre>
<h2>åŠ¨æ€åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼</h2>
<p>ä»ç”¨æˆ·è¾“å…¥ç­‰æ¥æºä¸­åŠ¨æ€åœ°äº§ç”Ÿï¼Œå°±éœ€è¦ä½¿ç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<pre><code class="language-js">// å‡è®¾éœ€æ±‚æ˜¯ç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š/temp/

// æ­¤æ—¶æˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸€ä¸ªå­—ç¬¦ä¸² &quot;temp&quot;
var str = 'temp';

// è¿™ç§æ–¹å¼æ˜¯ä¸å¯¹çš„ï¼Œå¾—åˆ°çš„åªæ˜¯ä¸€ä¸ª &quot;/temp/&quot; å­—ç¬¦ä¸²ã€‚
var re = '/' + str + '/';

// åº”è¯¥æ˜¯è¿™æ ·ï¼Œæ‰æ˜¯æ­£åˆ™è¡¨è¾¾å¼
var re = new RegExp(str);
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<pre><code>\s ç©ºç™½ç¬¦
\S éç©ºç™½ç¬¦
[\s\S]ä»»æ„å­—ç¬¦
[\s\S]* 0ä¸ªåˆ°ä»»æ„å¤šä¸ªå­—ç¬¦
[\s\S]*? 0ä¸ªå­—ç¬¦ï¼ŒåŒ¹é…ä»»ä½•å­—ç¬¦å‰çš„ä½ç½®ã€‚
</code></pre>
<h2>å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼</h2>
<pre><code class="language-js">// åˆ é™¤å­—ç¬¦ä¸²å‰åç¬¬ä¸€ä¸ªç©ºæ ¼
str.replace(/(^\s*)|(\s*$)/g, '')

// åˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰ç©ºæ ¼
str.replace(/\s/g, '')
</code></pre>
<h2>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦</h2>
<p>éœ€è¦è½¬ä¹‰çš„å­—ç¬¦æœ‰ï¼š<code>\</code>ã€<code>.</code>ã€<code>*</code>ã€<code>^</code>ã€<code>&amp;</code>ã€<code>[</code>ã€<code>]</code>ã€<code>{</code>ã€<code>}</code>ã€<code>?</code> ç­‰ã€‚</p>
<p>[ ] \ ^ $ . | ? * + ( )</p>
<!--
## TODO

/\s/	// åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \f\n\r\t\v]ã€‚
/\x20/	// åŒ¹é…ä¸€ä¸ªç©ºæ ¼ã€‚
/\f/	// åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚
/\n/	// åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚
/\r/	// åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚

-->
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-cn/docs/web/javascript/guide/regular_expressions">æ­£åˆ™è¡¨è¾¾å¼ MDN</a></li>
<li><a href="https://www.cnblogs.com/mmzuo-798/p/7264093.html">JS æ­£åˆ™è¡¨è¾¾å¼å¤§å…¨</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/134">å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„]]></title>
            <link>https://github.com/toFrankie/blog/issues/230</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/230</guid>
            <pubDate>Sun, 26 Feb 2023 10:55:21 GMT</pubDate>
            <description><![CDATA[<p>JavaScript åˆ¤æ–­æ•°ç»„çš„å‡ ç§æ–¹æ³•åŠå…¶åˆ©å¼Šã€‚</p>
<h3>1. typeof</h3>
<p>å¯¹äº Functionã€Stringã€Numberã€Undefined ç­‰å‡ ç§ç±»å‹çš„å¯¹è±¡æ¥è¯´ï¼Œä»–å®Œå…¨å¯ä»¥èƒœä»»ã€‚ä½†æ˜¯ä¸º Array æ—¶ï¼š</p>
<pre><code class="language-js">va]]></description>
            <content:encoded><![CDATA[<p>JavaScript åˆ¤æ–­æ•°ç»„çš„å‡ ç§æ–¹æ³•åŠå…¶åˆ©å¼Šã€‚</p>
<h3>1. typeof</h3>
<p>å¯¹äº Functionã€Stringã€Numberã€Undefined ç­‰å‡ ç§ç±»å‹çš„å¯¹è±¡æ¥è¯´ï¼Œä»–å®Œå…¨å¯ä»¥èƒœä»»ã€‚ä½†æ˜¯ä¸º Array æ—¶ï¼š</p>
<pre><code class="language-js">var arr = [1, 2, 3]
console.log(typeof arr) // &quot;object&quot;

// åŒæ ·çš„
console.log(typeof null) // &quot;object&quot;
console.log(typeof {}) // &quot;object&quot;
</code></pre>
<p>æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ <code>typeof</code> æ¥åˆ¤æ–­ã€‚</p>
<h3>2. instanceof</h3>
<p><code>instanceof</code> è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ <code>prototype</code> å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p>
<pre><code class="language-js">var arr = [1, 2 ,3]
console.log(arr instanceof Array) // true
</code></pre>
<h3>3. åŸå‹é“¾ï¼ˆconstructorï¼‰</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤äº† <code>undefined</code> å’Œ <code>null</code>ï¼Œå…¶å®ƒéƒ½èƒ½ä½¿ç”¨ <code>constructor</code> åˆ¤æ–­ç±»å‹ã€‚</p>
<pre><code class="language-js">var arr = [1, 2, 3]
console.log(arr.__proto__.constructor === Array) // true
console.log(arr.constructor === Array) // true

// æ³¨æ„ï¼šarr.__proto__ === Array.prototype ä¸º trueã€‚
</code></pre>
<p>ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œåˆ¤æ–­æ˜¯ä¸å‡†ç¡®çš„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-js">// æ„é€ å‡½æ•°
function Fn() {}
// ä¿®æ”¹åŸå‹å¯¹è±¡
Fn.prototype = new Array()
// å®ä¾‹åŒ–å¯¹è±¡
var fn = new Fn()

console.log(fn.constructor === Fn) // false
console.log(fn.constructor === Array) // true
// æ­¤æ—¶çš„ fn åº”è¯¥æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œè€Œéæ•°ç»„ï¼Œæ‰€ä»¥æ­¤æ—¶ä½¿ç”¨ constructor åˆ¤æ–­æ˜¯ä¸åˆé€‚çš„ã€‚
</code></pre>
<h5>ä½¿ç”¨ instanceof å’Œ constructor çš„å±€é™æ€§ï¼š</h5>
<blockquote>
<p>ä½¿ç”¨å’Œå£°æ˜éƒ½å¿…é¡»æ˜¯åœ¨å½“å‰é¡µé¢ï¼Œæ¯”å¦‚çˆ¶é¡µé¢å¼•ç”¨äº†å­é¡µé¢ï¼Œåœ¨å­é¡µé¢ä¸­å£°æ˜äº†ä¸€ä¸ª <code>Array</code>ï¼Œå°†å…¶èµ‹å€¼ç»™çˆ¶é¡µé¢çš„ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆæ­¤æ—¶åšåŸå‹é“¾çš„åˆ¤æ–­ï¼š<code>Array === object.constructor</code> å¾—åˆ°çš„æ˜¯ <code>false</code>ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>Array</code> å±äºå¼•ç”¨å‹æ•°æ®ï¼Œåœ¨ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä»…ä»…æ˜¯å¼•ç”¨åœ°å€çš„ä¼ é€’ã€‚</li>
<li>æ¯ä¸ªé¡µé¢çš„ <code>Array</code> åŸç”Ÿå¯¹è±¡æ‰€å¼•ç”¨çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨å­é¡µé¢å£°æ˜çš„<code>Array</code> æ‰€å¯¹åº”çš„æ„é€ å‡½æ•°æ˜¯å­é¡µé¢çš„ <code>Array</code> å¯¹è±¡ï¼›çˆ¶é¡µé¢æ¥è¿›è¡Œåˆ¤æ–­ï¼Œä½¿ç”¨çš„ <code>Array</code> å¹¶ä¸ç­‰äºå­é¡µé¢çš„ <code>Array</code>ã€‚</li>
</ol>
<p>é™„ä¸Š <a href="https://2ality.com/2013/01/categorizing-values.html">Categorizing values in JavaScript</a> çš„ä¸€æ®µåŸè¯ï¼š
<code>Array.isArray()</code> exists because of one particular problem in browsers: each frame has its own global environment. An example: Given a frame A and a frame B (where either one can be the document). Code in frame A can pass a value to code in frame B. Then B code cannot use <code>instanceof Array</code> to check whether the value is an array, because its B <code>Array</code> is different from the A <code>Array</code> (of which the value could be an instance).</p>
</blockquote>
<p>çœ‹ä»£ç ï¼š</p>
<pre><code class="language-js">var iframe = document.createElement('iframe')
document.body.appendChild(iframe)
var xArray = window.frames[window.frames.length - 1].Array
var xarr = new xArray()
var arr = new Array()

// ä¸åŒé¡µé¢ï¼Œç»“æœå¹¶éæˆ‘ä»¬æ‰€é¢„æœŸçš„ trueï¼Œè€Œæ˜¯ false å“¦ï¼
console.log(xarr instanceof Array) // false
console.log(xarr.constructor === Array) // false

// åŒé¡µé¢æ‰æ˜¯ true å“¦ï¼
console.log(arr instanceof Array) // true
console.log(arr.constructor === Array) // true
</code></pre>
<h3>4. Array.isArray</h3>
<p>é‰´äºä»¥ä¸ŠåŸå› ï¼ŒES5 æ ‡å‡†æä¾›çš„ä¸€ä¸ªåˆ¤æ–­æ•°ç»„æ–¹æ³• <code>isArray()</code>ï¼Œå…¶åŸç†ä¹Ÿæ˜¯é€šè¿‡ <code>Object.prototype.toString()</code> åˆ¤æ–­å¯¹è±¡çš„å†…éƒ¨å±æ€§ <code>[[Class]]</code> æ˜¯å¦ä¸º <code>&quot;Array&quot;</code>ï¼Œä»¥è¾¾åˆ°åˆ¤æ–­æ•°ç»„çš„ç›®çš„ã€‚</p>
<pre><code class="language-js">function isArray(arr) {
  return Array.isArray(arr)
}
</code></pre>
<h3>5. Object.prototype.toString</h3>
<p>æ‰€ä»¥ï¼Œç»ˆææ–¹æ³•å°±æ˜¯ä»¥ä¸‹è¿™ä¸ª ğŸ‘‡</p>
<pre><code class="language-js">function isArray(arr) {
  return Object.prototype.toString.call(arr) === '[object Array]'
}
</code></pre>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray">Array.isArray() MDN</a></li>
<li><a href="http://www.nowamagic.net/librarys/veda/detail/1250">js å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯ Arrayï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[URIã€URLã€URN æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/229</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/229</guid>
            <pubDate>Sun, 26 Feb 2023 10:54:08 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a565dd9ce24d2dc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<l]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a565dd9ce24d2dc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>URIï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifierï¼‰
æ¯ä¸ª web æœåŠ¡å™¨èµ„æºéƒ½æœ‰ä¸€ä¸ªåå­—ï¼ŒæœåŠ¡å™¨èµ„æºåè¢«ç»Ÿç§°ä¸ºç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼›URI å°±åƒ Internet çš„é‚®æ”¿åœ°å€ï¼Œå”¯ä¸€åœ°æ ‡è¯†å’Œå®šä½ä¸–ç•Œå„åœ°çš„ä¿¡æ¯èµ„æºã€‚URI æœ‰ä¸¤ç§å½¢å¼ï¼Œåˆ†åˆ«ä¸º URL å’Œ URNã€‚</li>
</ul>
<pre><code>ftp://ftp.is.co.za/rfc/rfc1808.txt
http://www.ietf.org/rfc/rfc2396.txt
ldap://[2001:db8::7]/c=GB?objectClass?one
mailto:John.Doe@example.com
news:comp.infosystems.www.servers.unix
tel:+1-816-555-1212
telnet://192.0.2.16:80/
urn:oasis:names:specification:docbook:dtd:xml:4.1.2
</code></pre>
<ul>
<li>URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼‰
URL æ˜¯æœ€å¸¸è§çš„èµ„æºæ ‡è¯†ç¬¦ï¼ŒURL æè¿°äº†ä¸€å°ç‰¹å®šæœåŠ¡å™¨ä¸ŠæŸèµ„æºçš„ç‰¹å®šä½ç½®ã€‚å®ƒä»¬å¯ä»¥æ˜ç¡®è¯´æ˜å¦‚ä½•ä»ä¸€ä¸ªç²¾å‡†ã€å›ºå®šçš„ä½ç½®è·å–èµ„æºã€‚</li>
</ul>
<pre><code>https://developer.mozilla.org
https://developer.mozilla.org/en-US/docs/Learn/
https://developer.mozilla.org/en-US/search?q=URL
https://tools.ietf.org/html/rfc2396#section-3.1
</code></pre>
<ul>
<li>URNï¼šç»Ÿä¸€èµ„æºåç§°ï¼ˆUniform Resource Nameï¼‰</li>
</ul>
<p>URI çš„ç¬¬äºŒç§å½¢å¼æ˜¯ç»Ÿä¸€èµ„æºåã€‚URN æ˜¯ä½œä¸ºç‰¹å®šå†…å®¹çš„å”¯ä¸€åç§°ä½¿ç”¨çš„ï¼Œä¸ç›®å‰çš„èµ„æºæ‰€åœ¨åœ°æ— å…³ã€‚å¦‚å›¾ä¹¦çš„ç¼–å·ï¼ˆISBNï¼‰urn:isbn:0451450523ã€‚</p>
<p>è¦ç†è§£è¿™ä¸‰è€…çš„åŒºåˆ«ï¼Œä¸è¦ URI ä¸ URL å’Œ URN æ”¾åœ¨åŒä¸€ä¸ªç­‰çº§ã€‚</p>
<h3>åŒºåˆ«</h3>
<p>URL ä¸€å®šæ˜¯ URIï¼Œä½† URI ä¸ä¸€å®šæ˜¯ URLï¼ŒURI è¿˜åŒ…æ‹¬ URNã€‚</p>
<p>URL é€šè¿‡æè¿°èµ„æºçš„ä½ç½®æ¥æ ‡è¯†èµ„æºï¼Œè€Œ URN æ˜¯é€šè¿‡åå­—æ¥æ ‡è¯†èµ„æºçš„ï¼Œä¸ä½ç½®æ— å…³ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://blog.csdn.net/qq_32595453/article/details/80563142">URI å’Œ URL çš„åŒºåˆ«æ¯”è¾ƒä¸ç†è§£</a></li>
<li><a href="https://www.zhihu.com/question/19557151/answer/1614646380">URL å’Œ URI æœ‰ä»€ä¹ˆä¸åŒ?</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è¯¦è°ˆ JSON ä¸ JavaScript]]></title>
            <link>https://github.com/toFrankie/blog/issues/228</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/228</guid>
            <pubDate>Sun, 26 Feb 2023 10:53:12 GMT</pubDate>
            <description><![CDATA[<p>JSON åœ¨ç¼–ç¨‹ç”Ÿæ¶¯ç®€ç›´å°±æ˜¯æ— å¤„ä¸åœ¨å•Šã€‚</p>
<ul>
<li>é‚£ä¹ˆ JSON æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li>
<li>è·Ÿæˆ‘ä»¬çš„ JavaScript æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</li>
<li>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•å¤„ç† JSON æ•°æ®å‘¢ï¼Ÿ</li>
</ul>
<h3>ä¸€ã€JSON</h3>
<p>JSONï¼ˆ]]></description>
            <content:encoded><![CDATA[<p>JSON åœ¨ç¼–ç¨‹ç”Ÿæ¶¯ç®€ç›´å°±æ˜¯æ— å¤„ä¸åœ¨å•Šã€‚</p>
<ul>
<li>é‚£ä¹ˆ JSON æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li>
<li>è·Ÿæˆ‘ä»¬çš„ JavaScript æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</li>
<li>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•å¤„ç† JSON æ•°æ®å‘¢ï¼Ÿ</li>
</ul>
<h3>ä¸€ã€JSON</h3>
<p>JSONï¼ˆJavaScript Object Natationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç”±äºæ˜“äºé˜…è¯»ã€ç¼–å†™ï¼Œä»¥åŠä¾¿äºæœºå™¨è§£æä¸ç”Ÿæˆçš„ç‰¹æ€§ï¼Œç›¸æ¯” XMLï¼Œå®ƒæ›´å°ã€æ›´å¿«ã€æ›´æ˜“è§£æï¼Œä½¿å¾—å®ƒæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„ä¸€ç§æ–‡æœ¬æ ¼å¼ã€‚</p>
<blockquote>
<p>JSON çš„ä¸¤ç§ç»“æ„ï¼š</p>
<ul>
<li><strong>â€œåç§°/å€¼â€ å¯¹çš„é›†åˆ</strong>ï¼šä¸åŒè¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£æˆå¯¹è±¡ï¼ˆobjectï¼‰ã€è®°å½•ï¼ˆrecordï¼‰ã€ç»“æ„ï¼ˆstructï¼‰ã€å­—å…¸ï¼ˆdictionaryï¼‰ã€å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰ã€æœ‰é”®åˆ—è¡¨ï¼ˆkeyed listï¼‰æˆ–è€…å…³è”æ•°ç»„ï¼ˆassociative arrayï¼‰ã€‚</li>
<li><strong>å€¼çš„æœ‰åºåˆ—è¡¨</strong>ï¼šå¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£æˆæ•°ç»„ï¼ˆarrayï¼‰ã€‚</li>
</ul>
</blockquote>
<p>ä¾‹å¦‚ç”¨ä»¥ä¸‹ JSON æ•°æ®æ¥æè¿°ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;Frankie&quot;,
  &quot;age&quot;: 20,
  &quot;skills&quot;: [&quot;Java&quot;, &quot;JavaScript&quot;, &quot;TypeScript&quot;]
}
</code></pre>
<p>æ³¨æ„ï¼Œ<strong>JavaScript ä¸æ˜¯ JSONï¼ŒJSON ä¹Ÿä¸æ˜¯ JavaScript</strong>ã€‚ä½† JSON ä¸ JavaScript æ˜¯å­˜åœ¨æ¸Šæºçš„ï¼ŒJSON çš„æ•°æ®æ ¼å¼æ˜¯ä» JavaScript å¯¹è±¡ä¸­æ¼”å˜å‡ºæ¥çš„ã€‚ï¼ˆä»åç§°ä¸Šå¯ä»¥ä½“ç°ï¼‰</p>
<h3>äºŒã€JSON ä¸ JavaScript çš„åŒºåˆ«</h3>
<p>JSON æ˜¯ä¸€ç§æ•°æ®æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§è§„èŒƒã€‚JSON æ˜¯ç”¨äºè·¨å¹³å°æ•°æ®äº¤æµçš„ï¼Œç‹¬ç«‹äºè¯­è¨€å’Œå¹³å°ã€‚è€Œ JavaScript å¯¹è±¡æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå­˜åœ¨äºå†…å­˜ä¸­ã€‚JavaScript å¯¹è±¡æ˜¯æ²¡åŠæ³•ä¼ è¾“çš„ï¼Œåªæœ‰åœ¨è¢«åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åæ‰èƒ½ä¼ è¾“ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">JavaScript ç±»å‹</th>
<th style="text-align:left">JSON çš„ä¸åŒç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">å¯¹è±¡å’Œæ•°ç»„</td>
<td style="text-align:left">å±æ€§åç§°å¿…é¡»æ˜¯åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼›æœ€åä¸€ä¸ªå±æ€§åä¸èƒ½æœ‰é€—å·</td>
</tr>
<tr>
<td style="text-align:center">æ•°å€¼</td>
<td style="text-align:left">ç¦æ­¢å‡ºç°å‰å¯¼é›¶ï¼ˆ <code>JSON.stringify()</code> æ–¹æ³•è‡ªåŠ¨å¿½ç•¥å‰å¯¼é›¶ï¼Œè€Œåœ¨ <code>JSON.parse()</code> æ–¹æ³•ä¸­å°†ä¼šæŠ›å‡º SyntaxErrorï¼‰ï¼›å¦‚æœæœ‰å°æ•°ç‚¹ï¼Œåˆ™åé¢è‡³å°‘è·Ÿç€ä¸€ä½æ•°å­—ã€‚</td>
</tr>
<tr>
<td style="text-align:center">å­—ç¬¦ä¸²</td>
<td style="text-align:left">åªæœ‰æœ‰é™çš„ä¸€äº›å­—ç¬¦å¯èƒ½ä¼šè¢«è½¬ä¹‰ï¼›ç¦æ­¢æŸäº›æ§åˆ¶å­—ç¬¦ï¼›Â Unicode è¡Œåˆ†éš”ç¬¦ ï¼ˆ<a href="http://unicode-table.com/cn/2028/">U+2028</a>ï¼‰å’Œæ®µåˆ†éš”ç¬¦ ï¼ˆ<a href="http://unicode-table.com/cn/2029/">U+2029</a>ï¼‰è¢«å…è®¸ ; å­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å·æ‹¬èµ·æ¥ã€‚è¯·å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°Â <code>JSON.parse()</code>Â èƒ½å¤Ÿæ­£å¸¸è§£æï¼Œä½†å°†å…¶å½“ä½œ JavaScript è§£ææ—¶ä¼šæŠ›å‡ºÂ <code>SyntaxError</code>Â é”™è¯¯ï¼š</td>
</tr>
</tbody>
</table>
<pre><code>let code = '&quot;\u2028\u2029&quot;'
JSON.parse(code)  // æ­£å¸¸
eval(code)  // é”™è¯¯
</code></pre>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä»¥ä¸‹å¯¹è±¡å«åš JSONï¼Œå¦‚ï¼š</p>
<pre><code class="language-js">// è¿™åªæ˜¯ JS å¯¹è±¡
var people = {}

// è¿™è·Ÿ JSON å°±æ›´ä¸æ²¾è¾¹äº†ï¼Œåªæ˜¯ JS çš„å¯¹è±¡
var people = { name: 'Frankie', age: 20 }

// è¿™è·Ÿ JSON å°±æ›´ä¸æ²¾è¾¹äº†ï¼Œåªæ˜¯ JS çš„å¯¹è±¡
var people = { 'name': 'Frankie', 'age': 20 }

// æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç§°åšï¼šJSON æ ¼å¼çš„ JS å¯¹è±¡
var people = { &quot;name&quot;: &quot;Frankie&quot;, &quot;age&quot;: 20 }

// æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç§°åšï¼šJSON æ ¼å¼çš„å­—ç¬¦ä¸²
var people = '{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20}'

// ç¨å¤æ‚çš„ JSON æ ¼å¼çš„æ•°ç»„
var peopleArr = [
  { &quot;name&quot;: &quot;Frankie&quot;, &quot;age&quot;: 20 },
  { &quot;name&quot;: &quot;Mandy&quot;, &quot;age&quot;: 18 }
]

// ç¨å¤æ‚çš„ JSON æ ¼å¼å­—ç¬¦ä¸²
var peopleStr = '[{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20},{&quot;name&quot;:&quot;Mandy&quot;,&quot;age&quot;:18}]'
</code></pre>
<blockquote>
<p>å°½ç®¡ JSON ä¸ä¸¥æ ¼çš„ JavaScript å¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ–¹å¼å¾ˆç›¸ä¼¼ï¼Œå¦‚æœå°† JavaScript å¯¹è±¡å±æ€§åŠ ä¸ŠåŒå¼•å·å°±ç†è§£æˆ JSON æ˜¯ä¸å¯¹çš„ï¼Œå®ƒåªæ˜¯ç¬¦åˆ JSON çš„è¯­æ³•è§„åˆ™è€Œå·²ã€‚JSON ä¸ JavaScript å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªä¸œè¥¿ï¼Œå°±åƒâ€œæ–‘é©¬â€å’Œâ€œæ–‘é©¬çº¿â€ä¸€æ ·ã€‚</p>
</blockquote>
<p>åœ¨ JavaScript ä¸­ï¼Œ<code>JSON</code> å¯¹è±¡åŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºè§£æçš„ <code>JSON.parse()</code> å’Œè½¬æ¢çš„ <code>JSON.stringify()</code> æ–¹æ³•ã€‚é™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>JSON</code> è¿™ä¸ªå¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰å…¶ä»–ä½œç”¨ï¼Œä¹Ÿä¸èƒ½è¢«è°ƒç”¨æˆ–è€…ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨ã€‚</p>
<h3>ä¸‰ã€JSON.stringify()</h3>
<p>å°†ä¸€ä¸ª JavaScript å¯¹è±¡æˆ–å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>JSON.stringify(value, replacer, space)</p>
</blockquote>
<ul>
<li>
<p>å‚æ•° <code>value</code> ï¼Œæ˜¯å°†è¦åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²çš„å€¼ã€‚</p>
</li>
<li>
<p>å‚æ•° <code>replacer</code> ï¼ˆå¯é€‰ï¼‰ï¼Œå¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œè¢«åºåˆ—åŒ–çš„å€¼çš„æ¯ä¸ªå±æ€§éƒ½ä¼šç»è¿‡è¯¥å‡½æ•°çš„è½¬æ¢å’Œå¤„ç†ï¼›å¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™åªæœ‰åŒ…å«åœ¨è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åæ‰ä¼šè¢«åºåˆ—åŒ–åˆ°æœ€ç»ˆçš„ JSON å­—ç¬¦ä¸²ä¸­ï¼›å¦‚æœè¯¥å‚æ•°æœªæä¾›ï¼ˆæˆ–è€…å€¼ä¸º <code>null</code>ï¼‰ï¼Œåˆ™å¯¹è±¡æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚</p>
</li>
</ul>
<pre><code class="language-js">const people = {
  name: 'Frankie',
  age: 20
}

const peopleStr1 = JSON.stringify(people, ['name'])
const peopleStr2 = JSON.stringify(people, (key, value) =&gt; {
  if (typeof value === 'string') {
    return undefined
  }
  return value
})

console.log(peopleStr1) // '{&quot;name&quot;:&quot;Frankie&quot;}'
console.log(peopleStr2) // '{&quot;age&quot;:20}'
</code></pre>
<ul>
<li>å‚æ•° <code>space</code> ï¼ˆå¯é€‰ï¼‰ï¼ŒæŒ‡å®šç¼©è¿›ç”¨çš„ç©ºç™½å­—ç¬¦ä¸²ï¼Œç”¨äºç¾åŒ–è¾“å‡ºï¼ˆpretty-printï¼‰ã€‚å¦‚æœå‚æ•°ä¸º<strong>æ•°å­—</strong>ï¼Œå®ƒè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªç©ºæ ¼ï¼Œå€¼å¤§äº 10 æ—¶ï¼Œè¾“å‡ºç©ºæ ¼ä¸º 10ï¼Œå°äº 1 åˆ™è¡¨ç¤ºæ²¡æœ‰ç©ºæ ¼ã€‚å¦‚æœå‚æ•°ä¸º<strong>å­—ç¬¦ä¸²</strong>ï¼Œè¯¥å­—ç¬¦ä¸²å°†è¢«å°†è¢«ä½œä¸ºç©ºæ ¼ã€‚å¦‚æœå‚æ•°æ²¡æœ‰æä¾›ï¼ˆæˆ–è€…å€¼ä¸º <code>null</code>ï¼‰ï¼Œå°†æ²¡æœ‰ç©ºæ ¼ã€‚æ³¨æ„ï¼Œè‹¥ä½¿ç”¨éç©ºå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°å€¼ï¼Œå°±ä¸èƒ½è¢« <code>JSON.parse()</code> è§£æäº†ï¼Œä¼šæŠ›å‡ºÂ <code>SyntaxError</code>Â é”™è¯¯ã€‚</li>
</ul>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå‚æ•° <code>replacer</code> å’Œ <code>space</code> å¹³å¸¸æ¯”è¾ƒå°‘ç”¨åˆ°ã€‚</p>
</blockquote>
<p>çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const symbol = Symbol()

const func = () =&gt; { }

const people = {
  name: 'Frankie',
  age: 20,
  birthday: new Date(),
  sex: undefined,
  home: null,
  say: func,
  [symbol]: 'This is Symbol',
  skills: ['', undefined, , 'JavaScript', undefined, symbol, func],
  course: {
    name: 'English',
    score: 90
  },
  prop1: NaN,
  prop2: Infinity,
  prop3: new Boolean(true) // or new String('abc') or new Number(10)
}

const replacer = (key, value) =&gt; {
  // è¿™é‡Œæˆ‘å…¶å®æ²¡åšä»€ä¹ˆå¤„ç†ï¼Œè·Ÿå¿½ç•¥ replacer å‚æ•°æ˜¯ä¸€è‡´çš„ã€‚

  // è‹¥ç¬¦åˆæŸç§æ¡ä»¶ä¸è¢«åºåˆ—åŒ–ï¼Œreturn undefined å³å¯ã€‚
  // æ¯”å¦‚ if (typeof value === 'string') return undefined
  
  // ä¹Ÿå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥çœ‹çœ‹åºåˆ—åŒ–çš„æ‰§è¡Œé¡ºåºã€‚

  // console.log('key: ', key)
  // console.log('value: ', value)
  return value
}

// åºåˆ—åŒ–æ“ä½œ
const peopleStr = JSON.stringify(people, replacer)

// '{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20,&quot;birthday&quot;:&quot;2021-01-17T10:24:39.333Z&quot;,&quot;home&quot;:null,&quot;skills&quot;:[&quot;&quot;,null,null,&quot;JavaScript&quot;,null,null,null],&quot;course&quot;:{&quot;name&quot;:&quot;English&quot;,&quot;score&quot;:90},&quot;prop1&quot;:null,&quot;prop2&quot;:null,&quot;prop3&quot;:true}'
console.log(peopleStr) 

console.log(JSON.stringify(function(){})) // undefined
console.log(JSON.stringify(undefined)) // undefined
</code></pre>
<h5>ç»“åˆä»¥ä¸Šç¤ºä¾‹ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</h5>
<ul>
<li><strong>éæ•°ç»„å¯¹è±¡</strong>çš„å±æ€§ä¸èƒ½ä¿è¯ä»¥<strong>ç‰¹å®šçš„é¡ºåº</strong>å±æ€§å‡ºç°åœ¨åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­ã€‚ï¼ˆç¤ºä¾‹å¯èƒ½æ²¡ä½“ç°å‡ºæ¥ï¼‰</li>
<li>å¸ƒå°”å€¼ã€æ•°å­—ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŸå§‹å€¼ã€‚ï¼ˆå¦‚ <code>prop3</code>ï¼‰</li>
<li><code>undefined</code>ã€ä»»æ„çš„å‡½æ•°ä»¥åŠ <code>symbol</code> å€¼ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚è‹¥å‡ºç°åœ¨<strong>éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼</strong>ä¸­ï¼Œä¼šè¢«å¿½ç•¥ï¼›è‹¥å‡ºç°åœ¨<strong>æ•°ç»„</strong>ä¸­ï¼Œä¼šè¢«è½¬æ¢æˆ <code>null</code>ã€‚</li>
<li>å‡½æ•°ã€<code>undefined</code> è¢«å•ç‹¬è½¬æ¢æ—¶ï¼Œä¼šè¿”å› <code>undefined</code>ã€‚</li>
<li>æ‰€æœ‰ä»¥ symbol ä¸ºå±æ€§é”®çš„å±æ€§éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥æ‰ï¼Œå³ä¾¿ <code>replacer</code> å‚æ•°ä¸­å¼ºåˆ¶æŒ‡å®šåŒ…å«äº†å®ƒä»¬ã€‚</li>
<li>Date æ—¥æœŸè°ƒç”¨äº†å…¶å†…ç½®çš„ <code>toJSON()</code> æ–¹æ³•å°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼ˆåŒ <code>Date.toISOString()</code>ï¼‰ï¼Œå› æ­¤ä¼šè¢«å½“åšå­—ç¬¦ä¸²å¤„ç†ã€‚</li>
<li><code>NaN</code> å’Œ <code>Infinity</code> æ ¼å¼çš„æ•°å€¼åŠ <code>null</code> éƒ½ä¼šè¢«å½“åš <code>null</code>ã€‚</li>
<li>å…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>Map</code>ã€<code>Set</code>ã€<code>WeakMap</code>ã€<code>WeakSet</code>ï¼Œä»…ä¼šåºåˆ—åŒ–å¯æšä¸¾çš„å±æ€§ã€‚</li>
<li>è½¬æ¢å€¼å¦‚æœå«æœ‰ <code>toJSON()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰ä»€ä¹ˆå€¼å°†è¢«åºåˆ—åŒ–ã€‚</li>
<li>å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
</ul>
<h5>é’ˆå¯¹æœ€åä¸¤ç‚¹ä¸¾ä¾‹è¯´æ˜ï¼š</h5>
<ul>
<li>è‹¥å¯¹è±¡æœ¬èº«å®ç°äº† <code>toJSON()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>JSON.stringify()</code> æ–¹æ³•æ—¶ï¼Œ<code>JSON.stringify()</code> ä¼šå°†è¿™ä¸ªå¯¹è±¡çš„ <code>toJSON()</code> æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå‚æ•°å»è¿›è¡Œåºåˆ—åŒ–ã€‚</li>
</ul>
<pre><code class="language-js">const people = {
  name: 'Frankie',
  age: 20,
  toJSON: () =&gt; {
    return { name: 'Mandy' }
  }
}

console.log(JSON.stringify(people))
// ç»“æœæ˜¯ {&quot;name&quot;:&quot;Mandy&quot;}ï¼Œè€Œä¸æ˜¯ {&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20}
// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥å¯¹è±¡çš„ toJSON å±æ€§å€¼ä¸æ˜¯å‡½æ•°çš„è¯ï¼Œä»ç„¶æ˜¯è¯¥å¯¹è±¡ä½œä¸ºå‚æ•°è¿›è¡Œåºåˆ—åŒ–ã€‚


// ä¸Šé¢è¿˜æåˆ° Date å¯¹è±¡æœ¬èº«å†…ç½®äº† toJSON() æ–¹æ³•ï¼Œæ‰€ä»¥ä»¥ä¸‹è¿”å›ç»“æœæ˜¯ï¼š
// &quot;2021-01-17T09:40:08.302Z&quot;
console.log(JSON.stringify(new Date()))


// å‡å¦‚æˆ‘å»ä¿®æ”¹ Date åŸå‹ä¸Šçš„ toJSON æ–¹æ³•ï¼Œç»“æœä¼šæ€æ ·å‘¢ï¼Ÿ
Date.prototype.toJSON = function () { return 'è¢«æ”¹å†™äº†' }
console.log(JSON.stringify(new Date())) // &quot;è¢«æ”¹å†™äº†&quot;
</code></pre>
<ul>
<li>å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
</ul>
<pre><code class="language-js">const foo = {}
const bar = {
  b: foo
}
foo.a = bar
console.log(foo)

// å¦‚æœè¿™æ—¶å€™å¯¹ foo è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚
JSON.stringify(foo) // Uncaught TypeError: Converting circular structure to JSON
</code></pre>
<p>foo å¯¹è±¡å’Œ bar å¯¹è±¡ä¼šæ— é™ç›¸äº’å¼•ç”¨ï¼Œå¯ä»¥çœ‹ä¸‹ foo æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œå¦‚æœæ­¤æ—¶å¯¹ foo è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼š<code>Uncaught TypeError: Converting circular structure to JSON</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9438c56fc6b1c107.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹åˆ«äººçš„è§£å†³æ–¹æ³•ï¼Œçœ‹è¿™é‡Œ <a href="https://github.com/douglascrockford/JSON-js">JSON-js</a>ã€‚å…·ä½“ç”¨æ³•æ˜¯ï¼Œå…ˆå¼•å…¥å…¶ä¸­çš„ <code>cycle.js</code> è„šæœ¬ï¼Œç„¶å <code>JSON.stringify(JSON.decycle(foo))</code> å°± OK äº†ã€‚</p>
<h5>JSON.stringify() æ€»ç»“ï¼š</h5>
<ol>
<li>è‹¥è¢«åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå­˜åœ¨ <code>toJSON()</code> æ–¹æ³•ï¼ŒçœŸæ­£è¢«åºåˆ—åŒ–çš„å…¶å®æ˜¯ <code>toJSON()</code> æ–¹æ³•çš„è¿”å›å€¼ã€‚</li>
<li>è‹¥æä¾›äº† <code>replacer</code> å‚æ•°ï¼Œåº”ç”¨è¿™ä¸ªå‡½æ•°è¿‡æ»¤å™¨ï¼Œä¼ å…¥çš„å‡½æ•°è¿‡æ»¤å™¨çš„å€¼æ˜¯ç¬¬ 1 æ­¥è¿”å›çš„å€¼ã€‚</li>
<li>å¯¹ç¬¬ 2 æ­¥è¿”å›çš„æ¯ä¸ªå€¼ï¼Œè¿›è¡Œç›¸åº”çš„åºåˆ—åŒ–ã€‚</li>
<li>å¦‚æœæä¾›äº† <code>space</code> å‚æ•°ï¼Œæ‰§è¡Œç›¸åº”çš„æ ¼å¼åŒ–æ“ä½œã€‚</li>
</ol>
<h3>å››ã€JSON.parse()</h3>
<p><code>JSON.parse()</code> æ–¹æ³•ç”¨æ¥è§£æ JSON å­—ç¬¦ä¸²ï¼Œæ„é€ ç”±å­—ç¬¦ä¸²æè¿°çš„ JavaScript å€¼æˆ–å¯¹è±¡ã€‚æä¾›å¯é€‰çš„ reviver å‡½æ•°ç”¨ä»¥åœ¨è¿”å›ä¹‹å‰å¯¹æ‰€å¾—åˆ°çš„å¯¹è±¡æ‰§è¡Œå˜æ¢(æ“ä½œ)ã€‚</p>
<blockquote>
<p>JSON.parse(text, reviver)</p>
</blockquote>
<ul>
<li>
<p>å‚æ•° <code>text</code>ï¼Œè¦è¢«è§£ææˆ JavaScript å€¼çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li>
<p>å‚æ•° <code>reviver</code>ï¼ˆå¯é€‰ï¼‰è½¬æ¢å™¨ï¼Œå¦‚æœä¼ å…¥è¯¥å‚æ•°(å‡½æ•°)ï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹è§£æç”Ÿæˆçš„åŸå§‹å€¼ï¼Œè°ƒç”¨æ—¶æœºåœ¨ parse å‡½æ•°è¿”å›ä¹‹å‰ã€‚</p>
<p>å¦‚æœæŒ‡å®šäº† <code>reviver</code> å‡½æ•°ï¼Œåˆ™è§£æå‡ºçš„ JavaScript å€¼ï¼ˆè§£æå€¼ï¼‰ä¼šç»è¿‡ä¸€æ¬¡è½¬æ¢åæ‰å°†è¢«æœ€ç»ˆè¿”å›ï¼ˆè¿”å›å€¼ï¼‰ã€‚æ›´å…·ä½“ç‚¹è®²å°±æ˜¯ï¼šè§£æå€¼æœ¬èº«ä»¥åŠå®ƒæ‰€åŒ…å«çš„æ‰€æœ‰å±æ€§ï¼Œä¼šæŒ‰ç…§<strong>ä¸€å®šçš„é¡ºåº</strong>ï¼ˆä»æœ€æœ€é‡Œå±‚çš„å±æ€§å¼€å§‹ï¼Œä¸€çº§çº§å¾€å¤–ï¼Œæœ€ç»ˆåˆ°è¾¾é¡¶å±‚ï¼Œä¹Ÿå°±æ˜¯è§£æå€¼æœ¬èº«ï¼‰åˆ†åˆ«çš„å»è°ƒç”¨ <code>reviver</code> å‡½æ•°ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå½“å‰å±æ€§æ‰€å±çš„å¯¹è±¡ä¼šä½œä¸º <code>this</code> å€¼ï¼Œå½“å‰å±æ€§åå’Œå±æ€§å€¼ä¼šåˆ†åˆ«ä½œä¸ºç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ <code>reviver</code> ä¸­ã€‚å¦‚æœ <code>reviver</code> è¿”å› <code>undefined</code>ï¼Œåˆ™å½“å‰å±æ€§ä¼šä»æ‰€å±å¯¹è±¡ä¸­åˆ é™¤ï¼Œå¦‚æœè¿”å›äº†å…¶ä»–å€¼ï¼Œåˆ™è¿”å›çš„å€¼ä¼šæˆä¸ºå½“å‰å±æ€§æ–°çš„å±æ€§å€¼ã€‚</p>
<p>å½“éå†åˆ°æœ€é¡¶å±‚çš„å€¼ï¼ˆè§£æå€¼ï¼‰æ—¶ï¼Œä¼ å…¥ <code>reviver</code> å‡½æ•°çš„å‚æ•°ä¼šæ˜¯ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code>ï¼ˆå› ä¸ºæ­¤æ—¶å·²ç»æ²¡æœ‰çœŸæ­£çš„å±æ€§ï¼‰å’Œå½“å‰çš„è§£æå€¼ï¼ˆæœ‰å¯èƒ½å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼‰ï¼Œå½“å‰çš„ <code>this</code> å€¼ä¼šæ˜¯ <code>{&quot;&quot;: ä¿®æ”¹è¿‡çš„è§£æå€¼}</code>ï¼Œåœ¨ç¼–å†™ <code>reviver</code> å‡½æ•°æ—¶ï¼Œè¦æ³¨æ„åˆ°è¿™ä¸ªç‰¹ä¾‹ã€‚ï¼ˆ<strong>è¿™ä¸ªå‡½æ•°çš„éå†é¡ºåºä¾ç…§ï¼šä»æœ€å†…å±‚å¼€å§‹ï¼ŒæŒ‰ç…§å±‚çº§é¡ºåºï¼Œä¾æ¬¡å‘å¤–éå†</strong>ï¼‰</p>
</li>
</ul>
<pre><code class="language-js">// JSON å­—ç¬¦ä¸²
const peopleStr = '{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20,&quot;birthday&quot;:&quot;2021-01-17T10:24:39.333Z&quot;,&quot;home&quot;:null,&quot;skills&quot;:[&quot;&quot;,null,null,&quot;JavaScript&quot;,null,null,null],&quot;course&quot;:{&quot;name&quot;:&quot;English&quot;,&quot;score&quot;:90},&quot;prop1&quot;:null,&quot;prop2&quot;:null,&quot;prop3&quot;:true}'

// è‹¥éœ€è¾“å‡º this å¯¹è±¡ï¼Œä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°
const reviver = (key, value) =&gt; {
  // å¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥çœ‹çœ‹åºåˆ—åŒ–çš„æ‰§è¡Œé¡ºåºã€‚
  // console.log('key: ', key)
  // console.log('value: ', value)

  // è‹¥åˆ é™¤æŸä¸ªå±æ€§ï¼Œreturn undefined å³å¯ã€‚
  // æ¯”å¦‚ if (typeof value === 'string') return undefined

  // å¦‚æœåˆ°äº†æœ€é¡¶å±‚ï¼Œåˆ™ç›´æ¥è¿”å›å±æ€§å€¼
  if (key === '') return value

  // æ•°å€¼ç±»å‹ï¼Œå°†å±æ€§å€¼å˜ä¸ºåŸæ¥çš„ 2 å€
  if (typeof value === 'number') return value * 2

  // å…¶ä»–çš„åŸæ ·è§£æ
  return value
}

const parseObj = JSON.parse(peopleStr, reviver)

console.log(parseObj)
</code></pre>
<p>è§£æç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;age&quot;: 40,
  &quot;birthday&quot;: &quot;2021-02-14T06:02:18.491Z&quot;,
  &quot;course&quot;: { &quot;name&quot;: &quot;English&quot;, &quot;score&quot;: 180 },
  &quot;home&quot;: null,
  &quot;name&quot;: &quot;Frankie&quot;,
  &quot;prop1&quot;: null,
  &quot;prop2&quot;: null,
  &quot;prop3&quot;: true,
  &quot;skills&quot;: [&quot;&quot;, null, null, &quot;JavaScript&quot;, null, null, null]
}
</code></pre>
<h3>äº”ã€å…¶ä»–</h3>
<p>é’ˆå¯¹ Line separator å’Œ Paragraph separator çš„å¤„ç†ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#json.stringify%E7%94%A8%E4%BD%9C_javascript" title="Permalink to JSON.stringifyç”¨ä½œ JavaScript">JSON.stringify ç”¨ä½œ JavaScript</a></p>
<h3>å…­ã€æ‹“å±•</h3>
<p>æ ¹æ® ECMA-262 æ ‡å‡†å®šä¹‰ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥åŒ…å«ä»»ä½•ä¸œè¥¿ï¼Œåªè¦å®ƒä¸æ˜¯ä¸€ä¸ªå¼•å·ï¼Œä¸€ä¸ªåæ–œçº¿æˆ–è€…ä¸€ä¸ªè¡Œç»ˆæ­¢ç¬¦ã€‚</p>
<p>ä»¥ä¸‹è¢«è®¤ä¸ºæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼š</p>
<ul>
<li><code>\u000A</code> - Line Feed</li>
<li><code>\u000D</code> - Carriage Return</li>
<li><code>\u2028</code> - Line separator</li>
<li><code>\u2029</code> - Paragraph separator</li>
</ul>
<h3>ä¸ƒã€å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON MDN</a></li>
<li><a href="http://www.json.org/json-zh.html">Introducing JSON</a></li>
<li><a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404 The JSON Data Interchange Standard</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript è·å–äºŒçº§åŸŸåçš„æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/227</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/227</guid>
            <pubDate>Sun, 26 Feb 2023 10:52:32 GMT</pubDate>
            <description><![CDATA[<h3>èƒŒæ™¯</h3>
<p>æœ‰ä¸ªéœ€æ±‚ï¼Œå°† cookie è®¾ç½®åˆ°æˆ‘ä»¬çš„äºŒçº§åŸŸåä¸Šï¼Œåœ¨ä¸åŒçš„é¡¹ç›®éƒ½å¯ä»¥å…¬ç”¨ã€‚</p>
<h3>å‡†å¤‡</h3>
<ol>
<li>ä¸€ä¸ªå®Œæ•´çš„åŸŸåç”±äºŒä¸ªæˆ–äºŒä¸ªä»¥ä¸Šéƒ¨åˆ†ç»„æˆï¼Œå„éƒ¨åˆ†ä¹‹é—´ç”¨è‹±æ–‡çš„å¥å· <code>.</code> æ¥åˆ†éš”ï¼›</li>
<li>åœ¨è®¾ç½® cookie æ—¶ï¼Œå¦‚çœç•¥ dom]]></description>
            <content:encoded><![CDATA[<h3>èƒŒæ™¯</h3>
<p>æœ‰ä¸ªéœ€æ±‚ï¼Œå°† cookie è®¾ç½®åˆ°æˆ‘ä»¬çš„äºŒçº§åŸŸåä¸Šï¼Œåœ¨ä¸åŒçš„é¡¹ç›®éƒ½å¯ä»¥å…¬ç”¨ã€‚</p>
<h3>å‡†å¤‡</h3>
<ol>
<li>ä¸€ä¸ªå®Œæ•´çš„åŸŸåç”±äºŒä¸ªæˆ–äºŒä¸ªä»¥ä¸Šéƒ¨åˆ†ç»„æˆï¼Œå„éƒ¨åˆ†ä¹‹é—´ç”¨è‹±æ–‡çš„å¥å· <code>.</code> æ¥åˆ†éš”ï¼›</li>
<li>åœ¨è®¾ç½® cookie æ—¶ï¼Œå¦‚çœç•¥ domain å‚æ•°ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤è®¾ç½®ä¸ºå½“å‰åŸŸåï¼›</li>
<li>domain å‚æ•°å¯ä»¥è®¾ç½®çˆ¶åŸŸåä»¥åŠå½“å‰åŸŸåã€‚ä¸èƒ½è®¾ç½®ä¸ºå…¶ä»–åŸŸåï¼ŒåŒ…æ‹¬å­åŸŸåä¹Ÿä¸è¡Œï¼›</li>
<li>cookie çš„ä½œç”¨åŸŸæ˜¯ domain æœ¬èº«ä»¥åŠ domain ä¸‹çš„æ‰€æœ‰å­åŸŸåã€‚(è¿™é‡Œå¿½ç•¥ path å‚æ•°é™åˆ¶ï¼Œå½“åš <code>/</code>)</li>
</ol>
<h3>æ€è·¯</h3>
<p>å¦‚ä½•è·å–äºŒçº§åŸŸåï¼Œä»¥ <code>shortcuts.sspai.com</code> ä¸ºä¾‹ï¼š</p>
<p>æ¥ç€æˆ‘ä»¬å¯¹ URL è¿›è¡Œæ‹†åˆ†ï¼ŒæŒ‰å…ˆåé¡ºåºå¯¹ <code>com</code>ã€<code>sspai.com</code>ã€<code>shortcuts.sspai.com</code> ï¼ˆä»¥æ­¤ç±»æ¨ï¼‰è®¾ç½® cookieã€‚å€˜è‹¥èƒ½è®¾ç½® cookie åˆ™è¯´æ˜åŸŸåæ˜¯åˆæ³•çš„ï¼Œæ­¤æ—¶åœæ­¢ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›ç»“æœ <code>sspai.com</code>ï¼ŒåŒæ—¶åˆ æ‰è¯¥ cookieã€‚</p>
<h3>å…¶ä»–</h3>
<ol>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>baidu.com</code> åº”å±äºäºŒçº§åŸŸåã€‚</li>
<li>å…³äºé¡¶çº§åŸŸåã€äºŒçº§åŸŸåã€ä¸‰çº§åŸŸåç­‰åˆ’åˆ†å¦‚ç†è§£æœ‰åå·®ï¼Œè‡ªè¡Œæœç´¢ã€‚<a href="https://www.zhihu.com/question/29998374/answer/399176525">å¯å‚è€ƒ</a></li>
<li>å½“å‰é‡‡ç”¨éƒ¨åˆ† ES6 è¯­æ³•ï¼Œè‹¥éœ€å…¼å®¹ ES5 è‡ªè¡Œä¿®æ”¹å³å¯ã€‚</li>
<li>è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå®ç”¨çš„ JS <a href="https://github.com/toFrankie/Some-JavaScript-File">æ–¹æ³•</a>ï¼Œæ¯”å¦‚ä¸­æ–‡è½¬æ‹¼éŸ³ã€èº«ä»½è¯å·ç æ ¡éªŒç­‰ã€‚</li>
</ol>
<h3>å®ç°</h3>
<pre><code class="language-js">/**
 * è·å–å½“å‰ URL äºŒçº§åŸŸå
 * å¦‚æœå½“å‰æ˜¯ IP åœ°å€ï¼Œåˆ™ç›´æ¥è¿”å› IP Address
 */
function getSubdomain() {
  try {
    let subdomain = ''
    const key = `mh_${Math.random()}`
    const expiredDate = new Date(0)
    const { domain } = document
    const domainList = domain.split('.')

    const reg = new RegExp(`(^|;)\\s*${key}=12345`)
    const ipAddressReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/

    // è‹¥ä¸º IP åœ°å€ã€localhostï¼Œåˆ™ç›´æ¥è¿”å›
    if (ipAddressReg.test(domain) || domain === 'localhost') {
      return domain
    }

    const urlItems = []
    urlItems.unshift(domainList.pop())

    while (domainList.length) {
      urlItems.unshift(domainList.pop())
      subdomain = urlItems.join('.')

      const cookie = `${key}=12345;domain=.${subdomain}`
      document.cookie = cookie

      if (reg.test(document.cookie)) {
        document.cookie = `${cookie};expires=${expiredDate}`
        break
      }
    }

    return subdomain || document.domain
  } catch (e) {
    return document.domain
  }
}
</code></pre>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.aliyun.com/article/195912">å‰ç«¯ JS å¦‚ä½•è·å–ä¸»åŸŸå(æ ¹åŸŸå)</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Date å¯¹è±¡]]></title>
            <link>https://github.com/toFrankie/blog/issues/226</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/226</guid>
            <pubDate>Sun, 26 Feb 2023 10:51:47 GMT</pubDate>
            <description><![CDATA[<p>å…³äº Date å¯¹è±¡ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æ€»æ˜¯è®°ä¸ä½æˆ–è€…è®°æ··æ·†çš„ï¼Œæ‰€ä»¥å†™ç¯‡æ–‡ç« æ•´ç†ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>å…³äº GTMï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰å’Œ UTCï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰çš„åŒºåˆ«ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ«å°¾å¼•ç”¨çš„æ–‡ç« </p>
</blockquote>
<h3>Date</h3>
<p>åœ¨ ECMAScript ä¸­ï¼ŒDat]]></description>
            <content:encoded><![CDATA[<p>å…³äº Date å¯¹è±¡ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•æ€»æ˜¯è®°ä¸ä½æˆ–è€…è®°æ··æ·†çš„ï¼Œæ‰€ä»¥å†™ç¯‡æ–‡ç« æ•´ç†ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>å…³äº GTMï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰å’Œ UTCï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰çš„åŒºåˆ«ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ«å°¾å¼•ç”¨çš„æ–‡ç« </p>
</blockquote>
<h3>Date</h3>
<p>åœ¨ ECMAScript ä¸­ï¼ŒDate ç±»å‹ä½¿ç”¨è‡ªä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆUTCï¼‰<strong>1970-1-1 00:00:00</strong> å¼€å§‹ç»è¿‡çš„æ¯«ç§’æ•°æ¥ä¿å­˜æ—¥æœŸã€‚</p>
<pre><code class="language-js">// è·å–èµ·å§‹æ—¶é—´
const date = new Date(0)
// Thu Jan 01 1970 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)
</code></pre>
<p>åˆ›å»º Date ä¸¤ç§æ–¹å¼ï¼š</p>
<pre><code class="language-js">// å­—ç¬¦ä¸²ç±»å‹
const date = Date()
console.log(typeof date) // string

// å¯¹è±¡ç±»å‹ï¼ˆå¸¸ç”¨ï¼‰
const date = new Date()
console.log(typeof date) // object
</code></pre>
<h3>Date Get æ–¹æ³•</h3>
<p>ä¸‹é¢ä»¥ 2020 å¹´ 12 æœˆ 03 æ—¥ä¸ºä¾‹ï¼š</p>
<ul>
<li>
<p><code>getTime()</code>
è¿”å› 1970 å¹´ 1 æœˆ 1 æ—¥é›¶æ—¶è‡³ä»Šçš„æ¯«ç§’æ•°ã€‚</p>
</li>
<li>
<p><code>getFullYear()</code>
è¿”å› 4 ä½æ•°çš„å¹´ä»½ï¼ˆå¦‚ 2020ï¼‰ã€‚</p>
</li>
<li>
<p><code>getMonth()</code>
è¿”å›æœˆä»½ï¼Œå€¼ä¸º <code>0~11</code> åˆ†åˆ«è¡¨ç¤º 1 æœˆåˆ° 12 æœˆã€‚<strong>æ‰€ä»¥ä¸€èˆ¬è·å–æœˆä»½éƒ½è¦åŠ ä¸€</strong>ã€‚</p>
</li>
<li>
<p><code>getDate()</code>
è¿”å›ä¸€ä¸ªæœˆçš„æŸå¤©ï¼Œå€¼ä¸º <code>1~31</code> åˆ†åˆ«è¡¨ç¤º 1æ—¥åˆ° 31 æ—¥ã€‚</p>
</li>
<li>
<p><code>getDay()</code>
è¿”å›ä¸€å‘¨çš„æŸå¤©ï¼Œå€¼ä¸º <code>0~6</code> åˆ†åˆ«è¡¨ç¤ºå‘¨æ—¥ã€å‘¨ä¸€åˆ°å‘¨å…­ã€‚</p>
</li>
<li>
<p><code>getHours()</code>
è¿”å›å°æ—¶æ•°ï¼Œå€¼ä¸º <code>0 ~ 23</code>ã€‚</p>
</li>
<li>
<p><code>getMinutes()</code>
è¿”å›åˆ†é’Ÿæ•°ï¼Œå€¼ä¸º <code>0 ~ 59</code>ã€‚</p>
</li>
<li>
<p><code>getSeconds()</code>
è¿”å›ç§’æ•°ï¼Œå€¼ä¸º <code>0 ~ 59</code>ã€‚</p>
</li>
<li>
<p><code>getMilliseconds()</code>
è¿”å›æ¯«ç§’æ•°ï¼Œå€¼ä¸º <code>0 ~ 999</code>ã€‚</p>
</li>
</ul>
<blockquote>
<p>**<code>getYear()</code> æ–¹æ³•åœ¨ Web æ ‡å‡†ä¸­å·²è¢«åˆ é™¤ï¼Œå°½ç®¡æŸäº›æµè§ˆå™¨ä»ç„¶æ”¯æŒå®ƒï¼Œä½†å»ºè®®ä¸è¦ç”¨äº†ï¼**å› ä¸ºå®ƒåœ¨ä¸åŒæµè§ˆå™¨çš„è¡¨ç°ä¸ä¸€æ ·ã€‚åƒ Chromeã€Safariã€FireFox è¿”å›çš„æ˜¯ <code>å½“å‰å¹´ä»½ - 1900</code> çš„å€¼ã€‚è€Œåœ¨ IE æµè§ˆå™¨ä¸Šï¼Œå½“å½“å‰å¹´ä»½å¤§äºç­‰äº 2000 æ—¶ï¼Œè¿”å›å€¼æ˜¯å½“å‰ 4 ä½æ•°å¹´ä»½ã€‚ ğŸ‘‰ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/getYear">MDN Date.getYear()</a></p>
</blockquote>
<h3>Date Set æ–¹æ³•</h3>
<ul>
<li>
<p><code>setTime()</code>
ä»¥æ¯«ç§’è®¾ç½® Date å¯¹è±¡ï¼ˆå‚æ•°ï¼š<code>æ¯«ç§’æ•°</code>ï¼‰</p>
</li>
<li>
<p><code>setDate()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­æœˆçš„æŸä¸€å¤©ï¼ˆåˆç†å‚æ•°ï¼š<code>1 ~ 31</code>ï¼Œåˆ†åˆ«è¡¨ç¤º 1 ~ 31 æ—¥ï¼‰</p>
<blockquote>
<p>å¦‚æœå‚æ•°è¶…å‡ºåˆç†èŒƒå›´ï¼Œä¼šç›¸å¯¹åº”çš„æ›´æ–° Date å¯¹è±¡ã€‚</p>
<ul>
<li>å‚æ•°ä¸º <code>0</code> æ—¶ï¼Œåˆ™è®¾ç½®ä¸º<strong>ä¸Šä¸ªæœˆçš„æœ€åä¸€å¤©</strong>ã€‚</li>
<li>å‚æ•°ä¸º <code>è´Ÿæ•°</code> æ—¶ï¼Œåˆ™è®¾ç½®ä¸ºä¸Šä¸ªæœˆæœ€åä¸€å¤©å¾€å‰æ•°è¿™ä¸ªè´Ÿæ•°ç»å¯¹å€¼å¤©æ•°åçš„æ—¥æœŸã€‚ä¾‹å¦‚ï¼š<code>-1</code> ä¼šè®¾ç½®ä¸º<strong>ä¸Šæœˆæœ€åä¸€å¤©çš„å‰ä¸€å¤©</strong>ã€‚</li>
<li>å‚æ•°ä¸º <code>è¶…è¿‡å½“å‰æœˆæœ€å¤§çš„å¤©æ•°</code> æ—¶ï¼Œåˆ™<strong>è¶…å‡ºå¤©æ•°</strong>ï¼ˆ<code>å‚æ•°å€¼ - å½“å‰æœˆå¤©æ•°</code>ï¼‰è®¾ç½®ä¸ºä¸‹ä¸ªæœˆå¯¹åº”æ—¥æœŸã€‚ä¾‹å¦‚ï¼šå½“å‰ Date ä¸º 4 æœˆï¼Œå½“å‚æ•°ä¸º 32 æ—¶ï¼Œåˆ™æ—¥æœŸè¢«è®¾ç½®ä¸º 5 æœˆ 2 æ—¥ã€‚</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p>ä¸‹åˆ— Set æ–¹æ³•åŒç†ã€‚</p>
</blockquote>
<ul>
<li>
<p><code>setMonth()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­æœˆä»½ï¼ˆå‚æ•°ï¼š<code>0 ~ 11</code>ï¼Œåˆ†åˆ«è¡¨ç¤º 1 ~ 12 æœˆä»½ï¼‰</p>
</li>
<li>
<p><code>setFullYear()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­çš„å¹´ä»½ï¼ˆå‚æ•°ï¼š<code>4 ä½æ•°å­—å¹´ä»½</code>ï¼‰</p>
<blockquote>
<p>åŒæ · <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/setYear">setYear()</a> å·²ä» Web æ ‡å‡†ä¸­åˆ é™¤ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>
</blockquote>
</li>
<li>
<p><code>setMilliseconds()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­çš„æ¯«ç§’æ•°ï¼ˆå‚æ•°ï¼š<code>0 ~ 999</code>ï¼‰</p>
<p>è¶…å‡ºåˆç†èŒƒå›´ï¼Œæ—¥æœŸå¯¹è±¡çš„æ—¶é—´ä¼šç›¸åº”åœ°æ›´æ›´æ–°ã€‚ä¾‹å¦‚ 1005ï¼Œç§’æ•°åŠ  1ï¼Œæ¯«ç§’æ•°ä¸º 5ã€‚</p>
</li>
<li>
<p><code>setSeconds()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­çš„ç§’æ•°ï¼ˆå‚æ•°ï¼š<code>0 ~ 59</code>ï¼‰</p>
<p>è¶…å‡ºåˆç†èŒƒå›´ï¼Œæ—¥æœŸå¯¹è±¡çš„æ—¶é—´ä¼šç›¸åº”åœ°æ›´æ›´æ–°ã€‚ä¾‹å¦‚ 100ï¼Œåˆ†é’Ÿæ•°åŠ  1ï¼Œç§’æ•°ä¸º 40ã€‚</p>
</li>
<li>
<p><code>setMinutes()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­çš„ç§’æ•°ï¼ˆå‚æ•°ï¼š<code>0 ~ 59</code>ï¼‰</p>
<p>è¶…å‡ºåˆç†èŒƒå›´ï¼Œæ—¥æœŸå¯¹è±¡çš„æ—¶é—´ä¼šç›¸åº”åœ°æ›´æ›´æ–°ã€‚ä¾‹å¦‚ 60ï¼Œå°æ—¶æ•°åŠ  1ï¼Œç§’æ•°ä¸º 0ã€‚</p>
</li>
<li>
<p><code>setHours()</code>
æ ¹æ®æœ¬åœ°æ—¶é—´è®¾ç½® Date å¯¹è±¡ä¸­çš„å°æ—¶æ•°ï¼ˆå‚æ•°ï¼š<code>0 ~ 23</code>ï¼‰</p>
<p>è¶…å‡ºåˆç†èŒƒå›´ï¼Œæ—¥æœŸå¯¹è±¡çš„æ—¶é—´ä¼šç›¸åº”åœ°æ›´æ›´æ–°ã€‚ä¾‹å¦‚ 24ï¼Œå¤©æ•°åŠ  1ï¼Œå°æ—¶æ•°ä¸º 0ã€‚</p>
</li>
</ul>
<h3>UTC æ—¶é—´</h3>
<p>ä¸Šè¿°æ‰€è®²çš„ Get å’Œ Set æ–¹æ³•æ˜¯é’ˆå¯¹æœ¬åœ°æ—¶åŒºæ—¶é—´å»è·å–ã€è®¾ç½®æ—¶é—´çš„ã€‚è€Œ Date åŒæ ·æä¾›äº†è·å–ã€è®¾ç½® UTC æ—¶é—´ï¼Œæ–¹æ³•å¦‚ï¼š<code>getUTCMonth()</code>ã€<code>setUTCMonth()</code> ç­‰ç­‰ã€‚å®è·µè¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒå°‘æ¶‰åŠ UTC æ—¶é—´ï¼Œæ‰€ä»¥ä¸å±•å¼€èµ˜è¿°ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/setUTCMonth">å¯ä»¥å·å·ç‚¹è¿™é‡Œå»äº†è§£ã€‚</a></p>
<h3>Date å…¶ä»–æ–¹æ³•</h3>
<ul>
<li>
<p><code>Date.now()</code></p>
<p>è¿”å›è‡ª 1970-1-1 00:00:00ï¼ˆUTCï¼‰åˆ°å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°ã€‚</p>
</li>
<li>
<p><code>Date.prototype.toString()</code>ã€<code>Date.prototype.toTimeString()</code>ã€<code>Date.prototype.toDateString()</code></p>
<p>è¿”å›å€¼æ˜¯ä»¥ç¾å¼è‹±è¯­å’Œäººç±»æ˜“è¯»çš„å½¢å¼è¿”å›æ—¥æœŸå¯¹è±¡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚è¯¥å­—ç¬¦ä¸²ç”±<strong>æ—¥æœŸéƒ¨åˆ†</strong>ï¼ˆå¹´æœˆæ—¥ï¼‰å’Œ<strong>æ—¶é—´éƒ¨åˆ†</strong>ï¼ˆæ—¶åˆ†ç§’åŠæ—¶åŒºï¼‰ç»„æˆã€‚</p>
</li>
</ul>
<pre><code class="language-js">const date = new Date()

date.toString() // &quot;Thu Dec 03 2020 18:19:17 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&quot;
date.toDateString() // &quot;Thu Dec 03 2020&quot;
date.toTimeString() // &quot;18:19:17 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&quot;
</code></pre>
<ul>
<li><code>Date.parse()</code>ã€<code>Date.prototype.getTime()</code>ã€<code>Date.prototype.valueOf()</code>
å®ƒä»¬éƒ½è¿”å› 1970-1-1 00:00:00ï¼ˆUTCï¼‰åˆ°æŒ‡å®šæ—¥æœŸçš„æ¯«ç§’æ•°ã€‚ä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚
<blockquote>
<p>å‰è€…ç²¾ç¡®åˆ°<strong>ç§’</strong>ï¼Œè€Œåä¸¤è€…æ˜¯ç²¾ç¡®åˆ°<strong>æ¯«ç§’</strong>ã€‚</p>
</blockquote>
</li>
</ul>
<pre><code class="language-js">const date = new Date('5/24/2020')
date.setMilliseconds(45) // è®¾ç½®æ¯«ç§’æ•°

console.log(date.getTime()) // 1590249600045
console.log(date.valueOf()) // 1590249600045
console.log(Date.parse(date)) // 1590249600000
</code></pre>
<h3>å…¼å®¹æ€§</h3>
<p>ç±»ä¼¼ <code>new Date('xxxx/xx/xx xx:xx:xx')</code> å½¢å¼çš„æ—¶é—´å¯¹è±¡åœ¨ IOS å’Œ Andriod ç³»ç»Ÿä¸Šéƒ½å¯ä»¥è¢«æ­£ç¡®çš„è¯†åˆ«ï¼Œè€Œç±»ä¼¼ <code>new Date('xxxx-xx-xx xx:xx:xx')</code> å½¢å¼çš„æ—¶é—´å¯¹è±¡åœ¨ iOS ç³»ç»Ÿä¸Šæ— æ³•è¢«æ­£ç¡®çš„è¯†åˆ«ï¼Œéœ€è¦åšä¸€å±‚è½¬åŒ–ã€‚</p>
<pre><code>const date = new Date('xxxx-xx-xx xx:xx:xx'.replace(/-/g, '/'))
</code></pre>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date">MDN Date</a></li>
<li><a href="https://juejin.cn/post/6844903941390467080">æ—¥æœŸç›¸å…³ Date</a></li>
<li><a href="https://www.cnblogs.com/tosee/p/5538007.html">GMT ä¸ UTC ç®€ä»‹</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ•°ç»„çš„é«˜é˜¶å‡½æ•° Array.prototype.reduce]]></title>
            <link>https://github.com/toFrankie/blog/issues/225</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/225</guid>
            <pubDate>Sun, 26 Feb 2023 10:50:14 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘åœ¨å†™ React ç³»åˆ—æ–‡ç« ï¼Œå…¶ä¸­å†™åˆ° Redux çš„æ—¶å€™ï¼ˆ<a href="https://www.jianshu.com/p/9fad70e92ac7">è¿™é‡Œ</a>ï¼‰ï¼Œæåˆ°äº†ä¸€ä¸ªå«åš <code>compose</code> çš„é«˜é˜¶å‡½æ•°ï¼Œ å®ƒé‡Œé¢ç”¨åˆ°çš„å°±æ˜¯ <a href="https://develop]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘åœ¨å†™ React ç³»åˆ—æ–‡ç« ï¼Œå…¶ä¸­å†™åˆ° Redux çš„æ—¶å€™ï¼ˆ<a href="https://www.jianshu.com/p/9fad70e92ac7">è¿™é‡Œ</a>ï¼‰ï¼Œæåˆ°äº†ä¸€ä¸ªå«åš <code>compose</code> çš„é«˜é˜¶å‡½æ•°ï¼Œ å®ƒé‡Œé¢ç”¨åˆ°çš„å°±æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array.prototype.reduce</a> æ–¹æ³•ã€‚å®ƒçš„æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// https://github.com/reduxjs/redux/blob/4.x/src/compose.js
export default function compose(...funcs) {
  if (funcs.length === 0) {
    return arg =&gt; arg
  }

  if (funcs.length === 1) {
    return funcs[0]
  }

  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))
}
</code></pre>
<p>å…¶å®ç±»ä¼¼çš„ç»„åˆå‡½æ•°ï¼Œå¾ˆå¤šéƒ½æ˜¯ä½¿ç”¨åˆ° <code>Array.prototype.reduce</code> æ–¹æ³•ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¹³æ—¶æ¯”è¾ƒå°‘ç”¨åˆ°å®ƒï¼Œå°±æ²¡å¥½å¥½æ•´ç†è¿‡çŸ¥è¯†ç‚¹ï¼Œä½†æœ€è¿‘æˆ‘è®¤ä¸ºï¼Œè¿™æ˜¯å¿…é¡»æŒæ¡è€Œä¸”ç”¨èµ·æ¥çš„æ–¹æ³•ã€‚</p>
<p>To be continue...</p>
<h3>ä¸€ã€reduce æ–¹æ³•</h3>
<p>å®ƒæ˜¯ ES5 æä¾›çš„ä¸€ä¸ªæ•°ç»„åŸç”Ÿçš„æ–¹æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>arr.reduce(reducer, [initialValue])</p>
</blockquote>
<p><strong>å‚æ•°</strong></p>
<ul>
<li>
<p><strong>reducer</strong>ï¼šæ˜¯æ‰§è¡Œæ•°ç»„ä¸­æ¯ä¸ªå€¼ï¼ˆå¦‚æœæ²¡æœ‰æä¾› <code>initialValue</code> åˆ™ç¬¬ä¸€ä¸ªå€¼é™¤å¤–ï¼‰çš„å‡½æ•°ã€‚</p>
</li>
<li>
<p><strong>initialValue</strong>ï¼ˆå¯é€‰ï¼‰ï¼šä½œä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ <code>reducer</code> å‡½æ•°æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚å¦‚æœæ²¡æœ‰æä¾›åˆå§‹å€¼ï¼Œåˆ™å°†ä½¿ç”¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚åœ¨æ²¡æœ‰åˆå§‹å€¼çš„ç©ºæ•°ç»„ä¸Šè°ƒç”¨ <code>reduce</code> æ–¹æ³•å°†æŠ¥é”™ã€‚</p>
</li>
</ul>
<p><strong>è¿”å›å€¼</strong></p>
<p>å‡½æ•°ç´¯è®¡å¤„ç†çš„ç»“æœ</p>
<pre><code class="language-js">const arr1 = [1, 2, 3, 4]
const arr2 = []
const arr3 = new Array(10)

const reducer = (acc, cur) =&gt; {
  console.log(`acc: ${acc}, cur: ${cur}`)
  return acc + cur
}

// (1) æ˜¯å¦å«åˆå§‹å€¼çš„åŒºåˆ«
const sum1 = arr1.reduce(reducer) // å¾ªç¯ä¸‰æ¬¡ï¼ˆreduceæ²¡æœ‰åˆå§‹å€¼ï¼Œæ•°ç»„ç¬¬ä¸€é¡¹è¢«ä½œä¸º acc çš„åˆå§‹å€¼ï¼‰
const sum2 = arr1.reduce(reducer, 0) // å¾ªç¯å››æ¬¡

// (2) ç©ºæ•°ç»„è®¿é—® reduce æ–¹æ³•ï¼Œå¿…é¡»ä¼ åˆå§‹å€¼ï¼Œå¦åˆ™æŠ¥é”™
const sum3 = arr2.reduce(reducer, 0) // åˆå§‹å€¼ 0 ä½œä¸ºè¿”å›ç»“æœï¼Œä¸”ä¸æ‰§è¡Œ reducer
const sum4 = arr2.reduce(reducer) // è¿è¡ŒæŠ¥é”™

// (3) åŒç†
const sum5 = arr3.reduce(reducer, 0) // åˆå§‹å€¼ 0 ä½œä¸ºè¿”å›ç»“æœï¼Œä»æœªè¢«èµ‹å€¼çš„å…ƒç´ ä¸æ‰§è¡Œ reducer
const sum6 = arr3.reduce(reducer) // è¿è¡ŒæŠ¥é”™

console.log(sum1, sum2, sum3, sum4, sum5, sum6)
</code></pre>
<h3>äºŒã€reducer å‡½æ•°</h3>
<blockquote>
<p>arr.reduce(reducer(accumulator, currentValue, index, array), initialValue)</p>
</blockquote>
<p>å®ƒæœ‰å››ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>
<p><strong>accumulator</strong>ï¼šç´¯è®¡å™¨å›è°ƒçš„è¿”å›å€¼ã€‚å®ƒæ˜¯ä¸Šä¸€æ¬¡è°ƒç”¨å›è°ƒæ—¶è¿”å›çš„ç´¯è®¡å€¼ã€‚è‹¥å®ƒæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œå®ƒçš„å€¼å°±æ˜¯ <code>initialValue</code> æˆ–è€…æ•°ç»„çš„ç¬¬ä¸€é¡¹ï¼ˆç»“åˆä¸Šé¢çš„ç†è§£ï¼‰ã€‚<strong>åƒä¸‡ä¸è¦è¢«å®ƒçš„å‘½åå“åˆ°ï¼Œå¦‚æœçœŸæ˜¯è¿™æ ·ï¼Œå°±æŠŠå®ƒå½“åšå‚æ•° <code>a</code> æˆ– <code>b</code> æˆ– <code>c</code> çœ‹å¾…ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªå­˜å‚¨ä¹‹å‰æ‰§è¡Œç»“æœçš„å˜é‡è€Œå·²ã€‚</strong></p>
</li>
<li>
<p><strong>currentValue</strong>ï¼šå½“å‰æ­£åœ¨éå†çš„æ•°ç»„å…ƒç´ ã€‚</p>
</li>
<li>
<p><strong>index</strong>ï¼ˆå¯é€‰ï¼‰ï¼šå½“å‰æ­£åœ¨éå†çš„æ•°ç»„å…ƒç´ çš„ç´¢å¼•ã€‚è‹¥æä¾›äº† <code>initialValue</code>ï¼Œåˆ™èµ·å§‹ç´¢å¼•æ˜¯ <code>0</code>ï¼Œå¦åˆ™ä»ç´¢å¼• <code>1</code> èµ·å§‹ã€‚</p>
</li>
<li>
<p><strong>array</strong>ï¼ˆå¯é€‰ï¼‰ï¼šè°ƒç”¨ <code>reduce()</code> çš„æ•°ç»„</p>
</li>
</ul>
<h3>ä¸‰ã€MDN å®˜æ–¹æè¿°</h3>
<p><code>reduce</code> ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¾æ¬¡æ‰§è¡Œ <code>reducer</code> å‡½æ•°ï¼Œ<strong>ä¸åŒ…æ‹¬æ•°ç»„ä¸­è¢«åˆ é™¤æˆ–ä»æœªè¢«èµ‹å€¼çš„å…ƒç´ </strong>ï¼Œæ¥å—å››ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>accumulator ç´¯è®¡å™¨</code></li>
<li><code>currentValue å½“å‰å€¼</code></li>
<li><code>currentIndex å½“å‰ç´¢å¼•</code></li>
<li><code>array æ•°ç»„</code></li>
</ul>
<p>å›è°ƒå‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œ<code>accumulator</code>Â å’Œ <code>currentValue</code> çš„å–å€¼æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>å¦‚æœè°ƒç”¨ <code>reduce()</code> æ—¶æä¾›äº† <code>initialValue</code>ï¼Œ<code>accumulator</code> å–å€¼ä¸º <code>initialValue</code>ï¼Œ<code>currentValue</code> å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼›</li>
<li>å¦‚æœæ²¡æœ‰æä¾›Â <code>initialValue</code>ï¼Œé‚£ä¹ˆ <code>accumulator</code> å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œ<code>currentValue</code> å–æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå€¼ã€‚</li>
</ol>
<blockquote>
<p>**æ³¨æ„ï¼š**å¦‚æœæ²¡æœ‰æä¾› <code>initialValue</code>ï¼Œ<code>reduce</code> ä¼šä»ç´¢å¼• <code>1</code> çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œ <code>reducer</code> æ–¹æ³•ï¼Œè·³è¿‡ç¬¬ä¸€ä¸ªç´¢å¼•ã€‚å¦‚æœæä¾› <code>initialValue</code>ï¼Œä»ç´¢å¼• <code>0</code> å¼€å§‹ã€‚</p>
</blockquote>
<p>å¦‚æœæ•°ç»„ä¸ºç©ºä¸”æ²¡æœ‰æä¾› <code>initialValue</code>ï¼Œä¼šæŠ›å‡º <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypeError"><code>TypeError</code></a>Â ã€‚å¦‚æœæ•°ç»„ä»…æœ‰ä¸€ä¸ªå…ƒç´ ï¼ˆæ— è®ºä½ç½®å¦‚ä½•ï¼‰å¹¶ä¸”æ²¡æœ‰æä¾› <code>initialValue</code>ï¼Œ æˆ–è€…æœ‰æä¾› <code>initialValue</code> ä½†æ˜¯æ•°ç»„ä¸ºç©ºï¼Œé‚£ä¹ˆæ­¤å”¯ä¸€å€¼å°†è¢«è¿”å›å¹¶ä¸” <code>reducer</code> ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>*è¿™ä¸€å°èŠ‚è·Ÿä¸Šé¢çš„æ˜¯æœ‰é‡å¤çš„ã€‚</p>
<p>å°±æœ¬èŠ‚å†…å®¹ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">// åœ¨ Array åŸå‹ä¸Šæ·»åŠ ä¸€ä¸ª delete æ–¹æ³•ï¼šç”¨äºåˆ é™¤æ•°ç»„æŸé¡¹
Array.prototype.delete = function (item) {
  for (let i = 0; i &lt; this.length; i++) {
    if (this[i] === item) {
      this.splice(i, 1)
      return this
    }
  }
  return this
}

const arr1 = new Array(10)
const arr2 = [1, 2, undefined, null]
const arr3 = [1, 2, 3, 4]

const reducer = (acc, cur, index, arr) =&gt; {
  // åˆ é™¤ arr3 æ•°ç»„çš„ç¬¬äºŒé¡¹
  if (index === 0 &amp;&amp; arr === arr3) arr.delete(2)
  return `${acc} - ${cur}`
}

const sum1 = arr1.reduce(reducer, 0) // è¿”å›ï¼š0
const sum2 = arr2.reduce(reducer, 0) // è¿”å›ï¼š0 - 1 - 2 - undefined - null
const sum3 = arr3.reduce(reducer, 0) // è¿”å›ï¼š0 - 1 - 3 - 4

// ç»“è®ºï¼š
// 1. ç©ºé¡¹ï¼ˆæœªè¢«èµ‹å€¼é¡¹ï¼‰ä¸æ‰§è¡Œ reducer ï¼Œè€Œ undefinedã€null ä¼šæ‰§è¡Œ reducer
// 2. è¢«åˆ é™¤é¡¹ï¼Œä¸æ‰§è¡Œ reducer
// PS: ç”±äºæˆ‘ç»å¸¸è¢«å„ç§æ–¹æ³•å¯¹ undefinedã€nullã€emptyï¼ˆç©ºé¡¹ï¼‰æ‰§ä¸æ‰§è¡Œå›°æ‰°ï¼Œæ‰€ä»¥æˆ‘å°±å…¨åˆ—ä¸¾å‡ºæ¥äº†ã€‚
</code></pre>
<h3>å››ã€åº”ç”¨åœºæ™¯</h3>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ASI æœºåˆ¶è¯¦è§£ï¼Œä¸ç”¨å†çº ç»“åˆ†å·é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/223</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/223</guid>
            <pubDate>Sun, 26 Feb 2023 10:43:12 GMT</pubDate>
            <description><![CDATA[<h2>å‰è¨€</h2>
<p>å…³äºè¦ä¸è¦åŠ åˆ†å·çš„é—®é¢˜ï¼Œå…¶å®æœ‰å¾ˆå¤šäº‰è®ºï¼æœ‰çš„åšæŒåŠ åˆ†å·ï¼Œè€Œæœ‰çš„ä¸å–œæ¬¢åŠ åˆ†å·...ä½†æ˜¯æ— è®ºé‚£ç§é£æ ¼ï¼Œéƒ½ä¸èƒ½ç™¾åˆ†ç™¾é¿å…æŸäº›ç‰¹æ®Šæƒ…å†µäº§ç”Ÿçš„é—®é¢˜ï¼Œç©¶å…¶æ ¹æœ¬å°±æ˜¯å› ä¸ºå¯¹ JavaScript è§£æå’Œ ASI è§„åˆ™çš„ä¸äº†è§£ã€‚</p>
<p>å¯¹äºæ­¤é—®é¢˜ï¼Œçœ‹çœ‹å‡ ä½å¤§ä½¬æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>
<ul>
<li>]]></description>
            <content:encoded><![CDATA[<h2>å‰è¨€</h2>
<p>å…³äºè¦ä¸è¦åŠ åˆ†å·çš„é—®é¢˜ï¼Œå…¶å®æœ‰å¾ˆå¤šäº‰è®ºï¼æœ‰çš„åšæŒåŠ åˆ†å·ï¼Œè€Œæœ‰çš„ä¸å–œæ¬¢åŠ åˆ†å·...ä½†æ˜¯æ— è®ºé‚£ç§é£æ ¼ï¼Œéƒ½ä¸èƒ½ç™¾åˆ†ç™¾é¿å…æŸäº›ç‰¹æ®Šæƒ…å†µäº§ç”Ÿçš„é—®é¢˜ï¼Œç©¶å…¶æ ¹æœ¬å°±æ˜¯å› ä¸ºå¯¹ JavaScript è§£æå’Œ ASI è§„åˆ™çš„ä¸äº†è§£ã€‚</p>
<p>å¯¹äºæ­¤é—®é¢˜ï¼Œçœ‹çœ‹å‡ ä½å¤§ä½¬æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>
<ul>
<li><a href="https://www.zhihu.com/question/20298345/answer/49551142">å°¤é›¨æºª</a></li>
<li><a href="https://www.zhihu.com/question/20298345/answer/14670020">è´ºå¸ˆä¿Š</a></li>
</ul>
<blockquote>
<p>æ‰€æœ‰ç›´è§‰æ€§çš„ â€œå½“ç„¶åº”è¯¥åŠ åˆ†å·â€ éƒ½æ˜¯ä¿å®ˆçš„ã€æœªç»æ·±å…¥æ€è€ƒçš„è‰ç‡ç»“è®ºã€‚</p>
</blockquote>
<blockquote>
<p>ä¸ªäººç«‹åœºæ˜¯åå‘ semicolon-less é£æ ¼ï¼Œå¯èƒ½æ˜¯å¼ºè¿«ç—‡ä½¿ç„¶ï¼Œè¿˜æœ‰åŠ äº†ä¹Ÿé¿å…ä¸äº†ç‰¹æ®Šæƒ…å†µã€‚</p>
</blockquote>
<h2>ASI æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>æŒ‰ç…§ ECMAScript æ ‡å‡†ï¼Œä¸€äº›<strong>ç‰¹å®šè¯­å¥</strong>ï¼ˆstatementï¼‰å¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚åˆ†å·ä»£è¡¨è¿™æ®µè¯­å¥çš„ç»ˆæ­¢ã€‚ä½†æ˜¯æœ‰æ—¶å€™ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™äº›åˆ†å·æ˜¯æœ‰å¯ä»¥çœç•¥çš„ã€‚è¿™ç§æƒ…å†µä¸‹è§£æå™¨ä¼šè‡ªå·±åˆ¤æ–­è¯­å¥è¯¥åœ¨å“ªé‡Œç»ˆæ­¢ã€‚è¿™ç§è¡Œä¸ºè¢«å«åšã€Œ<strong>è‡ªåŠ¨æ’å…¥åˆ†å·</strong>ã€ï¼Œç®€ç§° <strong>ASI</strong>ï¼ˆ<a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-automatic-semicolon-insertion">Automatic Semicolon Insertion</a>ï¼‰ã€‚</p>
<blockquote>
<p>å®é™…ä¸Šåˆ†å·å¹¶æ²¡æœ‰çœŸçš„è¢«æ’å…¥ï¼Œåªæ˜¯ä¾¿äºè§£é‡Šçš„å½¢è±¡è¯´æ³•ã€‚</p>
</blockquote>
<p>è¿™äº›ç‰¹å®šçš„è¯­å¥æœ‰ï¼š</p>
<ul>
<li><code>ç©ºè¯­å¥</code></li>
<li><code>let</code></li>
<li><code>const</code></li>
<li><code>import</code></li>
<li><code>export</code></li>
<li><code>å˜é‡èµ‹å€¼</code></li>
<li><code>è¡¨è¾¾å¼</code></li>
<li><code>dubugger</code></li>
<li><code>continue</code></li>
<li><code>break</code></li>
<li><code>return</code></li>
<li><code>throw</code></li>
</ul>
<p>ASI ä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å»åˆ¤æ–­ï¼Œåº”è¯¥åœ¨å“ªé‡Œæ’å…¥åˆ†å·ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ JavaScript æ˜¯å¦‚ä½•è§£æä»£ç çš„ã€‚</p>
<h2>Token</h2>
<p>è§£æå™¨åœ¨è§£æä»£ç æ—¶ï¼Œä¼šæŠŠä»£ç åˆ†æˆå¾ˆå¤š <code>token</code>ï¼Œä¸€ä¸ª <code>token</code> ç›¸å½“äºä¸€å°æ®µæœ‰ç‰¹å®šæ„ä¹‰çš„è¯­æ³•ç‰‡æ®µã€‚</p>
<p>çœ‹ä¾‹å­ï¼š</p>
<pre><code class="language-js">var a = 12;
</code></pre>
<p>é€šè¿‡ <a href="https://esprima.org/demo/parse.html#">Esprima Parser</a> å¯ä»¥çœ‹åˆ°è¢«æ‹†åˆ†ä¸ºå¤šä¸ª <code>token</code>ã€‚</p>
<pre><code class="language-json">[
  {
    &quot;type&quot;: &quot;Keyword&quot;,
    &quot;value&quot;: &quot;var&quot;
  },
  {
    &quot;type&quot;: &quot;Identifier&quot;,
    &quot;value&quot;: &quot;a&quot;
  },
  {
    &quot;type&quot;: &quot;Punctuator&quot;,
    &quot;value&quot;: &quot;=&quot;
  },
  {
    &quot;type&quot;: &quot;Numeric&quot;,
    &quot;value&quot;: &quot;12&quot;
  },
  {
    &quot;type&quot;: &quot;Punctuator&quot;,
    &quot;value&quot;: &quot;;&quot;
  }
]
</code></pre>
<p>ä»¥ä¸Šå˜é‡å£°æ˜è¯­å¥å¯ä»¥åˆ†æˆäº”ä¸ª <code>token</code>ï¼š</p>
<ul>
<li><code>var</code> å…³é”®å­—</li>
<li><code>a</code> æ ‡è¯†ç¬¦</li>
<li><code>=</code> æ ‡ç‚¹ç¬¦å·</li>
<li><code>12</code> æ•°å­—</li>
<li><code>;</code> æ ‡ç‚¹ç¬¦å·</li>
</ul>
<p>è§£æå™¨åœ¨è§£æè¯­å¥æ—¶ï¼Œä¼šä¸€ä¸ªä¸€ä¸ªåœ°è¯»å…¥ <code>token</code> å°è¯•æ„æˆç»™ä¸€ä¸ªå®Œæ•´çš„è¯­å¥ï¼ˆstatementï¼‰ï¼Œç›´åˆ°ç¢°åˆ°ç‰¹å®šæƒ…å†µï¼ˆä¾‹å¦‚è¯­æ³•è§„å®šçš„ç»ˆæ­¢ï¼‰æ‰ä¼šè®¤ä¸ºè¿™ä¸ªè¯­å¥ç»“æŸäº†ã€‚è¿™ä¸ªä¾‹å­ä¸­çš„ç»ˆæ­¢ç¬¦å°±æ˜¯<strong>åˆ†å·</strong>ã€‚ç”¨ <code>token</code> æ„æˆè¯­å¥çš„è¿‡ç¨‹ç±»ä¼¼äºæ­£åˆ™é‡Œçš„è´ªå©ªåŒ¹é…ï¼Œè§£é‡Šå™¨æ€»æ˜¯è¯•å›¾ç”¨å°½å¯èƒ½å¤šçš„ <code>token</code> æ„æˆè¯­å¥ã€‚</p>
<p><strong>æ•²é‡ç‚¹ï¼ï¼ï¼</strong></p>
<p>ä»»æ„ <code>token</code> ä¹‹é—´éƒ½å¯ä»¥æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ¢è¡Œç¬¦ï¼ˆLine Terminatorï¼‰ï¼Œè¿™å®Œå…¨ä¸ä¼šå½±å“ JavaScript çš„è§£æã€‚</p>
<pre><code class="language-js">var
a
=

// å‡è®¾è¿™é‡Œæœ‰ N ä¸ªæ¢è¡Œç¬¦

12
;
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ï¼Œè·Ÿä¹‹å‰å•è¡Œ <code>var a = 12;</code> æ˜¯ç­‰ä»·çš„ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥è®©å¼€å‘è€…é€šè¿‡å¢åŠ ä»£ç çš„å¯è¯»æ€§ï¼Œæ›´çµæ´»åœ°ç»„ç»‡è¯­è¨€é£æ ¼ã€‚å¹³æ—¶å†™çš„è·¨å¤šè¡Œæ•°ç»„ã€å­—ç¬¦ä¸²æ‹¼æ¥ã€é“¾å¼è°ƒç”¨ç­‰éƒ½å±äºè¿™ä¸€ç±»ã€‚</p>
<p>å½“ç„¶äº†ï¼Œåœ¨çœç•¥åˆ†å·çš„é£æ ¼ä¸­ï¼Œè¿™ç§ç‰¹æ€§ä¼šå¯¼è‡´ä¸€äº›æ„å¤–çš„æƒ…å†µã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">var a
  , b = 12
  , hi = 2
  , g = {exec: function() { return 3 }}

a = b
/hi/g.exec('hi')

console.log(a)

// æ‰“å°å‡º 2, å› ä¸ºä»£ç ä¼šè¢«è§£ææˆï¼š
// a = b / hi / g.exec('hi');
// a = 12 / 2 / 3
</code></pre>
<p>ä»¥ä¸Šä¾‹å­ï¼Œä»¥ <code>/</code> å¼€å¤´çš„æ­£åˆ™è¡¨è¾¾å¼è¢«è§£æå™¨ç†è§£æˆé™¤æ³•è¿ç®—ï¼Œæ‰€ä»¥æ‰“å°ç»“æœæ˜¯ <code>2</code>ã€‚</p>
<p>å…¶å®ï¼Œè¿™ä¸æ˜¯çœç•¥åˆ†å·é£æ ¼çš„é”™è¯¯ï¼Œè€Œæ˜¯å¼€å‘è€…æ²¡æœ‰ç†è§£ JavaScript è§£æå™¨çš„å·¥ä½œåŸç†ã€‚å¦‚æœä½ åå‘äºçœç•¥åˆ†å·çš„ï¼Œé‚£æ›´è¦ç†è§£ ASI çš„åŸç†äº†ã€‚</p>
<h2>ASI è§„åˆ™</h2>
<p>ECMAScript æ ‡å‡†å®šä¹‰çš„ ASI åŒ…æ‹¬<strong>ä¸‰æ¡è§„å®š</strong>å’Œ<strong>ä¸¤æ¡ä¾‹å¤–</strong>ã€‚</p>
<h3>ä¸‰æ¡è§„åˆ™</h3>
<ol>
<li>è§£æå™¨ä»å·¦å¾€å³è§£æä»£ç ï¼ˆè¯»å…¥ <code>token</code>ï¼‰ï¼Œå½“ç¢°åˆ°ä¸€ä¸ªä¸èƒ½æ„æˆåˆæ³•è¯­å¥çš„ <code>token</code> æ—¶ï¼Œä»–ä¼šåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸­ï¼Œåœ¨è¯¥ <code>token</code> ä¹‹å‰æ’å…¥åˆ†å·ï¼Œæ­¤æ—¶ä¸åˆç¾¤çš„ <code>token</code> è¢«ç§°ä¸º<code>è¿è§„ token</code> ï¼ˆ<code>offending token</code>ï¼‰
<ul>
<li>1.1 å¦‚æœè¿™ä¸ª <code>token</code> è·Ÿä¸Šä¸€ä¸ª <code>token</code> ä¹‹é—´æœ‰è‡³å°‘ä¸€ä¸ªæ¢è¡Œã€‚</li>
<li>1.2 å¦‚æœè¿™ä¸ª <code>token</code> æ˜¯ <code>}</code>ã€‚</li>
<li>1.3 å¦‚æœå‰ä¸€ä¸ª <code>token</code> æ˜¯ <code>)</code> å®ƒä¼šè¯•å›¾æŠŠç­¾åçš„ <code>token</code> ç†è§£æˆ <code>do-while</code> è¯­å¥å¹¶æ’å…¥åˆ†å·ã€‚</li>
</ul>
</li>
<li>å½“è§£æåˆ°æ–‡ä»¶æœ«å°¾å‘ç°è¯­æ³•è¿˜æ˜¯æ— æ³•æ„æˆåˆæ³•çš„è¯­å¥ï¼Œå°±ä¼šåœ¨æ–‡ä»¶æœ«å°¾æ’å…¥åˆ†å·ã€‚</li>
<li>å½“è§£æç¢°åˆ° <code>restricted production</code> çš„è¯­æ³•ï¼ˆæ¯”å¦‚ <code>return</code>ï¼‰ï¼Œå¹¶ä¸”åœ¨ <code>restricted production </code>è§„å®šçš„ <code>[no LineTerminator here]</code> çš„åœ°æ–¹å‘ç°æ¢è¡Œï¼Œé‚£ä¹ˆæ¢è¡Œçš„åœ°æ–¹å°±ä¼šè¢«æ’å…¥åˆ†å·ã€‚</li>
</ol>
<h3>ä¸¤ä¸ªä¾‹å¤–</h3>
<ol>
<li>åˆ†å·ä¸èƒ½è¢«è§£ææˆç©ºè¯­å¥ã€‚</li>
<li>åˆ†å·ä¸èƒ½è¢«è§£ææˆ <code>for</code> è¯­å¥çš„ä¸¤ä¸ªåˆ†å·ä¹‹ä¸€ã€‚</li>
</ol>
<p>åˆ°è¿™é‡Œï¼Œå¥½åƒè§„åˆ™æŒºæ™¦æ¶©çš„ã€‚å…ˆåˆ«æ…Œï¼Œçœ‹å®Œä¸‹é¢çš„ä¾‹å­å°±èƒ½æ˜ç™½å…¶ä¸­çš„å«ä¹‰äº†ã€‚</p>
<h2>ä¸¾ä¾‹è¯´æ˜</h2>
<p>å°±ä»¥ä¸Šè§„åˆ™ï¼Œä¸¾ä¾‹è¯´æ˜åŠ©äºç†è§£ã€‚</p>
<h3>ä¾‹ä¸€ï¼šæ¢è¡Œ</h3>
<pre><code class="language-js">a
b
</code></pre>
<p>è§£æå™¨ä¸€ä¸ªä¸€ä¸ªè¯»å– <code>token</code>ï¼Œä½†è¯»åˆ°ç¬¬äºŒä¸ª <code>token b</code> æ—¶ï¼Œå®ƒå°±å‘ç°æ²¡æ³•æ„æˆåˆæ³•çš„è¯­å¥ï¼Œç„¶åå®ƒå‘ç° <code>token b</code> å’Œä¸Šä¸€ä¸ª <code>token a</code> æ˜¯æœ‰æ¢è¡Œçš„ï¼Œäºæ˜¯æŒ‰ç…§ <code>è§„åˆ™ 1.1</code> çš„å¤„ç†ï¼Œåœ¨ <code>token b</code> ä¹‹å‰æ’å…¥åˆ†å·å˜æˆ <code>a\n;b</code>ï¼Œè¿™æ ·è¯­æ³•å°±åˆæ³•äº†ã€‚æ¥ç€ç»§ç»­è¯»å– <code>token</code>ï¼Œè¿™æ—¶è¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼Œ<code>token b</code> è¿˜æ˜¯ä¸èƒ½æ„æˆåˆæ³•çš„è¯­å¥ï¼Œè¿™æ˜¯æŒ‰ç…§ <code>è§„åˆ™ 2</code> å¤„ç†ï¼Œåœ¨æœ«å°¾æ’å…¥åˆ†å·ç»ˆæ­¢ã€‚æ•…å¾—åˆ°ï¼š</p>
<pre><code class="language-js">a
;b;
</code></pre>
<h3>ä¾‹äºŒï¼šå¤§æ‹¬å·</h3>
<pre><code class="language-js">{ a } b
</code></pre>
<p>è§£æå™¨ä»ç„¶ä¸€ä¸ªä¸€ä¸ªè¯»å– <code>token</code>ï¼Œè¯»åˆ° <code>token }</code> æ—¶ï¼Œå®ƒå‘ç° <code>{ a }</code> æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸º <code>a</code> æ˜¯è¡¨è¾¾å¼ï¼Œå®ƒå¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚ä½†æ˜¯å½“å‰ <code>token</code> æ˜¯ <code>}</code>ï¼Œæ‰€ä»¥æŒ‰ç…§ <code>è§„åˆ™ 1.2</code> å¤„ç†ï¼Œä»–åœ¨ <code>}</code> å‰é¢æ’å…¥åˆ†å·å˜æˆ <code>{ a; }</code>ï¼Œæ¥ç€å¾€åè¯»å– <code>token b</code>ï¼ŒæŒ‰ç…§ <code>è§„åˆ™ 2</code> ç»™ <code>b</code> åŠ ä¸Šåˆ†å·ã€‚æ•…å¾—åˆ°ï¼š</p>
<pre><code class="language-js">{ a; } b;
</code></pre>
<blockquote>
<p>å¦å¤–ï¼Œä¹Ÿè®¸æœ‰äººä¼šè®¤ä¸ºæ˜¯ <code>{ a; };</code> ï¼Œä½†ä¸æ˜¯è¿™æ ·çš„ã€‚å› ä¸º <code>{...}</code> å±äºå—è¯­å¥ï¼Œè€ŒæŒ‰ç…§å®šä¹‰å—è¯­å¥æ˜¯ä¸éœ€è¦åˆ†å·ç»“å°¾çš„ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯åœ¨ä¸€è¡Œã€‚å› ä¸ºå—è¯­å¥ä¹Ÿè¢«ç”¨åœ¨å…¶ä»–åœ°æ–¹ï¼ˆæ¯”å¦‚å‡½æ•°å£°æ˜ï¼‰ï¼Œæ‰€ä»¥ä¸‹é¢ä»£ç æ˜¯å®Œå…¨åˆæ³•çš„ï¼Œä¸éœ€è¦ä»»ä½•çš„åˆ†å·ã€‚</p>
</blockquote>
<pre><code class="language-js">function a() {} function b() {}
</code></pre>
<h3>ä¾‹ä¸‰ï¼šdo-while è¯­å¥</h3>
<p>è¿™ä¸ªæ˜¯ä¸ºäº†è§£é‡Š <code>è§„åˆ™ 1.3</code>ï¼Œè¿™æ˜¯æœ€ç»•çš„åœ°æ–¹ã€‚</p>
<pre><code class="language-js">do a; while(b) c
</code></pre>
<p>è¿™ä¾‹å­ç§è§£æåˆ° <code>token c</code> çš„æ—¶å€™å°±ä¸å¯¹äº†ã€‚è¿™é‡Œæ—¢æ²¡æœ‰ <code>æ¢è¡Œ</code>ï¼Œä¹Ÿæ²¡æœ‰ <code>}</code>ï¼Œä½† <code>token c</code> å‰é¢æ˜¯ <code>token )</code> ï¼Œæ‰€ä»¥è§£æå™¨æŠŠä¹‹å‰çš„ <code>token</code> ç»„æˆä¸€ä¸ªè¯­å¥ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦ä¸º <code>do-while</code> è¯­å¥ï¼Œç»“æœæ­£å¥½æ˜¯çš„ï¼Œäºæ˜¯è‡ªåŠ¨æ’å…¥åˆ†å·å˜æˆ <code>do a; whiile(b);</code>ï¼Œè¿™ç§ç»™ <code>token c</code> åŠ ä¸Šåˆ†å·ã€‚æ•…å¾—åˆ°ï¼š</p>
<pre><code class="language-js">do a; while(b); c;
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œ<code>do-while</code> åé¢çš„åˆ†å·æ˜¯è‡ªåŠ¨æ’å…¥çš„ã€‚ä½†æ˜¯å¦‚æœå…¶ä»–ä»¥ <code>)</code> ç»“å°¾çš„æƒ…å†µå°±ä¸è¡Œäº†ã€‚<code>è§„åˆ™ 1.3</code> å°±æ˜¯ä¸º <code>do-while</code> é‡èº«å®šåšçš„ã€‚</p>
<h3>ä¾‹å››ï¼šreturn</h3>
<pre><code class="language-js">return
a
</code></pre>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ <code>return</code> å’Œ <code>è¿”å›å€¼</code> ä¹‹é—´ä¸èƒ½æ¢è¡Œï¼Œå› ä¸ºä¸Šé¢ä»£ç ä¼šè§£ææˆï¼š</p>
<pre><code class="language-js">return;
a;
</code></pre>
<p>ä½†ä¸ºä»€ä¹ˆä¸èƒ½æ¢è¡Œå‘¢ï¼Ÿæ˜¯å› ä¸º <code>return</code> è¯­å¥å°±æ˜¯ä¸€ä¸ª <code>restricted production</code> è¯­æ³•ã€‚<code>restricted production</code> æ˜¯ä¸€ç»„æœ‰ä¸¥æ ¼é™å®šçš„è¯­æ³•çš„ç»Ÿç§°ï¼Œè¿™äº›è¯­æ³•éƒ½æ˜¯åœ¨æŸä¸ªåœ°æ–¹ä¸èƒ½æ¢è¡Œçš„ï¼Œä¸èƒ½æ¢è¡Œçš„åœ°æ–¹ä¼šè¢«æ ‡æ³¨ <code>[no LineTermiator here]</code>ã€‚</p>
<p>æ¯”å¦‚ ECMAScript çš„ <code>return</code> è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">return [no LineTerminator here] Expression;
</code></pre>
<p><strong>è¿™è¡¨ç¤º <code>return</code> è·Ÿè¡¨è¾¾å¼ä¹‹é—´æ˜¯ä¸å…è®¸æ¢è¡Œçš„ï¼ˆä½†åé¢çš„è¡¨è¾¾å¼å†…éƒ¨å¯ä»¥æ¢è¡Œï¼‰</strong>ã€‚å¦‚æœè¿™ä¸ªåœ°æ–¹æ°å¥½æœ‰æ¢è¡Œï¼ŒASI å°±ä¼šè‡ªåŠ¨æ’å…¥åˆ†å·ï¼Œè¿™å°±æ˜¯ <code>è§„åˆ™ 3</code> çš„å«ä¹‰ã€‚</p>
<p>åˆšæ‰æˆ‘ä»¬è¯´äº† <code>restricted production</code> æ˜¯ä¸€ç»„è¯­æ³•çš„ç»Ÿç§°ï¼Œå®ƒä¸€å…±åŒ…å«ä¸‹é¢å‡ ä¸ªè¯­æ³•ï¼š</p>
<ul>
<li>åç¼€è¡¨è¾¾å¼ <code>++</code> å’Œ <code>--</code></li>
<li><code>return</code></li>
<li><code>continue</code></li>
<li><code>break</code></li>
<li><code>throw</code></li>
<li>ES6 çš„ç®­å¤´å‡½æ•°ï¼ˆå‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œï¼‰</li>
<li><code>yield</code></li>
</ul>
<p>è¿™äº›æ— éœ€æ­»è®°ï¼Œå› ä¸ºæŒ‰ç…§ä¸€èˆ¬çš„ä¹¦å†™ä¹ æƒ¯ï¼Œå‡ ä¹æ²¡æœ‰äººä¼šè¿™æ ·æ¢è¡Œçš„ã€‚é¡ºå¸¦ä¸€æï¼Œ<code>continue</code> å’Œ <code>break</code> åé¢æ˜¯å¯ä»¥æ¥ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/break">label</a> çš„ã€‚ä½†è¿™ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ï¼Œæœ‰å…´è¶£è‡ªè¡Œæ¢ç´¢ã€‚</p>
<h3>ä¾‹äº”ï¼šåç¼€è¡¨è¾¾å¼</h3>
<pre><code class="language-js">a
++
b
</code></pre>
<p>è§£æå™¨è¯»åˆ° <code>token ++</code> æ—¶å‘ç°è¯­å¥ä¸åˆæ³•ï¼ˆæ³¨æ„ï¼š<code>++</code> ä¸æ˜¯ä¸¤ä¸ª <code>token</code>ï¼Œè€Œæ˜¯ä¸€ä¸ªï¼‰ã€‚å› ä¸ºåç¼€è¡¨è¾¾å¼æ˜¯ä¸å…è®¸æ¢è¡Œçš„ã€‚æ¢å¥è¯è¯´ï¼Œæ¢è¡Œçš„éƒ½ä¸æ˜¯åç¼€è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å®ƒåªèƒ½æŒ‰ç…§ <code>è§„åˆ™ 1.1</code> åœ¨ <code>token ++</code> å‰é¢æ’å…¥åˆ†å·æ¥ç»“æŸè¯­å¥ <code>a</code>ï¼Œç„¶åç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºå‰ç¼€è¡¨è¾¾å¼å¹¶ä¸æ˜¯ <code>restricted production</code>ï¼Œæ‰€ä»¥ <code>++</code> å’Œ <code>b</code> å¯ä»¥ç»„æˆä¸€æ¡è¯­å¥ï¼Œç„¶åæŒ‰ç…§ <code>è§„åˆ™ 2</code> åœ¨æœ«å°¾åŠ ä¸Šåˆ†å·ã€‚æ•…å¾—åˆ°ï¼š</p>
<pre><code class="language-js">a
;++
b;
</code></pre>
<h3>ä¾‹å…­ï¼šç©ºè¯­å¥</h3>
<pre><code class="language-js">if (a)
else b
</code></pre>
<p>è§£æå™¨è§£æåˆ° <code>token else</code> æ—¶å‘ç°ä¸åˆæ³•ï¼ˆ <code>else</code> æ˜¯ä¸èƒ½è·Ÿåœ¨ <code>if</code> è¯­å¥å¤´åé¢çš„ï¼‰ï¼Œæœ¬æ¥æŒ‰ç…§ <code>è§„åˆ™ 1.1</code>ï¼Œå®ƒåº”è¯¥åŠ ä¸Šåˆ†å·å˜æˆ <code>if (a)\n;</code>ï¼Œä½†æ˜¯è¿™æ · <code>;</code> å°±å˜æˆç©ºè¯­å¥äº†ï¼Œæ‰€ä»¥æŒ‰ç…§ <code>ä¾‹å¤– 1</code>ï¼Œè¿™ä¸ªåˆ†å·ä¸èƒ½åŠ ï¼Œç¨‹åºåœ¨ <code>else</code> å¤„æŠ›å¼‚å¸¸ç»“æŸã€‚Node.js çš„è¿è¡Œç»“æœï¼š</p>
<pre><code class="language-js">else b
^^^^

SyntaxError: Unexpected token else
</code></pre>
<p>è€Œä»¥ä¸‹è¿™æ ·è¯­æ³•æ˜¯æ­£ç¡®çš„ã€‚</p>
<pre><code class="language-js">if (a);
else b
</code></pre>
<h3>ä¾‹ä¸ƒï¼šfor è¯­å¥</h3>
<pre><code class="language-js">for(a; b
)
</code></pre>
<p>è§£æå™¨è¯»åˆ° <code>token )</code> æ—¶å‘ç°è¯­æ³•ä¸åˆæ³•ï¼Œæœ¬æ¥æ¢è¡Œå¯ä»¥è‡ªåŠ¨æ’å…¥åˆ†å·ï¼Œä½†æ˜¯æŒ‰ç…§ <code>ä¾‹å¤– 2</code>ï¼Œä¸èƒ½ä¸º <code>for</code> å¤´éƒ¨è‡ªåŠ¨æ’å…¥åˆ†å·ï¼Œäºæ˜¯ç¨‹åºåœ¨ <code>)</code> å¤„æŠ›å¼‚å¸¸ç»“æŸã€‚Node.js è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">)
^

SyntaxError: Unexpected token )
</code></pre>
<h2>å¦‚ä½•æ‰‹åŠ¨æµ‹è¯• ASI</h2>
<p>æˆ‘ä»¬å¾ˆéš¾æœ‰åŠæ³•å»æµ‹è¯• ASI æ˜¯ä¸æ˜¯å¦‚é¢„æœŸé‚£æ ·å·¥ä½œçš„ï¼Œåªèƒ½çœ‹åˆ°ä»£ç æœ€ç»ˆæ‰§è¡Œç»“æœæ˜¯å¯¹æ˜¯é”™ã€‚ASI ä¹Ÿæ²¡æœ‰æ‰‹åŠ¨æ‰“å¼€æˆ–è€…å…³æ‰å»å¯¹æ¯”ç»“æœã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ¯”è§£æå™¨ç”Ÿæˆçš„ tree æ˜¯å¦ä¸€è‡´æ¥åˆ¤æ–­ ASI æ’å…¥çš„åˆ†å·æ˜¯ä¸æ˜¯è·Ÿæˆ‘ä»¬é¢„æœŸçš„ä¸€è‡´ã€‚è¿™ç‚¹å¯ä»¥ç”¨ <a href="https://esprima.org/demo/parse.html#">Esprima Parser</a> éªŒè¯ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">do a; while(b) c
</code></pre>
<p>Esprima è§£æçš„ Syntax å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸éœ€è¦çœ‹æ‡‚ï¼Œè®°ä½å¤§æ¦‚æ ·å­å°±å¥½ï¼‰ï¼š</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;body&quot;: [
    {
      &quot;type&quot;: &quot;DoWhileStatement&quot;,
      &quot;body&quot;: {
        &quot;type&quot;: &quot;ExpressionStatement&quot;,
        &quot;expression&quot;: {
          &quot;type&quot;: &quot;Identifier&quot;,
          &quot;name&quot;: &quot;a&quot;
        }
      },
      &quot;test&quot;: {
        &quot;type&quot;: &quot;Identifier&quot;,
        &quot;name&quot;: &quot;b&quot;
      }
    },
    {
      &quot;type&quot;: &quot;ExpressionStatement&quot;,
      &quot;expression&quot;: {
        &quot;type&quot;: &quot;Identifier&quot;,
        &quot;name&quot;: &quot;c&quot;
      }
    }
  ],
  &quot;sourceType&quot;: &quot;script&quot;
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬ä¸»åŠ¨åŠ ä¸Šåˆ†å·ï¼Œè¾“å…¥è¿›å»ï¼š</p>
<pre><code class="language-js">do a; while(b); c;
</code></pre>
<p>ä½ å°±ä¼šå‘ç° <code>do a; while(b) c</code> å’Œ <code>do a; while(b); c;</code> ç”Ÿæˆçš„ Syntax æ˜¯ä¸€è‡´çš„ã€‚è¿™è¯´æ˜è§£æå™¨å¯¹è¿™ä¸¤æ®µä»£ç è§£æè¿‡ç¨‹æ˜¯ä¸€è‡´çš„ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åŠ å…¥ä»»ä½•å¤šä½™çš„åˆ†å·ã€‚</p>
<p>ç„¶åè¯•è¯•è¿™ä¸ªå¤šä½™åˆ†å·çš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">do a; while(b); c;; // ç»“å°¾å¤šä¸€ä¸ªåˆ†å·
</code></pre>
<p>å®ƒçš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;Program&quot;,
  &quot;body&quot;: [
    {
      &quot;type&quot;: &quot;DoWhileStatement&quot;,
      &quot;body&quot;: {
        &quot;type&quot;: &quot;ExpressionStatement&quot;,
        &quot;expression&quot;: {
          &quot;type&quot;: &quot;Identifier&quot;,
          &quot;name&quot;: &quot;a&quot;
        }
      },
      &quot;test&quot;: {
        &quot;type&quot;: &quot;Identifier&quot;,
        &quot;name&quot;: &quot;b&quot;
      }
    },
    {
      &quot;type&quot;: &quot;ExpressionStatement&quot;,
      &quot;expression&quot;: {
        &quot;type&quot;: &quot;Identifier&quot;,
        &quot;name&quot;: &quot;c&quot;
      }
    },
    {
      &quot;type&quot;: &quot;EmptyStatement&quot;
    }
  ],
  &quot;sourceType&quot;: &quot;script&quot;
}
</code></pre>
<p>ä½ ä¼šå‘ç°å¤šå‡ºæ¥ä¸€æ¡ç©ºè¯­å¥ï¼ˆEmptyStatementï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†å·å°±æ˜¯å¤šä½™çš„ã€‚</p>
<h2>æœ€å</h2>
<p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹ JavaScript è§£ææœºåˆ¶å’Œ ASI æœºåˆ¶æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£äº†ã€‚</p>
<blockquote>
<p>æ‰€ä»¥å³ä½¿åšæŒä½¿ç”¨åˆ†å·ï¼Œä»ç„¶ä¼šå› ä¸º ASI æœºåˆ¶å¯¼è‡´äº§ç”Ÿä¸é¢„æœŸä¸ä¸€è‡´çš„ç»“æœã€‚</p>
</blockquote>
<p>æ¯”å¦‚ä¸‹é¢ä¾‹å­ï¼Œè¿™ä¸æ˜¯åŠ ä¸åŠ åˆ†å·çš„é—®é¢˜ï¼Œè€Œæ˜¯æ‡‚ä¸æ‡‚ JavaScript è§£æçš„é—®é¢˜ã€‚</p>
<pre><code class="language-js">// åšæŒæ·»åŠ åˆ†å·çš„å°æ˜
return 
123;

// åšæŒä¸æ·»åŠ åˆ†å·çš„å°çº¢
return
123

// ä»¥ä¸Šå°æ˜ã€å°çº¢éƒ½ä¸èƒ½è¿”å›é¢„æœŸçš„ç»“æœ 123ï¼Œè€Œæ˜¯ undefinedã€‚
// å› ä¸º JavaScript è§£æå™¨è§£æå®ƒä»¬ï¼Œéƒ½ä¼šå˜æˆè¿™æ ·ï¼š
return;
123;

// å¦‚æœæˆ‘ä»¬æ‡‚å¾—äº† JavaScript è§£æè§„åˆ™ï¼Œé‚£ä¹ˆæ— è®ºæˆ‘ä»¬å†™åˆ†å·æˆ–è€…ä¸å†™åˆ†å·ï¼Œéƒ½èƒ½å¾—åˆ°é¢„æœŸç»“æœã€‚
return 123
return 123;
</code></pre>
<p>æ­£å¦‚æ–‡ç« å¼€å¤´æ‰€è¯´ï¼Œæˆ‘æ›´åå‘äºä¸åŠ åˆ†å·çš„ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬è¦æ³¨æ„ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œä»¥é¿å… ASI æœºåˆ¶äº§ç”Ÿä¸æˆ‘ä»¬ç¼–å†™ç¨‹åºçš„é¢„æœŸç»“æœä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p><strong>æ•²é‡ç‚¹ï¼ï¼ï¼</strong></p>
<blockquote>
<p>å¦‚æœä¸€æ¡è¯­å¥æ˜¯ä»¥ <code>(</code>ã€<code>[</code>ã€<code>/</code>ã€<code>+</code>ã€<code>-</code> å¼€å¤´ï¼Œé‚£ä¹ˆå°±è¦æ³¨æ„äº†ã€‚æ ¹æ® JavaScript è§£æå™¨çš„è§„åˆ™ï¼Œå°½å¯èƒ½è¯»å–æ›´å¤š <code>token</code> æ¥æ„æˆä¸€ä¸ªå®Œæ•´çš„è¯­å¥ï¼Œè€Œä»¥ä¸Šè¿™äº› <code>token</code> ææœ‰å¯èƒ½ä¸å‰ä¸€ä¸ª <code>token</code> å¯ç»„æˆä¸€ä¸ªåˆæ³•çš„è¯­å¥ï¼Œæ‰€ä»¥å®ƒä¸ä¼šè‡ªåŠ¨æ’å…¥åˆ†å·ã€‚</p>
<p>å®é™…é¡¹ç›®ä¸­ï¼Œä»¥ <code>/</code>ã€<code>+</code>ã€<code>- </code> ä½œä¸ºè¡Œé¦–çš„ä»£ç å…¶å®æ˜¯å¾ˆå°‘çš„ï¼Œ<code>(</code>ã€<code>[</code> ä¹Ÿæ˜¯è¾ƒå°‘çš„ã€‚<strong>å½“é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œé€šè¿‡åœ¨è¡Œé¦–æ‰‹åŠ¨é”®å…¥åˆ†å· <code>;</code> æ¥é¿å… ASI è§„åˆ™äº§ç”Ÿçš„éé¢„æœŸç»“æœæˆ–æŠ¥é”™ã€‚</strong></p>
</blockquote>
<h3>ä»¥ <code>(</code> å¼€å¤´çš„æƒ…å†µ</h3>
<pre><code class="language-js">a = b
(function() {

})
</code></pre>
<p>JavaScript è§£æå™¨ä¼šè§£ææˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">a = b(function() {

});
</code></pre>
<h3>ä»¥ <code>[</code> å¼€å¤´çš„æƒ…å†µ</h3>
<pre><code class="language-js">a = function() {
 
}
[1,2,3].forEach(function(item) {
 
})
</code></pre>
<p>JavaScript è§£æå™¨ä¼šæŒ‰ä»¥ä¸‹è¿™æ ·å»è§£æï¼Œç”±äº <code>function() {}[1,2,3]</code> è¿”å›å€¼æ˜¯ <code>undefined</code>ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">a = function() {
}[1,2,3].forEach(function(item) {
 
});
</code></pre>
<h3>ä»¥ <code>/</code> å¼€å¤´çš„æƒ…å†µ</h3>
<pre><code class="language-js">a = 'abc'
/[a-z]/.test(a)
</code></pre>
<p>JavaScript è§£æå™¨ä¼šæŒ‰ä»¥ä¸‹è¿™æ ·å»è§£æï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-js">a = â€˜abcâ€™/[a-z]/.test(a);
</code></pre>
<h3>ä»¥ <code>+</code> å¼€å¤´çš„æƒ…å†µ</h3>
<pre><code class="language-js">a = b
+c
</code></pre>
<p>JavaScript è§£æå™¨ä¼šè§£ææˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">a = b + c;
</code></pre>
<h3>ä»¥ <code>-</code> å¼€å¤´çš„æƒ…å†µ</h3>
<pre><code>a = b
-c
</code></pre>
<p>JavaScript è§£æå™¨ä¼šè§£ææˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">a = b - c;
</code></pre>
<blockquote>
<p>å…³äºåç¼€è¡¨è¾¾å¼ <code>++</code> å’Œ <code>--</code>  è·Ÿä¸Šé¢çš„æœ‰ç‚¹åŒºåˆ«ï¼Œä¸Šé¢å·²ç»ä¸¾ä¾‹è¯´æ˜äº†ï¼Œå®ƒå±äº <code>restricted production</code> çš„æƒ…å†µä¹‹ä¸€ï¼Œä¼šåœ¨æ¢è¡Œå¤„è‡ªåŠ¨æ’å…¥åˆ†å·ï¼Œæ‰€ä»¥å®ƒä»¬ä¸èƒ½æ¢è¡Œå†™ï¼Œå¦åˆ™å¯èƒ½ä¼šäº§ç”Ÿéé¢„æœŸç»“æœã€‚</p>
</blockquote>
<p>æ‰€ä»¥ç†è§£äº†ä»¥ä¸Šè§„åˆ™ä¹‹åï¼Œæˆ‘å¯ä»¥æ„‰å¿«äº†ä½¿ç”¨ <a href="https://www.jianshu.com/p/67a9d9f669b9">ESLint + Prettier</a> ä¸€é”®å»æ‰åˆ†å·ä»¥åŠç»Ÿä¸€æ ¼å¼åŒ–ï¼Œè€Œä¸ä¼šæœ‰ä»»ä½•çš„è´Ÿæ‹…äº†ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://segmentfault.com/a/1190000004548664">JavaScript ASI æœºåˆ¶è¯¦è§£</a></li>
<li><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-automatic-semicolon-insertion">ECMAScript ASI æ ‡å‡†</a></li>
<li><a href="https://esprima.org/demo/parse.html#">Esprima AST åœ¨çº¿è§£æå™¨</a></li>
<li><a href="https://www.cnblogs.com/ricklz/p/10342629.html">JavaScript ä»£ç è¦ä¸è¦åŠ åˆ†å·</a></li>
<li><a href="http://justjavac.iteye.com/blog/1852405">JavaScript ä¸­çš„è‡ªåŠ¨åˆ†å·æ’å…¥æœºåˆ¶ï¼ˆASIï¼‰</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#automatic_semicolon_insertion">MDN Automatic semicolon insertion</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JS åŒ…è£…ç±»]]></title>
            <link>https://github.com/toFrankie/blog/issues/222</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/222</guid>
            <pubDate>Sun, 26 Feb 2023 10:42:19 GMT</pubDate>
            <description><![CDATA[<p><strong>JavaScript çš„ã€ŒåŸå§‹å€¼ã€æ˜¯æ²¡æœ‰ä»»ä½•çš„å±æ€§å’Œæ–¹æ³•çš„</strong>ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ</p>
<pre><code class="language-js">var str = 'abc'
console.log(str.length) // 3
</code></pre>
]]></description>
            <content:encoded><![CDATA[<p><strong>JavaScript çš„ã€ŒåŸå§‹å€¼ã€æ˜¯æ²¡æœ‰ä»»ä½•çš„å±æ€§å’Œæ–¹æ³•çš„</strong>ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ</p>
<pre><code class="language-js">var str = 'abc'
console.log(str.length) // 3
</code></pre>
<p>åˆšä¸æ˜¯æ‰è¯´ï¼ŒåŸå§‹å€¼æ²¡æœ‰å±æ€§å’Œæ–¹æ³•å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆèƒ½è®¿é—®åˆ° <code>length</code> å±æ€§å‘¢ï¼Ÿ</p>
<pre><code class="language-js">// console.log(str.length) ç»å†äº†ä»€ä¹ˆè¿‡ç¨‹å‘¢ï¼Ÿ
// 1. ä½¿ç”¨ new String(str) ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª String å¯¹è±¡ï¼›ï¼ˆå‡è®¾ä¸º objï¼‰
// 2. è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡ obj ä¸‹é¢æœ‰ä¸ª length å±æ€§ï¼Œç„¶å obj.length å°±èƒ½è·å–åˆ°å¯¹åº”çš„å±æ€§å€¼ 3ï¼›
// 3. æ¥ç€é©¬ä¸Šé”€æ¯ delete obj.lengthã€‚
</code></pre>
<p>å†æ¥ï¼Œ</p>
<pre><code class="language-js">var str = 'abc'
str.len = 1
console.log(str.len) // undefined

// ç›¸å½“äº
var str = 'abc'
new String(str).len = 1
console.log(new String(str).len)
</code></pre>
<ul>
<li>åœ¨ç¬¬äºŒè¡Œçš„ <code>str.len = 1</code> é‡Œé¢ï¼Œè™½ç„¶ç»™ String çš„å®ä¾‹åŒ–å¯¹è±¡çš„ <code>len</code> å±æ€§èµ‹å€¼ <code>1</code>ï¼Œä½†ç”±äºæ²¡æœ‰ä¿å­˜èµ·æ¥ï¼Œæ‰€ä»¥ï¼Œæ¥ç€ç³»ç»Ÿä¼šé©¬ä¸Šç»™é”€æ¯æ‰ <code>delete new String(str).len</code>ã€‚</li>
<li>ç¬¬ä¸‰è¡Œé‡Œé¢ï¼Œåˆæ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œè¯¥å®ä¾‹åŒ–å¯¹è±¡é‡Œé¢å¹¶æ²¡æœ‰ <code>len</code> å±æ€§ï¼ˆæˆ–æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯ <code>undefined</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬å¸¸è§çš„ <code>string.length</code> å¹¶ä¸æ˜¯æˆ‘ä»¬è¡¨é¢çœ‹åˆ°çš„ <code>string</code> å˜é‡æœ‰ä¸€ä¸ª <code>length</code> å±æ€§ï¼Œå®ƒæ²¡æœ‰ã€‚</p>
<p><strong>åŸå§‹å€¼æ˜¯ä¸å¯èƒ½æœ‰å±æ€§å’Œæ–¹æ³•çš„</strong>ï¼Œä½† <code>str.len = 1</code> ä¸æŠ¥é”™ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºç»å†äº†ä¸€ä¸ªåŒ…è£…ç±»ã€‚<code>Boolean</code>ã€<code>String</code>ã€<code>Number</code> çš„åŸå§‹å€¼éƒ½å¯ä»¥åŠ å±æ€§å’Œæ–¹æ³•ï¼Œå› ä¸ºæœ‰åŒ…è£…ç±»ï¼Œä½†æ˜¯ Null å’Œ Undefined åŠ å±æ€§å’Œæ–¹æ³•ä¼šæŠ¥é”™ï¼ˆä¾‹å¤–ï¼‰ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº varã€let çš„é¡¶å±‚å¯¹è±¡çš„å±æ€§]]></title>
            <link>https://github.com/toFrankie/blog/issues/221</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/221</guid>
            <pubDate>Sun, 26 Feb 2023 10:41:18 GMT</pubDate>
            <description><![CDATA[<p><strong>é¡¶å±‚å¯¹è±¡</strong> ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒæŒ‡çš„æ˜¯ <code>window</code> å¯¹è±¡ï¼Œåœ¨ Node æŒ‡çš„æ˜¯ <code>global</code> å¯¹è±¡ã€‚ES5 ä¹‹ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚</p>
<pre><code class="language-js">window.]]></description>
            <content:encoded><![CDATA[<p><strong>é¡¶å±‚å¯¹è±¡</strong> ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒæŒ‡çš„æ˜¯ <code>window</code> å¯¹è±¡ï¼Œåœ¨ Node æŒ‡çš„æ˜¯ <code>global</code> å¯¹è±¡ã€‚ES5 ä¹‹ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚</p>
<pre><code class="language-js">window.a = 1;
console.log(a);  // 1

a = 2;
console.log(window.a);  // 2
</code></pre>
<p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œé¡¶çº§å¯¹è±¡çš„å±æ€§èµ‹å€¼ä¸å…¨å±€å˜é‡çš„èµ‹å€¼ï¼Œæ˜¯åŒä¸€ä»¶äº‹ã€‚</p>
<p>é¡¶å±‚å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æŒ‚é’©ï¼Œè¢«è®¤ä¸ºæ˜¯ JavaScript è¯­è¨€æœ€å¤§çš„è®¾è®¡è´¥ç¬”ä¹‹ä¸€ã€‚è¿™æ ·çš„è®¾è®¡å¸¦æ¥äº†å‡ ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé¦–å…ˆæ˜¯æ²¡æ³•åœ¨ç¼–è¯‘æ—¶å°±æŠ¥å‡ºå˜é‡æœªå£°æ˜çš„é”™è¯¯ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“ï¼ˆå› ä¸ºå…¨å±€å˜é‡å¯èƒ½æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§åˆ›é€ çš„ï¼Œè€Œå±æ€§çš„åˆ›é€ æ˜¯åŠ¨æ€çš„ï¼‰ï¼›å…¶æ¬¡ï¼Œç¨‹åºå‘˜å¾ˆå®¹æ˜“ä¸çŸ¥ä¸è§‰åœ°å°±åˆ›å»ºäº†å…¨å±€å˜é‡ï¼ˆæ¯”å¦‚æ‰“å­—å‡ºé”™ï¼‰ï¼›æœ€åï¼Œé¡¶å±‚å¯¹è±¡çš„å±æ€§æ˜¯åˆ°å¤„å¯ä»¥è¯»å†™çš„ï¼Œè¿™éå¸¸ä¸åˆ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚å¦ä¸€æ–¹é¢ï¼Œwindow å¯¹è±¡æœ‰å®ä½“å«ä¹‰ï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨çš„çª—å£å¯¹è±¡ï¼Œé¡¶å±‚å¯¹è±¡æ˜¯ä¸€ä¸ªæœ‰å®ä½“å«ä¹‰çš„å¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸åˆé€‚çš„ã€‚</p>
<p>ES6 ä¸ºäº†æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä¸€æ–¹é¢è§„å®šï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œ<code>var</code> å’Œ <code>function</code> å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¾æ—§æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å¦ä¸€æ–¹é¢è§„å®šï¼Œ<code>let</code>ã€<code>const</code>ã€<code>class</code> å£°æ˜çš„å…¨å±€å˜é‡ï¼Œä¸å±äºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä» ES6 å¼€å§‹ï¼Œå…¨å±€å˜é‡å°†é€æ­¥ä¸é¡¶å±‚å¯¹è±¡çš„å±æ€§è„±é’©ã€‚</p>
<pre><code class="language-js">var a = 1;
// å¦‚æœåœ¨ Node çš„ REPL ç¯å¢ƒï¼Œå¯ä»¥å†™æˆ global.a
// æˆ–è€…é‡‡ç”¨é€šç”¨æ–¹æ³•ï¼Œå†™æˆ this.a
console.log(window.a);  // 1
console.log(this.a);    // 1

let b = 1;
console.log(window.b);  // undefined
console.log(this.b);    // undefined
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…¨å±€å˜é‡ <code>a</code> ç”± <code>var</code> å‘½ä»¤å£°æ˜ï¼Œæ‰€ä»¥å®ƒæ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼›å…¨å±€å˜é‡ <code>b</code> ç”± <code>let</code> å‘½ä»¤å£°æ˜ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ï¼Œè¿”å› <code>undefined</code>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ECMAScript å’Œ JavaScript çš„å…³ç³»ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/220</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/220</guid>
            <pubDate>Sun, 26 Feb 2023 10:39:23 GMT</pubDate>
            <description><![CDATA[<p>ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ï¼ŒECMAScript å’Œ JavaScript åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>è¦è®²æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å›é¡¾å†å²ã€‚1996 å¹´ 11 æœˆï¼ŒJavaScript çš„åˆ›é€ è€… Netscape å…¬å¸ï¼Œå†³å®šå°† JavaScript æäº¤ç»™æ ‡å‡†åŒ–ç»„ç»‡ ECMAï¼Œå¸Œæœ›è¿™ç§è¯­è¨€èƒ½å¤Ÿæˆä¸ºå›½é™…æ ‡å‡†ã€‚æ¬¡å¹´ï¼ŒECMA ]]></description>
            <content:encoded><![CDATA[<p>ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ï¼ŒECMAScript å’Œ JavaScript åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>è¦è®²æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å›é¡¾å†å²ã€‚1996 å¹´ 11 æœˆï¼ŒJavaScript çš„åˆ›é€ è€… Netscape å…¬å¸ï¼Œå†³å®šå°† JavaScript æäº¤ç»™æ ‡å‡†åŒ–ç»„ç»‡ ECMAï¼Œå¸Œæœ›è¿™ç§è¯­è¨€èƒ½å¤Ÿæˆä¸ºå›½é™…æ ‡å‡†ã€‚æ¬¡å¹´ï¼ŒECMA å‘å¸ƒ 262 å·æ ‡å‡†æ–‡ä»¶ï¼ˆECMA-262ï¼‰çš„ç¬¬ä¸€ç‰ˆï¼Œè§„å®šäº†æµè§ˆå™¨è„šæœ¬è¯­è¨€çš„æ ‡å‡†ï¼Œå¹¶å°†è¿™ç§è¯­è¨€ç§°ä¸º ECMAScriptï¼Œè¿™ä¸ªç‰ˆæœ¬å°±æ˜¯ 1.0 ç‰ˆã€‚</p>
<p>è¯¥æ ‡å‡†ä»ä¸€å¼€å§‹å°±æ˜¯é’ˆå¯¹ JavaScript è¯­è¨€åˆ¶å®šçš„ï¼Œä½†æ˜¯ä¹‹æ‰€ä»¥ä¸å« JavaScriptï¼Œæœ‰ä¸¤ä¸ªåŸå› ã€‚ä¸€æ˜¯å•†æ ‡ï¼ŒJava æ˜¯ Sun å…¬å¸çš„å•†æ ‡ï¼Œæ ¹æ®æˆæƒåè®®ï¼Œåªæœ‰ Netscape å…¬å¸å¯ä»¥åˆæ³•åœ°ä½¿ç”¨ JavaScript è¿™ä¸ªåå­—ï¼Œä¸” JavaScript æœ¬èº«ä¹Ÿå·²ç»è¢« Netscape å…¬å¸æ³¨å†Œä¸ºå•†æ ‡ã€‚äºŒæ˜¯æƒ³ä½“ç°è¿™é—¨è¯­è¨€çš„åˆ¶å®šè€…æ˜¯ ECMAï¼Œä¸æ˜¯ Netscapeï¼Œè¿™æ ·æœ‰åˆ©äºä¿è¯è¿™é—¨è¯­è¨€çš„å¼€æ”¾æ€§å’Œä¸­ç«‹æ€§ã€‚</p>
<p>å› æ­¤ï¼ŒECMAScript å’Œ JavaScript çš„å…³ç³»æ˜¯ï¼Œå‰è€…æ˜¯åè€…çš„è§„æ ¼ï¼Œåè€…æ˜¯å‰è€…çš„ä¸€ç§å®ç°ï¼ˆå¦å¤–çš„ ECMAScript æ–¹è¨€è¿˜æœ‰ JScript å’Œ ActionScriptï¼‰ã€‚æ—¥å¸¸åœºåˆï¼Œè¿™ä¸¤ä¸ªè¯æ˜¯å¯ä»¥äº’æ¢çš„ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript åˆ¤æ–­å¯¹è±¡ä¸ºç©º]]></title>
            <link>https://github.com/toFrankie/blog/issues/219</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/219</guid>
            <pubDate>Sun, 26 Feb 2023 10:38:50 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€æ”¯æŒ Object.keys æƒ…å†µä¸‹</h3>
<ul>
<li>æ’é™¤ <code>undefined</code>ã€<code>null</code> ç­‰æŠ¥é”™</li>
<li>åˆ¤æ–­æ˜¯å¦å« <code>key</code></li>
<li>é€šè¿‡æ„é€ å‡½æ•°æ’é™¤åŒ…è£…ç±»ï¼Œå¦‚ <code>new String()]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€æ”¯æŒ Object.keys æƒ…å†µä¸‹</h3>
<ul>
<li>æ’é™¤ <code>undefined</code>ã€<code>null</code> ç­‰æŠ¥é”™</li>
<li>åˆ¤æ–­æ˜¯å¦å« <code>key</code></li>
<li>é€šè¿‡æ„é€ å‡½æ•°æ’é™¤åŒ…è£…ç±»ï¼Œå¦‚ <code>new String()</code>ã€<code>new Boolean()</code> ç­‰æƒ…å†µ</li>
</ul>
<blockquote>
<p>è¿™ç§æ–¹æ³•æœ‰ä¸ªä¸è¶³çš„æ˜¯ï¼Œå€˜è‹¥é€šè¿‡ <code>let emptyObj = Object.create(null)</code> åˆ›å»ºç©ºå¯¹è±¡ï¼Œé‚£ä¹ˆ <code>emptyObj.constructor === Object</code> å°±ä¸æˆç«‹äº†ã€‚</p>
</blockquote>
<pre><code class="language-js">function isEmptyObject(val) {
  return val &amp;&amp; Object.keys(val).length === 0 &amp;&amp; val.constructor === Object
}
</code></pre>
<h3>äºŒã€ä¸æ”¯æŒ Object.keys æ—¶</h3>
<pre><code class="language-js">function isEmptyObject(val) {
  return Object.prototype.toString.call(val) === '[object Object]' &amp;&amp; JSON.stringify(val) === '{}'
}
</code></pre>
<h3>ä¸‰ã€ä½¿ç”¨ç¬¬ä¸‰æ–¹ JS åº“</h3>
<pre><code class="language-js">// Lodash 
_.isEmpty(val)

// Underscore
_.isEmpty(val)

// jQuery
$.isEmptyObject(val)
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[module.exports å±æ€§ä¸ exports å˜é‡çš„åŒºåˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/218</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/218</guid>
            <pubDate>Sun, 26 Feb 2023 10:36:51 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€CommonJS æ¨¡å—è§„èŒƒ</h3>
<p>Node åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚
æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚</p>
<p>CommonJS è§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œ<code>module</code> ]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€CommonJS æ¨¡å—è§„èŒƒ</h3>
<p>Node åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚
æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚</p>
<p>CommonJS è§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œ<code>module</code> å˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ <code>exports</code> å±æ€§ï¼ˆå³ <code>module.exports</code> ï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚åŠ è½½æŸä¸ªæ¨¡å—ï¼Œå…¶å®æ˜¯åŠ è½½è¯¥æ¨¡å—çš„ <code>module.exports</code> å±æ€§ã€‚</p>
<p>CommonJS è§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œã€‚</p>
<blockquote>
<p>CommonJS æ¨¡å—çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</li>
<li>æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç„¶åè¿è¡Œç»“æœå°±è¢«ç¼“å­˜äº†ï¼Œä»¥åå†åŠ è½½ï¼Œå°±ç›´æ¥è¯»å–ç¼“å­˜ç»“æœã€‚è¦æƒ³è®©æ¨¡å—å†æ¬¡è¿è¡Œï¼Œå¿…é¡»æ¸…é™¤ç¼“å­˜ã€‚</li>
<li>æ¨¡å—åŠ è½½çš„é¡ºåºï¼ŒæŒ‰ç…§å…¶åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºã€‚</li>
</ul>
</blockquote>
<h4>1. module.exports å±æ€§</h4>
<p><code>module.exports</code> å±æ€§è¡¨ç¤ºå½“å‰æ¨¡å—å¯¹å¤–è¾“å‡ºçš„æ¥å£ï¼Œå…¶ä»–æ–‡ä»¶åŠ è½½è¯¥æ¨¡å—ï¼Œå®é™…ä¸Šå°±æ˜¯è¯»å– <code>module.exports</code> å˜é‡ã€‚</p>
<h4>2. exports å˜é‡</h4>
<p>ä¸ºäº†æ–¹ä¾¿ï¼ŒNode ä¸ºæ¯ä¸ªæ¨¡å—æä¾›ä¸€ä¸ª <code>exports</code> å˜é‡ï¼Œå®ƒæŒ‡å‘ <code>module.exports</code>ã€‚è¿™ç­‰åŒäºåœ¨æ¯ä¸ªæ¨¡å—å¤´éƒ¨ï¼Œæœ‰ä¸€è¡Œè¿™æ ·çš„å‘½ä»¤ï¼š<code>var exports = module.exports</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥éªŒè¯</p>
<pre><code class="language-js">console.log(exports === module.exports);  // true
</code></pre>
<p>æ‰€ä»¥åœ¨å¯¹å¤–è¾“å‡ºæ¨¡å—æ¥å£æ—¶ï¼Œå¯ä»¥å‘ <code>exports</code> å¯¹è±¡æ·»åŠ å±æ€§æ–¹æ³•ã€‚</p>
<pre><code class="language-js">module.exports.age = 20
module.exports.getAge = function() {}

// ç›¸å½“äº
exports.age = 20
exports.getAge = function() {}
</code></pre>
<p>ä½†æ˜¯ä¸èƒ½ç›´æ¥å°† <code>exports</code> å˜é‡æŒ‡å‘ä¸€ä¸ªå€¼ï¼Œå› ä¸ºè¿™æ ·ç­‰äºåˆ‡æ–­äº† <code>exports</code> ä¸ <code>module.exports</code> çš„è”ç³»ã€‚</p>
<pre><code class="language-js">// ä»¥ä¸‹å†™æ³•æ— æ•ˆï¼Œå› ä¸º exports ä¸å†æŒ‡å‘ module.exports äº†ã€‚
exports = function() {};
</code></pre>
<h4>3. module.exports ä¸ exports çš„ä½¿ç”¨</h4>
<p>å½“ä¸€ä¸ªæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œåªæ˜¯ä¸€ä¸ªå•ä¸€çš„å€¼æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ <code>exports</code> è¾“å‡ºï¼Œåªèƒ½ä½¿ç”¨ <code>module.exports</code> è¾“å‡ºã€‚</p>
<pre><code class="language-js">// moduleA.js
// 1ï¸âƒ£ æ­£ç¡® âœ…
module.exports = function() {};

// 2ï¸âƒ£ é”™è¯¯ â
exports = function() {};
</code></pre>
<p>å¯¼å…¥æ¨¡å—çœ‹ç»“æœï¼š</p>
<pre><code class="language-js">// other.js
var moduleA = require('moduleA.js');
console.log(moduleA);

// ä¸¤ç§å†™æ³•æ‰“å°çš„å€¼åˆ†åˆ«ä¸ºï¼š
// 1ï¸âƒ£ é¢„æœŸç»“æœ âœ…  Æ’ () { console.log('moduleD'); }
// 2ï¸âƒ£ éé¢„æœŸç»“æœ â  {}
</code></pre>
<p>åˆ†æç»“æœï¼š
é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ <code>module.exports</code> çš„åˆå§‹å€¼æ˜¯ <code>{}</code>ï¼Œå½“æ‰§è¡Œ <code>exports = function() {};</code> èµ‹å€¼æ—¶ï¼Œæ— è®ºèµ‹å€¼çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œéƒ½å°†æ”¹å˜ <code>exports</code> çš„æŒ‡å‘ï¼Œå³åˆ‡æ–­äº† <code>exports</code> ä¸ <code>module.exports</code> çš„è”ç³»ã€‚ä½†æ˜¯æˆ‘ä»¬æ¨¡å—å¯¹å¤–è¾“å‡ºçš„æ¥å£æ˜¯ <code>module.exports</code>ï¼Œæ‰€ä»¥ 2ï¸âƒ£ å¾—åˆ°çš„æ˜¯åˆå§‹å€¼ <code>{}</code>ã€‚</p>
<p><strong>å¦‚æœä½ è§‰å¾— <code>exports</code> ä¸ <code>module.exports</code> ä¹‹é—´çš„åŒºåˆ«å¾ˆéš¾åˆ†æ¸…ï¼Œä¸€ä¸ªç®€å•çš„å¤„ç†æ–¹æ³•ï¼Œå°±æ˜¯æ”¾å¼ƒä½¿ç”¨ <code>exports</code>ï¼Œåªä½¿ç”¨ <code>module.exports</code>ã€‚</strong></p>
<p>*æˆ‘ä¸ªäººä¹Ÿæ²¡è§‰å¾— <code>exports</code> çš„å†™æ³•æœ‰å¤šæ–¹ä¾¿ï¼Œå“ˆå“ˆã€‚</p>
<h4>4. æ€»ç»“</h4>
<p>éå¸¸ç®€å•ï¼Œå°±ä¸‰ç‚¹ï¼š</p>
<ul>
<li><code>module.exports</code> åˆå§‹å€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ <code>{}</code>ï¼›</li>
<li><code>exports</code> æ˜¯æŒ‡å‘çš„ <code>module.exports</code> çš„å¼•ç”¨ï¼›</li>
<li><code>require()</code> è¿”å›çš„æ˜¯ <code>module.exports</code> è€Œä¸æ˜¯ <code>exports</code>ã€‚</li>
</ul>
<p>è¿˜æ˜¯é‚£å¥è¯ï¼Œå¦‚æœä½ è§‰å¾— <code>exports</code> ä¸ <code>module.exports</code> ä¹‹é—´çš„åŒºåˆ«å¾ˆéš¾åˆ†æ¸…ï¼Œä¸€ä¸ªç®€å•çš„å¤„ç†æ–¹æ³•ï¼Œå°±æ˜¯æ”¾å¼ƒä½¿ç”¨ <code>exports</code>ï¼Œåªä½¿ç”¨ <code>module.exports</code>ã€‚</p>
<h3>äºŒã€require() æ‰©å±•è¯é¢˜</h3>
<p>ä»¥ä¸‹æ¡ˆä¾‹æºè‡ªçŸ¥ä¹æŸå¸–å›ç­”ï¼Œ<a href="https://www.zhihu.com/question/26621212/answer/625539463">è¿™é‡Œ</a>ã€‚</p>
<p>å…³äº <code>require()</code> çš„è§£é‡Š</p>
<blockquote>
<p>To illustrate the behavior, imagine this hypothetical implementation of require(), which is quite similar to what is actually done by require():</p>
</blockquote>
<pre><code class="language-js">function require(/* ... */) {
  const module = { exports: {} };
  ((module, exports) =&gt; {
    // Module code here. In this example, define a function.
    function someFunc() {}
    exports = someFunc;
    // At this point, exports is no longer a shortcut to module.exports, and
    // this module will still export an empty default object.
    module.exports = someFunc;
    // At this point, the module will now export someFunc, instead of the
    // default object.
  })(module, module.exports);
  return module.exports;
}
</code></pre>
<p>æ³¨æ„å®ç°é¡ºåºï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢ä»£ç ä¸ºä»€ä¹ˆä¸æˆåŠŸçš„åŸå› ã€‚</p>
<pre><code class="language-js">// moduleA.js
module.exports = function() {};
// ä¸ºä»€ä¹ˆè¿™æ®µé…ç½®ä¸æˆåŠŸï¼Ÿä½ ä»¬æœ‰ BUG!!!
exports.abc = 'abc';
</code></pre>
<p><code>require()</code> çš„æ—¶å€™ï¼Œæ˜¯å…ˆé€šè¿‡ <code>exports.abc</code> è·å–ï¼Œ ç„¶åé€šè¿‡ <code>module.exports</code> ç›´æ¥è¦†ç›–äº†åŸæœ‰çš„ <code>exports</code>ï¼Œæ‰€ä»¥ <code>exports.abc = 'abc'</code> å°±æ— æ•ˆäº†ã€‚</p>
<p><strong>ä¸€èˆ¬åº“çš„å°è£…éƒ½æ˜¯ <code>exports = module.exports = _</code> ï¼ˆunderscore çš„ä¾‹å­ï¼‰ã€‚</strong></p>
<p>åŸå› å¾ˆç®€å•ï¼Œé€šè¿‡ <code>exports = module.exports</code> è®© <code>exports</code> é‡æ–°æŒ‡å‘ <code>module.exports</code>ã€‚</p>
<h3>ä¸‰ã€References</h3>
<ul>
<li><a href="https://javascript.ruanyifeng.com/nodejs/module.html#">CommonJSè§„èŒƒ</a></li>
<li><a href="https://www.zhihu.com/question/26621212">Node.jsæ¨¡å—é‡Œexportsä¸module.exportsçš„åŒºåˆ«?</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº ES6 class ç±»]]></title>
            <link>https://github.com/toFrankie/blog/issues/217</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/217</guid>
            <pubDate>Sun, 26 Feb 2023 10:36:30 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡ç”¨æ¥è®°å½•ä¹‹å‰æ¯”è¾ƒå°‘ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p>
<h3>ä¸€ã€super å…³é”®å­—</h3>
<pre><code class="language-js">// çˆ¶ç±»
class Person {
  constructor(name) {
    this.name = name
  }
  showName() {]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡ç”¨æ¥è®°å½•ä¹‹å‰æ¯”è¾ƒå°‘ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p>
<h3>ä¸€ã€super å…³é”®å­—</h3>
<pre><code class="language-js">// çˆ¶ç±»
class Person {
  constructor(name) {
    this.name = name
  }
  showName() {
    console.log(`My name is ${this.name}. (class Person)`)
  }
}

// å­ç±»
class Student extends Person {
  constructor(name, skill) {
    // ç»§æ‰¿ç±»ä¸­çš„æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨ super(...)ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ this ä¹‹å‰æ‰§è¡Œå®ƒã€‚
    super(name)
    this.skill = skill
  }
}

// å®ä¾‹
let student = new Student('Frankie', 'JavaScript')
console.log(student)    // StudentÂ {name: &quot;Frankie&quot;, skill: &quot;JavaScript&quot;}
student.showName()      // My name is Frankie. (class Person)
</code></pre>
<p>ä¸€ä¸ªæå…¶ç®€å•çš„ä¾‹å­ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p>
<p><strong>1. å‡å¦‚æˆ‘ä»¬çš„å­ç±» <code>Student</code> ä¹Ÿæœ‰ä¸€ä¸ª <code>showName()</code> æ–¹æ³•ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ</strong></p>
<pre><code class="language-js">class Student extends Person {
  constructor(name, skill) {
    super(name)
    this.skill = skill
  }
  showName() {
    console.log(`My name is ${this.name}. (class Student)`)
  }
}
</code></pre>
<p>é‚£ä¹ˆï¼ˆä»è‡ªèº«æ‰¾åˆ°äº†ï¼Œè‡ªç„¶åœæ­¢å¾€åŸå‹ä¸Šæ‰¾ï¼Œæ²¡æ¯›ç—…ï¼‰</p>
<pre><code class="language-js">student.showName()      // My name is Frankie. (class Student)
</code></pre>
<p><strong>2. å¦‚æœæˆ‘ä»¬æ—¢æƒ³æ‰§è¡Œçˆ¶ç±» <code>Person</code> çš„ <code>showName()</code> æ–¹æ³•ï¼Œ ä¹Ÿè¦æ‰§è¡Œå­ç±»çš„ <code>Student</code> çš„ <code>showName()</code> æ–¹æ³•ï¼Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</strong></p>
<pre><code class="language-js">class Student extends Person {
  constructor(name, skill) {
    super(name)
    this.skill = skill
  }
  showName() {
    super.showName()
    console.log(`My name is ${this.name}. (class Student)`)
  }
}
</code></pre>
<p>é€šå¸¸æˆ‘ä»¬ä¸æƒ³å®Œå…¨æ›¿ä»£çˆ¶ç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨çˆ¶ç±»æ–¹æ³•çš„åŸºç¡€ä¸Šè°ƒæ•´æˆ–æ‰©å±•å…¶åŠŸèƒ½ã€‚æˆ‘ä»¬è¿›è¡Œä¸€äº›æ“ä½œï¼Œè®©å®ƒä¹‹å‰æˆ–ä¹‹åæˆ–åœ¨è¿‡ç¨‹ä¸­è°ƒç”¨çˆ¶æ–¹æ³•ã€‚</p>
<p>Class ä¸ºæ­¤æä¾›äº† <code>super</code> å…³é”®å­—ã€‚</p>
<ul>
<li>ä½¿ç”¨ <code>super.method()</code> è°ƒç”¨çˆ¶ç±»æ–¹æ³•</li>
<li>ä½¿ç”¨ <code>super()</code> è°ƒç”¨çˆ¶æ„é€ å‡½æ•°ï¼ˆä»…åœ¨ <code>constructor</code> å‡½æ•°ä¸­ï¼‰</li>
</ul>
<pre><code class="language-js">student.showName()      
// My name is Frankie. (class Person)
// My name is Frankie. (class Student)
</code></pre>
<h3>äºŒã€setã€get</h3>
<p>ä¸ ES5 ä¸€æ ·ï¼Œ åœ¨ Class å†…éƒ¨å¯ä»¥ä½¿ç”¨ <code>get</code> å’Œ <code>set</code> å…³é”®å­—ï¼Œ å¯¹æŸä¸ªå±æ€§è®¾ç½®å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°ï¼Œæ‹¦æˆªè¯¥å±æ€§çš„å­˜å–è¡Œä¸ºã€‚</p>
<pre><code class="language-js">class Student {
  constructor(name, skill) {
    this.name = name
    this.skill = skill
  }

  // ä¸å¾—æœ‰å‚æ•°ï¼ˆGetter must not have any formal parameters.)
  get age() {
    console.log(`getter`)
  }

  // å¿…é¡»æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆSetter must have exactly one formal parameter.ï¼‰
  set age(value) {
    console.log(`setter: ${value}`)
  }
}

let student = new Student('Frankie', 'JavaScript')
student.age = 20    // setter: 20
student.age         // getter
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript æœ€å…¨é¢çš„èº«ä»½è¯å·ç æ ¡éªŒæ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/216</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/216</guid>
            <pubDate>Sun, 26 Feb 2023 10:34:28 GMT</pubDate>
            <description><![CDATA[<p>å…³äºå›½å®¶å…¬æ°‘èº«ä»½å·ç è§„å®šå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * ã€–ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡† GB 11643-1999ã€—ä¸­æœ‰å…³å…¬æ°‘èº«ä»½å·ç çš„è§„å®šï¼š
 *    å…¬æ°‘èº«ä»½å·ç æ˜¯ç‰¹å¾ç»„åˆç ï¼Œç”±åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°å€ç ]]></description>
            <content:encoded><![CDATA[<p>å…³äºå›½å®¶å…¬æ°‘èº«ä»½å·ç è§„å®šå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * ã€–ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡† GB 11643-1999ã€—ä¸­æœ‰å…³å…¬æ°‘èº«ä»½å·ç çš„è§„å®šï¼š
 *    å…¬æ°‘èº«ä»½å·ç æ˜¯ç‰¹å¾ç»„åˆç ï¼Œç”±åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°å€ç ï¼Œå…«ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸç ï¼Œä¸‰ä½æ•°å­—é¡ºåºç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ã€‚
 *
 * åœ°å€ç ç¼–ç è§„åˆ™ä¸ºï¼š
 *    ç¬¬ä¸€ä½æ•°å­—è¡¨ç¤ºåœ°åŒºï¼Œ1 æ˜¯ååŒ—ï¼Œ2 æ˜¯ä¸œåŒ—ï¼Œ3 æ˜¯åä¸œï¼Œ4 æ˜¯ä¸­å—ï¼Œ5 æ˜¯è¥¿å—ï¼Œ6 æ˜¯è¥¿åŒ—ã€‚
 *    ç¬¬äºŒä½æ•°å­—è¡¨ç¤ºæˆ·ç±åœ°æ‰€åœ¨çš„ç›´è¾–å¸‚ã€çœã€è‡ªæ²»åŒºï¼Œæ¯”å¦‚åœ¨ååŒ—åœ°åŒºï¼Œ1 ä»£è¡¨åŒ—äº¬å¸‚ï¼Œ2 ä»£è¡¨å¤©æ´¥å¸‚ç­‰ã€‚
 *    ç¬¬ä¸‰ã€å››ä½æ•°å­—åˆ™è¡¨ç¤ºæˆ·ç±æ‰€åœ¨åœ°çš„åŒºã€å¿ã€å¿çº§å¸‚ã€æ——ã€‚
 *    ç¬¬äº”ã€å…­ä½æ•°å­—æ˜¯æˆ·ç±æ‰€åœ¨åœ°ã€‚
 *
 * å‡ºç”Ÿæ—¥æœŸç ï¼š
 *    èº«ä»½è¯å·ç ç¬¬ä¸ƒä½åˆ°ç¬¬åå››ä½è¡¨ç¤ºç¼–ç å¯¹è±¡å‡ºç”Ÿçš„å¹´ã€æœˆã€æ—¥ã€‚
 *
 * é¡ºåºç ï¼š
 *    èº«ä»½è¯å·ç ç¬¬åäº”ä½åˆ°åä¸ƒä½æ˜¯é¡ºåºç ï¼Œå¯¹åŒå¹´ã€æœˆã€æ—¥å‡ºç”Ÿçš„äººå‘˜ç¼–å®šçš„é¡ºåºå·ã€‚å…¶ä¸­ç¬¬åä¸ƒä½å¥‡æ•°åˆ†ç»™ç”·æ€§ï¼Œå¶æ•°åˆ†ç»™å¥³æ€§ã€‚
 *
 * æ ¡éªŒç ï¼š
 *    èº«ä»½è¯å·ç æœ€åä¸€ä½ä¸ºæ ¡éªŒç ã€‚
 *
 * æ ¡éªŒç çš„è®¡ç®—æ–¹æ³•ï¼š
 *    ä¸€ã€å°†èº«ä»½è¯å·ç å‰é¢çš„ 17 ä½æ•°åˆ†åˆ«ä¹˜ä»¥ä¸åŒçš„ç³»æ•°ã€‚ä»ç¬¬ä¸€ä½åˆ°ç¬¬åä¸ƒä½çš„ç³»æ•°åˆ†åˆ«ä¸ºï¼š7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ï¼1ï¼6ï¼3ï¼7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ã€‚
 *    äºŒã€å°†è¿™ 17 ä½æ•°å­—å’Œç³»æ•°ç›¸ä¹˜çš„ç»“æœç›¸åŠ ã€‚
 *    ä¸‰ã€ç”¨åŠ å‡ºæ¥çš„å’Œé™¤ä»¥ 11ï¼Œä½™æ•°åªå¯èƒ½æœ‰ï¼š0ï¼1ï¼2ï¼3ï¼4ï¼5ï¼6ï¼7ï¼8ï¼9ï¼10 è¿™ 11 ä¸ªæ•°å­—ã€‚å…¶åˆ†åˆ«å¯¹åº”çš„æœ€åä¸€ä½èº«ä»½è¯çš„å·ç ä¸ºï¼š1ï¼0ï¼X ï¼9ï¼8ï¼7ï¼6ï¼5ï¼4ï¼3ï¼2ã€‚
 *    å››ã€å¦‚æœä½™æ•°æ˜¯ 2ï¼Œé‚£ä¹ˆèº«ä»½è¯çš„ç¬¬ 18 ä½æ•°å­—å°±æ˜¯ Xã€‚
 */
</code></pre>
<p>èº«ä»½è¯æ ¡éªŒçš„ JavaScript å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">/**
 * æ”¯æŒ 15 ä½å’Œ 18 ä½èº«ä»½è¯å·æ ¡éªŒ
 * å…³äºèº«ä»½è¯å·æ›´å¤šè§„åˆ™ï¼Œè¯·çœ‹æ–‡ä»¶æœ«å°¾
 *
 * @param {string} code èº«ä»½è¯å·ç 
 * @returns {boolean} æ˜¯å¦æ£€éªŒé€šè¿‡
 */
export const checkIDNumber = code =&gt; {
  if (!code || typeof code !== 'string') return false
  // prettier-ignore
  const provinceCodes = ['11', '12', '13', '14', '15', '21', '22', '23', '31', '32', '33', '34', '35', '36', '37', '41', '42', '43', '44', '45', '46', '50', '51', '52', '53', '54', '61', '62', '63', '64', '65', '71', '81', '82', '91']
  const reg = /^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)?$/i
  const codeLen = code.length

  // æ ¼å¼é”™è¯¯
  if (!reg.test(code) || ![15, 18].includes(codeLen)) {
    return false
  }

  // åœ°å€ç é”™è¯¯
  const provinceCode = code.substring(0, 2)
  if (!provinceCodes.includes(provinceCode)) {
    return false
  }

  // 18 ä½éœ€æ ¡éªŒæœ€åä¸€ä½æ ¡éªŒç 
  if (codeLen === 18) {
    const codeArr = code.split('')
    const factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]
    const parity = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2]
    let sum = 0
    let ai = 0
    let wi = 0
    for (let i = 0; i &lt; 17; i++) {
      ai = codeArr[i]
      wi = factor[i]
      sum += ai * wi
    }
    if (parity[sum % 11] != codeArr[17].toUpperCase()) {
      // æ ¡éªŒç é”™è¯¯
      return false
    }
  }

  return true
}

/**
 * ã€–ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡† GB 11643-1999ã€—ä¸­æœ‰å…³å…¬æ°‘èº«ä»½å·ç çš„è§„å®šï¼š
 *    å…¬æ°‘èº«ä»½å·ç æ˜¯ç‰¹å¾ç»„åˆç ï¼Œç”±åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°å€ç ï¼Œå…«ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸç ï¼Œä¸‰ä½æ•°å­—é¡ºåºç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ã€‚
 *
 * åœ°å€ç ç¼–ç è§„åˆ™ä¸ºï¼š
 *    ç¬¬ä¸€ä½æ•°å­—è¡¨ç¤ºåœ°åŒºï¼Œ1 æ˜¯ååŒ—ï¼Œ2 æ˜¯ä¸œåŒ—ï¼Œ3 æ˜¯åä¸œï¼Œ4 æ˜¯ä¸­å—ï¼Œ5 æ˜¯è¥¿å—ï¼Œ6 æ˜¯è¥¿åŒ—ã€‚
 *    ç¬¬äºŒä½æ•°å­—è¡¨ç¤ºæˆ·ç±åœ°æ‰€åœ¨çš„ç›´è¾–å¸‚ã€çœã€è‡ªæ²»åŒºï¼Œæ¯”å¦‚åœ¨ååŒ—åœ°åŒºï¼Œ1 ä»£è¡¨åŒ—äº¬å¸‚ï¼Œ2 ä»£è¡¨å¤©æ´¥å¸‚ç­‰ã€‚
 *    ç¬¬ä¸‰ã€å››ä½æ•°å­—åˆ™è¡¨ç¤ºæˆ·ç±æ‰€åœ¨åœ°çš„åŒºã€å¿ã€å¿çº§å¸‚ã€æ——ã€‚
 *    ç¬¬äº”ã€å…­ä½æ•°å­—æ˜¯æˆ·ç±æ‰€åœ¨åœ°ã€‚
 *
 * å‡ºç”Ÿæ—¥æœŸç ï¼š
 *    èº«ä»½è¯å·ç ç¬¬ä¸ƒä½åˆ°ç¬¬åå››ä½è¡¨ç¤ºç¼–ç å¯¹è±¡å‡ºç”Ÿçš„å¹´ã€æœˆã€æ—¥ã€‚
 *
 * é¡ºåºç ï¼š
 *    èº«ä»½è¯å·ç ç¬¬åäº”ä½åˆ°åä¸ƒä½æ˜¯é¡ºåºç ï¼Œå¯¹åŒå¹´ã€æœˆã€æ—¥å‡ºç”Ÿçš„äººå‘˜ç¼–å®šçš„é¡ºåºå·ã€‚å…¶ä¸­ç¬¬åä¸ƒä½å¥‡æ•°åˆ†ç»™ç”·æ€§ï¼Œå¶æ•°åˆ†ç»™å¥³æ€§ã€‚
 *
 * æ ¡éªŒç ï¼š
 *    èº«ä»½è¯å·ç æœ€åä¸€ä½ä¸ºæ ¡éªŒç ã€‚
 *
 * æ ¡éªŒç çš„è®¡ç®—æ–¹æ³•ï¼š
 *    ä¸€ã€å°†èº«ä»½è¯å·ç å‰é¢çš„ 17 ä½æ•°åˆ†åˆ«ä¹˜ä»¥ä¸åŒçš„ç³»æ•°ã€‚ä»ç¬¬ä¸€ä½åˆ°ç¬¬åä¸ƒä½çš„ç³»æ•°åˆ†åˆ«ä¸ºï¼š7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ï¼1ï¼6ï¼3ï¼7ï¼9ï¼10ï¼5ï¼8ï¼4ï¼2ã€‚
 *    äºŒã€å°†è¿™ 17 ä½æ•°å­—å’Œç³»æ•°ç›¸ä¹˜çš„ç»“æœç›¸åŠ ã€‚
 *    ä¸‰ã€ç”¨åŠ å‡ºæ¥çš„å’Œé™¤ä»¥ 11ï¼Œä½™æ•°åªå¯èƒ½æœ‰ï¼š0ï¼1ï¼2ï¼3ï¼4ï¼5ï¼6ï¼7ï¼8ï¼9ï¼10 è¿™ 11 ä¸ªæ•°å­—ã€‚å…¶åˆ†åˆ«å¯¹åº”çš„æœ€åä¸€ä½èº«ä»½è¯çš„å·ç ä¸ºï¼š1ï¼0ï¼X ï¼9ï¼8ï¼7ï¼6ï¼5ï¼4ï¼3ï¼2ã€‚
 *    å››ã€å¦‚æœä½™æ•°æ˜¯ 2ï¼Œé‚£ä¹ˆèº«ä»½è¯çš„ç¬¬ 18 ä½æ•°å­—å°±æ˜¯ Xã€‚
 *
 * ç¤ºä¾‹ï¼š
 *    æŸå¥³æ€§çš„èº«ä»½è¯å·ç ä¸ºã€11010519491231002Xã€‘ï¼Œ æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªèº«ä»½è¯æ˜¯ä¸æ˜¯åˆæ³•çš„èº«ä»½è¯ã€‚
 *    é¦–å…ˆæˆ‘ä»¬å¾—å‡ºå‰ 17 ä½çš„ä¹˜ç§¯å’Œã€(1*7)+(1*9)+(0*10)+(1*5)+(0*8)+(5*4)+(1*2)+(9*1)+(4*6)+(9*3)+(1*7)+(2*9)+(3*10)+(1*5)+(0*8)+(0*4)+(2*2)ã€‘æ˜¯ 167ï¼Œ
 *    ç„¶åç”¨ 167 é™¤ä»¥ 11 å¾—å‡ºçš„ç»“æœæ˜¯ 167/11=15----2ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä½™æ•°æ˜¯ 2ã€‚
 *    æœ€åé€šè¿‡å¯¹åº”è§„åˆ™å°±å¯ä»¥çŸ¥é“ä½™æ•° 2 å¯¹åº”çš„æ£€éªŒç æ˜¯ Xã€‚
 *    æ‰€ä»¥ï¼Œå¯ä»¥åˆ¤å®šè¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„èº«ä»½è¯å·ç ã€‚
 *    è¯·çŸ¥æ‚‰ï¼Œç¤ºä¾‹ä¸­èº«ä»½è¯å·ç æ¥è‡ªå›½å®¶æ ‡å‡†æ–‡ä»¶é™„å½•ï¼Œè¯·å‹¿éæ³•ä½¿ç”¨ï¼Œå¦åˆ™åæœè‡ªè´Ÿï¼
 *
 * é™„ä¸Šï¼š
 *    ã€–ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡† GB 11643-1999ã€—ï¼šhttp://www.gb688.cn/bzgk/gb/newGbInfo?hcno=080D6FBF2BB468F9007657F26D60013E
 *    å…³äºèº«ä»½è¯æ ¡éªŒç ï¼Œå¯ä»¥çœ‹ï¼šhttps://baike.baidu.com/item/èº«ä»½è¯æ ¡éªŒç /3800388
 *
 * å…¶ä»–ï¼š
 *    ç›¸æ¯” 18 ä½çš„èº«ä»½è¯å·ç ï¼Œ15 ä½çš„èº«ä»½è¯å·å°‘äº†å‡ºå…¥å¹´ä»½çš„å‰ä¸¤ä½ï¼Œä»¥åŠæœ€åçš„æ ¡éªŒä½ã€‚å› æ­¤å°†ä½ ç°åœ¨çš„èº«ä»½è¯å·ç å»æ‰è¿™ä¸‰ä½æ•°å­—ï¼Œä½¿ç”¨æœ¬æ–¹æ³•ä¹Ÿå¯æ ¡éªŒé€šè¿‡
 */

// åœ°å€ç å‰ä¸¤ä½ï¼Œæ‰€å¯¹åº”çš„çœå¸‚ï¼š
// const provinceCodes = {
//   11: 'åŒ—äº¬',
//   12: 'å¤©æ´¥',
//   13: 'æ²³åŒ—',
//   14: 'å±±è¥¿',
//   15: 'å†…è’™å¤',
//   21: 'è¾½å®',
//   22: 'å‰æ—',
//   23: 'é»‘é¾™æ±Ÿ',
//   31: 'ä¸Šæµ·',
//   32: 'æ±Ÿè‹',
//   33: 'æµ™æ±Ÿ',
//   34: 'å®‰å¾½',
//   35: 'ç¦å»º',
//   36: 'æ±Ÿè¥¿',
//   37: 'å±±ä¸œ',
//   41: 'æ²³å—',
//   42: 'æ¹–åŒ—',
//   43: 'æ¹–å—',
//   44: 'å¹¿ä¸œ',
//   45: 'å¹¿è¥¿',
//   46: 'æµ·å—',
//   50: 'é‡åº†',
//   51: 'å››å·',
//   52: 'è´µå·',
//   53: 'äº‘å—',
//   54: 'è¥¿è—',
//   61: 'é™•è¥¿',
//   62: 'ç”˜è‚ƒ',
//   63: 'é’æµ·',
//   64: 'å®å¤',
//   65: 'æ–°ç–†',
//   71: 'å°æ¹¾',
//   81: 'é¦™æ¸¯',
//   82: 'æ¾³é—¨',
//   91: 'å›½å¤–'
// }
</code></pre>
<p>æ­¤æ–¹æ³•å·²æ”¶å½•è‡³ï¼š<a href="https://github.com/toFrankie/javascript-utils">toFrankie/javascript-utils</a>ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›æ¯”è¾ƒå®ç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚<strong>ä¸­æ–‡è½¬æ‹¼éŸ³</strong>ç­‰ï¼Œè¯·çœ‹<a href="https://github.com/toFrankie/javascript-utils">è¿™é‡Œ</a>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…­ã€Ajax ä¹‹ FormData]]></title>
            <link>https://github.com/toFrankie/blog/issues/215</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/215</guid>
            <pubDate>Sun, 26 Feb 2023 10:32:51 GMT</pubDate>
            <description><![CDATA[<h3>è¡¨å•ç¼–ç </h3>
<p>å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œè¡¨å•ä¸­çš„æ•°æ®ï¼ˆæ¯ä¸ªè¡¨å•å…ƒç´ çš„åå­—å’Œå€¼ï¼‰ç¼–ç åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶éšè¯·æ±‚å‘é€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTML è¡¨å•é€šè¿‡ POST æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œç¼–ç åçš„è¡¨å•æ•°æ®åˆ™ç”¨åšè¯·æ±‚ä¸»ä½“ã€‚</p>
<p>å¯¹è¡¨å•æ•°æ®ä½¿ç”¨çš„ç¼–ç æ–¹æ¡ˆç›¸å¯¹ç®€å•ï¼šå¯¹æ¯ä¸ªè¡¨å•å…ƒç´ çš„åå­—å’Œå€¼æ‰§è¡Œæ™®é€šçš„ <code>URL ]]></description>
            <content:encoded><![CDATA[<h3>è¡¨å•ç¼–ç </h3>
<p>å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œè¡¨å•ä¸­çš„æ•°æ®ï¼ˆæ¯ä¸ªè¡¨å•å…ƒç´ çš„åå­—å’Œå€¼ï¼‰ç¼–ç åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶éšè¯·æ±‚å‘é€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTML è¡¨å•é€šè¿‡ POST æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ï¼Œè€Œç¼–ç åçš„è¡¨å•æ•°æ®åˆ™ç”¨åšè¯·æ±‚ä¸»ä½“ã€‚</p>
<p>å¯¹è¡¨å•æ•°æ®ä½¿ç”¨çš„ç¼–ç æ–¹æ¡ˆç›¸å¯¹ç®€å•ï¼šå¯¹æ¯ä¸ªè¡¨å•å…ƒç´ çš„åå­—å’Œå€¼æ‰§è¡Œæ™®é€šçš„ <code>URL ç¼–ç </code>ï¼ˆä½¿ç”¨åå…­è¿›åˆ¶è½¬ä¹‰ç æ›¿æ¢ç‰¹æ®Šå­—ç¬¦ï¼‰ï¼Œä½¿ç”¨ <code>=</code> æŠŠç¼–ç åçš„åå­—å’Œå€¼åˆ†å¼€ï¼Œå¹¶ä½¿ç”¨ <code>&amp;</code> ç¬¦å·åˆ†å¼€ <code>å/å€¼å¯¹</code>ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„è¡¨å•çš„ç¼–ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>name=Frankie&amp;age=20&amp;height=180
</code></pre>
<p>è¡¨å•æ•°æ®ç¼–ç æ ¼å¼æœ‰ä¸€ä¸ªæ­£å¼çš„ <code>MIME</code> ç±»å‹ï¼š</p>
<pre><code>application/x-www-form-urlencoded
</code></pre>
<p>å½“ä½¿ç”¨ POST æ–¹æ³•æäº¤è¿™ç§é¡ºåºçš„è¡¨å•æ•°æ®å¸‚ï¼Œå¿…é¡»å°†è¯·æ±‚å¤´ <code>Content-Type</code> è®¾ç½®ä¸ºè¯¥å€¼ã€‚
æ³¨æ„ï¼šè¿™ç§ç±»å‹çš„ç¼–ç å¹¶ä¸éœ€è¦ HTML è¡¨å•ï¼Œåœ¨ Ajax åº”ç”¨ä¸­ï¼Œå¸Œæœ›å‘é€ç»™æœåŠ¡å™¨çš„å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå‰é¢å±•ç¤ºçš„æ•°æ®å˜æˆ JavaScript å¯¹è±¡çš„è¡¨å•ç¼–ç å½¢å¼å¯èƒ½æ˜¯ï¼š</p>
<pre><code>{ name: 'Frankie', age: 20, height: 180 }
</code></pre>
<p>è¡¨å•ç¼–ç åœ¨ Web ä¸Šå¦‚æ­¤å¹¿æ³›åœ°ä½¿ç”¨ï¼ŒåŒæ—¶æ‰€æœ‰æœåŠ¡å™¨ç«¯çš„ç¼–ç¨‹è¯­è¨€éƒ½èƒ½å¾—åˆ°è‰¯å¥½çš„æ”¯æŒï¼Œæ‰€ä»¥éè¡¨å•æ•°æ®çš„è¡¨å•ç¼–ç é€šå¸¸ä¹Ÿæ˜¯å®¹æ˜“å®ç°çš„äº‹æƒ…ï¼Œä¸‹é¢ä»£ç å±•ç¤ºå¦‚ä½•å®ç°å¯¹è±¡å±æ€§çš„è¡¨å•ç¼–ç ï¼š</p>
<pre><code class="language-js">function encodeFormData(data) {
  if (!data) return ''
  const pairs = []    // ç”¨äºä¿å­˜åå€¼å¯¹
  for (let key in data) {
    if (!data.hasOwnProperty(key) || typeof data[key] === 'function') {
      continue
    }
    let value = data[key].toString()                        // æŠŠå€¼è½¬æ¢æˆå­—ç¬¦ä¸²
    let name = encodeURIComponent(key.replace('%20', '+'))  // ç¼–ç åå­—
    value = encodeURIComponent(value.replace('%20', '+'))   // ç¼–ç å€¼
    pairs.push(name + '=' + value)
  }
  return pairs.join('&amp;')  // è¿”å›ä½¿ç”¨'&amp;'è¿æ¥çš„åå€¼å¯¹
}

const data = { name: 'è¶Šå‰å›', age: 20, height: 180 }
console.log(encodeFormData(data))   // name=%E8%B6%8A%E5%89%8D%E5%90%9B&amp;age=20&amp;height=180
</code></pre>
<h3>è¡¨å•åºåˆ—åŒ–</h3>
<p>éšç€ Ajax çš„å‡ºç°ï¼Œè¡¨å•åºåˆ—åŒ–å·²ç»æˆä¸ºä¸€ç§å¸¸è§çš„éœ€æ±‚ï¼Œåœ¨ JavaScript ä¸­ï¼Œå¯ä»¥åˆ©ç”¨è¡¨å•å­—æ®µçš„ <code>type</code> å±æ€§ï¼Œè¿åŒ <code>name</code> å’Œ <code>value</code> å±æ€§ä¸€èµ·å®ç°å¯¹è¡¨å•åºåˆ—åŒ–ã€‚åœ¨ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆå¼„æ¸…æ¥šåœ¨è¡¨å•æäº¤æœŸé—´ï¼Œæµè§ˆå™¨æ˜¯å¦‚ä½•å°†æ•°æ®å‘é€ç»™æœåŠ¡å™¨çš„ã€‚</p>
<ul>
<li><strong>å¯¹è¡¨å•å­—æ®µçš„åç§°å’Œå€¼è¿›è¡Œ <code>URL ç¼–ç </code>ï¼Œä½¿ç”¨ <code>&amp;</code> åˆ†éš”ï¼›</strong></li>
<li><strong>ä¸å‘é€ç¦ç”¨çš„è¡¨å•å­—æ®µï¼›</strong></li>
<li><strong>åªå‘é€å‹¾é€‰çš„å¤é€‰æ¡†å’Œå•é€‰æ¡†æŒ‰é’®ï¼›</strong></li>
<li><strong>ä¸å‘é€ <code>type</code> ä¸º <code>reset</code> å’Œ <code>button</code> çš„æŒ‰é’®ï¼›</strong></li>
<li><strong>å¯¹é€‰é€‰æ‹©æ¡†ä¸­ï¼Œæ¯ä¸ªé€‰ä¸­çš„å€¼å•ç‹¬ä¸€ä¸ªæ¡ç›®ï¼›</strong></li>
<li><strong>åœ¨å•å‡»æäº¤æŒ‰é’®æäº¤è¡¨å•çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå‘é€æäº¤æŒ‰é’®ï¼›å¦åˆ™ï¼Œä¸å‘é€æä»·æŒ‰é’®ã€‚ä¹ŸåŒ…æ‹¬ <code>type</code> ä¸º <code>image</code> çš„ <code>&lt;input&gt;</code> å…ƒç´ ï¼›</strong></li>
<li><strong><code>&lt;select&gt;</code> å…ƒç´ çš„å€¼ï¼Œå°±æ˜¯é€‰ä¸­çš„ <code>&lt;option&gt;</code> å…ƒç´ çš„ <code>value</code> å±æ€§å€¼ã€‚ å¦‚æœ <code>&lt;option&gt;</code> å…ƒç´ æ²¡æœ‰ <code>value</code> å±æ€§ï¼Œåˆ™æ˜¯ <code>&lt;option&gt;</code> å…ƒç´ çš„æ–‡æœ¬å€¼</strong></li>
</ul>
<p>åœ¨è¡¨å•åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¸åŒ…æ‹¬ä»»ä½•æŒ‰é’®å­—æ®µï¼Œå› ä¸ºç»“æœå­—ç¬¦ä¸²å¾ˆå¯èƒ½æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼æäº¤çš„ã€‚é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–ä¸Šè¿°è§„åˆ™éƒ½åº”è¯¥éµå¾ªã€‚</p>
<p>åœ¨ä¸‹é¢è¡¨å•åºåˆ—åŒ– <code>serialize()</code> å‡½æ•°ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>parts</code> æ•°ç»„ï¼Œç”¨äºä¿å­˜å°†è¦åˆ›å»ºçš„å­—ç¬¦ä¸²çš„å„ä¸ªéƒ¨åˆ†ã€‚ç„¶åï¼Œé€šè¿‡ <code>for</code> å¾ªç¯éå†æ¯ä¸ªè¡¨å•å­—æ®µï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ <code>field</code> å˜é‡ä¸­ã€‚åœ¨æ´»åŠ¨ä¸€ä¸ªå­—æ®µçš„å¼•ç”¨ä¹‹åï¼Œä½¿ç”¨ <code>switch</code> è¯­å¥æ£€æµ‹å…¶ <code>type</code> å±æ€§ã€‚</p>
<p>åºåˆ—åŒ–è¿‡ç¨‹ä¸­æœ€éº»çƒ¦çš„å°±æ˜¯ <code>&lt;select&gt;</code> å…ƒç´ ï¼Œå®ƒå¯èƒ½æ˜¯å•é€‰æ¡†ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤šé€‰æ¡†ã€‚ä¸ºæ­¤ï¼Œéœ€è¦éå†æ§ä»¶ä¸­çš„æ¯ä¸€ä¸ªé€‰é¡¹ï¼Œå¹¶åœ¨ç›¸åº”é€‰é¡¹è¢«é€‰ä¸­çš„æƒ…å†µä¸‹å‘æ•°ç»„æ·»åŠ ä¸€ä¸ªå€¼ã€‚å¯¹äºå•é€‰æ¡†ï¼Œåªæœ‰ä¸€ä¸ªé€‰ä¸­é¡¹ï¼Œè€Œå¤šé€‰æ¡†åˆ™å¯èƒ½æœ‰é›¶ä¸ªæˆ–å¤šä¸ªé€‰ä¸­é¡¹ã€‚è¿™é‡Œçš„ä»£ç é€‚ç”¨äºè¿™ä¸¤ç§é€‰æ‹©æ¡†ï¼Œè‡³äºå¯é€‰é¡¹çš„æ•°é‡åˆ™æ˜¯ç”±æµè§ˆå™¨æ§åˆ¶çš„ã€‚åœ¨æ‰¾åˆ°ä¸€ä¸ªé€‰ä¸­é¡¹ä¹‹åï¼Œéœ€è¦ç¡®å®šä½¿ç”¨ä»€ä¹ˆå€¼ã€‚å¦‚æœä¸å­˜åœ¨ <code>value</code> å±æ€§ï¼Œæˆ–è€…è™½ç„¶å­˜åœ¨è¯¥å±æ€§ï¼Œä½†å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œéƒ½è¦ä½¿ç”¨é€‰é¡¹çš„æ–‡æœ¬æ¥ä»£æ›¿ã€‚ä¸ºæ£€æŸ¥è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ DOM å…¼å®¹çš„æµè§ˆå™¨ä¸­éœ€è¦ä½¿ç”¨ <code>hasAttribute()</code> æ–¹æ³•ï¼Œè€Œåœ¨ IE7 ä¸­éœ€è¦ä½¿ç”¨å±æ€§ <code>specified</code> å±æ€§ã€‚</p>
<p>å¦‚æœè¡¨å•ä¸­åŒ…å« <code>&lt;fieldset&gt;</code> å…ƒç´ ï¼Œåˆ™è¯¥å…ƒç´ ä¼šå‡ºç°åœ¨å…ƒç´ é›†åˆä¸­ï¼Œä½†æ²¡æœ‰ <code>type</code> å±æ€§ã€‚å› æ­¤ï¼Œå¦‚æœ <code>type</code> å±æ€§æœªå®šä¹‰ï¼Œåˆ™ä¸éœ€è¦å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–ã€‚åŒæ ·ï¼Œå¯¹äºå„ç§æŒ‰é’®ä»¥åŠæ–‡ä»¶è¾“å…¥å­—æ®µä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆæ–‡ä»¶è¾“å…¥å­—æ®µåœ¨è¡¨å•æäº¤è¿‡ç¨‹ä¸­åŒ…å«æ–‡ä»¶çš„å†…å®¹ï¼›ä½†æ˜¯ï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ— æ³•æ¨¡ä»¿çš„ï¼Œåºåˆ—åŒ–æ—¶ä¸€èˆ¬éƒ½è¦å¿½ç•¥ï¼‰</p>
<p>å¯¹äºå•é€‰æŒ‰é’®å’Œå¤é€‰æ¡†ï¼Œè¦æ£€æŸ¥å…¶ <code>checked</code> å±æ€§æ˜¯å¦è¢«è®¾ç½®ä¸º <code>false</code>ï¼Œå¦‚æœæ˜¯åˆ™é€€å‡º <code>switch</code> è¯­å¥ã€‚å¦‚æœ <code>checked</code> å±æ€§æ˜¯ <code>true</code>ï¼Œåˆ™ç»§ç»­æ‰§è¡Œ <code>default</code> è¯­å¥ï¼Œå³å°†å½“å‰å­—æ®µçš„åç§°å’Œå€¼è¿›è¡Œç¼–ç ï¼Œç„¶åæ·»åŠ åˆ° <code>parts</code> æ•°ç»„ä¸­ã€‚å‡½æ•°çš„æœ€åä¸€æ­¥ï¼Œå°±æ˜¯ä½¿ç”¨ <code>join()</code> ä¸ªæ•°æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ç”¨ <code>&amp;</code> æ¥åˆ†éš”æ¯ä¸€ä¸ªè¡¨å•å­—æ®µã€‚</p>
<p>æœ€å <code>serialize()</code> å‡½æ•°ä¼šä»¥æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ ¼å¼è¾“å‡ºåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code>// æœªå®Œå¾…ç»­ï¼Œä¾‹å­æ™šç‚¹åŠ ä¸Š
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ä¹‹å¿«é€Ÿæ’åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/214</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/214</guid>
            <pubDate>Sun, 26 Feb 2023 10:31:21 GMT</pubDate>
            <description><![CDATA[<p><code>å¿«é€Ÿæ’åº</code>ï¼Œç®€ç§° <code>å¿«æ’</code>ï¼Œæ˜¯æœ€å¸¸è§çš„ç®—æ³•ä¹‹ä¸€ã€‚<code>æ¡¶æ’åº</code> è™½ç„¶å¿«ï¼Œä½†æ˜¯ç©ºé—´æ¶ˆè€—å¤§ï¼Œ<code>å†’æ³¡æ’åº</code> åˆ©ç”¨çš„ç©ºé—´è¾ƒä¸ºåˆç†ä½†æ˜¯ <code>O(nÂ²)</code>ï¼Œæ˜¾ç„¶åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ä¸å¤Ÿå¿«ã€‚<code>å¿«é€Ÿæ’åº</code> ç®—]]></description>
            <content:encoded><![CDATA[<p><code>å¿«é€Ÿæ’åº</code>ï¼Œç®€ç§° <code>å¿«æ’</code>ï¼Œæ˜¯æœ€å¸¸è§çš„ç®—æ³•ä¹‹ä¸€ã€‚<code>æ¡¶æ’åº</code> è™½ç„¶å¿«ï¼Œä½†æ˜¯ç©ºé—´æ¶ˆè€—å¤§ï¼Œ<code>å†’æ³¡æ’åº</code> åˆ©ç”¨çš„ç©ºé—´è¾ƒä¸ºåˆç†ä½†æ˜¯ <code>O(nÂ²)</code>ï¼Œæ˜¾ç„¶åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ä¸å¤Ÿå¿«ã€‚<code>å¿«é€Ÿæ’åº</code> ç®—æ˜¯ä»ä¸¤è€…å–é•¿è¡¥çŸ­çš„ç®—æ³•ã€‚</p>
<h3>åŸç†</h3>
<p>ä»¥å‡åºä¸ºä¾‹ï¼š</p>
<ol>
<li>åœ¨æ•°æ®ä¸­é€‰ä¸€ä¸ªä½œä¸º <code>åŸºå‡†æ•°</code>ã€‚ï¼ˆä¸€èˆ¬ä¹ æƒ¯é€‰æ‹©ä¸­é—´çš„æ•°ï¼Œä½†é€‰æ‹©å…¶ä»–æ•°ä¹Ÿå¯ä»¥ï¼‰</li>
<li>å°†æ‰€æœ‰çš„æ•°æ®è¿›è¡Œéå†ï¼ˆé™¤åŸºå‡†æ•°å¤–ï¼‰ï¼Œå°äºç­‰äºåŸºæ•°çš„æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶æ•°ç»„ <code>arr1</code>ï¼Œå¤§äºæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶æ•°ç»„ <code>arr2</code>ã€‚</li>
<li>è‹¥åªæœ‰ä¸¤ä¸ªæ•°åˆ™å°†å°çš„æ”¾å‰é¢ï¼Œå¤§çš„æ”¾åé¢ï¼›è‹¥ <code>arr1</code> æˆ– <code>arr2</code> åªæœ‰ <code>0~1</code> ä¸ªåˆ™å½“å‰æ•°ç»„é€€å‡ºã€‚</li>
<li>å°† <code>arr1</code>ï¼Œ<code>arr2</code> æ‰§è¡Œæ­¥éª¤ 1ã€2ã€3ã€‚ï¼ˆå³é€’å½’å®ç°ï¼‰</li>
</ol>
<h3>å›¾ç¤º</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-470fe3570e25a292.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¿«é€Ÿæ’åº"></p>
<h3>å®ç°</h3>
<pre><code class="language-js">function sort(arr) {
  // è®¾ç½®é€’å½’å‡ºå£
  if (arr.length &lt;= 1) return arr
  // è®¾ç½®åŸºæ•°ï¼Œå¹¶å°†åŸºæ•°ç§»å‡º
  let base = Math.floor(arr.length / 2)
  let baseValue = arr.splice(base, 1)[0]
  // ä¸´æ—¶æ•°ç»„ã€‚1ï¼‰å°äºç­‰äºåŸºæ•°æ”¾å…¥ arr1ï¼›2ï¼‰å¤§äºæ”¾å…¥åŸºæ•°æ”¾å…¥ arr2
  let arr1 = []
  let arr2 = []
  for (let i = 0; i &lt; arr.length; i++) {
    if (arr[i] &lt;= baseValue) {
      arr1.push(arr[i])
    } else {
      arr2.push(arr[i])
    }
  }
  // é€’å½’
  return sort(arr1).concat([baseValue], sort(arr2))
}

let array = [4, 9, 3, 6, 21, 5, 0, 30, 2, 14]
console.log(sort(array)) // [0, 2, 3, 4, 5, 6, 9, 14, 21, 30]
</code></pre>
<h3>æ—¶é—´å¤æ‚åº¦</h3>
<p>å¿«é€Ÿæ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º <code>O(nlogn)</code>ï¼Œå¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦è®¡ç®—è¾ƒä¸ºå¤æ‚ã€‚</p>
<p>æœ‰å…´è¶£çš„åŒå­¦å¯å‚è€ƒï¼š<a href="https://www.zhihu.com/question/22393997">å¦‚ä½•è¯æ˜å¿«é€Ÿæ’åºæ³•çš„å¹³å‡å¤æ‚åº¦ä¸º O(nlogn)ï¼Ÿ</a>
å¯ä»¥çœ‹åˆ°çš„æ˜¯ <code>å¿«é€Ÿæ’åº</code> çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä»‹äº <code>æ¡¶æ’åº O(n)</code> å’Œ <code>å†’æ³¡æ’åº O(n^2)</code> ä¹‹é—´çš„ï¼š
<code>O(1) &lt; O(logn) &lt; O(n) &lt; O(n*logn) &lt; O(n^2) &lt; O(n^3) &lt; O(2^n) &lt; O(n!) &lt; O(n^n)</code>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | æ·±å…¥ç»§æ‰¿åŸç†]]></title>
            <link>https://github.com/toFrankie/blog/issues/213</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/213</guid>
            <pubDate>Sun, 26 Feb 2023 10:18:57 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>åŸæ–‡å‡ºè‡ª <a href="https://juejin.im/post/5a96d78ef265da4e9311b4d8">ULIVZ</a>ã€‚</p>
</blockquote>
<blockquote>
<p>æ¥ä¸Šç¯‡ã€Š<a href="https://github.com/toFr]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>åŸæ–‡å‡ºè‡ª <a href="https://juejin.im/post/5a96d78ef265da4e9311b4d8">ULIVZ</a>ã€‚</p>
</blockquote>
<blockquote>
<p>æ¥ä¸Šç¯‡ã€Š<a href="https://github.com/toFrankie/blog/issues/212">JavaScript åŸå‹è¯¦è§£</a>ã€‹ã€‚</p>
</blockquote>
<p><code>ES6</code> çš„ <code>class</code> è¯­æ³•ç³–ä½ æ˜¯å¦å·²ç»ç”¨å¾—ç‚‰ç«çº¯é’å‘¢ï¼Ÿé‚£å¦‚æœå›å½’åˆ° <code>ES5</code> å‘¢ï¼Ÿ</p>
<p>æœ¬æ–‡ï¼Œå°†ç»§ç»­ä¸Šä¸€ç¯‡å°¾ç¯‡æå‡ºçš„ç–‘é—®ï¼š<code>å¦‚ä½•ç”¨ JavaScript å®ç°ç±»çš„ç»§æ‰¿ï¼Ÿ</code> æ¥å±•å¼€é˜è¿°ã€‚</p>
<p>é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†å­¦åˆ°ï¼š</p>
<ol>
<li>å¦‚ä½•ç”¨ JavaScript æ¨¡æ‹Ÿç±»ä¸­çš„ç§æœ‰å˜é‡ï¼Ÿ</li>
<li>äº†è§£å¸¸è§çš„å‡ ç§ JavaScript ç»§æ‰¿æ–¹æ³•ï¼ŒåŸç†æå…¶ä¼˜ç¼ºç‚¹ã€‚</li>
<li>å®ç°ä¸€ä¸ªè¾ƒä¸º fancy çš„ JavaScript ç»§æ‰¿æ–¹æ³•ã€‚</li>
</ol>
<p>æ­¤å¤–ï¼Œå¦‚æœä½ å®Œå…¨æ˜ç™½äº†æ–‡æœ«çš„ç»ˆæç‰ˆç»§æ‰¿ï¼Œä½ ä¹Ÿå°±æ‡‚äº†è¿™ä¸¤ç¯‡æ‰€è¦å°†çš„æ ¸å¿ƒçŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿèƒ½è¯´æ˜ä½ æ‹¥æœ‰ä¸é”™çš„ JavaScript åŸºç¡€ã€‚</p>
<h2>ç±»</h2>
<p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ <code>ES6 / TypeScript / ES5</code> çš„ç±»å†™æ³•ä»¥ä½œå¯¹æ¯”ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>GitHubUser</code> ç±»ï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ª <code>login</code> æ–¹æ³•å’Œä¸€ä¸ªé™æ€æ–¹æ³• <code>getPublicServices</code>ï¼Œç”¨äºè·å– <code>public</code> çš„æ–¹æ³•åˆ—è¡¨ï¼š</p>
<pre><code class="language-js">// ES6
class GithubUser {
  static getPublicServices() {
    return [&quot;login&quot;];
  }

  constructor(username, password) {
    this.username = username;
    this.password = password;
  }

  login() {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + this.password);
  }
}
</code></pre>
<p>å®é™…ä¸Šï¼Œ<code>ES6</code> è¿™ä¸ªç±»çš„å†™æ³•æœ‰ä¸€ä¸ªå¼Šç—…ï¼Œå®é™…ä¸Šå¯†ç  <code>password</code> åº”è¯¥æ˜¯ <code>GitHub</code> ç”¨æˆ·ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ <code>TypeScript</code> é‡å†™ä¸€ä¸‹ï¼š</p>
<pre><code class="language-ts">// TypeScript
class GithubUser {
  static getPublicServices() {
    return [&quot;login&quot;];
  }

  public username: string;
  private password: string;

  constructor(username, password) {
    this.username = username;
    this.password = password;
  }

  public login(): void {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + this.password);
  }
}
</code></pre>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œ<code>password</code> å°±åªèƒ½åœ¨ç±»çš„å†…éƒ¨è®¿é—®äº†ã€‚å¥½äº†ï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚æœç»“åˆåŸå‹è®²è§£é‚£ç–‘é—®çš„çŸ¥è¯†ï¼Œæ¥ç”¨ <code>ES5</code> å®ç°è¿™ä¸ªç±»å‘¢ï¼Ÿ</p>
<pre><code class="language-js">function GithubUser(username, password) {
  // private å±æ€§
  let _password = password;
  // public å±æ€§
  this.username = username;
  // public æ–¹æ³•
  GithubUser.prototype.login = function() {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

GithubUser.getPublicServices = function() {
  return [&quot;login&quot;];
};
</code></pre>
<blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæŠŠ <code>å…±æœ‰æ–¹æ³•</code> æ”¾åœ¨ç±»çš„åŸå‹ä¸Šï¼Œè€Œä¸ä¼šé‡‡ç”¨ <code>this.login = function() {}</code> è¿™ç§å†™æ³•ã€‚å› ä¸ºåªæœ‰è¿™æ ·ï¼Œæ‰èƒ½è®©å¤šä¸ªå®ä¾‹å¼•ç”¨åŒä¸€ä¸ªå…±æœ‰æ–¹æ³•ï¼Œä»è€Œé¿å…é‡å¤åˆ›å»ºæ–¹æ³•çš„æµªè´¹ã€‚</p>
</blockquote>
<p>æ˜¯ä¸æ˜¯å¾ˆç›´è§‚ï¼Œç•™ä¸‹ 2 ä¸ªç–‘é—®ï¼š</p>
<ol>
<li>å¦‚ä½•å®ç° <code>private æ–¹æ³•</code> å‘¢ï¼Ÿ</li>
<li>èƒ½å¦å®ç° <code>protected å±æ€§/æ–¹æ³•</code> å‘¢ï¼Ÿ</li>
</ol>
<h2>ç»§æ‰¿</h2>
<p>æˆ‘ä»¬å¦‚æœåˆ›å»ºä¸€ä¸ª <code>User</code> æ¥ç»§æ‰¿ <code>GitHubUser</code>ï¼Œé‚£ä¹ˆ <code>User</code> åŠå…¶å®ä¾‹å°±å¯ä»¥è°ƒç”¨ <code>GitHubUser</code> çš„ <code>login</code> æ–¹æ³•äº†ã€‚é¦–å…ˆï¼Œå…ˆå†™å‡ºè¿™ä¸ªç®€å•çš„ <code>User</code> ç±»ï¼š</p>
<pre><code class="language-js">function User(username, password, articles) {
  // TODO need implementation
  this.articles = articles;  // æ–‡ç« æ•°é‡
  User.prototype.readArticle = function () {
    console.log('Read article');
  }
}
</code></pre>
<p>ç”±äº <code>ES6/TS</code> çš„ç»§æ‰¿æ–¹å¼å¤ªè¿‡ç›´è§‚ï¼Œæœ¬èŠ‚å°†å¿½ç•¥ã€‚é¦–å…ˆæ¦‚è¿°ä¸€ä¸‹æœ¬æ–‡å°†è¦è®²è§£çš„å‡ ç§ç»§æ‰¿æ–¹å¼ï¼š</p>
<ul>
<li>ç±»å¼ç»§æ‰¿</li>
<li>æ„é€ å‡½æ•°ç»§æ‰¿</li>
<li>ç»„åˆå¼ç»§æ‰¿</li>
<li>åŸå‹ç»§æ‰¿</li>
<li>å¯„ç”Ÿå¼ç»§æ‰¿</li>
<li>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</li>
</ul>
<p>çœ‹èµ·æ¥å¾ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬ä¸€ä¸€è®ºè¿°ã€‚</p>
<h3>ç±»å¼ç»§æ‰¿</h3>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»å¾—çŸ¥ï¼šè‹¥é€šè¿‡ <code>new Parent()</code> åˆ›å»ºäº† <code>child</code>ï¼Œåˆ™ <code>child.__proto__ = Parent.prototype</code>ï¼Œè€ŒåŸå‹é“¾åˆ™é¡ºç€ <code>__proto__</code> ä¾æ¬¡å‘ä¸ŠæŸ¥æ‰¾ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å­ç±»çš„åŸå‹ä¸ºçˆ¶ç±»çš„å®ä¾‹æ¥å®ç°ç»§æ‰¿ã€‚</p>
<pre><code class="language-js">function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
  User.prototype = new GithubUser(username, password);
  User.prototype.readArticle = function () {
    console.log('Read article');
  }
}
var user = new User('Frankie', 'abc', 5);
console.log(user);
</code></pre>
<p>åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-082282f153017cc1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¯¶ï¼Œä¸å¯¹å•Šï¼Œå¾ˆæ˜æ˜¾ <code>user.__proto__</code> å¹¶ä¸æ˜¯ <code>GitHubUser</code> çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™æ˜¯å› ä¸ºä¹‹å‰æˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿåœ¨ç±»çš„æ–¹æ³•ä¸­è¯»å–ç§æœ‰å˜é‡ï¼Œå°† <code>User.prototype</code> çš„é‡æ–°èµ‹å€¼æ”¾åœ¨äº†æ„é€ å‡½æ•°ä¸­ï¼Œè€Œæ­¤æ—¶å®ä¾‹å·²ç»åˆ›å»ºï¼Œå…¶ <code>__proto__</code> è¿˜æŒ‡å‘è€çš„ <code>User.prototype</code>ã€‚æ‰€ä»¥ï¼Œé‡æ–°èµ‹å€¼ä¸€ä¸‹å®ä¾‹çš„ <code>__proto__</code>ã€‚æ‰€ä»¥é‡æ–°èµ‹å€¼ä¸€ä¸‹å®ä¾‹çš„ <code>__proto__</code> å°±å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<pre><code class="language-js">// ç±»å¼ç»§æ‰¿

function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
  var prototype = new GithubUser(username, password);
  // User.prototype = prototype;  // è¿™ä¸€è¡Œå·²ç»æ²¡æœ‰æ„ä¹‰äº†
  prototype.readArticle = function () {
    console.log('Read article');
  }
  this.__proto__ = prototype;
}
var user = new User('Frankie', 'abc', 5);
console.log(user);

// ä½†ç”±äºç§è‡ªç¯¡æ”¹äº† __proto__ï¼Œå¯¼è‡´ä»¥ä¸‹ä¸æˆç«‹
console.log(user.__proto__ === User.prototype);   // false
console.log(user instanceof User);                // false
</code></pre>
<p>ç»§ç»­æŸ¥çœ‹æ§åˆ¶å°æ‰“å°çš„ç»“æœï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677407223368.png" alt=""></p>
<p>Perfectï¼åŸå‹é“¾å·²ç»å‡ºæ¥ï¼Œé—®é¢˜â€œ<strong>å¥½åƒ</strong>â€å¾—åˆ°äº†å®Œç¾è§£å†³ï¼<strong>ä½†å®é™…ä¸Šè¿˜æ˜¯æœ‰æ˜æ˜¾çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li>åœ¨åŸå‹é“¾ä¸Šåˆ›å»ºäº†å±æ€§ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ç§å¥½çš„å®è·µï¼‰ã€‚</li>
<li>ç§è‡ªç¯¡æ”¹ <code>__proto__</code>ï¼Œå¯¼è‡´ <code>user.__proto__ === User.prototype</code> ä¸æˆç«‹ï¼ä»è€Œå¯¼è‡´ <code>user instanceof User</code> ä¹Ÿä¸æˆç«‹ï¼Œè¿™ä¸æ˜¯åº”è¯¥å‘ç”Ÿçš„ï¼</li>
</ol>
<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œé€ æˆè¿™ç§é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºæˆ‘ä»¬åœ¨å®ä¾‹åŒ–çš„æ—¶å€™åŠ¨æ€ä¿®æ”¹äº†åŸå‹ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨å®ä¾‹åŒ–ä¹‹å‰å°±å›ºå®šå¥½ç±»çš„åŸå‹çš„ <code>refernce</code> å‘¢ï¼Ÿ</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠç±»çš„åŸå‹èµ‹å€¼æŒªå‡ºæ¥ï¼š</p>
<pre><code class="language-js">// ç±»å¼ç»§æ‰¿ï¼Œä¿®æ”¹ç‰ˆ

function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
}

// æ­¤æ—¶æ„é€ å‡½æ•°è¿˜æœªè¿è¡Œï¼Œæ— æ³•è®¿é—® username å’Œ password ï¼
User.prototype = new GithubUser();

User.prototype.readArticle = function () {
  console.log('Read article');
}

var user = new User('Frankie', 'abc', 5);
console.log(user)

// ä»¥ä¸‹æˆç«‹
console.log(user.__proto__ === User.prototype);   // true
console.log(user instanceof User);                // true
</code></pre>
<p>æ‰“å° <code>user</code> å®ä¾‹çš„ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c97040b942e035f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™æ ·åšåˆæœ‰æ˜æ˜¾çš„<strong>ç¼ºç‚¹</strong>ï¼š</p>
<ol>
<li><strong>çˆ¶ç±»è¿‡æ—©è¢«åˆ›å»ºï¼Œå¯¼è‡´æ— æ³•æ¥å—å­ç±»çš„åŠ¨æ€å‚æ•°ï¼›</strong></li>
<li><strong>ä»ç„¶åœ¨åŸå‹ä¸Šåˆ›å»ºäº†å±æ€§ï¼Œæ­¤æ—¶ï¼Œå¤šä¸ªå­ç±»çš„å®ä¾‹å°†å…±äº«åŒä¸€ä¸ªçˆ¶ç±»çš„å±æ€§ï¼Œå®Œè›‹ä¼šäº’ç›¸å½±å“ï¼</strong></li>
</ol>
<pre><code class="language-js">// ä¸¾ä¾‹è¯´æ˜ç¼ºç‚¹ 2ï¼š
function GithubUser(username) {
  this.username = username;
}

function User(username, password) {};

User.prototype = new GithubUser();
var user1 = new User('Frankie', 'abc');
var user2 = new User('Mandy', 'mno');

// è¿™å°±æ˜¯æŠŠå±æ€§å®šä¹‰åœ¨åŸå‹é“¾ä¸Šçš„è‡´å‘½ç¼ºç‚¹ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä½†ä¿®æ”¹å°±æ˜¯ä¸€ä»¶éš¾äº‹äº†ï¼
console.log(user1.username);          // undefined ï¼ˆç¼ºç‚¹ 1ï¼šçˆ¶ç±»è¿‡æ—©åœ°è¢«åˆ›å»ºï¼Œå¯¼è‡´æ— æ³•æ¥å—å­ç±»çš„åŠ¨æ€å‚æ•°ï¼‰
user1.__proto__.username = 'Other';
console.log(user1.username);          // &quot;Other&quot;

// å§æ§½æ— æƒ…ï¼Œå½±å“äº†å¦ä¸€ä¸ªå®ä¾‹ï¼
console.log(user2.username);          // &quot;Ohter&quot;
</code></pre>
<p>ç”±æ­¤å¯è§ï¼Œ<code>ç±»å¼ç»§æ‰¿</code> çš„ä¸¤ç§æ–¹å¼ç¼ºé™·å¤ªå¤šï¼</p>
<h3>æ„é€ å‡½æ•°ç»§æ‰¿</h3>
<p>é€šè¿‡ <code>call()</code> æ¥å®ç°ç»§æ‰¿ã€‚ç›¸åº”åœ°ï¼Œä½ å¯ä»¥ç”¨ <code>apply()</code> å®ç°ã€‚</p>
<pre><code class="language-js">// æ„é€ å‡½æ•°ç»§æ‰¿

function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
  GithubUser.call(this, username, password);
  // æˆ–è€…ä½¿ç”¨ apply
  // GithubUser.apply(this, [username, password]);
}

var user = new User('Frankie', 'abc', 5);
console.log(user.username);   // Frankie
console.log(user.articles);   // 5
user.login();                 // Uncaught TypeError: user.login is not a function
</code></pre>
<p>å½“ç„¶ï¼Œå¦‚æœç»§æ‰¿çœŸå¦‚æ­¤ç®€å•ï¼Œé‚£ä¹ˆæœ¬æ–‡å°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼Œæœ¬ç»§æ‰¿æ–¹æ³•ä¹Ÿå­˜åœ¨æ˜æ˜¾çš„ç¼ºé™·ï¼š<strong><code>æ„é€ å‡½æ•°å¼ç»§æ‰¿</code>å¹¶æ²¡æœ‰ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•</strong>ã€‚</p>
<h3>ç»„åˆå¼ç»§æ‰¿</h3>
<p>æ—¢ç„¶ä¸Šè¿°ä¸¤ç§æ–¹å¼å„æœ‰ç¼ºç‚¹ï¼Œä½†æ˜¯åˆå„æœ‰æ‰€é•¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†å…¶ç»“åˆèµ·æ¥ä½¿ç”¨å‘¢ï¼Ÿï¼Ÿæ²¡é”™ï¼Œè¿™ç§æ–¹å¼å«åšï¼š<code>ç»„åˆå¼ç»§æ‰¿</code>ã€‚</p>
<pre><code class="language-js">// ç»„åˆå¼ç»§æ‰¿

function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
  GithubUser.call(this, username, password);  // ç¬¬äºŒæ¬¡æ‰§è¡Œ GitHubUser æ„é€ å‡½æ•°
}

User.prototype = new GithubUser();    // ç¬¬ä¸€æ¬¡æ‰§è¡Œ GitHubUser æ„é€ å‡½æ•°

var user = new User('Frankie', 'abc', 5);
console.log(user);
console.log(user.username);
console.log(user.articles);
user.login();
</code></pre>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6af2d57443df4af6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è™½ç„¶è¿™ç§æ–¹å¼å¼¥è¡¥äº†ä¸Šè¿°ä¸¤ç§æ–¹å¼çš„ä¸€äº›ç¼ºé™·ï¼Œä½†æœ‰äº›é—®é¢˜ä»ç„¶å­˜åœ¨ï¼š</p>
<ol>
<li><strong>å­ç±»ä»æ—§æ— æ³•ä¼ é€’åŠ¨æ€å‚æ•°ç»™çˆ¶ç±»ï¼</strong></li>
<li><strong>çˆ¶ç±»çš„æ„é€ å‡½æ•°è¢«è°ƒç”¨äº†ä¸¤æ¬¡ã€‚</strong></li>
</ol>
<p>æœ¬æ–¹å¼å¾ˆæ˜æ˜¾æ‰§è¡Œäº†ä¸¤æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œè¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„ç»§æ‰¿æ–¹å¼ã€‚</p>
<h3>åŸå‹ç»§æ‰¿</h3>
<p><code>åŸå‹ç»§æ‰¿</code> å®é™…ä¸Šå°±æ˜¯å¯¹ <code>ç±»å¼ç»§æ‰¿</code> çš„ä¸€ç§å°è£…ï¼Œåªä¸è¿‡å…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®šä¹‰äº†ä¸€ä¸ªå¹²å‡€çš„ä¸­é—´ç±»ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// åŸå‹ç»§æ‰¿

function createObject(o) {
  // åˆ›å»ºä¸´æ—¶ç±»
  function F() { };
  // ä¿®æ”¹ä¸´æ—¶ç±»çš„åŸå‹ä¸º oï¼Œäºæ˜¯ f çš„å®ä¾‹éƒ½å°†ç»§æ‰¿ o ä¸Šçš„æ–¹æ³•ã€‚
  F.prototype = o;
  return new F();
}

function GithubUser(username, password) {
  let _password = password;
  this.username = username;
  GithubUser.prototype.login = function () {
    console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + _password);
  };
}

function User(username, password, articles) {
  this.articles = articles;
}

User.prototype = createObject(GithubUser);

var user = new User('Frankie', 'abc', 5);
console.log(user.username);   // undefined
console.log(user.articles);   // 5
user.login();                 // Uncaught TypeError: user.login is not a function
</code></pre>
<p>ç†Ÿæ‚‰ <code>ES5</code> çš„åŒå­¦ï¼Œä¼šæ³¨æ„åˆ°ï¼Œè¿™ä¸å°±æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create</a> å—ï¼Ÿæ²¡é”™ï¼Œä½ å¯ä»¥è®¤ä¸ºæ˜¯å¦‚æ­¤ã€‚</p>
<p>æ—¢ç„¶åªæ˜¯ <code>ç±»å¼ç»§æ‰¿</code> çš„ä¸€ç§å°è£…ï¼Œå…¶ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">User.prototype = createObject(GithubUser);
</code></pre>
<p>ä¹Ÿä»æ—§æ²¡æœ‰è§£å†³ <code>ç±»å¼ç»§æ‰¿</code> çš„ä¸€äº›é—®é¢˜ã€‚</p>
<blockquote>
<p>ä¸ªäººè§‰å¾—ï¼Œ<code>åŸå‹ç»§æ‰¿</code> å’Œ <code>ç±»å¼ç»§æ‰¿</code> åº”è¯¥å½’ä¸ºä¸€ç§ç»§æ‰¿ï¼Œä½†æ— å¥ˆä¼—å¤š JavaScript ä¹¦ç±å‡æ˜¯å¦‚æ­¤å‘½åï¼Œç®—æ˜¯ <code>follow legacy</code> çš„æ ‡å‡†å§ã€‚</p>
</blockquote>
<h3>å¯„ç”Ÿç»§æ‰¿</h3>
<p><code>å¯„ç”Ÿç»§æ‰¿</code> æ˜¯ä¾æ‰˜äºä¸€ä¸ªå¯¹è±¡è€Œç”Ÿçš„ä¸€ç§ç»§æ‰¿æ–¹å¼ï¼Œå› æ­¤ç§°ä¹‹ä¸º <code>å¯„ç”Ÿ</code>ã€‚</p>
<pre><code class="language-js">// å¯„ç”Ÿç»§æ‰¿

var userSample = {
  username: 'Frankie',
  password: 'abc',
  articles: 5
}

function User(obj) {
  var o = Object.create(obj);
  o.readArticle = function () {
    console.log('Read article');
  }
  return o;
}

var user = new User(userSample);
console.log(user.username);   // Frankie
user.readArticle();           // Read article
</code></pre>
<p>ç”±äºå®é™…æƒ…å†µï¼Œç»§æ‰¿ä¸€ä¸ªå•ä¾‹å¯¹è±¡çš„åœºæ™¯å®åœ¨æ˜¯å¤ªå°‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ‰¾åˆ°æœ€ä½³çš„ç»§æ‰¿æ–¹æ³•ã€‚</p>
<h3>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h3>
<p>çœ‹èµ·æ¥å¾ˆç„ä¹ï¼Œå…ˆçœ‹ä»£ç ï¼š</p>
<pre><code class="language-js">// å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

// æ ¸å¿ƒæ–¹æ³•
function inherit(child, parent) {
  // ç»§æ‰¿çˆ¶ç±»çš„åŸå‹
  var p = Object.create(parent.prototype);
  // é‡å†™å­ç±»çš„åŸå‹
  child.prototype = p;
  // é‡å†™è¢«æ±¡æŸ“çš„å­ç±»çš„ constructor
  p.constructor = child;
}

// çˆ¶ç±»
function GithubUser(username, password) {
  this.password = password;
  this.username = username;
}

GithubUser.prototype.login = function () {
  console.log(this.username + ' è¦ç™»å½• GitHubï¼Œå¯†ç æ˜¯ï¼š' + this.password);
}

// å­ç±»
function User(username, password, articles) {
  this.articles = articles;
  GithubUser.call(this, username, password);
}

// å®ç°åŸå‹ä¸Šçš„æ–¹æ³•
inherit(User, GithubUser);

// åœ¨åŸå‹ä¸Šæ·»åŠ æ–°çš„æ–¹æ³•
User.prototype.readArticle = function () {
  console.log('Read article');
}

var user = new User('Frankie', 'abc', 5);
console.log(user);
</code></pre>
<p>çœ‹ä¸‹æ‰“å°ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7c5eebd2929bd1d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç®€å•è¯´æ˜ä¸€ä¸‹ï¼š</p>
<ol>
<li>å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼ŒåŒæ—¶å±æ€§æ²¡æœ‰è¢«åˆ›å»ºåœ¨åŸå‹é“¾ä¸Šï¼Œå› æ­¤å¤šä¸ªå­ç±»ä¸ä¼šå…±äº«åŒä¸€ä¸ªå±æ€§ã€‚</li>
<li>å­ç±»å¯ä»¥ä¼ é€’åŠ¨æ€å‚æ•°ç»™çˆ¶ç±»ã€‚</li>
<li>çˆ¶ç±»çš„æ„é€ å‡½æ•°åªæ‰§è¡Œäº†ä¸€æ¬¡ã€‚</li>
</ol>
<p>Niceï¼è¿™æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»§æ‰¿æ–¹æ³•ã€‚ç„¶è€Œï¼Œ<strong>ä»ç„¶å­˜åœ¨ä¸€ä¸ªç¾ä¸­ä¸è¶³çš„é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å­ç±»æƒ³è¦åœ¨åŸå‹ä¸Šæ·»åŠ æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç»§æ‰¿ä¹‹åæ·»åŠ ï¼Œå¦åˆ™å°†ä¼šè¦†ç›–æ‰åŸæœ‰åŸå‹ä¸Šçš„æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œè‹¥æ˜¯å·²ç»å­˜åœ¨çš„ä¸¤ä¸ªç±»ï¼Œå°±ä¸å¥½åŠäº†ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¼˜åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">// ä¼˜åŒ–ç‰ˆï¼š
function inherit(child, parent) {
  // ç»§æ‰¿çˆ¶ç±»çš„åŸå‹
  var p = Object.create(parent.prototype);
  // é‡å†™å­ç±»çš„åŸå‹
  child.prototype = Object.assign(parent.prototype, child.prototype);
  // é‡å†™è¢«æ±¡æŸ“çš„å­ç±»çš„ constructor
  p.constructor = child;
}
</code></pre>
<p>ä½†å®é™…ä¸Šï¼Œä½¿ç”¨ <code>Object.assign</code> æ¥è¿›è¡Œ <code>copy</code> ä»ç„¶ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œæ ¹æ® <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">MDN</a> æè¿°ï¼š</p>
<ul>
<li>The <code>Object.assign()</code> method is used to copy the values of all enumerable own properties from one or more source objects to a target object. It will return the target object.</li>
</ul>
<p>å…¶ä¸­æœ‰ä¸ªå¾ˆå…³é”®çš„è¯ï¼š<code>enumerable</code>ï¼Œè¿™å·²ç»ä¸æ˜¯æœ¬èŠ‚è®¨è®ºçš„çŸ¥è¯†äº†ï¼Œä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥å‚è€ƒ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">MDN - Object.defineProperty</a> è¡¥ä¹ ã€‚ç®€å•æ¥è¯´ï¼Œä¸Šè¿°çš„ç»§æ‰¿æ–¹æ³•åªé€‚ç”¨äº <code>copy</code> åŸå‹é“¾ä¸Šå¯æšä¸¾çš„æ–¹æ³•ï¼Œæ­¤å¤–ï¼Œå¦‚æœå­ç±»æœ¬èº«å·²ç»ç»§æ‰¿è‡ªæŸä¸ªç±»ï¼Œä»¥ä¸Šçš„ç»§æ‰¿å°†ä¸èƒ½æ»¡è¶³è¦æ±‚ã€‚</p>
<h2>ç»ˆæç‰ˆç»§æ‰¿</h2>
<p>ä¸ºäº†è®©ä»£ç æ›´æ¸…æ™°ï¼Œæˆ‘ç”¨ <code>ES6</code> çš„ä¸€äº› APIï¼Œå†™å‡ºæ¥è¿™ä¸ªæˆ‘è®¤ä¸ºæœ€åˆç†çš„ç»§æ‰¿æ–¹æ³•ï¼š</p>
<ul>
<li>ç”¨ <code>Reflect</code> ä»£æ›¿äº† <code>Object</code>ï¼›</li>
<li>ç”¨ <code>Reflect.getPrototypeOf</code> æ¥ä»£æ›¿ <code>obj.__proto__</code>ï¼›</li>
<li>ç”¨ <code>Reflect.ownKeys</code> æ¥è¯»å–æ‰€æœ‰ <code>å¯æšä¸¾/ä¸å¯æšä¸¾/Symbol</code> çš„å±æ€§ï¼›</li>
<li>ç”¨ <code>Reflect.getOwnPropertyDescriptor</code> è¯»å–å±æ€§æè¿°ç¬¦ï¼›</li>
<li>ç”¨ <code>Reflect.setPropertyOf</code> æ¥è®¾ç½® <code>__proto__</code>ã€‚</li>
</ul>
<p>æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

// ä¸åŒäº object.assign, è¯¥ merge æ–¹æ³•ä¼šå¤åˆ¶æ‰€æœ‰çš„æºé”®
// ä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾
function fancyShadowMerge(target, source) {
  for (const key of Reflect.ownKeys(source)) {
    Reflect.defineProperty(target, key, Reflect.getOwnPropertyDescriptor(source, key));
  }
  return target;
}

// Core
function inherit(child, parent) {
  const objectPrototype = Object.prototype;

  // ç»§æ‰¿çˆ¶ç±»çš„åŸå‹
  const parentPrototype = Object.create(parent.prototype);
  let childPrototype = child.prototype;

  // è‹¥å­ç±»æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ï¼Œç›´æ¥åˆå¹¶å­ç±»åŸå‹å’Œçˆ¶ç±»åŸå‹ä¸Šçš„æ‰€æœ‰æ–¹æ³•
  // åŒ…å«å¯æšä¸¾/ä¸å¯æšä¸¾çš„æ–¹æ³•
  if (Reflect.getPrototypeOf(childPrototype) === objectPrototype) {
    child.prototype = fancyShadowMerge(parentPrototype, childPrototype);
  } else {
    // è‹¥å­ç±»å·²ç»ç»§æ‰¿äº†æŸä¸ªç±»
    // çˆ¶ç±»çš„åŸå‹å°†å­ç±»çš„åŸå‹é“¾çš„å°½å¤´è¡¥å…¨
    while (Reflect.getPrototypeOf(childPrototype) !== objectPrototype) {
      childPrototype = Reflect.getPrototypeOf(childPrototype);
    }
    Reflect.setPrototypeOf(childPrototype, parent.prototype);
  }

  // é‡å†™è¢«æ±¡æŸ“çš„å­ç±»çš„ constructor
  parentPrototype.constructor = child;
}
</code></pre>
<p>æµ‹è¯•ï¼š</p>
<pre><code class="language-js">function GithubUser(username, password) {
  this.username = username;
  this.password = password;
}

GithubUser.prototype.login = function () {
  console.log(this.username + &quot; è¦ç™»å½• Githubï¼Œå¯†ç æ˜¯ï¼š&quot; + this.password);
}

function User(username, password, articles) {
  GithubUser.call(this, username, password);
  WeiboUser.call(this, username, password);
  this.articles = articles;
}

User.prototype.readArticle = function () {
  console.log('Read article');
}

function WeiboUser(username, password) {
  this.key = username + '&amp;' + password;
}

WeiboUser.prototype.compose = function () {
  console.log('compose');
}

// å…ˆè®© User ç»§æ‰¿ GitHubUser
inherit(User, GithubUser);

// å†è®© User ç»§æ‰¿ GitHubUser
inherit(User, WeiboUser);

const user = new User('Frankie', 'abc', 5);

console.log(user);
</code></pre>
<p>æ‰“å°ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1b4dcd449062f4da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœ€åç”¨ä¸€ä¸ªé—®é¢˜æ¥æ£€éªŒä½ å¯¹æœ¬æ–‡çš„ç†è§£ï¼š</p>
<ul>
<li>æ”¹å†™ä¸Šè¿°ç»§æ‰¿æ–¹æ³•ï¼Œè®©å…¶æ”¯æŒ <code>inherit(A, B, C, ...)</code> ï¼Œå®ç° <code>A</code> ä¾æ¬¡ç»§æ‰¿åé¢æ‰€æœ‰çš„ç±»ï¼Œä½†é™¤äº† <code>A</code> ä»¥å¤–çš„ç±»ä¸äº§ç”Ÿç»§æ‰¿å…³ç³»ã€‚</li>
</ul>
<h2>æ€»ç»“</h2>
<ol>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>function</code> æ¥æ¨¡æ‹Ÿç±»ï¼›</li>
<li>JavaScript ç±»çš„ç»§æ‰¿æ˜¯åŸºäºåŸå‹çš„ï¼Œä¸€ä¸ªå®Œå–„çš„ç»§æ‰¿æ–¹æ³•ï¼Œå…¶ç»§æ‰¿è¿‡ç¨‹æ˜¯ç›¸å½“å¤æ‚çš„ï¼›</li>
<li>è™½ç„¶å»ºè®®å®é™…ç”Ÿäº§ä¸­ç›´æ¥ä½¿ç”¨ <code>ES6</code> çš„ç»§æ‰¿ï¼Œä½†ä»ç„¶å»ºè®®æ·±å…¥äº†è§£å†…éƒ¨ç»§æ‰¿æœºåˆ¶ã€‚</li>
</ol>
<h2>é¢˜å¤–è¯</h2>
<p>æœ€åæ”¾ä¸€ä¸ªå½©è›‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¼šåœ¨å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ä¸­å°¤å…¶å¼ºè°ƒ <code>enumerable</code> è¿™ä¸ªå±æ€§æè¿°ç¬¦å‘¢ï¼Ÿå› ä¸ºï¼š</p>
<ul>
<li><code>ES6</code> çš„ <code>class</code> ä¸­ï¼Œé»˜è®¤æ‰€æœ‰ç±»çš„æ–¹æ³•æ˜¯ä¸å¯æšä¸¾çš„ï¼</li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | åŸå‹è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/212</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/212</guid>
            <pubDate>Sun, 26 Feb 2023 10:15:04 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>åŸæ–‡å‡ºè‡ª <a href="https://juejin.cn/post/6844903567325659144">ULIVZ</a>ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œå…³äºåŸå‹çš„è®¤çŸ¥éƒ½æ˜¯é›¶é›¶æ•£æ•£ï¼Œæ²¡æœ‰ç³»ç»Ÿæ•´ç†è¿‡ã€‚</p>
</blockqu]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>åŸæ–‡å‡ºè‡ª <a href="https://juejin.cn/post/6844903567325659144">ULIVZ</a>ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œå…³äºåŸå‹çš„è®¤çŸ¥éƒ½æ˜¯é›¶é›¶æ•£æ•£ï¼Œæ²¡æœ‰ç³»ç»Ÿæ•´ç†è¿‡ã€‚</p>
</blockquote>
<h2>å¼•å…¥ï¼šæ™®é€šå¯¹è±¡ä¸å‡½æ•°å¯¹è±¡</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ç§è¯´æ³•ï¼Œä¸‡ç‰©çš†å¯¹è±¡ã€‚</p>
<p>äº‹å®ä¸Šï¼Œåœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ’åˆ†ä¸ºã€Œæ™®é€šå¯¹è±¡ã€å’Œã€Œå‡½æ•°å¯¹è±¡ã€ã€‚</p>
<p><code>Object</code> å’Œ <code>Function</code> ä¾¿æ˜¯ JavaScript è‡ªå¸¦çš„ä¸¤ä¸ªå…¸å‹çš„ã€Œå‡½æ•°å¯¹è±¡ã€ã€‚è€Œå‡½æ•°å¯¹è±¡å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ‰€è°“çš„å‡½æ•°å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨ JavaScript åœ¨æ¨¡æ‹Ÿç±»ã€‚</p>
<p><strong>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯æ™®é€šå¯¹è±¡ï¼Œä»€ä¹ˆåˆæ˜¯å‡½æ•°å¯¹è±¡å‘¢ï¼Ÿ</strong></p>
<p>å…ˆåˆ›å»ºä¸‰ä¸ª <code>Function</code> å’Œ <code>Object</code> çš„å®ä¾‹ã€‚</p>
<pre><code class="language-js">function fn1() {};
var fn2 = function() {};
var fn3 = new Function('getName', 'console.log(&quot;Frankie&quot;)');

var obj1 = {};
var obj2 = new Object();
var obj3 = new fn1();
</code></pre>
<p>æ‰“å°ä»¥ä¸‹ç»“æœï¼Œå¯ä»¥å¾—åˆ°ï¼š</p>
<pre><code class="language-js">console.log(typeof Object);     // function
console.log(typeof Function);   // function
console.log(typeof obj1);       // object
console.log(typeof obj2);       // object
console.log(typeof obj3);       // object
console.log(typeof fn1);        // function
console.log(typeof fn2);        // function
console.log(typeof fn3);        // function
</code></pre>
<p>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œ<code>obj1</code>ã€<code>obj2</code>ã€<code>obj3</code> ä¸º <code>æ™®é€šå¯¹è±¡</code>ï¼ˆå‡ä¸º Object çš„å®ä¾‹ï¼‰ï¼Œè€Œ <code>fn1</code>ã€<code>fn2</code>ã€<code>fn3</code> ä¸º <code>å‡½æ•°å¯¹è±¡</code>ï¼ˆå‡æ˜¯ <code>Function</code> çš„å®ä¾‹ï¼‰ã€‚</p>
<p>å¦‚ä½•åŒºåˆ†å‘¢ï¼Ÿè®°ä½è¿™å¥è¯å°±è¡Œäº†ï¼š</p>
<p><strong>æ‰€æœ‰ Function çš„å®ä¾‹éƒ½æ˜¯å‡½æ•°å¯¹è±¡ï¼Œè€Œå…¶ä»–çš„éƒ½æ˜¯æ™®é€šå¯¹è±¡ã€‚</strong></p>
<p>è¯´åˆ°è¿™é‡Œï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘è¡¨ä¸€ä¸ªç–‘é—®ã€‚æ–‡ä¸­å¼€å¤´ï¼Œæˆ‘ä»¬æåˆ° <code>Object</code> å’Œ <code>Function</code> å‡æ˜¯ <code>å‡½æ•°å¯¹è±¡</code>ï¼Œè€Œè¿™é‡Œåˆè¯´ï¼šæ‰€æœ‰çš„ <code>Function</code> çš„å®ä¾‹éƒ½æ˜¯ <code>å‡½æ•°å¯¹è±¡</code>ï¼Œéš¾é“ <code>Function</code> ä¹Ÿæ˜¯ <code>Function</code> çš„å®ä¾‹å—ï¼Ÿï¼ˆå…ˆç•™ä¸‹ç–‘é—®ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1b9204ae33eb51b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹è±¡æœ¬èº«çš„å®ç°è¿˜æ˜¯è¦ä¾é <strong>æ„é€ å‡½æ•°</strong>ï¼Œé‚£ <code>åŸå‹é“¾</code> åˆ°åº•æ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿ</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œä½œä¸ºä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå¿…å®šå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>å¯¹è±¡å”¯ä¸€æ€§</li>
<li>æŠ½è±¡æ€§</li>
<li>ç»§æ‰¿æ€§</li>
<li>å¤šæ€æ€§</li>
</ul>
<p><strong>åŸå‹é“¾æœ€å¤§çš„ç›®çš„å°±æ˜¯ä¸ºäº†å®ç°ç»§æ‰¿ã€‚</strong></p>
<h2>è¿›é˜¶ï¼šprototype ä¸ __proto__</h2>
<p>åŸå‹é“¾ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°ç»§æ‰¿çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¼•å…¥ä»‹ç»ä¸¤å…„å¼Ÿï¼š<code>prototype</code> å’Œ <code>__proto__</code>ï¼Œè¿™æ˜¯åœ¨ JavaScript ä¸­æ— å¤„ä¸åœ¨çš„ä¸¤ä¸ªå˜é‡ï¼Œç„¶è€Œï¼Œè¿™ä¸¤ä¸ªå˜é‡å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„å¯¹è±¡ä¸Šéƒ½å­˜åœ¨ã€‚</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡ç±»å‹</th>
<th>prototype</th>
<th>__proto__</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šå¯¹è±¡(NO)</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>å‡½æ•°å¯¹è±¡(FO)</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆç»™å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
<ul>
<li><strong>åªæœ‰å‡½æ•°å¯¹è±¡æ‰å…·æœ‰ <code>prototype</code> å±æ€§ã€‚</strong></li>
<li><strong><code>prototype</code> å’Œ <code>__proto__</code> éƒ½æ˜¯ JavaScript åœ¨å®šä¹‰ä¸€ä¸ªå‡½æ•°æˆ–å¯¹è±¡æ—¶è‡ªåŠ¨åˆ›å»ºçš„é¢„å®šä¹‰å±æ€§ã€‚</strong></li>
</ul>
<pre><code class="language-js">function fn() {};
console.log(typeof fn.__proto__);   // function
console.log(typeof fn.prototype);   // object

const obj = {};
console.log(typeof obj.__proto__);  // function
console.log(typeof obj.prototype);  // undefinedï¼Œæ™®é€šå¯¹è±¡æ²¡æœ‰ prototype
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢ä»£ç æˆç«‹ï¼š</p>
<pre><code class="language-js">console.log(fn.__proto__ === Function.prototype);   // true
console.log(obj.__proto__ === Object.prototype);    // true
</code></pre>
<p>çœ‹èµ·æ¥å¾ˆé…·ï¼Œç»“è®ºç¬é—´è¢«è¯æ˜ï¼Œæ„Ÿè§‰æ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ—¢ç„¶ <code>fn</code> æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>fn.prototype.__proto__</code> åˆ°åº•ç­‰äºä»€ä¹ˆï¼Ÿ</p>
<p>è¿™æ˜¯æˆ‘å°è¯•å»è§£å†³è¿™ä¸ªé—®é¢˜çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>é¦–å…ˆç”¨ <code>typeof</code> å¾—åˆ° <code>fn.prototype</code> çš„ç±»å‹ <code>&quot;object&quot;</code>ï¼›</li>
<li>æ—¢ç„¶æ˜¯ <code>&quot;object&quot;</code>ï¼Œé‚£ <code>fn.prototype</code> å²‚ä¸æ˜¯ <code>Object</code> çš„å®ä¾‹ï¼Ÿæˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š</li>
</ol>
<pre><code class="language-js">console.log(fn.prototype.__proto__ === Object.prototype);  // true
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œå¦‚æœè¦ä½ å¿«é€Ÿåœ°å†™å‡ºï¼Œåœ¨åˆ›å»ºä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒJavaScript å¯¹è¯¥å‡½æ•°åŸå‹çš„åˆå§‹åŒ–ä»£ç ï¼Œä½ æ˜¯ä¸æ˜¯ä¹Ÿèƒ½å¿«é€Ÿåœ°å†™å‡ºï¼š</p>
<pre><code class="language-js">// å®é™…ä»£ç 
function fn() {};

// JavaScript è‡ªåŠ¨æ‰§è¡Œ
fn.prototype = {
  constructor: fn;
  __proto__: Object.prototype
}

fn.__proto__ = Function.prototype;
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œä½ æ˜¯å¦æœ‰ä¸€ä¸æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰ï¼Ÿ</p>
<p>æ­¤å¤–ï¼Œå› ä¸ºæ™®é€šå¯¹è±¡å°±æ˜¯é€šè¿‡å‡½æ•°å¯¹è±¡å®ä¾‹åŒ–ï¼ˆ<code>new</code>ï¼‰å¾—åˆ°çš„ï¼Œè€Œä¸€ä¸ªå®ä¾‹ä¸å¯èƒ½å†æ¬¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œä¹Ÿå°±ä¸ä¼šè®©å¦ä¸€ä¸ªå¯¹è±¡çš„ <code>__proto__</code> æŒ‡å‘å®ƒçš„ <code>prototype</code>ï¼Œéšè—æœ¬èŠ‚ä¸€å¼€å§‹æåˆ°çš„ã€Œæ™®é€šå¯¹è±¡æ²¡æœ‰ <code>prototype</code> å±æ€§ã€çš„ç»“è®ºä¼¼ä¹éå¸¸å¥½ç†è§£äº†ã€‚ä»ä¸Šè¿°çš„åˆ†æï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹å‡ºï¼Œ<code>fn.prototype</code> å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå®ƒä¹Ÿä¸å­˜åœ¨ <code>prototype</code> å±æ€§ã€‚</p>
<p>å†å›é¡¾ä¸‹ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬è¿˜é—ç•™äº†ä¸€ä¸ªç–‘é—®ï¼š<strong>éš¾é“ <code>Function</code> ä¹Ÿæ˜¯ <code>Function</code> çš„å®ä¾‹ï¼Ÿ</strong></p>
<p>æ˜¯æ—¶å€™å»æ‰ã€Œåº”è¯¥ã€è®©å®ƒæˆç«‹äº†ï¼š</p>
<pre><code class="language-js">console.log(Function.__proto__ === Function.prototype);    // true
</code></pre>
<h2>é‡ç‚¹ï¼šåŸå‹é“¾</h2>
<p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬è¯¦è§£äº† <code>prototype</code> å’Œ <code>__proto__</code>ã€‚å®é™…ä¸Šï¼Œè¿™ä¸¤å…„å¼Ÿä¸»è¦å°±æ˜¯ä¸ºäº†<strong>æ„é€ åŸå‹é“¾</strong>è€Œå­˜åœ¨çš„ã€‚</p>
<p>å…ˆä¸Šä¸€æ®µä»£ç ï¼š</p>
<pre><code class="language-js">function Person(name, age) {
  this.name = name;
  this.age = age;
}   // 1ï¸âƒ£

Person.prototype.getName = function() {
  return this.name;
};  // 2ï¸âƒ£

Person.prototype.getAge = function() {
  return this.age;
};  // 3ï¸âƒ£

var person = new Person(&quot;Frankie&quot;, 20); // 4ï¸âƒ£

console.log(person);  // 5ï¸âƒ£
console.log(person.getName());  // 6ï¸âƒ£

// é‡‡ç”¨ ES6 æ›´ä¼˜é›…çš„å†™æ³•ï¼Ÿå“ˆå“ˆ
// Object.assign(Person.prototype, {
// 	getName() {
// 	  return this.name;
// 	},
// 	getAge() {
// 	  return this.age;
// 	},
// })
</code></pre>
<p>è§£æä¸€ä¸‹æ‰§è¡Œç»†èŠ‚ï¼š</p>
<ol>
<li>æ‰§è¡Œ 1ï¸âƒ£ï¼Œåˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•° <code>Person</code>ï¼Œè¦æ³¨æ„å‰é¢å·²ç»æåˆ°ï¼Œæ­¤æ—¶ <code>Person.prototype</code> å·²ç»è¢«è‡ªåŠ¨åˆ›å»ºï¼Œå®ƒåŒ…å« <code>constructor</code> å’Œ <code>__proto__</code> è¿™ä¸¤ä¸ªå±æ€§ï¼›</li>
<li>æ‰§è¡Œ 2ï¸âƒ£ï¼Œç»™å¯¹è±¡ <code>Person.prototype</code> å¢åŠ ä¸€ä¸ªæ–¹æ³• <code>getName()</code>ï¼›</li>
<li>æ‰§è¡Œ 3ï¸âƒ£ï¼Œç»™å¯¹è±¡ <code>Person.prototype</code> å¢åŠ ä¸€ä¸ªæ–¹æ³• <code>getAge()</code>ï¼›</li>
<li>æ‰§è¡Œ 4ï¸âƒ£ï¼Œå³æ„é€ å‡½æ•° <code>Person</code> åˆ›å»ºä¸€ä¸ª <code>person</code> å®ä¾‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°åœ¨å®ä¾‹åŒ–æ—¶ï¼Œä¸€å®šä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ„é€ å‡½æ•°ã€‚</li>
<li>åœ¨æµè§ˆå™¨å¾—åˆ° 5ï¸âƒ£ çš„è¾“å‡ºï¼Œå³ <code>person</code> åº”è¯¥æ˜¯ï¼š</li>
</ol>
<pre><code class="language-js">{
  name: 'Frankie',
  age: 20,
  __proto__: Object    // å®é™…ä¸Šå°±æ˜¯ Person.prototype
}
</code></pre>
<p>ç»“åˆä¸Šä¸€èŠ‚çš„ç»éªŒï¼Œä»¥ä¸‹ç­‰å¼æˆç«‹ï¼š</p>
<pre><code class="language-js">console.log(person.__proto__ === Person.prototype);  // true
</code></pre>
<ol start="6">
<li>æ‰§è¡Œ 6ï¸âƒ£ çš„æ—¶å€™ï¼Œç”±äºåœ¨ <code>person</code> ä¸­æ‰¾ä¸åˆ° <code>getName()</code> å’Œ <code>getAge()</code> è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±ä¼šç»§ç»­æœç€åŸå‹é“¾ä¸ŠæŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ <code>__proto__</code> å‘ä¸ŠæŸ¥æ‰¾ï¼Œäºæ˜¯å¾ˆå¿«åœ¨ <code>person.__proto__</code> ä¸­ï¼Œå³ <code>Person.prototype</code> ä¸­æ‰¾åˆ°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œäºæ˜¯åœæ­¢æŸ¥æ‰¾å¹¶æ‰§è¡Œå¾—åˆ°ç»“æœã€‚</li>
</ol>
<p>è¿™ä¾¿æ˜¯ JavaScript çš„åŸå‹ç»§æ‰¿ã€‚å‡†ç¡®çš„è¯´ï¼ŒJavaScript çš„åŸå‹ç»§æ‰¿æ˜¯é€šè¿‡ <code>__proto__</code> å¹¶å€ŸåŠ© <code>prototype</code> æ¥å®ç°çš„ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½œä»¥ä¸‹æ€»ç»“ï¼š</p>
<ul>
<li>å‡½æ•°å¯¹è±¡çš„ <code>__proto__</code> æŒ‡å‘ <code>Function.prototype</code>ï¼›</li>
<li>å‡½æ•°å¯¹è±¡çš„ <code>prototype</code> æŒ‡å‘ <code>instance.__proto__</code>ï¼›</li>
<li>æ™®é€šå¯¹è±¡çš„ <code>__proto__</code> æŒ‡å‘ <code>Object.prototype</code>ï¼›</li>
<li>æ™®é€šå¯¹è±¡æ²¡æœ‰ <code>prototype</code> å±æ€§ï¼›</li>
<li>åœ¨è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§å¾ˆæ–¹æ³•æ—¶ï¼Œè‹¥åœ¨å½“å‰å¯¹è±¡ä¸Šæ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šå°è¯•è®¿é—® <code>obj.__proto__</code>ï¼Œä¹Ÿå°±æ˜¯è®¿é—®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹ <code>objCtr.prototype</code>ï¼Œè‹¥ä»ç„¶æ‰¾ä¸åˆ°ï¼Œä¼šç»§ç»­æŸ¥æ‰¾ <code>objCtr.prototype.__proto__</code>ï¼Œåƒä¾æ¬¡åœ°æŸ¥æ‰¾ä¸‹å»ã€‚è‹¥åœ¨æŸä¸€åˆ»ï¼Œæ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™ä¼šç«‹åˆ»è¿”å›å€¼å¹¶åœæ­¢å¯¹åŸå‹é“¾çš„æœç´¢ï¼Œè‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™è¿”å› <code>undefined</code>ã€‚</li>
</ul>
<p>ä¸ºäº†æ£€éªŒä½ å¯¹ä¸Šè¿°çš„ç†è§£ï¼Œè¯·åˆ†æä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>ä»¥ä¸‹ä»£ç è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</strong></li>
</ol>
<pre><code class="language-js">console.log(person.__proto__ === Function.prototype);    // false
</code></pre>
<ol start="2">
<li><strong><code>Person.__proto__</code> å’Œ <code>Person.prototype.__proto__</code> åˆ†åˆ«æŒ‡å‘ä½•å¤„ï¼Ÿ</strong></li>
</ol>
<pre><code class="language-js">console.log(Person.__proto__ === Function.prototype);            // true
console.log(Person.prototype.__proto__ === Object.prototype);    // true

// åˆ†æï¼š
// 1. å‰é¢å·²ç»æåˆ°è¿‡ï¼Œåœ¨ JavaScript ä¸­ä¸‡ç‰©çš†å¯¹è±¡ã€‚Person å¾ˆæ˜æ˜¾æ˜¯ Function çš„å®ä¾‹ï¼Œ
// å› æ­¤ï¼ŒPerson.__proto__ æŒ‡å‘ Function.prototypeã€‚

// 2. å› ä¸º Person.prototype æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå› æ­¤Person.prototype.__proto__ æŒ‡å‘ Object.prototypeã€‚

// 3. ä¸ºäº†éªŒè¯ Person.__proto__ æ‰€åœ¨çš„åŸå‹é“¾ä¸­æ²¡æœ‰ Objectï¼Œ
// ä»¥åŠ Person.prototype.__proto__ æ‰€åœ¨çš„åŸå‹é“¾ä¸­æ²¡æœ‰ Function, ç»“åˆä»¥ä¸‹è¯­å¥éªŒè¯ï¼š
console.log(Person.__proto__ === Object.prototype);             // false
console.log(Person.prototype.__proto__ == Function.prototype);  // false
</code></pre>
<h2>ç»ˆæï¼šåŸå‹é“¾å›¾</h2>
<p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å®é™…ä¸Šè¿˜é—ç•™äº†ä¸€ä¸ªç–‘é—®ï¼š<strong>åŸå‹é“¾å¦‚æœä¸€ä¸ªæœç´¢ä¸‹å»ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œé‚£ä½•æ—¶åœæ­¢å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå‹é“¾çš„å°½å¤´æ˜¯å“ªé‡Œï¼Ÿ</strong></p>
<p>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°åˆ©ç”¨ä¸‹é¢çš„ä»£ç éªŒè¯ï¼š</p>
<pre><code class="language-js">function Person() {};
var person = new Person();
console.log(person.name);  // undefined
</code></pre>
<p>å¾ˆæ˜¾ç„¶ï¼Œä¸Šè¿°è¾“å‡º <code>undefined</code>ã€‚ä¸‹é¢ç®€è¿°æŸ¥æ‰¾è¿‡ç¨‹ï¼š</p>
<pre><code class="language-js">person                // æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person['name']           // ä¸å­˜åœ¨ï¼Œç»§ç»­æŸ¥æ‰¾ 
person.__proto__            // æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person.__proto__['name']        // ä¸å­˜åœ¨ï¼Œç»§ç»­æŸ¥æ‰¾
person.__proto__.__proto__          // æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­
person.__proto__.__proto__['name']     // ä¸å­˜åœ¨, ç»§ç»­æŸ¥æ‰¾
person.__proto__.__proto__.__proto__       // null !!!! åœæ­¢æŸ¥æ‰¾ï¼Œè¿”å› undefined
</code></pre>
<p>åŸæ¥è·¯çš„å°½å¤´æ˜¯ä¸€åœºç©ºã€‚</p>
<p>æœ€åï¼Œå†å›è¿‡å¤´æ¥çœ‹çœ‹ä¸Šä¸€èŠ‚çš„é‚£æ¼”ç¤ºä»£ç ï¼š</p>
<pre><code class="language-js">function Person(name, age) {
  this.name = name;
  this.age = age;
}   // 1ï¸âƒ£

Person.prototype.getName = function() {
  return this.name;
};  // 2ï¸âƒ£

Person.prototype.getAge = function() {
  return this.age;
};  // 3ï¸âƒ£

var person = new Person(&quot;Frankie&quot;, 20); // 4ï¸âƒ£

console.log(person);  // 5ï¸âƒ£
console.log(person.getName(), person.getAge());  // 6ï¸âƒ£
</code></pre>
<p>æˆ‘ä»¬æ¥ç”»ä¸€ä¸ªåŸå‹é“¾å›¾ï¼Œæˆ–è€…è¯´ï¼Œå°†å…¶æ•´ä¸ªåŸå‹é“¾å›¾ç”»å‡ºæ¥ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-316803a64cac5224.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç”»å®Œè¿™å¼ å›¾ï¼ŒåŸºæœ¬ä¸Šä¹‹å‰æ‰€æœ‰çš„ç–‘é—®éƒ½å¯ä»¥è§£ç­”äº†ã€‚</p>
<p>ä¸å…¶è¯´ä¸‡ç‰©çš†å¯¹è±¡ï¼Œä¸‡ç‰©çš†ç©ºä¼¼ä¹æ›´åŠ å½¢è±¡ã€‚</p>
<h2>è°ƒæ–™ï¼šconstructor</h2>
<p>å‰é¢å·²ç»æœ‰æ‰€æåŠï¼Œä½†åªæœ‰åŸå‹å¯¹è±¡æ‰å…·æœ‰ <code>constructor</code> è¿™ä¸ªå±æ€§ï¼Œ<code>constructor</code> ç”¨æ¥æŒ‡å‘å¼•ç”¨å®ƒçš„å‡½æ•°å¯¹è±¡ã€‚</p>
<pre><code class="language-js">console.log(Person.prototype.constructor === Person);    // true
console.log(Person.prototype.constructor.prototype.constructor === Person);    // true
</code></pre>
<p>è¿™æ˜¯ä¸€ç§å¾ªç¯å¼•ç”¨ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ä¸Šä¸€èŠ‚çš„åŸå‹é“¾å›¾ä¸­ç”»ä¸Šå»ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<h2>è¡¥å…… JavaScriptä¸­çš„ å…­å¤§å†…ç½®ï¼ˆå‡½æ•°ï¼‰å¯¹è±¡çš„åŸå‹ç»§æ‰¿</h2>
<p>é€šè¿‡å‰æ–‡çš„è®ºè¿°ï¼Œç»“åˆç›¸åº”çš„ä»£ç éªŒè¯ï¼Œæ•´ç†å‡ºä»¥ä¸‹åŸå‹é“¾å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bd002e69d2ce5c10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬æ›´åŠ å¼ºåŒ–äº†è¿™ä¸¤ä¸ªå…³æ‰ï¼š</p>
<blockquote>
<ol>
<li>ä»»ä½•å†…ç½®å¯¹è±¡ï¼ˆç±»ï¼‰æœ¬èº«çš„ <code>__proto__</code> éƒ½æŒ‡å‘ <code>Function</code> çš„åŸå‹å¯¹è±¡ï¼›</li>
<li>é™¤äº† <code>Object</code> çš„åŸå‹å¯¹è±¡çš„<code> __proto__</code> æŒ‡å‘ <code>null</code>ï¼Œå…¶ä»–æ‰€æœ‰çš„å†…ç½®å‡½æ•°å¯¹è±¡çš„åŸå‹å¯¹è±¡çš„ <code>__proto__</code> éƒ½æŒ‡å‘ <code>Object</code>ã€‚</li>
</ol>
</blockquote>
<pre><code>console.log(Object.prototype.__proto__ === null);    // true
</code></pre>
<h2>æ€»ç»“</h2>
<p>æ¥å‡ ä¸ªæ€»ç»“ï¼š</p>
<ul>
<li>
<p>è‹¥ <code>A</code> é€šè¿‡ <code>new</code> åˆ›å»ºäº† <code>B</code>ï¼Œåˆ™ <code>B.__proto__ = A.prototype</code>ã€‚</p>
</li>
<li>
<p><code>__proto__</code> æ˜¯åŸå‹é“¾æŸ¥æ‰¾çš„èµ·ç‚¹ï¼›</p>
</li>
<li>
<p>æ‰§è¡Œ <code>B.a</code>ï¼Œè‹¥åœ¨ <code>B</code> ä¸­æ‰¾ä¸åˆ° <code>a</code>ï¼Œåˆ™ä¼šåœ¨ <code>B.__proto__</code> ä¸­ï¼Œä¹Ÿå°±æ˜¯ <code>A.prototype</code> ä¸­æŸ¥æ‰¾ï¼Œè‹¥ <code>A.prototype</code> ä¸­ä»ç„¶æ²¡æœ‰ï¼Œåˆ™ä¼šç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œæœ€ç»ˆï¼Œä¸€å®šä¼šæ‰¾åˆ° <code>Object.prototype</code>ï¼Œå€˜è‹¥è¿˜æ‰¾ä¸åˆ°ï¼Œå› ä¸º  <code>Object.prototype.__proto__</code> æŒ‡å‘ <code>null</code>ï¼Œå› æ­¤ä¼šè¿”å› <code>undefined</code>ï¼›</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆä¸‡ç‰©çš†ç©ºï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼ŒåŸå‹é“¾çš„é¡¶ç«¯ï¼Œä¸€å®šæœ‰ <code>Object.prototype.__proto__</code> ç­‰äº <code>null</code>ã€‚</p>
</li>
</ul>
<p>æœ€åæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼š</p>
<p><strong>å¦‚ä½•ç”¨ JavaScript å®ç°ç±»çš„ç»§æ‰¿ï¼Ÿ</strong></p>
<blockquote>
<p>è¯·æ¥ç€ä¸‹ä¸€ç¯‡ <a href="https://github.com/toFrankie/blog/issues/213">æ·±å…¥ JavaScript ç»§æ‰¿åŸç†</a>ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» JS | æ·±å…¥äº†è§£ä»é¢„ç¼–è¯‘åˆ°è§£ææ‰§è¡Œçš„è¿‡ç¨‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/211</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/211</guid>
            <pubDate>Sun, 26 Feb 2023 10:14:30 GMT</pubDate>
            <description><![CDATA[<p>å…ˆæ¥ä¸€ä¸ªæœ€ç®€å•çš„æ¡ˆä¾‹ã€‚</p>
<pre><code class="language-js">var a = 1;
</code></pre>
<p>ä»å­—é¢ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯ç®€å•çš„å°† <code>1</code> èµ‹å€¼ç»™å˜é‡ <code>a</code>ã€‚å¯åœ¨ JS å¼•æ“é‡Œé¢ï¼Œå®ƒè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š<code>var a]]></description>
            <content:encoded><![CDATA[<p>å…ˆæ¥ä¸€ä¸ªæœ€ç®€å•çš„æ¡ˆä¾‹ã€‚</p>
<pre><code class="language-js">var a = 1;
</code></pre>
<p>ä»å­—é¢ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯ç®€å•çš„å°† <code>1</code> èµ‹å€¼ç»™å˜é‡ <code>a</code>ã€‚å¯åœ¨ JS å¼•æ“é‡Œé¢ï¼Œå®ƒè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š<code>var a</code> å’Œ <code>a = 1</code>ï¼Œåˆ†åˆ«æ˜¯å£°æ˜å’Œèµ‹å€¼ï¼Œå®ƒä»¬å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒçš„é˜¶æ®µã€‚</p>
<p>å†™è¿™ç¯‡æ–‡ç« çš„åŸå› æ˜¯çœ‹åˆ°ä¸€é“é¢˜ï¼Œå‘ç°è‡ªå·±å¯¹é¢„ç¼–è¯‘çš„ç†è§£å‡ºç°äº†åå·®ã€‚åŠ ä¸Šä»¥å¾€ä¹Ÿæ²¡æ•´ç†è¿‡ï¼Œä¹…äº†ä¸æ¥è§¦å°±ä¼šæ…¢æ…¢é—å¿˜ã€å‡Œä¹±ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šæ•´ç†ä¸‹é¢„ç¼–è¯‘çš„çŸ¥è¯†ç‚¹ï¼ŒåŒæ—¶å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©å±å¹•å‰çš„ä½ ã€‚</p>
<h3>ä¸€ã€JS ä»åŠ è½½åˆ°æ‰§è¡Œå®Œç»å†äº†ä»€ä¹ˆï¼Ÿ</h3>
<ol>
<li>é¡µé¢äº§ç”Ÿä¾¿åˆ›å»ºäº†ä¸€ä¸ª GO å…¨å±€å¯¹è±¡ï¼ˆGlobal Objectï¼Œå…¨å±€ä¸Šä¸‹æ–‡ï¼‰ï¼Œå³ window å¯¹è±¡ã€‚</li>
<li>ç¬¬ä¸€ä¸ªè„šæœ¬æ–‡ä»¶åŠ è½½ã€‚ï¼ˆåŠ è½½å®Œæˆåï¼Œæ¥ç€æ˜¯ JS è¿è¡Œä¸‰éƒ¨æ›²ï¼‰
1). è¯­æ³•åˆ†æ
2). é¢„ç¼–è¯‘
3). è§£ææ‰§è¡Œ</li>
<li>ä¸‰éƒ¨æ›²ç¬¬ä¸€æ­¥ï¼šè¯­æ³•åˆ†æï¼Œæ£€æŸ¥æ˜¯å¦åˆæ³•ã€‚</li>
<li>ä¸‰éƒ¨æ›²ç¬¬äºŒæ­¥ï¼šå¼€å§‹é¢„ç¼–è¯‘ï¼š
ï¼ˆå…¶å®è¿™é‡Œè¿˜æœ‰åˆ›å»ºäº† documentã€navigatorã€screen ç­‰å±æ€§ï¼Œæ­¤å¤„å¿½ç•¥ï¼‰
1). æŸ¥æ‰¾å˜é‡å£°æ˜ï¼Œä½œä¸º GO å±æ€§ï¼Œå¹¶èµ‹äºˆ undefinedï¼›
2). æŸ¥æ‰¾å‡½æ•°å£°æ˜ï¼Œä½œä¸º GO å±æ€§ï¼Œå¹¶èµ‹äºˆå‡½æ•°ä½“æœ¬èº«ï¼ˆè‹¥å‡½æ•°ä¸å˜é‡åŒåï¼Œå‡½æ•°ä¼šè¦†ç›–å˜é‡ï¼›è‹¥å¤šä¸ªå‡½æ•°å£°æ˜æ˜¯åŒåï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼‰</li>
<li>ä¸‰éƒ¨æ›²ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹æ‰§è¡Œä»£ç ã€‚</li>
<li>æ‰§è¡Œå®Œä¸€ä¸ª script å—ï¼Œåˆ°ä¸‹ä¸€ä¸ª script å—ï¼Œä¼šé‡å¤ 2ã€3ã€4ã€5 æ­¥éª¤ã€‚</li>
</ol>
<pre><code>&lt;script&gt;
  console.log(a); // function a() {}
  console.log(b); // function b() {}
  console.log(c); // undefined
  var a = 1;
  function a() {};
  function b() {};
  var c = 3;
  console.log(a); // 1
  console.log(d); // Uncaught ReferenceError: d is not definedï¼Œä¸”ä»è¿™é‡Œå¼€å§‹ä»£ç ç»ˆæ­¢æ‰§è¡Œ
  d = 4;
  console.log(d);
  /**
  ï¼ˆæœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ï¼šä¸‹é¢çš„ GO æ˜¯ä¼ªä»£ç ï¼Œä¸ºäº†åŠ©äºç†è§£ç½¢äº†ï¼‰
  1. åˆ›å»º GO å¯¹è±¡ï¼›GO {}
  2. åŠ è½½ script å—
  3. è¯­æ³•åˆ†æ
  4. å¼€å§‹é¢„ç¼–è¯‘
    1). æ‰¾åˆ°å˜é‡å£°æ˜ a å’Œ cï¼Œæ”¾åˆ° GO {a: undefined, c: undefined}
    2). æ‰¾åˆ°å‡½æ•°å£°æ˜ a å’Œ bï¼Œå› ä¸ºå‡½æ•° a å’Œ å˜é‡ a åŒåï¼Œæ‰€ä»¥å‡½æ•°è¦†ç›–æ‰å˜é‡ï¼šGO {a: f(), b: f(), c: undefined}
  5. æ‰§è¡Œä»£ç 
    1). æ‰§è¡Œåˆ° console.log(a)ï¼Œç„¶åä» GO é‡Œé¢æ‰¾åˆ° aï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯å‡½æ•°ï¼›
    2). ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼ŒåŒç†æ‰“å° b ä¹Ÿæ˜¯å‡½æ•°ï¼›
    3). åŒç†ï¼Œc æ‰“å°ç»“æœæ˜¯ undefinedï¼›
    4). å› ä¸º a èµ‹å€¼ 1ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª console.log(a) ä¼šæ‰“å° 1ï¼›
    5). åˆ°äº† console.log(d) è¿™ä¸€æ­¥ï¼Œå› ä¸ºæš—ç¤ºå…¨å±€å˜é‡ (imply global variable)ï¼Œä¸å‚ä¸é¢„ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¼šæŠ¥å¼•ç”¨é”™è¯¯ï¼›ï¼ˆä»£ç ç»ˆæ­¢æ‰§è¡Œï¼Œä¸ä¼šç»§ç»­å¾€ä¸‹èµ°ï¼‰
  */
&lt;/script&gt;
</code></pre>
<blockquote>
<p>JavaScript ä¸æ˜¯å…¨æ–‡ç¼–è¯‘å®Œå†æ‰§è¡Œï¼Œè€Œæ˜¯å—ç¼–è¯‘ï¼Œå³ä¸€ä¸ª script å—ä¸­é¢„ç¼–è¯‘ç„¶åæ‰§è¡Œï¼Œå†æŒ‰é¡ºåºé¢„ç¼–è¯‘ä¸‹ä¸€ä¸ª script å—å†æ‰§è¡Œã€‚ä½†æ˜¯æ­¤æ—¶ä¸Šä¸€ä¸ª script å—ä¸­çš„æ•°æ®éƒ½æ˜¯å¯ç”¨çš„ï¼Œè€Œä¸‹ä¸€ä¸ª script å—ä¸­çš„å‡½æ•°å’Œå˜é‡åˆ™æ˜¯ä¸å¯ç”¨çš„ã€‚</p>
</blockquote>
<h3>äºŒã€è§£ææ‰§è¡Œé˜¶æ®µï¼Œå½“é‡åˆ°å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿ AO æ´»è·ƒå¯¹è±¡ï¼ˆActivation Objectï¼Œæ´»è·ƒä¸Šä¸‹æ–‡ï¼‰ï¼Œé‚£è¿‡ç¨‹åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</h3>
<p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œ<strong>é¢„ç¼–è¯‘ä¸ä»…ä»…å‘ç”Ÿåœ¨ script ä»£ç å—æ‰§è¡Œä¹‹å‰ï¼Œè¿˜å‘ç”Ÿåœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰</strong>ã€‚</p>
<p>å‡½æ•°æ‰§è¡Œä¹‹å‰çš„â€œé¢„ç¼–è¯‘â€çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>åˆ›å»º AO å¯¹è±¡</li>
<li>æŸ¥æ‰¾å½¢å‚å’Œå˜é‡å£°æ˜ï¼Œå¹¶èµ‹äºˆ undefinedï¼›</li>
<li>å®å‚å€¼èµ‹ç»™å½¢å‚ï¼›</li>
<li>æŸ¥æ‰¾å‡½æ•°å£°æ˜ï¼Œèµ‹äºˆå‡½æ•°æœ¬èº«ï¼›</li>
</ol>
<p>é¢„ç¼–è¯‘å®Œäº†ä¹‹åï¼Œæ¥ç€æ˜¯æ‰§è¡Œå‡½æ•°ã€‚ï¼ˆä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼‰</p>
<pre><code>&lt;script&gt;
  function fn(a) {
    console.log(a); // 123
    console.log(b); // undefined
    console.log(c); // function c() {}
    var a = 1;
    var b = function() {}; // æ³¨æ„ï¼šå‡½æ•°è¡¨è¾¾å¼ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼ç»™å˜é‡ b
    function c() {};
    console.log(a); // 1
    console.log(b); // function() {}
  }
  fn(123);
  /**
    æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ï¼šä¸‹é¢çš„ AO æ˜¯ä¼ªä»£ç ï¼Œä¸ºäº†åŠ©äºç†è§£ç½¢äº†
    1. åˆ›å»º AO å¯¹è±¡ï¼›AO {}
    2. é¢„ç¼–è¯‘
      ï¼ˆè¿˜åŒ…æ‹¬ arguments ç­‰ï¼Œæ­¤å¤„å¿½ç•¥ï¼‰
      1). æŸ¥æ‰¾å½¢å‚å’Œå˜é‡å£°æ˜ aã€b å’Œ cï¼Œæ”¾åˆ° AO {a: undefined, b: undefined}
      2). å®å‚èµ‹å€¼ç»™å½¢å‚ï¼šAO {a: 123, b: undefined}
      3). æ‰¾åˆ°å‡½æ•°å£°æ˜ cï¼ŒAO {a: 123, b: undefined, c: f()}
    3. æ‰§è¡Œä»£ç 
      1). æ‰§è¡Œåˆ° console.log(a)ï¼Œç„¶åä» AO é‡Œé¢æ‰¾åˆ° aï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯ 123ï¼›
      2). ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰“å° b æ˜¯ undefinedï¼›
      3). ç»§ç»­å¾€ä¸‹ï¼Œa èµ‹å€¼ 1ï¼›b èµ‹å€¼ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼›
      4). ç¬¬äºŒä¸ª console.log(a) ä¼šæ‰“å° 1ï¼›
      5). ç¬¬äºŒä¸ª console.log(b) ä¼šæ‰“å° functionï¼›
  */
&lt;/script&gt;
</code></pre>
<h3>ä¸‰ã€å…¶ä»–</h3>
<p>å…¶å® GO å’Œ AO  å°±å·®åœ¨å½¢å‚å’Œå®å‚è¿™ä¿©ä¸ªä¸œè¥¿ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œæå‡â€ ï¼ˆHoistingï¼‰ã€‚</p>
<p>å…¶å®è¿™äº›è›‹ç–¼çš„æƒ…å†µï¼Œå‡ ä¹åªä¼šå‡ºç°åœ¨â€œé¢è¯•â€ä¸Šï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­å‡ ä¹å¾ˆå°‘å‡ºç°ã€‚å¦‚æœåœ¨å¤šäººå…±åŒç»´æŠ¤é¡¹ç›®ä¸­ï¼Œä¼°è®¡æ—©è¢«æ‰“æ­»äº†ã€‚å› ä¸ºå¯è¯»æ€§å·®è€Œä¸”ç»´æŠ¤æˆæœ¬é«˜ã€‚</p>
<p>åœ¨ ES6 ä¸­ï¼Œæ–°å¢çš„ letã€constã€class ç‰¹æ€§å°±ä¸ä¼šå­˜åœ¨æå‡çš„é—®é¢˜ï¼Œå£°æ˜å˜é‡ï¼Œå¿…é¡»è¦åœ¨è°ƒç”¨ä¹‹å‰å‘ç”Ÿï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚è¿™åº”è¯¥ä¹Ÿæ˜¯ä¸€ä¸ªä¿¡å·ï¼Œå‡å°‘é‚£äº›è›‹ç–¼çš„æƒ…å†µã€‚</p>
<p>ä½†æ˜¯æ— è®ºæ˜¯ä¸ºäº†å¯¹ä»˜é¢è¯•ï¼Œè¿˜æ˜¯ä¸ºäº†äº†è§£ JavaScript å†…éƒ¨è¿è¡Œçš„åŸç†ï¼Œä½œä¸ºå‰ç«¯å¼€å‘çš„ä¸€å‘˜ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥è¦å¼„æ¸…æ¥šã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ä¹‹å†’æ³¡æ’åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/210</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/210</guid>
            <pubDate>Sun, 26 Feb 2023 10:09:55 GMT</pubDate>
            <description><![CDATA[<p>å†’æ³¡æ’åºï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒä¸ºç®€å•æ˜“äºç†è§£çš„æ’åºç®—æ³•ã€‚ä¸‹é¢ä»¥å‡åºä¸ºä¾‹ã€‚</p>
<h3>åŸç†</h3>
<ul>
<li>æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ aã€bã€‚è‹¥ a &gt; bï¼Œåˆ™äº’æ¢ a ä¸ b çš„ä½ç½®ï¼Œå¦åˆ™ä¸å˜ã€‚</li>
<li>æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™ï¼Œç¬¬ä¸€è½®å¾ªç¯æ¬¡æ•°ä¸º <code>array.length - 1</code>]]></description>
            <content:encoded><![CDATA[<p>å†’æ³¡æ’åºï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒä¸ºç®€å•æ˜“äºç†è§£çš„æ’åºç®—æ³•ã€‚ä¸‹é¢ä»¥å‡åºä¸ºä¾‹ã€‚</p>
<h3>åŸç†</h3>
<ul>
<li>æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ aã€bã€‚è‹¥ a &gt; bï¼Œåˆ™äº’æ¢ a ä¸ b çš„ä½ç½®ï¼Œå¦åˆ™ä¸å˜ã€‚</li>
<li>æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™ï¼Œç¬¬ä¸€è½®å¾ªç¯æ¬¡æ•°ä¸º <code>array.length - 1</code>ï¼Œä¸€è½®å¾ªç¯ç»“æŸï¼Œæ•°ç»„æœ€åä¸€é¡¹åº”è¯¥æ˜¯æœ€å¤§æ•°ã€‚</li>
<li>ç¬¬äºŒè½®å¼€å§‹ï¼Œå¾ªç¯æ¬¡æ•°ä¸º <code>array.length - 1 - 1</code>ï¼ŒåŒæ ·æŠŠæœ¬æ¬¡å¾ªç¯çš„æœ€å¤§é¡¹äº’æ¢åˆ° <code>array[length - 1 - 1]</code> çš„ä½ç½®ä¸Šã€‚</li>
<li>ä»¥æ­¤ç±»æ¨...</li>
</ul>
<h3>å›¾ç¤º</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-dbed2e37d336fb33.gif?imageMogr2/auto-orient/strip" alt="å†’æ³¡æ’åº"></p>
<h3>å®ç°</h3>
<pre><code class="language-js">// å†’æ³¡æ’åºï¼ˆå‡åºï¼‰
function bubbleSort(arr) {
  for (let i = 0; i &lt; arr.length - 1; i++) {
    for (let j = 0; j &lt; arr.length - i - 1; j++) {
      if (arr[j] &gt; arr[j + 1]) {
        ;[arr[j], arr[j + 1]] = [arr[j + 1], arr[j]]
      }
    }
  }
  return arr
}

const array = [8, 12, 4, 0, 22, 8, 21, 3, 56]
console.log(bubbleSort(array)) // [0, 3, 4, 8, 8, 12, 21, 22, 56]
</code></pre>
<h3>æ—¶é—´å¤æ‚åº¦</h3>
<p>å¯çŸ¥å†’æ³¡æ’åºæ‰§è¡Œæ¬¡æ•°æ˜¯ <code>(n-1) + (n-2) + ... + 2 + 1</code> = <code>(n^2 - n)/2</code>ï¼Œæ ¹æ®<a href="https://www.jianshu.com/p/9fb90a332524">æ—¶é—´å¤æ‚åº¦æ¨å¯¼æ–¹å¼</a>ï¼Œå¯å¾—åˆ° <code>O(n^2)</code>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[äº”ã€Ajax ä¹‹å“åº”è§£ç ]]></title>
            <link>https://github.com/toFrankie/blog/issues/209</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/209</guid>
            <pubDate>Sun, 26 Feb 2023 09:45:34 GMT</pubDate>
            <description><![CDATA[<p>æˆ‘ä»¬æ¥æ”¶åˆ°çš„å“åº”ä¸»ä½“ç±»å‹å¯ä»¥æ˜¯å¤šç§å½¢å¼çš„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸² Stringã€ArrayBuffer å¯¹è±¡ã€äºŒè¿›åˆ¶ Blob å¯¹è±¡ã€JSON å¯¹è±¡ã€JavaScript æ–‡ä»¶ä»¥åŠè¡¨ç¤º XML æ–‡æ¡£çš„ Document å¯¹è±¡ç­‰ã€‚ä¸‹é¢å°†é’ˆå¯¹ä¸åŒçš„ä¸»ä½“ç±»å‹ï¼Œè¿›è¡Œç›¸åº”çš„å“åº”è§£ç ã€‚</p>
<h3>å±æ€§</h3>
<p>åœ¨ä»‹ç»å“åº”è§£]]></description>
            <content:encoded><![CDATA[<p>æˆ‘ä»¬æ¥æ”¶åˆ°çš„å“åº”ä¸»ä½“ç±»å‹å¯ä»¥æ˜¯å¤šç§å½¢å¼çš„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸² Stringã€ArrayBuffer å¯¹è±¡ã€äºŒè¿›åˆ¶ Blob å¯¹è±¡ã€JSON å¯¹è±¡ã€JavaScript æ–‡ä»¶ä»¥åŠè¡¨ç¤º XML æ–‡æ¡£çš„ Document å¯¹è±¡ç­‰ã€‚ä¸‹é¢å°†é’ˆå¯¹ä¸åŒçš„ä¸»ä½“ç±»å‹ï¼Œè¿›è¡Œç›¸åº”çš„å“åº”è§£ç ã€‚</p>
<h3>å±æ€§</h3>
<p>åœ¨ä»‹ç»å“åº”è§£ç ä¹‹å‰ï¼Œè¦å…ˆäº†è§£ä¸€ä¸‹ <a href="https://github.com/toFrankie/blog/issues/205">XHR å¯¹è±¡</a>çš„å±æ€§ã€‚ä¸€èˆ¬åœ°ï¼Œå¦‚æœæ¥æ”¶çš„æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ responseText å³å¯ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç”¨äºæ¥æ”¶æ•°æ®çš„å±æ€§ã€‚ä½†å¦‚æœè·å–äº†å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä½¿ç”¨ responseText å¯èƒ½å°±ä¸å¤ªåˆé€‚äº†ã€‚</p>
<ol>
<li>
<p><strong>responseText</strong>
è¯¥å±æ€§è¿”å›ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²ï¼Œè¯¥å±æ€§<strong>åªè¯»</strong>ã€‚å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æˆåŠŸæˆ–è€…æ•°æ®ä¸å®Œæ•´ï¼Œè¯¥å±æ€§å°±ä¼šç­‰äº <code>null</code>ã€‚å¦‚æœæœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼æ˜¯ JSONã€å­—ç¬¦ä¸²ã€JavaScriptæˆ–è€…XMLï¼Œéƒ½å¯ä»¥ä½¿ç”¨ responseText å±æ€§ã€‚</p>
</li>
<li>
<p><strong>response</strong>
è¯¥å±æ€§<strong>åªè¯»</strong>ï¼Œè¿”å›æ¥æ”¶åˆ°çš„æ•°æ®ä½“ã€‚å®ƒçš„ç±»å‹å¯ä»¥æ˜¯ ArrayBufferã€Blobã€Documentã€JSONå¯¹è±¡ã€æˆ–è€…å­—ç¬¦ä¸²ï¼Œè¿™ç”± XMLHttpRequest.responseType å±æ€§çš„å€¼å†³å®šã€‚å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æˆåŠŸæˆ–è€…æ•°æ®ä¸å®Œæ•´ï¼Œè¯¥å±æ€§å°±ä¼šç­‰äº <code>null</code>ã€‚ï¼ˆIE 9 æµè§ˆå™¨ä¸æ”¯æŒï¼‰</p>
</li>
<li>
<p><strong>responseType</strong>
è¯¥å±æ€§ç”¨æ¥æŒ‡å®šæœåŠ¡å™¨è¿”å›æ•°æ®ï¼ˆxhr.responseï¼‰çš„ç±»å‹ã€‚</p>
</li>
</ol>
<ul>
<li><code>&quot;&quot;</code>ï¼šå­—ç¬¦ä¸²ï¼ˆé»˜è®¤å€¼ï¼‰</li>
<li><code>&quot;arraybuffer&quot;</code>ï¼šArrayBuffer å¯¹è±¡</li>
<li><code>&quot;blob&quot;</code>ï¼šBlob å¯¹è±¡</li>
<li><code>&quot;document&quot;</code>ï¼šDocument å¯¹è±¡</li>
<li><code>&quot;json&quot;</code>ï¼šJSON å¯¹è±¡</li>
<li><code>&quot;text&quot;</code>ï¼šå­—ç¬¦ä¸²</li>
</ul>
<ol start="4">
<li>
<p><strong>responseXML</strong>
è¯¥å±æ€§è¿”å›ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ Document å¯¹è±¡ï¼Œè¯¥å±æ€§ä¸º<strong>åªè¯»</strong>ã€‚å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æˆåŠŸï¼Œæˆ–è€…æ•°æ®ä¸å®Œæ•´ï¼Œæˆ–è€…ä¸èƒ½è¢«è§£æä¸º XML æˆ– HTMLï¼Œè¯¥å±æ€§ç­‰äº <code>null</code>ã€‚</p>
</li>
<li>
<p><strong>overrideMimeType()</strong>
è¯¥æ–¹æ³•ç”¨æ¥æŒ‡å®šæœåŠ¡å™¨è¿”å›æ•°æ®çš„ MIME ç±»å‹ã€‚<strong>è¯¥æ–¹æ³•å¿…é¡»åœ¨ send() ä¹‹å‰è°ƒç”¨</strong>ã€‚ä¼ ç»Ÿä¸Šï¼Œå¦‚æœå¸Œæœ›ä»æœåŠ¡å™¨å–å›äºŒè¿›åˆ¶æ•°æ®ï¼Œå°±è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œäººä¸ºå°†æ•°æ®ç±»å‹ä¼ªè£…æˆæ–‡æœ¬æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•å¾ˆéº»çƒ¦ï¼Œåœ¨ XMLHttpRequest ç‰ˆæœ¬å‡çº§ä»¥åï¼Œä¸€èˆ¬é‡‡ç”¨æŒ‡å®š responseType çš„æ–¹æ³•ã€‚</p>
</li>
</ol>
<h3>å­—ç¬¦ä¸²</h3>
<p>å¦‚æœæœåŠ¡å™¨è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ responseText å±æ€§è§£æå³å¯ã€‚
å…³äº <code>ajax()</code> å‡½æ•°å°è£…ï¼Œå·²ç»åœ¨<a href="https://github.com/toFrankie/blog/issues/208">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­è¯¦ç»†ä»‹ç»è¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ ç›´æ¥è°ƒç”¨ <code>ajax()</code>ã€‚</p>
<pre><code class="language-html">&lt;button id=&quot;btn&quot;&gt;å–å¾—å“åº”&lt;/button&gt;
&lt;div id=&quot;result&quot;&gt;&lt;/div&gt;

&lt;script&gt;
  btn.onclick = function () {
    ajax({
      url: './example.php',
      method: 'GET',
      timeout: 30000,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      success: function (res) {
        // result å‡è®¾ä¸º id ä¸º result çš„èŠ‚ç‚¹
        result.innerHTML = res
      },
      fail: function (err) {
        console.log('request fail: ', err)
      }
    })
  }
&lt;/script&gt;
</code></pre>
<pre><code class="language-php">&lt;?php
    // è®¾ç½®é¡µé¢å†…å®¹çš„ html ç¼–ç æ ¼å¼æ˜¯ utf-8ï¼Œå†…å®¹æ˜¯çº¯æ–‡æœ¬
    header(&quot;Content-Type: text/plain;charset=utf-8&quot;);    
    echo 'ä½ å¥½ï¼Œä¸–ç•Œ';
?&gt;
</code></pre>
<h3>JSON</h3>
<p>ä½¿ç”¨ ajax æœ€å¸¸ç”¨çš„ä¼ è¾“æ–¹å¼å°±æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œç›´æ¥ä½¿ç”¨ responseText å±æ€§è§£æå³å¯ã€‚</p>
<pre><code class="language-js">ajax({
  success: function (res) {
    const data = JSON.parse(res)
  }
})
</code></pre>
<h3>JS</h3>
<p>ä½¿ç”¨ ajax ä¹Ÿå¯ä»¥æ¥æ”¶ js æ–‡ä»¶ã€‚ä»ç„¶ä½¿ç”¨ responseText æ¥æ¥æ”¶æ•°æ®ï¼Œä½†è¦ä½¿ç”¨ <code>eval()</code> æ¥æ‰§è¡Œä»£ç ã€‚</p>
<pre><code class="language-js">// æ­¤å¤„çœç•¥ä¸€ä¸‡è¡Œä»£ç 
ajax({
  success: function (res) {
    eval(res)
  }
})
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<p>åç»­è¡¥ä¸Š xmlã€blobã€arraybuffter...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å››ã€Ajax ä¹‹ GETã€POST è¯·æ±‚æ–¹å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/208</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/208</guid>
            <pubDate>Sun, 26 Feb 2023 09:45:05 GMT</pubDate>
            <description><![CDATA[<p>åœ¨<a href="https://github.com/toFrankie/blog/issues/205">ä¸Šä¸€ç¯‡</a>ä¸­ï¼Œæ¦‚è¦åœ°ä»‹ç»äº† XHR å¯¹è±¡çš„ä½¿ç”¨ï¼Œæœ¬æ–‡å°†è¯¦ç»†åœ°ä»‹ç»ä½¿ç”¨ XHR å¯¹è±¡å‘é€è¯·æ±‚çš„ä¸¤ç§æ–¹å¼ <code>GET</code> å’Œ <code>POST</code>ã€‚</p>
<h3>ä¸€ã€]]></description>
            <content:encoded><![CDATA[<p>åœ¨<a href="https://github.com/toFrankie/blog/issues/205">ä¸Šä¸€ç¯‡</a>ä¸­ï¼Œæ¦‚è¦åœ°ä»‹ç»äº† XHR å¯¹è±¡çš„ä½¿ç”¨ï¼Œæœ¬æ–‡å°†è¯¦ç»†åœ°ä»‹ç»ä½¿ç”¨ XHR å¯¹è±¡å‘é€è¯·æ±‚çš„ä¸¤ç§æ–¹å¼ <code>GET</code> å’Œ <code>POST</code>ã€‚</p>
<h3>ä¸€ã€GET è¯·æ±‚</h3>
<p>GET è¯·æ±‚æ˜¯æœ€å¸¸è§çš„è¯·æ±‚ç±»å‹ï¼Œæœ€å¸¸ç”¨äºå‘æœåŠ¡å™¨æŸ¥è¯¢æŸäº›ä¿¡æ¯ï¼Œå®ƒé€‚ç”¨äºå½“ URL å®Œå…¨æŒ‡å®šè¯·æ±‚èµ„æºï¼Œå½“è¯·æ±‚å¯¹æœåŠ¡å™¨æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ä»¥åŠå½“æœåŠ¡å™¨çš„å“åº”æ˜¯å¯ç¼“å­˜çš„çš„æƒ…å†µä¸‹ã€‚</p>
<ol>
<li><strong>æ•°æ®å‘é€</strong></li>
</ol>
<p>ä½¿ç”¨ GET æ–¹å¼å‘é€è¯·æ±‚æ—¶ï¼Œæ•°æ®è¢«è¿½åŠ åˆ° <code>open()</code> æ–¹æ³•ä¸­çš„ URL çš„æœ«å°¾ã€‚
æ•°æ®ä»¥ <code>?</code> é—®å·å¼€å§‹ï¼Œå±æ€§åå’Œå±æ€§å€¼ä¹‹é—´ç”¨ <code>=</code> ç­‰å·è¿æ¥ï¼Œé”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨ <code>&amp;</code> åˆ†éš”ã€‚ä½¿ç”¨ GET æ–¹å¼å‘é€çš„æ•°æ®å¸¸å¸¸è¢«ç§°ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-js">xhr.open('GET', 'example.php?name1=value1&amp;name2=value2', true)
</code></pre>
<ol start="2">
<li><strong>ç¼–ç </strong></li>
</ol>
<p>ç”±äº URL æ— æ³•è¯†åˆ«ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥å¦‚æœæ•°æ®ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ï¼‰ï¼Œåˆ™éœ€è¦ä½¿ç”¨ encodeURIComponent() è¿›è¡Œç¼–ç ã€‚</p>
<pre><code class="language-js">const url = 'example.php?name=' + encodeURIComponent('è¶Šå‰å›')
// url è¢«ç¼–ç æˆï¼šexample.php?name=%E8%B6%8A%E5%89%8D%E5%90%9B
xhr.open('GET', url, true)
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š<code>encodeURIComponent()</code> åªæ˜¯å…­ç§ç¼–è§£ç æ–¹æ³•çš„ä¸€ç§ï¼Œå…³äºå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œ<a href="http://www.cnblogs.com/xiaohuochai/p/6144157.html#anchor4">è¯·ç‚¹å‡»è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<ol start="3">
<li><strong>å†™ä¸ªå‡½æ•°æ¥ç¼–ç </strong></li>
</ol>
<pre><code class="language-js">function addURLParam(url, name, value) {
  url += url.indexOf('?') &gt; -1 ? '&amp;' : '?'
  url += encodeURIComponent(name) + '=' + encodeURIComponent(value)
  return url
}

let url = 'example.php'
url = addURLParam(url, 'name1', 'Frankie')
url = addURLParam(url, 'name2', 'Mandy')

xhr.open('GET', url, true)
</code></pre>
<ol start="4">
<li><strong>ç¼“å­˜</strong></li>
</ol>
<p>åœ¨ GET è¯·æ±‚ä¸­ï¼Œä¸ºäº†é¿å…ç¼“å­˜çš„å½±å“ï¼Œå¯ä»¥å‘ URL æ·»åŠ ä¸€ä¸ªéšæœºæ•°æˆ–è€…æ—¶é—´æˆ³ã€‚</p>
<pre><code class="language-js">xhr.open('GET', 'example.php?' + Number(new Date()), true)
// æˆ–è€…
xhr.open('GET', 'example.php?' + Math.random(), true)
</code></pre>
<ol start="5">
<li><strong>å°è£… GET æ–¹æ³•</strong></li>
</ol>
<pre><code class="language-js">function get(url, data, callback) {
  let xhr

  // åˆ›å»º xhr å¯¹è±¡
  if (window.XMLHttpRequest) {
    xhr = new window.XMLHttpRequest()
  } else {
    xhr = new ActiveXObject('Microsoft.XMLHTTP')
  }

  // ç›‘å¬è¯·æ±‚å®Œæˆ
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {
      typeof callback === 'function' &amp;&amp; callback(xhr.responseText)
    }
  }

  // è®¾ç½®è¶…æ—¶
  xhr.ontimeout = function () {
    typeof callback === 'function' &amp;&amp; callback('The request was timed out!')
  }
  xhr.timeout = 30000

  // ç¼–ç ç‰¹æ®Šå­—ç¬¦
  for (const key in data) {
    url += url.indexOf('?') &gt; -1 ? '&amp;' : '?'
    url += encodeURIComponent(key) + '=' + encodeURIComponent(data[key])
  }

  // æ·»åŠ æ—¶é—´æˆ³ï¼Œé˜²æ­¢ç¼“å­˜
  url += (url.indexOf('?') &gt; -1 ? '&amp;' : '?') + Number(new Date())

  // å»ºç«‹ã€å‘é€è¯·æ±‚
  xhr.open('GET', url, true)
  xhr.send(null)
}

// å‘èµ· GET è¯·æ±‚
get('example.php', { name: 'Frankie', age: '20', sex: 'ç”·' }, function (res) {
  // callback statements...
})

</code></pre>
<h3>äºŒã€POST è¯·æ±‚</h3>
<p>ä½¿ç”¨é¢‘ç‡ä»…æ¬¡äº GET è¯·æ±‚çš„æ˜¯ POST è¯·æ±‚é€šå¸¸ç”¨äºå‘æœåŠ¡å™¨å‘é€åº”è¯¥è¢«ä¿å­˜çš„æ•°æ®ã€‚POST æ–¹æ³•å¸¸ç”¨äº HTML è¡¨å•ã€‚å®ƒåœ¨è¯·æ±‚ä¸»ä½“ä¸­åŒ…å«é¢å¤–æ•°æ®ä¸”è¿™äº›æ•°æ®å¸¸å­˜å‚¨åˆ°æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ä¸­ã€‚ç›¸åŒ URL çš„é‡å¤ POST è¯·æ±‚ä»æœåŠ¡å™¨å¾—åˆ°çš„å“åº”å¯èƒ½ä¸åŒï¼ŒåŒæ—¶ä¸åº”è¯¥ç¼“å­˜ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„è¯·æ±‚ã€‚</p>
<p>POST è¯·æ±‚åº”è¯¥æŠŠæ•°æ®ä½œä¸ºè¯·æ±‚çš„ä¸»ä½“æäº¤ï¼Œè€Œ GET è¯·æ±‚ä¼ ç»Ÿä¸Šä¸æ˜¯è¿™æ ·ã€‚POST è¯·æ±‚çš„ä¸»ä½“å¯ä»¥åŒ…å«éå¸¸å¤šçš„æ•°æ®ï¼Œè€Œä¸”æ ¼å¼ä¸é™ã€‚åœ¨ open() æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®ä¼ å…¥ 'POST' ï¼ˆå¤§å°å†™ä¸é™åˆ¶ï¼Œé€šå¸¸ä¹ æƒ¯å¤§å†™ï¼‰ï¼Œå°±å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ª POST è¯·æ±‚äº†ã€‚</p>
<pre><code class="language-js">xhr.open('POST', 'example.php', true)
</code></pre>
<ol>
<li><strong>è®¾ç½®è¯·æ±‚å¤´</strong></li>
</ol>
<p>å‘é€ POST è¯·æ±‚çš„ç¬¬äºŒæ­¥å°±æ˜¯å‘ send() æ–¹æ³•ä¼ å…¥æŸäº›æ•°æ®ã€‚ç”±äº XHR æœ€åˆçš„è®¾è®¡æ˜¯ä¸ºäº†å¤„ç† XMLï¼Œå› æ­¤å¯ä»¥åœ¨æ­¤ä¼ å…¥ XML DOM æ–‡æ¡£ï¼Œä¼ å…¥çš„æ–‡æ¡£ç»åºåˆ—åŒ–ä¹‹åå°†ä½œä¸ºè¯·æ±‚ä¸»ä½“è¢«æäº¤åˆ°æœåŠ¡å™¨ã€‚äº¦å¯ä»¥åœ¨æ­¤ä¼ å…¥ä»»ä½•æƒ³å‘é€åˆ°æœåŠ¡å™¨çš„<strong>å­—ç¬¦ä¸²</strong>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯¹ POST è¯·æ±‚å’Œæäº¤ Web è¡¨å•çš„è¯·æ±‚å¹¶ä¸ä¼šä¸€è§†åŒä»ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç«¯å¿…é¡»æœ‰ç¨‹åºæ¥è¯»å–å‘é€è¿‡æ¥çš„åŸå§‹æ•°æ®ï¼Œå¹¶ä»ä¸­è§£æå‡ºæœ‰ç”¨çš„éƒ¨åˆ†ã€‚ä¸è¿‡ï¼Œå¯ä»¥ä½¿ç”¨ XHR æ¥æ¨¡ä»¿è¡¨å•æäº¤ï¼šé¦–å…ˆå°† <code>Content-Type</code> å¤´éƒ¨ä¿¡æ¯è®¾ç½®ä¸º <code>application/x-www-form-urlencoded</code>ï¼Œä¹Ÿå°±æ˜¯è¡¨å•æäº¤æ—¶çš„å†…å®¹ç±»å‹ã€‚</p>
<pre><code class="language-js">xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
</code></pre>
<p>å¦‚æœä¸è®¾ç½® Content-Typeï¼Œå‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®å°±ä¸ä¼šå‡ºç°åœ¨ <code>$POST</code> è¶…çº§å…¨å±€å˜é‡ä¸­ã€‚è¿™æ—¶è¦è®¿é—®åŒæ ·çš„æ•°æ®ï¼Œéœ€å€ŸåŠ© <code>$HTTP_RAW_POST_DATA</code> ã€‚</p>
<blockquote>
<p>å¦‚æœå¯¹ç›¸åŒçš„å¤´è°ƒç”¨å¤šæ¬¡ setRequestHeader()ï¼Œæ–°å€¼ä¸ä¼šå–ä»£ä¹‹å‰æŒ‡å®šçš„å€¼ã€‚ç›¸åï¼ŒHTTP è¯·æ±‚å°†åŒ…å«è¿™ä¸ªå¤´çš„å¤šä¸ªå‰¯æœ¬æˆ–è€…è¿™ä¸ªå¤´å°†æŒ‡å®šå¤šä¸ªå€¼ã€‚</p>
</blockquote>
<ol start="2">
<li><strong>å‘é€ä¸»ä½“</strong></li>
</ol>
<p>æ¥ä¸‹æ¥è¦ä»¥é€‚å½“çš„æ ¼å¼åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ send() æ–¹æ³•å‘é€ã€‚
POST æ•°æ®çš„æ ¼å¼ä¸æŸ¥è¯¢å­—ç¬¦ä¸²æ ¼å¼ç›¸åŒï¼Œé”®å’Œå€¼ä¹‹é—´ä½¿ç”¨ <code>=</code> ç­‰å·è¿æ¥ï¼Œé”®å€¼å¯¹ä¹‹é—´ç”¨ <code>&amp;</code> åˆ†éš”ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">xhr.send('name=Frankie&amp;age=20')
</code></pre>
<ol start="3">
<li><strong>ç¼–ç å’Œç¼“å­˜</strong></li>
</ol>
<p>ç”±äºä½¿ç”¨ POST æ–¹å¼ä¼ é€’æ•°æ®æ—¶ï¼Œéœ€è¦è®¾ç½®è¯·æ±‚å¤´ <code>content-type</code>ï¼Œè¿™ä¸€æ­¥éª¤å·²ç»èƒ½å‹¾è‡ªåŠ¨å¯¹ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ï¼‰è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥å°±ä¸éœ€è¦ä½¿ç”¨ encodeURIComponent() æ–¹æ³•äº†ã€‚POST è¯·æ±‚ä¸»è¦ç”¨äºæ•°æ®æäº¤ï¼Œç›¸åŒ URL çš„é‡å¤ POST è¯·æ±‚ä»æœåŠ¡å™¨å¾—åˆ°çš„å“åº”å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ä¸åº”è¯¥ç¼“å­˜ä½¿ç”¨ POST æ–¹æ³•çš„è¯·æ±‚ã€‚</p>
<ol start="4">
<li><strong>æ€§èƒ½</strong></li>
</ol>
<p>GET å¯¹å‘é€ä¿¡æ¯çš„æ•°é‡æœ‰é™åˆ¶ï¼Œä¸€èˆ¬åœ¨ 2000 ä¸ªå­—ç¬¦ã€‚ä¸ GET è¯·æ±‚ç›¸æ¯”ï¼ŒPOST è¯·æ±‚æ¶ˆè€—çš„èµ„æºè¦æ›´å¤šä¸€äº›ã€‚ä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œä»¥å‘é€ç›¸åŒçš„æ•°æ®è®¡ç®—ï¼ŒGET è¯·æ±‚çš„é€Ÿåº¦æœ€å¤šå¯ POST è¯·æ±‚çš„ä¸¤å€ã€‚</p>
<ol start="5">
<li><strong>å°è£… POST æ–¹æ³•</strong></li>
</ol>
<pre><code class="language-js">function post(url, data, callback) {
  let xhr

  // åˆ›å»º xhr å¯¹è±¡
  if (window.XMLHttpRequest) {
    xhr = new window.XMLHttpRequest()
  } else {
    xhr = new ActiveXObject('Microsoft.XMLHTTP')
  }

  // ç›‘å¬è¯·æ±‚å®Œæˆ
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {
      typeof callback === 'function' &amp;&amp; callback(xhr.responseText)
    }
  }

  // è®¾ç½®è¶…æ—¶
  xhr.ontimeout = function () {
    typeof callback === 'function' &amp;&amp; callback('The request was timed out!')
  }
  xhr.timeout = 30000

  // åºåˆ—åŒ– data
  let strData = ''
  for (const key in data) {
    strData += '&amp;' + key + '=' + data[key]
  }
  strData = strData.substr(1)

  // åˆå§‹åŒ–è¯·æ±‚
  xhr.open('POST', url, true)

  // è®¾ç½®è¯·æ±‚å¤´
  xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded')

  // å‘é€è¯·æ±‚
  xhr.send(strData)
}

// å‘èµ· POST è¯·æ±‚
post('example.php', { name: 'Frankie', age: '20', sex: 'ç”·' }, function (res) {
  // callback statements...
})
</code></pre>
<h3>ä¸‰ã€å°† GET å’Œ POST å°è£…ä¸€ä¸‹</h3>
<pre><code class="language-js">function ajax(opt) {
  // è¯·æ±‚ url
  let url = opt.url ? opt.url : ''
  // é»˜è®¤å¼‚æ­¥
  const isAsync = typeof opt.async !== 'undefined' ? !!opt.async : true
  // é»˜è®¤ GET æ–¹æ³•
  const method = opt.method &amp;&amp; opt.method.toUpperCase() === 'POST' ? 'POST' : 'GET'
  // æˆåŠŸå›è°ƒ
  const successCallback = typeof opt.success === 'function' ? opt.success : null
  // å¤±è´¥å›è°ƒ
  const failCallback = typeof opt.fail === 'function' ? opt.fail : null

  let xhr

  // åˆ›å»º xhr å¯¹è±¡
  if (window.XMLHttpRequest) {
    xhr = new window.XMLHttpRequest()
  } else {
    xhr = new ActiveXObject('Microsoft.XMLHTTP')
  }

  // ç›‘å¬è¯·æ±‚å®Œæˆ
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        successCallback &amp;&amp; successCallback(xhr.responseText)
      } else {
        failCallback &amp;&amp; failCallback(xhr.responseText)
      }
    }
  }

  // è®¾ç½®è¶…æ—¶ï¼ˆåŒæ­¥ä¸èƒ½è®¾ç½®è¶…æ—¶ï¼‰
  if (isAsync) {
    xhr.ontimeout = function () {
      console.error('The request was timed out!')
    }
    xhr.timeout = opt.timeout ? opt.timeout : 30000
  }

  if (method === 'POST') {
    // POST å¤„ç†
    let strData = ''
    for (var key in opt.data) {
      strData += '&amp;' + key + '=' + opt.data[key]
    }
    strData = strData.substr(1)
    xhr.open(method, url, isAsync)
    if (opt.headers) {
      for (const key2 in opt.headers) {
        xhr.setRequestHeader(key2, opt.headers[key2])
      }
    }
    xhr.send(strData)
  } else {
    // GET å¤„ç†
    for (var key in opt.data) {
      url += url.indexOf('?') &gt; -1 ? '&amp;' : '?'
      url += encodeURIComponent(key) + '=' + encodeURIComponent(opt.data[key])
    }
    url += (url.indexOf('?') &gt; -1 ? '&amp;' : '?') + Number(new Date())
    xhr.open(method, url, isAsync)
    xhr.send()
  }
}

// å‘èµ·è¯·æ±‚
ajax({
  url: './example.php',
  method: 'POST',
  data: {
    name: 'Frankie',
    age: 20
  },
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded'
  },
  success: function (res) {
    console.log('request success: ', res)
  },
  fail: function (err) {
    console.log('request fail: ', err)
  }
})
</code></pre>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/209">Ajax ä¹‹å“åº”è§£ç </a></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸‰ã€HTTP åè®®]]></title>
            <link>https://github.com/toFrankie/blog/issues/207</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/207</guid>
            <pubDate>Sun, 26 Feb 2023 09:44:33 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº†ï¼š<a href="https://github.com/toFrankie/blog/issues/206">HTTP Content-Type è¯¦è§£</a></p>
<h3>ä»€ä¹ˆæ˜¯ HTTP åè®®ï¼Ÿ</h3>
<p>HTTPï¼Œå…¨ç§°æ˜¯ HyperText Transfer Protocolï¼Œä¸­æ–‡å«åš]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº†ï¼š<a href="https://github.com/toFrankie/blog/issues/206">HTTP Content-Type è¯¦è§£</a></p>
<h3>ä»€ä¹ˆæ˜¯ HTTP åè®®ï¼Ÿ</h3>
<p>HTTPï¼Œå…¨ç§°æ˜¯ HyperText Transfer Protocolï¼Œä¸­æ–‡å«åšè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚å®ƒæ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼ã€åä½œå¼å’Œè¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„åº”ç”¨å±‚åè®®ã€‚</p>
<p>ä¸€ç³»åˆ—å‘å¸ƒçš„ RFC ä¸­ï¼Œæœ€è‘—åçš„æ˜¯ 1999 å¹´ 6 æœˆå…¬å¸ƒçš„ RFC 2616ï¼Œå®šä¹‰äº† HTTP åè®®ä¸­ç°ä»Šå¹¿æ³›ä½¿ç”¨çš„ä¸€ä¸ªç‰ˆæœ¬ <code>HTTP/1.1</code>ã€‚ç›´åˆ° <code>HTTP/2</code> äº 2015 å¹´ 5 æœˆçš„ RFC 7540 æ­£å¼å‘å¸ƒï¼Œå–ä»£äº† HTTP/1.1 æˆä¸º HTTP çš„å®ç°æ ‡å‡†ã€‚</p>
<h3>HTTP åè®®æ¦‚è¿°</h3>
<p>HTTP æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆç”¨æˆ·ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆç½‘ç«™ï¼‰è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚
é€šè¿‡ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶ä»–å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šçš„ç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º 80ï¼‰ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå®¢æˆ·ç«¯ä¸ºç”¨æˆ·ä»£ç†ç¨‹åºï¼ˆuser agentï¼‰ã€‚åº”ç­”çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨è¿™ä¸€äº›èµ„æºï¼Œæ¯”å¦‚ HTMLæ–‡ä»¶ã€å›¾åƒç­‰ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªåº”ç­”æœåŠ¡å™¨ä¸ºæºæœåŠ¡å™¨ï¼ˆorigin serverï¼‰ã€‚åœ¨ç”¨æˆ·ä»£ç†ç¨‹åºå’ŒæºæœåŠ¡å™¨ä¸­é—´å¯èƒ½å­˜åœ¨å¤šä¸ªâ€œä¸­é—´å±‚â€ï¼Œæ¯”å¦‚ä»£ç†æœåŠ¡å™¨ã€ç½‘å…³æˆ–è€…éš§é“ï¼ˆtunnelï¼‰ã€‚</p>
<p>å°½ç®¡ TCP/IP åè®®æ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„åº”ç”¨ï¼Œä½†åœ¨ HTTP åè®®ä¸­ï¼Œå¹¶æ²¡æœ‰è§„å®šå¿…é¡»ä½¿ç”¨å®ƒæˆ–è€…ä»–æ”¯æŒçš„å±‚ã€‚äº‹å®ä¸Šï¼ŒHTTP å¯ä»¥åœ¨ä»»ä½•äº’è”ç½‘åè®®ä¸Šï¼Œæˆ–è€…å…¶ä»–ç½‘ç»œä¸Šå®ç°ã€‚HTTP å‡å®šå…¶ä¸‹å±‚åè®®æä¾›å¯é çš„ä¼ è¾“ã€‚å› æ­¤ï¼Œä»»ä½•èƒ½å¤Ÿæä¾›è¿™ç§ä¿è¯çš„åè®®éƒ½å¯ä»¥è¢«å…¶ä½¿ç”¨ã€‚å› æ­¤ï¼Œä¹Ÿå°±æ˜¯å…¶åœ¨ TCP/IP åè®®æ—ä½¿ç”¨ TCP ä½œä¸ºå…¶ä¼ è¾“å±‚ã€‚</p>
<p>é€šå¸¸ï¼Œç”± HTTP å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ä¸º 80ï¼‰çš„ TCP è¿æ¥ã€‚HTTP æœåŠ¡å™¨åˆ™åœ¨é‚£ä¸ªç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯”å¦‚ â€œHTTP/1.1 200 OKâ€ï¼Œä»¥åŠè¿”å›çš„å†…å®¹ï¼Œå¦‚è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯ä¿¡æ¯ã€æˆ–è€…å…¶ä»–ä¿¡æ¯ã€‚</p>
<h3>HTTP å·¥ä½œåŸç†</h3>
<p>HTTP åè®®å®šä¹‰ Web å®¢æˆ·ç«¯å¦‚ä½•ä» Web æœåŠ¡å™¨è¯·æ±‚ Web é¡µé¢ï¼Œä»¥åŠæœåŠ¡å™¨å¦‚ä½•æŠŠ Web é¡µé¢ä¼ é€ç»™å®¢æˆ·ç«¯ã€‚HTTP åè®®é‡‡ç”¨äº†â€œè¯·æ±‚/å“åº”æ¨¡å‹â€ã€‚</p>
<p>å®¢æˆ·ç«¯æƒ³æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡åŒ…å«äº†è¯·æ±‚æ–¹æ³•ã€URLåè®®ç‰ˆæœ¬ã€è¯·æ±‚å¤´éƒ¨å’Œè¯·æ±‚æ•°æ®ã€‚æœåŠ¡å™¨ä»¥ä¸€ä¸ªçŠ¶æ€è¡Œä½œä¸ºå“åº”ï¼Œå“åº”çš„å†…å®¹åŒ…æ‹¬åè®®çš„ç‰ˆæœ¬ã€æˆåŠŸæˆ–é”™è¯¯ä»£ç ã€æœåŠ¡å™¨ä¿¡æ¯ã€å“åº”å¤´éƒ¨å’Œå“åº”æ•°æ®ã€‚</p>
<p>HTTP æŠ¥æ–‡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šè¯·æ±‚æŠ¥æ–‡ï¼ˆrequest messageï¼‰å’Œå“åº”æŠ¥æ–‡ï¼ˆresponse messageï¼‰ï¼Œä¸¤è€…çš„åŸºæœ¬æŠ¥æ–‡ç»“æ„ç›¸åŒã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677406046919.png" alt=""></p>
<p>è¯·æ±‚æŠ¥æ–‡çš„æ ¼å¼ï¼š</p>
<pre><code class="language-xml">&lt;method&gt; &lt;request-URL&gt; &lt;version&gt;
&lt;headers&gt;

&lt;entiry-body&gt;
</code></pre>
<p>å“åº”æŠ¥æ–‡æ ¼å¼ï¼š</p>
<pre><code class="language-xml">&lt;version&gt; &lt;status&gt; &lt;reason-phrase&gt;
&lt;headers&gt;

&lt;entity-body&gt;
</code></pre>
<p>æŠ¥æ–‡å¯¹åº”è¡¨ç¤ºï¼š</p>
<pre><code>// method: å®¢æˆ·ç«¯å¸Œæœ›æœåŠ¡å™¨å¯¹èµ„æºæ‰§è¡Œçš„åŠ¨ä½œã€‚æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¯ï¼Œæ¯”å¦‚ GETã€HEAD æˆ– POST;
// request-URL: å‘½åäº†æ‰€è¯·æ±‚çš„èµ„æºï¼Œæˆ–è€… URL è·¯å¾„ç»„ä»¶çš„å®Œæ•´ URL
// version: æŠ¥æ–‡æ‰€ä½¿ç”¨çš„ HTTP ç‰ˆæœ¬ï¼Œæ ¼å¼ï¼šHTTP/&lt;major&gt;.&lt;minor&gt;ï¼Œä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·éƒ½æ˜¯æ•´æ•°
// headers: é¦–éƒ¨ï¼Œå¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªé¦–éƒ¨ï¼Œæ¯ä¸ªé¦–éƒ¨éƒ½åŒ…å«ä¸€ä¸ªåå­—ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå†’å·ï¼ˆ:ï¼‰ï¼Œç„¶åæ˜¯ä¸€ä¸ªå¯é€‰çš„ç©ºæ ¼ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªå€¼ï¼Œæœ€åæ˜¯ä¸€ä¸ª CRLFã€‚é¦–éƒ¨æ˜¯ç”±ä¸€ä¸ªç©ºè¡Œï¼ˆCRLFï¼‰ç»“æŸçš„ï¼Œè¡¨ç¤ºäº†é¦–éƒ¨åˆ—è¡¨çš„ç»“æŸå’Œå®ä½“ä¸»ä½“éƒ¨åˆ†çš„å¼€å§‹
// entity-body: ä¸»ä½“éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ä¸ªç”±ä»»æ„æ•°æ®ç»„æˆçš„æ•°æ®å—ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ï¼Œæœ‰æ—¶æŠ¥æ–‡æ˜¯å·²ä¸€ä¸ª CRLF ç»“æŸçš„ã€‚

// æ³¨æ„ï¼šè¯·æ±‚è¡Œã€å“åº”è¡Œçš„æ¯ä¸ªå­—æ®µéƒ½æ˜¯ç”±â€œç©ºæ ¼ç¬¦â€è¿›è¡Œåˆ†å‰²çš„ã€‚
</code></pre>
<h3>HTTP è¯·æ±‚/å“åº”çš„æ­¥éª¤ï¼š</h3>
<ol>
<li>
<p>å®¢æˆ·ç«¯è¿æ¥åˆ° Web æœåŠ¡å™¨
ä¸€ä¸ª HTTP å®¢æˆ·ç«¯ã€‚é€šå¸¸æ˜¯æµè§ˆå™¨ï¼Œä¸ Web æœåŠ¡å™¨çš„ HTTP ç«¯ï¼ˆé»˜è®¤ä¸º 80ï¼‰å»ºç«‹ä¸€ä¸ª TCP å¥—æ¥å­—è¿æ¥ã€‚å¦‚ï¼š<a href="http://www.baidu.com">http://www.baidu.com</a>ï¼›</p>
</li>
<li>
<p>å‘é€ HTTP è¯·æ±‚
é€šè¿‡ TCP å¥—æ¥å­—ï¼Œå®¢æˆ·ç«¯å‘ Web æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡ï¼Œ<strong>ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ® 4 éƒ¨åˆ†ç»„æˆã€‚</strong></p>
</li>
<li>
<p>æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶è¿”å› HTTP å“åº”
Web æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æºã€‚æœåŠ¡å™¨å°†èµ„æºå‰¯æœ¬å†™åˆ° TCP å¥—æ¥å­—ï¼Œç”±å®¢æˆ·ç«¯è¯»å–ã€‚ä¸€ä¸ªå“åº”ç”±çŠ¶æ€è¡Œã€å“åº”å¤´éƒ¨ã€ç©ºè¡Œå’Œå“åº”æ•°æ® 4 éƒ¨åˆ†ç»„æˆã€‚</p>
</li>
<li>
<p>é‡Šæ”¾ TCP è¿æ¥
å¦‚æœ connect æ¨¡å¼ä¸º closeï¼Œåˆ™æœåŠ¡å™¨é˜»æ–­å…³é—­ TCP è¿æ¥ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­è¿æ¥ï¼Œé‡Šæ”¾ TCP è¿æ¥ï¼›å¦‚æœ connection æ¨¡å¼ä¸º keepaliveï¼Œåˆ™è¯¥è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œåœ¨æ”¹æ—¶é—´å†…å¯ä»¥ç»§ç»­æ¥æ”¶è¯·æ±‚ã€‚</p>
</li>
<li>
<p>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æ HTML å†…å®¹ã€‚
å®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè§£æçŠ¶æ€è¡Œï¼ŒæŸ¥çœ‹è¡¨æ˜è¯·æ±‚æ˜¯å¦æˆåŠŸçš„çŠ¶æ€ä»£ç ï¼Œç„¶åè§£ææ¯ä¸€ä¸ªå“åº”å¤´ï¼Œå“åº”å¤´å‘ŠçŸ¥ä»¥ä¸‹ä¸ºè‹¥å¹²å­—èŠ‚çš„ HTML æ–‡æ¡£å’Œæ–‡æ¡£çš„å­—ç¬¦é›†ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è¯»å–å“åº”æ•°æ® HTMLï¼Œæ ¹æ® HTML è¯­æ³•å †ç Œè¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶åœ¨æµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºã€‚</p>
</li>
</ol>
<p><strong>ä¸€ä¸ªç»å…¸é—®é¢˜ï¼šåœ¨æµè§ˆå™¨åœ°å€æ é”®å…¥ URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åä¼šç»å†ä»€ä¹ˆï¼Ÿ</strong></p>
<blockquote>
<ol>
<li>æµè§ˆå™¨å‘ DNS æœåŠ¡å™¨è¯·æ±‚è§£æè¯¥ URL ä¸­åŸŸåå¯¹åº”çš„ IP åœ°å€ï¼›</li>
<li>è§£æå‡º IP åœ°å€åï¼Œæ ¹æ®è¯¥ IP åœ°å€å’Œé»˜è®¤ç«¯å£ 80ï¼Œå’ŒæœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ï¼›</li>
<li>æœåŠ¡å™¨å‘å‡ºè¯»å–æ–‡ä»¶çš„HTTPè¯·æ±‚ï¼ˆURL ä¸­åŸŸååé¢éƒ¨åˆ†å¯¹åº”çš„æ–‡ä»¶ï¼‰ï¼Œè¯¥è¯·æ±‚æŠ¥æ–‡ä½œä¸º TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡çš„æ•°æ®å‘é€ç»™æœåŠ¡å™¨ï¼›</li>
<li>æœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚ä½œå‡ºå“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„ HTML æ–‡æœ¬å‘é€ç»™æµè§ˆå™¨ï¼›</li>
<li>é‡Šæ”¾ TCP è¿æ¥ï¼›</li>
<li>æµè§ˆå™¨å°† HTML æ–‡æ¡£æ¸²æŸ“å¹¶æ˜¾ç¤ºå†…å®¹ï¼›</li>
</ol>
</blockquote>
<h3>HTTP 1.1 æä¾›äº†å…«ç§æ–¹æ³•æ¥ä»¥ä¸åŒæ–¹å¼æ“ä½œæŒ‡å®šçš„èµ„æº</h3>
<blockquote>
<p>GETï¼šè·å–èµ„æº
POSTï¼šä¼ è¾“å®ä½“ä¸»ä½“
PUTï¼šä¼ è¾“æ–‡ä»¶
HEADï¼šè·å–æŠ¥æ–‡é¦–éƒ¨
DELETEï¼šåˆ é™¤æ–‡ä»¶
OPTIONSï¼šè¯¢é—®æ”¯æŒçš„æ–¹æ³•
TRACEï¼šè¿½è¸ªè·¯å¾„
CONNECTï¼šè¦æ±‚ç”¨éš§é“åè®®è¿æ¥ä»£ç†</p>
</blockquote>
<ul>
<li>
<p><strong>GET</strong>ï¼šå‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ã€‚ä½¿ç”¨GETæ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ï¼Œè€Œä¸åº”å½“è¢«ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚åœ¨Web Applicationä¸­ã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯GETå¯èƒ½ä¼šè¢«ç½‘ç»œèœ˜è››ç­‰éšæ„è®¿é—®ã€‚</p>
</li>
<li>
<p><strong>HEAD</strong>ï¼šä¸GETæ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ã€‚åªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ã€‚å®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­â€œå…³äºè¯¥èµ„æºçš„ä¿¡æ¯â€ï¼ˆå…ƒä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ã€‚</p>
</li>
<li>
<p><strong>PUT</strong>ï¼šå‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹ã€‚</p>
</li>
<li>
<p><strong>POST</strong>ï¼šå‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æœ¬æ–‡ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–äºŒè€…çš†æœ‰ã€‚</p>
</li>
<li>
<p><strong>TRACE</strong>ï¼šå›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚</p>
</li>
<li>
<p><strong>OPTIONS</strong>ï¼šè¿™ä¸ªæ–¹æ³•å¯ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨'*'æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘WebæœåŠ¡å™¨å‘é€OPTIONSè¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œã€‚</p>
</li>
<li>
<p><strong>DELETE</strong>ï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤Request-URIæ‰€æ ‡è¯†çš„èµ„æºã€‚</p>
</li>
<li>
<p><strong>CONNECT</strong>ï¼šHTTP/1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºSSLåŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„HTTPä»£ç†æœåŠ¡å™¨ï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>æ–¹æ³•åç§°æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚å½“æŸä¸ªè¯·æ±‚æ‰€é’ˆå¯¹çš„èµ„æºä¸æ”¯æŒå¯¹åº”çš„è¯·æ±‚æ–¹æ³•çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨åº”å½“è¿”å›çŠ¶æ€ç  405ï¼ˆMethod Not Allowedï¼‰ï¼Œå½“æœåŠ¡å™¨ä¸è®¤è¯†æˆ–è€…ä¸æ”¯æŒå¯¹åº”çš„è¯·æ±‚æ–¹æ³•çš„æ—¶å€™ï¼Œåº”å½“è¿”å›çŠ¶æ€ç  501ï¼ˆNot Implementedï¼‰ã€‚</li>
<li>HTTP æœåŠ¡å™¨è‡³å°‘åº”è¯¥å®ç° GET å’Œ HEAD æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ã€‚å½“ç„¶ï¼Œæ‰€æœ‰çš„æ–¹æ³•æ”¯æŒçš„å®ç°éƒ½åº”å½“åŒ¹é…ä¸‹è¿°çš„æ–¹æ³•å„è‡ªçš„è¯­ä¹‰å®šä¹‰ã€‚æ­¤å¤–ï¼Œé™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œç‰¹å®šçš„HTTPæœåŠ¡å™¨è¿˜èƒ½å¤Ÿæ‰©å±•è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚ä¾‹å¦‚ PATCHï¼ˆç”± RFC 5789 æŒ‡å®šçš„æ–¹æ³•ï¼‰ç”¨äºå°†å±€éƒ¨ä¿®æ”¹åº”ç”¨åˆ°èµ„æºã€‚</li>
<li>GET æäº¤çš„æ•°æ®å¤§å°æœ‰é™åˆ¶ï¼ˆå› ä¸ºæµè§ˆå™¨å¯¹ URL çš„é•¿åº¦æœ‰é™åˆ¶ï¼‰ï¼Œè€Œ POST æ–¹æ³•æäº¤çš„æ•°æ®æ²¡æœ‰é™åˆ¶.</li>
</ol>
</blockquote>
<h4>çŠ¶æ€ç </h4>
<p>HTTP çŠ¶æ€ç è´Ÿè´£è¡¨ç¤ºå®¢æˆ·ç«¯ HTTP è¯·æ±‚çš„è¿”å›ç»“æœã€æ ‡è®°æœåŠ¡å™¨ç«¯å¤„ç†æ˜¯å¦æ­£å¸¸ã€é€šçŸ¥å‡ºç°çš„é”™è¯¯ç­‰å·¥ä½œã€‚HTTP çŠ¶æ€ç è¢«åˆ†æˆäº†â€œäº”â€å¤§ç±»ï¼Œä¸åŒçš„ç±»å‹ä»£è¡¨ä¸åŒç±»åˆ«çš„çŠ¶æ€ç ã€‚</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€ç </th>
<th>ç±»åˆ«</th>
<th>åŸå› çŸ­è¯­</th>
</tr>
</thead>
<tbody>
<tr>
<td>1XX</td>
<td>Informationï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</td>
<td>è¡¨ç¤ºæ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†</td>
</tr>
<tr>
<td>2XX</td>
<td>Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td>è¡¨ç¤ºè¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•</td>
</tr>
<tr>
<td>3XX</td>
<td>Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td>è¡¨ç¤ºéœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚</td>
</tr>
<tr>
<td>4XX</td>
<td>Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td>è¡¨ç¤ºæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td>
</tr>
<tr>
<td>5XX</td>
<td>Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯ç ï¼‰</td>
<td>è¡¨ç¤ºæœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™</td>
</tr>
</tbody>
</table>
<p>æ›´å…·ä½“çš„çŠ¶æ€ç ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3833fd464b48e6b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
<img src="https://upload-images.jianshu.io/upload_images/5128488-93daefc198269fa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
<img src="https://upload-images.jianshu.io/upload_images/5128488-33c89a13338fcc8e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>å‚è€ƒæ–‡ç« </h3>
<ul>
<li><a href="https://www.cnblogs.com/xiaohuochai/p/6156435.html">å‰ç«¯å­¦ HTTP ä¹‹æŠ¥æ–‡èµ·å§‹è¡Œ</a></li>
<li><a href="https://www.cnblogs.com/an-wen/p/11180076.html">HTTP åè®®è¶…çº§è¯¦è§£</a></li>
</ul>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/208">Ajax ä¹‹ GETã€POST è¯·æ±‚æ–¹å¼</a></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[äºŒã€HTTP Content-Type è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/206</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/206</guid>
            <pubDate>Sun, 26 Feb 2023 09:43:13 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº†ï¼š<a href="https://github.com/toFrankie/blog/issues/205">æ‰€è°“â€œç¥ç§˜â€çš„ XMLHttpRequest å¯¹è±¡</a></p>
<p>ä¹‹å‰å†™ JavaScript æ—¶ï¼Œå¹¶æ²¡æœ‰ç‰¹æ„å»æ•´ç†è¿‡ç±»ä¼¼çš„çŸ¥è¯†ç‚¹ï¼Œæœ¬æ–‡æ•´ç†è®°å½•ä¸‹ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥é˜…ã€‚</p>
<h4>ä»€]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº†ï¼š<a href="https://github.com/toFrankie/blog/issues/205">æ‰€è°“â€œç¥ç§˜â€çš„ XMLHttpRequest å¯¹è±¡</a></p>
<p>ä¹‹å‰å†™ JavaScript æ—¶ï¼Œå¹¶æ²¡æœ‰ç‰¹æ„å»æ•´ç†è¿‡ç±»ä¼¼çš„çŸ¥è¯†ç‚¹ï¼Œæœ¬æ–‡æ•´ç†è®°å½•ä¸‹ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥é˜…ã€‚</p>
<h4>ä»€ä¹ˆæ˜¯ Content-Type ï¼Ÿ</h4>
<p>Media-Typeï¼Œå³æ˜¯ Internet Media Typeï¼Œäº’è”ç½‘åª’ä½“ç±»å‹ï¼Œä¹Ÿå«åš MIME ç±»å‹ã€‚åœ¨äº’è”ç½‘ä¸­æœ‰æˆç™¾ä¸Šåƒç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼ŒHTTP åœ¨ä¼ è¾“æ•°æ®å¯¹è±¡æ—¶ä¼šä¸ºä»–ä»¬æ‰“ä¸Šç§°ä¸º MIME çš„æ•°æ®æ ¼å¼æ ‡ç­¾ï¼Œç”¨äºåŒºåˆ†æ•°æ®ç±»å‹ã€‚æœ€åˆ MIME æ˜¯ç”¨äºç”µå­é‚®ä»¶ç³»ç»Ÿçš„ï¼Œåæ¥ HTTP ä¹Ÿé‡‡ç”¨äº†è¿™ä¸€æ–¹æ¡ˆã€‚</p>
<p><strong>Content-Type æ ¼å¼ï¼š<code>Content-Type: [type]/[subtype]; parameter</code></strong></p>
<ul>
<li>typeï¼šä¸»ç±»å‹ï¼Œä»»æ„çš„å­—ç¬¦ä¸²ï¼Œå¦‚ <code>text</code>ï¼Œå¦‚æœæ˜¯ <code>*</code> è¡¨ç¤ºæ‰€æœ‰ã€‚</li>
<li>subtypeï¼šå­ç±»å‹ï¼Œç”¨äºæŒ‡å®š type çš„è¯¦ç»†å½¢å¼ï¼Œä»»æ„çš„å­—ç¬¦ä¸²ï¼Œå¦‚ <code>html</code>ï¼ŒåŒæ · <code>*</code> è¡¨ç¤ºæ‰€æœ‰ï¼Œç”¨ <code>/</code> ä¸ä¸»ç±»å‹éš”å¼€ã€‚</li>
<li>parameterï¼šå¯é€‰å‚æ•°ï¼Œå¦‚ charsetã€boundary ç­‰ã€‚</li>
</ul>
<blockquote>
<p>å¦‚ï¼šContent-Type: text/html; charset:utf-8</p>
</blockquote>
<h4>å¸¸ç”¨ type</h4>
<ul>
<li>Textï¼šç”¨äºæ ‡å‡†åŒ–åœ°è¡¨ç¤ºçš„æ–‡æœ¬ä¿¡æ¯ï¼Œæ–‡æœ¬æ¶ˆæ¯å¯ä»¥æ˜¯å¤šç§å­—ç¬¦ä¸²é›†åˆæˆ–è€…å¤šç§æ ¼å¼çš„é›†åˆï¼›</li>
<li>Multipartï¼šç”¨äºè¿æ¥æ¶ˆæ¯ä½“çš„å¤šä¸ªéƒ¨åˆ†æ„æˆä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™äº›éƒ¨åˆ†å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„æ•°æ®ï¼›</li>
<li>Applicationï¼šç”¨äºä¼ è¾“è¥è¿ç¨‹åºæ•°æ®æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼›</li>
<li>Messageï¼šç”¨äºåŒ…è£…ä¸€ä¸ª Email æ¶ˆæ¯ï¼›</li>
<li>Imageï¼šç”¨äºä¼ è¾“é™æ€å›¾ç‰‡æ•°æ®ï¼›</li>
<li>Audioï¼š ç”¨äºä¼ è¾“éŸ³é¢‘æˆ–è€…éŸ³å£°æ•°æ®ï¼›</li>
<li>Videoï¼šç”¨äºä¼ è¾“åŠ¨æ€å½±åƒæ•°æ®ï¼Œå¯ä»¥æ˜¯ä¸éŸ³é¢‘ç¼–è¾‘å’‹ä¸€èµ·çš„è§†é¢‘æ•°æ®æ ¼å¼ã€‚</li>
</ul>
<h4>å¸¸ç”¨ subtype</h4>
<p>ä¸ºäº†ç¡®ä¿è¿™äº›å€¼å†ä¸€ä¸ªæœ‰åºè€Œä¸”å…¬å¼€çš„çŠ¶æ€ä¸‹å¼€å‘ï¼ŒMIME ä½¿ç”¨ Internet Assigned Numbers Authorityï¼ˆIANAï¼‰ä½œä¸ºä¸­å¿ƒçš„æ³¨å†Œæœºåˆ¶æ¥ç®¡ç†è¿™äº›å€¼ã€‚å¸¸ç”¨çš„æœ‰å¦‚ä¸‹è¿™äº›ï¼š</p>
<ul>
<li>
<p>text/plainï¼šçº¯æ–‡æœ¬</p>
</li>
<li>
<p>text/htmlï¼šHTML æ–‡æ¡£</p>
</li>
<li>
<p>text/xmlï¼šXML æ–‡æ¡£</p>
</li>
<li>
<p>image/gifï¼šGIF å›¾åƒ</p>
</li>
<li>
<p>image/jpegï¼šJPEG å›¾åƒï¼ˆæ³¨æ„ï¼šJPG ä¸ JPEG æ²¡åŒºåˆ«ï¼Œåªæ˜¯ <code>.jpg</code> çš„å†™æ³•æ›´æµè¡Œè€Œå·²ï¼‰ï¼ˆPHP ä¸­ä¸º image/pjpegï¼‰</p>
</li>
<li>
<p>image/pngï¼šPNG å›¾åƒï¼ˆPHP ä¸­ä¸º image/x-pngï¼‰</p>
</li>
<li>
<p>video/mpegï¼šMPEG åŠ¨ç”»</p>
</li>
<li>
<p>message/rfc822ï¼š<a href="https://tools.ietf.org/html/rfc822">RFC 822</a> å½¢å¼</p>
</li>
<li>
<p>application/octet-streamï¼šä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®</p>
</li>
<li>
<p>application/pdfï¼šPDF æ–‡æ¡£</p>
</li>
<li>
<p>application/xhtml+xmlï¼šXHTML æ–‡æ¡£</p>
</li>
<li>
<p>application/mswordï¼šMicrosoft Word æ–‡ä»¶</p>
</li>
<li>
<p>application/x-www-form-urlencodedï¼šä½¿ç”¨ HTTP çš„ POST æ–¹å¼æäº¤çš„è¡¨å•ï¼Œ<form encType="">ä¸­é»˜è®¤çš„encType</p>
</li>
<li>
<p>application/jsonï¼šJSON æ•°æ®æ ¼å¼</p>
</li>
<li>
<p>multipart/form-dataï¼šç”¨äºæäº¤åŒ…å«æ–‡ä»¶ã€éASCIIæ•°æ®å’ŒäºŒè¿›åˆ¶æ•°æ®çš„è¡¨å•ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ </p>
</li>
<li>
<p>multipart/alternativeï¼šHTML é‚®ä»¶çš„ HTML å½¢å¼å’Œçº¯æ–‡æœ¬å½¢å¼ï¼Œç›¸åŒå†…å®¹ä½¿ç”¨ä¸åŒçš„å½¢å¼è¡¨ç¤º</p>
</li>
</ul>
<p><strong>é™„ï¼š</strong><a href="https://tool.oschina.net/commons?type=22013-05-17">Content-Type å¯¹ç…§è¡¨</a></p>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/207">HTTP åè®®</a></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸€ã€æ‰€è°“â€œç¥ç§˜â€çš„ XMLHttpRequest å¯¹è±¡]]></title>
            <link>https://github.com/toFrankie/blog/issues/205</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/205</guid>
            <pubDate>Sun, 26 Feb 2023 09:35:03 GMT</pubDate>
            <description><![CDATA[<h3>èƒŒæ™¯</h3>
<p>åœ¨ 1999 å¹´ï¼Œå¾®è½¯å‘å¸ƒ IE5ï¼Œç¬¬ä¸€æ¬¡å¼•å…¥äº†æ–°åŠŸèƒ½ï¼šå…è®¸ JavaScript è„šæœ¬å‘æœåŠ¡å™¨å‘èµ· HTTP è¯·æ±‚ã€‚è¿™åŠŸèƒ½åœ¨å½“æ—¶å¹¶æ²¡æœ‰è¢«å¼•èµ·æ³¨æ„ï¼Œç›´åˆ° 2004 å¹´ Gmail å’Œ 2005 å¹´ Google Map çš„å‘å¸ƒï¼Œæ‰å¼•èµ·å¹¿æ³›çš„é‡è§†ã€‚åœ¨ 2005 å¹´ 2 æœˆï¼ŒAjax ï¼ˆ<co]]></description>
            <content:encoded><![CDATA[<h3>èƒŒæ™¯</h3>
<p>åœ¨ 1999 å¹´ï¼Œå¾®è½¯å‘å¸ƒ IE5ï¼Œç¬¬ä¸€æ¬¡å¼•å…¥äº†æ–°åŠŸèƒ½ï¼šå…è®¸ JavaScript è„šæœ¬å‘æœåŠ¡å™¨å‘èµ· HTTP è¯·æ±‚ã€‚è¿™åŠŸèƒ½åœ¨å½“æ—¶å¹¶æ²¡æœ‰è¢«å¼•èµ·æ³¨æ„ï¼Œç›´åˆ° 2004 å¹´ Gmail å’Œ 2005 å¹´ Google Map çš„å‘å¸ƒï¼Œæ‰å¼•èµ·å¹¿æ³›çš„é‡è§†ã€‚åœ¨ 2005 å¹´ 2 æœˆï¼ŒAjax ï¼ˆ<code>Asynchronous JavaScript And XML</code>ï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯ï¼š<code>å¼‚æ­¥çš„ JavaScript å’Œ XML</code> ï¼‰è¿™è¯ç¬¬ä¸€æ¬¡æå‡ºï¼ŒæŒ‡å›´ç»•è¿™ä¸ªåŠŸèƒ½è¿›è¡Œå¼€å‘çš„ä¸€æ•´å¥—åšæ³•ã€‚æ­¤åï¼ŒAjax æˆä¸ºè„šæœ¬å‘èµ· HTTP é€šä¿¡çš„ä»£åè¯ï¼ŒW3C ä¹Ÿåœ¨ 2006 å¹´å‘å¸ƒäº†å®ƒçš„å›½é™…æ ‡å‡†ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯ XHR å¯¹è±¡</h3>
<p>XHR æ˜¯ <code>XMLHttpRequest</code> çš„ç®€ç§°ã€‚è¿™æ˜¯å¾®è½¯é¦–å…ˆå¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…¶ä»–æµè§ˆå™¨æä¾›å•†åæ¥éƒ½æä¾›äº†ç›¸åŒçš„å®ç°ã€‚XHR ä¸ºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚å’Œè§£ææœåŠ¡å™¨å“åº”æä¾›äº†æµç•…çš„æ¥å£ï¼Œèƒ½å¤Ÿä»¥å¼‚æ­¥æ–¹å¼ä»æœåŠ¡å™¨å–å¾—æ›´å¤šä¿¡æ¯ï¼Œæ„å‘³ç€ç”¨æˆ·å•å‡»åï¼Œå¯ä»¥ä¸å¿…åˆ·æ–°é¡µé¢ä¹Ÿèƒ½å–å¾—æ–°æ•°æ®ã€‚</p>
<h3>ä¸€ã€åˆ›å»º XHR</h3>
<p>IE5æ˜¯ç¬¬ä¸€æ¬¾å¼•å…¥ XHR å¯¹è±¡çš„æµè§ˆå™¨ï¼Œ åœ¨ IE5ä¸­ï¼Œ XHR å¯¹è±¡æ˜¯é€šè¿‡ MSXML åº“ä¸­çš„ä¸€ä¸ª ActiveX å¯¹è±¡å®ç°çš„ï¼Œè€Œ IE7+ åŠå…¶ä»–æ ‡å‡†æµè§ˆå™¨éƒ½æ”¯æŒåŸç”Ÿçš„ XHR å¯¹è±¡ã€‚</p>
<pre><code class="language-js">let xhr
if (window.XMLHttpRequest) {
  xhr = new window.XMLHttpRequest()
} else {
  // IE5, IE6
  xhr = new ActiveXObject('Microsort.XMLHTTP')
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœè¦å»ºç«‹ N ä¸ªä¸åŒçš„è¯·æ±‚ï¼Œå°±è¦ä½¿ç”¨ N ä¸ªä¸åŒçš„ XHR å¯¹è±¡ã€‚å½“ç„¶å¯ä»¥é‡ç”¨å·²å­˜åœ¨çš„ XHR å¯¹è±¡ï¼Œä½†è¿™ä¼šç»ˆæ­¢ä¹‹å‰é€šè¿‡è¯¥å¯¹è±¡æŒ‚èµ·çš„ä»»ä½•è¯·æ±‚ã€‚</p>
</blockquote>
<h3>äºŒã€å‘é€è¯·æ±‚</h3>
<p>å‘é€è¯·æ±‚çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ open å’Œ send ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<h4>open</h4>
<p>åœ¨ä½¿ç”¨ XHR å¯¹è±¡æ—¶ï¼Œè¦è°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ <code>open()</code> ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ 3 ä¸ªå‚æ•°ï¼›</p>
<pre><code class="language-js">// xhr.open(method, url, async)
xhr.open('GET', 'example.php', false)
</code></pre>
<ul>
<li><strong>method</strong>ï¼šå³æŒ‡å®šå‘é€è¯·æ±‚çš„æ–¹å¼ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†é€šå¸¸ä½¿ç”¨å¤§å†™å­—æ¯ã€‚å¦‚ <code>GET</code>ã€<code>POST</code>ã€‚è¿˜å¯ä»¥æ˜¯ <code>HEAD</code>ã€<code>OPTIONS</code>ã€<code>PUT</code>ã€‚è€Œç”±äºå®‰å…¨é£é™©çš„åŸå› ï¼Œ<code>CONNECT</code>ã€<code>TRACE</code>ã€<code>TRACK</code> è¢«ç¦æ­¢ä½¿ç”¨ã€‚ï¼ˆ <a href="https://www.cnblogs.com/xiaohuochai/p/6156435.html">å…³äºHTTPåè®®8ç§å¸¸ç”¨æ–¹æ³•çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡Œ</a>ï¼‰</li>
<li><strong>url</strong>ï¼šæ‰€è¦è¯·æ±‚ URLï¼Œè¯¥ URLç›¸å¯¹äºæ‰§è¡Œä»£ç çš„å½“å‰é¡µé¢ï¼Œä¸”<strong>åªèƒ½</strong>å‘<strong>åŒä¸€ä¸ªåŸŸä¸­</strong>ä½¿ç”¨<strong>ç›¸åŒç«¯å£</strong>å’Œ<strong>åè®®</strong>çš„ URL å‘é€è¯·æ±‚ã€‚å¦‚æœ URL ä¸å¯åŠ¨è¯·æ±‚çš„é¡µé¢æœ‰ä»»ä½•å·®åˆ«ï¼Œéƒ½ä¼šå¼•å‘å®‰å…¨é”™è¯¯ã€‚</li>
<li><strong>async</strong>ï¼šè¡¨ç¤ºæ˜¯å¦å¼‚æ­¥å‘é€è¯·æ±‚ï¼Œå¸ƒå°”ç±»å‹ï¼ˆ<code>true</code> è¡¨ç¤ºå¼‚æ­¥ï¼Œ<code>false</code> è¡¨ç¤ºåŒæ­¥ï¼‰ã€‚å¦‚æœä¸å¡«å†™ï¼Œé»˜è®¤ <code>true</code>ï¼Œè¡¨ç¤ºå¼‚æ­¥å‘é€ã€‚</li>
<li>å¦‚æœè¯·æ±‚ä¸€ä¸ªå—å¯†ç ä¿æŠ¤çš„ URLï¼ŒæŠŠç”¨äºè®¤è¯çš„ç”¨æˆ·åå’Œå¯†ç ä½œä¸ºç¬¬ 4 ä¸ªå’Œ ç¬¬ 5 ä¸ªå‚æ•°ä¼ é€’ç»™ <code>open()</code> æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å¦‚æœæ¥æ”¶çš„æ˜¯åŒæ­¥å“åº”ï¼Œåˆ™éœ€è¦å°† <code>open()</code> æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º <code>false</code>ï¼Œé‚£ä¹ˆ <code>send()</code> æ–¹æ³•å°†é˜»å¡ç›´åˆ°è¯·æ±‚å®Œæˆã€‚</p>
<p>åŒæ­¥è¯·æ±‚æ˜¯å¸å¼•äººçš„ï¼Œä½†åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ã€‚å®¢æˆ·ç«¯ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œå½“ <code>send()</code> æ–¹æ³•é˜»å¡æ—¶ï¼Œä»–é€šå¸¸ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢å†»ç»“ã€‚å¦‚æœè¿æ¥çš„æœåŠ¡å™¨å“åº”æ…¢ï¼Œé‚£ä¹ˆç”¨æˆ·çš„æµè§ˆå™¨çœ‹èµ·æ¥åƒâ€œå‡æ­»â€çŠ¶æ€ã€‚</p>
</blockquote>
<h4>send</h4>
<p><code>send()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³è¦ä½œä¸ºè¯·æ±‚ä¸»ä½“å‘é€çš„æ•°æ®ã€‚è°ƒç”¨ send() æ–¹æ³•åï¼Œè¯·æ±‚è¢«åˆ†æ´¾åˆ°æœåŠ¡å™¨ã€‚</p>
<ul>
<li>å¦‚æœ <code>GET</code> è¯·æ±‚ï¼Œ <code>send()</code> æ–¹æ³•<strong>æ— å‚æ•°ï¼Œæˆ–è€…å‚æ•°ä¸º <code>null</code></strong>ï¼›</li>
<li>å¦‚æœ <code>POST</code> è¯·æ±‚ï¼Œ<code>send()</code> æ–¹æ³•å‚æ•°ä¸º<strong>è¦å‘é€çš„æ•°æ®ï¼Œå­—ç¬¦ä¸²ç±»å‹</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦åºåˆ—åŒ–ã€‚</li>
</ul>
<pre><code class="language-js">xhr.open('GET', 'example.php', false)
xhr.send(null)
</code></pre>
<h3>ä¸‰ã€æ¥æ”¶å“åº”</h3>
<p>ä¸€ä¸ªå®Œæ•´çš„ HTTP å“åº”ç”±çŠ¶æ€ç ã€å“åº”å¤´é›†åˆã€å“åº”ä¸»ä½“ç»„æˆã€‚åœ¨æ”¶åˆ°å“åº”åï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡ XHR å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä½¿ç”¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 4 ä¸ªå±æ€§ï¼š</p>
<ul>
<li><strong>responseText</strong>ï¼šä½œä¸ºå“åº”ä¸»ä½“è¢«è¿”å›çš„æ–‡æœ¬ï¼ˆæ–‡æœ¬å½¢å¼ï¼‰ï¼›</li>
<li><strong>responseXML</strong>ï¼šå¦‚æœå“åº”çš„å†…å®¹æ˜¯ <code>text/xml</code> æˆ– <code>application/xml</code>ï¼Œè¿™ä¸ªå±æ€§ä¸­å°†ä¿å­˜è¿™å“åº”æ•°æ®çš„ XML DOM æ–‡æ¡£ï¼ˆdocument å½¢å¼ï¼‰</li>
<li><strong>status</strong>ï¼šHTTP çŠ¶æ€ç ï¼ˆæ•°å­—å½¢å¼ï¼‰</li>
<li><strong>statusText</strong>ï¼šHTTP çŠ¶æ€è¯´æ˜ï¼ˆæ–‡æœ¬å½¢å¼ï¼‰</li>
</ul>
<p>åœ¨æ¥æ”¶åˆ°å“åº”ä¹‹åï¼Œç¬¬ä¸€æ­¥æ˜¯æ£€æµ‹ status å±æ€§ï¼Œä»¥ç¡®å®šå“åº”å·²ç»æˆåŠŸè¿”å›ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥å°† HTTPçŠ¶æ€ç ä¸º 200 ä½œä¸ºæˆåŠŸçš„æ ‡å¿—ã€‚æ­¤æ—¶ï¼ŒresponseText å±æ€§çš„å†…å®¹å·²ç»å°±ç»ªï¼Œè€Œä¸”åœ¨å†…å®¹ç±»å‹æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œ responseXML ä¹Ÿå¯ä»¥è®¿é—®äº†ã€‚æ­¤å¤–ï¼ŒçŠ¶æ€ç ä¸º 304 è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨ä¸­çš„ç¼“å­˜ç‰ˆæœ¬ã€‚å½“ç„¶ï¼Œä¹Ÿæ„å‘³ç€å“åº”æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ— è®ºå†…å®¹ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå“åº”ä¸»ä½“çš„å†…å®¹éƒ½ä¼šä¿å­˜åˆ° responseText å±æ€§ä¸­ï¼Œè€Œå¯¹äºé XML æ•°æ®è€Œå·²ï¼ŒresponseXML å±æ€§çš„å€¼å°†ä¸º nullã€‚</p>
<pre><code class="language-js">// è¿™æ˜¯åŒæ­¥çš„æ–¹å¼ï¼Œï¼ˆå¼‚æ­¥åˆ™éœ€è¦ç›‘å¬ onreadystatechange äº‹ä»¶ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼‰
if ((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) || xhr.status == 304) {
  alert(xhr.responseText)
} else {
  alert('request was unsuccessful: ' + xhr.status)
}
</code></pre>
<h3>å››ã€readyState</h3>
<p>å½“å‘é€ä¸€ä¸ªè¯·æ±‚åï¼Œå®¢æˆ·ç«¯éœ€è¦ç¡®å®šè¿™ä¸ªè¯·æ±‚ä»€ä¹ˆæ—¶å€™ä¼šå®Œæˆï¼Œå› æ­¤ï¼ŒXHR å¯¹è±¡æä¾›äº† onreadystatechange äº‹ä»¶æœºåˆ¶æ¥æ•è·è¯·æ±‚çš„çŠ¶æ€ï¼Œç»§è€Œå®ç°å“åº”ã€‚</p>
<p>æ¯å½“ readyState æ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘ onreadystatechange äº‹ä»¶ã€‚readyState å±æ€§å­˜æœ‰ XHR çš„çŠ¶æ€ä¿¡æ¯ã€‚
readyState å­˜æœ‰ XHR çš„çŠ¶æ€ï¼Œä» 0 åˆ° 4 å‘ç”Ÿå˜åŒ–ã€‚</p>
<ul>
<li><strong>0 ï¼ˆUninitialized æœªåˆå§‹åŒ–ï¼‰ï¼šè¯·æ±‚æœªåˆå§‹åŒ–</strong>ï¼ˆæ­¤é˜¶æ®µç¡®è®¤XMLHttpRequestå¯¹è±¡æ˜¯å¦åˆ›å»ºï¼Œè¿˜æ²¡æœ‰è°ƒç”¨Â <code>open()</code> æ–¹æ³•ï¼‰</li>
<li><strong>1ï¼ˆLoading è½½å…¥ï¼‰ï¼šæœåŠ¡å™¨è¿æ¥å·²å»ºç«‹</strong>ï¼ˆæ­¤é˜¶æ®µè°ƒç”¨ open() æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶è°ƒç”¨ send() æ–¹æ³•å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼‰</li>
<li><strong>2ï¼ˆLoaded è½½å…¥å®Œæˆï¼‰ï¼šè¯·æ±‚å·²æ¥æ”¶</strong>ï¼ˆæ­¤é˜¶æ®µ send() æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œä¸”å·²æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„å“åº”æ•°æ®ã€‚ä½†è·å¾—çš„è¿˜åªæ˜¯æœåŠ¡ç«¯å“åº”çš„åŸå§‹æ•°æ®ï¼Œå¹¶ä¸èƒ½ç›´æ¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼‰</li>
<li><strong>3ï¼ˆInteractive äº¤äº’ï¼‰ï¼šè¯·æ±‚å¤„ç†ä¸­</strong>ï¼ˆæ­¤é˜¶æ®µè§£ææ¥æ”¶åˆ°çš„æœåŠ¡å™¨ç«¯å“åº”æ•°æ®ï¼Œå³æ ¹æ®æœåŠ¡å™¨ç«¯å“åº”å¤´éƒ¨è¿”å›çš„ MIME ç±»å‹æŠŠæ•°æ®è½¬æ¢æˆèƒ½é€šè¿‡ responseBodyï¼ŒresponseText æˆ– responseXML çš„å±æ€§å­˜å–çš„æ ¼å¼ï¼‰</li>
<li><strong>4ï¼ˆCompleted å®Œæˆï¼‰ï¼šè¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª</strong>ï¼ˆæ­¤é˜¶æ®µå“åº”å†…å®¹è§£æå®Œæˆï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è°ƒç”¨äº†ï¼‰</li>
</ul>
<pre><code class="language-js">// å¼‚æ­¥æ–¹å¼
xhr.onreadystatechange = function() {
  if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {
    alert('request was successful!')
  }
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šç†è®ºä¸Šï¼Œåªè¦ <code>readyState</code> å±æ€§å€¼å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡ <code>onreadystatechange</code> äº‹ä»¶ã€‚ä½†æ˜¯ä¸ºäº†ç¡®ä¿è·¨æµè§ˆå™¨çš„å…¼å®¹æ€§ï¼Œå¿…é¡»åœ¨è°ƒç”¨ <code>open()</code> ä¹‹å‰æŒ‡å®š <code>onreadystatechange</code> äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦åˆ™å°†æ— æ³•æ¥æ”¶ <code>readyState</code> å±æ€§ä¸º <code>0</code> å’Œ <code>1</code> çš„æƒ…å†µã€‚</p>
</blockquote>
<h3>äº”ã€è¶…æ—¶</h3>
<p>XHR å¯¹è±¡çš„ timeout å±æ€§ç­‰äºä¸€ä¸ªæ•´æ•°ï¼Œå•ä½æ¯«ç§’ï¼ˆmsï¼‰ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚çš„æœ€å¤§è¯·æ±‚æ—¶é—´ã€‚å³åœ¨å¤šå°‘æ¯«ç§’åï¼Œå¦‚æœè¯·æ±‚ä»ç„¶æ²¡æœ‰å¾—åˆ°ç»“æœï¼Œå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚<strong>è¯¥å±æ€§é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚</strong></p>
<p>å¦‚æœè¯·æ±‚è¶…æ—¶ï¼Œå°†ä¼šè§¦å‘ ontimeout äº‹ä»¶ã€‚</p>
<pre><code class="language-js">xhr.open('POST', 'example.php', true)
xhr.ontimeout = function () {
  console.log('The request timed out')
}
xhr.timeout = 1000
xhr.send()
</code></pre>
<blockquote>
<p>IE8 æµè§ˆå™¨ä¸æ”¯æŒè¯¥å±æ€§ã€‚</p>
</blockquote>
<h3>å…­ã€æœ€å</h3>
<p>åªè¦å¼„æ¸…æ¥šäº†æ•´ä¸ªè¿‡ç¨‹ï¼Œå°±ä¼šå‘ç°å…¶å®å®ƒå¹¶æ²¡æœ‰é‚£ä¹ˆç¥ç§˜ï¼Œå¯¹å§ã€‚
æ¦‚è€Œæ‹¬ä¹‹ï¼Œæ•´ä¸ª XHR å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥åŒ…æ‹¬å¦‚ä¸‹é˜¶æ®µï¼š<strong>åˆ›å»º â†’ åˆå§‹åŒ–è¯·æ±‚ â†’ å‘é€è¯·æ±‚ â†’ æ¥æ”¶æ•°æ® â†’ è§£ææ•°æ® â†’ å®Œæˆ</strong>ã€‚</p>
<pre><code class="language-js">// æ•´ä¸ªè¿‡ç¨‹
function httpRequest() {
  let xhr

  // åˆ›å»º xhr å¯¹è±¡
  if (window.XMLHttpRequest) {
    xhr = new window.XMLHttpRequest()
  } else {
    // ä¸ºäº†å…¼å®¹ IE5ã€IE6
    xhr = new ActiveXObject('Microsoft.XMLHTTP')
  }

  // å¼‚æ­¥æ–¹å¼å¿…é¡»é‡‡ç”¨ onreadystatechange æ¥ç›‘å¬
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) {
      alert('The request was successful! ' + xhr.responseText)
      // handle statements...
    }
  }

  // è®¾ç½®è¶…æ—¶å¤„ç†
  xhr.ontimeout = function () {
    alert('The request was timed out')
  }
  xhr.timeout = 3000

  xhr.open('POST', './test.ajax', true)

  // å¦‚éœ€è®¾ç½® HTTP è¯·æ±‚å¤´ï¼Œå¿…é¡»åœ¨ open() ä¹‹åã€send() ä¹‹å‰è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š
  // xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencode');

  // åºåˆ—åŒ–
  xhr.send(JSON.stringify({ name: 'test' }))
}

httpRequest()
</code></pre>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/206">HTTP Content-Typeè¯¦è§£</a></p>
<hr>
<p><strong>å‚è€ƒæ–‡ç« </strong></p>
<ul>
<li><a href="https://www.cnblogs.com/xiaohuochai/p/6036475.html">æ·±å…¥ç†è§£ Ajax ç³»åˆ—ç¬¬ä¸€ç¯‡ä¹‹ XHR å¯¹è±¡</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">MDN web docs ä¹‹ XMLHttpRequest</a></li>
</ul>
<p><strong>è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜</strong></p>
<ul>
<li><a href="https://blog.csdn.net/sky786905664/article/details/53079487">å…³äº chrome æ§åˆ¶å°è­¦å‘Šï¼šSynchronous XMLHttpRequest on the main threadç»ˆæè§£å†³åŠæ³•</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript ç®—æ³•æœ‰å“ªäº›ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/203</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/203</guid>
            <pubDate>Sun, 26 Feb 2023 09:33:34 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€ç®—æ³•ä¼˜åŠ£è¯„åˆ¤</h3>
<ul>
<li><strong>ç¨³å®š</strong>ï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a = bï¼Œæ’åºä¹‹å a ä»ç„¶åœ¨ b çš„å‰é¢ï¼›</li>
<li><strong>ä¸ç¨³å®š</strong>ï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a = bï¼Œæ’åºä¹‹å a å¯èƒ½ä¼šå‡ºç°åœ¨ b çš„åé¢ï¼›<]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€ç®—æ³•ä¼˜åŠ£è¯„åˆ¤</h3>
<ul>
<li><strong>ç¨³å®š</strong>ï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a = bï¼Œæ’åºä¹‹å a ä»ç„¶åœ¨ b çš„å‰é¢ï¼›</li>
<li><strong>ä¸ç¨³å®š</strong>ï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a = bï¼Œæ’åºä¹‹å a å¯èƒ½ä¼šå‡ºç°åœ¨ b çš„åé¢ï¼›</li>
</ul>
<hr/>
<ul>
<li><strong>å†…æ’åº</strong>ï¼šæ‰€æœ‰æ’åºæ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼›</li>
<li><strong>å¤–æ’åº</strong>ï¼šç”±äºæ•°æ®å¤ªå¤§ï¼Œå› æ­¤æŠŠæ•°æ®æ”¾åœ¨ç£ç›˜ï¼Œè€Œæ’åºé€šè¿‡ç£ç›˜å’Œå†…å­˜ä¸­çš„æ•°æ®æ‰èƒ½è¿›è¡Œæ’åº</li>
</ul>
<hr/>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šä¸€ä¸ªç®—æ³•æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼›</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šè¿è¡Œå®Œä¸€ä¸ªç®—æ³•æ‰€éœ€å†…å­˜çš„å¤§å°ï¼›</li>
</ul>
<h3>äºŒã€æ’åºç®—æ³•</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-37adf60eb748bb90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>ä¸‰ã€æ—¶é—´å¤æ‚åº¦çš„æ¨å¯¼</h3>
<p>ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯è¡¨ç¤ºç®—æ³•æ‰€æ¶ˆè€—æ—¶é—´å¤§å°çš„é‡åº¦ï¼Œé€šå¸¸ä½¿ç”¨ <code>å¤§ O è¡¨ç¤ºæ³•</code> æ¥å»ºç«‹æ•°å­¦æ¨¡å‹ï¼Œå³ <code>O(f(n))</code>ï¼Œéšç€ <code>n</code> çš„æ•°å€¼å¢å¤§ï¼Œ<code>O(f(n))</code> çš„æ•°å€¼å¢é•¿çš„è¶Šæ…¢å°±è¶Šæ˜¯æ—¶é—´å¤æ‚åº¦ä½çš„ç®—æ³•ã€‚</p>
<ol>
<li>ç”¨å¸¸æ•° <code>1</code> å–ä»£è¿è¡Œæ—¶é—´ä¸­çš„æ‰€æœ‰åŠ æ³•å¸¸æ•°ã€‚</li>
<li>åœ¨ä¿®æ”¹åçš„è¿è¡Œæ¬¡æ•°å‡½æ•°ä¸­ï¼Œåªä¿ç•™æœ€é«˜é˜¶é¡¹ã€‚</li>
<li>å¦‚æœæœ€é«˜é˜¶é¡¹å­˜åœ¨ä¸”ä¸æ˜¯<code>1</code>ï¼Œåˆ™å»é™¤ä¸è¿™ä¸ªé¡¹ç›¸ä¹˜çš„å¸¸æ•°ã€‚å¾—åˆ°çš„ç»“æœå°±æ˜¯å¤§ <code>O</code> é˜¶ã€‚</li>
</ol>
<p>ï¼ˆå¦‚æŸä¸€æ­¥ä¸å­˜åœ¨ï¼Œå¿½ç•¥è¯¥æ­¥ï¼‰</p>
<h3>å‚è€ƒæ–‡ç« </h3>
<ul>
<li><a href="https://www.cnblogs.com/ybygb-geng/p/9355425.html">js åå¤§æ’åºç®—æ³•ï¼šå†’æ³¡æ’åº</a></li>
<li><a href="https://www.cnblogs.com/aimeeblogs/articles/9502050.html">js åå¤§æ’åºç®—æ³•è¯¦è§£</a></li>
<li><a href="https://www.cnblogs.com/zaking/p/9085240.html">js ç®—æ³•åˆçª¥ 07ï¼ˆç®—æ³•å¤æ‚åº¦ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Array.prototype.sort ä½ çœŸçš„æŒæ¡äº†å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/202</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/202</guid>
            <pubDate>Sun, 26 Feb 2023 09:24:46 GMT</pubDate>
            <description><![CDATA[<p>åœ¨é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œå¯¹æ•°ç»„çš„æ’åºè‚¯å®šå°‘ä¸äº†ï¼Œç±»ä¼¼çš„å‡åºæ’åºè‚¯å®šéƒ½è§è¿‡ã€‚</p>
<pre><code class="language-js">const array = [2, 7, 4, 9, 3]
array.sort((a, b) =&gt; a - b)
// å‡åºæ’åˆ—ï¼š[2, 3, 4, 7, 9]
</c]]></description>
            <content:encoded><![CDATA[<p>åœ¨é¡¹ç›®å¼€å‘å½“ä¸­ï¼Œå¯¹æ•°ç»„çš„æ’åºè‚¯å®šå°‘ä¸äº†ï¼Œç±»ä¼¼çš„å‡åºæ’åºè‚¯å®šéƒ½è§è¿‡ã€‚</p>
<pre><code class="language-js">const array = [2, 7, 4, 9, 3]
array.sort((a, b) =&gt; a - b)
// å‡åºæ’åˆ—ï¼š[2, 3, 4, 7, 9]
</code></pre>
<p>å¯ä½ åˆè¿½ç©¶è¿‡ <strong>sort()</strong> é‡Œé¢æ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿ</p>
<p><code>sort()</code> æ–¹æ³•ç”¨ <a href="https://en.wikipedia.org/wiki/In-place_algorithm">åŸåœ°ç®—æ³•</a> å¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œå¹¶è¿”å›æ•°ç»„ã€‚é»˜è®¤æ’åºé¡ºåºæ˜¯åœ¨å°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åä¼šæŒ‰ç…§è½¬æ¢ä¸ºçš„å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦çš„ Unicode ä½ç‚¹è¿›è¡Œæ’åºã€‚</p>
<blockquote>
<p>è¯­æ³•ï¼š<code>array.sort([compareFunction])</code>ï¼Œå‚æ•°å¯é€‰ã€‚</p>
</blockquote>
<p>å‡€çœ‹æ¦‚ç‡ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹éš¾ç†è§£ï¼Œç„¶åä¸‹é¢ç»“åˆä»£ç ç†è§£ã€‚</p>
<h3>ä¸€ã€æ²¡æœ‰å‚æ•°</h3>
<pre><code class="language-js">// 1. æ²¡é—®é¢˜
const arr1 = [5, 3, 8, 2, 0, -3]
arr1.sort() // output: [-3, 0, 2, 3, 5, 8]

// 2. ä¹Ÿæ²¡é—®é¢˜
const arr2 = ['m', 'c', 'h', 'd']
arr2.sort() // output: [&quot;c&quot;, &quot;d&quot;, &quot;h&quot;, &quot;m&quot;]

// 3. ä¼¼ä¹è·Ÿé¢„æƒ³çš„ä¸ä¸€æ ·å•Šï¼å°æœ‹å‹ä½ æ˜¯å¦æœ‰å¾ˆå¤šé—®å· â“â“â“
const arr3 = [-2, 27, 0, -5, 4]
arr3.sort() // output: [-2, -5, 0, 27, 4]
</code></pre>
<p>ä¸ºä»€ä¹ˆ <code>arr3</code> è¿›è¡Œæ’åºä¹‹åï¼Œè¿”å›çš„ä¸ºä»€ä¹ˆä¸æ˜¯ <code>[-2, -5, 0, 4, 27]</code> å‘¢ï¼Ÿ</p>
<p>ç»“åˆæ¦‚å¿µæ¥çœ‹ï¼Œå…¶å®å°±æ²¡é‚£ä¹ˆéš¾ç†è§£äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ²¡ä¼ å‚æ•°ï¼Œå³é‡‡ç”¨<strong>é»˜è®¤æ’åº</strong>æ–¹å¼ï¼Œå®ƒä¼šå°†<strong>æ¯ä¸€ä¸ªå…ƒç´ </strong>è½¬åŒ–ä¸º<strong>å­—ç¬¦ä¸²</strong>ï¼Œæ¥ç€æŒ‰ç…§å­—ç¬¦ä¸²çš„<strong>æ¯ä¸ªå­—ç¬¦</strong>çš„ Unicode ä½ç½®è¿›è¡Œæ’åºã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨æ¯”è¾ƒ <code>27</code> å’Œ <code>4</code> æ—¶ï¼Œå®ƒä¼šå…ˆæ¯”è¾ƒ <code>2</code> å’Œ <code>4</code> ï¼Œå‘ç° <code>2</code> çš„ Unicode é¡ºåºè¦æ¯” <code>4</code> é å‰ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœæ˜¯ <code>27</code> åœ¨ <code>4</code> ä¹‹å‰ã€‚åŒæ ·çš„é“ç†ï¼Œè´Ÿæ•°åœ¨å‰æ˜¯å› ä¸º  <code>-</code>  çš„ Unicode é¡ºåºæ›´é å‰ã€‚ï¼ˆé™„ <a href="https://tool.oschina.net/commons?type=4">ASCII å¯¹ç…§è¡¨</a>ï¼‰</p>
<h3>äºŒã€å¸¦å‚ï¼Œä¸”å¿…é¡»æ˜¯å‡½æ•°</h3>
<p>å…¶å®é»˜è®¤çš„æ’åºæ–¹å¼åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œå¾ˆå¤šä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„æ’åºè¦æ±‚ï¼Œæ‰€ä»¥ sort ä¹Ÿæä¾›äº†ä¸€ä¸ªå‚æ•° <code>comparFunction</code>ï¼Œæ¥æ»¡è¶³æˆ‘ä»¬çš„å„ç§éœ€æ±‚ã€‚</p>
<blockquote>
<p>array.sort(compareFunction(a, b))</p>
</blockquote>
<p>æŒ‡æ˜äº† <code>compareFunction</code>ï¼Œé‚£ä¹ˆæ•°ç»„ä¼šæŒ‰ç…§è¯¥å‡½æ•°çš„è¿”å›å€¼æ’åºï¼Œå³ <code>a</code> å’Œ <code>b</code> æ˜¯ä¸¤ä¸ªå°†è¦è¢«æ¯”è¾ƒçš„å…ƒç´ </p>
<ul>
<li>å¦‚æœ <code>compareFunction(a, b)</code> å°äº <code>0</code>ï¼Œé‚£ä¹ˆ <code>a</code> ä¼šè¢«æ’åˆ—åˆ° <code>b</code> ä¹‹å‰ï¼›</li>
<li>å¦‚æœ <code>compareFunction(a, b)</code> å¤§äº <code>0</code>ï¼Œé‚£ä¹ˆ <code>b</code> ä¼šæ’åˆ—åˆ° <code>a</code> ä¹‹å‰ï¼›</li>
<li>å¦‚æœ <code>compareFunction(a, b)</code> ç­‰äº <code>0</code>ï¼Œé‚£ä¹ˆ <code>a</code> å’Œ <code>b</code> çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚</li>
</ul>
<h3>ä¸‰ã€å‡ ç§æœ€å¸¸è§çš„æ’åºæ–¹å¼</h3>
<ol>
<li>å‡åºã€é™åºæ’åº</li>
</ol>
<pre><code class="language-js">// æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™ï¼Œæ¥å†™ä¸ªå‡åºæ’åºï¼Œé‚£å°± so easy äº†ï¼Œå¯¹å§
const array = [-2, 27, 0, -5, -4]
array.sort((a, b) =&gt; {
  if (a &gt; b) {
    return 1
  } else if (a &lt; b) {
    return -1
  } else {
    return 0
  }
})
console.log(array) // [-5, -2, 0, 4, 27]
// ç®€å†™
// array.sort((a, b) =&gt; a - b)

// é™åºä¹Ÿæ˜¯åŒç†
// array.sort((a, b) =&gt; b - a)
</code></pre>
<ol start="2">
<li>æ ¹æ®å¯¹è±¡æŸå±æ€§æ’åº</li>
</ol>
<pre><code class="language-js">const classroom = [
  {
    name: 'Frankie',
    age: 18
  },
  {
    name: 'Mandy',
    age: 16
  },
  {
    name: 'John',
    age: 22
  },
  {
    name: 'Ada',
    age: 20
  }
]

classroom.sort((a, b) =&gt; a.age - b.age)
console.log(classroom)
// [{&quot;name&quot;: &quot;Mandy&quot;, &quot;age&quot;: 16}, {&quot;name&quot;: &quot;Frankie&quot;, &quot;age&quot;: 18}, {&quot;name&quot;: &quot;Ada&quot;, &quot;age&quot;: 20}, {&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 22}]
</code></pre>
<ol start="3">
<li>æ ¹æ®å­—æ¯ A-Z æ’åº</li>
</ol>
<pre><code class="language-js">const array = ['fifa', 'nba', 'cbb', 'dnfa', 'cba', 'sos', 'dnf']
array.sort((a, b) =&gt; {
  let length = Math.max.apply(null, [a.length, b.length])
  for (let i = 0; i &lt; length; i++) {
    if (a[i] === undefined) {
      return -1
    } else if (b[i] === undefined) {
      return 1
    } else if (a.charCodeAt(i) &lt; b.charCodeAt(i)) {
      return -1
    } else if (a.charCodeAt(i) &gt; b.charCodeAt(i)) {
      return 1
    }
  }
  return 0
})
console.log(array)
// [&quot;cba&quot;, &quot;cbb&quot;, &quot;dnf&quot;, &quot;dnfa&quot;, &quot;fifa&quot;, &quot;nba&quot;, &quot;sos&quot;]
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å‰ç«¯å¦‚ä½•å®ç°è§†è§‰è®¾è®¡ç¨¿]]></title>
            <link>https://github.com/toFrankie/blog/issues/201</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/201</guid>
            <pubDate>Sun, 26 Feb 2023 09:23:54 GMT</pubDate>
            <description><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†å’Œå¤§å®¶æ¢è®¨ä¸€ä¸‹å…³äºå‰ç«¯åœ¨ç§»åŠ¨ç«¯å¼€å‘å¦‚ä½•å»å®ç°è§†è§‰è®¾è®¡ç¨¿ã€‚æ¢è®¨è¿‡åï¼Œåœ¨å¤§å®¶çš„å®é™…å·¥ä½œä¸­æˆ–è®¸èƒ½å¸®åŠ©è§£å†³ä¸€äº›é—®é¢˜ã€‚</p>
<h3>å‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦æ˜ç™½çš„ã€Œåƒç´ ã€</h3>
<p>ä¸€èˆ¬è®¾è®¡ç¨¿æ˜¯ <strong>640px</strong> æˆ–è€… <strong>750px</strong>ï¼ˆç°åœ¨æœ€æµè¡Œï¼‰ï¼Œä½†]]></description>
            <content:encoded><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­å°†å’Œå¤§å®¶æ¢è®¨ä¸€ä¸‹å…³äºå‰ç«¯åœ¨ç§»åŠ¨ç«¯å¼€å‘å¦‚ä½•å»å®ç°è§†è§‰è®¾è®¡ç¨¿ã€‚æ¢è®¨è¿‡åï¼Œåœ¨å¤§å®¶çš„å®é™…å·¥ä½œä¸­æˆ–è®¸èƒ½å¸®åŠ©è§£å†³ä¸€äº›é—®é¢˜ã€‚</p>
<h3>å‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦æ˜ç™½çš„ã€Œåƒç´ ã€</h3>
<p>ä¸€èˆ¬è®¾è®¡ç¨¿æ˜¯ <strong>640px</strong> æˆ–è€… <strong>750px</strong>ï¼ˆç°åœ¨æœ€æµè¡Œï¼‰ï¼Œä½†æ˜¯ iPhone 5 ä¸æ˜¯ 320px å®½å—ï¼ŒiPhone 6 ä¸æ˜¯ 375px å®½å—?
è¿™é‡Œéœ€è¦ç†è§£ä¸€ä¸‹åŸºç¡€æ¦‚å¿µï¼šÂ <strong>è®¾å¤‡åƒç´ </strong>(device pixel)ï¼Œ<strong>CSS åƒç´ </strong>(css pixel)ä»¥åŠ<strong>è®¾å¤‡åƒç´ æ¯”</strong>(device pixel ratio)ã€‚</p>
<ul>
<li>
<p>è®¾å¤‡åƒç´  (device pixel):
è®¾å¤‡åƒç´ è®¾æ˜¯ç‰©ç†æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯è®¾å¤‡ä¸­ä½¿ç”¨çš„ç‰©ç†åƒç´ ã€‚
æ¯”å¦‚ iPhone 5 çš„åˆ†è¾¨ç‡ <code>640 x 1136px</code>ã€‚</p>
</li>
<li>
<p>CSS åƒç´  (css pixel):
CSS åƒç´ æ˜¯ Web ç¼–ç¨‹çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ CSS æ ·å¼ä»£ç ä¸­ä½¿ç”¨çš„é€»è¾‘åƒç´ ã€‚
åœ¨ CSS è§„èŒƒä¸­ï¼Œé•¿åº¦å•ä½å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œç»å¯¹ (absolute) å•ä½ä»¥åŠç›¸å¯¹ (relative) å•ä½ã€‚pxæ˜¯ä¸€ä¸ªç›¸å¯¹å•ä½ï¼Œç›¸å¯¹çš„æ˜¯è®¾å¤‡åƒç´  (device pixel)ã€‚</p>
</li>
<li>
<p>è®¾å¤‡åƒç´ æ¯” (device pixel ratio):
å³ <code>window.devicePixelRatio</code>ï¼Œæ˜¯è®¾å¤‡ä¸Šç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´  (device-independent pixels (dips)) çš„æ¯”ä¾‹ã€‚
å…¬å¼è¡¨ç¤ºå°±æ˜¯ <code>window.devicePixelRatio = ç‰©ç†åƒç´  / dips</code></p>
</li>
</ul>
<p>å‚ç›´æ‰‹æœºå±å¹•ä¸‹ï¼Œä½¿ç”¨<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;/&gt;</code>ï¼ŒiPhone 5 å±å¹•ç‰©ç†åƒç´  640 åƒç´ ï¼Œç‹¬ç«‹åƒç´ è¿˜æ˜¯ 320 åƒç´ ï¼Œå› æ­¤ï¼Œ<code>window.devicePixelRatio</code> ç­‰äº 2ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eebe616f19503db6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¯”å¦‚ iPhone 5ï¼Œ6 ä½¿ç”¨çš„æ˜¯ Retina è§†ç½‘è†œå±å¹•ï¼ˆ2 å€å±ï¼‰ï¼Œ6 Plus æ˜¯ 3 å€å±ï¼Œä½¿ç”¨<code>2px Ã— 2px</code>çš„ device pixel ä»£è¡¨<code>1px Ã— 1px</code>çš„ css pixelï¼Œæ‰€ä»¥è®¾å¤‡åƒç´ æ•°ä¸º<code>640 Ã— 1136px</code>ï¼ˆ5ï¼‰ï¼Œ<code>750 Ã— 1134</code>ï¼ˆ6ï¼‰ï¼Œè€Œ CSS é€»è¾‘åƒç´ æ•°ä¸º <code>320 x 568px</code>ï¼ˆ5ï¼‰ï¼Œ<code>375 Ã— 667</code>ï¼ˆ6ï¼‰ï¼›5ï¼Œ6 çš„ window.devicePixelRatio=2ï¼Œ6 Plus ä¸º 3ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ffbba247649ec278.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>H5 é€‚é…ï¼šrem æ–¹æ¡ˆ
remï¼šæ˜¯ CSS3 æ–°å¢çš„ä¸€ä¸ªç›¸å¯¹å•ä½ï¼Œç›¸å¯¹äº html æ ‡ç­¾çš„ font-size çš„å¤§å°ä¸ºåŸºç¡€çš„ã€‚è€Œ font-size çš„å¤§å°å¯ä»¥åŠ¨æ€æ ¹æ®æ‰‹æœºå±å¹•å®½åº¦document.documentElement.clientWidth æ¥è®¾ç½®ï¼Œä»è€Œè¾¾åˆ°è‡ªé€‚åº”å±å¹•çš„ç›®çš„ã€‚</p>
<p>æˆ‘è¿™é‡Œæ‰¾äº†ä¸€ä¸‹<a href="https://m.mi.com/">å°ç±³</a>ï¼Œ<a href="http://3g.163.com/touch/">ç½‘æ˜“</a>ï¼Œ<a href="https://m.lagou.com/">æ‹‰å‹¾ç½‘</a>ï¼Œ<a href="https://m.taobao.com/">æ‰‹æ·˜</a>Â ä»¥åŠç³¯ç±³ï¼Œå¤§åŒå°å¼‚ã€‚</p>
<h4><a href="https://m.mi.com/">å°ç±³å®˜ç½‘</a></h4>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-29587ddb8d98c4c6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è®¾è®¡ç¨¿æ˜¯ 720px çš„ï¼Œå³ 5 è‹±å¯¸å±å¹•çš„å®‰å“æ‰‹æœºï¼ˆ720 x 1280pxï¼‰ã€‚
å¯¹äºé¡µé¢ç¼©æ”¾å’Œæ¨ªç«–å±äº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œæ”¹å˜ html æ ¹å…ƒç´ å­—ä½“ <code>clientWidth/720/100</code>ã€‚
å¦‚å›¾æ˜¯è¿™æ ·è®¡ç®—çš„ <code>375/(720/100) = 52.0833</code></p>
<h4><a href="http://3g.163.com/touch/">ç½‘æ˜“</a></h4>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-18c526dd3de7812d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2bc8dd6e8588396f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>iPhone 6 :Â <code>375/7.5=50</code>, åˆ™çŸ¥é“è®¾è®¡ç¨¿åº”è¯¥æ˜¯åŸºäº iPhone 6 æ¥çš„ï¼Œæ‰€ä»¥å®ƒçš„è®¾è®¡ç¨¿ç«–ç›´æ”¾æ—¶çš„æ¨ªå‘åˆ†è¾¨ç‡ä¸º 750pxï¼Œä¸ºäº†è®¡ç®—æ–¹ä¾¿ï¼Œå–ä¸€ä¸ª 100px çš„ font-size ä¸ºå‚ç…§ï¼Œé‚£ä¹ˆ body å…ƒç´ çš„å®½åº¦å°±å¯ä»¥è®¾ç½®ä¸º <code>width: 7.5rem</code>ï¼Œäºæ˜¯ html çš„ <code>font-size=deviceWidth / 7.5</code>ã€‚å¸ƒå±€æ—¶ï¼Œè®¾è®¡å›¾æ ‡æ³¨çš„å°ºå¯¸é™¤ä»¥ 100 å¾—åˆ° css ä¸­çš„å°ºå¯¸ã€‚å¹¶ä¸”å¸ƒå±€ä¸­çš„ <code>font-size</code> ä¹Ÿå¯ç”¨ <code>rem</code> å•ä½ã€‚</p>
<h4><a href="https://m.lagou.com/">æ‹‰å‹¾ç½‘</a></h4>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-631a457412efbb3e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-42a7136ed4a5f869.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code>html {
	font-size: 65.5%;
}
</code></pre>
<p>è®¾ç½®htmlæ ¹å…ƒç´ å­—ä½“ä¸º<code>65.5%</code>ï¼Œå¯¹åº”pxå•ä½åˆ™ä¸º<code>10.48px</code>ï¼Œåˆ™åˆ—è¡¨é‡Œæ—¶é—´ä¿¡æ¯å­—ä½“è®¾ç½®ä¸º<code>1rem = 10.48px</code>ï¼Œchromeåœ¨<code>-webkit-text-size-adjust: 100%;</code>æƒ…å†µä¸‹å°äº<code>12px</code>çš„ä¸€å¾‹æ˜¾ç¤ºä¸º<code>12px</code>ã€‚</p>
<p>æ‹‰å‹¾ç½‘é¡µé¢åˆ—è¡¨éƒ¨åˆ†æ˜¯<code>px</code>ä¸ºå•ä½ï¼Œå­—ä½“æ˜¯<code>rem</code>ï¼Œåº•éƒ¨baræ˜¯ä½¿ç”¨<code>ç™¾åˆ†ç™¾</code>æ¥æ§åˆ¶å®½é«˜é—´è·ã€‚</p>
<p>ä¹‹å‰ç½‘ä¸Šè®¨è®ºçš„æ¯”è¾ƒå¤šçš„æ˜¯</p>
<pre><code>body {
	font-size: 62.5%;
}
p {
 	font-size: 1.2em;
}
</code></pre>
<p>åˆ™ <code>1em = 16px * 62.5% = 10px</code>ï¼Œem çš„åˆå§‹å€¼ä¸º <code>1em = 16px</code>ï¼Œè€Œä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œ æ¢ç®—ä¸€ä¸‹ <code>10 / 16</code>ï¼ˆ16px æ˜¯ Chrome æµè§ˆå™¨é»˜è®¤å­—ä½“å¤§å°ï¼‰ã€‚ç¼ºç‚¹æ˜¯è¿›è¡Œä»»ä½•å…ƒç´ è®¾ç½®ï¼Œéƒ½æœ‰å¯èƒ½éœ€è¦çŸ¥é“ä»–çˆ¶å…ƒç´ çš„å¤§å°ï¼Œæ¯”è¾ƒç¹çä½æ•ˆã€‚</p>
<h4><a href="https://m.taobao.com/">æ‰‹æ·˜</a></h4>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-20cf64a29a08e6d3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Image text"></p>
<p>ï¼ˆ1ï¼‰åŠ¨æ€è®¾ç½® viewportçš„scale</p>
<pre><code>var scale = 1 / devicePixelRatio;
document.querySelector('meta[name=&quot;viewport&quot;]').setAttribute('content','initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');

</code></pre>
<p>ï¼ˆ2ï¼‰åŠ¨æ€è®¡ç®— html çš„ font-size</p>
<pre><code>document.documentElement.style.fontSize = document.documentElement.clientWidth / 10 + 'px';

</code></pre>
<p>ï¼ˆ3ï¼‰å¸ƒå±€çš„æ—¶å€™ï¼Œå„å…ƒç´ çš„ css å°ºå¯¸ = è®¾è®¡ç¨¿æ ‡æ³¨å°ºå¯¸/è®¾è®¡ç¨¿æ¨ªå‘åˆ†è¾¨ç‡/10</p>
<p>è®¾è®¡ç¨¿æ˜¯ 750 çš„ï¼Œæ‰€ä»¥ html çš„ font-size å°±æ˜¯ 75ï¼Œå¦‚æœæŸä¸ªå…ƒç´ æ˜¯ 150pxçš„å®½ï¼Œæ¢ç®—æˆ rem å°±æ˜¯ 150 / 75 = 2remã€‚</p>
<p>æ•´ä¸ªæ‰‹æ·˜è®¾è®¡å¸ˆå’Œå‰ç«¯å¼€å‘çš„é€‚é…åä½œåŸºæœ¬æ€è·¯æ˜¯ï¼š</p>
<ul>
<li>é€‰æ‹©ä¸€ç§å°ºå¯¸ä½œä¸ºè®¾è®¡å’Œå¼€å‘åŸºå‡†</li>
<li>å®šä¹‰ä¸€å¥—é€‚é…è§„åˆ™ï¼Œè‡ªåŠ¨é€‚é…å‰©ä¸‹çš„ä¸¤ç§å°ºå¯¸(ä»‹äº iPhone 6çš„å°å±å’Œå¤§å±)</li>
<li>ç‰¹æ®Šé€‚é…æ•ˆæœç»™å‡ºè®¾è®¡æ•ˆæœ</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-82041248c359b004.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ‰‹æ·˜æ¨å‡ºäº†ä¸€å¥—ç§»åŠ¨ç«¯é€‚é…çš„æ–¹æ¡ˆâ€”â€”<a href="https://github.com/amfe/lib-flexible">Flexible æ–¹æ¡ˆ</a>ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼š</p>
<ul>
<li>åŠ¨æ€è¯»å–è®¾å¤‡å®½åº¦å¹¶ç»“åˆè®¾å¤‡çš„åƒç´ æ¯”</li>
<li>åŠ¨æ€æ”¹å˜ html çš„ font-size å¤§å° &amp; é¡µé¢ç¼©æ”¾æ¯”ä¾‹</li>
<li>å½±å“ä»¥ rem ä¸ºå•ä½çš„å…ƒç´ çš„æœ€ç»ˆå‘ˆç°</li>
</ul>
<hr/>
<h3>px æ–¹æ¡ˆï¼šcss å°ºå¯¸ä¸ºå¯¹åº”è®¾è®¡ç¨¿ï¼2</h3>
<p>è®¾è®¡ç¨¿æ˜¯ 750 çš„ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-7d604282b2972607.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0361bcd04065cb42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¼˜ç‚¹ï¼šç®€å•ç²—æš´ï¼Œæ‰€æœ‰ css å°ºå¯¸å‡ä¸ºè®¾è®¡ç¨¿å°ºå¯¸ç›´æ¥é™¤ 2ï¼Œå¼€å‘å¿«é€Ÿç®€å•ï¼›
ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°ä¸€æ’æ”¾ä¸ä¸‹çš„æƒ…å†µï¼Œéœ€è¦é’ˆå¯¹å°å±å¹•å¦‚ 5 åŠä»¥ä¸‹åšå•ç‹¬é€‚é…</p>
<h3>vw æ–¹æ¡ˆ</h3>
<ul>
<li><a href="https://m.nuomi.com/">ç³¯ç±³ WAP</a>
åˆ©ç”¨ CSS3 ä¸­æ–°å¢å•ä½  <code>&lt;mark style=&quot;background: rgb(255, 255, 0); color: rgb(0, 0, 0);&quot;&gt;vw&lt;/mark&gt;</code>ï¼Œé…åˆ <code>&lt;mark style=&quot;background: rgb(255, 255, 0); color: rgb(0, 0, 0);&quot;&gt;</code>ç™¾åˆ†æ¯”</mark>`æ¥åšå“åº”å¼å¼€å‘ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>å•ä½</th>
<th>é‡Šä¹‰</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>px</td>
<td>ç›¸å¯¹äºæ˜¾ç¤ºå™¨å±å¹•åˆ†è¾¨ç‡</td>
<td>-</td>
</tr>
<tr>
<td>em</td>
<td>ç›¸å¯¹äºçˆ¶å…ƒç´ å­—ä½“å¤§å°</td>
<td>-</td>
</tr>
<tr>
<td>rem</td>
<td>ç›¸å¯¹äºæ ¹å…ƒç´ å­—ä½“å¤§å°</td>
<td>css3</td>
</tr>
<tr>
<td>vw</td>
<td>ç›¸å¯¹äºè§†çª—çš„å®½åº¦</td>
<td>css3</td>
</tr>
<tr>
<td>vh</td>
<td>ç›¸å¯¹äºè§†çª—çš„é«˜åº¦</td>
<td>css3</td>
</tr>
</tbody>
</table>
<p><code>vw</code>Â ç›¸å¯¹äºè§†çª—çš„å®½åº¦ï¼šè§†çª—å®½åº¦æ˜¯ <code>100vw</code>ã€‚
å¦‚æœè§†åŒºå®½åº¦æ˜¯ 100vm, åˆ™ 1vm æ˜¯è§†åŒºå®½åº¦çš„ 1/100, ä¹Ÿå°±æ˜¯ 1%ï¼Œç±»ä¼¼äº width: 1%ã€‚
é‚£ iPhone 6 æ¥è¯´ï¼Œ<code>document.documentElement.clientWidth=375</code>, åˆ™è±†è…å—å®½åº¦ä¸ºÂ <code>375/100*30=112.5px</code></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-61635fff2b67721a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ba64af3537d9666a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr/>
<p>æ··åˆ: rem px vw ç™¾åˆ†ç™¾ç­‰å•ä½æ··ç”¨</p>
<ul>
<li>rem &amp; ç™¾åˆ†æ¯”%</li>
</ul>
<pre><code>body {
	padding-bottom: 14.0625%;
}
a.link {
	width: 30vw;
	height: 23vw;
}
</code></pre>
<p>ç•¥ï¼ŒåŒä¸Šç³¯ç±³WAP</p>
<ul>
<li>rem &amp; vw</li>
</ul>
<pre><code>html {  
    font-size: 4.375vw;
}
</code></pre>
<p>è¿™é‡Œå‡è®¾è®¾è®¡ç¨¿ 640pxï¼Œåˆ™è®¾ç½®æ ¹å…ƒç´  font-size ä¸º 4.375vwï¼Œæ ¹æ®å±å¹•å®½åº¦è‡ªé€‚åº”ï¼Œåœ¨è§†çª—å®½åº¦ä¸º 320px çš„æ—¶å€™ï¼Œæ­£å¥½æ˜¯ 14px (14 / 320 = 0.04375)ã€‚ è¾¾åˆ°é¡µé¢é»˜è®¤å­—ä½“å¤§å° 14px çš„ç›®çš„ï¼ˆå…¶ä»–å¤§å°ä¹Ÿ okï¼‰ã€‚å¥½äº†ï¼Œç°åœ¨é¡µé¢ä¸Šæ‰€æœ‰ä»¥ Â <code>rem</code>Â  ä¸ºå•ä½çš„å±æ€§å€¼éƒ½ä¼šéšç€å±å¹•çš„å®½åº¦å˜åŒ–è€Œå˜åŒ–ï¼Œè¾¾åˆ°è‡ªé€‚åº”çš„ç›®çš„ã€‚ï¼ˆ<code>è‡ªé€‚åº”ä¸ç”¨ js åŠ¨æ€è®¾ç½®æ ¹å…ƒç´ å¤§å°</code>ï¼‰</p>
<pre><code>p {  
    font-size: 1rem;   
    padding-top: 2rem: /* è®¾è®¡ç¨¿ä¸Šä¸º 28px */
}
</code></pre>
<h3>æ€»ç»“</h3>
<p>åœ¨ç§»åŠ¨ç«¯é¡µé¢å¼€å‘ä¸­ï¼Œè§†è§‰ç«¥é‹ä¸€èˆ¬ä¼šç”¨ 750pxï¼ˆiPhone 6ï¼‰æ¥å‡ºè®¾è®¡ç¨¿ï¼Œç„¶åè¦æ±‚ FE ç«¥é‹èƒ½å¤Ÿåšåˆ°é¡µé¢æ˜¯è‡ªé€‚åº”å±å¹•çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ç”¨ rem æˆ–è€… vm ç­‰ç›¸å¯¹å•ä½æ¥åšé€‚é…ï¼Œæ„‰å¿«å’Œè§†è§‰ç«¥é‹ä¸€èµ·ç©è€å•¦ã€‚</p>
<p>å†…å®¹è½¬è‡ªï¼š<a href="https://www.dazhuanlan.com/2019/10/01/5d92e372da2f5/">å¤§ä¸“æ </a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript æ·±æµ…æ‹·è´ï¼Œå…¶å®æ²¡é‚£ä¹ˆéš¾ï¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/200</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/200</guid>
            <pubDate>Sun, 26 Feb 2023 09:20:21 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-03-03ã€‚</p>
<blockquote>
<p>PSï¼šè¿™ç¯‡åˆ«çœ‹äº†ï¼Œçœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/246">è¶…è¯¦ç»†çš„ JavaScript æ·±æ‹·è´å®ç°</a>ã€‚</p>
</blockquote>
<h]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-03-03ã€‚</p>
<blockquote>
<p>PSï¼šè¿™ç¯‡åˆ«çœ‹äº†ï¼Œçœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/246">è¶…è¯¦ç»†çš„ JavaScript æ·±æ‹·è´å®ç°</a>ã€‚</p>
</blockquote>
<h3>ä»€ä¹ˆæ˜¯æ·±æµ…æ‹·è´ï¼Ÿ</h3>
<ul>
<li>
<p>æµ…æ‹·è´ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ç€åŸå§‹å¯¹è±¡å±æ€§å€¼çš„ä¸€ä»½ç²¾ç¡®æ‹·è´ã€‚å¦‚æœå±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œå¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ ï¼Œæ‰€ä»¥å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li>
<p>æ·±æ‹·è´ï¼šå°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´çš„æ‹·è´ä¸€ä»½å‡ºæ¥,ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„åŒºåŸŸå­˜æ”¾æ–°å¯¹è±¡,ä¸”ä¿®æ”¹æ–°å¯¹è±¡ä¸ä¼šå½±å“åŸå¯¹è±¡</p>
</li>
</ul>
<h3>æµ…æ‹·è´çš„å‡ ç§æ–¹å¼</h3>
<p><code>array.slice()</code>ã€<code>array.concat()</code>ã€<code>Object.assign()</code> éƒ½èƒ½å®ç°æµ…æ‹·è´ï¼Œå‰ä¸¤ä¸ªé’ˆå¯¹æ•°ç»„ã€‚è¿˜å¯ä»¥ç”¨ä»¥ä¸‹è¿™ç§æ–¹å¼ã€‚</p>
<pre><code class="language-js">// æµ…æ‹·è´
function shallowCopy(source, target = {}) {
  for (let key in source) {
    if (source.hasOwnProperty(key)) {
      target[key] = source[key]
    }
  }
  return target
}

let student1 = {
  name: 'Frankie',
  age: 22,
  language: ['Chinese', ['English', 'German']]
}

let student2 = shallowCopy(student1)
student2.language[1] = ['French']

console.log(student1)
console.log(student2)
// æ‰“å°å¯¹æ¯”å¯çŸ¥ï¼Œlanguage åŒæ—¶æ”¹å˜äº†

</code></pre>
<h3>æ·±æ‹·è´çš„å‡ ç§æ–¹å¼</h3>
<ul>
<li><strong>JSON</strong>
åˆ©ç”¨ <code>JSON.stringify</code> &amp; <code>JSON.parse</code> æ–¹æ³•</li>
</ul>
<blockquote>
<p>ä¸è¶³ï¼š</p>
<ol>
<li>æ— æ³•æ‹·è´å¯¹è±¡ä¸­çš„<strong>æ–¹æ³•</strong>å±æ€§ï¼›</li>
<li>æ— æ³•æ‹·è´å¯¹è±¡ä¸­çš„ <strong>undefined</strong> å±æ€§</li>
</ol>
</blockquote>
<ul>
<li><strong>JQuery</strong></li>
</ul>
<p>JQuery æä¾›çš„ä¸¤ç§æ–¹æ³• <code>$.extend()</code>ã€<code>$.clone()</code> ï¼Œå‰è€…æ˜¯ JS å¯¹è±¡çš„æ‹·è´ã€åè€…æ˜¯ DOM å¯¹è±¡çš„æ‹·è´ï¼ˆè¿™é‡Œä¸è®¨è®ºï¼‰</p>
<blockquote>
<p>ä¸è¶³ï¼š</p>
<ol>
<li>éœ€è¦å¼•å…¥ JQuery åº“</li>
<li>æ— æ³•æ‹·è´å¯¹è±¡ä¸­çš„ <strong>undefined</strong> å±æ€§</li>
</ol>
</blockquote>
<ul>
<li><strong>é€’å½’</strong></li>
</ul>
<p>åˆ©ç”¨ <code>for..in..</code>ã€ <code>hasOwnProperty</code>ã€<code>é€’å½’</code>å®ç°</p>
<blockquote>
<p>ä¸è¶³ï¼šæ¯”ä¸Šé¢çš„ä¸¤ç§æ–¹å¼ç¨å¤æ‚</p>
</blockquote>
<p>é€’å½’å®ç°æ·±æ‹·è´ï¼š</p>
<pre><code class="language-js">// å‡è®¾åœ¨ Object çš„åŸå‹ï¼Œæ·»åŠ ä¸€ä¸ª height å±æ€§
Object.prototype.height = 180

// student1 ä»€ä¹ˆç±»å‹çš„å±æ€§éƒ½æœ‰äº†
const student1 = {
  name: 'Frankie',
  age: 22,
  private: true,
  friends: ['Mandy', 'John'],
  abilities: undefined,
  other: null,
  car: {
    color: 'gray',
    brand: 'Benz'
  },
  teacher: {
    name: 'Ada',
    student: ['Helkai', 'Jerry']
  },
  learn: function () {
    console.log(this.name + ' is learning JavaScript now.')
  }
}

// æ·±æ‹·è´
function deepCopy(source, target = {}) {
  for (const key in source) {
    // for...in... ä¼šéå†åŸå‹é“¾ä¸Šçš„å±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆ©ç”¨ hasOwnProperty åˆ¤æ–­ï¼Œå¦åˆ™ä¼šæŠŠ Object åŸå‹ä¸Šçš„ height ä¹Ÿæ‹·è´è¿›å»äº†
    if (source.hasOwnProperty(key)) {
      if (typeof source[key] === 'object' &amp;&amp; source[key] !== null) {
        // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
        target[key] = Object.prototype.toString.call(source[key]) === '[object Array]' ? [] : {}
        // é€’å½’
        deepCopy(source[key], target[key])
      } else {
        target[key] = source[key]
      }
    }
  }
  return target
}

// ä» student1 ä¸­æ‹·è´ä¸€ä¸ª student2 å‡ºæ¥
const student2 = deepCopy(student1)
// ä¿®æ”¹ student2 çš„å±æ€§å€¼
student2.name = 'Steven'
student2.age = 20
student2.car = {
  color: 'red',
  brand: 'BMW'
}
student2.friends[1] = 'Jone'
student2.teacher.age = '30'
// æ‰“å°ç»“æœçœ‹ä¸‹é¢æˆªå›¾ï¼Œç»“æœæ˜¯æ²¡æœ‰ç›¸äº’å½±å“çš„
console.log(student1)
console.log(student2)

// JSON æ–¹å¼
const student3 = JSON.parse(JSON.stringify(student1))
console.log(student3) //  æ‰“å° student3 å¯è§ abilitiesã€learn å±æ€§ä¸¢å¤±äº†

</code></pre>
<h3>è¿è¡Œç»“æœ</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9ee01cdb74de98a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ—¥å¸¸æ¬ç –é€‰æ‹©å“ªç§æ–¹å¼å‘¢ï¼Œè§†å…·ä½“æƒ…å†µè€Œå®šã€‚æˆ‘çš„è¯ï¼Œèƒ½ç”¨ JSON æ–¹å¼è§£å†³çš„ï¼Œç»ä¸ç”¨é€’å½’ï¼Œæ²¡å¿…è¦å¤æ‚åŒ–ï¼Œç®€å•å¤Ÿç”¨å³å¯ã€‚ä½†æ˜¯å­¦ä¹ çš„è¯ï¼Œé€’å½’çš„æ–¹å¼å¿…é¡»å¾—æ‡‚å•Šï¼Œå…¶å®ä¸éš¾æ‡‚ã€‚</p>
<p>å…¶å®è¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ for...in çš„æ€§èƒ½æ˜¯æ¯”è¾ƒå·®çš„ã€‚å…³äºæ€§èƒ½ä¼˜åŒ–ç¯‡ï¼Œå¯ä»¥çœ‹ä¸‹æ˜é‡‘æŸå¤§ç¥çš„æ–‡ç« ï¼Œ<a href="https://juejin.im/entry/5d6c4ebff265da03ed196a48">è¿™é‡Œ</a>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é‡å†™ Function.prototype.bind]]></title>
            <link>https://github.com/toFrankie/blog/issues/199</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/199</guid>
            <pubDate>Sun, 26 Feb 2023 09:16:24 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>åˆ«çœ‹æœ¬æ–‡äº†ï¼Œçœ‹è¿™ç¯‡ï¼š<a href="https://github.com/toFrankie/Blog/issues/3">æ‰‹å†™ç³»åˆ— - callã€applyã€bind çš„å®ç°</a>ã€‚</p>
</blockquote>
<p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨ <code>bind()</]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>åˆ«çœ‹æœ¬æ–‡äº†ï¼Œçœ‹è¿™ç¯‡ï¼š<a href="https://github.com/toFrankie/Blog/issues/3">æ‰‹å†™ç³»åˆ— - callã€applyã€bind çš„å®ç°</a>ã€‚</p>
</blockquote>
<p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨ <code>bind()</code> è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ <code>this</code> è¢«æŒ‡å®šä¸º <code>bind()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>
<pre><code class="language-js">function.bind(thisArg [, arg1 [, arg2 [, ...]]])
</code></pre>
<p><strong>å‚æ•° thisArg</strong></p>
<ul>
<li>å¦‚æœä½¿ç”¨ <code>new</code> è¿ç®—ç¬¦æ„é€ ç»‘å®šå‡½æ•°ï¼Œåˆ™å¿½ç•¥è¯¥å€¼ã€‚</li>
<li>å½“ä½¿ç”¨ <code>bind</code> åœ¨ <code>setTimeout</code> ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼ˆä½œä¸ºå›è°ƒæä¾›ï¼‰æ—¶ï¼Œä½œä¸º <code>thisArg</code> ä¼ é€’çš„ä»»ä½•åŸå§‹å€¼éƒ½å°†è½¬æ¢ä¸º <code>Object</code>ã€‚</li>
<li>å¦‚æœ <code>bind</code> å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸ºç©ºï¼Œæ‰§è¡Œä½œç”¨åŸŸçš„ <code>this</code> å°†è¢«è§†ä¸ºæ–°å‡½æ•°çš„ <code>thisArg</code>ã€‚</li>
</ul>
<p><strong>å‚æ•° arg1ã€arg2...</strong></p>
<p>å½“ç›®æ ‡å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¢«é¢„ç½®å…¥ç»‘å®šå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚</p>
<p><strong>è¿”å›å€¼</strong></p>
<p>è¿”å›ä¸€ä¸ªåŸå‡½æ•°çš„æ‹·è´ï¼Œå¹¶æ‹¥æœ‰æŒ‡å®šçš„ <code>this</code> å€¼å’Œåˆå§‹å‚æ•°ã€‚</p>
<h3>é‡å†™ bind æ–¹æ³•</h3>
<pre><code class="language-js">const point = {
  x: 0,
  y: 0,
  z: 0
}

// æ„é€ å‡½æ•°
function Point(x, y, z) {
  console.log(this.x, x, y, z)
  console.log('')
}

// å‡½æ•°åå†™æˆ bindyï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿ä¸åŸç”Ÿ bind æ–¹æ³•å¯¹æ¯”
Function.prototype.bindy = function (context) {
  const _this = this
  const args = Array.prototype.slice.call(arguments, 1)
  const tempFn = function () {}

  const fn = function () {
    const thatArgs = Array.prototype.slice.call(arguments)
    _this.apply(this instanceof _this ? this : context, args.concat(thatArgs))
  }

  // åœ£æ¯æ¨¡å¼
  tempFn.prototype = this.prototype
  fn.prototype = new tempFn()

  return fn
}

// bind å¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™ä¼ å…¥å‚æ•°
Point.bind(point, 1, 2)(3) // output: 0 1 2 3
Point.bindy(point, 4, 5)(6) // output: 0 4 5 6

// ä½¿ç”¨ new å»æ„é€ æ—¶ï¼Œbind ç»‘å®šçš„ this æœ€ç»ˆä¼šæ‰§è¡Œæ„é€ å‡½æ•°
const p = Point.bind(point)
const p2 = Point.bindy(point)
new p(3, 3, 3) // output: undefined 3 3 3
new p2(4, 4, 4) // output: undefined 4 4 4

</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™å®ç° Promise/A+ æ ‡å‡†]]></title>
            <link>https://github.com/toFrankie/blog/issues/198</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/198</guid>
            <pubDate>Sun, 26 Feb 2023 09:11:51 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººè®°å½•ï¼Œæ–‡ä¸­å¯èƒ½å­˜åœ¨ä¸ä¸¥è°¨çš„åœ°æ–¹ã€‚</p>
<p>è¦äº†è§£æ›´å¤šå¯ä»¥çœ‹ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/21834559">å²ä¸Šæœ€æ˜“è¯»æ‡‚çš„ Promise/A+ å®Œå…¨å®ç°</a></li>
<li><a href="htt]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººè®°å½•ï¼Œæ–‡ä¸­å¯èƒ½å­˜åœ¨ä¸ä¸¥è°¨çš„åœ°æ–¹ã€‚</p>
<p>è¦äº†è§£æ›´å¤šå¯ä»¥çœ‹ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/21834559">å²ä¸Šæœ€æ˜“è¯»æ‡‚çš„ Promise/A+ å®Œå…¨å®ç°</a></li>
<li><a href="https://segmentfault.com/a/1190000018589798">promise/A+ è§„èŒƒç¿»è¯‘ä»¥åŠæ‰‹å†™å®ç°</a></li>
</ul>
<h3>Promise/A+ çš„æ ‡å‡†æœ‰å“ªäº›ï¼Ÿ</h3>
<ul>
<li>åªæœ‰ä¸€ä¸ª <code>then</code> æ–¹æ³•ï¼Œæ²¡æœ‰ <code>catch</code>ã€<code>race</code>ã€<code>all</code> ç­‰æ–¹æ³•ã€‚</li>
<li><code>then</code> è¿”å›ä¸€ä¸ªæ–°çš„ Promiseã€‚</li>
<li>ä¸åŒçš„ Promise çš„å®ç°éœ€è¦ç›¸äº’è°ƒç”¨ã€‚</li>
<li>Promise çš„çŠ¶æ€æœ‰ <code>pending</code>ã€<code>fullfilled</code>ã€<code>rejected</code> ä¸‰ç§ã€‚åˆå§‹çŠ¶æ€æ˜¯ <code>pending</code>ï¼Œå¯ä»¥ç”± <code>pending</code> è½¬åŒ–ä¸º <code>fullfilled</code> æˆ–è€… <code>rejected</code>ã€‚ä¸€æ—¦çŠ¶æ€ç¡®å®šä¹‹åï¼Œä¸èƒ½å†è¢«æ”¹å˜ã€‚</li>
<li>æ›´å…·ä½“çš„å®˜æ–¹æ ‡å‡†ï¼Œçœ‹<a href="https://promisesaplus.com/">è¿™é‡Œ</a>ã€‚</li>
</ul>
<h3>å…·ä½“ä»£ç å®ç°</h3>
<pre><code class="language-js">function MyPromise(executor) {
  const _this = this
  // çŠ¶æ€
  _this.status = 'pending'
  // resolve å€¼
  _this.value = null
  // reject åŸå› 
  _this.reason = null
  // resolveã€reject å‡½æ•°
  _this.onFullfilled = []
  _this.onRejected = []

  function resolve(value) {
    if (value instanceof MyPromise) {
      return value.then(resolve, reject)
    }

    // å…¶å®è¿™é‡Œé‡‡ç”¨ setTimeout æ–¹å¼å®ç°å¼‚æ­¥æ‰§è¡Œ onFullfilled/onRejected ä¸å¤ªç¬¦åˆ Event Loop æœºåˆ¶ã€‚ä¸‹é¢ reject åŒç†ã€‚
    setTimeout(() =&gt; {
      // åªæœ‰çŠ¶æ€ä¸º pending æ‰èƒ½è¢«æ”¹å˜
      if (_this.status == 'pending') {
        _this.value = value
        _this.status = 'resolved'
        _this.onFullfilled.forEach(currentValue =&gt; currentValue(value))
      }
    }, 0)
  }

  function reject(reason) {
    setTimeout(() =&gt; {
      // åªæœ‰çŠ¶æ€ä¸º pending æ‰èƒ½è¢«æ”¹å˜
      if (_this.status == 'pending') {
        _this.reason = reason
        _this.status = 'rejected'
        _this.onRejected.forEach(currentValue =&gt; currentValue(reason))
      }
    }, 0)
  }

  // æ³¨æ„ï¼šè‹¥æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸ï¼Œåˆ™æ•è·å¼‚å¸¸å¹¶æ‰§è¡Œ reject å‡½æ•°ã€‚
  try {
    executor(resolve, reject)
  } catch (e) {
    reject(e)
  }
}

function resolvePromise(promise2, x, resolve, reject) {
  let then
  let thenCallorThrow = false

  if (promise2 === x) {
    return reject(new TypeError('same Promise!'))
  }

  if (x instanceof MyPromise) {
    if (x.status === 'pending') {
      x.then(value =&gt; {
        resolvePromise(promise2, value, resolve, reject)
      }, reject)
    } else {
      x.then(resolve, reject)
    }
    return
  }

  if (x !== null &amp;&amp; (typeof x === 'object' || typeof x === 'function')) {
    try {
      then = x.then
      if (typeof then === 'function') {
        then.call(
          x,
          res =&gt; {
            if (thenCallorThrow) return
            thenCallorThrow = true
            return resolvePromise(promise2, res, resolve, reject)
          },
          err =&gt; {
            if (thenCallorThrow) return
            thenCallorThrow = true
            return reject(err)
          }
        )
      } else {
        resolve(x)
      }
    } catch (e) {
      if (thenCallorThrow) return
      thenCallorThrow = true
      return reject(e)
    }
  } else {
    return resolve(x)
  }
}

MyPromise.prototype.then = function (onFullfilled, onRejected) {
  const _this = this
  let promise2 // promise.then() è¿”å›ä¸€ä¸ª promise å¯¹è±¡

  // Promise å€¼çš„ç©¿é€å¤„ç†ï¼š
  // åœºæ™¯å¦‚ï¼š new Promise(resolve =&gt; resolve('abc')).then().catch().then(res =&gt; {console.log('print abc')})
  onFullfilled = typeof onFullfilled === 'function' ? onFullfilled : val =&gt; val
  onRejected =
    typeof onRejected === 'function'
      ? onRejected
      : err =&gt; {
          throw err
        }

  switch (_this.status) {
    case 'pending':
      promise2 = new MyPromise((resolve, reject) =&gt; {
        _this.onFullfilled.push(value =&gt; {
          try {
            const x = onFullfilled(value)
            resolvePromise(promise2, x, resolve, reject)
          } catch (e) {
            reject(e)
          }
        })
        _this.onRejected.push(reason =&gt; {
          try {
            const x = onRejected(reason)
            resolvePromise(promise2, x, resolve, reject)
          } catch (e) {
            reject(e)
          }
        })
      })
      break
    case 'resolved':
      promise2 = new MyPromise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
          try {
            const x = onFullfilled(_this.value)
            resolvePromise(promise2, x, resolve, reject)
          } catch (e) {
            reject(e)
          }
        })
      })
      break
    case 'rejected':
      promise2 = new MyPromise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
          try {
            const x = onRejected(_this.reason)
            resolvePromise(promise2, x, resolve, reject)
          } catch (e) {
            reject(e)
          }
        })
      })
      break
    default:
      break
  }

  return promise2
}

// Promise æ ‡å‡†é‡Œé¢æ²¡æœ‰ catchã€raceã€all ç­‰æ–¹æ³•ï¼Œåªæœ‰ä¸€ä¸ª then æ–¹æ³•
MyPromise.prototype.catch = function (onRejected) {
  return this.then(null, onRejected)
}

new MyPromise((resolve, reject) =&gt; {
  resolve('right')
}).then(
  res =&gt; {
    console.log(res)
  },
  err =&gt; {
    console.warn(err)
  }
)
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½ æ˜¯å¦‚ä½•ç†è§£ setTimeout çš„ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/197</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/197</guid>
            <pubDate>Sun, 26 Feb 2023 09:10:04 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-efd1b7b4a20b1621.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-efd1b7b4a20b1621.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h3>ä¸€ã€setTimeout</h3>
<p>åœ¨ JavaScript ä¸­ <code>setTimeout</code>ã€<code>setInterval</code> æœ€å¸¸è§ä¸è¿‡äº†ï¼Œç”¨äºå»¶è¿Ÿæˆ–è€…å»¶è¿Ÿé‡å¤å¤„ç†ç­‰ã€‚</p>
<pre><code class="language-js">setTimeout(() =&gt; {
  console.log('ä¸€ç§’åæ‰§è¡Œ')
}, 1000)
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£æˆï¼šã€Œä¸€ç§’ã€åè¾“å‡ºå¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯è¿™ã€Œä¸€ç§’ã€åªæ˜¯æˆ‘ä»¬æ‰€è®¾çš„ã€Œé¢„æœŸå€¼ã€ï¼Œç„¶è€Œå®é™…æƒ…å†µå®ƒåªæ˜¯ã€Œæœ€å°å»¶è¿Ÿæ—¶é—´ã€è€Œå·²ã€‚æ¢å¥è¯è¯´ï¼Œæœ€ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ç§’ä¹‹åä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œç„¶è€Œç°å®å¾€å¾€ä¸æ˜¯è¿™æ ·çš„ï¼Œè‚¯å®šå­˜åœ¨è¯¯å·®åœ¨é‡Œé¢ã€‚</p>
<blockquote>
<p>é‚£èƒ½å¦åœ¨æˆ‘ä»¬æ‰€æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œå›è°ƒå‡½æ•°å‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸¥æ ¼æ¥è¯´è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæœ‰å®å®åœ¨åœ¨çš„è¯¯å·®åœ¨é‡Œé¢ï¼Œå¹³å¸¸çœ‹èµ·æ¥åƒæ˜¯æŒ‡å®šæ—¶é—´æ‰§è¡Œåªæ˜¯å› ä¸ºäººæœ¬èº«æ— æ³•æ„ŸçŸ¥å…¶ä¸­å¾®å¦™çš„è¯¯å·®è€Œå·²ã€‚å€˜è‹¥è¯¯å·®åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œç†è§£æˆæŒ‡å®šæ—¶é—´åæ‰§è¡Œä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
<p>è¯¯å·®äº§ç”Ÿçš„å› ç´ æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ <code>for</code> å¾ªç¯ã€å…¶ä»–å¼‚æ­¥ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ã€å®ä»»åŠ¡ï¼‰ã€æµè§ˆå™¨ç²¾åº¦ç­‰ç­‰ã€‚æœ¬è´¨ä¸Šæ˜¯ <a href="https://www.jianshu.com/p/350a054c9562">Event Loop æœºåˆ¶</a>å¯¼è‡´çš„çš„ç°è±¡ã€‚æ¯”å¦‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">setTimeout(() =&gt; {
  console.log('ä¼šåœ¨ä¸€ç§’åæ‰§è¡Œå—?')
}, 1000)

for(let i = 0; i &lt; 10000; i++) {
  console.count('å¾ªç¯æ¬¡æ•°')
}
</code></pre>
<blockquote>
<p>æˆ‘å¯¹ <code>setTimeout</code> çš„ç†è§£æ˜¯ï¼š<strong>åœ¨æŒ‡å®šæ—¶é—´åï¼Œå°†å›è°ƒå‡½æ•°ä½œä¸ºå¼‚æ­¥ä»»åŠ¡åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚</strong></p>
<p>å¯¹äºåˆšæ¥è§¦ JavaScript çš„æœ‹å‹ï¼Œå¯èƒ½ä¼š<strong>é”™è¯¯åœ°</strong>ç†è§£ä¸ºï¼šåœ¨æŒ‡å®šæ—¶é—´åï¼Œæ‰§è¡Œå¯¹åº”å‡½æ•°ã€‚è¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå¯èƒ½ä¸€ç§’çš„æ—¶é—´å†… <code>for</code> å¾ªç¯è¿˜æ²¡æ‰§è¡Œå®Œï¼Œæ‰€ä»¥ä¸€ç§’åè¿˜æ²¡å¼€å§‹æ‰§è¡Œå®šæ—¶å™¨é‡Œé¢çš„å‡½æ•°ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ <code>setTimeout</code> å±äºå¼‚æ­¥ä»»åŠ¡ï¼ˆå®ä»»åŠ¡ï¼‰ï¼Œåœ¨æ‰§è¡Œï¼ˆä¸‹ï¼‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä¹‹å‰ï¼Œé¦–å…ˆå¾—æ‰§è¡Œå½“å‰å®ŒåŒæ­¥ä»»åŠ¡ã€å¾®ä»»åŠ¡ï¼ˆä¹Ÿå±äºå¼‚æ­¥ä»»åŠ¡ï¼‰ã€æ¥ç€æ›´æ–° UI ä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œï¼ˆä¸‹ä¸€ä¸ªï¼‰å¼‚æ­¥ä»»åŠ¡ã€‚</p>
</blockquote>
<h3>äºŒã€æ‰©å±•</h3>
<p><strong><code>setTimeout</code> åŠ ä¸åŠ æ‹¬å·ï¼Œä¼šå¯¼è‡´ä»€ä¹ˆä¸åŒçš„ç»“æœï¼Ÿ</strong></p>
<p>çœ‹ä¸ªç¤ºä¾‹ï¼Œè¯·é—®äºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆä¸åŒçš„ç»“æœï¼š</p>
<pre><code class="language-js">function foo() {
  console.log('show foo')
}

// å†™æ³•ä¸€
setTimeout(foo, 3000)

// å†™æ³•äºŒ
setTimeout(foo(), 3000)
// ä¸¤è€…è¿è¡Œç»“æœä¸€è‡´å—ï¼Ÿ
</code></pre>
<ol>
<li>å°† <code>delay</code> è®¾ä¸º <code>300</code>ï¼Œçœ‹èµ·æ¥å¥½åƒæ²¡åŒºåˆ«ï¼Œéƒ½èƒ½æ­£å¸¸è¾“å‡º <code>show foo</code>ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</li>
<li>è‹¥å°† <code>delay</code> è®¾ä¸º <code>3000</code>ï¼Œä»ç„¶éƒ½èƒ½è¾“å‡ºå­—ç¬¦ä¸²ï¼Œä½†æœ‰ç‚¹åŒºåˆ«ã€‚<code>setTimeout(foo, 3000)</code> åœ¨é¢„æœŸçš„ <code>3s</code> åè¾“å‡ºå€¼ã€‚ç„¶è€Œ<code>setTimeout(foo(), 3000)</code> å¥½åƒç«‹åˆ»æ‰§è¡Œäº†ï¼Œè€Œä¸æ˜¯ç­‰ <code>3s</code> åæ‰è¾“å‡ºã€‚</li>
<li>é€šè¿‡è®¾ç½®ä¸åŒ <code>delay</code> å€¼å¯ä»¥æ›´æ˜æ˜¾åœ°æ„ŸçŸ¥å…¶ä¸­çš„åŒºåˆ«ï¼Œè¶Šå¤§è¶Šæ˜æ˜¾ã€‚</li>
</ol>
<blockquote>
<p>ä¸¤è€…åŒºåˆ«ï¼š</p>
<ol>
<li>ä¸åŠ æ‹¬å·ï¼šèƒ½æ­£å¸¸åœ°æŒ‰ç…§æˆ‘ä»¬æ‰€é¢„æœŸçš„æ—¶å€™æ‰§è¡Œå¯¹åº”çš„å‡½æ•°ã€‚</li>
<li>åŠ æ‹¬å·ï¼šåŒæ ·ä¼šæ‰§è¡Œè¯¥å‡½æ•°ï¼Œä½†å®ƒæ˜¯ç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šè¾¾åˆ°å»¶è¿Ÿæ‰§è¡Œçš„ç›®çš„ã€‚(è¿™ç‚¹è¯´æ³•ä¸ä¸¥è°¨ï¼Œåªæ˜¯å¸®åŠ©ç†è§£ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹)</li>
</ol>
</blockquote>
<p><strong>é€ æˆä¸Šé¢å·®å¼‚çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬æ”¹ä¸‹ä»£ç ï¼Œå°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<pre><code>function foo() {
  console.log('show foo')
  return `console.log('å“ˆå“ˆ')`
}

setTimeout(foo(), 3000)

// ç»“æœï¼šç«‹å³æ‰“å°å‡º show fooï¼Œä¸‰ç§’åæ‰“å°äº† â€œå“ˆå“ˆâ€ã€‚
</code></pre>
<p>ç”±äº <code>foo</code> å‡½æ•°è¿”å›å€¼æ˜¯ <code>console.log('å“ˆå“ˆ')</code>ï¼Œå› æ­¤ <code>setTimeout(foo(), 3000)</code> ç›¸å½“äº <code>setTimeout('console.log(&quot;å“ˆå“ˆ&quot;)', 3000)</code> ï¼Œå°±ä¼šäº§ç”Ÿè¿™æ ·çš„ç»“æœã€‚</p>
<p>å…¶å® <code>setTimeout</code> æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°é™¤äº†æ”¯æŒå‡½æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€‚è‹¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šä½¿ç”¨  <code>eval</code> å»æ‰§è¡Œã€‚</p>
<blockquote>
<p>ç”±äºæˆ‘ä»¬æœ€å¸¸ç”¨çš„å†™æ³•æ˜¯æ‰§è¡Œä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆå¦‚<code>setTimeout(() =&gt; {}, delay)</code>ï¼‰ï¼Œæ²¡æ³¨æ„çš„åŒå­¦ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¿½ç•¥åŠ ä¸ä¸åŠ æ‹¬å·çš„åŒºåˆ«ã€‚</p>
<p>è¿˜æœ‰ï¼Œä¸å»ºè®®ä½¿ç”¨ <code>setTimeout('String Code', delay)</code> çš„å½¢å¼ã€‚å› ä¸º <code>eval</code> é€šå¸¸è¢«ç”¨æ¥æ‰§è¡ŒåŠ¨æ€åˆ›å»ºçš„ä»£ç ï¼Œå¦‚æœ <code>eval(...)</code> ä¸­æ‰§è¡Œçš„ä»£ç åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªå£°æ˜ï¼ˆæ— è®ºå˜é‡è¿˜æ˜¯å‡½æ•°ï¼‰ï¼Œå°±ä¼šå¯¹ <code>eval(...)</code> æ‰€å¤„çš„è¯æ³•ä½œç”¨åŸŸè¿›è¡Œä¿®æ”¹ï¼ˆå¯çœ‹<a href="https://www.jianshu.com/p/12e9b0edcd31">æ–‡ç« </a>ï¼‰ã€‚é¿å…å‡ºç°ä¸€äº›æ„æ–™ä¹‹å¤–çš„äº‹æƒ…ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>
</blockquote>
<h3>ä¸‰ã€å…¶ä»–</h3>
<p><strong>1. å½“ä½¿ç”¨ setTimeout() æ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯å¦å¿…é¡»æ‰§è¡Œ clearTimeout() ï¼Ÿ</strong></p>
<ul>
<li>
<p>åœ¨ <code>setTimeout()</code> å†…çš„å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œå¦‚æœæƒ³è¦é˜»æ­¢æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡ <code>cleartTimeout()</code> æ¥å¤„ç†ã€‚</p>
</li>
<li>
<p>åœ¨ <code>setTimeout()</code> å†…çš„å‡½æ•°æ‰§è¡Œä¹‹åï¼Œæ‰§è¡Œ <code>clearTimeout()</code> æ–¹æ³•å¯¹æ•´ä¸ªä»£ç æµç¨‹æ²¡æœ‰å®³å¤„ï¼Œä½†æ˜¯æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚</p>
</li>
<li>
<p>é€šå¸¸æƒ…å†µï¼Œæ‰§è¡Œ <code>clearInterval()</code> æ¯”æ‰§è¡Œ <code>clearTimeout()</code> æ›´å®é™…ä¸€äº›ï¼Œå› ä¸ºå¦‚æœä¸æ‰§è¡Œ <code>clearInterval()</code>ï¼Œåˆ™ <code>setInterval()</code> çš„æ–¹æ³•ä¼šæ— é™å¾ªç¯æ‰§è¡Œä¸‹å»ã€‚è€Œ <code>setTimeout()</code> åœ¨ä¸€æ¬¡è°ƒç”¨åï¼Œå°±ä¼šåœæ­¢æ‰§è¡Œï¼ˆæµè§ˆå™¨ä¼šè‡ªåŠ¨å›æ”¶èµ„æºï¼‰ã€‚é™¤éä½ åˆ›å»ºäº†ä¸€ä¸ªæ— é™å¾ªç¯çš„ <code>setTimeout()</code>ã€‚</p>
</li>
</ul>
<p><strong>2. å…³äº setTimeout(fn, 0) çš„é—®é¢˜</strong></p>
<p>æ³¨æ„ï¼Œè¿™ä»ç„¶å±äºå¼‚æ­¥ä»»åŠ¡ï¼ŒæŒ‡å®šæŸä¸ªä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æœ€æ—©å¯å¾—çš„ç©ºé—²æ—¶é—´æ‰§è¡Œã€‚HTML5 æ ‡å‡†ä¸­è§„å®šäº† <code>setTimeout()</code> çš„ç¬¬äºŒä¸ªå‚æ•°çš„æœ€å°å€¼ï¼ˆæœ€çŸ­é—´éš”ï¼‰ï¼Œä¸å¾—ä½äº <code>4ms</code>ï¼Œå¦‚æœä½äºè¿™ä¸ªå€¼ï¼Œå°±ä¼šè‡ªåŠ¨å¢åŠ ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè€ç‰ˆæœ¬çš„æµè§ˆå™¨éƒ½å°†æœ€çŸ­é—´éš”è®¾ä¸º <code>10ms</code>ã€‚å¦å¤–ï¼Œå¯¹äºé‚£äº› DOM çš„å˜åŠ¨ï¼ˆå°¤å…¶æ˜¯æ¶‰åŠé¡µé¢é‡æ–°æ¸²æŸ“éƒ¨åˆ†ï¼‰ï¼Œé€šå¸¸ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ¯ <code>16ms</code> æ‰§è¡Œä¸€æ¬¡ï¼Œå¯¹äºåŠ¨ç”»çš„ä¼˜åŒ–ï¼Œ<code>window.requestAnimationFrame</code> æˆ–æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<h3>å››ã€References</h3>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout#%E5%AE%9E%E9%99%85%E5%BB%B6%E6%97%B6%E6%AF%94%E8%AE%BE%E5%AE%9A%E5%80%BC%E6%9B%B4%E4%B9%85%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9C%80%E5%B0%8F%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4">å®é™…å»¶æ—¶æ¯”è®¾å®šå€¼æ›´ä¹…çš„åŸå› ï¼šæœ€å°å»¶è¿Ÿæ—¶é—´ï¼ˆMDNï¼‰</a></li>
<li><a href="https://www.quora.com/How-accurate-are-JavaScript-timers">How accurate are JavaScript timers?</a></li>
<li><a href="https://developer.chrome.com/blog/timer-throttling-in-chrome-88">Heavy throttling of chained JS timers beginning in Chrome 88</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[History å¯¹è±¡]]></title>
            <link>https://github.com/toFrankie/blog/issues/196</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/196</guid>
            <pubDate>Sun, 26 Feb 2023 09:00:57 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-04-22ã€‚</p>
<ol>
<li>
<p>HTML5 ä½¿ç”¨ <code>history</code> å¯¹è±¡ <code>history.pushState()</code> å’Œ <code>history.replaceState()</code> æ–¹æ³•æ·»åŠ å’Œä¿®æ”¹æµè§ˆå†å²è®°å½•ï¼Œ<a h]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-04-22ã€‚</p>
<ol>
<li>
<p>HTML5 ä½¿ç”¨ <code>history</code> å¯¹è±¡ <code>history.pushState()</code> å’Œ <code>history.replaceState()</code> æ–¹æ³•æ·»åŠ å’Œä¿®æ”¹æµè§ˆå†å²è®°å½•ï¼Œ<a href="https://blog.csdn.net/u012028371/article/details/67636395">è¿™é‡Œ</a>ã€‚</p>
</li>
<li>
<p>History å¯¹è±¡æä¾›çš„æ–¹æ³•æœ‰ï¼š</p>
</li>
</ol>
<ul>
<li>
<p><code>back()</code>ï¼šç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªè®¿é—®é¡µé¢ï¼Œç­‰åŒäºæµè§ˆå™¨çš„åé€€é”®ã€‚</p>
</li>
<li>
<p><code>forward()</code>ï¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè®¿é—®é¡µé¢ï¼Œç­‰åŒäºæµè§ˆå™¨çš„å‰è¿›é”®ã€‚</p>
</li>
<li>
<p><code>go()</code>ï¼šæ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œç§»åŠ¨åˆ°è¯¥æ•´æ•°æŒ‡å®šçš„é¡µé¢ï¼Œæ¯”å¦‚ <code>go(1)</code> ç›¸å½“äº <code>forward()</code>ï¼Œ<code>go(-1)</code>ç›¸å½“äº <code>back()</code>ã€‚<code>history.go(0)</code> æˆ– <code>history.go()</code> ç›¸å½“äºåˆ·æ–°å½“å‰é¡µé¢ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœç§»åŠ¨çš„ä½ç½®è¶…å‡ºäº†è®¿é—®å†å²çš„è¾¹ç•Œï¼Œä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•å¹¶ä¸æŠ¥é”™ï¼Œè€Œæ˜¯é»˜é»˜çš„å¤±è´¥ã€‚
æ³¨æ„ï¼šè¿”å›ä¸Šä¸€é¡µæ—¶ï¼Œé¡µé¢é€šå¸¸æ˜¯ä»æµè§ˆå™¨ç¼“å­˜ä¹‹ä¸­åŠ è½½ï¼Œè€Œä¸æ˜¯é‡æ–°è¦æ±‚æœåŠ¡å™¨å‘é€æ–°çš„ç½‘é¡µã€‚</p>
</li>
<li>
<p>å…¶ä¸­ <code>pushState()</code>ã€<code>replaceState()</code> æ˜¯ HTML5 æ–°å¢çš„æ–¹æ³•ï¼Œç”¨æ¥åœ¨æµè§ˆå†å²ä¸­æ·»åŠ å’Œä¿®æ”¹è®°å½•ã€‚åˆ¤æ–­æ˜¯å¦æ”¯æŒ <code>pushState</code> æ–¹æ³•ï¼š<code>!!(window.history &amp;&amp; history.pushState)</code></p>
</li>
</ul>
<ol start="3">
<li>
<p><code>history.pushState(object state, string title, string url)</code> æ–¹æ³•èƒ½å®ç°åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ä¿®æ”¹æµè§ˆå™¨ url é“¾æ¥ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•åˆ›å»ºäº†æ–°çš„æµè§ˆè®°å½•ï¼Œå¹¶å°†æ–°çš„é“¾æ¥æ’å…¥åˆ°æµè§ˆè®°å½•é˜Ÿåˆ—ä¸­ã€‚</p>
<ul>
<li>
<p><code>state</code>ï¼šä¸€ä¸ªä¸æŒ‡å®šç½‘å€ç›¸å…³çš„çŠ¶æ€å¯¹è±¡ï¼Œ<code>popstate</code> äº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä¼ å…¥å›è°ƒå‡½æ•°ã€‚
å¦‚æœä¸éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤å¤„å¯ä»¥å¡« <code>null</code>ã€‚æ–°é¡µé¢é‡Œå¯ä»¥é€šè¿‡ <code>window.history.state</code> è·å–ã€‚</p>
</li>
<li>
<p><code>title</code>ï¼šæ–°é¡µé¢çš„æ ‡é¢˜ï¼Œä½†æ˜¯æ‰€æœ‰æµè§ˆå™¨ç›®å‰éƒ½å¿½ç•¥è¿™ä¸ªå€¼ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥å¡« <code>null</code>ã€‚</p>
</li>
<li>
<p><code>url</code>ï¼šæ–°çš„ç½‘å€ï¼Œå¿…é¡»ä¸å½“å‰é¡µé¢å¤„åœ¨åŒä¸€ä¸ªåŸŸï¼Œå¦åˆ™æŠ¥é”™ï¼ˆä¸æ”¯æŒè·¨åŸŸï¼‰ã€‚æµè§ˆå™¨çš„åœ°å€æ å°†æ˜¾ç¤ºè¿™ä¸ªç½‘å€ã€‚ä¸å…è®¸è·¨åŸŸçš„ç›®çš„æ˜¯ï¼Œé˜²æ­¢æ¶æ„ä»£ç è®©ç”¨æˆ·ä»¥ä¸ºä»–ä»¬æ˜¯åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šã€‚å‡å¦‚è®¾ç½®äº†ä¸€ä¸ªæ–°çš„é”šç‚¹å€¼ï¼ˆå³ hashï¼‰ï¼Œå¹¶ä¸ä¼šè§¦å‘ <code>hashchange</code> äº‹ä»¶ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ€»ä¹‹ï¼Œ<code>pushState</code> æ–¹æ³•ä¸ä¼šè§¦å‘é¡µé¢åˆ·æ–°ï¼Œåªæ˜¯å¯¼è‡´ <code>history</code> å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œåœ°å€æ ä¼šæœ‰ååº”ã€‚</p>
</li>
<li>
<p><code>history.replaceState</code> æ–¹æ³•çš„å‚æ•°ä¸ <code>pushState</code> æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯å®ƒä¿®æ”¹æµè§ˆå†å²ä¸­å½“å‰çºªå½•ã€‚</p>
</li>
<li>
<p><code>popstate</code> äº‹ä»¶ï¼š</p>
<p>æ¯å½“åŒä¸€ä¸ªæ–‡æ¡£çš„æµè§ˆå†å²(å³ <code>history</code> å¯¹è±¡)å‡ºç°å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…è°ƒç”¨ <code>pushState</code> æ–¹æ³•æˆ– <code>replaceState</code> æ–¹æ³•ï¼Œå¹¶ä¸ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œåªæœ‰ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨å€’é€€æŒ‰é’®å’Œå‰è¿›æŒ‰é’®ï¼Œæˆ–è€…ä½¿ç”¨ JS è°ƒç”¨ <code>back()</code>ã€<code>forward()</code>ã€<code>go()</code> æ–¹æ³•æ—¶æ‰ä¼šè§¦å‘ã€‚å¦å¤–ï¼Œè¯¥äº‹ä»¶åªé’ˆå¯¹åŒä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæµè§ˆå†å²çš„åˆ‡æ¢ï¼Œå¯¼è‡´åŠ è½½ä¸åŒçš„æ–‡æ¡£ï¼Œè¯¥äº‹ä»¶ä¹Ÿä¸ä¼šè§¦å‘ã€‚</p>
</li>
</ol>
<pre><code class="language-js">// event.stateï¼Œå°±æ˜¯é€šè¿‡ pushState å’Œ replaceState æ–¹æ³•ï¼Œä¸ºå½“å‰ URL ç»‘å®šçš„ state å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ history.state è·å–
window.onpopstate = function (event) {
  console.log('location: ' + document.location)
  console.log('state: ' + JSON.stringify(event.state))
}
</code></pre>
<ol start="7">
<li>
<p>å…¶ä»–</p>
<p>è·å– URLï¼Œ ä»è¾“å‡ºç»“æœä¸Šï¼Œ<code>document.URL</code> å’Œ <code>windows.location.href</code> æ²¡æœ‰åŒºåˆ«ã€‚ éè¦è¯´åŒºåˆ«çš„è¯ï¼Œä½ åªå¯ä»¥è¯»å– <code>document.URL</code> çš„å€¼ï¼Œä¸èƒ½ä¿®æ”¹å®ƒã€‚<code>windows.location.href</code> çš„å€¼ä½ å³å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚ <code>windows.location.href</code> æ˜¯æ—§çš„å†™æ³•ï¼Œæ–°çš„æ ‡å‡†æ¨èç”¨ <code>document.URL</code> æ›¿ä»£ã€‚ï¼ˆå¦‚æœä½ åªæ˜¯è¯»å–çš„è¯ï¼‰</p>
</li>
</ol>
<pre><code class="language-js">document.location.href
window.location.href
document.URL // åªè¯»
</code></pre>
<ol start="8">
<li>å‚è€ƒï¼š
<ul>
<li><a href="http://www.mamicode.com/info-detail-2375792.html">javascript History å¯¹è±¡è¯¦è§£</a>ã€‚</li>
<li><a href="https://yq.aliyun.com/articles/626809">history ç¦ç”¨æµè§ˆå™¨çš„åé€€åŠŸèƒ½ï¼ˆåŒ…æ‹¬å…¶ä»–æ“ä½œåé€€çš„æŒ‰é’®ï¼Œæ“ä½œç­‰ï¼‰</a>ã€‚</li>
</ul>
</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript äº‹ä»¶å¾ªç¯ï¼ˆå«å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/195</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/195</guid>
            <pubDate>Sun, 26 Feb 2023 08:59:40 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>æœ¬æ–‡å·²è¿‡æ—¶ï¼Œå¯ç§»æ­¥ã€Š<a href="https://github.com/toFrankie/blog/issues/348">é€šè¿‡ä¸¤ä¸ªä¾‹å­å†æ¢ Event Loop</a>ã€‹ã€‚</p>
</blockquote>
<h2>JavaScript ç‰¹ç‚¹</h2>
<p>JavaScrip]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡å·²è¿‡æ—¶ï¼Œå¯ç§»æ­¥ã€Š<a href="https://github.com/toFrankie/blog/issues/348">é€šè¿‡ä¸¤ä¸ªä¾‹å­å†æ¢ Event Loop</a>ã€‹ã€‚</p>
</blockquote>
<h2>JavaScript ç‰¹ç‚¹</h2>
<p>JavaScript æ˜¯å•çº¿ç¨‹éé˜»å¡çš„ä¸€é—¨è¯­è¨€ã€‚</p>
<p>å•çº¿ç¨‹æ„å‘³ç€ JavaScript ä»£ç æ‰§è¡Œæ—¶åªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹å»å¤„ç†æ‰€æœ‰çš„ä»»åŠ¡ï¼Œå³åŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>éé˜»å¡è¡¨ç¤ºå½“æ‰§è¡Œåˆ°å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šæŒ‚èµ·è¯¥å¼‚æ­¥ä»»åŠ¡ï¼Œå¾…å¼‚æ­¥ä»»åŠ¡è¿”å›ç»“æœæ—¶ï¼Œå†æ ¹æ®ä¸€å®šçš„è§„åˆ™å»æ‰§è¡Œç›¸åº”çš„å›è°ƒã€‚</p>
<blockquote>
<p>æ€è€ƒï¼š ä¸ºä»€ä¹ˆ JavaScript è¦è®¾è®¡æˆå•çº¿ç¨‹ï¼Ÿ</p>
<p>å•çº¿ç¨‹æ˜¯å¿…è¦çš„ï¼Œä¹Ÿæ˜¯ Javascript è¿™é—¨è¯­è¨€çš„åŸºçŸ³ã€‚åœ¨æœ€åˆçš„æµè§ˆå™¨æ‰§è¡Œç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå„ç§å„æ ·çš„ DOM æ“ä½œã€‚å¦‚æœ Javascript æ˜¯å¤šçº¿ç¨‹çš„è¯ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ DOM è¿›è¡Œä¸€é¡¹æ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªå‘å…¶æ·»åŠ äº‹ä»¶ï¼Œå¦ä¸€ä¸ªåˆ é™¤äº†è¿™ä¸ª DOM å…ƒç´ ï¼Œæ­¤æ—¶è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå› æ­¤ï¼ŒJavascript é€‰æ‹©åªç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥æ‰§è¡Œä»£ç ï¼Œè¿™æ ·å°±ä¿è¯äº†ç¨‹åºæ‰§è¡Œçš„ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<h2>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</h2>
<p>JavaScript æ˜¯é€šè¿‡ã€Œäº‹ä»¶å¾ªç¯ã€çš„å®ç°éé˜»å¡çš„ã€‚è€Œäº‹ä»¶å¾ªç¯æ˜¯é€šè¿‡ã€Œä»»åŠ¡é˜Ÿåˆ—ã€æœºåˆ¶åè°ƒçš„ã€‚</p>
<p>åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯æ“ä½œç§°ä¸º Tickï¼Œæ¯ä¸€æ¬¡ Tick çš„ä»»åŠ¡å¤„ç†æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨æœ¬æ¬¡ Tick ä¸­é€‰æ‹©æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå¦‚æœ‰åˆ™æ‰§è¡Œä¸€æ¬¡ã€‚</li>
<li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ï¼Œå¦‚æœ‰åˆ™æ‰§è¡Œï¼Œç›´è‡³æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆmicrotask queueï¼‰ã€‚</li>
<li>æ¸²æŸ“é¡µé¢ã€‚</li>
<li>ä¸»çº¿ç¨‹é‡å¤æ‰§è¡Œä¸Šè¿°æ­¥éª¤ã€‚</li>
</ol>
<p>Tick éœ€è¦äº†è§£çš„æ˜¯ï¼š</p>
<ul>
<li>JS ä»»åŠ¡åˆ†ä¸ºã€ŒåŒæ­¥ä»»åŠ¡ã€å’Œã€Œå¼‚æ­¥ä»»åŠ¡ã€ã€‚</li>
<li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆã€‚</li>
<li>ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ç€ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œåªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†ç»“æœï¼Œå°±åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚</li>
<li>ä¸€æ—¦æ‰§è¡Œæ ˆä¸­æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ˆJS å¼•æ“ç©ºé—²ä¹‹åï¼‰ï¼Œå°±ä¼šå»è¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¯æ‰§è¡Œæ ˆé‡Œé¢ï¼Œå¼€å§‹æ‰§è¡Œã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733794120351.png" alt=""></p>
<blockquote>
<p>ä»»åŠ¡åˆ†ä¸ºã€ŒåŒæ­¥ä»»åŠ¡ã€å’Œã€Œå¼‚æ­¥ä»»åŠ¡ã€ï¼Œå…¶ä¸­å¼‚æ­¥ä»»åŠ¡åˆåˆ†ä¸ºã€Œå®ä»»åŠ¡ã€å’Œã€Œå¾®ä»»åŠ¡ã€ã€‚</p>
</blockquote>
<h3>å®ä»»åŠ¡ï¼ˆTaskï¼‰</h3>
<p>æ¯æ¬¡æ‰§è¡Œæ ˆçš„ä»£ç å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ¯æ¬¡ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–çš„ä¸€ä¸ªäº‹ä»¶å›è°ƒå¹¶æ”¾åˆ°æ‰§è¡Œä¸­æ‰§è¡Œï¼‰ã€‚</p>
<p>æµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿä½¿å¾— JS å†…éƒ¨å®ä»»åŠ¡ä¸ DOM ä»»åŠ¡æœ‰åºåœ°æ‰§è¡Œï¼Œä¼šåœ¨å®ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œå¯¹é¡µé¢è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚</p>
<blockquote>
<p>å½“å‰å®ä»»åŠ¡ â†’ æ¸²æŸ“é¡µé¢ â†’ ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ â†’ ...</p>
</blockquote>
<p>å¸¸è§å®ä»»åŠ¡æœ‰ï¼š</p>
<ul>
<li><code>setInterval</code></li>
<li><code>setTimeout</code></li>
<li><code>setImmediate</code>ï¼ˆnode.jsï¼‰</li>
<li>XHR å›è°ƒ</li>
<li>äº‹ä»¶å›è°ƒï¼ˆé¼ æ ‡é”®ç›˜äº‹ä»¶ï¼‰</li>
<li>indexedDB æ•°æ®åº“ç­‰ I/O æ“ä½œ</li>
<li>æ¸²æŸ“ DOM</li>
</ul>
<h3>å¾®ä»»åŠ¡ï¼ˆMicrotaskï¼‰</h3>
<p>å½“å‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰ï¼ˆä¹Ÿåœ¨æ¸²æŸ“ DOM ä¹‹å‰ï¼‰ï¼Œç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
<blockquote>
<p>å½“å‰å®ä»»åŠ¡ â†’ å½“å‰å¾®ä»»åŠ¡ â†’ æ¸²æŸ“é¡µé¢ â†’ ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ â†’ ...</p>
</blockquote>
<p>å¸¸è§å¾®ä»»åŠ¡åŒ…æ‹¬ï¼š</p>
<ul>
<li>Promise çš„ <code>then</code>ã€<code>catch</code>ã€<code>finally</code> å›è°ƒã€‚</li>
<li><code>process.nextTick</code>ï¼ˆnode.jsï¼‰</li>
<li><code>MutationObserver</code></li>
<li><code>Object.observe</code>ï¼ˆå·²åºŸå¼ƒï¼‰</li>
</ul>
<h2>è¿è¡Œæœºåˆ¶</h2>
<ol>
<li>æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼ˆæ‰§è¡Œæ ˆä¸­æ²¡æœ‰å°±ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰ã€‚</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¾®ä»»åŠ¡ï¼Œå°±å°†å…¶æ·»åŠ åˆ°å¾®ä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ã€‚</li>
<li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œç«‹å³æ‰§è¡Œå½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„æ‰€æœ‰å¾®ä»»åŠ¡ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰ã€‚</li>
<li>å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¼€å§‹æ£€æŸ¥æ¸²æŸ“ï¼Œç„¶å GUI çº¿ç¨‹æ¥ç®¡æ¸²æŸ“ï¼ˆä½†æ˜¯ UI render ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œå› ä¸ºéœ€è¦è€ƒè™‘ UI æ¸²æŸ“æ¶ˆè€—çš„æ€§èƒ½å·²ç»æœ‰æ²¡æœ‰ UI å˜åŠ¨ï¼‰ã€‚</li>
<li>æ¸²æŸ“å®Œæ¯•åï¼ŒJS çº¿ç¨‹ç»§ç»­æ¥ç®¡ï¼Œå¼€å§‹ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰ã€‚</li>
<li>JS ä¸æ–­é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´è‡³æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚ï¼ˆæ ˆå†…å­˜æº¢å‡ºä¹Ÿä¼šç»ˆæ­¢æ‰§è¡Œï¼‰ã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c74eab1f1485b08d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>References</h2>
<ul>
<li><a href="https://www.jianshu.com/p/184988903562">JS äº‹ä»¶å¾ªç¯</a></li>
<li><a href="https://www.cnblogs.com/cangqinglang/p/8967268.html">è¯¦è§£ JavaScript ä¸­çš„ Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰æœºåˆ¶ï¼ˆå« node ç¯å¢ƒä¸‹çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼‰</a></li>
<li><a href="https://www.cnblogs.com/ckAng/p/11133643.html">JS å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html">JavaScript è¿è¡Œæœºåˆ¶è¯¦è§£ï¼šå†è°ˆ Event Loopï¼ˆé˜®ä¸€å³°ï¼‰</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI3NTM5NDgzOA==&amp;mid=2247484039&amp;idx=1&amp;sn=e70e5b6473917dcf71bfd3f60ddb2a7d&amp;chksm=eb043afedc73b3e8fb3ac90613d52d14cd165d358912e519e13f25bbd236c3591386fb2e349a&amp;token=1983269989&amp;lang=zh_CN&amp;scene=21#wechat_redirect">æ·±å…¥è§£æ Event Loop å’Œæµè§ˆå™¨æ¸²æŸ“ã€å¸§åŠ¨ç”»ã€ç©ºé—²å›è°ƒçš„å…³ç³»</a></li>
<li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&amp;ab_channel=JSConf">JSConf.Asia - In the loop</a></li>
<li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">Tasks, microtasks, queues and schedules</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[H5 å”¤èµ·åŸç”Ÿ APP]]></title>
            <link>https://github.com/toFrankie/blog/issues/194</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/194</guid>
            <pubDate>Sun, 26 Feb 2023 08:58:00 GMT</pubDate>
            <description><![CDATA[<p>å¯ä»¥çœ‹çœ‹ä»¥ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢åˆ—ä¸¾äº† URL Schemeã€Intentã€Universal Link ä¸‰ç§æ–¹å¼å”¤é†’ APP çš„å‘ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ³•ã€‚æ–‡ç« æœ€åå»ºè®®ä½¿ç”¨ä¸€ä¸ª <a href="https://github.com/suanmei/callapp-lib">callapp-lib</a> åº“å»å…¼]]></description>
            <content:encoded><![CDATA[<p>å¯ä»¥çœ‹çœ‹ä»¥ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢åˆ—ä¸¾äº† URL Schemeã€Intentã€Universal Link ä¸‰ç§æ–¹å¼å”¤é†’ APP çš„å‘ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ³•ã€‚æ–‡ç« æœ€åå»ºè®®ä½¿ç”¨ä¸€ä¸ª <a href="https://github.com/suanmei/callapp-lib">callapp-lib</a> åº“å»å…¼å®¹ç»å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ã€‚<a href="https://github.com/suanmei/callapp-lib">é›·é”‹æŒ‡è·¯ ğŸ‘‰ç‚¹æˆ‘</a></p>
<blockquote>
<p>æ–‡ç« å‡ºå¤„ï¼šæ‹¾å£¹å°ç­‘ â€”â€” <a href="https://suanmei.github.io/2018/08/23/h5_call_app/#more">H5 å”¤èµ· APP æŒ‡å—</a></p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº onbeforeunload]]></title>
            <link>https://github.com/toFrankie/blog/issues/193</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/193</guid>
            <pubDate>Sun, 26 Feb 2023 08:56:49 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p><a href="https://www.cnblogs.com/strangerqt/p/3630040.html">åŸæ–‡</a></p>
</blockquote>
<p>é¡µé¢åœ¨å…³é—­å‰ä¼šæœ‰ <code>onbeforeUnload</code> äº‹ä»¶ï¼Œæ¥è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦å…³é—­è¿™ä¸ªé¡µé¢/æ ‡]]></description>
            <content:encoded><![CDATA[<blockquote>
<p><a href="https://www.cnblogs.com/strangerqt/p/3630040.html">åŸæ–‡</a></p>
</blockquote>
<p>é¡µé¢åœ¨å…³é—­å‰ä¼šæœ‰ <code>onbeforeUnload</code> äº‹ä»¶ï¼Œæ¥è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦å…³é—­è¿™ä¸ªé¡µé¢/æ ‡ç­¾ã€‚</p>
<ul>
<li>æµè§ˆå™¨çš„ F5 åˆ·æ–°ä¸ºï¼š<code>onbeforeUnload â†’ onunload â†’ onload</code>ã€‚</li>
<li>æµè§ˆå™¨å…³é—­ä¸ºï¼š<code>onbeforeUnload â†’ onunload</code>ï¼›</li>
</ul>
<p>åœ¨ <code>window.onbeforeunload</code> çš„æ–¹æ³•ä½“ä¸­ç”¨ <code>alert</code> æˆ– <code>confirm</code> è¿™æ ·çš„æ–¹æ³•åœ¨ IE ä¸­æ˜¯æœ‰æ•ˆçš„ï¼Œä¼šå¼¹å‡ºæ¥ï¼Œç‚¹å‡»åé¡µé¢ä¹Ÿä¼šå…³é—­ã€‚<code>confirm</code> ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå³ä½¿ä½  <code>confirm</code> ç‚¹å‡»äº†å–æ¶ˆè¿˜æ˜¯ä¼šåˆ·æ–°/å…³é—­é¡µé¢ã€‚</p>
<p>è€Œåœ¨ç°ä»£æµè§ˆå™¨ Chromeã€Firefox ä¸­æ˜¯ä¸ä¼šå¼¹å‡ºæ¥çš„ï¼Œä½†æ˜¯ä¼šæ‰§è¡Œã€‚è¿™æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ª bug æˆ–è€…æœºåˆ¶å§ï¼Œåœ¨é¡µé¢å…³é—­å <code>alert</code> å’Œ <code>confirm</code> ç­‰å¼¹å‡ºæ¡†æ˜¯ä¸ä¼šå¼¹å‡ºæ¥çš„ã€‚æƒ³è¦ä¸€ä¸ªå¯ä»¥è®©ç”¨æˆ·é€‰æ‹©çš„æ˜¯å¦å…³é—­çš„åŠæ³•ï¼Œ<code>alert</code> å’Œ <code>confirm</code> æ˜¯ä¸å¯è¡Œçš„ã€‚</p>
<p>ç½‘ä¸ŠæŸ¥äº†ä¸‹èµ„æ–™å‘ç°ç”¨ <code>event.returnValue = 'ä½ æƒ³è®©ç”¨æˆ·çœ‹åˆ°çš„ä¿¡æ¯'</code> è¿™æ ·çš„æ–¹æ³•å¯ä»¥åœ¨é¡µé¢è¢«å…³é—­ä¹‹å‰è®©ç”¨æˆ·çœ‹åˆ°æç¤ºä¿¡æ¯â€œè¿™ä¸ªé¡µé¢è¦è¢«å…³é—­äº†ï¼Œä½ æƒ³å…³é—­è¿˜æ˜¯ä¸å…³é—­ï¼Ÿâ€æ¥è®©ç”¨æˆ·è¿›è¡Œé€‰æ‹©ã€‚</p>
<p>IE8ã€Chrome å¯ä»¥è®©ç”¨æˆ·å®Œå…¨çœ‹åˆ°ä½  <code>rerturnValue</code> ä¸­çš„ä¿¡æ¯ï¼ŒFirefox çš„å†…å®¹å°±æ˜¯æµè§ˆå™¨è‡ªå¸¦çš„ï¼Œä¸ç®¡ä½ <code>returnValue</code> è®¾ç½®çš„æ˜¾ç¤ºå†…å®¹æ˜¯å¦‚ä½•ï¼Œå®ƒå§‹ç»ˆæ˜¾ç¤ºè‡ªå¸¦çš„ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://www.zhangxinxu.com/wordpress/2021/11/js-visibilitychange-pagehide-lifecycle/">æ·±åº¦å¥½æ–‡ï¼šä» js visibilitychange Safari ä¸‹æ— æ•ˆè¯´å¼€å»</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åˆè¯† JavaScript å‡½æ•° Arguments æ¨¡æ‹Ÿé‡è½½]]></title>
            <link>https://github.com/toFrankie/blog/issues/192</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/192</guid>
            <pubDate>Sun, 26 Feb 2023 08:44:51 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ JavaScript ä¸­å¹¶æ²¡æœ‰é‡è½½å‡½æ•°çš„åŠŸèƒ½ï¼Œä½†æ¯ä¸ªå‡½æ•°ä¸­çš„ Arguments å¯¹è±¡å¯ä»¥æ¨¡æ‹Ÿé‡è½½çš„å®ç°ã€‚</p>
<h4>1. é€šè¿‡ä¸‹æ ‡è®¿é—®å®å‚ï¼š</h4>
<p><code>arguments</code> ä¸æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰æ•°ç»„å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†é€šè¿‡ <code>arguments[0]</c]]></description>
            <content:encoded><![CDATA[<p>åœ¨ JavaScript ä¸­å¹¶æ²¡æœ‰é‡è½½å‡½æ•°çš„åŠŸèƒ½ï¼Œä½†æ¯ä¸ªå‡½æ•°ä¸­çš„ Arguments å¯¹è±¡å¯ä»¥æ¨¡æ‹Ÿé‡è½½çš„å®ç°ã€‚</p>
<h4>1. é€šè¿‡ä¸‹æ ‡è®¿é—®å®å‚ï¼š</h4>
<p><code>arguments</code> ä¸æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰æ•°ç»„å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†é€šè¿‡ <code>arguments[0]</code>ã€<code>arguments[1]</code> ç­‰æ–¹å¼è·å–å®å‚ã€‚</p>
<pre><code class="language-js">function demo() {
  let str = ''
  for (let i = 0; i &lt; arguments.length; i++) {
    str += arguments[i] + ', '
  }
}
console.log(demo('å°æ˜', 'å°çº¢')) // è¾“å‡ºï¼šå°æ˜, å°çº¢,
</code></pre>
<h4>2. å®ç°é‡è½½</h4>
<p>åˆ©ç”¨ Arguments å¯¹è±¡å®ç°å‡½æ•°é‡è½½çš„æ–¹å¼å¯ä»¥æœ‰å‡ ç§ï¼Œé™¤äº†æ ¹æ®å‚æ•°çš„ä¸ªæ•°ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¼ å…¥å‚æ•°çš„ç±»å‹ã€æˆ–è€…åˆ©ç”¨å‚æ•°ä¸­ç‰¹æ®Šçš„å‚æ•°å€¼æ¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</p>
<pre><code class="language-js">// é€šè¿‡å‚æ•°ä¸ªæ•°å®ç°é‡è½½
function overloadDemo() {
  switch (arguments.length) {
    case 0:
      console.log(0)
      break
    case 1:
      console.log(1)
      break
    default:
      console.log(arguments.length)
      break
  }
}
overloadDemo('name') // è¾“å‡ºï¼š1
</code></pre>
<h4>3. callee å±æ€§</h4>
<p>Arguments å¯¹è±¡çš„ <code>callee</code> å±æ€§æŒ‡å‘çš„æ˜¯<strong>æ­£åœ¨è¢«æ‰§è¡Œçš„ Function å¯¹è±¡</strong>ã€‚å¸¸å¸¸åˆ©ç”¨è¯¥å±æ€§å®ç°é€’å½’ã€‚</p>
<pre><code>function sum(n) {
  if (n == 1) {
    return 1
  } else {
    return n + arguments.callee(n - 1)
  }
}
console.log(sum(5)) // è¾“å‡ºï¼š15
</code></pre>
<blockquote>
<p>ä½†æ˜¯ <code>arguments.callee</code> å’Œ <code>arguments.caller</code> å·²ç»åœ¨ ES5 ä¸¥æ ¼æ¨¡å¼ä¸­ç¦ç”¨ï¼Œå°†æ¥ä¹Ÿä¼šå½»åº•ç§»é™¤ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Vue ç»„ä»¶ä¹‹é—´é€šä¿¡ä»¥åŠçŠ¶æ€ç®¡ç†æ¨¡å¼ï¼ˆVuexï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/191</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/191</guid>
            <pubDate>Sun, 26 Feb 2023 08:36:20 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€ä½¿ç”¨ props</h3>
<p><code>props</code> ç”¨äºæ¥æ”¶æ¥è‡ªçˆ¶ç»„ä»¶çš„æ•°æ®ã€‚<code>props</code> å¯ä»¥æ˜¯ç®€å•çš„æ•°ç»„ï¼Œæˆ–è€…ä½¿ç”¨å¯¹è±¡ä½œä¸ºæ›¿ä»£ï¼Œå¯¹è±¡å…è®¸é…ç½®é«˜çº§é€‰é¡¹ï¼Œå¦‚ç±»å‹æ£€æµ‹ã€è‡ªå®šä¹‰æ ¡éªŒå’Œè®¾ç½®é»˜è®¤å€¼ã€‚<strong>è¿™ç§æ–¹å¼ï¼Œä¸èƒ½åœ¨å­ç»„ä»¶æ›´æ”¹çˆ¶ç»„ä»¶çš„å¯¹åº”çš„å±æ€§å€¼</stro]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€ä½¿ç”¨ props</h3>
<p><code>props</code> ç”¨äºæ¥æ”¶æ¥è‡ªçˆ¶ç»„ä»¶çš„æ•°æ®ã€‚<code>props</code> å¯ä»¥æ˜¯ç®€å•çš„æ•°ç»„ï¼Œæˆ–è€…ä½¿ç”¨å¯¹è±¡ä½œä¸ºæ›¿ä»£ï¼Œå¯¹è±¡å…è®¸é…ç½®é«˜çº§é€‰é¡¹ï¼Œå¦‚ç±»å‹æ£€æµ‹ã€è‡ªå®šä¹‰æ ¡éªŒå’Œè®¾ç½®é»˜è®¤å€¼ã€‚<strong>è¿™ç§æ–¹å¼ï¼Œä¸èƒ½åœ¨å­ç»„ä»¶æ›´æ”¹çˆ¶ç»„ä»¶çš„å¯¹åº”çš„å±æ€§å€¼</strong>ã€‚</p>
<pre><code class="language-vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;child message=&quot;è¿™æ˜¯çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶çš„ä¿¡æ¯&quot;&gt;&lt;/child&gt;
&lt;/template&gt;

&lt;script&gt;
import Child from '../xxx/xxx'
export default {
  components: { Child }
}
&lt;/script&gt;
</code></pre>
<pre><code class="language-vue">&lt;!-- å­ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;div&gt;{{ message }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  props: ['message']
}
&lt;/script&gt;
</code></pre>
<blockquote>
<p><code>props</code> æ˜¯å•å‘ç»‘å®šçš„ï¼šå½“çˆ¶ç»„ä»¶çš„å±æ€§å˜åŒ–æ—¶ï¼Œå°†ä¼ å¯¼ç»™å­ç»„ä»¶ï¼Œä½†æ˜¯ä¸ä¼šåè¿‡æ¥ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å­ç»„ä»¶æ— æ„ä¿®æ”¹äº†çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚</p>
<p>è‹¥ä¸€å®šè¦æ”¹ï¼Œåªèƒ½é€šè¿‡å­ç»„ä»¶ <code>$emit()</code>ï¼Œçˆ¶ç»„ä»¶ <code>$on()</code> è¿›è¡Œå“åº”æ›´æ”¹ï¼Œå¦‚åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼Œå³ <code>Vuex</code>ã€‚ä¸‹é¢ä¼šè®²è¿°è¿™ä¸¤ç§æ–¹å¼çš„å…·ä½“ä½¿ç”¨æ–¹å¼ã€‚</p>
</blockquote>
<h3>äºŒã€$emit()ã€$on() éçˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡ï¼ˆç®€å•åœºæ™¯ï¼‰</h3>
<blockquote>
<p><code>$emit()</code>å’Œ <code>$on()</code>å’Œçš„äº‹ä»¶å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªå…¬å…±çš„å®ä¾‹ä¸Šï¼Œæ‰èƒ½è§¦å‘ã€‚å®˜æ–¹æ–‡æ¡£é‡Œè¿™ä¸ªä¸»è¦ç”¨äºéçˆ¶å­ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚</p>
<p>ä¸‹é¢å¯¹è¿™ä¸ªä¾‹å­ç®€å•ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
</blockquote>
<pre><code class="language-js">// æ–°å»ºä¸€ä¸ªå…¬å…±ç¤ºä¾‹
// bus.js
import Vue from 'vue'
export const bus = new Vue()
</code></pre>
<pre><code class="language-vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;child :message=&quot;message&quot;&gt;&lt;/child&gt;
&lt;/template&gt;

&lt;script&gt;
import Child from '../xxx/xxx'
// å¼•å…¥å…¬å…±å®ä¾‹
import { bus } = from 'xxx/bus.js'
export default {
    components: {Child},
    data() {
      return {
         message: 'è¿™æ˜¯çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶çš„ä¿¡æ¯'
      }
    },
  mounted() {
    // $on() å“åº”
    bus.$on('change', (msg) =&gt; {
      console.log(msg)
    })
  }
}
&lt;/script&gt;
</code></pre>
<pre><code class="language-vue">&lt;!-- å­ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;div&gt;{{ message }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { bus } from 'xxx/bus.js'
export default {
  props: ['message'],
  watch: {
    message(newVal, oldVal) {
      // é€šè¿‡ $emit() å»è§¦å‘
      bus.$emit('change', 'è¦æ”¹å˜çš„å€¼')
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3>ä¸‰ã€ä½¿ç”¨ Vuex è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼ˆä¸»è¦ç”¨äºè¾ƒä¸ºå¤æ‚åœºæ™¯ï¼‰ï¼Œåˆ’é‡ç‚¹</h3>
<ol>
<li>å®‰è£… <a href="https://vuex.vuejs.org/zh/installation.html">Vuex</a></li>
</ol>
<pre><code>npm install vuex --save
</code></pre>
<ol start="2">
<li>æ–°å»º <code>store.js</code> ï¼Œå°† Vuex æ”¾åœ¨é‡Œé¢ï¼Œæˆ‘å°±ä¸æ”¾ <code>main.js</code> é‡Œäº†</li>
</ol>
<pre><code class="language-js">import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

/**
 * è¯´æ˜ï¼š
 *
 * ä¸€ã€Mutations
 * 1. æ›´æ”¹ Vuex çš„ store ä¸­çš„çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•æ˜¯æäº¤ mutation
 * 2. ä¸€æ¡é‡è¦çš„åŸåˆ™å°±æ˜¯è¦è®°ä½ mutation å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°
 *
 * äºŒã€Action
 * 1. action æäº¤çš„æ˜¯ mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€
 * 2. action å¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œ
 * 3. æ‰€ä»¥æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ action å»æäº¤ mutationï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªå¼‚æ­¥æ“ä½œ
 *
 */

const store = new Vuex.Store({
  // å®šä¹‰çŠ¶æ€
  state: {
    message: ''
  },
  mutations: {
    changeMessage(state, payload) {
      // çŠ¶æ€å˜æ›´
      state.message = payload
    }
  },
  actions: {
    changeMessage(context, args) {
      context.commit('changeMessage', args)
      setTimeout(() =&gt; {
        // 1.5s åç½®ç©º
        context.commit('changeMessage', '')
      }, 1500)
    }
  }
})

export default store
</code></pre>
<p>3). <code>main.js</code> å¼•å…¥</p>
<pre><code class="language-js">import Vue from 'vue'
import App from './App.vue'
import store from './store.js'

new Vue({
  el: '#app',
  store,
  render: h =&gt; h(App)
})
</code></pre>
<p>4). æäº¤è½½è·ã€åˆ†å‘ Actionã€è·å–çŠ¶æ€</p>
<pre><code class="language-js">// ä»¥ä¸‹ this æŒ‡å‘ vue å®ä¾‹

// æäº¤ Payloadï¼Œä»…æ”¯æŒåŒæ­¥æ“ä½œ
this.$store.commit('changeMessage', 'any')

// åˆ†å‘ Actionï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œ
this.$store.dispatch('changeMessage', 'any')

// è·å– state
const var1 = this.$store.state.message
</code></pre>
<blockquote>
<p>å†™å¾—æœ‰ç‚¹å•°å—¦äº†ï¼Œæ›´å…·ä½“æˆ–è€…ç»†èŠ‚çš„åœ°æ–¹ï¼Œéº»çƒ¦ç§»æ­¥å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://vuex.vuejs.org/zh/">Vuex æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
</blockquote>
<p>å•Šå•Šå•Šï¼Œä¸æƒ³å†™äº†ï¼Œå¥½äº†ï¼Œå°±åˆ°æ­¤ä¸ºæ­¢å§ã€‚æœ‰ç–‘é—®çš„ç•™æ„ï¼Œå°½æˆ‘æ‰€ä¼šçš„å›ç­”ã€‚ï¼ˆå¦‚æœ‰æ›´å¥½çš„æ–¹å¼ï¼Œæˆ–è€…æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºï¼ï¼‰</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Vue å®ç°å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿]]></title>
            <link>https://github.com/toFrankie/blog/issues/190</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/190</guid>
            <pubDate>Sun, 26 Feb 2023 08:35:48 GMT</pubDate>
            <description><![CDATA[<p>å®˜ç½‘ï¼š<a href="https://www.npmjs.com/package/vue-clipboard2">ç‚¹å‡»è·³è½¬</a></p>
<ol>
<li>
<p>å®‰è£… <code>npm install --save vue-clipboard2</code></p>
</li>
<li>
<p>å¼•å…¥ï¼ˆæˆ‘ä¸€]]></description>
            <content:encoded><![CDATA[<p>å®˜ç½‘ï¼š<a href="https://www.npmjs.com/package/vue-clipboard2">ç‚¹å‡»è·³è½¬</a></p>
<ol>
<li>
<p>å®‰è£… <code>npm install --save vue-clipboard2</code></p>
</li>
<li>
<p>å¼•å…¥ï¼ˆæˆ‘ä¸€èˆ¬åœ¨ <code>main.js</code> å¼•å…¥ï¼Œå¦‚æœä»…ä»…æ˜¯æŸä¸€å°æ¨¡å—ç”¨åˆ°ï¼Œåœ¨å¯¹åº”çš„ <code>component</code> å¼•å…¥å³å¯ï¼‰</p>
</li>
</ol>
<pre><code class="language-js">import Vue from 'vue'
import VueClipboard from 'vue-clipboard2'
 
Vue.use(VueClipboard)
</code></pre>
<p>3ã€ä½¿ç”¨</p>
<pre><code class="language-js">const message = 'æ‹·è´çš„æ–‡æœ¬'
this.$copyText(message)
  .then(res =&gt; {
    alert('Copied')
  })
  .catch(err =&gt; {
    alert('Can not copy')
  })
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JS ä¸­æ–‡è½¬æ¢æ‹¼éŸ³çš„å®ç°]]></title>
            <link>https://github.com/toFrankie/blog/issues/189</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/189</guid>
            <pubDate>Sun, 26 Feb 2023 08:31:53 GMT</pubDate>
            <description><![CDATA[<h2>å†™åœ¨å‰é¢</h2>
<p>æˆ–è®¸ä½ éœ€è¦çš„æ˜¯ï¼š</p>
<ul>
<li><a href="https://github.com/zh-lx/pinyin-pro">pinyin-pro</a> â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</li>
<li><a href="https://github.com/hotoo/pinyin]]></description>
            <content:encoded><![CDATA[<h2>å†™åœ¨å‰é¢</h2>
<p>æˆ–è®¸ä½ éœ€è¦çš„æ˜¯ï¼š</p>
<ul>
<li><a href="https://github.com/zh-lx/pinyin-pro">pinyin-pro</a> â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</li>
<li><a href="https://github.com/hotoo/pinyin">pinyin</a></li>
</ul>
<h2>éœ€æ±‚</h2>
<p>æ­¤å‰é¡¹ç›®ä¸­æœ‰ä¸€ä¸ª<strong>ä¸­æ–‡è½¬æ‹¼éŸ³</strong>çš„éœ€æ±‚ï¼Œäºæ˜¯æ•´ç†äº†ä¸€ä¸‹å®ç°æ–¹æ³•ã€‚</p>
<blockquote>
<p>åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œè¿™é‡Œæˆ‘ä¿ç•™äº†æ•°å­—å’Œå­—æ¯ï¼Œå…¶ä»–ç‰¹æ®Šå­—ç¬¦æˆ–è€…ç©ºæ ¼å°†ä¼šè¢«å»æ‰ã€‚å¦‚ <code>æµ‹è¯•</code> ä¼šè¢«è½¬æ¢æˆ <code>CeShi</code>ã€‚ï¼ˆå¯è‡ªè¡Œä¿®æ”¹ <code>convert2Pinyin()</code> æ–¹æ³•å®ç°å…¶ä»–éœ€æ±‚ï¼‰</p>
</blockquote>
<h2>å®ç°</h2>
<p>è¯ä¸å¤šè¯´ï¼ˆ<a href="https://github.com/toFrankie/javascript-utils/blob/master/examples/convert2Pinyin.html">Github Demo</a>ï¼‰</p>
<pre><code class="language-html">&lt;!-- html --&gt;
&lt;input id=&quot;input&quot; value=&quot;æµ‹è¯•&quot; /&gt;
&lt;input id=&quot;output&quot; disabled /&gt;
</code></pre>
<pre><code class="language-js">// js
window.onload = () =&gt; {
  const input = document.getElementById('input')
  const output = document.getElementById('output')

  // å¤±ç„¦è¿›è¡Œè½¬æ¢
  input.addEventListener('blur', () =&gt; {
    const val = input.value
    output.value = convertToPinyin(val)
  })

  /**
   * è½¬æ¢æˆæ‹¼éŸ³ï¼ˆè‹¥æœ‰ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦å°†è¢«ç§»é™¤ï¼‰
   *
   * @param {string} sourceStr åŸå§‹æ•°æ®
   */
  const convertToPinyin = sourceStr =&gt; {
    // ç›®æ ‡æ•°æ®
    let targetStr = ''
    // åŒ¹é…ä¸­æ–‡
    const cnReg = /[\u4e00-\u9fa5]/
    // åŒ¹é…æ•°å­—å’Œè‹±æ–‡
    const enReg = /[a-zA-Z0-9]/
    // ä¿ç•™è‹±æ–‡å’Œæ•°å­—
    const keep = true

    // éå†æºæ•°æ®
    for (let i = 0, len = sourceStr.length; i &lt; len; i++) {
      const str = sourceStr.substr(i, 1)
      if (keep &amp;&amp; enReg.test(str)) {
        targetStr += str
      } else if (cnReg.test(str)) {
        const searchResult = searchPinYin(str, PinYin)
        if (searchResult) {
          // targetStr += searchResult
          targetStr += capitalize(searchResult) // é¦–å­—æ¯å¤§å†™
        }
      }
    }

    return targetStr
  }

  /**
   * æ£€ç´¢æ‹¼éŸ³
   *
   * @param {string} str æºå­—ç¬¦ä¸²
   * @param {object} data æ”¶é›†çš„æ‹¼éŸ³ Unicode ç¼–ç é›†åˆ
   */
  const searchPinYin = (str, data) =&gt; {
    for (const key in data) {
      if (data.hasOwnProperty(key) &amp;&amp; data[key].indexOf(str) !== -1) {
        return key
      }
    }
    return ''
  }

  /**
   * å°†æ‹¼éŸ³é¦–å­—æ¯è½¬æ¢ä¸ºå¤§å†™
   *
   * @param {string} str æºå­—ç¬¦ä¸²
   */
  const capitalize = str =&gt; {
    if (str) {
      const [first] = str
      const other = str.replace(/^\S/, '')
      return `${first.toUpperCase()}${other}`
    }
    return str
  }

  /**
   * ç›®å‰è¿™ä¸ª 16 è¿›åˆ¶ Unicode ç¼–ç æ˜¯ç½‘ä¸Šæ”¶é›†çš„ï¼Œå¯èƒ½ä¸èƒ½è¦†ç›–æ‰€æœ‰çš„ä¸­æ–‡å­—ç¬¦ï¼Œå¯ä»¥è‡ªè¡Œè¡¥å……ï¼›
   *
   * ä¾‹å¦‚ï¼šâ€˜å©‹â€™ï¼ˆxiaoï¼‰å­—ï¼š
   * 1ã€ä½¿ç”¨ 'å©‹'.charCodeAt(0).toString(16) å¾—åˆ° Unicode ç¼–ç ï¼š5a4bï¼›
   * 2ã€å°†ç¼–ç å‰é¢åŠ ä¸Šï¼š\u =&gt; \u5a4b;
   * 3ã€ç„¶åæ”¾åˆ°å¯¹è±¡ PinYin['xiao'] é‡Œé¢ã€‚
   *
   * ç°åœ¨åªæƒ³åˆ°äº†è¿™ç§ç¬¨æ–¹æ³•ä¸€ä¸ªä¸€ä¸ªå¾€é‡Œè¡¥å……ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæ¬¢è¿æŒ‡å‡ºï¼ï¼ï¼
   */
  const PinYin = {
    a: '\u554a\u963f\u9515'
    // ...
    // ç”±äºè¿™å—ä»£ç å¤ªå¤šï¼Œè¿™é‡Œçœç•¥å°±ä¸è´´ä¸Šæ¥äº†ï¼Œéº»çƒ¦è¯·çœ‹ GitHub Demoã€‚
  }
}

</code></pre>
<h2>éš¾ç‚¹</h2>
<p>å…¶å®åœ¨ä¸­æ–‡è½¬æ‹¼éŸ³çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒéº»çƒ¦çš„åœ¨äº <code>å¤šéŸ³å­—</code> å’Œ <code>ç”Ÿåƒ»å­—</code> çš„å®ç°ï¼Œæˆ‘æƒ³åˆ°çš„è§£å†³æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>
<p><strong>ç”Ÿåƒ»å­—</strong>ï¼šæ˜¯ç”±äº <code>PinYin</code> é‡Œé¢åˆ—ä¸¾çš„ç¼ºå¤±ä¸€äº›ä¸­æ–‡å­—ç¬¦ï¼Œå¯é€šè¿‡ <code>str.charCodeAt(0).toString(16)</code> çš„æ–¹å¼è¡¥å……ï¼Œå…·ä½“æ–¹æ³•ä¸å†èµ˜è¿°ï¼Œä¸Šé¢æœ‰è¯´æ˜ã€‚</p>
</li>
<li>
<p><strong>å¤šéŸ³å­—</strong>ï¼šå…¶å®å¤šéŸ³å­—ä¸€ç›´æ˜¯æœ€éº»çƒ¦çš„åœ°æ–¹ï¼Œå› ä¸ºæ¯ä¸€ä¸ªä¸­æ–‡å­—ç¬¦åªæœ‰ä¸€ä¸ªå¯¹åº”çš„ Unicode ç¼–ç ï¼Œæ‰€ä»¥éœ€è¦åœ¨å¯¹è±¡çš„å¤šä¸ªå¯¹åº”å±æ€§ä¸Šæ·»åŠ ç¼–ç ã€‚
å¦‚ <code>æ›¾</code> å­—ï¼Œé€šè¿‡ <code>'æ›¾'.charCodeAt(0).toString(16)</code> è·å–åˆ° <code>66fe</code>ï¼Œç„¶åå‰é¢æ‹¼æ¥ä¸Š <code>\u</code>ï¼Œå¾—åˆ° <code>\u66fe</code>ã€‚</p>
</li>
</ol>
<pre><code>// æˆªå– PinYin ä¸€å°éƒ¨åˆ†
const PinYin = {
  ceng: '\u66fe',
  zeng: '\u66fe'
}
</code></pre>
<p>ç„¶åä¿®æ”¹ä¸Šè¿° <code>convert2Pinyin()</code> å’Œ <code>searchPinYin()</code> æ–¹æ³•ï¼ŒæŠŠç¬¦åˆè§„åˆ™çš„å­—ç¬¦è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åç”¨<strong>æ’åˆ—ç»„åˆ</strong>çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰å¯èƒ½ã€‚</p>
<h2>GitHub</h2>
<p>è¯¥<a href="https://github.com/toFrankie/javascript-utils">ä»“åº“</a>é™¤äº†<strong>æ‹¼éŸ³è½¬ä¸­æ–‡</strong>ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–å®ç”¨æ–¹æ³•ï¼Œ<a href="https://github.com/toFrankie/javascript-utils">éº»çƒ¦ç§»æ­¥æŸ¥çœ‹</a>ã€‚å¦‚æœ‰æ›´å¥½çš„å®ç°æ–¹æ³•ï¼Œæ¬¢è¿ç•™è¨€ï¼Œè°¢è°¢ï¼</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº Flex å¸ƒå±€]]></title>
            <link>https://github.com/toFrankie/blog/issues/188</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/188</guid>
            <pubDate>Sun, 26 Feb 2023 08:28:38 GMT</pubDate>
            <description><![CDATA[<p>åœ¨é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¸¸é‡åˆ°æ°´å¹³å±…ä¸­ã€å‚ç›´å±…ä¸­çš„éœ€æ±‚ã€‚æŒºå¤šäººç¬¬ä¸€ä¸ªæƒ³åˆ°å¯èƒ½æ˜¯ï¼š<code>text-align</code>ã€<code>vertical-align</code>ï¼Œä½†è¿™ä¸¤ä¸ªå±æ€§<strong>ä»…é€‚ç”¨äºè¡Œå†…å…ƒç´ </strong> ã€‚</p>
<pre><code class="language-cs]]></description>
            <content:encoded><![CDATA[<p>åœ¨é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¸¸é‡åˆ°æ°´å¹³å±…ä¸­ã€å‚ç›´å±…ä¸­çš„éœ€æ±‚ã€‚æŒºå¤šäººç¬¬ä¸€ä¸ªæƒ³åˆ°å¯èƒ½æ˜¯ï¼š<code>text-align</code>ã€<code>vertical-align</code>ï¼Œä½†è¿™ä¸¤ä¸ªå±æ€§<strong>ä»…é€‚ç”¨äºè¡Œå†…å…ƒç´ </strong> ã€‚</p>
<pre><code class="language-css">{
  text-align: center;
  vertical-align: middle
}
</code></pre>
<p>æœ¬æ–‡ï¼Œä»‹ç»ä¸€äº›å¸¸è§çš„å±…ä¸­æ–¹æ³•ï¼ŒåŒ…æ‹¬æ°´å¹³å±…ä¸­ã€å‚ç›´å±…ä¸­ã€‚</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;!-- æ­¤å¤„çœç•¥ä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„ä»£ç ... --&gt;
    &lt;style&gt;
      .parent {
        width: 100px;
        height: 100px;
        border: 2px solid #f00; /* çº¢è‰² */
      }
      .child {
        width: 50px;
        height: 50px;
        border: 2px solid #00f; /* è“è‰² */
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;parent&quot;&gt;
      &lt;div class=&quot;child&quot;&gt;child&lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<ol>
<li>æ°´å¹³å±…ä¸­ï¼š<code>text-align: center</code> å’Œ <code>margin: 0 auto</code>ï¼Œå…¶ä¸­ <code>text-align</code> ä½œç”¨çš„å¯¹è±¡æ˜¯å®ƒçš„<strong>å­å…ƒç´ ï¼Œä¸”å¿…é¡»ä¸ºè¡Œå†…å…ƒç´ ï¼Œå—çº§å…ƒç´ æ— æ•ˆ</strong>ã€‚</li>
</ol>
<pre><code class="language-html">&lt;!-- æ ·å¼ --&gt;
&lt;style&gt;
  .parent {
    width: 100px;
    height: 100px;
    border: 2px solid #f00;
    text-align: center;
  }
  .child {
    width: 50px;
    height: 50px;
    border: 2px solid #00f;
  }
&lt;/style&gt;

&lt;!-- HTML --&gt;
&lt;div class=&quot;parent&quot;&gt;
  &lt;!-- å—çº§å…ƒç´  --&gt;
  &lt;div class=&quot;child&quot;&gt;child&lt;/div&gt;
  &lt;!-- è¡Œå†…å…ƒç´  --&gt;
  &lt;img src=&quot;./images/pic.jpg&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;
&lt;/div&gt;
</code></pre>
<p>ä¸‹ç­ç»§ç»­å†™ï¼Œå“ˆå“ˆå“ˆâ€¦â€¦</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript for å¾ªç¯æ¯”è¾ƒ]]></title>
            <link>https://github.com/toFrankie/blog/issues/187</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/187</guid>
            <pubDate>Sun, 26 Feb 2023 08:24:03 GMT</pubDate>
            <description><![CDATA[<ol>
<li>
<p>for å¾ªç¯çš„æ•ˆç‡é—®é¢˜æ¯”è¾ƒï¼Œå»ºè®®çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/23812134">æ·±å…¥äº†è§£ JavaScript ä¸­çš„ for å¾ªç¯</a></p>
</li>
<li>
<p>åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå¯¹è±¡</p>
</li>
</ol>
<p]]></description>
            <content:encoded><![CDATA[<ol>
<li>
<p>for å¾ªç¯çš„æ•ˆç‡é—®é¢˜æ¯”è¾ƒï¼Œå»ºè®®çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/23812134">æ·±å…¥äº†è§£ JavaScript ä¸­çš„ for å¾ªç¯</a></p>
</li>
<li>
<p>åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå¯¹è±¡</p>
</li>
</ol>
<pre><code>// å…¼å®¹å†™æ³•ï¼ŒJavaScript in æ“ä½œç¬¦å¯è·å–å¯¹è±¡çš„å±æ€§ï¼›delete æ“ä½œç¬¦åˆ™åˆ é™¤å±æ€§
function isEmptyObj(obj) {
  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      return false
    }
  }
  return true
}

// ES6 å†™æ³•
function isEmptyObj(obj) {
  return Object.keys(obj).length == 0
}
</code></pre>
<ol start="3">
<li>éå†æ•ˆç‡ï¼š<code>for &gt; for-of &gt; forEach &gt; filter &gt; map &gt; for-in</code>ã€‚è™½ç„¶ <code>for-in</code> éå† Array å…ƒç´ æ€§èƒ½æ²¡æœ‰æ™®é€šçš„ for å¾ªç¯å¥½ï¼Œä½†å¯¹äº <code>ç¨€ç–æ•°ç»„</code> çš„ä½¿ç”¨æ˜¯æå¥½çš„ï¼Œå°¤å…¶åœ¨æ•°ç»„é•¿åº¦å¾ˆå¤§çš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š</li>
</ol>
<pre><code>const arr = []
arr[99] = 'å“ˆå“ˆ'
arr[999] = 'å‘µå‘µ'
arr[9999] = 'æ»š'

// ä¼˜åŒ–ç‰ˆ for å¾ªç¯ï¼Œåªè®¡ç®—ä¸€æ¬¡æ•°ç»„é•¿åº¦ï¼ˆå…±éå†äº† 10000 æ¬¡ï¼‰
for (let i = 0, len = arr.length; i &lt; len; i++) {
  if (i in { '99': '', '999': '', '9999': '' }) {
    console.log(true + ' ' + i)
  } else {
    console.log(false)
  }
}

// for-inï¼ˆå…±éå†äº† 3 æ¬¡ï¼‰
for (const key in arr) {
  if (key in { '99': '', '999': '', '9999': '' }) {
    console.log(arr[key])
  }
}

// ä¸¤è€…éå†æ¬¡æ•°ç›¸å·®å¾ˆå¤§ï¼Œè¿™ç§æƒ…å†µä¸‹é‡‡ç”¨ for-in æ˜¯æ•ˆç‡é«˜å¾ˆå¤šã€‚
</code></pre>
<ol start="4">
<li>å¾ªç¯æ–¹å¼çš„æ¯”è¾ƒ</li>
</ol>
<table>
<thead>
<tr>
<th>éå†æ–¹å¼</th>
<th>æè¿°</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>for</td>
<td>æ•ˆç‡æœ€é«˜</td>
<td>æ”¹è¿›ç‰ˆ for å¾ªç¯ï¼šä½¿ç”¨ä¸€ä¸ªå˜é‡å­˜å‚¨æ•°ç»„çš„é•¿åº¦ï¼Œå¯ä»¥çœå»æ¯æ¬¡å¾ªç¯éƒ½å»è®¡ç®—æ•°ç»„é•¿åº¦</td>
</tr>
<tr>
<td>for-of</td>
<td>ES6 æ–°å¢çš„æ–¹æ³•ï¼Œæœ€ç®€æ´ã€æœ€ç›´æ¥çš„éå†æ•°ç»„å…ƒç´ çš„æ–¹æ³•ï¼Œä¸ºäº†æ”¹è¿› <code>forEach</code>ã€<code>for-in</code> ç¼ºé™·è€Œç”Ÿçš„æ–°æ–¹æ³•ã€‚æ”¯æŒæ•°ç»„ã€å¯¹è±¡ã€å­—ç¬¦ä¸²ã€Map å¯¹è±¡ã€Set å¯¹è±¡éå†</td>
<td>ä¸æ”¯æŒéå†æ™®é€šå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>for-in</code> ä»£æ›¿</td>
</tr>
<tr>
<td>forEach</td>
<td>æ¯æ‰§è¡Œä¸€éï¼Œéƒ½ä¼šæ‰§è¡Œ <code>callback(item, index, array)</code>ã€‚å…¶ä¸­ï¼Œ<code>item</code> æ˜¯å½“å‰é¡¹ï¼Œ<code>index</code> æ˜¯å½“å‰ç´¢å¼•é¡¹ï¼Œ<code>array</code> æ˜¯æ•°ç»„å¯¹è±¡æœ¬èº«</td>
<td>ä¸èƒ½ <code>break</code> ã€<code>continue</code> æˆ–è€… <code>return</code></td>
</tr>
<tr>
<td>filter</td>
<td>ç”¨æ¥ç­›é€‰ç¬¦åˆæŸç§æ¡ä»¶çš„å…ƒç´ ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ é‡æ–°ç»„æˆä¸€ä¸ªæ–°çš„æ•°ç»„</td>
<td></td>
</tr>
<tr>
<td>map</td>
<td>é¢å‘æ•°ç»„ï¼Œä¸æ”¹å˜åŸæ•°ç»„ã€‚å¯¹äº <code>æœªè¢«åˆå§‹åŒ–</code>ã€<code>è¢«åˆ é™¤é¡¹ï¼ˆdelete æ“ä½œç¬¦ï¼‰</code>ã€<code>æ•°ç»„çš„å±æ€§ï¼ˆarray.name='å°æ˜'ï¼‰</code> éƒ½ä¸ä¼šæ‰§è¡Œ <code>callback</code> å‡½æ•°</td>
<td></td>
</tr>
<tr>
<td>for-in</td>
<td><code>for-in</code> æ˜¯ä¸ºæ™®é€šå¯¹è±¡è®¾è®¡çš„ï¼Œ<code>for (var index in arr) { }</code> èµ‹å€¼ç»™ <code>index</code> çš„å€¼ä¸æ˜¯ç´¢å¼•å€¼ <code>1</code>ã€<code>2</code>ï¼Œè€Œæ˜¯å­—ç¬¦ä¸² <code>'1'</code>ï¼Œ<code>'2'</code>ã€‚</td>
<td><code>for-in</code> ç¼ºç‚¹æ›´åŠ æ˜æ˜¾ï¼Œå®ƒä¸ä»…éå†æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¿˜ä¼šéå†è‡ªå®šä¹‰çš„å±æ€§ï¼Œç”šè‡³åŸå‹é“¾ä¸Šçš„å±æ€§éƒ½è¢«è®¿é—®åˆ°ã€‚è€Œä¸”ï¼Œéå†æ•°ç»„å…ƒç´ çš„é¡ºåºå¯èƒ½æ˜¯éšæœºçš„ã€‚</td>
</tr>
</tbody>
</table>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Canvas ç”Ÿæˆå›¾ç‰‡æ¨¡ç³Šçš„è§£å†³æ–¹æ¡ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/186</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/186</guid>
            <pubDate>Sun, 26 Feb 2023 08:18:16 GMT</pubDate>
            <description><![CDATA[<p>è¯´æ˜ï¼šæœ¬æ–‡çœç•¥éƒ¨åˆ†éå…³é”®ä»£ç ï¼Œéº»çƒ¦è‡ªå·±è¡¥å…¨ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µï¼Œåœ¨é«˜æ¸…å±çš„è®¾å¤‡ä¸‹ï¼Œä»»ä½•ç»˜åˆ¶ canvas ä¸­çš„å›¾åƒã€æ–‡å­—ã€çº¿æ¡ã€å½¢çŠ¶éƒ½å¯èƒ½ä¼šå‡ºç°æ¨¡ç³Šçš„é—®é¢˜ã€‚å¯é€šè¿‡å¼•å…¥ GitHub ä¸­çš„ <a href="https://github.com/jondavidjohn/hidpi-canvas-polyfi]]></description>
            <content:encoded><![CDATA[<p>è¯´æ˜ï¼šæœ¬æ–‡çœç•¥éƒ¨åˆ†éå…³é”®ä»£ç ï¼Œéº»çƒ¦è‡ªå·±è¡¥å…¨ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µï¼Œåœ¨é«˜æ¸…å±çš„è®¾å¤‡ä¸‹ï¼Œä»»ä½•ç»˜åˆ¶ canvas ä¸­çš„å›¾åƒã€æ–‡å­—ã€çº¿æ¡ã€å½¢çŠ¶éƒ½å¯èƒ½ä¼šå‡ºç°æ¨¡ç³Šçš„é—®é¢˜ã€‚å¯é€šè¿‡å¼•å…¥ GitHub ä¸­çš„ <a href="https://github.com/jondavidjohn/hidpi-canvas-polyfill">hidpi-canvas</a> æœ‰æ•ˆåœ°è§£å†³ã€‚</p>
<ol>
<li>é¦–å…ˆå» GitHub ä¸‹è½½ <a href="https://github.com/jondavidjohn/hidpi-canvas-polyfill">hidpi-canvas.js</a> æ–‡ä»¶ï¼›</li>
<li>åœ¨é¡¹ç›®ä¸­å¼•å…¥ <code>hidpi-canvas.js</code> æ–‡ä»¶ï¼›</li>
<li>è°ƒç”¨ <code>getPixelRatio()</code> å‡½æ•°ï¼Œå¾—åˆ° <code>ratio</code> å€¼ï¼›</li>
<li>åœ¨ <code>drawImage()</code> ä¸­ï¼Œå°† <code>width</code> å’Œ <code>height</code> ä¹˜ä»¥ <code>ratio</code>ï¼›</li>
<li>æ•ˆæœå¦‚ä¸‹ï¼Œä½†æŠ±æ­‰ï¼Œæ²¡åšå¯¹æ¯”å›¾ï¼</li>
</ol>
<p>åœ¨éƒ¨åˆ† iOS è®¾å¤‡ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨ <code>image.onload</code> å¤±æ•ˆçš„é—®é¢˜ï¼Œä¼šå¯¼è‡´æ— æ³•å°†å›¾ç‰‡ç”»åˆ° <code>canvas</code> ä¸­ã€‚å¼•èµ·è¯¥ç°è±¡çš„åŸå› å¯èƒ½æ˜¯ï¼š</p>
<p>1ã€iOS ä¸­å­˜åœ¨ <code>image.onload</code> å¤±æ•ˆçš„é—®é¢˜ï¼ˆæ³¨æ„ï¼š<code>image.onload</code> æ‰§è¡Œçš„å‰ææ˜¯å›¾ç‰‡æ­£å¸¸åŠ è½½å®Œæˆï¼Œå¦‚æœç¨å¾®å‡ºé”™ï¼Œå°±ä¼šæ‰§è¡Œ <code>image.onerror</code> è€Œä¸æ˜¯ <code>image.onload</code>ï¼‰ï¼›
2ã€å¦‚æœ image.src æ˜¯ base64 æ ¼å¼æ–‡ä»¶ï¼Œä¸è¦è®¾ç½® <code>image.crossOrigin = &quot;anonymous&quot;</code>ï¼Œå¯èƒ½ä¼šå‡ºç°  <code>image.onload</code> æ— æ³•æ‰§è¡Œçš„é—®é¢˜ï¼Œä»è€Œæ— æ³•æ­£å¸¸ç”»å›¾ã€‚</p>
<blockquote>
<p>å…³äº onload å¤±æ•ˆçš„é—®é¢˜ï¼Œçœ‹ Stack Overflow è¿™ä¸ªè§£ç­”ï¼Œå¯èƒ½æ”¶è·æŒºå¤šçš„ï¼š<a href="https://stackoverflow.com/questions/18773531/iphone-img-onload-fails">IPhone img onload fails</a>ã€‚</p>
</blockquote>
<pre><code>&lt;!-- html --&gt;
&lt;div onclick=&quot;makeCanvasToPhoto()&quot; style=&quot;width: 100px; padding: 10px 30px; background: #eee; text-align: center;&quot;&gt;ç”Ÿæˆå›¾ç‰‡&lt;/div&gt;
&lt;canvas id=&quot;canvasBox&quot; style=&quot;margin: 50px auto;&quot;&gt;&lt;/canvas&gt;
&lt;!-- å¼•å…¥js --&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;canvas.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;hidpi-canvas.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<pre><code class="language-js">// canvas.js æ–‡ä»¶
function makeCanvasToPhoto() {
  const canvas = document.getElementById('canvasBox')
  const context = canvas.getContext('2d')
  const ratio = getPixelRatio(context) // å…³é”®ä»£ç 
  canvas.width = 300 * ratio // ç”»å¸ƒå®½åº¦
  canvas.height = 300 * ratio // ç”»å¸ƒé«˜åº¦
  const divWidth = 300 * ratio // ç”¨äºå†…å®¹å±…ä¸­
  const divHeight = 300 * ratio // ç”¨äºå†…å®¹å±…ä¸­

  // ç”»çŸ©å½¢
  context.beginPath()
  context.fillStyle = '#abcdef'
  context.fillRect(0, 0, divWidth, divHeight)
  context.closePath()

  // å›¾ç‰‡
  context.beginPath()
  const imgObj = new Image()
  imgObj.crossOrigin = 'anonymous' // åœ¨iOS 9è®¾å¤‡ä¸­ï¼Œå¦‚æœsrcæ˜¯base64æ ¼å¼ï¼Œè®¾ç½®äº†crossOrigin å±æ€§ï¼Œä¼šå¯¼è‡´æ— æ³•æ‰§è¡Œimage.onload è€Œæ‰§è¡Œimage.onerror å‡½æ•°
  imgObj.src = 'http://img0.imgtn.bdimg.com/it/u=458129248,1588126214&amp;fm=26&amp;gp=0.jpg'
  imgObj.onload = function () {
    const imgWidth = '150'
    const imgHeight = '150'
    context.drawImage(this, 50, 50, imgWidth * ratio, imgHeight * ratio)
  }
  context.closePath()

  // æ–‡æœ¬
  context.beginPath()
  context.font = '32px bold'
  context.fillStyle = '#1a1a1a'
  context.textAlign = 'center'
  context.textBaseline = 'middle'
  context.fillText('æ–‡æœ¬', 50, 240)
  context.closePath()

  context.drawImage(canvas, 0, 0, divWidth, divHeight)
  const base64Obj = canvas.toDataURL('image/png', 1)
  console.log(base64Obj)
}

function getPixelRatio(context) {
  const backingStore =
    context.backingStorePixelRatio ||
    context.webkitBackingStorePixelRatio ||
    context.mozBackingStorePixelRatio ||
    context.msBackingStorePixelRatio ||
    context.oBackingStorePixelRatio ||
    context.backingStorePixelRatio ||
    1
  return (window.devicePixelRatio || 1) / backingStore
}
</code></pre>
<p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8cbfb0ff01ad2e09.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JavaScript æ•°ç»„]]></title>
            <link>https://github.com/toFrankie/blog/issues/185</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/185</guid>
            <pubDate>Sun, 26 Feb 2023 08:12:39 GMT</pubDate>
            <description><![CDATA[<ol>
<li>ç­›é€‰æ»¡è¶³æ¡ä»¶çš„é¡¹</li>
</ol>
<pre><code class="language-js">const arr = [1, 6, 9, 3, 6, 56, 7, 36]
arr.filter(item =&gt; item &gt; 6 &amp;&amp; item &lt; 32) //]]></description>
            <content:encoded><![CDATA[<ol>
<li>ç­›é€‰æ»¡è¶³æ¡ä»¶çš„é¡¹</li>
</ol>
<pre><code class="language-js">const arr = [1, 6, 9, 3, 6, 56, 7, 36]
arr.filter(item =&gt; item &gt; 6 &amp;&amp; item &lt; 32) // è¾“å‡º [9, 7]
</code></pre>
<ol start="2">
<li>å»æ‰ç©ºå­—ç¬¦ã€ç©ºæ ¼å­—ç¬¦ä¸²ã€nullã€undefined</li>
</ol>
<pre><code class="language-js">const arr = ['A', '', 'B', null, undefined, 'C', ' ']
const newArr = arr.filter(
  item =&gt; item &amp;&amp; item.trim() // æ³¨ï¼šIE9(ä¸åŒ…å«IE9)ä»¥ä¸‹çš„ç‰ˆæœ¬æ²¡æœ‰trim()æ–¹æ³•
)
console.log(newArr) // è¾“å‡º ['A', 'B', 'C']
</code></pre>
<ol start="3">
<li>æ’åºï¼ˆæŒ‰å¯¹è±¡å±æ€§æ’åºï¼‰</li>
</ol>
<pre><code class="language-js">const fruit = [
  { id: 3, type: 'è‹¹æœ' },
  { id: 7, type: 'è‰è“' },
  { id: 2, type: 'æ¢¨å­' },
  { id: 6, type: 'å‡¤æ¢¨' },
]
function sortById(item1, item2) {
  // å‡åºï¼Œå¦‚é™åºï¼Œåè¿‡æ¥å³å¯
  return item1.id - item2.id
}
console.log(fruit.sort(sortById))

// è¾“å‡º [{id: 2, type: 'æ¢¨å­'}, {id: 3, type: 'è‹¹æœ'},{id: 6, type: 'å‡¤æ¢¨'},{id: 7, type: 'è‰è“'}]
// array.sort() æ–¹æ³•æ˜¯åœ¨åŸæ•°ç»„çš„åŸºç¡€ä¸Šé‡æ–°æ’åºï¼Œä¸ä¼šç”Ÿæˆå‰¯æœ¬ã€‚
</code></pre>
<ol start="4">
<li>æ•°ç»„å»é‡</li>
</ol>
<pre><code class="language-js">const newArr = arr.reduce((pre, cur) =&gt; {
  if (!pre.includes(cur)) {
    return pre.concat(cur)
  } else {
    return pre
  }
}, [])
console.log(newArr) // [1, 6, 9, 3, 56, 36]
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Muse UI é‡åˆ°çš„å‘]]></title>
            <link>https://github.com/toFrankie/blog/issues/184</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/184</guid>
            <pubDate>Sun, 26 Feb 2023 08:10:36 GMT</pubDate>
            <description><![CDATA[<p>æ–‡ä¸­è‹¥æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ï¼</p>
<p>æ•…äº‹èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘åšä¸€ä¸ªVueé¡¹ç›®ï¼Œä½¿ç”¨åˆ° <a href="http://www.muse-ui.org/#/index">Muse UI</a> ç»„ä»¶åº“ã€‚åˆšå¼€å§‹æ—¶æƒ³ç€èƒ½ç”¨ Material Design è®¾è®¡è§„èŒƒæ˜¯ä¸€ä»¶éå¸¸å¼€å¿ƒçš„äº‹æƒ…ï¼Œç„¶åäº‹æƒ…å¹¶ä¸ä¼šä¸€]]></description>
            <content:encoded><![CDATA[<p>æ–‡ä¸­è‹¥æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ï¼</p>
<p>æ•…äº‹èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘åšä¸€ä¸ªVueé¡¹ç›®ï¼Œä½¿ç”¨åˆ° <a href="http://www.muse-ui.org/#/index">Muse UI</a> ç»„ä»¶åº“ã€‚åˆšå¼€å§‹æ—¶æƒ³ç€èƒ½ç”¨ Material Design è®¾è®¡è§„èŒƒæ˜¯ä¸€ä»¶éå¸¸å¼€å¿ƒçš„äº‹æƒ…ï¼Œç„¶åäº‹æƒ…å¹¶ä¸ä¼šä¸€ç›´ç¾å¥½ä¸‹å»ã€‚ã€‚ã€‚</p>
<p>é¡¹ç›®æœ¬èº«éœ€è¦ç”¨åˆ° Material Icon å­—ä½“åŒ…ï¼Œä½†ç”±äºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…ç½‘ç»œæ— æ³•è®¿é—®ä¸€äº›å¤–ç½‘ã€‚äºæ˜¯é‡‡ç”¨äº†æœ¬åœ°åŒ–éƒ¨ç½²å­—ä½“çš„æ–¹æ³•ã€‚ä¸‹è½½ Material Icons å­—ä½“åŒ…ï¼Œç„¶åæ”¾åˆ° <code>static</code> é™æ€æ–‡ä»¶å¤¹ä¸­ï¼Œå†ä» <code>index.html</code> å¼•å…¥ã€‚</p>
<p>é—®é¢˜æ¥äº†ï¼š</p>
<blockquote>
<ol>
<li>åœ¨ç³»ç»Ÿé¦–é¡µï¼ˆè·¯ç”±æ˜¯ï¼š<code>/</code>ï¼‰ï¼Œå¯ä»¥æ­£å¸¸è¯»å–åˆ°å­—ä½“åŒ…ï¼Œæ‰€ä»¥é¡µé¢æ¸²æŸ“æˆåŠŸï¼Œæ²¡é—®é¢˜çš„ï¼ˆå›¾ä¸€ï¼‰ã€‚</li>
<li>å½“è¿›å…¥å…¶ä»–è·¯ç”±ï¼ˆä¾‹å¦‚è·¯ç”±ï¼š<code>/trip/history</code>ï¼Œå†å²è¡Œç¨‹ï¼‰ï¼Œåˆšè¿›å…¥é¡µé¢åŒæ ·æ˜¯æ¸²æŸ“æˆåŠŸã€‚å½“æ­¤æ—¶å¯¹é¡µé¢é‡æ–°åŠ è½½æ—¶ï¼Œå°±ä¼šå‡ºç°é”™è¯¯ï¼Œå­—ä½“å›¾æ ‡æ‰¾ä¸åˆ°ï¼Œåªæ˜¾ç¤ºäº†çš„å­—ä½“å›¾æ ‡åç§°ï¼ˆå›¾äºŒï¼‰ã€‚</li>
</ol>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5631ac7b7f54c111.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ä¸€ ç³»ç»Ÿé¦–é¡µ">
<img src="https://upload-images.jianshu.io/upload_images/5128488-1f711d008aa21028.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾äºŒ å†å²è¡Œç¨‹"></p>
<blockquote>
<p>å¯¹äºè¿™ä¸ª Bugï¼Œå¤§æ¦‚å›°æ‰°äº†æˆ‘ä¸€ä¸ªå¤šæœˆã€‚ä¸€åº¦å¾ˆæ— å¥ˆè§£å†³ä¸äº†ï¼Œç”šè‡³æƒ³è¿‡æ”¾å¼ƒä½¿ç”¨ Muse UIã€‚ç›´åˆ°ä»Šå¤©æ‰å‘ç°é—®é¢˜æ‰€åœ¨ï¼Œç„¶åå°±è§£å†³äº†ã€‚</p>
</blockquote>
<p>æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ–¹æ³•å¼•å…¥ï¼ˆæœ€åå°±åœ¨è¿™é‡Œè§£å†³çš„ï¼Œå°±æ˜¯ä¸€ä¸ªé€€æ ¼é”®çš„äº‹ï¼‰ï¼š</p>
<pre><code class="language-html">// index.html
&lt;link rel=&quot;stylesheet&quot; href=&quot;./static/fonts/material-icons/material-icons.css&quot;/&gt;
</code></pre>
<p>è¿™ä¸ª Bug æ˜¯åœ¨æ§åˆ¶å°å¶ç„¶ Warningï¼š<code>Resource interpreted as Stylesheet but transferred with MIME type text/html: &quot;URL(è¿™ä¸ªURLæ˜¯å…³äº Material Icon çš„è·¯å¾„)&quot;</code>ï¼Œæ‰æ„è¯†åˆ° URL é”™äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8d97045be1e9b2bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µ"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e166801fd05f0666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å†å²è¡Œç¨‹"></p>
<blockquote>
<ol>
<li>ä»”ç»†å¯¹æ¯”è·¯å¾„ä¹‹åå‘ç°äº†é—®é¢˜ï¼Œé¦–é¡µçš„ Requset URL æ˜¯æ­£ç¡®çš„ï¼Œè€Œå†å²è¡Œç¨‹é¡µé¢æ˜¯é”™è¯¯çš„ã€‚ç„¶åå°±é”å®šåˆ° <code>index.html</code> ä¸­å¼•å…¥ Material Icon çš„ <code>&lt;link/&gt;</code> æ ‡ç­¾ã€‚</li>
<li>è·Ÿå®˜æ–¹æ–‡æ¡£å¯¹æ¯”åï¼Œå¥½åƒæ²¡å‘ç°æœ‰é”™ã€‚ç”±äº <code>index.html</code> å’Œ  <code>static</code> æ–‡ä»¶å¤¹æ˜¯åŒçº§ç›®å½•ä¸‹çš„ï¼Œæ‰€ä»¥ <code>href=&quot;./static/fonts/material-icons/material-icons.css&quot;</code> æŒ‰é“ç†åº”è¯¥æ˜¯æ²¡é”™çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿè¿™ä¹ˆå†™ï¼Œä½†å®é™…ä¸Šç¡®å®å‡ºé”™äº†ã€‚</li>
</ol>
</blockquote>
<p>äºæ˜¯ä¹......æˆ‘æŠŠè·¯å¾„æ”¹æˆé¡¹ç›®æ ¹ç›®å½•ï¼Œç„¶åå°±è¡Œäº†ï¼Œå¦‚ä¸‹ã€‚</p>
<pre><code class="language-html">// index.html
&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/fonts/material-icons/material-icons.css&quot;&gt;
</code></pre>
<p>åœ¨æœ¬åœ°ç¡®å®šæ²¡é—®é¢˜åï¼Œå†æ‰“åŒ…é¡¹ç›®æ”¾åˆ°äº‘æœåŠ¡å™¨ä¸Šï¼Œçœ‹çœ‹èƒ½å¦è¯»å–åˆ°é™æ€èµ„æºï¼Œå‘ç°ä¹Ÿæ­£å¸¸ã€‚</p>
<p>å›æƒ³æ•´ä¸ªè¿‡ç¨‹ï¼Œæœ€ä¸»è¦æ˜¯å› ä¸ºæ²¡å‘ç°åœ¨ä¸åŒé¡µé¢ä¸‹çš„ Request URL ä¸ä¸€è‡´ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸æ­£ç¡®çš„ã€‚å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œäº‹æƒ…å°±å¥½åŠäº†ã€‚å½“ç„¶è¿˜æœ‰ä¸ªé—®é¢˜æ²¡æ˜ç™½ï¼šä¸ºä»€ä¹ˆ <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;./static/fonts/material-icons/material-icons.css&quot;&gt;</code> ä¼šä¸è¡Œï¼ˆä¸€ä¸ªå‰ç«¯å°ç™½çš„ç–‘é—®ï¼Ÿï¼‰ï¼Œè¿Ÿç‚¹å†ä¸Š <a href="https://github.com/museui/muse-ui">GitHub</a> å‘å¤§ä½¬æä¸ª Issue æ‰¾æ‰¾åŸå› ï¼Œåˆ°æ—¶åœ¨æ›´æ–°ä¸€ä¸‹æ–‡ç« ã€‚</p>
<p>ç”±äºè¿™ä¸ª Bug å›°æ‰°æˆ‘å¤ªä¹…äº†ï¼Œå°±å†™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[vue-baidu-map è¿›å…¥é¡µé¢è‡ªåŠ¨å®šä½çš„è§£å†³æ–¹æ¡ˆï¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/183</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/183</guid>
            <pubDate>Sun, 26 Feb 2023 08:07:35 GMT</pubDate>
            <description><![CDATA[<p>è‹¥æ–‡ä¸­æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡å‡ºï¼</p>
<p>å…¶å®ä¹‹å‰ä¹Ÿè¢«è¿™é—®é¢˜å›°æ‰°è¿‡ï¼Œåœ¨ç½‘ä¸Šä¹ŸæŸ¥äº†ä¸€ç•ªï¼Œæ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚ç›´åˆ°ä»Šå¤©ï¼Œåœ¨ <a href="https://github.com/Dafrok/vue-baidu-map">GitHub</a> å†’æ˜§åœ°å‘å¤§ä½¬æäº†ä¸€ä¸ª issueï¼Œæ‰ç‚¹é†’äº†æˆ‘ã€‚å…¶å®æ˜¯å› ä¸ºå¤ªè¿‡æ€¥åŠŸè¿‘åˆ©äº†ï¼Œæ²¡]]></description>
            <content:encoded><![CDATA[<p>è‹¥æ–‡ä¸­æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡å‡ºï¼</p>
<p>å…¶å®ä¹‹å‰ä¹Ÿè¢«è¿™é—®é¢˜å›°æ‰°è¿‡ï¼Œåœ¨ç½‘ä¸Šä¹ŸæŸ¥äº†ä¸€ç•ªï¼Œæ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚ç›´åˆ°ä»Šå¤©ï¼Œåœ¨ <a href="https://github.com/Dafrok/vue-baidu-map">GitHub</a> å†’æ˜§åœ°å‘å¤§ä½¬æäº†ä¸€ä¸ª issueï¼Œæ‰ç‚¹é†’äº†æˆ‘ã€‚å…¶å®æ˜¯å› ä¸ºå¤ªè¿‡æ€¥åŠŸè¿‘åˆ©äº†ï¼Œæ²¡æœ‰è®¤çœŸé˜…è¯» <code>vue-baidu-map</code> æä¾›<a href="https://dafrok.github.io/vue-baidu-map/#/zh/start/usage">å‚è€ƒæ–‡æ¡£</a>ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯çœ‹è¿‡ç„¶åå¿˜è®°äº†ï¼</p>
<p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼ˆ<a href="https://dafrok.github.io/vue-baidu-map/#/zh/start/usage">æ–‡æ¡£åŸè¯</a>ï¼‰ï¼š<strong>ç”±äºç™¾åº¦åœ°å›¾ JS API åªæœ‰ JSONP ä¸€ç§åŠ è½½æ–¹å¼ï¼Œå› æ­¤ BaiduMap ç»„ä»¶åŠå…¶æ‰€æœ‰å­ç»„ä»¶çš„æ¸²æŸ“åªèƒ½æ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤ï¼Œè¯·ä½¿ç”¨åœ¨ç»„ä»¶çš„ ready äº‹ä»¶æ¥æ‰§è¡Œåœ°å›¾ API åŠ è½½å®Œæ¯•åæ‰èƒ½æ‰§è¡Œçš„ä»£ç ï¼Œä¸è¦è¯•å›¾åœ¨ vue è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨ BMap ç±»ï¼Œæ›´ä¸è¦åœ¨è¿™äº›æ—¶æœºä¿®æ”¹ model å±‚ã€‚</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-959714861de3af10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘è¯•è¿‡ï¼Œä»¥ä¸Šè¿™ç§æ–¹æ³•å¥½åƒæ˜¯å¯è¡Œï¼Œæ•ˆæœå¯ä»¥å‡ºæ¥ï¼Œä½†æˆ‘ä»¬æœ€å¥½é‡‡ç”¨ä½œè€…æä¾›çš„æ­£ç¡®æ–¹æ³•ï¼</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0f9f75c2a53f44a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¨èè¿™ç§æ–¹æ³•ï¼é‚£ä¸‹é¢è§£å†³è¿›å…¥é¡µé¢è‡ªåŠ¨å®šä½çš„æ–¹æ³•ä¹Ÿæ˜¯åœ¨è¿™é‡Œã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„å†™æ³•ï¼Œä»…ä¾›å‚è€ƒï¼Œæœ‰ä¸è¶³è¯·æŒ‡å‡ºï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªå°ç™½ï¼Œå“ˆå“ˆï¼</p>
<ol>
<li>templateï¼š</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f9b0886eddb86326.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="HTML"></p>
<ol start="2">
<li>jsï¼šè¿™é‡Œä¸»è¦æ˜¯æœ‰äº›å°ç»†èŠ‚éœ€è¦æ³¨æ„çš„ï¼Œå›¾ä¸Šæœ‰æ ‡æ³¨å’Œæ³¨é‡Šï¼Œç¨å¾®çœ‹ä¸€ä¸‹å°±æ˜ç™½äº†ã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2f304d529731c4c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Uncaught SyntaxError: Unexpected token <]]></title>
            <link>https://github.com/toFrankie/blog/issues/182</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/182</guid>
            <pubDate>Sun, 26 Feb 2023 08:05:52 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©åšä¸€ä¸ª VUE çš„é¡¹ç›®ï¼Œåœ¨å¼•å…¥ JS æ–‡ä»¶æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-46c8537ed07954cd.png?imageMogr2/auto-orient/strip%7]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©åšä¸€ä¸ª VUE çš„é¡¹ç›®ï¼Œåœ¨å¼•å…¥ JS æ–‡ä»¶æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-46c8537ed07954cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ§åˆ¶å°çš„æç¤ºï¼š<code>Uncaught SyntaxError: Unexpected token &lt;</code>ã€‚æŒ‰ç…§æç¤ºè¿›å…¥æ–‡ä»¶ï¼Œå†çœ‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ff5103d7affd42ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æç¤ºï¼š<code>&lt;!DOCTYPE html&gt;</code> å‡ºé”™ï¼Œæ˜¯è·Ÿæˆ‘å¼€ç©ç¬‘æ˜¯å§ï¼
ä½†æ ¹æ®ä»¥å¾€çš„å°è±¡ï¼Œè¿™ä¸ªå¥½åƒæ˜¯å¼•å…¥ JS çš„é—®é¢˜ï¼Œç¡®è®¤ JS æ–‡ä»¶æ²¡å‡ºé”™åï¼Œå†ä»”ç»†çœ‹äº†çœ‹ <code>index.html</code> æ–‡ä»¶ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c4e38d712a1d7fbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="index.html"></p>
<p>åŸæœ¬æˆ‘çš„ JS æ–‡ä»¶æ˜¯æ”¾åœ¨ <code>/src/utils</code> æ–‡ä»¶å¤¹ä¸‹çš„ï¼Œä½†å¼•å…¥ <code>/src</code> å’Œ <code>/static</code> çš„æ–‡ä»¶æ˜¯æœ‰åŒºåˆ«çš„ã€‚å…¶ä¸­åŒºåˆ«ï¼Œæ¨èçœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/huangqiao/p/7798887.html">vue ä¸­é™æ€æ–‡ä»¶å¼•ç”¨æ³¨æ„äº‹é¡¹</a>ã€‚</p>
<p>ç°åœ¨æˆ‘çš„è§£å†³åŠæ³•æ˜¯å°† JS æ–‡ä»¶æ”¾åˆ° <code>/static/utils</code> ç›®å½•ä¸‹ï¼Œå¼•å…¥è·¯å¾„ä¹Ÿæ”¹æˆï¼š<code>&lt;script src=&quot;./static/utils/sockjs.js&quot;&gt;&lt;/script&gt;</code>ï¼Œè¿™æ ·å°±ä¸æŠ¥é”™äº†ï¼</p>
<p>è™½ç„¶ç°åœ¨åŠ›é‡è¿˜å¾ˆå¾®å¼±ï¼Œä½†ç›¸ä¿¡ç»ˆæœ‰ä¸€å¤©ä¼šç§¯å°‘æˆå¤šï¼Œæ¥è‡ªäºä¸€ä¸ªå³å°†æ­¥å…¥ç¤¾ä¼šçš„å¹´é’äºº...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Vue é¡¹ç›®ä¸­å¸¸è§é—®é¢˜çš„è§£å†³åŠæ³•ï¼ˆä¸å®šæœŸæ›´æ–°ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/181</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/181</guid>
            <pubDate>Sun, 26 Feb 2023 08:01:05 GMT</pubDate>
            <description><![CDATA[<p>æ–‡ä¸­æ¶‰åŠé—®é¢˜å¯èƒ½æ¯”è¾ƒåŸºç¡€ï¼Œå¤§ä½¬è¯·ç»•è·¯ã€‚
å¦‚è‹¥æ–‡ç« ä¸­æœ‰é”™å¤„ï¼Œæ¬¢è¿çº æ­£æŒ‡å‡ºï¼</p>
<ul>
<li>é¡µé¢é—´ä¼ å‚é—®é¢˜</li>
</ul>
<blockquote>
<p>é¡µé¢é—´ä¼ å‚é—®é¢˜</p>
</blockquote>
<p>é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B éœ€è¦ä¼ å‚ï¼Œæˆ‘ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯ç¼–ç¨‹å¼å¯¼èˆª <code>router]]></description>
            <content:encoded><![CDATA[<p>æ–‡ä¸­æ¶‰åŠé—®é¢˜å¯èƒ½æ¯”è¾ƒåŸºç¡€ï¼Œå¤§ä½¬è¯·ç»•è·¯ã€‚
å¦‚è‹¥æ–‡ç« ä¸­æœ‰é”™å¤„ï¼Œæ¬¢è¿çº æ­£æŒ‡å‡ºï¼</p>
<ul>
<li>é¡µé¢é—´ä¼ å‚é—®é¢˜</li>
</ul>
<blockquote>
<p>é¡µé¢é—´ä¼ å‚é—®é¢˜</p>
</blockquote>
<p>é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B éœ€è¦ä¼ å‚ï¼Œæˆ‘ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯ç¼–ç¨‹å¼å¯¼èˆª <code>router.push( )</code>ï¼Œè€Œä¸æ˜¯å£°æ˜å¼å¯¼èˆª <code>&lt;router-link :to=&quot; &quot;&gt;</code>ï¼ŒäºŒè€…æ•ˆæœä½œç”¨éƒ½ä¸€æ ·ã€‚ä»¥ä¸‹ä¸ºè·¯ç”±è®¾ç½®ï¼š</p>
<pre><code class="language-js">// éƒ¨åˆ†ä¸å…³é”®çš„ä»£ç çœç•¥
// ...
const routes = [
  {
    path: '/trip/history',
    name: 'HistoryTrip',
    component: HistoryTrip,
  },
  {
    path: '/trip/history/detail',
    name: 'TripDetail',
    component: TripDetail,
  },
]

const router = new VueRouter({
  routes,
  // ä½¿ç”¨ HTML5 history æ¨¡å¼
  mode: 'history',
})

export default router
</code></pre>
<p>ç¼–ç¨‹å¼ä¼ å‚æœ‰ä¸¤ç§æ–¹å¼ï¼š
æ–¹å¼ä¸€ï¼š<code>router.push({ name: 'TripDetail', params: { TripOrderId: 123 }})</code></p>
<pre><code class="language-js">// A é¡µé¢ï¼Œæ­¤æ—¶ URL ä¸ºï¼šhttp://localhost:8080/trip/history
this.$router.push({ name: 'TripDetail', params: { TripOrderId: 123 }})
// B é¡µé¢è·å–å‚æ•°çš„æ–¹æ³•ï¼Œæ­¤æ—¶çš„ URL ä¸ºï¼šhttp://localhost:8080/trip/history/detail
console.log(this.$route.params.TripOrderId)
</code></pre>
<p>å¤§å®¶æ³¨æ„ä¸€ä¸‹ B é¡µé¢çš„ URLï¼Œä¸Šé¢å¹¶æ²¡æœ‰ TripOrderId è¿™ä¸ªå‚æ•°ã€‚é‡‡ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œä¼ å‚æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œè¿™å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚å¦ä¸€ä¸ªå°±æ˜¯ï¼šè·³è½¬åˆ°é¡µé¢ B ä¹‹åï¼Œå¦‚æœå¯¹é¡µé¢è¿›è¡Œåˆ·æ–°ï¼Œè¿™ä¸ª params å‚æ•°æ˜¯ä¼šä¸¢å¤±çš„ã€‚æ‰“å°ä¸€ä¸‹å°±çŸ¥é“ï¼Œæ‰“å°ç»“æœåº”è¯¥æ˜¯ undefinedã€‚
æ–¹å¼äºŒï¼ˆæ¨èï¼‰ï¼š<code>router.push({ path: '/trip/history/detail', query: { TripOrderId: 123 }})</code></p>
<pre><code class="language-js">// A é¡µé¢ï¼Œæ­¤æ—¶URLä¸ºï¼šhttp://localhost:8080/trip/history
this.$router.push({ path: '/trip/history/detail', query: { TripOrderId: 123 }})
// B é¡µé¢è·å–å‚æ•°çš„æ–¹æ³•ï¼Œæ­¤æ—¶çš„URLä¸ºï¼šhttp://localhost:8080/trip/history/detail?TripOrderId=123
console.log(this.$route.query.TripOrderId)
</code></pre>
<p>æ–¹æ³•äºŒä¸­ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯ URL ä¸­å¯ä»¥çœ‹å‡ºå‚æ•°æ˜¯ä»€ä¹ˆï¼Œè¿™ç§æ–¹æ³•æ›´ä¸ºç›´è§‚ã€‚æœ€é‡è¦çš„æ˜¯å¯¹é¡µé¢è¿›è¡Œåˆ·æ–°ï¼Œquery å‚æ•°å¹¶ä¸ä¼šä¸¢å¤±ï¼Œä¾ç„¶å¯ä»¥åœ¨åœ°å€æ çœ‹åˆ° TripOrderId å‚æ•°ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å‰ç«¯é‚£äº›ç»å¸¸è¢«å¿½è§†è€ŒçœŸå®å­˜åœ¨çš„å°é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/180</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/180</guid>
            <pubDate>Sun, 26 Feb 2023 08:00:10 GMT</pubDate>
            <description><![CDATA[<ol>
<li>img åœ¨ div æ€»æœ‰é‚£å‡ ä¸ªåƒç´ çš„é«˜åº¦ä¸èƒ½å®Œå…¨å¡«å……çš„é—®é¢˜ï¼ˆå‰ææ˜¯ä¸è®¾ç½® div å®½é«˜ï¼‰ã€‚è§£å†³åŠæ³•æ˜¯ï¼šç»™ img åŠ ä¸ª <code>display: block</code> å³å¯ã€‚</li>
</ol>
<pre><code class="language-html">&lt;style&gt;
 ]]></description>
            <content:encoded><![CDATA[<ol>
<li>img åœ¨ div æ€»æœ‰é‚£å‡ ä¸ªåƒç´ çš„é«˜åº¦ä¸èƒ½å®Œå…¨å¡«å……çš„é—®é¢˜ï¼ˆå‰ææ˜¯ä¸è®¾ç½® div å®½é«˜ï¼‰ã€‚è§£å†³åŠæ³•æ˜¯ï¼šç»™ img åŠ ä¸ª <code>display: block</code> å³å¯ã€‚</li>
</ol>
<pre><code class="language-html">&lt;style&gt;
  .div1 {
    background: red;
  }
  
  .div1 img {
    width: 100px;
    height: 100px;
    /* display: block åŠ ä¸Šå³å¯è§£å†³ */
  }
&lt;/style&gt;

&lt;div class=&quot;div1&quot;&gt;
  &lt;img src=&quot;./images/pic.jpg&quot;/&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ccfdfd4a7be37ac2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®é™…æ•ˆæœå›¾ï¼ŒæŒ‰é“ç† div1 å®½é«˜åº”è¯¥æ˜¯ 100x100"></p>
<p><strong>ä¸å®šæ—¶æ›´æ–°ï¼</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JS ä»£ç ç‰‡æ®µ]]></title>
            <link>https://github.com/toFrankie/blog/issues/179</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/179</guid>
            <pubDate>Sun, 26 Feb 2023 07:56:07 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1734754386261.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>é¦–å­—æ¯å¤§å†™è½¬æ¢</h2>
<pre><code class="langua]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1734754386261.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>é¦–å­—æ¯å¤§å†™è½¬æ¢</h2>
<pre><code class="language-js">function captialize([first, ...rest]) {
  return first.toUpperCase() + rest.join('')
}
</code></pre>
<h2>ç”Ÿæˆæ•°å­—èŒƒå›´æ•°ç»„</h2>
<pre><code class="language-js">function range(length) {
  return Array.from({ length }, (_, index) =&gt; index)
}
</code></pre>
<h2>è¿‡æ»¤æ•°ç»„è™šå€¼</h2>
<p>è™šå€¼ï¼ˆfalsyï¼‰æœ‰ <code>undefined</code>ã€<code>null</code>ã€<code>false</code>ã€<code>+0</code>ã€<code>-0</code>ã€<code>NaN</code>ã€<code>0n</code>ã€<code>''</code>ï¼Œé™¤æ­¤ä¹‹å¤–ç§°ä¸ºçœŸå€¼ï¼ˆtruthyï¼‰ã€‚</p>
<pre><code class="language-js">function filterFalsy(arr) {
  return arr.filter(Boolean)
}
</code></pre>
<h2>ç”Ÿæˆéšæœºå­—ç¬¦ä¸²</h2>
<pre><code class="language-js">function getRandomKey() {
  return Math.random().toString(36).slice(2)
}

// create unique id from letters and numbers
const uniqueAlphaNumericId = (() =&gt; {
  const heyStack = '0123456789abcdefghijklmnopqrstuvwxyz'
  const randomInt = () =&gt; Math.floor(Math.random() * Math.floor(heyStack.length))
  return (length = 24) =&gt; Array.from({ length }, () =&gt; heyStack[randomInt()]).join('')
})()
</code></pre>
<h2>ç”Ÿæˆéšæœºé¢œè‰²å€¼ï¼ˆåå…­è¿›åˆ¶ï¼‰</h2>
<pre><code class="language-js">function getRandomColor() {
  // å¸¦ä¸é€æ˜åº¦çš„è¯ slice(2, 10)
  return Math.random().toString(16).slice(2, 8)
}
</code></pre>
<h2>é¢œè‰²è½¬æ¢ RGB â†’ Hex</h2>
<pre><code class="language-js">function rgb2hex(rgb) {
  return `#${((rgb.r &lt;&lt; 16) | (rgb.g &lt;&lt; 8) | rgb.b).toString(16).padStart(6, '0')}`
}
</code></pre>
<h2>åè½¬å­—ç¬¦ä¸²</h2>
<pre><code class="language-js">function reverseString(str) {
  return [...str].reduce((a, s) =&gt; s + a)
}
</code></pre>
<h2>äº”æ˜Ÿæ‰“åˆ†</h2>
<p>æœ‰å¤§ä½¬åˆ©ç”¨è¿™ä¸ªæ€è·¯åšäº†ä¸ªäº”æ˜Ÿè¯„çº§çš„ç»„ä»¶ï¼Œè¯¦çœ‹ï¼š<a href="https://zhuanlan.zhihu.com/p/33464317">â˜…æ„å»ºä¸œåŠçƒæœ€å°çš„è¯„çº§ç»„ä»¶â˜†</a>ã€‚</p>
<pre><code class="language-js">function getRating(rate) {
  if (rate &gt; 5 || rate &lt; 0) throw new Error('ä¸åœ¨èŒƒå›´å†…')
  return 'â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†'.substring(5 - rate, 10 - rate)
  // return 'â˜…'.repeat(rate) + 'â˜†'.repeat(5 - rate)
}
</code></pre>
<h2>åˆ¤æ–­æ˜¯å¦ä¸ºè‹¹æœè®¾å¤‡</h2>
<pre><code class="language-js">function isAppleDevice() {
  return /(iPhone|iPad|iPod|iOS|mac\sos)/i.test(navigator.userAgent)
}
</code></pre>
<h2>æ•°å­—åƒåˆ†ä½è¡¨ç¤ºæ³•</h2>
<p>æ€è·¯çœ‹<a href="https://github.com/toFrankie/blog/issues/134">è¿™é‡Œ</a>ã€‚</p>
<pre><code class="language-js">function thousandsReplace(str) {
  return String(str).replace(/\B(?=(\d{3})+$)/g, ',')
}

thousandsReplace(10000) // &quot;10,000&quot;
</code></pre>
<h2>ç§»é™¤æœ«å°¾ 0</h2>
<p>å¸¸ç”¨åœºæ™¯æ˜¯ä»·æ ¼å±•ç¤ºã€‚</p>
<pre><code class="language-js">function removeTrailingZero(str) {
  const reg = /(?:\.0*|(\.\d+?)0+)$/
  return str.replace(reg, '$1')
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ·±ç©¶ Safari ä¸‹ border-radius & overflow ä¸ç”Ÿæ•ˆçš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/178</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/178</guid>
            <pubDate>Sun, 26 Feb 2023 07:55:14 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-696ca255e5121991.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-696ca255e5121991.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>èƒŒæ™¯</h2>
<p>å‰ä¸¤å¤©åœ¨åšéœ€æ±‚çš„æ—¶å€™ï¼Œå‘ç°äº† Safari æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ iOS å¹³å°å„æµè§ˆå™¨ï¼‰ä¸‹æœ‰ä¸€ä¸ªæ¸²æŸ“çš„ Bugï¼Œå…¶ä»–åˆ™æ²¡é—®é¢˜ã€‚</p>
<p>å¤ç°ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;box&quot;&gt;
  &lt;img src=&quot;https://gw.alipayobjects.com/mdn/rms_08e378/afts/img/A*lEtuTZi2GvIAAAAAAAAAAABkARQnAQ&quot; alt=&quot;picture&quot; /&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.box {
  width: 270px;
  height: 169px;
  margin: 0 auto;
  overflow: hidden;
  border-radius: 30px;
  border: 4px solid #000;
}

.box img {
  width: 100%;
  height: 100%;
  transform: translateZ(10px);
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-50a4e637c93bb388.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
<a href="https://codesandbox.io/s/overflow-hidden-border-radius-bu-sheng-xiao-demo-qesus8?file=/index.html">CodeSandbox Demo</a></p>
<p>å…¶å®å°±æ˜¯ç®€å•åœ°åœ¨ <code>.box</code> ä¸­æ·»åŠ äº† <code>overflow: hidden; border-radius: 30px;</code> åšä¸€ä¸ªåœ†è§’å¤„ç†ã€‚ä¸Šå›¾ä¸ºé¢„æœŸè¡¨ç°ã€‚
ä½†æ˜¯åœ¨ Apple çš„ WebKit å¹³å°ï¼ˆä¸åŒ…å« Chrome çš„ Blink å¹³å°ï¼‰ï¼Œå°±å‡ºç°é—®é¢˜äº† ğŸ‘‡</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eb0e59ac87220290.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ˜¯ overflow: hidden å¤„ç†æ— æ•ˆï¼Ÿè¿˜æ˜¯ border-radius çš„é—®é¢˜ï¼Ÿ</p>
<h2>åŸå› </h2>
<p>è§£å†³æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘ä»¬å…ˆæ·±ç©¶ä¸‹åŸå› ã€‚</p>
<p>å‰é¢ï¼Œæˆ‘ä»¬ç»™ <code>&lt;img&gt;</code> æ·»åŠ äº† <code>transform: translateZ(10px)</code>ï¼Œäºæ˜¯è¯¥å…ƒç´ äº§ç”Ÿäº† Composite Layerï¼ˆåˆæˆå±‚ï¼‰ã€‚</p>
<pre><code class="language-css">.box img {
  width: 100%;
  height: 100%;
  transform: translateZ(10px);
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5682227f829b3855.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è€Œ Webkit å†…æ ¸ä¸­ï¼Œ<code>border-radius</code> å¯¹å«æœ‰ Composite Layer çš„å…ƒç´ çš„è£å‰ªæ˜¯å­˜åœ¨ Bug çš„ï¼Œè¯¥é—®é¢˜å¯ä»¥è¿½æº¯åˆ° 2011 å¹´ï¼Œå¾ˆæ—©å°±æœ‰äººæå‡ºé—®é¢˜äº†ã€‚</p>
<blockquote>
<p><a href="https://bugs.webkit.org/show_bug.cgi?id=68196">Bug 68196: border-radius clipping of composited layers doesn't work</a></p>
</blockquote>
<p>å‘ç°è¯¥ Bug åœ¨ 2022 å¹´ 9 æœˆ 7 æ—¥å·²è¢«æ ‡è®°ä¸ºã€ŒRESOLVED FIXEDã€ï¼Œåœ¨ 2022 å¹´ 10 æœˆ 19 æ—¥å‘å¸ƒçš„ <a href="https://webkit.org/blog/13394/release-notes-for-safari-technology-preview-156/">Safari Technology Preview 156</a> ä¸­å·²ä¿®å¤ã€‚å¥½å®¶ä¼™ï¼Œè¿™é—®é¢˜æ•´æ•´åå¤šå¹´æ‰è§£å†³ã€‚</p>
<p>éš”å£ Blink å†…æ ¸ï¼ˆåŸºäº Webkit çš„ä¸€ä¸ªåˆ†æ”¯ï¼‰åˆ™åœ¨ 2017 å¹´ 1 æœˆ 24 æ—¥ä¿®å¤ã€‚</p>
<blockquote>
<p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=157218">Issue 157218: border-radius clipping without a stacking context does not apply to composited children</a></p>
</blockquote>
<h2>è§£å†³æ–¹æ³•</h2>
<p>æˆ‘ä»¬åªè¦åœ¨ <code>border-radius</code> çš„å…ƒç´ ä¸Šæ·»åŠ ä¸€ä¸ªå¯åˆ›å»º Stacking Contextï¼ˆå±‚å ä¸Šä¸‹æ–‡ï¼‰çš„ CSS å±æ€§å³å¯ã€‚æ¯”å¦‚ <code>transform: scale(1)</code>ã€<code>transform: translateZ(1px)</code>ã€<code>isolation: isolate</code>ã€<code>position: relative; z-index: 0</code> ç­‰ç­‰ã€‚</p>
<ul>
<li>ä»è¯­ä¹‰è§’åº¦è€ƒè™‘ï¼Œä¸ªäººæ›´åå‘ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/isolation">isolation</a>ï¼Œå®ƒè¡¨ç¤ºè¯¥å…ƒç´ æ˜¯å¦å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</li>
<li>ä»å…¼å®¹æ€§è§’åº¦è€ƒè™‘ï¼Œç›¸æ¯” isolationï¼Œtransform æˆ– position + z-index ä¼šæ›´å¥½ä¸€äº›ã€‚</li>
</ul>
<pre><code class="language-css">.box {
  width: 270px;
  height: 169px;
  margin: 0 auto;
  overflow: hidden;
  border-radius: 30px;
  border: 4px solid #000;
  isolation: isolate; /* æ–°å¢ */
}

.box img {
  width: 100%;
  height: 100%;
  transform: translateZ(10px);
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-09e96a5fbf95ba9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>ç›¸å…³é“¾æ¥</h2>
<ul>
<li><a href="https://bugs.webkit.org/show_bug.cgi?id=68196">border-radius clipping of composited layers doesn't work</a></li>
<li><a href="https://github.com/WebKit/WebKit/pull/3883">border-radius clipping of composited layers doesn't work #3883</a></li>
<li><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=157218">Issue 157218: border-radius clipping without a stacking context does not apply to composited children</a></li>
<li><a href="https://stackoverflow.com/questions/49066011/overflow-hidden-with-border-radius-not-working-on-safari">Overflow: hidden with border radius not working on Safari</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº CSS Reset çš„æ€è€ƒ]]></title>
            <link>https://github.com/toFrankie/blog/issues/177</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/177</guid>
            <pubDate>Sun, 26 Feb 2023 07:54:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e62e9178132ac886.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e62e9178132ac886.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è®°å¾—å½“å¹´ç¬¬ä¸€æ¬¡æ¥è§¦ CSSï¼Œè€å¸ˆä¸€ä¸Šæ¥å°±è¯´ç”¨è¿™ä¸ªæŠ¹å¹³æµè§ˆå™¨çš„æ ·å¼å·®å¼‚ã€‚</p>
<pre><code class="language-css">* {
  margin: 0;
  padding: 0;
}
</code></pre>
<p>ä»¥ä¸Šæ˜¯æœ€å…¸å‹çš„ä¾‹å­ã€‚å½“ç„¶ï¼Œå®é™…é¡¹ç›®é‡Œå¯èƒ½å¹¶ä¸ä¼šå¦‚æ­¤ç®€å•çš„é‡ç½®ã€‚</p>
<p>ä½†ä½ æœ‰æ²¡ç»†æƒ³è¿‡ï¼Œ<strong>è¿™æ˜¯å¿…è¦çš„å—ï¼Ÿè¿™æ˜¯åˆç†çš„å—ï¼Ÿ</strong></p>
<p>ä¸å¦¨çœ‹ä¸‹ä»¥ä¸‹å‡ ç¯‡æ–‡ç« ã€‚</p>
<ul>
<li><a href="https://www.cnblogs.com/coco1s/p/6249038.html">reset.css çŸ¥å¤šå°‘ï¼Ÿ</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2010/04/css-reset%E7%9A%84%E9%87%8D%E6%96%B0%E5%AE%A1%E8%A7%86-%E9%81%BF%E5%85%8D%E6%A0%B7%E5%BC%8F%E9%87%8D%E7%BD%AE/">CSS reset çš„é‡æ–°å®¡è§† â€“ é¿å…æ ·å¼é‡ç½®</a></li>
<li><a href="http://meyerweb.com/eric/thoughts/2007/04/18/reset-reasoning/">Reset Reasoning</a></li>
<li><a href="https://nicolasgallagher.com/about-normalize-css/">About normalize.css</a></li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç”¨å¾—è¾ƒå¤šçš„æœ‰ï¼š</p>
<ul>
<li><a href="https://github.com/necolas/normalize.css/">normalize.css</a></li>
<li><a href="https://github.com/sindresorhus/modern-normalize">modern-normalize</a></li>
<li><a href="https://github.com/csstools/postcss-normalize">postcss-normalize</a></li>
<li><a href="https://meyerweb.com/eric/tools/css/reset/">CSS Tools: Reset CSS</a>ï¼ˆæ–‡ä¸­ç¤ºä¾‹å¹¶éæœ€æ–°ç‰ˆæœ¬ï¼‰</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[overflow ä½¿å¾— transform-style å¤±æ•ˆäº†]]></title>
            <link>https://github.com/toFrankie/blog/issues/176</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/176</guid>
            <pubDate>Sun, 26 Feb 2023 07:54:13 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d9a50f2eb426646f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d9a50f2eb426646f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿™å‘¨åšäº†ä¸€ä¸ªéœ€æ±‚ï¼Œå‡ºç°äº† Bugï¼Œç»æ’æŸ¥åå‘ç°ï¼š</p>
<blockquote>
<p>åŒä¸€å…ƒç´ åŒæ—¶è®¾ç½® <code>overflow: hidden</code> å’Œ <code>transform-style: preserve-3d</code> æ ·å¼ï¼Œä¼šä½¿å¾—åè€…å¤±å» 3D æ•ˆæœï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº <code>transform-style: flat</code>ã€‚</p>
</blockquote>
<p>ä¸‹é¢ç”¨ç¤ºä¾‹éªŒè¯ä¸€ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;rect red&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;rect green&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<blockquote>
<p><code>.constainer</code> åŒºåŸŸè®¾ç½®äº† <code>transform-style: preserve-3d</code>ï¼›
<code>.red</code> åŒºåŸŸè®¾ç½®äº† <code>transform: translate3d(20px, 20px, 10px)</code>ï¼›
<code>.green</code> åŒºåŸŸè®¾ç½®äº† <code>transform: translate3d(0, 0, 5px)</code>ï¼›</p>
</blockquote>
<p>ğŸ‘‡</p>
<pre><code class="language-css">.container {
  margin: 0 auto;
  border-radius: 10px;
  padding: 10px;
  width: 200px;
  height: 200px;
  background: #f8f8f8;
  transform-style: preserve-3d;
}

.rect {
  box-sizing: border-box;
  border: 2px solid #000;
  border-radius: 4px;
  width: 100px;
  height: 100px;
}

.red {
  background: #f00;
  /* translateZ ä¸º 10px */
  transform: translate3d(20px, 20px, 10px);
}

.green {
  background: #0f0;
  /* translateZ ä¸º 5px */
  transform: translate3d(0, 0, 5px);
}
</code></pre>
<p>ç”±äºçº¢è‰²åŒºåŸŸä¸ç»¿è‰²åŒºåŸŸç½®äº 3D ç©ºé—´ä¸­ï¼Œå…¶ä¸­çº¢è‰²åœ¨ Z è½´æ›´ä¸Šé¢ï¼Œå› æ­¤å®é™…è¡¨ç°å¦‚ä¸‹ï¼Œä¸é¢„æœŸä¸€è‡´ã€‚ ğŸ‘‡</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-65f8da6a74c25446.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸€æ—¦ï¼Œå°† <code>overflow: hidden</code> åº”ç”¨äº <code>.container</code>ï¼Œ</p>
<pre><code class="language-css">.container {
  margin: 0 auto;
  border-radius: 10px;
  padding: 10px;
  width: 200px;
  height: 200px;
  background: #f8f8f8;
  transform-style: preserve-3d;
  /* æ–°å¢ */
  overflow: hidden
}
</code></pre>
<p>é‚£ä¹ˆç»“æœå°±... ğŸ‘‡</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-70c0fad927b7bb44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ä¸åŒè®¾å¤‡å®é™…è¡¨ç°è¿˜ä¸ä¸€æ ·ï¼Œåº”è¯¥æ˜¯æ¸²æŸ“å†…æ ¸å®ç°ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚FireFox æµè§ˆå™¨åŒå·¦è¾¹è¡¨ç°ä¸€æ ·ã€‚
å…¶ä¸­å·¦è¾¹ä¸ºã€Œéé¢„æœŸæ•ˆæœã€ï¼Œå³è¾¹ä¸ºã€Œé¢„æœŸæ•ˆæœã€ã€‚</p>
<p>ç¤ºä¾‹å¯çœ‹ï¼šğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/ExLWRPQ">CodePen</a></p>
<p>æˆ‘ä»¬åˆ†æä¸€ä¸‹å·¦è¾¹çš„åŸå› ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ <code>transform</code> ä¼šä½¿å¾—å…ƒç´ åˆ›å»ºä¸€ä¸ªã€Œå±‚å ä¸Šä¸‹æ–‡ã€ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>.red</code> å’Œ <code>.green</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„å±‚å ä¸Šä¸‹æ–‡ã€‚ç”±äºè¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ <code>z-index</code> æ¥æ§åˆ¶å…ƒç´ çš„ã€Œå±‚å é¡ºåºã€ï¼ŒåŠ ä¸Š <code>overflow: hidden</code> ä½¿å¾— <code>transform-style: preserve-3d</code> å¤±å»äº† 3D ç©ºé—´æ•ˆæœï¼Œå› æ­¤æ— æ³•é€šè¿‡ <code>transform: translateZ()</code> çš„å¤§å°æ¥æ§åˆ¶å±‚å é¡ºåºã€‚å› æ­¤åœ¨æ–‡æ¡£æµä¸­éµå¾ªã€Œåè€…å±…ä¸Šã€çš„åŸåˆ™ï¼Œä½¿å¾— <code>.green</code> å¤„äº <code>.red</code> çš„ä¸Šæ–¹ï¼ˆå³å·¦è¾¹çš„è¡¨ç°ï¼‰ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œå¯å¾—å‡ºç»“è®ºï¼š</p>
<blockquote>
<p><strong>åœ¨ã€Œé Webkit å†…æ ¸ã€ä¸­ï¼ŒåŒä¸€å…ƒç´ åŒæ—¶è®¾ç½® <code>overflow: hidden</code> å’Œ <code>transform-style: preserve-3d</code> æ ·å¼ï¼Œä¼šä½¿å¾—åè€…å¤±å» 3D æ•ˆæœï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº <code>transform-style: flat</code>ã€‚</strong></p>
</blockquote>
<p>æ³¨æ„ï¼Œä»¥ä¸Šç»“è®ºè¡¨è¿°ä¸ºã€Œé Webkit å†…æ ¸ã€å¯èƒ½ä¸ä¸¥è°¨ã€‚åŸå› æ˜¯ï¼šä»¥ä¸Š Chrome ä¸º Mac å¹³å°çš„æˆªå›¾ï¼ŒæŸ¥çœ‹äº†å…¶ UA æ˜¯ <code>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36</code> æ ‡æ³¨çš„æ˜¯ Webkit å†…æ ¸ï¼Œéš¾é“å®é™…æ˜¯ Google çš„ Blink å†…æ ¸ï¼ˆè™½è¯´ Blink å¸ˆå‡º Webkitï¼‰ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œè¡¨è¿°å°±æ²¡é—®é¢˜äº†ã€‚</p>
<p>æœ‰æ—¶å€™ï¼ŒçŠ¯é”™äº†å°è±¡æ‰ä¼šæ›´åŠ æ·±åˆ»...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äºæµè§ˆå™¨å¦‚ä½•æ¸²æŸ“å«å°æ•°åƒç´ çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/175</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/175</guid>
            <pubDate>Sun, 26 Feb 2023 07:53:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e19e73aca03c938e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e19e73aca03c938e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ€è¿‘è·Ÿè¿›çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­æ¶‰åŠåˆ°ã€Œå«å°æ•°åƒç´ ã€çš„æ¸²æŸ“é—®é¢˜ï¼Œåœ¨æŸ¥é˜…äº†ä¸€ç•ªèµ„æ–™ä¹‹åï¼Œæœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚</p>
<p>ä»¥ä¸‹ä¸ºç›¸å…³é“¾æ¥ï¼Œç­‰å‘¨æœ«æœ‰ç©ºå†æ•´ç†ä¸€ä¸‹ï¼š</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/401287272">æ·±ç©¶ç§»åŠ¨ç«¯é€‚é…é‚£äº›å‘ï¼šå°æ•°åƒç´ ã€å›¾ç‰‡æ¨¡ç³Š</a></li>
<li><a href="https://www.zhihu.com/question/264372456">æµè§ˆå™¨å°† rem è½¬æˆ px æ—¶æœ‰ç²¾åº¦è¯¯å·®æ€ä¹ˆåŠï¼Ÿ</a></li>
<li><a href="https://www.zhihu.com/question/48624427/answer/134621269">css è®¾ç½®å…ƒç´ çš„å®½é«˜ä¸ºæ•´æ•°ï¼Œä¸ºä»€ä¹ˆæœ‰çš„æµè§ˆå™¨è§£æå‡ºæ¥çš„å®½é«˜æ˜¯å°æ•°ï¼Ÿ</a></li>
<li><a href="https://judes.me/frontend/2018/01/07/why_circle_not_round.html">è¯´å¥½ä¸€èµ·å˜åœ†ï¼Œä½ æ€ä¹ˆå°±ç˜¦äº†ï¼Ÿ</a></li>
<li><a href="https://isux.tencent.com/articles/105.html">æµè§ˆå™¨äºšåƒç´ æ¸²æŸ“ä¸å°æ•°ä½çš„å–èˆ</a></li>
<li><a href="https://trac.webkit.org/wiki/LayoutUnit">LayoutUnit</a></li>
<li><a href="https://github.com/Jiavan/blog/issues/5">LayoutUnit &amp; Subpixel Layout</a></li>
<li><a href="https://www.w3.org/TR/CSS22/cascade.html#value-stages">Assigning property values, Cascading, and Inheritance</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½ çœŸçš„äº†è§£ã€Œåƒç´ ã€å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/174</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/174</guid>
            <pubDate>Sun, 26 Feb 2023 07:52:08 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a7d9143553fc8bb.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a7d9143553fc8bb.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¸€åˆ‡éƒ½ä»ã€Œåƒç´ ã€å¼€å§‹...</p>
<blockquote>
<p>ä»<a href="https://www.wikiwand.com/en/Pixel">ç»´åŸºç™¾ç§‘</a>è¯æºå¯çŸ¥ï¼Œåƒç´  <code>pixel</code> ä¸€è¯ç”± <code>pictures</code> å’Œ <code>element</code> ä¸¤ä¸ªè¯çš„ç®€å†™å½¢å¼ <code>pix</code>  å’Œ <code>el</code> ç»“åˆè€Œæ¥ã€‚</p>
</blockquote>
<p>åƒç´ ï¼Œåœ¨æ•°å­—æˆåƒä¸­æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œå¯åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<blockquote>
<ul>
<li><strong>è™šæ‹Ÿåƒç´ </strong>ï¼šå…¶å¤§å°æ˜¯ä»»æ„çš„ã€å¯å˜çš„ï¼Œæ²¡æœ‰å®é™…çš„ç‰©ç†å°ºå¯¸å¤§å°ã€‚</li>
<li><strong>ç‰©ç†åƒç´ </strong>ï¼šé€šå¸¸ç”¨äºæè¿°æ‰‹æœºã€ç”µè„‘ã€æ˜¾ç¤ºå™¨ç­‰è®¾å¤‡çš„åƒç´ ï¼Œå®ƒåœ¨è®¾å¤‡å‡ºå‚æ—¶å·²ç»ç¡®å®šï¼Œæ˜¯ä¸å¯å˜çš„ï¼Œå…·æœ‰å®é™…çš„ç‰©ç†å°ºå¯¸å¤§å°ï¼ˆä¸€èˆ¬ä½¿ç”¨è‹±å¯¸è¡¨ç¤ºï¼‰ã€‚</li>
</ul>
</blockquote>
<p>ç‰©ç†åƒç´ ï¼ˆå³å±å¹•åƒç´ ï¼Œscreen pixelï¼‰æ˜¯æ˜¾ç¤ºè®¾å¤‡æˆåƒçš„æœ€å°å•ä½ã€‚æˆ‘ä»¬ã€Œè‚‰çœ¼ã€çœ‹åˆ°çš„ç‰©ç†åƒç´ éƒ½æ˜¯çœŸå®çš„ç‰©ç†å‘å…‰å…ƒä»¶ï¼Œæ—¢ç„¶æ˜¯ç‰©ç†å…ƒä»¶ï¼Œå°±ä¸å¯èƒ½ã€Œæ— ç¼ã€å¡«æ»¡æ•´ä¸ªå±å¹•ï¼Œè€Œä¸”åƒç´ ï¼ˆå³å…ƒä»¶ï¼‰å¤§å°ã€å½¢çŠ¶ä¹Ÿæ˜¯å¯ä»¥è‡ªç”±å®šä¹‰çš„ï¼Œåœ¨å±å¹•ä¸Šå¤šæ˜¯æ–¹å½¢æˆ–è€…æ¥è¿‘æ–¹å½¢çš„ã€‚ä¸¤ä¸ªç›¸é‚»åƒç´ ä¹‹é—´çš„è·ç¦»å°±æ˜¯ç‚¹è·ï¼ˆdot pitchï¼‰ï¼Œç‚¹è·è¶Šå°æˆåƒè¶Šç»†è…»ï¼Œè¿‘è·ç¦»ä½¿ç”¨ä½“éªŒè¶Šå¥½ã€‚</p>
<p>ä½†å¹¶ä¸æ˜¯è¯´åƒç´ ç´§å¯†æ’åˆ—å°±æ„å‘³ç€ã€Œè§†è§‰æ•ˆæœã€æ›´å¥½ï¼Œæ¯”å¦‚è¯´æˆ·å¤–ç¡•å¤§çš„ LED å¹¿å‘Šç‰Œï¼Œæ˜¯å¯ä»¥æ˜æ˜¾åœ°çœ‹åˆ°é»‘è‰²ç¼éš™çš„ï¼ŒåŸå› æ˜¯å®ƒä»¬çš„å…ƒä»¶æ’åˆ—æ˜¯æœ‰é—´éš™çš„ã€‚</p>
<p>è™šæ‹Ÿåƒç´ åˆ°ç‰©ç†æˆåƒï¼Œæ˜¯æœ‰ä¸€å®šçš„æ˜ å°„å…³ç³»çš„ï¼Œå…·ä½“ç”±æ˜¾ç¤ºè®¾å¤‡æˆ–æ‰“å°è®¾å¤‡æ¥å†³å®šã€‚</p>
<h2>ä¸€ã€åˆ†è¾¨ç‡</h2>
<p>æˆ‘ä»¬å‘ç°ï¼Œé€šå¸¸æè¿°ã€Œ<a href="https://www.wikiwand.com/en/Resolution">åˆ†è¾¨ç‡</a>ã€çš„å•ä½ä¹Ÿå«åƒç´ ï¼Œä½†æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li>
<p><strong>ç‰©ç†å±å¹•åˆ†è¾¨ç‡</strong>ï¼ˆPhysical screen resolutionï¼‰ï¼šæ³›æŒ‡ç”µè§†æœºã€ç”µè„‘æ˜¾ç¤ºå™¨ã€æ‰‹æœºå±å¹•ç­‰æ˜¾ç¤ºè®¾å¤‡çš„åˆ†è¾¨ç‡ï¼Œå®ƒåœ¨è®¾å¤‡å‡ºå‚æ—¶ä¾¿ä»¥ç¡®å®šï¼Œä¸å¯ä¿®æ”¹ï¼Œè€Œä¸”æ˜¯æœ‰ç€å…·ä½“çš„ç‰©ç†å°ºå¯¸å¤§å°ã€‚</p>
<p>å¸¸è¯´çš„ 1920 Ã— 1080 åˆ†è¾¨ç‡çš„æ‰‹æœºï¼ŒæŒ‡çš„æ˜¯æ˜¾ç¤ºå™¨æ¨ªå‘æ’åˆ—äº† 1080 ä¸ªåƒç´ ï¼Œçºµå‘æ’åˆ—äº† 1920 ä¸ªåƒç´ ã€‚</p>
</li>
<li>
<p><strong>æ˜¾ç¤ºåˆ†è¾¨ç‡</strong>ï¼ˆ<a href="https://www.wikiwand.com/en/Display_resolution">Display resolution</a>ï¼‰ï¼šä¹Ÿç§°ä½œå±å¹•åˆ†è¾¨ç‡ï¼ˆscreen resolutionï¼‰ï¼Œå®ƒæ²¡æœ‰å…·ä½“çš„ç‰©ç†å¤§å°ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚</p>
<p>å¸¸è¯´çš„â€œè°ƒèŠ‚ç”µè„‘å±å¹•åˆ†è¾¨ç‡â€ï¼Œä¿®æ”¹çš„å°±æ˜¯æ˜¾ç¤ºåˆ†è¾¨ç‡ã€‚å½“æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡ä¸å±å¹•åˆ†è¾¨ç‡ä¸€è‡´æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿåƒç´ å°†ä¼šç”¨ä¸€ä¸ªç‰©ç†åƒç´ æ¥æ˜¾ç¤ºï¼Œæ­¤æ—¶æ˜¾ç¤ºæ•ˆæœæ˜¯æœ€ä½³çš„ã€‚å½“äºŒè€…ä¸ç›¸åŒæ—¶ï¼Œå°†æœ‰ç›¸å…³ç³»ç»Ÿä½¿ç”¨ç®—æ³•å»æ¨¡æ‹Ÿåƒç´ ï¼Œè€Œè¿™äº›æ¨¡æ‹Ÿå¤„ç†éƒ½ä¼šå¸¦æ¥ç”»è´¨çš„æŸå¤±ã€‚</p>
</li>
<li>
<p>è¿˜æœ‰å¾ˆå¤šåˆ†ç±»ï¼Œæ¯”å¦‚ Image resolutionã€Printing resolutionã€Sensor resolution ç­‰ç­‰ï¼Œè¯¦çœ‹ <a href="https://www.wikiwand.com/en/Resolution">Wiki</a>ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šæè¿°<a href="https://zhuanlan.zhihu.com/p/97895083">æºè‡ª</a>ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä¸èƒ½å•å‡­æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡æ¥è®¡é‡å±å¹•çš„ç»†è…»ç¨‹åº¦ã€‚è¯•æƒ³ï¼ŒåŒæ ·æ˜¯ 1920 Ã— 1080 åˆ†è¾¨ç‡ï¼Œä¸€ä¸ªæ”¾åœ¨ 5.5 è‹±å¯¸çš„æ‰‹æœºå±å¹•ä¸Šï¼Œä¸€ä¸ªæ”¾åœ¨ 40 è‹±å¯¸çš„ç”µè§†æœºå±å¹•ä¸Šï¼Œç»†è…»ç¨‹åº¦ä¼šä¸€æ ·å—ï¼Ÿ</p>
</blockquote>
<h2>äºŒã€å±å¹•å°ºå¯¸</h2>
<p>è¿™ç©æ„æœ¬æ¥å°±æ˜¯å¤–å›½äººå‘æ˜çš„ï¼Œå› æ­¤å¸¸ç”¨å•ä½ã€Œ<a href="https://www.wikiwand.com/en/Inch">è‹±å¯¸</a>ã€æ¥æè¿°ã€‚å•ä½æ¢ç®—ï¼š1 è‹±å¯¸ = 2.54Â å˜ç±³ï¼ˆcmï¼‰ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œ<strong>è‹±å¯¸æ˜¯ã€Œé•¿åº¦ã€å•ä½</strong>ï¼Œè€Œä¸æ˜¯ã€Œé¢ç§¯ã€å•ä½ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ 4.7 è‹±å¯¸çš„æ‰‹æœºï¼Œè¿™é‡Œçš„ 4.7 è‹±å¯¸æŒ‡çš„æ˜¯<strong>æ‰‹æœºæ˜¾ç¤ºå±ã€Œå¯¹è§’çº¿ã€çš„é•¿åº¦</strong>ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå™¨çš„å®½åº¦æˆ–è€…é«˜åº¦ï¼Œæ›´ä¸æ˜¯é¢ç§¯ã€‚å¯¹ï¼Œå°±æ˜¯æ•°å­¦ä¸­ç›´è§’ä¸‰è§’å½¢çš„é‚£ä¸ªæ–œè¾¹ï¼Œå‹¾è‚¡å®šç†è¿˜è®°å¾—å§ã€‚</p>
<p>ä¸‹æ–‡å°†ä¼šæåˆ°çš„åƒç´ å¯†åº¦ï¼ˆPPIï¼‰è¡¨ç¤ºã€Œæ¯è‹±å¯¸ã€å±å¹•æ‰€æ‹¥æœ‰çš„åƒç´ æ•°ï¼Œä¹Ÿæ˜¯æŒ‡å¯¹è§’çº¿çš„é•¿åº¦ï¼Œè€Œéé¢ç§¯å¤§å°ã€‚</p>
<h2>ä¸‰ã€åƒç´ å¯†åº¦</h2>
<p><a href="https://www.wikiwand.com/en/Pixels_per_inch">åƒç´ å¯†åº¦</a>ï¼ˆPixel densityï¼‰ï¼Œé€šå¸¸ç”¨æ¥è®¡é‡ç”µå­è®¾å¤‡å±å¹•ç»†è…»ç¨‹åº¦ã€‚</p>
<blockquote>
<p>åƒç´ å¯†åº¦çš„å•ä½ä¸€èˆ¬æ˜¯ <strong>PPIï¼ˆPixel Per Inchï¼Œæ¯è‹±å¯¸åƒç´ ï¼‰</strong>ï¼Œè¡¨ç¤ºå•ä½é•¿åº¦ä¸Šçš„åƒç´ æ•°é‡ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯å•ä½é¢ç§¯çš„åƒç´ æ•°é‡ï¼‰ã€‚</p>
</blockquote>
<p>ç”µå­è®¾å¤‡çš„ PPI å–å†³äºã€Œå±å¹•å°ºå¯¸ã€å’Œã€Œæ˜¾ç¤ºå™¨åˆ†è¾¨ç‡ã€ï¼Œè®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b6eb608fed6b5a50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶ä¸­ï¼Œ</p>
<ul>
<li><code>dp</code> ä¸ºå±å¹•å¯¹è§’çº¿çš„åˆ†è¾¨ç‡</li>
<li><code>di</code> ä¸ºå±å¹•å¯¹è§’çº¿çš„é•¿åº¦ï¼ˆå•ä½ä¸ºè‹±å¯¸ï¼‰</li>
<li><code>wp</code> ä¸ºå±å¹•æ¨ªå‘åˆ†è¾¨ç‡</li>
<li><code>hp</code> ä¸ºå±å¹•çºµå‘åˆ†è¾¨ç‡</li>
</ul>
<p>ä»¥ 4.7 è‹±å¯¸çš„ iPhone 7 ä¸ºä¾‹ï¼Œåˆ†è¾¨ç‡ä¸º 750 Ã— 1334ï¼Œåƒç´ å¯†åº¦çº¦ä¸º 326PPIï¼ˆ<a href="https://www.calculatorsoup.com/calculators/technology/ppi-calculator.php">åœ¨çº¿æ¢ç®—</a>ï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº”ä»¥è®¾å¤‡ã€Œå®é™…å°ºå¯¸ã€æ¢ç®—ï¼Œè€Œéå‚å•†ã€Œå®£ä¼ å°ºå¯¸ã€ï¼ŒäºŒè€…ä¹‹é—´å¯èƒ½ä¼šæœ‰ä¸€å®šçš„åå·®ï¼Œè‡ªç„¶è®¡ç®—ç»“æœå°±ä¼šäº§ç”Ÿè¯¯å·®ã€‚æ¯”å¦‚ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0aaca2e521e33346.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ã€Œæ•°ç ç›¸æœºã€ä¸æ‰‹æœºç­‰å±å¹•ä¸åŒçš„æ˜¯ï¼Œæ•°ç ç›¸æœºçš„å±å¹•é€šå¸¸ç”¨ã€Œç‚¹è‰²æ•°ã€æ¥æè¿°ï¼Œè€Œä¸æ˜¯åƒç´ ã€‚æ¯ä¸ªåƒç´ åŒ…å«äº†ä¸‰ä¸ªç‚¹è‰²æ•°ï¼ˆåˆ†åˆ«æ˜¯çº¢ã€ç»¿ã€è“ä¸‰åŸè‰²ï¼‰ã€‚ä»¥<a href="https://www.dpreview.com/reviews/canoneos50d/">ä½³èƒ½ 50D</a> ç›¸æœºæ˜¾ç¤ºå±ä¸ºä¾‹ï¼Œå®ƒæœ‰ 920,000 ä¸ªç‚¹è‰²æ•°ï¼ˆåº”è¯¥æ˜¯çº¦æ•°ï¼‰ï¼Œå³ 92 ä¸‡è‰²ï¼Œé€šè¿‡è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥æ¨ç®—å‡ºå±å¹•ä¸º 307,200 ä¸ªåƒç´ ï¼Œåˆ†è¾¨ç‡ä¸º 640 Ã— 480ã€‚å› æ­¤ï¼Œç›¸æœºæ˜¾ç¤ºå±çš„ç‚¹è‰²æ•°å’Œåƒç´ å¸¸è¢«äººæ··æ·†ï¼ˆæºè‡ª<a href="https://www.wikiwand.com/zh-hans/%E6%AF%8F%E8%8B%B1%E5%AF%B8%E5%83%8F%E7%B4%A0">ç»´åŸºç™¾ç§‘</a>ï¼‰ã€‚</p>
<p>è¿˜æœ‰ï¼Œç”¨äºé‡åº¦ã€Œæ‰“å°æœºã€æ‰“å°ç²¾ç»†ç¨‹åº¦çš„è®¡é‡å•ä½æ˜¯ <strong>DPI</strong>ã€‚</p>
<blockquote>
<p><strong>DPIï¼ˆDots Per Inchï¼Œæ¯è‹±å¯¸ç‚¹æ•°ï¼‰</strong>ï¼Œè¡¨ç¤ºå•ä½é•¿åº¦ä¸Šå¯æ‰“å°çš„ç‚¹æ•°ã€‚</p>
</blockquote>
<p>è™½è¯´ PPI å’Œ DPI ä¸¤è€…æ‰€ç”¨çš„é¢†åŸŸå­˜åœ¨åŒºåˆ«ï¼Œã€Œåƒç´ ã€åªå­˜åœ¨äºå±å¹•æ˜¾ç¤ºé¢†åŸŸï¼Œè€Œã€Œç‚¹ã€åªå‡ºç°äºæ‰“å°æˆ–å°åˆ·é¢†åŸŸã€‚ä½†ç”±äº PPI ä¹Ÿä¼šå½±å“åˆ°å›¾ç‰‡çš„æ‰“å°è´¨é‡ï¼Œå› æ­¤å®¹æ˜“å‡ºç°æ··ç”¨æˆ–æ··æ·†çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œåœ¨ SONY Support çš„ä¸€ç¯‡<a href="https://www.sony.com/electronics/support/articles/00027623">æ–‡ç« </a>ä¸­æŒ‡å‡ºï¼š</p>
<blockquote>
<p>Much of the confusion between these two terms happens for a couple of reasons. First, even though PPI refers to the resolution of an on-screen digital image, it can also affect the quality of the final printed picture. Second, even some professional print services request that pictures must be at a certain DPI level before they can be printed; what they normally mean is PPI, not DPI - thus, this adds to the confusion.</p>
</blockquote>
<p>ç”±äºæœ¬æ–‡çš„é‡ç‚¹è®¨è®ºçš„æ˜¯æ˜¾ç¤ºå±å¹•é¢†åŸŸåƒç´ ä¹‹é—´çš„å…³ç³»ï¼Œè€Œéæ‰“å°é¢†åŸŸï¼ŒåŠ ä¹‹æœ¬äººå¯¹æ­¤å¹¶ä¸æ˜¯å¾ˆäº†è§£ï¼Œå› æ­¤ä¸ä½œè¿‡å¤šä»‹ç»ï¼Œç‚¹åˆ°ä¸ºæ­¢ï¼Œå“ˆå“ˆï¼</p>
<h2>å››ã€è®¾å¤‡ç‹¬ç«‹åƒç´ ï¼ˆå³é€»è¾‘åƒç´ ï¼‰</h2>
<p><a href="https://www.wikiwand.com/en/Device-independent_pixel">è®¾å¤‡ç‹¬ç«‹åƒç´ </a>ï¼ˆdevice-independent pixelï¼‰ï¼Œä¹Ÿç§°ä¸ºã€Œé€»è¾‘åƒç´ ã€ï¼Œè™½ç„¶å®ƒå±äºè™šæ‹Ÿåƒç´ èŒƒç•´ï¼Œä½†æ˜¯å®ƒå›ºå®šä¸å¯å˜çš„ï¼Œåœ¨æ˜¾ç¤ºè®¾å¤‡å‡ºå‚æ—¶ä¾¿å·²ç¡®å®šã€‚</p>
<p>ä» <a href="https://yesviz.com/iphones.php">YESVZ</a> ç½‘ç«™å¯ä»¥æŸ¥çœ‹å¸¸è§è®¾å¤‡çš„é€»è¾‘åƒç´ ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0f56369e08f6b795.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>æ—¢ç„¶æœ‰äº†ç‰©ç†åƒç´ ï¼Œä¸ºä»€ä¹ˆè¿˜è¦é€»è¾‘åƒç´ çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆå®é™…é—®é¢˜è€Œå‡ºç°çš„å‘¢ï¼Ÿ</strong></p>
<p>åœ¨å¾ˆæ—©ä»¥å‰ï¼Œä¸€ä¸ª CSS åƒç´ ç”±ä¸€ä¸ªç‰©ç†åƒç´ è¡¨ç¤ºï¼ˆå³ DPR ä¸º 1ï¼‰ã€‚æ”¹å˜ä» Apple å¼€å§‹ï¼Œéšç€ iPhone 4 å‘å¸ƒï¼Œè‹¹æœå‘ä¸–ç•Œå±•ç¤ºäº†ä¸€å—æ˜¾ç¤ºæ•ˆæœä¿±ä½³ Retina å±å¹•ï¼Œå…¶åé«˜æ¸…å±å¦‚é›¨åæ˜¥ç¬‹èˆ¬å‡ºç°ï¼Œæ¯”å¦‚ 720Pã€1080Pã€2K å±ç­‰ç­‰ï¼ŒåŠ ä¹‹å„è®¾å¤‡çš„å±å¹•å¤§å°è¿˜ä¸ä¸€æ ·......é¢å¯¹å¦‚æ­¤ä¹‹å¤šä¸åŒå°ºå¯¸ä¸åŒåˆ†è¾¨ç‡çš„å±å¹•ï¼Œå¯¹äºè½¯ä»¶å¼€å‘è€…æ¥è¯´æ˜¯éå¸¸å¤´ç–¼çš„ï¼ŒäºŸéœ€ä¸€ç§ã€Œè§„èŒƒã€æˆ–ã€Œæ–¹æ¡ˆã€ä½¿å¾—åŒä¸€å›¾åƒåœ¨ä¸åŒè®¾å¤‡ä¸Šâ€œçœ‹èµ·æ¥â€ä¸€æ ·ï¼Œå› æ­¤ã€Œé€»è¾‘åƒç´ ã€çš„æ¦‚å¿µå°±å‡ºç°äº†ã€‚</p>
<p>å‰é¢æåˆ°è¿‡ï¼Œè™šæ‹Ÿåƒç´ åˆ°ç‰©ç†æˆåƒï¼Œæ˜¯å…·æœ‰æ˜ å°„å…³ç³»çš„ã€‚åœ¨ Web é¢†åŸŸä¸­ï¼Œè¿™ç§æ˜ å°„å…³ç³»å¯ä»¥ç”¨ DPR è¡¨ç¤ºã€‚å½“ DPR ä¸º 1 æ—¶ï¼Œä¸€ä¸ª CSS åƒç´ ç”¨ä¸€ä¸ªç‰©ç†åƒç´ è¡¨ç¤ºï¼›å½“ DPR ä¸º 2 æ—¶ï¼Œä¸€ä¸ª CSS åƒç´ ç”¨ä¸¤ä¸ªç‰©ç†æ˜¾ç¤ºè¡¨ç¤ºï¼Œå…¶ä»–åŒç†ã€‚</p>
<h3>é€»è¾‘åƒç´ ä¸ CSS åƒç´ </h3>
<p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« ï¼ŒæŒ‡å‡ºã€Œé€»è¾‘åƒç´ ç­‰äºCSS åƒç´ ã€ï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</p>
<p>åœ¨ã€Œç½‘é¡µæœªç¼©æ”¾ã€æƒ…å†µä¸‹ï¼Œé€»è¾‘åƒç´ ä¸ CSS åƒç´ æ˜¯ 1:1 çš„å…³ç³»ã€‚å¦‚æœ‰ç¼©æ”¾çš„è¯ï¼Œå…¶ç¼©æ”¾æ¯”ä¾‹å°±æ˜¯é€»è¾‘åƒç´ ä¸é€»è¾‘åƒç´ çš„æ¯”å€¼ã€‚</p>
<!--

å…ˆéšè—æ‰

> **DIP**ï¼ˆ[device-independent pixel](https://www.wikiwand.com/en/device-independent%20pixel)ï¼Œè®¾å¤‡ç‹¬ç«‹åƒç´ ï¼›density-independent pixelï¼Œå¯†åº¦ç‹¬ç«‹æ€§ï¼‰ï¼Œæ˜¯ä¸€ç§é•¿åº¦å•ä½ï¼Œ å¸¸è§ç®€å†™å½¢å¼ä¸º DP æˆ– DIPã€‚

åœ¨ Android å¼€å‘ä¸­å¾ˆå¸¸è§ï¼Œä¸€ç§åŸºäºå±å¹•å¯†åº¦çš„æŠ½è±¡å•ä½ï¼Œè¿™äº›å•ä½ä¸ 160 dpi å±å¹•ç›¸å…³ï¼ˆé€šå¸¸ Android è®¾å¤‡çš„åˆ†è¾¨ç‡æ˜¯ 160 çš„æ•´æ•°å€ï¼‰ã€‚åœ¨ Android æ“ä½œç³»ç»Ÿä¸Šï¼Œ1dp ç›¸å½“äº 160dpi å±å¹•ä¸Šçš„ä¸€ä¸ªç‰©ç†åƒç´ ï¼Œdp ä¸ç‰©ç†åƒç´ çš„æ¯”ä¾‹ä¼šéšç€å±å¹•å¯†åº¦è€Œå˜åŒ–ï¼Œä½†ä¸ä¸€å®šæˆæ­£æ¯”ã€‚

è€Œåœ¨ Web è®¾è®¡ä¸­åº”ä»¥ px ä½œä¸ºå•ä½ã€‚å…¶ä¸­ [Material Design](https://material.io/design/layout/pixel-density.html#pixel-density-on-the-web) è®¾è®¡æŒ‡å—ä¸­è¡¨ç¤ºï¼š

> When designing for the web, replace dp with px (for pixel).

-->
<h4>CSS åƒç´ </h4>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒWeb æ ‡å‡†ç”± <a href="https://www.w3.org/Consortium/">W3C</a>ï¼ˆThe World Wide Web Consortiumï¼‰ åˆ¶å®šï¼Œåœ¨ CSS æ ‡å‡†ä¸­ï¼Œé•¿åº¦å•ä½åŒ…æ‹¬ã€Œ<a href="https://www.w3.org/TR/css3-values/#relative-lengths">ç›¸å¯¹é•¿åº¦</a>ã€å’Œã€Œ<a href="https://www.w3.org/TR/css3-values/#absolute-lengths">ç»å¯¹é•¿åº¦</a>ã€ä¸¤ç±»ã€‚å…¶ä¸­ <code>px</code> æ˜¯ç»å¯¹é•¿åº¦å•ä½ä¹‹ä¸€ï¼ˆ<a href="https://www.w3.org/TR/css3-values/#absolute-lengths">è¯¦è§</a>ï¼‰ï¼Œ</p>
<p>ä½†çœŸçš„ã€Œç»å¯¹ã€å—ï¼Ÿ</p>
<p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« æåˆ° <code>px</code> å½’ä¸ºã€Œç›¸å¯¹å•ä½ã€ï¼Œ åŸå› æœ‰äºŒï¼š</p>
<blockquote>
<ol>
<li>ä¸åŠ æ€ç´¢ï¼Œäººäº‘äº¦äº‘ã€‚</li>
<li>æ‰€é€‰å‚ç…§ç‰©ä¸ä¸€æ ·ã€‚ç”±äº CSS åƒç´ ä¸ç‰©ç†åƒç´ ä¸ä¸€å®šæ˜¯ 1 : 1 çš„å…³ç³»ï¼Œå®ƒè·Ÿå±å¹•çš„åƒç´ å¯†åº¦æœ‰å…³ï¼Œæ¯”å¦‚åœ¨ iPhone 7 ä¸‹ 1 Ã— 1 çš„ CSS åƒç´ ï¼Œå°†ä¼šä½¿ç”¨ 2 Ã— 2 ä¸ªç‰©ç†åƒç´ å»æ¸²æŸ“ã€‚åœ¨ Web é¢†åŸŸé€šå¸¸ä½¿ç”¨ã€Œè®¾å¤‡åƒç´ æ¯”ã€ï¼ˆDevice Pixel Ratioï¼ŒDPRï¼‰å»æè¿° CSS åƒç´ ä¸æœ€ç»ˆæ˜¾ç¤ºæˆåƒçš„å…³ç³»ã€‚</li>
</ol>
</blockquote>
<p>æˆ‘çœ‹åˆ°ä¸€å¥è¯ã€ŒA pixel no longer equals a pixelã€ï¼Œåœ¨å½“ä¸‹é«˜æ¸…å±å¤§è¡Œå…¶é“çš„æ—¶ä»£ï¼Œè¿™å¥è¯å°±æˆç«‹äº†ï¼Œä¸€ä¸ªè™šæ‹Ÿåƒç´ ä¸å†ç­‰äºä¸€ä¸ªç‰©ç†åƒç´ ã€‚</p>
<h4>è®¾å¤‡åƒç´ æ¯”</h4>
<blockquote>
<p>DPRï¼ˆDevice Pixel Ratioï¼Œè®¾å¤‡åƒç´ æ¯”ï¼‰ï¼Œè¡¨ç¤ºå½“å‰æ˜¾ç¤ºè®¾å¤‡çš„ç‰©ç†åƒç´ åˆ†è¾¨ç‡ä¸ CSS åƒç´ åˆ†è¾¨ç‡ä¹‹æ¯”ã€‚</p>
</blockquote>
<p>åœ¨  CSS è§„èŒƒä¸­ <code>window.devicePixelRatio</code> çš„è®¡ç®—é€»è¾‘å¦‚ä¸‹ï¼ˆ<a href="https://drafts.csswg.org/cssom-view/#dom-window-devicepixelratio">è¯¦è§</a>ï¼‰ï¼š</p>
<blockquote>
<ol>
<li>If there is no output device, return 1 and abort these steps.</li>
<li>LetÂ <em>CSS pixel size</em>Â be the size of aÂ <a href="https://drafts.csswg.org/css-values-4/#px">CSS pixel</a>Â at the currentÂ <a href="https://drafts.csswg.org/cssom-view/#page-zoom">page zoom</a>Â scale factor and at aÂ <a href="https://drafts.csswg.org/cssom-view/#pinch-zoom">pinch zoom</a>Â scale factor of 1.0.</li>
<li>LetÂ <em>device pixel size</em>Â be the vertical size of a device pixel of the output device.</li>
<li>Return the result of dividingÂ <em>CSS pixel size</em>Â byÂ <em>device pixel size</em>.</li>
</ol>
</blockquote>
<p>å…³é”®è¯æ˜¯ã€Œç¼©æ”¾æ¯”ä¾‹ä¸º 1ã€ã€ã€Œè¾“å‡ºè®¾å¤‡å¤„äºå‚ç›´æ–¹å‘ã€ï¼ˆå¯ä»¥ç†è§£ä¸ºæ‰‹æœºç«–å±çŠ¶æ€ï¼‰ã€</p>
<p>è®¾å¤‡åƒç´ æ¯”æ˜¯å¯å˜çš„ï¼Œæ¯”å¦‚é¡µé¢çš„ç¼©æ”¾ï¼ˆä½†æ³¨æ„æ‰‹åŠ¿ç¼©æ”¾ä¸ä¼šï¼‰</p>
<p>æœªå®Œå¾…ç»­...</p>
<!--

## ä¸€äº›è§‚ç‚¹

* CSS pixel ratio (also referred to as device pixel ratio) 
* A pixel is not a pixelï¼ˆa pixel no longer equals a pixel.ï¼‰
* é€»è¾‘åƒç´ å®šä¹‰ä¸ºè®¾å¤‡å±å¹•ä¸­çš„ç‰©ç†åƒç´ æ•°é™¤ä»¥ CSS åƒç´ æ¯”ç‡ï¼Œé€»è¾‘åƒç´ æ˜¯æ‚¨åœ¨æŸ¥çœ‹è®¾å¤‡æ—¶çœ‹åˆ°çš„ï¼ˆæ›´é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„æµè§ˆå™¨çœ‹åˆ°çš„ï¼‰ã€‚
* In this post, we refer to the physical pixel on the screen as â€œdevice pixelâ€ (not to be confused with CSS pixel which will be explained later on).
* TheÂ *reference pixel*Â is the visual angle of one pixel on a device with a pixel density of 96dpi and a distance from the reader of an arm's length. ï¼ˆæºè‡ª[W3C CSS specification](https://www.w3.org/TR/CSS2/syndata.html#length-units)ï¼‰
* Note: Values are case-insensitive and serialize as lower case, for example 1Q serializes as 1q.
* Understand that CSS pixels reference an abstract reference pixel and that the key rule to remember is that 96 CSS pixels are always the same length as 1 CSS inch.
* 96px will not always equal 1 real-life inch.

## å…¶ä»–

https://www.reddit.com/r/web_design/comments/24c1hj/comment/ch5u0ly/?utm_source=share&utm_medium=web2x&context=3

CSS åƒç´ é’ˆå¯¹è§†è§’è¿›è¡Œäº†æ ‡å‡†åŒ–ï¼Œè¿™æ„å‘³ç€æ— è®ºæ˜¾ç¤ºå™¨çš„åƒç´ å¯†åº¦ã€ä½¿ç”¨å®ƒçš„è§‚çœ‹è·ç¦»ç­‰å¦‚ä½•ï¼Œä¸€ä¸ª CSS åƒç´ å¯¹ç”¨æˆ·æ¥è¯´éƒ½å°†æ˜¾ç¤ºç›¸åŒçš„å¤§å°ã€‚ä¸€ä¸ª CSS åƒç´ ä¸ç­‰äºä¸€ä¸ªç‚¹ç»“æœæ˜¾ç¤ºã€‚ä½†è¿™æ˜¯ä¸€ä»¶å¥½äº‹â€”â€”è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨é€‰æ‹©çš„ä»»ä½•å•ä½æ¥è°ƒæ•´å…ƒç´ çš„å¤§å°ï¼Œå¹¶æœŸæœ›æ¯ä¸ªç”¨æˆ·éƒ½èƒ½ä»¥å¤§è‡´ç›¸åŒçš„å¤§å°çœ‹åˆ°å®ƒä»¬ï¼Œè€Œä¸ç®¡ä»–ä»¬çš„ç¡¬ä»¶é…ç½®å¦‚ä½•ã€‚

ç‰¹åˆ«æåˆ°â€œRetinaâ€è®¾å¤‡ï¼Œè¿™ç¡®å®æ„å‘³ç€æ¯ä¸ª CSS åƒç´ çš„ç‰©ç†åƒç´ æ•°é‡å¢åŠ ä¸€å€ã€‚ç”±äºæ¯ä¸ªåƒç´ çš„å¤§å°æ˜¯æ ‡å‡†å®šä¹‰åƒç´ çš„ä¸€åŠï¼Œå› æ­¤æ¯ä¸ª CSS åƒç´ åœ¨æ¯ä¸ªç»´åº¦ä¸Šç”± 2 å€çš„ç‰©ç†åƒç´ ç»„æˆï¼ˆç»“æœæ˜¯æ¯ä¸ª CSS åƒç´ æœ‰ 4 å€çš„ç‰©ç†åƒç´ ï¼‰ã€‚

ä¸ºæ­¤ï¼Œè§†å£å…ƒæ ‡è®°ä»ç„¶å¼•ç”¨ CSS åƒç´ â€”â€”ä½¿ç”¨â€œwidth=device-widthâ€æˆ–â€œinitial-scale=1â€ä»ç„¶æ„å‘³ç€æ‚¨å°†è·å¾—ä¸€è‡´çš„è§†è§’ï¼Œè€Œä¸æ˜¯ä¸€è‡´çš„æ•°é‡åƒç´ ã€‚

https://www.reddit.com/r/web_design/comments/24c1hj/comment/ch5zx60/?utm_source=share&utm_medium=web2x&context=3

æ®æˆ‘äº†è§£ï¼Œæ‚¨æ‰€æœ‰çš„æ ‡è®°/css éƒ½æŒ‡çš„æ˜¯ CSS åƒç´ ã€‚è®¾å¤‡æ ¹æ®è®¾å¤‡çš„è®¾å¤‡åƒç´ æ¯”ç‡ç¡®å®š CSS åƒç´ å¦‚ä½•æ˜ å°„åˆ°ç‰©ç†åƒç´ ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å°† 50x50 çš„å›¾åƒä»¥ 1.3 çš„æ¯”ç‡æä¾›ç»™è®¾å¤‡ï¼Œå®ƒä¼šå°†å›¾åƒç¼©æ”¾åˆ° 65x65 ç‰©ç†åƒç´ ï¼Œåœ¨æ ‡å‡†å±å¹•ä¸Šçœ‹èµ·æ¥åƒ 50x50 å¤§å°ã€‚æ¯”ç‡ä¸º 2 çš„è®¾å¤‡ä¼šå°†å…¶ç¼©æ”¾åˆ° 100x100ã€‚ç›¸åï¼Œå¦‚æœæ‚¨æä¾› 100x100 çš„å›¾åƒï¼Œä½†ä½¿ç”¨ CSS å°†å…¶è°ƒæ•´ä¸º 50x50ï¼Œåˆ™æ¯”ç‡ä¸º 2 çš„è®¾å¤‡æ ¹æœ¬ä¸éœ€è¦ç¼©æ”¾å®ƒâ€”â€”å®ƒä¼šå°†å…¶æ˜ å°„åˆ° 1 æ¯” 1 çš„è®¾å¤‡åƒç´ ï¼Œä»è€Œäº§ç”Ÿæ¸…æ™°çš„å›¾åƒ.

https://blogs.perficient.com/2014/12/24/css-pixel-ratio-or-how-big-is-my-phone/

è¯´ç™½äº†ï¼ŒCSS åƒç´ æ¯”ï¼ˆä¹Ÿç§°ä¸ºè®¾å¤‡åƒç´ æ¯”ï¼‰æ˜¯è®¾å¤‡çš„ç‰©ç†åƒç´ å’Œé€»è¾‘åƒç´ ä¹‹é—´çš„å…³ç³»ã€‚å°¤å…¶æ˜¯éšç€è§†ç½‘è†œå±å¹•çš„å‡ºç°ï¼Œç°ä»£ç§»åŠ¨è®¾å¤‡çš„åƒç´ åˆ†è¾¨ç‡æ­£åœ¨å¿«é€Ÿå¢é•¿ã€‚è€ƒè™‘åˆ° iPhone 3g çš„åˆ†è¾¨ç‡ä¸º 320Ã—480 pxï¼ŒiPhone 4s çš„åˆ†è¾¨ç‡ä¸º 640Ã—960 pxï¼Œè€Œç°åœ¨ä¸€äº›æ‰‹æœºå¦‚ LG Nexus 5 çš„åˆ†è¾¨ç‡ä¸º 1080Ã—1920 pxã€‚å½“æ‰€æœ‰ç§»åŠ¨è®¾å¤‡çš„å±å¹•å°ºå¯¸å·®å¼‚å¦‚æ­¤ä¹‹å¤§æ—¶ï¼Œåº”è¯¥å¦‚ä½•ä¸ºæ‰€æœ‰ç§»åŠ¨è®¾å¤‡è®¾è®¡ç½‘ç«™ï¼Ÿè¿™æ­£æ˜¯åˆ›å»ºè®¾å¤‡åƒç´ æ¯”çš„åŸå› ã€‚

https://juiceboxinteractive.com/blog/a-pixel-is-not-a-pixel-designing-for-a-new-generation-of-mobile-devices/

è®¾å¤‡åˆ¶é€ å•†ç¡®å®šæœ‰å¤šå°‘ç¡¬ä»¶åƒç´ ç­‰äºä¸€ä¸ªè½¯ä»¶åƒç´ ï¼Œè¿™ä¸€æ¦‚å¿µç§°ä¸ºè®¾å¤‡åƒç´ æ¯”ã€‚å¯¹äº Apple çš„ Retina æ˜¾ç¤ºå±ï¼Œå•ä¸ª CSS åƒç´ åŒ…å«å››ä¸ªç¡¬ä»¶åƒç´ ï¼ˆ2 åƒç´ å®½å’Œ 2 åƒç´ é«˜ï¼‰ï¼Œè¿™æ„å‘³ç€è®¾å¤‡åƒç´ æ¯”ä¸º 2ã€‚ä¸‰æ˜Ÿ Galaxy S4 é€šè¿‡å¼•å…¥ 3 çš„è®¾å¤‡åƒç´ æ¯”æ›´è¿›ä¸€æ­¥ï¼Œè¿™æ„å‘³ç€æ¯ä¸ª CSS åƒç´ åŒ…å« 9 ä¸ªç¡¬ä»¶åƒç´ ã€‚ LG G3 æ˜¯ç¬¬ä¸€ä¸ªæ¯”ä¾‹ä¸º 4 çš„äº§å“ï¼Œç°åœ¨ Galaxy S6 ä¹Ÿç´§éšå…¶åã€‚ ï¼ˆæ‰‹æœºåˆ¶é€ å•†ï¼šä¸ä¹…æˆ‘ä»¬å°†åœæ­¢å…³å¿ƒã€‚ä¸è¦æˆä¸ºå‰åˆ—ã€‚ï¼‰

https://hacks.mozilla.org/2013/09/css-length-explained/

å®é™…çš„ DPPX å°†ç”±æ¯ä¸ªè¿è¾“è®¾å¤‡çš„åˆ¶é€ å•†ç¡®å®šã€‚

https://webplatform.github.io/docs/tutorials/understanding-css-units/

äº†è§£ CSS åƒç´ å¼•ç”¨æŠ½è±¡å‚è€ƒåƒç´ ï¼Œè¦è®°ä½çš„å…³é”®è§„åˆ™æ˜¯ 96 ä¸ª CSS åƒç´ çš„é•¿åº¦å§‹ç»ˆä¸ 1 CSS è‹±å¯¸ç›¸åŒã€‚

https://stackoverflow.com/a/40603876/14569218

åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒCss åƒç´ å¾ˆå¤§ç¨‹åº¦ä¸ŠåŸºäºå‚è€ƒåƒç´ ï¼Œè¯¥å‚è€ƒåƒç´ åŸºäºå…¶å§‹ç»ˆä¸º 96dpi çš„å‡è®¾ã€‚è¿™é‡Œï¼Œcss px å’Œ phy px æ˜¯é€šè¿‡åƒç´ æ¯”ç‡ç›¸å…³çš„ã€‚

96px will not always equal 1 real-life inch.

https://github.com/jawil/blog/issues/21

æ³¨æ„ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡ï¼Œå…¶å®æ˜¯æŒ‡æ¡Œé¢è®¾å®šçš„åˆ†è¾¨ç‡ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå™¨çš„ç‰©ç†åˆ†è¾¨ç‡ã€‚åªä¸è¿‡ç°åœ¨æ¶²æ™¶æ˜¾ç¤ºå™¨æˆä¸ºä¸»æµï¼Œç”±äºæ¶²æ™¶çš„æ˜¾ç¤ºåŸç†ä¸CRTä¸åŒï¼Œåªæœ‰åœ¨æ¡Œé¢åˆ†è¾¨ç‡ä¸ç‰©ç†åˆ†è¾¨ç‡ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºæ•ˆæœæœ€ä½³ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬çš„æ¡Œé¢åˆ†è¾¨ç‡å‡ ä¹æ€»æ˜¯ä¸æ˜¾ç¤ºå™¨çš„ç‰©ç†åˆ†è¾¨ç‡ä¸€è‡´äº†ã€‚

https://www.wikiwand.com/en/Pixel

ï¼ˆLogical pixelï¼‰åœ¨å›¾å½¢ã€ç½‘é¡µè®¾è®¡å’Œç”¨æˆ·ç•Œé¢ä¸­ï¼Œâ€œåƒç´ â€å¯èƒ½æŒ‡çš„æ˜¯å±å¹•ä¸Šçš„å›ºå®šé•¿åº¦è€Œä¸æ˜¯çœŸæ­£çš„åƒç´ ï¼Œä»¥é€‚åº”ä¸åŒçš„åƒç´ å¯†åº¦ã€‚ä¸€ä¸ªå…¸å‹çš„å®šä¹‰ï¼Œä¾‹å¦‚åœ¨ CSS ä¸­ï¼Œæ˜¯ä¸€ä¸ªâ€œç‰©ç†â€åƒç´ æ˜¯ 1â„96 è‹±å¯¸ï¼ˆ0.26 æ¯«ç±³ï¼‰ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿ç»™å®šå…ƒç´ å°†æ˜¾ç¤ºä¸ºç›¸åŒçš„å¤§å°ï¼Œæ— è®ºå±å¹•åˆ†è¾¨ç‡å¦‚ä½•ã€‚ [19]

https://www.w3.org/Style/Examples/007/units.en.html

ç»å¯¹å•ä½ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š1in = 2.54cm = 25.4mm = 72pt = 6pc

https://www.wikiwand.com/zh-hans/%E6%98%BE%E7%A4%BA%E5%88%86%E8%BE%A8%E7%8E%87

æè¿°åˆ†è¾¨ç‡çš„å•ä½æœ‰ï¼š[dpi](https://www.wikiwand.com/zh-hans/%E6%AF%8F%E8%8B%B1%E5%AF%B8%E7%82%B9%E6%95%B0)ï¼ˆç‚¹æ¯è‹±å¯¸ï¼‰ã€lpiï¼ˆçº¿æ¯è‹±å¯¸ï¼‰å’Œ[ppi](https://www.wikiwand.com/zh-hans/%E6%AF%8F%E8%8B%B1%E5%AF%B8%E5%83%8F%E7%B4%A0 "æ¯è‹±å¯¸åƒç´ ")ï¼ˆæ¯è‹±å¯¸åƒç´ ï¼‰ã€‚ä½†åªæœ‰lpiæ˜¯æè¿°å…‰å­¦åˆ†è¾¨ç‡çš„å°ºåº¦çš„ã€‚è™½ç„¶dpiå’Œppiä¹Ÿå±äºåˆ†è¾¨ç‡èŒƒç•´å†…çš„å•ä½ï¼Œä½†æ˜¯ä»–ä»¬çš„å«ä¹‰ä¸lpiä¸åŒã€‚è€Œä¸”lpiä¸dpiæ— æ³•æ¢ç®—ï¼Œåªèƒ½å‡­ç»éªŒä¼°ç®—ã€‚<sup>[[1]](https://www.wikiwand.com/zh-hans/%E6%98%BE%E7%A4%BA%E5%88%86%E8%BE%A8%E7%8E%87#citenote1)</sup>


å¦å¤–ï¼Œppiå’Œdpiç»å¸¸éƒ½ä¼šå‡ºç°æ··ç”¨ç°è±¡ã€‚ä½†æ˜¯ä»–ä»¬æ‰€ç”¨çš„é¢†åŸŸä¹Ÿå­˜åœ¨åŒºåˆ«ã€‚ä»æŠ€æœ¯è§’åº¦è¯´ï¼Œâ€œåƒç´ â€åªå­˜åœ¨äºç”µè„‘æ˜¾ç¤ºé¢†åŸŸï¼Œè€Œâ€œç‚¹â€åªå‡ºç°äºæ‰“å°æˆ–å°åˆ·é¢†åŸŸã€‚

https://www.wikiwand.com/en/Pixel

è®¡ç®—æœºæ˜¾ç¤ºå™¨ä¸Šçš„åƒç´ é€šå¸¸æ˜¯â€œæ–¹å½¢â€çš„ï¼ˆå³å…·æœ‰ç›¸ç­‰çš„æ°´å¹³å’Œå‚ç›´é‡‡æ ·é—´è·ï¼‰ï¼›å…¶ä»–ç³»ç»Ÿä¸­çš„åƒç´ é€šå¸¸æ˜¯â€œçŸ©å½¢â€çš„ï¼ˆå³å…·æœ‰ä¸ç›¸ç­‰çš„æ°´å¹³å’Œå‚ç›´é‡‡æ ·é—´è· - é•¿æ–¹å½¢ï¼‰ï¼Œå…·æœ‰ä¸åŒçºµæ¨ªæ¯”çš„æ•°å­—è§†é¢‘æ ¼å¼ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¾‹å¦‚ Rec. 601 æ•°å­—è§†é¢‘æ ‡å‡†ã€‚

https://zhuanlan.zhihu.com/p/97895083

å±å¹•åƒç´ ï¼ˆscreen pixelï¼‰æ˜¯æ˜¾ç¤ºè®¾å¤‡æˆåƒçš„æœ€å°å•ä½ã€‚å’Œå›¾åƒä¸åŒï¼Œæˆ‘ä»¬çœ‹åˆ°çš„å±å¹•åƒç´ éƒ½æ˜¯çœŸå®å‘å…‰çš„ç‰©ç†å…ƒä»¶ï¼Œæ—¢ç„¶æ˜¯ç‰©ç†åŸä»¶å°±ä¸å¯èƒ½æ— ç¼å¡«æ»¡æ•´ä¸ªå±å¹•ï¼Œå½“ç„¶åƒç´ å¤§å°ã€å½¢çŠ¶ä¹Ÿå¯ä»¥è‡ªç”±å®šä¹‰ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¾ç¤ºå™¨ã€ç”µè§†ã€æ‰‹æœºå±å¹•éƒ½æ˜¯ä¸€æ ·ã€‚ä¸¤ä¸ªç›¸é‚»åƒç´ ä¹‹é—´çš„è·ç¦»å°±æ˜¯ç‚¹è·ï¼ˆdot pitchï¼‰ï¼Œç‚¹è·è¶Šå°æˆåƒè¶Šç»†è…»ï¼Œè¿‘è·ç¦»ä½¿ç”¨ä½“éªŒè¶Šå¥½ã€‚æ‰€ä»¥å³ä½¿æ˜¯ä¸€å¼ çŸ¢é‡å›¾ï¼Œä½¿ç”¨æ˜¾ç¤ºå™¨è¿‘è·ç¦»è§‚çœ‹ï¼Œè¿˜æ˜¯ä¼šçœ‹åˆ°æ˜æ˜¾çš„åƒç´ é¢—ç²’æ„Ÿï¼Œè¿™æ˜¯æ˜¾ç¤ºå™¨å†³å®šçš„ã€‚

è¿™é‡Œé¡ºä¾¿â€œè¯å®â€ä¸€ä¸ªè°£è¨€ï¼Œå¸¸æœ‰è°£ä¼ é«˜åˆ†å±ä¸Šå¼€ä½å±å¹•åˆ†è¾¨ç‡å¯ä»¥çœç”µï¼Œä»ç»“æœçœ‹è¿™æ˜¯å¯¹çš„ï¼Œè°ƒä½åˆ†è¾¨ç‡å¯ä»¥çœç”µï¼Œä½†æ˜¯çœçš„ä¸æ˜¯å±å¹•çš„ç”µè€Œæ˜¯æ˜¾å¡çš„ç”µã€‚è°ƒä½åˆ†è¾¨ç‡æ¯ä¸€ä¸ªç‰©ç†åƒç´ è¿˜æ˜¯åœ¨å‘å…‰ï¼Œå¹¶ä¸ä¼šå› æ­¤ä¼‘æ¯ï¼Œä½†æ˜¯ä½åˆ†è¾¨ç‡ä¸‹æ˜¾å¡å¯ä»¥é€šè¿‡æ›´å°‘è®¡ç®—å°±è¾“å‡ºç”»é¢ã€‚

https://www.jianshu.com/p/c3387bcc4f6e

åŸæ¥ä¸€è‹±å¯¸ç›¸å½“äºæˆ‘ä»¬çš„2.54å˜ç±³è¿™ä¹ˆé•¿ã€‚ç°åœ¨è®©æˆ‘ä»¬å›åˆ°5.2è‹±å¯¸åˆ°åº•æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„è¿™ä¸ªé—®é¢˜ã€‚ä¸€å¼€å§‹å‘¢ï¼Œæˆ‘è§‰å¾—å¯èƒ½æ˜¯æ‰‹æœºå±å¹•çš„é¢ç§¯æœ‰è¿™ä¹ˆå¤§å§ï¼Œåæ¥æˆ‘ç™¾åº¦äº†è‹±å¯¸ä¹‹åï¼Œæ‰å‘ç°è‡ªå·±æœ‰å¤šæ„šè ¢ã€‚å› ä¸ºè‹±å¯¸æ˜¯é•¿åº¦å•ä½ï¼Œé¢ç§¯çš„è¡¨ç¤ºè¦ç”¨é¢ç§¯å•ä½ï¼Œè‹±å¯¸æ˜¾ç„¶ä¸å¯ä»¥è¡¨ç¤ºé¢ç§¯ã€‚ä»è¿™ä¸€ç‚¹ï¼Œå°±å¦è®¤äº†æˆ‘çš„æƒ³æ³•ã€‚

https://stackoverflow.com/a/41126784/14569218

Note: If the anchor unit is the pixel unit, the physical units might not match their physical measurements. Alternatively if the anchor unit is a physical unit, the pixel unit might not map to a whole number of device pixels.

æ³¨æ„ï¼šå¦‚æœé”šå•ä½æ˜¯åƒç´ å•ä½ï¼Œåˆ™ç‰©ç†å•ä½å¯èƒ½ä¸å…¶ç‰©ç†æµ‹é‡ä¸åŒ¹é…ã€‚æˆ–è€…ï¼Œå¦‚æœé”šå•å…ƒæ˜¯ç‰©ç†å•å…ƒï¼Œåˆ™åƒç´ å•å…ƒå¯èƒ½ä¸ä¼šæ˜ å°„åˆ°æ•´æ•°ä¸ªè®¾å¤‡åƒç´ ã€‚

https://stackoverflow.com/a/58979031/14569218

CSSè‹±å¯¸å’Œç‰©ç†è‹±å¯¸æ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚ 1 CSS è‹±å¯¸å§‹ç»ˆä¸º 96pxï¼Œä¸å±å¹•å¯†åº¦æ— å…³ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨ 96 dpi æ˜¾ç¤ºå™¨ä¸Šï¼ŒCSS è‹±å¯¸å’Œç‰©ç†è‹±å¯¸æ‰èƒ½è¢«è§†ä¸ºç›¸ç­‰ã€‚

https://stackoverflow.com/a/21413366/14569218

Device Pixel Ratio == CSS Pixel Ratio
In the world of web development, the device pixel ratio (also called CSS Pixel Ratio) is what determines how a device's screen resolution is interpreted by the CSS.

Why does the Device Pixel Ratio exist?

The reason that CSS pixel ratio was created is because as phones screens get higher resolutions, if every device still had a CSS pixel ratio of 1 then webpages would render too small to see.

A typical full screen desktop monitor is a roughly 24" at 1920x1080 resolution. Imagine if that monitor was shrunk down to about 5" but had the same resolution. Viewing things on the screen would be impossible because they would be so small. But manufactures are coming out with 1920x1080 resolution phone screens consistently now.

So the device pixel ratio was invented by phone makers so that they could continue to push the resolution, sharpness and quality of phone screens, without making elements on the screen too small to see or read.

https://www.pudn.com/news/628f8312bf399b7f351e67b2.html

## TODOs

* åˆ†è¾¨ç‡è¶Šé«˜ï¼Œå­—ä¼šæ˜¾å¾—è¶Šå°ï¼Ÿ


## References

* [CSS Length Explained](https://hacks.mozilla.org/2013/09/css-length-explained/)
* [A pixel is not a pixel: designing for a new generation of mobile devices](https://juiceboxinteractive.com/blog/a-pixel-is-not-a-pixel-designing-for-a-new-generation-of-mobile-devices/)
* [Understanding pixels and other CSS units](https://webplatform.github.io/docs/tutorials/understanding-css-units/)
* [CSSåƒç´ ã€ç‰©ç†åƒç´ ã€é€»è¾‘åƒç´ ã€è®¾å¤‡åƒç´ æ¯”ã€PPIã€Viewport](https://github.com/jawil/blog/issues/21#)
* [EM, PX, PT, CM, INâ€¦](https://www.w3.org/Style/Examples/007/units.en.html)
* [å½“æˆ‘ä»¬åœ¨è®¨è®ºè®¾å¤‡åƒç´ æ¯”ï¼ˆdevice pixel ratioï¼Œdprï¼‰çš„æ—¶å€™æˆ‘ä»¬åœ¨è®¨è®ºä»€ä¹ˆï¼Ÿ](https://blog.csdn.net/easonmu/article/details/122714738)

-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS éšè—æ»šåŠ¨æ¡æ€»ç»“]]></title>
            <link>https://github.com/toFrankie/blog/issues/173</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/173</guid>
            <pubDate>Sun, 26 Feb 2023 07:51:18 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-72a7790449ca20f7.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-72a7790449ca20f7.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°æ»šåŠ¨æ¡ï¼Ÿ</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªå…ƒç´ çš„å†…å®¹å¤§å°è¶…è¿‡äº†æ‰€åœ¨å®¹å™¨çš„ç©ºé—´å¤§å°æ—¶ï¼Œä¼šäº§ç”Ÿæº¢å‡ºæ•ˆæœï¼Œè€Œä¸”æº¢å‡ºéƒ¨åˆ†çš„å†…å®¹æ˜¯å¯è§çš„ã€‚</p>
<p>åœ¨ CSS ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>overflow</code> å±æ€§å¯¹æº¢å‡ºå†…å®¹åšæ§åˆ¶ï¼Œå®ƒæ˜¯ <code>overflow-x</code> å’Œ <code>overflow-y</code> çš„ç®€å†™å±æ€§ã€‚å…¶ä¸­ <code>overflow</code> äº§ç”Ÿæ•ˆæœçš„å‰ææ˜¯ï¼š</p>
<blockquote>
<p>å…ƒç´ æ‰€åœ¨çš„å—çº§å®¹å™¨æŒ‡å®šäº†é«˜åº¦ï¼ˆè®¾ç½® <code>height</code> æˆ– <code>max-height</code>ï¼‰æˆ–å°† <code>white-space</code> è®¾ä¸º <code>nowrap</code>ã€‚</p>
</blockquote>
<h4>å–å€¼</h4>
<table>
<thead>
<tr>
<th>å±æ€§å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>visibile</code></td>
<td>é»˜è®¤å€¼ï¼Œå†…å®¹ä¸ä¼šè¢«ä¿®å‰ªï¼Œä¼šå‘ˆç°åœ¨å®¹å™¨ä¹‹å¤–ã€‚</td>
</tr>
<tr>
<td><code>hidden</code></td>
<td>å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œå¹¶ä¸”æº¢å‡ºå†…å®¹ä¸å¯è§ã€‚</td>
</tr>
<tr>
<td><code>scroll</code></td>
<td>å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ï¼Œæ»šåŠ¨å¯æŸ¥çœ‹æº¢å‡ºå†…å®¹ã€‚</td>
</tr>
<tr>
<td><code>auto</code></td>
<td>ç”±æµè§ˆå™¨å®šå¤ºï¼Œå¦‚æœå†…å®¹è¢«ä¿®å‰ªï¼Œå°±ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ã€‚</td>
</tr>
<tr>
<td><code>overlay</code></td>
<td>è¡Œä¸ºä¸ <code>auto</code> ç›¸åŒï¼Œä½†æ»šåŠ¨æ¡ç»˜åˆ¶åœ¨å†…å®¹ä¹‹ä¸Šè€Œä¸æ˜¯å ç”¨ç©ºé—´ã€‚ä»…è¢«åŸºäº WebKit å†…æ ¸çš„æµè§ˆå™¨æ‰€æ”¯æŒã€‚</td>
</tr>
<tr>
<td><code>clip</code></td>
<td>è¡Œä¸ºä¸ <code>hidden</code> ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºå®ƒæ— æ³•é€šè¿‡ DOM API ä½¿å¾—å…ƒç´ æ»šåŠ¨ï¼ˆæ–°ç‰¹æ€§å…¼å®¹æ€§è¾ƒå·®ï¼‰ã€‚</td>
</tr>
</tbody>
</table>
<p>ç”±äº <code>overflow</code> æ˜¯ç®€å†™å½¢å¼ï¼ŒæŒ‰ç…§è§„èŒƒï¼š</p>
<ul>
<li>å¦‚æœæŒ‡å®šä¸€ä¸ªå€¼æ—¶ï¼Œ<code>overflow-x</code> å’Œ <code>overflow-y</code> éƒ½åº”ç”¨ç›¸åŒçš„å€¼ã€‚</li>
<li>å¦‚æœæŒ‡å®šä¸¤ä¸ªå€¼æ—¶ï¼Œç¬¬ä¸€ä¸ªå€¼åº”ç”¨äº <code>overflow-x</code>ï¼Œç¬¬äºŒä¸ªåº”ç”¨äº <code>overflow-y</code>ã€‚</li>
</ul>
<blockquote>
<p>ä½†æ˜¯æ€»æœ‰ä¸éµå¾ªè§„èŒƒçš„å®¶ä¼™ï¼Œåœ¨ Firefox 63 ä¹‹å‰ï¼ŒæŒ‡å®šä¸¤ä¸ªå€¼æ—¶ï¼Œåˆšå¥½ä¸è§„èŒƒç›¸åï¼Œå‰è€…ä½œç”¨äº <code>overflow-y</code>ï¼Œåè€…ä½œç”¨äº <code>overflow-x</code>ã€‚åœ¨åç»­æ–°ç‰ˆæœ¬ä¸­é¡ºåºå·²ç»è°ƒæ•´è¿‡æ¥ï¼Œå¦‚è§„èŒƒä¸€èˆ¬ã€‚<strong>å› æ­¤ï¼Œå½“ <code>overflow-x</code> å’Œ <code>overflow-y</code> éœ€æŒ‡å®šä¸åŒçš„å€¼æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨ç®€å†™å½¢å¼ï¼Œåº”åˆ†åˆ«è®¾ç½®ä¸ºå¥½ã€‚</strong></p>
</blockquote>
<h4>æ³¨æ„ç‚¹</h4>
<blockquote>
<ol>
<li>å½“ä¸€ä¸ªè½´è®¾ç½®äº†é <code>visibile</code> çš„å€¼ï¼Œå³ä½¿å¦å¤–ä¸€ä¸ªè½´æŒ‡å®šä¸º <code>visibile</code>ï¼Œå®ƒçš„è¡Œä¸ºä¹Ÿä¼šå˜æˆ <code>auto</code> çš„æ•ˆæœã€‚</li>
<li>å½“ <code>overflow</code> æŒ‡å®šä¸ºé <code>visibile</code> çš„å€¼ï¼Œè¯¥å®¹å™¨ä¼šå½¢æˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰ã€‚</li>
<li>å°½ç®¡ <code>overflow: hidden</code> å¯ä»¥éšè—æº¢å‡ºå†…å®¹ï¼Œä½†ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollTop">Element.scrollTop</a> ä»å¯ä»¥ç”¨æ¥æ»šåŠ¨å…ƒç´ ã€‚ç›®å‰æœ‰ä¸€ä¸ª<a href="https://caniuse.com/?search=overflow%3A%20clip">å…¼å®¹æ€§</a>ä¸å¥½çš„æ–°ç‰¹æ€§ <code>clip</code> å€’æ˜¯å¯ä»¥è§£å†³è¿™ç§é€šè¿‡ DOM API æ»šåŠ¨çš„é—®é¢˜ã€‚</li>
</ol>
</blockquote>
<p>å…³äºæ›´å¤š <code>clip</code> å†…å®¹ï¼Œè¯·çœ‹<a href="https://www.zhangxinxu.com/wordpress/2022/02/css-overflow-clip-margin/">æ–‡ç« </a>ã€‚</p>
<h2>äºŒã€å¦‚ä½•éšè—æ»šåŠ¨æ¡ï¼Ÿ</h2>
<p>åœ¨ä¸åŒæµè§ˆå™¨ä¸­ï¼Œéšè—çš„æ–¹å¼è¿˜æœ‰ç‚¹ä¸åŒï¼Œåªè¦åœ¨æ‰€åœ¨çš„å—çº§å®¹å™¨ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹æ ·å¼å³å¯ã€‚</p>
<h4>Chromeã€Safari ç­‰åŸºäº WebKitï¼ˆBlinkï¼‰å†…æ ¸çš„æµè§ˆå™¨</h4>
<p>å®ƒä½¿ç”¨åˆ° <code>::-webkit-scrollbar</code> ä¼ªå…ƒç´ ï¼Œæ›´å¤š<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/::-webkit-scrollbar">è¯·çœ‹</a>ã€‚</p>
<pre><code class="language-css">.container::-webkit-scrollbar {
  display: none;
  width: 0;
  height: 0;
  color: transparent;
}
</code></pre>
<h4>FireFox æµè§ˆå™¨</h4>
<p>ä½¿ç”¨åˆ°æ ‡å‡†çš„ <code>scrollbar-width</code> å±æ€§ï¼Œæ›´å¤š<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/scrollbar-width">è¯·çœ‹</a>ã€‚</p>
<pre><code class="language-css">.container {
  scrollbar-width: none;
}
</code></pre>
<h4>IE æµè§ˆå™¨</h4>
<p>è¿™è´§è¿™æ ·å¤„ç†ï¼š</p>
<pre><code class="language-css">.container {
  -ms-overflow-style: none; /* IE 10+ */
}
</code></pre>
<p>å› æ­¤ï¼Œæ±‡æ€»èµ·æ¥å¦‚ä¸‹å…¼å®¹å¤„ç†ï¼š</p>
<pre><code class="language-css">.container {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.container::-webkit-scrollbar {
  display: none;
  width: 0;
  height: 0;
  color: transparent;
}
</code></pre>
<h4>å…¶ä»–</h4>
<p>å…³äºå¾®ä¿¡å°ç¨‹åºéšè— <code>&lt;scroll-view&gt;</code> æ»šåŠ¨æ¡ï¼ˆæˆ‘æš‚æ—¶æœªé‡åˆ°è¿™ç§éœ€æ±‚ï¼Œæ‡’å¾—å»å®æµ‹äº†ï¼‰ï¼Œè¯·çœ‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/qq_41638795/article/details/98172326">å¾®ä¿¡å°ç¨‹åº -- å»æ‰ scroll-view æ»šåŠ¨æ¡ï¼ˆæµ‹è¯•æœ‰æ•ˆï¼‰</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/00024e761d872887f24858d0252000">å°ç¨‹åºå¦‚ä½•éšè—æ»šåŠ¨æ¡</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Taro å•ä½è½¬æ¢ä¼˜åŒ–]]></title>
            <link>https://github.com/toFrankie/blog/issues/172</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/172</guid>
            <pubDate>Sun, 26 Feb 2023 07:49:47 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2d95ef1cdede782f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2d95ef1cdede782f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>è¿‘æœŸå°† Taro ä» v3.4.8 å‡çº§è‡³ v3.6.20ï¼Œå‘ç°æœ‰ä¸€äº›è°ƒæ•´ï¼ˆæ–‡æœ«ï¼‰ã€‚</p>
</blockquote>
<h2>ä¸€ã€å•ä½ä½¿ç”¨</h2>
<p>åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼š</p>
<pre><code class="language-shell">$ yarn global add @tarojs/cli

$ taro init simple-taro

$ yarn dev:weapp
</code></pre>
<blockquote>
<p>å®é™…é¡¹ç›®å»ºè®®å°† <code>@taro/cli</code> å®‰è£…åˆ°é¡¹ç›®ä¾èµ–é‡Œé¢ï¼Œè€Œä¸æ˜¯å…¨å±€å®‰è£…ã€‚<code>@taro/cli</code> ä¸ <code>@tarojs/taro</code> ç‰ˆæœ¬ä¸€è‡´å¾ˆé‡è¦ï¼Œå¯ä»¥é¿å…ä¸€äº›é—®é¢˜ã€‚</p>
</blockquote>
<p>ä»¥ <code>750px</code> çš„è®¾è®¡ç¨¿å°ºå¯¸ä¸ºä¾‹ï¼Œé€šå¸¸ Taro é…ç½®æ–‡ä»¶ä¼šè®¾ç½®ï¼ˆ<a href="https://docs.taro.zone/docs/size">æ›´å¤šå°ºå¯¸</a>ï¼‰ï¼š</p>
<pre><code class="language-js">const config = {
  designWidth: 750,
  deviceRatio: { 750: 1 }
}
</code></pre>
<p>è¿™æ ·ï¼Œæºç ä½¿ç”¨ <code>px</code> å•ä½å³å¯ï¼Œæ‰“åŒ…æ—¶ä¼šå¯¹åº”å¹³å°çš„å•ä½ã€‚æ¯”å¦‚å°ç¨‹åºçš„ <code>rpx</code>ã€H5 çš„ <code>rem</code>ã€‚</p>
<pre><code class="language-css">/* ç¼–è¯‘å‰ */
.avatar {
  width: 50px;
}
 
/* ç¼–è¯‘ä¸ºå°ç¨‹åº */
.avatar {
  width: 50rpx;
}
 
/* ç¼–è¯‘ä¸º H5 */
.avatar {
  width: 1.0667rem;
}
</code></pre>
<p>å¦‚æœæ˜¯è¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>Taro.pxtransform</code> APIï¼š</p>
<pre><code class="language-js">Taro.pxtransform(50) // æ— éœ€æŒ‡å®šå•ä½
</code></pre>
<p>å¦‚æœä¸æƒ³è¢«è½¬æ¢ï¼Œå¯ä»¥å†™æˆ <code>1Px</code> æˆ– <code>1PX</code>ï¼ˆæ’ç‰ˆå¼•æ“å¤§å°å†™å‡å¯è¯†åˆ«ï¼‰ã€‚</p>
<pre><code class="language-css">.avatar {
  width: 1Px; /* å°†ä¼šè¢«å¿½ç•¥ */
}
</code></pre>
<p>è‹¥è¦å¿½ç•¥æŸä¸ªæ–‡ä»¶ï¼Œåˆ™åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  <code>/* postcss-pxtransform disable */</code> æ³¨é‡Šå³å¯ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œå¦‚æœé¡¹ç›®æœ‰ç”¨ Prettierã€Stylelint ç­‰æ ¼å¼åŒ–å·¥å…·ï¼Œä¿å­˜æ—¶å¯èƒ½ä¼šè¢«è‡ªåŠ¨ä¿®å¤ä¸º pxï¼Œéœ€è¦ç”¨ <code>/* prettier-ignore */</code> ç­‰å¿½ç•¥æ‰ã€‚</p>
</blockquote>
<p>è¿˜æä¾›äº†è¿™äº›é…ç½®ï¼š</p>
<pre><code class="language-js">{
  postcss: {
    pxtransform: {
      enable: true,
      config: {
        onePxTransform: true, // è®¾ç½® 1px æ˜¯å¦éœ€è¦è¢«è½¬æ¢
        unitPrecision: 5, // rem å•ä½å…è®¸çš„å°æ•°ä½
        propList: ['*'], // å…è®¸è½¬æ¢çš„å±æ€§
        selectorBlackList: [], // é»‘åå•é‡Œçš„é€‰æ‹©å™¨å°†ä¼šè¢«å¿½ç•¥ï¼Œä¸åšè½¬æ¢å¤„ç†
        replace: true, // ç›´æ¥æ›¿æ¢è€Œä¸æ˜¯è¿½åŠ ä¸€æ¡è¿›è¡Œè¦†ç›–
        mediaQuery: false, // å…è®¸åª’ä½“æŸ¥è¯¢é‡Œçš„ px å•ä½è½¬æ¢
        minPixelValue: 0 // è®¾ç½®ä¸€ä¸ªå¯è¢«è½¬æ¢çš„æœ€å° px å€¼
      }
    }
  }
}
</code></pre>
<h2>äºŒã€ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–ï¼Ÿ</h2>
<p>å…¶å® Taro å·²ç»æä¾›äº†å®Œå¤‡è½¬æ¢æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼˜åŒ–å‘¢ï¼Ÿ</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-css">/* ç¼–è¯‘å‰ */
.avatar {
  width: 50px;
}
 
/* ç¼–è¯‘ä¸ºå°ç¨‹åº */
.avatar {
  width: 50rpx;
}
 
/* ç¼–è¯‘ä¸º H5 */
.avatar {
  width: 1.0667rem;
}
</code></pre>
<p>ä»ç¼–è¯‘ç»“æœçœ‹ï¼Œç¼–è¯‘åˆ° H5 ç«¯å®½åº¦æ˜¯ <code>1.0667rem</code>ã€‚</p>
<p><strong>è¯•æƒ³ï¼Œå¦‚æœè¦ç”¨åˆ° DevTool è°ƒè¯•åƒç´ å¤§å°ï¼ˆæ¯”å¦‚æ·»åŠ  2 åƒç´ ï¼‰ï¼Œé¢å¯¹ <code>width: 1.0667rem</code> è¿™ä¸ªå€¼ï¼Œä½ è¦æ€ä¹ˆä¸‹æ‰‹å‘¢ï¼Ÿ</strong></p>
<p>å¦‚æœ H5 ç«¯ç¼–è¯‘å‰åç›¸å·® 100ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡æœ‰æ¢ç®—è´Ÿæ‹…äº†ï¼Ÿ</p>
<pre><code class="language-css">/* ç¼–è¯‘å‰ */
.avatar {
  width: 50px;
}

/* ç¼–è¯‘ä¸º H5 */
.avatar {
  width: 0.5rem;
}
</code></pre>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å°±æœç€è¿™ä¸ªæ–¹å‘å»åš...</p>
<h2>ä¸‰ã€è½¬æ¢åŸç†</h2>
<p>ä½ ä¹Ÿè®¸ç”¨è¿‡ <a href="https://github.com/cuth/postcss-pxtorem/">postcss-pxtorem</a> æ’ä»¶ï¼Œå°†  <code>px</code> è½¬æ¢ä¸º <code>rem</code>ã€‚Taro å†…éƒ¨çš„å•ä½è½¬æ¢æ’ä»¶ <a href="https://github.com/Pines-Cheng/postcss-pxtransform/">postcss-pxtransform</a> åœ¨æ­¤åŸºç¡€ä¸ŠäºŒæ¬¡å¼€å‘çš„ï¼Œæ–°å¢äº†å¯¹å°ç¨‹åºçš„æ”¯æŒã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ <code>rem</code> å‚ç…§ç‰©æ˜¯é¡µé¢æ ¹èŠ‚ç‚¹å­—å·ã€‚æ¯”å¦‚æ ¹èŠ‚ç‚¹å­—å·æ˜¯ <code>16px</code>ï¼Œé‚£ä¹ˆ <code>1rem</code> = <code>16px</code> çš„é•¿åº¦ã€‚</p>
<p>å‡è®¾ 750px è®¾è®¡ç¨¿ä¸­ï¼ŒæŸä¸ªå…ƒç´ é•¿åº¦ä¸º <code>123px</code> æ—¶ï¼ŒæŒ‰ç…§æ ¹å…ƒç´ å­—å· <code>16px</code> æ¥æ¢ç®—ï¼Œå¯¹åº”å°±æ˜¯ <code>123 / 16 = 7.6875rem</code>ï¼Œè¿™æ ·çš„è¯æ¢ç®—è´Ÿæ‹…éå¸¸å¤§ã€‚</p>
<p>å¦‚æœæ¢ç®—çš„åŸºç¡€å€¼æ˜¯ <code>100</code>ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ <code>123px</code> è¿˜æ˜¯ <code>345px</code>ï¼ŒåŸæœ‰å€¼é™¤ä»¥ <code>100</code> å°±æ˜¯ç¼–è¯‘ç»“æœï¼Œæ¢ç®—è´Ÿæ‹…ä¸ºé›¶ã€‚</p>
<h3>ä½¿ç”¨ postcss-pxtorem</h3>
<p>åœ¨é Taro é¡¹ç›®ä¸­ï¼Œæˆ‘é€šå¸¸æ˜¯è¿™æ ·ä½¿ç”¨ <code>postcss-pxtorem</code> çš„ï¼š</p>
<pre><code class="language-js">// postcss.config.js
module.exports = {
  // ...
  plugins: [
    require('postcss-pxtorem')({
      propList: ['*'],
      rootValue: 100,
      minPixelValue: 2
    })
  ]
}
</code></pre>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ <a href="https://github.com/cuth/postcss-pxtorem/#options">postcss-pxtorem</a> é…ç½®é¡¹çš„é»˜è®¤å€¼ï¼š</p>
<pre><code class="language-js">{
  rootValue: 16,
  unitPrecision: 5,
  propList: ['font', 'font-size', 'line-height', 'letter-spacing'], // è¿™äº› CSS å±æ€§å°†ä¼šè¢«è½¬æ¢
  selectorBlackList: [],
  replace: true,
  mediaQuery: false,
  minPixelValue: 0,
  exclude: /node_modules/i,
}
</code></pre>
<p>ä¸»è¦å…³æ³¨ <code>rootValue</code> é…ç½®é¡¹ï¼Œå®ƒæ¥å—ä¸€ä¸ª <code>Number</code> æˆ– <code>Function</code> å‚æ•°ï¼Œæè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Represents the root element font size or returns the root element font size based on theÂ <a href="https://api.postcss.org/Input.html"><code>input</code></a>Â parameter.</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<code>ä¹¦å†™å€¼/rootValue = è½¬æ¢å€¼</code>ã€‚æ¯”å¦‚æºç æ˜¯ <code>50px</code>ï¼Œå½“ <code>rootValue</code> ä¸º <code>16</code>ï¼Œé‚£ä¹ˆç»“æœä¸º <code>50/16 = 3.125rem</code>ã€‚</p>
<p>æ‰€ä»¥ <code>rootValue</code> è®¾ç½®ä¸º <code>100</code> çš„åŸå› å¾ˆç®€å•ï¼š<strong>æ¢ç®—è´Ÿæ‹…æœ€å°ï¼Œçº¦ä¸ºé›¶</strong>ã€‚è¿™æ · <code>50px</code> â†’ <code>0.5rem</code>ã€<code>123px</code> â†’ <code>1.23rem</code>ã€‚</p>
<h3>è®¾å¤‡åƒç´ ä¸ CSS åƒç´ </h3>
<p>åœ¨å¾€ä¸‹ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹è¿™äº›å†…å®¹ï¼š</p>
<table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>è®¾å¤‡åˆ†è¾¨ç‡</th>
<th>è®¾å¤‡åƒç´ </th>
<th>CSS åƒç´ </th>
<th>è®¾å¤‡åƒç´ æ¯”</th>
</tr>
</thead>
<tbody>
<tr>
<td>iPhone 5/5s</td>
<td>640 Ã— 1136</td>
<td>640 Ã— 1136</td>
<td>320 Ã— 568</td>
<td>2</td>
</tr>
<tr>
<td>iPhone 6/6s/7/8</td>
<td>750 Ã— 1334</td>
<td>750 Ã— 1334</td>
<td>375 Ã— 667</td>
<td>2</td>
</tr>
<tr>
<td>iPhone 6/6s/7/8 Plus</td>
<td>1080 Ã— 1920</td>
<td>1242 Ã— 2208</td>
<td>414 Ã— 736</td>
<td>3</td>
</tr>
<tr>
<td>iPhone X/XS</td>
<td>1125 Ã— 2436</td>
<td>1125 Ã— 2436</td>
<td>375 Ã— 812</td>
<td>3</td>
</tr>
<tr>
<td>iPhone XR</td>
<td>828 Ã— 1792</td>
<td>828 Ã— 1792</td>
<td>414 Ã— 896</td>
<td>2</td>
</tr>
<tr>
<td>iPhone 11 Pro</td>
<td>1125 Ã— 2436</td>
<td>1125 Ã— 2436</td>
<td>375 Ã— 812</td>
<td>3</td>
</tr>
<tr>
<td>iPhone XS Max/11 Pro Max</td>
<td>1242 Ã— 2688</td>
<td>1242 Ã— 2688</td>
<td>414 Ã— 896</td>
<td>3</td>
</tr>
<tr>
<td>iPhone 12 mini</td>
<td>1125 Ã— 2436</td>
<td>1125 Ã— 2436</td>
<td>375 Ã— 812</td>
<td>2</td>
</tr>
<tr>
<td>iPhone 12/12 Pro</td>
<td>1170 Ã— 2532</td>
<td>1170 Ã— 2532</td>
<td>390 Ã— 844</td>
<td>3</td>
</tr>
<tr>
<td>iPhone 12 Pro Max</td>
<td>1284 Ã— 2778</td>
<td>1284 Ã— 2778</td>
<td>428 Ã— 926</td>
<td>3</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ¨è <a href="https://yesviz.com/">YESVIZ</a> å’Œ <a href="https://www.mydevice.io/">My Device</a> ä¸¤ä¸ªç½‘ç«™ï¼Œå¯ä»¥æŸ¥çœ‹å¸¸è§è®¾å¤‡å‚æ•°ã€‚</p>
</blockquote>
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-2de75000e4b49a5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p>æ€ä¹ˆåŒºåˆ†ï¼š</p>
<ul>
<li>è®¾å¤‡åˆ†è¾¨ç‡ï¼šé€šå¸¸æ˜¯ç”¨æˆ·æ¯”è¾ƒå…³æ³¨çš„è´­æœºæŒ‡æ ‡ã€‚</li>
<li>è®¾å¤‡åƒç´ ï¼šæ˜¯è®¾è®¡å¸ˆå…³æ³¨çš„æŒ‡æ ‡ï¼Œ<strong>å¸¸è¯´çš„ 750px è®¾è®¡ç¨¿å°ºå¯¸ï¼Œå°±æ˜¯æŒ‡è®¾å¤‡åƒç´ çš„å®½åº¦</strong>ã€‚</li>
<li>CSS åƒç´ ï¼šæ˜¯å¼€å‘è€…éœ€å…³æ³¨çš„æŒ‡æ ‡ï¼ŒåŒæ—¶è¦ç†è§£è®¾å¤‡åƒç´ ä¸ CSS åƒç´ çš„å…³ç³»ã€‚</li>
<li>è®¾å¤‡åƒç´ æ¯”ï¼šè®¾å¤‡åƒç´  / CSS åƒç´ ã€‚</li>
</ul>
<p>æˆ‘ä»¬è¿˜ç»å¸¸çœ‹å¾—åˆ°è¿™æ ·çš„å£°æ˜ï¼š</p>
<pre><code class="language-html">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no&quot; /&gt;
</code></pre>
<ul>
<li><code>width=device-width</code>ï¼šå®šä¹‰ Viewport å®½åº¦ã€‚ç”±äºå„æµè§ˆå™¨é»˜è®¤ Viewport å®½åº¦å¯èƒ½ä¸ä¸€è‡´ï¼Œè€Œä¸”ç§»åŠ¨è®¾å¤‡çš„å±å¹•å¤§å°æœ‰é™ï¼Œé€šå¸¸ä¼šå°†è®¾å¤‡å®½åº¦è®¾ç½®ä¸º Viewport å®½åº¦ã€‚</li>
<li><code>initial-scale=1</code>ï¼šå®šä¹‰è®¾å¤‡å®½åº¦ä¸ Viewport ä¹‹é—´çš„ç¼©æ”¾æ¯”ä¾‹ã€‚</li>
<li><code>minimum-scale=1</code>ï¼šå®šä¹‰ç¼©æ”¾æ¯”ä¾‹çš„æœ€å°å€¼ã€‚</li>
<li><code>maximum-scale=1</code>ï¼šå®šä¹‰ç¼©æ”¾æ¯”ä¾‹çš„æœ€å°å€¼ã€‚</li>
<li><code>user-scalable</code>ï¼šå–å€¼ <code>yes</code> æˆ– <code>no</code>ï¼Œå…¶ä¸­ <code>no</code> è¡¨ç¤ºç”¨æˆ·å°†æ— æ³•ç¼©æ”¾å½“å‰é¡µé¢ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾ç½®å‘¢ï¼Ÿ</p>
<blockquote>
<p><strong>åŸæ¥ã€Œè®¾å¤‡åƒç´ æ¯”ã€æ˜¯æŒ‡åœ¨æœªç¼©æ”¾çŠ¶æ€ä¸‹ï¼Œè®¾å¤‡åƒç´ ä¸ CSS åƒç´ çš„åˆå§‹æ¯”ä¾‹å…³ç³»ã€‚</strong></p>
</blockquote>
<p>å½“ç½‘é¡µç¼©æ”¾æ¯”ä¾‹è®¾ä¸º <code>1</code> æ—¶ï¼Œ<code>document.documentElement.clientWidth</code> çš„è¿”å›å€¼ç­‰äºè¯¥è®¾å¤‡æ¨ªå‘ CSS åƒç´ å®½åº¦ã€‚</p>
<h3>åŠ¨æ€è®¾ç½®æ ¹å…ƒç´ å­—ä½“å¤§å°</h3>
<p>æ¥ä¸‹æ¥ï¼Œä»‹ç»å¦‚ä½•åŠ¨æ€åœ°è®¾ç½®æ ¹å…ƒç´  <code>&lt;html&gt;</code> çš„å­—ä½“å¤§å°ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡ JavaScript è·å–å…ƒç´ çš„å®½é«˜ç­‰ï¼Œå¯¹åº”çš„æ˜¯ CSS åƒç´ ï¼Œè€Œä¸æ˜¯è®¾å¤‡åƒç´ ï¼Œæ›´ä¸æ˜¯è®¾å¤‡åˆ†è¾¨ç‡ã€‚æ¯”å¦‚ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-12f80a1efd736a00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>è®¾å¤‡åƒç´ </th>
<th>CSS åƒç´ </th>
<th>è®¾å¤‡åƒç´ æ¯”</th>
</tr>
</thead>
<tbody>
<tr>
<td>iPhone 7</td>
<td>750 Ã— 1334</td>
<td>375 Ã— 667</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>ä»¥ iPhone 7 ä¸ºä¾‹ï¼Œ750px è®¾è®¡ç¨¿ä¸Šçš„ <code>100px</code> å¯¹åº” CSS åƒç´ ä¸º <code>50px</code>ã€‚</p>
<p>å½“æ ¹å…ƒç´ å­—å·è®¾ä¸º <code>50px</code> æ—¶ï¼Œæ­¤æ—¶ <code>1rem = 50 CSS åƒç´  = 100 è®¾å¤‡åƒç´ </code>ã€‚</p>
<p>å…¼å®¹å…¶ä»–è®¾å¤‡å¯ä»¥è¿™æ ·ç®—ï¼š</p>
<pre><code class="language-js">rootFontSize = document.documentElement.clientWidth / 375 * 50
</code></pre>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;script&gt;
  !(function (n, e) {
    var t = n.documentElement
    var i = 'orientationchange' in window ? 'orientationchange' : 'resize'
    var d = function () {
      var n = t.clientWidth
      if (n) {
        var e = 50 * (n / 375)
        e = e &gt; 58 ? 58 : e
        t.style.fontSize = e + 'px'
      }
    }
    if (n.addEventListener) {
      e.addEventListener(i, d)
      n.addEventListener('DOMContentLoaded', d)
    }
  })(document, window)
&lt;/script&gt;
</code></pre>
<h2>å››ã€Taro è½¬æ¢åŸç†</h2>
<p>å‰é¢æåˆ° Taro å¯¹ postcss-pxtorem è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ï¼Œä»¥é€‚é…å¤šç«¯çš„å•ä½è½¬æ¢ã€‚</p>
<p>å…¶é…ç½®é¡¹ä¸ postcss-pxtorem æ˜¯ç›¸ä¼¼ï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äº <code>rootValue</code> ä¸Šã€‚å°½ç®¡åœ¨ <a href="https://github.com/Pines-Cheng/postcss-pxtransform/#rootvalue-number-%E5%BF%85%E5%A1%AB">README</a> æåˆ° <code>rootValue</code> æ˜¯å¿…å¡«çš„ï¼Œä½†å…¶å®æ˜¯æ²¡ç”¨çš„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cea88a66b7b79224.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ ¹æ®æºç  <code>rootValue</code> åœ¨ä¸åŒç«¯ä¼šæœ‰ä¸åŒçš„æ¢ç®—è§„åˆ™ã€‚</p>
<ul>
<li>æºæ–‡ä»¶ <a href="https://github.com/NervJS/taro/blob/be064b6c9c872bcda2410ad77871021d4c2b70eb/packages/postcss-pxtransform/index.js">taro/packages/postcss-pxtransform/index.js</a>ã€‚</li>
<li>æºæ–‡ä»¶ä¸­ <code>rootValue</code> çš„å…³é”®é€»è¾‘åœ¨ <a href="https://github.com/NervJS/taro/blob/be064b6c9c872bcda2410ad77871021d4c2b70eb/packages/postcss-pxtransform/index.js#L50-L71">L50-L71</a>ã€‚</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f0c85d9177502157.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœ Taro çš„ç¼–è¯‘é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const config = {
  designWidth: 750,
  deviceRatio: { 750: 1 }
}
</code></pre>
<p>é‚£ä¹ˆä»æºç ä¸­ï¼Œå¯ä»¥çŸ¥é“è°ƒç”¨ <code>rootValue()</code> æ–¹æ³•ï¼Œå°†ä¼šå¾—åˆ°ä»€ä¹ˆå€¼ã€‚ä»¥ <code>50px</code> ä¸ºä¾‹ï¼š</p>
<p><strong>å°ç¨‹åºç«¯ï¼š</strong></p>
<pre><code class="language-js">options.rootValue = input =&gt; 1 / options.deviceRatio[designWidth(input)]

// æ ¹æ®é…ç½®ï¼Œå¯çŸ¥ designWidth(input) ç»“æœä¸º 750ï¼Œ
// å› æ­¤ options.deviceRatio[designWidth(input)] å³ä¸º 1
// æ‰€ä»¥ï¼Œå°ç¨‹åºç«¯è½¬æ¢ï¼Œä»…æ¶‰åŠå•ä½çš„è½¬æ¢ï¼ˆpx =&gt; rpxï¼‰ï¼Œæ•°å€¼æ˜¯ä¸å˜çš„ï¼Œå³è½¬æ¢ç»“æœä¸º 50rpxã€‚
</code></pre>
<p><strong>H5ç«¯ï¼š</strong></p>
<pre><code class="language-js">options.rootValue = input =&gt; baseFontSize * designWidth(input) / 640

// å…¶ä¸­ baseFontSize æ˜¯æºç ä¸­å†™æ­»çš„ 40
// å…¶ä¸­ designWidth(input) ä¸º 750ï¼Œ
// å› æ­¤è¯¥æ–¹æ³•è¿”å›å€¼å°†ä¼šæ˜¯ 46.875
// æ‰€ä»¥ H5 ç«¯ 50px ä¼šè½¬æ¢ä¸º 1.06666667rem
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å°±æ˜ç™½å…¶è½¬æ¢ç»“æœä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·çš„äº†ã€‚</p>
<pre><code class="language-css">/* ç¼–è¯‘å‰ */
.avatar {
  width: 50px;
}
 
/* ç¼–è¯‘ä¸ºå°ç¨‹åº */
.avatar {
  width: 50rpx;
}
 
/* ç¼–è¯‘ä¸º H5 */
.avatar {
  width: 1.0667rem;
}
</code></pre>
<p>å®Œæ•´çš„è½¬æ¢è¿‡ç¨‹çœ‹ <a href="https://github.com/NervJS/taro/blob/be064b6c9c872bcda2410ad77871021d4c2b70eb/packages/postcss-pxtransform/index.js#L207-L220">createPxReplace</a> éƒ¨åˆ†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f96208c5091f836a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç†è§£è½¬æ¢è§„åˆ™åï¼Œå°±å¾ˆç®€å•äº†ã€‚æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ <code>String.prototype.replace()</code> æ–¹æ³•æ¥æ›¿æ¢å­—ç¬¦ä¸²è€Œå·²ã€‚ä»è¿™é‡Œï¼Œä½ ä¹Ÿç†è§£äº† <code>onePxTransform</code> å’Œ <code>minPixelValue</code> é…ç½®é¡¹çš„ä½œç”¨ã€‚</p>
<p>è‡³äºåŒ¹é… <code>px</code> çš„æ­£åˆ™è¡¨è¾¾å¼å¦‚ä¸‹ï¼ˆ<a href="https://github.com/NervJS/taro/blob/be064b6c9c872bcda2410ad77871021d4c2b70eb/packages/postcss-pxtransform/lib/pixel-unit-regex.js#L11">#L11</a>ï¼‰ï¼š</p>
<pre><code>const pxRegex = /&quot;[^&quot;]+&quot;|'[^']+'|url\([^\)]+\)|(\d*\.?\d+)px/g
</code></pre>
<h2>äº”ã€è½¬æ¢è°ƒæ•´</h2>
<p>Taro é¡¹ç›® <code>index.html</code> æ˜¯è¿™æ ·å¤„ç†çš„ï¼š</p>
<pre><code class="language-html">&lt;script&gt;
  !(function (n) {
    function e() {
      var e = n.document.documentElement,
        t = e.getBoundingClientRect().width;
      e.style.fontSize =
        t &gt;= 640 ? &quot;40px&quot; : t &lt;= 320 ? &quot;20px&quot; : (t / 320) * 20 + &quot;px&quot;;
    }
    n.addEventListener(&quot;resize&quot;, function () {
      e();
    }),
      e();
  })(window);
&lt;/script&gt;
</code></pre>
<p>æŒ‰ä¸Šä¸€èŠ‚çš„è°ƒæ•´ä¸ºï¼š</p>
<pre><code class="language-html">&lt;script&gt;
  !(function (n, e) {
    var t = n.documentElement
    var i = 'orientationchange' in window ? 'orientationchange' : 'resize'
    var d = function () {
      var n = t.clientWidth
      if (n) {
        var e = 50 * (n / 375)
        e = e &gt; 58 ? 58 : e
        t.style.fontSize = e + 'px'
      }
    }
    if (n.addEventListener) {
      e.addEventListener(i, d)
      n.addEventListener('DOMContentLoaded', d)
    }
  })(document, window)
&lt;/script&gt;
</code></pre>
<p>é€šè¿‡æºç ï¼Œæˆ‘ä»¬çŸ¥é“ H5 ä¸­ <code>rootValue</code> çš„è®¡ç®—å¦‚ä¸‹ï¼Œç”±äºæˆ‘ä»¬çš„ <code>designWidth</code> ä¸º <code>750</code>ï¼Œè€Œ <code>baseFontSize</code> åˆ™æ˜¯å†™æ­»çš„ <code>40</code>ã€‚</p>
<pre><code class="language-js">options.rootValue = input =&gt; baseFontSize * designWidth(input) / 640
</code></pre>
<p>è¦ä½¿å¾— <code>rootValue()</code> æ–¹æ³•çš„è¿”å›å€¼ä¸º <code>100</code>ï¼Œéœ€è¦å°† <code>designWidth</code> è®¾ä¸º <code>1600</code>ã€‚ä½†æ˜¯å°ç¨‹åºç«¯ä»è¦è®¾ä¸º <code>750</code>ï¼Œå¯ä»¥é€šè¿‡ <code>process.env.TARO_ENV</code> åˆ¤æ–­å¹³å°ã€‚</p>
<pre><code class="language-js">const config = {
  designWidth: process.env.TARO_ENV === 'h5' ? 1600 : 750,
  deviceRatio: { 750: 1 },
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          platform: 'weapp',
          minPixelValue: 2,
          onePxTransform: false
        }
      }
    }
  },
  h5: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          platform: 'h5',
          minPixelValue: 2,
          onePxTransform: false,
        }
      }
    }
  }
}
</code></pre>
<p>è‡³æ­¤ï¼Œå°±èƒ½å®ç°ç±»ä¼¼ postcss-pxtorem è®¾ç½® <code>rootValue</code> ä¸º <code>100</code> çš„æ•ˆæœï¼Œç¼–è¯‘å‰åå°±å¦‚é¢„æœŸæ‰€æƒ³ï¼š</p>
<pre><code class="language-css">/* ç¼–è¯‘å‰ */
.avatar {
  width: 50px;
}
 
/* ç¼–è¯‘ä¸ºå°ç¨‹åº */
.avatar {
  width: 50rpx;
}
 
/* ç¼–è¯‘ä¸º H5 */
.avatar {
  width: 0.5rem;
}
</code></pre>
<h2>å…­ã€2023.11.30 æ›´æ–°</h2>
<blockquote>
<p>postcss-pxtransform æœ€æ–°ä»“åº“ç§»åˆ°äº†<a href="https://github.com/NervJS/taro/blob/68f9618a5d43856462c9cdc0983f075edf01a15a/packages/postcss-pxtransform/README.md">è¿™é‡Œ</a>ï¼Œ<a href="https://github.com/Pines-Cheng/postcss-pxtransform/">åŸå…ˆ</a>çš„åº”è¯¥å¼ƒç”¨äº†ã€‚</p>
</blockquote>
<p>æœ€è¿‘ä» v3.4.8 å‡çº§è‡³ v3.6.20 åä¼šå¯¼è‡´æŠ¥é”™ä»¥åŠæ ·å¼é”™ä¹±ã€‚</p>
<pre><code class="language-text">Error: deviceRatio é…ç½®ä¸­ä¸å­˜åœ¨ 1600 çš„è®¾ç½®ï¼
</code></pre>
<p>ä» <a href="https://github.com/NervJS/taro/issues/12078">#12078</a> å‘ç°äº†ç»™ taro-h5 çš„ <a href="https://github.com/NervJS/taro/blob/68f9618a5d43856462c9cdc0983f075edf01a15a/packages/taro-h5/src/api/taro.ts#L85-L87"><code>pxTransform()</code></a> æ·»åŠ äº†ä»¥ä¸‹æ£€æµ‹é€»è¾‘ï¼Œåº”è¯¥æ˜¯å„å¹³å°éƒ½åŠ äº†ï¼š</p>
<pre><code class="language-js">if (!(designWidth in config.deviceRatio)) {
  throw new Error(`deviceRatio é…ç½®ä¸­ä¸å­˜åœ¨ ${designWidth} çš„è®¾ç½®ï¼`)
}
</code></pre>
<p>è¿™ä¸ªé—®é¢˜åªè¦åœ¨é…ç½®æ–‡ä»¶åŠ ä¸Šå°±å¥½ <code>1600</code> çš„ <code>deviceRatio</code> å°±èƒ½è§£å†³ï¼š</p>
<pre><code class="language-js">const config = {
  designWidth: process.env.TARO_ENV === 'h5' ? 1600 : 750,
  deviceRatio: {
    750: 1,
    1600: 0.8
  },
}
</code></pre>
<p>ç„¶åè¿˜è§‚å¯Ÿåˆ° <code>baseFontSize</code>ã€<code>rootValue</code> è®¡ç®—çš„è§„åˆ™å‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼ˆ<a href="https://github.com/NervJS/taro/blob/68f9618a5d43856462c9cdc0983f075edf01a15a/packages/postcss-pxtransform/index.js#L42-L98">è¯¦è§</a>ï¼‰ï¼š</p>
<pre><code class="language-js">const transUnits = ['px']
// å˜åŒ– 1ï¸âƒ£
const baseFontSize = options.baseFontSize || (options.minRootSize &gt;= 1 ? options.minRootSize : 20)
const designWidth = (input) =&gt;
  typeof options.designWidth === 'function' ? options.designWidth(input) : options.designWidth

switch (options.platform) {
  case 'h5': {
    targetUnit = options.targetUnit ?? 'rem'

    if (targetUnit === 'vw') {
      options.rootValue = (input) =&gt; {
        return designWidth(input) / 100
      }
    } else if (targetUnit === 'px') {
      options.rootValue = (input) =&gt; (1 / options.deviceRatio[designWidth(input)]) * 2
    } else {
      // rem
      // å˜åŒ– 2ï¸âƒ£
      options.rootValue = (input) =&gt; {
        return (baseFontSize / options.deviceRatio[designWidth(input)]) * 2
      }
    }

    transUnits.push('rpx')
    break
  }
  
  // ...
}
</code></pre>
<p>ä¸ºäº†è·Ÿä¹‹å‰ä¸€æ ·ä½¿å¾— <code>rootValue</code> æ€»ç­‰äº <code>100</code>ï¼Œä¸€æ˜¯ä¸»åŠ¨é…ç½® <code>baseFontSize</code> ä¸º <code>40</code>ï¼Œç„¶åæ¢ç®—è¿‡æ¥ <code>deviceRatio['1600']</code> å°±æ˜¯ <code>0.8</code>ã€‚</p>
<p>æ›´æ–°åçš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const config = {
  designWidth: process.env.TARO_ENV === 'h5' ? 1600 : 750,
  deviceRatio: { 750: 1, 1600: 0.8 },
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          platform: 'weapp',
          minPixelValue: 2,
          onePxTransform: false
        }
      }
    }
  },
  h5: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          baseFontSize: 40,
          platform: 'h5',
          minPixelValue: 2,
          onePxTransform: false,
        }
      }
    }
  }
}
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS ä¸­çš„ä¼ªç±»ã€ä¼ªå…ƒç´ æ€»ç»“]]></title>
            <link>https://github.com/toFrankie/blog/issues/171</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/171</guid>
            <pubDate>Sun, 26 Feb 2023 07:49:30 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f84b737694aace38.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f84b737694aace38.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>æœ¬æ–‡æ‘˜æŠ„è‡ª AlloyTeam å›¢é˜Ÿï¼š<a href="http://www.alloyteam.com/2016/05/summary-of-pseudo-classes-and-pseudo-elements/">æ€»ç»“ä¼ªç±»ä¸ä¼ªå…ƒç´ </a>ã€‚</p>
</blockquote>
<p>è€æ˜¯ä¸è®°å¾—å“ªä¸ªç”¨åŒå†’å·ï¼Œå“ªä¸ªç”¨å•å†’å·ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰è¿™ç§å›°æƒ‘ã€‚å°½ç®¡çŸ¥é“æ˜¯å¯å…¼å®¹çš„ï¼Œä½†è¿˜æ˜¯æƒ³å†æ•´ç†ä¸€ä¸‹ã€‚</p>
<h4>ä¸€ã€æ¦‚å¿µ</h4>
<ul>
<li>
<p><strong>ä¼ªç±»ï¼ˆpseudo-classesï¼‰</strong>
ç”¨äºå½“å·²æœ‰å…ƒç´ å¤„äºçš„æŸä¸ªçŠ¶æ€æ—¶ï¼Œä¸ºå…¶æ·»åŠ å¯¹åº”çš„æ ·å¼ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯æ ¹æ®ç”¨æˆ·è¡Œä¸ºè€ŒåŠ¨æ€å˜åŒ–çš„ã€‚</p>
</li>
<li>
<p><strong>ä¼ªå…ƒç´ ï¼ˆpseudo-elementsï¼‰</strong>
ç”¨äºåˆ›å»ºä¸€äº›ä¸åœ¨æ–‡æ¡£æ ‘ä¸­çš„å…ƒç´ ï¼Œå¹¶ä¸ºå…¶æ·»åŠ æ ·å¼ã€‚</p>
</li>
</ul>
<p>ä¼ªç±»çš„æ“ä½œå¯¹è±¡æ˜¯ã€Œæ–‡æ¡£æ ‘ä¸­å·²æœ‰çš„å…ƒç´ ã€ï¼Œè€Œä¼ªå…ƒç´ åˆ™åˆ›å»ºäº†ä¸€ä¸ªã€Œæ–‡æ¡£æ ‘ä¹‹å¤–çš„å…ƒç´ ã€ã€‚å› æ­¤ï¼Œä¼ªç±»ä¸ä¼ªå…ƒç´ çš„åŒºåˆ«åœ¨äºï¼šæœ‰æ²¡æœ‰åˆ›å»ºä¸€ä¸ªæ–‡æ¡£æ ‘ä¹‹å¤–çš„å…ƒç´ ã€‚</p>
<h4>äºŒã€ä¼ªå…ƒç´ æ˜¯ä½¿ç”¨å•å†’å·è¿˜æ˜¯åŒå†’å·ï¼Ÿ</h4>
<p>æŒ‰ CSS3 è§„èŒƒï¼Œ</p>
<blockquote>
<p>ä¼ªå…ƒç´ ä½¿ç”¨åŒå†’å·ï¼ˆ<code>::</code>ï¼‰è¡¨ç¤ºï¼Œä¼ªç±»ä½¿ç”¨å•å†’å·ï¼ˆ<code>:</code>ï¼‰è¡¨ç¤ºã€‚</p>
</blockquote>
<p>å¦‚æœä¸æŒ‰è§„èŒƒè¡Œäº‹ï¼Œå¹¶éœ€è¦å…¼å®¹ IE8 ä»¥ä¸‹æµè§ˆå™¨ï¼Œ</p>
<blockquote>
<p>æ— è®ºæ˜¯ä¼ªç±»ï¼Œè¿˜æ˜¯ä¼ªå…ƒç´ ï¼Œéƒ½ä½¿ç”¨å•å†’å·ï¼ˆ<code>:</code>ï¼‰è¡¨ç¤ºã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œç»è¿‡å„å¤§æµè§ˆå™¨å‚å•†ä»¬çš„åŠ ç­åŠ ç‚¹ï¼ˆå¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘ï¼‰ï¼Œ</p>
<blockquote>
<p>é™¤äº†å°‘éƒ¨åˆ†ä¼ªå…ƒç´ ï¼ˆæ¯”å¦‚ <code>::backdrop</code>ï¼‰å¿…é¡»ä½¿ç”¨åŒå†’å·ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†ä¼ªå…ƒç´ éƒ½æ”¯æŒå•å†’å·å’ŒåŒå†’å·çš„å†™æ³•ã€‚</p>
</blockquote>
<p>å¯¹äº<a href="https://www.w3.org/community/webed/wiki/Advanced_CSS_selectors#CSS3_pseudo-element_double_colon_syntax">ä¼ªå…ƒç´ æ˜¯ä½¿ç”¨å•å†’å·è¿˜æ˜¯åŒå†’å·çš„é—®é¢˜</a>ï¼ŒW3C æ ‡å‡†ä¸­çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Please note that the new CSS3 way of writing pseudo-elements is to use a double colon, egÂ <code>a::after { ... }</code>, to set them apart from pseudo-classes. You may see this sometimes in CSS. CSS3 however also still allows for single colon pseudo-elements, for the sake of backwards compatibility, and we would advise that you stick with this syntax for the time being.</p>
</blockquote>
<p>ç»¼ä¸Šæ‰€è¿°ï¼š<strong>é™¤äº†å¿…é¡»è¦åŒå†’å·çš„ä¼ªå…ƒç´ ä¹‹å¤–ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œå»ºè®®ä¼ªå…ƒç´ ä¹Ÿä½¿ç”¨å•å†’å·çš„å†™æ³•ã€‚</strong></p>
<h4>ä¸‰ã€å¸¸è§çš„ä¼ªå…ƒç´ ã€ä¼ªç±»</h4>
<p>ä¼ªç±»ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e2155bccbd5ca240.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¼ªå…ƒç´ ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-46ef6fa9783beaa1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…·ä½“ç”¨æ³•<a href="http://www.alloyteam.com/2016/05/summary-of-pseudo-classes-and-pseudo-elements/">åŸæ–‡</a>ï¼ŒçœŸå¿ƒå†™å¾—ä¸é”™~</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS å˜é‡ä½¿ç”¨è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/170</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/170</guid>
            <pubDate>Sun, 26 Feb 2023 07:47:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ec3461bf9c25d6c4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ec3461bf9c25d6c4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿™ç¯‡æ–‡ç« ä½ å°†å­¦åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>CSS å˜é‡</li>
<li>CSS å¸¸ç”¨å‡½æ•°</li>
<li>iPhone X ç³»åˆ—æœºå‹é€‚é…</li>
<li>CSS At-rules å’Œåª’ä½“æŸ¥è¯¢</li>
<li>æ·±è‰²æ¨¡å¼é€‚é…</li>
</ul>
<h2>ä¸€ã€ç®€è¿°</h2>
<p>CSS å˜é‡ï¼ˆCSS Variablesï¼‰ï¼Œä¹Ÿç§°ä½œ CSS è‡ªå®šä¹‰å±æ€§ï¼ˆCSS Custom Propertiesï¼‰ï¼Œå®ƒæ˜¯å¸¦æœ‰å‰ç¼€ <code>--</code> å±æ€§åï¼Œä¸”å¸¦æœ‰å€¼çš„è‡ªå®šä¹‰å±æ€§ã€‚ç„¶åé€šè¿‡ <code>var</code> å‡½æ•°åœ¨å…¨æ–‡èŒƒå›´å¤ç”¨ã€‚</p>
<blockquote>
<p>è‡³äºä¸ºä»€ä¹ˆé‡‡ç”¨ <code>--</code>ï¼Œå¤§æ¦‚æ˜¯å› ä¸º <code>@</code> è¢« <a href="https://lesscss.org/">Less</a> å ç”¨äº†ï¼Œ<code>$</code> è¢« <a href="https://sass-lang.com/">Sass</a> å ç”¨äº†å§ã€‚</p>
</blockquote>
<h4>1.1 è¯­æ³•</h4>
<p>å®šä¹‰ CSS å˜é‡çš„è¯­æ³•éå¸¸ç®€å•ï¼Œåœ¨å˜é‡åç§°ä¹‹å‰æ·»åŠ ä¸¤ä¸ªçŸ­æ¨ªçº¿ <code>--</code>ï¼š</p>
<pre><code class="language-css">--&lt;custom-property-name&gt;: &lt;declaration-value&gt;
</code></pre>
<p>å…¶ä¸­ <code>&lt;custom-property-name&gt;</code> è¡¨ç¤ºå˜é‡åç§°ï¼Œ<code>&lt;declaration-value&gt;</code> è¡¨ç¤ºå˜é‡å€¼ï¼Œå½¢å¦‚ï¼š<code>--*</code>ã€‚è¿™ç±»è‡ªå®šä¹‰ CSS å±æ€§ä¸ <code>color</code>ã€<code>font-size</code>ã€<code>background-image</code> ç­‰å±æ€§å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œåªæ˜¯å®ƒæ²¡æœ‰é»˜è®¤å«ä¹‰ç½¢äº†ï¼Œå®ƒå¿…é¡»é€šè¿‡ <code>var()</code> å‡½æ•°å¤ç”¨ä¹‹åï¼Œæ‰ä¼šäº§ç”Ÿæ„ä¹‰ã€‚</p>
<p>å…¶ä¸­ã€Œå˜é‡åç§°ã€å‘½åçº¦æŸæ˜¯æ¯”è¾ƒå®½æ¾çš„ï¼Œå¯ä»¥æ˜¯æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ <code>_</code>ã€çŸ­æ¨ªçº¿ <code>-</code> çš„ç»„åˆï¼Œä½†ä¸èƒ½åŒ…å« <code>$</code>ã€<code>[</code>ã€<code>^</code>ã€<code>(</code>ã€<code>%</code> ç­‰å­—ç¬¦ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">--some-keyword: left;
--some-color: #f00;
--some-complex-value: 3px 6px rgb(20, 32, 54);
</code></pre>
<p>ç”šè‡³å¯ä»¥æ˜¯ä»¥æ•°å­—å¼€å¤´ã€ä¹Ÿå¯ä»¥æ˜¯ä¸­æ–‡ã€éŸ©æ–‡ç­‰ã€‚</p>
<pre><code class="language-css">:root {
 --çº¢è‰²: #f00; /* æœ‰æ•ˆ */
 --1: 1px; /* æœ‰æ•ˆ */
}

body {
 background-color: var(--çº¢è‰²);
 height: var(--1);
}
</code></pre>
<p>å½“ç„¶ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œåƒä¸‡åˆ«ä»¥è¿™ç§èŠ±é‡Œèƒ¡å“¨ã€å¥‡å¥‡æ€ªæ€ªçš„ç»„åˆæ¥å‘½åå˜é‡åç§°ï¼Œä¸»è¦æ˜¯é¿å…è¢«æ‰“ã€‚å»ºè®®ä½¿ç”¨ <code>kebab-case</code> æ–¹å¼è¿›è¡Œå‘½åï¼Œæ¯”å¦‚ <code>--theme-primary</code> ç­‰ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼ŒCSS å˜é‡åç§°æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œ<code>--foo</code> å’Œ <code>--Foo</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ã€‚è¿™ä¸€ç‚¹ä¸ CSS å±æ€§å¤§å°å†™ä¸æ•æ„Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
</blockquote>
<h4>1.2 ä½œç”¨åŸŸ</h4>
<p>åŒä¸€ä¸ª CSS å˜é‡ï¼Œå¯ä»¥åœ¨å¤šä¸ªé€‰æ‹©å™¨å†…å£°æ˜ï¼Œè¯»å–é¡ºåºä¸ CSS åŒ¹é…è§„åˆ™ä¸€è‡´ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„ç”Ÿæ•ˆã€‚è¯·æ³¨æ„ï¼ŒCSS å˜é‡å¹¶æ²¡æœ‰ <code>!important</code> ç”¨æ³•ï¼Œå˜é‡çš„è¦†ç›–è§„åˆ™ç”± CSS é€‰æ‹©å™¨æƒé‡å†³å®šã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¨å±€æ€§å˜é‡æ”¾åœ¨ <code>:root</code> å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»æ„å…ƒç´ ä¸­å£°æ˜ CSS å˜é‡ï¼Œè§†å®é™…æƒ…å†µè€Œå®šå³å¯ã€‚å¦‚æœæ˜¯å°ç¨‹åºï¼Œåˆ™åœ¨å…¨å±€æ ·å¼ <code>app.wxss</code> çš„ <code>page</code> å†…å£°æ˜ã€‚</p>
<blockquote>
<p><code>:root</code>Â è¿™ä¸ª CSSÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-classes">ä¼ªç±»</a>åŒ¹é…æ–‡æ¡£æ ‘çš„æ ¹å…ƒç´ ã€‚å¯¹äº HTML æ¥è¯´ï¼Œ<strong><code>:root</code></strong>Â è¡¨ç¤ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/html"><code>&lt;html&gt;</code></a>Â å…ƒç´ ï¼Œé™¤äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Specificity">ä¼˜å…ˆçº§</a>æ›´é«˜ä¹‹å¤–ï¼Œä¸Â <code>html</code>Â é€‰æ‹©å™¨ç›¸åŒã€‚</p>
</blockquote>
<pre><code class="language-css">:root {
  --theme-primary: #f00; /* å…¨å±€å¯å¤ç”¨ */
}

header {
  --theme-primary: #0f0; /* ä»… header èŒƒå›´å†…å¯å¤ç”¨ */
}

section {
  --theme-primary: #00f; /* ä»… section èŒƒå›´å†…å¯å¤ç”¨ */
}
</code></pre>
<p>æ¯”å¦‚ <code>&lt;section&gt;</code> å†…ä½¿ç”¨ <code>color: var(--theme-primary)</code>ï¼Œç”Ÿæ•ˆçš„å°†ä¼šæ˜¯ <code>color: #00f</code>ã€‚å†è€…ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåœ¨ <code>&lt;div id=&quot;error&quot;&gt;&lt;/div&gt;</code> ä¸­å¼•ç”¨ <code>--color</code> å˜é‡ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯ ID é€‰æ‹©å™¨çš„å˜é‡å€¼ã€‚</p>
<pre><code class="language-css">:root {
  --color: #f00;
}

div {
  --color: #0f0;
}

#id {
  --color: #00f;
}
</code></pre>
<p>æ€»çš„æ¥è®²ï¼ŒCSS å˜é‡æ˜¯æœ‰ä½œç”¨åŸŸæ¦‚å¿µçš„ï¼Œå®ƒåªèƒ½ä½œç”¨äºè‡ªèº«æˆ–åä»£å…ƒç´ ï¼Œè€Œå…„å¼Ÿå…ƒç´ ã€ç¥–å…ˆå…ƒç´ éƒ½æ˜¯ä¸ç”¨äº«ç”¨çš„ã€‚</p>
<p>å¯ä»¥è¯•ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼š<a href="https://codesandbox.io/s/css-variable-scope-demo-7p5rio">css-variable-scope-demo</a>ã€‚</p>
<h4>1.3 å…¼å®¹æ€§</h4>
<p>å…¼å®¹æ€§å¦‚ä¸‹ï¼Œè¿˜æ˜¯æŒºä¸é”™çš„ï¼ˆå¦‚æœå¿½ç•¥ IE çš„è¯ï¼‰ï¼Œæ›´å¤šè¯·çœ‹ <a href="https://caniuse.com/css-variables">Can I use</a>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bc4e198b24a69ca4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¾ˆæ£’ ğŸ™„ï¼ŒIE å…¨ç³»ä¸æ”¯æŒï¼Œéª‚éª‚å’§å’§åœ°è¯´ï¼šè¿˜æ˜¯ç”¨ SCSS æˆ– LESS å§ã€‚å¯ä»¥å‚è€ƒä¸‹è¿™ä¸ªé¡¹ç›®ï¼š<a href="https://github.com/jhildenbiddle/css-vars-ponyfill">css-vars-ponyfill</a>ã€‚</p>
<p>å¯¹äºä¸æ”¯æŒ CSS å˜é‡çš„æµè§ˆå™¨ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼å…¼å®¹å¤„ç†ï¼š</p>
<pre><code>:root {
  --color-primary: #00f;
}

a {
  color: #00f;
  color: var(--color-primary);
}
</code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@supports</code> è§„åˆ™ï¼Œç„¶è€Œå®ƒä¹Ÿä¸å…¼å®¹ IE æµè§ˆå™¨ã€‚</p>
<pre><code class="language-css">@supports (--foo: 0) {
  /* supported */
}

@supports (not (--foo: 0)) {
  /* unsupported */
}
</code></pre>
<h2>äºŒã€JavaScript æ“ä½œ</h2>
<p>åˆ©ç”¨ <code>CSS.supports()</code> æ–¹æ³•å³å¯åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒ CSS å˜é‡ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const isSupported = window.CSS.supports('--foo', 0)
</code></pre>
<p>ç”±äº CSS å˜é‡å°±æ˜¯è‡ªå®šä¹‰çš„ CSS å±æ€§å˜›ï¼Œå› æ­¤æŒ‰ç…§å¹³å¸¸è®¾ç½® CSS å±æ€§çš„æ–¹å¼å»æ“ä½œå³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const element = document.querySelector('selectors')

// å®šä¹‰ CSS å˜é‡
element.style.setProperty('--color', '#f00')

// è¯»å– CSS å˜é‡
element.style.getPropertyValue('--color', '#f00')

// åˆ é™¤ CSS å˜é‡
element.style.removeProperty('--color')
</code></pre>
<p>å¦å¤–æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç”¨æ³•ï¼ˆæ¥è‡ª <a href="https://drafts.csswg.org/css-variables/#syntax">EXAMPLE 7</a>ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">:root {
  --foo: if(x &gt; 5) this.width = 10;
}
</code></pre>
<p>å°½ç®¡è¿™ä¸ªå±æ€§å€¼æ˜¯ã€Œæ— ç”¨ã€çš„ï¼Œä¸ä¼šä½¿å¾—ä»»æ„ CSS å±æ€§äº§ç”Ÿå®é™…æ•ˆæœï¼Œä½†æ˜¯è¿™ä¸ª CSS å˜é‡å®šä¹‰æ˜¯ã€Œæœ‰æ•ˆã€çš„ã€‚å®ƒå¯ä»¥è¢« JavaScript è¯»å–ï¼Œè‡³äºæœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ã€‚</p>
<h2>äºŒã€CSS å‡½æ•°</h2>
<h4>2.1 var å‡½æ•°</h4>
<p><code>var()</code> å‡½æ•°ç”¨äºè¯»å– CSS å˜é‡ï¼Œå®ƒå¯ä»¥æ›¿ä»£å…ƒç´ ä¸­ã€Œä»»ä½•å±æ€§ã€ä¸­çš„ã€Œå€¼çš„ä»»ä½•éƒ¨åˆ†ã€ï¼Œä¸èƒ½ä½œä¸ºå±æ€§åã€é€‰æ‹©å™¨æˆ–å…¶ä»–å¤„ç†å±æ€§å€¼ä¹‹å¤–çš„å€¼ã€‚</p>
<p>è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">var(&lt;custom-property-name&gt;[, &lt;declaration-value&gt;])
</code></pre>
<ul>
<li><code>&lt;custom-property-name&gt;</code> è¡¨ç¤ºè‡ªå®šä¹‰å±æ€§å</li>
<li><code>&lt;declaration-value&gt;</code>ï¼ˆå¯é€‰ï¼‰è¡¨ç¤ºå£°æ˜å€¼ï¼ˆåå¤‡å€¼ï¼‰ï¼Œ<strong>ä»…è‡ªå®šä¹‰å±æ€§æ²¡æœ‰å®šä¹‰æ—¶ï¼Œå®ƒæ‰ä¼šæœ‰æ•ˆ</strong>ï¼ˆç±»ä¼¼ ES6 ä¸­çš„å‡½æ•°å‚æ•°è®¾å®šé»˜è®¤å€¼ï¼‰ã€‚</li>
</ul>
<p><strong>2.1.1 CSS å˜é‡ä¸åˆæ³•çš„ç¼ºçœç‰¹æ€§</strong></p>
<p>çœ‹çœ‹ä»¥ä¸‹ç¤ºä¾‹ï¼Œå˜é‡ <code>--color</code> çš„å€¼ä¸º <code>20px</code>ï¼Œæ˜¾ç„¶å®ƒä½œä¸º <code>background-color</code> å€¼çš„è¯æ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆ <code>&lt;body&gt;</code> ä¼šæ˜¾ç¤ºä»€ä¹ˆèƒŒæ™¯é¢œè‰²å‘¢ï¼Ÿçº¢è‰²ï¼Ÿç»¿è‰²ï¼Ÿè¿˜æ˜¯...</p>
<pre><code class="language-css">body {
  --color: 20px;
  background-color: #f00;
  background-color: var(--color, #0f0); /* æ­£ç¡®è¯­æ³•ï¼Œä¸ background-color: 20px æœ‰ç€æœ¬è´¨ä¸Šçš„åŒºåˆ« */
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9f4eb1f8d9923384.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å®ƒæœ€ç»ˆç”Ÿæ•ˆçš„å±æ€§å€¼ä¸º <code>transparent</code>ï¼Œå³ <code>background-color</code> çš„é»˜è®¤å€¼ï¼Œå› æ­¤ç›¸å½“äºï¼š</p>
<pre><code class="language-css">body {
  --color: 20px;
  background-color: #f00;
  background-color: transparent;
}
</code></pre>
<p>ğŸ‘† å¯çœ‹ <a href="https://drafts.csswg.org/css-variables/#using-variables">EXAMPLE 13</a>ã€‚</p>
<p>ä½†è¯·æ³¨æ„ï¼Œä»¥ä¸‹ç¤ºä¾‹ç”Ÿæ•ˆçš„æ˜¯ <code>background-color: #f00</code>ï¼Œå°±æ€•æœ‰äººçœ‹åˆ°ä¸Šé¢ç¤ºä¾‹ä¹‹åï¼Œå¯¹åŸæ¥çš„è®¤çŸ¥äº§ç”Ÿæ€€ç–‘ï¼Œç‰¹æ„è¯´æ˜ä¸‹ã€‚</p>
<pre><code class="language-css">body {
  background-color: #f00; /* æœ‰æ•ˆ */
  background-color: 20px; /* è¯­æ³•é”™è¯¯ï¼Œè¿™æ¡è§„åˆ™å£°æ˜è¢«ä¸¢å¼ƒï¼Œå› æ­¤ä¸Šä¸€æ¡è§„åˆ™ç”Ÿæ•ˆ */
}
</code></pre>
<blockquote>
<p>å› æ­¤ï¼Œå½“ CSS å˜é‡å€¼ä¸åˆæ³•æ—¶ï¼Œç”Ÿæ•ˆçš„æ˜¯ CSS å±æ€§çš„â€œé»˜è®¤å€¼â€ã€‚</p>
<p>ä½†æ³¨æ„ï¼ŒCSS å˜é‡å€¼ä¸åˆæ³•å¹¶ä¸èƒ½ä½¿å¾— <code>&lt;declaration-value&gt;</code> å£°æ˜å€¼ç”Ÿæ•ˆï¼Œå®ƒä»…é™äº CSS å˜é‡æ²¡æœ‰å®šä¹‰æ‰ä¼šç”Ÿæ•ˆï¼ˆç±»ä¼¼å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ä»…å®å‚ä¸º <code>undefined</code> æ‰ä¼šç”Ÿæ•ˆï¼Œå³ä¾¿æ˜¯ <code>null</code> ç­‰ falsy å®å‚ä¹Ÿä¸ä¼šä½¿å…¶ç”Ÿæ•ˆä¸€æ ·ï¼‰ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¿™é‡Œé»˜è®¤å€¼è¦æ‰“åŒå¼•å·å‘¢ï¼ŒåŸå› æ˜¯æ ‡å‡† <a href="https://drafts.csswg.org/css-variables/#using-variables">EXAMPLE 13</a> éƒ¨åˆ†æ˜ç¡®è¯´æ˜äº†ï¼š</p>
<blockquote>
<p>If the property was one thatâ€™s inherited by default, such asÂ <a href="https://drafts.csswg.org/css-color-4/#propdef-color">color</a>, it would compute to the inherited value rather than the initial value.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ª CSS å±æ€§æ˜¯å¯ç»§æ‰¿çš„ï¼Œé‚£ä¸ªå½“å®ƒåº”ç”¨äº†ä¸€ä¸ªä¸åˆæ³•çš„ CSS å˜é‡å€¼ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯å…¶ç»§æ‰¿å€¼ï¼Œè€Œä¸æ˜¯é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-html">&lt;style&gt;
  :root {
    --not-a-color: 20px;
  }

  body {
    color: #f00;
  }

  p {
    color: var(--not-a-color);
  }
&lt;/style&gt;
&lt;body&gt;
  &lt;p&gt;å­—ä½“ä¼šæ˜¯ä»€ä¹ˆé¢œè‰²å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/body&gt;
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2792ace894e4b6d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½ çœ‹æœ€ç»ˆ <code>&lt;p&gt;</code> ç”Ÿæ•ˆçš„ <code>color</code> æ˜¯å…¶ä» <code>&lt;body&gt;</code> ä¸­ç»§æ‰¿è¿‡æ¥çš„ <code>#f00</code> çº¢è‰²ï¼Œè€Œä¸æ˜¯ <code>color</code> çš„é»˜è®¤é¢œè‰² <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color#formal_definition">canvastext</a>ã€‚</p>
<p>æ’ä¸ªè¯é¢˜ï¼Œæˆ‘å¾ˆå¥½å¥‡ <code>canvastext</code> é¢œè‰²æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Œä¸€èˆ¬æ¥è¯´å®ƒä¼šæ˜¯é»‘è‰² <code>rgb(0, 0, 0)</code>ï¼Œç„¶åæˆ‘å°è¯•å°†ç³»ç»Ÿè°ƒè‡³æ·±è‰²æ¨¡å¼ï¼Œç„¶è€Œå®ƒå¹¶ä¸ä¼šé»˜è®¤å˜ä¸ºç™½è‰²ï¼Œå“ˆå“ˆã€‚ç„¶åæˆ‘ç¿»æŸ¥äº†ä¸‹æ ‡å‡†ï¼Œå‘ç°å®ƒè·Ÿ <system-color> æœ‰å…³ï¼Œå®ƒä¸€èˆ¬ç”±æµè§ˆå™¨æ¥å®šä¹‰ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œå¯çœ‹ <a href="https://drafts.csswg.org/css-color-4/#css-system-colors">6.2 System Color</a> ç« èŠ‚ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-517c8504fb4797c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å› æ­¤ï¼Œæ¯”è¾ƒä¸¥è°¨çš„è¯´æ³•æ˜¯ï¼šå½“ CSS å˜é‡å€¼ä¸åˆæ³•æ—¶ï¼Œç”Ÿæ•ˆçš„æ˜¯ CSS å±æ€§çš„ç»§æ‰¿å€¼æˆ–åˆå§‹å€¼ã€‚</p>
</blockquote>
<p><strong>2.1.2 var å‡½æ•°çš„å°¾éšç©ºæ ¼</strong></p>
<pre><code class="language-html">&lt;style&gt;
  body {
    --size: 20;
    font-size: var(--size)px;
  }
&lt;/style&gt;
&lt;body&gt;
  &lt;p&gt;å­—å·æ˜¯å¤šå¤§å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/body&gt;
</code></pre>
<p>çŒœä¸€ä¸‹ <code>font-size</code> ä¼šæ˜¯é¢„æœŸçš„ <code>20px</code> å—ï¼Ÿå®ƒä¸æ˜¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b44033e8423f2558.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¯·æ³¨æ„ï¼Œæµè§ˆå™¨æœ€ç»ˆè§£æå‡ºæ¥çš„è§„åˆ™æ˜¯ï¼š<code>font-size: var(--size) px;</code>ï¼Œå®ƒåœ¨ <code>var(--size)</code> å’Œ <code>px</code> ä¹‹é—´å¤šäº†ä¸€ä¸ªã€Œç©ºæ ¼ã€ï¼Œå› æ­¤è¿™æ¡è§„åˆ™æ˜¯æ— æ•ˆçš„ï¼ˆæ³¨æ„å¹¶ä¸æ˜¯å¼•ç”¨ CSS å˜é‡æ— æ•ˆï¼‰ï¼Œæ‰€ä»¥å­—å·æ˜¯æµè§ˆå™¨é»˜è®¤å­—ä½“å¤§å° <code>16px</code>ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨è¯¸å¦‚ VS Code ç­‰ç¼–è¾‘å™¨ï¼Œå®ƒä¸€èˆ¬ä¼šæœ‰ <code>semi-colon expected</code> é”™è¯¯æé†’çš„ï¼Œå¦‚æœä¿å­˜è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œå®ƒå°†ä¼šè¢«ä¿å­˜ä¸ºï¼š<code>font-size: var(--size) px;</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8b6f5de892b940e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™ç§æƒ…å†µå¯ç»“åˆ <code>calc()</code> å‡½æ•°å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-css">body {
  --size: 20;
  font-size: calc(var(--size) * 1px); /* è¿™æ ·å°±èƒ½æ­£å¸¸è®¡ç®—å¾—å‡º 20px äº† */
}
</code></pre>
<p>ä½†ä¸ªäººæ›´æ¨èè¿™æ ·ç”¨ï¼šå¯¹äºä¸€äº›é•¿åº¦ã€å¤§å°ç­‰ CSS å±æ€§å€¼ï¼Œåœ¨å®šä¹‰ CSS å˜é‡æ—¶ï¼Œåº”å¸¦ä¸Šå•ä½ï¼š</p>
<pre><code class="language-css">body {
  --size: 20px;
  font-size: var(--size);
}
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœå˜é‡å€¼åŒ…å«å•ä½ï¼Œå°±ä¸èƒ½å†™æˆå­—ç¬¦ä¸²å½¢å¼ã€‚</p>
</blockquote>
<pre><code class="language-css">body {
  --size: '20px';
  font-size: var(--size); /* æ³¨æ„ï¼ŒCSS å˜é‡å¼•ç”¨çš„è¯­æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ç» CSS è§£æå™¨è®¡ç®—ä¹‹åï¼Œå…¶å€¼å¹¶ä¸ç¬¦åˆ font-size å±æ€§å€¼çš„è¦æ±‚ï¼Œå› æ­¤è¢«åˆ¤å®šä¸ºè¯­æ³•é”™è¯¯ï¼Œè§„åˆ™ä¼šè¢«ä¸¢å¼ƒã€‚ */
}
</code></pre>
<p>ç›¸å½“äº <code>font-size: '20px';</code> è¯­æ³•é”™è¯¯ï¼Œè§„åˆ™ä¼šè¢«ä¸¢å¼ƒï¼Œå› æ­¤å–å…¶ç»§æ‰¿å€¼æˆ–é»˜è®¤å€¼ã€‚</p>
<p><strong>2.1.3 CSS å˜é‡çš„ç›¸äº’ä¼ é€’æ€§</strong></p>
<p>æˆ‘ä»¬åœ¨æŸä¸ªé€‰æ‹©å™¨ä¸­å®šä¹‰äº†ä¸€ä¸ª CSS å˜é‡ï¼Œå®ƒé™¤äº†åœ¨å­å…ƒç´ ä¸­è¢«å¤ç”¨ï¼Œå®ƒæœ¬èº«ä½œç”¨åŸŸå†…ä¹Ÿå¯ä»¥å¤ç”¨ï¼Œè€Œä¸”ä¸ç¼–å†™é¡ºåºæ— å…³ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">body {
  --size: 20px;
  font-size: var(--size);
}
</code></pre>
<pre><code>body {
  font-size: var(--size);
  --size: 20px;
}
</code></pre>
<p>ä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹ï¼Œå‡æ˜¯æœ‰æ•ˆçš„ã€‚åè€…å¹¶ä¸ä¼šå› ä¸º <code>--size: 20px;</code> å®šä¹‰åœ¨åï¼Œå°±ä¸ä¼šç”Ÿæ•ˆã€‚è¿™æ ·è§„åˆ™ï¼Œå¯¹äºæˆ‘ä»¬é€šè¿‡ JavaScript åŠ¨æ€è®¾ç½® CSS å˜é‡æœ‰ç€éå¸¸é‡è¦çš„æ„ä¹‰ã€‚</p>
<h4>2.2 calc å‡½æ•°</h4>
<p><code>calc()</code> è¯­æ³•éå¸¸åœ°ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>property: calc(expression)
</code></pre>
<p>è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå®ƒçš„å‚æ•°ï¼Œè¡¨è¾¾å¼çš„è¿”å›å€¼ä½œä¸º <code>calc()</code> å‡½æ•°çš„å€¼ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯ <code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code> çš„ç»„åˆï¼Œè€Œä¸”å¯ä»¥æ··ç”¨ä¸åŒå•ä½è¿›è¡Œè¿ç®—ã€‚</p>
<p>å®ƒåŒæ ·æ”¯æŒ CSS å˜é‡ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-css">.foo {
  --height: 30px;
  width: calc(100% - 30px);
  height: calc(100vh - var(--height))
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>å¯¹äº <code>+</code> å’Œ <code>-</code> è¿ç®—ï¼Œè¿ç®—ç¬¦ä¸¤è¾¹å¿…é¡»è¦æœ‰ã€Œç©ºæ ¼ã€ï¼Œè€Œ <code>*</code> å’Œ <code>/</code> è¿ç®—åˆ™æ²¡æœ‰è¦æ±‚ï¼Œå› æ­¤å»ºè®®éƒ½åŠ ä¸Šç©ºç™½ç¬¦ã€‚</li>
<li>å¯¹äº <code>*</code> è¿ç®—ï¼Œå‚ä¸è¿ç®—çš„è‡³å°‘æœ‰ä¸€ä¸ªæ•°å€¼ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/number"><number></a>ï¼‰ï¼Œä¸”ä¸èƒ½ä¸º <code>0</code>ã€‚</li>
<li>å¯¹äº <code>/</code> è¿ç®—ï¼Œè¿ç®—ç¬¦ <code>/</code> å³ä¾§å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å€¼ï¼ˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/number"><number></a>ï¼‰ã€‚</li>
<li><code>calc()</code> å‡½æ•°æ”¯æŒåµŒå¥—å†™æ³•ï¼Œä½†å…¶å®è¢«åµŒå¥—çš„ <code>calc()</code> å‡½æ•°åªä¼šè¢«å½“åšæ™®é€šçš„æ‹¬å·ï¼Œå› æ­¤å‡½æ•°å†…ç›´æ¥ä½¿ç”¨æ‹¬å·å°±å¥½äº†ã€‚</li>
</ul>
<p>é‚£ä¹ˆåµŒå¥—è¯­æ³•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-css">.foo {
  --widthA: 100px;
  --widthB: calc(var(--widthA) / 2);
  --widthC: calc(var(--widthB) / 2);
  width: var(--widthC);
}
</code></pre>
<p>é‚£ä¹ˆï¼Œä»¥ä¸Š <code>--widthC</code> çš„å€¼å°±ä¼šå˜æˆ <code>calc(calc(100px / 2) / 2)</code>ï¼Œå³ <code>25px</code>ã€‚</p>
<p>Web å‰ç«¯æ€»æ˜¯ç»•ä¸å¼€å…¼å®¹æ€§ï¼Œé‚£ä¹ˆçœ‹ä¸‹ <code>calc()</code> å‡½æ•°çš„å…¼å®¹æ€§å¦‚ä½•ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f64dd288d7edc1b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç»¿æ‚ æ‚ çš„ä¸€ç‰‡ï¼Œç”šå¥½ï¼å¯ä»¥çœ‹åˆ° IE9 ä»¥ä¸Šéƒ½æ”¯æŒï¼Œå¯ IE æµè§ˆå™¨ä¸æ”¯æŒåµŒå¥—å†™æ³•ï¼Œç”±äº IE æµè§ˆå™¨éƒ½ä¸æ”¯æŒ CSS å˜é‡ï¼Œå› æ­¤è¿™ä¸ªæ— ä¼¤å¤§é›…ã€‚</p>
<h4>2.3 env å’Œ constant å‡½æ•°</h4>
<!--

å¾€ä¸‹ä¹‹å‰ï¼Œäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼ˆ[æ›´å¤šè¯·çœ‹](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Viewport_concepts)ï¼‰ï¼š

> * è§†å£ï¼ˆViewportï¼‰ï¼šåœ¨ Web æµè§ˆå™¨ä¸­ï¼Œé€šå¸¸ä¸æµè§ˆå™¨çª—å£ç›¸åŒï¼Œä½†ä¸åŒ…æ‹¬æµè§ˆå™¨åº”ç”¨æœ¬èº«çš„ UIã€åœ°å€æ ã€ä¹¦ç­¾æ ç­‰ï¼Œå³æŒ‡ä½ æ­£åœ¨æµè§ˆçš„æ–‡æ¡£çš„é‚£ä¸€éƒ¨åˆ†ã€‚
> * å¯è§†è§†å£ï¼ˆVisual Viewportï¼‰ï¼šè¡¨ç¤ºè§†å£å½“å‰å¯è§çš„éƒ¨åˆ†ã€‚
> * å¸ƒå±€è§†å£ (layout viewport) 
> * å¯è§†è§†å£å¯èƒ½ä¼šæ¯”å¸ƒå±€è§†å£ï¼ˆlayout viewport ï¼‰æ›´å°ï¼Œå› ä¸ºå½“ç”¨æˆ·ç¼©å°æµè§ˆå™¨ç¼©æ”¾æ¯”ä¾‹æ—¶ï¼Œå¸ƒå±€è§†å£ä¸å˜ï¼Œè€Œå¯è§†è§†å£å˜å°äº†ã€‚

-->
<p>2017 å¹´ Apple å…¬å¸å‘å¸ƒäº† iPhone X å’Œ iOS 11ï¼Œå¼€å¯äº†ã€Œåˆ˜æµ·å±ã€å’Œåº•éƒ¨å°æ¨ªæ¡ä¹‹è·¯ã€‚</p>
<p>äºæ˜¯å°±æœ‰äº†ã€Œå®‰å…¨åŒº Safe Areaã€ä¹‹è¯´ï¼ˆ<a href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/#Layout%20Guides%20and%20Safe%20Area">è¯¦è§</a>ï¼‰ï¼š</p>
<blockquote>
<p>A safe area defines the area within a view that isnâ€™t covered by a navigation bar, tab bar, toolbar, or other views a view controller might provide.</p>
</blockquote>
<p>ç®€å•æ¥è®²ï¼Œä»¥ iPhone X ä¸ºä¾‹ï¼Œå…¶å®‰å…¨åŒºæ˜¯æŒ‡ä¸å—åˆ˜æµ·ï¼ˆSensor Housingï¼‰ã€åº•éƒ¨å°æ¨ªæ¡ï¼ˆHome Indicatorï¼‰ã€è®¾å¤‡åœ†è§’ï¼ˆCornersï¼‰å½±å“çš„åŒºåŸŸï¼Œå¦‚ä¸‹å›¾çš„æµ…è“è‰²åŒºåŸŸæ‰€ç¤ºï¼Œå…¶ä¸­ç²‰è‰²éƒ¨åˆ†æ˜¯æŒ‡æµè§ˆå™¨é»˜è®¤çš„ Margin å€¼ï¼Œé€šå¸¸ä¸ºäº†æŠ¹å¹³å„æµè§ˆå™¨ä¸åŒçš„å¤–è¾¹è·ï¼Œéƒ½ä¼šè®¾ç½® <code>* { margin: 0 }</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d59d12b5798c6372.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒViewport æ˜¯è§„åˆ™çš„çŸ©å½¢ï¼Œå¦‚æœæ˜¾ç¤ºè®¾å¤‡çš„å±å¹•æ˜¯ä¸è§„åˆ™ï¼ˆæ¯”å¦‚åœ†å½¢ï¼‰çš„è¯ï¼Œé¡µé¢ä¸­çš„æŸäº›éƒ¨åˆ†å°±ä¼šè¢«è£å‰ªã€‚é‚£ä¹ˆ <code>viewport-fit</code> å¯ä»¥é€šè¿‡è®¾ç½®å¯è§† Viewport å¤§å°æ¥æ§åˆ¶è£å‰ªåŒºåŸŸã€‚</p>
<p>å…¶ä¸­ <code>viewport-fit</code> æä¾›äº† <code>auto</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>contain</code>ã€<code>cover</code> ä¸‰ç§å±æ€§å€¼ï¼ˆ<a href="https://www.w3.org/TR/css-round-display-1/#extending-viewport-rule">è¯¦è§</a>ï¼‰ï¼š</p>
<pre><code class="language-html">&lt;meta name=&quot;viewport&quot; content=&quot;viewport-fit=auto|contain|cover&quot; /&gt;
</code></pre>
<table>
<thead>
<tr>
<th>å±æ€§å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auto</code></td>
<td>é»˜è®¤å€¼ï¼Œè¡¨ç°ä¸ <code>contain</code> ä¸€è‡´ï¼ŒViewport ä¼šæ˜¾ç¤ºåœ¨ã€Œå®‰å…¨åŒºã€ä¹‹å†…ï¼Œç›¸å½“äº <code>viewport-fit: contain</code>ã€‚</td>
</tr>
<tr>
<td><code>contain</code></td>
<td>å°†å¯è§† Viewport è®¾ç½®ä¸ºé¡µé¢æ‰€æœ‰å†…å®¹å‡å¯è§çš„æœ€å¤§çŸ©å½¢ã€‚</td>
</tr>
<tr>
<td><code>cover</code></td>
<td>å°†å¯è§† Viewport å¤§å°è®¾ç½®ä¸ºæ˜¾ç¤ºè®¾å¤‡å±å¹•çš„å¤–æ¥çŸ©å½¢ã€‚</td>
</tr>
</tbody>
</table>
<p>ä»¥åœ†å½¢å±å¹•ä¸ºä¾‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-40f1dd5f01108829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Apple å…¬å¸ä¸ºäº†é€‚é…æ——ä¸‹çš„å…¨é¢å±è®¾å¤‡ï¼Œï¼ˆiOS 11 èµ·ï¼‰WebKit å†…æ ¸çš„æµè§ˆå™¨ä¸­å®šä¹‰äº† <code>safe-area-inset-*</code> å››ä¸ªç¯å¢ƒå˜é‡ã€‚</p>
<ul>
<li><code>safe-area-inset-top</code></li>
<li><code>safe-area-inset-right</code></li>
<li><code>safe-area-inset-bottom</code></li>
<li><code>safe-area-inset-left</code></li>
</ul>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç«–å±å’Œæ¨ªå±çŠ¶æ€ä¸‹ï¼Œ<code>safe-area-inset-*</code> å€¼æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ï¼Œç«–å±çŠ¶æ€ä¸‹ç¯å¢ƒå˜é‡ <code>safe-area-inset-left</code> å’Œ <code>safe-area-inset-right</code> çš„å€¼ä¸º <code>0</code>ï¼Œæ¨ªå±çŠ¶æ€ä¸‹ç¯å¢ƒå˜é‡ <code>safe-area-inset-top</code> çš„å€¼ä¸º <code>0</code>ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-217dc9c3b5c7eac7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸Šå›¾æºè‡ª <a href="https://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/">Deng's Blog</a>ã€‚</p>
<p>é€šè¿‡ <code>env()</code> æˆ– <code>constant()</code> å‡½æ•°å°±èƒ½å¼•ç”¨ä»¥ä¸Šå‡ ä¸ªç¯å¢ƒå˜é‡ï¼Œå¯¹äºä¸æ”¯æŒ <code>env()</code> æˆ– <code>constant()</code> çš„æµè§ˆå™¨ï¼ŒåŒ…å«å®ƒçš„æ ·å¼è§„åˆ™å°†è¢«å¿½ç•¥ã€‚</p>
<blockquote>
<p>è‡ª Safari Technology Preview 41 å’Œ iOS 11.2 beta èµ·ï¼Œ<code>constant()</code> å‡½æ•°å·²è¢«ç§»é™¤ï¼Œå¹¶ç”¨ <code>env()</code> å‡½æ•°æ›¿æ¢ï¼ˆ<a href="https://webkit.org/blog/7929/designing-websites-for-iphone-x/">è¯¦è§</a>ï¼‰ã€‚å¯ä¸ºäº†å…¼å®¹æ€§ï¼Œä¸€èˆ¬ä¸¤ä¸ªéƒ½ä¼šå†™ã€‚</p>
</blockquote>
<blockquote>
<p>å¦å¤–ï¼Œè‹¥è¦ç¯å¢ƒå˜é‡ <code>safe-area-inset-*</code> ç”Ÿæ•ˆï¼Œéœ€å°†é¡µé¢è®¾ç½®ä¸º <code>viewport-fit: cover</code>ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œä¼šä»‹ç»å¦‚ä½•é€‚é… iPhone X ç³»åˆ—åˆ˜æµ·å±æ‰‹æœºï¼Œæœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, user-scalable=no&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
      * {
        margin: 0;
        padding: 0;
      }

      body {
        width: 100%;
        background-color: darkorange;
      }

      .container {
        height: 100%;
        min-height: 200vh;
        background-color: forestgreen;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å½“æˆ‘ä»¬ä¸åšä»»ä½•å¤„ç†ï¼Œä»¥ä¸Šç¤ºä¾‹åœ¨ iPhone X ç³»åˆ—æ‰‹æœºæ¨ªå±çŠ¶æ€ä¸‹ï¼Œå·¦å³è¾¹æ¡†ä¼šç©ºå‡ºä¸€éƒ¨åˆ†ï¼Œç©¶å…¶åŸå› å°±æ˜¯ Safari æµè§ˆå™¨ä¼šå°†ç½‘é¡µå†…å®¹ç½®äºã€Œå®‰å…¨åŒºä¹‹å†…ã€ï¼Œç›¸å½“äº <code>viewport-fit: contain</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-91a5299ed7acf9a9.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“æˆ‘ä»¬å°† <code>&lt;meta&gt;</code> æ ‡ç­¾å†…çš„ <code>viewport-fit</code> æ”¹ä¸º <code>cover</code> ä¹‹åï¼Œå¹¶åœ¨é¡µé¢ä¸­æ·»åŠ ä¸€é¦–è¯—ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e7f2a8f3cadec8a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™æ ·ï¼ŒViewport å°±å æ»¡äº†æ˜¾ç¤ºè®¾å¤‡æœ€å¤§çš„çŸ©å½¢ï¼Œä½†å› ä¸ºè®¾å¤‡çš„åˆ˜æµ·ã€åœ†è§’ç­‰å› ç´ ï¼Œä¼šå¯¼è‡´é¡µé¢ä¸­çš„éƒ¨åˆ†å†…å®¹æ— æ³•å®Œå…¨æ˜¾ç¤ºã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬è¯•ç€åœ¨ <code>container</code> å†…æ·»åŠ å·¦å³å¤–è¾¹è·ï¼Œå…¶å€¼åˆ†åˆ«å– <code>safe-area-inset-left</code>ã€<code>safe-area-inset-right</code> ç¯å¢ƒå˜é‡ã€‚</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
      * {
        margin: 0;
        padding: 0;
      }

      body {
        width: 100%;
        background-color: darkorange;
      }

      .container {
        height: 100%;
        min-height: 200vh;
        background-color: forestgreen;

        /* æ–°å¢ */
        margin-left: env(safe-area-inset-left);
        margin-right: env(safe-area-inset-left);
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;article&gt;
        &lt;h1&gt;è’¹è‘­&lt;/h1&gt;
        &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚&lt;/p&gt;
        &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚&lt;/p&gt;
        &lt;p&gt;è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚&lt;/p&gt;
        &lt;p&gt;&lt;/p&gt;
      &lt;/article&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>æ¨ªå±ã€ç«–å±æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5c60fdf041d3b477.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è€ƒè™‘ <code>env()</code> å’Œ <code>constant()</code> å‡½æ•°å…¼å®¹æ€§çš„å†™æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">@supports (bottom: constant(safe-area-inset-bottom)) or (bottom: env(safe-area-inset-bottom)) {
  .container {
    /* è¯·æ³¨æ„ï¼Œconstant å’Œ env å…ˆåé¡ºåºå¦‚ä¸‹ */
    margin-left: constant(safe-area-inset-left); /* å…¼å®¹ iOS &lt; 11.2 */
    margin-left: env(safe-area-inset-left); /* å…¼å®¹ iOS &gt;= 11.2 */

    margin-right: constant(safe-area-inset-right);
    margin-right: env(safe-area-inset-right);
  }
}
</code></pre>
<h4>2.4 max å’Œ min å‡½æ•°</h4>
<p>ä»æ–‡ç« æ’ç‰ˆæ¥çœ‹ï¼Œè¿™æ˜¯æä¸ç¾è§‚çš„ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å·¦å³ä¸¤è¾¹å†åŠ ç‚¹å†…è¾¹è·ã€‚PSï¼šä¸Šè¿°å›¾ç‰‡ä¸ºäº†æ›´æ–¹ä¾¿å¯¹æ¯”ï¼Œé‡‡ç”¨äº†å¤–è¾¹è·ï¼ˆMarginï¼‰ï¼Œæ¥ä¸‹æ¥ä¼šå°†å…¶ä¿®æ”¹ä¸ºå†…è¾¹è·ï¼ˆPaddingï¼‰ã€‚</p>
<pre><code class="language-css">.container {
  /* è¿™é‡Œå°†åŸå…ˆçš„ margin ä¿®æ”¹ä¸º padding */
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-left);
}
</code></pre>
<blockquote>
<p>ä½†æœ‰ä¸ªå°å°çš„éœ€æ±‚ï¼Œæˆ‘ä»¬åªå¸Œæœ›ç«–å±çŠ¶æ€ä¸‹ï¼Œæ·»åŠ  <code>10px</code> çš„å·¦å³å†…è¾¹è·ï¼Œè€Œæ¨ªå±çŠ¶æ€ä¸‹å– <code>safe-area-inset-*</code> çš„å€¼å°±å¥½ã€‚</p>
</blockquote>
<p>å®ƒä»¬æä¾›äº†ä¸¤ä¸ª CSS å‡½æ•°ï¼š<code>min()</code> å’Œ <code>max()</code>ï¼Œåˆ©ç”¨å®ƒä»¬å°±èƒ½å®ç°è¿™éœ€æ±‚ã€‚</p>
<pre><code class="language-css">.container {
  /* è¿™é‡Œä½¿ç”¨åˆ° max() å‡½æ•°ï¼Œè¡¨ç¤ºå–äºŒè€…æœ€å¤§å€¼ã€‚ */
  padding-left: max(10px, env(safe-area-inset-left));
  padding-right: max(10px, env(safe-area-inset-left));
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9f4a3eacd37279d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœè€ƒè™‘å…¼å®¹æ€§çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>@supports</code> è¯­æ³•æ¥å¤„ç†ï¼š</p>
<pre><code class="language-css">@supports (padding: max(0px)) {
  .container {
    padding-left: max(10px, env(safe-area-inset-left));
    padding-right: max(10px, env(safe-area-inset-left));
  }
}
</code></pre>
<p>å¯¹äº <code>max()</code> å’Œ <code>min()</code> çš„è¯­æ³•å’Œä½¿ç”¨éå¸¸åœ°ç®€å•ï¼Œåˆ†åˆ«è¡¨ç¤ºå–æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</p>
<p>ä¸¤è€…è¯­æ³•æ˜¯ä¸€è‡´çš„ï¼Œä»¥ <code>max</code> ä¸ºä¾‹ï¼š</p>
<pre><code class="language-css">property: max(expression [, expression])
</code></pre>
<p>å®ƒæ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œè‹¥æœ‰å¤šä¸ªå€¼åˆ™é‡‡ç”¨é€—å· <code>,</code> åˆ†éš”ï¼Œé€‰æ‹©æœ€å¤§çš„å€¼ä½œä¸º CSS å±æ€§çš„å€¼ã€‚æ¯ä¸ªå€¼é™¤äº†å¯ä»¥æ˜¯ç›´æ¥æ•°å€¼ï¼Œè¿˜å¯ä»¥æ˜¯æ•°å­¦è¿ç®—ï¼ˆå¦‚ <code>calc()</code>ï¼‰ã€å…¶ä»–è¡¨è¾¾å¼ï¼ˆå¦‚ <code>attr()</code>ï¼‰ã€‚</p>
<p>è¿˜æ”¯æŒåµŒå¥— <code>max()</code> å’Œ <code>min()</code> å‡½æ•°ï¼Œéœ€è¦æ—¶å¯ä»¥ä½¿ç”¨å°æ‹¬å· <code>()</code> æ¥è®¾å®šè¿ç®—é¡ºåºã€‚</p>
<p>å…¼å®¹æ€§å¦‚ä¸‹ï¼Œä¸€å¦‚æ—¢å¾€ IE å…¨ç³»ä¸æ”¯æŒï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-07a568a13c56b1e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>è‡³æ­¤ï¼Œç›¸ä¿¡ä½ å¯¹ iPhone X ç­‰æœºå‹çš„é€‚é…æœ‰æ›´æ·±åˆ»çš„äº†è§£ï¼Œé€‚é…èµ·æ¥å°±å®Œå…¨æ²¡æœ‰å‹åŠ›äº†ã€‚</p>
</blockquote>
<h2>ä¸‰ã€CSS At-rules</h2>
<p>ä¸€ä¸ª at-rule æ˜¯ä¸€ä¸ª CSS è¯­å¥ï¼Œå®ƒä»¥ <code>@</code> ç¬¦å·å¼€å¤´ï¼Œåæ¥ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶åŒ…æ‹¬ç›´åˆ°ä¸‹ä¸€ä¸ªåˆ†å· <code>;</code> çš„æ‰€æœ‰å†…å®¹æˆ–ä¸‹ä¸€ä¸ª CSS å—ï¼Œä»¥å…ˆåˆ°è€…ä¸ºå‡†ã€‚</p>
<p>ä¸»è¦å¯åˆ†ä¸ºä¸å¯åµŒå¥—ã€å¯åµŒå¥—ä¸¤ç±»ï¼š</p>
<p><strong>ä¸å¯åµŒå¥— at-ruleï¼š</strong></p>
<ul>
<li><code>@charset</code>ï¼šæŒ‡å®šæ ·å¼è¡¨ä¸­ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ã€‚</li>
<li><code>@import</code>ï¼šå¯¼å…¥å…¶ä»–å¤–éƒ¨æ ·å¼è¡¨ã€‚</li>
<li><code>@namespace</code>ï¼šæŒ‡ç¤º  CSS å¼•æ“å¿…é¡»è€ƒè™‘XMLå‘½åç©ºé—´ã€‚</li>
</ul>
<p><strong>å¯åµŒå¥— at-ruleï¼š</strong></p>
<ul>
<li><code>@media</code>ï¼šç”¨äºåŸºäºä¸€ä¸ªæˆ–å¤šä¸ªåª’ä½“æŸ¥è¯¢çš„ç»“æœæ¥åº”ç”¨æ ·å¼è¡¨ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li><code>@font-face</code>ï¼šæŒ‡å®šä¸€ä¸ªç”¨äºæ˜¾ç¤ºæ–‡æœ¬çš„è‡ªå®šä¹‰å­—ä½“ã€‚</li>
<li><code>@keyframs</code>ï¼šé€šè¿‡åœ¨åŠ¨ç”»åºåˆ—ä¸­å®šä¹‰å…³é”®å¸§çš„æ ·å¼æ¥æ§åˆ¶ CSS åŠ¨ç”»åºåˆ—ä¸­çš„ä¸­é—´æ­¥éª¤ã€‚</li>
<li><code>@supports</code>ï¼šæŒ‡å®šä¾èµ–äºæµè§ˆå™¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„ CSS åŠŸèƒ½çš„æ”¯æŒå£°æ˜ã€‚</li>
<li><code>@document</code>ï¼šæ ¹æ®æ–‡æ¡£çš„ URL é™åˆ¶å…¶ä¸­åŒ…å«çš„æ ·å¼è§„åˆ™çš„ä½œç”¨èŒƒå›´ï¼ˆå®éªŒç‰¹æ€§ï¼‰ã€‚</li>
<li><code>@page</code>ï¼šç”¨äºåœ¨æ‰“å°æ–‡æ¡£æ—¶ä¿®æ”¹æŸäº› CSS å±æ€§ã€‚</li>
</ul>
<p>æ¯ä¸ª at-rule è§„åˆ™éƒ½æœ‰ä¸åŒçš„è¯­æ³•ï¼Œæœ‰ä¸€éƒ¨åˆ† at-rule å¯ä»¥å½’ä¸ºä¸€ç±»ï¼š<strong>æ¡ä»¶è§„åˆ™ç»„</strong>ã€‚</p>
<blockquote>
<p>è¿™äº›è§„åˆ™ç»„æ‰€æŒ‡çš„æ¡ä»¶æ€»ç­‰æ•ˆäº <code>true</code> æˆ– <code>false</code>ï¼Œå¦‚æœä¸º <code>true</code> é‚£ä¹ˆå®ƒé‡Œé¢çš„ CSS è¯­å¥ç”Ÿæ•ˆã€‚</p>
</blockquote>
<p>æœ¬æ–‡ä»…ä»‹ç» <code>@supports</code> å’Œ <code>@media</code>ï¼Œå…¶ä»–è§„åˆ™è¯·çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/At-rule">CSS At-rules</a>ã€‚</p>
<h4>3.1 @supports</h4>
<p><code>@supports</code> å¸¸ç”¨äº CSS å…¼å®¹æ€§åˆ¤æ–­ã€‚</p>
<p>å®ƒç”±ä¸€ç»„æ”¯æŒæ¡ä»¶å’Œä¸€ç»„æ ·å¼å£°æ˜ç»„æˆã€‚æ”¯æŒæ¡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä½¿ç”¨é€»è¾‘ä¸ <code>and</code>ã€é€»è¾‘æˆ– <code>or</code>ã€é€»è¾‘é <code>not</code> ç»„åˆè€Œæˆã€‚</p>
<ul>
<li>å•ä¸€æ¡ä»¶ï¼šç”±ä¸€ä¸ª CSS å±æ€§å’Œå±æ€§å€¼ç»„æˆï¼Œä¸­é—´ç”¨åˆ†å· <code>;</code> éš”å¼€ã€‚</li>
</ul>
<pre><code class="language-css">@supports (transform-origin: 5% 5%) {
  /* æ ·å¼å£°æ˜ */
}
</code></pre>
<p>å½“ <code>transform-origin</code> çš„å®ç°è¯­æ³•è®¤ä¸º <code>5% 5%</code> æ˜¯æœ‰æ•ˆçš„å€¼ï¼Œè¡¨è¾¾å¼ä¼šè¿”å› <code>true</code>ï¼Œæ­¤æ—¶è§„åˆ™å†…å£°æ˜çš„æ ·å¼å°±ä¼šç”Ÿæ•ˆã€‚</p>
<ul>
<li>å¤šä¸ªæ¡ä»¶ï¼šä½¿ç”¨ <code>not</code>ã€<code>and</code>ã€<code>or</code> æ“ä½œç¬¦ç»„åˆã€‚</li>
</ul>
<blockquote>
<p>ç›¸å½“äº JavaScript ä¸­çš„ <code>!</code>ã€<code>&amp;&amp;</code>ã€<code>||</code> æ“ä½œç¬¦å•¦ï¼Œéœ€è®¾å®šè¿ç®—é¡ºåºï¼Œåˆ™ä½¿ç”¨æ‹¬å·åŒ…è£¹ã€‚</p>
</blockquote>
<pre><code class="language-css">/* å½“ transform-origin: 10em 10em 10em æ— æ•ˆæ—¶ï¼Œè¡¨è¾¾å¼è¿”å› true */
@supports not (transform-origin: 10em 10em 10em) {
  /* æ ·å¼å£°æ˜ */
}
</code></pre>
<pre><code class="language-css">/* å½“æ‰€æœ‰æ¡ä»¶åŒæ—¶ä¸ºçœŸæ—¶ï¼Œè¡¨è¾¾å¼æ‰è¿”å› true */
@supports (display: table-cell) and (display: list-item) {
  /* æ ·å¼å£°æ˜ */
}
</code></pre>
<pre><code class="language-css">/* å½“æ¡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªä¸ºçœŸæ—¶ï¼Œè¡¨è¾¾å¼æ‰è¿”å› true */
@supports (transform-style: preserve) or (-moz-transform-style: preserve) {
  /* æ ·å¼å£°æ˜ */
}
</code></pre>
<p>è¿˜æœ‰ä¸€ä¸ªå®éªŒæ€§çš„è¯­æ³•ï¼š<code>selector()</code>ï¼Œæœ‰å…´è¶£è¯·çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@supports#function_syntax">è¿™é‡Œ</a>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-98c0f9a484a65ee0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¼å®¹æ€§ä»ç„¶æ˜¯ IE å…¨ç³»ä¸æ”¯æŒï¼Œå‘µå‘µ~</p>
<h4>3.2 @media ä»‹ç»</h4>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Media_Queries/Using_media_queries">åª’ä½“æŸ¥è¯¢</a>ï¼ˆMedia Queriesï¼‰ï¼Œåœ¨ç½‘é¡µå¼€å‘ä¸­æ˜¯éå¸¸å¸¸ç”¨çš„ã€‚æµè§ˆå™¨ç»™ Web æä¾›äº†ä¸€äº›åª’ä½“ç‰¹æ€§ï¼ˆMedia Featuresï¼‰ï¼Œå®ƒæè¿°äº† <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent">User Agent</a>ã€è¾“å‡ºè®¾å¤‡ã€æµè§ˆå™¨ç¯å¢ƒçš„å…·ä½“ç‰¹å¾ã€‚ç½‘é¡µå¼€å‘è€…å¯æ ¹æ®è¿™äº›ç‰¹æ€§ï¼Œæ¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">@import 'common.css' screen, projection;

@media screen and (min-width: 480px) {
    /* ... */
}
</code></pre>
<pre><code class="language-html">&lt;link rel=&quot;stylesheet&quot; src=&quot;styles.css&quot; media=&quot;screen&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;mobile.css&quot; media=&quot;(max-width: 480px)&quot; /&gt;
</code></pre>
<pre><code class="language-js">// å¦‚æœå‚æ•°æ˜¯ CSS å£°æ˜ï¼ˆä¹Ÿå°±æ˜¯å‡ºç°äº†å†’å·ï¼‰ï¼Œå¤–é¢éœ€è¦æœ‰ä¸ªæ‹¬å·ï¼Œå¦åˆ™è¯­æ³•ä¸æ­£ç¡®ã€‚
if (window.matchMedia('(max-width: 480px)').matches) {
    // ...
}
</code></pre>
<p>ä½¿ç”¨åª’ä½“æŸ¥è¯¢æœ€å¸¸è§çš„æ˜¯ <code>@media</code> æ–¹å¼ï¼Œä½†æ˜¯åœ¨ HTML å’Œ JavaScript åŒæ ·æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œåè€…ç”¨å¾—è¾ƒå°‘ã€‚</p>
<p>åª’ä½“æŸ¥è¯¢å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p>
<blockquote>
<ul>
<li>åœ¨ CSS ä¸­ä½¿ç”¨ <code>@media</code> æ¥è£…é¥°æ ·å¼ã€‚</li>
<li>åœ¨ HTML ä¸­å°† <code>media</code> å±æ€§ä½œç”¨äº <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/style#attr-media"><code>&lt;style&gt;</code></a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/link#attr-media"><code>&lt;link&gt;</code></a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/source#attr-media"><code>&lt;source&gt;</code></a> ç­‰å…ƒç´ æŒ‡å®šç‰¹å®šçš„åª’ä½“ç±»å‹ã€‚</li>
<li>åœ¨ JavaScript ä¸­ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia"><code>Window.matchMedia()</code></a>Â å’Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList/addListener"><code>MediaQueryList.addListener()</code></a>Â æ–¹æ³•æ¥<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Testing_media_queries">æµ‹è¯•å’Œç›‘æ§åª’ä½“çŠ¶æ€</a>ã€‚</li>
</ul>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åª’ä½“æŸ¥è¯¢ä½œç”¨äº <code>&lt;link&gt;</code> å…ƒç´ æ—¶ï¼Œå³ä½¿åª’ä½“æŸ¥è¯¢ç»“æœä¸º <code>false</code>ï¼Œè¯¥æ ·å¼è¡¨ä»ä¼šè¢«ä¸‹è½½ï¼Œåªæ˜¯æ ·å¼å†…å®¹ä¸è¢«ä½œç”¨è€Œå·²ã€‚</p>
<p><strong>3.2.1 åª’ä½“æŸ¥è¯¢è¯­æ³•</strong></p>
<p>æ¯æ¡åª’ä½“æŸ¥è¯¢è¯­å¥ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç”±ä¸€ä¸ªå¯é€‰çš„ã€Œåª’ä½“ç±»å‹ã€å’Œä»»æ„æ•°é‡çš„ã€Œåª’ä½“ç‰¹å¾ã€è¡¨è¾¾å¼æ„æˆã€‚åŒæ—¶å¯ä½¿ç”¨å¤šç§ã€Œé€»è¾‘æ“ä½œç¬¦ã€åˆå¹¶å¤šæ¡åª’ä½“æŸ¥è¯¢è¯­å¥ã€‚</p>
<p>å½“åª’ä½“æŸ¥è¯¢è¯­å¥ä¸­æŒ‡å®šçš„åª’ä½“ç±»å‹ä¸è®¾å¤‡åŒ¹é…æ—¶ï¼Œè¿™æ¡åª’ä½“æŸ¥è¯¢ç»“æœè¿”å› <code>true</code>ã€‚è‹¥æ˜¯å¤šæ¡åª’ä½“æŸ¥è¯¢è¯­å¥ç»„åˆï¼Œéœ€æ¯ä¸ªæ¡ä»¶å‡ä¸º <code>true</code>ï¼Œé‚£ä¹ˆåª’ä½“æŸ¥è¯¢ç»“æœæ‰ä¸º <code>true</code>ã€‚</p>
<p><strong>3.2.2 åª’ä½“ç±»å‹ï¼ˆMedia Typesï¼‰</strong></p>
<p>åœ¨åª’ä½“æŸ¥è¯¢ä¸­ï¼Œåª’ä½“ç±»å‹ï¼ˆMedia Typesï¼‰æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤æ˜¯ <code>all</code> ç±»å‹ã€‚ä¸€èˆ¬æ˜¯ä½¿ç”¨äº† <code>not</code> æˆ– <code>only</code> é€»è¾‘æ“ä½œç¬¦ï¼Œæ‰éœ€è¦æ˜¾å¼æŒ‡å®šã€‚æœ‰ä»¥ä¸‹è¿™äº›ï¼š</p>
<table>
<thead>
<tr>
<th>åª’ä½“ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>all</code></td>
<td>é»˜è®¤å€¼ï¼Œé€‚ç”¨äºæ‰€æœ‰è®¾å¤‡</td>
</tr>
<tr>
<td><code>screen</code></td>
<td>é€‚ç”¨äºå±å¹•ã€‚</td>
</tr>
<tr>
<td><code>print</code></td>
<td>é€‚ç”¨äºåœ¨æ‰“å°é¢„è§ˆæ¨¡å¼ä¸‹çš„å±å¹•ä¸ŠæŸ¥å¿«é€’åˆ†é¡µææ–™å’Œæ–‡æ¡£ã€‚</td>
</tr>
<tr>
<td><code>speech</code></td>
<td>é€‚ç”¨äºè¯­éŸ³åˆæˆå™¨ã€‚</td>
</tr>
</tbody>
</table>
<p>ä¸€éƒ¨åˆ†åª’ä½“ç±»å‹åœ¨ Media Queries Level 4 ä¸­å·²è¢«å¼ƒç”¨ï¼Œå¯çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media#media_types">è¿™é‡Œ</a>ã€‚</p>
<p>ç®€å•ç¤ºä¾‹ï¼š</p>
<pre><code class="language-css">@media print {
  /* é’ˆå¯¹æ‰“å°è®¾å¤‡ */
}

@media screen, print {
  /* é’ˆå¯¹å¤šç§è®¾å¤‡ */
}
</code></pre>
<p><strong>3.2.3 åª’ä½“ç‰¹æ€§ï¼ˆMedia Featuresï¼‰</strong></p>
<p>åª’ä½“ç‰¹æ€§æè¿°äº†Â User Agentã€è¾“å‡ºè®¾å¤‡ï¼Œæˆ–æ˜¯æµè§ˆç¯å¢ƒçš„å…·ä½“ç‰¹å¾ï¼Œæ›´å¤šè¯·çœ‹ <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media#media_features">MDN</a>ã€‚</p>
<blockquote>
<p>å»ºè®®ï¼šä½¿ç”¨å‰å…ˆå¼„æ¸…æ¥š<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media#browser_compatibility">å…¼å®¹æƒ…å†µ</a>ã€‚</p>
</blockquote>
<p>å¸¸è§çš„åª’ä½“ç‰¹æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>åª’ä½“ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aspect-ratio</code></td>
<td>è§†å£ï¼ˆViewportï¼‰çš„å®½é«˜æ¯”ã€‚</td>
</tr>
<tr>
<td><code>width</code></td>
<td>è¾“å‡ºè®¾å¤‡æ›´æ–°å†…å®¹çš„æ¸²æŸ“ç»“æœçš„é¢‘ç‡ã€‚</td>
</tr>
<tr>
<td><code>height</code></td>
<td>è§†å£ï¼ˆViewportï¼‰çš„é«˜åº¦</td>
</tr>
<tr>
<td><code>hover</code></td>
<td>ä¸»è¦è¾“å…¥æ¨¡å¼æ˜¯å¦å…è®¸ç”¨æˆ·åœ¨å…ƒç´ ä¸Šæ‚¬åœã€‚</td>
</tr>
<tr>
<td><code>orientation</code></td>
<td>è§†å£ï¼ˆViewportï¼‰çš„æ—‹è½¬æ–¹å‘ã€‚</td>
</tr>
<tr>
<td><code>prefers-color-scheme</code></td>
<td>æ¢æµ‹ç”¨æˆ·å€¾å‘äºé€‰æ‹©äº®è‰²è¿˜æ˜¯æš—è‰²çš„é…è‰²æ–¹æ¡ˆã€‚</td>
</tr>
<tr>
<td><code>resolution</code></td>
<td>è¾“å‡ºè®¾å¤‡çš„åƒç´ å¯†åº¦ï¼ˆåˆ†è¾¨ç‡ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>scripting</code></td>
<td>æ¢æµ‹è„šæœ¬ï¼ˆä¾‹å¦‚ JavaScriptï¼‰æ˜¯å¦å¯ç”¨ï¼Ÿ</td>
</tr>
</tbody>
</table>
<p>å®é™…åœºæ™¯ä¸­ç”¨å¾—è¾ƒå°‘çš„åª’ä½“ç‰¹æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>åª’ä½“ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>any-hover</code></td>
<td>æ˜¯å¦æœ‰ä»»ä½•å¯ç”¨çš„è¾“å…¥æœºåˆ¶å…è®¸ç”¨æˆ·ï¼ˆå°†é¼ æ ‡ç­‰ï¼‰æ‚¬åœåœ¨å…ƒç´ ä¸Šï¼Ÿ</td>
</tr>
<tr>
<td><code>any-pointer</code></td>
<td>å¯ç”¨çš„è¾“å…¥æœºåˆ¶ä¸­æ˜¯å¦æœ‰ä»»ä½•æŒ‡é’ˆè®¾å¤‡ï¼Œå¦‚æœæœ‰ï¼Œå®ƒçš„ç²¾åº¦å¦‚ä½•ï¼Ÿ</td>
</tr>
<tr>
<td><code>pointer</code></td>
<td>ä¸»è¦è¾“å…¥æœºåˆ¶æ˜¯ä¸€ä¸ªæŒ‡é’ˆè®¾å¤‡å—ï¼Ÿå¦‚æœæ˜¯ï¼Œå®ƒçš„ç²¾åº¦å¦‚ä½•ï¼Ÿ</td>
</tr>
<tr>
<td><code>color</code></td>
<td>è¾“å‡ºè®¾å¤‡æ¯ä¸ªåƒç´ çš„æ¯”ç‰¹å€¼ï¼Œå¸¸è§çš„æœ‰ 8ã€16ã€32 ä½ã€‚å¦‚æœè®¾å¤‡ä¸æ”¯æŒè¾“å‡ºå½©è‰²ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚</td>
</tr>
<tr>
<td><code>color-gamut</code></td>
<td>ç”¨æˆ·ä»£ç†å’Œè¾“å‡ºè®¾å¤‡å¤§è‡´ç¨‹åº¦ä¸Šæ”¯æŒçš„è‰²åŸŸã€‚</td>
</tr>
<tr>
<td><code>color-index</code></td>
<td>è¾“å‡ºè®¾å¤‡çš„é¢œè‰²æŸ¥è¯¢è¡¨ï¼ˆcolor lookup tableï¼‰ä¸­çš„æ¡ç›®æ•°é‡ï¼Œå¦‚æœè®¾å¤‡ä¸ä½¿ç”¨é¢œè‰²æŸ¥è¯¢è¡¨ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚</td>
</tr>
<tr>
<td><code>display-mode</code></td>
<td>åº”ç”¨ç¨‹åºçš„æ˜¾ç¤ºæ¨¡å¼ï¼Œæ¯”å¦‚ Web App ä¸­çš„ manifest ä¸­çš„ display æˆå‘˜æ‰€æŒ‡å®šã€‚</td>
</tr>
<tr>
<td><code>forced-color</code></td>
<td>æ£€æµ‹ User Agent æ˜¯å¦é™åˆ¶è°ƒè‰²æ¿ã€‚</td>
</tr>
<tr>
<td><code>grid</code></td>
<td>è¾“å‡ºè®¾å¤‡ä½¿ç”¨ç½‘æ ¼å±å¹•è¿˜æ˜¯ç‚¹é˜µå±å¹•ï¼Ÿ</td>
</tr>
<tr>
<td><code>inverted-colors</code></td>
<td>User Agent æˆ–è€…åº•å±‚æ“ä½œç³»ç»Ÿæ˜¯å¦åè½¬äº†é¢œè‰²ã€‚</td>
</tr>
<tr>
<td><code>light-height</code></td>
<td>ç¯å¢ƒå…‰äº®åº¦ã€‚</td>
</tr>
<tr>
<td><code>monochrome</code></td>
<td>è¾“å‡ºè®¾å¤‡å•è‰²å¸§ç¼“å†²åŒºä¸­æ¯ä¸ªåƒç´ çš„ä½æ·±åº¦ã€‚å¦‚æœè®¾å¤‡å¹¶éé»‘ç™½å±å¹•ï¼Œåˆ™è¯¥å€¼ä¸º 0ã€‚</td>
</tr>
<tr>
<td><code>overflow-block</code></td>
<td>è¾“å‡ºè®¾å¤‡å¦‚ä½•å¤„ç†æ²¿å—è½´æº¢å‡ºè§†çª—(viewport)çš„å†…å®¹</td>
</tr>
<tr>
<td><code>overflow-inline</code></td>
<td>æ²¿å†…è”è½´æº¢å‡ºè§†å£ï¼ˆViewportï¼‰çš„å†…å®¹æ˜¯å¦å¯ä»¥æ»šåŠ¨ï¼Ÿ</td>
</tr>
<tr>
<td><code>prefers-contrast</code></td>
<td>æ¢æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å‘ç³»ç»Ÿè¦æ±‚æé«˜æˆ–é™ä½ç›¸è¿‘é¢œè‰²ä¹‹é—´çš„å¯¹æ¯”åº¦ã€‚</td>
</tr>
<tr>
<td><code>prefers-reduced-motion</code></td>
<td>ç”¨æˆ·æ˜¯å¦å¸Œæœ›é¡µé¢ä¸Šå‡ºç°æ›´å°‘çš„åŠ¨æ€æ•ˆæœã€‚</td>
</tr>
<tr>
<td><code>update</code></td>
<td>è¾“å‡ºè®¾å¤‡æ›´æ–°å†…å®¹çš„æ¸²æŸ“ç»“æœçš„é¢‘ç‡ã€‚</td>
</tr>
</tbody>
</table>
<p>åœ¨ Media Queries Level 4 å·²è¢«å¼ƒç”¨çš„åª’ä½“ç‰¹æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>åª’ä½“ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>device-aspect-ratio</code></td>
<td>è¾“å‡ºè®¾å¤‡çš„å®½é«˜æ¯”ã€‚</td>
</tr>
<tr>
<td><code>device-width</code></td>
<td>è¾“å‡ºè®¾å¤‡æ¸²æŸ“è¡¨é¢ï¼ˆå¦‚å±å¹•ï¼‰çš„å®½åº¦ã€‚</td>
</tr>
<tr>
<td><code>device-height</code></td>
<td>è¾“å‡ºè®¾å¤‡æ¸²æŸ“è¡¨é¢ï¼ˆå¦‚å±å¹•ï¼‰çš„é«˜åº¦ã€‚</td>
</tr>
</tbody>
</table>
<p>å¯¹äº Media Queries Level å„çº§ä¸­æ–°å¢æˆ–å¼ƒç”¨çš„åª’ä½“ç‰¹æ€§ï¼Œå¯çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media#%E8%A7%84%E8%8C%83">è¿™é‡Œ</a>ã€‚</p>
<p>å¯¹äºè¡¨ç¤ºã€ŒèŒƒå›´ã€çš„çš„åª’ä½“ç‰¹æ€§ï¼ˆæ¯”å¦‚ <code>width</code>ã€<code>height</code> ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ <code>min-*</code>ã€<code>max-*</code> è¡¨ç¤ºæŸ¥è¯¢æœ€å°å€¼ã€æœ€å¤§å€¼ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-css">@media (width: 480px) {
  /* å½“ Viewport å®½åº¦ç­‰äº 480px æ—¶è¢«åº”ç”¨ */
}

@media (min-width: 720px) {
  /* å½“ Viewport æœ€å°å®½åº¦å¤§äºç­‰äº 720px æ—¶è¢«åº”ç”¨ */
}

@media (max-width: 960px) {
  /* å½“ Viewport æœ€å¤§å®½åº¦ä¸è¶…è¿‡ 960px æ—¶è¢«åº”ç”¨ */
}
</code></pre>
<p>ä»¥ä¸Šè¿™ç§å†™æ³•ï¼Œåœ¨ Media Queries Level 4 ä¸­æ”¯æŒä»¥ä¸‹<a href="https://drafts.csswg.org/mediaqueries-4/#mq-min-max">èŒƒå›´è¯­æ³•</a>ï¼Œä½†ç›®å‰<a href="https://caniuse.com/?search=media%20queries%204">å…¼å®¹æ€§</a>éå¸¸çš„å·®ï¼Œäº†è§£ä¸‹å°±è¡Œäº†ï¼š</p>
<pre><code class="language-css">@media (min-width: 720px) and (max-width: 960px) {}

/* ç­‰ä»·äº */
@media ( 720px &lt;= width &lt;= 960px) {}
</code></pre>
<p><strong>3.2.4 device-width ä¸ width çš„åŒºåˆ«</strong></p>
<p>å…¶ä¸­ <code>device-width</code> è¡¨ç¤ºè®¾å¤‡çš„å®½åº¦ï¼Œ<code>width</code> è¡¨ç¤ºè§†å£ Viewport å®½åº¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ PC ä¸­æ‰“å¼€äº†ä¸€ä¸ªã€Œéå…¨å±ã€çš„æµè§ˆå™¨çª—å£ï¼Œé‚£ä¹ˆ <code>device-with</code> æ˜¯æ˜¾ç¤ºå™¨çš„å®½åº¦ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚è€Œ <code>width</code> åˆ™æ˜¯æµè§ˆå™¨å†…é¡µé¢çš„ Viewport å®½åº¦ï¼ˆæ³¨æ„ï¼Œä¸èƒ½å•çº¯åœ°è®¤ä¸ºæµè§ˆå™¨çª—å£çš„å®½åº¦ï¼‰ï¼Œé€šè¿‡æ‹–æ‹½æµè§ˆå™¨çª—å£ç­‰è¡Œä¸ºæ˜¯å¯ä½¿å…¶å‘ç”Ÿå˜åŒ–çš„ã€‚</p>
<p>ä½†è¯·æ³¨æ„ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸­ï¼Œæ¨ªå±ä¸ç«–å±çš„åˆ‡æ¢ï¼Œ<code>device-width</code> ä¼šç›¸åº”è·Ÿç€æ”¹å˜çš„ã€‚åº”å¯¹è¿™ç§è¡Œä¸ºï¼Œå¯ç»“åˆ <code>orientation</code> è¿™ä¸ªåª’ä½“ç‰¹æ€§ä½¿ç”¨ã€‚</p>
<blockquote>
<p><code>device-height</code> ä¸ <code>height</code> åŒç†ã€‚</p>
</blockquote>
<p><strong>3.2.5 é€»è¾‘æ“ä½œç¬¦ï¼ˆLogical Operatorsï¼‰</strong></p>
<p>é€šè¿‡é€»è¾‘æ“ä½œç¬¦ï¼ˆ<code>and</code>ã€<code>not</code>ã€<code>only</code>ï¼‰ï¼Œå¯ä»¥åˆ›å»ºå¤æ‚ã€å¤šæ¡ä»¶çš„åª’ä½“æŸ¥è¯¢ã€‚å…¶ä¸­ <code>and</code>ã€<code>not</code>ã€<code>only</code> åˆ†åˆ«è¡¨ç¤ºä¸ã€éã€å”¯ä¸€çš„æ„æ€ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>,</code>ï¼ˆé€—å·ï¼‰å°†å¤šä¸ªåª’ä½“æŸ¥è¯¢åˆå¹¶ï¼Œåªè¦ä»»ä¸€æŸ¥è¯¢ç»“æœä¸º <code>true</code>ï¼Œæ•´ä¸ªæŸ¥è¯¢è¯­å¥å°±è¿”å› <code>true</code>ï¼ˆè·Ÿé€»è¾‘æˆ– <code>or</code> è¡Œä¸ºç±»ä¼¼ï¼‰ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<blockquote>
<ul>
<li><code>not</code> æ“ä½œç¬¦ä¸èƒ½ç”¨äºå¦å®šå•ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåªèƒ½ç”¨äºå¦å®šæ•´ä¸ªåª’ä½“æŸ¥è¯¢ã€‚</li>
<li>ä½¿ç”¨ <code>not</code>ã€<code>only</code> æ“ä½œç¬¦ï¼Œå¿…é¡»æŒ‡å®šã€Œåª’ä½“ç±»å‹ã€ã€‚</li>
<li><code>and</code> æ“ä½œç¬¦å¯ä»¥å°†åª’ä½“ç±»å‹ã€åª’ä½“ç‰¹æ€§æˆ–å…¶ä»–åª’ä½“åŠŸèƒ½ç»„åˆåœ¨ä¸€èµ·ã€‚</li>
<li><code>only</code> æ“ä½œç¬¦ï¼Œä¸€èˆ¬ç”¨äºå¤„ç†ä¸æ”¯æŒã€Œåª’ä½“ç‰¹æ€§ã€æŸ¥è¯¢çš„è¯­å¥æ—§ç‰ˆæœ¬æµè§ˆå™¨ã€‚</li>
</ul>
</blockquote>
<p>ä¸‹é¢çœ‹ä¸€äº›ç¤ºä¾‹ï¼š</p>
<pre><code class="language-css">/* not ä½œç”¨äºæ•´ä¸ªåª’ä½“æŸ¥è¯¢ */
@media not all and (monochrome) {}

/* ç­‰ä»·äº */
@media not (all and (monochrome)) {}

/* è€Œä¸æ˜¯ */
@media (not all) and (monochrome) {}
</code></pre>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-css">@media not screen and (color), print and (color) {}

/* ç­‰ä»·äº */
@media (not (screen and (color))), print and (color) {}
</code></pre>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-css">/* é€šè¿‡ and å¯ç»„åˆå¤šä¸ªæ¡ä»¶ */
@media screen and (min-width: 30em) and (orientation: landscape) {}
</code></pre>
<p>å†çœ‹ï¼š</p>
<pre><code class="language-css">/*
  ç”¨æˆ·è®¾å¤‡çš„æœ€å°é«˜åº¦ä¸º 680px æˆ–ä¸ºç«–å±æ¨¡å¼çš„å±å¹•è®¾å¤‡ï¼Œéƒ½ä¼šè¢«åº”ç”¨æ­¤æ ·å¼ã€‚
*/
@media (min-height: 680px), screen and (orientation: portrait) {}
</code></pre>
<p>å†çœ‹è¿™ä¸ªç¤ºä¾‹ï¼Œå¦‚æœæ˜¯ä¸æ”¯æŒã€Œåª’ä½“ç‰¹æ€§ã€æŸ¥è¯¢çš„æ—§æµè§ˆå™¨ï¼Œé‚£ä¹ˆä»¥ä¸‹æ ·å¼å°†ä¸ä¼šè¢«åº”ç”¨ï¼Œåœ¨è¿™äº›æµè§ˆå™¨çœ‹æ¥ï¼Œå®ƒå°† <code>only</code> è¯†åˆ«ä¸ºã€Œåª’ä½“ç±»å‹ã€äº†ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰è¿™æ ·çš„åª’ä½“ç±»å‹ï¼Œå› è€Œå°†ä¸ä¼šè¢«åº”ç”¨ã€‚è€Œåœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œå°±æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p>
<pre><code class="language-css">@media only screen and (color) {}

/* åœ¨æ—§ç‰ˆæµè§ˆå™¨ï¼Œç›¸å½“äºè¿™æ · */
@media only {}

/* åœ¨ç°ä»£æµè§ˆå™¨ï¼Œç›¸å½“äºè¿™æ · */
@media screen and (color) {}
</code></pre>
<h4>3.3 @media åº”ç”¨åœºæ™¯</h4>
<ol>
<li>æµ…è‰²æ¨¡å¼ä¸æ·±è‰²æ¨¡å¼</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨åª’ä½“ç‰¹æ€§ <code>prefers-color-scheme</code> æ¥åˆ¤æ–­æ˜¯å¦åœ¨ç³»ç»Ÿå±‚é¢è®¾ç½®äº†æ·±è‰²æ¨¡å¼ã€‚å®ƒæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p>
<ul>
<li><code>light</code> - è¡¨ç¤ºç”¨æˆ·åœ¨ç³»ç»Ÿå±‚é¢ä½¿ç”¨äº†â€œæµ…è‰²æ¨¡å¼â€ã€‚</li>
<li><code>dark</code> - è¡¨ç¤ºç”¨æˆ·åœ¨ç³»ç»Ÿå±‚é¢ä½¿ç”¨äº†â€œæ·±è‰²æ¨¡å¼â€ã€‚</li>
<li><code>no-preference</code> - ç†è§£ä¸ºæµè§ˆå™¨ä¸æ”¯æŒè®¾ç½®ä¸»é¢˜è‰²ï¼Œæˆ–è€…æµè§ˆå™¨æ”¯æŒè®¾ç½®ä¸»é¢˜è‰²ï¼Œä½†é»˜è®¤è¢«è®¾ä¸ºâ€œæœªè®¾ç½®â€ã€â€œæ— åå¥½â€ç­‰ï¼ˆä¹Ÿå¯ç®€å•ç†è§£ä¸ºæ— é»˜è®¤å€¼ï¼‰ã€‚</li>
</ul>
<pre><code class="language-css">/* æ·±â¾Šæ¨¡å¼ */
@media (prefers-color-scheme: dark) {}

/* æµ…â¾Šæ¨¡å¼ */
@media (prefers-color-scheme: light) {}
</code></pre>
<p>é€šè¿‡ DOM API æä¾›çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia">matchMedia</a> æ¥å£ï¼Œå¯ä»¥åšä¸€äº›åˆ¤æ–­ï¼š</p>
<pre><code class="language-js">if (window.matchMedia('(prefers-color-scheme)').media !== 'not all') {
  console.log('ğŸ‰ Dark mode is supported')
}

if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  console.log('Dark mode is on.')
}

if (window.matchMedia('(prefers-color-scheme: light)').matches) {
  console.log('Light mode is on.')
}
</code></pre>
<p>æƒ³è¦ç›‘å¬æµ…è‰²/æ·±è‰²æ¨¡å¼çš„åˆ‡æ¢ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code class="language-js">const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
const lightModeMediaQuery = window.matchMedia('(prefers-color-scheme: light)')

darkModeMediaQuery.addListener(e =&gt; {
  const darkModeStatus = e.matches
  console.log(`Dark mode is ${darkModeStatus ? 'on' : 'off'}.`)
})

lightModeMediaQuery.addListener(e =&gt; {
  const lightModeStatus = e.matches
  console.log(`Light mode is ${lightModeStatus ? 'on' : 'off'}.`)
})
</code></pre>
<p>ç»“åˆ CSS å˜é‡å°±å¯ä»¥å¾ˆå¥½åœ°å»é€‚é…ç½‘ç«™çš„æ·±è‰²æ¨¡å¼äº†ã€‚ä¸¾ä¸ªç®€å•ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;theme.css&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;article&gt;
        &lt;h1&gt;è’¹è‘­&lt;/h1&gt;
        &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²ä¸ºéœœã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¸€æ–¹ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”é•¿ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å¤®ã€‚&lt;/p&gt;
        &lt;p&gt;è’¹è‘­è‹è‹ï¼Œç™½éœ²æœªæ™ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¹„ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”è·»ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­å»ã€‚&lt;/p&gt;
        &lt;p&gt;è’¹è‘­é‡‡é‡‡ï¼Œç™½éœ²æœªå·²ã€‚æ‰€è°“ä¼Šäººï¼Œåœ¨æ°´ä¹‹æ¶˜ã€‚æº¯æ´„ä»ä¹‹ï¼Œé“é˜»ä¸”å³ã€‚æº¯æ¸¸ä»ä¹‹ï¼Œå®›åœ¨æ°´ä¸­æ²šã€‚&lt;/p&gt;
        &lt;p&gt;&lt;/p&gt;
      &lt;/article&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="language-css">/* theme.css */
:root {
  --theme-bg: #fff;
  --theme-color: #000;
}

@media screen and (prefers-color-scheme: dark) {
  :root {
    --theme-bg: #000;
    --theme-color: #fff;
  }
}

body {
  color: var(--theme-color);
  background: var(--theme-bg);
}
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ä¼šè‡ªé€‚åº”ç³»ç»Ÿä¸»é¢˜è‰²ï¼Œå¦‚æœä½ æƒ³äº¤ç”±ç”¨æˆ·å†³å®šï¼Œå»æ‰ç¤ºä¾‹ä¸­çš„åª’ä½“æŸ¥è¯¢ï¼Œç„¶åé€šè¿‡ JavaScript å»åŠ¨æ€è®¾ç½® CSS å˜é‡å³å¯ã€‚å¦å¤–ï¼Œå¯ä»¥çœ‹ä¸‹å¼ é‘«æ—­å¤§ä½¬è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.zhangxinxu.com/wordpress/2020/11/css-mix-blend-mode-filter-dark-theme/">å‡ è¡ŒCSSè®©æ•´ç«™æ”¯æŒæ·±è‰²æ¨¡å¼çš„æ¢ç´¢ä¸æ‹“å±•</a>ã€‚</p>
<p><a href="https://caniuse.com/prefers-color-scheme">å…¼å®¹æ€§</a>å¦‚ä¸‹ï¼Œçœ‹ç€è¿˜ä¸é”™ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-526f05195a8c2b18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç§è®¤ä¸ºæ·±è‰²æ¨¡å¼çš„é€‚é…éš¾ç‚¹å¹¶ä¸åœ¨å®ç°ä¸Šï¼Œé€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œå¯ä»¥è¯´æ˜¯æ²¡æœ‰éš¾åº¦å¯¹å§ï¼Œéš¾ç‚¹åº”è¯¥åœ¨äºè®¾è®¡å¸ˆè¦è€ƒè™‘å…¨ç«™çš„äº¤äº’æ ·å¼ï¼Œå¹¶åˆ¶å®šå‡ºæ·±æµ…æ¨¡å¼ä¸‹çš„å„çº§è‰²è°ƒç­‰ã€‚</p>
<blockquote>
<p>æ¨èçœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://web.dev/prefers-color-scheme/">prefers-color-scheme: Hello darkness, my old friend</a></p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
<!--



https://webkit.org/blog/7929/designing-websites-for-iphone-x/
https://objcer.com/2017/09/21/Understanding-the-WebView-Viewport-in-iOS-11-iPhone-X/

## TODO

1. ä¸Šä¼ è¿›åº¦æ¡ï¼š[CSSå˜é‡å±€éƒ¨ç‰¹æ€§ç”¨é€”](https://www.zhangxinxu.com/wordpress/2019/01/css-var-å˜é‡-å±€éƒ¨/)
2. @mediaã€@supports

3. 1px é€‚é…ï¼Œä»¥åŠ[-webkit-device-pixel-ratio](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/-webkit-device-pixel-ratio)

## References

* [MDN è‡ªå®šä¹‰å±æ€§ (--*)ï¼šCSSå˜é‡](https://developer.mozilla.org/zh-CN/docs/Web/CSS/--*)
* [äº†è§£ CSS å˜é‡ var](https://www.zhangxinxu.com/wordpress/2016/11/css-css3-variables-var/)
* [CSS å˜é‡æ•™ç¨‹](https://www.ruanyifeng.com/blog/2017/05/css-variables.html)
* [Everything you need to know about CSS Variables](https://www.freecodecamp.org/news/everything-you-need-to-know-about-css-variables-c74d922ea855/)
* [Understanding the Difference Between CSS Resolution and Device Resolution](https://elad.medium.com/understanding-the-difference-between-css-resolution-and-device-resolution-28acae23da0b)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº Safari 100vh çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/169</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/169</guid>
            <pubDate>Sun, 26 Feb 2023 07:46:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-957cd24d4ff33bb3.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-957cd24d4ff33bb3.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h3>ä¸€ã€èƒŒæ™¯</h3>
<p>æœ€è¿‘åœ¨åšä¸€ä¸ªç§»åŠ¨ç«¯çš„ H5 é¡¹ç›®ï¼Œé‡åˆ°äº†ä¸€ä¸ªã€Œæœ‰è¶£ã€çš„é—®é¢˜ã€‚å‡è®¾æœ‰ä¸€é¡µé¢å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-44e5d7fc2b9f44dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸‹æ–¹ 50px æ‚¬æµ®äºåº•éƒ¨ï¼Œé‡‡ç”¨ fixed å¸ƒå±€ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;container&quot;&gt;
  &lt;!-- height: 100vh - 50px --&gt;
  &lt;div class=&quot;page&quot;&gt;&lt;/div&gt;
  &lt;!-- fixed bottom, height: 50px --&gt;
  &lt;div class=&quot;tabbar&quot;&gt;TabBar&lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
  window.onload = function () {
    const arr = new Array(100).fill(0).map((_, index) =&gt; index + 1)
    const pageEl = document.querySelector('.page')
    const listEl = document.createElement('div')

    arr.forEach(item =&gt; {
      const itemElement = document.createElement('div')
      itemElement.innerText = item
      itemElement.className = 'list'
      listEl.appendChild(itemElement)
    })

    pageEl.appendChild(listEl)
  }
&lt;/script&gt;
</code></pre>
<p>å®Œæ•´ç¤ºä¾‹è¯·çœ‹  <a href="https://codesandbox.io/s/safari-100vh-demo-cmh34y">CodeSandbox</a>ã€‚</p>
<p>æµ‹è¯•ä¸‹æ¥çœ‹ä¼¼ä¹æ²¡é—®é¢˜ï¼Œå¯å½“ä½ ä½¿ç”¨ iPhone çš„ Safari æµè§ˆå™¨æ‰“å¼€æ­¤é¡µé¢æ—¶ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cd4c2e666432ab21.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆªå›¾ä¸­å·²æ»‘åŠ¨è‡³é¡µé¢æœ€åº•éƒ¨ï¼Œç„¶è€Œ 100 è¢« TabBar éƒ¨åˆ†æŒ¡ä½äº†ï¼ˆå…¶ä»–æµè§ˆå™¨å‡èƒ½æ­£å¸¸å±•ç¤ºå‡ºæ¥ï¼‰ã€‚</p>
<h3>äºŒã€åŸå› </h3>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>vh</code>ã€<code>vw</code> éƒ½æ˜¯ CSS ä¸­çš„ä¸€ç§ç›¸å¯¹é•¿åº¦å•ä½ï¼Œ<code>1vh</code> è¡¨ç¤º <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Viewport_concepts#mobile_viewports">viewport</a> é«˜åº¦çš„ 1%ï¼ˆ<code>vm</code> åŒç†ï¼‰ã€‚ç®€å•æ¥è®²ï¼Œviewport åŸºæœ¬ä¸Šæ˜¯æŒ‡å½“å‰æ–‡æ¡£çš„å¯è§éƒ¨åˆ†ï¼Œå› æ­¤ <code>100vh</code> è¡¨ç¤ºå¯è§æ–‡æ¡£çš„æœ€å¤§é«˜åº¦ã€‚</p>
<p><strong>å¯äº‹å®çœŸæ˜¯å¦‚æ­¤å—ï¼Ÿ</strong></p>
<p>åœ¨ Safari æµè§ˆå™¨ä¸­ï¼Œ<code>100vh</code> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆ<a href="https://github.com/postcss/postcss-100vh-fix">å‡ºè‡ª</a>ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b1854fe9be4944dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æŒ‰ä¸Šé¢æ‰€è¯´ï¼Œ<code>100vh</code> ä¸åº”è¯¥æ˜¯ viewport å¯è§†åŒºåŸŸçš„å…¨éƒ¨é«˜åº¦ï¼Œä¸ºä»€ä¹ˆå³å›¾çš„é«˜åº¦ä¼šè¶…å‡ºçš„å‘¢ï¼Ÿ</p>
<p>åšä¸ªç®€å›¾åŒºåˆ†ä¸€ä¸‹å§ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e264185efee55497.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ Safari ä¼šè¢«æŒ¡ä½ä¸€éƒ¨åˆ†çš„åŸå› ã€‚</p>
<blockquote>
<p>åæ§½ä¸€ä¸‹ï¼ŒSafari ä¼šæ˜¯ç°ä»£åŒ–çš„ IE æµè§ˆå™¨ï¼Ÿ</p>
</blockquote>
<h3>ä¸‰ã€å¯»æ ¹é—®åº•</h3>
<p>æ˜¯ bug è¿˜æ˜¯æ•…æ„ä¸ºä¹‹ï¼Ÿ</p>
<p>å¯ä»¥è¯¦ç»†åœ°çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://nicolas-hoizey.com/articles/2015/02/18/viewport-height-is-taller-than-the-visible-part-of-the-document-in-some-mobile-browsers/">Viewport height is taller than the visible part of the document in some mobile browsers</a>ï¼Œç„¶åæ–‡ç« ä½œè€…ç»™ WebKit æäº†ä¸ª <a href="https://bugs.webkit.org/show_bug.cgi?id=141832">bug</a>ï¼Œå…¶ä¸­ Apple å·¥ç¨‹å¸ˆ Benjamin Poulain çš„<a href="https://bugs.webkit.org/show_bug.cgi?id=141832#c5">å›ç­”</a>å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>This is completely intentional. It took quite a bit of work on our part to achieve this effect. :)</p>
</blockquote>
<p><strong>So, it's a feature, not a bug.</strong></p>
<p>ç„¶è€Œï¼Œå¹¶ä¸æ˜¯åªæœ‰ Safari æ˜¯è¿™æ ·åšçš„ï¼Œæ¯”å¦‚ iOS ç«¯ Chrome æµè§ˆå™¨è¡¨ç°ä¸ iOS ç«¯ Safari ä¸€è‡´...Â (âŠ™ËâŠ™)</p>
<h3>å››ã€è§£å†³æ–¹æ³•</h3>
<p>å°½ç®¡è¿™å¹¶ä¸æ˜¯å¤§å¤šæ•°å¼€å‘è€…æƒ³è¦çš„ï¼Œä½†å¾ˆæ— å¥ˆï¼Œæˆ‘ä»¬åªèƒ½æƒ³åŠæ³•å»ã€Œä¿®å¤ã€å®ƒï¼Œä½¿å¾—æˆ‘ä»¬çš„ç½‘ç«™åœ¨å„æµè§ˆå™¨è¡¨ç°ä¸€è‡´ã€‚</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ -webkit-fill-available</strong></p>
<p>ç®€å•æ¥è¯´ï¼Œ-webkit-fill-available å°±æ˜¯è‡ªåŠ¨å¡«æ»¡å‰©ä½™ç©ºé—´ï¼ˆ<a href="https://www.zhangxinxu.com/wordpress/2016/05/css3-width-max-contnet-min-content-fit-content/">è¯¦è§</a>ï¼‰ã€‚è¿™é‡Œä½¿ç”¨å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¥è¯´æ˜ <code>-webkit-fill-available</code> çš„ä¸€äº›é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;style&gt;
    * {
      padding: 0;
      margin: 0;
      text-align: center;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
  &lt;/style&gt;
  &lt;body&gt;
    &lt;div style=&quot;height: 100px; background: blue&quot;&gt;&lt;/div&gt;
    &lt;div style=&quot;flex: 1; background: red&quot;&gt;&lt;/div&gt;
    &lt;div style=&quot;height: 100px; background: green&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œåˆ†åˆ«ä¼šæœ‰è“ã€çº¢ã€ç»¿ä¸‰éƒ¨åˆ†ï¼ŒæŒ‰é¢„æœŸç»“æœï¼Œå®ƒä»¬åº”è¯¥ä¼šå æ»¡æ•´ä¸ªå¯è§†åŒºåŸŸï¼ˆå®Œæ•´ç¤ºä¾‹è¯·çœ‹  <a href="https://codesandbox.io/s/-webkit-fill-available-demo-ibeg82">CodeSandbox</a>ï¼‰ï¼Œè€Œ Safari ä¸­åº•éƒ¨ç»¿è‰²éƒ¨åˆ†ä¼šè¢«æŒ¡ä½ã€‚ç„¶åæˆ‘ä»¬æ·»åŠ åœ¨ <code>body</code> æ·»åŠ ä¸Š -<code>webkit-fill-available</code> çœ‹çœ‹ï¼š</p>
<pre><code class="language-css">body {
  min-height: 100vh;
  min-height: -webkit-fill-available;
  display: flex;
  flex-direction: column;
}
</code></pre>
<p>iOS ä¸Šçš„ Safari ä¸­çš„è¡¨ç°æ˜¯æ­£å¸¸äº†ï¼Œä½†æ˜¯ä½ ä¼šå‘ç° Chrome ä¸‹çº¢è‰²åŒºåŸŸæ²¡äº†ï¼ŒåŸå› æ˜¯ Chrome 84 èµ·å·²ä¸å†æ”¯æŒ <code>-webkit-fill-available</code>ï¼Œæ‰€ä»¥å®é™…æ¸²æŸ“å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-23be078b1ebc0e4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é‚£ä¹ˆè§£å†³æ–¹æ³•å°±æ˜¯ï¼Œé’ˆå¯¹ Safari æµè§ˆå™¨æ‰è®¾ç½® <code>-webkit-fill-available</code> å³å¯ï¼Œè¿™é‡Œåˆ©ç”¨åˆ° <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@supports">@support</a> å’Œ <a href="https://caniuse.com/?search=-webkit-touch-callout">-webkit-touch-callout</a>ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">body {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

@supports (-webkit-touch-callout: none) {
  body {
    min-height: -webkit-fill-available;
  }
}
</code></pre>
<p>è¿™æ ·å°± OK äº†ï¼ŒSafari å’Œ Chrome è¡¨ç°å‡å¦‚é¢„æœŸä¸€è‡´ã€‚è¿™ä¹Ÿæ˜¯ <a href="https://github.com/postcss/postcss-100vh-fix">postcss-100vh-fix</a> æ’ä»¶çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç„¶è€Œï¼Œä»¥ä¸Šæ–¹æ¡ˆå¹¶ä¸é€‚ç”¨äºè¿™äº›æƒ…å†µï¼Œæ¯”å¦‚ï¼š<code>height: 90vh</code>ã€<code>height: calc(100vh - 50px)</code>ï¼Œå› æ­¤æ‰æœ‰äº†æ–¹æ¡ˆäºŒã€‚</p>
<p><strong>æ–¹æ¡ˆäºŒï¼šé€šè¿‡ CSS å˜é‡è®¡ç®— 1vh æ‰€è¡¨ç¤ºçš„å®é™…é«˜åº¦</strong></p>
<p>æ€è·¯ï¼š</p>
<blockquote>
<p>è®¾ç½®ä¸€ä¸ª CSS å˜é‡ï¼ˆæ¯”å¦‚ <code>--vh</code>ï¼‰ï¼Œç„¶åé€šè¿‡ JavaScript è„šæœ¬åŠ¨æ€è®¾ç½® <code>--vh</code> çš„å€¼ï¼Œç„¶åä½¿ç”¨æ—¶éœ€å…¼å®¹å¤„ç†å³å¯ï¼ˆæ¯”å¦‚ï¼Œ<code>height: 100vh; height: calc(var(--vh) * 100)</code>ï¼‰ã€‚</p>
</blockquote>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;style&gt;
  :root {
    --vh: 1vh;
  }
&lt;/style&gt;

&lt;script&gt;
  !(function (n, e) {
    function setViewHeight() {
      var windowVH = e.innerHeight / 100
      n.documentElement.style.setProperty('--vh', windowVH + 'px')
    }
    var i = 'orientationchange' in window ? 'orientationchange' : 'resize'
    n.addEventListener('DOMContentLoaded', setViewHeight)
    e.addEventListener(i, setViewHeight)
  })(document, window)
&lt;/script&gt;
</code></pre>
<p>ä½¿ç”¨ <code>vh</code> æ—¶ï¼Œéœ€è¦è¿™æ ·å…¼å®¹å¤„ç†ï¼š</p>
<pre><code class="language-css">.page {
  height: calc(100vh - 50px);
  height: calc(var(--vh) * 100 - 50px);
}
</code></pre>
<p>æœ‰ä¸€ä¸ª <a href="https://github.com/mvasin/react-div-100vh">react-div-100vh</a> åº“å°±æ˜¯è·å– <code>window.innerHeight</code>ï¼Œç„¶åå°†å…¶å€¼è®¾ç½®ä¸ºå®¹å™¨é«˜åº¦å®ç°çš„ï¼Œç„¶è€Œè¿™ä¹Ÿæ˜¯ä»…å¯å¤„ç† <code>100vh</code> çš„æƒ…å†µã€‚</p>
<p>è‡³äºä½¿ç”¨å“ªä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè§†ä¹å®é™…æƒ…å†µè€Œå®šå§ï¼</p>
<h3>äº”ã€References</h3>
<ul>
<li><a href="https://nicolas-hoizey.com/articles/2015/02/18/viewport-height-is-taller-than-the-visible-part-of-the-document-in-some-mobile-browsers/">Viewport height is taller than the visible part of the document in some mobile browsers</a></li>
<li><a href="https://stackoverflow.com/questions/23223157/how-to-fix-vhviewport-unit-css-in-mobile-safari">How to fix vh(viewport unit) css in mobile Safari?</a></li>
<li><a href="https://github.com/JeffKko/blog/issues/14">è§£æ±º safari mobile ä¸Š css æ•¸å€¼ &quot;vh&quot; çš„å•é¡Œ</a></li>
<li><a href="https://www.bram.us/2020/05/06/100vh-in-safari-on-ios/">100vh in Safari on iOS</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å½±å“å›æµã€é‡ç»˜çš„ CSS å±æ€§æœ‰å“ªäº›ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/168</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/168</guid>
            <pubDate>Sun, 26 Feb 2023 07:44:52 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e065267f89d63bf.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e065267f89d63bf.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç›®å‰ï¼Œæ¯”è¾ƒå¸¸è§çš„æµè§ˆå™¨å†…æ ¸ï¼ˆæ¸²æŸ“å¼•æ“ï¼‰æœ‰ï¼š<a href="https://www.wikiwand.com/zh-hans/WebKit">WebKit</a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Blink">Blink</a> ã€<a href="https://www.wikiwand.com/zh-hans/Gecko">Gecko</a>ã€<a href="https://www.wikiwand.com/zh-hans/Trident_(%E6%8E%92%E7%89%88%E5%BC%95%E6%93%8E)">Trident</a>ã€<a href="https://www.wikiwand.com/zh-hans/EdgeHTML">EdgeHTML</a>ï¼Œæ›´å¤š<a href="https://www.jianshu.com/p/174d7f89702e">è¯·çœ‹</a>ã€‚</p>
<blockquote>
<ul>
<li><strong>WebKit</strong> è¯¾ä»£è¡¨æ˜¯ Safari æµè§ˆå™¨</li>
<li><strong>Blink</strong> è¯¾ä»£è¡¨æ˜¯ Chrome æµè§ˆå™¨ï¼ˆBlink èµ·æºè‡ª WebKit çš„ä¸€ä¸ªåˆ†æ”¯ï¼‰</li>
<li><strong>Gecko</strong> è¯¾ä»£è¡¨æ˜¯ Firefox æµè§ˆå™¨</li>
<li><strong>Trident</strong> è¯¾ä»£è¡¨æ˜¯ IE æµè§ˆå™¨ã€‚2015 å¹´å¾®è½¯æ¨å‡ºçš„ Edge æµè§ˆå™¨å…¶å†…æ ¸æ˜¯ EdgeHTMLã€‚ä»è‰¯ä¹‹åäº 2020 å¹´æ¨å‡ºåŸºäº Chromium çš„ Edge æµè§ˆå™¨ï¼Œä½¿ç”¨ Blink å¼•æ“ã€‚</li>
</ul>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ä¸¤ä¸ªä¸»æµæµè§ˆå™¨å†…æ ¸ WebKitã€Gecko åˆæˆ DOM çš„è¿‡ç¨‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-dd2f0bbc5617944f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WebKit"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-282467dd31324334.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Gecko"></p>
<p>ä¸¤è€…æ•´ä½“æµç¨‹åŸºæœ¬ç›¸ä¼¼ï¼Œåœ¨æœ¯è¯­æ–¹é¢ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚ WebKit ä¸­çš„ <strong>Layout</strong> è¿‡ç¨‹ï¼ŒGecko ç§°ä¸º <strong>Reflow</strong>ã€‚</p>
<blockquote>
<p>æé«˜ç½‘é¡µæ€§èƒ½çš„å…¶ä¸­ä¸€ä¸ªæ–¹å¼å°±æ˜¯ï¼Œå‡å°‘å›æµï¼ˆreflowï¼‰ã€é‡ç»˜ï¼ˆrepaintï¼‰ï¼Œåˆ†åˆ«å¯¹åº” <strong>Layout</strong> å’Œ <strong>Painting</strong> è¿‡ç¨‹ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼ŒReact Hooks ä¸­å¤„ç†å‰¯ä½œç”¨æ—¶ï¼ŒæŸäº›åœºæ™¯ä¸‹åº”é€‰æ‹© <code>useLayoutEffect</code>ï¼Œè€Œä¸æ˜¯ <code>useEffect</code> çš„åŸå› æ­£æ˜¯ä¸ºäº†å‡å°‘å›æµé‡ç»˜çš„è¿‡ç¨‹ã€‚</p>
<p>ã€Œå›æµã€ä¹Ÿæœ‰ç§°ä½œã€Œé‡æ’ã€çš„ã€‚</p>
<h2>ä»€ä¹ˆæ˜¯å¡é¡¿ï¼Ÿ</h2>
<p>åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæ˜¾ç¤ºå™¨çš„åˆ·æ–°ç‡å¤šæ•°ä¸º 60Hzï¼Œå³ä½¿åˆ°ç°åœ¨ä»ç„¶æ˜¯å å¤šæ•°ã€‚</p>
<p>åˆ·æ–°ç‡ï¼ˆRefreshRateï¼‰ï¼Œè¡¨ç¤ºå•ä½æ—¶é—´å†…èƒ½å¤Ÿç»˜åˆ¶æ–°å›¾åƒçš„æ¬¡æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ60Hz çš„åˆ·æ–°ç‡ï¼Œè¡¨ç¤ºæ˜¾ç¤ºå™¨è¦åœ¨ä¸€ç§’å†…åˆ·æ–° 60 æ¬¡å›¾åƒï¼Œæ¢å¥è¯è¯´ï¼Œä¸€æ¬¡å›¾åƒçš„æ›´æ–°è¦åœ¨ <code>16.67ms</code> å†…å®Œæˆã€‚è¿™æ ·æ‰ä¸ä¼šé€ æˆå¡é¡¿ã€‚å¦‚æœè¶…å‡ºè¿™ä¸ªæ—¶é—´ï¼Œåœ¨è§†è§’ä¸Šå°±ä¼šäº§ç”Ÿå¡é¡¿æ„Ÿã€‚</p>
<blockquote>
<p>60Hz çš„åˆ·æ–°ç‡æ˜¯äººç±»ä¸ä¼šæ„Ÿè§‰åˆ°å±å¹•å›¾åƒé—ªçƒçš„æ•°å€¼ï¼Œç”±ç§‘å­¦å®¶éªŒè¯å¾—å‡ºã€‚</p>
</blockquote>
<p>é™„ä¸€ä¸ªæ¥è‡ªç½‘ä¸Šçš„å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a2d41f8b6e3554f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿˜æ˜¯ç”¨ React ä¸¾ä¾‹å§ã€‚æˆ‘ä»¬çŸ¥é“ React 16 èµ·é‡‡ç”¨äº†å…¨æ–°çš„ Fiber æ¶æ„ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å¤§å‹åº”ç”¨å¡é¡¿çš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼ŒJavaScript æ˜¯å•çº¿ç¨‹çš„ã€‚æµè§ˆå™¨ä¼šä¸ºæ¯ä¸ªæ ‡ç­¾ï¼ˆTabï¼‰åˆ†é…ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹ç”± GUI æ¸²æŸ“çº¿ç¨‹ã€JS çº¿ç¨‹ã€å®šæ—¶å™¨çº¿ç¨‹ã€ç½‘ç»œçº¿ç¨‹ã€äº‹ä»¶çº¿ç¨‹å¤šä¸ªçº¿ç¨‹ç»„æˆã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼š<strong>GUI æ¸²æŸ“çº¿ç¨‹ä¸ JS çº¿ç¨‹æ˜¯äº’æ–¥çš„</strong>ã€‚æ¢å¥è¯è¯´ï¼ŒæŸä¸ªæ—¶åˆ»å®ƒåªèƒ½æ‰§è¡Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰å°†æ‰§è¡Œæƒäº¤ç”±å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆ React 15 åœ¨å¤„ç†å¤§å‹åº”ç”¨çš„æ—¶å€™ä¼šå¡é¡¿å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆ React 15 æ¶æ„ï¼Œç”±<strong>åè°ƒå™¨</strong>ï¼ˆReconcilerï¼‰å’Œ<strong>æ¸²æŸ“å™¨</strong>ï¼ˆRenderï¼‰ç»„æˆã€‚è€Œ React 16 åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ–°å¢äº†<strong>è°ƒåº¦å™¨</strong>ï¼ˆSchedulerï¼‰ï¼Œç”¨äºè°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚</p>
<p>åœ¨ React 15 çš„ Reconciler ä¸­ï¼Œç»„ä»¶çš„æŒ‚è½½ï¼ˆMountingï¼‰ã€æ›´æ–°ï¼ˆUpdatingï¼‰ä¼šå¯¹åº”è°ƒç”¨ <code>mountComponent</code>ã€<code>updateComponent</code> æ–¹æ³•ï¼Œå®ƒä»¬å†…éƒ¨ä¼šæ‰§è¡Œé€’å½’æ“ä½œï¼Œä»¥æ›´æ–°å­ç»„ä»¶ã€‚**ä½†æ˜¯é€’å½’æ‰§è¡Œçš„ç¼ºç‚¹æ˜¯ã€Œæ— æ³•ä¸­æ–­ã€ã€‚**å‡è®¾ JS çº¿ç¨‹æ‰§è¡Œé€’å½’è€—æ—¶è¶…è¿‡äº† <code>16.67ms</code>ï¼Œç”±äºäº’æ–¥æœŸé—´ GUI çº¿ç¨‹å¹¶ä¸èƒ½æ‰§è¡Œä»»ä½•çš„æ“ä½œï¼Œç­‰é€’å½’å®Œå¹¶ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOM ä¹‹åï¼Œè§¦å‘ DOM ç­‰æ›´æ–°ï¼Œæ­¤æ—¶ç”± GUI çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½åŒ…æ‹¬å›æµã€é‡ç»˜çš„è¿‡ç¨‹ï¼Œç„¶åæ‰å®Œæˆä¸€æ¬¡é¡µé¢çš„æ›´æ–°ã€‚ç”±äºæ— æ³•æ»¡è¶³åˆ·æ–°ç‡çš„è¦æ±‚ï¼Œå°±ä¼šäº§ç”Ÿå¡é¡¿æ„Ÿã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œè§£å†³å¡é¡¿çš„æ€è·¯å°±æ˜¯ï¼šåœ¨æ¯ä¸€å¸§çš„æ—¶é—´å†…ï¼Œé¢„ç•™ä¸€äº›æ—¶é—´ç»™ JS çº¿ç¨‹ï¼Œå½“é¢„ç•™çš„æ—¶é—´ä¸å¤Ÿç”¨æ—¶ï¼ŒReact ä¸­æ–­å½“å‰ä»»åŠ¡ï¼Œå°†çº¿ç¨‹æ§åˆ¶æƒäº¤æ¢ç»™æµè§ˆå™¨ï¼Œä½¿å…¶æœ‰æ—¶é—´æ¸²æŸ“é¡µé¢ï¼Œç­‰ä¸‹ä¸€å¸§åˆ°æ¥çš„æ—¶å€™ï¼Œç»§ç»­è¢«ä¸­æ–­çš„å·¥ä½œã€‚</p>
</blockquote>
<p>åœ¨ React 16 æ–°å¢çš„ Scheduler å¯ä»¥ä½¿å¾—æµè§ˆå™¨æœ‰å‰©ä½™æ—¶é—´çš„æ—¶å€™é€šçŸ¥ Reactï¼Œè€Œä¸”æä¾›äº†å¤šç§è°ƒåº¦ä¼˜å…ˆçº§ï¼Œä½¿å¾—æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼˜å…ˆè¿›å…¥ Reconciler é˜¶æ®µã€‚ è€Œ Reconciler åˆ™æ˜¯åˆ©ç”¨äº† Fiber è¿™ç§æ¶æ„å®ç°äº†**ã€Œå¯ä¸­æ–­çš„å¼‚æ­¥æ›´æ–°ã€**ï¼ˆè¯·æ³¨æ„ï¼Œè¿™é‡Œçš„å¼‚æ­¥å¹¶ä¸æ˜¯ç”± <code>setTimeout</code> å®ç°çš„ï¼Œç”±äºç²¾åº¦é—®é¢˜ï¼Œ<code>setTimeout</code> å®é™…ä¸Šæœ€ä½å»¶è¿Ÿæ—¶é—´æ˜¯ <code>4ms</code>ï¼Œåœ¨è¿™å¯¸åœŸå¯¸é‡‘çš„ä¸€å¸§æ—¶é—´æ‰ <code>16.67ms</code>ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼‰ã€‚</p>
<p>å› æ­¤ï¼ŒReact å°±æ˜¯é‡‡ç”¨äº†è¿™ç§æ€è·¯æ¥è§£å†³å¤§å‹åº”ç”¨å¡é¡¿é—®é¢˜çš„ã€‚</p>
<p>é¢˜å¤–è¯æ‰¯å®Œäº†ï¼Œå›åˆ°æœ¬æ–‡çš„ä¸»é¢˜...</p>
<h2>å½±å“é¡µé¢æ¸²æŸ“æ€§èƒ½çš„æœ‰ä»€ä¹ˆï¼Ÿ</h2>
<p>å†é™„ä¸Šä¸€å¼ æºè‡ªç½‘ä¸Šçš„å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e0bb9a5bc1efbf44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li><strong>JavaScript</strong> - ä½¿ç”¨ JavaScript è„šæœ¬æ¥è§¦å‘ DOM çš„æ›´æ–°ã€‚</li>
<li><strong>Style</strong> - åŒ¹é…å„ç§é€‰æ‹©å™¨ï¼Œå¹¶è®¡ç®—å‡ºå“ªäº›å…ƒç´ åº”ç”¨å“ªäº› CSS æ ·å¼çš„è¿‡ç¨‹ã€‚</li>
<li><strong>Layout</strong> - å‰é¢çŸ¥é“ä¸€ä¸ªå…ƒç´ åº”ç”¨å“ªäº›è§„åˆ™ä¹‹åï¼Œæµè§ˆå™¨å¼€å§‹è®¡ç®—å®ƒè¦å ç”¨çš„ç©ºé—´å¤§å°ä»¥åŠåœ¨å±å¹•çš„ä½ç½®ã€‚ä¸€ä¸ªå…ƒç´ åœ¨ç©ºé—´ä¸Šçš„å˜åŒ–ï¼Œä¼šåŒæ—¶å½±å“å…¶ä»–å…ƒç´ çš„é‡æ’ã€‚</li>
<li><strong>Paint</strong> - ç»˜åˆ¶æ˜¯å¡«å……çš„åƒç´ çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚æ–‡æœ¬ã€é¢œè‰²ã€å›¾åƒã€è¾¹æ¡†å’Œé˜´å½±ç­‰ã€‚</li>
<li><strong>Composite</strong> - åˆæˆè¿‡ç¨‹å¤„ç†å…ƒç´ ç»˜åˆ¶åˆ°å“ªä¸€å±‚ï¼Œå¯èƒ½æ˜¯åœ¨æŸä¸ªå…ƒç´ çš„ä¸Šå±‚æˆ–ä¸‹å±‚ã€‚ä¸<a href="https://www.jianshu.com/p/5573da95186d">å±‚å ä¸Šä¸‹æ–‡</a>æœ‰å…³ã€‚</li>
</ul>
<blockquote>
<ol>
<li>å¦‚æœä¿®æ”¹äº†æŸä¸ªå…ƒç´ çš„ Layout å±æ€§ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ£€æŸ¥å…¶ä»–æ‰€æœ‰å…ƒç´ ï¼Œç„¶åâ€œè‡ªåŠ¨é‡æ’â€ï¼Œä»»ä½•å—å½±å“çš„éƒ¨åˆ†éƒ½éœ€è¦é‡æ–°ç»˜åˆ¶ï¼Œç„¶åæ‰è¿›è¡Œåˆæˆã€‚</li>
<li>å¦‚æœä»…ä¿®æ”¹äº†ã€Œpaint onlyã€å±æ€§ï¼Œæ¯”å¦‚èƒŒæ™¯å›¾ç‰‡ï¼Œæ–‡å­—é¢œè‰²ã€èƒŒæ™¯ç­‰ï¼Œå®ƒä¸ä¼šå½±å“é¡µé¢å¸ƒå±€ï¼Œæ‰€ä»¥ä¼šè·³è¿‡ Layout é˜¶æ®µï¼Œç„¶åæ‰§è¡Œé‡ç»˜ã€‚</li>
<li>å¦‚æœä¿®æ”¹äº†ä¸€ä¸ªæ—¢ä¸å½±å“ Layoutï¼Œä¹Ÿæ— éœ€ Paint çš„å±æ€§ï¼Œé‚£ä¹ˆæµè§ˆå™¨åªæ‰§è¡Œ Composite åˆæˆè¿‡ç¨‹ã€‚è¿™ä¸ªå¼€é”€æ˜¯æœ€å°çš„ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count">æ–‡ç« </a>ã€‚</li>
</ol>
</blockquote>
<h2>CSS Triggers</h2>
<p>å“ªäº› CSS å±æ€§å½±å“ Layoutï¼Œå“ªäº›å½±å“ Paint å‘¢ï¼Ÿ</p>
<p>å¯ä»¥çœ‹è¿™ä¸ªç½‘ç«™ <a href="https://csstriggers.com">CSS Triggers</a>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-068c1e7433ce166c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶ä¸­ <strong>Change from default</strong> è¡¨ç¤ºä»æœªè®¾ç½®ï¼ˆå³ CSS é»˜è®¤å€¼ï¼‰åˆ°è®¾ç½®ä¸ºå…¶ä»–å€¼ï¼Œ<strong>Subsequent updates</strong> è¡¨ç¤ºå±æ€§ä¿®æ”¹ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://developers.google.com/web/fundamentals/performance/rendering">Rendering Performance </a></li>
<li><a href="https://csstriggers.com">CSS Triggers</a></li>
<li><a href="https://www.jianshu.com/p/174d7f89702e">æµè§ˆå™¨å†…æ ¸åŠæ¸²æŸ“è¿‡ç¨‹æ‚è°ˆ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åŸç”Ÿ JavaScript è¯»å†™ CSSæ ·å¼çš„æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/167</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/167</guid>
            <pubDate>Sun, 26 Feb 2023 07:40:22 GMT</pubDate>
            <description><![CDATA[<p>å¥½ä¹…æ²¡ç”¨åŸç”Ÿ JS å†™ CSS æ ·å¼ï¼Œå·®ç‚¹å¿˜äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼</p>
<ol>
<li>é€šè¿‡ DOM èŠ‚ç‚¹å¯¹è±¡çš„styleå¯¹è±¡</li>
</ol>
<pre><code class="language-js">var element = document.getElementById('id')
element.]]></description>
            <content:encoded><![CDATA[<p>å¥½ä¹…æ²¡ç”¨åŸç”Ÿ JS å†™ CSS æ ·å¼ï¼Œå·®ç‚¹å¿˜äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼</p>
<ol>
<li>é€šè¿‡ DOM èŠ‚ç‚¹å¯¹è±¡çš„styleå¯¹è±¡</li>
</ol>
<pre><code class="language-js">var element = document.getElementById('id')
element.style.color = 'red'
</code></pre>
<ol start="2">
<li>é€šè¿‡ Element å¯¹è±¡çš„ setAttribute()ã€getAttribute()ã€removeAttribute() æ–¹æ³•</li>
</ol>
<pre><code class="language-js">var element = document.getElementById('id')
element.setAttribute('color', 'red')
</code></pre>
<ol start="3">
<li>é€šè¿‡ style å¯¹è±¡çš„ cssText å±æ€§ã€setProperty()ã€removeProperty() æ–¹æ³•</li>
</ol>
<pre><code class="language-js">var element = document.getElementById('id')
element.style.cssText = 'color: red'
element.style.setProperty('color', 'red', 'important')
element.style.removeProperty('color')
element.style.cssText = ''  // å¿«é€Ÿæ¸…ç©ºè¯¥è§„åˆ™çš„æ‰€æœ‰å£°æ˜
</code></pre>
<ol start="4">
<li>ç›´æ¥æ·»åŠ æ ·å¼è¡¨</li>
</ol>
<p>1ï¼‰åˆ›å»º <code>style&gt;</code> æ ‡ç­¾ï¼Œå†…è”æ ·å¼</p>
<pre><code class="language-js">var style = document.createElement('style')
style.innerHTML = 'body{color: red}'
document.head.appendChild(style)
</code></pre>
<p>2ï¼‰æ·»åŠ å¤–éƒ¨æ ·å¼è¡¨</p>
<pre><code class="language-js">var link = document.createElement('link')
link.setAttribute('rel', 'stylesheet')
link.setAttribute('type', 'text/css')
link.setAttribute('href', 'reset-min.css')
document.head.appendChild(link)
</code></pre>
<ol start="5">
<li>è¿˜æœ‰å¾ˆå¤šâ€¦</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» CSS | å±‚å ä¸Šä¸‹æ–‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/166</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/166</guid>
            <pubDate>Sun, 26 Feb 2023 07:21:48 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8f52f8ba5cbcb1e5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8f52f8ba5cbcb1e5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€æ¦‚å¿µ</h2>
<p>åœ¨ HTML é¡µé¢ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ <code>margin</code>ã€<code>float</code>ã€<code>offset</code> ç­‰ CSS å±æ€§æ§åˆ¶å…ƒç´ åœ¨ X è½´å’Œ Y è½´é¡µé¢ä¸­çš„ä½ç½®ï¼Œå¦å¤–ä¼šä½¿ç”¨ <code>z-index</code> å’Œ <code>transform</code> æ¥æ§åˆ¶å…ƒç´ åœ¨ Z è½´çš„æ’åˆ—é¡ºåºã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ HTML é¡µé¢å…¶å®æ˜¯ä¸€ä¸ª<strong>ä¸‰ç»´</strong>çš„ç»“æ„ã€‚</p>
</blockquote>
<p>äº†è§£ä»¥ä¸‹è¿™å‡ ä¸ªè¯ï¼š</p>
<ul>
<li><strong>å±‚å ä¸Šä¸‹æ–‡</strong>ï¼ˆStacking Contextï¼‰</li>
</ul>
<p>å±‚å ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µã€‚å½“ä¸€ä¸ªå…ƒç´ æ‹¥æœ‰äº†ä¸€ä¸ªâ€œä¸‰ç»´â€çš„è¡¨ç°ï¼Œå³åœ¨ Z è½´ä¸Šæœ‰ä¸€å®šçš„é¡ºåºï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¯¥å…ƒç´ æœ‰ä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ã€‚</p>
<ul>
<li><strong>å±‚å ç­‰çº§</strong>ï¼ˆStacking Levelï¼‰</li>
</ul>
<p>æœ‰äº†å±‚å ä¸Šä¸‹æ–‡ä¹‹åï¼Œéœ€è¦ä¸€ä¸ªå«åšå±‚å ç­‰çº§ï¼ˆå±‚å æ°´å¹³ï¼‰çš„å®¶ä¼™æ¥å†³å®šåŒä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ä¸­å…ƒç´ åœ¨ Z è½´ä¸Šçš„æ˜¾ç¤ºé¡ºåºã€‚</p>
<ul>
<li><strong>å±‚å é¡ºåº</strong>ï¼ˆStacking Orderï¼‰</li>
</ul>
<p>å±‚å é¡ºåºæ˜¯ä¸€ç§ç”¨äºæè¿°å±‚å ç­‰çº§çš„ç‰¹å®šè§„åˆ™ã€‚</p>
<p><strong>å¦‚ä½•åŒºåˆ†ï¼Ÿ</strong></p>
<p>å±‚å ä¸Šä¸‹æ–‡å’Œå±‚å ç­‰çº§æ˜¯æ¦‚å¿µï¼Œè€Œå±‚å é¡ºåºæ˜¯è§„åˆ™ã€‚é€šä¿—åœ°è®²ï¼Œå‰ä¸¤è€…å°±åƒæ˜¯å…¬å¸å’Œé¢†å¯¼ï¼Œè´Ÿè´£ç”»é¥¼å’Œåˆ¶å®šè®¡åˆ’ï¼Œè€Œåè€…åˆ™æ˜¯æ‰“å·¥äººï¼Œè´Ÿè´£å…·ä½“å®æ–½ï¼ˆå°±æ˜¯æ¬ç –ï¼‰ã€‚</p>
<h2>äºŒã€é‡ç‚¹</h2>
<h4>æœ¬æ–‡æœ¯è¯­çº¦å®š</h4>
<p>æœ¬æ–‡ä¸­æ‰€æåˆ°çš„â€œå±‚å å…ƒç´ â€å’Œâ€œå®šä½å…ƒç´ â€å‡æŒ‰ä»¥ä¸‹æè¿°è¿›è¡Œçº¦å®šï¼Œæœ‰ç‰¹æ®Šè¯´æ˜é™¤å¤–ã€‚</p>
<ul>
<li><strong>å±‚å å…ƒç´ </strong>ï¼šæŒ‡å«æœ‰å±‚å ä¸Šä¸‹æ–‡çš„å…ƒç´ ï¼ˆä¸»è¦ç”¨äºåŒºåˆ«ä¸å«å±‚å ä¸Šä¸‹æ–‡çš„æ™®é€šå…ƒç´ ï¼‰ã€‚</li>
<li><strong>å®šä½å…ƒç´ </strong>ï¼šæŒ‡å«æœ‰ <code>position</code> å±æ€§ï¼Œä¸”å…¶å€¼ä¸ä¸º <code>static</code> çš„å…ƒç´ ã€‚</li>
</ul>
<h4>æ³¨æ„ç‚¹</h4>
<ul>
<li>æ™®é€šå…ƒç´ çš„å±‚å ç­‰çº§ä¼˜å…ˆç”±å±‚å ä¸Šä¸‹æ–‡å†³å®šã€‚</li>
<li>å±‚å é¡ºåºçš„æ¯”è¾ƒï¼Œåªæœ‰åœ¨åŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œå¯¹æ¯”æ‰æœ‰æ„ä¹‰ã€‚</li>
<li>æ‰€æœ‰å…ƒç´ ï¼ˆæ™®é€šå…ƒç´ ã€å±‚å å…ƒç´ ï¼‰éƒ½å­˜åœ¨å±‚å ç­‰çº§ã€‚è¯·ä¸è¦å°†å±‚å ç­‰çº§å’Œ CSS ä¸­çš„ <code>z-index</code> å±æ€§æ··ä¸ºä¸€è°ˆï¼Œå°½ç®¡ <code>z-index</code> åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå½±å“åˆ°å±‚å ç­‰çº§ã€‚</li>
</ul>
<h4>å±‚å ä¸Šä¸‹æ–‡çš„ç‰¹æ€§</h4>
<p>å±‚å å…ƒç´ æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>å±‚å å…ƒç´ çš„å±‚å ç­‰çº§è¦æ¯”æ™®é€šå…ƒç´ é«˜ã€‚</li>
<li>å±‚å ä¸Šä¸‹æ–‡å¯ä»¥é˜»æ–­å…ƒç´ çš„æ··åˆæ¨¡å¼ã€‚</li>
<li>å±‚å ä¸Šä¸‹æ–‡å¯åµŒå¥—ï¼Œå†…éƒ¨å±‚å ä¸Šä¸‹æ–‡åŠå…¶æ‰€æœ‰å­å…ƒç´ å‡å—é™äºå¤–éƒ¨çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</li>
<li>æ¯ä¸ªå±‚å ä¸Šä¸‹æ–‡å’Œå…„å¼Ÿå…ƒç´ ç‹¬ç«‹ï¼Œä¹Ÿå°±æ˜¯å½“è¿›è¡Œå±‚å å˜åŒ–æˆ–æ¸²æŸ“çš„æ—¶å€™ï¼Œåªéœ€è¦è€ƒè™‘åä»£å…ƒç´ å³å¯ã€‚</li>
<li>æ¯ä¸ªå±‚å ä¸Šä¸‹æ–‡æ˜¯è‡ªæˆä½“ç³»çš„ï¼Œå½“å…ƒç´ å‘ç”Ÿå±‚å çš„æ—¶å€™ï¼Œæ•´ä¸ªå…ƒç´ éƒ½è¢«è®¤ä¸ºæ˜¯åœ¨çˆ¶å±‚å ä¸Šä¸‹æ–‡çš„å±‚å é¡ºåºä¸­ã€‚</li>
</ul>
<h4>åˆ›å»ºå±‚å ä¸Šä¸‹æ–‡</h4>
<p>ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œéƒ½ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼š</p>
<ul>
<li>
<p>æ ¹å±‚å ä¸Šä¸‹æ–‡
é¡µé¢çš„æ ¹å…ƒç´  <code>&lt;html&gt;</code> è‡ªå¸¦ä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç»å¯¹å®šä½å…ƒç´ é€šè¿‡ <code>top/right/bottom/left</code> æ¥å®šä½æ—¶ï¼Œè‹¥æ²¡æœ‰å…¶ä»–å®šä½å…ƒç´ é™åˆ¶ï¼Œä¼šç›¸å¯¹æµè§ˆå™¨çª—å£å®šä½ã€‚å…¶ä¸­ç¼˜ç”±ï¼Œå°±æ˜¯å› ä¸ºæœ‰æ ¹å±‚å ä¸Šä¸‹æ–‡çš„åŸå› ã€‚</p>
</li>
<li>
<p>å®šä½å…ƒç´ å±‚å ä¸Šä¸‹æ–‡ï¼ˆä¼ ç»Ÿï¼‰
å½“å…ƒç´ çš„ <code>position</code> ä¸ä¸º <code>static</code>ï¼Œ<code>z-index</code> ä¸ä¸º <code>auto</code> æ—¶ï¼Œè¯¥å…ƒç´ å°±ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼ˆä½†æœ‰äº›ç‰¹ä¾‹ï¼Œä¸‹æ–‡ä¼šæåˆ°ï¼‰ã€‚</p>
</li>
<li>
<p>CSS3å±‚å ä¸Šä¸‹æ–‡ï¼ˆæ–°æ—¶ä»£ï¼‰
åœ¨ CSS3 ä¸­æ–°å¢äº†å¾ˆå¤šæ–°å±æ€§ï¼Œæœ‰ä¸€äº›ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚</p>
<ol>
<li><code>z-index</code> å€¼ä¸ä¸º <code>auto</code> çš„ <code>flex</code> é¡¹ï¼ˆçˆ¶å…ƒç´  <code>display:flex|inline-flex</code>ï¼‰ï¼›</li>
<li>å…ƒç´ çš„ <code>opacity</code> å€¼ä¸ä¸º <code>1</code>ï¼›</li>
<li>å…ƒç´ çš„ <code>transform</code> å€¼ä¸ä¸º <code>none</code>ï¼›</li>
<li>å…ƒç´  <code>mix-blend-mode</code> å€¼ä¸ä¸º <code>normal</code>ï¼›</li>
<li>å…ƒç´ çš„ <code>filter</code> å€¼ä¸ä¸º <code>none</code>ï¼›</li>
<li>å…ƒç´ çš„ <code>isolation</code> å€¼ä¸º <code>isolate</code>ï¼›</li>
<li><code>will-change</code> æŒ‡å®šçš„å±æ€§å€¼ä¸ºä¸Šé¢ä»»æ„ä¸€ä¸ªï¼›</li>
<li>å…ƒç´ çš„ <code>-webkit-overflow-scrolling</code> è®¾ä¸º <code>touch</code>ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<p>ç‰¹ä¾‹è¯´æ˜</p>
<ol>
<li>åœ¨è¿œå¤ç¥å…½ IE5/6/7 æµè§ˆå™¨ä¸‹ï¼Œ<code>z-index: auto</code> ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚è‡³äºè¿™æ˜¯ Bug è¿˜æ˜¯å¾®è½¯æ•…æ„ä¸ºä¹‹ï¼Œå°±ä¸å»è€ƒç©¶äº†ï¼Œåæ­£ä¹Ÿæ¥è§¦ä¸åˆ°è¿™äº›è¿œå¤ç¥å…½äº†ã€‚<strong>åœ¨ç°ä»£æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ IE8 åŠä»¥ä¸Šï¼‰ä¸­ï¼Œ<code>z-index: auto</code> éƒ½ä¸ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡</strong>ã€‚</li>
<li>åœ¨è¿‡å» <code>position: relative | absolute | fixed</code> éƒ½éœ€è¦é…åˆ <code>z-index</code>ï¼ˆæ•°å€¼ï¼‰æ‰ä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èµ·ï¼ŒChromeã€Firefoxã€Safariã€Edge ç­‰æµè§ˆå™¨ï¼Œ<code>position: fixed | sticky</code> å…ƒç´ å¤©ç„¶å±‚å ä¸Šä¸‹æ–‡ï¼Œæ— éœ€ <code>z-index</code> ä¸ºæ•°å€¼ã€‚ï¼ˆ2022.01 äº²æµ‹ï¼‰</li>
</ol>
</blockquote>
<h4>å±‚å ä¸Šä¸‹æ–‡ä¸å±‚å é¡ºåº</h4>
<p>ä¸€æ—¦æ™®é€šå…ƒç´ å…·æœ‰äº†å±‚å ä¸Šä¸‹æ–‡ï¼Œå…¶å±‚å é¡ºåºå°±ä¼šå˜é«˜ã€‚</p>
<p>åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<blockquote>
<ol>
<li>å¦‚æœå±‚å å…ƒç´ ä¸ä¾èµ– <code>z-index</code>ï¼Œé‚£ä¹ˆå…¶å±‚å é¡ºåºçœ‹æˆä¸ <code>z-index: auto</code> ä¸€è‡´çš„ <code>z-index: 0</code> çº§åˆ«ã€‚</li>
<li>å¦‚æœå±‚å å…ƒç´ ä¾èµ– <code>z-index</code>ï¼Œé‚£ä¹ˆå…¶å±‚å é¡ºåºç”± <code>z-index</code> å†³å®šã€‚</li>
</ol>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396172119.png" alt=""></p>
<p>*å¼ é‘«æ—­å¤§ä½¬åŸå›¾å‡ºå¤„ï¼Œè¯·çœ‹<a href="https://www.zhangxinxu.com/wordpress/2016/01/understand-css-stacking-context-order-z-index/">è¿™é‡Œ</a>ã€‚</p>
<p><strong>Qï¼šä¸ºä»€ä¹ˆå®šä½å…ƒç´ ä¼šå±‚å åœ¨æ™®é€šå…ƒç´ çš„ä¸Šé¢ï¼Ÿ</strong></p>
<p>å½“ä¸€ä¸ªå…ƒç´ æˆä¸ºäº†å®šä½å…ƒç´ ï¼Œ<code>z-index</code> ä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œå–å…¶é»˜è®¤å€¼ <code>auto</code>ã€‚æ ¹æ®å±‚å é¡ºåºå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>z-index: auto</code> çš„å±‚å é¡ºåºæ¯” <code>block</code>ã€<code>float</code>ã€<code>inline/inline-block</code> éƒ½è¦é«˜ã€‚</p>
<h4>å±‚å å‡†åˆ™</h4>
<p>å½“å…ƒç´ å‘ç”Ÿå±‚å æ—¶ï¼Œå…¶è¦†ç›–å…³ç³»éµå¾ªä»¥ä¸‹ä¸¤ä¸ªå‡†åˆ™ï¼š</p>
<blockquote>
<ol>
<li><strong>è°å¤§è°ä¸Š</strong>ï¼šåœ¨åŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­ï¼Œå±‚å ç­‰çº§è¾ƒå¤§çš„ä¼šè¦†ç›–è¾ƒå°çš„ã€‚</li>
<li><strong>åæ¥å±…ä¸Š</strong>ï¼šåœ¨åŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­ï¼Œè‹¥å±‚å ç­‰çº§ï¼ˆé¡ºåºï¼‰ç›¸åŒæ—¶ï¼Œåœ¨ DOM æ–‡æ¡£æµä¸­å¤„äºåé¢çš„å…ƒç´ ä¼šè¦†ç›–å‰é¢çš„å…ƒç´ ã€‚</li>
</ol>
</blockquote>
<p>è¯·æ³¨æ„ï¼Œä¸Šé¢ä¸¤æ¡å‡†åˆ™çš„å‰æéƒ½æ˜¯â€œå¤„äºåŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­â€ï¼Œé‚£æ˜¯å› ä¸ºåœ¨ä¸åŒå±‚å ä¸Šä¸‹æ–‡çš„æ¯”è¾ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸€äº›å¸¸è§çš„å±‚å ä¸Šä¸‹æ–‡ã€å±‚å é¡ºåºçš„æ¡ˆä¾‹ï¼Œå¸®åŠ©è¿›ä¸€æ­¥ç†è§£ã€‚</p>
<h2>ä¸‰ã€position ä¸ z-index</h2>
<p>å®ƒä»¬å–å€¼å¦‚ä¸‹ï¼š</p>
<pre><code>position: static(default) | relative | absolute | fixed | sticky
</code></pre>
<pre><code>z-index: auto(default) | &lt;integer&gt; | inherit
</code></pre>
<p><strong>å½“ <code>position</code> ä¸ä¸º <code>static</code> æ—¶ï¼Œ<code>z-index</code> æ‰ä¼šç”Ÿæ•ˆ</strong>ã€‚</p>
<p>å…¶ä¸­ <code>z-index</code> å±æ€§å€¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auto</td>
<td>å°†å±‚å æ°´å¹³è®¾ä¸º <code>0</code>ï¼Œä¸”<strong>ä¸ä¼š</strong>åˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</td>
</tr>
<tr>
<td>inherit</td>
<td>å°†å±‚å æ°´å¹³è®¾ä¸ºä¸çˆ¶å…ƒç´ ç›¸åŒï¼Œä¸”<strong>ä¸ä¼š</strong>åˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</td>
</tr>
<tr>
<td><integer></td>
<td>å°†å±‚å æ°´å¹³è®¾ä¸ºå¯¹åº”ï¼ˆæ­£è´Ÿï¼‰æ•´æ•°ï¼Œå¹¶<strong>ä¼š</strong>åˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</td>
</tr>
</tbody>
</table>
<p><s>*å…¶å®è¿˜æœ‰ä¸€äº›å…¨å±€å€¼ï¼ˆå¦‚ <code>initial</code>ã€<code>unset</code>ï¼‰ï¼Œä½†ä¸é‡è¦ï¼Œæ•…å¿½ç•¥ã€‚</s></p>
<p>è¯·æ³¨æ„ï¼Œåœ¨ CSS3 é‡Œå½“çˆ¶å…ƒç´ è®¾ä¸º <code>display: flex | inline-flex</code>ï¼Œå­å…ƒç´ ä½¿ç”¨ <code>z-index</code> æ—¶ï¼Œä¹Ÿä¼šä½¿å¾—<strong>å­å…ƒç´ </strong>åˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ï¼ˆè¯·æ³¨æ„ï¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡æ˜¯å­å…ƒç´ ï¼Œè€Œä¸æ˜¯çˆ¶å…ƒç´ å“¦ï¼‰ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œ<code>z-index</code> ä¸å†æ˜¯å®šä½å…ƒç´ ç‹¬äº«ï¼Œå®ƒè¿˜å¯ä»¥ä¸ <code>flex</code> æåœ¨ä¸€èµ·åšç‚¹ä»€ä¹ˆã€‚</p>
<p><strong>åŸºç¡€ç¤ºä¾‹ä¸€</strong> ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/dyVqWbm">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396228291.png" alt=""></p>
<p><strong>åŸºç¡€ç¤ºä¾‹äºŒ</strong> ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/OJxomvJ">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396267240.png" alt=""></p>
<p>ä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹éƒ½å¾ˆåŸºç¡€ï¼Œä¸å¤šè¯´äº†...</p>
<h4>å°ç»“</h4>
<blockquote>
<ul>
<li>è‹¥ <code>position</code> ä¸º <code>static</code> æ—¶ï¼Œ<code>top</code>ã€<code>right</code>ã€<code>bottom</code>ã€<code>left</code> å’Œ <code>z-index</code> å±æ€§å‡æ— æ•ˆã€‚</li>
<li>å½“ <code>z-index</code> ç”Ÿæ•ˆæ—¶ï¼Œå±‚å é¡ºåºè¡¨ç°ä¸ºï¼š<code>-integer &lt; auto/0 &lt; +integer</code>ã€‚</li>
<li>ä»…<strong>å±‚å é¡ºåº</strong>è€Œè¨€ï¼Œ<code>z-index: auto</code> å’Œ <code>z-index: 0</code> è¡¨ç°æ˜¯ä¸€è‡´ï¼Œéƒ½æ˜¯ <code>0</code> çº§åˆ«ã€‚ä½†ä¸¤è€…åœ¨å±‚å ä¸Šä¸‹æ–‡é¢†åŸŸæœ‰ç€æ ¹æœ¬æ€§çš„å·®å¼‚ï¼Œå‰è€…ä¸ä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ï¼Œè€Œåè€…ä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</li>
<li>å³ä½¿ä¸æ˜¾å¼è®¾ç½® <code>z-index</code>ï¼Œå®šä½å…ƒç´ çš„å±‚å é¡ºåºä¹Ÿä¼šæ¯”æ™®é€šå…ƒç´ é«˜ã€‚</li>
</ul>
</blockquote>
<h4>éªŒè¯ z-index: auto å’Œ z-index: 0 çš„å±‚å é¡ºåºæ˜¯ç›¸åŒçš„</h4>
<p>ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/poWOwRa">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396325935.png" alt=""></p>
<p>ä»ç»“æœä¸Šçœ‹ï¼Œå¯ä»¥çŸ¥é“ï¼š</p>
<blockquote>
<ul>
<li>å±‚å é¡ºåº <code>z-index: -1 &lt; z-index: auto | z-index: 0 &lt; z-index: 1</code>ï¼Œä¸” <code>z-index: auto</code> å’Œ <code>z-index: 0</code> å±‚å é¡ºåºå‡ä¸º <code>0</code> çº§åˆ«ã€‚</li>
<li>å½“ <code>z-index: auto</code> å’Œ <code>z-index: 0</code> çš„å®šä½å…ƒç´ åŒæ—¶å­˜åœ¨ï¼Œå‘ç”Ÿå±‚å æ—¶ï¼Œåœ¨ DOM æµä¸­å¤„äºåé¢çš„å…ƒç´ ä¼šè¦†ç›–å‰é¢çš„å…ƒç´ ï¼ˆåŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>è¯·è®°ä½ï¼šå¤„äºåŒä¸€å±‚å ä¸Šä¸‹æ–‡ä¸­ï¼Œéµå¾ªè°å¤§è°ä¸Šã€åæ¥å±…ä¸Šçš„å‡†åˆ™ã€‚</p>
<h4>éªŒè¯ z-index: auto ä¸ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡</h4>
<p>ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/LYzMpRr">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396360906.png" alt=""></p>
<p>å›¾ä¸­ç¤ºä¾‹çš„åŒºåˆ«åœ¨äº <code>inner</code> ç›’å­å¤–å±‚çš„ <code>outer</code> ç›’å­ï¼Œä¸€ä¸ªè®¾ä¸º <code>z-index: auto</code>ï¼Œå¦ä¸€ä¸ªè®¾ä¸º <code>z-index: 0</code>ã€‚</p>
<p><strong>å‡è®¾ <code>z-index: auto</code> ä¼šä½¿å¾—å…ƒç´ æœ¬èº«åˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡</strong>ï¼Œé‚£ä¹ˆ <code>inner1</code> å’Œ <code>inner2</code> å¯¹åº”çš„å‚ç…§ç‰©åˆ†åˆ«æ˜¯ <code>outer1</code> å’Œ <code>outer2</code>ï¼Œæ­¤æ—¶ <code>inner1</code> ä¸­çš„ <code>z-index</code> å€¼ï¼Œå…¶å®æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ— è®ºå®ƒçš„å€¼æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€è¿˜æ˜¯ <code>0</code> æˆ– <code>auto</code>ï¼Œå®ƒæ€»ä¼šæ˜¾ç¤ºåœ¨ <code>outer1</code> ä¸Šé¢ï¼ˆ<code>inner2</code> åŒç†ï¼‰ã€‚åŒæ—¶ï¼Œç”±äº <code>outer1</code> å’Œ <code>outer2</code> çš„å±‚å é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œ<code>outer2</code> åœ¨ DOM æµåé¢ï¼Œå±äºâ€œåæ¥å±…ä¸Šâ€ï¼Œå› æ­¤ <code>outer2</code> ä¼šè¦†ç›– <code>outer1</code>ã€‚</p>
<p>å€˜è‹¥å‡è®¾æˆç«‹ï¼Œè“è‰²å—åº”è¦†ç›–åœ¨ç»¿è‰²å—ä¸Šé¢ï¼ˆæ•ˆæœåº”å¦‚ç¤ºä¾‹äºŒç›¸åŒï¼‰ï¼Œå¯äº‹å®å¹¶éå¦‚æ­¤ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š<code>z-index: auto</code> å¹¶ä¸ä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚</p>
<p>ç»™ä½ ä»¬çœ‹çœ‹è¿œå¤ç¥å…½ IE5/6/7 æµè§ˆå™¨ä¸‹ï¼Œ<code>z-index: auto</code> åˆ›å»ºå±‚å ä¸Šä¸‹æ–‡çš„æ•ˆæœã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396398744.png" alt="Internet Explorer 7"></p>
<blockquote>
<p>å› æ­¤ï¼Œè¾ƒä¸ºä¸¥è°¨çš„è¯´æ³•æ˜¯ï¼šåœ¨<strong>ç°ä»£æµè§ˆå™¨</strong>ï¼ˆåŒ…æ‹¬ IE8 åŠä»¥ä¸Šæµè§ˆå™¨ï¼‰ä¸­ï¼Œ<code>z-index: auto</code> ä¸ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<h4>å…³äº z-index è´Ÿå€¼æ—¶è€Œæœ‰æ•ˆï¼Œæ—¶è€Œæ— æ•ˆçš„é—®é¢˜</h4>
<p>ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/dyVwQmg">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396437410.png" alt=""></p>
<p>ç©¶å…¶åŸå› ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ã€‚<strong>æ¯”è¾ƒå±‚å é¡ºåºæ—¶ï¼Œåº”åœ¨åŒä¸€å±‚å ä¸Šæ–‡ä¸­è¿›è¡Œå¯¹æ¯”ï¼Œå¦åˆ™æ˜¯æ— æ„ä¹‰çš„</strong>ã€‚</p>
<p>åœ¨ç¤ºä¾‹ä¸€ï¼Œ<code>red</code> ç›’å­å’Œ <code>green</code> ç›’å­å¤„äºåŒä¸€å±‚å ä¸Šä¸‹æ–‡ï¼ˆå³æ ¹å±‚å ä¸Šä¸‹æ–‡ï¼‰ä¸­ï¼Œä¸” <code>z-index: -1</code> å±‚å é¡ºåºè¾ƒä½ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ° <code>red</code> ç›’å­è¦†ç›–äº† <code>green</code> ç›’å­ã€‚</p>
<p>åœ¨ç¤ºä¾‹äºŒï¼Œç”±äº <code>red</code> ç›’å­çš„ <code>z-index: 0</code> æ˜¯ä½¿å¾—å…¶æœ¬èº«åˆ›å»ºäº†æ–°çš„å±‚å ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ <code>green</code> æ°¸è¿œä¸ä¼šç©¿è¶Š <code>red</code> ç›’å­ã€‚æ­¤æ—¶ï¼Œå³ä½¿ <code>green</code> ç›’å­çš„ <code>z-index</code> ä¸º <code>-9999</code> ä¹Ÿæ€»ä¼šæ˜¾ç¤ºåœ¨ <code>red</code> ç›’å­ä¸Šå±‚ã€‚</p>
<p>åœ¨ç¤ºä¾‹ä¸‰ä¸­ï¼Œ<code>red</code> ç›’å­å†…å¤šäº†ä¸€ä¸ª <code>blue</code> ç›’å­ï¼Œå¹¶è®¾ä¸º <code>z-index: 1</code>ã€‚ç”±äº <code>blue</code> ç›’å­å’Œ <code>green</code> ç›’å­åŒå±äº <code>red</code> ç›’å­åˆ›å»ºçš„å±‚å ä¸Šä¸‹æ–‡ï¼Œå› è€Œï¼Œæ­¤æ—¶ <code>z-index</code> å°±æœ‰äº†æ¯”è¾ƒçš„æ„ä¹‰äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>green</code> ç›’å­å¤„äº <code>blue</code> ç›’å­ä¸‹æ–¹ï¼Œä¸”ä¸ä¼šç©¿è¿‡ <code>red</code> ç›’å­ã€‚</p>
<p>å†çœ‹å¦å¤–ä¸€ä¸ªç¤ºä¾‹ ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/yLzGGyz">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396506219.png" alt=""></p>
<p>å®ƒçš„åŸå› æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºé™¤äº† <code>z-index</code> ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ä¹‹å¤–ï¼ŒCSS3 ä¸­çš„ <code>transform</code> ä¹Ÿä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡å“¦ï¼</p>
<p>ä»¥ä¸Šä¸¤ä¸ªéƒ½æ˜¯å¸¸è§çš„ <code>z-index</code> â€œå¤±æ•ˆâ€çš„åœºæ™¯ï¼Œæ ¹æœ¬åŸå› è¿˜æ˜¯ï¼Œæœ‰çš„å°ä¼™ä¼´ä¸çŸ¥é“ <code>transform</code> ä¹Ÿä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚</p>
<blockquote>
<p>å½“é‡åˆ° <code>z-index</code> å¤±æ•ˆæ—¶ï¼ŒCheck List å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ£€æŸ¥å½“å‰å…ƒç´ æ˜¯å¦ä¸ºå®šä½å…ƒç´ ï¼Œæˆ–å…¶çˆ¶çº§å…ƒç´ æ˜¯å¦æœ‰ <code>display: flex | inline-flex</code>ï¼›</li>
<li>æ£€æŸ¥å®ƒä»¬æ˜¯å¦å¤„äºåŒä¸€å±‚å ä¸Šä¸‹æ–‡ï¼›</li>
<li>è‹¥å‰é¢æ¡ä»¶éƒ½ç¡®è®¤æ— ç–‘ï¼Œé‚£è¯´æ˜æœ‰ä¸€äº›ä½ ä¸çŸ¥é“çš„ CSS å±æ€§ä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼ˆæ­¤æ—¶åº”å»ç¿»é˜…æ–‡æ¡£ï¼‰ï¼›</li>
<li>å¦åˆ™ï¼Œå°±æ˜¯è¿™åƒåœ¾æµè§ˆå™¨æ²¡æœ‰éµå¾ªæ ‡å‡†ï¼Œå·å·åœ°åˆ›å»ºäº†æ–°çš„å±‚å ä¸Šä¸‹æ–‡ï¼ˆè¿™ç§æƒ…å†µåº”è¯¥å‡ ä¹ä¸ä¼šå‡ºç°ï¼Œæ¯•ç«Ÿå¾®è½¯éƒ½æ”¾å¼ƒ IE è½¬æŠ• Chromium äº†ï¼‰ã€‚</li>
</ul>
</blockquote>
<h4>å…³äº position: fixed | sticky è‡ªå¸¦å±‚å ä¸Šä¸‹æ–‡</h4>
<p>ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/qBPLLrw">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396986853.png" alt=""></p>
<p>äº 2022.01 äº²æµ‹ï¼ŒChrome 97ã€Safari 15.2ã€Firefox 97ã€Microsoft Edge 97 æµè§ˆå™¨ä¸‹é¢ï¼Œè¡¨ç°å‡å¦‚ä¸Šå›¾ã€‚ç”±äº <code>position: fixed | sticky</code> è‡ªå¸¦å±‚å ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å›¾ä¸­ç¤ºä¾‹ä¸‰ã€ç¤ºä¾‹å››è“è‰²å—ä¼šè¦†ç›–ç»¿è‰²å—ã€‚</p>
<h2>å››ã€transform</h2>
<p>åœ¨ CSS3 ä¸­æœ‰å‡ ä¸ªä¸åŠ¨ç”»ç›¸å…³çš„å±æ€§ï¼š<code>transform</code>ã€<code>transition</code>ã€<code>animation</code> åˆ†åˆ«å¯¹åº”å˜æ¢ã€è¿‡æ¸¡ã€åŠ¨ç”»ã€‚è™½æ„ä¹‰ç›¸è¿‘ï¼Œä½†å…·ä½“è§’è‰²ä¸ä¸€ã€‚å®ƒä»¬çš„å–å€¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">.selector {
  transform: transform-function | none;
  transition: property duration timing-function delay;
  animation: name duration timing-function delay iteration-count direction fill-mode play-state;
}
</code></pre>
<p>æœ¬æ–‡é‡ç‚¹å¹¶éè°ˆè°ˆå®ƒä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ <code>transform</code>ã€‚ä¸ä¹‹ç›¸å…³çš„ CSS å±æ€§æœ‰è¿™äº›ï¼š</p>
<pre><code class="language-css">.selector {
  /* è®¾ç½®å…ƒç´ å˜å½¢æ–¹å¼ï¼Œå¦‚æ—‹è½¬ã€ç¼©æ”¾ã€å€¾æ–œã€å¹³ç§»ç­‰ */
  transform: transform-function | none;

  /* æ›´æ”¹ä¸€ä¸ªå…ƒç´ å˜å½¢çš„åŸç‚¹ */
  transform-origin: &lt;length&gt; | &lt;percentage&gt; | center | left | right | top | bottom;

  /* å®šä¹‰ä¸ transformã€transform-origin è¿™ä¸¤ä¸ªå±æ€§æœ‰å…³è”çš„å¸ƒå±€æ¡† */
  transform-box: content-box | border-box | fill-box | stroke-box | view-box;

  /* è®¾ç½®å…ƒç´ çš„å­å…ƒç´ æ˜¯ä½äºå¹³é¢ä¸­ï¼Œè¿˜æ˜¯ 3D ç©ºé—´ä¸­ */
  transform-style: flat | preserve-3d;
}
</code></pre>
<p>å®ƒè¿˜æœ‰å…¼å®¹æ€§å±æ€§ï¼š</p>
<pre><code class="language-css">.selector {
  -webkit-transform: transform-function | none;
  -moz-transform: transform-function | none;
  -ms-transform: transform-function | none;
  -o-transform: transform-function | none;
  transform: transform-function | none;
}
</code></pre>
<p>å…¶ä¸­ <code>transform-function</code> çš„å˜æ¢å‡½æ•°æœ‰ä»¥ä¸‹è¿™äº›ï¼š</p>
<ul>
<li>é€è§†ï¼š<code>perspective()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/QWqYPLN">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
<li>çŸ©é˜µï¼š<code>matrix()</code>ã€<code>matrix3d()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/PoJVLVr">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
<li>å€¾æ–œï¼š<code>skew()</code>ã€<code>skewX()</code>ã€<code>skewY()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/RwLvvzx">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
<li>ç¼©æ”¾ï¼š<code>scale()</code>ã€<code>scaleX()</code>ã€<code>scaleY()</code>ã€<code>scaleZ()</code>ã€<code>scale3d()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/abLXMYy">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
<li>æ—‹è½¬ï¼š<code>rotate()</code>ã€<code>rotateX()</code>ã€<code>rotateY()</code>ã€<code>rotateZ()</code>ã€<code>rotate3d()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/vYebbqW">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
<li>å¹³ç§»ï¼š<code>translate()</code>ã€<code>translateX()</code>ã€<code>translateY()</code>ã€<code>translateZ()</code>ã€<code>translate3d()</code>ï¼ˆ<a href="https://codepen.io/tofrankie/pen/wvrNZzM">æŸ¥çœ‹ç¤ºä¾‹</a>ï¼‰</li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåªè¦ <code>transform</code> ä¸ä¸º <code>none</code> æ—¶ï¼Œå®ƒä¹Ÿä¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ã€‚è¿˜æœ‰ <code>translateZ()</code>ã€<code>perspective()</code> ä¸¤ä¸ªå˜æ¢å‡½æ•°ï¼Œå¯ä»¥å®ç° <code>z-index</code> ç±»ä¼¼çš„æ•ˆæœã€‚<code>translateZ(tz)</code> å°±æ˜¯ <code>translate3d(0, 0, tz)</code> ç®€å†™å½¢å¼ã€‚</p>
<h4>transform-style ä¸ translateZ</h4>
<p>ä»å­—é¢ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“ï¼Œ<code>translateZ</code> çš„å˜æ¢æ˜¯å±äº 3D ç©ºé—´çš„ã€‚</p>
<p>å…ˆçœ‹ä¸ªç®€å•<a href="https://codepen.io/tofrankie/pen/WNZmeVP">ç¤ºä¾‹</a>ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396582754.png" alt=""></p>
<p>ä¸ºä»€ä¹ˆçº¢è‰²å—çš„ <code>translateZ</code> å€¼æ›´å¤§ï¼Œä½†å´ä¸æ˜¯åœ¨æ›´ä¸Šé¢å‘¢ï¼Ÿ</p>
<p>åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸º <code>transform-style</code> çš„é»˜è®¤å€¼æ˜¯ <code>flat</code>ï¼Œå³å¤„äº 2D å¹³é¢ä¸­ã€‚å¦‚æœé€‰æ‹©å¹³é¢ï¼Œå…ƒç´ çš„å­å…ƒç´ å°†ä¸ä¼šæœ‰ 3D çš„é®æŒ¡å…³ç³»ã€‚</p>
<p>å®ƒçš„å–å€¼æœ‰ï¼š</p>
<pre><code>transform-style: flat | preserve-3d
</code></pre>
<p>åªè¦å°†å…¶æ·»åŠ ä¸€ä¸ª <code>transform-style: preserve-3d</code> çš„çˆ¶å…ƒç´ ï¼Œå°±èƒ½å¾—åˆ°é¢„æœŸç»“æœï¼šçº¢è‰²è¦†ç›–åœ¨ç»¿è‰²ä¸Šé¢ã€‚<code>preserve-3d</code> ä½¿å¾—è¯¥å…ƒç´ çš„å­å…ƒç´ åº”ä½äº 3D ç©ºé—´ä¸­ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396624151.png" alt=""></p>
<p>å†çœ‹ç¤ºä¾‹ ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/MWExgoL">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677397159291.png" alt=""></p>
<p>ä»¥ä¸Šç¤ºä¾‹å¤šç»„å¯¹æ¯”ï¼Œå…¶å®è¿˜æ˜¯ä¸ºäº†è¯´æ˜ï¼šåœ¨ä¸åŒå±‚å ä¸Šä¸‹æ–‡ä¸­æ¯”è¾ƒå±‚å é«˜ä½æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p>
<h4>Transform å’Œ z-index åŒæ—¶ä½¿ç”¨ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</h4>
<p>çœ‹ç¤ºä¾‹  ğŸ‘‰ <a href="https://codepen.io/tofrankie/pen/PoOwyBB">æºç åŠæ¼”ç¤º</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677396848790.png" alt=""></p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ iPhone å¾®ä¿¡æµè§ˆå™¨ä¸‹ï¼Œè¡¨ç°å¦‚ä½•ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677397022227.png" alt="å¾®ä¿¡æµè§ˆå™¨ iOS ç‰ˆ"></p>
<p>çœ‹åˆ°å·®å¼‚äº†å—ï¼Ÿ</p>
<p>åŸå› æ˜¯ï¼Œè‹¹æœæ——ä¸‹çš„ Safari æµè§ˆå™¨åœ¨ä½¿ç”¨ 3D å˜æ¢æ—¶ï¼Œä¼šå¿½ç•¥ <code>z-index</code> çš„ä½œç”¨ã€‚</p>
<blockquote>
<p>è¯¦æƒ…æˆ³è¿™é‡Œï¼š<a href="https://www.zhangxinxu.com/wordpress/2016/08/safari-3d-transform-z-index/">Safari 3D transform å˜æ¢ z-index å±‚çº§æ¸²æŸ“å¼‚å¸¸çš„ç ”ç©¶</a></p>
</blockquote>
<p><strong>ä¸ªäººå»ºè®®</strong></p>
<blockquote>
<ul>
<li>å°½é‡ä¸è¦åŒæ—¶ä½¿ç”¨ <code>translateZ()</code> å’Œ <code>z-index</code>ï¼ŒiOS ä¸ Android ä¸‹è¡¨ç°æœ‰å·®å¼‚ï¼›</li>
<li>åœ¨æ¶‰åŠ 3D å˜æ¢æ—¶ï¼Œåº”é‡‡ç”¨ <code>transform-style: preserve-3d</code>ã€<code>transform: translateZ()</code>ã€<code>transform: perspective</code> çš„æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯ <code>z-index</code>ï¼›</li>
</ul>
</blockquote>
<!--
**å¾…éªŒè¯**

1. å…ˆè€ƒè™‘ z-indexï¼Œå†è€ƒè™‘ translateZï¼›è‹¥å­˜åœ¨ translateZ ä½†æ²¡æœ‰è®¾ç½® z-index æ—¶ï¼Œå¯ä»¥ç†è§£ä¸º z-index æ˜¯ 0 ç­‰çº§ã€‚
-->
<p>æœªå®Œå¾…ç»­...</p>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context">å±‚å ä¸Šä¸‹æ–‡ MDN</a></li>
<li><a href="https://blog.csdn.net/WuLex/article/details/105769655">z-index å’Œ transformï¼Œä½ çœŸçš„äº†è§£å—ï¼Ÿ</a></li>
<li><a href="https://jelly.jd.com/article/6006b1025b6c6a01506c8775">æ¢ç©¶ transform åŠ¨ç”»å…ƒç´ çš„ z-index</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2016/01/understand-css-stacking-context-order-z-index/">æ·±å…¥ç†è§£ CSS ä¸­çš„å±‚å ä¸Šä¸‹æ–‡å’Œå±‚å é¡ºåº</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2012/09/css3-3d-transform-perspective-animate-transition/">å¥½å§ï¼ŒCSS3 3D transform å˜æ¢ï¼Œä¸è¿‡å¦‚æ­¤ï¼</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2015/05/css3-transform-affect/">CSS3 transform å¯¹æ™®é€šå…ƒç´ çš„ N å¤šæ¸²æŸ“å½±å“</a></li>
<li><a href="https://bitsofco.de/how-z-index-works/">How z-index Works</a></li>
<li><a href="https://www.zoo.team/article/css-stacking-context">CSS å±‚å ä¸Šä¸‹æ–‡ï¼ˆStacking Contextï¼‰</a></li>
<li><a href="https://www.cnblogs.com/xiaohuochai/p/5289653.html">æ·±å…¥ç†è§£ CSS æº¢å‡º overflow</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2016/08/safari-3d-transform-z-index/">Safari 3D transform å˜æ¢ z-index å±‚çº§æ¸²æŸ“å¼‚å¸¸çš„ç ”ç©¶</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åŠ¨æ€è®¾ç½® CSS æ ·å¼æ—¶ï¼Œå¦‚ä½•å†™å…¥å„æµè§ˆå™¨å…¼å®¹æ€§æ ·å¼ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/165</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/165</guid>
            <pubDate>Sun, 26 Feb 2023 07:20:36 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0f1696f4648ca5f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0f1696f4648ca5f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡åŸç”Ÿ JS è„šæœ¬åŠ¨æ€è®¾ç½®å†…è”æ ·å¼çš„æ–¹å¼æœ‰ï¼š</p>
<pre><code class="language-html">&lt;!-- çœç•¥ä¸€ä¸‡è¡Œä»£ç ... --&gt;
&lt;style&gt;
  @keyframes slidein {
    from {
      transform: scaleX(0);
    }
    to {
      transform: scaleX(1);
    }
  }
&lt;/style&gt;

&lt;div id=&quot;app&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²...&lt;/div&gt;
</code></pre>
<pre><code class="language-js">const element = document.getElementById('app')

// 1ï¸âƒ£ æ–¹å¼ä¸€ï¼ˆæ³›æŒ‡ä¸€ç±»ï¼Œä¸‹åŒï¼‰
element.style.fontSize = '30px'

// 2ï¸âƒ£ æ–¹å¼äºŒ
element.style.setProperty('font-size', '30px')

// 3ï¸âƒ£ æ–¹å¼ä¸‰ï¼ˆè¯·æ³¨æ„ï¼Œè¿™å¯èƒ½ä¼šæŠ¹æ‰å…¶ä»– CSS å±æ€§çš„å“¦ï¼‰
element.style.cssText = 'color: 30px'
element.setAttribute('style', 'color: 30px')
</code></pre>
<p><strong>ä½†æ˜¯ï¼Œè¿™é‡Œé¢æœ‰ä¸€äº›é™åˆ¶åœ¨é‡Œé¢...</strong></p>
<blockquote>
<ul>
<li>æ–¹å¼ä¸€ï¼šæ— æ³•è®¾ç½®æƒé‡ <code>!important</code>ï¼Œè‹¥å¸¦ä¸Šæƒé‡ï¼Œå…¶å±æ€§å€¼ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</li>
<li>æ–¹å¼äºŒï¼šæ— æ³•è®¾ç½®å¸¦ <code>-webkit-</code>ã€<code>-moz-</code>ã€<code>-o-</code>ã€<code>-ms-</code> ç­‰å„æµè§ˆå™¨å‚å•†å®éªŒæ€§æˆ–éæ ‡å‡†çš„ CSS å±æ€§ï¼Œå¦‚ <code>-webkit-animation</code>ã€‚</li>
<li>æ–¹å¼ä¸‰ï¼šå¯ä»¥å¤„ç†ä»¥ä¸Šä¸¤ç§æ–¹å¼æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œè¦è·å–å†…è”æ ·å¼ä¸­æŸä¸ª CSS å±æ€§æ˜¯å¦å«æœ‰ <code>!important</code> æƒé‡ï¼Œä¹Ÿéœ€å€ŸåŠ© <code>element.style.cssText</code> æ–¹å¯è·å–ã€‚</li>
</ul>
</blockquote>
<h2>éªŒè¯</h2>
<h4>æ–¹å¼ä¸€</h4>
<pre><code class="language-js">// å¯¹æ¯”ä¸€
element.style.fontSize = '30px' // æœ‰æ•ˆ
element.style.fontSize = '50px !important' // æ— æ•ˆï¼Œé™¤äº†ä¸ä¼šè®¾ç½®æƒé‡ä¹‹å¤–ï¼Œ50px ä¹Ÿä¸ä¼šç”Ÿæ•ˆå“¦ã€‚

// å¯¹æ¯”äºŒ
// å‡è®¾ element å…ƒç´ æœ¬èº«å°±å«æœ‰ font-size: 30px !important çš„å†…è”æ ·å¼
element.style.fontSize // è¾“å‡º &quot;30px&quot;ï¼Œæ³¨æ„æ˜¯ä¸å«æƒé‡çš„
element.style.fontSize = '50px' // è¿™æ˜¯æœ‰æ•ˆçš„ï¼ŒåŒæ—¶æƒé‡ä¹Ÿä¼šä¸¢å¤±
element.style.fontSize = '50px !important' // æ— æ•ˆ

// å¯¹æ¯”ä¸‰
element.style.animation = '3s slidein' // æœ‰æ•ˆ
element.style.webkitAnimation = '3s slidein' // æœ‰æ•ˆï¼Œä½†æ˜¯æœ€ç»ˆä¼šå˜æˆ animation: &quot;3s slidein&quot;ï¼Œè€Œä¸æ˜¯ -webkit-animation: &quot;3s slidein&quot;
element.style.MozAnimation = '3s slidein' // æœ‰æ•ˆï¼Œä½†åŒä¸Š
</code></pre>
<p>å°ç»“ï¼š</p>
<ul>
<li>é€šè¿‡ <code>element.style.fontSize</code> è¿™ä¸€ç±»å½¢å¼è¯»å†™å†…è”æ ·å¼æ—¶ï¼Œéƒ½æ— æ³•<strong>è¯»å–</strong>æˆ–<strong>å†™å…¥</strong>æƒé‡ï¼Œè€Œä¸”éœ€è¦æ³¨æ„çš„æ˜¯ <code>element.style.fontSize = '30 !important'</code> å¹¶ä¸ä¼šè¢«å†™å…¥å“¦ã€‚</li>
<li>é€šè¿‡ <code>element.style.webkitAnimation = '3s slidein'</code> æˆ– <code>element.style.MozAnimation = '3s slidein'</code> å½¢å¼å†™å…¥åŒ…å«æµè§ˆå™¨å‚å•†ç‰¹æ€§çš„ CSS å±æ€§æ—¶ï¼Œå°†ä¼šè¢«å¤„ç†æˆæ ‡å‡†çš„ CSS å±æ€§ã€‚ä¾‹å¦‚ï¼š<code>-webkit-animation</code> å˜ä¸º <code>animation</code>ï¼Œè·Ÿé¢„æœŸç»“æœæ˜¯æœ‰å‡ºå…¥çš„ã€‚</li>
<li>å¦å¤–ï¼Œè¯·æ³¨æ„å†™æ³•ã€‚æ ‡å‡† CSS å±æ€§æ˜¯å°é©¼å³°å½¢å¼ï¼Œè€Œå¸¦æµè§ˆå™¨å‚å•†ç‰¹æ€§çš„ CSS å±æ€§ï¼Œåˆ™å¯èƒ½ä¸æ˜¯å°é©¼å³°å‘½åè§„åˆ™ã€‚ä¾‹å¦‚ï¼š<code>webkitXxx</code>ã€<code>MozXxx</code> é¦–å­—æ¯å¤§å°å†™å°±ä¸ä¸€æ ·ã€‚</li>
</ul>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä»¥ä¸Šç¤ºä¾‹ä»…åˆ—ä¸¾äº†ä¸ªåˆ«å±æ€§ï¼Œä½†å…¶å®æ˜¯æ³›æŒ‡åŒä¸€ç±»ã€‚</p>
</blockquote>
<h4>æ–¹å¼äºŒ</h4>
<pre><code class="language-js">// å¯¹æ¯”ä¸€
element.style.setProperty('font-size', '30px') // æœ‰æ•ˆ
element.style.setProperty('font-size', '30px', 'important') // æœ‰æ•ˆï¼ˆå¯è®¾ç½®æƒé‡ï¼Œä½†è¯·æ³¨æ„æ˜¯ä¸å« ! çš„ï¼‰

// å¯¹æ¯”äºŒ
element.style.setProperty('-webkit-animation', '3s slidein') // æœ‰æ•ˆï¼Œå¯ä¼šå˜ä¸º animationã€‚åŒæ–¹å¼ä¸€
element.style.setProperty('-moz-animation', '3s slidein') // æœ‰æ•ˆï¼Œå¯ä¼šå˜ä¸º animationã€‚åŒæ–¹å¼ä¸€
</code></pre>
<p>å°ç»“ï¼š</p>
<ul>
<li>å¯é€šè¿‡ <code>CSSStyleDeclaration.setProperty(propertyName, value, priority)</code> æ–¹æ³•ï¼Œå¹¶ä¼ é€’ <code>important</code>ï¼ˆè¯·æ³¨æ„æ˜¯ä¸å« <code>!</code> çš„ï¼‰ ç»™ <code>priority</code> å‚æ•°ï¼Œæ¥è®¾ç½® CSS ä¼˜å…ˆçº§ã€‚</li>
</ul>
<h4>æ–¹å¼ä¸‰</h4>
<p>è¿™ç§æ–¹å¼ï¼Œé™¤äº†å¯ä»¥å®ç°ä»¥ä¸ŠåŠŸèƒ½ä¹‹å¤–ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå®ƒå¯ä»¥è®¾ç½® <code>-webkit-</code>ã€<code>-moz-</code>ã€<code>-o-</code>ã€<code>-ms-</code> ç­‰å®éªŒæ€§æˆ–éæ ‡å‡†çš„ CSS å±æ€§ã€‚</p>
<pre><code class="language-js">element.style.cssText = 'font-size: 30px; -webkit-animation: 3s slidein' // æœ‰æ•ˆ
element.setAttribute('style', 'font-size: 30px; -webkit-animation: 3s slidein') // æœ‰æ•ˆ
</code></pre>
<blockquote>
<p>âš ï¸ å°½ç®¡ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½èƒ½å®ç°ï¼Œä½†æ³¨æ„å¯èƒ½ä¼šæŠ¹æ‰å½“å‰å…ƒç´ çš„å…¶ä»– CSS å±æ€§ï¼Œå¯åˆ©ç”¨ç±»å‹ä»¥ä¸‹çš„æ–¹å¼å¤„ç†ã€‚</p>
</blockquote>
<pre><code class="language-js">const { cssText } = element.style
element.style.cssText = `${cssText} font-size: 30px; color: #f00`
</code></pre>
<h2>2023-03-21 æ›´æ–°</h2>
<p>ä¸Šè¿°æ–¹å¼ä¸‰ä¸­é€šè¿‡ <code>element.style.cssText</code> æ–¹å¼è®¾ç½®å¸¦æœ‰ <code>-webkit</code> ç­‰æ ·å¼æ—¶ï¼Œå…¶å‰ç¼€å¯èƒ½ä¼šè¢«æŠ¹é™¤ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">element.style.cssText = '-webkit-user-select: none'
</code></pre>
<p>åœ¨ Safari 16.3 ä¸­ï¼Œå¯æŒ‰é¢„æœŸè®¾ç½® <code>-webkit-user-select: none</code>ï¼Œè€Œåœ¨ Chrome 111ã€Firefox 112 åˆ™ä¼šè¢«å¤„ç†æˆ <code>user-select: none</code>ã€‚</p>
<p>ç›®å‰æ¯”è¾ƒå®‰å…¨çš„åšæ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">element.setAttribute('style', '-webkit-user-select: none')
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/40230182/why-doesnt-style-webkittransition-and-style-webkittransform-work-anymore-in">Why doesn't style.webKitTransition and style.webkitTransform work anymore in Chrome?</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS å›¾ç‰‡æœ€å¤§è¾¹è‡ªé€‚åº”]]></title>
            <link>https://github.com/toFrankie/blog/issues/164</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/164</guid>
            <pubDate>Sun, 26 Feb 2023 07:19:48 GMT</pubDate>
            <description><![CDATA[<p>æ¨¡æ‹Ÿç§»åŠ¨ç«¯å›¾ç‰‡é¢„è§ˆæ•ˆæœï¼Œä½¿å›¾ç‰‡æœ€å¤§è¾¹é€‚åº”å±å¹•å®½æˆ–é«˜ã€‚</p>
<pre><code class="language-html">&lt;div class=&quot;prev-box&quot;&gt;
  &lt;img class=&quot;prev-img&quot; src=&quot;https:/]]></description>
            <content:encoded><![CDATA[<p>æ¨¡æ‹Ÿç§»åŠ¨ç«¯å›¾ç‰‡é¢„è§ˆæ•ˆæœï¼Œä½¿å›¾ç‰‡æœ€å¤§è¾¹é€‚åº”å±å¹•å®½æˆ–é«˜ã€‚</p>
<pre><code class="language-html">&lt;div class=&quot;prev-box&quot;&gt;
  &lt;img class=&quot;prev-img&quot; src=&quot;https://images.unsplash.com/photo-1612998137328-15874448d686?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=668&amp;q=80&quot; /&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.prev-box {
  background: rgba(0, 0, 0, 1);
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  z-index: 10000;
}

/* ä¿è¯æœ€å¤§è¾¹å æ»¡å±å¹• */
.prev-box .prev-img {
  max-width: 100%;
  max-height: 100%;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}
</code></pre>
<h3>æ•ˆæœ</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fb85ff70953985c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç«–å±å›¾ç‰‡æ•ˆæœ"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-483c6c8213689f83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ¨ªå±å›¾ç‰‡æ•ˆæœ"></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS white-space]]></title>
            <link>https://github.com/toFrankie/blog/issues/163</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/163</guid>
            <pubDate>Sun, 26 Feb 2023 07:19:09 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1685631707200.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¯¹äº white-space å±æ€§ï¼Œç»å¸¸è®°ä¸æ¸…æ¥šé‚£å‡ ä¸ªå±æ€§ï¼Œç„¶åæœ‰ä»€ä¹ˆå¾®å¦™çš„å·®]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/6/1685631707200.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¯¹äº white-space å±æ€§ï¼Œç»å¸¸è®°ä¸æ¸…æ¥šé‚£å‡ ä¸ªå±æ€§ï¼Œç„¶åæœ‰ä»€ä¹ˆå¾®å¦™çš„å·®åˆ«ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<h3>white-space</h3>
<p>é€šå¸¸ç”¨äºå¤„ç†å…ƒç´ çš„ç©ºç™½ï¼ŒåŒ…å«ç©ºæ ¼ï¼ˆSpaceï¼‰ã€å›è½¦ï¼ˆEnterï¼‰ã€åˆ¶è¡¨ç¬¦ï¼ˆTabï¼‰ã€‚</p>
<blockquote>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— è®ºæˆ‘ä»¬æœ‰ N å¤šä¸ªç©ºæ ¼æˆ–è€…å›è½¦ï¼Œå®ƒæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šéƒ½ä¼šåˆå¹¶æˆä¸€ä¸ªã€‚è¶…è¿‡ä¸€è¡Œçš„æƒ…å†µä¸‹ï¼Œæ–‡å­—ä¼šæ¢è¡Œã€‚</p>
</blockquote>
<p>ä½†æ— å¥ˆçš„æ˜¯ï¼Œæˆ‘ä»¬çœŸå®éœ€æ±‚å¯èƒ½æ˜¯è¦æ±‚å„å¼å„æ ·çš„ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µæ˜¾ç„¶æ˜¯ä¸æ»¡è¶³æˆ‘ä»¬æ‰€æœ‰è¦æ±‚çš„ã€‚</p>
<ul>
<li>
<p><strong>normalï¼ˆé»˜è®¤ï¼‰</strong>
æ‰€æœ‰ç©ºæ ¼ã€å›è½¦ã€åˆ¶è¡¨ç¬¦éƒ½åˆå¹¶æˆä¸€ä¸ªç©ºæ ¼ï¼Œæ–‡æœ¬è‡ªåŠ¨æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>nowrap</strong>
æ‰€æœ‰ç©ºæ ¼ã€å›è½¦ã€åˆ¶è¡¨ç¬¦éƒ½åˆå¹¶æˆä¸€ä¸ªç©ºæ ¼ï¼Œæ–‡æœ¬ä¸æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>pre</strong>
æ‰€æœ‰ä¸œè¥¿åŸæ ·è¾“å‡ºï¼Œæ–‡æœ¬ä¸æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>pre-wrap</strong>
æ‰€æœ‰ä¸œè¥¿åŸæ ·è¾“å‡ºï¼Œæ–‡æœ¬æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>pre-line</strong>
æ‰€æœ‰ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦åˆå¹¶æˆä¸€ä¸ªç©ºæ ¼ï¼Œå›è½¦ä¸å˜ï¼Œæ–‡æœ¬æ¢è¡Œã€‚</p>
</li>
<li>
<p><strong>inherit</strong>
ç»§æ‰¿çˆ¶å…ƒç´ ï¼ˆIE ä¸æ”¯æŒï¼‰</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">white-space å±æ€§</th>
<th style="text-align:left">æºç ç©ºæ ¼</th>
<th style="text-align:left">æºç æ¢è¡Œ</th>
<th style="text-align:left">&lt;br&gt; æ¢è¡Œ</th>
<th style="text-align:left">å®¹å™¨è¾¹ç•Œæ¢è¡Œ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">normal</td>
<td style="text-align:left">åˆå¹¶</td>
<td style="text-align:left">å¿½ç•¥</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">nowrap</td>
<td style="text-align:left">åˆå¹¶</td>
<td style="text-align:left">å¿½ç•¥</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">ä¸æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">pre</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">ä¸æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">pre-wrap</td>
<td style="text-align:left">ä¿ç•™</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
</tr>
<tr>
<td style="text-align:left">pre-line</td>
<td style="text-align:left">åˆå¹¶</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
<td style="text-align:left">æ¢è¡Œ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ›´å¤šç»†èŠ‚å¯çœ‹ã€Š<a href="https://github.com/toFrankie/blog/issues/313">ç»†è°ˆç©ºç™½ç¬¦</a>ã€‹ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[input placeholder å…¼å®¹æ€§å¤„ç†]]></title>
            <link>https://github.com/toFrankie/blog/issues/162</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/162</guid>
            <pubDate>Sun, 26 Feb 2023 07:18:24 GMT</pubDate>
            <description><![CDATA[<p>è‹¥è¦ä¿®æ”¹ <code>&lt;input /&gt;</code> å…ƒç´  <code>placeholder</code> å±æ€§çš„æ ·å¼ï¼Œéœ€è¦å…¼å®¹å¤šç§æµè§ˆå™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">/* WebKit, Blink, Edge */
input::-webki]]></description>
            <content:encoded><![CDATA[<p>è‹¥è¦ä¿®æ”¹ <code>&lt;input /&gt;</code> å…ƒç´  <code>placeholder</code> å±æ€§çš„æ ·å¼ï¼Œéœ€è¦å…¼å®¹å¤šç§æµè§ˆå™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">/* WebKit, Blink, Edge */
input::-webkit-input-placeholder {
  color: #eee !important;
  font-size: 16px !important;
}

/* Mozilla Firefox 19+ */
.input::-moz-placeholder {
  color: #eee !important;
  font-size: 16px !important;
}

/* Mozilla Firefox 4 to 18 */
.input:-moz-placeholder {
  color: #eee !important;
  font-size: 16px !important;
}

/* Internet Explorer 10-11 */
.input:-ms-input-placeholder {
  color: #eee !important;
  font-size: 16px !important;
}
</code></pre>
<h3>è®¾ç½®ä¸ç”Ÿæ•ˆï¼Ÿ</h3>
<p>è‹¥è®¾ç½® <code>placeholder</code> çš„æ ·å¼ä¸ç”Ÿæ•ˆï¼ŒåŸå› å¯èƒ½æ˜¯åœ¨æŸäº›å…¬å…±æ ·å¼å·²ç»å¯¹ <code>placeholder</code> è¿›è¡Œè®¾ç½®äº†ï¼Œå†ä¸€æ¬¡è®¾ç½®å°±ä¼šæ— æ•ˆã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯ï¼Œæ·»åŠ  <code>!important</code> å¢åŠ æƒé‡ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Autoprefixer æ²¡æœ‰æ·»åŠ å‰ç¼€ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/161</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/161</guid>
            <pubDate>Sun, 26 Feb 2023 07:16:42 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ <a href="https://github.com/postcss/postcss/blob/main/docs/README-cn.md">PostCSS</a> ä¸­ä½¿ç”¨ <a href="https://github.com/postcss/autoprefixer.git">Autoprefixer]]></description>
            <content:encoded><![CDATA[<p>åœ¨ <a href="https://github.com/postcss/postcss/blob/main/docs/README-cn.md">PostCSS</a> ä¸­ä½¿ç”¨ <a href="https://github.com/postcss/autoprefixer.git">Autoprefixer</a> å‘ç°æ²¡æœ‰ç»™æˆ‘æ·»åŠ å‰ç¼€ï¼Œç„¶å...</p>
<p>ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<h5>æ–¹æ¡ˆä¸€</h5>
<p>æ— è®ºä½¿ç”¨ <code>postcss.config.js</code> ç­‰é…ç½®æ–‡ä»¶è¿˜æ˜¯ç›´æ¥åœ¨ <code>webpack.config.js</code> ä¸­ä½¿ç”¨ <a href="https://github.com/postcss/autoprefixer.git">Autoprefixer</a>ï¼Œéƒ½éœ€è¦è®¾ç½® <code>browserslist</code> æ‰ä¼šå¸®ä½ æ·»åŠ å‰ç¼€ã€‚</p>
<pre><code class="language-js">// postcss.config.js
module.exports = {
  plugins: [
    require('autoprefixer')
  ]
}
</code></pre>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader', {
          loader: 'postcss-loader',
          options: {
            plugins: [
              require('autoprefixer')
            ],
          }
        }]
      }
    ]
  }
}
</code></pre>
<pre><code class="language-json5">// package.json
{
  &quot;browserslist&quot;: [
    &quot;last 2 versions&quot;,
    &quot;&gt; 1%&quot;,
    &quot;iOS 7&quot;,
    &quot;last 3 iOS versions&quot;
  ]
}
</code></pre>
<p>æˆ–è€…æ·»åŠ é…ç½®æ–‡ä»¶ <code>.browserslistrc</code></p>
<pre><code># Browsers that we support

last 2 versions
&gt; 1%
iOS 7
last 3 iOS versions
</code></pre>
<h5>2. æ–¹æ¡ˆäºŒï¼ˆä¸æ¨èï¼‰</h5>
<p>åœ¨ <code>postcss.config.js</code> é…ç½®æ–‡ä»¶æ·»åŠ  <code>browsers</code> é€‰é¡¹ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œ<a href="https://github.com/postcss/autoprefixer.git">Autoprefixer</a> ä¸æå€¡è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚</p>
<p>å»ºè®®ä½¿ç”¨æ–¹æ¡ˆä¸€è§£å†³ï¼Œå¦åˆ™é¡¹ç›®æ„å»ºæ—¶ä¼šæœ‰è­¦å‘Š âš ï¸ï¼š</p>
<blockquote>
<p>Replace Autoprefixer browsers option to Browserslist config.
Use browserslist key in package.json or .browserslistrc file.</p>
<p>Using browsers option cause some error. Browserslist config
can be used for Babel, Autoprefixer, postcss-normalize and other tools.</p>
<p>If you really need to use option, rename it to overrideBrowserslist.</p>
<p>Learn more at:
<a href="https://github.com/browserslist/browserslist#readme">https://github.com/browserslist/browserslist#readme</a>
<a href="https://twitter.com/browserslist">https://twitter.com/browserslist</a></p>
</blockquote>
<pre><code class="language-js">// postcss.config.js
module.exports = {
  plugins: [
    require('autoprefixer')({
      browsers: ['defaults', 'not ie &lt; 11', 'last 2 versions', '&gt; 1%', 'iOS 7', 'last 3 iOS versions']
    })
  ]
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[é’ˆå¯¹ä¸è§„åˆ™å›¾æ¡ˆé˜´å½± drop-shadow]]></title>
            <link>https://github.com/toFrankie/blog/issues/160</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/160</guid>
            <pubDate>Sun, 26 Feb 2023 07:15:52 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘åœ¨åšå¾®ä¿¡å°ç¨‹åºä¼˜æƒ åˆ¸çš„ä¸€ä¸ªéœ€æ±‚ï¼Œç„¶åä¼˜æƒ åˆ¸å¡ç‰‡å±•ç¤ºæ˜¯<strong>ä¸è§„åˆ™å›¾å½¢ä¸”å«é˜´å½±</strong>ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-aaed6ecb9b47a129.j]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘åœ¨åšå¾®ä¿¡å°ç¨‹åºä¼˜æƒ åˆ¸çš„ä¸€ä¸ªéœ€æ±‚ï¼Œç„¶åä¼˜æƒ åˆ¸å¡ç‰‡å±•ç¤ºæ˜¯<strong>ä¸è§„åˆ™å›¾å½¢ä¸”å«é˜´å½±</strong>ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-aaed6ecb9b47a129.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å› ä¸ºå¡ç‰‡æœ‰å±•å¼€äº¤äº’ï¼Œæ‰€ä»¥é«˜åº¦éå›ºå®šçš„ï¼Œæ‰€ä»¥å°±æ²¡ç”¨åˆ‡å›¾å»å¼„ï¼Œæƒ³ç€ç”¨ CSS å®ç°ï¼Œç„¶åä¸€é¡¿æ“ä½œï¼š</p>
<pre><code class="language-css">.card {
  width: 100%;
  height: auto;
  margin: 24rpx 0;
  position: relative;
  border-radius: 10rpx;
  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.06);
  background: radial-gradient(circle at 0 142rpx, transparent 10rpx, #fff 0) top left, linear-gradient(0.25turn, #fff, #fff),
    radial-gradient(circle at 70rpx 142rpx, transparent 10rpx, #fff 0) bottom right;
  background-size: 10% 100%, 82% 100%, 10% 100%;
  background-repeat: no-repeat;
  background-position: 0 0, 50% 0, 100% 0;
}
</code></pre>
<p>å‡ºæ¥çš„æ•ˆæœå¦‚ä¸‹ï¼Œæœ‰ç‘•ç–µï¼Œå¼ºè¿«ç—‡è¡¨ç¤ºå—ä¸äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7fe8a89ea7010197.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é’ˆå¯¹ä¸è§„åˆ™å›¾å½¢ï¼Œä½¿ç”¨ <code>filter</code> å±æ€§æ›¿æ¢æ‰ <code>box-shadow</code>ã€‚ï¼ˆæ•ˆæœå¦‚å›¾ä¸€ï¼‰</p>
<pre><code class="language-css">{
  filter: drop-shadow(0px 4rpx 12rpx rgba(0, 0, 0, 0.06));
}
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>drop-shadow</code> å‚æ•°ä¸ <code>box-shadow</code> åŸºæœ¬ä¸€è‡´ã€‚</p>
</blockquote>
<h3>å…¼å®¹æ€§</h3>
<p>åœ¨ä½¿ç”¨ <code>filter: drop-shadow</code> è®¾ç½®é˜´å½±ä¼šå¯¼è‡´éƒ¨åˆ† iOS è®¾å¤‡å¯¼è‡´èŠ±å±ã€‚</p>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/000446f4b14600321067eaee851800">wx:for æ¸²æŸ“åˆ—è¡¨æ—¶åœ¨ iPhone X å‡ºç°é‡å¤æ•°æ®ï¼Ÿ</a></li>
<li><a href="https://segmentfault.com/a/1190000017236686">å°ç¨‹åºè¸©å‘è®°ä¹‹â€”â€”èŠ±å±/é‡å¤æ¸²æŸ“æ•°æ®</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/0002022265c700a43a395a67351c00">iOS çœŸæœºä¸‹åŠ¨æ€ä¿®æ”¹ filter:drop-shadow å¯¼è‡´çš„æ¸²æŸ“å¼‚å¸¸é—®é¢˜</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡æµè§ˆå™¨ä¸­ Input æ ‡ç­¾ CSS å…¼å®¹æ€§é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/159</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/159</guid>
            <pubDate>Sun, 26 Feb 2023 07:15:06 GMT</pubDate>
            <description><![CDATA[<p>ç»æµ‹è¯•ä¸ä¸ªäººçŒœæµ‹ï¼Œåœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­ï¼Œ<code>&lt;input /&gt;</code> æ ‡ç­¾ï¼Œå¾®ä¿¡çš„ webview å®¹å™¨åº”è¯¥æ˜¯èµ‹äºˆäº†ä¸€äº›é»˜è®¤çš„å±æ€§ï¼Œå¦‚æ ‡ç­¾ç¦ç”¨çŠ¶æ€ä¸‹ <code>opacity</code> ä¸é€æ˜åº¦é 100% ç­‰ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆæœ‰è¿™ç§çŒœæµ‹ï¼Œå› ä¸ºåœ¨ Chr]]></description>
            <content:encoded><![CDATA[<p>ç»æµ‹è¯•ä¸ä¸ªäººçŒœæµ‹ï¼Œåœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­ï¼Œ<code>&lt;input /&gt;</code> æ ‡ç­¾ï¼Œå¾®ä¿¡çš„ webview å®¹å™¨åº”è¯¥æ˜¯èµ‹äºˆäº†ä¸€äº›é»˜è®¤çš„å±æ€§ï¼Œå¦‚æ ‡ç­¾ç¦ç”¨çŠ¶æ€ä¸‹ <code>opacity</code> ä¸é€æ˜åº¦é 100% ç­‰ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆæœ‰è¿™ç§çŒœæµ‹ï¼Œå› ä¸ºåœ¨ Chrome è°ƒè¯•æ˜¯é¢„æœŸè¡¨ç°ï¼Œè€Œå¾®ä¿¡æµè§ˆå™¨ä¸­åˆ™éé¢„æœŸç»“æœï¼Œæ‰€ä»¥æœ‰äº†ä»¥ä¸Šå¤§èƒ†çš„çŒœæµ‹ï¼Œå“ˆå“ˆ ã€‚å¦‚æœ‰çŸ¥é“æ ¹æœ¬åŸå› çš„ï¼Œè¯·æ¬¢è¿å¤§èƒ†æŒ‡å‡ºï¼Œè°¢è°¢ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œæˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œ<code>disabled</code> çŠ¶æ€ä¸‹åªè®¾ç½®äº† <code>color</code> ä¹‹åï¼Œè€Œä¸”è¾“å…¥æ¡†çš„èƒŒæ™¯é¢œè‰²æ˜¯ç™½è‰²ï¼Œæ‰€ä»¥å¯¼è‡´å‰ç«¯é¡µé¢çœ‹èµ·æ¥å°±åƒè¾“å…¥æ¡†æ²¡æœ‰ä»»ä½•å€¼ä¸€æ ·ã€‚</p>
<h5>è§£å†³æ–¹æ¡ˆä¸€</h5>
<p>å±€éƒ¨æ·»åŠ </p>
<pre><code class="language-css">.your-input {
  color: #ababab;
  text-fill-color: #ababab;
  opacity: 1;
  -webkit-text-fill-color: #ababab;
  -webkit-opacity: 1;
}
</code></pre>
<h5>è§£å†³æ–¹æ¡ˆäºŒ</h5>
<p>å…¨å±€ input æ ‡ç­¾è¦†ç›–</p>
<pre><code class="language-css">input:disabled, textarea:disabled {
  color: #ababab;
  text-fill-color: #ababab;
  opacity: 1;
  -webkit-text-fill-color: #ababab;
  -webkit-opacity: 1;
}
</code></pre>
<blockquote>
<p>å…¶ä¸­ï¼Œ<code>-webkit-text-fill-color</code> æ˜¯ç”¨æ¥åšå¡«å……è‰²ä½¿ç”¨çš„ï¼Œå¦‚æœæœ‰è®¾ç½®è¿™ä¸ªå€¼ï¼Œåˆ™ <code>color</code> å±æ€§å°†ä¸ç”Ÿæ•ˆã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡æµè§ˆå™¨ä¸­ Input çš„å…¼å®¹æ€§å¤„ç†]]></title>
            <link>https://github.com/toFrankie/blog/issues/158</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/158</guid>
            <pubDate>Sun, 26 Feb 2023 07:14:13 GMT</pubDate>
            <description><![CDATA[<ol>
<li>åœ¨ iOS ä¸Šè¾“å…¥æ¡†é»˜è®¤æ ·å¼ä¼šæœ‰å†…é˜´å½±ï¼Œæ— æ³•é€šè¿‡ <code>box-shadow: none</code> å»é™¤ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ã€‚</li>
</ol>
<pre><code class="language-css">input {
  -webkit-appearance: none;
}
<]]></description>
            <content:encoded><![CDATA[<ol>
<li>åœ¨ iOS ä¸Šè¾“å…¥æ¡†é»˜è®¤æ ·å¼ä¼šæœ‰å†…é˜´å½±ï¼Œæ— æ³•é€šè¿‡ <code>box-shadow: none</code> å»é™¤ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ã€‚</li>
</ol>
<pre><code class="language-css">input {
  -webkit-appearance: none;
}
</code></pre>
<ol start="2">
<li>åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­éƒ¨åˆ† iOS è®¾å¤‡åœ¨è¾“å…¥æ¡†å¤±ç„¦æ—¶ï¼Œé¡µé¢æ— æ³•æ­£å¸¸å›å¼¹ï¼Œå¯é€šè¿‡åœ¨ <code>input</code> å¤±ç„¦äº‹ä»¶åŠ ä¸Šï¼š</li>
</ol>
<pre><code class="language-js">function blurHandler() {
  setTimeout(() =&gt; {
    const scrollHeight = document.documentElement.scrollTop || document.body.scrollTop || 0
    window.scrollTo(0, Math.max(scrollHeight - 1, 0))
  }, 0)
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³å¤šè¡Œæ–‡æœ¬æ¢è¡Œçœç•¥æ˜¾ç¤ºå¤±æ•ˆçš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/157</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/157</guid>
            <pubDate>Sun, 26 Feb 2023 07:12:15 GMT</pubDate>
            <description><![CDATA[<p>ç›¸ä¿¡å¤§å®¶çš„å‰ç«¯å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ï¼Œéƒ½ä¼šç”¨åˆ° <code>autoprefixer</code> ï¼Œå®ƒè®©æˆ‘ä»¬æ— éœ€å…³ç³»è¦ä¸ºå“ªäº›æµè§ˆå™¨åŠ å‰ç¼€ã€‚é…åˆ <code>postcss</code> ä¸€èµ·ä½¿ç”¨ä¼šæ›´å¥½ã€‚</p>
<p>ä½†åŒæ—¶å®ƒä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚å®ƒä¸ä¼šå¸®ä½ æ·»åŠ  <code>-webkit-</code> ä¹‹ç±»çš„ pre]]></description>
            <content:encoded><![CDATA[<p>ç›¸ä¿¡å¤§å®¶çš„å‰ç«¯å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ï¼Œéƒ½ä¼šç”¨åˆ° <code>autoprefixer</code> ï¼Œå®ƒè®©æˆ‘ä»¬æ— éœ€å…³ç³»è¦ä¸ºå“ªäº›æµè§ˆå™¨åŠ å‰ç¼€ã€‚é…åˆ <code>postcss</code> ä¸€èµ·ä½¿ç”¨ä¼šæ›´å¥½ã€‚</p>
<p>ä½†åŒæ—¶å®ƒä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚å®ƒä¸ä¼šå¸®ä½ æ·»åŠ  <code>-webkit-</code> ä¹‹ç±»çš„ prefixerã€‚è™½ç„¶å®ƒä¼šå¸®ä½ å¢åŠ æ–°å‰ç¼€ï¼Œä½†ä¹Ÿä¼šå¸®ä½ åˆ é™¤è€å¼è¿‡æ—¶çš„ä»£ç ã€‚</p>
<h3>éœ€æ±‚æ¥äº†</h3>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œ<strong>æ–‡æœ¬æœ€å¤šæ˜¾ç¤ºä¸¤è¡Œï¼Œæº¢å‡ºéƒ¨åˆ†ä½¿ç”¨çœç•¥å·è¡¨ç¤º</strong>ï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<h3>ä»£ç å®ç°</h3>
<p>å¿ƒæƒ³ so easy å•¦ï¼Œç„¶åå­æ‹‰ä¸€ä¸‹å†™å‡ºæ¥ä¸‹é¢çš„ä»£ç ï¼Œé¡µé¢çƒ­æ›´æ–°å¥½äº†ï¼Œæ“¦äº†æ“¦çœ¼é•œï¼Œä¸æ˜¯çœ¼èŠ±äº†å§ï¼Œæ²¡æˆåŠŸï¼Ÿï¼ˆå†…å¿ƒåä¸‡ä¸ªé©¬å„¿å¥”è…¾...ï¼‰</p>
<pre><code class="language-html">&lt;div class=&quot;text&quot;&gt;å…³å…³é›é¸ ï¼Œåœ¨æ²³ä¹‹æ´²ã€‚çªˆçª•æ·‘å¥³ï¼Œå›å­å¥½é€‘ã€‚å‚å·®è‡èœï¼Œå·¦å³æµä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œå¯¤å¯æ±‚ä¹‹ã€‚æ±‚ä¹‹ä¸å¾—ï¼Œå¯¤å¯æ€æœã€‚æ‚ å“‰æ‚ å“‰ï¼Œè¾—è½¬åä¾§ã€‚å‚å·®è‡èœï¼Œå·¦å³é‡‡ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œç´ç‘Ÿå‹ä¹‹ã€‚å‚å·®è‡èœï¼Œå·¦å³èŠ¼ä¹‹ã€‚çªˆçª•æ·‘å¥³ï¼Œé’Ÿé¼“ä¹ä¹‹ã€‚&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.text {
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}
</code></pre>
<h3>ç»“æœ</h3>
<p>é¢„æœŸè¡¨ç°ï¼šâœ…</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-097edae264132ac3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¢„æœŸä¸°æ»¡"></p>
<p>å®é™…è¡¨ç°ï¼šâ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7d6bfec7807aef32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç°å®éª¨æ„Ÿ"></p>
<h3>æ‰¾åŸå›  Why</h3>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿç»†å¿ƒä¸€çœ‹ï¼Œä¼šå‘ç°ç¼–è¯‘åçš„ CSS ä¸­ <code>-webkit-box-orient: vertical;</code> ä¸è§äº†ã€‚ğŸ‘‡
<img src="https://upload-images.jianshu.io/upload_images/5128488-5fdb7b8b4e3987bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¼–è¯‘åçš„CSS">
ç„¶åå°±å¤§æ¦‚èƒ½çŒœå‡ºæ˜¯ä»€ä¹ˆç©æ„æé¬¼äº†ï¼Œä¸æ˜¯ postcssï¼Œå°±æ˜¯ autoprefixer äº†ã€‚ç„¶åæœäº†ä¸€ç•ªï¼Œå‘ç°æ€äººå‡¶æ‰‹å°±æ˜¯ autoprefixerï¼Œå®ƒæŠŠæˆ‘çš„ <code>-webkit-box-orient: vertical</code> åƒäº†ï¼ˆä¸Šé¢æè¿‡ï¼Œä¼šåˆ æ‰ä¸€äº›è¿‡æ—¶çš„è§„åˆ™ï¼‰</p>
<h3>è§£å†³æ–¹æ³•</h3>
<ol>
<li>åœ¨ postcss-loader å¢åŠ  <code>autoprefixer({ remove: false })</code>ã€‚<strong>ï¼ˆä¸æ¨èï¼‰</strong></li>
<li>åªç§»é™¤è¿‡æ—¶å‰ç¼€ï¼Œä¸è‡ªåŠ¨å¢åŠ æ–°å‰ç¼€ï¼š<code>autoprefixer({ add: false })</code>ã€‚<strong>ï¼ˆéæœ¬æ–‡é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œä»…æ‰©å±•ç”¨ï¼‰</strong></li>
<li>ä½¿ç”¨ Control Commentsï¼ˆæ§åˆ¶æ³¨é‡Šï¼Œå—çº§ï¼‰<strong>ï¼ˆæœ‰æ•ˆï¼‰</strong></li>
</ol>
<pre><code class="language-css">.text {
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  /*! autoprefixer: off */
  -webkit-box-orient: vertical;
  /*! autoprefixer: on */
}
</code></pre>
<ol start="4">
<li>ä½¿ç”¨ Control Commentsï¼ˆæ§åˆ¶æ³¨é‡Šï¼Œå•è¡Œï¼‰<strong>ï¼ˆæ— æ•ˆï¼‰</strong>
ç½‘ä¸Šå¾ˆå¤šæ‰€ä½¿ç”¨è¿™ç§æ–¹å¼çš„ï¼Œä½†æˆ‘æµ‹è¯•æ— æ•ˆï¼ŒåŸå› æœªçŸ¥ã€‚å¦‚ç”¨è¡¥å……ï¼Œæ¬¢è¿æŒ‡å‡ºä¿®æ­£ï¼Œè°¢è°¢ï¼</li>
</ol>
<pre><code>.text {
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  /*! autoprefixer: ignore next */
  -webkit-box-orient: vertical;
}
</code></pre>
<ol start="5">
<li>å¢åŠ å†…è”æ ·å¼ <code>style={{WebkitBoxOrient: 'vertical'}}</code><strong>ï¼ˆæœ‰æ•ˆï¼‰</strong></li>
</ol>
<p><strong>åœ¨ä¸Šé¢åˆ—ä¸¾çš„å‡ ç§æ–¹æ³•ä¸­ï¼Œä¸ªäººæ¨èç¬¬ 3 ç§æ–¹å¼ã€‚</strong></p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/postcss/autoprefixer#control-comments">Autoprefixer control comments</a></li>
<li><a href="https://juejin.cn/post/6844903848599896072">æ€æ ·ä½¿ç”¨ autoprefixer æ—¶ä¿ç•™ -webkit-box-orient ç­‰æ ·å¼è§„åˆ™</a></li>
<li><a href="https://juejin.cn/post/6844903988081475591">å¯èƒ½æ˜¯æœ€å…¨çš„ â€œæ–‡æœ¬æº¢å‡ºæˆªæ–­çœç•¥â€ æ–¹æ¡ˆåˆé›†</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CSS é€‰æ‹©å™¨çš„æƒé‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/156</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/156</guid>
            <pubDate>Sun, 26 Feb 2023 07:08:51 GMT</pubDate>
            <description><![CDATA[<p>é—²æ¥æ²¡äº‹ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæœ‰äº›è¿˜æ˜¯å¾ˆå°‘ä½¿ç”¨åˆ°çš„ã€‚</p>
<p><strong>æƒé‡ç”±é«˜åˆ°ä½ï¼š<code>!important</code> ï¼ <code>å†…è”æ ·å¼</code> ï¼ <code>id é€‰æ‹©å™¨</code> ï¼ <code>ç±»é€‰æ‹©å™¨</code> ï¼ <code>æ ‡ç­¾é€‰æ‹©å™¨</code> ï¼ <cod]]></description>
            <content:encoded><![CDATA[<p>é—²æ¥æ²¡äº‹ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæœ‰äº›è¿˜æ˜¯å¾ˆå°‘ä½¿ç”¨åˆ°çš„ã€‚</p>
<p><strong>æƒé‡ç”±é«˜åˆ°ä½ï¼š<code>!important</code> ï¼ <code>å†…è”æ ·å¼</code> ï¼ <code>id é€‰æ‹©å™¨</code> ï¼ <code>ç±»é€‰æ‹©å™¨</code> ï¼ <code>æ ‡ç­¾é€‰æ‹©å™¨</code> ï¼ <code>é€šé…ç¬¦</code> ï¼ <code>ç»§æ‰¿</code>ã€‚</strong></p>
<ul>
<li>id é€‰æ‹©å™¨ï¼ˆ<code>#myid</code>ï¼‰</li>
<li>ç±»é€‰æ‹©å™¨ï¼ˆ<code>.myclassname</code>ï¼‰</li>
<li>æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆ<code>div</code>ã€<code>h1</code>ã€<code>p</code>ï¼‰</li>
<li>ç›¸é‚»é€‰æ‹©å™¨ï¼ˆ<code>h1 + p</code>ï¼‰</li>
<li>å­é€‰æ‹©å™¨ï¼ˆ<code>ul &gt; li</code>ï¼‰</li>
<li>åä»£é€‰æ‹©å™¨ï¼ˆ<code>li a</code>ï¼‰</li>
<li>é€šé…ç¬¦é€‰æ‹©å™¨ï¼ˆ<code>*</code>ï¼‰</li>
<li>å±æ€§é€‰æ‹©å™¨ï¼ˆ<code>a[rel=&quot;external&quot;]</code>ï¼‰</li>
<li>ä¼ªç±»é€‰æ‹©å™¨ï¼ˆ<code>a:hover</code>ã€<code>li:nth-child</code>ï¼‰</li>
<li>å¯ç»§æ‰¿çš„å±æ€§ï¼š<code>font-size</code>ã€<code>font-family</code>ã€<code>color</code></li>
</ul>
<p><strong>The end.</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº fail can only be invoked by user TAP gesture çš„è®°å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/155</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/155</guid>
            <pubDate>Sat, 25 Feb 2023 14:30:47 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-252b9243b6274d98.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-252b9243b6274d98.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç›¸ä¿¡å¤§å®¶å¼€å‘å°ç¨‹åºçš„æ—¶å€™éƒ½é‡åˆ°è¿‡ï¼š</p>
<blockquote>
<p>{errMsg: &quot;requestSubscribeMessage:fail can only be invoked by user TAP gesture.&quot;}</p>
</blockquote>
<p>æ„æ€å°±æ˜¯éœ€è¦ã€Œç”¨æˆ·è§¦å‘ã€ï¼Œæ˜¯ç”¨æˆ·è‡ªå‘ã€ä¸»åŠ¨çš„è¡Œä¸ºæ‰èƒ½æ­£å¸¸è°ƒç”¨ï¼Œå¾ˆå¤š API éƒ½ç”¨æ­¤é™åˆ¶ï¼Œæ¯”å¦‚ <code>wx.navigateToMiniprogram()</code>ã€<code>wx.openSetting()</code> ç­‰ã€‚å®˜æ–¹ç”©é”…è¯´å¼€å‘è€…æ»¥ç”¨æ¥å£ï¼Œå…¶å®éƒ½æ˜¯äº§å“ç»ç†éœ€æ±‚ä¸Šçš„æ»¥ç”¨ã€‚ä»–ä»¬é™åˆ¶ä¸äº†äº§å“ç»ç†ï¼Œå°±åªèƒ½æå¼€å‘è€…äº†ã€‚</p>
<p>è¯¸å¦‚æ­¤ç±»çš„é—®é¢˜ï¼Œåœ¨å¾®ä¿¡å¼€æ”¾ç¤¾åŒºä¸€æœä¸€å †ï¼Œç„¶åå®˜æ–¹ä¸‡èƒ½å›å¤æ¨¡æ¿æ˜¯ï¼šã€Œè¯·å…·ä½“æè¿°é—®é¢˜å‡ºç°çš„æµç¨‹ï¼Œå¹¶æä¾›èƒ½å¤ç°é—®é¢˜çš„ç®€å•ä»£ç ç‰‡æ®µã€ã€‚</p>
<p>åŸå› å¯èƒ½ä¼šæœ‰è¿™äº›ï¼Œè‡ªè¡Œæ’æŸ¥ä¸€ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>åªèƒ½åœ¨ <code>bindtap/catchtap</code> ç»‘å®šçš„æ–¹æ³•å†…è°ƒç”¨ <code>wx.requestSubscribeMessage()</code>ã€‚</li>
<li>åªèƒ½åœ¨æ‰€ç»‘å®šçš„æ–¹æ³•å†…ç›´æ¥è°ƒç”¨ï¼Œä¸å…è®¸åœ¨å›è°ƒå‡½æ•°ä¸­è°ƒç”¨ã€‚</li>
<li>åœ¨æ‰§è¡Œ <code>wx.requestSubscribeMessage()</code> å‰ï¼Œä¸èƒ½æœ‰ <code>await xxx</code> ç­‰å¼‚æ­¥æ“ä½œã€‚çœ‹åˆ°ä¸€ä¸ªæ›´ç¦»è°±çš„æ˜¯å‰é¢æœ‰ <code>console.log()</code> ä¹Ÿå¤±è´¥äº†ï¼Œç§»æ­¥<a href="https://developers.weixin.qq.com/community/develop/article/doc/00066e97bb8dc0d1720b1a8f75fc13">è¿™é‡Œ</a>ã€‚</li>
</ol>
</blockquote>
<p>å…³äºèƒ½ä¸èƒ½åœ¨å›è°ƒå‡½æ•°é‡Œä½¿ç”¨ï¼Œæœ‰äº›äººåœ¨ <code>wx.request()</code>ã€<code>wx.showToast()</code> ç­‰å›è°ƒé‡Œæ˜¯æˆåŠŸçš„ï¼Œæ€»ä¹‹å¾ˆè¯¡å¼‚~</p>
<p>è§£å†³æ–¹æ³•æ˜¯ï¼Œå°†å…¶ä»–é€»è¾‘åç½®ï¼Œé¦–å…ˆè°ƒç”¨ <code>wx.requestSubscribeMessage()</code> æ¥å£ã€‚</p>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html">wx.requestSubscribeMessage()</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html">å°ç¨‹åºè®¢é˜…æ¶ˆæ¯</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-message-management/subscribe-message/sendMessage.html">å‘é€è®¢é˜…æ¶ˆæ¯</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/product/#_5-21-%E6%BB%A5%E7%94%A8%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF">æ»¥ç”¨è®¢é˜…æ¶ˆæ¯</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/000046b0e6035824c6b9ed8235b809">å…³äºå°ç¨‹åºæ¨¡æ¿æ¶ˆæ¯èƒ½åŠ›è°ƒæ•´è¯´æ˜</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/article/doc/00006c4ea5ca80d4bcde43a755c813">å°ç¨‹åºä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯è¯¦è§£</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/000c086fffc06852bd5996fe45b000">requestSubscribeMessage æ— æ³•è°ƒç”¨ï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[wx-open-launch-weapp æ ·å¼é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/154</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/154</guid>
            <pubDate>Sat, 25 Feb 2023 14:25:12 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e4bd58aef5e80535.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e4bd58aef5e80535.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ç³»åˆ—æ–‡ç« </h2>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/153">å…³äº React ä¸­ä½¿ç”¨ wx-open-launch-weapp å”¤èµ·å¾®ä¿¡å°ç¨‹åº</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/154">wx-open-launch-weapp æ ·å¼é—®é¢˜</a></li>
</ul>
<h2>èƒŒæ™¯</h2>
<p>ä¸Šç¯‡ä»‹ç»äº†å¦‚ä½•åœ¨ React ä¸­å¼•å…¥ wx-open-launch-weappã€‚å®Œäº†ä¹‹åï¼Œè¯¥æ ‡ç­¾è®¾ç½®æ ·å¼éå¸¸åœ°è›‹ç–¼ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b49c98749eee768b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç”±äºåœ¨ <code>&lt;wx-open-launch-weapp&gt;</code> è®¾ç½®æ ·å¼ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œç”šè‡³ä¸èµ·ä½œç”¨ï¼Œå› æ­¤æˆ‘æ˜¯è¿™æ ·è®¾è®¡çš„ï¼š</p>
<ul>
<li><code>container</code> ä¸ºç‚¹å‡»å”¤èµ·å°ç¨‹åºçš„åŒºåŸŸï¼ˆç›¸å¯¹å®šä½ï¼‰</li>
<li><code>content</code> åˆ™æ˜¯è¯¥åŒºåŸŸçš„å±•ç¤ºå†…å®¹ï¼Œ<code>wx-open-launch-weapp</code> åˆ™æ˜¯å æ»¡å”¤èµ·åŒºåŸŸï¼ˆç»å¯¹å®šä½ï¼‰ã€‚</li>
</ul>
<pre><code class="language-jsx">&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;content&quot;&gt;é¡µé¢å†…å®¹&lt;/div&gt;
  &lt;wx-open-launch-weapp&gt;çœç•¥äº†ä¸€éƒ¨åˆ†ä»£ç &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.container {
  position: relative;
  margin: 30px;
  height: 182px;
}

.content {
  width: 100%;
  height: 100%;
}
</code></pre>
<blockquote>
<p>ç®€åŒ–ç‰ˆï¼Œå®Œæ•´ç¤ºä¾‹è¯·çœ‹æ–‡æœ«ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿåé¢çš„æ–¹æ¡ˆä¼šç»™å‡ºç­”æ¡ˆã€‚</p>
<h2>æ–¹æ¡ˆä¸€</h2>
<p>å½“å‰éœ€æ±‚ï¼Œç”±äºæˆ‘çš„ <code>content</code> éƒ¨åˆ†æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå› æ­¤æˆ‘çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯è¿™æ ·çš„ã€‚</p>
<blockquote>
<p>ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œæ·»åŠ äº†èƒŒæ™¯è‰²ã€‚å…¶ä¸­ç´«è‰²éƒ¨åˆ†ä¸º <code>&lt;wx-open-launch-weapp&gt;</code> åŒºåŸŸï¼Œç²‰çº¢éƒ¨åˆ†ä¸º <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> åŒºåŸŸã€‚</p>
</blockquote>
<pre><code class="language-jsx">&lt;div class=&quot;container&quot;&gt;
  &lt;wx-open-launch-weapp
    username=&quot;gh_xxxxxxxx&quot;
    path=&quot;pages/index/index.html&quot;
    style={{ width: '100%', height: '100%', opacity: 0.3, background: 'blue' }}
  &gt;
    &lt;script type=&quot;text/wxtag-template&quot;&gt;
      &lt;div style={{ opacity: 0.3, background: 'red' }} /&gt;
    &lt;/script&gt;
  &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.container {
  margin: 30px;
  height: 182px;
  background-image: url(../../../images/banner-movecar.png);
  background-repeat: no-repeat;
  background-position: center center;
  background-size: 100% 100%;
}
</code></pre>
<p>å°† <code>&lt;wx-open-launch-weapp&gt;</code> å®½é«˜è®¾ä¸º <code>100%</code>ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æ•ˆæœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2eb53bd847bd4c91.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>æ­¤æ—¶åªå‡ºç°äº†ç´«è‰²éƒ¨åˆ†ï¼Œä¸”ç´«è‰²éƒ¨åˆ†ç‚¹å‡»ä¹Ÿæ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œä¸èƒ½å”¤èµ·å°ç¨‹åº</strong>ã€‚</p>
<p>æˆ‘æƒ³æ˜¯ä¸æ˜¯ <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> æœªè®¾ç½®å®½é«˜çš„é—®é¢˜ï¼Œå°†å…¶è®¾ç½®ä¸º <code>100%</code> ä¹‹åï¼Œæ•ˆæœä¸€æ ·å‡æ— æ•ˆã€‚</p>
<h2>æ–¹æ¡ˆäºŒ</h2>
<p>æ–¹æ¡ˆä¸€æµäº§ä¹‹åï¼Œæƒ³åˆ°ä¼šä¸ä¼šæ˜¯ <code>100%</code> ä¸ç”Ÿæ•ˆï¼Œäºæ˜¯æƒ³ç€å°†å®½é«˜è®¾ç½®ä¸ºå…·ä½“å€¼ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-html">&lt;div class=&quot;container&quot;&gt;
  &lt;wx-open-launch-weapp
    username=&quot;gh_xxxxxxxx&quot;
    path=&quot;pages/index/index.html&quot;
    style={{ width: '6.9rem', height: '1.82rem', opacity: 0.3, background: 'blue' }}
  &gt;
    &lt;script type=&quot;text/wxtag-template&quot;&gt;
      &lt;div style={{ width: '100%', height: '100%', opacity: 0.3, background: 'red' }} /&gt;
    &lt;/script&gt;
  &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9749d5406f203b6d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å°½ç®¡ <code>&lt;wx-open-launch-weapp&gt;</code> å æ»¡ <code>container</code> çš„å®½åº¦ï¼Œä½†é«˜åº¦...</p>
<p>æ¥ç€å°è¯•è®¾ä¸º <code>{{ width: '6.9rem', height: '100%'  }}</code>ï¼Œæ•ˆæœå®Œå…¨ä¸€è‡´ï¼Œé«˜åº¦ä»æ— æ³•å æ»¡ <code>container</code> çš„é«˜åº¦ã€‚</p>
<blockquote>
<p>PSï¼šé¡¹ç›®è®¾ç½® <code>100px</code> å¯¹åº”çš„æ˜¯ <code>1rem</code>ã€‚</p>
</blockquote>
<p>æˆ‘åˆæƒ³æ˜¯ä¸æ˜¯ <code>rem</code> å•ä½é—®é¢˜ï¼Œç„¶åæˆ‘åˆæ”¹ä¸º <code>{{ width: '690px', height: '182px'  }}</code> çœ‹çœ‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Œä½†é«˜åº¦ä»ç„¶å¦‚ä¸Šå›¾ä¸€æ ·ï¼Œå¯å®½åº¦å€’æ˜¯æœ‰å˜åŒ–ã€‚</p>
<p>å¤šæ¬¡è°ƒæ•´å®½é«˜åŠå…¶å•ä½åå‘ç°ï¼š<strong>å®½åº¦å¯æ§ï¼Œå¯é«˜åº¦å§‹ç»ˆå¦‚ä¸€</strong>ã€‚</p>
<p>æ— å¥ˆ.jpg</p>
<h2>æ–¹æ¡ˆä¸‰</h2>
<p>åˆ°è¿™é‡Œæƒ³åäº†ï¼Œæˆ‘æƒ³ç€å…ˆè§£å†³ <code>&lt;wx-open-launch-weapp&gt;</code> å æ»¡ <code>container</code> çš„é—®é¢˜ï¼Œæš‚æ—¶å¿½ç•¥ <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> çš„é—®é¢˜ã€‚</p>
<p>æ—¢ç„¶æ–¹æ¡ˆäºŒå°è¯•äº†å„ç§å¯èƒ½æ€§ï¼Œæ— è®ºæ€ä¹ˆè®¾ç½®å®½é«˜ä»ä¸å°½äººæ„ã€‚äºæ˜¯é‡‡ç”¨<strong>ç»å¯¹å¸ƒå±€</strong>çœ‹çœ‹ï¼š</p>
<blockquote>
<p>æ­¤å‰è®¾ç½®äº†èƒŒæ™¯è‰²æ¥åŒºåˆ†ï¼Œå°† <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> åŒºåŸŸå®½åº¦æš‚æ—¶è®¾ä¸º <code>90%</code> ä»¥ä¾¿äºå¯¹æ¯”ã€‚</p>
</blockquote>
<pre><code class="language-jsx">&lt;div class=&quot;container&quot;&gt;
  &lt;wx-open-launch-weapp
    username=&quot;gh_xxxxxxxx&quot;
    path=&quot;pages/index/index.html&quot;
    style={{ position: 'absolute', width: '100%', height: '100%', opacity: 0.3, background: 'blue' }}
  &gt;
    &lt;script type=&quot;text/wxtag-template&quot;&gt;
      &lt;div style={{ width: '90%', height: '100%', opacity: 0.3, background: 'red' }} /&gt;
    &lt;/script&gt;
  &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-css">.container {
  position: relative
  /* å…¶ä»–ä¸å˜ */
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d55e976b786471bc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¥½åƒçœ‹åˆ°å¸Œæœ›äº†ï¼Œ<code>&lt;wx-open-launch-weapp&gt;</code> å·²å æ»¡ <code>container</code> äº†ã€‚</p>
<p>ä½† <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> çš„åŒºåŸŸä»ç„¶æ²¡æœ‰å±•ç¤ºå‡ºæ¥ï¼Œé‚£æˆ‘æ˜¯ä¸ä¹Ÿè¦è®¾ä¸ºç»å¯¹å¸ƒå±€å‘¢ï¼Œè¯•è¯•çœ‹ï¼š</p>
<pre><code class="language-jsx">&lt;div class=&quot;container&quot;&gt;
  &lt;wx-open-launch-weapp
    username=&quot;gh_xxxxxxxx&quot;
    path=&quot;pages/index/index.html&quot;
    style={{ position: 'absolute', width: '100%', height: '100%', opacity: 0.3, background: 'blue' }}
  &gt;
    &lt;script type=&quot;text/wxtag-template&quot;&gt;
      &lt;div style={{ position: 'absolute', width: '90%', height: '100%', opacity: 0.3, background: 'red' }} /&gt;
    &lt;/script&gt;
  &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>PSï¼šæ³¨æ„è¿™é‡Œå®½åº¦æ˜¯æ²¡é—®é¢˜çš„ï¼Œå†™æˆ <code>100%</code> å°±èƒ½æ¨ªå‘å æ»¡ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0e687035d880bed1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¥½åƒå¿«æˆåŠŸäº†ï¼Œé«˜åº¦è¿˜æ˜¯ä¸å¯¹ã€‚å…¶ä¸­ç´«è‰²éƒ¨åˆ†å±äº <code>&lt;wx-open-launch-weapp&gt;</code>ï¼Œè€Œç²‰çº¢éƒ¨åˆ†å±äº <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code>ã€‚æ‰€ä»¥ç‚¹å‡»ç²‰çº¢åŒºåŸŸå¯ä»¥æ­£å¸¸å”¤èµ·å°ç¨‹åºäº†ã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å‘ç°äº†ï¼Œç¼ºçš„é‚£éƒ¨åˆ†é«˜åº¦è·Ÿæœªè®¾ç½®å¸ƒå±€æ—¶çš„é«˜åº¦æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œæˆ‘ä¹Ÿæ²¡æ‰¾åˆ°åŸå› ã€‚æœ‰çŸ¥é“çš„åŒå­¦å¯ä»¥å‘Šè¯‰æˆ‘å“¦ï¼Œè°¢è°¢ã€‚</p>
<blockquote>
<p>è‹¥å°† <code>&lt;script type=&quot;text/wxtag-template&quot;&gt;</code> è®¾ä¸º <code>relative</code> å¸ƒå±€ï¼Œæˆ‘è¯•äº†ï¼Œå‘ç°æ˜¯ä¸è¡Œçš„ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œåˆæƒ³åˆ°å°† <code>top</code> è®¾ä¸º <code>0</code>ï¼Œå‘ç°å¯ä»¥äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7aef5ae7be7d48ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸ºäº†å…¼å®¹æ€§ï¼Œäºæ˜¯æˆ‘è°¨æ…åœ°å°† <code>top</code>ã€<code>left</code> å‡è®¾ä¸º <code>0</code>ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæ„Ÿè§‰å¯ä»¥æ”¶å°¾äº†ã€‚</p>
<h2>æœ€ç»ˆç‰ˆ</h2>
<p>ä¸Šæ–‡æ˜¯è¿™æ ·è®¾è®¡çš„ï¼š</p>
<ul>
<li><code>container</code> ä¸ºç‚¹å‡»å”¤èµ·å°ç¨‹åºçš„åŒºåŸŸï¼ˆç›¸å¯¹å®šä½ï¼‰</li>
<li><code>content</code> åˆ™æ˜¯è¯¥åŒºåŸŸçš„å±•ç¤ºå†…å®¹ï¼Œ<code>wx-open-launch-weapp</code> åˆ™æ˜¯å æ»¡å”¤èµ·åŒºåŸŸï¼ˆç»å¯¹å®šä½ï¼‰ã€‚</li>
</ul>
<p>ä½†ç”±äºå‰é¢å®½é«˜é—®é¢˜ï¼Œå°±é‚£ä¹ˆéš¾æäº†ï¼Œæˆ‘æƒ³æŠŠé¡µé¢å…ƒç´ ä¸å”¤èµ·å°ç¨‹åºçš„åŒºåŸŸåˆ†å¼€æ¥ï¼Œæ˜¯ä¸æ˜¯çœå¿ƒå¾ˆå¤šã€‚</p>
<p>å®Œæ•´ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">import React, { useState } from 'react'
import style from './index.scss'

export default function Demo() {
  return (
    &lt;div className={style.container}&gt;
      &lt;div className={style.content}&gt;
        {/* è¿™é‡Œå†™é¡µé¢å†…å®¹ */}
      &lt;/div&gt;
      &lt;wx-open-launch-weapp
        username=&quot;gh_xxxxxxxx&quot;
        path=&quot;pages/index/index.html&quot;
        style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }}
      &gt;
        &lt;script type=&quot;text/wxtag-template&quot;&gt;
          {/* è¿™é‡Œå”¤èµ·å°ç¨‹åºçš„ç‚¹æŒ‰åŒºåŸŸ */}
          &lt;div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', opacity: 0 }} /&gt;
        &lt;/script&gt;
      &lt;/wx-open-launch-weapp&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<pre><code class="language-scss">// index.scss
.container {
  position: relative;
  margin: 30px;
  height: 182px;
}

.content {
  width: 100%;
  height: 100%;
  background-image: url(../../../images/banner-movecar.png);
  background-repeat: no-repeat;
  background-position: center center;
  background-size: 100% 100%;
}
</code></pre>
<p>åäº†ä¸‰æ–¤è¡€ï¼Œåº†å¹¸çš„æ˜¯å¯ä»¥æ„‰å¿«åœ°å”¤èµ·å°ç¨‹åºäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-73bfc193a217e68d.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº React ä¸­ä½¿ç”¨ wx-open-launch-weapp å”¤èµ·å¾®ä¿¡å°ç¨‹åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/153</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/153</guid>
            <pubDate>Sat, 25 Feb 2023 14:18:58 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0ff32ff14994a6e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0ff32ff14994a6e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ç³»åˆ—æ–‡ç« </h2>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/153">å…³äº React ä¸­ä½¿ç”¨ wx-open-launch-weapp å”¤èµ·å¾®ä¿¡å°ç¨‹åº</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/154">wx-open-launch-weapp æ ·å¼é—®é¢˜</a></li>
</ul>
<h2>èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨åšä¸­ç§‹å›½åº†æ´»åŠ¨ï¼Œå…¶ä¸­ä¸€ä¸ªéœ€æ±‚æ˜¯åœ¨ H5 é¡µé¢ä¸­å”¤èµ·å¾®ä¿¡å°ç¨‹åºã€‚</p>
<p>å‰ä¸ä¹…ï¼Œå¾®ä¿¡ JSSDK å¼€æ”¾äº†è¯¥æ¥å£ <code>wx-open-launch-weapp</code> ï¼Œä»…æ”¯æŒå¾®ä¿¡æµè§ˆå™¨å†…å”¤èµ·å°ç¨‹åºã€‚<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html#2">å®˜æ–¹æ–‡æ¡£</a></p>
<p>è®°å½•ä¸€ä¸‹è¸©å‘çš„è¿‡ç¨‹ã€‚</p>
<h2>é‡è¦å‰æ</h2>
<blockquote>
<p>[!WARNING]
å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå¦åˆ™æ¸²æŸ“ä¸å‡ºæ¥ã€‚</p>
</blockquote>
<ul>
<li>
<p><strong>å·²è®¤è¯çš„æœåŠ¡å·</strong>ï¼šæœåŠ¡å·ç»‘å®šâ€œJSæ¥å£å®‰å…¨åŸŸåâ€ä¸‹çš„ç½‘é¡µå¯ä½¿ç”¨æ­¤æ ‡ç­¾è·³è½¬ä»»æ„åˆæ³•åˆè§„çš„å°ç¨‹åºã€‚</p>
</li>
<li>
<p><strong>å·²è®¤è¯çš„éä¸ªäººä¸»ä½“çš„å°ç¨‹åº</strong>ï¼šä½¿ç”¨å°ç¨‹åºäº‘å¼€å‘çš„<a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/staticstorage/introduction.html">é™æ€ç½‘ç«™æ‰˜ç®¡</a>ç»‘å®šçš„åŸŸåä¸‹çš„ç½‘é¡µï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ ‡ç­¾è·³è½¬ä»»æ„åˆæ³•åˆè§„çš„å°ç¨‹åºã€‚</p>
</li>
</ul>
<p>è¿™é‡Œè¸©å‘äº†ã€‚æˆ‘ä¸€ç›´ä»¥ä¸ºç”Ÿäº§ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒéƒ½æ˜¯åŒä¸€ä¸ªå…¬ä¼—å·ï¼ˆæœåŠ¡å·ï¼‰ã€‚åæ¥é—®äº†åç«¯æ‰çŸ¥é“ï¼Œæµ‹è¯•ç¯å¢ƒæ˜¯ä¸€ä¸ªç§äººå…¬ä¼—å·ï¼ˆè®¢é˜…å·ï¼‰ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•ç¯å¢ƒæ£é¼“äº†åŠå¤©ä¹Ÿæ²¡å¼„å‡ºæ¥ï¼ ğŸ˜”</p>
<h2>ç‰ˆæœ¬è¦æ±‚</h2>
<blockquote>
<p>è¦çœŸæœºä¸Šæ‰æœ‰æ•ˆæœï¼Œå¾®ä¿¡å¼€å‘å·¥å…·æ˜¯çœ‹ä¸åˆ°çš„ï¼</p>
</blockquote>
<ul>
<li>å¾®ä¿¡ JS-SDK ç‰ˆæœ¬ï¼š1.6.0 åŠä»¥ä¸Š</li>
<li>å¾®ä¿¡ç‰ˆæœ¬ï¼š7.0.12 åŠä»¥ä¸Š</li>
<li>ç³»ç»Ÿç‰ˆæœ¬ï¼šiOS 10.3 åŠä»¥ä¸Šã€Android 5.0 åŠä»¥ä¸Š</li>
</ul>
<h2>wx.config</h2>
<pre><code class="language-js">wx.config({
  debug: true, // å¼€å¯è°ƒè¯•æ¨¡å¼,è°ƒç”¨çš„æ‰€æœ‰apiçš„è¿”å›å€¼ä¼šåœ¨å®¢æˆ·ç«¯alertå‡ºæ¥ï¼Œè‹¥è¦æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°ï¼Œå¯ä»¥åœ¨pcç«¯æ‰“å¼€ï¼Œå‚æ•°ä¿¡æ¯ä¼šé€šè¿‡logæ‰“å‡ºï¼Œä»…åœ¨pcç«¯æ—¶æ‰ä¼šæ‰“å°
  appId: '', // å¿…å¡«ï¼Œå…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†
  timestamp: '', // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³
  nonceStr: '', // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²
  signature: '',// å¿…å¡«ï¼Œç­¾å
  jsApiList: [], // å¿…å¡«ï¼Œéœ€è¦ä½¿ç”¨çš„JSæ¥å£åˆ—è¡¨
  openTagList: [ 'wx-open-launch-weapp' ] // å¯é€‰ï¼Œéœ€è¦ä½¿ç”¨çš„å¼€æ”¾æ ‡ç­¾åˆ—è¡¨
})
</code></pre>
<blockquote>
<p>æˆ‘çœ‹è¿‡<a href="https://developers.weixin.qq.com/community/develop/article/doc/00002a05760be03915caee70e51413">æŸå¸–</a>è¯´ï¼Œå³ä½¿æ²¡ç”¨åˆ° <code>jsApiList</code>ï¼Œä¹Ÿè¦æ˜¾å¼é…ç½® <code>jsApiList: []</code>ï¼Œè¿™æ · <code>wx.config()</code> æ‰èƒ½ç”Ÿæ•ˆã€‚ä½†æˆ‘é¡¹ç›®æœ¬èº«å°±æœ‰ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰å»éªŒè¯ã€‚</p>
</blockquote>
<p>å¯é€šè¿‡æŒ‡å®š <code>debug: true</code> æ¥éªŒè¯ <code>wx.config()</code> æ˜¯å¦æˆåŠŸã€‚</p>
<p>åªæœ‰é…ç½®æˆåŠŸäº†ï¼Œåç»­çš„åŠŸèƒ½æ‰èƒ½å®ç°ã€‚</p>
<h2>wx-open-launch-weapp</h2>
<p>æä¸€å˜´ï¼Œåˆ«å¼„é”™æ ‡ç­¾äº†ï¼Œé•¿å¾—æœ‰ç‚¹åƒï¼</p>
<ul>
<li><code>&lt;wx-open-launch-app&gt;</code> æ‰“å¼€ APP æ ‡ç­¾</li>
<li><code>&lt;wx-open-launch-weapp&gt;</code> æ‰“å¼€å¾®ä¿¡å°ç¨‹åºæ ‡ç­¾</li>
</ul>
<blockquote>
<p>[!NOTE]
å®˜æ–¹æ–‡æ¡£æœ‰æ›´æ–°ï¼Œæ”¯æŒæ›´å¤šå±æ€§ï¼Œè¯¦è§<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html#%E8%B7%B3%E8%BD%AC%E5%B0%8F%E7%A8%8B%E5%BA%8F%EF%BC%9Awx-open-launch-weapp">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<p>å±æ€§ï¼š</p>
<ul>
<li>
<p><strong>username</strong>ï¼ˆå¿…å¡«ï¼‰ï¼šæ‰€éœ€è·³è½¬çš„<strong>å°ç¨‹åºåŸå§‹ id</strong>ã€‚æ˜¯ä»¥ <code>gh_</code> å¼€å¤´çš„åŸå§‹ idï¼Œéä»¥ <code>wx</code> å¼€å¤´çš„å°ç¨‹åº APPIDã€‚</p>
</li>
<li>
<p><strong>path</strong>ï¼ˆéå¿…å¡«ï¼‰ï¼šæ‰€éœ€è·³è½¬çš„å°ç¨‹åºå†…é¡µé¢è·¯å¾„åŠå‚æ•°ã€‚é¡µé¢è·¯å¾„å¿…é¡»æ·»åŠ <code>.html</code>åç¼€ï¼Œæ¯”å¦‚<code>pages/index/index.html</code>ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ React çš„å†™æ³•ï¼Œå…¶ä»–çš„æ¡†æ¶æˆ–åº“æˆ‘æ²¡ç‰¹æ„å»å†™è¿‡ï¼Œå¯ä»¥å‚è€ƒ <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<blockquote>
<p>ä½†çœ‹å¾®ä¿¡æ–‡æ¡£è¦å¸¦ä¸€åŒæ…§çœ¼ï¼ŒåˆæœŸå®˜æ–¹ç¤ºä¾‹ä¼¼ä¹æœ‰è¯­æ³•é”™è¯¯ï¼Œç°åœ¨ä¼¼ä¹ä¿®å¤äº†ã€‚</p>
</blockquote>
<p>React ä¸­ä¸æ”¯æŒç›´æ¥å†™ <code>&lt;template /&gt;</code> æ ‡ç­¾ï¼Œéœ€è¦ä½¿ç”¨ <code>&lt;script type=&quot;text/wxtag-template&quot; /&gt;</code> æ›¿æ¢ã€‚æˆ–è€ƒè™‘ä½¿ç”¨ <a href="https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html">dangerouslySetInnerHTML</a>ã€‚</p>
<pre><code class="language-jsx">&lt;div style={{ position: 'relative', width: '6.3rem', height: '2.46rem' }}&gt;
  &lt;div&gt;å”¤èµ·å°ç¨‹åºçš„é¡µé¢å…ƒç´ ï¼Œå¦‚æŒ‰é’®ç­‰&lt;/div&gt;
  &lt;wx-open-launch-weapp
    id=&quot;launch-btn&quot;
    username=&quot;gh_****&quot;
    path=&quot;/pages/index/index.html&quot;
    style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }}
  &gt;
    &lt;script type=&quot;text/wxtag-template&quot;&gt;
      &lt;div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', opacity: 0 }} /&gt;
    &lt;/script&gt;
  &lt;/wx-open-launch-weapp&gt;
&lt;/div&gt;
</code></pre>
<p>è‹¥ä½¿ç”¨ TS é‡åˆ°</p>
<pre><code>Property 'wx-open-launch-weapp' does not exist on type 'JSX.IntrinsicElements'.
</code></pre>
<p>å¯æ·»åŠ ç±»å‹å£°æ˜ï¼š</p>
<pre><code class="language-ts">declare global {
  namespace JSX {
    interface IntrinsicElements {
      'wx-open-launch-weapp': React.DetailedHTMLProps&lt;
        React.HTMLAttributes&lt;HTMLElement&gt;,
        HTMLElement
      &gt; &amp; {
        username: string
        path?: string
      }
    }
  }
}
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/00048ee3af87a0bd09aaee4c35b800?jumpto=comment&amp;commentid=00004e8f228440dd0caae0a29568">react é‡Œé¢ h5 wx-open-launch-weapp è·³è½¬å°ç¨‹åºæŒ‰é’®æ ·å¼æ— æ³•è®¾ç½®ï¼Ÿ</a></li>
<li><a href="https://juejin.im/post/6868526637458128903">å…¬ä¼—å·è·³è½¬ H5</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/doc/0004c86fcf80801413aab38fc5c000?_at=1576086274183">react é‡Œé¢ h5 wx-open-launch-weapp ä¸æ˜¾ç¤ºï¼Œæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°ç¨‹åºå¯åŠ¨å‚æ•°ç›¸å…³é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/152</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/152</guid>
            <pubDate>Sat, 25 Feb 2023 14:15:50 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€æ”¯ä»˜å®å°ç¨‹åº</h3>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://opendocs.alipay.com/mini/framework/app-detail">æ–‡æ¡£ä»‹ç»</a></li>
<li><a href="https://opensupport.alipay.co]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€æ”¯ä»˜å®å°ç¨‹åº</h3>
<p>ç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://opendocs.alipay.com/mini/framework/app-detail">æ–‡æ¡£ä»‹ç»</a></li>
<li><a href="https://opensupport.alipay.com/support/helpcenter/142/201602475172?ant_source=manual&amp;recommend=9784af7814a1ec663089e796d8a7b4ce">å°ç¨‹åºè·³è½¬èƒ½åŠ›ä»‹ç»</a></li>
<li><a href="https://opensupport.alipay.com/support/helpcenter/144/201602504467?ant_source=antsupport">ä¸‰æ–¹ APP /æµè§ˆå™¨å¦‚ä½•è·³è½¬å°ç¨‹åº</a></li>
<li><a href="https://opensupport.alipay.com/support/helpcenter/142/201602496413?ant_source=antsupport">å°ç¨‹åº scheme é“¾æ¥ä»‹ç»</a></li>
</ul>
<pre><code>// scheme é“¾æ¥
alipays://platformapi/startapp?appId=[appId]&amp;page=[pagePath]&amp;query=[params]
</code></pre>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>appId</td>
<td>è¦è·³è½¬çš„ç›®æ ‡å°ç¨‹åº appId</td>
<td><code>20170713077xxxxx</code></td>
</tr>
<tr>
<td>pagePath</td>
<td>è¦è·³è½¬åˆ°ç›®æ ‡å°ç¨‹åºçš„å…·ä½“ page é¡µé¢ï¼Œè¯¥å€¼ç­‰äº app.json é‡Œé¢çš„é…ç½®å€¼ï¼›å¦‚æœä¸å¸¦ page å­—æ®µï¼Œé»˜è®¤è·³è½¬åˆ°å°ç¨‹åºé¦–é¡µã€‚<br><br><strong>æ³¨æ„ï¼šå¦‚ pagePath éœ€è¦å¸¦å‚æ•°ï¼Œä¹Ÿè¦è¿›è¡Œ UrlEncode å¤„ç†ã€‚</strong></td>
<td><code>pages/index/index</code></td>
</tr>
<tr>
<td>query</td>
<td>è¡¨ç¤ºä»å¤–éƒ¨ APP æºå¸¦çš„å‚æ•°é€ä¼ åˆ°ç›®æ ‡å°ç¨‹åºï¼›å¦‚æœä¸éœ€è¦æºå¸¦å‚æ•°ç»™å°ç¨‹åºï¼Œå¯ä»¥ä¸å¸¦è¯¥å‚æ•°ã€‚<br><br>queryï¼šå¯åŠ¨å‚æ•°ï¼Œå†…å®¹æŒ‰ç…§æ ¼å¼ä¸ºï¼š<strong>å‚æ•°å=å‚æ•°å€¼&amp;å‚æ•°å=å‚æ•°å€¼</strong>ã€‚<br><br><strong>æ³¨æ„ï¼šquery æºå¸¦çš„å¯åŠ¨å‚æ•°å¿…é¡»è¿›è¡Œ UrlEncode å¦åˆ™åªèƒ½è·å–ç¬¬ä¸€ä¸ªå‚æ•°!</strong></td>
<td><code>xx%3Dxx</code></td>
</tr>
</tbody>
</table>
<h5>1. åº”ç”¨é€»è¾‘</h5>
<p>æ¯æ¬¡é€šè¿‡ scheme è°ƒç”¨ï¼Œå‰ç«¯è¡¨ç°æ˜¯é‡æ–°è§¦å‘ <code>onLaunch</code> å’Œ <code>onShow</code>ï¼Œéƒ½ä¼šä¼ å‚ç»™ <code>app.js</code> çš„ <code>onLaunch</code> å’Œ <code>onShow</code>ï¼ŒåŸºç¡€é¡µé¢ä¼šé‡æ–°è§¦å‘ <code>onLoad</code> å’Œ <code>onShow</code> æ–¹æ³•ã€‚</p>
<p>åœ¨ä¿æ´»æœŸé—´ï¼ˆ5åˆ†é’Ÿï¼‰ï¼Œæ¯”å¦‚é”å±ä¹‹åï¼Œä¼šé‡æ–°è§¦å‘ <code>onShow</code> æ–¹æ³•ï¼Œä½†æ˜¯å´æ²¡æ³•è·å–å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¼ å‚ scheme åªä¼šåœ¨è°ƒç”¨çš„æ—¶å€™è§¦å‘ä¸€æ¬¡ï¼Œå†æ¬¡å¯åŠ¨åªæ˜¯è§¦å‘ <code>onShow</code> ä¸ä¼šä¼ å‚ã€‚åªèƒ½å‰ç«¯åœ¨ <code>onShow</code> é‡Œåšç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h5>2. é¡µé¢çš„é€»è¾‘</h5>
<p>å½“å°ç¨‹åºç”¨ scheme ä»åå°å”¤èµ·çš„æ—¶å€™ï¼Œå…¶å®ç›¸å½“äºé‡æ–°è¢«æ‰“å¼€äº† <code>onLoad</code>ï¼Œè¿˜æœ‰ <code>onShow</code> éƒ½ä¼šè¢«è§¦å‘ã€‚</p>
<p>åœ¨ä¿æ´»æœŸé—´ï¼ˆ5åˆ†é’Ÿï¼‰è¢«é‡æ–°å”¤èµ·çš„æ—¶å€™ï¼Œå°±åªä¼šè§¦å‘ <code>onShow</code>ã€‚</p>
<h5>3. å°ç¨‹åºé€šè¿‡ scheme è·³è½¬å¦‚ä½•è·å–å¯åŠ¨å‚æ•°</h5>
<p>åœ¨å°ç¨‹åº <code>app.js</code> çš„ <code>onLaunch</code> æˆ– <code>onShow</code> è¿›è¡Œè·å–å¯åŠ¨å‚æ•°ã€‚</p>
<p>å¦‚æœå†·å¯åŠ¨ï¼Œåˆ™ä¼šåœ¨ <code>onLaunch(options)</code> ä¸­è·å¾—å‚æ•°ï¼› å¦‚æœä¸ºçƒ­å¯åŠ¨ï¼Œåˆ™ä¼šåœ¨ <code>onShow(options)</code> ä¸­è·å¾—å‚æ•°ã€‚å»ºè®®å†·å¯åŠ¨ä¸­è·å–ä¸äº†çš„æ—¶å€™ï¼Œå†å°è¯•åœ¨ <code>onShow</code> ä¸­è·å–ï¼Œè‹¥è¿˜æ˜¯è·å–ä¸äº†ï¼Œåˆ™å¯åˆ¤å®šä¸ºæ²¡æœ‰æ‹¿åˆ°è¯¥å‚æ•°ã€‚</p>
<h5>4. å…¶ä»–</h5>
<blockquote>
<p><code>my.switchTab()</code>ã€<code>my.navigateBack()</code> ä¸æ”¯æŒå¸¦å‚è·³è½¬ã€‚</p>
</blockquote>
<h3>äºŒã€å¾®ä¿¡å°ç¨‹åº</h3>
<p>å¤§åŒå°å¼‚ï¼Œåç»­è¡¥ä¸Š...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å°ç¨‹åºè½¬æ”¯ä»˜å®å°ç¨‹åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/151</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/151</guid>
            <pubDate>Sat, 25 Feb 2023 14:06:04 GMT</pubDate>
            <description><![CDATA[<p>ç¤¾åŒºå®˜æ–¹åˆ—å‡ºçš„å¸¸è§é—®é¢˜ï¼š<a href="https://openclub.alipay.com/read.php?tid=6471&amp;fid=66&amp;ant_source=zsearch">å°ç¨‹åºå¸¸è§é—®é¢˜æ±‡æ€»</a></p>
<h2>æ¡†æ¶ç›¸å…³</h2>
<ol>
<li>é¡µé¢æ ‡é¢˜ï¼š<code>nav]]></description>
            <content:encoded><![CDATA[<p>ç¤¾åŒºå®˜æ–¹åˆ—å‡ºçš„å¸¸è§é—®é¢˜ï¼š<a href="https://openclub.alipay.com/read.php?tid=6471&amp;fid=66&amp;ant_source=zsearch">å°ç¨‹åºå¸¸è§é—®é¢˜æ±‡æ€»</a></p>
<h2>æ¡†æ¶ç›¸å…³</h2>
<ol>
<li>é¡µé¢æ ‡é¢˜ï¼š<code>navigationBarTitleText</code> â†’ <code>defaultTitle</code>ã€‚</li>
</ol>
<h2>ç»„ä»¶</h2>
<ol>
<li><code>wx.showModal</code>ï¼Œåœ¨æ”¯ä»˜å®å°ç¨‹åºä¸Šæ‹†åˆ†ä¸º <code>my.alert</code> å’Œ <code>my.confirm</code>ï¼Œ <a href="https://docs.alipay.com/mini/api/ui-feedback">äº¤äº’åé¦ˆ</a>ã€‚</li>
<li>canvas:</li>
</ol>
<h2>API</h2>
<ol>
<li>
<p>å¾®ä¿¡æ”¯ä»˜ï¼š<a href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.requestPayment.html"><code>wx.request()</code></a> â†’ <a href="https://docs.alipay.com/mini/api/openapi-pay"><code>my.httpRequest()</code></a>ï¼ŒäºŒè€…å‚æ•°ä¸ä¸€è‡´ã€‚</p>
</li>
<li>
<p>ç¼“å­˜ï¼š <a href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.setStorageSync.html"><code>wx.setStorageSync(string key, any data)</code></a> â†’ <a href="https://docs.alipay.com/mini/api/storage"><code>my.setStorageSync({key: key, data: value})</code></a>ï¼Œ<code>getStorageSync</code> å’Œ <code>removeStorage</code> ä¹Ÿç±»ä¼¼ã€‚</p>
</li>
<li>
<p><code>wx.showToast</code> å…³äº loading çš„è¦æ”¹æˆï¼š<a href="https://docs.alipay.com/mini/api/ui-feedback"><code>my.showLoading</code></a>ï¼›<a href="https://docs.alipay.com/mini/api/ui-feedback"><code>my.showToast()</code></a> å†…å®¹å±æ€§ï¼Œå¾®ä¿¡å°ç¨‹åºæ˜¯ <code>title</code>ï¼Œæ”¯ä»˜å®å°ç¨‹åºæ˜¯ <code>content</code>ï¼Œä¸”æ²¡æœ‰<code>mask</code> å±æ€§ã€‚</p>
</li>
<li>
<p><code>&lt;form&gt;</code> ç»„ä»¶äº‹ä»¶ï¼š<code>bindreset â†’ onReset</code>ã€ <code>bindsubmit â†’ onSubmit</code>ã€‚</p>
</li>
<li>
<p><code>&lt;input&gt;</code>ã€<code>textarea</code> ç»„ä»¶äº‹ä»¶ï¼š<code>bindinput â†’ onInput</code>ã€<code>bindblur â†’ onBlur</code>ã€<code>bindfocus â†’ onFocus</code>ã€‚</p>
</li>
<li>
<p><code>&lt;canvas&gt;</code> ç»„ä»¶äº‹ä»¶ï¼š<code>onTouchstart â†’ onTouchStart</code>ã€<code>onTouchmove â†’ onTouchMove</code>ã€<code>onTouchend â†’ onTouchEnd</code>ï¼›ç»„ä»¶å±æ€§ï¼š<code>canvas-id â†’ id</code>ã€‚</p>
</li>
<li>
<p><code>&lt;div&gt;</code>ã€<code>&lt;span&gt;</code> æ ‡ç­¾åœ¨æ”¯ä»˜å®å°ç¨‹åºéƒ½ä¸æ”¯æŒï¼Œæ”¹æˆ <code>&lt;view&gt;</code>ã€<code>&lt;text&gt;</code> æ ‡ç­¾å³å¯ã€‚</p>
</li>
<li>
<p>æ‹¨æ‰“ç”µè¯
å¾®ä¿¡ï¼š<code>wx.makePhoneCall({ phoneNumber: '020-11183' })</code>
æ”¯ä»˜å®ï¼š<code>my.makePhoneCall({ number: '020-11183' })</code></p>
</li>
<li>
<p><code>my.alert(object)</code> æ²¡æœ‰â€œå–æ¶ˆâ€æŒ‰é’®ï¼Œä»¥åŠâ€œç¡®å®šâ€æŒ‰é’®çš„é”®ä¸ºï¼š<code>buttonText</code>ã€‚</p>
</li>
<li>
<p>æ”¯ä»˜å®å°ç¨‹åºä¸­ï¼Œå¦‚æœæ ‡ç­¾ä¸­å†™äº†ä¸¤ä¸ªæˆ–ä»¥ä¸Š <code>class</code> å±æ€§ï¼Œåªèƒ½è¯»å–ç¬¬ä¸€ä¸ªï¼Œå¯èƒ½æ˜¯ bugã€‚</p>
</li>
<li>
<p>ï¼ˆè¯·å¿½ç•¥ï¼Œè·Ÿæ”¯ä»˜å®å°ç¨‹åºæ— å…³ï¼‰ä¸€äº›å­—æ®µæ”¹å˜ï¼š
<code>wxChannel â†’ aliChannel</code>
<code>updateWxUserChannel â†’ updateAliUserChannel</code></p>
</li>
<li>
<p><code>&lt;checkbox&gt;</code> ç»„ä»¶çš„æ”¹å˜äº‹ä»¶å±æ€§ä¸ºï¼š<code>onChange=&quot;onChangeFn&quot;</code>ã€‚</p>
</li>
<li>
<p><code>my.getImageInfo</code> æœ‰å…¼å®¹æ€§çš„é—®é¢˜ï¼Œéœ€è¦åšå¤„ç†ã€‚åœ¨è”æƒ³æ‰‹æœºä¸Šæœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ”¯ä»˜å® APP ç‰ˆæœ¬è¿‡ä½çš„åŸå› ã€‚</p>
</li>
<li>
<p>åœ¨æ”¯ä»˜å®å°ç¨‹åº <code>my.uploadFile</code> æ¥å£ä¸­ï¼Œä¸éœ€è¦æŠŠå¤´éƒ¨ä¿¡æ¯è®¾ä¸º <code>header: { &quot;Content-Type&quot;: &quot;multipart/form-data&quot; }</code>ï¼Œè¿™ä¸ªå¯èƒ½å¯¼è‡´ä¸ªåˆ«æœºå‹æ¥å£è¿”å›æ•°æ®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡ã€‚è€Œå¾®ä¿¡å°ç¨‹åº <code>wx.uploadFile</code> ä¸­ï¼Œå¦‚æœå‘èµ· POST è¯·æ±‚ï¼Œåˆ™éœ€è¦æŠŠå¤´éƒ¨ä¿¡æ¯è®¾æˆä¸Šé¢é‚£æ ·ã€‚</p>
</li>
<li>
<p><code>this.setData()</code> æ–¹æ³•ï¼Œä» 1.7.0 ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>setData</code> å¯ä»¥æ¥å—ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨é¡µé¢æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚ä½¿ç”¨ <code>my.canIUse('page.setData.callback')</code>åšå…¼å®¹æ€§å¤„ç†ã€‚</p>
</li>
<li>
<p>åŸºç¡€åº“ç‰ˆæœ¬åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ef6872c2693e442c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åŸºç¡€åº“"></p>
<ol start="17">
<li>
<p><code>my.httpRequest</code> API æ¥å£å¤±è´¥è¿”å›çš„é”™è¯¯ç æè¿°æœ‰è¯¯ï¼Œå®˜æ–¹å·²ç¡®è®¤ï¼Œå¾…ä¿®æ­£ï¼<a href="https://docs.alipay.com/mini/api/network"><code>my.httpRequest</code></a>ã€‚</p>
</li>
<li>
<p><a href="https://docs.alipay.com/mini/component/picker"><code>&lt;picker&gt;</code></a> ä¸­åªèƒ½å«æœ‰ä¸€ä¸ªå­å…ƒç´ ã€‚è‹¥å¤šä¸ªå…ƒç´ ï¼Œéœ€è¦ç”¨ <code>&lt;view&gt;</code> æ‹¬èµ·æ¥ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºã€‚</p>
</li>
<li>
<p>ï¼ˆè¯·å¿½ç•¥ï¼Œéæ”¯ä»˜å® api ï¼‰å»æ‰å‡½æ•° <code>compareAppVersionToTarget</code> å’Œ <code>compareWxVersion</code>ã€‚</p>
</li>
<li>
<p>å¤šä¸ªç©ºæ ¼çš„é—®é¢˜ï¼š</p>
</li>
</ol>
<pre><code class="language-html">&lt;!-- å¾®ä¿¡å°ç¨‹åºæ”¯æŒï¼Œä½†ä½ç‰ˆæœ¬çš„æ”¯ä»˜å®å®¢æˆ·ç«¯ä¸å…¼å®¹è¿™ç§å†™æ³• --&gt;
&lt;text decode=&quot;{{true}}&quot; space=&quot;nbsp&quot;&gt;&amp;nbsp;&lt;/text&gt;

&lt;!-- å…¼å®¹ä½ç‰ˆæœ¬æ”¯ä»˜å®å®¢æˆ·ç«¯çš„å†™æ³• --&gt;
&lt;text style=&quot;white-space: pre-wrap&quot;&gt;{{' '}}&lt;/text&gt;
</code></pre>
<p>CSS3 ä¸º <code>white-space</code> æ–°å¢äº†<code>pre-line</code> å’Œ <code>pre-wrap</code> å±æ€§ï¼Œå‰è€…ä¼šå°†å¤šä¸ªç©ºæ ¼åˆæˆä¸€ä¸ªï¼Œåè€…ä¼šä¿ç•™æ‰€æœ‰ç©ºæ ¼ã€‚è¯¦æƒ…å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/qianlegeqian/p/3987235.html">white-space ä¸­ preã€pre-lineã€pre-wrap çš„åŒºåˆ«</a>ã€‚</p>
<ol start="21">
<li>
<p>æ–‡ä»¶ä¸‹è½½çš„ç›¸å…³æ¥å£ï¼ŒæˆåŠŸå›è°ƒé‡Œçš„è·¯å¾„ï¼š<code>res.tempFilePath â†’ res.apFilePath</code>ã€‚</p>
</li>
<li>
<p>é€‚é… iPhone X å¯¼èˆªçš„éœ€è¦ä¿®æ”¹ï¼Œæ”¯ä»˜å®é‡Œ <code>my.getSystemInfo</code> è·å–çš„ <code>res.model</code> å€¼ä¸ä¸€æ ·ã€‚</p>
</li>
<li>
<p>åˆ é™¤åœ°å€çš„å¼¹çª—ï¼š<code>wx.alert()</code> è¦æ”¹æˆ <code>my.confirm()</code>ã€‚</p>
</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è®°å½•å‰ç«¯é‡åˆ°çš„å‘ï¼Œå«å°ç¨‹åºï¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/150</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/150</guid>
            <pubDate>Sat, 25 Feb 2023 13:58:08 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-09-04</p>
<hr/>
<ol>
<li>react é¡¹ç›®æ— æ³•ï¼ˆçƒ­ï¼‰æ›´æ–°ï¼Œæ˜¯ç¼–è¯‘è·¯å¾„æ‰¾ä¸åˆ°ã€‚</li>
<li>åœ¨ç»å¯¹å¸ƒå±€ä¸­ï¼Œå½“ <code>left</code> ä¸º <code>0</code> æ—¶ï¼Œå¦‚æœä¸å†™ï¼Œåœ¨éƒ¨åˆ†æœºå‹çš„æµè§ˆå™¨ä¼šå‡ºç°é”™ä½ã€‚</li>
</ol>
<pre><co]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-09-04</p>
<hr/>
<ol>
<li>react é¡¹ç›®æ— æ³•ï¼ˆçƒ­ï¼‰æ›´æ–°ï¼Œæ˜¯ç¼–è¯‘è·¯å¾„æ‰¾ä¸åˆ°ã€‚</li>
<li>åœ¨ç»å¯¹å¸ƒå±€ä¸­ï¼Œå½“ <code>left</code> ä¸º <code>0</code> æ—¶ï¼Œå¦‚æœä¸å†™ï¼Œåœ¨éƒ¨åˆ†æœºå‹çš„æµè§ˆå™¨ä¼šå‡ºç°é”™ä½ã€‚</li>
</ol>
<pre><code class="language-css">div {
  position: absolute;
  left: 0;  /* åŠ ä¸Šæœ€å¥½ */
  top: 10px
}
</code></pre>
<ol start="3">
<li>React é¡¹ç›®ä¸­ï¼Œä¸€äº›çº¯æ–‡æœ¬é¡µé¢ï¼Œå¦‚æœè¦è®¾ç½®æ•´ä¸ª HTML é¡µé¢èƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥æŠŠä»–è®¾ä¸º <code>fixed</code> å¸ƒå±€ï¼Œå†è®¾ç½® <code>width</code> å’Œ <code>height</code> ä¸º <code>100%</code>ï¼Œå› ä¸º <code>fixed</code> å¸ƒå±€å‚è€ƒå¯¹è±¡æ˜¯ <code>body</code> çš„å®½åº¦ã€‚</li>
</ol>
<pre><code class="language-css">/* css æ ·å¼ */
div {
  width: 100%;
  height: 100%;
  position: fixed;
  left: 0;
  bottom: 0;
  overflow-y: scroll;
}
</code></pre>
<ol start="4">
<li>
<p>åœ¨ CSS3 æ ‡å‡†ä¸­ï¼Œä¼ªç±»ä½¿ç”¨å•å†’å· <code>:</code>ï¼Œè€Œä¼ªå…ƒç´ ä½¿ç”¨åŒå†’å· <code>::</code>ã€‚åœ¨æ­¤ä¹‹å‰çš„æ ‡å‡†ï¼Œä»–ä¿©éƒ½ä½¿ç”¨å•å†’å·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒå†’å·çš„å†™æ³•åœ¨ä½ç‰ˆæœ¬çš„IEæµè§ˆå™¨ä¸­å…¼å®¹æ€§æœ‰é—®é¢˜ï¼Œæ‰€ä»¥ä¸€äº›å¼€å‘è€…ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼Œä¼ªç±»å’Œä¼ªå…ƒç´ éƒ½ç”¨å•å†’å·çš„å†™æ³•ã€‚</p>
</li>
<li>
<p><code>rpx</code> æ˜¯å¾®ä¿¡å°ç¨‹åºçš„ CSS å°ºå¯¸å•ä½ï¼Œå°ç¨‹åºæŠŠä¸åŒçš„è®¾å¤‡ç»Ÿä¸€è§„å®šå±å¹•å®½åº¦ä¸º <code>750rpx</code>ï¼Œ<code>rpx</code> å¯ä»¥æ ¹æ®è®¾å¤‡å±å¹•çš„çœŸå®å®½åº¦è¿›è¡Œè‡ªé€‚åº”ã€‚å¸¸è§è®¾å¤‡çš„è½¬åŒ–å…³ç³»ï¼ˆ<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html?t=1476197492063">å°ç¨‹åºå¼€å‘æ–‡æ¡£</a>ï¼‰ï¼š</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>è®¾å¤‡</th>
<th>rpx æ¢ç®— px (å±å¹•å®½åº¦/750)</th>
<th>px æ¢ç®— rpx (750/å±å¹•å®½åº¦)</th>
</tr>
</thead>
<tbody>
<tr>
<td>iPhone 5</td>
<td>1rpx = 0.42px</td>
<td>1px = 2.34rpx</td>
</tr>
<tr>
<td>iPhone 6</td>
<td>1rpx = 0.5px</td>
<td>1px = 2rpx</td>
</tr>
<tr>
<td>iPhone 6 Plus</td>
<td>1rpx = 0.552px</td>
<td>1px = 1.81prx</td>
</tr>
</tbody>
</table>
<p>è¯´æ˜ä¸€ä¸‹ï¼ŒiPhone 6/7 çš„å±å¹•å®½åº¦æ˜¯ <code>375px</code>ï¼Œæ„å¤–ç€ <code>1px = 2rpx</code>ã€‚å¾ˆå¤šUIè®¾è®¡å¸ˆä»¥ iPhone6/7 ä½œä¸ºè§†è§‰ç¨¿ã€‚ï¼ˆæ’å¥è¯ï¼ŒiPhone 6/7 çš„ç‰©ç†åƒç´ æ˜¯ <code>750</code> ä¸ªï¼Œå³ç”¨ <code>2</code> ä¸ªåƒç´ è¡¨ç¤ºç½‘é¡µä¸­çš„ <code>1px</code>ï¼Œæ‰€ä»¥åœ¨ä»¥å‰ iPhone æ¯”ä¸€äº›æ™®é€šè®¾å¤‡æ˜¾å¾—æ›´åŠ ç»†è…»å°±æ˜¯è¿™ä¸ªåŸå› ã€‚<code>1px = 2rpx = 2</code> ä¸ªç‰©ç†åƒç´ ã€‚å¦‚æœè§‰å¾—æ··ä¹±çš„å¯ä»¥å¿½ç•¥è¿™å¥ï¼ï¼‰</p>
<ol start="6">
<li>
<p>å°ç¨‹åº <code>rem</code>ï¼ˆroot emï¼‰å•ä½ï¼Œè§„å®šå±å¹•å®½åº¦ä¸º <code>20rem</code>ï¼›<code>1rem = (750/20)rpx</code></p>
</li>
<li>
<p>é¼ æ ‡å½¢çŠ¶</p>
</li>
</ol>
<pre><code class="language-css">/* css æ ·å¼*/
div {
  cursor: default;  /* é»˜è®¤ï¼Œç®­å¤´ */
  cursor: pointer;  /* æ‰‹æŒ‡ */
}
</code></pre>
<ol start="8">
<li>
<p>npmï¼ˆnodejs package managerï¼‰ï¼Œnodejs åŒ…ç®¡ç†å™¨ï¼› <code>--save</code> çš„ç›®çš„æ˜¯å°†é¡¹ç›®å¯¹è¯¥åŒ…çš„ä¾èµ–å†™å…¥åˆ° <code>package.json</code> æ–‡ä»¶ä¸­ã€‚</p>
</li>
<li>
<p><code>box-shadow</code>ï¼Œå…¶ä¸­ IE6 å’Œ IE7 åº”è¯¥æ˜¯ä¸æ”¯æŒ <code>box-shadow</code> å±æ€§ã€‚</p>
</li>
</ol>
<pre><code class="language-css">/* css æ ·å¼*/
div {
  -moz-box-shadow:0 4px 4px rgba(0, 0, 0, 0.4);  /* ä¸éœ€è¦è®¾ç½®é€æ˜åº¦çš„ï¼Œç›´æ¥ä½¿ç”¨é¢œè‰²å€¼ */
  -webkit-box-shadow:0 4px 4px rgba(0, 0, 0, 0.4); 
  box-shadow:0 4px 4px rgba(0, 0, 0, 0.4); 
}
</code></pre>
<ol start="10">
<li>CSS3 è¾¹æ¡†</li>
</ol>
<pre><code class="language-css">/* cssæ ·å¼ */
div {
  border: 1px solid #eee;
  box-sizing: border-box;  /* å†…è¾¹æ¡†ï¼Œé»˜è®¤ */
  box-sizing: content-box;  /* å¤–è¾¹æ¡† */
}
</code></pre>
<ol start="11">
<li>
<p>åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ <code>&lt;map&gt;</code>ã€<code>&lt;canvas&gt;</code>ã€<code>&lt;video&gt;</code>ã€<code>&lt;textarea&gt;</code> æ˜¯ç”±å®¢æˆ·ç«¯åˆ›å»ºçš„åŸç”Ÿç»„ä»¶ï¼ŒåŸç”Ÿç»„ä»¶çš„å±‚çº§æ˜¯æœ€é«˜çš„ï¼Œæ‰€ä»¥é¡µé¢ä¸­çš„å…¶ä»–ç»„ä»¶æ— è®ºè®¾ç½® <code>z-index</code> ä¸ºå¤šå°‘ï¼Œéƒ½æ— æ³•ç›–åœ¨åŸç”Ÿç»„ä»¶ä¸Šã€‚ åŸç”Ÿç»„ä»¶æš‚æ—¶è¿˜æ— æ³•æ”¾åœ¨ <code>&lt;scroll-view&gt;</code> ä¸Šï¼Œä¹Ÿæ— æ³•å¯¹åŸç”Ÿç»„ä»¶è®¾ç½® css åŠ¨ç”»ã€‚ï¼ˆå®˜æ–¹è§£é‡Šï¼‰<code>&lt;map&gt;</code>ï¼Œ<code>&lt;video&gt;</code>ï¼Œ<code>&lt;canvas&gt;</code>ï¼Œ<code>&lt;textarea&gt;</code> æ˜¯åŸç”Ÿç»„ä»¶ï¼Œå±‚çº§ä½äº webview ä¹‹ä¸Šã€‚
åœ¨åŸç”Ÿæ§ä»¶ <code>&lt;cover-view&gt;</code> ä½œä¸ºçˆ¶å®¹å™¨æ—¶ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–æ§ä»¶åµŒå¥—ä½œä¸ºå­å…ƒç´ ï¼Œåªèƒ½ä½¿ç”¨ cover ç±»çš„æ§ä»¶ï¼Œä¾‹å¦‚ï¼š<code>&lt;cover-view&gt;</code>ã€<code>&lt;cover-image&gt;</code> ã€‚</p>
</li>
<li>
<p>ä¸åŒæ•°æ®ç±»å‹çš„å¸ƒå°”è¿ç®—ï¼ˆè¯¦ç»†è¯´æ˜ï¼š<a href="https://blog.csdn.net/mrhaoxiaojun/article/details/50946366">ç‚¹å‡»è¿™é‡Œ</a>ï¼‰
<code>if(a)</code>ï¼Œ<code>a</code> ä¸º <code>false</code>ã€<code>0</code>ã€<code>undefined</code>ã€<code>null</code>ã€<code>NaN</code>ã€<code>ç©ºå­—ç¬¦ä¸²</code> æ—¶éƒ½è¿”å› <code>false</code>ã€‚</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>è§„å¾‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object</td>
<td>éƒ½ä¸º <code>true</code></td>
<td></td>
</tr>
<tr>
<td>Number</td>
<td>åªæœ‰ <code>0</code> å’Œ <code>NaN</code> ä¸º <code>false</code></td>
<td></td>
</tr>
<tr>
<td>String</td>
<td>åªæœ‰ç©ºå­—ç¬¦ä¸²(<code>''</code>)ä¸º <code>false</code></td>
<td>ç©ºæ ¼å­—ç¬¦ä¸²(<code>' '</code>)ä¸º <code>true</code></td>
</tr>
<tr>
<td>Function</td>
<td>éƒ½ä¸º <code>true</code></td>
<td></td>
</tr>
<tr>
<td>null, undefined</td>
<td>éƒ½ä¸º <code>false</code></td>
<td></td>
</tr>
</tbody>
</table>
<ol start="13">
<li>å°ç¨‹åº <code>&lt;scroll-view&gt;</code> ä¸­çš„ <code>bindscrolltolower</code> æ–¹æ³•å¤±æ•ˆçš„åŸå› ï¼šéœ€è¦åœ¨ <code>app.wxss</code> ä¸­è®¾ç½® <code>page</code> çš„é«˜åº¦ä¸º <code>100%</code>ï¼Œå¹¶åœ¨ <code>&lt;scroll-view&gt;</code> ç»„ä»¶ä¸­è®¾ç½®é«˜åº¦ä¸º <code>100%</code>ã€‚</li>
</ol>
<pre><code>// app.wxss
page {
  height: 100%
}

// scroll-view ç»„ä»¶
&lt;scroll-view scroll-y=&quot;true&quot; style=&quot;height:100%&quot; bindscrolltolower=&quot;scrollLower&quot;&gt;&lt;/scroll-view&gt;
</code></pre>
<ol start="14">
<li>
<p><code>&lt;input&gt;</code> ç»„ä»¶ï¼Œåœ¨æ‰‹å†™è¾“å…¥çš„çŠ¶æ€ä¸‹ï¼Œå¯èƒ½ä¸ä¼šè§¦å‘ <code>bindinput</code> äº‹ä»¶ï¼Œä¸ºäº†ç¡®ä¿è·å–çš„ <code>value</code> å€¼æ­£ç¡®ï¼Œå¯ä»¥åœ¨ <code>bindblur</code> äº‹ä»¶ä¸­é€šè¿‡ <code>e.detail.value</code> è·å–æœ€æ–°çš„è¾“å…¥å€¼ã€‚</p>
</li>
<li>
<p><code>wx.scanCode</code> API è°ƒç”¨æ‰«ä¸€æ‰«ï¼Œæ‰«ç æˆåŠŸæˆ–è€…è¿”å›çš„æ—¶å€™ï¼Œåœ¨çœŸæœºä¸Šä¼šè°ƒç”¨ <code>onShow</code> ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœåœ¨åœ¨ <code>onShow</code> ä¸­è¯»å–ç¼“å­˜æ•°æ®ï¼Œéœ€è¦åŠ ä¸ªåˆ¤æ–­ï¼ŒæŠŠæ–°å€¼èµ‹è¿‡å»</p>
</li>
<li>
<p>æ–‡æœ¬ä¸æ¢è¡Œï¼Œæº¢å‡ºéƒ¨åˆ†ç”¨çœç•¥å·æ˜¾ç¤ºï¼š</p>
</li>
</ol>
<pre><code class="language-css">.text {
  width: 100px;    /* å¿…é¡»è¦è®¾ç½®å®½åº¦ */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: inline-block;
}
</code></pre>
<ol start="17">
<li>
<p>å–„ç”¨ <code>!!</code> å°†å˜é‡è½¬åŒ–ä¸ºå¸ƒå°”ç±»å‹ã€‚é™¤äº†<code>false</code>ã€<code>0</code>ã€<code>null</code>ã€<code>undefined</code>ã€<code>NaN</code> ã€<code>ç©ºå­—ç¬¦ä¸²</code>è¿”å› <code>false</code>ï¼Œå…¶ä½™çš„éƒ½è¿”å› <code>true</code>ã€‚ï¼ˆç©ºæ ¼å­—ç¬¦ä¸²ä¹Ÿæ˜¯è¿”å›trueï¼‰ã€‚</p>
</li>
<li>
<p>å¾®ä¿¡å°ç¨‹åºï¼šå½“é¡¹ç›®ä¸Šä¼ æˆ–è€…é¢„è§ˆç¼–è¯‘çš„æ—¶å€™å‡ºç°<code>æ— æ³•ä½¿ç”¨ä»£ç ä¿æŠ¤åŠŸèƒ½</code>çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºå½“å‰é¡¹ç›®å‹¾é€‰äº†<code>ä¸Šä¼ æ—¶è¿›è¡Œä»£ç ä¿æŠ¤</code>çš„é€‰é¡¹ï¼Œè€Œä¸”é¡¹ç›®æœ¬èº«å¼•ç”¨äº†ç¬¬ä¸‰æ–¹åº“ï¼Œæ‰å¯¼è‡´å‡ºç°è¿™æ ·çš„æƒ…å†µã€‚è§£å†³åŠæ³•æ˜¯ï¼šå…³é—­ä»£ç ä¿æŠ¤ã€‚</p>
</li>
<li>
<p>å¾®ä¿¡å°ç¨‹åºåœ¨ <code>&lt;scroll-view /&gt;</code> å­å…ƒç´ ä½¿ç”¨ <code>&lt;textarea /&gt;</code> åŸç”Ÿç»„ä»¶å¯èƒ½ä¼šæŠ¥é”™ï¼šå¦‚ï¼š<code>insertTextArea:fail</code> ç­‰ã€‚</p>
</li>
<li>
<p>æ”¯ä»˜å®å°ç¨‹åºå…³äº <code>&lt;cover-view /&gt;</code>ã€<code>&lt;cover-image /&gt;</code> çš„é—®é¢˜ï¼š</p>
</li>
</ol>
<ul>
<li><code>&lt;cover-view&gt;</code> é»˜è®¤ç™½è‰²èƒŒæ™¯ï¼Œè™½ç„¶<a href="https://opensupport.alipay.com/support/knowledge/46919/201602487825">å®˜æ–¹å›ç­”</a>æ˜¯ä¸èƒ½æ›´æ”¹ï¼Œä½†å¯é€šè¿‡å† app.acss é‡Œé¢æ·»åŠ æ ·å¼ä¿®æ”¹ï¼Œäº²æµ‹æœ‰æ•ˆï¼š</li>
</ul>
<pre><code class="language-css">cover-view {
  background-color: rgba(0, 0, 0, 0);
}
</code></pre>
<ul>
<li><code>&lt;cover-image&gt;</code> çš„ <code>border-radius</code> å±æ€§éƒ¨åˆ†æœºå‹æ— æ•ˆï¼Œ<a href="https://opensupport.alipay.com/support/knowledge/46919/201602487826">å®˜æ–¹å›ç­”</a>å¯ä¿®æ”¹ï¼Œä½†æ— æ•ˆï¼ˆå·²çŸ¥åä¸º P30 ä¸ç”Ÿæ•ˆï¼ŒiPhone éƒ½æœ‰æ•ˆï¼‰ï¼Œå¯èƒ½æ˜¯æ”¯ä»˜å®ç‰ˆæœ¬é—®é¢˜ï¼ˆ10.1.26ï¼‰</li>
</ul>
<ol start="21">
<li>æ”¯ä»˜å®å°ç¨‹åºå¼€å‘å·¥å…· Mac ç‰ˆåŒæ—¶å¼€å¯å¤šä¸ªé¡¹ç›®çš„æ–¹æ³•ï¼š</li>
</ol>
<pre><code>$ open -n /Applications/å°ç¨‹åºå¼€å‘è€…å·¥å…·.app
</code></pre>
<ol start="22">
<li>å¾®ä¿¡å°ç¨‹åº <code>&lt;input /&gt;</code> ä¸æ”¯æŒè‡ªå®šä¹‰ <code>font-family</code>ï¼ˆ<a href="https://developers.weixin.qq.com/miniprogram/dev/component/input.html#Bug-Tip">è¯¦è§</a>ï¼‰</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å°ç¨‹åº Canvas ç»˜å›¾å­˜å›¾]]></title>
            <link>https://github.com/toFrankie/blog/issues/149</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/149</guid>
            <pubDate>Sat, 25 Feb 2023 13:57:41 GMT</pubDate>
            <description><![CDATA[<p>ä½¿ç”¨ Canvas ç”»å›¾ï¼Œå¹¶ä¿å­˜è‡³ç›¸å†Œçš„è¿‡ç¨‹ï¼Œä»¥ä¸‹æ˜¯è¸©è¿‡çš„å‘ï¼š</p>
<ol>
<li>canvas æ ‡ç­¾ä¸å¯ä»¥è®¾ç½®ä¸º <code>display: none</code>ï¼›è‹¥ä¸æƒ³æ˜¾ç¤ºåˆ°é¡µé¢ï¼Œå¯ä»¥é‡‡ç”¨ <code>fixed</code> å¸ƒå±€è§†è§‰éšè—ï¼›</li>
<li>context.draw(boolea]]></description>
            <content:encoded><![CDATA[<p>ä½¿ç”¨ Canvas ç”»å›¾ï¼Œå¹¶ä¿å­˜è‡³ç›¸å†Œçš„è¿‡ç¨‹ï¼Œä»¥ä¸‹æ˜¯è¸©è¿‡çš„å‘ï¼š</p>
<ol>
<li>canvas æ ‡ç­¾ä¸å¯ä»¥è®¾ç½®ä¸º <code>display: none</code>ï¼›è‹¥ä¸æƒ³æ˜¾ç¤ºåˆ°é¡µé¢ï¼Œå¯ä»¥é‡‡ç”¨ <code>fixed</code> å¸ƒå±€è§†è§‰éšè—ï¼›</li>
<li>context.draw(boolean reserve, function callback) æ˜¯å¼‚æ­¥çš„ï¼Œ<code>wx.canvasToTempFilePath</code>ä¸€å®šè¦å†™åœ¨å›è°ƒé‡Œï¼Œå¦åˆ™ä¼šå‡ºç°æ— æ³•ç»˜å›¾çš„æƒ…å†µï¼›</li>
<li><code>wx.canvasToTempFilePath</code> ä¿å­˜å›¾ç‰‡è‡³ç›¸å†Œï¼Œéœ€è¦ç”¨æˆ·æˆæƒï¼Œæ‰€ä»¥ä¿å­˜å‰éœ€è¦æ£€æŸ¥æƒé™ã€‚ä¸€æ—¦ç”¨æˆ·ä¸€æ¬¡æ‹’ç»æˆæƒï¼Œç¬¬äºŒæ¬¡ä¿å­˜æ—¶æ˜¯ä¸ä¼šæœ‰æˆæƒå¼¹çª—çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>wx.openSetting</code> å»å¼•å¯¼ç”¨æˆ·æˆæƒã€‚ï¼ˆæ’ä¸€å¥ï¼šæ”¯ä»˜å®å°ç¨‹åºï¼Œåªè¦æ²¡æƒé™ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šå¼¹å‡ºæˆæƒå¼¹çª—ï¼‰</li>
</ol>
<p>ä»£ç ç‰‡æ®µï¼š<a href="https://developers.weixin.qq.com/s/14RxPjmC7k50">ä¸€ä¸ªç®€å•çš„canvas demo</a></p>
<p>å†æ”¾ä¸ªé‡‡å‘è¿‡ç¨‹ï¼š<code>å…³äº HTML â†’ Canvas â†’ Image â†’ ä¿å­˜ç›¸å†Œ</code> çš„è¿‡ç¨‹ã€‚<a href="https://juejin.im/post/5a17c5e26fb9a04527254689">ç‚¹æˆ‘è·³è½¬</a>ã€‚ï¼ˆä¸æ˜¯æˆ‘å†™çš„ï¼Œä½†è¿‡ç¨‹è·Ÿæˆ‘ç›¸åŒï¼Œæ‡’å¾—å†™äº†ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a10707178cf68eba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå›¾"></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¾®ä¿¡å°ç¨‹åºè½¬ä¸ºç™¾åº¦å°ç¨‹åº]]></title>
            <link>https://github.com/toFrankie/blog/issues/148</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/148</guid>
            <pubDate>Sat, 25 Feb 2023 13:56:24 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘åœ¨åšç™¾åº¦å°ç¨‹åºå¼€å‘éœ€æ±‚ï¼ŒæŠŠåŸæœ‰çš„å¾®ä¿¡å°ç¨‹åºå¿«é€Ÿè¿ç§»è¿‡å»ï¼Œä»æ–‡æ¡£ä¸Šçœ‹ï¼Œä¸¤è€…ç›¸ä¼¼åº¦è¿˜æ˜¯æŒºé«˜çš„ã€‚</p>
<p>ç°åœ¨ç½‘ä¸Šæœ‰æŒºå¤šçš„è½¬æ¢å·¥å…·çš„ï¼Œè€Œæˆ‘ä½¿ç”¨çš„æ˜¯ <a href="https://www.npmjs.com/package/wx2swan">wx2swan</a> ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œè½¬åŒ–å®Œæˆåº¦èƒ½åˆ° 80% ~]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘åœ¨åšç™¾åº¦å°ç¨‹åºå¼€å‘éœ€æ±‚ï¼ŒæŠŠåŸæœ‰çš„å¾®ä¿¡å°ç¨‹åºå¿«é€Ÿè¿ç§»è¿‡å»ï¼Œä»æ–‡æ¡£ä¸Šçœ‹ï¼Œä¸¤è€…ç›¸ä¼¼åº¦è¿˜æ˜¯æŒºé«˜çš„ã€‚</p>
<p>ç°åœ¨ç½‘ä¸Šæœ‰æŒºå¤šçš„è½¬æ¢å·¥å…·çš„ï¼Œè€Œæˆ‘ä½¿ç”¨çš„æ˜¯ <a href="https://www.npmjs.com/package/wx2swan">wx2swan</a> ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œè½¬åŒ–å®Œæˆåº¦èƒ½åˆ° 80% ~ 90% ä¹‹é—´ï¼ŒæŒºä¸é”™çš„ã€‚</p>
<h4>å¿«é€Ÿä¸Šæ‰‹ï¼š</h4>
<ol>
<li>å…¨å±€å®‰è£…</li>
</ol>
<pre><code class="language-shell">$ npm install -g wx2swan
</code></pre>
<ol start="2">
<li>è½¬æ¢</li>
</ol>
<pre><code class="language-shell">$ wx2swan input-path output-path
# wx2swan ./projectA ./projectB
</code></pre>
<ol start="3">
<li>è½¬åŒ–è¿‡ç¨‹åœ¨ <code>log</code> æ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹</li>
<li>å°±è¿™æ ·æ²¡äº†ï¼Œå¾ˆç®€å•ã€‚</li>
</ol>
<h4>wx2swan åšäº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>å·¥å…·åªåšäº†é™æ€è¯­æ³•ä¸Šçš„è½¬æ¢ï¼Œæ ¹æ®ä¸€äº›è§„åˆ™å»è½¬æ¢ä»£ç ï¼ŒæŠ¹å¹³å¾®ä¿¡å°ç¨‹åºè¯­æ³•å’Œç™¾åº¦å°ç¨‹åºè¯­æ³•ä¸Šçš„å·®å¼‚ï¼Œé¿å…å¤§å®¶è¸©å‘ï¼›</li>
<li>æ¬å®¶å·¥å…·æ˜¯ç¦»çº¿çš„ï¼Œæ²¡æœ‰è¿è¡Œæ—¶æ¡†æ¶ï¼Œæ‰€ä»¥æœ‰äº›æ²¡æ³•æŠ¹å¹³çš„è¿è¡Œæ—¶ diff ï¼Œéœ€è¦äºŒæ¬¡å¼€å‘è°ƒæ•´ï¼›</li>
<li>ä½¿ç”¨ä¸­çš„ä»»ä½•é—®é¢˜ï¼Œéƒ½å¯ä»¥æ <a href="https://github.com/yican008/wx2swan/issues">Issues</a> æˆ–è€…åŠ  wx2swan ä½œè€…å¾®ä¿¡å°åŠ©æ‰‹ï¼š<code>wx2swan-helper</code>;</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è´­æˆ¿æœ‰æ„Ÿï¼šåŸæ¥ä¸ä»…ä»…è¦è€ƒè™‘é¦–ä»˜é—®é¢˜...]]></title>
            <link>https://github.com/toFrankie/blog/issues/147</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/147</guid>
            <pubDate>Sat, 25 Feb 2023 13:55:42 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eb150f286db4a7d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eb150f286db4a7d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿‘ä¸¤å‘¨ï¼Œå·¥ä½œä¹‹ä½™ä¸€ç›´åœ¨å¿™è´­æˆ¿çš„äº‹æƒ…ï¼Œä½œä¸€ä¸ªç®€å•çš„æœ‰æ„Ÿè®°å½•ã€‚</p>
<p>æ—©åœ¨ 2021 å¹´ï¼Œå®¶é‡Œäººå°±è®©æˆ‘æŠ½ç©ºå»çœ‹ä¸‹æˆ¿ï¼Œä½†ç”±äºä¸€ç›´æ‹–æ‹–æ‹–......å°±åˆ° 2023 å¹´äº†ã€‚
ä»ç½‘ä¸Šçœ‹æˆ¿ã€çº¿ä¸‹çœ‹æˆ¿ã€äº¤å®šé‡‘ã€ç»™é¦–ä»˜ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¹Ÿæ‰ä¸‰å‘¨ä¸åˆ°çš„æ—¶é—´ï¼Œäººç”Ÿå¤§äº‹ä¹‹ä¸€å°±è‰è‰å®šä¸‹äº†ã€‚</p>
<p>ç°åœ¨å›æƒ³èµ·æ¥ï¼Œæœ‰ç‚¹ä¸å¯æ€è®®ï¼Œå…¶å®åªåœ¨ 2 æœˆ 12 æ—¥è·‘äº†ä¸¤ä¸ªæ¥¼ç›˜ï¼Œå¯¹æ¯”ä¹‹ä¸‹ï¼Œç„¶åæ„Ÿè§‰åè€…è¿˜ä¸é”™ï¼Œå°±äº¤å®šé‡‘äº†ã€‚</p>
<p>ç”±äºæ­¤å‰èµ„æ–™ä¸å…¨ï¼ŒæŒ‰æ­ã€ç½‘ç­¾è¿˜æ²¡å¤„ç†å®Œï¼Œè¿˜å¾—æŠ½ç©ºå†è·‘ä¸€è¶Ÿã€‚</p>
<blockquote>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰äº›ä¸œè¥¿æ˜¯ç»å†è¿‡æ‰çŸ¥é“ï¼šã€Œå“¦ï¼ŒåŸæ¥å¦‚æ­¤...ã€</p>
</blockquote>
<h3>è¦ä¸è¦æ‰¾ä¸­ä»‹ï¼Ÿ</h3>
<p>åƒæˆ‘è¿™æ ·ï¼Œå…¶å®å¯¹è´­æˆ¿å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ä¸äº†è§£çš„ï¼Œæ‰€ä»¥æˆ‘æ˜¯æœ‰æ‰¾ä¸­ä»‹çš„ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥å»å”®æ¥¼éƒ¨/æ¥¼ç›˜è¥é”€ä¸­å¿ƒå»çœ‹ã€‚
ä¸­ä»‹çš„å¥½å¤„æ˜¯æ•´ä¸ªè´­æˆ¿è¿‡ç¨‹ï¼Œå¥¹ä¼šå…¨ç¨‹è·Ÿè¸ªï¼Œæœ‰ä¸æ‡‚çš„ä¹Ÿå¯ä»¥ç›´æ¥é—®ã€‚</p>
<p>ä½†å…¶å®ä¸­ä»‹å’Œæ¥¼ç›˜è‚¯å®šæ˜¯æœ‰åˆä½œçš„ï¼Œæ‰€ä»¥å¤§å®¶ä¹Ÿè¦ç•™ä¸ªå¿ƒçœ¼ï¼Œå­¦ä¼šåˆ¤æ–­ä»–ä»¬æ¨ä»‹çš„å¥½åä¸å¦ï¼Œå¿ƒé‡Œè¦æœ‰æ•°ï¼Œå°å¿ƒè¢«éª—ã€‚</p>
<p>ç„¶åæˆ‘æ˜¯åœ¨æŸ App ä¸Šå’¨è¯¢æ¥¼ç›˜ç›¸å…³æƒ…å†µæ—¶ï¼Œéšæ„åŠ ä¸Šçš„ä¸­ä»‹ï¼Œç„¶åæ¥è§¦ä¸‹æ¥ï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒé è°±ã€ä¸“ä¸šçš„ã€‚</p>
<blockquote>
<p>è‡³äºçº¿ä¸‹çœ‹æˆ¿ï¼Œæœ€å¥½å¸¦ä¸Šæœ‰è´­æˆ¿ç»éªŒçš„æœ‹å‹åŒå­¦ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</p>
</blockquote>
<h3>æ˜¯ä¸æ˜¯åªéœ€è¦è€ƒè™‘é¦–ä»˜æ¬¾ï¼Ÿ</h3>
<p>æ—¢ç„¶è€ƒè™‘è´­æˆ¿äº†ï¼Œæœˆä¾›åº”è¯¥æ˜¯åœ¨å¯æ¥å—èŒƒå›´çš„åŒºé—´å†…ï¼Œé¦–ä»˜æ˜¯ç¬¬ä¸€é“ç ã€‚</p>
<p>æˆ–è®¸ä½ æœ‰åˆ·åˆ°è¿‡ï¼Œåªéœ€é¦–ä»˜ 5w è¯¸å¦‚æ­¤ç±»çš„ï¼Œç›®çš„æ˜¯å¸å¼•æ›´å¤šå¹´è½»äººå»ä¹°æˆ¿ï¼Œä½†ç»†æƒ³é‡Œé¢çš„åˆ©æ¯è‚¯å®šå¾ˆé«˜...</p>
<p>å…¶å®æ›´å¤šçš„æ˜¯ï¼Œæœ€ä½é¦–ä»˜æ˜¯æˆ¿å±‹æ€»ä»·çš„ 2 æˆæˆ– 3 æˆï¼Œå„åœ°æ”¿ç­–ä¼šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬è¿™è¾¹çš„å°åŸå¸‚æ˜¯ï¼š</p>
<blockquote>
<ul>
<li>å•†ä¸šè´·æ¬¾ï¼šé¦–ä»˜æœ€ä½ 2 æˆã€‚</li>
<li>ç»„åˆè´·æ¬¾ï¼ˆå•†ä¸šè´·æ¬¾ + å…¬ç§¯é‡‘è´·æ¬¾ï¼‰ï¼šé¦–ä»˜æœ€ä½ 3 æˆã€‚</li>
</ul>
</blockquote>
<p>ç„¶åï¼Œå¾ˆå¤šæ¥¼ç›˜çš„å¥—è·¯æ˜¯æœ€ä½ 2 æˆé¦–ä»˜......
æˆ‘ä¹Ÿæ˜¯å»è°ˆä»·æ ¼çš„æ—¶å€™æ‰çŸ¥é“ï¼Œç»„åˆè´·é¦–ä»˜æœ€ä½è¦ 3 æˆï¼Œè¿™ä¹Ÿæ˜¯æœ‰ç‚¹è¶…é¢„ç®—çš„ã€‚</p>
<p>é™¤äº†é¦–ä»˜ã€æœˆä¾›è¿˜æœ‰å“ªäº›è´¹ç”¨å‘¢ï¼Ÿ</p>
<blockquote>
<ul>
<li>æŒ‰æ­è´¹ç”¨ï¼ˆå«æœåŠ¡è´¹ã€å…¬è¯è´¹ã€æŒ‰æ­å¾‹æ‰€ä»£æ”¶ï¼‰</li>
<li>ç­¾çº¦è´¹ï¼ˆå«æœåŠ¡è´¹ã€äº§æƒç™»è®°è´¹ã€å·¥æœ¬è´¹ã€å°èŠ±ç¨ç­‰ï¼‰</li>
<li>ä¸“é¡¹ç»´ä¿®åŸºé‡‘ï¼ˆæ¯å¹³æ–¹ç±³å»ºç­‘é¢ç§¯æˆæœ¬ä»· Ã— æ¯”ä¾‹ Ã— é¢ç§¯ï¼Œå„åœ°åŒºç»´ä¿®åŸºé‡‘çš„æ¯”ä¾‹å­˜åœ¨ä¸€å®šå·®å¼‚ï¼‰</li>
<li>å¥‘ç¨ï¼ˆå»ºç­‘é¢ç§¯ Ã— ç¨ç‡ã€‚ä»¥é¦–å¥—æˆ¿ä¸ºä¾‹ï¼Œå»ºç­‘é¢ç§¯å°äº 90ã¡ ç¨ç‡ä¸º 1%ï¼Œå¤§äº 90ã¡ ç¨ç‡ä¸º 1.5%ï¼›äºŒå¥—æˆ¿æ— è®ºå»ºç«™é¢ç§¯å¤šå°‘ç¨ç‡å‡ä¸º 3%ï¼‰</li>
</ul>
</blockquote>
<p>å› æ­¤ï¼Œé™¤äº†å¤šå°‘æˆçš„é¦–ä»˜æ¯”ä¾‹ä¹‹å¤–ï¼Œä»¥ä¸Šè¿™äº›è´¹ç”¨éƒ½æ˜¯è¦è€ƒè™‘çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿç®—æ˜¯é¦–ä»˜çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3>å…³äºè´·æ¬¾</h3>
<p>ç”±äºå•†è´·å’Œå…¬ç§¯é‡‘è´·çš„åˆ©ç‡å¯ä»¥ç›¸å·®å¾ˆå¤šï¼Œå› æ­¤èƒ½ç”¨å…¬ç§¯é‡‘ä¸€å®šè¦ä¼˜å…ˆé€‰æ‹©å…¬ç§¯é‡‘è´·æ¬¾ï¼Œå‰©ä½™éƒ¨åˆ†é€‰æ‹©å•†ä¸šè´·æ¬¾ã€‚</p>
<h4>å…¬ç§¯é‡‘è´·æ¬¾é¢åº¦</h4>
<p>å„åœ°æ”¿ç­–ä¸ä¸€æ ·ï¼Œä»¥å½“åœ°çš„ã€Œä½æˆ¿å…¬ç§¯é‡‘ç®¡ç†ä¸­å¿ƒå®˜ç½‘ã€æœ€æ–°çš„ç›¸å…³æ”¿ç­–æ–‡ä»¶ä¸ºå‡†ã€‚æ”¿ç­–æ˜¯ä¼šè°ƒæ•´çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™è¾¹å»å¹´ 10 ~ 12 æœˆä¸ªäººå¯è´·æ€»é¢ç”± 40w è°ƒè‡³ 50wï¼Œç°åœ¨åˆè°ƒæ•´å› 40w äº†ã€‚</p>
<p>ä¸»è¦è€ƒè™‘ä»¥ä¸‹è¿™äº›é—®é¢˜ï¼ˆ<strong>ä»¥å½“åœ°æ”¿ç­–ä¸ºå‡†</strong>ï¼‰ï¼š</p>
<ul>
<li>æœ€é«˜è´·æ¬¾é¢åº¦æ˜¯åˆ†ä¸ªäººã€å¤«å¦»åŒæ–¹çš„ï¼Œä¸€èˆ¬å¤«å¦»çš„é¢åº¦è¾ƒé«˜ï¼›</li>
<li>å®é™…å¯è´·é¢åº¦æŒ‰ã€Œå…¬ç§¯é‡‘ä½™é¢ Ã— ä¸€å®šçš„å€æ•°ã€è®¡ç®—ï¼Œä¸”ä¸èƒ½è¶…è¿‡æœ€é«˜è´·æ¬¾é¢åº¦ï¼›</li>
<li>æ³¨æ„ï¼Œã€Œå€æ•°ã€å¦‚ä½•ç¡®å®šçš„é—®é¢˜ï¼Œæ˜¯æŒ‰ã€Œç´¯è®¡ç¼´å­˜æ—¶é—´ã€è¿˜æ˜¯ã€Œè¿ç»­ç¼´å­˜æ—¶é—´ã€è®¡ç®—ï¼›</li>
<li>æ³¨æ„ï¼Œå¦‚æœä½ æ˜¯å¼‚åœ°å…¬ç§¯é‡‘ï¼Œè¦æ¸…æ¥šè´­æˆ¿åœ°èƒ½å¦ä½¿ç”¨ä½ æ‰€ç¼´å­˜åœ°çš„å…¬ç§¯é‡‘è¿›è¡Œè´·æ¬¾ï¼›</li>
<li>æ³¨æ„ï¼Œä¸€èˆ¬æƒ…å†µç”³è¯·å…¬ç§¯é‡‘è´·æ¬¾è¦æ±‚ã€Œè¿ç»­ã€ç¼´å­˜ 6 ä¸ªæœˆã€1 å¹´ã€ç”šè‡³ 2 å¹´ä¸ç­‰ã€‚</li>
</ul>
<p>ä»¥ä¸ªäººä¸ºä¾‹ï¼Œåœ¨æ¸…è¿œè´­æˆ¿ï¼Œç”¨çš„æ˜¯å¹¿å·å…¬ç§¯é‡‘ï¼Œç´¯è®¡ç¼´å­˜æ—¶é—´è¶…è¿‡ 48 ä¸ªæœˆï¼Œä½† 2021 å¹´ä¸­ç”±äºç¦»èŒæ–­ç¼´è¿‡ï¼Œç›®å‰è¿ç»­ç¼´å­˜æ—¶é—´ä¸åˆ° 24 ä¸ªæœˆã€‚ç›®å‰æ¸…è¿œæ”¿ç­–å¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>éœ€ã€Œè¿ç»­ã€è¶³é¢ç¼´å­˜ä½æˆ¿å…¬ç§¯é‡‘ 6 ä¸ªæœˆï¼ˆå«ï¼‰ä»¥ä¸Šï¼›</li>
<li>åœ¨æ¸…è¿œå¸‚åŒºï¼ˆæ¸…æ–°åŒºã€æ¸…åŸåŒºï¼‰è´­æˆ¿ï¼›</li>
<li>ä¸ªäººç”³è¯·ä½æˆ¿å…¬ç§¯é‡‘è´·æ¬¾æœ€é«˜é¢åº¦ä¸º 40wï¼Œå¤«å¦»åŒæ–¹ä¸º 50wï¼›</li>
<li>å®é™…å¯è´·é¢åº¦ï¼ˆä»¥é¦–å¥—æˆ¿ä¸ºä¾‹ï¼‰
a. ç´¯è®¡ç¼´å­˜æ—¶é—´åœ¨ 24 ä¸ªæœˆï¼ˆä¸å«ï¼‰ä»¥ä¸‹çš„ï¼Œå¯è´·é¢åº¦ä¸è¶…è¿‡å…¬ç§¯é‡‘è´¦æˆ·ä½™é¢çš„ 8 å€ï¼›
b. ç´¯è®¡ç¼´å­˜æ—¶é—´åœ¨ 24 ä¸ªæœˆä»¥ä¸Šï¼Œ48 ä¸ªæœˆï¼ˆä¸å«ï¼‰ä»¥ä¸‹çš„ï¼Œå¯è´·é¢åº¦ä¸è¶…è¿‡å…¬ç§¯é‡‘è´¦æˆ·ä½™é¢çš„ 10 å€ï¼›
c. ç´¯è®¡ç¼´å­˜æ—¶é—´åœ¨ 48 ä¸ªæœˆï¼ˆå«ï¼‰ä»¥ä¸Šçš„ï¼Œå¯è´·é¢åº¦ä¸è¶…è¿‡å…¬ç§¯é‡‘è´¦æˆ·ä½™é¢çš„ 12 å€ï¼›</li>
<li>ç”³è¯·ä½æˆ¿å…¬ç§¯é‡‘è´·æ¬¾è´­ä¹°é¦–å¥—æˆ¿æ™®é€šè‡ªä½ä½æˆ¿ï¼Œæœ€åº•é¦–ä»˜æ¯”ä¾‹ä¸º 30%ï¼›</li>
<li>å…¬ç§¯é‡‘è´·æ¬¾åˆ©ç‡ä¸º 3.1%ï¼Œå•†ä¸šè´·æ¬¾åˆ©ç‡ä¸º 4.1%ï¼ˆLPR - 20 ä¸ªæµ®åŠ¨åŸºç‚¹ï¼‰ï¼›</li>
</ol>
</blockquote>
<p>è¿™å…¶ä¸­å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ï¼šçœ‹æˆ¿å‰ï¼Œä»æœ‹å‹è½¬å‘çš„å…¬ç§¯é‡‘è´·æ¬¾é¢åº¦è®¡ç®—çš„æ¨æ–‡çœ‹ï¼Œæˆ‘æ˜¯å¯ä»¥è´· 12 å€çš„ã€‚åˆ°å”®æ¥¼éƒ¨çœ‹æˆ¿ä¹‹åï¼Œæ— è®ºæ˜¯ç½®ä¸šé¡¾é—®ã€ä¸­ä»‹ã€è¿˜æ˜¯å”®æ¥¼éƒ¨æŸå·¥ä½œäººå‘˜ï¼ˆåº”è¯¥æ˜¯è´·æ¬¾æˆ–å…¬ç§¯é‡‘ç›¸å…³çš„ï¼‰ï¼Œéƒ½è¯´åªèƒ½è´· 8 å€ï¼ŒåŸå› æ˜¯æˆ‘ä¸­é—´æ–­ç¼´äº†ï¼Œç›®å‰è¿ç»­ç¼´å­˜æ—¶é—´ä¸è¶³ 24 ä¸ªæœˆï¼ŒåŠ ä¸Šæˆ‘æ˜¯å¤–å¸‚çš„å…¬ç§¯é‡‘ï¼Œåªèƒ½æŒ‰ã€Œè¿ç»­ç¼´å­˜æ—¶é—´ã€è®¡ç®—ã€‚</p>
<p>ä¸€å¼€å§‹ï¼Œæˆ‘æƒ³æ”¿ç­–ç›¸å…³çš„ä»–ä»¬è‚¯å®šæœ€ç†Ÿæ‚‰ï¼Œå°±åªèƒ½è®¤äº†ï¼Œè°è®©æˆ‘æ–­ç¼´äº†å‘¢ï¼ä½†æ˜¯ï¼Œåœ¨å»ç½‘ç­¾çš„å½“å¤©ï¼Œå°†ç›¸å…³èµ„æ–™äº¤ç»™åšæŒ‰æ­çš„å¾‹æ‰€å·¥ä½œäººå‘˜ï¼Œå¥¹è¯´æˆ–è®¸èƒ½è´· 12 å€ï¼Œå…·ä½“ä»¥å…¬ç§¯é‡‘é‚£è¾¹å®¡æ‰¹ä¸ºå‡†ã€‚é‚£æ—¶å€™è¿˜æœ‰ç‚¹å¸Œæœ›ï¼Œä½†éš”å¤©ä»–ä»¬å°±æ¥ç”µè¯´åªèƒ½è´· 8 å€ï¼ŒåŸå› æ˜¯å¼‚åœ°å…¬ç§¯é‡‘è¦æŒ‰ã€Œè¿ç»­ç¼´å­˜æ—¶é—´ã€è®¡ç®—ï¼Œæˆ‘ä¸­é—´æ–­ç¼´è¿‡ï¼Œæ‰€ä»¥ä¸è¡Œã€‚</p>
<p>ç”±äºä¸€èµ·ä¸€è½çš„ï¼Œå¿ƒé‡Œå¾ˆä¸çˆ½ã€ä¸æœæ°”ï¼Œä»–ä»¬å£ä¸­æ‰€è¯´è·Ÿæ”¿ç­–æ–‡ä»¶æ‰€ç¤ºå¹¶ä¸ä¸€è‡´ã€‚äºæ˜¯æˆ‘å»æ¸…è¿œã€å¹¿å·çš„ä½æˆ¿å…¬ç§¯é‡‘å®˜ç½‘ç¿»é˜…ç›¸å…³æ”¿ç­–æ–‡ä»¶ï¼Œä»¥åŠç»™æ¸…è¿œä½æˆ¿å…¬ç§¯é‡‘ç®¡ç†ä¸­å¿ƒçš„å®¢æœå’¨è¯¢ï¼Œå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼š<strong>å…¬ç§¯é‡‘å¯è´·é¢åº¦æ˜¯æŒ‰ç…§ã€Œç´¯è®¡ç¼´å­˜æ—¶é—´ã€å»è®¡ç®—å€æ•°çš„ï¼Œå¹¶ä¸æ˜¯ã€Œè¿ç»­ç¼´å­˜æ—¶é—´ã€</strong>ã€‚</p>
<ul>
<li><a href="http://gjj.gz.gov.cn/bsfw/qtfw/content/post_3476874.html">ä¸ªäººä½æˆ¿å…¬ç§¯é‡‘è´·æ¬¾æœåŠ¡æŒ‡å—ï¼ˆå¹¿æ¸…äº’è´·ï¼‰</a></li>
<li><a href="http://gjjzx.gdqy.gov.cn/dkyw/496.jhtml">æ¸…è¿œå¸‚ä½æˆ¿å…¬ç§¯é‡‘è´·æ¬¾ä¸šåŠ¡åŠäº‹æŒ‡å—</a></li>
<li><a href="https://mp.weixin.qq.com/s/olOl5v40wY9N1rYlfXVHFQ">å…¬ç§¯é‡‘è´·æ¬¾å¯ä»¥è´·å¤šå°‘é¢åº¦ï¼Ÿè®¡ç®—å…¬å¼å¦‚ä¸‹â€¦â€¦</a></li>
</ul>
<p>ä»¥ä¸Šæ–‡ä¸­æ‰€ç¤ºï¼Œå‡è¡¨æ˜åº”æŒ‰ã€Œç´¯è®¡ç¼´å­˜æ—¶é—´ã€å»è®¡ç®—å¯è´·å€æ•°ã€‚äºæ˜¯ï¼Œæˆ‘å°†ä»¥ä¸Šé“¾æ¥å‘ç»™å¾‹æ‰€ï¼Œç„¶åå¥¹é‚£è¾¹å†è·Ÿå…¬ç§¯é‡‘è´·æ¬¾å¯¹æ¥äººå‘˜æ²Ÿé€šç¡®è®¤ä¸€ä¸‹ã€‚ä»ä¸­é—´åé¦ˆçš„ä¸€äº›å†…å®¹çœ‹å¾—å‡ºæ¥ï¼Œå¯¹æ¥äººå‘˜åº”è¯¥æ˜¯ä¸€ç›´æŒ‰ã€Œè¿ç»­ç¼´å­˜æ—¶é—´ã€å»åŠç†çš„ï¼Œæ‰€ä»¥å¥¹å½“åˆã€Œç†æ‰€å½“ç„¶ã€åœ°è®¤ä¸ºæˆ‘åªèƒ½è´· 8 å€ã€‚ä»å¾‹æ‰€è½¬å‘çš„æˆªå›¾çœ‹ï¼Œå¯¹æ¥çš„å·¥ä½œäººå‘˜è¯´æ˜¯åŸåŒºçš„å®¡å•äººå‘˜å°±æ˜¯è¿™æ ·è·Ÿä»–ä»¬è¯´çš„ã€‚å¯èƒ½æ˜¯å› ä¸ºæˆ‘æŠŠæ”¿ç­–æ–‡ä»¶é“¾æ¥ç»™å¥¹äº†ï¼Œæ•´å¾—å¥¹éƒ½ä¸è‡ªä¿¡ï¼Œä¸æ•¢ç«‹é©¬ä¸‹ç»“è®ºã€‚å¥¹è¯´æ˜å¤©å†é—®å¸‚åŒºçš„ç§‘é•¿ç¡®è®¤ã€‚<strong>æœ€åçš„ç»“å±€æ˜¯ï¼šæˆ‘èƒœåˆ©äº†</strong>ã€‚</p>
<p>å›æƒ³èµ·æ¥ï¼ŒåŠªåŠ›äº‰å–è¿˜æ˜¯æœ‰ç”¨çš„ã€‚å°±è¿™æ ·çœ‹æ¥ï¼Œåœ¨æˆ‘ä¹‹å‰åº”è¯¥æœ‰éƒ¨åˆ†è´­æˆ¿è€…å› æ–­ç¼´å¯¼è‡´è´·æ¬¾å€æ•°è¢«è¯¯ç®—çš„æƒ…å†µã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Google Docs ä»£ç å—é«˜äº®]]></title>
            <link>https://github.com/toFrankie/blog/issues/146</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/146</guid>
            <pubDate>Sat, 25 Feb 2023 13:54:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e51425e5b1ee1761.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e51425e5b1ee1761.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>2023.11.27 æ›´æ–°ï¼š</p>
<p>Google Workspace äº 2022.12.14 æ¨å‡ºäº†å†…ç½®çš„ä»£ç å—åŠŸèƒ½ï¼Œä½†ä¸ªäººè´¦å·æ— æ³•ä½¿ç”¨ï¼Œä¸”æ‰€æ”¯æŒçš„è¯­è¨€å¹¶æ²¡æœ‰ä»¥ä¸‹æ’ä»¶ä¸°å¯Œï¼Œè¯¦è§ï¼š<a href="https://workspaceupdates.googleblog.com/2022/12/format-display-code-google-docs.html">Easily format and display code in Google Docs</a>ã€‚</p>
<p>ä½¿ç”¨ï¼šã€Œæ’å…¥ Insert - ç»„æˆè¦ç´  Building blocks - ä»£ç å— Code blockã€</p>
</blockquote>
<p>å¦‚æœä½ åœ¨ä½¿ç”¨ Google Docs ç¼–å†™è®¾è®¡æ–‡æ¡£ç­‰å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ª Code Blocks æ’ä»¶åº”è¯¥æ˜¯ä½ æƒ³è¦çš„ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹è´´ä»£ç çš„é˜…è¯»æ€§å¾ˆä¸å¥½ã€‚</p>
<p>æ’ä»¶åœ°å€ï¼š<a href="https://workspace.google.com/u/1/marketplace/app/code_blocks/100740430168">Code Blocks</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e7ac09acd6a29dea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å®‰è£…ä¹‹åï¼Œè¿™æ ·å¯åŠ¨æ’ä»¶ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2085aa3629a1362f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ‰€æ”¯æŒçš„è¯­è¨€ã€ä¸»é¢˜ä¼—å¤šï¼Œä»»å›é€‰æ‹©ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ff43e0913f382628.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ ¼å¼åŒ–å‰åå¯¹æ¯”ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8e53dc098ae86ad7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7608dc1fc9616c60.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åœ°å›¾ SDK åæ ‡ç³»è¯´æ˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/145</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/145</guid>
            <pubDate>Sat, 25 Feb 2023 13:54:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-11632340c9ee998c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-11632340c9ee998c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>åæ ‡ç³»åˆ†ç±»</h2>
<p>å¸¸è§åæ ‡ç³»æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>åœ°çƒåæ ‡ç³»ï¼ˆWGS84ï¼‰ï¼šå¸¸è§äº GPS è®¾å¤‡ï¼ŒGoogle åœ°å›¾ç­‰å›½é™…æ ‡å‡†çš„åæ ‡ä½“ç³»ã€‚</li>
<li>ç«æ˜Ÿåæ ‡ç³»ï¼ˆGCJ-02ï¼‰ï¼šä¸­å›½å›½å†…ä½¿ç”¨çš„è¢«å¼ºåˆ¶åŠ å¯†åçš„åæ ‡ä½“ç³»ï¼Œé«˜å¾·åæ ‡å°±å±äºè¯¥ç§åæ ‡ä½“ç³»ã€‚</li>
<li>ç™¾åº¦åæ ‡ç³»ï¼ˆBD-09ï¼‰ï¼šç™¾åº¦åœ°å›¾æ‰€ä½¿ç”¨çš„åæ ‡ä½“ç³»ï¼Œæ˜¯åœ¨ç«æ˜Ÿåæ ‡ç³»çš„åŸºç¡€ä¸Šåˆè¿›è¡Œäº†ä¸€æ¬¡åŠ å¯†å¤„ç†ã€‚</li>
</ul>
<p>åœ¨ä¸åŒåæ ‡ç³»ä¸­ï¼ŒåŒä¸€ç»çº¬åº¦æ‰€è¡¨ç¤ºçš„å®é™…ä½ç½®æ˜¯æœ‰åå·®ã€ä¸ç›¸åŒçš„ï¼Œä½†ä¸€èˆ¬å„ SDK å¹³å°éƒ½ä¼šæä¾›åæ ‡ç³»è½¬åŒ–çš„ APIã€‚</p>
<ul>
<li>è°·æ­Œåœ°å›¾ä½¿ç”¨çš„æ˜¯ WGS84 åæ ‡ç³»ï¼›</li>
<li>é«˜å¾·åœ°å›¾ã€è…¾è®¯åœ°å›¾ï¼ˆåŒ…æ‹¬å¾®ä¿¡ã€QQã€å¾®ä¿¡å°ç¨‹åº Map ç»„ä»¶ç­‰ï¼‰ä½¿ç”¨çš„æ˜¯ GCJ-02 åæ ‡ç³»ï¼›</li>
<li>ç™¾åº¦åœ°å›¾é‡‡ç”¨çš„æ˜¯ BD-09 åæ ‡ç³»ã€‚</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼š</p>
<blockquote>
<ul>
<li>é«˜å¾·åœ°å›¾ SDK åœ¨å¤§é™†ã€æ¸¯æ¾³ä½¿ç”¨çš„æ˜¯ GCJ-02 åæ ‡ç³»ï¼Œå°æ¹¾çœã€æµ·å¤–åœ°åŒºä½¿ç”¨çš„æ˜¯ WGS84 åæ ‡ç³»ã€‚</li>
<li>ç™¾åº¦åœ°å›¾ SDK åœ¨å›½å†…ï¼ˆåŒ…æ‹¬æ¸¯æ¾³å°ï¼‰ä½¿ç”¨çš„æ˜¯ BD09 åæ ‡ç³»ï¼Œæµ·å¤–åœ°åŒºç»Ÿä¸€ä½¿ç”¨ WGS84 åæ ‡ç³»ã€‚</li>
<li>è…¾è®¯åœ°å›¾ SDK åœ¨å¤§é™†ã€æ¸¯æ¾³ä½¿ç”¨çš„æ˜¯ GCJ-02 åæ ‡ç³»ï¼Œå°æ¹¾çœã€æµ·å¤–åœ°åŒºä½¿ç”¨çš„æ˜¯ WGS84 åæ ‡ã€‚</li>
</ul>
</blockquote>
<p>å›½å†…ä¸‰å¤§åœ°å›¾æœåŠ¡å•†åœ¨æµ·å¤–åœ°åŒºå‡ä½¿ç”¨çš„æ˜¯ WGS84 åæ ‡ç³»ï¼Œä½†åœ¨æ¸¯æ¾³å°ç•¥æœ‰ä¸åŒã€‚</p>
<h2>åæ ‡æ‹¾å–å™¨</h2>
<ul>
<li><a href="https://lbs.amap.com/tools/picker">é«˜å¾·åœ°å›¾åæ ‡æ‹¾å–å™¨</a></li>
<li><a href="https://api.map.baidu.com/lbsapi/getpoint/index.html">ç™¾åº¦åœ°å›¾åæ ‡æ‹¾å–å™¨</a></li>
<li><a href="https://lbs.qq.com/webDemoCenter/glAPI/glMap/mapPosition">è…¾è®¯åœ°å›¾åæ ‡æ‹¾å–å™¨</a></li>
<li><a href="https://www.google.com/maps">è°·æ­Œåœ°å›¾åæ ‡æ‹¾å–å™¨</a>ï¼ˆå³é”®å¤åˆ¶ï¼‰</li>
</ul>
<h2>å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="https://lbs.baidu.com/index.php?title=yingyan/api/v3/coordtrans">ç™¾åº¦åœ°å›¾åæ ‡ç³»è¯´æ˜</a></li>
<li><a href="https://lbs.amap.com/faq/advisory/others/39840/">æ¸¯æ¾³å°åŠæµ·å¤–ï¼Œé«˜å¾·æ˜¯å¦éƒ½ä¼šè¿”å›ç«æ˜Ÿåæ ‡ç³»ï¼Ÿ</a></li>
<li><a href="https://lbsyun.baidu.com/index.php?title=FAQ/iOS/map">ç™¾åº¦åœ°å›¾ SDK ä½¿ç”¨ä»€ä¹ˆåæ ‡ç³»ï¼Ÿ</a></li>
<li><a href="https://lbs.qq.com/FAQ/latlng_faq.html">è…¾è®¯ä½ç½®æœåŠ¡ API ä½¿ç”¨ä»€ä¹ˆåæ ‡ä½“ç³»ï¼Ÿ</a></li>
<li><a href="https://lbs.qq.com/FAQ/latlng_faq.html">æ¸¯æ¾³å°åŠæµ·å¤–ï¼Œè…¾è®¯ä½ç½®æœåŠ¡æ˜¯å¦éƒ½ä¼šè¿”å›ç«æ˜Ÿåæ ‡ç³»ï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Stylish ç»™ç½‘é¡µä¸€é”®æ¢è‚¤ï¼Œè¿˜å» ADï¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/144</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/144</guid>
            <pubDate>Sat, 25 Feb 2023 13:53:16 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€ä»€ä¹ˆæ˜¯ Stylish ï¼Ÿ</h3>
<p>å…ˆçœ‹æ•ˆæœå›¾ï¼ŒStylish æŠŠç™¾åº¦é¦–é¡µå˜æˆäº†è¿™æ ·å­:<img src="http://upload-images.jianshu.io/upload_images/5128488-8e803c68fd3fad93.png?imageMogr2/auto-orien]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€ä»€ä¹ˆæ˜¯ Stylish ï¼Ÿ</h3>
<p>å…ˆçœ‹æ•ˆæœå›¾ï¼ŒStylish æŠŠç™¾åº¦é¦–é¡µå˜æˆäº†è¿™æ ·å­:<img src="http://upload-images.jianshu.io/upload_images/5128488-8e803c68fd3fad93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Stylish æ˜¯ä¸€æ¬¾æµè§ˆå™¨æ’ä»¶ï¼Œç›®å‰é€‚ç”¨äº Chrome ã€Safari ã€Firefox ã€Opera ç­‰ä¸»æµæµè§ˆå™¨ã€‚Stylishçš„åŸç†æ˜¯é€šè¿‡æ›¿æ¢ç½‘é¡µæœ¬èº«çš„ CSS æ ·å¼æ¥è¾¾åˆ°ç½‘é¡µç¾åŒ–çš„æ•ˆæœã€‚</p>
<p><a href="https://userstyles.org/styles/browse">Stylish å®˜ç½‘</a>ä¸Šæœ‰éå¸¸éå¸¸å¤šçš„æ ·å¼ä¾›ç”¨æˆ·ä¸‹è½½ï¼Œä¸ä»…èƒ½è®©ç™¾åº¦ã€æ–°æµªå¾®åšå˜å¾—æç®€ã€è®¨äººå–œæ¬¢ï¼Œè¿˜èƒ½ç»™æ–°æµªç½‘ã€è…¾è®¯ç½‘ã€Google ã€YouTube ã€Facebook ã€Wikipedia ç­‰ä¸»æµç½‘ç«™**ã€Œæ¢è‚¤ã€**ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœä½ æœ‰å‰ç«¯åŸºç¡€ï¼Œæ‡‚å¾— CSS çŸ¥è¯†ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ ·å¼ï¼Œåšä¸€ä¸ªå±äºè‡ªå·±çš„ç½‘é¡µæ•ˆæœï¼Œä¹Ÿå¯ä»¥åœ¨å·²æœ‰æ ·å¼çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å®Œå–„ã€‚</p>
<h3>äºŒã€å®‰è£…ä½¿ç”¨ Stylish æ’ä»¶</h3>
<p>ä¸‹é¢æˆ‘å°†ä»¥ Chrome æµè§ˆå™¨ä¸ºä¾‹å­ï¼Œå…¶ä»–æµè§ˆå™¨çš„ä½¿ç”¨æ–¹æ³•å¤§åŒå°å¼‚ï¼Œä¸å¤ªæµè§ˆå™¨æ•ˆæœä¹Ÿå¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p>
<ol>
<li>
<p>ä¸‹è½½å®‰è£…æ’ä»¶ï¼šåˆ©ç”¨ç§‘å­¦ä¸Šç½‘å» <a href="https://chrome.google.com/webstore/category/extensions?hl=zh-CN">Chrome æ’ä»¶å®˜ç½‘</a> ä¸‹è½½å®‰è£…ï¼›äº¦å¯å» <a href="http://www.cnplugins.com/devtool/stylish/">æ’ä»¶ç½‘</a>ï¼ˆä¸ç”¨ç¿»å¢™ï¼‰ä¸‹è½½ï¼Œé‡Œé¢æœ‰å…·ä½“çš„å®‰è£…æ–¹æ³•ã€‚</p>
</li>
<li>
<p>åœ¨æµè§ˆå™¨æ‰©å±•ç¨‹åºé¡µé¢å¯ç”¨ Stylish æ’ä»¶åï¼Œå‰å¾€ <a href="https://userstyles.org/styles/browse">Stylish å®˜ç½‘</a>ä¸‹è½½æ¨¡æ¿ã€‚</p>
</li>
<li>
<p>å¯ä»¥å¯¹å·²å®‰è£…æ¨¡æ¿è¿›è¡Œ<strong>ä¿®æ”¹</strong>ã€<strong>ç¦ç”¨</strong>ã€<strong>åˆ é™¤</strong>ã€<strong>æ›´æ–°</strong>ç­‰ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-ee4b06288cadbafa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p>å¿«æ·å¯ç”¨ã€ç¦ç”¨ã€ä¿®æ”¹æ ·å¼ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-2b2a6d44398f03d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
</ol>
<h3>ä¸‰ã€å¸¸ç”¨æ¨¡æ¿å¥½è</h3>
<ol>
<li>
<p><strong>ç»å¯¹å¹²å‡€çš„ç™¾åº¦ï¼š</strong><a href="https://userstyles.org/styles/123858/baidu-lite"><strong>ç™¾åº¦è½»</strong></a> <br>æˆ‘ç”¨ä¸Š Stylish åä¸å†åæ§½æœç´¢ç•Œé¢ä¸‘ã€ä¹±ã€å¹¿å‘Šå¤šäº†ï¼Œç”šè‡³æœ‰ç‚¹å–œæ¬¢äº†ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-b098777e87b2a20d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">è¿™å¥—æ¨¡æ¿ç›®å‰ç‰ˆæœ¬æœ‰ä¸€ç‚¹ç‚¹å°ç‘•ç–µï¼šâ€œ é»˜è®¤ç”¨æˆ·åé¢œè‰²å€¼ä¸ºç™½è‰² â€ã€‚çœ‹ç€ä¸é¡ºçœ¼ï¼Œäºæ˜¯æˆ‘æ”¹æˆäº†é»‘è‰²ï¼Œæ•ˆæœå¦‚ä¸Šå›¾ã€‚ï¼ˆæˆ‘æœ‰å¼ºè¿«ç—‡ï¼Œä½ å¯ä»¥ä¸ä¿®æ”¹ ï¼Œå“ˆå“ˆï¼‰<img src="http://upload-images.jianshu.io/upload_images/5128488-0cdc65d246623d8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>ç®€æ´çš„æ–°æµªå¾®åšï¼š</strong><a href="https://userstyles.org/styles/106272/weibo-v6"><strong>weibo_v6</strong></a> <br>åŸæ¥ç½‘é¡µç‰ˆå¾®åšä¹Ÿå¯ä»¥è¿™ä¹ˆå¥½çœ‹ï¼Œå…¨æ–°å¸ƒå±€ï¼Œå»å¹¿å‘Šï¼Œè®¾è®¡æºè‡ª â€œ å¾®åšæ€¥ç®€ WC â€ã€‚æ•ˆæœç‰¹èµï¼Œæˆ‘æœ€å–œæ¬¢çš„æ ·å¼ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-5fc093b920481d91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>çŸ¥ä¹ï¼š</strong><a href="https://userstyles.org/styles/108011/flat-zhihu-v2-4-13"><strong>Flat_Zhihu v2.4.13</strong></a> <br>å­—ä½“å¤§å°ã€æ’ç‰ˆç¨å¾®è°ƒæ•´ï¼Œæ›´åˆç†ï¼Œæ›´å¥½çœ‹ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-b22682e4b4c5011c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>æ·˜å®é¦–é¡µï¼š</strong><a href="https://userstyles.org/styles/129300/taobao-clean-1-5-2"><strong>Taobao clean</strong></a> <br>æˆ‘åªæƒ³å®‰å®‰é™é™åœ°æœç´¢ï¼Œ<br>ä½†æ˜¯çº¯ç™½è‰²çš„èƒŒæ™¯ï¼Œæ€»è§‰å¾—ç¼ºç‚¹ä»€ä¹ˆâ€¦â€¦<img src="http://upload-images.jianshu.io/upload_images/5128488-2b19e6169d28574c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>è´´å§ï¼š</strong><a href="https://userstyles.org/styles/124770/tieba-maverick"><strong>TieBa - Maverick</strong></a> <br>æ›´ç°ä»£åŒ–çš„è´´å§é¡µã€éšè—å¹¿å‘Šå’Œæ— ç”¨åŠŸèƒ½ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-0ff5b8cfdd851a10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>è°·æ­Œæœæœç´¢ç»“æœé¡µé¢ï¼š</strong><a href="https://userstyles.org/styles/109717/google-material"><strong>Google Material</strong></a><br>æ•ˆæœèµï¼Œçœ‹èµ·æ¥èˆ’æœï¼ŒåŸºäº Dribbble è®¾è®¡å¸ˆ <a href="https://dribbble.com/aureliensalomon">AurÃ©lien Salomon</a> çš„è®¾è®¡å›¾ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-8871579557ee0400.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p><strong>ç½‘é¡µæš—é»‘æ¨¡å¼ï¼š</strong><a href="https://userstyles.org/styles/143766/dark-is-better-for-my-eyes-global-web-v1-12"><strong>Dark is better for my eyes</strong></a><br>é»‘è‰²çš„èƒŒæ™¯ï¼Œæ­é…æ·¡è“è‰²å­—ä½“ï¼Œç†è®ºä¸Šé€‚ç”¨äºæ‰€æœ‰çš„ç½‘ç«™ï¼Œä½†å®ƒä¸ä¼šå½±å“æµè§ˆå™¨çš„èœå•ã€‚
<img src="http://upload-images.jianshu.io/upload_images/5128488-9172a83777a7364e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li>
<p>è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œå¯ä»¥å» <a href="https://userstyles.org/styles/browse">Stylish å®˜ç½‘</a>ä¸‹è½½æ›´å¤šå¥½çœ‹çš„æ¨¡æ¿ã€‚äº¦å¯ä»¥è‡ªå·± DIY ï¼
<img src="http://upload-images.jianshu.io/upload_images/5128488-ccdf35366b8410f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
</ol>
<h3>å››ã€å†™åœ¨æœ€å</h3>
<p>æ— è®ºä½ æ˜¯ä¸€ä¸ªå°ç™½ï¼Œè¿˜æ˜¯ç•¥æ‡‚ CSS å±‚å æ ·å¼ï¼Œæˆ–æ˜¯èµ„æ·±å‰ç«¯å¤§ç¥ï¼ŒStylish éƒ½èƒ½æ»¡è¶³å¤§éƒ¨åˆ†ç”¨æˆ·çš„éœ€æ±‚ã€‚<strong>å»å¹¿å‘Š</strong>ã€<strong>æ’ç‰ˆè°ƒæ•´</strong>ã€<strong>å…¨æ–°å¸ƒå±€</strong>ç­‰åŠŸèƒ½ï¼Œç»™ä½ ç½‘é¡µä¸€ä¸ªæ›´å¥½çœ‹çš„ â€œæ–°çš®è‚¤â€ã€‚</p>
<p>å¸Œæœ›ç”¨æˆ·å‘ç°æ›´å¤šå¥½æ¨¡æ¿ï¼Œä¹Ÿé¼“åŠ±å„è·¯å¤§ç¥å»è®¾è®¡æ›´å¤šæ›´å¥½æ›´ç²¾ç¾çš„æ¨¡æ¿ï¼Œä¾›åƒæˆ‘è¿™æ ·çš„å°ç™½é€‰æ‹©ä¸ä½¿ç”¨ã€‚å¦‚æœè·¯è¿‡æœ‹å‹æœ‰å¥½æ¨èï¼Œæ¬¢è¿ç•™è¨€ï¼</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Google æ–°æ ‡ç­¾é¡µæ‰“å¼€æœç´¢ç»“æœ]]></title>
            <link>https://github.com/toFrankie/blog/issues/143</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/143</guid>
            <pubDate>Sat, 25 Feb 2023 13:52:11 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d32234afef9e30ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d32234afef9e30ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¾ˆå¤šå°ä¼™ä¼´ä½¿ç”¨ Google ä½œä¸ºæœç´¢å¼•æ“ï¼Œä½†æ˜¯æœ‰ä¸ªä¸å¤ªå¥½ç”¨ï¼ˆè§ä»è§æ™ºï¼‰çš„æ˜¯ï¼š</p>
<blockquote>
<p>æ‰“å¼€æœç´¢æ¡ç›®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯åœ¨ã€Œå½“å‰æ ‡ç­¾å†…ã€æ‰“å¼€çš„ã€‚</p>
</blockquote>
<h4>åŸå› </h4>
<p>æ‰“å¼€æ£€æŸ¥å…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ° <code>&lt;a&gt;</code> æ ‡ç­¾ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ª <code>target=&quot;_blank&quot;</code> çš„å±æ€§ï¼Œå› æ­¤å®ƒå¹¶ä¸ä¼šåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-63f031d581c476d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è€Œç™¾åº¦é»˜è®¤æ˜¯æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼ŒåŸå› å°±æ˜¯æœç´¢ç»“æœçš„é“¾æ¥ä¸­æœ‰ä¸€ä¸ª <code>target=&quot;_blank&quot;</code> å±æ€§ï¼Œæœ‰å…´è¶£å¯è‡ªè¡Œè§‚å¯Ÿä¸€ä¸‹ã€‚</p>
<h4>è§£å†³æ–¹æ³•</h4>
<p>ç½‘ä¸Šå……æ–¥ç€å„ç§æ–¹æ³•ï¼Œè£…æ’ä»¶ä»€ä¹ˆçš„ï¼ŒçœŸçš„æ˜¯æ²¡å¿…è¦...</p>
<p><strong>æ–¹æ³•ä¸€</strong>ï¼ˆä¸æ¨èï¼‰</p>
<p>æŒ‰ä¸‹ <strong>âŒ˜ é”®</strong>ï¼ˆWin ä¸º Ctrl é”®ï¼‰ï¼Œå†ç”¨é¼ æ ‡ç‚¹å‡»é“¾æ¥ï¼Œä¹Ÿå¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ã€‚å¯æ¯æ¬¡éƒ½è¦ç‚¹æŒ‰ï¼Œå¤ªéº»çƒ¦äº†ï¼Œæ•…ä¸æ¨èã€‚</p>
<blockquote>
<p>åŸç†ï¼šæŒ‰ä¸‹ âŒ˜ é”®ï¼Œå¯ä»¥ä½¿å¾— <code>&lt;a&gt;</code> æ ‡ç­¾äº§ç”Ÿ <code>&lt;a target=&quot;_blank&quot;&gt;</code> çš„æ•ˆæœã€‚</p>
</blockquote>
<p><strong>æ–¹æ³•äºŒ</strong></p>
<blockquote>
<p>æ³¨æ„ï¼Œæœªæ¥ Google æœç´¢é¡µé¢å¯èƒ½ä¼šæ”¹ç‰ˆï¼Œæ‰€ä»¥ä¸‹åˆ—æ­¥éª¤å¯èƒ½ä¸å®é™…æœ‰å‡ºå…¥ï¼Œä½†ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œæ‰¾åˆ°â€œè®¾ç½®â€æŒ‰é’®å°±å¥½äº†ã€‚</p>
</blockquote>
<p>æ­¥éª¤å¦‚ä¸‹ï¼Œç›´æ¥çœ‹å›¾å§ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-65c1aef67ff31516.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-45935eb170a0e3f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fdf43835932fc654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2c1990dcb0297b7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å‹¾é€‰ä¸­ä¹‹åï¼Œå°±ä¼šåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€äº†...</p>
<blockquote>
<p>è¿™é‡Œå¯èƒ½æœ‰äººæå‡ºç–‘é—®ï¼ˆæˆ‘ä¹Ÿæœ‰ï¼‰ï¼Œä½†å®é™…æ•ˆæœå°±æ˜¯ï¼š<strong>å‹¾é€‰ä¸Šæˆªå›¾ä¸­çš„é€‰é¡¹ï¼Œç¡®å®æ˜¯åœ¨â€œæ–°æ ‡ç­¾é¡µä¸­â€æ‰“å¼€é¡µé¢ï¼Œè€Œä¸æ˜¯â€œæ–°æµè§ˆå™¨çª—å£â€å“¦</strong>ã€‚ç„¶åæˆ‘çŒœä¼šä¸ä¼šæ˜¯è‹±è¯‘ä¸­çš„é—®é¢˜ï¼Œä½†æ˜¯è‹±æ–‡å°±æ˜¯ï¼šOpen each selected result in a new browser window</p>
<p>æ‰€ä»¥ï¼Œä»å®é™…æ•ˆæœå‡ºå‘ï¼Œè‹¥æ”¹ä¸º Open each selected result in a new tab å°±æ²¡äº‰è®®äº†ï¼ˆä¸é‡è¦ï¼‰ã€‚</p>
</blockquote>
<p>åˆ·æ–°é¡µé¢ï¼Œå†æ£€æŸ¥ä¸‹å…ƒç´ ï¼Œå°±ä¼šå‘ç° <code>&lt;a&gt;</code> æ ‡ç­¾å¤šäº†ä¸ª <code>target=&quot;_blank&quot;</code> å±æ€§ï¼ŒSo æˆåŠŸäº†...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ce4796e00a720799.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>More</h2>
<p>ç„¶åæˆ‘å‘ç°ï¼Œåœ¨æ²¡æœ‰ç™»å½• Google è´¦å·æƒ…å†µä¸‹ï¼Œæœ‰äº›æµè§ˆå™¨å…³æ‰é‡æ–°æ‰“å¼€ï¼Œè¿™ä¸ªé…ç½®ä¼šè¢«é‡ç½®ã€‚å¦‚æœç™»å½•äº† Google è´¦å·é…ç½®å¯ä»¥è¢«åŒæ­¥ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Markdown å¦‚ä½•é«˜äº®åå¼•å·]]></title>
            <link>https://github.com/toFrankie/blog/issues/142</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/142</guid>
            <pubDate>Sat, 25 Feb 2023 13:50:55 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e03fe77f74b5c063.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e03fe77f74b5c063.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ Markdown è¯­æ³•ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ã€Œåå¼•å·ã€ï¼ˆbackquoteï¼Œ<code>`</code>ï¼‰è¡¨ç¤ºä»£ç ã€‚å®ƒä¼šäº§ç”Ÿé«˜äº®æ•ˆæœï¼Œè¯­æ³•å½¢å¦‚ <code>`&lt;some code&gt;`</code>ã€‚</p>
<p><strong>ç”±äº Markdown è§£æå™¨ä¸­ã€Œåå¼•å·ã€éƒ½ä¼šè¢«è½¬ä¹‰ï¼Œé‚£ä¹ˆå¦‚ä½•æ˜¾ç¤ºåå¼•å·æœ¬èº«å‘¢ï¼Ÿ</strong></p>
<p>åå¼•å·çš„ HTML è½¬ä¹‰å­—ç¬¦ä¸º <code>&amp;#96;</code>ï¼Œä½†ç›´æ¥è¾“å…¥ <code>&amp;#96;</code> å­—ç¬¦æˆ–å•ä¸ªåå¼•å·ï¼Œå®ƒä»¬å°†ä¼šæ˜¾ç¤ºä¸ºï¼ˆ`ï¼‰ï¼Œæ— é«˜äº®æ•ˆæœã€‚</p>
<blockquote>
<p>è‹¥éœ€é«˜äº®æ•ˆæœï¼Œéœ€åœ¨å¤–å±‚è¿ç»­ä½¿ç”¨ã€Œä¸¤ä¸ªåå¼•å·ã€æ‹¬èµ·æ¥ï¼Œè€Œä¸”æœ€å¥½åœ¨ä¸¤è¾¹ä½¿ç”¨ã€Œç©ºæ ¼ã€éš”å¼€ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ•ˆæœä¸º <code>`Hello Markdown!`</code>ï¼š</p>
<pre><code class="language-text">`` `Hello Markdown!` `` âœ… æœ‰æ•ˆ

`` `Hello Markdown!``` âŒ æ— æ•ˆï¼Œæœ«å°¾çš„ä¸‰ä¸ªåå¼•å·éœ€ç©ºæ ¼éš”å¼€
</code></pre>
<p>ä»¥ä¸‹æ•ˆæœä¸º <code>`</code>ï¼š</p>
<pre><code class="language-text">`` ` ``
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸€ä¸ªçŸ­å°å´ä»¤äººæƒŠå¹çš„ JavaScript ä»£ç ]]></title>
            <link>https://github.com/toFrankie/blog/issues/141</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/141</guid>
            <pubDate>Sat, 25 Feb 2023 13:50:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3a8704de2e5837cb.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3a8704de2e5837cb.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç®€ç›´æ˜¯å¤§å‘¼æƒŠå¹ï¼Œä¸å¾—ä¸ä½©æœ...</p>
<pre><code class="language-js">try {
  something
} catch (e) {
  window.location.href = `https://stackoverflow.com/search?q=[js] ${e.message}`
}
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-17f98102065b46cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f11f0496e500464b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é¢å‘ Stack Overflow Debugï¼Œç®€ç›´äº†ï¼Œå¸–å­<a href="https://twitter.com/DivineOmega/status/695744177557106688?s=20&amp;t=50Jde_R7QN6iPXhF7xc73w">å‡ºå¤„</a>ï¼Œä»¥ä¸Šæ— è¥å…»ï¼Œä½†å€¼å¾—ä¸€ç¬‘ï¼Œå“ˆå“ˆ~</p>
<p>Otherwiseï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š<a href="https://www.zhihu.com/question/46943112">æœ‰å“ªäº›çŸ­å°å´ä»¤äººæƒŠå¹çš„ JavaScript ä»£ç ï¼Ÿ</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½ çœŸçš„ä¼šä½¿ç”¨æ•°æ®åº“çš„ç´¢å¼•å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/140</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/140</guid>
            <pubDate>Sat, 25 Feb 2023 13:49:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-670155875280b0be.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-670155875280b0be.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>è½¬è½½è‡ªï¼š<a href="https://developer.huawei.com/consumer/cn/forum/topic/0202699338499720961">ä½ çœŸçš„ä¼šä½¿ç”¨æ•°æ®åº“çš„ç´¢å¼•å—ï¼Ÿ</a></p>
</blockquote>
<p>ä½¿ç”¨ç´¢å¼•ä¹Ÿå¾ˆç®€å•ï¼Œç„¶è€Œï¼Œ ä¼šä½¿ç”¨ç´¢å¼•æ˜¯ä¸€å›äº‹ï¼Œ è€Œæ·±å…¥ç†è§£ç´¢å¼•åŸç†åˆèƒ½æ°åˆ°å¥½å¤„ä½¿ç”¨ç´¢å¼•åˆæ˜¯å¦ä¸€å›äº‹ã€‚</p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>æ— è®ºæ˜¯é¢è¯•ã€è¿˜æ˜¯æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šä½¿ç”¨æˆ–è€…å¬åˆ°åˆ«äººè°ˆè®ºç´¢å¼•è¿™ä¸ªæŠ€æœ¯ã€‚</p>
<p>ç„¶è€Œå¾ˆå¤§ä¸€éƒ¨ä»½ç¨‹åºå‘˜å¯¹ç´¢å¼•çš„äº†è§£ä»…é™äºåˆ°â€œåŠ ç´¢å¼•èƒ½ä½¿æŸ¥è¯¢å˜å¿«â€è¿™ä¸ªæ¦‚å¿µä¸ºæ­¢ã€‚</p>
<p>ä½¿ç”¨ç´¢å¼•ä¹Ÿå¾ˆç®€å•ï¼Œç„¶è€Œï¼Œ ä¼šä½¿ç”¨ç´¢å¼•æ˜¯ä¸€å›äº‹ï¼Œ è€Œæ·±å…¥ç†è§£ç´¢å¼•åŸç†åˆèƒ½æ°åˆ°å¥½å¤„ä½¿ç”¨ç´¢å¼•åˆæ˜¯å¦ä¸€å›äº‹ã€‚</p>
<p>è¿™å·²ç»æ˜¯ä¸¤ä¸ªç›¸å·®ç”šè¿œçš„æŠ€æœ¯å±‚çº§äº†ã€‚</p>
<h2>äºŒã€åƒä¸‡çº§æ•°æ®è¡¨ç´¢å¼•å’Œæ— ç´¢å¼•æŸ¥è¯¢æ•ˆç‡å¯¹æ¯”</h2>
<p>ç°åœ¨æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ <code>student</code>ï¼Œæœ‰ 1000 ä¸‡æ¡æ•°æ®</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f1bd796d3d71f783.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœªåŠ ç´¢å¼•ï¼ŒæŸ¥è¯¢ <code>class_id=2</code> çš„å­¦ç”Ÿä¿¡æ¯çš„è€—æ—¶ï¼š<code>SELECT \* FROM student WHERE class_id=2</code> èŠ±è´¹äº† 3.357 ç§’</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6ef7966faee42e1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åŠ ä¸Šç´¢å¼•ï¼ŒæŸ¥è¯¢ <code>class_id=2</code> çš„å­¦ç”Ÿä¿¡æ¯çš„è€—æ—¶ï¼š<code>SELECT \* FROM student WHERE class_id=2</code> èŠ±è´¹äº† 0.017 ç§’</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-63dfb7e2175bf6d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>1000 ä¸‡æ¡æ•°æ®ä¸‹ï¼Œä¸¤ä¸ªæŸ¥è¯¢çš„æ€§èƒ½å·®äº†è¿‘ 200 å€ï¼ï¼</p>
<p>è¿™ä¸ªå·®è·æ˜¯ç‰¹åˆ«å¤§çš„ï¼ éš¾æ€ªéœ€è¦åŠ ç´¢å¼•ï¼ï¼ï¼</p>
<h2>ä¸‰ã€ä»€ä¹ˆæ˜¯ç´¢å¼•</h2>
<p>ç½‘ä¸Šå¾ˆå¤šè®²è§£ç´¢å¼•çš„æ–‡ç« å¯¹ç´¢å¼•çš„æè¿°æ˜¯è¿™æ ·çš„ï¼š</p>
<p>ç´¢å¼•å°±åƒä¹¦çš„ç›®å½•ï¼Œ é€šè¿‡ä¹¦çš„ç›®å½•å°±å¯ä»¥å‡†ç¡®çš„å®šä½åˆ°ä¹¦ç±çš„å…·ä½“çš„å†…å®¹ã€‚</p>
<p>è¿™å¥è¯æ¦‚è¿°çš„éå¸¸æ­£ç¡®ï¼</p>
<p>ä½†è¯´äº†è·Ÿæ²¡è¯´ä¸€æ ·ï¼Œæ‡‚çš„äººè‡ªç„¶æ‡‚ï¼ä¸æ‡‚çš„äººæ„Ÿè§‰æ‡‚äº†ï¼Œä½†è¿˜æ˜¯ä¸€è„¸è’™çš„çŠ¶æ€ï¼</p>
<p>å…¶å®æƒ³è¦ç†è§£ç´¢å¼•åŸç†ï¼Œå¿…é¡»æ¸…æ¥šä¸€ç§æ•°æ®ç»“æ„ï¼š</p>
<p>ã€Œå¹³è¡¡æ ‘ã€(éäºŒå‰)ï¼Œä¹Ÿå°±æ˜¯ <code>B Tree</code> æˆ–è€… <code>B+Tree</code></p>
<p>å½“ç„¶ï¼Œ æœ‰çš„æ•°æ®åº“ä¹Ÿä½¿ç”¨å“ˆå¸Œæ¡¶ä½œç”¨ç´¢å¼•çš„æ•°æ®ç»“æ„ ï¼Œ ç„¶è€Œï¼Œ ä¸»æµçš„ RDBMS éƒ½æ˜¯æŠŠå¹³è¡¡æ ‘å½“åšæ•°æ®è¡¨é»˜è®¤çš„ç´¢å¼•æ•°æ®ç»“æ„çš„ã€‚</p>
<p>æˆ‘ä»¬å¹³æ—¶å»ºè¡¨çš„æ—¶å€™éƒ½ä¼šä¸ºè¡¨åŠ ä¸Šä¸»é”®ï¼Œ åœ¨æŸäº›å…³ç³»æ•°æ®åº“ä¸­ï¼Œ å¦‚æœå»ºè¡¨æ—¶ä¸æŒ‡å®šä¸»é”®ï¼Œæ•°æ®åº“ä¼šæ‹’ç»å»ºè¡¨çš„è¯­å¥æ‰§è¡Œã€‚</p>
<p>äº‹å®ä¸Šï¼Œ ä¸€ä¸ªåŠ äº†ä¸»é”®çš„è¡¨ï¼Œå¹¶ä¸èƒ½è¢«ç§°ä¹‹ä¸ºâ€œè¡¨â€ã€‚ä¸€ä¸ªæ²¡åŠ ä¸»é”®çš„è¡¨ï¼Œå®ƒçš„æ•°æ®æ— åºçš„æ”¾ç½®åœ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œä¸€è¡Œä¸€è¡Œçš„æ’åˆ—çš„å¾ˆæ•´é½ã€‚</p>
<p>å¦‚æœç»™è¡¨ä¸Šäº†ä¸»é”®ï¼Œé‚£ä¹ˆè¡¨åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ç»“æ„å°±ç”±æ•´é½æ’åˆ—çš„ç»“æ„è½¬å˜æˆäº†æ ‘çŠ¶ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„â€œå¹³è¡¡æ ‘â€ç»“æ„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ•´ä¸ªè¡¨å°±å˜æˆäº†ä¸€ä¸ªç´¢å¼•ã€‚</p>
<p>æ²¡é”™ï¼Œ å†è¯´ä¸€éï¼Œ æ•´ä¸ªè¡¨å˜æˆäº†ä¸€ä¸ªç´¢å¼•ï¼</p>
<p>ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œèšé›†ç´¢å¼•â€ã€‚ <strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œ ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªâ€œèšé›†ç´¢å¼•â€ï¼Œå› ä¸ºä¸»é”®çš„ä½œç”¨å°±æ˜¯æŠŠâ€œè¡¨â€çš„æ•°æ®æ ¼å¼è½¬æ¢æˆâ€œæ ‘ï¼ˆç´¢å¼•ï¼‰â€çš„æ ¼å¼ã€‚</strong></p>
<p>æœªåŠ ç´¢å¼•æ—¶ï¼Œä¹‹å‰æ‰§è¡Œçš„æŸ¥è¯¢ SQL ä¼šè®©æ•°æ®åº“ç³»ç»Ÿé€è¡Œçš„éå†æ•´å¼ è¡¨ï¼Œå¯¹äºæ¯ä¸€è¡Œéƒ½è¦æ£€æŸ¥å…¶ <code>class_id</code> å­—æ®µæ˜¯å¦ç­‰äº <code>2</code>ã€‚å› ä¸ºæˆ‘ä»¬è¦æŸ¥æ‰¾æ‰€æœ‰ <code>class_id</code> ä¸º <code>2</code> çš„å‘˜å·¥ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å‘ç°äº†ä¸€æ¡ <code>class_id</code> æ˜¯ <code>2</code> çš„è®°å½•åï¼Œå¹¶ä¸èƒ½åœæ­¢ç»§ç»­æŸ¥æ‰¾ï¼Œå› ä¸ºå¯èƒ½è¿˜æœ‰ <code>class_id</code> ç­‰äº <code>2</code> çš„å…¶ä»–è®°å½•ã€‚</p>
<p>è¿™å°±æ„å‘³ç€ï¼Œå¯¹äºè¡¨ä¸­çš„åƒä¸‡æ¡è®°å½•ï¼Œæ•°æ®åº“æ¯ä¸€æ¡éƒ½è¦æ£€æŸ¥ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå…¨è¡¨æ‰«æâ€ï¼ˆfull table scanï¼‰</p>
<p>è€ŒåŠ ä¸Šç´¢å¼•çš„æœ€å¤§ä½œç”¨å°±æ˜¯åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œå®ƒèƒ½ä»æ ¹æœ¬ä¸Šå‡å°‘éœ€è¦æ‰«è¡¨çš„è®°å½•/è¡Œçš„æ•°é‡ã€‚</p>
<h2>å››ã€Mysql ä¸­çš„ç´¢å¼•</h2>
<p>åœ¨ MySQL ä¸­ï¼Œ ç´¢å¼•æœ‰ä¸¤ç§åˆ†ç±»æ–¹å¼ï¼š<strong>é€»è¾‘åˆ†ç±»</strong>å’Œ<strong>ç‰©ç†åˆ†ç±»</strong>ã€‚</p>
<p>æŒ‰ç…§é€»è¾‘åˆ†ç±»ï¼Œç´¢å¼•å¯åˆ†ä¸ºï¼š</p>
<ul>
<li>
<p>ä¸»é”®ç´¢å¼•ï¼šä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œä¸å…è®¸é‡å¤ã€ä¸å…è®¸ä¸º NULLï¼›</p>
</li>
<li>
<p>å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸º NULL å€¼ï¼Œä¸€å¼ è¡¨å¯æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•åªèƒ½åŒ…å«ä¸€åˆ—ï¼Œæ¯”å¦‚èº«ä»½è¯å·ç ã€å¡å·ç­‰éƒ½å¯ä»¥ä½œä¸ºå”¯ä¸€ç´¢å¼•ï¼›</p>
</li>
<li>
<p>æ™®é€šç´¢å¼•ï¼šä¸€å¼ è¡¨å¯ä»¥åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œä¸€ä¸ªæ™®é€šç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œå…è®¸æ•°æ®é‡å¤ï¼Œå…è®¸ NULL å€¼æ’å…¥ï¼›</p>
</li>
<li>
<p>å…¨æ–‡ç´¢å¼•ï¼šè®©æœç´¢å…³é”®è¯æ›´é«˜æ•ˆçš„ä¸€ç§ç´¢å¼•ã€‚</p>
</li>
</ul>
<p>æŒ‰ç…§ç‰©ç†åˆ†ç±»ï¼Œç´¢å¼•å¯åˆ†ä¸ºï¼š</p>
<ul>
<li>
<p>èšé›†ç´¢å¼•ï¼šä¸€èˆ¬æ˜¯è¡¨ä¸­çš„ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœè¡¨ä¸­æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šä¸»é”®ï¼Œåˆ™ä¼šé€‰æ‹©è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªä¸å…è®¸ä¸º NULL çš„å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰çš„è¯ï¼Œå°±é‡‡ç”¨ Innodb å­˜å‚¨å¼•æ“ä¸ºæ¯è¡Œæ•°æ®å†…ç½®çš„ 6 å­—èŠ‚ ROWID ä½œä¸ºèšé›†ç´¢å¼•ã€‚æ¯å¼ è¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼Œå› ä¸ºèšé›†ç´¢å¼•çš„é”®å€¼çš„é€»è¾‘é¡ºåºå†³å®šäº†è¡¨ä¸­ç›¸åº”è¡Œçš„ç‰©ç†é¡ºåºã€‚èšé›†ç´¢å¼•åœ¨ç²¾ç¡®æŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾æ–¹é¢æœ‰è‰¯å¥½çš„æ€§èƒ½è¡¨ç°ï¼ˆç›¸æ¯”äºæ™®é€šç´¢å¼•å’Œå…¨è¡¨æ‰«æï¼‰ï¼Œèšé›†ç´¢å¼•å°±æ˜¾å¾—å¼¥è¶³çè´µï¼Œèšé›†ç´¢å¼•é€‰æ‹©è¿˜æ˜¯è¦æ…é‡çš„ï¼ˆä¸€èˆ¬ä¸ä¼šè®©æ²¡æœ‰è¯­ä¹‰çš„è‡ªå¢ id å……å½“èšé›†ç´¢å¼•ï¼‰ï¼›</p>
</li>
<li>
<p>éèšé›†ç´¢å¼•ï¼šè¯¥ç´¢å¼•ä¸­ç´¢å¼•çš„é€»è¾‘é¡ºåºä¸ç£ç›˜ä¸Šè¡Œçš„ç‰©ç†å­˜å‚¨é¡ºåºä¸åŒï¼ˆéä¸»é”®çš„é‚£ä¸€åˆ—ï¼‰ï¼Œä¸€ä¸ªè¡¨ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªéèšé›†ç´¢å¼•ã€‚</p>
</li>
</ul>
<p>åœ¨ç›®å‰ç”¨çš„æœ€å¤šçš„ mysql çš„ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œæ˜¯ä½¿ç”¨ B+Tree ç´¢å¼•æ–¹æ³•æ¥è¿›è¡Œç´¢å¼•å»ºç«‹çš„ã€‚</p>
<p>B+ æ ‘ç´¢å¼•æ˜¯ B+ æ ‘åœ¨æ•°æ®åº“ä¸­çš„ä¸€ç§å®ç°ï¼Œæ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯æ•°æ®åº“ä¸­ä½¿ç”¨æœ€ä¸ºé¢‘ç¹çš„ä¸€ç§ç´¢å¼•ã€‚</p>
<p>B+ æ ‘ä¸­çš„ B ä»£è¡¨å¹³è¡¡ï¼ˆbalanceï¼‰ï¼Œè€Œä¸æ˜¯äºŒå‰ï¼ˆbinaryï¼‰ï¼Œå› ä¸º B+ æ ‘æ˜¯ä»æœ€æ—©çš„å¹³è¡¡äºŒå‰æ ‘æ¼”åŒ–è€Œæ¥çš„ã€‚å…ˆäº†è§£äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLTreeï¼‰å’Œå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼ˆB-Treeï¼‰ï¼ŒB+ æ ‘å³ç”±è¿™äº›æ ‘é€æ­¥ä¼˜åŒ–è€Œæ¥ã€‚</p>
<blockquote>
<p>å…·ä½“çš„è®²è§£å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/wuzhenzhao/p/10341114.html">MySQL ç´¢å¼•æœºåˆ¶ï¼ˆB+Treeï¼‰</a>ã€‚</p>
</blockquote>
<h2>äº”ã€ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h2>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç´¢å¼•èƒ½å¤Ÿæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„ IO æˆæœ¬ã€‚</li>
<li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ï¼Œåˆ›å»ºå”¯ä¸€ç´¢å¼•</li>
<li>åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼ŒåŒæ ·å¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´</li>
<li>åŠ é€Ÿä¸¤ä¸ªè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œä¸€èˆ¬æ˜¯åœ¨å¤–é”®ä¸Šåˆ›å»ºç´¢å¼•</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ </li>
<li>ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æœè¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§</li>
<li>å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œé™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦</li>
</ul>
<h2>å…­ã€ç´¢å¼•ä½•æ—¶åº”è¯¥ä½¿ç”¨</h2>
<p>éœ€åˆ›å»ºç´¢å¼•çš„æƒ…å†µï¼š</p>
<ul>
<li>ä¸»é”®ï¼Œè‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</li>
<li>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢çš„æ¡ä»¶çš„å­—æ®µ</li>
<li>æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µå­˜åœ¨å¤–é”®å…³ç³»</li>
<li>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºçš„é€Ÿåº¦</li>
<li>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µ</li>
</ul>
<p>é¿å…åˆ›å»ºç´¢å¼•çš„æƒ…å†µï¼š</p>
<ul>
<li>
<p>æ•°æ®å”¯ä¸€æ€§å·®çš„å­—æ®µä¸è¦ä½¿ç”¨ç´¢å¼•</p>
<p>æ¯”å¦‚æ€§åˆ«ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½æ•°æ®ã€‚æ„å‘³ç€ç´¢å¼•çš„äºŒå‰æ ‘çº§åˆ«å°‘ï¼Œå¤šæ˜¯å¹³çº§ã€‚è¿™æ ·çš„äºŒå‰æ ‘æŸ¥æ‰¾æ— å¼‚äºå…¨è¡¨æ‰«æã€‚</p>
</li>
<li>
<p>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸è¦ä½¿ç”¨ç´¢å¼•</p>
<p>æ¯”å¦‚ç™»å½•æ¬¡æ•°ï¼Œé¢‘ç¹å˜åŒ–å¯¼è‡´ç´¢å¼•ä¹Ÿé¢‘ç¹å˜åŒ–ï¼Œå¢å¤§æ•°æ®åº“å·¥ä½œé‡ï¼Œé™ä½æ•ˆç‡ã€‚</p>
</li>
<li>
<p>å­—æ®µä¸åœ¨ where è¯­å¥å‡ºç°æ—¶ä¸è¦æ·»åŠ ç´¢å¼•</p>
<p>åªæœ‰åœ¨ where è¯­å¥å‡ºç°ï¼Œmysql æ‰ä¼šå»ä½¿ç”¨ç´¢å¼•</p>
</li>
<li>
<p>æ•°æ®é‡å°‘çš„è¡¨ä¸è¦ä½¿ç”¨ç´¢å¼•</p>
<p>ä½¿ç”¨äº†æ”¹å–„ä¹Ÿä¸å¤§</p>
</li>
</ul>
<h2>ä¸ƒã€å“ªäº› sql èƒ½å‘½ä¸­ç´¢å¼•</h2>
<ol>
<li>
<p>å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œå¦‚ <code>name like '%æ¶›'</code></p>
</li>
<li>
<p><code>union</code>ã€<code>in</code>ã€<code>or</code> å¯ä»¥å‘½ä¸­ç´¢å¼•ï¼Œå»ºè®®ä½¿ç”¨ <code>in</code>ã€‚</p>
</li>
<li>
<p>è´Ÿæ¡ä»¶æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥ä¼˜åŒ–ä¸º <code>in</code> æŸ¥è¯¢ï¼Œå…¶ä¸­è´Ÿæ¡ä»¶æœ‰ <code>!=</code>ã€<code>&lt;&gt;</code>ã€<code>not in</code>ã€<code>not exists</code>ã€<code>not like</code> ç­‰</p>
</li>
<li>
<p>è”åˆç´¢å¼•æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œåˆå«æœ€å·¦ä¾§æŸ¥è¯¢ï¼Œå¦‚æœåœ¨ <code>(a, b, c)</code> ä¸‰ä¸ªå­—æ®µä¸Šå»ºç«‹è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒèƒ½å¤ŸåŠ å¿« <code>a | (a, b) | (a, b, c)</code> ä¸‰ç»„çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
</li>
<li>
<p>å»ºç«‹è”åˆæŸ¥è¯¢æ—¶ï¼ŒåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µåœ¨æœ€å·¦è¾¹</p>
</li>
<li>
<p>å¦‚æœå»ºç«‹äº†<code>(aï¼Œb)</code>è”åˆç´¢å¼•ï¼Œå°±ä¸å¿…å†å•ç‹¬å»ºç«‹ a ç´¢å¼•ã€‚åŒç†ï¼Œå¦‚æœå»ºç«‹äº†<code>(aï¼Œbï¼Œc)</code>ç´¢å¼•å°±ä¸å¿…å†å»ºç«‹ <code>aï¼Œ(aï¼Œb)</code> ç´¢å¼•</p>
</li>
<li>
<p>å­˜åœ¨éç­‰å·å’Œç­‰å·æ··åˆåˆ¤æ–­æ¡ä»¶æ—¶ï¼Œåœ¨å»ºç´¢å¼•æ—¶ï¼Œè¦æŠŠç­‰å·æ¡ä»¶çš„åˆ—å‰ç½®</p>
</li>
<li>
<p>èŒƒå›´åˆ—å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼Œä½†æ˜¯èŒƒå›´åˆ—åé¢çš„åˆ—æ— æ³•ç”¨åˆ°ç´¢å¼•ã€‚</p>
</li>
</ol>
<p>ç´¢å¼•æœ€å¤šç”¨äºä¸€ä¸ªèŒƒå›´åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ä¸¤ä¸ªèŒƒå›´åˆ—åˆ™æ— æ³•å…¨ç”¨åˆ°ç´¢å¼•ã€‚èŒƒå›´æ¡ä»¶æœ‰ï¼š<code>&lt;</code>ã€<code>&lt;=</code>ã€<code>&gt;</code>ã€<code>&gt;=</code>ã€<code>between</code> ç­‰ã€‚</p>
<ol start="9">
<li>
<p>æŠŠè®¡ç®—æ”¾åˆ°ä¸šåŠ¡å±‚è€Œä¸æ˜¯æ•°æ®åº“å±‚ã€‚åœ¨å­—æ®µä¸Šè®¡ç®—ä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œ</p>
</li>
<li>
<p>å¼ºåˆ¶ç±»å‹è½¬æ¢ä¼šå…¨è¡¨æ‰«æï¼Œå¦‚æœ <code>phone</code> å­—æ®µæ˜¯ <code>varchar</code> ç±»å‹ï¼Œåˆ™ä¸‹é¢çš„ SQL ä¸èƒ½å‘½ä¸­ç´¢å¼•ã€‚<code>Select \* fromuser where phone=13800001234</code></p>
</li>
<li>
<p>æ›´æ–°ååˆ†é¢‘ç¹ã€æ•°æ®åŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µä¸Šä¸å®œå»ºç«‹ç´¢å¼•ã€‚</p>
</li>
</ol>
<p>æ›´æ–°ä¼šå˜æ›´ B+ æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½ã€‚</p>
<p>â€œæ€§åˆ«â€è¿™ç§åŒºåˆ†åº¦ä¸å¤ªå¤§çš„å±æ€§ï¼Œå»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œä¸èƒ½æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæ€§èƒ½ä¸å…¨è¡¨æ‰«æç±»ä¼¼ã€‚</p>
<p>ä¸€èˆ¬åŒºåˆ†åº¦åœ¨ 80%ä»¥ä¸Šå°±å¯ä»¥å»ºç«‹ç´¢å¼•ã€‚åŒºåˆ†åº¦å¯ä»¥ä½¿ç”¨ <code>count(distinct(åˆ—å))/count(\*)</code>æ¥è®¡ç®—ã€‚</p>
<ol start="12">
<li>åˆ©ç”¨è¦†ç›–ç´¢å¼•æ¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé¿å…å›è¡¨ã€‚</li>
</ol>
<p>è¢«æŸ¥è¯¢çš„åˆ—ï¼Œæ•°æ®èƒ½ä»ç´¢å¼•ä¸­å–å¾—ï¼Œè€Œä¸æ˜¯é€šè¿‡å®šä½ç¬¦ <code>row-locator</code> å†åˆ° <code>row</code> ä¸Šè·å–ï¼Œå³â€œè¢«æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–â€ï¼Œè¿™èƒ½å¤ŸåŠ é€Ÿåº¦æŸ¥è¯¢ã€‚</p>
<ol start="13">
<li>
<p>å»ºç«‹ç´¢å¼•çš„åˆ—ä¸èƒ½ä¸º <code>null</code>ï¼Œä½¿ç”¨ <code>not null</code> çº¦æŸåŠé»˜è®¤å€¼</p>
</li>
<li>
<p>åˆ©ç”¨å»¶è¿Ÿå…³è”æˆ–è€…å­æŸ¥è¯¢ä¼˜åŒ–è¶…å¤šåˆ†é¡µåœºæ™¯ï¼Œ</p>
</li>
</ol>
<p>MySQL å¹¶ä¸æ˜¯è·³è¿‡ <code>offset</code> è¡Œï¼Œè€Œæ˜¯å– <code>offset+N</code> è¡Œï¼Œç„¶åæ”¾å¼ƒå‰ <code>offset</code> è¡Œï¼Œè¿”å› <code>N</code> è¡Œï¼Œé‚£å½“ <code>offset</code> ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ï¼Œè¦ä¹ˆæ§åˆ¶è¿”å›çš„æ€»æ•°ï¼Œè¦ä¹ˆå¯¹è¶…è¿‡ç‰¹å®šé˜ˆå€¼çš„é¡µè¿›è¡Œ SQL æ”¹å†™ã€‚</p>
<ol start="15">
<li>
<p>ä¸šåŠ¡ä¸Šå”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯å¤šä¸ªå­—æ®µçš„ç»„åˆï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•ã€‚</p>
</li>
<li>
<p>è¶…è¿‡ä¸‰ä¸ªè¡¨æœ€å¥½ä¸è¦ç”¨ <code>join</code>ï¼Œéœ€è¦ <code>join</code> çš„å­—æ®µï¼Œæ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œä¿è¯è¢«å…³è”çš„å­—æ®µéœ€è¦æœ‰ç´¢å¼•ã€‚</p>
</li>
<li>
<p>å¦‚æœæ˜ç¡®çŸ¥é“æŸ¥è¯¢ç»“æœåªè¦ä¸€æ¡ï¼Œ<code>limit 1</code> èƒ½å¤Ÿæé«˜æ•ˆç‡ï¼Œæ¯”å¦‚éªŒè¯ç™»å½•çš„æ—¶å€™ã€‚</p>
</li>
<li>
<p>Select è¯­å¥åŠ¡å¿…æŒ‡æ˜å­—æ®µåç§°</p>
</li>
<li>
<p>å¦‚æœæ’åºå­—æ®µæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå°±å°½é‡å°‘æ’åº</p>
</li>
<li>
<p>å°½é‡ç”¨ <code>union all</code> ä»£æ›¿ <code>union</code>ã€‚<code>union</code> éœ€è¦å°†é›†åˆåˆå¹¶ååœ¨è¿›è¡Œå”¯ä¸€æ€§è¿‡æ»¤æ“ä½œï¼Œè¿™ä¼šæ¶‰åŠåˆ°æ’åºï¼Œå¤§é‡çš„ CPU è¿ç®—ï¼ŒåŠ å¤§èµ„æºæ¶ˆè€—åŠå»¶è¿Ÿï¼Œå½“ç„¶ï¼Œä½¿ç”¨ <code>union all</code> çš„å‰ææ¡ä»¶æ˜¯ä¸¤ä¸ªç»“æœé›†æ²¡æœ‰é‡å¤æ•°æ®ã€‚</p>
</li>
</ol>
<h2>å…«ã€æ€»ç»“</h2>
<p>ç´¢å¼•æ˜¯éå¸¸é‡è¦çš„æŠ€æœ¯ï¼</p>
<p>ä½†æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œå®é™…ä¸Šéƒ½éœ€è¦åœ¨ç¡¬ç›˜ä¸Šå¼€è¾Ÿä¸€å—ç©ºé—´ç”¨äºå­˜å‚¨è¿™ä¸ªç´¢å¼•æ‰€éœ€è¦çš„æ•°æ®ç»“æ„ï¼ˆè™½ç„¶è¡¨è¿°ä¸å¤ªå‡†ç¡®ä½†æ˜¯æ˜¯è¿™ä¸ªæ„æ€ï¼‰ï¼Œå› æ­¤ä¸å»ºè®®å¯¹å¤ªé•¿çš„å­—æ®µå»ºç«‹ç´¢å¼•ã€‚</p>
<p>è€Œä¸”å»ºç«‹çš„ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå› ä¸ºç´¢å¼•è™½ç„¶èƒ½å¤Ÿæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æ˜¯ä¼šå¤§å¤§å¾—å½±å“æ’å…¥ã€åˆ é™¤å’Œä¿®æ”¹çš„æ•ˆç‡ï¼Œå› ä¸ºæ¯ä¸€æ¬¡æ•°æ®çš„æ›´æ–°éƒ½ä¼šç‰µæ¶‰åˆ°å¯¹ç´¢å¼•çš„ä¿®æ”¹ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¾€å¾€åœ¨å¯¹äºå¤§é‡æ•°æ®çš„æ’å…¥çš„æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ é™¤æ‰æ•°æ®è¡¨çš„ç´¢å¼•ï¼Œç­‰æ’å…¥å®Œæ¯•åé‡æ–°å»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·æ‰èƒ½æœ€å¤§é™åº¦åœ°ä¿è¯æ•°æ®åº“çš„æ•ˆç‡ï¼</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äºå¾®ä¿¡å…¬ä¼—å·æ’å…¥å¤–éƒ¨é“¾æ¥]]></title>
            <link>https://github.com/toFrankie/blog/issues/139</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/139</guid>
            <pubDate>Sat, 25 Feb 2023 13:48:54 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-88b44bef0dbe4e28.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2022 åŒ—äº¬å†¬å¥¥ä¼šå¼€å¹•å¼]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-88b44bef0dbe4e28.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2022 åŒ—äº¬å†¬å¥¥ä¼šå¼€å¹•å¼"></p>
<h4>ä¸€ã€å…¬ä¼—å·è‡ªå®šä¹‰èœå•</h4>
<blockquote>
<p>å·²è®¤è¯çš„å…¬ä¼—å·ï¼Œå³å¯æ’å…¥å¤–é“¾ã€‚</p>
</blockquote>
<h4>äºŒã€å¾®ä¿¡å›¾æ–‡å¤–é“¾</h4>
<p>åˆ†ä¸º<strong>è®¢é˜…å·</strong>ã€<strong>æœåŠ¡å·</strong>ä¸¤ç±»ï¼š</p>
<blockquote>
<ul>
<li>æœåŠ¡å· + å·²è®¤è¯ + å¼€é€šå¾®ä¿¡æ”¯ä»˜</li>
<li>è®¢é˜…å· + å·²è®¤è¯ + å¼€é€šå¾®ä¿¡æ”¯ä»˜</li>
</ul>
</blockquote>
<p>æ»¡è¶³ä»¥ä¸Šæ·»åŠ ä¹‹ä¸€çš„å…¬ä¼—å·ï¼Œå‡å¯åœ¨å¾®ä¿¡å›¾æ–‡æ­£æ–‡æ’å…¥å¤–éƒ¨é“¾æ¥ã€‚</p>
<p>å½“å¤–é“¾èƒ½åŠ›å¼€é€šä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æ’å…¥è¶…é“¾æ¥æ—¶ï¼Œå°±ä¼šæœ‰ä¸‹å›¾çš„é€‰é¡¹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ea5d42d9d351526c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>âš ï¸ å…¶ä¸­æœåŠ¡å·å¼€é€šå¾®ä¿¡æ”¯ä»˜å¾ˆç®€å•ï¼Œè€Œè®¢é˜…å·å¼€é€šå¾®ä¿¡æ”¯ä»˜æ¯”è¾ƒéš¾ï¼Œéœ€æ»¡è¶³ï¼š</p>
<blockquote>
<p>æŒ‰å®˜æ–¹æŒ‡å¼•è¯´æ˜ï¼Œç›®å‰ä»…<strong>æ”¿åºœä¸åª’ä½“ç±»è®¢é˜…å·</strong>æ–¹èƒ½ç”³è¯·å¾®ä¿¡æ”¯ä»˜ã€‚</p>
</blockquote>
<p>å¦‚æœæ”¯æŒç”³è¯·å¾®ä¿¡æ”¯ä»˜ï¼Œå…¬ä¼—å·åå°å·¦ä¾§å¯¼èˆªæ æ˜¯æœ‰ä¸€ä¸ªâ€œå¾®ä¿¡æ”¯ä»˜â€å…¥å£çš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-582f2b14a68b57f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸æ”¯æŒå¼€é€šå¾®ä¿¡æ”¯ä»˜çš„"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c1c1917c3493c0a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ”¯æŒç”³è¯·å¾®ä¿¡æ”¯ä»˜çš„"></p>
<p>ä½†æ˜¯æˆ‘å‘ç°ï¼Œæœ‰äº›è®¢é˜…å·ä¹Ÿä¼¼ä¹å¯ä»¥æ·»åŠ å¤–é“¾ï¼Œè€Œä¸”å®ƒä»¬çœ‹èµ·æ¥å¹¶ä¸åƒæ˜¯â€œæ”¿åºœä¸åª’ä½“ç±»â€è®¢é˜…å·ï¼Œç›®æµ‹æ˜¯å……äº† VIP æˆ–è€…æ˜¯è…¾è®¯äº²æˆšã€‚</p>
<p>è‡³äºæœ‰æ²¡æœ‰å…¶ä»– Hack æ–¹å¼ï¼Œä¼¼ä¹å…¨è¢«å°æ‰äº†...</p>
<p>å¦‚æœè¿˜ä¸æ­»å¿ƒçš„è¯ï¼Œçœ‹çœ‹å®˜æ–¹äººå‘˜çš„<a href="https://developers.weixin.qq.com/community/develop/doc/0006e2db2b0a58826f8c72e6151000">å›ç­”</a>ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b12ab7ee27b86c4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“ç„¶ï¼Œä¸æ’é™¤æ—¥åå®˜æ–¹å¼€é€šå…¶ä»–æ¸ é“å…è®¸åœ¨å¾®ä¿¡å›¾æ–‡æ’å…¥å¤–éƒ¨é“¾æ¥ï¼Œæ¯•ç«Ÿå¾®ä¿¡éƒ½èƒ½æ‰“å¼€æŠ–éŸ³ç­‰é“¾æ¥äº†...</p>
<h4>ä¸‰ã€å…¶ä»–</h4>
<p>ç›®å‰å¾®ä¿¡å›¾æ–‡å¯¹è·³è½¬å°ç¨‹åºæ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥é€‰æ‹©æŠ˜ä¸­æ–¹æ¡ˆï¼šå°† H5 åµŒå…¥è‡³å°ç¨‹åº <code>&lt;webview&gt;&lt;/webview&gt;</code> ç»„ä»¶ä¸­ï¼ˆä¹Ÿæ˜¯æœ‰é—¨æ§›çš„ï¼‰ï¼Œç„¶ååœ¨å¾®ä¿¡å›¾æ–‡ä¸­è·³è½¬å°ç¨‹åºã€‚</p>
<p>å¦å¤–ï¼Œå¾®ä¿¡å›¾æ–‡çš„â€œé˜…è¯»åŸæ–‡â€ä¹Ÿæ˜¯æ”¯æŒä»»æ„ç¬¬ä¸‰æ–¹é“¾æ¥çš„ï¼Œä¸”æ²¡æœ‰é—¨æ§›ã€‚</p>
<p>ä½†æˆ‘æƒ³ï¼Œè¿™å¹¶ä¸æ˜¯ä½ ä»¬æƒ³è¦çš„ï¼Œä¹Ÿä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚</p>
<h4>å››ã€References</h4>
<ul>
<li><a href="https://kf.qq.com/faq/120322fu63YV130422RR3Ajq.html">å›¾æ–‡æ¶ˆæ¯æ·»åŠ é“¾æ¥æ–¹æ³•ï¼Ÿ</a></li>
<li><a href="https://kf.qq.com/faq/1612197nEJNR161219BB7Jne.html">å¾®ä¿¡è®¤è¯åæœ‰å“ªäº›ç‰¹æƒï¼Ÿ</a></li>
<li><a href="https://kf.qq.com/faq/161220eeuIVn161220aE3a22.html">è®¢é˜…å·å¼€æ”¾ç”³è¯·å¾®ä¿¡æ”¯ä»˜èƒ½åŠ›ä»‹ç»</a></li>
<li><a href="https://weixin.qq.com/cgi-bin/readtemplate?t=weixin_external_links_content_management_specification">å¾®ä¿¡å¤–éƒ¨é“¾æ¥å†…å®¹ç®¡ç†è§„èŒƒ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº JavaScript å¼‚æ­¥ç¼–ç¨‹å­¦ä¹ é¡ºåº]]></title>
            <link>https://github.com/toFrankie/blog/issues/138</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/138</guid>
            <pubDate>Sat, 25 Feb 2023 13:47:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e3bc4ad9aca92a86.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e3bc4ad9aca92a86.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å‰æ®µæ—¶é—´è¾èŒåœ¨å®¶ï¼ŒæŠ½ç©ºå†™äº†å‡ ç¯‡å…³äº ES6+ ä¸­ Promiseã€Generatorã€Async çš„æ–‡ç« ã€‚å†™å®Œä¹‹åï¼Œæ‰å‘ç°åŸå…ˆå¹¶æ²¡æœ‰å¾ˆå¥½åœ°ç†è§£â€œå¼‚æ­¥ç¼–ç¨‹â€ï¼Œäº‹åæœ‰ç‚¹æç„¶å¤§æ‚Ÿçš„æ„æ€ã€‚</p>
<p>ä¸ªäººè®¤ä¸ºè¦å†™å¥½ JavaScript å¼‚æ­¥ç¼–ç¨‹ï¼Œå­¦ä¹ é¡ºåºå¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>äº‹ä»¶å¾ªç¯æœºåˆ¶</li>
<li>Promise å¯¹è±¡</li>
<li>è¿­ä»£å™¨ Iterator</li>
<li>ç”Ÿæˆå™¨ Generator</li>
<li>Generator å‡½æ•°ä¸ Thunk å‡½æ•°</li>
<li>Async/Await å‡½æ•°</li>
</ul>
</blockquote>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒé€šè¿‡äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶å»å®ç°éé˜»å¡ã€‚è¿™å±äºå¿…é¡»æŒæ¡çš„å†…å®¹ï¼ŒåŒ…æ‹¬åŒæ­¥ä»»åŠ¡ã€å¼‚æ­¥ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ã€å®ä»»åŠ¡ï¼‰ï¼Œè¿™æ˜¯å­¦ä¹ å…¶ä»–å†…å®¹çš„å‰æã€‚</p>
<p>åœ¨ ES6 ä¹‹å‰ï¼Œé€šå¸¸é€šè¿‡å›è°ƒå‡½æ•°ã€äº‹ä»¶ç›‘å¬ç­‰æ–¹å¼å»å¤„ç†å¼‚æ­¥æ“ä½œã€‚å½“ ES6 æ ‡å‡†æ­£å¼å‘å¸ƒä¹‹åï¼Œæä¾›äº†å…¨æ–°çš„ Promise å¯¹è±¡ã€Generator å‡½æ•°ã€‚</p>
<p>Promise å¯¹è±¡å¹²æ‰äº†â€œåœ°ç‹±å›è°ƒâ€ï¼ˆCallback Hellï¼‰ï¼Œä½†å®¹æ˜“çºµå‘å‘å±•ï¼Œå³ä¸€å †çš„ <code>then()</code>ã€<code>catch()</code> å¤„ç†ã€‚ä¸ªäººè®¤ä¸º Generator æ‰æ˜¯ä½¿å¾— ES6+ å¼‚æ­¥ç¼–ç¨‹æ›´å¼ºå¤§çš„åŠŸè‡£ã€‚</p>
<p>ä½†åœ¨ Generator ä¹‹å‰ï¼Œåº”è¯¥å…ˆè¦äº†è§£ Iterator è¿­ä»£å™¨ã€‚è¿­ä»£å™¨æ˜¯ä¸€ç§æœºåˆ¶ï¼Œæ˜¯ä¸€ç§æ¥å£ã€‚ä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›äº†ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚è¿­ä»£å™¨ä¸èƒ½å®Œå…¨ç®—æ˜¯â€œå…¨æ–°â€çš„ä¸œè¥¿ï¼Œåªæ˜¯åœ¨ ES6 ä¸­è¢«å†™å…¥æ ‡å‡†ï¼Œå¹¶ä¸ºåŸæœ‰ï¼ˆå¦‚æ•°ç»„ã€å­—ç¬¦ä¸²ï¼‰ã€æ–°å¢ï¼ˆå¦‚Setã€Mapï¼‰çš„æ•°æ®ç»“æ„å®ç°äº† Iterator æ¥å£ã€‚å…¶å®æˆ‘ä»¬å¾ˆå¤šå¸¸ç”¨æ–¹ä¾¿çš„ ES6 è¯­æ³•éƒ½æ˜¯åˆ©ç”¨è¿­ä»£å™¨ Iterator æ¥å£å®ç°çš„ã€‚ä¾‹å¦‚ <code>for...of</code>ã€æ•°ç»„è§£æ„ã€æ‰©å±•è¿ç®—ç¬¦ã€<code>new Set()</code>ã€<code>Promise.all()</code> ç­‰ç­‰ã€‚</p>
<p>ç”±äºè°ƒç”¨ Generator å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå…·æœ‰ Iterator æ¥å£ï¼‰ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ <code>for...of</code> ç­‰å»éå†å®ƒã€‚Generator å‡½æ•°è¿˜æ˜¯å®ç°è‡ªå®šä¹‰è¿­ä»£å™¨çš„å¥½æ–¹æ³•ã€‚</p>
<p>è€Œ Generator å‡½æ•°çš„å…¨æ–°è€Œç‹¬ç‰¹çš„è°ƒç”¨æœºåˆ¶ï¼Œæ‰æ˜¯å®ƒå¼ºå¤§çš„åŸå› ï¼Œæ‰€ä»¥åº”è¯¥è¦å­¦ä¼šå®ƒï¼Œå¹¶ä¸”è¦äº†è§£æ€æ ·å†™ä¸€ä¸ªæ‰§è¡Œå™¨å»è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆå™¨å¯¹è±¡ã€‚è¿™ä¸ªæ‰æ˜¯å®é™…ç¼–ç¨‹ä¸­æœ€é•¿ç”¨åˆ°çš„ã€‚</p>
<p>ç­‰ä½ å½»åº•äº†è§£ Generator å‡½æ•°ä¹‹åï¼ŒAsync å°±æ˜¯å°èœä¸€ç¢Ÿï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ Generator + Promise + è‡ªå®šä¹‰æ‰§è¡Œå™¨çš„ç»„åˆã€‚</p>
<p>é™„ä¸Šå‡ ç¯‡ç›¸å…³çš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/195">JavaScript äº‹ä»¶å¾ªç¯ï¼ˆå«å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/255">ç»†è¯» ES6 | Promise ä¸Šç¯‡</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/256">ç»†è¯» ES6 | Promise ä¸‹ç¯‡</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/257">ç»†è¯» ES6 | Iterator è¿­ä»£å™¨</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/258">ç»†è¯» ES6 | Generator ç”Ÿæˆå™¨</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/261">Thunk å‡½æ•°ä¸ Generator å‡½æ•°</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/259">ç»†è¯» ES6 | async/await</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/260">å…³äº Awaitã€Promise æ‰§è¡Œé¡ºåºå·®å¼‚é—®é¢˜</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¸¸è§é»˜è®¤ç«¯å£]]></title>
            <link>https://github.com/toFrankie/blog/issues/137</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/137</guid>
            <pubDate>Sat, 25 Feb 2023 13:47:10 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-813696309557852b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-813696309557852b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¸¸è§æœåŠ¡ç«¯å£</p>
<table>
<thead>
<tr>
<th>ç«¯å£</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>21</td>
<td>FTP æ–‡ä»¶ä¼ è¾“æœåŠ¡</td>
</tr>
<tr>
<td>22</td>
<td>SSH è¿œç¨‹è¿æ¥æœåŠ¡</td>
</tr>
<tr>
<td>23</td>
<td>TELENT ç»ˆç«¯ä»¿çœŸæœåŠ¡</td>
</tr>
<tr>
<td>25</td>
<td>SMTP ç®€å•é‚®ä»¶ä¼ è¾“æœåŠ¡</td>
</tr>
<tr>
<td>53</td>
<td>DNS åŸŸåè§£ææœåŠ¡</td>
</tr>
<tr>
<td>80</td>
<td>HTTP è¶…æ–‡æœ¬ä¼ è¾“æœåŠ¡</td>
</tr>
<tr>
<td>443</td>
<td>HTTPS åŠ å¯†è¶…æ–‡æœ¬ä¼ è¾“æœåŠ¡</td>
</tr>
<tr>
<td>8080</td>
<td>TCP æœåŠ¡ç«¯é»˜è®¤ç«¯å£</td>
</tr>
<tr>
<td>8888</td>
<td>Nginx æœåŠ¡å™¨ç«¯å£</td>
</tr>
</tbody>
</table>
<p>å¸¸è§æ•°æ®åº“ç«¯å£</p>
<table>
<thead>
<tr>
<th>ç«¯å£</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>1433</td>
<td>SQL Server æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>1521</td>
<td>Oracle æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>3306</td>
<td>MySQL æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>5000</td>
<td>DB2 æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>5432</td>
<td>PostgreSQL æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>6379</td>
<td>Redis æ•°æ®åº“ç«¯å£</td>
</tr>
<tr>
<td>27017</td>
<td>MongoDB æ•°æ®åº“é»˜è®¤ç«¯å£</td>
</tr>
</tbody>
</table>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¸¸è§å˜é‡å‘½å]]></title>
            <link>https://github.com/toFrankie/blog/issues/136</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/136</guid>
            <pubDate>Sat, 25 Feb 2023 13:46:10 GMT</pubDate>
            <description><![CDATA[<!--
![](https://upload-images.jianshu.io/upload_images/5128488-7a1c93cab456c784.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p><img src="https:]]></description>
            <content:encoded><![CDATA[<!--
![](https://upload-images.jianshu.io/upload_images/5128488-7a1c93cab456c784.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-03b0a51877a8720b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æŒç»­ã€ä¸å®šæ—¶æ›´æ–°...</p>
<hr>
<p>ç›¸ä¿¡å¾ˆå¤š Coder ä¼šé‡åˆ°ä¸€ä¸ªå¾ˆå¤´ç—›çš„é—®é¢˜ï¼Œå°±æ˜¯å˜é‡å‘½åã€‚</p>
<p>åæ­£æˆ‘å°±æ˜¯é‚£ç§å¯ä»¥åœ¨å˜é‡å‘½åä¸Šçº ç»“åŠå¤©çš„äººï¼Œæ²¡é”™ï¼Œæˆ‘æ˜¯å¼ºè¿«ç—‡æ‚£è€…ã€‚å¯¹äºä¸€ä¸ªâ€œåˆæ ¼â€çš„å˜é‡ï¼Œæ—¢èƒ½æ˜ç¡®è¡¨ç¤ºå®ƒçš„å‡†ç¡®æ„å›¾ï¼ˆå‰æï¼‰ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥ç®€çŸ­ä¸€ç‚¹ã€‚ä½†ä¸ªäººè®¤ä¸ºè¿˜æ˜¯å‰è€…æ›´é‡è¦ä¸€äº›ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ<code>i18n</code> å°±æ˜¯è‹±æ–‡å•è¯ <code>internationalization</code> çš„â€œç®€å†™â€ï¼ˆä¸­é—´ 18 ä¸ªå­—æ¯ï¼Œç”¨ 18 è¡¨ç¤ºï¼‰ï¼Œè¡¨ç¤ºå›½é™…åŒ–çš„æ„æ€ã€‚èµ·ç åœ¨å¼€å‘ç¼–ç¨‹ä¸­çº¦å®šä¿—æˆçš„ï¼Œè‡³äºå…¶ä»–è¡Œä¸šæ˜¯ä¸æ˜¯è¿™æ ·ç®€å†™æˆ–ç¼©å†™çš„ï¼Œæˆ‘å°±ä¸æ·±ç©¶äº†ã€‚ç±»ä¼¼çš„è¿˜æœ‰ <code>K8s</code>ï¼Œæ˜¯ <code>Kubernets</code> çš„ç®€å†™ã€‚</p>
<blockquote>
<p>æœ‰æ„ä¹‰çš„å‘½åæ–¹å¼ï¼Œåº”æˆä¸ºè‰¯å¥½ç¼–ç¨‹ä¹ æƒ¯çš„ä¸€éƒ¨åˆ†ã€‚å°½ç®¡å®ƒä¸æ˜¯è¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼Œä½†æˆ‘è®¤ä¸ºæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä¼šæœ‰æ„è¯†åœ°å»è®°å½•ä¸‹æ¥ã€‚æ¯”å¦‚æŸå¤©ï¼Œçœ‹äº†æŸåº“çš„æºç ï¼Œå®ƒè§‰å¾—å®ƒé‡Œé¢æŸä¸ªå˜é‡çš„å‘½åæ˜¯ OK çš„ï¼Œå¯ä»¥åº”ç”¨åœ¨æˆ‘å¹³å¸¸çš„é¡¹ç›®ä¸­ï¼Œé‚£ä¹ˆæˆ‘å°±æŠŠå®ƒè®°å½•ä¸‹æ¥...</p>
<blockquote>
<p><strong>å°½ç®¡å®ƒä»¬ç®—æ˜¯æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡çš„ä¸œè¥¿ï¼Œä½†æˆ‘ä¹Ÿæƒ³æŠŠå®ƒåšå¥½ï¼Œä»…æ­¤è€Œå·²...</strong></p>
</blockquote>
<p>ä¹Ÿæœ‰å¾ˆå¤šäººæ¨èçš„ç½‘ç«™ï¼š<a href="https://unbug.github.io/codelf/">CODELF</a>ï¼Œå®ƒæ˜¯ä» GitHubã€GitLabã€Bitbucket çš„é¡¹ç›®ä¸­çˆ¬å–çš„ã€‚æ”¯æŒä¸­æ–‡æ£€ç´¢ï¼Œä»¥å‰çœ‹äº†ä¸‹è¯·æ±‚æ¥å£ï¼Œå¥½åƒæ˜¯åˆ©ç”¨ Bing Microsoft Translator æ¥å£å…ˆå°†ä¸­æ–‡è½¬æ¢ä¸ºè‹±æ–‡ï¼Œç„¶åå†è¿›è¡Œæ£€ç´¢çš„ã€‚æˆ‘ç°åœ¨å¾ˆå°‘åœ¨ä¸Šé¢æ‰¾å˜é‡äº†...</p>
<h3>ä¸€ã€å¸¸è§ç®€å†™</h3>
<p>ä¾‹å¦‚ï¼Œè¡¨ç¤ºç”¨æˆ·ä¿¡æ¯çš„å˜é‡ï¼Œç›¸ä¿¡ç»å¤§å¤šæ•°å¼€å‘è€…ä¼šä½¿ç”¨ <code>userInfo</code>ï¼Œè€Œä¸æ˜¯ <code>userInformation</code>ï¼ˆé©¼å³°å¼éæœ¬æ–‡è®¨è®ºèŒƒå›´ï¼Œå¿½ç•¥ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>å…¨ç§°</th>
<th>ç®€å†™</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>template</td>
<td>tmpl</td>
<td></td>
</tr>
<tr>
<td>contribution</td>
<td>contrib</td>
<td></td>
</tr>
<tr>
<td>versus</td>
<td>vs</td>
<td></td>
</tr>
<tr>
<td>arguments</td>
<td>args</td>
<td></td>
</tr>
<tr>
<td>international</td>
<td>Intl</td>
<td></td>
</tr>
<tr>
<td>package</td>
<td>pkg</td>
<td></td>
</tr>
<tr>
<td>dependencies</td>
<td>deps</td>
<td></td>
</tr>
<tr>
<td>information</td>
<td>info</td>
<td></td>
</tr>
<tr>
<td>property</td>
<td>prop</td>
<td></td>
</tr>
<tr>
<td>properties</td>
<td>props</td>
<td></td>
</tr>
<tr>
<td>regular expression</td>
<td>regexã€regexpã€re</td>
<td></td>
</tr>
<tr>
<td>second</td>
<td>sec</td>
<td></td>
</tr>
<tr>
<td>memoization</td>
<td>memo</td>
<td>æ³¨æ„ï¼Œå®ƒä¸ <code>memorization</code> ä¸åŒï¼ŒåŒºåˆ«è¯·çœ‹ä¸‹æ–‡ã€‚</td>
</tr>
<tr>
<td>High-Order Component</td>
<td>HOC</td>
<td></td>
</tr>
<tr>
<td>standard</td>
<td>std</td>
<td></td>
</tr>
<tr>
<td>corporation</td>
<td>corp</td>
<td></td>
</tr>
<tr>
<td>First In First Out</td>
<td>FIFO</td>
<td>å…ˆè¿›å…ˆå‡º</td>
</tr>
<tr>
<td>Last In First Out</td>
<td>LIFO</td>
<td>åè¿›å…ˆå‡º</td>
</tr>
<tr>
<td>temporary</td>
<td>tempã€tmp</td>
<td></td>
</tr>
<tr>
<td>instance</td>
<td>inst</td>
<td></td>
</tr>
<tr>
<td>asynchronous</td>
<td>async</td>
<td>å¼‚æ­¥</td>
</tr>
<tr>
<td>synchronous</td>
<td>sync</td>
<td>åŒæ­¥</td>
</tr>
<tr>
<td>double click</td>
<td>dblclick</td>
<td></td>
</tr>
<tr>
<td>specification</td>
<td>spec</td>
<td>è§„æ ¼</td>
</tr>
<tr>
<td>conference</td>
<td>conf</td>
<td>ä¼šè®®</td>
</tr>
<tr>
<td>Read-Eval-Print-Loop</td>
<td>REPL</td>
<td>â€œè¯»å–-æ±‚å€¼-è¾“å‡ºâ€å¾ªç¯ï¼Œä¸€ä¸ªäº¤äº’å¼è§£é‡Šå™¨ã€‚</td>
</tr>
<tr>
<td>Generate Your Projects</td>
<td>GYPã€gyp</td>
<td>ä¸€ä¸ªç”¨æ¥ç”Ÿæˆé¡¹ç›®æ–‡ä»¶çš„å·¥å…·ã€‚</td>
</tr>
<tr>
<td>No Operation</td>
<td>noop</td>
<td>ç©ºæ“ä½œï¼Œåœ¨ JavaScript ä¸­ä¸€èˆ¬æ˜¯æ— æ“ä½œçš„ç©ºå‡½æ•°ï¼Œå¯ä½œä¸ºå‚æ•°é»˜è®¤å€¼ï¼Œä¾‹å¦‚å›è°ƒå‡½æ•°ï¼Œä»¥é¿å…ä»£ç æŠ¥é”™ã€‚</td>
</tr>
<tr>
<td>Request For Comments</td>
<td>RFC</td>
<td>å¾æ±‚ä¿®æ­£æ„è§ä¹¦</td>
</tr>
<tr>
<td>picture</td>
<td>pix</td>
<td></td>
</tr>
</tbody>
</table>
<h3>äºŒã€å¸¸è§ç¿»è¯‘</h3>
<table>
<thead>
<tr>
<th>ä¸­æ–‡</th>
<th>è‹±æ–‡</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>é”®å€¼å¯¹</td>
<td>key-value map</td>
<td></td>
</tr>
<tr>
<td>æ•°æ®ç»“æ„</td>
<td>data structures</td>
<td></td>
</tr>
<tr>
<td>ç”Ÿå‘½å‘¨æœŸ</td>
<td>life cycle</td>
<td></td>
</tr>
</tbody>
</table>
<h3>ä¸‰ã€å¸¸è§åœºæ™¯çš„å‘½å</h3>
<pre><code class="language-js">timerId // setTimeoutã€setInterval äº§ç”Ÿçš„ Id
</code></pre>
<h3>å››ã€æ‰©å±•</h3>
<h5>1. å…³äº <code>Corp.</code>ã€<code>Inc.</code>ã€<code>Co.,Ltd.</code> çš„åŒºåˆ«ï¼š</h5>
<ul>
<li><code>Corp.</code> æ˜¯ Corporation çš„ç¼©å†™ï¼Œä¸»è¦æ˜¯ç”¨äºå¤§å…¬å¸é›†å›¢çš„åç¼€ã€‚</li>
<li><code>Inc.</code> æ˜¯ Incorporation çš„ç¼©å†™ï¼Œå³è‚¡ä»½æœ‰é™å…¬å¸ï¼Œæ„æ€æ˜¯â€œå›¢ä½“ã€æ³•äººç»„ç»‡ã€å…¬å¸â€ã€‚</li>
<li><code>Co.</code> æ˜¯ Company çš„ç¼©å†™ï¼Œæ— è®ºè§„æ¨¡å¤§å°ï¼Œä¸€èˆ¬æŒ‡æœ‰é™è´£ä»»å…¬å¸ï¼Œç”¨å¾—è¾ƒæ™®éã€‚</li>
<li><code>Co.,Ltd.</code> æ˜¯ Limited Company çš„ç¼©å†™ï¼Œå³æœ‰é™è´£ä»»å…¬å¸ã€‚<code>Ltd.</code> é€‚ç”¨äºè§„æ¨¡è¾ƒå°çš„ä¼ä¸šã€‚è‹±å›½ã€åŠ æ‹¿å¤§å¸¸ç”¨çš„è¡¨è¿°æ–¹å¼ã€‚</li>
</ul>
<h5>2. <code>memoization</code> ä¸ <code>memorization</code> çš„åŒºåˆ«ï¼š</h5>
<p>æ²¡é”™ï¼Œå®ƒä»¬åªå·®åœ¨ä¸€ä¸ªå­—æ¯ <code>r</code> ä¸Šï¼Œè€Œä¸”éƒ½æ˜¯ä¸â€œè®°å¿†â€ ç›¸å…³çš„ï¼Œä½†æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<ul>
<li><code>memoization</code>ï¼šæ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ˜¯ä½¿ç¨‹åºè¿è¡Œæ›´å¿«çš„ä¸€ç§æ–¹æ³•ã€‚æ¯”å¦‚ã€‚React ä¸­çš„ memo å°±æ˜¯å®ƒçš„ç®€å†™ã€‚</li>
<li><code>memorization</code>ï¼šæ˜¯è£…è¿›ä½ è„‘è¢‹é‡Œé¢çš„ã€‚</li>
</ul>
<p>ä¸ä¹‹å¯¹åº”çš„åŠ¨è¯å°±æ˜¯ <code>memoize</code> ä¸ <code>memorize</code>ã€‚</p>
<blockquote>
<p>è¯¦è§ï¼š<a href="https://www.breword.com/92hackers-translate-articles/what-is-memoization">ä»€ä¹ˆæ˜¯ Memoization ï¼Ÿ</a></p>
</blockquote>
<h5>3. Node.js <code>REPL</code> ç®€è¿°</h5>
<p>Node.js REPL(Read Eval Print Loopï¼šäº¤äº’å¼è§£é‡Šå™¨) è¡¨ç¤ºä¸€ä¸ªç”µè„‘çš„ç¯å¢ƒï¼Œç±»ä¼¼ Window ç³»ç»Ÿçš„ç»ˆç«¯æˆ– Unix/Linux shellï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼Œå¹¶æ¥æ”¶ç³»ç»Ÿçš„å“åº”ã€‚</p>
<p>Node è‡ªå¸¦äº†äº¤äº’å¼è§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ul>
<li>
<p><strong>è¯»å–</strong> - è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œè§£æè¾“å…¥çš„ Javascript æ•°æ®ç»“æ„å¹¶å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡Œ</strong> - æ‰§è¡Œè¾“å…¥çš„æ•°æ®ç»“æ„</p>
</li>
<li>
<p><strong>æ‰“å°</strong> - è¾“å‡ºç»“æœ</p>
</li>
<li>
<p><strong>å¾ªç¯</strong> - å¾ªç¯æ“ä½œä»¥ä¸Šæ­¥éª¤ç›´åˆ°ç”¨æˆ·ä¸¤æ¬¡æŒ‰ä¸‹ <code>Ctrl + C</code> æˆ– <code>âŒ˜ + C</code> æŒ‰é’®é€€å‡ºã€‚</p>
</li>
</ul>
<p>Node çš„äº¤äº’å¼è§£é‡Šå™¨å¯ä»¥å¾ˆå¥½çš„è°ƒè¯• Javascript ä»£ç ã€‚</p>
<h5>4. node-gyp</h5>
<p><code>gyp</code>ï¼ˆGenerate Your Projectsï¼Œç®€ç§° GYPï¼Œ<a href="https://gyp.gsrc.io/index.md">å®˜ç½‘</a>ï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆé¡¹ç›®æ–‡ä»¶çš„å·¥å…·ï¼Œä¸€å¼€å§‹æ˜¯è®¾è®¡ç»™ Chromium é¡¹ç›®ä½¿ç”¨çš„ï¼Œåæ¥å¤§å®¶å‘ç°æ¯”è¾ƒå¥½ç”¨å°±ç”¨åˆ°äº†å…¶ä»–åœ°æ–¹ã€‚ç”Ÿæˆé¡¹ç›®æ–‡ä»¶åå°±å¯ä»¥è°ƒç”¨ GCCã€VSBuildã€Xcode ç­‰ç¼–è¯‘å¹³å°æ¥ç¼–è¯‘ã€‚è‡³äºä¸ºä»€ä¹ˆè¦æœ‰ <code>node-gyp</code>ï¼Œæ˜¯ç”±äº Node ç¨‹åºä¸­éœ€è¦è°ƒç”¨ä¸€äº›å…¶ä»–è¯­è¨€ç¼–å†™çš„å·¥å…·ç”šè‡³æ˜¯ DLLï¼Œéœ€è¦å…ˆç¼–è¯‘ä¸€ä¸‹ï¼Œå¦åˆ™å°±ä¼šæœ‰è·¨å¹³å°çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://www.zhihu.com/question/36291768/answer/318429630">node-gyp çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</a></p>
</blockquote>
<!--
* å½¢å‚ï¼šparameters
* å®å‚ï¼šarguments

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»€ä¹ˆæ˜¯ RC ç‰ˆæœ¬ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/135</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/135</guid>
            <pubDate>Sat, 25 Feb 2023 13:45:44 GMT</pubDate>
            <description><![CDATA[<p>å¸¸è§çš„ RC ç‰ˆæœ¬ï¼Œå…¨ç§°æ˜¯ Release Candidateã€‚å…¶ä¸­ Release æ˜¯å‘è¡Œã€å‘å¸ƒçš„æ„æ€ã€‚Candidate æ˜¯å€™é€‰äººçš„æ„æ€ï¼Œç”¨åœ¨è½¯ä»¶æˆ–è€…æ“ä½œç³»ç»Ÿä¸Šå°±æ˜¯å€™é€‰ç‰ˆæœ¬ã€‚å› æ­¤ Release Candidate å°±æ˜¯å‘è¡Œå€™é€‰ç‰ˆæœ¬ã€‚</p>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬åç§°</th]]></description>
            <content:encoded><![CDATA[<p>å¸¸è§çš„ RC ç‰ˆæœ¬ï¼Œå…¨ç§°æ˜¯ Release Candidateã€‚å…¶ä¸­ Release æ˜¯å‘è¡Œã€å‘å¸ƒçš„æ„æ€ã€‚Candidate æ˜¯å€™é€‰äººçš„æ„æ€ï¼Œç”¨åœ¨è½¯ä»¶æˆ–è€…æ“ä½œç³»ç»Ÿä¸Šå°±æ˜¯å€™é€‰ç‰ˆæœ¬ã€‚å› æ­¤ Release Candidate å°±æ˜¯å‘è¡Œå€™é€‰ç‰ˆæœ¬ã€‚</p>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬åç§°</th>
<th>ä»‹ç»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alpha</td>
<td>å†…æµ‹ç‰ˆæœ¬</td>
<td>å†…éƒ¨æµ‹è¯•ç‰ˆæœ¬ã€‚</td>
</tr>
<tr>
<td>Beta</td>
<td>å…¬æµ‹ç‰ˆæœ¬</td>
<td>Beta é˜¶æ®µä¼šä¸€ç›´åŠ å…¥æ–°çš„åŠŸèƒ½ã€‚</td>
</tr>
<tr>
<td>RC</td>
<td>å€™é€‰ç‰ˆæœ¬</td>
<td>å‡ ä¹å°±ä¸ä¼šåŠ å…¥æ–°çš„åŠŸèƒ½äº†ï¼Œè€Œä¸»è¦ç€é‡äºé™¤é”™ã€‚</td>
</tr>
<tr>
<td>Release</td>
<td>æ­£å¼ç‰ˆæœ¬</td>
<td>ç¨³å®šç‰ˆæœ¬ã€‚</td>
</tr>
</tbody>
</table>
<p>RC ç‰ˆæœ¬å’Œ Beta ç‰ˆæœ€å¤§çš„å·®åˆ«åœ¨äº Beta é˜¶æ®µä¼šä¸€ç›´åŠ å…¥æ–°çš„åŠŸèƒ½ï¼Œä½†æ˜¯åˆ°äº† RC é˜¶æ®µï¼Œå‡ ä¹å°±ä¸ä¼šåŠ å…¥æ–°çš„åŠŸèƒ½äº†ï¼Œè€Œä¸»è¦ç€é‡äºé™¤é”™ã€‚</p>
<p>RC ç‰ˆæœ¬ï¼Œå®ƒä¸æ˜¯æœ€ç»ˆçš„ç‰ˆæœ¬ï¼Œè€Œæ˜¯æœ€ç»ˆç‰ˆï¼ˆRTMï¼ŒRelease To Manufactureï¼‰ä¹‹å‰çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¹¿ä¹‰ä¸Šå¯¹æµ‹è¯•æœ‰ä¸‰ä¸ªä¼ ç»Ÿçš„ç§°å‘¼ï¼šAlphaï¼ˆÎ±ï¼‰ã€Betaï¼ˆÎ²ï¼‰ã€Gammaï¼ˆÎ³ï¼‰ï¼Œç”¨æ¥æ ‡è¯†æµ‹è¯•çš„é˜¶æ®µå’ŒèŒƒå›´ã€‚Alpha æ˜¯æŒ‡å†…æµ‹ï¼Œå³ç°åœ¨è¯´çš„ CBï¼ŒæŒ‡å¼€å‘å›¢é˜Ÿå†…éƒ¨æµ‹è¯•çš„ç‰ˆæœ¬æˆ–è€…æœ‰é™ç”¨æˆ·ä½“éªŒæµ‹è¯•ç‰ˆæœ¬ã€‚Beta æ˜¯æŒ‡å…¬æµ‹ï¼Œå³é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·å…¬å¼€çš„æµ‹è¯•ç‰ˆæœ¬ã€‚ç„¶ååšè¿‡ä¸€äº›ä¿®æ”¹ï¼Œæˆä¸ºæ­£å¼å‘å¸ƒçš„å€™é€‰ç‰ˆæœ¬æ—¶å«åš Gammaï¼Œç°åœ¨å°±åš RCã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/134</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/134</guid>
            <pubDate>Sat, 25 Feb 2023 13:44:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1717740131675.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è®°å½•ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹å·ç ä¸ºéš]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/6/1717740131675.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è®°å½•ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹å·ç ä¸ºéšæ„è¾“å…¥ï¼Œå¦‚æœ‰ç›¸åŒï¼Œçº¯å±å·§åˆï¼</p>
</blockquote>
<h2>å·ç è„±æ•</h2>
<p>èº«ä»½è¯å·ï¼Œä¿ç•™å‰ 6 ä½å’Œæœ€å 2 ä½ã€‚</p>
<pre><code class="language-js">const id = '801823200507142619'
id.replace(/(\w{6})\w*(\w{2})/, '$1******$2') // &quot;801823******19&quot;
</code></pre>
<p>æ‰‹æœºå·ï¼Œä¿ç•™å‰ 3 ä½å’Œæœ€å 4 ä½ã€‚</p>
<pre><code class="language-js">const phone = '13463592385'
phone.replace(/(\w{3})\w*(\w{4})/, '$1****$2') // &quot;134****2385&quot;
</code></pre>
<h2>æ ¼å¼åŒ–</h2>
<h3>ç§»é™¤ç©ºç™½ç¬¦</h3>
<p>ç§»é™¤æ‰€æœ‰ç©ºç™½ç¬¦ã€‚</p>
<pre><code class="language-js">const str = '  abc def  '
str.replace(/\s/g, '') // &quot;abcdef&quot;
</code></pre>
<p>ç§»é™¤å‰å¯¼ã€å°¾éšç©ºç™½ç¬¦ã€‚ä¹Ÿå¯ä»¥ç”¨ <code>String.prototype.trim()</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-js">const str = '  abc def  '
str.replace(/^\s*|\s*$/g, '') // &quot;abc def&quot;
</code></pre>
<blockquote>
<p><code>\s</code> è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ <code>\n</code>ã€<code>\r</code>ã€<code>\f</code>ã€<code>\t</code>ã€<code>\v</code> ç­‰ï¼Œç›¸å½“äº <code>/[\n\r\f\t\v]/</code>ã€‚</p>
</blockquote>
<h3>ç©ºæ ¼éš”å¼€</h3>
<p>é“¶è¡Œå¡å·ç æ¯ 4 ä½ç©ºæ ¼éš”å¼€ã€æ‰‹æœºå·ç  344 å½¢å¼ç©ºæ ¼éš”å¼€ç­‰åœºæ™¯ã€‚</p>
<pre><code class="language-js">const code = '801823200507142619'
code.replace(/(.{4})(?!$)/g, '$1 ') // &quot;8018 2320 0507 1426 19&quot;
</code></pre>
<blockquote>
<p>ä¸ºé¿å…å‡ºç° <code>'8018 2320 '</code> æœ«å°¾æœ‰ç©ºå­—ç¬¦ä¸²çš„æƒ…å†µï¼Œä½¿ç”¨è´Ÿå‘å…ˆè¡Œæ–­è¨€ <code>exp1(?!exp2)</code>ï¼Œè¡¨ç¤ºæŸ¥æ‰¾åé¢ä¸æ˜¯ exp2 çš„ exp1ã€‚</p>
</blockquote>
<pre><code class="language-js">const phone = '13463592385'
phone.replace(/(.{3})(.{4})(.{4})/, '$1 $2 $3') // &quot;134 6359 2385&quot;
</code></pre>
<h3>æ•°å­—åƒåˆ†ä½è¡¨ç¤ºæ³•</h3>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ä¸ªç‰ˆæœ¬å¹¶ä¸æ”¯æŒå¸¦å°æ•°çš„æƒ…å†µã€‚</p>
</blockquote>
<pre><code class="language-js">const str = '100000000000'
console.log(str.replace(/\B(?=(\d{3})+$)/g, ',')) // &quot;100,000,000,000&quot;
</code></pre>
<p><code>(?=p)</code>ï¼šè¡¨ç¤ºåŒ¹é… <code>p</code> å‰é¢çš„ä½ç½®ã€‚</p>
<p><code>?=\d{3}$</code>ï¼šè¡¨ç¤ºåŒ¹é… 3 ä¸ªæ•°å­—å‰çš„ä½ç½®ï¼Œæ›¿æ¢ç»“æœæ˜¯ <code>100000000,000</code>ã€‚</p>
<p><code>?=(\d{3})+$</code>ï¼šåœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ  <code>+</code> é‡è¯è¡¨ç¤ºåŒ¹é…å¤šä¸ª 3 ä½æ•°å­—çš„ä½ç½®ï¼Œæ›¿æ¢ç»“æœæ˜¯ <code>,100,000,000,000</code>ã€‚</p>
<p><code>\B(?=(\d{3})+$)</code>ï¼šå»æ‰å¼€å¤´çš„é€—å·ï¼Œ<code>\B</code> è¡¨ç¤ºåŒ¹é…éå•è¯è¾¹ç•Œï¼Œæ›¿æ¢ç»“æœæ˜¯ <code>100,000,000,000</code>ã€‚</p>
<blockquote>
<p><a href="https://juejin.cn/post/6844903943684751368">ç†è§£æ­£åˆ™ä¸­çš„ (?=p)ã€(?!p)ã€(?&lt;=p)ã€(?&lt;!p)</a></p>
</blockquote>
<h3>ä¿ç•™ 2 ä½å°æ•°</h3>
<pre><code class="language-js">const regex = /^(([1-9]{1}\d*)|(0{1}))(\.\d{2})$/

regex.test(0.11) // true
regex.test(5.12) // true

regex.test(1) // false
regex.test(2.5) // false
regex.test(3.324) // false
regex.test(4.) // false
regex.test(5.00) // falseï¼Œè¯·æ³¨æ„æ•°å€¼ 5.00 çš„å†™æ³•ä¼šç›´æ¥è½¬ä¸º 5 å†åšåˆ¤æ–­ï¼Œæ‰€ä»¥æ˜¯ falseã€‚
regex.test('5.00') // trueï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å½¢å¼æ˜¯åŒ¹é…æˆåŠŸçš„ã€‚
</code></pre>
<blockquote>
<p>æ€è·¯è¯·çœ‹<a href="https://www.cnblogs.com/hyunbar/p/10083532.html">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h2>æ±‰å­—åŒ¹é…</h2>
<p>å¯¹äºåŒ¹é…æ±‰å­—ï¼Œç½‘ä¸Šä¸€æœåŸºæœ¬ä¸Šéƒ½æ˜¯è¿™ä¸ªç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">const regex = /^[\u4e00-\u9fa5]+$/

regex.test('') // false
regex.test('123') // false
regex.test('ä½ å¥½') // true
</code></pre>
<blockquote>
<p>ä»¥ä¸Š <code>\u4e00</code>ã€<code>\u9fa5</code> åˆ†åˆ«æ˜¯ Unicode å­—ç¬¦é›†é‡Œæ±‰å­—çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªç ç‚¹ã€‚</p>
</blockquote>
<p>ä½† Unicode ä¸€ç›´åœ¨æ›´æ–°ï¼Œç›®å‰æœ€åä¸€ä¸ªæ±‰å­—ç ç‚¹ä¸å†æ˜¯ <code>\u9fa5</code>ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼åŒ¹é…æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<p>æ¯”å¦‚ï¼Œã€Œä¶®ã€å§“ã€‚</p>
<pre><code class="language-js">regex.test('ä¶®') // false
</code></pre>
<p>å¦ä¸€ä¸ªç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">const newRegex = /^\p{sc=Han}+$/gu

newRegex.test('ä¶®') // true
</code></pre>
<h2>è®¾å¤‡/æµè§ˆå™¨åˆ¤æ–­</h2>
<p>åˆ¤æ–­è‹¹æœè®¾å¤‡</p>
<pre><code class="language-js">const isAppleDevice = /Mac|iPod|iPhone|iPad/.test(navigator.platform)
</code></pre>
<p>åˆ¤æ–­ç§»åŠ¨è®¾å¤‡</p>
<pre><code class="language-js">const isMobile = /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|IEMobile)/i.test(navigator.userAgent)
</code></pre>
<h2>å…¶ä»–</h2>
<h3>è¯­ä¹‰åŒ–ç‰ˆæœ¬å·</h3>
<pre><code class="language-js">// https://regex101.com/r/vkijKf/1/
const regex = /^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/

regex.test('1.0.0') // true
regex.test('v1.0.0') // false
regex.test('1.0') // false
</code></pre>
<p>è‹¥è¦æ”¯æŒæ›´å¤šç‰¹æ€§ï¼ˆå¦‚ <code>1.0.0-alpha</code> ç­‰ï¼‰ã€ç‰ˆæœ¬æ¯”è¾ƒç­‰ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://www.npmjs.com/package/semver">semver</a> è¿™ä¸ªåº“ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/231">JavaScript æ­£åˆ™è¡¨è¾¾å¼</a></li>
<li><a href="https://www.cnblogs.com/hyunbar/p/10083532.html">å°æ•°ç‚¹åä¿ç•™ 2 ä½å°æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åŸæ¥ Markdown ä»£ç å—æ”¯æŒè¯­è¨€é«˜äº®]]></title>
            <link>https://github.com/toFrankie/blog/issues/133</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/133</guid>
            <pubDate>Sat, 25 Feb 2023 13:43:11 GMT</pubDate>
            <description><![CDATA[<h3>ä¸¤ç§ç±»å‹</h3>
<ul>
<li>æŒ‡å®š JavaScript è¯­è¨€</li>
</ul>
<pre><code class="language-js">const path = require('path')
</code></pre>
<ul>
<li>æ²¡æœ‰æŒ‡å®šè¯­è¨€</li>
</ul>
<pre><co]]></description>
            <content:encoded><![CDATA[<h3>ä¸¤ç§ç±»å‹</h3>
<ul>
<li>æŒ‡å®š JavaScript è¯­è¨€</li>
</ul>
<pre><code class="language-js">const path = require('path')
</code></pre>
<ul>
<li>æ²¡æœ‰æŒ‡å®šè¯­è¨€</li>
</ul>
<pre><code>const path = require('path')
</code></pre>
<p>é€šè¿‡å…ƒç´ å®¡æŸ¥ï¼Œå¯ä»¥å‘ç°å®ƒæ˜¯æ·»åŠ ç›¸åº”è¯­è¨€çš„é«˜äº®é£æ ¼ï¼ˆhighlightï¼‰çš„ï¼Œç„¶åå„ä¸ªå¹³å°çš„é«˜äº®é£æ ¼ä¼šç•¥æœ‰ä¸åŒã€‚</p>
<p>åœ¨ç®€ä¹¦å¹³å°åº”è¯¥æ˜¯è‡ªåŠ¨è¯†åˆ«è¯­è¨€äº†ï¼Œæ‰€ä»¥ä½ ç°åœ¨çœ‹åˆ°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å®ƒä»¬å¥½åƒæ˜¯ç”¨åˆ°äº† <a href="https://github.com/syntaxhighlighter/syntaxhighlighter">syntaxhighlighter</a> åº“ï¼Œæˆ–è€…è‡ªå·±å®ç°äº†ä¸€å¥—å§ï¼Œæ²¡æœ‰ç»†ç©¶ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c675d5f58ea301b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>GitHub æ•ˆæœ</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e7f0cfcc039a485e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>æ”¯æŒçš„è¯­è¨€</h3>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å…³é”®å­—</th>
</tr>
</thead>
<tbody>
<tr>
<td>JavaScript</td>
<td>jsã€jscriptã€javascript</td>
</tr>
<tr>
<td>CSS</td>
<td>css</td>
</tr>
<tr>
<td>SASS&amp;SCSS</td>
<td>sassã€scss</td>
</tr>
<tr>
<td>Java</td>
<td>java</td>
</tr>
<tr>
<td>Python</td>
<td>pyã€python</td>
</tr>
<tr>
<td>text</td>
<td>text ã€plain</td>
</tr>
<tr>
<td>XML</td>
<td>xmlã€xhtmlã€xsltã€html</td>
</tr>
<tr>
<td>SQL</td>
<td>sql</td>
</tr>
<tr>
<td>PHP</td>
<td>php</td>
</tr>
<tr>
<td>AppleScript</td>
<td>applescript</td>
</tr>
<tr>
<td>ActionScript 3.0</td>
<td>actionscript3ã€as3</td>
</tr>
<tr>
<td>Shell</td>
<td>bash , shell</td>
</tr>
<tr>
<td>ColdFusion</td>
<td>coldfusionã€cf</td>
</tr>
<tr>
<td>C</td>
<td>cppã€c</td>
</tr>
<tr>
<td>C#</td>
<td>c#ã€c-sharpã€csharp</td>
</tr>
<tr>
<td>Delphi</td>
<td>delphiã€pascalã€pas</td>
</tr>
<tr>
<td>diff&amp;patch</td>
<td>diff patch</td>
</tr>
<tr>
<td>Erlang</td>
<td>erlã€erlang</td>
</tr>
<tr>
<td>Groovy</td>
<td>groovy</td>
</tr>
<tr>
<td>JavaFX</td>
<td>jfxã€javafx</td>
</tr>
<tr>
<td>Perl</td>
<td>perlã€plã€Perl</td>
</tr>
<tr>
<td>Ruby</td>
<td>rubyã€railsã€rorã€rb</td>
</tr>
<tr>
<td>Scala</td>
<td>scala</td>
</tr>
<tr>
<td>Visual Basic</td>
<td>vbã€vbnet</td>
</tr>
<tr>
<td>Objective C</td>
<td>objcã€obj-c</td>
</tr>
<tr>
<td>F#</td>
<td>f#ã€f-sharpã€fsharp</td>
</tr>
<tr>
<td></td>
<td>xppã€dynamics-xpp</td>
</tr>
<tr>
<td>R</td>
<td>rã€sã€splus</td>
</tr>
<tr>
<td>matlab</td>
<td>matlab</td>
</tr>
<tr>
<td>swift</td>
<td>swift</td>
</tr>
<tr>
<td>GO</td>
<td>goã€golang</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li><code>diff&amp;patch</code>ï¼šä»£ç ç‰ˆæœ¬æ§åˆ¶ï¼Œé‡åˆ°ä»£ç å†²çªï¼Œå…¶è¯­æ³•å°±æ˜¯è¿™ä¸ªã€‚</li>
<li><code>text</code>: å°±æ˜¯æ™®é€šæ–‡æœ¬ã€‚</li>
</ul>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[APP è®¾è®¡å¸¸ç”¨å­—ä½“]]></title>
            <link>https://github.com/toFrankie/blog/issues/132</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/132</guid>
            <pubDate>Sat, 25 Feb 2023 13:42:44 GMT</pubDate>
            <description><![CDATA[<p>æœ‰æ—¶å€™æ€»å¿˜è®° Androidã€iOS ç³»ç»Ÿ APP è®¾è®¡å¸¸ç”¨å­—ä½“ï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼š</p>
<h5>iOS 7ï¼š</h5>
<blockquote>
<p>ä¸­æ–‡ï¼šåæ–‡ç»†é»‘ã€é»‘ä½“ç®€
è‹±æ–‡ï¼šHelvetica Ne</p>
</blockquote>
<h5>iOS 9ï¼š</h5>
<blockquote>
<p>]]></description>
            <content:encoded><![CDATA[<p>æœ‰æ—¶å€™æ€»å¿˜è®° Androidã€iOS ç³»ç»Ÿ APP è®¾è®¡å¸¸ç”¨å­—ä½“ï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼š</p>
<h5>iOS 7ï¼š</h5>
<blockquote>
<p>ä¸­æ–‡ï¼šåæ–‡ç»†é»‘ã€é»‘ä½“ç®€
è‹±æ–‡ï¼šHelvetica Ne</p>
</blockquote>
<h5>iOS 9ï¼š</h5>
<blockquote>
<p>ä¸­æ–‡ï¼šè‹¹æ–¹é»‘
è‹±æ–‡ï¼šSystem San Francisco</p>
</blockquote>
<h5>å®‰å“ 4.0 ä»¥ä¸Šï¼š</h5>
<blockquote>
<p>ä¸­æ–‡ï¼šæ–¹æ­£å…°äº­é»‘ç®€ä½“ã€æ–¹æ­£å…°äº­ç»†é»‘ä½“
è‹±æ–‡ï¼šRoboto</p>
</blockquote>
<h5>Material Designï¼š</h5>
<blockquote>
<p>ä¸­æ–‡ï¼šNotoï¼ˆæˆ–å«æ€æºé»‘ä½“ï¼‰
è‹±æ–‡ï¼šRoboto</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ENOENT æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/131</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/131</guid>
            <pubDate>Sat, 25 Feb 2023 13:39:36 GMT</pubDate>
            <description><![CDATA[<p>åŸå› æ˜¯è¿™æ ·çš„ï¼Œä»Šå¤©åœ¨è°ƒè¯•ä¸€ä¸ª <code>Gulp</code> çš„å‘½ä»¤ï¼Œç„¶åå°±æŠ¥äº†è¿‡é”™ï¼Œå“ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8f6220621c7b5e54.png?imageMogr2/auto-]]></description>
            <content:encoded><![CDATA[<p>åŸå› æ˜¯è¿™æ ·çš„ï¼Œä»Šå¤©åœ¨è°ƒè¯•ä¸€ä¸ª <code>Gulp</code> çš„å‘½ä»¤ï¼Œç„¶åå°±æŠ¥äº†è¿‡é”™ï¼Œå“ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8f6220621c7b5e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ˜Œ"></p>
<p>å‰åŠå¥çœ‹æ‡‚äº†ï¼Œç„¶å <code>ENOENT</code> ä¼¼ä¹æ˜¯ç¬¬ä¸€æ¬¡è§ï¼Œç„¶åå°±æœäº†ä¸€ç•ªã€‚</p>
<blockquote>
<p>å®ƒæ˜¯ Error No Entry çš„ç¼©å†™ã€‚ æ„æ€æ˜¯ï¼šæ²¡æœ‰è¿™æ ·çš„ç›®å½•æ¡ç›®ã€‚<a href="https://cloud.tencent.com/developer/ask/27778">ğŸ‘‰ answer from here</a></p>
</blockquote>
<p>è¿™æ˜¯ä¸€ç¯‡æ²¡æœ‰è¥å…»çš„æ–‡ç« ï¼Œä½†æ²¡å…³ç³»ï¼Œå“ˆå“ˆã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…¨å›½å“€æ‚¼ï¼Œä¸ºäº†æ›´å¥½åœ°å‰è¡Œ]]></title>
            <link>https://github.com/toFrankie/blog/issues/130</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/130</guid>
            <pubDate>Sat, 25 Feb 2023 13:37:25 GMT</pubDate>
            <description><![CDATA[<p>ä¸ºè¡¨è¾¾å…¨å›½äººæ°‘å¯¹æŠ—å‡»æ–°å† è‚ºç‚ç–«æƒ…æ–—äº‰ç‰ºç‰²çƒˆå£«å’Œé€ä¸–åŒèƒçš„æ·±åˆ‡å“€æ‚¼ï¼Œå›½åŠ¡é™¢ 4 æœˆ 3 æ—¥å‘å¸ƒå…¬å‘Šï¼š<strong>å†³å®š 2020 å¹´ 4 æœˆ 4 æ—¥ä¸¾è¡Œå…¨å›½æ€§å“€æ‚¼æ´»åŠ¨</strong>ã€‚åœ¨æ­¤æœŸé—´ï¼Œå…¨å›½å’Œé©»å¤–ä½¿é¢†é¦†ä¸‹åŠæ——å¿—å“€ï¼Œå…¨å›½åœæ­¢å…¬å…±å¨±ä¹æ´»åŠ¨ï¼Œä»ä¸Šåˆ 10 æ—¶èµ·ï¼Œå…¨å›½äººæ°‘é»˜å“€ 3 åˆ†é’Ÿï¼Œæ±½è½¦ã€ç«è½¦ã€èˆ°èˆ¹é¸£ç¬›ï¼Œé˜²]]></description>
            <content:encoded><![CDATA[<p>ä¸ºè¡¨è¾¾å…¨å›½äººæ°‘å¯¹æŠ—å‡»æ–°å† è‚ºç‚ç–«æƒ…æ–—äº‰ç‰ºç‰²çƒˆå£«å’Œé€ä¸–åŒèƒçš„æ·±åˆ‡å“€æ‚¼ï¼Œå›½åŠ¡é™¢ 4 æœˆ 3 æ—¥å‘å¸ƒå…¬å‘Šï¼š<strong>å†³å®š 2020 å¹´ 4 æœˆ 4 æ—¥ä¸¾è¡Œå…¨å›½æ€§å“€æ‚¼æ´»åŠ¨</strong>ã€‚åœ¨æ­¤æœŸé—´ï¼Œå…¨å›½å’Œé©»å¤–ä½¿é¢†é¦†ä¸‹åŠæ——å¿—å“€ï¼Œå…¨å›½åœæ­¢å…¬å…±å¨±ä¹æ´»åŠ¨ï¼Œä»ä¸Šåˆ 10 æ—¶èµ·ï¼Œå…¨å›½äººæ°‘é»˜å“€ 3 åˆ†é’Ÿï¼Œæ±½è½¦ã€ç«è½¦ã€èˆ°èˆ¹é¸£ç¬›ï¼Œé˜²ç©ºè­¦æŠ¥é¸£å“ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677332408014.png" alt=""></p>
<p>å‡ ä¹æ‰€æœ‰çš„æ¸¸æˆåœæœã€ç›´æ’­åœæ’­ã€å½±è§†åœæ›´ï¼ŒåŒæ—¶ä¸Šçº¿æŠ—ç–«ç¼…æ€€ä¸“é¢˜ã€‚è¿˜æœ‰ä¸€ä¸ªç°è±¡å°±æ˜¯å¾ˆå¤š APPã€ç½‘ç«™ç•Œé¢ç½®ç°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677332473902.png" alt="ç®€ä¹¦"></p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677332490924.png" alt="æ˜é‡‘"></p>
<p>ä½œä¸ºä¸€ä½å‰ç«¯é¡µé¢åˆ‡å›¾ä»”ï¼Œå¦‚ä½•è®©é¡µé¢å˜ç°å‘¢ï¼Ÿéå¸¸åœ°ç®€å•ã€‚åªéœ€è¦ä¸€è¡Œ CSS ä»£ç ï¼š</p>
<pre><code class="language-css">.your-class {
  filter: grayscale(1); /* ç°åº¦æ»¤é•œï¼šèŒƒå›´ 0 ~ 1ï¼Œæˆ–è€… 0 ~ 100% */
}
</code></pre>
<p><strong>æ„Ÿè°¢æœ‰ä½ ä»¬ã€‚â€ï¸â€ï¸â€â™€ï¸</strong></p>
<p>æœ€åï¼Œå¸Œæœ›æ˜¥æš–èŠ±å¼€ä¹‹æ—¥æ—©äº›åˆ°æ¥ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°† CSScomb é›†æˆåˆ° Git Hook ä¸­]]></title>
            <link>https://github.com/toFrankie/blog/issues/129</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/129</guid>
            <pubDate>Sat, 25 Feb 2023 13:30:24 GMT</pubDate>
            <description><![CDATA[<p>åœ¨æ­¤å‰æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨ CSScomb æ¥å¤„ç†æˆ‘ä»¬çš„å°ç¨‹åºæ ·å¼æ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ–‡ç« æœ‰ä¸¤ç¯‡ï¼š</p>
<ol>
<li><a href="https://github.com/toFrankie/blog/issues/128">å°† CSScomb é›†æˆåˆ°å¾®ä¿¡å°ç¨‹åºé¡¹]]></description>
            <content:encoded><![CDATA[<p>åœ¨æ­¤å‰æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨ CSScomb æ¥å¤„ç†æˆ‘ä»¬çš„å°ç¨‹åºæ ·å¼æ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ–‡ç« æœ‰ä¸¤ç¯‡ï¼š</p>
<ol>
<li><a href="https://github.com/toFrankie/blog/issues/128">å°† CSScomb é›†æˆåˆ°å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ä¸­</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/129">å°† CSScomb é›†æˆåˆ° Git Hook ä¸­</a>ï¼ˆæœ¬æ–‡ï¼‰</li>
</ol>
<p>é¡¹ç›®æ”¾åœ¨ GitHub ä¸Š ğŸ‘‰ <a href="https://github.com/toFrankie/csscomb-mini">csscomb-mini</a> æ¬¢è¿ Star ğŸ‘‹ã€‚</p>
</blockquote>
<p>ä½†æ˜¯æ­¤å‰å®ç°æœ‰ä¸ªä¸è¶³çš„åœ°æ–¹ï¼š<strong>æ²¡æœ‰å®ç°åœ¨æäº¤ä»£ç ä¹‹å‰å»æ‰§è¡Œæˆ‘ä»¬çš„è„šæ­¥å‘½ä»¤ã€‚</strong></p>
<h3>ä¸€ã€è®¾æƒ³</h3>
<p>å‡è®¾æˆ‘ä»¬å¯ä»¥åœ¨ <code>pre-commit</code> é˜¶æ®µåšä¸€äº›ç±»ä¼¼ ESLintã€Prettier çš„æ“ä½œï¼Œå²‚ä¸ç¾å“‰ï¼</p>
<p>ä¾‹å¦‚ï¼Œå¦‚ä¸‹é…ç½®æ–‡ä»¶æ˜¯åˆ©ç”¨ huskyã€lint-staged åšäº†ä¸€äº›å¤„ç†ï¼Œåœ¨ä»£ç  commit ä¹‹å‰å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥å’Œæ ¼å¼åŒ–ã€‚</p>
<pre><code class="language-json5">{
  &quot;husky&quot;: {
    &quot;hooks&quot;: {
      &quot;pre-commit&quot;: &quot;lint-staged&quot;
    }
  },
  &quot;lint-staged&quot;: {
    &quot;*.{js}&quot;: &quot;eslint --fix --ext .js&quot;,
    &quot;*.{css,wxss,acss}&quot;: &quot;prettier --config .prettierrc.js --write&quot;
  }
}
</code></pre>
<p>é‚£æˆ‘ä»¬ä½¿ç”¨ CSScomb ä¹Ÿæƒ³è¿™ä¹ˆåšçš„è¯ï¼Œè¦æ€æ ·å®ç°å‘¢ï¼Ÿ</p>
<h3>äºŒã€è¯•å›¾å®ç°</h3>
<p>å…³äºå‰ä¸€ç¯‡æ–‡ç« çš„å…·ä½“æ€è·¯å°±ä¸å†èµ˜è¿°äº†ï¼ˆéœ€è¦çš„è¯ï¼Œè¯·çœ‹<a href="https://www.jianshu.com/p/7c3ce9be7341">å®ç°ä¸€ä¸ª CSScomb çš„ Gulp æ’ä»¶å¹¶åº”ç”¨äºå¾®ä¿¡å°ç¨‹åº</a> ï¼‰ã€‚</p>
<ol>
<li>é¦–å…ˆå®‰è£… huskyã€lint-stagedã€‚</li>
</ol>
<p>å¦‚æœå¯¹ä¸¤è€…ä¸å¤ªäº†è§£çš„è¯ï¼Œå¯ä»¥å»çœ‹æˆ‘å†™çš„å¦å¤–ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/124">æ–‡ç« </a>ã€‚</p>
<pre><code># è¿™é‡Œæˆ‘ä¸å®‰è£…æœ€æ–°ç‰ˆ husky çš„åŸå› æ˜¯ husky 5.x åœ¨ä½¿ç”¨ä¸Šæœ‰å¾ˆå¤§å˜åŒ–
# æˆ‘æš‚æ—¶è¿˜æ²¡æ—¶é—´å»äº†è§£å®ƒï¼Œæ‰€ä»¥å…ˆç”¨ç€å·²ç»ä¹ æƒ¯çš„ 4.x ç‰ˆæœ¬ï¼Œé—®é¢˜ä¸å¤§
$ yarn add --dev husky@4.3.8 lint-staged
</code></pre>
<ol start="2">
<li>åœ¨ <code>package.json</code> æ·»åŠ é…ç½®ï¼Œå¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="language-json5">{
  &quot;scripts&quot;: {
    &quot;csscomb&quot;: &quot;gulp wxssTask&quot;,
    &quot;csscomb:mini&quot;: &quot;gulp csscombTask --path './**/*.wxss'&quot;
  },
  &quot;husky&quot;: {
    &quot;hooks&quot;: {
      &quot;pre-commit&quot;: &quot;lint-staged&quot;
    }
  },
  &quot;lint-staged&quot;: {
    &quot;*.wxss&quot;: &quot;gulp csscombTask&quot;
  }
}
</code></pre>
<ol start="3">
<li>æ¥ç€ï¼Œæˆ‘ä»¬å°è¯•å»ä¿®æ”¹ä¸€ä¸ªæ ·å¼æ–‡ä»¶ï¼Œå¹¶æäº¤ä»£ç ã€‚</li>
</ol>
<pre><code class="language-shell">$ git commit -m 'test'
                                                                                                          
husky &gt; pre-commit (node v14.16.0)
âœ” Preparing...
âš  Running tasks...
  â¯ Running tasks for *.wxss
    âœ– gulp csscombTask [FAILED]
â†“ Skipped because of errors from tasks. [SKIPPED]
âœ” Reverting to original state because of errors...
âœ” Cleaning up...

âœ– gulp csscombTask:
[14:30:14] Task never defined: /Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss
[14:30:14] To list available tasks, try running: gulp --tasks
[14:30:14] Using gulpfile ~/Desktop/Web/Git/csscomb-mini/gulpfile.js
husky &gt; pre-commit hook failed (add --no-verify to bypass)
</code></pre>
<p>éå¸¸çš„é—æ†¾ï¼Œå®ƒå¤±è´¥äº†ï¼Œå¹¶æç¤ºï¼š<code>Task never defined: /Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss</code>ã€‚</p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ˜æ˜æ˜¯æ‰¾å¾—åˆ° <code>csscombTask</code> ä»»åŠ¡çš„å•Šï¼</p>
<pre><code class="language-shell">$ npx gulp --tasks

[14:35:09] Tasks for ~/Desktop/Web/Git/csscomb-mini/gulpfile.js
[14:35:09] â”œâ”€â”€ wxssTask
[14:35:09] â””â”€â”€ csscombTask
</code></pre>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿä»€ä¹ˆåŸå› å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯æˆ‘çš„è¸©å‘çš„åœ°æ–¹ã€‚</p>
<h3>ä¸‰ã€å¯»æ‰¾å¤±è´¥åŸå› </h3>
<p>é¦–å…ˆï¼Œæˆ‘å…ˆç¿»é˜…äº† lint-staged çš„<a href="https://github.com/okonet/lint-staged#lintstagedrc-example">æ–‡æ¡£</a> ï¼Œé‡Œé¢æœ‰ä¸€æ®µè¯ï¼š</p>
<pre><code class="language-json">{
  &quot;*&quot;: &quot;your-cmd&quot;
}
</code></pre>
<p>This config will execute <code>your-cmd</code> with the list of currently staged files passed as arguments.</p>
<p>So, considering you did <code>git add file1.ext file2.ext</code>, lint-staged will run the following command: <code>your-cmd file1.ext file2.ext</code>.</p>
<p>å‡è®¾æˆ‘ä»¬æš‚å­˜çš„æ–‡ä»¶æ˜¯ <code>/Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œï¼š</p>
<pre><code class="language-json">{
  &quot;*.wxss&quot;: &quot;gulp csscombTask&quot;
}
</code></pre>
<p>å°±ç­‰äºæ‰§è¡Œäº† <code>gulp csscombTask /Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss</code> è¿™æ¡æŒ‡ä»¤ã€‚</p>
<p>ä½†å¦‚æœç†Ÿæ‚‰ <a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/#%E6%B5%8B%E8%AF%95">Gulp</a> çš„è¯ï¼Œå½¢å¼å¦‚ï¼š<code>gulp &lt;task&gt; &lt;othertask&gt;</code> å…¶å®æ˜¯æ‰§è¡Œäº†å¤šä¸ªä»»åŠ¡ã€‚ æ‰€ä»¥ï¼Œä¸Šé¢å®é™…ä¸Šæ‰§è¡Œäº†ä¸¤ä¸ªä»»åŠ¡ <code>csscombTask</code>ã€<code>/Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss</code>ï¼Œå®ƒæŠŠåè€…ä¹Ÿå½“æˆæ˜¯ä¸€ä¸ªä»»åŠ¡äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ª Gulp ä»»åŠ¡ï¼š</p>
<pre><code class="language-js">const test = cb =&gt; {
  // éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
  // ç”±äº node ç‰¹æ€§ï¼Œéä¸»è¿›ç¨‹ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œæ— æ³•å°† test log æ‰“å°å‡ºæ¥ï¼Œ
  // ä¾‹å¦‚åœ¨ lint-staged ä¸‹æ‰§è¡Œè¯¥ gulp ä»»åŠ¡ï¼Œå°±æ— æ³•æ‰“å°ï¼Œ
  // å¦‚æœé€šè¿‡ npx gulp xxx æ‰§è¡Œä»»åŠ¡ï¼Œå±äºä¸»è¿›ç¨‹ï¼Œå°±èƒ½æ‰“å°å‡ºæ¥ã€‚
  console.log('test log')
  cb()
}

module.exports = {
  csscombTask,
  '/Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss': test
}
</code></pre>
<p>æ¥ç€é‡æ–°æäº¤ä¸€ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-shell">$ git commit -m 'test'

husky &gt; pre-commit (node v14.16.0)
âœ” Preparing...
âœ” Running tasks...
âœ” Applying modifications...
âœ” Cleaning up...
[master a2ba057] test
 1 file changed, 3 insertions(+), 3 deletions(-)
</code></pre>
<p>å®ƒæˆåŠŸäº†ï¼Œè¯´æ˜æˆ‘ä»¬çš„çŒœæƒ³æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æ—¢ç„¶æ‰¾åˆ°äº†ç¼˜ç”±ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼€å§‹ç€æ‰‹è§£å†³é—®é¢˜å§ã€‚</p>
<h3>å››ã€è§£å†³é—®é¢˜</h3>
<p>å…¶å® <code>/Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss</code> åº”è¯¥æ˜¯æˆ‘ä»¬ Gulp ä»»åŠ¡çš„å‚æ•°æ‰å¯¹ã€‚</p>
<p>æŒ‰ç…§æ­¤å‰çš„çº¦å®šï¼š</p>
<pre><code class="language-shell">gulp csscombTask --path '&lt;filepath&gt;' --ext &lt;extension&gt;
</code></pre>
<p>æ‰€ä»¥åªè¦æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤å½¢å¼å¦‚ï¼š<code>gulp csscombTask --path '/Users/frankie/Desktop/Web/Git/csscomb-mini/app.wxss'</code> å³å¯ã€‚</p>
<p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ lint-staged çš„é…ç½®æ–‡ä»¶ï¼Œæ­¤å‰åœ¨ <code>package.json</code> çš„é…ç½®æ–¹å¼å±€é™æ€§å¤ªå¤§äº†ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ JavaScript å½¢å¼çš„é…ç½®æ–¹å¼ï¼š</p>
<blockquote>
<p>Writing the configuration file in JavaScript is the most powerful way to configureÂ <em>lint-staged</em>Â (<code>lint-staged.config.js</code>,Â <a href="https://github.com/okonet/lint-staged#configuration">similar</a>, or passed viaÂ <code>--config</code>).</p>
</blockquote>
<p>å…¶å® lint-staged æä¾›äº†å¾ˆå¤šçš„é…ç½®ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://github.com/okonet/lint-staged#example-wrap-filenames-in-single-quotes-and-run-once-per-file">Example: Wrap filenames in single quotes and run once per file</a> å³å¯ã€‚</p>
<p>ç§»é™¤ <code>package.json</code> çš„é…ç½®é¡¹ï¼Œå¹¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»º <code>.lintstagedrc.js</code> é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="language-js">// .lintstagedrc.js
module.exports = {
  '*.wxss': filenames =&gt; filenames.map(filename =&gt; `gulp csscombTask --path ${filename}`)
}

// å…¶å®è¿™é‡Œå¯é…ç½®çš„æ–¹å¼å¾ˆå¤šï¼Œ
// ä¾‹å¦‚ï¼šè¶…è¿‡ 10 ä¸ªæš‚å­˜æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªé¡¹ç›®ä¸‹æ‰§è¡Œä¸€é csscombTask æ“ä½œï¼š
// module.exports = {
//   '*.wxss': filenames =&gt; {
//     if (filenames.length &gt; 10) {
//       return 'gulp csscombTask --path './**/*.wxss''
//     }
//     return `gulp csscombTask --path '${filenames.join(',')'}`
//   }
// }
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸¤ä¸ªæ ·å¼æ–‡ä»¶ï¼Œå†æäº¤ä¸€ä¸‹ï¼š</p>
<pre><code class="language-shell">$ git commit -m 'test'

husky &gt; pre-commit (node v14.16.0)
âœ” Preparing...
âœ” Running tasks...
âœ” Applying modifications...
âœ” Cleaning up...
[master 7b84b9c] test
 2 files changed, 7 insertions(+), 3 deletions(-)
</code></pre>
<p>å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè€Œä¸”æˆ‘ä»¬æ‰€æäº¤çš„æ–‡ä»¶éƒ½ç»è¿‡äº† CSScomb æ ¼å¼åŒ–äº†ï¼ŒğŸ‰ğŸ‰ğŸ‰ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°† CSScomb é›†æˆåˆ°å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ä¸­]]></title>
            <link>https://github.com/toFrankie/blog/issues/128</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/128</guid>
            <pubDate>Sat, 25 Feb 2023 13:29:44 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ <a href="http://www.alloyteam.com/">AlloyTeam</a> å›¢é˜Ÿçš„ <a href="http://alloyteam.github.io/CodeGuide/">Code Guide</a> ä»£ç ä¹¦å†™ä¹ æƒ¯ï¼Œå…¶ä¸­ä¸€é¡¹æ˜¯ <a href="http://alloyt]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ <a href="http://www.alloyteam.com/">AlloyTeam</a> å›¢é˜Ÿçš„ <a href="http://alloyteam.github.io/CodeGuide/">Code Guide</a> ä»£ç ä¹¦å†™ä¹ æƒ¯ï¼Œå…¶ä¸­ä¸€é¡¹æ˜¯ <a href="http://alloyteam.github.io/CodeGuide/#css-declaration-order">CSS å±æ€§ç¼–å†™é¡ºåº</a>ã€‚</p>
<p>è™½ç„¶ CSS å±æ€§é¡ºåºå…ˆåå¹¶ä¸å½±å“æˆ‘ä»¬çš„ç¨‹åºï¼Œé‚£ä¸ºä»€ä¹ˆè¦åšè¿™ä»¶äº‹å‘¢ï¼Ÿæˆ‘ç†è§£æ˜¯å¯åˆ†ç±»ã€æœ‰è¿¹å¯å¾ªã€æœ‰åˆ©äºæ’æŸ¥é”™è¯¯ã€‚</p>
<p>ç”±äºå±æ€§ä¼—å¤šï¼Œé‚£ä¹ˆäººæ€»æ˜¯ä¼šçŠ¯é”™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ªå·¥å…·æ¥å¤„ç†ï¼Œå®ƒå°±æ˜¯ <a href="https://github.com/csscomb/csscomb.js">CSScomb</a>ï¼Œç”¨äº CSS æ ¼å¼åŒ–ã€ä¸”å¯æ’åºã€‚å®˜æ–¹æè¿°æ˜¯ï¼šCSScomb is a coding style formatter for CSS.</p>
<blockquote>
<p>**æœ¬æ–‡æ—¨åœ¨ä½¿å¾— CSScomb æ”¯æŒæ ¼å¼åŒ–å°ç¨‹åºæ ·å¼ <code>.wxss</code>ã€‚**åŒæ—¶ä¹Ÿæ”¯æŒæ”¯ä»˜å®å°ç¨‹åº <code>.acss</code>ï¼Œè€Œç™¾åº¦å°ç¨‹åºæ ·å¼æ–‡ä»¶çš„æ‰©å±•åæ˜¯ <code>.css</code>ï¼Œæ‰€ä»¥å®ƒå¤©ç”Ÿå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p>
<p>æ–‡ç« æœ‰ä¸¤ç¯‡ï¼š</p>
<ol>
<li><a href="https://github.com/toFrankie/blog/issues/128">å°† CSScomb é›†æˆåˆ°å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ä¸­</a>ï¼ˆæœ¬æ–‡ï¼‰</li>
<li><a href="https://github.com/toFrankie/blog/issues/129">å°† CSScomb é›†æˆåˆ° Git Hook ä¸­</a></li>
</ol>
<p>é¡¹ç›®æ”¾åœ¨ GitHub ä¸Š ğŸ‘‰ <a href="https://github.com/toFrankie/csscomb-mini">csscomb-mini</a> æ¬¢è¿ Star ğŸ‘‹ã€‚</p>
</blockquote>
<p>æ­¤å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡æ–‡ç« <a href="https://github.com/toFrankie/blog/issues/123">ã€ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSã€‘</a>æ˜¯è®²è¿°ä½¿ç”¨ Prettier æ¥æ ¼å¼åŒ–å°ç¨‹åºçš„ï¼Œä½†å®ƒæ²¡æœ‰ CSScomb çš„å±æ€§æ’åºåŠŸèƒ½ã€‚ï¼ˆåç»­å¯èƒ½ä¼šè€ƒè™‘æ•´åˆèµ·æ¥ï¼Œè¿™æ˜¯åè¯äº†ï¼‰</p>
<h3>ä¸€ã€CSScomb å®‰è£…ä½¿ç”¨</h3>
<p>åˆ›å»ºä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºé¡¹ç›®ï¼Œå› è¿‡äºç®€å•ï¼Œå¿½ç•¥è¯¥æ­¥éª¤ã€‚</p>
<h5>1. æœ¬åœ°å®‰è£…</h5>
<pre><code class="language-shell">$ yarn add csscomb --dev
</code></pre>
<h5>2. æ·»åŠ é…ç½®æ–‡ä»¶</h5>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ·»åŠ é…ç½®æ–‡ä»¶ <code>.csscomb.json</code>ã€‚</p>
<p>è‹¥æ— é…ç½®æ–‡ä»¶ï¼ŒCSScomb çš„é»˜è®¤é…ç½®è¯·çœ‹ <a href="https://github.com/csscomb/csscomb.js/blob/master/config/csscomb.json">csscomb.js/config/csscomb.json</a>ã€‚</p>
<p>è€Œæœ¬æ–‡å‡é‡‡ç”¨ AlloyTeam æ¨èçš„<a href="http://alloyteam.github.io/CodeGuide/#css-declaration-order">æ’åºè§„åˆ™</a>ï¼Œè€Œéé»˜è®¤ã€‚<strong>ä½†ç”±äº <code>sort-order</code> å¾ˆé•¿ï¼Œå½±å“æ–‡ç« ç¯‡å¹…ï¼Œéƒ¨åˆ†é…ç½®æ²¡è´´ä¸Šå»ï¼Œå®Œæ•´é…ç½®è¯·çœ‹çœ‹ ğŸ‘‰ <a href="https://github.com/toFrankie/csscomb-mini/blob/master/.csscomb.json">csscomb-mini/.csscomb.json</a>ã€‚</strong></p>
<blockquote>
<p>å…³äºè¯¥é…ç½®æ–‡ä»¶æ˜¯æŒ‰æˆ‘å¹³å¸¸ç¼–å†™ä»£ç çš„ä¹ æƒ¯è°ƒæ•´æœ‰æ‰€è°ƒæ•´çš„ï¼Œå¹¶é CSScomb é»˜è®¤é…ç½®ã€‚å…·ä½“é…ç½®é¡¹æ‰€æŒ‡å¯ç»†çœ‹ ğŸ‘‰ <a href="https://github.com/csscomb/csscomb.js/blob/dev/doc/options.md">CSScomb Configuration Options</a>ã€‚æ³¨æ„ CSScomb æ‰€èƒ½åšçš„äº‹æƒ…å¹¶éå°±åªæœ‰å±æ€§æ’åºå“¦ï¼Œæ¯”å¦‚è®¾ç½®ç¼©è¿›ã€é¢œè‰²å€¼åå…­è¿›åˆ¶å¤§å°å†™ã€å‰å¯¼é›¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
</blockquote>
<pre><code class="language-json">{
  &quot;exclude&quot;: [&quot;.git/**&quot;, &quot;node_modules/**&quot;, &quot;bower_components/**&quot;],
  &quot;verbose&quot;: true,
  &quot;always-semicolon&quot;: true,
  &quot;block-indent&quot;: 2,
  &quot;color-case&quot;: &quot;lower&quot;,
  &quot;color-shorthand&quot;: true,
  &quot;element-case&quot;: &quot;lower&quot;,
  &quot;eof-newline&quot;: true,
  &quot;leading-zero&quot;: false,
  &quot;quotes&quot;: &quot;single&quot;,
  &quot;remove-empty-rulesets&quot;: false,
  &quot;space-before-colon&quot;: 0,
  &quot;space-after-colon&quot;: 1,
  &quot;space-before-combinator&quot;: 1,
  &quot;space-after-combinator&quot;: 1,
  &quot;space-before-opening-brace&quot;: 1,
  &quot;space-after-opening-brace&quot;: &quot;\n&quot;,
  &quot;space-before-closing-brace&quot;: &quot;\n&quot;,
  &quot;space-before-selector-delimiter&quot;: 0,
  &quot;space-after-selector-delimiter&quot;: &quot;\n&quot;,
  &quot;space-between-declarations&quot;: &quot;\n &quot;,
  &quot;strip-spaces&quot;: true,
  &quot;unitless-zero&quot;: true,
  &quot;vendor-prefix-align&quot;: false,
  &quot;sort-order&quot;: []
}
</code></pre>
<h5>3. æ·»åŠ  NPM è„šæœ¬</h5>
<p>ä¸ºäº†æµ‹è¯•æ•ˆæœï¼Œæ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>app.css</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;csscomb&quot;: &quot;csscomb app.css&quot;
  }
}
</code></pre>
<h5>4. è¿è¡Œè„šæœ¬</h5>
<pre><code class="language-shell">$ yarn run csscomb

âœ“ app.css
âœ¨  Done in 0.45s.
</code></pre>
<h5>5. æ•ˆæœ</h5>
<p>æŒ‰ä»¥ä¸Šé…ç½®æ–‡ä»¶çš„æ’åºè§„åˆ™ï¼Œ<code>padding-right</code> å±æ€§åœ¨ <code>padding-left</code> ä¹‹å‰ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ä¿®æ”¹å‰åçš„å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">/* before */
view {
  padding-left: 30px;
  padding-right: 30px;
}

/* after */
view {
  padding-right: 30rpx;
  padding-left: 30rpx;
}
</code></pre>
<h3>äºŒã€å¾®ä¿¡å°ç¨‹åºå¦‚ä½•ä½¿ç”¨ csscomb</h3>
<p>ç”±äº CSScomb ä»…æ”¯æŒæ‰©å±•åä¸º <code>.css</code>ã€<code>.sass</code>ã€<code>.scss</code>ã€<code>.less</code> çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<blockquote>
<p>åªèƒ½åˆ©ç”¨ Gulp æ¥<strong>æ›²çº¿æ•‘å›½</strong>äº†ã€‚</p>
<p>å¤§è‡´æ€è·¯ï¼Œåˆ©ç”¨ Gulp å°† WXSS æ–‡ä»¶ä¸´æ—¶è½¬ä¸º CSS æ‰©å±•åï¼Œä½¿ç”¨ CSScomb æ ¼å¼åŒ–ä¹‹åï¼Œå†å°†å…¶è½¬æ¢å› WXSS çš„æ‰©å±•åï¼Œä»¥è¾¾åˆ°æ›²çº¿æ•‘å›½çš„ç›®çš„ã€‚</p>
</blockquote>
<p>æ’äº†ä¸€ä¸‹ï¼Œæ°å·§æœ‰ä¸€æ¬¾ Gulp æ’ä»¶ <a href="https://github.com/koistya/gulp-csscomb">gulp-csscomb</a> å¯ç”¨ï¼Œè¯ä¸å¤šè¯´ã€‚</p>
<h5>1. å®‰è£…ç›¸å…³ä¾èµ–åŒ…</h5>
<pre><code class="language-shell">$ yarn add --dev gulp gulp-debug gulp-csscomb gulp-rename
</code></pre>
<h5>2. åˆ›å»º Gulp ä»»åŠ¡</h5>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>gulpfile.js</code> æ–‡ä»¶ã€‚è€Œ gulp-csscomb çš„<a href="https://github.com/koistya/gulp-csscomb#readme">ä½¿ç”¨æ–¹æ³•</a>å¾ˆç®€å•ï¼Œäºæ˜¯æˆ‘ä»¬å¾ˆå¿«å¯ä»¥å†™å‡ºï¼š</p>
<pre><code class="language-js">const { src, dest } = require('gulp')
const rename = require('gulp-rename')
const debug = require('gulp-debug')
const csscomb = require('gulp-csscomb')

const wxssTask = cb =&gt; {
  return src('app.wxss')
    .pipe(debug()) // æ‰“å°ä¸€äº›è°ƒè¯•ä¿¡æ¯
    .pipe(
      rename({
        extname: '.css'
      })
    )
    .pipe(csscomb()) // æ ¼å¼åŒ–æ“ä½œ
    .pipe(
      rename({
        extname: '.wxss'
      })
    )
    .pipe(dest(file =&gt; file.base))
}

module.exports = {
  wxssTask
}
</code></pre>
<p>ä¿®æ”¹ NPM è„šæœ¬ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;csscomb&quot;: &quot;gulp wxssTask&quot;
  }
}
</code></pre>
<p>æ‰§è¡Œè„šæœ¬ <code>yarn run csscomb</code> å¯ä»¥çœ‹åˆ°ï¼š</p>
<pre><code class="language-shell">$ yarn run csscomb

yarn run v1.22.4
$ gulp wxssformat
[15:34:11] Using gulpfile ~/Desktop/Web/MyGitHub/csscomb-mini/gulpfile.js
[15:34:11] Starting 'wxssformat'...
[15:34:11] gulp-debug: app.wxss

Failed to configure &quot;remove-empty-rulesets&quot; option:
 Value must be one of the following: true.

Failed to configure &quot;vendor-prefix-align&quot; option:
 Value must be one of the following: true.
[15:34:11] gulp-debug: 1 item
[15:34:11] Finished 'wxssformat' after 98 ms
âœ¨  Done in 1.05s.
</code></pre>
<p>æ­¤æ—¶ <code>app.wxss</code> æ–‡ä»¶å·²ç»è¢«æ ¼å¼åŒ–äº†ï¼Œä½†å¾ˆé—æ†¾æˆ‘ä»¬çœ‹åˆ°ä¸¤è¡Œ Failed ä¿¡æ¯ï¼š</p>
<pre><code class="language-sehll">Failed to configure &quot;remove-empty-rulesets&quot; option:
 Value must be one of the following: true.

Failed to configure &quot;vendor-prefix-align&quot; option:
 Value must be one of the following: true.
</code></pre>
<p>å®ƒä¸æ”¯æŒ <code>remove-empty-rulesets</code> å’Œ <code>vendor-prefix-align</code> é…ç½®é€‰é¡¹ï¼Œä¼°è®¡æ˜¯ gulp-csscomb â€œå¹´ä¹…å¤±ä¿®â€äº†ã€‚å½“å‰å®‰è£… csscomb æ˜¯æœ€æ–°ç‰ˆæœ¬ <code>4.3.0</code>ï¼ˆæœ¬æ–‡ç¼–å†™æ—¶ï¼‰ï¼Œè€Œ gulp-csscomb é‡Œé¢å¼•ç”¨çš„ <a href="https://github.com/koistya/gulp-csscomb/blob/master/package.json">csscomb ç‰ˆæœ¬</a>è¿˜æ˜¯ <code>3.1.7</code>ï¼ŒçŒœæµ‹æ˜¯æ—§ç‰ˆæœ¬ä¸æ”¯æŒè¯¥é€‰é¡¹ã€‚</p>
<pre><code class="language-shell"># æŸ¥çœ‹ä¾èµ–åŒ…ç‰ˆæœ¬
$ npm view &lt;package&gt; versions
</code></pre>
<blockquote>
<p>å†æ¬¡<strong>æ›²çº¿æ•‘å›½</strong>ä¸€ä¸‹ï¼Œå¹²è„†è‡ªå·±å®ç°ä¸€ä¸ª csscomb-gulp æ’ä»¶çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<h3>ä¸‰ã€ç¼–å†™ Gulp æ’ä»¶</h3>
<p>é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹ï¼Œå¦‚ä½•å†™ä¸€ä¸ª Gulp æ’ä»¶å“¦ã€‚</p>
<blockquote>
<p>ç¬¬ä¸€æ¬¡å†™çš„åŒå­¦ï¼Œå¯ç®€å•çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/chyingp/p/writting-gulp-plugin.html">Gulp æ’ä»¶ç¼–å†™å…¥é—¨</a>ã€‚</p>
</blockquote>
<p>æˆ‘çœ‹äº† <a href="https://github.com/koistya/gulp-csscomb/blob/master/index.js">gulp-csscomb</a> å’Œ <a href="https://github.com/csscomb/core">CSScomb Core</a> çš„æºç ï¼Œå‘ç°è‡ªå·±å®ç°ä¸€ä¸ªæ’ä»¶ä¸éš¾ï¼ŒåŒæ—¶è¿˜å‘ç°å¯ä»¥å°‘ä¸€æ­¥ <code>wxss</code> å’Œ <code>css</code> æ¥å›åˆ‡æ¢çš„è½¬æ¢è¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆæ˜¯ gulp-csscomb çš„æºç ï¼ˆ<a href="https://github.com/koistya/gulp-csscomb/blob/master/index.js">gulp-csscomb</a>ï¼‰ï¼Œæˆªå–äº†ä¸€éƒ¨åˆ†ä¸‹æ¥ï¼š</p>
<pre><code class="language-js">// éƒ¨åˆ†æºç 
var comb = new Comb(config || 'csscomb'); // æ ¹æ®é…ç½®å®ä¾‹åŒ–å¯¹è±¡
var syntax = options.syntax || file.path.split('.').pop(); // è·å– syntaxï¼Œä»å‚æ•°æˆ–è€…æ‰©å±•åè·å–ï¼Œå³ cssã€lessã€sassã€scss

try {
  var output = comb.processString( // å…³é”®å°±æ˜¯è¿™æ­¥ï¼Œå¯¹æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–
    file.contents.toString('utf8'), {
      syntax: syntax,
      filename: file.path
    });
  file.contents = new Buffer(output); // å°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²æ›¿æ¢å›æ–‡ä»¶ä¸­
} catch (err) {
  this.emit('error', new PluginError(PLUGIN_NAME, file.path + '\n' + err));
}
</code></pre>
<p>ä»ä»¥ä¸Šæºç å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®åœ¨äº <code>comb.processString()</code> æ–¹æ³•ã€‚äºæ˜¯æ‰¾åˆ° CSScomb çš„æ ¸å¿ƒæºç ï¼ˆ<a href="https://github.com/csscomb/core">CSScomb Core</a>ï¼‰ï¼Œè¯¥æ–¹æ³•çš„æè¿°å¦‚ä¸‹ï¼š</p>
<pre><code>comb.processString(string, options)

Params:
  {String} Code to process
  {{context: String, filename: String, syntax: String}} Options (optional) where context is Gonzales PE rule, filename is a file's name that is used to display errors and syntax is syntax name with css being a default value.

Return: {Promise} Resolves with processed string.
</code></pre>
<blockquote>
<p>syntax is syntax name with <code>css</code> being a default value.</p>
</blockquote>
<p>æ‰€ä»¥åªè¦åœ¨è°ƒç”¨ <code>comb.processString()</code> æ–¹æ³•æ—¶ï¼Œå¯¹å¾®ä¿¡å°ç¨‹åºçš„æ ·å¼æ–‡ä»¶ï¼Œä¼ å€¼ä¸º <code>{syntax: 'css'}</code> å³å¯ã€‚</p>
<p>ä¸Šä»£ç ï¼Œæ¡†æ¶å¤§è‡´æ˜¯è¿™æ ·ï¼š</p>
<p>å…ˆå®‰è£…å¿…è¦ä¾èµ–</p>
<pre><code class="language-shell">$ yarn add --dev gulp-csscomb through2
</code></pre>
<pre><code class="language-js">// gulpfile.js
const { src, dest } = require('gulp')
const rename = require('gulp-rename')
const debug = require('gulp-debug')
const csscomb = require('gulp-csscomb')
const through = require('through2')

// csscomb æ’ä»¶
const csscombPlugin = () =&gt; {
  return through.obj(function (file, enc, cb) {
    // æš‚æ—¶ä»€ä¹ˆéƒ½æ²¡åš...
    return cb()
  })
}

// Gulp ä»»åŠ¡
const csscombTask = cb =&gt; {
  try {
    return src('app.wxss')
      .pipe(debug())
      .pipe(csscombPlugin())
      .pipe(dest(file =&gt; file.base))
  } catch (e) {
    console.warn(e)
  }
}

module.exports = {
  csscombTask
}
</code></pre>
<p>åˆ›å»ºæ–°è„šæœ¬ï¼Œå¹¶è¿è¡Œ <code>yarn run csscomb:mini</code>ã€‚</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;csscomb:mini&quot;: &quot;gulp csscombTask&quot;
  }
}
</code></pre>
<p>çœ‹æ ·å­æ˜¯å¯ä»¥æ­£å¸¸è·‘èµ·æ¥çš„ï¼Œæ¥ä¸‹æ¥å°±å®ç° csscomb è½¬åŒ–è¿‡ç¨‹ã€‚</p>
<pre><code class="language-shell">$ yarn run csscomb:mini

yarn run v1.22.10
$ gulp csscombTask
[20:29:25] Using gulpfile ~/Desktop/Web/Git/csscomb-mini/gulpfile.js
[20:29:25] Starting 'csscombTask'...
[20:29:25] gulp-debug: app.wxss
[20:29:25] gulp-debug: 1 item
[20:29:25] Finished 'csscombTask' after 14 ms
âœ¨  Done in 0.51s.
</code></pre>
<blockquote>
<p>å¦‚å¯¹ <a href="https://www.gulpjs.com.cn/">Gulp</a> å’Œ <a href="https://github.com/rvagg/through2">through2</a> ä¸äº†è§£ï¼Œå¯å»å®˜ç½‘äº†è§£ä¸€ä¸‹ã€‚through2 æ˜¯å¿«é€Ÿåˆ›å»ºä¸€ä¸ª transform stream çš„å·¥å…·å‡½æ•°ã€‚</p>
</blockquote>
<h5>ç¼–å†™ csscombPlugin å®ç°</h5>
<p>å®‰è£…å¿…è¦ä¾èµ–</p>
<pre><code class="language-shell">$ yarn add --dev plugin-error
</code></pre>
<pre><code class="language-js">const fs = require('fs')
const path = require('path')
const { src, dest } = require('gulp')
const rename = require('gulp-rename')
const debug = require('gulp-debug')
const Comb = require('csscomb')
const csscomb = require('gulp-csscomb')
const through = require('through2')
const PluginError = require('plugin-error') // ç”¨äºå¤„ç†å¼‚å¸¸


// csscomb æ’ä»¶
const csscombPlugin = () =&gt; {
  // é»˜è®¤æ”¯æŒæ‰©ç±»å‹
  const defaultExts = ['.css', '.sass', '.scss', '.less']
  // æ‰©å±•ç±»å‹ï¼Œå‡è®¾ä»¥åå…¼å®¹å­—èŠ‚è·³åŠ¨å°ç¨‹åºï¼Œå¯åŠ ä¸Š .ttss
  const expandExts = ['.wxss', '.acss']
  const supportExts = defaultExts.concat(expandExts)

  return through.obj(async function (file, enc, cb) {
    let syntax = 'css'
    const filePath = file.path
    const extname = path.extname(filePath)
    // è·å– csscomb é…ç½®
    const combConfigPath = Comb.getCustomConfigPath(path.resolve(__dirname, '.csscomb.json'))
    const combConfig = Comb.getCustomConfig(combConfigPath)

    if (file.isNull()) {
      // æ–‡ä»¶ä¸ºç©ºä¸åšå¤„ç†ï¼Œç›´æ¥è¿”å›è¿›å…¥ä¸‹ä¸€ä¸ª pipe()
      return cb()
    } else if (file.isStream()) {
      // ä¸æ”¯æŒå¯¹æµï¼ˆStreamï¼‰è¿›è¡Œæ“ä½œï¼ŒæŠ›å‡ºå¼‚å¸¸
      this.emit('error', new PluginError('csscombPlugin', 'Streams are not supported!'))
      return cb()
    } else if (file.isBuffer() &amp;&amp; supportExts.includes(extname)) {
      // é»˜è®¤æ”¯æŒç±»å‹ï¼Œé€šè¿‡æ‰©å±•åè·å–ã€‚å…¶ä½™å½“åš css
      if (defaultExts.includes(extname)) {
        syntax = extname.split('.').pop()
      }

      // æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶
      if (combConfigPath &amp;&amp; !fs.existsSync(combConfigPath)) {
        this.emit('error', new PluginError('csscombPlugin', 'Configuration file not found: ' + configPath))
        return cb()
      }

      try {
        // å®ä¾‹åŒ–
        const comb = new Comb(combConfig)
        // å¯¹æ‰€è¦è½¬æ¢çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–
        const output = await comb.processString(
          file.contents.toString('utf8'),
          {
            syntax,
            filename: filePath
          }
        )
        // åˆ›å»º Bufferï¼Œå¹¶å°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²æ›¿æ¢åŸæœ¬çš„ contents
        file.contents = Buffer.from(output, 'utf-8')
        this.push(file)
        return cb()
      } catch (e) {
        this.emit('error', new PluginError('csscombPlugin', filePath + '\n' + e))
      }

    } else {
      // å…¶ä½™æƒ…å†µï¼Œç›´æ¥è¿”å›ã€‚ä¾‹å¦‚ file ä¸º JS æ–‡ä»¶ç­‰
      return cb()
    }
  })
}


// Gulp ä»»åŠ¡
const csscombTask = cb =&gt; {
  try {
    return src('app.wxss')
      .pipe(debug())
      .pipe(csscombPlugin())
      .pipe(dest(file =&gt; file.base))
  } catch (e) {
    console.warn(e)
  }
}


module.exports = {
  csscombTask
}
</code></pre>
<p>æˆ‘ä»¬å†æ¬¡è¿è¡Œè„šæœ¬ <code>yarn run csscomb:mini</code>ï¼Œå¯ä»¥çœ‹åˆ° <code>app.wxss</code> æ–‡ä»¶çš„å˜åŒ–ï¼š</p>
<pre><code class="language-css">/* before */
.container {
  height: 100%;
  padding: 200rpx 0;
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: space-between;
  box-sizing: border-box;
}

/* after */
.container {
  display: flex;

  box-sizing: border-box;
  padding: 200rpx 0;
  height: 100%;

  align-items: center;
  flex-direction: column;
  justify-content: space-between;
}
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„å·¥ä½œå®Œæˆäº† 90%... è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ã€‚</p>
<blockquote>
<p>ä½ æ³¨æ„åˆ°æˆ‘ä»¬ <code>csscombTask</code> æ–¹æ³•é‡Œé¢æ˜¯é’ˆå¯¹ä¸€ä¸ªç›¸å¯¹å›ºå®šçš„è·¯å¾„æˆ–è€…æ–‡ä»¶äº†å—ï¼Ÿå‡è®¾æˆ‘æ¯æ¬¡æ ¼å¼åŒ–å…¶ä»–ç›®å½•çš„æ–‡ä»¶ï¼Œéƒ½éœ€è¦ä¿®æ”¹æ­¤æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¯åœ¨ NPM è„šæœ¬è¿›è¡Œä¼ å‚ï¼Œç„¶åé€šè¿‡ <code>process.argv</code> æ¥è·å–ï¼Œæˆ‘ä»¬å¤„ç†ä¸‹å†ä¼ å…¥ <code>gulp.src()</code> æ–¹æ³•å³å¯ã€‚</p>
<h3>å››ã€ä¼˜åŒ–</h3>
<p>å…ˆçº¦å®šå¥½ä¼ å‚è§„åˆ™ï¼š</p>
<ul>
<li><code>--path</code> è¡¨ç¤ºç¬¦åˆ glob æ–‡ä»¶åŒ¹é…æ¨¡å¼çš„è·¯å¾„ï¼Œå¤šä¸ªè·¯å¾„æ˜¯ç”¨ <code>,</code> éš”å¼€ï¼Œå¹¶ç”¨å•å¼•å· <code>'</code> æ‹¬èµ·æ¥ï¼Œè¿˜æœ‰æˆ‘é™åˆ¶äº†ä»…æ”¯æŒé¡¹ç›®ä¸‹çš„æ–‡ä»¶ã€‚</li>
<li><code>--ext</code> è¡¨ç¤ºæ‰©å±•åï¼Œå¦‚ <code>.css</code>ã€<code>.wxss</code> ç­‰ã€‚ï¼ˆæ­¤é€‰é¡¹ç›®å‰æ²¡ä»€ä¹ˆç”¨ï¼Œä¿ç•™ä¸‹æ¥åç»­ä¼˜åŒ–ç”¨ï¼‰</li>
</ul>
<blockquote>
<p>è‹¥å¯¹ Glob æ¨¡å¼ä¸äº†è§£ï¼Œå¯çœ‹ <a href="https://www.gulpjs.com.cn/docs/getting-started/explaining-globs/#glob-%E8%AF%A6%E8%A7%A3">Glob è¯¦è§£</a>ã€‚å…¶ä¸­ <code>gulp.src(globs[, options])</code> ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¿™ç§æ¨¡å¼çš„ã€‚</p>
</blockquote>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;csscomb:mini&quot;: &quot;gulp csscombTask --path '&lt;filepath&gt;' --ext &lt;extension&gt;&quot;
  }
}
</code></pre>
<p>æˆ‘ä»¬å€ŸåŠ© <a href="https://github.com/substack/minimist">minimist</a> æ¥è·å– NPM å‚æ•°ï¼Œé€šè¿‡</p>
<p>å®‰è£…å¿…è¦ä¾èµ–ï¼Œ</p>
<pre><code class="language-shell">$ yarn add --dev minimist
</code></pre>
<pre><code class="language-js">// gulp.js
// è¿™é‡Œçœç•¥å…¶ä»–éƒ¨åˆ†ï¼Œä»…ä¿®æ”¹äº† csscombTask æ–¹æ³•
const minimist = require('minimist')

// Gulp ä»»åŠ¡
const csscombTask = cb =&gt; {
  try {
    // è·å–å‚æ•°ï¼Œå¦‚ { _: [ 'csscomb:mini' ], path: 'xxx', ext: 'xxx' }
    const options = minimist(process.argv.slice(2))

    // è¿‡æ»¤æ‰éé¡¹ç›®ä¸‹çš„è·¯å¾„
    const paths = options.path.split(',').filter(item =&gt; {
      const re1 = /^\//
      const re2 = /^\.\.\//
      return item &amp;&amp; !re2.test(item) &amp;&amp; (!re1.test(item) || (re1.test(item) &amp;&amp; item.includes(__dirname)))
    })

    // å»é‡
    const newPaths = Array.from(new Set(paths))

    if (!newPaths.length) {
      return cb()
    }

    // allowEmpty é€‰é¡¹æ˜¯ä¸ºäº†é¿å…åœ¨æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶æ—¶æŠ›å‡ºé”™è¯¯
    // Error: File not found with singular glob: xxx (if this was purposeful, use `allowEmpty` option)
    return src(newPaths, { allowEmpty: true })
      .pipe(debug())
      .pipe(csscombPlugin())
      .pipe(dest(file =&gt; file.base))
  } catch (e) {
    console.warn(e)
  }
}
</code></pre>
<p>ä¿®æ”¹ NPM è„šæœ¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ”¯ä»˜å®å°ç¨‹åºçš„æ ·å¼æ–‡ä»¶ <code>app.acss</code> æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;csscomb:mini&quot;: &quot;gulp csscombTask --path './**/*.wxss,app.acss'&quot;
  }
}
</code></pre>
<p>è¿è¡Œè„šæœ¬ï¼Œå‘ç°å¯ä»¥ä¸€é”®æ ¼å¼åŒ–äº†ï¼Œè‡³æ­¤åŸºæœ¬å®Œæˆäº†ã€‚</p>
<h3>äº”ã€GitHub</h3>
<p>é¡¹ç›®æ”¾åœ¨ GitHub ä¸Š ğŸ‘‰ <a href="https://github.com/toFrankie/csscomb-mini">csscomb-mini</a> æ¬¢è¿ Star ğŸ‘‹ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ä»‹ç»ï¼š<a href="https://github.com/toFrankie/blog/issues/129">å°† CSScomb é›†æˆåˆ° Git Hook ä¸­</a>ã€‚</p>
<h3>å…­ã€å‚è€ƒ</h3>
<ul>
<li><a href="http://alloyteam.github.io/CodeGuide/">Code Guide by @AlloyTeam</a></li>
<li><a href="https://github.com/csscomb/core">CSScomb Core</a></li>
<li><a href="https://github.com/csscomb/csscomb.js">CSScomb</a></li>
<li><a href="https://github.com/koistya/gulp-csscomb/blob/master/index.js">gulp-csscomb</a></li>
<li><a href="https://github.com/ahmadnassri/node-glob-promise">glob-promise</a></li>
<li><a href="https://www.gulpjs.com.cn/">Gulp.js</a></li>
<li><a href="https://www.cnblogs.com/chyingp/p/writting-gulp-plugin.html">Gulpï¼šæ’ä»¶ç¼–å†™å…¥é—¨</a></li>
<li><a href="https://v3.gulpjs.com.cn/docs/recipes/pass-arguments-from-cli/">Gulp ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°</a></li>
<li><a href="https://www.dazhuanlan.com/2020/03/13/5e6a9510f0cbc/">Gulp ç³»åˆ—ä¹‹ through2 æºç ç¬”è®°</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[no-plusplus]]></title>
            <link>https://github.com/toFrankie/blog/issues/127</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/127</guid>
            <pubDate>Sat, 25 Feb 2023 13:28:36 GMT</pubDate>
            <description><![CDATA[<p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ ESLint æ¥æ£€æŸ¥ä»£ç è´¨é‡ï¼Œä¸”å¯ç”¨äº†å…¶ä¸­ä¸€æ¡è§„åˆ™ <code>no-plusplus</code>ï¼ˆç¦æ­¢ä½¿ç”¨ä¸€å…ƒæ“ä½œç¬¦ <code>++</code> å’Œ <code>--</code>ï¼‰ï¼Œä¸‹é¢ä»£ç å°±ä¼šæç¤ºé”™è¯¯ã€‚</p>
<pre><code class="language-js">// Unar]]></description>
            <content:encoded><![CDATA[<p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ ESLint æ¥æ£€æŸ¥ä»£ç è´¨é‡ï¼Œä¸”å¯ç”¨äº†å…¶ä¸­ä¸€æ¡è§„åˆ™ <code>no-plusplus</code>ï¼ˆç¦æ­¢ä½¿ç”¨ä¸€å…ƒæ“ä½œç¬¦ <code>++</code> å’Œ <code>--</code>ï¼‰ï¼Œä¸‹é¢ä»£ç å°±ä¼šæç¤ºé”™è¯¯ã€‚</p>
<pre><code class="language-js">// Unary operator '++' used. eslint (no-plusplus)
for (let i = 0; i &lt; 10; i++) {
  // ...
}
</code></pre>
<p>ç”±äºä¸€å…ƒ <code>++</code> å’Œ <code>--</code> è¿ç®—ç¬¦éƒ½å—<a href="https://www.jianshu.com/p/05cd9981dc56">è‡ªåŠ¨æ’å…¥åˆ†å·æœºåˆ¶</a>ï¼ˆAutomatic Semicolon Insertionï¼Œç®€ç§° ASIï¼‰çš„å½±å“ï¼Œå› æ­¤ç©ºæ ¼çš„å·®å¼‚å¯èƒ½ä¼šæ”¹å˜æºä»£ç çš„è¯­ä¹‰ã€‚</p>
<pre><code class="language-js">var i = 10;
var j = 20;

i ++
j
// i = 11, j = 20
</code></pre>
<pre><code class="language-js">var i = 10;
var j = 20;

i
++
j
// i = 10, j = 21
</code></pre>
<p>æ­¤è§„åˆ™çš„<strong>é”™è¯¯</strong>ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">/*eslint no-plusplus: &quot;error&quot;*/

var foo = 0;
foo++;

var bar = 42;
bar--;

for (i = 0; i &lt; l; i++) {
    return;
}
</code></pre>
<p>æ­¤è§„åˆ™çš„<strong>æ­£ç¡®</strong>ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">/*eslint no-plusplus: &quot;error&quot;*/

var foo = 0;
foo += 1;

var bar = 42;
bar -= 1;

for (i = 0; i &lt; l; i += 1) {
    return;
}
</code></pre>
<h3>é€‰é¡¹</h3>
<p>è¯¥è§„åˆ™è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹ <code>{ &quot;allowForLoopAfterthoughts&quot;: true }</code>ï¼Œå®ƒå…è®¸åœ¨ <code>for</code> å¾ªç¯ä¸­ä½¿ç”¨ä¸€å…ƒè¿ç®—ç¬¦ <code>++</code> å’Œ <code>--</code>ã€‚</p>
<p>æ­¤è§„åˆ™çš„<strong>æ­£ç¡®</strong>ä»£ç ç¤ºä¾‹åŒ…å«ä»¥ä¸‹ <code>{ &quot;allowForLoopAfterthoughts&quot;: true }</code> é€‰é¡¹ï¼š</p>
<pre><code class="language-js">/*eslint no-plusplus: [&quot;error&quot;, { &quot;allowForLoopAfterthoughts&quot;: true }]*/

for (let i = 0; i &lt; 10; i++) {
  // ...
}

for (let i = 10; i &gt; 0; i--) {
  // ...
}
</code></pre>
<p>æ­¤è§„åˆ™çš„<strong>é”™è¯¯</strong>ä»£ç ç¤ºä¾‹åŒ…å«ä»¥ä¸‹ <code>{ &quot;allowForLoopAfterthoughts&quot;: true }</code> é€‰é¡¹ï¼š</p>
<pre><code class="language-js">/*eslint no-plusplus: [&quot;error&quot;, { &quot;allowForLoopAfterthoughts&quot;: true }]*/
let i, j, l;

for (i = 0, j = l; i &lt; l; i++, j--) {
  // ...
}

for (let i = 0; i &lt; 10; j = i++) {
  // ...
}

for (i = l; i--;) {
  // ...
}

for (i = 0; i &lt; l;) i++;
</code></pre>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://cloud.tencent.com/developer/section/1135736">no-plusplus</a></li>
<li><a href="https://github.com/eslint/eslint/blob/master/docs/rules/no-plusplus.md">no-plusplus æ–‡æ¡£æ¥æº</a></li>
<li><a href="https://github.com/eslint/eslint/blob/master/lib/rules/no-plusplus.js">no-plusplus è§„åˆ™æ¥æº</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ESLint åœ¨ä»£ç æºæ–‡ä»¶æ·»åŠ é…ç½®çš„æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/126</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/126</guid>
            <pubDate>Sat, 25 Feb 2023 13:28:02 GMT</pubDate>
            <description><![CDATA[<p>é™¤äº†é€šè¿‡æ·»åŠ é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œæ¥æŒ‡å®š ESLint ç›¸å…³è§„åˆ™ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­ä½¿ç”¨ JavaScript æ³¨é‡Šæ¥æŒ‡å®šã€‚</p>
<h5>1. æŒ‡å®šç¯å¢ƒ</h5>
<pre><code class="language-js">/* eslint-env node, browser */

// ç›¸å½“äº
{
  &]]></description>
            <content:encoded><![CDATA[<p>é™¤äº†é€šè¿‡æ·»åŠ é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œæ¥æŒ‡å®š ESLint ç›¸å…³è§„åˆ™ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­ä½¿ç”¨ JavaScript æ³¨é‡Šæ¥æŒ‡å®šã€‚</p>
<h5>1. æŒ‡å®šç¯å¢ƒ</h5>
<pre><code class="language-js">/* eslint-env node, browser */

// ç›¸å½“äº
{
  &quot;env&quot;: {
    &quot;browser&quot;: true,
    &quot;node&quot;: true
  }
}
</code></pre>
<h5>2. æŒ‡å®šå…¨å±€å˜é‡</h5>
<pre><code class="language-js">/* global var1, var2 */

// é€‰æ‹©æ€§åœ°æŒ‡å®šè¿™äº›å…¨å±€å˜é‡å¯ä»¥è¢«å†™å…¥(è€Œä¸æ˜¯åªè¢«è¯»å–)
/* global var1:writable, var2:readonly */

// ç”±äºå†å²åŸå› ï¼Œ
// å¸ƒå°”å€¼ false å’Œå­—ç¬¦ä¸²å€¼ &quot;readable&quot; ç­‰ä»·äº &quot;readonly&quot;ã€‚
// å¸ƒå°”å€¼ true å’Œå­—ç¬¦ä¸²å€¼ &quot;writeable&quot; ç­‰ä»·äº &quot;writable&quot;ã€‚ä½†æ˜¯ï¼Œä¸å»ºè®®ä½¿ç”¨æ—§å€¼ã€‚
// ä½¿ç”¨å­—ç¬¦ä¸² &quot;off&quot; ç¦ç”¨å…¨å±€å˜é‡ã€‚å‡å¦‚å½“å‰ç¯å¢ƒä¸æ”¯æŒä½¿ç”¨ Promise å¯ä»¥é€šè¿‡ &quot;Promise&quot;: &quot;off&quot; å…¨å±€ç¦ç”¨ã€‚
{
  &quot;globals&quot;: {
    &quot;var1&quot;: &quot;writable&quot;,
    &quot;var2&quot;: &quot;readonly&quot;
  }
}
</code></pre>
<h5>3. æŒ‡å®šç¦ç”¨æˆ–è€…å¯ç”¨è§„åˆ™</h5>
<pre><code class="language-js">/* eslint eqeqeq: &quot;off&quot;, curly: &quot;error&quot; */
/* eslint eqeqeq: 0, curly: 2 */

// å¦‚æœä¸€ä¸ªè§„åˆ™æœ‰é¢å¤–çš„é€‰é¡¹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ•°ç»„å­—é¢é‡æŒ‡å®šå®ƒä»¬ï¼Œæ¯”å¦‚ï¼š
/* eslint quotes: [&quot;error&quot;, &quot;double&quot;], curly: 2 */

// è§„åˆ™ plugin1/rule1 è¡¨ç¤ºæ¥è‡ªæ’ä»¶ plugin1 çš„ rule1 è§„åˆ™ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ ¼å¼çš„æ³¨é‡Šé…ç½®ï¼Œæ¯”å¦‚ï¼š
/* eslint &quot;plugin1/rule1&quot;: &quot;error&quot; */

// ç›¸å½“äº
{
  &quot;rules&quot;: {
    &quot;eqeqeq&quot;: &quot;off&quot;,
    &quot;curly&quot;: &quot;error&quot;,
    &quot;quotes&quot;: [&quot;error&quot;, &quot;double&quot;],
    &quot;plugin1/rule1&quot;: &quot;error&quot;
  }
}
</code></pre>
<h5>4. ä¸´æ—¶ç¦æ­¢è§„åˆ™å‡ºç°è­¦å‘Š</h5>
<pre><code class="language-js">/* eslint-disable */
alert('foo');
/* eslint-enable */
</code></pre>
<blockquote>
<p>å…³äºä¸´æ—¶ç¦æ­¢å‡ºç°è­¦å‘Šï¼Œå¦ä¸€ç¯‡æ–‡ç« å·²è¯¦å†™ ğŸ‘‰  <a href="https://github.com/toFrankie/blog/issues/122">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆç»“å±€ç¯‡ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/125</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/125</guid>
            <pubDate>Sat, 25 Feb 2023 13:15:55 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="https://prettier.io/">Prettier</a> çš„ä»£ç æ£€æŸ¥æˆ–è€…æ ¼å¼çº¦æŸç­‰å·¥å…·ã€‚</p>
<p>ç›®å‰éƒ¨é—¨ä»…å‰©æˆ‘ä¸€äººç»´æŠ¤è¿™åå‡ ä¸ªå°ç¨‹åºã€H5 å‰ç«¯é¡¹ç›®ã€‚ç°åœ¨åªè¦æ¥è§¦ä»¥å‰æ²¡æœ‰ç»æ‰‹çš„é¡¹ç›®ï¼Œå°±å¤´ç–¼ä¸æƒ³æ”¹ï¼Œå¾ˆæ— å¥ˆï¼Œè°è®©æˆ‘æ˜¯ä¸€ä¸ªæ‰“å·¥äººå‘¢ï¼</p>
<p>æœ¬æ–‡å°†ä¼šç»“åˆ ESLintã€Prettierã€huskyã€lint-stage å±•å¼€ä»‹ç»ï¼Œæ—¨åœ¨åœ¨ä»£ç æ ¼å¼åŒ–ã€ä»£ç æ£€æŸ¥ä¸Šå‡å°‘æ—¶é—´æµªè´¹ã€‚</p>
<p>å®Œæ•´ç¤ºä¾‹ï¼š<a href="https://github.com/toFrankie/wechat_applet_demo.git">wechat_applet_demo</a></p>
<p>å…±ä¸‰ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/123">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/124">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸‹é›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/125">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆç»“å±€ç¯‡ï¼‰</a></li>
</ul>
<p>æ‰©å±•ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/101">Git Commit è§„èŒƒ</a></li>
</ul>
<p>å‰é¢ç»ˆç©¶è¿˜æ˜¯ç•™ä¸‹äº†ä¸€äº›ä¸å¤ªå®Œç¾çš„åœ°æ–¹ã€‚åŠ ä¹‹ï¼Œä»Šå¤©çœ‹åˆ°äº† <a href="https://prettier.io/docs/en/configuration.html">Prettier Configuration Overrides</a> ã€<a href="https://prettier.io/docs/en/options.html#parser">Setting theÂ parserÂ option</a> é…ç½®é¡¹ã€‚</p>
<p>äºæ˜¯æˆ‘å‘ç°ï¼š</p>
<blockquote>
<ol>
<li>ä½¿ç”¨ Gulp.js å¤„ç† <code>wxss</code> æ–‡ä»¶åè€Œæ˜¯å¤šæ­¤ä¸€ä¸¾äº†ï¼›</li>
<li>åŒæ—¶å¾ˆå¥½åœ°è§£å†³äº†<a href="https://github.com/toFrankie/blog/issues/124">ä¸‹é›†</a>å…³äºä½¿ç”¨ <code>lint-staged</code> ä»…å¤„ç†æš‚å­˜æ–‡ä»¶çš„é—®é¢˜ã€‚</li>
</ol>
</blockquote>
<p>å¥½å§ï¼Œä½¿ç”¨ Gulp æ¥å¤„ç†çš„æ–¹å¼å¹¶éå®Œå…¨ä¸å¯å–ï¼Œèµ·ç ç»™æˆ‘æä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œå¯ä¾›å‚è€ƒã€‚</p>
<h2>è°ƒæ•´</h2>
<p>é¦–å…ˆï¼ŒPrettier æ˜¯æ”¯æŒå¯¹æŸäº›æ–‡ä»¶æ‰©å±•åï¼Œæ–‡ä»¶å¤¹å’Œç‰¹å®šæ–‡ä»¶è¿›è¡Œä¸åŒçš„é…ç½®<a href="https://prettier.io/docs/en/configuration.html">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p>Overrides let you have different configuration for certain file extensions, folders and specific files.</p>
</blockquote>
<ol>
<li>å¯¹ Prettier é…ç½®åšè°ƒæ•´ï¼š</li>
</ol>
<pre><code class="language-js">{
  overrides: [
    {
      files: ['*.wxss', '*.acss'],
      options: {
        parser: 'css'
      }
    },
    {
      files: ['*.wxml', '*.axml'],
      options: {
        parser: 'html'
      }
    },
    {
      files: ['*.wxs', '*.sjs'],
      options: {
        parser: 'babel'
      }
    }
  ]
}
</code></pre>
<ol start="2">
<li>è°ƒæ•´ NPM è„šæœ¬å‘½ä»¤</li>
</ol>
<p>å› ä¸ºæ— éœ€ä½¿ç”¨ Gulp.js äº†ï¼Œç§»é™¤ <code>gulpfile.js</code> ä»¥åŠç›¸å…³ä¾èµ–åŒ…ï¼Œç„¶åå¯¹ npm scripts è°ƒæ•´ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;eslint&quot;: &quot;eslint . --ext .js,.wxs,.sjs&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix . --ext .js,.wxs,.sjs&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.{js,sjs,wxs,css,wxss,acss,wxml,axml,less,scss,json}'&quot;,
    &quot;format:all&quot;: &quot;npm-run-all -s prettier:fix eslint:fix&quot;
  },
}
</code></pre>
<ol start="3">
<li>è°ƒæ•´ husky åŠ lint-staged é…ç½®</li>
</ol>
<p>ç”±äºæ— éœ€å†ä½¿ç”¨åˆ°å‡½æ•°çš„å½¢å¼ï¼Œæˆ‘ä»¬å°†åŸå…ˆçš„ <code>.lint-stagedrc.js</code> é…ç½®æ–‡ä»¶ç§»é™¤ï¼Œç„¶åæ”¾åˆ° <code>package.json</code> ä¸­ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;husky&quot;: {
    &quot;hooks&quot;: {
      &quot;pre-commit&quot;: &quot;lint-staged&quot;
    }
  },
  &quot;lint-staged&quot;: {
    &quot;*.{js,wxs,sjs}&quot;: [
      &quot;prettier --config .prettierrc.js --write&quot;,
      &quot;eslint --fix --ext .js&quot;
    ],
    &quot;*.{json,wxml,axml,css,wxss,acss,wxml,axml,less,scss}&quot;: &quot;prettier --config .prettierrc.js --write&quot;
  }
}
</code></pre>
<h2>æœ€å</h2>
<p>å®Œæ•´ç¤ºä¾‹ï¼š<a href="https://github.com/toFrankie/wechat_applet_demo.git">wechat_applet_demo</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸‹é›†ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/124</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/124</guid>
            <pubDate>Sat, 25 Feb 2023 13:15:21 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="https://prettier.io/">Prettier</a> çš„ä»£ç æ£€æŸ¥æˆ–è€…æ ¼å¼çº¦æŸç­‰å·¥å…·ã€‚</p>
<p>ç›®å‰éƒ¨é—¨ä»…å‰©æˆ‘ä¸€äººç»´æŠ¤è¿™åå‡ ä¸ªå°ç¨‹åºã€H5 å‰ç«¯é¡¹ç›®ã€‚ç°åœ¨åªè¦æ¥è§¦ä»¥å‰æ²¡æœ‰ç»æ‰‹çš„é¡¹ç›®ï¼Œå°±å¤´ç–¼ä¸æƒ³æ”¹ï¼Œå¾ˆæ— å¥ˆï¼Œè°è®©æˆ‘æ˜¯ä¸€ä¸ªæ‰“å·¥äººå‘¢ï¼</p>
<p>æœ¬æ–‡å°†ä¼šç»“åˆ ESLintã€Prettierã€huskyã€lint-stage å±•å¼€ä»‹ç»ï¼Œæ—¨åœ¨åœ¨ä»£ç æ ¼å¼åŒ–ã€ä»£ç æ£€æŸ¥ä¸Šå‡å°‘æ—¶é—´æµªè´¹ã€‚</p>
<p>å®Œæ•´ç¤ºä¾‹ï¼š<a href="https://github.com/toFrankie/wechat_applet_demo.git">wechat_applet_demo</a></p>
<p>å…±ä¸‰ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/123">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/124">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸‹é›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/125">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆç»“å±€ç¯‡ï¼‰</a></li>
</ul>
<p>æ‰©å±•ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/101">Git Commit è§„èŒƒ</a></li>
</ul>
<p><a href="https://github.com/toFrankie/blog/issues/123">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº†å¦‚ä½•ä¸€é”®æ ¼å¼åŒ– <code>wxss</code> æ–‡ä»¶ã€‚ä»Šå¤©ä»‹ç»åˆ©ç”¨ Git Hooks é’©å­å®ç°æäº¤ä»£ç è‡ªåŠ¨æ‰§è¡Œæ­¤å‰çš„ ESLintã€Prettier å‘½ä»¤ï¼Œä»¥ä¿è¯æˆ‘ä»¬æäº¤çš„ä»£ç æ˜¯ä¸ä¸‘çš„ã€‚</p>
<h2>Git é’©å­</h2>
<p>Git æä¾›äº†ä¸€äº›é’©å­ï¼Œèƒ½åœ¨ç‰¹å®šçš„é‡è¦æ“ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬ã€‚</p>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>git init</code> åˆå§‹åŒ–ä¸€ä¸ª Git ç‰ˆæœ¬åº“æ—¶ï¼ŒGit ä¼šé»˜è®¤åœ¨ <code>.git/hooks</code> ç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ï¼ˆShell è„šæœ¬ï¼‰ã€‚è¿™äº›ç¤ºä¾‹è„šæœ¬éƒ½æ˜¯ä»¥ <code>.sample</code> ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚</p>
<p>æŠŠä¸€ä¸ªæ­£ç¡®å‘½åï¼ˆä¸å¸¦æ‰©å±•åï¼‰ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ <code>.git/hooks</code> ç›®å½•ä¸‹ï¼Œå³å¯æ¿€æ´»è¯¥é’©å­è„šæœ¬ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå®ƒå°±èƒ½è¢« Git è°ƒç”¨ã€‚</p>
<h2>å¸¸ç”¨é’©å­</h2>
<ul>
<li><strong>pre-commit</strong>
è¯¥é’©å­åœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚ å®ƒç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ï¼Œä¸è¿‡ä½ å¯ä»¥ç”¨ <code>git commit --no-verify</code> æ¥ç»•è¿‡è¿™ä¸ªç¯èŠ‚ã€‚ ä½ å¯ä»¥åˆ©ç”¨è¯¥é’©å­ï¼Œæ¥æ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ä¸€è‡´ã€å°¾éšç©ºç™½å­—ç¬¦æ˜¯å¦å­˜åœ¨ï¼Œæˆ–æ–°æ–¹æ³•çš„æ–‡æ¡£æ˜¯å¦é€‚å½“ç­‰ç­‰ã€‚</li>
</ul>
<h2>husky</h2>
<p><a href="https://github.com/typicode/husky#readme">husky</a> æ˜¯ä¸€ä¸ªä¸º Git å®¢æˆ·ç«¯å¢åŠ  <code>hook</code> çš„å·¥å…·ã€‚å½“å…¶å®‰è£…åˆ°æ‰€åœ¨ä»“åº“æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨ <code>.git/hooks</code> å¢åŠ ç›¸åº”çš„é’©å­å®ç°åœ¨ <code>pre-commit</code> é˜¶æ®µå°±æ‰§è¡Œä¸€ç³»åˆ—ä¿è¯æ¯ä¸€ä¸ª <code>commit</code> çš„æ­£ç¡®æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œ<code>pre-commit</code> é˜¶æ®µæ‰§è¡Œçš„å‘½ä»¤ï¼Œå½“ç„¶è¦ä¿è¯å…¶é€Ÿåº¦ä¸è¦å¤ªæ…¢ï¼Œæ¯æ¬¡ <code>commit</code> éƒ½ç­‰å¾ˆä¹…ä¹Ÿä¸æ˜¯å¥½çš„ä½“éªŒã€‚</p>
<h3>å®‰è£… npm-run-all</h3>
<p>å®ƒç”¨äºåŒæ­¥æˆ–è€…å¹¶è¡Œæ‰§è¡Œ npm script è„šæœ¬ã€‚</p>
<pre><code class="language-shell">$ yarn add --dev npm-run-all@4.1.5
</code></pre>
<p>äºæ˜¯ä¹ï¼Œç»“åˆä¹‹å‰çš„ npm scriptï¼Œå†é€šè¿‡ <code>npm-run-all</code> æ¥æŠŠå‡ ä¸ªå‘½ä»¤ä¸²èµ·æ¥ã€‚</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;format:all&quot;: &quot;npm-run-all -p prettier:wxss:acss prettier:fix -s eslint:fix&quot;
  }
}
</code></pre>
<p>è¿™è¡Œå‘½ä»¤åšäº†ä»€ä¹ˆï¼šé¦–å…ˆå¹¶è¡Œæ‰§è¡Œ <code>prettier:wxss:acss</code> å’Œ <code>prettier:fix</code> ä¸¤ä¸ªå‘½ä»¤ï¼Œç­‰åˆ°æ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œ <code>eslint:fix</code> å‘½ä»¤ã€‚</p>
<ul>
<li><code>npm-run-all -p</code> è¡¨ç¤ºå¹¶è¡Œæ“ä½œã€‚</li>
<li><code>npm-run-all -s</code> è¡¨ç¤ºæŒ‰é¡ºåºæ“ä½œã€‚</li>
<li>å®ƒåŒæ—¶æä¾›äº†ä¸Šé¢ä¸¤æ¡å‘½ä»¤çš„ç®€å†™ç‰ˆ APIï¼Œåˆ†åˆ«å¯¹åº” <code>run-p</code>ã€<code>run-s</code>ã€‚</li>
</ul>
<p>å› ä¸º <code>prettier:wxss:acss</code> å’Œ <code>prettier:fix</code> åŒ¹é…çš„æ–‡ä»¶æ²¡æœ‰é‡åˆçš„ï¼Œæ‰€ä»¥å¯ä»¥å¹¶è¡Œæ“ä½œã€‚è‡³äºä¸ºä»€ä¹ˆå…ˆè¿›è¡Œ Prettier æ ¼å¼åŒ–ï¼Œå†è¿›è¡Œ ESLint æ£€æŸ¥ï¼Œå› ä¸ºå®ƒä»¬ä¸¤ä¸ªæ˜¯å­˜åœ¨å†²çªçš„ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ <code>.eslintrc.js</code> å¼•å…¥ç›¸å…³æ’ä»¶è¿›è¡Œé…ç½®ï¼Œä½¿å…¶å½“ Prettier è§„åˆ™ä¸ç¬¦åˆ ESLint è§„åˆ™æ—¶è¿›è¡ŒæŠ¥é”™æé†’ï¼Œä½†æ²¡æœ‰è§£å†³æˆ‘ä»¬çš„ç—›ç‚¹ï¼Œå®ƒéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»ä¿®å¤ã€‚</p>
<p>è¿˜æœ‰ï¼Œæ€»æ˜¯å¯èƒ½ä¼šå­˜åœ¨å…ˆæ‰§è¡Œ ESLintï¼Œå†è¿›è¡Œ Prettier çš„æƒ…å†µã€‚æ‰€ä»¥æˆ‘å°±æƒ³ç€æ•´åˆè¿™ä¸ªè„šæœ¬ï¼Œä½¿å…¶æŒ‰ç…§æˆ‘ä»¬é¢„æœŸæ–¹å‘èµ°ï¼šå½“ä¸¤è€…æœ‰å†²çªçš„æƒ…å†µæ—¶ï¼Œé‡‡ç”¨ ESLint çš„è§„åˆ™ã€‚</p>
<p>å®Œæ•´è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
    &quot;eslint&quot;: &quot;eslint ./ --ext .js&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix ./ --ext .js&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'&quot;,
    &quot;prettier:wxss&quot;: &quot;gulp wxss&quot;,
    &quot;prettier:acss&quot;: &quot;gulp acss&quot;,
    &quot;prettier:wxss:acss&quot;: &quot;gulp all&quot;,
    &quot;format:all&quot;: &quot;npm-run-all -p prettier:wxss:acss prettier:fix -s eslint:fix&quot;
  }
}
</code></pre>
<h3>å®‰è£… husky</h3>
<pre><code class="language-shell">$ yarn add --dev husky@4.3.0
</code></pre>
<p>åœ¨ <code>package.json</code> æ·»åŠ é…ç½®ï¼Œä½¿å…¶åœ¨è¿›è¡Œ <code>git commit -m 'xxx'</code> ä»£ç æäº¤æ—¶ï¼Œè¿›è¡Œæ ¼å¼åŒ–æ“ä½œï¼Œä»¥ä¿è¯æˆ‘ä»¬æäº¤çš„ä»£ç æ˜¯ä¸ä¸‘çš„ã€‚</p>
<p>å¦‚æœè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼ˆå¦‚ ESLint æ ¡éªŒä¸é€šè¿‡ï¼‰ï¼Œå°†ä¼šåœæ­¢ <code>commit</code> æ“ä½œï¼Œå³ <code>pre-commit</code> è¿”å›éé›¶ç»“æœä»¥é€€å‡ºã€‚</p>
<p>å®ƒå¯ä»¥é€šè¿‡ <code>git commit --no-verify</code> å‘½ä»¤è¿›è¡Œå¿½ç•¥ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;husky&quot;: {
    &quot;hooks&quot;: {
      &quot;pre-commit&quot;: &quot;yarn run format:all&quot;
    }
  }
}
</code></pre>
<h3>éªŒè¯</h3>
<p>æˆ‘ä»¬éšä¾¿ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œæäº¤ã€‚å¦‚å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æŒ‰ç…§é¢„æœŸæ‰§è¡Œçš„ï¼Œå¥½äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-284d03ac44d48a62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>lint-staged</h2>
<p>çœ‹åˆ°ä¸Šé¢çš„ç»“æœï¼Œä¼¼ä¹ä¸€åˆ‡é¡ºåˆ©ã€‚ä½†æ²¡æœ‰å®Œ...</p>
<p>ä»ä¸Šå›¾æˆ‘ä»¬çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬åªæäº¤äº†<strong>ä¸€ä¸ªæ–‡ä»¶</strong>çš„å˜åŠ¨ï¼Œä½†æ˜¯å®ƒå¯¹<strong>æ‰€æœ‰æ–‡ä»¶</strong>è¿›è¡Œäº†æ‰«æï¼Œè¿™é‡Œæ˜¯å­˜åœ¨ä½“éªŒæ€§é—®é¢˜çš„ã€‚</p>
<p><strong>å‡å¦‚æˆ‘ä»¬æœ‰ N å¤šä¸ªæš‚å­˜æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¯å½“æˆ‘ä»¬ <code>git commit</code> ä¸€æ¬¡å°±æ‰€æœ‰æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶ä¸€éï¼Œè¿™å¯¼è‡´æˆ‘ä»¬çš„ä½“éªŒéå¸¸ä¸å¥½ï¼Œè¿‡ç¨‹å¾ˆæ…¢ï¼Œæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</strong></p>
<p>é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ç”¨åˆ°å®ƒ  <a href="https://github.com/okonet/lint-staged">lint-staged</a>ã€‚</p>
<pre><code class="language-shell">$ yarn add --dev lint-staged@10.3.0
</code></pre>
<p>è‡ª v3.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥æœ‰<a href="https://github.com/okonet/lint-staged#configuration">å¤šç§ä¸åŒçš„æ–¹å¼</a>è¿›è¡Œé…ç½®ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>.lintstagedrc.js</code> çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code>--config</code> æˆ–è€… <code>-c</code> æŒ‡å®šã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;husky&quot;: {
    &quot;hooks&quot;: {
      &quot;pre-commit&quot;: &quot;lint-staged --config .lintstagedrc.js&quot;
    }
  }
}
</code></pre>
<pre><code class="language-js">// .lintstagedrc.js
const path = require('path')

module.exports = {
  '*.js': ['prettier --config .prettierrc.js --write', 'eslint --fix --ext .js'],
  '*.json': 'prettier --config .prettierrc.js --write',
  '*.wxss': absolutePaths =&gt; {
    // è·å–ç›¸å¯¹è·¯å¾„
    // const cwd = process.cwd()
    // const relativePaths = absolutePaths.map(file =&gt; path.relative(cwd, file))
    // return `gulp wxss --path ${relativePaths.join(' ')}`

    return 'gulp wxss'
  },
  '*.acss': 'gulp acss'
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸å°†è·¯å¾„ä½œä¸ºå‘½ä»¤è°ƒç”¨æ—¶çš„å‚æ•°ä¼ é€’ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸º lint-staged å°†ä¸ºæˆ‘ä»¬å®Œæˆè¿™ä¸€ç‚¹ã€‚</p>
</blockquote>
<p><code>lint-staged</code> é‡‡ç”¨çš„æ˜¯ <code>glob</code> åŒ¹é…æ¨¡å¼ã€‚ä»ä¸Šé¢çš„é…ç½®ä¸­ï¼Œé€šè¿‡åŒ¹é…ä¸åŒçš„æ–‡ä»¶ç±»å‹æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<p>å…³äº <code>lint-staged</code> ç›¸å…³ä½¿ç”¨è¯´æ˜ï¼Œå»ºè®®æŸ¥çœ‹<a href="https://github.com/okonet/lint-staged">å®˜æ–¹æ–‡æ¡£</a>æˆ–è€…è¾ƒç˜¦çš„è¿™ç¯‡<a href="https://www.cnblogs.com/jiaoshou/p/12250278.html">æ–‡ç« </a>ï¼Œæˆ‘å°±ä¸å†è¯¦è¯´ã€‚</p>
<blockquote>
<p>ä¸çŸ¥é“æœ‰æ²¡æœ‰äººå¥½å¥‡ï¼Œä¸Šé¢ <code>lint-staged</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘åœ¨åŒ¹é… <code>.wxss</code> æ–‡ä»¶æ—¶é‡‡ç”¨çš„æ˜¯å‡½æ•°å½¢å¼ã€‚</p>
<p><strong>å…¶å®è¿™é‡Œæ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³çš„ï¼Œå°±æ˜¯åœ¨æäº¤ <code>.wxss</code> æš‚å­˜æ–‡ä»¶æ—¶ï¼Œä¸æ˜¯åªå¤„ç†è¯¥ <code>.wxss</code> æ–‡ä»¶ï¼Œè€Œæ˜¯å°†é¡¹ç›®æ‰€æœ‰çš„ <code>.wxss</code> æ–‡ä»¶ï¼ˆåŒ…å«æœªæäº¤è‡³æš‚å­˜åŒºçš„ <code>.wxss</code> æ–‡ä»¶ï¼‰ã€‚</strong></p>
<p>åŸå› å¤§æ¦‚å¦‚ä¸‹ï¼š
1 åœ¨å‰é¢æˆ‘ä»‹ç»äº†ï¼Œç”±äº Prettier æ²¡æœ‰è§£æå™¨å»å¤„ç† <code>.wxss</code> æ‰©å±•åçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† Gulp.js é€šè¿‡è½¬æ¢æ–‡ä»¶ç±»å‹çš„æ–¹å¼å»å¤„ç†ã€‚è€Œå¯¹åº” Gulp ä»»åŠ¡æ˜¯åŒ¹é…å½“å‰é¡¹ç›®ä¸‹æ‰€æœ‰ <code>.wxss</code> æ–‡ä»¶çš„ï¼Œä½¿ç”¨ <code>gulp.dest(__dirname)</code> æ˜¯æ­£å¸¸å¯¼å‡ºåˆ°æºæ–‡ä»¶è·¯å¾„ä¸‹ã€‚</p>
<p>2 æŒ‰ç…§ <code>lint-staged</code> çš„æ€æƒ³ï¼Œåªå¤„ç†æäº¤çš„æš‚å­˜æ–‡ä»¶ã€‚æ„å‘³ç€æˆ‘ä»¬åœ¨æ‰§è¡Œ <code>gulp wxss</code> ä»»åŠ¡æ—¶åº”è¯¥è¦ä¼ é€’ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œç„¶åå†ä¿®æ”¹ <code>wxssPrettier</code> ä»»åŠ¡ï¼Œä½¿å…¶æ—¢èƒ½åŒ¹é…æ‰€æœ‰çš„ï¼Œä¹Ÿå¯ä»¥åŒ¹é…ä¸ªåˆ«æˆ–å¤šä¸ªçš„ï¼ˆè€Œéæ‰€æœ‰ï¼‰<code>.wxss</code> æ–‡ä»¶ã€‚ç„¶åæˆ‘å°è¯•äº†å¾ˆå¤šå‡ ç§æ–¹æ³•ï¼Œéƒ½æ²¡èƒ½å¾—åˆ°é¢„æœŸæ•ˆæœã€‚</p>
<p>3 æˆ‘è¸©å‘æ€è·¯å¤§è‡´æ˜¯ï¼šåœ¨æ‰§è¡Œ <code>gulp wxss</code> æ—¶ä¼ é€’ä¸€ä¸ªæˆ–è€…å¤šä¸ªè·¯å¾„å‚æ•°ï¼ˆå¦‚ä¸Šé…ç½®æ–‡ä»¶æ³¨é‡Šéƒ¨åˆ†ï¼‰ï¼Œé€šè¿‡ <code>process.argv</code> è·å– NPM è„šæœ¬å‚æ•°ï¼Œæ¥ç€åœ¨ <code>wxssPrettier</code> ä»»åŠ¡ä¸­å¯¹è·å–çš„å‚æ•°åšå¤„ç†ï¼Œå¾€ <code>gulp.src()</code> ä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œåˆ°è¿™æ¥æˆ‘è§‰å¾—æ€è·¯åº”è¯¥æ˜¯æ²¡é”™çš„ã€‚ä½†æ˜¯ç°å®æ˜¯æ®‹é…·çš„ï¼Œåœ¨ <code>gulp.dest()</code> æ—¶å¯¼å‡ºçš„è·¯å¾„æ€»æ˜¯ä¸å¯¹ï¼Œæ‰€æœ‰çš„ <code>.wxss</code> æ–‡ä»¶éƒ½è¢«å¯¼å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹äº†ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚åœ¨ Stack Overflow çœ‹åˆ°ä¸€ä¸ª<a href="https://stackoverflow.com/questions/22240977/gulp-js-use-path-from-gulp-src-in-gulp-dest">å¸–å­</a>ï¼Œåº”è¯¥è·Ÿæˆ‘è¿™ä¸ªé—®é¢˜ç±»ä¼¼ã€‚</p>
<p>4 ç›®å‰æˆ‘è¿˜æ²¡æ‰¾åˆ°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿å¤§ä½¬ä»¬èµæ•™ã€‚</p>
</blockquote>
<p>å°±æ˜¯å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—æˆ‘è¿™ä¸ª <a href="https://github.com/toFrankie/wechat_applet_demo">wechat_applet_demo</a> è¿˜ä¸æ˜¯å¾ˆå®Œç¾ï¼ˆæˆ‘æœ‰å¼ºè¿«ç—‡ï¼‰ï¼Œè‹¥åç»­æœ‰è§£å†³æ–¹æ¡ˆäº†ï¼Œä¼šå›æ¥æ›´æ–°çš„ã€‚</p>
<blockquote>
<p>æœ‰è§£å†³æ–¹æ¡ˆäº†ï¼Œå¿«å»çœ‹<a href="https://www.jianshu.com/p/553cef04e262">ç»“å±€ç¯‡</a>ã€‚</p>
</blockquote>
<h2>æœ€å</h2>
<p>åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†ï¼Œä½†å¯èƒ½è¿˜ä¼šåŠ å…¥ Commit Message æäº¤è¯´æ˜çš„è§„èŒƒï¼Œå› ä¸ºä¸€ä¸ªæ¸…æ™°æ˜äº†çš„æäº¤è¯´æ˜ï¼Œå¯ä»¥è®©äººå¾ˆæ¸…æ¥šæœ¬æ¬¡ä»£ç æäº¤çš„ç›®çš„æˆ–è€…è§£å†³äº†ä»€ä¹ˆå…·ä½“é—®é¢˜ã€‚ç›®å‰ä½¿ç”¨æœ€å¹¿çš„åº”è¯¥æ˜¯ Angular è§„èŒƒäº†ï¼Œæ¯”è¾ƒåˆç†å’Œç³»ç»ŸåŒ–ï¼Œè€Œä¸”æœ‰é…å¥—çš„å·¥å…·ã€‚</p>
<blockquote>
<p>è¡¥å……äº†ä¸€ç¯‡å…³äº Git Commit Message è§„èŒƒçš„æ–‡ç« <a href="https://github.com/toFrankie/blog/issues/101">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<p>è‹¥æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿ç•™è¨€æŒ‡æ­£ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/123</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/123</guid>
            <pubDate>Sat, 25 Feb 2023 13:14:56 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>âš ï¸ Deprecated</p>
</blockquote>
<h2>å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ï¼Œåœ¨å¤„ç†éƒ¨é—¨å‰ç«¯é¡¹ç›®ç”± SVN è¿ç§» Git çš„äº‹æƒ…ã€‚ç”±äºå†å²ä»£ç åœ¨æ­¤ä¹‹å‰å¹¶æ²¡æœ‰å¼•å…¥ç±»ä¼¼ <a href="http://eslint.cn/">ESLint</a>ã€<a href="https://prettier.io/">Prettier</a> çš„ä»£ç æ£€æŸ¥æˆ–è€…æ ¼å¼çº¦æŸç­‰å·¥å…·ã€‚</p>
<p>ç›®å‰éƒ¨é—¨ä»…å‰©æˆ‘ä¸€äººç»´æŠ¤è¿™åå‡ ä¸ªå°ç¨‹åºã€H5 å‰ç«¯é¡¹ç›®ã€‚ç°åœ¨åªè¦æ¥è§¦ä»¥å‰æ²¡æœ‰ç»æ‰‹çš„é¡¹ç›®ï¼Œå°±å¤´ç–¼ä¸æƒ³æ”¹ï¼Œå¾ˆæ— å¥ˆï¼Œè°è®©æˆ‘æ˜¯ä¸€ä¸ªæ‰“å·¥äººå‘¢ï¼</p>
<p>æœ¬æ–‡å°†ä¼šç»“åˆ ESLintã€Prettierã€huskyã€lint-stage å±•å¼€ä»‹ç»ï¼Œæ—¨åœ¨åœ¨ä»£ç æ ¼å¼åŒ–ã€ä»£ç æ£€æŸ¥ä¸Šå‡å°‘æ—¶é—´æµªè´¹ã€‚</p>
<p>å®Œæ•´ç¤ºä¾‹ï¼š<a href="https://github.com/toFrankie/wechat_applet_demo.git">wechat_applet_demo</a></p>
<p>å…±ä¸‰ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/123">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸Šé›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/124">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆä¸‹é›†ï¼‰</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/125">ä½¿ Prettier ä¸€é”®æ ¼å¼åŒ– WXSSï¼ˆç»“å±€ç¯‡ï¼‰</a></li>
</ul>
<p>æ‰©å±•ç¯‡ï¼š</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/101">Git Commit è§„èŒƒ</a></li>
</ul>
<h2>ç¼–è¾‘å™¨æ’ä»¶</h2>
<p>ä½¿ç”¨åˆ° VS Code æ’ä»¶ï¼š</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">ESLint</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier</a></li>
</ul>
<p>ç›¸å…³é…ç½®ä»¥ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š</p>
<pre><code class="language-json5">{
  &quot;files.associations&quot;: {
    &quot;*.wxss&quot;: &quot;css&quot;,
    &quot;*.wxs&quot;: &quot;javascript&quot;,
    &quot;*.acss&quot;: &quot;css&quot;,
    &quot;*.axml&quot;: &quot;html&quot;,
    &quot;*.wxml&quot;: &quot;html&quot;,
    &quot;*.swan&quot;: &quot;html&quot;
  },
  &quot;files.trimTrailingWhitespace&quot;: true,
  &quot;eslint.workingDirectories&quot;: [{ &quot;mode&quot;: &quot;auto&quot; }],
  &quot;eslint.enable&quot;: true, // æ˜¯å¦å¼€å¯ vscode çš„ eslint
  &quot;eslint.options&quot;: {
    // æŒ‡å®š vscode çš„ eslint æ‰€å¤„ç†çš„æ–‡ä»¶çš„åç¼€
    &quot;extensions&quot;: [&quot;.js&quot;, &quot;.ts&quot;, &quot;.tsx&quot;]
  },
  &quot;eslint.validate&quot;: [&quot;javascript&quot;],
  &quot;editor.codeActionsOnSave&quot;: {
    &quot;source.fixAll.eslint&quot;: true
  },
  &quot;git.ignoreLimitWarning&quot;: true
}
</code></pre>
<h2>å¼€å§‹</h2>
<h3>å®‰è£… ESLintã€Prettier ç›¸å…³ä¾èµ–</h3>
<p>é¿å…é‡å¤é€ è½®å­ï¼Œç¤¾åŒºä¸Šå·²æœ‰æœ€ä½³å®è·µï¼Œé€‰æ‹©å®ƒä»¬å³å¯ï¼Œæ¯”å¦‚ airbnbã€standardã€prettier ç­‰ã€‚å¦‚æœå›¢é˜Ÿæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè‡ªå®šä¹‰ä¸€äº›è§„åˆ™å³å¯ã€‚</p>
<p>è¿™é‡Œé€‰æ‹©çš„æ˜¯å›½å†…è…¾è®¯ AlloyTeam å›¢é˜Ÿå‡ºå“çš„ <a href="https://alloyteam.github.io/eslint-config-alloy/?language=zh-CN">eslint-config-alloy</a>ã€‚</p>
<p>å…¶å®ä»–ä»¬å›¢é˜Ÿæœ€å¼€å§‹ä½¿ç”¨ Airbnb è§„åˆ™ï¼Œä½†æ˜¯ç”±äºå®ƒè¿‡äºä¸¥æ ¼ï¼Œéƒ¨åˆ†è§„åˆ™è¿˜æ˜¯éœ€è¦ä¸ªæ€§åŒ–ï¼Œå¯¼è‡´åæ¥è¶Šæ”¹è¶Šå¤šï¼Œæœ€åå†³å®šé‡æ–°ç»´æŠ¤ä¸€å¥—ã€‚ç»è¿‡ä¸¤å¹´å¤šçš„æ‰“ç£¨ï¼Œç°åœ¨ eslint-config-alloy å·²ç»éå¸¸æˆç†Ÿäº†ã€‚</p>
<p>æˆ‘é€‰æ‹©å®ƒçš„å‡ ç‚¹åŸå› ï¼š</p>
<ul>
<li>é€‚ç”¨äº React/Vue/Typescript é¡¹ç›®</li>
<li>æ ·å¼ç›¸å…³è§„åˆ™ç”± Prettier ç®¡ç†</li>
<li>æœ‰<a href="https://github.com/AlloyTeam/eslint-config-alloy/blob/master/README.zh-CN.md">ä¸­æ–‡æ–‡æ¡£</a>å’Œç½‘ç«™<a href="https://alloyteam.github.io/eslint-config-alloy/?language=zh-CN&amp;rule=base">ç¤ºä¾‹</a></li>
<li>æ›´æ–°å¿«ï¼Œä¸”æ‹¥æœ‰å®˜æ–¹ç»´æŠ¤çš„ vueã€typescriptã€react+typescript è§„åˆ™</li>
</ul>
<pre><code class="language-shell">$ yarn add --dev babel-eslint@10.0.3
$ yarn add --dev eslint@6.7.1
$ yarn add --dev eslint-config-alloy@3.7.1
$ yarn add --dev eslint-config-prettier@6.10.0
$ yarn add --dev eslint-plugin-prettier@3.1.4
$ yarn add --dev prettier@2.0.5
$ yarn add --dev prettier-eslint-cli@5.0.0
</code></pre>
<h3>ESLintã€Prettier é…ç½®æ–‡ä»¶</h3>
<blockquote>
<p>æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<p><code>.eslintrc.js</code> ğŸ‘‡</p>
<pre><code class="language-js">module.exports = {
  root: true,
  parser: 'babel-eslint',
  env: {
    browser: true,
    es6: true,
    node: true,
    commonjs: true
  },
  extends: ['alloy'],
  plugins: ['prettier'],
  globals: {
    Atomics: 'readonly',
    SharedArrayBuffer: 'readonly',
    __DEV__: true,
    __WECHAT__: true,
    __ALIPAY__: true,
    App: true,
    Page: true,
    Component: true,
    Behavior: true,
    wx: true,
    my: true,
    swan: true,
    getApp: true,
    getCurrentPages: true
  },
  parserOptions: {
    ecmaVersion: 2018,
    sourceType: 'module'
  },
  rules: {
    'no-debugger': 2,
    'no-unused-vars': 1,
    'no-var': 0,
    'no-param-reassign': 0,
    'no-irregular-whitespace': 0,
    'no-useless-catch': 1,
    'max-params': ['error', 3],
    'array-callback-return': 1,
    eqeqeq: 0,
    indent: ['error', 2, { SwitchCase: 1 }]
  }
}
</code></pre>
<p><code>.prettierrc.js</code> ğŸ‘‡</p>
<pre><code class="language-js">module.exports = {
  printWidth: 120,
  tabWidth: 2,
  useTabs: false,
  semi: false,
  singleQuote: true,

  // å¯¹è±¡çš„ key ä»…åœ¨å¿…è¦æ—¶ç”¨å¼•å·
  quoteProps: 'as-needed',

  // jsx ä¸ä½¿ç”¨å•å¼•å·ï¼Œè€Œä½¿ç”¨åŒå¼•å·
  jsxSingleQuote: false,

  // æœ«å°¾ä¸éœ€è¦é€—å·
  trailingComma: 'none',

  // å¤§æ‹¬å·å†…çš„é¦–å°¾éœ€è¦ç©ºæ ¼
  bracketSpacing: true,

  // jsx æ ‡ç­¾çš„åå°–æ‹¬å·éœ€è¦æ¢è¡Œ
  jsxBracketSameLine: false,

  // ç®­å¤´å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæ— éœ€æ‹¬å·
  arrowParens: 'avoid',

  // æ¯ä¸ªæ–‡ä»¶æ ¼å¼åŒ–çš„èŒƒå›´æ˜¯æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
  rangeStart: 0,

  rangeEnd: Infinity,

  // ä¸éœ€è¦å†™æ–‡ä»¶å¼€å¤´çš„ @prettier
  requirePragma: false,

  // ä¸éœ€è¦è‡ªåŠ¨åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥ @prettier
  insertPragma: false,

  // ä½¿ç”¨é»˜è®¤çš„æŠ˜è¡Œæ ‡å‡†
  proseWrap: 'preserve',

  // æ ¹æ®æ˜¾ç¤ºæ ·å¼å†³å®š html è¦ä¸è¦æŠ˜è¡Œ
  htmlWhitespaceSensitivity: 'css',

  // æ¢è¡Œç¬¦ä½¿ç”¨ lf
  endOfLine: 'lf'
}
</code></pre>
<h3>é…ç½® ESLintã€Prettier å¿½ç•¥æ–‡ä»¶</h3>
<blockquote>
<p>æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<p><code>.eslintignore</code> ğŸ‘‡</p>
<pre><code class="language-.gitignore"># .eslintignore

*.min.js
typings
node_modules
</code></pre>
<p><code>.prettierignore</code> ğŸ‘‡</p>
<pre><code class="language-.gitignore">*.min.js
/node_modules
/dist
# OS
.DS_Store
.idea
.editorconfig
.npmrc
package-lock.json
# Ignored suffix
*.log
*.md
*.svg
*.png
*ignore
## Built-files
.cache
dist
</code></pre>
<h3>EditorConfig é…ç½®æ–‡ä»¶</h3>
<p>å®ƒæ˜¯ç”¨æ¥æŠ¹å¹³ä¸åŒç¼–è¾‘å™¨ä¹‹é—´çš„å·®å¼‚çš„ã€‚åŒæ ·æ”¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>æŒ‰éœ€é…ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<p><code>.editorconfig</code> ğŸ‘‡</p>
<pre><code class="language-ini"># .editorconfig
# http://editorconfig.org
# https://github.com/editorconfig/editorconfig/wiki/EditorConfig-Properties


# æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘å™¨ä¼šç”±å½“å‰ç›®å½•å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ° `roor = true` çš„æ–‡ä»¶ï¼Œåˆ™ä¸å†æŸ¥æ‰¾
root = true

# åŒ¹é…æ‰€æœ‰çš„æ–‡ä»¶
[*]
# ç¼©è¿›é£æ ¼ï¼šspace
indent_style = space
# ç¼©è¿›å¤§å° 2
indent_size = 2
# æ¢è¡Œç¬¦ lf
end_of_line = lf
# å­—ç¬¦é›† utf-8
charset = utf-8
# ä¸ä¿ç•™è¡Œæœ«çš„ç©ºæ ¼
trim_trailing_whitespace = true
# æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€ä¸ªç©ºè¡Œ
insert_final_newline = true
# è¿ç®—ç¬¦ä¸¤ééƒ½æœ‰ç©ºæ ¼
spaces_around_operators = true

# å¯¹æ‰€æœ‰çš„ js æ–‡ä»¶ç”Ÿæ•ˆ
[*.js]
# å­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·
quote_type = single

[*.md]
trim_trailing_whitespace = false
</code></pre>
<h3>æ·»åŠ  NPM Scripts</h3>
<p>æ·»åŠ ä¸‰æ¡è„šæœ¬æŒ‡ä»¤ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;eslint&quot;: &quot;eslint ./ --ext .js&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix ./ --ext .js&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'&quot;
  }
}
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥ä¸€é”®æ ¼å¼åŒ–å’Œä¿®å¤äº†ï¼Œæ³¨æ„ ESLint ä½¿ç”¨ <code>--fix</code> åªèƒ½ä¿®å¤ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œéƒ¨åˆ†éœ€æ‰‹åŠ¨è§£å†³ã€‚</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;wechat_applet_demo&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;å¾®ä¿¡å°ç¨‹åº Demo&quot;,
  &quot;main&quot;: &quot;app.js&quot;,
  &quot;repository&quot;: &quot;git@github.com:toFrankie/wechat_applet_demo.git&quot;,
  &quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;eslint&quot;: &quot;eslint ./ --ext .js&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix ./ --ext .js&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;babel-eslint&quot;: &quot;10.0.3&quot;,
    &quot;eslint&quot;: &quot;6.7.1&quot;,
    &quot;eslint-config-alloy&quot;: &quot;3.7.1&quot;,
    &quot;eslint-config-prettier&quot;: &quot;6.10.0&quot;,
    &quot;eslint-plugin-prettier&quot;: &quot;3.1.4&quot;,
    &quot;prettier&quot;: &quot;2.0.5&quot;,
    &quot;prettier-eslint-cli&quot;: &quot;5.0.0&quot;
  }
}
</code></pre>
<h2>è¿˜æ²¡å®Œ</h2>
<p>æ¥ä¸‹æ¥æ¶‰åŠ Gulp.js å†…å®¹ï¼Œæ˜¯ä¸ºäº†è®© Prettier å¤„ç† Gulp.js è½¬æ¢å‡ºæ¥çš„ <code>css</code>ï¼Œä»¥è¾¾åˆ°æœ€ç»ˆ Prettier æ ¼å¼åŒ–å¤„ç† <code>wxss</code> çš„ç›®çš„ã€‚</p>
<blockquote>
<p>ä¸Šè¿°æ–¹å¼èµ°äº†ä¸€äº›å¼¯è·¯ï¼Œå…¶å®é€šè¿‡ <a href="https://prettier.io/docs/en/configuration.html">Overrides</a> é…ç½®æ˜¯å¯ä»¥æŒ‡å®š <code>.wxss</code> æ–‡ä»¶ä½¿ç”¨æŒ‡å®šçš„è§£æå™¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç† <code>.wxss</code> æ–‡ä»¶æ—¶ä½¿ç”¨ CSS è§£æå™¨å»å¤„ç†å®ƒå°±å¥½äº†ï¼Œå…·ä½“çœ‹<a href="https://github.com/toFrankie/blog/issues/125">ç»“å±€ç¯‡</a>ã€‚</p>
</blockquote>
<p>æœ¬æ–‡æœ€æƒ³åˆ†äº«çš„æ˜¯ä¸‹é¢çš„å†…å®¹ï¼Œå‰é¢å¾ˆç®€å•ã€‚</p>
<p>Prettier æ”¯æŒçš„ JavaScriptã€JSXã€Angularã€Vueã€Flowã€TypeScriptã€CSSã€Lessã€Scssã€HTMLã€JSONã€GraphQLã€Markdownï¼ˆGFMã€MDXï¼‰ã€YAML çš„ä»£ç æ ¼å¼åŒ–ã€‚</p>
<p>ä½†å…¶å®æ˜¯ä¸èƒ½è¯†åˆ« <code>wxss</code>ã€<code>acss</code> ç­‰å°ç¨‹åºç‰¹æœ‰çš„å±‚å æ ·å¼ï¼Œå°½ç®¡å®ƒä»¬è§„åˆ™ä¸ CSS æ— å¼‚ï¼Œä½†æ˜¯ Prettier å¹¶æ²¡æœ‰è§£æå™¨å»è§£æå®ƒä»¬ã€‚</p>
<p>æˆ‘ä»¬è¯•å›¾å»è°ƒæ•´è„šæœ¬å‘½ä»¤ä¸ºï¼ˆæ·»åŠ  <code>*.wxss</code> æ‰©å±•åçš„æ–‡ä»¶ï¼‰ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.wxss'&quot;,
  }
}
</code></pre>
<p>ç„¶åå»æ‰§è¡Œçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>[error] No parser could be inferred for file: app.wxss</p>
</blockquote>
<p>æ—¢ç„¶è¿™æ ·èµ°ä¸é€šçš„è¯ï¼Œæ€»ä¸èƒ½åˆ©ç”¨ VS Code çš„ Prettier æ’ä»¶ä¸€ä¸ªä¸€ä¸ªåœ°å»æ ¼å¼åŒ– <code>*.wxss</code> çš„æ–‡ä»¶å§ï¼Œé‚£æ ·å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä¸ç¬¦åˆæˆ‘ä»¬â€œå·æ‡’â€çš„åšæ³•ã€‚ä¸‹é¢ä½¿ç”¨ <a href="https://www.gulpjs.com.cn/">Gulp</a> æ¥å¤„ç†ã€‚</p>
<h2>Gulp</h2>
<p>ç®€å•è¯´ä¸‹ Gulp çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ Node.js ä¸­çš„ <code>stream</code>ï¼ˆæµï¼‰ï¼Œé¦–å…ˆè·å–åˆ°éœ€è¦çš„ <code>stream</code>ï¼Œç„¶åé€šè¿‡ <code>stream</code> çš„ <code>pipe()</code> æ–¹æ³•æŠŠæµå¯¼å…¥åˆ°ä½ æƒ³è¦çš„åœ°æ–¹ã€‚æ¯”å¦‚ Gulp æ’ä»¶ä¸­ï¼Œç»è¿‡æ’ä»¶å¤„ç†åçš„æµåˆå¯ä»¥å¯¼å…¥åˆ°å…¶ä»–æ’ä»¶æ±‡æ€»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠæµå†™å…¥æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ Gulp æ˜¯ä»¥ <code>stream</code> ä¸ºåª’ä»‹çš„ï¼Œå®ƒä¸éœ€è¦é¢‘ç¹çš„ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ Gulp çš„é€Ÿåº¦æ¯” <a href="https://www.gruntjs.net/">Grunt</a> å¿«çš„ä¸€ä¸ªåŸå› ã€‚</p>
<blockquote>
<p>æˆ‘åˆšå¼€å§‹æ—¶çš„æƒ³æ³•æ˜¯ï¼šé¦–å…ˆå°† <code>wxss</code>ï¼ˆ<code>acss</code>ï¼‰è½¬æ¢å¹¶å¯¼å‡ºä¸º <code>css</code>ï¼Œæ¥ç€åˆ é™¤  <code>wxss</code>ï¼ˆ<code>acss</code>ï¼‰æ–‡ä»¶ï¼Œå†è€…ä½¿ç”¨ Prettier å¯¹ <code>css</code> æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œè½¬å›  <code>wxss</code>ï¼ˆ<code>acss</code>ï¼‰ä¹‹åï¼Œå†åˆ é™¤æ‰ <code>css</code> æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šé¢‘ç¹çš„ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œæ€è·¯æ˜¯æœ‰ç‚¹åƒ Gruntã€‚</p>
<p>ä½†æ˜¯äº†è§£äº† Gulp çš„æ€æƒ³åï¼Œå…¶å®å®ƒå¸®æˆ‘ä»¬çœæ‰äº†é¢‘ç¹å¢åˆ æ–‡ä»¶çš„ç¯èŠ‚ï¼Œå…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­æ“ä½œï¼Œä¹Ÿä¼šæ›´å¿«ä¸€äº›ï¼Œæ‰€ä»¥æ­¤å‰çš„æ–¹æ¡ˆè¢«æˆ‘å¦æ‰äº†ã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬åªç”¨åˆ° Gulp çš„å…¶ä¸­ä¸¤ä¸ª APIï¼Œ <a href="https://www.gulpjs.com.cn/docs/api/src/"><code>gulp.src()</code></a> å’Œ <a href="https://www.gulpjs.com.cn/docs/api/dest/"><code>gulp.dest()</code></a>ã€‚</p>
<h3>gulp.src()</h3>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è·å–æµçš„ï¼Œä½†è¦æ³¨æ„è¿™ä¸ªæµé‡Œé¢çš„å†…å®¹ä¸æ˜¯åŸå§‹çš„æ–‡ä»¶æµï¼Œè€Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡æµï¼ˆ<a href="https://www.gulpjs.com.cn/docs/api/vinyl/">Vinyl files</a>ï¼‰ï¼Œè¿™ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡ä¸­å­˜å‚¨ç€åŸå§‹æ–‡ä»¶çš„è·¯å¾„ã€æ–‡ä»¶åã€å†…å®¹ç­‰ä¿¡æ¯ã€‚ï¼ˆè¿™é‡Œä¸æ·±å…¥ï¼Œç‚¹åˆ°ä¸ºæ­¢ï¼Œæœ‰å…´è¶£è‡ªè¡Œäº†è§£ï¼‰</p>
<blockquote>
<p>è¯­æ³•ï¼šgulp.src(globs[, options])</p>
</blockquote>
<ul>
<li><strong>globs</strong>ï¼šæ˜¯æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼Œç”¨æ¥åŒ¹é…æ–‡ä»¶è·¯å¾„ï¼ˆåŒ…æ‹¬æ–‡ä»¶åï¼‰</li>
<li><strong>options</strong>ï¼šä¸ºå¯é€‰å‚æ•°ï¼Œé€šå¸¸æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦ç”¨åˆ°</li>
</ul>
<p>*å…³äºå‚æ•°è¯¦ç»†è¯´æ˜ï¼Œè¯·çœ‹<a href="https://www.gulpjs.com.cn/docs/api/src/">æ–‡æ¡£</a>ã€‚</p>
<h3>gulp.dest()</h3>
<p>è¯¥æ–¹æ³•æ˜¯ç”¨æ¥å†™æ–‡ä»¶çš„</p>
<blockquote>
<p>gulp.dest(path[, options])</p>
</blockquote>
<ul>
<li><strong>path</strong>ï¼šæ˜¯å†™å…¥æ–‡ä»¶çš„è·¯å¾„</li>
<li><strong>options</strong>ï¼šä¸ºå¯é€‰å‚æ•°ï¼Œé€šå¸¸æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦ç”¨åˆ°</li>
</ul>
<p>è¦æƒ³ä½¿ç”¨å¥½ <code>gulp.dest()</code> è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¦ç†è§£ç»™å®ƒä¼ å…¥çš„è·¯å¾„å‚æ•°ä¸æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶çš„å…³ç³»ã€‚</p>
<p>Gulp çš„ä½¿ç”¨æµç¨‹ä¸€èˆ¬æ˜¯ï¼šé¦–å…ˆé€šè¿‡ <code>gulp.src()</code> æ–¹æ³•è·å–åˆ°æˆ‘ä»¬æƒ³è¦å¤„ç†çš„æ–‡ä»¶æµï¼Œç„¶åæŠŠæ–‡ä»¶æµé€šè¿‡ <code>pipe()</code> æ–¹æ³•å¯¼å…¥åˆ° Gulp çš„æ’ä»¶ä¸­ï¼Œæœ€åæŠŠç»è¿‡æ’ä»¶å¤„ç†åçš„æµå†é€šè¿‡ <code>pipe()</code> æ–¹æ³•å¯¼å…¥åˆ° <code>gulp.dest()</code> ä¸­ï¼Œ<code>gulp.dest()</code> æ–¹æ³•åˆ™æŠŠæµä¸­çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</p>
<p>è¿™é‡Œéœ€è¦å¼„æ¸…æ¥šçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ç»™ <code>gulp.dest()</code> ä¼ å…¥çš„è·¯å¾„å‚æ•°ï¼Œåªèƒ½ç”¨æ¥æŒ‡å®šè¦ç”Ÿæˆçš„æ–‡ä»¶çš„ç›®å½•ï¼Œè€Œä¸èƒ½æŒ‡å®šç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå®ƒç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶åä½¿ç”¨çš„æ˜¯å¯¼å…¥åˆ°å®ƒçš„æ–‡ä»¶æµè‡ªèº«çš„æ–‡ä»¶åï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ–‡ä»¶åæ˜¯ç”±å¯¼å…¥åˆ°å®ƒçš„æ–‡ä»¶æµå†³å®šçš„ï¼Œå³ä½¿æˆ‘ä»¬ç»™å®ƒä¼ å…¥ä¸€ä¸ªå¸¦æœ‰æ–‡ä»¶åçš„è·¯å¾„å‚æ•°ï¼Œç„¶åå®ƒä¹Ÿä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åå½“åšæ˜¯ç›®å½•åï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">const gulp = require('gulp')
gulp.src('script/jquery.js').pipe(gulp.dest('dist/foo.js'))

// æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„ä¸º dist/foo.js/jquery.jsï¼Œè€Œä¸æ˜¯ dist/foo.js
</code></pre>
<p>è‹¥éœ€è¦ä¿®æ”¹æ–‡ä»¶åï¼Œéœ€è¦ä½¿ç”¨æ’ä»¶ <a href="https://www.npmjs.com/package/gulp-rename">gulp-rename</a>ã€‚</p>
<ul>
<li>å…³äºä¸Šè¿° Gulp çš„ API ä¸æ–¹æ³•è¯´æ˜ï¼Œä¸»è¦å‚è€ƒè‡ª<a href="https://www.gulpjs.com.cn/">å®˜æ–¹æ–‡æ¡£</a>ä¸æ— åŒçš„ä¸€ç¯‡<a href="https://www.cnblogs.com/2050/p/4198792.html">æ–‡ç« </a>ã€‚</li>
</ul>
<h2>Gulp é…ç½®</h2>
<p>é¦–å…ˆï¼Œå®‰è£… Gulp ç›¸å…³ä¾èµ–åŒ…ã€‚</p>
<pre><code class="language-shell">$ yarn add --dev gulp@4.0.2
$ yarn add --dev gulp-clean@0.4.0
$ yarn add --dev gulp-debug@4.0.0
$ yarn add --dev gulp-prettier@3.0.0
$ yarn add --dev gulp-rename@2.0.0
</code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>gulpfile.js</code> æ–‡ä»¶ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ä½¿ç”¨ <code>gulp.src()</code> è·å–æµï¼Œç„¶åä½¿ç”¨ Gulp æ’ä»¶å¯¹æµåˆ†åˆ«ä½œé‡å‘½åï¼ˆgulp-renameï¼‰ã€æ ¼å¼åŒ–ï¼ˆ<code>gulp-prettier</code>ï¼‰ã€å†é‡å‘½åå›æ¥ï¼ˆ<code>gulp-rename</code>ï¼‰ã€æœ€åå¯¼å‡ºï¼ˆ<code>gulp.dest()</code>ï¼‰ã€‚è¿‡ç¨‹ä¸­æœ‰åˆ©ç”¨ <code>gulp-debug</code> æ’ä»¶æ¥æŸ¥çœ‹ä¸€äº›ä¿¡æ¯ã€‚</p>
</blockquote>
<p>è¿™é‡Œæˆ‘å¯¹å¾®ä¿¡å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºçš„å±‚å æ ·å¼éƒ½å¤„ç†äº†ã€‚</p>
<pre><code class="language-js">// gulpfile.js
const { series, parallel, src, dest } = require('gulp')
const rename = require('gulp-rename')
const debug = require('gulp-debug')
const clean = require('gulp-clean')
const prettier = require('gulp-prettier')
const config = require('./.prettierrc')

// wxss ä¸€é”®æ ¼å¼åŒ–
const wxssPrettier = () =&gt; {
  return src('./**/*.wxss')
    .pipe(
      // å¯ä»¥åˆ©ç”¨æ’ä»¶ï¼ŒæŸ¥çœ‹ä¸€äº› debug ä¿¡æ¯
      debug()
    )
    .pipe(
      // é‡å†™æ‰©å±•åä¸º cssï¼Œæ‰èƒ½è¢« Prettier è¯†åˆ«è§£æ
      rename({
        extname: '.css'
      })
    )
    .pipe(
      // Prettier æ ¼å¼åŒ–
      prettier(config)
    )
    .pipe(
      // é‡æ–°å°†æ‰©å±•åæ”¹ä¸º wxss
      rename({
        extname: '.wxss'
      })
    )
    .pipe(
      // å¯¼å‡ºæ–‡ä»¶
      dest(__dirname)
    )
}

// acss ä¸€é”®æ ¼å¼åŒ–
const acssPrettier = () =&gt; {
  return src('./**/*.acss')
    .pipe(debug())
    .pipe(
      rename({
        extname: '.css'
      })
    )
    .pipe(prettier(config))
    .pipe(
      rename({
        extname: '.acss'
      })
    )
    .pipe(dest(__dirname))
}

// è¿™é‡Œå¯¼å‡ºå¤šä¸ª taskï¼Œé€šè¿‡ gulp xxx å°±èƒ½æ¥è°ƒç”¨äº†ï¼Œå¦‚ gulp all
// å…³äº seriesã€parallel API åˆ†åˆ«æ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼ˆåŒæ­¥ï¼‰ã€åŒæ—¶æ‰§è¡Œï¼ˆå¹¶è¡Œï¼‰
module.exports = {
  all: parallel(wxssPrettier, acssPrettier),
  wxss: wxssPrettier,
  acss: acssPrettier
}
</code></pre>
<p>åœ¨é…ç½®ä¸‹ NPM Scriptï¼š</p>
<pre><code class="language-json5">{
  &quot;scripts&quot;: {
    &quot;prettier:wxss&quot;: &quot;gulp wxss&quot;,
    &quot;prettier:accs&quot;: &quot;gulp acss&quot;,
    &quot;prettier:wxss:acss&quot;: &quot;gulp all&quot;
  }
}
</code></pre>
<p>ç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜é…ç½®æˆåŠŸäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7412e44f142f43d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>Git-Hooks</h2>
<p>ä¸Šé¢å·²ç»å®ç°äº†å¯¹ <code>wxss</code>ã€<code>acss</code> æ‰©å±•åçš„æ–‡ä»¶è¿›è¡Œä¸€é”®æ ¼å¼åŒ–äº†ã€‚</p>
<p>è¿˜å¯ä»¥â€œæ›´æ‡’â€ä¸€äº›ï¼Œåˆ©ç”¨ <a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90">git-hooks</a> æˆ‘ä»¬å¯å®ç°åœ¨ <code>commit</code> ä¹‹å‰ï¼Œå¯¹é¡¹ç›®è¿›è¡Œ ESLintã€Prettier æ£€æµ‹å’Œæ ¼å¼åŒ–ï¼Œä¸€æ—¦å‡ºç°é”™è¯¯ï¼Œå°†åœæ­¢ <code>commit</code> æ“ä½œã€‚</p>
<p>æœ¬æ–‡ç¯‡å¹…è¿‡é•¿ï¼Œæ”¾åˆ°<a href="https://github.com/toFrankie/blog/issues/124">ä¸‹ç¯‡</a>æ¥ç€...</p>
<h2>æ’ä¸ªé¢˜å¤–è¯</h2>
<p>ç”±äºæœ¬é¡¹ç›®çš„ npm åŒ…ä»…ç”¨äºä»£ç æ£€æŸ¥ä¸æ ¼å¼åŒ–ï¼Œå¹¶æœªå‚ä¸é¡µé¢ä»£ç é€»è¾‘ä¸­ã€‚æ‰€ä»¥æˆ‘åœ¨å°ç¨‹åºæœ¬åœ°é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸Š<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html">æ‰“åŒ…é…ç½®é€‰é¡¹</a>ã€‚</p>
<blockquote>
<p>packOptions ç”¨ä»¥é…ç½®é¡¹ç›®åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­çš„é€‰é¡¹ã€‚æ‰“åŒ…æ˜¯é¢„è§ˆã€ä¸Šä¼ æ—¶å¯¹é¡¹ç›®è¿›è¡Œçš„å¿…é¡»æ­¥éª¤ã€‚</p>
<p>ç›®å‰å¯ä»¥æŒ‡å®š <code>packOptions.ignore</code> å­—æ®µï¼Œç”¨ä»¥é…ç½®æ‰“åŒ…æ—¶å¯¹ç¬¦åˆæŒ‡å®šè§„åˆ™çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œå¿½ç•¥ï¼Œä»¥è·³è¿‡æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œè¿™äº›æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å°†ä¸ä¼šå‡ºç°åœ¨é¢„è§ˆæˆ–ä¸Šä¼ çš„ç»“æœå†…ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯æ”¯ä»˜å®å°ç¨‹åºï¼Œåœ¨ç¼–å†™æœ¬æ–‡æ—¶è¿˜æœªæ”¯æŒç±»ä¼¼ <code>ignore</code> é€‰é¡¹ã€‚</p>
<pre><code class="language-json5">// project.config.json
{
  &quot;packOptions&quot;: {
    &quot;ignore&quot;: [
      {
        &quot;type&quot;: &quot;regexp&quot;,
        &quot;test&quot;: &quot;\\.md$&quot;
      },
      {
        &quot;type&quot;: &quot;folder&quot;,
        &quot;test&quot;: &quot;node_modules&quot;
      }
    ]
  }
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ESLint ç¦æ­¢è§„åˆ™å‡ºç°è­¦å‘Šçš„ 5 ç§æ–¹å¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/122</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/122</guid>
            <pubDate>Sat, 25 Feb 2023 13:13:43 GMT</pubDate>
            <description><![CDATA[<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ ESLint é…ç½®æ–‡ä»¶ <code>rules</code> ä¸­é’ˆå¯¹æˆ‘ä»¬çš„é¡¹ç›®åšä¸€äº›ä¸ªæ€§åŒ–çš„ç¦ç”¨è§„åˆ™çš„é…ç½®ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä»¥ä¸‹è¿™ä¸€æ¡ç¦ç”¨è§„åˆ™ï¼Œæ„å‘³ç€æ‰€æœ‰è¢«æ£€æµ‹çš„æ–‡ä»¶ä¸­éƒ½ä¸å…è®¸ä½¿ç”¨ <code>alert()</code> æ–¹æ³•ã€‚</p>
<pre><code class="l]]></description>
            <content:encoded><![CDATA[<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ ESLint é…ç½®æ–‡ä»¶ <code>rules</code> ä¸­é’ˆå¯¹æˆ‘ä»¬çš„é¡¹ç›®åšä¸€äº›ä¸ªæ€§åŒ–çš„ç¦ç”¨è§„åˆ™çš„é…ç½®ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä»¥ä¸‹è¿™ä¸€æ¡ç¦ç”¨è§„åˆ™ï¼Œæ„å‘³ç€æ‰€æœ‰è¢«æ£€æµ‹çš„æ–‡ä»¶ä¸­éƒ½ä¸å…è®¸ä½¿ç”¨ <code>alert()</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-js">{
  rules: {
    'no-alert': 2
  }
}
</code></pre>
<p>å‡å¦‚æˆ‘ä»¬è°ƒè¯•æŸä¸ªåŠŸèƒ½æ—¶éœ€è¦ç”¨åˆ° <code>alert() </code> æ–¹æ³•ï¼Œä½†åˆä¸æƒ³ ESLint æ£€æµ‹å‡ºç°è­¦å‘Šï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼ŒESLint æ”¯æŒåœ¨ä½ çš„æ–‡ä»¶ä¸­ä½¿ç”¨è¡Œæ³¨é‡Šæˆ–è€…å—æ³¨é‡Šçš„æ–¹å¼æ¥ç¦æ­¢ï¼ˆæŸäº›ï¼‰è§„åˆ™ã€‚</p>
<h3>ä¸€ã€ç¦æ­¢è­¦å‘Šçš„æ–¹å¼</h3>
<ol>
<li>é€šè¿‡å—æ³¨é‡Šæ¥ä¸´æ—¶ç¦æ­¢è§„åˆ™å‡ºç°è­¦å‘Š</li>
</ol>
<pre><code class="language-js">/* eslint-disable */
alert('foo')
/* eslint-enable */
</code></pre>
<ol start="2">
<li>å¯¹æŒ‡å®šçš„è§„åˆ™å¯ç”¨æˆ–ç¦ç”¨è­¦å‘Š</li>
</ol>
<pre><code class="language-js">/* eslint-disable no-alert, no-console */
alert('foo')
console.log('bar')
/* eslint-enable no-alert, no-console */
</code></pre>
<ol start="3">
<li>é€šè¿‡è¡Œæ³¨é‡Šæˆ–å—æ³¨é‡Šåœ¨æŸä¸€ç‰¹å®šçš„è¡Œä¸Šç¦ç”¨æ‰€æœ‰è§„åˆ™</li>
</ol>
<pre><code class="language-js">// å½“å‰è¡Œ
alert('foo') // eslint-disable-line
alert('foo') /* eslint-disable-line */

// å…³é—­ä¸‹ä¸€è¡Œæ ¡éªŒ
// eslint-disable-next-line
alert('foo')
/* eslint-disable-next-line */
alert('foo')
</code></pre>
<ol start="4">
<li>åœ¨æ–‡ä»¶é¡¶éƒ¨åŠ ä¸Šå—æ³¨é‡Šï¼Œä½¿æ•´ä¸ªæ–‡ä»¶èŒƒå›´å†…ç¦æ­¢è§„åˆ™å‡ºç°è­¦å‘Š</li>
</ol>
<pre><code class="language-js">/* eslint-disable */

alert('foo')
</code></pre>
<blockquote>
<p>è‹¥ä¸´æ—¶ç¦æ­¢æŸä¸ªæˆ–å¤šä¸ªè§„åˆ™å‡ºç°è­¦å‘Šï¼Œå¯ä»¥åœ¨æœ«å°¾è·Ÿä¸Šè¦ç¦æ­¢çš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼š<code>// eslint-disable-line no-alert</code> å¯ä»¥åœ¨å½“å‰è¡Œä½¿ç”¨ <code>alert()</code> æ—¶ç¦æ­¢å‡ºç°è­¦å‘Šã€‚å¤šä¸ªè§„åˆ™æ—¶ï¼Œä½¿ç”¨é€—å· (<code>,</code>) éš”å¼€ã€‚</p>
<p>å¦å¤–ï¼Œä»¥ä¸Šæ‰€æœ‰æ–¹æ³•åŒæ ·é€‚ç”¨äºæ’ä»¶è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œç¦æ­¢ <code>eslint-plugin-example</code> çš„ <code>rule-name</code> è§„åˆ™ï¼ŒæŠŠæ’ä»¶åï¼ˆ<code>example</code>ï¼‰å’Œè§„åˆ™åï¼ˆ<code>rule-name</code>ï¼‰ç»“åˆä¸º <code>example/rule-name</code>ã€‚</p>
</blockquote>
<ol start="5">
<li>è‹¥è¦ç¦ç”¨ä¸€ç»„æ–‡ä»¶çš„é…ç½®æ–‡ä»¶ä¸­çš„è§„åˆ™ï¼Œè¯·ä½¿ç”¨ <code>overrides</code> å’Œ <code>files</code>ã€‚ä¾‹å¦‚:</li>
</ol>
<pre><code class="language-js">// ä»¥ä¸‹æ˜¯ Javascript æ ¼å¼ï¼Œè‹¥ JSON å½¢å¼é…ç½®æ–‡ä»¶è¯·æ³¨æ„æ ¼å¼ã€‚
{
  rules: {...},
  overrides: [
    {
      files: ['*-test.js','*.spec.js'],
      rules: {
        'no-unused-expressions': 0
      }
    }
  ]
}
</code></pre>
<h3>æœ€å</h3>
<p>*<strong>æ³¨æ„</strong>ï¼šä¸ºæ–‡ä»¶çš„æŸéƒ¨åˆ†ç¦ç”¨è­¦å‘Šçš„æ³¨é‡Šï¼Œå‘Šè¯‰ ESLint ä¸è¦å¯¹ç¦ç”¨çš„ä»£ç æŠ¥å‘Šè§„åˆ™çš„å†²çªã€‚ESLint ä»è§£ææ•´ä¸ªæ–‡ä»¶ï¼Œç„¶è€Œï¼Œç¦ç”¨çš„ä»£ç ä»éœ€è¦æ˜¯æœ‰æ•ˆçš„ JavaScript è¯­æ³•ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åº”è¯¥æ‹¥æŠ± ESLint]]></title>
            <link>https://github.com/toFrankie/blog/issues/121</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/121</guid>
            <pubDate>Sat, 25 Feb 2023 13:11:11 GMT</pubDate>
            <description><![CDATA[<p>æœ€æœ€æœ€ç®€å•çš„ ESLint ä½¿ç”¨æ¡ˆä¾‹ã€‚</p>
<blockquote>
<p>ESLint é‡å¿ƒåœ¨ä»£ç è´¨é‡ä¸Šï¼Œè€Œ Prettier åªå…³å¿ƒä»£ç æ ¼å¼ã€‚</p>
</blockquote>
<ol>
<li>åˆå§‹åŒ–é¡¹ç›®</li>
</ol>
<pre><code class="language-shell"># åˆ›]]></description>
            <content:encoded><![CDATA[<p>æœ€æœ€æœ€ç®€å•çš„ ESLint ä½¿ç”¨æ¡ˆä¾‹ã€‚</p>
<blockquote>
<p>ESLint é‡å¿ƒåœ¨ä»£ç è´¨é‡ä¸Šï¼Œè€Œ Prettier åªå…³å¿ƒä»£ç æ ¼å¼ã€‚</p>
</blockquote>
<ol>
<li>åˆå§‹åŒ–é¡¹ç›®</li>
</ol>
<pre><code class="language-shell"># åˆ›å»ºé¡¹ç›® HelloESLint
$ mkdir HelloESLint

# è¿›å…¥é¡¹ç›®ç›®å½•
$ cd HelloESLint

# åˆå§‹åŒ–é¡¹ç›®
$ npm init
</code></pre>
<ol start="2">
<li>å®‰è£… <code>eslint</code></li>
</ol>
<pre><code class="language-shell">$ npm i --save-dev eslint
</code></pre>
<ol start="3">
<li>è¿è¡Œå‘½ä»¤è‡ªåŠ¨åˆ›å»º <code>.eslintrc</code> æ–‡ä»¶</li>
</ol>
<pre><code class="language-shell"># æ–¹å¼ä¸€ï¼ˆæ¨èï¼‰
$ npx eslint --init

# æ–¹å¼äºŒ
$ node ./node_modules/eslint/bin/eslint.js --init
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-69da7b53d92e11ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-js">// .eslintrc.js
module.exports = {
    &quot;env&quot;: {
        &quot;es6&quot;: true,
        &quot;node&quot;: true
    },
    &quot;extends&quot;: &quot;eslint:recommended&quot;,
    &quot;globals&quot;: {
        &quot;Atomics&quot;: &quot;readonly&quot;,
        &quot;SharedArrayBuffer&quot;: &quot;readonly&quot;
    },
    &quot;parserOptions&quot;: {
        &quot;ecmaVersion&quot;: 2018,
        &quot;sourceType&quot;: &quot;module&quot;
    },
    &quot;rules&quot;: {

    }
};
</code></pre>
<ol start="4">
<li>åˆ›å»º <code>src/index.js</code>ã€<code>src/common.js</code> æ–‡ä»¶</li>
</ol>
<pre><code class="language-js">// index.js
var a = 123;

// common.js
function sum(a, b) {
  return a + b;
}
</code></pre>
<ol start="5">
<li><code>eslint</code> æ£€æŸ¥</li>
</ol>
<pre><code class="language-shell"># å•æ–‡ä»¶æ£€æŸ¥
$ npx eslint ./src/index.js

# å¤šæ–‡ä»¶æ£€æŸ¥
$ npx eslint ./src/index.js ./src/common.js

# æˆ–ç”¨é€šé…ç¬¦çš„æ–¹å¼
$ npx eslint ./src/*.js
</code></pre>
<ol start="6">
<li><code>eslint</code> æ£€æŸ¥ç»“æœ</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-44cab6caf74ef8eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>ä¸ºä»€ä¹ˆå‡ºç°æŠ¥é”™å‘¢ï¼Ÿå¦‚ä½•å±è”½æ­¤ç±»é”™è¯¯æç¤ºï¼Ÿå¦‚ä½•è‡ªå®šä¹‰ ESLint è§„åˆ™å‘¢ï¼Ÿ</strong></p>
<ol>
<li>åœ¨æˆ‘ä»¬çš„ <code>.eslintrc</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° <code>&quot;extends&quot;: &quot;eslint:recommended&quot;</code> è¿™ä¸€è¡Œï¼Œå…¶å®æ˜¯é‡‡ç”¨äº† ESLint æ¨èçš„è§„åˆ™ï¼Œ<a href="http://eslint.cn/docs/rules/">è¯¥è§„åˆ™é¡µé¢åœ¨è¿™é‡Œ</a>ï¼Œé‡Œé¢å°±åŒ…æ‹¬å…¶ä¸­ä¸€é¡¹ï¼š<strong><code>no-unused-vars</code>ï¼ˆç¦æ­¢å‡ºç°æœªä½¿ç”¨è¿‡çš„å˜é‡ï¼‰</strong>ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æŠ¥é”™çš„åŸå› ã€‚</li>
<li>ESLint å¹¶ä¸æ¨èä»»ä½•ç¼–ç é£æ ¼ï¼Œè§„åˆ™æ˜¯è‡ªç”±çš„ã€‚ï¼ˆè·Ÿç¬¬ä¸€ç‚¹æ˜¯ä¸æ˜¯å¾ˆçŸ›ç›¾ï¼‰ï¼Œå…¶å®å¹¶ä¸æ˜¯ã€‚<code>eslint:recommended</code> å®ƒåªæ˜¯æ˜¯æ¶µç›–äº†è¡Œä¸šæ™®éçš„æœ€ä½³å®è·µè€Œå·²ï¼Œå¹¶ä¸æ˜¯å®Œå…¨é€‚åˆä»»ä½•ä¸€ä¸ªå¼€å‘è€…æˆ–è€…å›¢é˜Ÿï¼Œè¿˜æœ‰ Airbnb çš„ <a href="https://www.npmjs.com/package/eslint-config-airbnb">eslint-config.airbnb</a>ã€è…¾è®¯ Alloy å›¢é˜Ÿçš„ <a href="https://github.com/AlloyTeam/eslint-config-alloy">eslint-config-alloy</a> ç­‰æ·±å—å¼€å‘è€…å–œçˆ±çš„é…ç½®è§„åˆ™ã€‚</li>
<li>è‡ªå®šä¹‰ ESLint è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>.eslintrc</code> æ–‡ä»¶ä¸­ <code>rules</code> ä¸­æ·»åŠ ç¬¦åˆè‡ªå·±çš„è§„åˆ™ã€‚å‡å¦‚æˆ‘è¦å±è”½ä¸Šé¢çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ï¼š<code>&quot;no-unused-vars&quot;: &quot;off&quot;</code>ï¼Œå†æ‰§è¡Œæ£€æŸ¥å°±ä¸ä¼šæŠ¥æ­¤ç±»é”™è¯¯äº†ã€‚</li>
</ol>
<h4>æ›´ä¾¿æ·åœ°å®æ—¶æ£€æµ‹æ’ä»¶</h4>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œå‘½ä»¤ <code>npx eslint youfile.js</code> æ‰çŸ¥é“ç»“æœï¼Œä½†å¦‚æœä½¿ç”¨ Visual Studio Code è¿›è¡Œå¼€å‘çš„è¯ï¼Œå¯ä»¥å®‰è£… <code>ESLint</code> æ’ä»¶ï¼Œå¦‚æœå‘ç”Ÿä¸ç¬¦åˆè§„åˆ™ï¼Œä¼šç›´æ¥æŠ¥é”™ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-16203f69f897ff37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
<img src="https://upload-images.jianshu.io/upload_images/5128488-510db786ea57a1b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœ€åï¼Œä¸Šé¢çš„æ•™ç¨‹åªæ˜¯ä¸€ä¸ªæœ€æœ€ç®€å•çš„æ¡ˆä¾‹å»è¯´æ˜å¦‚ä½•ä½¿ç”¨ ESLint è€Œå·²ï¼Œå…¶å®ç°åœ¨å‰ç«¯é¡¹ç›®éƒ½æ˜¯å·¥ç¨‹åŒ–äº†ï¼ŒESLint æœ€ä½³çš„å®è·µåº”è¯¥æ˜¯ç»“åˆ Reactã€Vueã€Angular ç­‰ä½¿ç”¨æ‰å¯¹ï¼Œè¿˜æœ‰åŠ ä¸Š Prettierï¼Œåé¢æœ‰æ—¶é—´ä¼šç»§ç»­å†™çš„ï¼Œè°¢è°¢ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•åœ¨ React ä¸­æ·»åŠ  !important çš„è¡Œå†…æ ·å¼ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/120</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/120</guid>
            <pubDate>Sat, 25 Feb 2023 13:10:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2070bbb051e46444.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2070bbb051e46444.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œåœ¨ React ä¸­æ˜¯æ— æ³•ç»™è¡Œå†…æ ·å¼æ·»åŠ  <code>!important</code> æƒé‡çš„ã€‚</p>
<pre><code class="language-jsx">// not worked
export default function App() {
  return (
    &lt;div className=&quot;app&quot; style={{ fontSize: '30px !important' }} &gt;
      React App
    &lt;/div&gt;
  )
}
</code></pre>
<p>å¦‚æœéè¦ç”¨ï¼Œå¯ä»¥ç”¨ <a href="https://beta.reactjs.org/reference/react-dom/components/common#ref-callback">Callback Refs</a> å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-jsx">// worked
export default function App() {
  return (
    &lt;div
      className=&quot;app&quot;
      ref={el =&gt; el &amp;&amp; el.style.setProperty('font-size', '30px', 'important')}
    &gt;
      React App
    &lt;/div&gt;
  )
}
</code></pre>
<p>ç›¸å…³è®¨è®ºå¯çœ‹ï¼š</p>
<blockquote>
<p><a href="https://github.com/facebook/react/issues/1881#top">Support !important for styles? #1881</a></p>
</blockquote>
<blockquote>
<p>To be fair, the ref solution doesnâ€™t help for server rendering. Again, if you have a particular API proposal, sending an RFC would be a better place to discuss it. Thank you! <a href="https://github.com/facebook/react/issues/1881#issuecomment-542657600">commented by dan</a></p>
</blockquote>
<p><strong>ä¸ºä»€ä¹ˆ React ä¸æ”¯æŒå‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œè¿™éœ€æ±‚çš„å®ç°æ˜¯æ²¡æœ‰ä»»ä½•æŠ€æœ¯éš¾åº¦çš„ã€‚ä½† React ä¸ºä»€ä¹ˆä¸åšå‘¢ï¼Œä¸ªäººçŒœæµ‹å¯èƒ½æ˜¯å¼€å‘è€…æ»¥ç”¨ <code>!important</code> å¤„ç†æ ·å¼æ ·å¼ä¼˜å…ˆçº§ã€‚è™½è¯´å¦‚æ­¤ï¼Œä½†ç†åº”æ”¯æŒï¼Œæ€»ä¼šé‡åˆ°ã€Œç”¨é­”æ³•æ‰“è´¥é­”æ³•ã€çš„åœºæ™¯çš„ã€‚</p>
<p><strong>å…³äº !important çš„ä¸€äº›çœ‹æ³•ï¼š</strong></p>
<p>å½“åœ¨ä¸€ä¸ªæ ·å¼å£°æ˜ä¸­ä½¿ç”¨ä¸€ä¸ª <code>!important</code> è§„åˆ™æ—¶ï¼Œæ­¤å£°æ˜å°†è¦†ç›–ä»»ä½•å…¶ä»–å£°æ˜ã€‚è™½ç„¶ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œ<code>!important</code> ä¸ä¼˜å…ˆçº§æ— å…³ï¼Œä½†å®ƒä¸æœ€ç»ˆçš„ç»“æœç›´æ¥ç›¸å…³ã€‚ä½¿ç”¨ <code>!important</code> æ˜¯ä¸€ä¸ª<strong>åä¹ æƒ¯</strong>ï¼Œåº”è¯¥å°½é‡é¿å…ï¼Œå› ä¸ºè¿™ç ´åäº†æ ·å¼è¡¨ä¸­çš„å›ºæœ‰çš„çº§è”è§„åˆ™ ä½¿å¾—è°ƒè¯•æ‰¾ bug å˜å¾—æ›´åŠ å›°éš¾äº†ã€‚å½“ä¸¤æ¡ç›¸äº’å†²çªçš„å¸¦æœ‰ <code>!important</code> è§„åˆ™çš„å£°æ˜è¢«åº”ç”¨åˆ°ç›¸åŒçš„å…ƒç´ ä¸Šæ—¶ï¼Œæ‹¥æœ‰æ›´å¤§ä¼˜å…ˆçº§çš„å£°æ˜å°†ä¼šè¢«é‡‡ç”¨ã€‚</p>
<p>ä¸€äº›ç»éªŒæ³•åˆ™ï¼š</p>
<blockquote>
<ul>
<li><strong>ä¸€å®š</strong>è¦ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æ ·å¼è§„åˆ™çš„ä¼˜å…ˆçº§æ¥è§£å†³é—®é¢˜è€Œä¸æ˜¯ <code>!important</code></li>
<li><strong>åªæœ‰</strong>åœ¨éœ€è¦è¦†ç›–å…¨ç«™æˆ–å¤–éƒ¨ CSS çš„ç‰¹å®šé¡µé¢ä¸­ä½¿ç”¨ <code>!important</code></li>
<li><strong>æ°¸è¿œä¸è¦</strong>åœ¨ä½ çš„æ’ä»¶ä¸­ä½¿ç”¨ <code>!important</code></li>
<li><strong>æ°¸è¿œä¸è¦</strong>åœ¨å…¨ç«™èŒƒå›´çš„ CSS ä»£ç ä¸­ä½¿ç”¨ <code>!important</code></li>
<li><strong>ä¸å…¶ä½¿ç”¨ <code>!important</code></strong>ï¼Œä½ å¯ä»¥ï¼š
<ol>
<li>æ›´å¥½åœ°åˆ©ç”¨ CSS çº§è”å±æ€§</li>
<li>ä½¿ç”¨æ›´å…·ä½“çš„è§„åˆ™ã€‚åœ¨æ‚¨é€‰æ‹©çš„å…ƒç´ ä¹‹å‰ï¼Œå¢åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å…ƒç´ ï¼Œä½¿é€‰æ‹©å™¨å˜å¾—æ›´åŠ å…·ä½“ï¼Œå¹¶è·å¾—æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</li>
<li>å¯¹äºï¼ˆ2ï¼‰çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå½“æ‚¨æ— å…¶ä»–è¦æŒ‡å®šçš„å†…å®¹æ—¶ï¼Œè¯·å¤åˆ¶ç®€å•çš„é€‰æ‹©å™¨ä»¥å¢åŠ ç‰¹å¼‚æ€§ã€‚</li>
</ol>
</li>
</ul>
</blockquote>
<p>ä»¥ä¸Šæ‘˜è‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Specificity">MDN</a>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | React Router è·¯ç”±åˆ‡æ¢åŸç†]]></title>
            <link>https://github.com/toFrankie/blog/issues/119</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/119</guid>
            <pubDate>Sat, 25 Feb 2023 13:09:32 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-acc03dd12a89d602.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2022 åŒ—äº¬å†¬å¥¥ä¼šå¼€å¹•å¼]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-acc03dd12a89d602.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2022 åŒ—äº¬å†¬å¥¥ä¼šå¼€å¹•å¼"></p>
<p>æ­¤å‰ä¸€ç›´åœ¨ç–‘æƒ‘ï¼Œæ˜æ˜ <code>pushState()</code>ã€<code>replaceState()</code> ä¸è§¦å‘ <code>popstate</code> äº‹ä»¶ï¼Œå¯ä¸ºä»€ä¹ˆ React Router è¿˜èƒ½æŒ‚è½½å¯¹åº”è·¯ç”±çš„ç»„ä»¶å‘¢ï¼Ÿ</p>
<p>ç¿»äº†ä¸€ä¸‹ <a href="https://github.com/remix-run/history">history.js</a> æºç ï¼Œç»ˆäºçŸ¥é“åŸå› äº†ã€‚</p>
<h2>æºç </h2>
<p>å‡è®¾é¡¹ç›®è·¯ç”±è®¾è®¡å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { render } from 'react-dom'
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import { Mine, About } from './routes'
import App from './App'

const rootElement = document.getElementById('root')

render(
  &lt;BrowserRouter&gt;
    &lt;Routes&gt;
      &lt;Route path=&quot;/&quot; exact element={&lt;App /&gt;} /&gt;
      &lt;Route path=&quot;/mine&quot; element={&lt;Mine /&gt;} /&gt;
      &lt;Route path=&quot;/about&quot; element={&lt;About /&gt;} /&gt;
    &lt;/Routes&gt;
  &lt;/BrowserRouter&gt;,
  rootElement
)
</code></pre>
<p>ç„¶åæˆ‘ä»¬çœ‹ä¸‹ <code>&lt;BrowserRouter /&gt;</code> çš„æºç ï¼ˆ<code>react-router-dom/modules/BrowserRouter.js</code>ï¼‰ï¼Œä»¥ä¸‹çœç•¥äº†ä¸€éƒ¨åˆ†æ— å…³ä»£ç ï¼š</p>
<pre><code class="language-jsx">import React from 'react'
import { Router } from 'react-router'
import { createBrowserHistory as createHistory } from 'history'

/**
 * The public API for a &lt;Router&gt; that uses HTML5 history.
 */
class BrowserRouter extends React.Component {
  // æ„å»º history å¯¹è±¡
  history = createHistory(this.props)

  render() {
    // å°† history å¯¹è±¡ç­‰ä¼ å…¥ &lt;Router /&gt; ç»„ä»¶
    return &lt;Router history={this.history} children={this.props.children} /&gt;
  }
}

// ...

export default BrowserRouter
</code></pre>
<p>æ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹ <code>&lt;Router /&gt;</code> ç»„ä»¶çš„æºç ï¼ˆ<code>react-router/modules/Router.js</code>ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import React from 'react'
import HistoryContext from './HistoryContext.js'
import RouterContext from './RouterContext.js'

/**
 * The public API for putting history on context.
 */
class Router extends React.Component {
  static computeRootMatch(pathname) {
    return { path: '/', url: '/', params: {}, isExact: pathname === '/' }
  }

  constructor(props) {
    super(props)

    this.state = {
      location: props.history.location
    }
    
    // å…³é”®ç‚¹ï¼š
    // å½“è§¦å‘ popstate äº‹ä»¶ã€
    // æˆ–ä¸»åŠ¨è°ƒç”¨ props.history.push()ã€props.history.replace() æ–¹æ³•æ—¶ï¼Œ
    // éƒ½ä¼šæ‰§è¡Œ history å¯¹è±¡çš„ listen æ–¹æ³•ï¼Œä½¿å¾—æ‰§è¡Œ setState å¼ºåˆ¶æ›´æ–°å½“å‰ç»„ä»¶
    this.unlisten = props.history.listen(location =&gt; {
      this.setState({ location })
    })
  }

  componentWillUnmount() {
    // ç»„ä»¶å¸è½½æ—¶ï¼Œè§£é™¤ç›‘å¬
    if (this.unlisten) this.unlisten()
  }

  render() {
    return (
      // ç”±äº React Context çš„ç‰¹æ€§ï¼Œæ‰€æœ‰æ¶ˆè´¹ RouterContext.Provider çš„ Custom ç»„ä»¶
      // åœ¨å…¶ value å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚
      // å½“å‰ &lt;Router /&gt; ç»„ä»¶å¹¶æ²¡æœ‰åšä»»ä½•é™åˆ¶é‡æ–°æ¸²æŸ“çš„å¤„ç†ï¼Œ
      // å› æ­¤æ¯æ¬¡ setState éƒ½ä¼šå¼•èµ· RouterContext.Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–ã€‚
      &lt;RouterContext.Provider
        value={{
          history: this.props.history,
          location: this.state.location,
          match: Router.computeRootMatch(this.state.location.pathname),
          staticContext: this.props.staticContext
        }}
      &gt;
        &lt;HistoryContext.Provider children={this.props.children || null} value={this.props.history} /&gt;
      &lt;/RouterContext.Provider&gt;
    )
  }
}

export default Router
</code></pre>
<h2>åŸå› å‰–æ</h2>
<blockquote>
<p>å¾€ä¸‹ä¹‹å‰ï¼Œå¦‚æœå¯¹ History API æˆ–è€… URL Fragment ä¸äº†è§£çš„ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/273">History å¯¹è±¡åŠäº‹ä»¶ç›‘å¬è¯¦è§£</a>ã€‚</p>
</blockquote>
<p><code>react-router-dom</code> å¼•ç”¨äº† <a href="https://github.com/remix-run/history">history.js</a> åº“ ï¼Œå®ƒä¸»è¦æä¾›äº†ä¸‰ç§æ–¹æ³•ï¼š<code>createBrowserHistory</code>ã€<code>createHashHistory</code>ã€<code>createMemoryHistory</code>ã€‚</p>
<p>å®ƒä»¬ç”¨äºæ„å»ºå¯¹åº”æ¨¡å¼çš„ <code>history</code> å¯¹è±¡ï¼ˆè¯·æ³¨æ„ï¼Œå®ƒæœ‰åˆ«äº <code>window.history</code> å¯¹è±¡ï¼‰ï¼Œè¯¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å¯åœ¨ Devtools ä¸­æ¸…æ™°åœ°çœ‹åˆ°ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œä¹Ÿå¯æŸ¥é˜…æ–‡æ¡£ã€‚è¿™ä¸ªå¤ªç®€å•äº†ï¼Œä½ ä»¬éƒ½æ‡‚ï¼Œä¸è¯´äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3dd30aefeec495b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æœ¬æ–‡è®¨è®ºçš„æ˜¯ History æ¨¡å¼ï¼Œå› è€Œå¯¹åº” <code>createBrowserHistory</code> æ–¹æ³•ã€‚</p>
<p>åœ¨æ„å»ºé¡¹ç›®è·¯ç”±æ—¶ï¼Œé€‰æ‹© <code>&lt;BrowserRouter /&gt;</code> ç»„ä»¶ï¼Œå®ƒå†…éƒ¨æ˜¯å°†é€šè¿‡ <code>createBrowserHistory()</code> æ–¹æ³•æ„é€ çš„ <code>history</code> å¯¹è±¡ä¼ é€’ç»™ <code>&lt;Router /&gt;</code> ç»„ä»¶ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ React åº”ç”¨ä¸­åˆ‡æ¢è·¯ç”±ï¼Œå®ƒä¼šåŠ è½½å¯¹åº”çš„ç»„ä»¶ã€‚æˆ‘ä»¬çŸ¥é“ <code>createBrowserHistory()</code> åˆ©ç”¨äº† HTML5 History API ç‰¹æ€§ï¼Œä½†æ˜¯ä¸»åŠ¨è°ƒç”¨ <code>window.history.pushState()</code> å’Œ <code>window.history.replaceState()</code> æ–¹æ³•éƒ½ä¸ä¼šè§¦å‘ <code>popstate</code> äº‹ä»¶ï¼Œå› æ­¤ï¼Œå¦‚æœä»…é€šè¿‡ç›‘å¬ <code>popstate</code> äº‹ä»¶æ˜¯ä¸èƒ½å®Œå…¨å®ç°è·¯ç”±åˆ‡æ¢çš„ã€‚</p>
<p><strong>é‚£ä¹ˆ React Router æ˜¯å¦‚ä½•è§£å†³é—®é¢˜çš„å‘¢ï¼Ÿ</strong></p>
<p>åœ¨å‰é¢çš„æºç éƒ¨åˆ†ï¼Œå…¶å®å·²ç»æ·»åŠ äº†ä¸€äº›æ³¨è§£ï¼Œ<code>&lt;Router /&gt;</code> ç»„ä»¶å®ƒå†…éƒ¨ä¾èµ–äº Context çš„ Provider/Comsumer æ¨¡å¼ã€‚å› æ­¤ï¼Œå®ƒåªè¦åšåˆ° URL å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–° <code>Context.Provider</code> çš„ <code>value</code> å€¼å³å¯ï¼Œè‡³äºåç»­å¦‚ä½•åŠ è½½ç»„ä»¶å°±äº¤ç»™ React äº†ï¼ˆå½“ç„¶é‡Œé¢è¿˜åŒ…æ‹¬ React Router çš„è·¯ç”±åŒ¹é…ï¼Œä½†éæœ¬æ–‡è®¨è®ºå†…å®¹ï¼Œä¸å±•å¼€è®²è¿°ï¼‰ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>&lt;BrowserRouter /&gt;</code> éƒ½ä¼šä½œä¸ºæ•´ä¸ªé¡¹ç›®çš„æ ¹è·¯ç”±ï¼Œå®ƒåŒ…è£¹äº†ä¸€å±‚ <code>&lt;Router /&gt;</code> ç»„ä»¶ï¼Œ<code>&lt;Router /&gt;</code> ç»„ä»¶åœ¨å®ä¾‹åŒ–æ—¶ï¼Œè®¾ç½®äº†ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼š</p>
<pre><code class="language-js">// props.history å°±æ˜¯é€šè¿‡ createBrowserHistory(props) ç”Ÿæˆçš„å¯¹è±¡
this.unlisten = props.history.listen(location =&gt; {
  // å›è°ƒå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œé€šè¿‡ setState è§¦å‘ Router ç»„ä»¶æ›´æ–°ï¼Œ
  // ä½¿å¾— Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–ï¼Œä»¥å¸¦åŠ¨ Consumer çš„æ›´æ–°ã€‚
  this.setState({ location })
})
// this.unlisten æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå®ƒå†…éƒ¨ä¼šç§»é™¤ popstate äº‹ä»¶ç›‘å¬å™¨
</code></pre>
<p><strong>Qï¼šhistory.js æ˜¯å¦‚ä½•åšåˆ°æ¯å½“ URL å‘ç”Ÿå˜åŒ–ï¼Œä¼šè§¦å‘è¿™ä¸ªå›è°ƒå‡½æ•°çš„ï¼Ÿ</strong></p>
<p>åœ¨ React ä¸­æ˜¯é€šè¿‡è°ƒç”¨ç»„ä»¶çš„ <code>props.history.push()</code> å’Œ <code>props.history.replace()</code> æ–¹æ³•å®ç°è·¯ç”±åˆ‡æ¢çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <a href="https://github.com/remix-run/history">history.js</a> çš„æºç ï¼ˆ<code>history/esm/history.js</code>ï¼‰ï¼š</p>
<blockquote>
<p>é‡Œé¢çœç•¥äº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œç„¶ååˆ†æé¡ºåºå·²ç»æŒ‰é¡ºåºæ ‡æ³¨å‡ºæ¥ã€‚</p>
</blockquote>
<pre><code class="language-js">function createTransitionManager() {
  // ...

  function confirmTransitionTo(location, action, getUserConfirmation, callback) {
    var result = typeof prompt === 'function' ? prompt(location, action) : prompt

    if (typeof result === 'string') {
      if (typeof getUserConfirmation === 'function') {
        getUserConfirmation(result, callback)
      } else {
        process.env.NODE_ENV !== 'production' ? warning(false, 'A history needs a getUserConfirmation function in order to use a prompt message') : void 0
        callback(true)
      }
    } else {
      // Return false from a transition hook to cancel the transition.
      callback(result !== false)
    }
  }

  var listeners = []

  function appendListener(fn) {
    var isActive = true

    function listener() {
      if (isActive) fn.apply(void 0, arguments)
    }

    // æ·»åŠ ç›‘å¬å™¨
    listeners.push(listener)
    return function () {
      isActive = false
      // è¿‡æ»¤é‡å¤çš„ç›‘å¬å™¨
      listeners = listeners.filter(function (item) {
        return item !== listener
      })
    }
  }

  // 6ï¸âƒ£ æ‰§è¡Œ listeners ä¸­æ‰€æœ‰çš„ listener ç›‘å¬å™¨ï¼Œ
  // æœ€åè§¦å‘ &lt;Router /&gt; ä¸­çš„å›è°ƒå‡½æ•° this.unlisten = props.history.listen(location =&gt; { this.setState({ location }) }) é€»è¾‘
  function notifyListeners() {
    // å°†ç±»æ•°ç»„ arguments è½¬æ¢ä¸ºæ•°ç»„å½¢å¼
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key &lt; _len; _key++) {
      args[_key] = arguments[_key]
    }

    listeners.forEach(function (listener) {
      // å›è°ƒå‡½æ•°å°†è·å¾— locationã€action ä¸¤ä¸ªå‚æ•°
      return listener.apply(void 0, args)
    })
  }

  return {
    setPrompt: setPrompt,
    confirmTransitionTo: confirmTransitionTo,
    appendListener: appendListener,
    notifyListeners: notifyListeners
  }
}

/**
 * Creates a history object that uses the HTML5 history API including
 * pushState, replaceState, and the popstate event.
 */
function createBrowserHistory(props) {
  // ...

  // åˆ›å»º location å¯¹è±¡
  function getDOMLocation(historyState) {
    var _ref = historyState || {},
      key = _ref.key,
      state = _ref.state

    var _window$location = window.location,
      pathname = _window$location.pathname,
      search = _window$location.search,
      hash = _window$location.hash
    var path = pathname + search + hash

    if (basename) path = stripBasename(path, basename)
    return createLocation(path, state, key)
  }

  // ...

  // åˆ›å»º transitionManager å¯¹è±¡
  var transitionManager = createTransitionManager()

  // 5ï¸âƒ£ ä¸»è¦æ›´æ–° history å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ notifyListeners æ–¹æ³•
  function setState(nextState) {
    _extends(history, nextState)

    history.length = globalHistory.length
    // æ‰§è¡Œ transitionManager ä¸­çš„æ‰€æœ‰ listeners
    transitionManager.notifyListeners(history.location, history.action)
  }

  // 3ï¸âƒ£ popstate äº‹ä»¶ç›‘å¬å™¨çš„å¤„ç†å‡½æ•°
  function handlePopState(event) {
    // getDOMLocation æ–¹æ³•ç”¨äºç”Ÿæˆ location å¯¹è±¡ï¼Œlocation: { hash, pathname, search, state }
    // handlePop æ–¹æ³•ï¼Œä¸»è¦æ˜¯ç”¨äºè§¦å‘ setState æ–¹æ³•
    handlePop(getDOMLocation(event.state))
  }

  // 4ï¸âƒ£ ç”¨äºè°ƒç”¨ setState æ–¹æ³•
  function handlePop(location) {
    var action = 'POP'
    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
      if (ok) {
        setState({
          action: action,
          location: location
        })
      }
    })
  }

  // 7ï¸âƒ£
  // è¿™é‡Œçš„ push å’Œ replace æ–¹æ³•ï¼Œæ˜¯åˆ©ç”¨äº† window.history.pushState() å’Œ window.history.replaceState()
  // ä»–ä»¬ä¸ä¼šè§¦å‘ popstate äº‹ä»¶ï¼Œå› æ­¤æ— æ³•æ‰§è¡Œ handlePopState æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸»åŠ¨æ‰§è¡Œ setState() æ–¹æ³•ï¼Œè¿›è€Œ
  // æ‰§è¡Œ notifyListeners() ä»¥ä½¿å¾— &lt;Router /&gt; ç»„ä»¶çš„å›è°ƒè¢«æ‰§è¡Œï¼Œä½¿å¾—ç»„ä»¶è¿›è¡Œæ›´æ–°ã€‚
  function push(path, state) {
    // ...
    var action = 'PUSH'
    var location = createLocation(path, state, createKey(), history.location)
    // å°†ä¼šæ‰§è¡Œ confirmTransitionTo çš„ callback å‡½æ•°
    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
      if (!ok) return
      var href = createHref(location)
      var key = location.key,
        state = location.state

      if (canUseHistory) {
        globalHistory.pushState(
          {
            key: key,
            state: state
          },
          null,
          href
        )

        if (forceRefresh) {
          window.location.href = href
        } else {
          var prevIndex = allKeys.indexOf(history.location.key)
          var nextKeys = allKeys.slice(0, prevIndex + 1)
          nextKeys.push(location.key)
          allKeys = nextKeys
          // è°ƒç”¨ setState() æ–¹æ³•ï¼Œç„¶åé‡Œé¢ä¼šæ‰§è¡Œ notifyListeners æ–¹æ³•ï¼Œå¹¶è§¦å‘ listeners çš„æ‰€æœ‰ç›‘å¬å™¨
          setState({
            action: action,
            location: location
          })
        }
      } else {
        window.location.href = href
      }
    })
  }

  function replace(path, state) {
    // ä¸ push æ–¹æ³•åŒç†ï¼Œçœç•¥...
  }

  // 8ï¸âƒ£
  // è¿™é‡Œçš„ go()ã€goBack()ã€goForward() å…¨æ˜¯åˆ©ç”¨äº† History API çš„èƒ½åŠ›ï¼Œ
  // ä»–ä»¬éƒ½ä¼šè§¦å‘ popstate äº‹ä»¶ï¼Œå› æ­¤éƒ½ä¼šæ‰§è¡Œ handlePopState æ–¹æ³•ã€‚
  function go(n) {
    globalHistory.go(n)
  }

  function goBack() {
    go(-1)
  }

  function goForward() {
    go(1)
  }

  var listenerCount = 0

  // 2ï¸âƒ£ æ³¨å†Œ/ç§»é™¤ popstate äº‹ä»¶ç›‘å¬å™¨
  function checkDOMListeners(delta) {
    listenerCount += delta

    if (listenerCount === 1 &amp;&amp; delta === 1) {
      // æ·»åŠ  popstate äº‹ä»¶ç›‘å¬å™¨ï¼Œæ‰§è¡Œ handlePopState æ—¶å°†ä¼šè§¦å‘ setState
      window.addEventListener(PopStateEvent, handlePopState)
      if (needsHashChangeListener) window.addEventListener(HashChangeEvent, handleHashChange)
    } else if (listenerCount === 0) {
      // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
      window.removeEventListener(PopStateEvent, handlePopState)
      if (needsHashChangeListener) window.removeEventListener(HashChangeEvent, handleHashChange)
    }
  }

  // 1ï¸âƒ£ è®¾ç½®ç›‘å¬å™¨ï¼Œä»¥è§¦å‘ &lt;Router /&gt; ç»„ä»¶ä¸­çš„å›è°ƒå‡½æ•°
  function listen(listener) {
    // å¾€ transitionManager ä¸­çš„ listeners æ•°ç»„æ·»åŠ æ–°çš„ç›‘å¬å™¨ listenerï¼Œ
    // å…¶ä¸­ transitionManager å¯¹è±¡æœ‰è¿™äº›æ–¹æ³•ï¼š{ setPrompt, confirmTransitionTo, appendListener, notifyListeners }
    var unlisten = transitionManager.appendListener(listener)

    // è´Ÿè´£æ·»åŠ ã€ç§»é™¤ popstate äº‹ä»¶ç›‘å¬å™¨
    checkDOMListeners(1)

    // æ‰§è¡Œå›è°ƒå‡½æ•°ç§»é™¤ listener ç›‘å¬å™¨
    return function () {
      checkDOMListeners(-1)
      unlisten()
    }
  }

  var history = {
    length: globalHistory.length,
    action: 'POP',
    location: initialLocation,
    createHref: createHref,
    push: push,
    replace: replace,
    go: go,
    goBack: goBack,
    goForward: goForward,
    block: block,
    listen: listen
  }
  return history
}
</code></pre>
<p>ä»¥ä¸‹æ˜¯ history.js ä¸­åˆ›å»ºçš„ <code>history</code>ã€<code>location</code> å¯¹è±¡çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8b181f6fb08a4a2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…ˆå›åˆ° <code>&lt;Router /&gt;</code> ç»„ä»¶ä¸­çš„ <code>history.listen(fn)</code>ï¼Œå®ƒä¸»è¦åšå‡ ä»¶äº‹ï¼š</p>
<blockquote>
<ul>
<li>å°† <code>fn</code> ä¿å­˜åœ¨è´Ÿè´£å­˜å‚¨ç›‘å¬å™¨çš„ <code>listeners</code> æ•°ç»„ä¸­ï¼Œæœªæ¥å®ƒå°†ä¼šè¢« <code>notifyListeners()</code> æ–¹æ³•è°ƒç”¨ã€‚</li>
<li>æ³¨å†Œ <code>popstate</code> äº‹ä»¶ç›‘å¬å™¨ï¼Œè§¦å‘ä¹‹åï¼Œä¼šæ‰§è¡Œ <code>notifyListeners()</code> æ–¹æ³•</li>
<li>åœ¨ React ç»„ä»¶ä¸­è°ƒç”¨ <code>props.history.push()</code> ç­‰æ–¹æ³•ï¼Œä¹Ÿå°†ä¼šè§¦å‘ <code>notifyListeners()</code> æ–¹æ³•ã€‚</li>
<li>æ‰§è¡Œ <code>notifyListeners()</code> æ–¹æ³•ï¼Œä¼šæ‰§è¡Œ <code>listeners</code> ä¸­æ‰€æœ‰çš„ <code>listener</code>ï¼Œå› æ­¤ <code>fn</code> å°†ä¼šè¢«è§¦å‘ã€‚</li>
<li>æ‰§è¡Œ <code>fn()</code> è§¦å‘ Component ä¸­çš„ <code>setState()</code> æ–¹æ³•æ›´æ–° <code>&lt;Router /&gt;</code> ç»„ä»¶ï¼Œå³ <code>Router.Provider</code> çš„ <code>value</code> å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆ <code>Router.Consumer</code> å°±ä¼šè·Ÿç€æ›´æ–°</li>
</ul>
</blockquote>
<p>æ‰€ä»¥ï¼ŒReact Router æ˜¯åˆ©ç”¨äº† Context çš„ Provider/Custom ç‰¹æ€§ï¼Œè§£å†³äº† pushState/replaceState ä¸è§¦å‘ <code>popstate</code> äº‹ä»¶æ—¶å®ç°äº†è·¯ç”±åˆ‡æ¢çš„é—®é¢˜ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | Refs]]></title>
            <link>https://github.com/toFrankie/blog/issues/118</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/118</guid>
            <pubDate>Sat, 25 Feb 2023 13:08:29 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7e7f9b89ca22872b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7e7f9b89ca22872b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ç»å…¸çš„ React æ•°æ®æµä¸­ï¼Œ<code>props</code> æ˜¯çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶äº¤äº’çš„å”¯ä¸€æ–¹å¼ï¼Œè€Œä¸” <code>props</code> æ˜¯è‡ªä¸Šè€Œä¸‹ï¼ˆç”±çˆ¶åŠå­ï¼‰è¿›è¡Œä¼ é€’çš„ã€‚åæ¥ï¼Œç”±äºä¸€äº›å…¨å±€æ€§çš„å±æ€§éœ€è¦åœ¨å„ä¸ªç»„ä»¶ä¸­å…±äº«ï¼Œä½†é‰´äº <code>props</code> éœ€é€å±‚æ‰‹åŠ¨æ·»åŠ æå…¶ç¹çï¼Œäºæ˜¯ React æä¾›äº†ä¸€ç§å…¨æ–°çš„æ–¹å¼ Contextï¼Œå®ƒæ— éœ€åœ¨ç»„ä»¶æ ‘ä¸­é€å±‚ä¼ é€’ <code>props</code>ï¼Œå±äº Provider/Consumer æ¨¡å¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦åœ¨å…¸å‹æ•°æ®æµä¹‹å¤–å¼ºåˆ¶ä¿®æ”¹å­ç»„ä»¶ã€‚è¢«ä¿®æ”¹çš„å­ç»„ä»¶å¯èƒ½æ˜¯ä¸€ä¸ª React ç»„ä»¶çš„å®ä¾‹ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª DOM å…ƒç´ ã€‚ä¸ºæ­¤ React æä¾›äº† Refsã€‚</p>
<p>ä»¥ä¸‹åœºæ™¯é€‚åˆä½¿ç”¨ Refsï¼š</p>
<ul>
<li>ç®¡ç†ç„¦ç‚¹ï¼Œæ–‡æœ¬é€‰æ‹©æˆ–åª’ä½“æ’­æ”¾</li>
<li>è§¦å‘å¼ºåˆ¶åŠ¨ç”»</li>
<li>é›†æˆç¬¬ä¸‰æ–¹ DOM åº“</li>
</ul>
<p>æˆ‘æƒ³ï¼ŒRefs æœ€å¸¸ç”¨çš„åœºæ™¯åº”è¯¥æ˜¯è·å–æŸä¸ªçœŸå® DOM å…ƒç´ æˆ–è€… React ç»„ä»¶å®ä¾‹å§ã€‚å…¶å®ä¸æ­¢äºæ­¤ï¼Œè¿˜å¯ä»¥ç”¨äºç»„ä»¶é€šä¿¡ç­‰é«˜é˜¶ä¸€ç‚¹çš„ç”¨æ³•ã€‚</p>
<h2>ä¸€ã€Refs åŸºç¡€</h2>
<h4>1. Ref åˆ›å»ºä¸è®¿é—®</h4>
<p>ä»¥ä¸‹æ–¹å¼å¯ä»¥åˆ›å»º Ref å¯¹è±¡ï¼š</p>
<ul>
<li><code>React.useRef()</code>ï¼šé€‚ç”¨äºå‡½æ•°ç»„ä»¶</li>
<li><code>React.createRef()</code>ï¼šé€‚ç”¨äºç±»ç»„ä»¶</li>
<li><code>å›è°ƒ Ref</code>ï¼šå¯ç”¨äºå‡½æ•°ç»„ä»¶æˆ–ç±»ç»„ä»¶</li>
<li><code>å­—ç¬¦ä¸² Ref</code>ï¼šå·²è¿‡æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨...</li>
</ul>
<p>ä¼˜å…ˆé€‰æ‹©å‰ä¸¤ç§ï¼Œè‹¥ React ç‰ˆæœ¬è¾ƒä½å†è€ƒè™‘åé¢çš„ä¸¤ç§æ–¹å¼ã€‚</p>
<p><strong>React.useRef()</strong></p>
<blockquote>
<p>é€‚ç”¨äº React 16.8 + å‡½æ•°ç»„ä»¶</p>
</blockquote>
<p><code>React.useRef(initialValue)</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Ref å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ª <code>current</code> å±æ€§ã€‚å…¶ä¸­ <code>initialValue</code> å‚æ•°ç”¨äºæŒ‡å®š <code>current</code> çš„åˆå§‹å€¼ã€‚å½“å‚æ•°ç¼ºçœæ—¶ <code>current</code> ä¸º <code>undefined</code>ã€‚</p>
<pre><code class="language-jsx">import React from 'react'

function Parent() {
  const domRef = React.useRef()
  const classRef = React.useRef()
  const funcRef = React.useRef()

  useEffect(() =&gt; {
    console.log(domRef.current) // æŒ‡å‘ div èŠ‚ç‚¹
    console.log(classRef.current) // æŒ‡å‘ Child1 ç»„ä»¶å®ä¾‹
    console.log(funcRef.current) // undefined
  }, [])

  return (
    &lt;&gt;
      &lt;div ref={domRef}&gt;è¿™æ˜¯DOMèŠ‚ç‚¹&lt;/div&gt;
      &lt;Child1 ref={classRef}&gt;è¿™æ˜¯ç±»ç»„ä»¶&lt;/Child1&gt;
      &lt;Child2 ref={funcRef}&gt;è¿™æ˜¯å‡½æ•°ç»„ä»¶&lt;/Child2&gt;
    &lt;/&gt;
  )
}
</code></pre>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°ç»„ä»¶æ¯ä¸€æ¬¡æ›´æ–°æ˜¯é€šè¿‡é‡æ–°è°ƒç”¨å‡½æ•°å®ç°çš„ï¼Œæ„å‘³ç€é‡Œé¢çš„å˜é‡ä¼šé‡æ–°åˆ›å»ºï¼Œé‚£ä¹ˆä½¿ç”¨ Hook æ‰èƒ½ä¿ç•™ä¸Šä¸€æ¬¡çš„å¼•ç”¨ã€‚å› æ­¤ï¼Œè¯·ä¸è¦åœ¨å‡½æ•°ç»„ä»¶å†…ä½¿ç”¨ <code>React.createRef()</code>ã€‚</p>
<p>è¿˜æœ‰ï¼Œ<strong>è‹¥åœ¨å‡½æ•°ç»„ä»¶ä¸Šè®¾ç½® <code>ref</code> å±æ€§ï¼Œç”±äºå‡½æ•°ç»„ä»¶æ˜¯æ²¡æœ‰å®ä¾‹çš„ï¼Œå› æ­¤ç±»ä¼¼ <code>&lt;Child2 ref={funcRef} /&gt;</code> è®¾ç½® <code>ref</code> å±æ€§æ˜¯æ— æ•ˆçš„ã€‚å½“ä½ åœ¨ä»»æ„åœ°æ–¹è®¿é—® <code>funcRef.current</code> çš„æ—¶å€™åªä¼šå¾—åˆ°åˆå§‹å€¼</strong>ã€‚</p>
<p>åœ¨ç±»ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶å†…ï¼Œæ— è®º Ref å¯¹è±¡æ˜¯é€šè¿‡å“ªä¸€ç§æ–¹å¼åˆ›å»ºçš„ï¼Œåªè¦ç»™å­å‡½æ•°ç»„ä»¶è®¾ç½® Refsï¼Œå¼€å‘æ¨¡å¼ä¸‹éƒ½ä¼šå‘å‡ºå¦‚ä¸‹è­¦å‘Šï¼š</p>
<blockquote>
<p>Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?</p>
</blockquote>
<p>å…³äº <code>React.forwardRef()</code> ä¸‹æ–‡ä¼šä»‹ç»çš„ã€‚</p>
<p><strong>React.createRef()</strong></p>
<blockquote>
<p>é€‚ç”¨äº React 16.3 + ç±»ç»„ä»¶ã€‚ç”±äºå‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶ï¼Œæ­¤æ–¹æ³•ä¸é€‚åˆç”¨äºå‡½æ•°ç»„ä»¶ã€‚è‹¥ä½äº React 16.3 ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨å›è°ƒ Refã€‚</p>
</blockquote>
<p><code>React.createRef()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Ref å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ª <code>current</code> å±æ€§ï¼Œåˆå§‹å€¼ä¸º <code>null</code>ã€‚å°†æ¥ <code>current</code> å±æ€§ä¼šæŒ‡å‘ Ref å¯¹è±¡æ‰€ç»‘å®šçš„ DOM èŠ‚ç‚¹æˆ– Reactï¼ˆç±»ï¼‰ç»„ä»¶ã€‚ç»‘å®šæ–¹å¼å¾ˆç®€å•ï¼Œåªè¦å°† Ref å¯¹è±¡æ·»åŠ åˆ° <code>ref</code> å±æ€§ä¸Šå³å¯ã€‚</p>
<pre><code class="language-jsx">import React from 'react'

class Parent extends React.Component {
  domRef = React.createRef()
  classRef = React.createRef()
  funcRef = React.createRef()

  componentDidMount() {
    console.log(this.domRef.current) // æŒ‡å‘ div èŠ‚ç‚¹
    console.log(this.classRef.current) // æŒ‡å‘ Child1 ç»„ä»¶å®ä¾‹
    console.log(this.funcRef.current) // null
  }

  render = () =&gt; (
    &lt;&gt;
      &lt;div ref={this.domRef}&gt;è¿™æ˜¯DOMèŠ‚ç‚¹&lt;/div&gt;
      &lt;Child1 ref={this.classRef}&gt;è¿™æ˜¯ç±»ç»„ä»¶&lt;/Child1&gt;
      &lt;Child2 ref={this.funcRef}&gt;è¿™æ˜¯å‡½æ•°ç»„ä»¶&lt;/Child2&gt;
    &lt;/&gt;
  )
}
</code></pre>
<p>ä»ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ° Ref å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®å¾ˆç®€å•ã€‚</p>
<p><strong>å›è°ƒ Ref</strong></p>
<blockquote>
<p>é€‚ç”¨äº React 16.2 åŠä»¥ä¸‹ç‰ˆæœ¬</p>
</blockquote>
<p>è¿™ç§æ–¹å¼å¯ä»¥æ›´ç²¾ç»†åœ°æ§åˆ¶ä½•æ—¶è®¾ç½®å’Œè§£é™¤ Refsã€‚</p>
<p>å®ƒçš„åˆ›å»ºæ–¹å¼ä¸åŒäº <code>React.createRef()</code> å’Œ <code>React.useRef()</code>ï¼Œä½ éœ€è¦åœ¨ DOM èŠ‚ç‚¹æˆ– Reactï¼ˆç±»ï¼‰ç»„ä»¶ä¸­ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å— React ç»„ä»¶å®ä¾‹æˆ– DOM èŠ‚ç‚¹ä½œä¸ºå‚æ•°ï¼Œä½¿å¾—å®ƒä»¬èƒ½åœ¨å…¶ä»–åœ°æ–¹è¢«å­˜å‚¨å’Œè®¿é—®ã€‚</p>
<pre><code class="language-jsx">import React from 'react'

class Parent extends React.Component {
  componentDidMount() {
    console.log(this.domRef) // æŒ‡å‘ div èŠ‚ç‚¹
    console.log(this.classRef) // æŒ‡å‘ Child1 ç»„ä»¶å®ä¾‹
    console.log(this.funcRef) // undefined
  }

  setCallbackRef(instKey) {
    return ref =&gt; {
      // å°†å‡½æ•°èµ‹äºˆ ref å±æ€§æ—¶ï¼Œå¯¹åº”çš„ DOM èŠ‚ç‚¹ã€ç±»ç»„ä»¶å®ä¾‹ä½œä¸ºå‡½æ•°å‚æ•°è¿”å›ã€‚
      // ä½œç”¨äºå‡½æ•°ç»„ä»¶ï¼Œå°†ä¸ç¬¦åˆä»»ä½•å‚æ•°ï¼Œå³ ref ä¸º undefinedã€‚
      this[instKey] = ref
    }
  }

  render = () =&gt; (
    &lt;&gt;
      &lt;div ref={this.setCallbackRef('domRef')}&gt;è¿™æ˜¯DOMèŠ‚ç‚¹&lt;/div&gt;
      &lt;Child1 ref={this.setCallbackRef('classRef')}&gt;è¿™æ˜¯ç±»ç»„ä»¶&lt;/Child1&gt;
      &lt;Child2 ref={this.setCallbackRef('funcRef')}&gt;è¿™æ˜¯å‡½æ•°ç»„ä»¶&lt;/Child2&gt;
    &lt;/&gt;
  )
}
</code></pre>
<p><strong>å­—ç¬¦ä¸² Ref</strong></p>
<blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªè¿‡æ—¶çš„ Refï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚å®ƒå­˜åœ¨<a href="https://github.com/facebook/react/pull/8333#issuecomment-271648615">ä¸€äº›é—®é¢˜</a>ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚</p>
</blockquote>
<p>åˆ›å»ºå­—ç¬¦ä¸² Ref éå¸¸ç®€å•ï¼Œåœ¨ DOM èŠ‚ç‚¹æˆ– Reactï¼ˆç±»ï¼‰ç»„ä»¶çš„ ref å±æ€§è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å³å¯ï¼Œå®ƒä»¬å°†ä¼šç»‘å®šåˆ°å½“å‰ç»„ä»¶å®ä¾‹çš„ <code>refs</code> å¯¹è±¡ä¸‹ï¼Œ<code>ref</code> å±æ€§çš„åç§°å°†ä½œä¸º <code>refs</code> å¯¹è±¡çš„é”®åã€‚</p>
<pre><code class="language-jsx">import React from 'react'

class Parent extends React.Component {
  componentDidMount() {
    // æ‰€æœ‰å­—ç¬¦ä¸² Ref å°†ä¼šè¢«æ·»åŠ åˆ°ç»„ä»¶å®ä¾‹çš„ refs å¯¹è±¡ä¸Šã€‚
    console.log(this.refs.domRef) // æŒ‡å‘ div èŠ‚ç‚¹
    console.log(this.refs.classRef) // æŒ‡å‘ Child1 ç»„ä»¶å®ä¾‹
    console.log(this.refs.funcRef) // undefined
  }

  render = () =&gt; (
    &lt;&gt;
      &lt;div ref=&quot;domRef&quot;&gt;è¿™æ˜¯DOMèŠ‚ç‚¹&lt;/div&gt;
      &lt;Child1 ref=&quot;classRef&quot;&gt;è¿™æ˜¯ç±»ç»„ä»¶&lt;/Child1&gt;
      &lt;Child2 ref=&quot;funcRef&quot;&gt;è¿™æ˜¯å‡½æ•°ç»„ä»¶&lt;/Child2&gt;
    &lt;/&gt;
  )
}
</code></pre>
<h4>2. ç»‘å®šä¸è§£é™¤ Ref</h4>
<p>React 16.4 åŠæ›´é«˜ç‰ˆæœ¬çš„<a href="https://www.jianshu.com/p/24e80dabd581">ç”Ÿå‘½å‘¨æœŸ</a>å¦‚ä¸‹ï¼Œè‹¥ä¸äº†è§£ï¼Œå…ˆç®€å•çœ‹çœ‹ï¼Œä»¥ä¾¿äºåç»­ç†è§£ã€‚</p>
<p>ä¸€ä¸ª React ç»„ä»¶å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº† Mountingï¼ˆæŒ‚è½½ï¼‰ã€Updatingï¼ˆæ›´æ–°ï¼‰ã€Unmountingï¼ˆå¸è½½ï¼‰ä¸‰ä¸ªé˜¶æ®µã€‚æ¯ä¸€é˜¶æ®µåˆå¯ä»¥å†ç»†åˆ†ä¸º Renderã€Pre-commitã€Commit é˜¶æ®µã€‚ä¾‹å¦‚ <code>constructor()</code> åªå­˜åœ¨äº Mounting çš„ Render é˜¶æ®µï¼›Unmounting åªå« Commit é˜¶æ®µã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-febf779021fe49b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>æ³¨æ„ï¼ŒReact 16.3 å¯¹äº <a href="https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromprops">getÂ­DerivedÂ­StateÂ­FromÂ­Props</a> æ–¹æ³•ç¨æœ‰ä¸åŒï¼Œä½†ä¸å½±å“æœ¬æ–‡è®¨è®ºçš„å†…å®¹ã€‚</p>
</blockquote>
<p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯ï¼Œåœ¨æ„é€ ç»„ä»¶ï¼ˆå³ <code>constructor()</code> æ–¹æ³•å†…ï¼‰æ—¶ï¼Œå°†åˆ›å»ºçš„ Ref å¯¹è±¡æŒ‚è½½åˆ°å®ä¾‹å±æ€§ï¼Œä»¥ä¾¿å¯ä»¥åœ¨æ•´ä¸ªç»„ä»¶ä¸­å¼•ç”¨å®ƒä»¬ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-jsx">class Comp extends React.Component {
  constructor(props) {
    this.xxxRef = React.createRef()
  }
  
  // æˆ–è€…
  // xxxRef = React.createRef()
}
</code></pre>
<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼Œéƒ½å°† <code>xxxRef</code> æŒ‚è½½åˆ° <code>Comp</code> å®ä¾‹ä¸Šï¼Œåœ¨ç»„ä»¶çš„ä»»æ„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å†…éƒ½èƒ½è®¿é—®ã€‚</p>
<p>å¥½äº†ï¼Œå‰é¢æåˆ°è°ƒç”¨ <code>React.createRef()</code> æ–¹æ³•è¿”å› Ref å¯¹è±¡çš„å€¼ä¸º <code>{ current: null }</code>ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šå°† React ç»„ä»¶å®ä¾‹æˆ– DOM èŠ‚ç‚¹ç»‘å®šåˆ° Ref å¯¹è±¡çš„ <code>current</code> å±æ€§ä¸Šå‘¢ï¼Ÿ</p>
<blockquote>
<ul>
<li>åœ¨ç»„ä»¶æŒ‚è½½çš„ Render é˜¶æ®µç»‘å®š Refs</li>
<li>åœ¨ç»„ä»¶å¸è½½çš„ Commit é˜¶æ®µè§£é™¤ Refs</li>
</ul>
<p>ä¾‹å¦‚ <code>React.createRef()</code>ï¼Œåœ¨ç»„ä»¶æŒ‚è½½æ—¶å°†ç»„ä»¶å®ä¾‹æˆ– DOM èŠ‚ç‚¹å…³è”åˆ° <code>xxxRef.current</code> ä¸Šã€‚å½“ç»„ä»¶å¸è½½æ—¶ï¼Œ<code>xxxRef.current</code> åˆä¼šä¼ å…¥ <code>null</code>ï¼Œå®ç°è§£é™¤ç›®çš„ã€‚</p>
<p>è‡³äºå°† Ref å¯¹è±¡å­˜æ”¾åœ¨å“ªï¼Œæ˜¯ä½ çš„è‡ªç”±ï¼Œä½†é€šå¸¸ä¼šæŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹ä¸Šï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚</p>
</blockquote>
<h4>3. createRef ä¸ useRef</h4>
<p>å‰é¢æåˆ° <code>React.createRef()</code> ä¸è¦åœ¨å‡½æ•°ç»„ä»¶å†…ä½¿ç”¨ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-jsx">import React from 'react'

function Comp() {
  const domRef = React.createRef()
  const [num, setNum] = useState(0)

  const focus = () =&gt; domRef.current.focus()
  const update = () =&gt; setNum(num + 1)

  return (
    &lt;&gt;
      &lt;input ref={domRef} /&gt;
      &lt;button onClick={focus}&gt;èšç„¦&lt;/button&gt;
      &lt;button onClick={update}&gt;ç‚¹å‡»è§¦å‘æ›´æ–° {num}&lt;/button&gt;
    &lt;/&gt;
  )
}
</code></pre>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°ç»„ä»¶ <code>Comp</code> ä¸­ä½¿ç”¨ <code>React.createRef()</code> åˆ›å»ºäº†ä¸€ä¸ª Ref å¯¹è±¡ <code>domRef</code>ï¼Œå…¶å…³è”äº† <code>input</code> èŠ‚ç‚¹ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªèšç„¦æŒ‰é’®ï¼Œç‚¹å‡»æ—¶èšç„¦ input è¾“å…¥æ¡†ã€‚è€Œæœ€åä¸€ä¸ªæ›´æ–°æŒ‰é’®ç”¨äºè§¦å‘ç»„ä»¶æ›´æ–°ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°ç»„ä»¶æ¯ä¸€æ¬¡æ›´æ–°æ˜¯é€šè¿‡é‡æ–°è°ƒç”¨å‡½æ•°å®ç°çš„ï¼Œæ„å‘³ç€é‡Œé¢çš„å˜é‡ä¼šé‡æ–°åˆ›å»ºã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸€æ¬¡ Comp å‡½æ•°è¢«è°ƒç”¨ï¼ŒdomRef éƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„å˜é‡ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œâ€œä¼¼ä¹â€åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ <code>React.createRef()</code> ä¹Ÿæ²¡é—®é¢˜ï¼Œå¯¹å—ï¼Ÿè™½ç„¶ <code>domRef</code> æ¯æ¬¡å‡½æ•°æ‰§è¡Œéƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œä½†ä¹Ÿä¼šå…³è”åˆ° <code>input</code> èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ç‚¹å‡»èšç„¦æŒ‰é’®è§¦å‘ <code>domRef.current.focus()</code> ä¹Ÿæ²¡é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬æ¥æ”¹é€ ä¸€ä¸‹ä¸Šé¢çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">import React from 'react'

function Comp() {
  const domRef = createRef()
  const [num, setNum] = useState(0)

  useEffect(() =&gt; {
    setNum(1) // è§¦å‘ä¸€ä¸ªæ›´æ–°
    setTimeout(() =&gt; {
      domRef.current.focus() // è¿™é‡Œèƒ½æ­£å¸¸èšç„¦å—ï¼Ÿ
    }, 3000)
  }, [])

  return &lt;input ref={domRef} /&gt;
}
</code></pre>
<p><strong>ä»¥ä¸Šç¤ºä¾‹ï¼Œå°†ä¼šæŠ¥é”™ï¼</strong></p>
<p>åŸå› ä¹Ÿå¾ˆç®€å•ã€‚å‰é¢è¯´äº†ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½ä¼šé‡æ–°æ‰§è¡Œ <code>Comp()</code> å‡½æ•°ã€‚ç®€å•åˆ†æä¸€ä¸‹ï¼š</p>
<p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åŠ è½½ <code>Comp</code> ç»„ä»¶æ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>domRef</code> å˜é‡ï¼ˆå‡è®¾ç§°ä¸º <code>domRef1</code>ï¼‰ï¼Œå½“ <code>Comp</code> æ¸²æŸ“å®Œæ¯•ä¼šæ‰§è¡Œå‰¯ä½œç”¨æ“ä½œ <code>useEffect</code> çš„å›è°ƒå‡½æ•°ï¼Œé‡Œé¢çš„ <code>setNum(1)</code> å°†ä¼šè§¦å‘ä¸€æ¬¡æ›´æ–°ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡ä¸­å­˜åœ¨å¯¹ <code>domRef1</code> çš„å¼•ç”¨ã€‚</p>
<p>ç„¶ååœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰ï¼ŒRef å¯¹è±¡ä¼šè¢«è§£é™¤ï¼Œå¹¶ä¼ å…¥ <code>null</code>ï¼Œå³ <code>domRef1 = { current: null }</code>ã€‚</p>
<p>ç„¶åæ‰§è¡Œ <code>Comp()</code> å‡½æ•°é‡æ–°æ¸²æŸ“ï¼Œåˆä¼šåˆ›å»ºä¸€ä¸ª <code>domRef</code> å˜é‡ï¼ˆå‡è®¾ç§°ä¸º <code>domRef2</code>ï¼‰ã€‚æ˜¾ç„¶ <code>domRef2</code> å’Œ <code>domRef1</code> ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚ç„¶å 3 ç§’è¿‡å»äº†ï¼Œå®šæ—¶å™¨è¢«è§¦å‘ <code>domRef.current.focus()</code>ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ <code>domRef</code> æ˜¯ <code>domRef1</code> è¿˜æ˜¯ <code>domRef2</code> å‘¢ï¼Ÿ</p>
<p>å¦‚æœå¯¹é—­åŒ…ä¸ç†Ÿæ‚‰çš„è¯ï¼Œæˆ‘ä»¬æ‰“ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-52362ff0cf9cb1db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ˜¾ç„¶å®šæ—¶ä»»åŠ¡å†…çš„ <code>domRef</code> æ˜¯ <code>domRef1</code>ï¼Œå³ä¸Šä¸€æ¬¡çš„ <code>domRef</code> å˜é‡ï¼Œç”±äº <code>domRef.currect</code> ä¸º <code>null</code>ï¼Œè‡ªç„¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<blockquote>
<p>è¯´äº†é‚£ä¹ˆå¤šåªæ˜¯ä¸ºäº†å¼ºè°ƒï¼š<strong>å‡½æ•°ç»„ä»¶å†…è¯·ä¸è¦ä½¿ç”¨ <code>React.createRef()</code></strong> ã€‚</p>
</blockquote>
<blockquote>
<p>è‡³äºä¸ºä»€ä¹ˆä»å¼•ç”¨ç€ <code>domRef1</code>ï¼ŒåŸå› è‡ªç„¶æ˜¯é—­åŒ…ã€‚</p>
<p>**é—­åŒ…æ˜¯åŸºäºè¯æ³•ä½œç”¨åŸŸä¹¦å†™ä»£ç æ—¶æ‰€äº§ç”Ÿçš„è‡ªç„¶ç»“æœã€‚**å˜é‡çš„ä½œç”¨åŸŸä¸å‡½æ•°å¦‚ä½•æ‰§è¡Œæ²¡å…³ç³»ï¼Œè·Ÿå¦‚ä½•åˆ›å»ºæœ‰å…³ç³»ã€‚è¿™å°±æ˜¯é—­åŒ…å½¢æˆçš„åŸå› ï¼ˆä¸‹é¢ä¸¾ä¸ªä¾‹å­ç®€å•è¯´ä¸‹ï¼Œè‹¥å·²ç†è§£é—­åŒ…ç›´æ¥è·³è¿‡ï¼Œæœ‰å…´è¶£è€…çœ‹ï¼‰ã€‚</p>
</blockquote>
<pre><code class="language-js">var a = 'global'

function foo() {
  var a = 'local'
  function bar() {
    console.log(a) // æ— è®º bar ä½•æ—¶ä½•åœ°è°ƒç”¨ï¼Œæ€»ä¼šæ‰“å° local
    // æ³¨æ„ï¼Œè¯æ³•ä½œç”¨åŸŸä¸ this æ˜¯ä¸¤å›äº‹ï¼Œåˆ«æ··æ·†äº†ã€‚
  }
}

// å½“æ‰§è¡Œå‡½æ•° foo() ï¼Œä¼šåˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¯çœ‹ä½œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº† { AO, Scope, this } ä¸‰ä¸ªå±æ€§ï¼‰ï¼š
// 
// * AO ï¼šå®ƒä¼šè®°ä½å½“å‰å‡½æ•°å†…å£°æ˜çš„å˜é‡ï¼ˆå«å½¢å‚ï¼‰ã€å‡½æ•°ã€ arguments ï¼ˆéç®­å¤´å‡½æ•°ï¼‰ç­‰ã€‚
// * Scope ï¼šå®ƒæ˜¯åŸºäºå½“å‰å‡½æ•° foo çš„ [[scope]] å±æ€§ + å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ AO å¯¹è±¡ç»„æˆçš„ï¼Œè¿™ä¸ªå°±æ˜¯å¸¸è¯´çš„ä½œç”¨åŸŸé“¾ã€‚
// * this ï¼šå®ƒè·Ÿå‡½æ•°å¦‚ä½•è°ƒç”¨æœ‰å…³ï¼ˆä½†è·Ÿé—­åŒ…æ²¡å…³ç³»ï¼Œä¸å±•å¼€è®²è¿°ï¼‰
// 
// æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå°±æ˜¯å‡½æ•°è¢«å®šä¹‰æ—¶ï¼Œå…¶å†…éƒ¨å±æ€§ [[scope]] å°±ä¼šè®°å½•å½“å‰çš„ Scope ã€‚æ¯”å¦‚å½“ bar() è¢«è°ƒç”¨ï¼Œè¦æŸ¥æ‰¾å˜é‡ a ï¼Œå®ƒå…ˆä» bar æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ Scope æŸ¥æ‰¾ï¼Œå‘ç°å½“å‰ AO å¯¹è±¡æ²¡æœ‰ï¼Œäºæ˜¯å¾€ä¸Šä¸€å±‚ Scope ä¸­æŸ¥æ‰¾å¹¶æˆåŠŸæ‰¾åˆ°å˜é‡ a ï¼Œå€¼ä¸º local ï¼Œå°±åœæ­¢æŸ¥æ‰¾äº†ã€‚
// 
// å›åˆ°è¿™ä¸ª Comp ä¾‹å­ï¼Œå®ƒæœ¬èº«åªæ˜¯ä¸€ä¸ªå‡½æ•°è€Œå·²ã€‚æ¯å½“æ‰§è¡Œä¸€æ¬¡ Comp() å‡½æ•°ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œ AO ä¼šè®°å½•å˜é‡ domRef ï¼ˆå½“ç„¶ num ã€ setNum å®ƒä¹Ÿä¼šè®°å½•çš„ï¼‰ï¼Œ
// ...
// ç”±äºè¯æ³•ä½œç”¨åŸŸä¸å‡½æ•°å¦‚ä½•è°ƒç”¨æ²¡å…³ç³»ï¼Œæ‰€ä»¥ä½ ä¸ç”¨ç®¡ useEffect ã€ useEffect å†…éƒ¨çš„å‡½æ•°ã€åŠå…¶å›è°ƒå‡½æ•°æ˜¯å¦‚ä½•è°ƒç”¨çš„ã€‚ä½ åªè¦æ¸…æ¥šå†…éƒ¨å„ç§å‡½æ•°æ²¡æœ‰å®šä¹‰ä¸€ä¸ªåä¸º domRef çš„å˜é‡å³å¯ã€‚
// ...
// ç„¶åæ‰§è¡Œåˆ° setTimeout è¿™è¡Œä»£ç ï¼Œä¼šåœ¨ useEffect å›è°ƒå‡½æ•°å†…åˆ›å»ºä¸€ä¸ªåŒ¿åçš„ç®­å¤´å‡½æ•°ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰åŠæ³•å¼•ç”¨å®ƒï¼Œä½† AO ä¹Ÿä¼šè®°ä½çš„ã€‚ç”±äº Comp ä¹‹åçš„æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­éƒ½æ²¡æœ‰ domRef å˜é‡ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰§è¡ŒåŒ¿åç®­å¤´å‡½æ•°ï¼Œå¯»æ‰¾å˜é‡ domRef æ—¶ï¼Œæ€»ä¼šå¾€ä½œç”¨åŸŸé“¾ä¸Šæ‰¾åˆ° Comp.[[scope]] ï¼Œå¹¶ä»å…¶ AO å¯¹è±¡ä¸Šæ‰¾åˆ°äº† domRef å˜é‡ï¼Œå€¼ä¸º { current: null } ã€‚
</code></pre>
<p>å°±å‰é¢ <code>Comp</code> çš„ç¤ºä¾‹ï¼Œä½¿ç”¨å›è°ƒ Ref æˆ–å­—ç¬¦ä¸² Ref çš„æ–¹å¼ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼ŒåŸå› åŒç†ã€‚å”¯æœ‰ä½¿ç”¨ <code>React.useRef()</code> è§£å†³ï¼Œæˆ‘å°±ä¸å†™ Demo äº†ï¼Œä½ ä»¬éƒ½æ‡‚ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ React.useRef() èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p>
<p>åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå½“ç¬¬ä¸€æ¬¡åŠ è½½å‡½æ•°ç»„ä»¶æ—¶ï¼Œæ‰§è¡Œ <code>React.useRef()</code> ç”Ÿæˆä¸€ä¸ª Ref å¯¹è±¡ï¼ŒReact ä¼šå°†å…¶åœ¨æŸä¸ªç¥ç§˜çš„è§’è½è®°å½•èµ·æ¥ï¼Œåé¢ç»„ä»¶æ›´æ–°å†ä»å°é»‘å±‹é‡Œå°†åŸå…ˆçš„ Ref å¯¹è±¡å–å‡ºæ¥ï¼ˆä¸‹æ–‡å†è¯¦è§£ï¼‰ã€‚</p>
<h2>äºŒã€Refs è¿›é˜¶</h2>
<p>æ˜¯çš„ï¼Œå‰é¢éƒ½æ˜¯ Refs çš„åŸºç¡€ç”¨æ³•ï¼Œä¹Ÿæ˜¯å¿…é¡»è¦æŒæ¡çš„å†…å®¹ã€‚</p>
<p>é‚£ä¹ˆè¿›é˜¶ Refs æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸»è¦æ˜¯åˆ©ç”¨ <code>React.forwardRef()</code> API å¯¹ Ref å¯¹è±¡è¿›è¡Œè½¬å‘ï¼Œå®ƒæ˜¯ React 16.3 æ–°å¢çš„ç‰¹æ€§ï¼Œç§°ä¸ºâ€œRefs è½¬å‘â€ã€‚</p>
<ul>
<li><a href="https://react.docschina.org/docs/forwarding-refs.html#forwarding-refs-to-dom-components">è½¬å‘ Refs åˆ° DOM ç»„ä»¶</a></li>
<li><a href="https://react.docschina.org/docs/forwarding-refs.html#forwarding-refs-in-higher-order-components">åœ¨é«˜é˜¶ç»„ä»¶ä¸­è½¬å‘ Refs</a></li>
</ul>
<h4>1. è½¬å‘ Refs åˆ° DOM èŠ‚ç‚¹</h4>
<p>å‰é¢ä»‹ç»çš„ Refs éƒ½æœ‰äº›ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ— æ³•åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨ <code>ref</code> å±æ€§ã€‚</li>
<li>åœ¨ç±»ç»„ä»¶ä¸Šä½¿ç”¨ <code>ref</code> å±æ€§ï¼Œåªä¼šå¾—åˆ°ç»„ä»¶å®ä¾‹ã€‚</li>
</ul>
<p>åœ¨ä»¥å‰ï¼Œå¦‚æœçˆ¶ç»„ä»¶çš„ Ref å¯¹è±¡è¦ä¼ é€’ç»™å­ç»„ä»¶çš„æŸä¸ª DOM èŠ‚ç‚¹æˆ–è€…æ›´ä¸‹å±‚ï¼Œå”¯ä¸€æ–¹æ³•åªæœ‰å˜é€šåœ°ä½¿ç”¨ç‰¹æ®Šçš„å±æ€§åæ¥ä¼ é€’ Ref å¯¹è±¡ã€‚è‡ª React 16.3 èµ·ï¼Œå¯ä»¥ä½¿ç”¨ <code>React.forwardRef()</code> æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-jsx">import React from 'react'

class Parent extends React.Component {
  parentRef1 = React.createRef()
  parentRef2 = React.createRef()

  componentDidMount() {
    // ä»¥ä¸‹è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è·å–åˆ°å­ç»„ä»¶çš„ input èŠ‚ç‚¹
    console.log(this.parentRef1.current)
    console.log(this.parentRef2.current)
  }

  render = () =&gt; (
    &lt;&gt;
      &lt;div&gt;è¿™æ˜¯çˆ¶ç»„ä»¶&lt;/div&gt;

      {/* åŸå§‹æ–¹æ³•ï¼šä½¿ç”¨ç‰¹æ®Šçš„å±æ€§åæ¥ä¼ é€’ */}
      &lt;Child forwardRef={this.parentRef1}&gt;è¿™æ˜¯å­ç»„ä»¶&lt;/Child&gt;

      {/* ForwardRef æ–¹æ³•ï¼šå¯ä»¥å°† Ref å¯¹è±¡ç›´æ¥ä¼ å…¥ ref å±æ€§ï¼Œå¯ä»¥æ˜¯ç±»ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶  */}
      &lt;NewChild ref={this.parentRef2}&gt;è¿™æ˜¯å­ç»„ä»¶&lt;/NewChild&gt;
    &lt;/&gt;
  )
}

function Child(props) {
  return (
    &lt;&gt;
      &lt;div&gt;{props.children}&lt;/div&gt;
      &lt;input ref={props.forwardRef} placeholder=&quot;å­ç»„ä»¶çš„input&quot; /&gt;
    &lt;/&gt;
  )
}


// ç¬¬äºŒä¸ªå‚æ•° ref åªåœ¨ä½¿ç”¨ React.forwardRef å®šä¹‰ç»„ä»¶æ—¶å­˜åœ¨ï¼Œå‡½æ•°ç»„ä»¶æˆ–ç±»ç»„ä»¶ä¸æ¥æ”¶ ref å‚æ•°ã€‚
const NewChild = React.forwardRef((props, ref) =&gt; (
  &lt;Child {...props} forwardRef={ref} /&gt;
))
</code></pre>
<p><strong>è¯´çœŸçš„ï¼Œè¿™ç§è½¬å‘ Refs ä¸ªäººæ„Ÿè§‰å¾ˆé¸¡è‚‹ï¼Œæ˜¯æˆ‘æ²¡ Get åˆ°å—ï¼Ÿ</strong></p>
<h4>2. é«˜é˜¶ç»„ä»¶è½¬å‘ Refs</h4>
<blockquote>
<p>é«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>é«˜é˜¶ç»„ä»¶å®šä¹‰å¦‚ä¸Šï¼Œå‡è®¾æˆ‘ä»¬ä¸å¯¹ Refs è¿›è¡Œè½¬å‘ï¼Œå½“æˆ‘ä»¬ç»™é«˜é˜¶ç»„ä»¶åŒ…è£…åçš„æ–°ç»„ä»¶æ·»åŠ  <code>ref</code> å±æ€§ï¼Œæ˜¾ç„¶è¿™ä¸ª Ref å¯¹è±¡å°†ä¼šæŒ‡å‘é«˜é˜¶ç»„ä»¶è¿”å›çš„æ–°ç»„ä»¶çš„å®ä¾‹ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼ŒRefs è½¬å‘å°±æ˜¾å¾—å¾ˆé‡è¦äº†ã€‚</p>
<pre><code class="language-jsx">import React from 'react'

class Parent extends React.Component {
  parentRef = React.createRef()

  componentDidMount() {
    // å°†ä¼šè·å–åˆ° Child ç»„ä»¶
    console.log(this.parentRef.current)
  }

  render = () =&gt; (
    &lt;&gt;
      &lt;div&gt;è¿™æ˜¯çˆ¶ç»„ä»¶&lt;/div&gt;
      &lt;NewChild ref={this.parentRef}&gt;è¿™æ˜¯å­ç»„ä»¶&lt;/NewChild&gt;
    &lt;/&gt;
  )
}

class Child extends React.Component {
  render = () =&gt; (
    &lt;&gt;
      &lt;div&gt;{this.props.children}&lt;/div&gt;
      &lt;input ref={this.props.forwardRef} placeholder=&quot;å­ç»„ä»¶çš„input&quot; /&gt;
    &lt;/&gt;
  )
}

function HOCWrapper(Comp) {
  // è¿™é‡Œçš„é«˜é˜¶ç»„ä»¶å•¥ä¹Ÿæ²¡åšï¼Œå°±å•çº¯åšäº†ä¸ªè½¬å‘ç½¢äº†
  // ä¸ºäº†ä¸¾ä¾‹è€Œä¸¾ä¾‹...
  class WrapperComponent extends React.Component {
    render() {
      const { forwardRef, ...others } = this.props
      return &lt;Comp {...others} ref={forwardRef} /&gt;
    }
  }

  // å¦‚æœè¿™é‡Œä¸åšè½¬å‘ï¼Œå°†æ¥å¯¹ Comp ä½œç”¨çš„ Ref å¯¹è±¡ï¼Œå°†æŒ‡å‘ WrapperComponent ç»„ä»¶å®ä¾‹
  return React.forwardRef((props, ref) =&gt; &lt;WrapperComponent {...props} forwardRef={ref} /&gt;)
}

const NewChild = HOCWrapper(Child)
</code></pre>
<h2>ä¸‰ã€æ·±å…¥ Refs</h2>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | Fragment]]></title>
            <link>https://github.com/toFrankie/blog/issues/117</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/117</guid>
            <pubDate>Sat, 25 Feb 2023 13:07:22 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8848e6bc743d2819.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8848e6bc743d2819.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>React ä¸­çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼æ˜¯ä¸€ä¸ªç»„ä»¶è¿”å›å¤šä¸ªå…ƒç´ ã€‚Fragments å…è®¸ä½ å°†å­åˆ—è¡¨åˆ†ç»„ï¼Œè€Œæ— éœ€å‘ DOM æ·»åŠ é¢å¤–èŠ‚ç‚¹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨ React ç»„ä»¶æ¸²æŸ“ä»¥ä¸‹è¿™æ®µçœŸå® DOM èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-html">Some text.
&lt;h2&gt;A heading&lt;/h2&gt;
More text.
&lt;h2&gt;Another heading&lt;/h2&gt;
Even more text.
</code></pre>
<p>è¦æ€ä¹ˆåšå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œè°éƒ½çŸ¥é“...</p>
<p>React.Fragment æ˜¯åœ¨ React 16.2 æ–°å¢çš„æ–°ç‰¹æ€§ï¼Œæ—§ç‰ˆæœ¬å¹¶ä¸æ”¯æŒã€‚ä¸‹é¢æˆ‘ä»¬ä»å‡ ä¸ªæ–¹é¢ï¼Œè¯´æ˜ Fragment çš„å¥½å¤„ã€‚</p>
<h2>ä¸€ã€React 16.0 ä¹‹å‰</h2>
<p>åœ¨ä½äº React 16.0 çš„ç‰ˆæœ¬ï¼Œç±»ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶æœ‰å¾ˆå¤šé™åˆ¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œå®ƒä»¬å¿…é¡»è¿”å› <strong>React å…ƒç´ </strong>æˆ– <code>null</code>ã€‚å…¶ä¸­ React å…ƒç´ åŒ…æ‹¬ç±»ä¼¼ <code>&lt;MyComponent /&gt;</code> ç­‰è‡ªå®šä¹‰ç»„ä»¶ã€ç±»ä¼¼ <code>&lt;div /&gt;</code> ç­‰ DOM èŠ‚ç‚¹å…ƒç´ ã€‚</p>
<p>æ­£ç¡®ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  // âœ… åˆæ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»– HTML å…ƒç´ 
  return &lt;div&gt;...&lt;/div&gt;
}

function MyComponent() {
  // âœ… åˆæ³•ï¼Œè¿”å› React ç»„ä»¶
  return &lt;ChildComponent /&gt;
}

function MyComponent() {
  // âœ… åˆæ³•ï¼Œä¸æ¸²æŸ“ä»»ä½•çœŸå® DOM èŠ‚ç‚¹
  return null
}
</code></pre>
<p>é”™è¯¯ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  // âŒ ä¸èƒ½è¿”å›æ•°ç»„
  return [1, 2, 3].map((item, index) =&gt; (
    &lt;div key={index}&gt;{item}&lt;/div&gt;
  ))

  // âœ… ä½†æ³¨æ„ï¼Œä¸‹é¢è¿™ç§åŒ…è£¹åœ¨ {} å†…æ˜¯åˆæ³•çš„ï¼Œ
  // map æ–¹æ³•è¿”å›çš„æ•°ç»„ï¼Œç›®æµ‹æ˜¯é™¤äº†å­å…ƒç´ æ—¶ï¼Œåšäº†æ‰å¹³åŒ–å¤„ç†ã€‚
  // return (
  //   &lt;div&gt;
  //     {[1, 2, 3].map((item, index) =&gt; (
  //       &lt;div key={index}&gt;{item}&lt;/div&gt;
  //     ))}
  //   &lt;/div&gt;
  // )
}

function MyComponent() {
  // âŒ ä¸€å®šè¦æœ‰è¿”å›å€¼ï¼Œè·Ÿ return null æ˜¯ä¸¤å›äº‹
  return undefined
}
</code></pre>
<p>ç±»ç»„ä»¶åŒç†ã€‚å½“ä¸æ­£ç¡®ä½¿ç”¨æ—¶ï¼Œå°†ä¼šæŠ¥é”™ï¼š</p>
<blockquote>
<p>Warning: MyComponent(...): A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object.</p>
</blockquote>
<p>è¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œåœ¨ç»„ä»¶çš„è¿”å›å€¼ä¸Šï¼Œæ€»éœ€è¦ä¸€å±‚ <div>ã€<span> æˆ–å…¶ä»– DOM èŠ‚ç‚¹åŒ…è£…èµ·æ¥ã€‚å½“ React æ¸²æŸ“æˆçœŸå® DOM æ—¶ï¼Œè¿™ä¸ªåŒ…è£…èŠ‚ç‚¹æ€»æ˜¯ä¼šå­˜åœ¨çš„ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™ï¼Œå¾€å¾€è¿™ä¸ªåŒ…è£…èŠ‚ç‚¹å¯¹æˆ‘ä»¬çš„ UI å±‚æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåè€ŒåŠ æ·±äº† DOM æ ‘çš„å±‚æ¬¡ã€‚ä½†å¾ˆæ— å¥ˆï¼Œè°è®©æˆ‘ä»¬è¦ç”¨ React å‘¢ï¼Œäººå®¶è¯­æ³•é™åˆ¶å°±é‚£æ ·...</p>
<h2>äºŒã€React 16.0 èµ·</h2>
<p>é™¤äº†åŸæ¥çš„ React å…ƒç´ å’Œ <code>null</code> ä¹‹å¤–ï¼Œæ–°å¢äº†å‡ ç§ç±»å‹ï¼š</p>
<ul>
<li>React 16.0 èµ·æ”¯æŒè¿”å›<strong>æ•°ç»„</strong>ã€<strong><a href="https://zh-hans.reactjs.org/docs/portals.html">Protals</a></strong>ã€<strong>å­—ç¬¦ä¸²</strong>ã€<strong>æ•°å€¼</strong>ã€<strong>å¸ƒå°”å€¼</strong>ã€‚</li>
<li>React 16.2 èµ·æ”¯æŒè¿”å› <strong><a href="https://zh-hans.reactjs.org/docs/fragments.html">Fragment</a></strong>ï¼Œä¸ªäººè®¤ä¸ºè¿™æ˜¯å¯¹æ•°ç»„å½¢å¼çš„ä¸€ç§å¢å¼ºç”¨æ³•ã€‚</li>
</ul>
<blockquote>
<p>å…¶ä¸­<strong>å¸ƒå°”å€¼</strong>å’Œ <strong><code>null</code></strong> ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ï¼Œ<strong>å­—ç¬¦ä¸²æˆ–æ•°å€¼</strong>ç±»å‹ä¼šæ¸²æŸ“ä¸º<strong>æ–‡æœ¬èŠ‚ç‚¹</strong>ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  // âœ… åˆæ³•ï¼Œæ”¯æŒæ•°ç»„äº†ï¼Œéœ€è¦æ·»åŠ  key å±æ€§å»é¿å…è­¦å‘Šï¼Œ
  // è¿™ç§æƒ…å†µä¸‹ï¼Œåº•å±‚ä¼šé»˜è®¤åµŒå¥—ä¸€ä¸ª &lt;Fragment&gt; åŒ…è£¹èµ·æ¥ã€‚
  return [1, 2, 3].map((item, index) =&gt; (
    &lt;div key={index}&gt;{item}&lt;/div&gt;
  ))

  // æˆ–è€…æ˜¯
  // return [
  //   &lt;div key=&quot;1&quot;&gt;1&lt;/div&gt;,
  //   &lt;div key=&quot;2&quot;&gt;2&lt;/div&gt;,
  //   &lt;div key=&quot;3&quot;&gt;3&lt;/div&gt;
  // ]
}

function MyComponent() {
  // âœ… åˆæ³•ï¼Œè‡ª React 16.2 èµ·æ”¯æŒ Fragment è¯­æ³•ï¼Œä¸ç”¨åƒä¸Šé¢ä¸€æ ·éœ€è¦ key äº†
  return (
    &lt;React.Fragment&gt;
      &lt;div&gt;1&lt;/div&gt;
      &lt;div&gt;2&lt;/div&gt;
      &lt;div&gt;3&lt;/div&gt;
    &lt;/React.Fragment&gt;
  )
}

function MyComponent() {
  // âœ… åˆæ³•ï¼Œæœ€ç»ˆä¼šæ¸²æŸ“ä¸ºæ–‡æœ¬èŠ‚ç‚¹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯ &lt;span&gt;some string...&lt;/span&gt; å“¦ï¼‰
  return 'some string...'
}
</code></pre>
<p>ç›¸æ¯” React 15.x åŠæ›´æ—©ç‰ˆæœ¬ï¼Œè¿™ç§æ–¹å¼å®åœ¨æ˜¯å¤ªæ£’äº†ã€‚é™¤äº†æ”¯æŒæ›´å¤šç±»å‹ï¼Œæœ€é‡è¦çš„æ˜¯ä¸ä¼šå¢åŠ é¢å¤–çš„èŠ‚ç‚¹ã€‚</p>
<p>å‰é¢æåˆ°ï¼ŒReact 15.x é‡Œçš„ React ç»„ä»¶æ€»æ˜¯é¿å…ä¸äº†éœ€è¦ä¸€å±‚å¯èƒ½æ˜¯â€œæ— è°“â€çš„èŠ‚ç‚¹èŠ‚ç‚¹è¿›è¡ŒåŒ…è£…ï¼Œé‚£ä¹ˆ React 16.0 çš„æ”¹è¿›ï¼Œå¯ä»¥è§£å†³å¦‚ä¸‹åœºæ™¯ï¼š</p>
<p>é—®é¢˜ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">function Table() {
  return (
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;Columns /&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  )
}

function Columns() {
  // æŒ‰ç…§ React 15.x çš„è¯­æ³•è¦æ±‚ï¼ŒColumns ç»„ä»¶çš„è¿”å›å€¼ï¼Œ
  // å¿…é¡»è¦ç”¨ä¸€ä¸ªç±»ä¼¼ div å…ƒç´ ç­‰åŒ…è£…èµ·æ¥
  return (
    &lt;div&gt;
      &lt;td&gt;Hello&lt;/td&gt;
      &lt;td&gt;World&lt;/td&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p>æ ¹æ® W3C çš„è¦æ±‚ï¼Œä¸€ä¸ªåˆæ³•çš„ <code>&lt;table&gt;</code>ï¼Œ<code>&lt;tr&gt;</code> çš„å­å…ƒç´ å¿…é¡»æ˜¯ <code>&lt;td&gt;</code>ã€‚è€Œ React è¿™ç§ç»„ä»¶çš„å†™æ³•ç›´æ¥ç ´åäº† <code>&lt;table&gt;</code> ç»“æ„ï¼Œæœ€ç»ˆä¹Ÿå¾—ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸç»“æœã€‚</p>
<blockquote>
<p>ä¸€ä¸ªåˆæ³•çš„ <table> ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œ<code>table &gt; thead/tbody/tfoot &gt; tr &gt; td &gt; div/other</code>ã€‚</p>
</blockquote>
<p>å¦‚æœæŒ‰ç…§ React 16.x æä¾›çš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥è½»æ¾è§£å†³...</p>
<pre><code class="language-jsx">function Columns() {
  // React.Fragment æœ€ç»ˆæ¸²æŸ“ä¸ºçœŸå® DOM å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½• DOM èŠ‚ç‚¹ï¼Œ
  // å› æ­¤ï¼Œä¸ä¼šç ´å &lt;table&gt; çš„ç»“æ„äº†ã€‚ï¼ˆæ•°ç»„å½¢å¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰
  return (
    &lt;React.Fragment&gt;
      &lt;td&gt;Hello&lt;/td&gt;
      &lt;td&gt;World&lt;/td&gt;
    &lt;/React.Fragment&gt;
  )
}
</code></pre>
<h2>ä¸‰ã€Fragment</h2>
<p>è‡ª React 16.2 èµ·ï¼Œå¼€å§‹æ”¯æŒ React.Fragment è¯­æ³•ã€‚å‰é¢æåˆ°è¯¥ç‰¹æ€§æ˜¯å¯¹æ•°ç»„å½¢å¼çš„ä¸€ç§å¢å¼ºç”¨æ³•ã€‚</p>
<h4>è¯­æ³•</h4>
<p>å®ƒçš„è¯­æ³•éå¸¸ç®€å•ï¼ŒæŠŠå®ƒæ˜¯ React å†…ç½®çš„ä¸€ä¸ª React ç»„ä»¶ã€‚</p>
<pre><code class="language-jsx">&lt;React.Fragment&gt;
  // One or more child elements
&lt;/React.Fragment&gt;
</code></pre>
<p><code>key</code> æ˜¯å”¯ä¸€å¯ä»¥ä¼ é€’ç»™ Fragment çš„å±æ€§ã€‚å°†æ¥å¯èƒ½ä¼šæ·»åŠ å¯¹å…¶ä»–å±æ€§çš„æ”¯æŒï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p>
<pre><code class="language-jsx">class App extends React.Component {
  state = {
    items: [
      {
        id: '`2`',
        name: 'è®¡ç®—æœº',
        description: 'ç”¨æ¥è®¡ç®—çš„ä»ªå™¨...'
      },
      {
        id: '2',
        name: 'æ˜¾ç¤ºå™¨',
        description: 'ä»¥è§†è§‰æ–¹å¼æ˜¾ç¤ºä¿¡æ¯çš„è£…ç½®...'
      }
    ]
  }

  render() {
    return &lt;Glossary items={this.state.items} &gt;&lt;/Glossary&gt;
  }
}

function Glossary(props) {
  return (
    &lt;dl&gt;
      {props.items.map(item =&gt; (
        // æ²¡æœ‰ `key`ï¼ŒReact ä¼šå‘å‡ºä¸€ä¸ªå…³é”®è­¦å‘Š
        &lt;React.Fragment key={item.id}&gt;
          &lt;dt&gt;{item.name}&lt;/dt&gt;
          &lt;dd&gt;{item.description}&lt;/dd&gt;
        &lt;/React.Fragment&gt;
      ))}
    &lt;/dl&gt;
  )
}
</code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒçš„ç®€å†™è¯­æ³• <code>&lt;&gt;&lt;/&gt;</code>ï¼Œä½†è¿™ç§å†™æ³•ä¸æ¥å—ä»»æ„å±æ€§ï¼ŒåŒ…æ‹¬ <code>key</code>ã€‚</p>
<blockquote>
<p>JSX ä¸­çš„ç‰‡æ®µè¯­æ³•å—åˆ°ç°æœ‰æŠ€æœ¯çš„å¯å‘ï¼Œä¾‹å¦‚ <a href="https://developer.mozilla.org/en-US/docs/Archive/Web/E4X/E4X_for_templating">E4X</a> ä¸­çš„ <code>XMLList() &lt;&gt;&lt;/&gt;</code> æ„é€ å‡½æ•°ã€‚ä½¿ç”¨ä¸€å¯¹ç©ºæ ‡ç­¾æ˜¯ä¸ºäº†è¡¨ç¤ºå®ƒä¸ä¼šå‘ DOM æ·»åŠ å®é™…å…ƒç´ çš„æƒ³æ³•ã€‚</p>
</blockquote>
<h4>å¯¹æ¯”</h4>
<p>å›åˆ°æ–‡ç« å¼€å¤´çš„ç¤ºä¾‹ï¼Œè¦æ¸²æŸ“è¿™æ ·ä¸€æ®µçœŸå® DOM èŠ‚ç‚¹ã€‚</p>
<pre><code class="language-html">Some text.
&lt;h2&gt;A heading&lt;/h2&gt;
More text.
&lt;h2&gt;Another heading&lt;/h2&gt;
Even more text.
</code></pre>
<p>å‰é¢æåˆ°ï¼Œå¯ä»¥æœ‰å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œå„æœ‰åˆ©å¼Šã€‚</p>
<p><strong>è§£å†³æ–¹æ³•ä¸€</strong></p>
<p>ä½äº React 16.0 ç‰ˆæœ¬ï¼Œç”±äºä¸æ”¯æŒ Fragment å’Œæ•°ç»„å½¢å¼ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯å°†å®ƒä»¬åŒ…è£…åœ¨ä¸€ä¸ªé¢å¤–çš„å…ƒç´ ä¸­ï¼Œé€šå¸¸æ˜¯ <code>div</code> æˆ– <code>span</code>ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return (
    &lt;div&gt;
      Some text.
      &lt;h2&gt;A heading&lt;/h2&gt;
      More text.
      &lt;h2&gt;Another heading&lt;/h2&gt;
      Even more text.
    &lt;/div&gt;
  )
}
</code></pre>
<p>ä½†ä¸Šè¿°è¿™ç§æ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œåœ¨æ¸²æŸ“æˆçœŸå® DOM çš„æ—¶å€™ï¼Œä¼šå¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸Šè¿°çš„ <code>&lt;div /&gt;</code>ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•äºŒ</strong></p>
<p>è‡ª React 16.0 èµ·ï¼Œæ”¯æŒæ•°ç»„å½¢å¼ã€‚å› æ­¤å¯ä»¥è¿™ä¹ˆåšï¼š</p>
<pre><code class="language-jsx">function MyComponent() {
  return [
    'Some text.',
    &lt;h2 key=&quot;heading-1&quot;&gt;A heading&lt;/h2&gt;,
    'More text.',
    &lt;h2 key=&quot;heading-2&quot;&gt;Another heading&lt;/h2&gt;,
    'Even more text.'
  ]
}
</code></pre>
<p>è¿™ç§æ–¹å¼æœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ Fragment å½¢å¼ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•ä¸‰ï¼ˆæ¨èï¼‰</strong></p>
<p>è‡ª React 16.2 èµ·ï¼Œæ”¯æŒ React.Fragment è¯­æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚</p>
<pre><code class="language-jsx">function MyComponent() {
  return (
    &lt;React.Fragment&gt;
      Some text.
      &lt;h2&gt;A heading&lt;/h2&gt;
      More text.
      &lt;h2&gt;Another heading&lt;/h2&gt;
      Even more text.
    &lt;/React.Fragment&gt;
  )
}
</code></pre>
<p>ä»”ç»†å¯¹æ¯”æ•°ç»„å’Œ Fragment å½¢å¼ï¼Œå¯ä»¥å‘ç°æ•°ç»„å½¢å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ•°ç»„ä¸­çš„å­é¡¹å¿…é¡»ç”¨é€—å·åˆ†éš”ã€‚</li>
<li>æ•°ç»„ä¸­çš„ children å¿…é¡»æœ‰ä¸€ä¸ª key æ¥é˜²æ­¢ React çš„ key è­¦å‘Šã€‚</li>
<li>å­—ç¬¦ä¸²å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚</li>
</ul>
<p>ä»¥ä¸Šè¿™äº›é™åˆ¶ Fragment ç»Ÿç»Ÿéƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬å°±æŒ‰æ­£å¸¸çš„æ€ç»´å»ç¼–å†™ DOM èŠ‚ç‚¹å°±å¥½äº†ã€‚</p>
<h2>å››ã€References</h2>
<ul>
<li><a href="https://react.docschina.org/docs/fragments.html">Fragments</a></li>
<li><a href="https://reactjs.org/blog/2017/09/26/react-v16.0.html#new-render-return-types-fragments-and-strings">React v16.0</a></li>
<li><a href="https://reactjs.org/blog/2017/11/28/react-v16.2.0-fragment-support.html">React v16.2.0: Improved Support for Fragments</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | PureComponet]]></title>
            <link>https://github.com/toFrankie/blog/issues/116</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/116</guid>
            <pubDate>Sat, 25 Feb 2023 13:06:23 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ac9e67a8eaa1fe63.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ac9e67a8eaa1fe63.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©æ¥èŠä¸€èŠ <code>React.Component</code>ã€<code>React.PureComponent</code>ã€<code>React.memo</code> çš„ä¸€äº›åŒºåˆ«ä»¥åŠä½¿ç”¨åœºæ™¯ã€‚</p>
<h3>ä¸€ã€ç±»ç»„ä»¶å®šä¹‰</h3>
<p>åœ¨ React ä¸­ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿ <code>React.Component</code> æˆ– <code>React.PureComponent</code> æ¥å®šä¹‰ Class ç»„ä»¶ï¼š</p>
<pre><code class="language-jsx">import React, { Component, PureComponent } from 'react'

class Comp extends Component {
  // ...
}

class PureComp extends PureComponent {
  // ...
}
</code></pre>
<p>ä¸¤è€…å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äº <code>React.Component</code> å¹¶æœªå®ç° <code>shouldComponentUpdate()</code>ï¼Œè€Œ <code>React.PureComponent</code> ä¸­ä»¥æµ…å±‚å¯¹æ¯” <code>prop</code> å’Œ <code>state</code> çš„æ–¹å¼æ¥å®ç°äº†è¯¥å‡½æ•°ã€‚</p>
<p>å¦‚æœèµ‹äºˆ React ç»„ä»¶ç›¸åŒçš„ <code>props</code> å’Œ <code>state</code>ï¼Œ<code>render()</code> å‡½æ•°ä¼šæ¸²æŸ“ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆåœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ <code>React.PureComponent</code> å¯æé«˜æ€§èƒ½ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>React.PureComponent</code>Â ä¸­çš„Â <code>shouldComponentUpdate()</code>Â ä»…ä½œå¯¹è±¡çš„æµ…å±‚æ¯”è¾ƒã€‚å¦‚æœå¯¹è±¡ä¸­åŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåˆ™æœ‰å¯èƒ½å› ä¸ºæ— æ³•æ£€æŸ¥æ·±å±‚çš„å·®åˆ«ï¼Œäº§ç”Ÿé”™è¯¯çš„æ¯”å¯¹ç»“æœã€‚ä»…åœ¨ä½ çš„ <code>props</code> å’Œ <code>state</code> è¾ƒä¸ºç®€å•æ—¶ï¼Œæ‰ä½¿ç”¨Â <code>React.PureComponent</code>ï¼Œæˆ–è€…åœ¨æ·±å±‚æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨Â <a href="https://zh-hans.reactjs.org/docs/react-component.html#forceupdate"><code>forceUpdate()</code></a>Â æ¥ç¡®ä¿ç»„ä»¶è¢«æ­£ç¡®åœ°æ›´æ–°ã€‚ä½ ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨Â <a href="https://facebook.github.io/immutable-js/">immutable å¯¹è±¡</a>åŠ é€ŸåµŒå¥—æ•°æ®çš„æ¯”è¾ƒã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>React.PureComponent</code>Â ä¸­çš„Â <code>shouldComponentUpdate()</code>Â å°†è·³è¿‡æ‰€æœ‰å­ç»„ä»¶æ ‘çš„ <code>prop</code> æ›´æ–°ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å­ç»„ä»¶ä¹Ÿéƒ½æ˜¯â€œçº¯â€çš„ç»„ä»¶ã€‚</p>
</blockquote>
<h3>äºŒã€æµ…å±‚å¯¹æ¯”å®ç°</h3>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹æºç ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•â€œæµ…å±‚å¯¹æ¯”â€çš„ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œåœ¨éå¼ºåˆ¶æ›´æ–°ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œè‹¥ <code>props</code> å’Œ <code>state</code> çš„å˜æ›´ï¼Œå†…éƒ¨éƒ½ä¼šè§¦å‘ <code>checkShouldComponentUpdate</code> æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚è‹¥ä½¿ç”¨ <a href="https://zh-hans.reactjs.org/docs/react-component.html#forceupdate"><code>forceUpdate()</code></a> å¼ºåˆ¶æ›´æ–°ç»„ä»¶çš„è¯ï¼Œåˆ™ä¼šè·³è¿‡è¯¥æ–¹æ³•ã€‚</p>
<pre><code class="language-jsx">// checkHasForceUpdateAfterProcessing æ–¹æ³•ç”¨äºåˆ¤æ–­æ˜¯å¦å¼ºåˆ¶æ›´æ–°
// è‹¥ä¸æ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œåˆ™ä¼šæ ¹æ® checkShouldComponentUpdate æ–¹æ³•åˆ¤æ–­æ˜¯å¦åº”è¯¥æ›´æ–°ç»„ä»¶
var shouldUpdate = checkHasForceUpdateAfterProcessing() || checkShouldComponentUpdate(workInProgress, ctor, oldProps, newProps, oldState, newState, nextContext);
</code></pre>
<pre><code class="language-jsx">function checkShouldComponentUpdate(workInProgress, ctor, oldProps, newProps, oldState, newState, nextContext) {
  var instance = workInProgress.stateNode;

  // è‹¥è‡ªå®ç°äº† shouldComponentUpdate æ–¹æ³•ï¼Œåˆ™ä¸ä¼šè·‘åˆ°åé¢çš„æ­¥éª¤
  if (typeof instance.shouldComponentUpdate === 'function') {
    startPhaseTimer(workInProgress, 'shouldComponentUpdate');
    var shouldUpdate = instance.shouldComponentUpdate(newProps, newState, nextContext);
    stopPhaseTimer();

    {
      !(shouldUpdate !== undefined) ? warningWithoutStack$1(false, '%s.shouldComponentUpdate(): Returned undefined instead of a ' + 'boolean value. Make sure to return true or false.', getComponentName(ctor) || 'Component') : void 0;
    }

    return shouldUpdate;
  }

  // å…³é”®æ˜¯è¿™é‡Œï¼š
  // åœ¨ React ç»„ä»¶æœªå®ç° shouldComponentUpdate å‰æä¸‹ï¼Œ
  // å¯é€šè¿‡ isPureReactComponent åˆ¤æ–­æ˜¯å¦ä¸º PureComponent ç»„ä»¶çš„åŸå› æ˜¯æ„é€ å‡½æ•°é‡Œè®¾ç½®äº†è¯¥å±æ€§çš„å€¼ä¸º trueã€‚
  // ä½¿ç”¨ shallowEqual æ–¹æ³•æ¥åˆ¤æ–­ç»„ä»¶å±æ€§å’ŒçŠ¶æ€æ—¶æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œè‹¥ä¸¤ç§å‡æ˜¯â€œç›¸ç­‰â€ï¼Œåˆ™è¿”å› falseï¼Œå³ä¸æ›´æ–°ç»„ä»¶ï¼Œå¦åˆ™ä¼šè§¦å‘ç»„ä»¶çš„ render() æ–¹æ³•ä»¥æ›´æ–°ç»„ä»¶ã€‚
  if (ctor.prototype &amp;&amp; ctor.prototype.isPureReactComponent) {
    return !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState);
  }

  return true;
}
</code></pre>
<p>å†çœ‹ä¸‹ <code>shallowEqual</code> çš„å®ç°ï¼Œä¸éš¾ï¼š</p>
<pre><code class="language-jsx">function shallowEqual(objA, objB) {
  // is$1 ç›¸å½“äº ES6 çš„ Object.is() æ–¹æ³•ï¼Œæ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰
  if (is$1(objA, objB)) {
    return true;
  }

  // è®²è¿‡ä¸Šä¸€æ­¥çš„æ’é™¤ä¹‹åï¼Œè‹¥ objA æˆ– ObjB çš„å€¼æ˜¯â€œéå¼•ç”¨ç±»å‹â€æˆ– nullï¼Œåˆ™å¯ä»¥ç¡®å®š objA ä¸ objB æ˜¯ä¸ç›¸ç­‰çš„ã€‚
  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {
    return false;
  }

  // èµ°åˆ°è¿™æ­¥ï¼Œè¯´æ˜ objA å’Œ objB æ˜¯ä¸¤ä¸ªä¸åŒçš„å¼•ç”¨ç±»å‹çš„å€¼
  var keysA = Object.keys(objA);
  var keysB = Object.keys(objB);
  
  // æ¯”è¾ƒä¸¤è€…çš„å±æ€§æ•°é‡æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´ï¼Œåˆ™å¯ç¡®å®šä¸¤è€…æ˜¯ä¸ç›¸ç­‰çš„
  if (keysA.length !== keysB.length) {
    return false;
  } // Test for A's keys different from B.

  // è¿™é‡Œåªéå†æœ€å¤–å±‚çš„å±æ€§æ˜¯å¦ä¸€è‡´
  for (var i = 0; i &lt; keysA.length; i++) {
    // hasOwnProperty$2 å³ Object.prototype.hasOwnPropertyï¼›
    // å…ˆæ¯”è¾ƒ objA çš„å±æ€§ï¼Œåœ¨ objB å±æ€§æœ‰æ²¡æœ‰ï¼Œè‹¥æ— è¯´æ˜ä¸¤è€…ä¸ç›¸ç­‰ï¼Œå¦åˆ™æ¥ç€å†åˆ¤æ–­åŒä¸€å±æ€§å€¼æ˜¯å¦ç›¸ç­‰ï¼Œ
    // è¿™åˆ¤æ–­å°±æ¯”è¾ƒç®€å•äº†ï¼šObject.is() æ˜¯ä½¿ç”¨å…¨ç­‰åˆ¤æ–­çš„ï¼Œå¹¶è®¤ä¸º NaN === NaN å’Œ +0 !== -0 çš„ã€‚
    if (!hasOwnProperty$2.call(objB, keysA[i]) || !is$1(objA[keysA[i]], objB[keysA[i]])) {
      return false;
    }
  }

  // å¦åˆ™ï¼Œè¿”å› trueï¼Œè®¤ä¸ºå®ƒä»¬ç›¸ç­‰ã€‚
  return true;
}
</code></pre>
<p>é»˜è®¤æµ…å±‚å¯¹æ¯”æ–¹æ³•ï¼Œç›¸å½“äºï¼š</p>
<pre><code class="language-jsx">shouldComponentUpdate(nextProps, nextState) {
  return !shallowEqual(this.props, nextProps) || !shallowEqual(this.state, nextState);
}
</code></pre>
<blockquote>
<p>å…³äº <code>Object.is()</code> è§£å†³äº†ä»€ä¹ˆâ€œå¥‡è‘©â€é—®é¢˜ï¼Œå¯ä»¥çœ‹æ­¤å‰çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/3f732feac17f">JavaScript ç›¸ç­‰æ¯”è¾ƒè¯¦è§£</a> çš„ç¬¬ä¸‰èŠ‚å†…å®¹ã€‚</p>
</blockquote>
<p><strong>æ ¹æ®ä»¥ä¸Šæºç çš„åˆ†æï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š</strong></p>
<ul>
<li>
<p>è‹¥åŸºäº <code>React.PureComponent</code> çš„ç»„ä»¶è‡ªå®ç°äº† <code>shouldComponentUpdate()</code> æ–¹æ³•ï¼Œåˆ™ä¼šè·³è¿‡é»˜è®¤çš„â€œæµ…å±‚å¯¹æ¯”â€ï¼Œå¯ä»¥ç†è§£ä¸ºè¦†ç›–äº†é»˜è®¤çš„ shouldComponentUpdate() æ–¹æ³•ã€‚ã€‚</p>
</li>
<li>
<p>ä»æºç å¯çŸ¥ï¼Œ<code>React.Component</code> â€œæœªå®ç°â€ <code>shouldComponentUpdate()</code> æ˜¯å› ä¸ºå†…éƒ¨è¿”å›äº† <code>true</code> è€Œå·²ã€‚</p>
</li>
<li>
<p><code>React.PureComponent</code> çš„æµ…å±‚å¯¹æ¯”ï¼Œä¸»è¦åˆ†ä¸ºä¸‰æ­¥åˆ¤æ–­ï¼š1ï¸âƒ£ å¯¹æ¯” <code>oldProps</code> ä¸ <code>newProps</code> æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰åˆ™è¿”å› <code>false</code>ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹èµ°ï¼›2ï¸âƒ£ æ¥ç€åˆ¤æ–­ <code>oldProps</code> ä¸ <code>newProps</code> ï¼ˆæ­¤æ—¶å¯ä»¥ç¡®å®šä¸¤è€…æ˜¯ä¸ç›¸ç­‰çš„å¼•ç”¨å€¼äº†ï¼‰çš„ç¬¬ä¸€å±‚å±æ€§ï¼Œè‹¥å±æ€§æ•°é‡æˆ–è€…å±æ€§ <code>key</code> ä¸ä¸€è‡´ï¼Œåˆ™è®¤ä¸ºä¸¤è€…ä¸ç›¸ç­‰å¹¶è¿”å› <code>true</code>ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹èµ°ï¼›3ï¸âƒ£ åˆ¤æ–­å¯¹åº”å±æ€§çš„å±æ€§å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥å­˜åœ¨ä¸ç›¸ç­‰åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚å¯¹äº <code>oldState</code> ä¸ <code>newState</code> çš„åˆ¤æ–­åŒç†ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œæåˆ°çš„è¿”å›å€¼ <code>true/false</code> æ˜¯æŒ‡ <code>!shalldowEqual()</code> çš„ç»“æœï¼Œç›¸å½“äº <code>shouldComponentUpdate()</code> çš„è¿”å›å€¼</p>
</li>
</ul>
<h3>ä¸‰ã€ç¤ºä¾‹åŠæ³¨æ„äº‹é¡¹</h3>
<p>åŸºäºä»¥ä¸Šç»“è®ºï¼Œæ¥çœ‹å‡ ä¸ªç¤ºä¾‹å§ã€‚</p>
<blockquote>
<p>å…ˆæ˜ç¡®å‡ ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>setState()</code> æ¥æ›´æ–°çŠ¶æ€ï¼Œæ— è®ºçŠ¶æ€å€¼æ˜¯å¦çœŸçš„å‘ç”Ÿäº†æ”¹å˜ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œå³ <code>oldState !== newState</code>ã€‚</li>
<li>ç»„ä»¶çš„ <code>props</code> å¯¹è±¡æ˜¯ <code>readonly</code>ï¼ˆåªè¯»ï¼‰çš„ï¼ŒReact ä¼šä¿æŠ¤å®ƒä¸è¢«æ›´æ”¹ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</li>
<li>æ¯æ¬¡çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå­ç»„ä»¶çš„ <code>props</code> éƒ½ä¼šæ˜¯ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œå³ <code>oldProps !== newProps</code>ã€‚</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»„ä»¶å®ä¾‹çš„ <code>props</code> å€¼å‡ ä¹éƒ½æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å€¼ï¼Œå³å¯¹è±¡ï¼Œæˆ‘è¿˜æ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆåœºæ™¯ä¼šå‡ºç° <code>null</code> çš„æƒ…å†µã€‚è€Œç»„ä»¶å®ä¾‹çš„ <code>state</code> å€¼åˆ™å¯èƒ½æ˜¯å¯¹è±¡æˆ– <code>null</code>ï¼Œåè€…å³æ— çŠ¶æ€çš„ç±»ç»„ä»¶ï¼Œå½“ç„¶è¿™ç§æƒ…å†µä¸‹åº”å¯èƒ½ä½¿ç”¨å‡½æ•°ç»„ä»¶ã€‚</li>
</ul>
</blockquote>
<pre><code class="language-jsx">// çˆ¶ç»„ä»¶
class Parent extends React.Component {
  state = {
    number: 0, // åŸå§‹ç±»å‹
    list: [] // å¼•ç”¨ç±»å‹
  }

  changeList() {
    const { list } = this.state
    list.push(0)
    this.setState({ list })
  }

  changeNumber() {
    this.setState({ number: this.state.number + 1 })
  }

  render() {
    console.log('---&gt; Parent Render.')
    return (
      &lt;&gt;
        &lt;button onClick={this.changeNumber.bind(this)}&gt;Change Number&lt;/button&gt;
        &lt;button onClick={this.changeList.bind(this)}&gt;Change List&lt;/button&gt;
        &lt;Child num={this.state.number} lists={this.state.list} /&gt;
      &lt;/&gt;
    )
  }
}


// å­ç»„ä»¶
class Child extends React.PureComponent {
  state = {
    name: 'child'
  }

  render() {
    console.log('---&gt; Child Render.')
    return (
      &lt;&gt;
        &lt;div&gt;Child Component.&lt;/div&gt;
      &lt;/&gt;
    )
  }
}
</code></pre>
<p>1ï¸âƒ£ å½“æˆ‘ä»¬ç‚¹å‡»çˆ¶ç»„ä»¶çš„ <code>Change Number</code> æŒ‰é’®æ—¶ï¼Œå­ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ã€‚å› ä¸ºåœ¨å¯¹æ¯”å­ç»„ä»¶çš„ <code>oldProps.num</code> å’Œ <code>newProps.num</code> æ—¶ï¼Œä¸¤è€…çš„å€¼ä¸ç›¸ç­‰ï¼Œå› æ­¤ä¼šæ›´æ–°ç»„ä»¶ã€‚åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ï¼š</p>
<pre><code>---&gt; Parent Render.
---&gt; Child Render.
</code></pre>
<p>2ï¸âƒ£ å½“æˆ‘ä»¬ç‚¹å‡»çˆ¶ç»„ä»¶çš„ <code>Change List</code> æŒ‰é’®æ—¶ï¼Œå­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚å› ä¸ºåœ¨å¯¹æ¯”å­ç»„ä»¶çš„ <code>oldProps.list</code> å’Œ <code>newProps.list</code> æ—¶ï¼Œå®ƒä»¬éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸”ä¸¤è€…åœ¨å†…å­˜ä¸­çš„åœ°å€æ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸”ä¸ä¼šæ›´æ·±å±‚æ¬¡åœ°å»æ¯”è¾ƒäº†ï¼Œå› æ­¤ React è®¤ä¸ºå®ƒä¿©æ˜¯ç›¸ç­‰çš„ï¼Œå› æ­¤ä¸ä¼šæ›´æ–°ç»„ä»¶ã€‚åœ¨æ§åˆ¶å°åªçœ‹åˆ°ï¼š</p>
<pre><code>---&gt; Parent Render.
</code></pre>
<p>å½“ç„¶ï¼Œè¿™ä¸€ç‚¹ä¹Ÿæ˜¯ <code>React.PureComponent</code> çš„å±€é™æ€§ï¼Œå› æ­¤å®ƒåº”è¯¥åº”ç”¨äºä¸€äº›æ•°æ®ç»“æ„è¾ƒä¸ºç®€å•çš„å±•ç¤ºç±»ç»„ä»¶ã€‚</p>
<p>å¦å¤–ï¼Œ<code>React.PureComponent</code> ä¸­çš„ <code>shouldComponentUpdate()</code> å°†è·³è¿‡æ‰€æœ‰å­ç»„ä»¶æ ‘çš„ <code>prop</code> æ›´æ–°ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å­ç»„ä»¶ä¹Ÿéƒ½æ˜¯â€œçº¯â€çš„ç»„ä»¶ã€‚</p>
<h3>å››ã€å»¶ä¼¸ React.memo</h3>
<p>å¦‚æœåœ¨<strong>å‡½æ•°ç»„ä»¶</strong>ä¸­ï¼Œæƒ³è¦æ‹¥æœ‰ç±»ä¼¼ <code>React.PureComponent</code> çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactmemo"><code>React.memo</code></a>ã€‚</p>
<pre><code class="language-jsx">const MyComponent = React.memo(function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
})
</code></pre>
<p><code>React.memo</code>Â ä¸º<a href="https://zh-hans.reactjs.org/docs/higher-order-components.html">é«˜é˜¶ç»„ä»¶</a>ã€‚</p>
<p>å¦‚æœä½ çš„ç»„ä»¶åœ¨ç›¸åŒ <code>props</code> çš„æƒ…å†µä¸‹æ¸²æŸ“ç›¸åŒçš„ç»“æœï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å°†å…¶åŒ…è£…åœ¨ <code>React.memo</code> ä¸­è°ƒç”¨ï¼Œä»¥æ­¤é€šè¿‡è®°å¿†ç»„ä»¶æ¸²æŸ“ç»“æœçš„æ–¹å¼æ¥æé«˜ç»„ä»¶çš„æ€§èƒ½è¡¨ç°ã€‚è¿™æ„å‘³ç€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒReact å°†è·³è¿‡æ¸²æŸ“ç»„ä»¶çš„æ“ä½œå¹¶ç›´æ¥å¤ç”¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“çš„ç»“æœã€‚</p>
<p><code>React.memo</code>Â ä»…æ£€æŸ¥ <code>props</code> å˜æ›´ã€‚å¦‚æœå‡½æ•°ç»„ä»¶è¢«Â <code>React.memo</code>Â åŒ…è£¹ï¼Œä¸”å…¶å®ç°ä¸­æ‹¥æœ‰Â <a href="https://zh-hans.reactjs.org/docs/hooks-state.html"><code>useState</code></a>ï¼Œ<a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usereducer"><code>useReducer</code></a>Â æˆ–Â <a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usecontext"><code>useContext</code></a>Â çš„ Hookï¼Œå½“ <code>context</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä»ä¼šé‡æ–°æ¸²æŸ“ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹å…¶åªä¼šå¯¹å¤æ‚å¯¹è±¡åšæµ…å±‚å¯¹æ¯”ï¼Œå¦‚æœä½ æƒ³è¦æ§åˆ¶å¯¹æ¯”è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å°†è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¥å®ç°ã€‚</p>
<pre><code class="language-jsx">function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
}

function areEqual(prevProps, nextProps) {
  /*
  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸
  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ
  å¦åˆ™è¿”å› false
  */
}

export default React.memo(MyComponent, areEqual)
</code></pre>
<p>æ­¤æ–¹æ³•ä»…ä½œä¸º**<a href="https://zh-hans.reactjs.org/docs/optimizing-performance.html">æ€§èƒ½ä¼˜åŒ–</a>**çš„æ–¹å¼è€Œå­˜åœ¨ã€‚ä½†è¯·ä¸è¦ä¾èµ–å®ƒæ¥â€œé˜»æ­¢â€æ¸²æŸ“ï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿ bugã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œä¸ class ç»„ä»¶ä¸­Â <a href="https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate"><code>shouldComponentUpdate()</code></a>Â æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œå¦‚æœ <code>props</code> ç›¸ç­‰ï¼Œ<code>areEqual</code>Â ä¼šè¿”å›Â <code>true</code>ï¼›å¦‚æœ <code>props</code> ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å›Â <code>false</code>ã€‚è¿™ä¸Â <code>shouldComponentUpdate</code>Â æ–¹æ³•çš„è¿”å›å€¼ç›¸åã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œè‹¥éœ€è¦æ›´æ–°ç»„ä»¶ï¼Œé‚£ä¹ˆ <code>areEqual</code> æ–¹æ³•è¯·è¿”å› <code>false</code>ï¼Œå¦åˆ™è¿”å› <code>true</code>ã€‚</p>
</blockquote>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | setState]]></title>
            <link>https://github.com/toFrankie/blog/issues/115</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/115</guid>
            <pubDate>Sat, 25 Feb 2023 13:04:06 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6bcfb75e9c94ecb6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6bcfb75e9c94ecb6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©æ¥ç»†èŠä¸€ä¸‹ React ä¸­çš„ <code>setState()</code>ã€‚å½“ç„¶ï¼Œä»Šæ—¶ä»Šæ—¥å¤§å®¶éƒ½å¯èƒ½ä½¿ç”¨ Functional Component + Hook æ›¿ä»£ Class Component äº†å§ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¹Ÿä¸å¦¨ç¢æˆ‘ä»¬å»æ¢å¯»é‚£äº›â€œè¿‡æ—¶â€çš„è®¾è®¡ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ <code>setState()</code>ï¼Œæœ‰ä»€ä¹ˆé²œä¸ºäººçŸ¥çš„è®¾è®¡å‘¢ï¼Ÿ</p>
<p>æŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><code>setState()</code> æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ</li>
<li><code>setState()</code> ä»€ä¹ˆåœºæ™¯ä¸‹ç«‹å³æ›´æ–°ï¼Œä»€ä¹ˆåœºæ™¯æ‰¹é‡æ›´æ–°ï¼Ÿ</li>
</ul>
<h3>ä¸€ã€Props vs State</h3>
<p><code>props</code> å’Œ <code>state</code> éƒ½æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ã€‚å®ƒä»¬éƒ½æ˜¯ç”¨æ¥ä¿å­˜ä¿¡æ¯çš„ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“è¾“å‡ºï¼Œè€Œå®ƒä»¬çš„ä¸€ä¸ªé‡è¦çš„ä¸åŒç‚¹å°±æ˜¯ï¼š<code>props</code> æ˜¯ä¼ é€’ç»™ç»„ä»¶çš„ï¼ˆç±»ä¼¼äºå‡½æ•°çš„å½¢å‚ï¼‰ï¼Œè€Œ <code>state</code> æ˜¯åœ¨ç»„ä»¶å†…è¢«ç»„ä»¶è‡ªå·±ç®¡ç†çš„ï¼ˆç±»ä¼¼äºåœ¨ä¸€ä¸ªå‡½æ•°å†…å£°æ˜çš„å˜é‡ï¼‰ã€‚</p>
<h3>äºŒã€State ä½¿ç”¨</h3>
<p>è¯»å†™ç»„ä»¶çŠ¶æ€ï¼Œæœ€ç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">// è¯»å–çŠ¶æ€
const { count } = this.state
// æ›´æ–°çŠ¶æ€
this.setState = { count: xxx }
</code></pre>
<h5>1. setState ç®€è¿°</h5>
<p><code>setState()</code> æ˜¯æ›´æ–°ç”¨æˆ·ç•Œé¢çš„ä¸»è¦æ–¹å¼ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å¯¹ç»„ä»¶ <code>state</code> çš„æ›´æ”¹æ’å…¥é˜Ÿåˆ—ï¼Œå¹¶é€šçŸ¥ React éœ€è¦ä½¿ç”¨æ›´æ–°åçš„ <code>state</code> é‡æ–°æ¸²æŸ“æ­¤ç»„ä»¶åŠå…¶å­ç»„ä»¶ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ <code>setState()</code> æ›´æ–°çŠ¶æ€å¯èƒ½æ˜¯â€œ<strong>å¼‚æ­¥</strong>â€çš„ï¼ŒReact å¹¶ä¸ä¼šä¿è¯ <code>state</code> çš„å˜æ›´ä¼šç«‹å³ç”Ÿæ•ˆï¼Œå› æ­¤ä½¿å¾—åœ¨è°ƒç”¨ <code>setState()</code> åç«‹å³è¯»å– <code>this.state</code> æˆä¸ºäº†éšæ‚£ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-jsx">class Counter extends React.Component {
  constructor(props) {
    super(props)
    this.state = { count: 0 }
    this.increment = this.increment.bind(this)
  }

  increment() {
    this.setState({ count: this.state.count + 1 })
    this.setState({ count: this.state.count + 1 })
    this.setState({ count: this.state.count + 1 })
    console.log(this.state.count) // 1ï¸âƒ£
  }

  render() {
    return (
      &lt;div&gt;
        &lt;button onClick={this.increment}&gt;add&lt;/button&gt;
        &lt;div&gt;count: {this.state.count}&lt;/div&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>
<p>å‡è®¾ <code>count</code> ä» <code>0</code> å¼€å§‹ï¼Œæˆ‘ä»¬ç‚¹å‡»æŒ‰é’®è§¦å‘ <code>increment</code> äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé‡Œé¢ä¾æ¬¡æ›´æ–°äº†ä¸‰æ¬¡ <code>count</code> çš„çŠ¶æ€ï¼Œâ€œç›´è§‰æ€§â€çš„ç»“æœåº”è¯¥æ˜¯ <code>count</code> æ›´æ–°åˆ° <code>3</code> ä¸” 1ï¸âƒ£  å¤„æ‰“å°ç»“æœä¸º <code>3</code>ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚<strong>äº‹å®æ˜¯ <code>count</code> åªå¢åŠ äº† <code>1</code>ï¼Œ1ï¸âƒ£  å¤„æ‰“å°ç»“æœä¸º <code>0</code>ï¼Œä¸” <code>render()</code> åªè§¦å‘äº†ä¸€æ¬¡ã€‚</strong></p>
<p>ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ</p>
<p>åŸå› å°±æ˜¯ä¸Šé¢æåˆ°çš„ã€‚ä½¿ç”¨ <code>setState()</code> æ›´æ”¹çŠ¶æ€ï¼ŒReact å¹¶ä¸ä¼šç«‹å³æ›´æ–°ç»„ä»¶ï¼Œå®ƒä¼šæ‰¹é‡æ¨è¿Ÿæ›´æ–°ã€‚å³åœ¨ <code>increment()</code> æ–¹æ³•é‡Œï¼Œå››æ¬¡è¯»å– <code>this.state.count</code> çš„å€¼å‡ä¸º <code>0</code>ï¼Œå³ä½¿å†é‡å¤ N æ¬¡ä¹Ÿä¸€æ ·ï¼Œæ¯æ¬¡è§¦å‘ä»…ä¼šåœ¨åŸæ¥åŸºç¡€ä¸Šå¢åŠ  <code>1</code>ã€‚</p>
<pre><code class="language-jsx">increment() {
  const curCount = this.state.count // 0
  this.setState({ count: curCount + 1 })
  this.setState({ count: curCount + 1 })
  this.setState({ count: curCount + 1 })
  // ...
  console.log(curCount) // 0
}
</code></pre>
<h5>2. setState è¯­æ³•</h5>
<p>æ¥çœ‹çœ‹ <code>setState()</code> çš„è¯­æ³•ï¼Œæ”¯æŒä¸¤ç§å½¢å¼ï¼š</p>
<pre><code class="language-js">// 1ï¸âƒ£ updater æ¥å—å‡½æ•°ç±»å‹
setState(updater[, callback])

// 2ï¸âƒ£ stateChange æ¥å—å¯¹è±¡ç±»å‹
setState(stateChange[, callback])
</code></pre>
<ul>
<li>
<p><code>updater</code>ï¼šå¦‚ï¼š<code>(state, props) =&gt; stateChange</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p><code>state</code> æ˜¯å¯¹åº”ç”¨å˜åŒ–æ—¶ç»„ä»¶çŠ¶æ€çš„å¼•ç”¨ã€‚<code>props</code> åˆ™æ˜¯å½“å‰ç»„ä»¶çš„å±æ€§å¯¹è±¡ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ <code>updater</code> å‡½æ•°ä¸­æ¥æ”¶çš„ <code>state</code> å’Œ <code>props</code> éƒ½ä¿è¯ä¸ºæœ€æ–°çš„ï¼Œä½†æ­¤æ—¶ç»„ä»¶çŠ¶æ€è¿˜æ²¡æ”¹å˜ï¼ˆå…³äº <code>this.state</code> å€¼çš„æ›´æ–°ï¼Œä¸‹ä¸€èŠ‚è¯¦è§£ï¼‰ã€‚</p>
</li>
<li>
<p><code>stateChange</code>ï¼šæ¥å—å¯¹è±¡ç±»å‹ï¼Œå®ƒä¼šå°†ä¼ å…¥çš„å¯¹è±¡æµ…å±‚åˆå¹¶åˆ°æ–°çš„ <code>state</code> ä¸­ã€‚è¿™ç§å½¢å¼ä¹Ÿæ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œåœ¨åŒä¸€å‘¨æœŸå†…ä¼šå¯¹å¤šä¸ª <code>setState</code> è¿›è¡Œæ‰¹å¤„ç†æ›´æ–°ã€‚</p>
</li>
<li>
<p><code>callback</code>ï¼šç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œå®ƒå°†åœ¨ <code>setState</code> å®Œæˆåˆå¹¶å¹¶å¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶åæ‰§è¡Œã€‚é€šå¸¸å»ºè®®ä½¿ç”¨ <code>componentDidUpdate()</code> æ¥ä»£æ›¿æ­¤æ–¹å¼ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œ</p>
<p>ä¸Šè¿°ç¤ºä¾‹æ˜¯ <code>stateChange</code> å¯¹è±¡å½¢å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">increment() {
  this.setState({ count: this.state.count + 1 })
  this.setState({ count: this.state.count + 1 })
  this.setState({ count: this.state.count + 1 })
}

// setState æ“ä½œç›¸å½“äº
Object.assign(
  previousState,
  { count: previousState.count + 1 },
  { count: previousState.count + 1 },
  { count: previousState.count + 1 }
)
</code></pre>
<p>å¦‚æœé‡‡ç”¨ <code>updater</code> å‡½æ•°å½¢å¼ï¼Œå¦‚ä½•å¾—åˆ°æˆ‘ä»¬â€œé¢„æœŸâ€ç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">increment() {
  const incrementChange = state =&gt; ({ count: state.count + 1 })
  this.setState(incrementChange)
  this.setState(incrementChange)
  this.setState(incrementChange)
  console.log(this.state.count) // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä»ç„¶æ˜¯ 0
}
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œæ¯è§¦å‘ä¸€æ¬¡ <code>increment</code> äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œ<code>count</code> éƒ½èƒ½â€œé¢„æœŸâ€åœ°å¢åŠ  <code>3</code>ï¼Œä¸”åªä¼šè§¦å‘ä¸€æ¬¡ <code>render()</code> æ–¹æ³•ã€‚ä½†ç”±äºæ­¤æ—¶ <code>this.state</code> è¿˜æ²¡è¢«æ”¹å˜ï¼Œå› æ­¤è¯»å–çš„å€¼ä»æ˜¯åŸæœ¬çš„çŠ¶æ€å€¼ <code>0</code>ã€‚</p>
<h5>3. setState å…¶ä»–ç”¨æ³•</h5>
<p>åœ¨æ‰¹é‡æ›´æ–°æ—¶ï¼ŒReact æ€»ä¼šæŒ‰ç…§å®šä¹‰é¡ºåºè¿›è¡Œæµ…åˆå¹¶ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-jsx">handleState() {
  this.setState({ a: 1 })
  this.setState({ b: 2 })
  this.setState({ c: 3, a: '1' })
}

// React ä¼šè¿›è¡Œæµ…åˆå¹¶ï¼Œå¯¹å¤šä¸ª setState è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œç›¸å½“äºï¼š
handleState() {
  this.setState({ a: '1', b: 2, c: 3 }) // æ€»æ˜¯æŒ‰é¡ºåºè¿›è¡Œæµ…åˆå¹¶ï¼Œå› æ­¤ a ä¼šè¢«è¦†ç›–
}
</code></pre>
<p>å†çœ‹ä¸ªä¾‹å­ï¼Œ<code>updater</code> å’Œ <code>stateChange</code> ä¸¤ç§å½¢å¼æ··ç”¨ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆç»“æœï¼Ÿ</p>
<pre><code class="language-jsx">increment() {
  // å°† this.setState({ count: this.state.count + 1 }) æ’å…¥ä»¥ä¸‹ 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£  ä¸åŒçš„ä½ç½®ï¼Œå¾—åˆ°çš„ç»“æœæœ‰ä»€ä¹ˆå·®å¼‚å‘¢ï¼Ÿ
  const incrementChange = state =&gt; ({ count: state.count + 1 })
  // 1ï¸âƒ£
  this.setState(incrementChange)
  this.setState(incrementChange)
  // 2ï¸âƒ£
  this.setState(incrementChange)
  // 3ï¸âƒ£
  // è¯·é—®æœ€ç»ˆ count ä¼šåŠ åˆ°å‡ ï¼Ÿ
}

// å‡è®¾ count åˆå§‹çŠ¶æ€ä¸º 0ï¼Œè§¦å‘ä¸€æ¬¡ increment å¤„ç†å‡½æ•°åï¼Œcount æœ€ç»ˆçš„çŠ¶æ€ä¼šæ˜¯ 4ã€2ã€1ã€‚
</code></pre>
<p>æˆ‘ä»¬æ¥åˆ†æä¸‹åŸå› ï¼š</p>
<p><code>setState()</code> çš„ä½œç”¨æ˜¯å°† <code>state</code> çš„æ›´æ–°æ’å…¥é˜Ÿåˆ—ï¼Œç„¶åå…¶æ¥å—ä¸åŒçš„å®å‚ï¼ˆå³å¯¹è±¡ <code>stateChange</code> å½¢å¼ å’Œå‡½æ•° <code>updater</code> å½¢å¼ï¼‰ï¼Œä»ä¸Šé¢çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„è¿‡ç¨‹ï¼š</p>
<p>ä»¥ 2ï¸âƒ£  ä¸ºä¾‹ï¼Œæ³¨æ„ä»¥ä¸‹æ˜¯ä¼ªä»£ç ï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£ç½¢äº†ï¼š</p>
<pre><code class="language-jsx">// å‡è®¾åˆå§‹ count ä¸º 0
increment() {
  const incrementChange = state =&gt; ({ count: state.count + 1 })
  this.setState(incrementChange)
  this.setState(incrementChange)
  this.setState({ count: this.state.count + 1 })
  this.setState(incrementChange)
}

// state æ›´æ–°é˜Ÿåˆ—ï¼ˆä¼ªä»£ç ï¼‰
const queue = {
  // ...
}

// è§¦å‘ä¸€æ¬¡ increment() ä¹‹åï¼Œå‘ç”Ÿä»¥ä¸‹è¿‡ç¨‹ï¼š
// 1. æ‰§è¡Œç¬¬ä¸€ä¸ª setStateï¼Œæ˜¯å‡½æ•°å½¢å¼çš„ï¼Œå®ƒçš„ state æ˜¯åº”ç”¨å˜åŒ–æ—¶å¯¹ç»„ä»¶çŠ¶æ€çš„å¼•ç”¨ã€‚
//    æ­¤æ—¶é˜Ÿåˆ—ä¸ºç©ºï¼Œstate.count å–çš„å€¼å°±å½“å‰ç»„ä»¶çš„ count å€¼ 0ï¼Œå¹¶åŸºäºæ­¤åŠ  1ï¼Œç„¶åæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå³ queue.count ä¸º 1ï¼›
// 2. æ¥ç€æ‰§è¡Œç¬¬äºŒä¸ª setStateï¼ŒåŒç†ã€‚ç”±äºé˜Ÿåˆ—ä¸­å­˜åœ¨ count çš„å¼•ç”¨ï¼Œå› æ­¤å½“å‰ count = queue.count + 1ï¼Œ
//    å†æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå³ queue.count ä¸º 2ï¼›
// 3. æ‰§è¡Œç¬¬ä¸‰ä¸ª setStateï¼Œç”±äºæ˜¯å¯¹è±¡å½¢å¼ï¼Œä¼šå‘ç”Ÿæµ…åˆå¹¶ï¼Œ
//    ç±»ä¼¼äºï¼šObject.assgin(queue, { count: this.state.count + 1 }) çš„æ“ä½œï¼Œ
//    å…¶ä¸­ this.state.count ä¸º 0ï¼Œå› æ­¤æµ…åˆå¹¶çš„ç»“æœå°±æ˜¯ { count: 1 }ï¼Œç„¶åå†å­˜å…¥é˜Ÿåˆ—ï¼Œå³ queue.count ä¸º 1
// 4. æ‰§è¡Œç¬¬å››ä¸ª setState åŒç†ï¼Œé˜Ÿåˆ—å­˜åœ¨å¼•ç”¨ï¼Œå¹¶åŸºäºæ­¤å¢åŠ å†å­˜å…¥é˜Ÿåˆ—ï¼Œæ‰€ä»¥ queue.count ä¸º 2.
// 5. æ‰€ä»¥æœ€ç»ˆç»“æœä¸º 2ã€‚
</code></pre>
<p>å…¶ä»–åŒç†ï¼Œåªè¦æŒ‰ä»¥ä¸Šæ–¹å¼å»åˆ†æçš„è¯ï¼Œéƒ½èƒ½å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚è‹¥æƒ³æ›´æ·±å…¥åœ°äº†è§£ï¼Œè¯·çœ‹æºç ï¼</p>
<h3>ä¸‰ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ setState æ¥æ›´æ–° state ï¼Ÿ</h3>
<p>å¼€å¤´æåˆ°äº†ï¼Œè¯»å–å’Œæ›´æ–°çŠ¶æ€çš„æ­£ç¡®æ–¹å¼ï¼Œåº”å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">// è¯»å–çŠ¶æ€
const { count } = this.state
// æ›´æ–°çŠ¶æ€
this.setState = { count: xxx }
</code></pre>
<p>é‚£ä¹ˆï¼Œè¿™æ ·æ›´æ–°çŠ¶æ€å¯ä»¥å—ï¼Ÿ</p>
<pre><code class="language-jsx">// bad
this.state.count = xxx
</code></pre>
<p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†ä¸æ¨èã€‚å®ƒä¸ä¼šè§¦å‘ UI çš„æ›´æ–°ï¼Œå› æ­¤æ˜¯æ— æ„ä¹‰çš„ã€‚å®ƒç±»ä¼¼äº <code>setState</code> å’Œ <code>shouldComponetUpdate() { return false }</code> çš„ç»“åˆã€‚</p>
<p><code>state</code> æ˜¯ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ä¸ªæ™®é€š JavaScript å¯¹è±¡è€Œå·²ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ <code>state.xxx = xxx</code> å»æ›´æ”¹å®ƒï¼Œä¸å°±æ˜¯ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/set">setter</a> å˜›ã€‚ä½†å¦‚æœç»“åˆ React è®¾è®¡ <code>state</code> çš„åˆè¡·ï¼Œæˆ‘ä»¬ä¸åº”è¯¥é€šè¿‡è¿™ç§æ–¹å¼å»æ›´æ”¹æŸä¸ªçŠ¶æ€çš„å€¼ã€‚</p>
<p>ç›¸ä¿¡å¤§å®¶éƒ½å¬è¿‡ï¼š</p>
<blockquote>
<p><code>UI=f(State)</code>ï¼ŒçŠ¶æ€å³ UIã€‚å…·ä½“çŠ¶æ€æ˜¯å¦‚ä½•æ˜ å°„ç”¨æˆ·ç•Œé¢çš„ï¼Œè¿™å°±ç”± React å»æ“å¿ƒå°±å¥½äº†ã€‚</p>
</blockquote>
<p>è¿˜æœ‰ï¼Œ</p>
<blockquote>
<p>è¯·è®°ä½ï¼Œ<strong>å¦‚æœæŸäº›å€¼æœªç”¨äºæ¸²æŸ“æˆ–æ•°æ®æµï¼ˆä¼ é€’ç»™å­å­™ç»„ä»¶ï¼‰ï¼Œä¾‹å¦‚è®¡æ—¶å™¨ IDï¼Œåˆ™ä¸å¿…å°†å…¶è®¾ç½®ä¸º <code>state</code>ã€‚æ­¤ç±»å€¼å¯ä»¥åœ¨ç»„ä»¶å®ä¾‹ä¸Šå®šä¹‰ã€‚</strong></p>
</blockquote>
<h3>å››ã€state æ›´æ–°æ—¶æœº</h3>
<p>æ­¤å‰å†™äº†ä¸€ç¯‡æ–‡ç«  <a href="https://www.jianshu.com/p/24e80dabd581">React çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ‡‚äº†å—ï¼Ÿ</a> ï¼Œæåˆ° Class Component çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º Mountingã€Updatingã€Unmounting ä¸‰ä¸ªé˜¶æ®µã€‚è€Œ <code>setState()</code> å¸¦æ¥çš„æ›´æ–°ï¼Œåˆ™å‘ç”Ÿåœ¨ Updating é˜¶æ®µã€‚</p>
<p>å½“ <code>state</code>ï¼ˆæˆ– <code>props</code>ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ul>
<li><a href="">shouldComponentUpdate()</a></li>
<li><a href="">UNSAFE_componentWillUpdate()</a></li>
<li><a href="">render()</a></li>
<li><a href="">getSnapshotBeforeUpdate()</a></li>
<li><a href="">componentDidUpdate()</a></li>
</ul>
<blockquote>
<p>è¿˜åŒ…æ‹¬ React 16.3 æä¾›çš„ <a href="">getDerivedStateFromProps()</a> å…¨æ–° APIã€‚</p>
</blockquote>
<p>å½“ <code>shouldComponentUpdate()</code>ã€<code>UNSAFE_componentWillUpdate()</code> è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>this.state</code> éƒ½æœªè¢«æ›´æ–°ã€‚ç›´åˆ° <code>render()</code> è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>this.state</code> æ‰å¾—åˆ°æ›´æ–°ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ <code>shouldComponentUpdate()</code> è¿”å› <code>false</code> æ—¶ï¼Œä¼šå¯¼è‡´æœ¬æ¬¡æ›´æ–°è¢«ä¸­æ–­ï¼Œè‡ªç„¶ä¸ä¼šè°ƒç”¨ <code>render()</code> äº†ã€‚ä½†æ˜¯ React ä¹Ÿä¸ä¼šæ”¾å¼ƒæ‰å¯¹ <code>this.state</code> çš„æ›´æ–°ï¼ˆå¯é€šè¿‡å®šæ—¶å™¨å»è§‚å¯Ÿï¼‰ã€‚è¿™ç§æƒ…å†µï¼Œåƒ <code>this.state.xxx = xxx</code> è¿™ç§æ–¹å¼å»æ›´æ”¹ <code>this.state</code> å€¼ï¼Œä½†ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>
</blockquote>
<p><strong>å› æ­¤ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå½“è°ƒç”¨ <code>setState()</code> æ–¹æ³•å¯¹ç»„ä»¶çŠ¶æ€è¿›è¡Œæ›´æ–°æ—¶ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡ <code>render()</code> è¢«è°ƒç”¨ï¼ˆæˆ– <code>shouldComponentUpdate()</code> è¿”å› <code>false</code>ï¼‰ä¹‹åï¼Œ<code>this.state</code> æ‰å¾—åˆ°æ›´æ–°ã€‚ä¸” <code>setState</code> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿæ˜¯åœ¨æ­¤æ—¶æ‰ä¼šè¢«æ‰§è¡Œï¼Œä¹Ÿæ­£æ˜¯å¦‚æ­¤ï¼Œæ­¤æ—¶ <code>this.state</code> æ˜¯æœ€æ–°å€¼ï¼ˆé¢„æœŸå€¼ï¼‰ã€‚</strong></p>
<h3>äº”ã€setState æ‰¹é‡æ›´æ–°</h3>
<p>ä¸Šé¢æåˆ°ï¼Œåœ¨åŒä¸€æ—¶æœŸå†…å¤šæ¬¡è¿›è¡Œ <code>setState</code> æ“ä½œï¼Œä¼šè¢« React æ‰¹é‡æ›´æ–°ï¼Œå®ƒä»¬ä¼šè¢«æµ…åˆå¹¶ï¼Œåªä¼šè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚æˆ‘ä»¬æ‰€è¯´çš„ setState å¯èƒ½æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œå°±æ˜¯å› ä¸ºæ‰¹é‡æ›´æ–°æœºåˆ¶ï¼Œä½¿å¾—çœ‹èµ·æ¥åƒâ€œå¼‚æ­¥â€è€Œå·²ï¼Œå¹¶éçœŸæ­£çš„å¼‚æ­¥ã€‚</p>
<p>ä¸åŒç‰ˆæœ¬ä¸‹ï¼Œæ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šç¨æœ‰ä¸åŒã€‚ä»¥ä¸‹ä¸º <a href="https://github.com/gaearon">Dan ç¥</a>ï¼ˆReact æ ¸å¿ƒå¼€å‘ï¼‰åœ¨ <a href="https://stackoverflow.com/questions/48563650/does-react-keep-the-order-for-state-updates/48610973#48610973">Stack Overflow æŸè´´</a>çš„åŸè¯ï¼š</p>
<blockquote>
<p>Currently (React 16 and earlier), only updates inside React event handlers are batched by default. There is an unstable API to force batching outside of event handlers for rare cases when you need it.</p>
<p>In future versions (probably React 17 and later), React will batch all updates by default so you won't have to think about this. As always, we will announce any changes about this on theÂ <a href="https://reactjs.org/blog/">React blog</a>Â and in the release notes.</p>
</blockquote>
<p>ç¿»è¯‘è¿‡æ¥ï¼Œå¤§è‡´æ„æ€æ˜¯ï¼šåœ¨ React 16ï¼ˆæˆ–æ›´æ—©ï¼‰ç‰ˆæœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šåœ¨ React äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚åœ¨æœªæ¥ï¼ˆå¯èƒ½æ˜¯ React 17ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ‰¹å¤„ç†æ‰€æœ‰çš„æ›´æ–°ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<blockquote>
<p><code>setState()</code> åªåœ¨ <a href="https://zh-hans.reactjs.org/docs/events.html#gatsby-focus-wrapper"><strong>React åˆæˆäº‹ä»¶</strong></a> å’Œ<strong>ç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong>ä¸­æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œè€Œåœ¨<strong>åŸç”Ÿäº‹ä»¶</strong>å’Œ <strong><code>setTimeout</code></strong>ã€<strong><code>setInterval</code></strong> ä»¥åŠ<strong>ç½‘ç»œå“åº”</strong>ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">// base on React 16.12.0
componentDidMount() {
  fetch('http://192.168.1.102:7701/config')
    .then(() =&gt; {
      this.setState({ count: this.state.count + 1 })
      this.setState({ count: this.state.count + 1 })
      this.setState({ count: this.state.count + 1 })
      console.log(this.state.count) // 3
    })
}
</code></pre>
<p>æˆ‘ä»¬åœ¨ Fetch æˆ–è€… XHR è¯·æ±‚çš„å“åº”å¤„ç†ç¨‹åºä¸­ï¼Œä½¿ç”¨ <code>setState()</code> æ¥æ›´æ–°çŠ¶æ€ï¼Œè¿™æ—¶æ¯ä¸ª <code>setState()</code> éƒ½ä¼šç«‹å³å¤„ç†ï¼Œå› æ­¤ <code>count</code> å¢åŠ äº† 3 æ¬¡ï¼Œå³ <code>render()</code> ä¹Ÿè§¦å‘äº† 3 æ¬¡ï¼ŒåŒæ—¶æ‰“å°ç»“æœä¹Ÿä¸º <code>3</code>ã€‚</p>
<blockquote>
<p>å…¶å®é’ˆå¯¹ä¸Šè¿°æƒ…å†µï¼ŒReact ä¹Ÿæä¾›äº†ä¸€ä¸ª â€œunstableâ€ çš„ API <code>ReactDOM.unstable_batchedUpdates()</code> è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚â€œä¸ç¨³å®šâ€æ˜¯å› ä¸ºå®ƒä¼šåœ¨é»˜è®¤å¯ç”¨æ‰¹é‡æ›´æ–°åè¢«ç§»é™¤ã€‚å…³äºæ­¤ API çš„ä½¿ç”¨å°±ä¸å±•å¼€äº†ï¼Œè¯·çœ‹åŸè´´ã€‚ï¼ˆPSï¼šåŸºäº React 17.0.2 äº²æµ‹ï¼Œå¦‚ä¸Šå“åº”å¤„ç†ç¨‹åºï¼Œä»æœªå¯ç”¨æ‰¹é‡æ›´æ–°ï¼‰</p>
</blockquote>
<p>åŸç”Ÿäº‹ä»¶å’Œ React åˆæˆäº‹ä»¶åŒºåˆ«ï¼š</p>
<pre><code class="language-jsx">class Counter extends React.Component {
  constructor(props) {
    super(props)
    this.state = { count: 0 }
    this.increment = this.increment.bind(this)
    this.refElem = React.createRef()
  }

  componentDidMount() {
    this.refElem.current.addEventListener('click', this.increment, false)
  }

  increment() {
    this.setState({ count: this.state.count + 1 })
    this.setState({ count: this.state.count + 1 })
    this.setState({ count: this.state.count + 1 })
  }

  render() {
    return (
      &lt;div&gt;
        {/* React åˆæˆäº‹ä»¶ */}
        &lt;button onClick={this.increment}&gt;react add&lt;/button&gt;
        {/* åŸç”Ÿäº‹ä»¶ */}
        &lt;button ref={this.refElem}&gt;dom add&lt;/button&gt;
        &lt;div&gt;count: {this.state.count}&lt;/div&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>
<p>è¿è¡Œå¯çŸ¥ï¼Œæ¯æ¬¡è§¦å‘åˆæˆäº‹ä»¶ <code>count</code> ä¼šå¢åŠ  <code>1</code>ï¼Œè€Œè§¦å‘åŸç”Ÿäº‹ä»¶ <code>count</code> ä¼šå¢åŠ  <code>3</code>ã€‚</p>
<h3>å…­ã€setState æ˜¯å¦‚ä½•å®ç°â€œå¼‚æ­¥â€çš„ï¼Ÿ</h3>
<p>éšç€ React çš„ä¸æ–­æ›´æ–°ï¼Œä¸åŒç‰ˆæœ¬çš„æ–¹æ³•ï¼ŒåŠå…¶é€»è¾‘éƒ½ç•¥æœ‰ä¸åŒï¼Œä¾‹å¦‚æ—§ç‰ˆæ˜¯é€šè¿‡ <code>isBatchingUpdates</code> æ¥åˆ¤æ–­æ˜¯å¦æ‰¹é‡æ›´æ–°çš„ï¼Œç„¶åæ–°ç‰ˆåˆå˜æˆäº† <code>isBatchingEventUpdates</code>ï¼ˆå¯çœ‹æºç ï¼‰ã€‚</p>
<p>è¯¦çœ‹æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/6844904096424525832">setState çš„åœºæ™¯åŠè§£è¯»</a></li>
<li><a href="https://juejin.cn/post/6955636911214067720#heading-23">ä¸€æ–‡åƒé€ React äº‹ä»¶ç³»ç»ŸåŸç†</a></li>
</ul>
<h3>ä¸ƒã€ç»“è®º</h3>
<ul>
<li>
<p><code>setState</code> åªåœ¨ <a href="https://zh-hans.reactjs.org/docs/events.html#gatsby-focus-wrapper"><strong>React åˆæˆäº‹ä»¶</strong></a> å’Œ<strong>ç”Ÿå‘½å‘¨æœŸå‡½æ•°</strong>ä¸­æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œè€Œåœ¨<strong>åŸç”Ÿäº‹ä»¶</strong>å’Œ <strong><code>setTimeout</code></strong>ã€<strong><code>setInterval</code></strong> ä»¥åŠ<strong>ç½‘ç»œå“åº”</strong>ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚</p>
</li>
<li>
<p><code>setState</code> çš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å†…éƒ¨æœ¬èº«æ‰§è¡Œè¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­æ— æ³•ç«‹åˆ»æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢æˆäº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° <code>callback</code> å›è°ƒå‡½æ•°ä¸­æ‹¿åˆ°æ›´æ–°åçš„ç»“æœï¼ˆè¯¥å›è°ƒå‡½æ•°åœ¨ç»„ä»¶æ›´æ–°åè§¦å‘ï¼Œå› æ­¤ä¹Ÿå¯åœ¨ <code>ComponentDidUpdate</code> ä¸­è·å–æ›´æ–°åçš„å€¼ï¼‰ã€‚</p>
</li>
<li>
<p><code>setState</code> çš„æ‰¹é‡æ›´æ–°ä¼˜åŒ–ä¹Ÿæ˜¯å»ºç«‹åœ¨â€œå¼‚æ­¥â€ï¼ˆåˆæˆäº‹ä»¶ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰ä¹‹ä¸Šçš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ <code>setTimeout</code> ä¸­ä¸ä¼šæ‰¹é‡æ›´æ–°ï¼Œåœ¨æ‰¹é‡æ›´æ–°ä¸­ï¼Œå¦‚æœè¿›è¡Œå¤šæ¬¡ <code>setState</code>ï¼Œæ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šå½¢æˆæµ…åˆå¹¶çš„æ•ˆæœï¼Œè‹¥æœ‰ç›¸åŒçš„å€¼ï¼ˆKeyï¼‰ï¼Œè¯¥å€¼ä»…æœ€åä¸€æ¬¡æœ‰æ•ˆã€‚</p>
</li>
</ul>
<!--
### å››ã€å¾…å¤„ç†

1. ä¸ºä»€ä¹ˆçˆ¶ç»„ä»¶ state çš„æ›´æ–°ï¼Œå³ä½¿æ²¡å˜åŒ–ï¼Œéƒ½ä¼šå­ç»„ä»¶çš„ render() æ–¹æ³•ã€‚

3. setState å³ä½¿ state æ²¡å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ renderï¼Œåº”ç»“åˆ shouldComponentUpdate() é¿å…æ²¡å¿…è¦çš„æ¸²æŸ“ã€‚

### TODO List

1. async/await ä½œç”¨äº setState
  * https://stackoverflow.com/questions/47019199/why-does-async-await-work-with-react-setstate
  * https://www.jianshu.com/p/7d2f9e582403
-->
<h3>å…«ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/facebook/react/issues/11527#issuecomment-360199710">why is setState asynchronous?</a></li>
<li><a href="https://reactjs.org/docs/react-component.html#setstate">docs for setState</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/39512941">ä½ çœŸçš„ç†è§£ setState å—ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25954470">setStateï¼šè¿™ä¸ªAPIè®¾è®¡åˆ°åº•æ€ä¹ˆæ ·</a></li>
<li><a href="https://www.jianshu.com/p/7d2f9e582403">ä» setState promise åŒ–çš„æ¢è®¨ ä½“ä¼š React å›¢é˜Ÿè®¾è®¡æ€æƒ³</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» React | å…ƒç´ ã€ç»„ä»¶ã€å®ä¾‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/114</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/114</guid>
            <pubDate>Sat, 25 Feb 2023 13:03:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-75107ae9086be47f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-75107ae9086be47f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h3>ä¸€ã€å‰è¨€</h3>
<p>å…ƒç´ æ˜¯æ„æˆ React åº”ç”¨æœ€å°çš„ç –å—ï¼Œå®ƒæè¿°äº†ä½ åœ¨é¡µé¢ä¸Šæƒ³çœ‹åˆ°çš„å†…å®¹ã€‚</p>
<pre><code class="language-jsx">const element = &lt;h1&gt;Hello World&lt;/h1&gt;
</code></pre>
<p>ä¸æµè§ˆå™¨çš„ DOM å…ƒç´ ä¸åŒï¼ŒReact å…ƒç´ æ˜¯åˆ›å»ºå¼€é”€æå°çš„æ™®é€šå¯¹è±¡ã€‚React DOM ä¼šè´Ÿè´£æ›´æ–° DOM æ¥ä¸ React å…ƒç´ ä¿æŒä¸€è‡´ã€‚</p>
<p>ä»¥ä¸Š JSX è¯­æ³•ç¼–å†™çš„ä»£ç ï¼Œæœ€ç»ˆä¼šè¢« Babel ï¼ˆ<a href="https://babeljs.io/repl/#?presets=react&amp;code_lz=GYVwdgxgLglg9mABACwKYBt1wBQEpEDeAUIogE6pQhlIA8AJjAG4B8AEhlogO5xnr0AhLQD0jVgG4iAXyJA">åœ¨çº¿ Babel ç¼–è¯‘å™¨</a>ï¼‰è½¬æ¢ä¸ºï¼š</p>
<pre><code class="language-jsx">const element = React.createElement('h1', null, 'Hello World')
</code></pre>
<p>è€Œ <a href="https://reactjs.org/docs/react-api.html#createelement">React.createElement()</a> æœ€åä¼šè¿”å›ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼ˆè¯¥å¯¹è±¡å°±æ˜¯å¯¹ React å…ƒç´ çš„æè¿°ï¼‰ï¼š</p>
<pre><code class="language-js">const element = {
  type: 'h1',
  props: {
    children: 'Hello World'
  },
  // ...
}
</code></pre>
<p>å¯ä»¥åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ <code>element</code> å…ƒç´ ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5fa4948e79d9efb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒReact å…ƒç´ æè¿°çš„æ˜¯ Virtual DOM çš„ç»“æ„ï¼Œè€ŒéçœŸå® DOMã€‚çœŸå® DOM ç”± React DOM æ ¹æ® Virtual DOM è´Ÿè´£æ›´æ–°ã€‚</p>
<h3>äºŒã€React å…ƒç´ </h3>
<p>ä¸Šé¢æåˆ°ï¼ŒReact å…ƒç´ æœ¬èº«ä¸Šå°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œè€Œä¸”æ˜¯<a href="">ä¸å¯å˜å¯¹è±¡</a>ï¼ˆImmutable Objectï¼‰ã€‚</p>
<blockquote>
<p>ç”±äº React å…ƒç´ æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œè‹¥å¯¹å…¶ <code>props</code> ç­‰å±æ€§è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ˜¯ä¼šæŠ›å‡ºé”™è¯¯çš„ã€‚</p>
</blockquote>
<p>React å…ƒç´ è¡¨ç¤ºäº†æŸä¸ªæ—¶åˆ»çš„ UIï¼Œè€Œæ›´æ–° UI çš„å”¯ä¸€æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å…ƒç´ ã€‚React DOM ä¼šæ ¹æ® Diff ç®—æ³•åªæ›´æ–°å®ƒéœ€è¦æ›´æ–°çš„éƒ¨åˆ†ã€‚</p>
<h3>ä¸‰ã€React ç»„ä»¶</h3>
<p>åˆšå¼€å§‹æ¥è§¦ React æ—¶ï¼Œäººä»¬å¾ˆå®¹æ˜“å°†<strong>å…ƒç´ </strong>å’Œ<strong>ç»„ä»¶</strong>çš„æ¦‚å¿µæ··æ·†ã€‚å…ƒç´ æ˜¯ React åº”ç”¨æœ€å°çš„å•å…ƒï¼Œè€Œç»„ä»¶åˆ™æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ„æˆçš„ã€‚</p>
<p>ç»„ä»¶æ˜¯ React ä¸­å¾ˆé‡è¦çš„æ€æƒ³ã€‚ä¸€ä¸ªå¤æ‚åºå¤§çš„ React åº”ç”¨ï¼Œæ˜¯ç”±è®¸å¤šç»“æ„ç®€å•ã€æ¸…æ™°çš„ç»„ä»¶ç»„åˆè€Œæˆçš„ã€‚</p>
<p>ç»„ä»¶ï¼Œä»æ¦‚å¿µä¸Šç±»ä¼¼äº JavaScript å‡½æ•°ï¼Œå®ƒæ¥å—ä»»æ„çš„å…¥å‚ï¼ˆå³ <code>props</code>ï¼‰ï¼Œå¹¶è¿”å› React å…ƒç´ ã€‚</p>
<p>åœ¨ React ä¸­ï¼Œç»„ä»¶åˆ†ä¸º<strong>å‡½æ•°ç»„ä»¶</strong>å’Œ <strong>class ç»„ä»¶</strong>ã€‚ä¸‹é¢å£°æ˜äº†ä¸¤ç§ä¸åŒç±»å‹çš„ç»„ä»¶ï¼š</p>
<pre><code class="language-jsx">// å‡½æ•°ç»„ä»¶
function Comp1() {
  return &lt;h1&gt;Functional Component.&lt;/h1&gt;
}

// class ç»„ä»¶
class Comp2 extends React.Component {
  // render æ˜¯ç±»ç»„ä»¶å”¯ä¸€å¿…éœ€å®ç°çš„æ–¹æ³•
  render() {
    return &lt;h1&gt;Class Component.&lt;/h1&gt;
  }
}
</code></pre>
<p>æˆ‘ä»¬çŸ¥é“ <code>ReactDOM.render(element, container[, callback])</code> æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>element</code> æ¥æ”¶çš„æ˜¯ React å…ƒç´ ã€‚è€Œæˆ‘ä»¬å£°æ˜çš„ç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥è¦è¿™æ ·ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼š</p>
<pre><code class="language-jsx">ReactDOM.render(&lt;Comp1 /&gt;, document.getElementById('root'))
</code></pre>
<h3>å››ã€React å…ƒç´ åˆ†ç±»</h3>
<p>ä»ä»¥ä¸Šå¯çŸ¥ï¼Œæˆ‘ä»¬é‡åˆ°çš„ React å…ƒç´ ï¼Œå¯ä»¥æ˜¯ DOM æ ‡ç­¾ï¼š</p>
<pre><code class="language-jsx">const element = &lt;h1&gt;Hello World&lt;/h1&gt;
</code></pre>
<p>ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ç»„ä»¶ï¼š</p>
<pre><code class="language-jsx">const element = &lt;Comp1 /&gt;
</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† React å…ƒç´ åˆ†ä¸ºä¸¤ç±»ï¼šDOM ç±»å‹å…ƒç´ ã€ç»„ä»¶ç±»å‹å…ƒç´ ã€‚</p>
<p>å‰è€…æ˜¯æŒ‡ä½¿ç”¨ç±»ä¼¼ <code>div</code>ã€<code>h1</code>ã€<code>p</code>ã€<code>span</code> ç­‰ DOM æ ‡ç­¾åˆ›å»ºçš„ React å…ƒç´ ï¼Œè€Œåè€…æ˜¯æŒ‡ä½¿ç”¨ React ç»„ä»¶ï¼ˆå¦‚ Class Componentsã€Functional Componentsï¼‰åˆ›å»ºçš„ React å…ƒç´ ã€‚</p>
<p>å¯¹äº DOM æ ‡ç­¾ï¼ŒReact å¯ä»¥åˆ†è¾¨å‡ºæ¥ï¼Œè€Œè‡ªå®šä¹‰çš„ React ç»„ä»¶å‘¢ï¼Ÿè‹¥ä¸çº¦å®šè§„åˆ™ï¼Œé‚£ä¹ˆå®ƒæ— æ³•è¾¨è®¤å•Šã€‚æ‰€ä»¥ React è¦æ±‚ä»¥ JSX è¯­æ³•ç¼–å†™ React ç»„ä»¶æ—¶ï¼Œå…¶ç»„ä»¶åç§°å¿…é¡»<strong>ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>MyComponent</code> æ˜¯â€œåˆæ³•â€çš„ React ç»„ä»¶ï¼Œè€Œ <code>myComponent</code> æ˜¯â€œä¸åˆæ³•â€çš„ã€‚å¦åˆ™ React ä¼šå‘å‡ºå¦‚ä¸‹è­¦å‘Š âš ï¸ï¼š</p>
<blockquote>
<p>Warning: The tag <code>&lt;myComponent&gt;</code> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.</p>
</blockquote>
<blockquote>
<p>ä¸Šé¢æ‰“äº†åŒå¼•å·ï¼Œå…¶å®åœ¨å£°æ˜ä¸€ä¸ª React ç»„ä»¶æ—¶ï¼Œæ˜¯å¯ä»¥ä»¥å°å†™å­—æ¯å¼€å¤´çš„ï¼Œä½†åœ¨ä½¿ç”¨æ—¶å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚å³æˆ‘ä»¬å¯ä»¥å°† React ç»„ä»¶èµ‹å€¼ç»™ä¸€ä¸ªä»¥å¤§å†™å­—æ¯å¼€å¤´çš„å˜é‡ï¼Œç„¶åæ­£å¸¸ä½¿ç”¨ã€‚**ä½†è¿™ç§â€œéä¸»æµâ€çš„å†™æ³•ï¼Œä¸è¢«æ¨èã€‚**å†è€…ï¼Œå£°æ˜ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒçš„åç§°åº”ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œè¿™æ˜¯ä¸€ç§çº¦å®šä¿—æˆçš„å†™æ³•ã€‚</p>
</blockquote>
<p>åŒæ ·çš„ï¼ŒDOM ç±»å‹å…ƒç´ åªèƒ½<strong>ä»¥å°å†™å­—æ¯</strong>çš„å½¢å¼ï¼Œä¾‹å¦‚ <code>&lt;div /&gt;</code>ã€‚å¦‚æœä½¿ç”¨ <code>&lt;Div /&gt;</code> ä¼šè¢« React è®¤ä¸ºæ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œä½†ç”±äºæˆ‘ä»¬åˆæ²¡æœ‰å£°æ˜ï¼Œå› æ­¤å¯èƒ½ä¼šæŠ›å‡ºå¼•ç”¨é”™è¯¯ï¼š<code>ReferenceError: Div is not defined</code>ã€‚</p>
<blockquote>
<p>æƒ³äº†è§£æ›´å¤šå…³äºæ­¤è§„èŒƒçš„åŸå› ï¼Œè¯·çœ‹<a href="https://zh-hans.reactjs.org/docs/jsx-in-depth.html#user-defined-components-must-be-capitalized">æ·±å…¥ JSX</a>ã€‚</p>
</blockquote>
<h3>äº”ã€React å…ƒç´ ã€ç»„ä»¶ä½¿ç”¨è¯¯åŒº</h3>
<p>ä¸€äº›å®¹æ˜“æ··æ·†ã€å‡ºé”™çš„å†™æ³•ï¼š</p>
<pre><code class="language-jsx">const Element = &lt;h1&gt;React Element.&lt;/h1&gt;
const rootEl = document.getElementById('root')

// æ­£ç¡®ç¤ºä¾‹ âœ…
ReactDOM.render(Element, rootEl)
ReactDOM.render(&lt;Comp1 /&gt;, rootEl)

// é”™è¯¯ç¤ºä¾‹ âŒ
ReactDOM.render(&lt;Element /&gt;, rootEl) // 1ï¸âƒ£
ReactDOM.render(Comp1, rootEl) // 2ï¸âƒ£
</code></pre>
<p>é”™è¯¯ç¤ºä¾‹ 1ï¸âƒ£ ä¼šæŠ›å‡ºä»¥ä¸‹è­¦å‘Š âš ï¸ï¼š</p>
<blockquote>
<p>Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: <code>&lt;h1 /&gt;</code>. Did you accidentally export a JSX literal instead of a component?</p>
</blockquote>
<p>é”™è¯¯ç¤ºä¾‹ 2ï¸âƒ£ ä¼šæŠ›å‡ºä»¥ä¸‹è­¦å‘Š âš ï¸ï¼š</p>
<blockquote>
<p>Warning: Functions are not valid as a React child. This may happen if you return a Component instead of <code>&lt;Component /&gt;</code> from render. Or maybe you meant to call this function rather than return it.</p>
</blockquote>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>ReactDOM.render(element, container[, callback])</code> ç¬¬ä¸€ä¸ªå‚æ•°æ¥æ”¶ React å…ƒç´ ã€‚è€Œ React å…ƒç´ éƒ½æ˜¯ç”± <code>React.createElement()</code> è¿”å›çš„ã€‚æˆ‘ä»¬ä» <code>React.createElement()</code> çš„è¯­æ³•ä¸Šè§£é‡Šä»¥ä¸Šé”™è¯¯ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">React.createElement(
  type,
  [props],
  [...children]
)
</code></pre>
<ul>
<li>
<p><code>type</code> å¯ä»¥æ˜¯æ ‡ç­¾åå­—ç¬¦ä¸²ï¼ˆå¦‚ <code>div</code>ã€<code>span</code>ã€<code>h1</code> ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ React ç»„ä»¶ç±»å‹ï¼ˆclass ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶ï¼‰ï¼Œæˆ–è€…æ˜¯ React Fragment ç±»å‹ã€‚</p>
</li>
<li>
<p><code>props</code> å¯é€‰ï¼Œç»„ä»¶å±æ€§</p>
</li>
<li>
<p><code>children</code> å¯é€‰ï¼Œå­å…ƒç´ ã€‚å«æœ‰å¤šä¸ªå­å…ƒç´ æ—¶ï¼Œæœ€ç»ˆ React Element çš„ <code>props.children</code> ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</p>
</li>
</ul>
<blockquote>
<p>åŸå› åˆ†æï¼š</p>
<ol>
<li><code>ReactDOM.render(Element, rootEl)</code> ç›¸å½“äº <code>ReactDOM.render(&lt;h1&gt;React Element.&lt;/h1&gt;, rootEl)</code>ï¼ˆ è¿™é‡Œ <code>Element</code> åªæ˜¯ä¸€ä¸ªå˜é‡ï¼‰ã€‚ä»¥<strong>å°å†™å­—æ¯å¼€å¤´</strong>çš„å…ƒç´ ä»£è¡¨ä¸€ä¸ª HTML å†…ç½®ç»„ä»¶ï¼Œåœ¨ç¼–è¯‘æ—¶ <code>&lt;h1&gt;</code> ä¼šç”Ÿæˆå“åº”çš„å­—ç¬¦ä¸² <code>'h1'</code> ä¼ é€’ç»™ <code>React.createElement</code>ï¼Œæ˜¯ç¬¦åˆå‚æ•°è¦æ±‚çš„ã€‚æ‰€ä»¥æ²¡é—®é¢˜ã€‚</li>
<li><code>ReactDOM.render(&lt;Comp1 /&gt;, rootEl)</code> ä¸­<strong>ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>çš„å…ƒç´ ï¼Œå¯¹åº”ç€è‡ªå®šä¹‰ç»„ä»¶ï¼Œ<code>&lt;Comp1 /&gt;</code> ä¼šè¢«ç¼–è¯‘ä¸º <code>React.createElement(Comp1)</code>ã€‚è€Œä¸” <code>Comp1</code> æ­£æ˜¯ React ç»„ä»¶ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ JavaScript å‡½æ•°ï¼‰ï¼Œä¹Ÿç¬¦åˆå‚æ•°è¦æ±‚ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ã€‚</li>
<li>æŒ‰ä¸Šé¢çš„è§„åˆ™ï¼Œ<code>&lt;Element /&gt;</code> ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ React ç»„ä»¶ï¼Œä½† <code>Element</code> çš„ç±»å‹æ˜¯ <code>&quot;object&quot;</code>ï¼Œè€Œä¸æ˜¯ <code>&quot;function&quot;</code>ï¼ˆclass æœ¬è´¨ä¹Ÿæ˜¯å‡½æ•°ï¼‰ï¼Œä¸ç¬¦åˆ <code>React.createElement</code> å‚æ•°è¦æ±‚ï¼Œå› æ­¤ä¼šè¢«æŠ¥é”™æˆ–è­¦å‘Šã€‚</li>
<li><code>ReactDOM.render(Comp1, rootEl)</code> ä¸­çš„ <code>Comp1</code> æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œè€Œé React å…ƒç´ ï¼Œå› æ­¤ä¹Ÿä¼šæŠ¥é”™ã€‚</li>
</ol>
</blockquote>
<h3>å…­ã€å®ä¾‹</h3>
<p>React ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…ç±»ï¼Œè€Œå®é™…å‘æŒ¥ä½œç”¨çš„æ˜¯ React ç»„ä»¶çš„å®ä¾‹å¯¹è±¡ã€‚åªæœ‰åœ¨ç»„ä»¶å®ä¾‹åŒ–ä¹‹åï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹æ‰æœ‰è‡ªèº«çš„ propsã€state æˆ–å¯¹ DOM èŠ‚ç‚¹çš„å¼•ç”¨ã€‚</p>
<pre><code class="language-jsx">function Child() {
  return &lt;div&gt;Child Component&lt;/div&gt;
}

class Parent extends React.Component {
  // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç»„ä»¶å°†è¦è¢«é”€æ¯çš„æ—¶å€™ä¼šè§¦å‘æ­¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°
  // å½“ç»„ä»¶ä»é¡µé¢ä¸­â€œç§»é™¤â€ï¼Œå¹¶ä¸æ„å‘³ç€ç»„ä»¶å®ä¾‹è¢«å›æ”¶æ‰äº†
  // ä»…åœ¨ç»„ä»¶å®ä¾‹ä¸å†è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå®ƒæ‰ä¼šè¢«åƒåœ¾å›æ”¶ã€‚
  componentWillUnmount() {
    // ...
  }

  render() {
    return (
      &lt;div&gt;
         &lt;div&gt;Parent Component&lt;/div&gt;
         {/* å½“çˆ¶ç»„ä»¶è§¦å‘ render ä¹‹åï¼Œå­ç»„ä»¶å°±ä¼šè¢«å®ä¾‹åŒ– */}
         &lt;Child /&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>
<h3>ä¸ƒã€èŠ‚ç‚¹</h3>
<p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ PropTypes æ¥é™åˆ¶ç»„ä»¶å±æ€§ç±»å‹ã€‚è¿™é‡Œæˆ‘ä»¬æä¸€ä¸‹ä¸æœ¬æ–‡ç›¸å…³çš„ä¸¤ç§ç±»å‹ï¼š<code>PropTypes.node</code> å’Œ <code>PropTypes.element</code>ã€‚</p>
<pre><code class="language-jsx">import PropTypes from 'prop-types'

function MyComponent(props) {
  return (
    &lt;div&gt;
      &lt;div&gt;node: { props.node }&lt;/div&gt;
      &lt;div&gt;element: { props.element }&lt;/div&gt;
    &lt;/div&gt;
  )
}

MyComponent.propTypes = {
  node: PropTypes.node,
  element: PropTypes.element
}
</code></pre>
<ul>
<li><strong>PropTypes.element</strong>ï¼šå¯ä»¥æ˜¯ <code>null</code>ã€<code>undefined</code> æˆ– React å…ƒç´ ã€‚</li>
<li><strong>PropTypes.node</strong>: å¯ä»¥æ˜¯ <code>null</code>ã€<code>undefined</code>ã€å­—ç¬¦ä¸²ã€React å…ƒç´ æˆ–åŒ…å«è¿™äº›ç±»å‹çš„æ•°ç»„ã€‚</li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[React çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ‡‚äº†å—ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/113</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/113</guid>
            <pubDate>Sat, 25 Feb 2023 13:02:14 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0a6ae356f88f3fc8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0a6ae356f88f3fc8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å‘ç°å¥½åƒæœ‰äº›æ²¡æœ‰è¿‡çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè¿˜æ²¡å®Œå…¨å¼„æ¸…æ¥š...</p>
<h3>ä¸€ã€ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸»è¦åˆ†ä¸º Mountingï¼ˆæŒ‚è½½ï¼‰ã€Updatingï¼ˆæ›´æ–°ï¼‰ã€Unmountingï¼ˆå¸è½½ï¼‰ä¸‰ä¸ªé˜¶æ®µã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-cac9c319fc8dbb05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="React â‰¥ 16.4"></p>
<h5>Mounting</h5>
<p>å½“ç»„ä»¶ç¤ºä¾‹è¢«åˆ›å»ºå¹¶æ’å…¥ DOM ä¸­æ—¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://react.docschina.org/docs/react-component.html#constructor">constructor()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#static-getderivedstatefromprops">static getDerivedStateFromProps()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#render">render()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#componentdidmount">componentDidMount()</a></li>
</ul>
<blockquote>
<p>ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å³å°†è¿‡æ—¶ï¼Œåœ¨æ–°ä»£ç ä¸­åº”è¯¥<a href="https://react.docschina.org/blog/2018/03/27/update-on-async-rendering.html">é¿å…ä½¿ç”¨å®ƒä»¬</a>ï¼š<code>UNSAFE_componentWillMount()</code>ã€‚</p>
</blockquote>
<h5>Updating</h5>
<p>å½“ç»„ä»¶çš„ props æˆ– state å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘æ›´æ–°ã€‚ç»„ä»¶æ›´æ–°çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://react.docschina.org/docs/react-component.html#static-getderivedstatefromprops">static getDerivedStateFromProps()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#shouldcomponentupdate">shouldComponentUpdate()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#render">render()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#getsnapshotbeforeupdate">getSnapshotBeforeUpdate()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#componentdidupdate">componentDidUpdate()</a></li>
</ul>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹æ–¹æ³•å³å°†è¿‡æ—¶ï¼Œåœ¨æ–°ä»£ç ä¸­åº”è¯¥<a href="https://react.docschina.org/blog/2018/03/27/update-on-async-rendering.html">é¿å…ä½¿ç”¨å®ƒä»¬</a>ï¼š<a href="https://react.docschina.org/docs/react-component.html#unsafe_componentwillupdate"><code>UNSAFE_componentWillUpdate()</code></a>ã€<a href="https://react.docschina.org/docs/react-component.html#unsafe_componentwillreceiveprops"><code>UNSAFE_componentWillReceiveProps()</code></a></p>
</blockquote>
<h5>Unmounting</h5>
<p>å½“ç»„ä»¶ä» DOM ä¸­ç§»é™¤æ—¶ä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><a href="https://react.docschina.org/docs/react-component.html#componentwillunmount">componentWillUnmount()</a></li>
</ul>
<h5>Error Handlingï¼ˆé”™è¯¯å¤„ç†ï¼‰</h5>
<p>å½“æ¸²æŸ“è¿‡ç¨‹ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œæˆ–å­ç»„ä»¶çš„æ„é€ å‡½æ•°ä¸­æŠ›å‡ºé”™è¯¯æ—¶ï¼Œä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><a href="https://react.docschina.org/docs/react-component.html#static-getderivedstatefromerror">static getDerivedStateFromError()</a></li>
<li><a href="https://react.docschina.org/docs/react-component.html#componentdidcatch">componentDidCatch()</a></li>
</ul>
<h3>äºŒã€Mountingï¼ˆæŒ‚è½½ï¼‰</h3>
<h5>2.1 constructor</h5>
<pre><code class="language-js">constructor(props)
</code></pre>
<blockquote>
<p>å¦‚æœä¸åˆå§‹åŒ– state æˆ–ä¸è¿›è¡Œæ–¹æ³•ç»‘å®šï¼Œåˆ™ä¸éœ€è¦ä¸º React ç»„ä»¶å®ç°æ„é€ å‡½æ•°ã€‚</p>
</blockquote>
<p>åœ¨ React ç»„ä»¶æŒ‚è½½ä¹‹å‰ï¼Œä¼šè°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°ã€‚åœ¨ä¸º <code>React.Component</code> å­ç±»å®ç°æ„é€ å‡½æ•°æ—¶ï¼Œåº”è¯¥åœ¨å…¶ä»–è¯­å¥ä¹‹å‰è°ƒç”¨ <code>super(props)</code>ã€‚å¦åˆ™ï¼Œ<code>this.props</code> åœ¨æ„é€ å‡½æ•°ä¸­å¯èƒ½ä¼šå‡ºç°æœªå®šä¹‰çš„ bugã€‚</p>
<p>ä¸€èˆ¬éœ€é‡å†™æ„é€ å‡½æ•°ï¼Œåªåšä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–ç»„ä»¶å†…éƒ¨ stateï¼Œå³ <code>this.state = { ... }</code>ã€‚</li>
<li>ä¸ºæ—¶é—´å¤„ç†å‡½æ•°ç»‘å®šå®ä¾‹ï¼Œå¦‚ï¼š<code>this.handleClick = this.handleClick.bind(this)</code></li>
</ul>
<p>å¦åˆ™æ— éœ€ä¸º React ç»„ä»¶å®ç°æ„é€ å‡½æ•°ã€‚</p>
<h5>2.2 static getDerivedStateFromPropsï¼ˆä¸å¸¸ç”¨ï¼‰</h5>
<pre><code class="language-js">static getDerivedStateFromProps(props, state)
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ–¹æ³•æ— æ³•è®¿é—®ç»„ä»¶å®ä¾‹ï¼Œå³ä¸èƒ½ä½¿ç”¨ <code>this</code>ã€‚</p>
</blockquote>
<p><code>getDerivedStateFromState</code> ä¼šåœ¨è°ƒç”¨ <code>render</code> æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨åˆå§‹æŒ‚è½½åŠåç»­æ›´æ–°æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚å®ƒåº”è¿”å›ä¸€ä¸ª <code>å¯¹è±¡</code> æ¥æ›´æ–° stateï¼Œå¦‚æœè¿”å› <code>null</code> åˆ™ä¸æ›´æ–°ä»»ä½•å†…å®¹ã€‚</p>
<p>ä¸ <code>componentWillReceiveProps</code> ä¸åŒçš„æ˜¯ï¼Œ<code>getDerivedStateFromProps</code> ä¸ç®¡åŸå› æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“å‰è§¦å‘æ­¤æ–¹æ³•ã€‚è€Œ <code>componentWillReceiveProps</code> ä»…åœ¨çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è§¦å‘ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨è°ƒç”¨ <code>setState</code> æ—¶ã€‚</p>
<blockquote>
<p>è¯·é¿å…ä½¿ç”¨<a href="https://react.docschina.org/blog/2018/06/07/you-probably-dont-need-derived-state.html">æ´¾ç”Ÿ state</a>ã€‚</p>
</blockquote>
<h5>2.2.1 UNSAFE_componentWillReceiveProps</h5>
<blockquote>
<p>æ­¤ç”Ÿå‘½å‘¨æœŸä¹‹å‰åä¸º <code>componentWillReceiveProps</code>ã€‚è¯¥åç§°å°†ç»§ç»­ä½¿ç”¨è‡³ React 17ã€‚åœ¨ React 16.3 ä¹‹åï¼Œå®ƒçš„æ›¿ä»£è€…æ˜¯ <code>getDerivedStateFromProps</code>ã€‚</p>
</blockquote>
<p><code>UNSAFE_componentWillReceiveProps()</code> ä¼šåœ¨å·²æŒ‚è½½çš„ç»„ä»¶æ¥æ”¶æ–°çš„ <code>props</code> ä¹‹å‰è¢«è°ƒç”¨ã€‚å¦‚æœä½ éœ€è¦æ›´æ–°çŠ¶æ€ä»¥å“åº” <code>prop</code> æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œé‡ç½®å®ƒï¼‰ï¼Œä½ å¯ä»¥æ¯”è¾ƒ <code>this.props</code> å’Œ <code>nextProps</code> å¹¶åœ¨æ­¤æ–¹æ³•ä¸­ä½¿ç”¨ <code>this.setState()</code> æ‰§è¡Œ <code>state</code> è½¬æ¢ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœçˆ¶ç»„ä»¶å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿æ²¡æœ‰ <code>props</code> æ²¡æœ‰æ›´æ”¹ï¼Œä¹Ÿä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚å¦‚æœåªæ˜¯æƒ³å¤„ç†æ›´æ”¹ï¼Œè¯·ç¡®ä¿è¿›è¡Œå½“å‰å€¼ä¸å˜æ›´å€¼çš„æ¯”è¾ƒã€‚</p>
<p>åœ¨æŒ‚è½½è¿‡ç¨‹ï¼ŒReact ä¸ä¼šé’ˆå¯¹åˆå§‹ <code>props</code> è°ƒç”¨ <code>UNSAFE_componentWillReceiveProps()</code>ã€‚ç»„ä»¶åªä¼šåœ¨ç»„ä»¶çš„ <code>props</code> æ›´æ–°æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚è°ƒç”¨ <code>this.setState()</code> é€šå¸¸ä¸ä¼šè§¦å‘ <code>UNSAFE_componentWillReceiveProps()</code>ã€‚</p>
<h5>2.3 UNSAFE_componentWillMount</h5>
<blockquote>
<p>è¯¥ç”Ÿå‘½å‘¨æœŸä¹‹å‰åä¸º <code>componentWillMount</code>ï¼Œæ—§åç§°ä»å¯ä½¿ç”¨è‡³ React 17.</p>
</blockquote>
<p><code>UNSAFE_componentWillMount()</code> åœ¨ <code>constructor</code> ä¹‹åï¼Œ<code>render</code> ä¹‹å‰è¢«è°ƒç”¨ï¼Œå› æ­¤åœ¨æ­¤æ–¹æ³•ä¸­åŒæ­¥è°ƒç”¨ <code>setState()</code> ä¸ä¼šè§¦å‘é¢å¤–æ¸²æŸ“ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ <code>constructor()</code> æ¥åˆå§‹åŒ– stateã€‚</p>
<blockquote>
<p>é¿å…åœ¨æ­¤æ–¹æ³•å¼•å…¥ä»»ä½•å‰¯ä½œç”¨æˆ–è®¢é˜…ï¼Œè¯·æ”¾ç½®åœ¨ <code>componentDidMount()</code>ã€‚</p>
</blockquote>
<p><strong>æ­¤æ–¹æ³•æ˜¯æœåŠ¡ç«¯æ¸²æŸ“å”¯ä¸€ä¼šè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</strong></p>
<h5>2.4 render</h5>
<p><code>render()</code> æ–¹æ³•æ˜¯ class ç»„ä»¶ä¸­å”¯ä¸€å¿…é¡»å®ç°çš„æ–¹æ³•ã€‚</p>
<p>å½“ <code>render</code> è¢«è°ƒç”¨ï¼Œå®ƒä¼šæ£€æµ‹ <code>this.props</code> å’Œ <code>this.state</code> çš„å˜åŒ–å¹¶è¿”å›ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š</p>
<ul>
<li><strong>React å…ƒç´ </strong>ï¼šé€šå¸¸é€šè¿‡ JSX åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œ<code>&lt;div /&gt;</code> ä¼šè¢« React æ¸²æŸ“ä¸º DOM èŠ‚ç‚¹ï¼Œ<code>&lt;MyComponent /&gt;</code> ä¼šè¢« React æ¸²æŸ“ä¸ºè‡ªå®šä¹‰ç»„ä»¶ï¼Œæ— è®ºæ˜¯ <code>&lt;div /&gt;</code> è¿˜æ˜¯ <code>&lt;MyComponent /&gt;</code> å‡ä¸º React å…ƒç´ ã€‚</li>
<li>æ•°ç»„æˆ– fragmentsï¼šÂ ä½¿å¾— <code>render</code> æ–¹æ³•å¯ä»¥è¿”å›å¤šä¸ªå…ƒç´ ã€‚æ¬²äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Â <a href="https://zh-hans.reactjs.org/docs/fragments.html">fragments</a>Â æ–‡æ¡£ã€‚</li>
<li><strong>Portals</strong>ï¼šå¯ä»¥æ¸²æŸ“å­èŠ‚ç‚¹åˆ°ä¸åŒçš„ DOM å­æ ‘ä¸­ã€‚æ¬²äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ‰å…³Â <a href="https://zh-hans.reactjs.org/docs/portals.html">portals</a>Â çš„æ–‡æ¡£</li>
<li><strong>å­—ç¬¦ä¸²æˆ–æ•°å€¼ç±»å‹</strong>ï¼šå®ƒä»¬åœ¨ DOM ä¸­ä¼šè¢«æ¸²æŸ“ä¸ºæ–‡æœ¬èŠ‚ç‚¹</li>
<li><strong>å¸ƒå°”ç±»å‹æˆ–Â <code>null</code></strong>ï¼šä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ã€‚ï¼ˆä¸»è¦ç”¨äºæ”¯æŒè¿”å›Â <code>test &amp;&amp; &lt;Child /&gt;</code>Â çš„æ¨¡å¼ï¼Œå…¶ä¸­ <code>test</code> ä¸ºå¸ƒå°”ç±»å‹ã€‚)</li>
</ul>
<p><code>render()</code> å‡½æ•°åº”è¯¥ä¸ºçº¯å‡½æ•°ï¼Œè¿™æ„å‘³ç€åœ¨ä¸ä¿®æ”¹ç»„ä»¶ state çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶éƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œå¹¶ä¸”å®ƒä¸ä¼šç›´æ¥ä¸æµè§ˆå™¨äº¤äº’ã€‚</p>
<p>å¦‚éœ€ä¸æµè§ˆå™¨è¿›è¡Œäº¤äº’ï¼Œè¯·åœ¨ <code>componentDidMount()</code> æˆ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ‰§è¡Œä½ çš„æ“ä½œã€‚ä¿å­˜ <code>render()</code> ä¸ºçº¯å‡½æ•°ï¼Œå¯ä»¥ä½¿ç»„ä»¶æ›´å®¹æ˜“æ€è€ƒã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„éƒ½æ˜¯ï¼Œ<code>shouleComponentUpdate()</code> è¿”å› <code>false</code>ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ <code>render()</code>ã€‚</p>
</blockquote>
<h5>2.5 componentDidMount</h5>
<pre><code>componentDidMount()
</code></pre>
<p><code>componentDidMount()</code> ä¼šåœ¨ç»„ä»¶æŒ‚è½½åï¼ˆæ’å…¥ DOM æ ‘ä¸­ï¼‰ç«‹å³è°ƒç”¨ã€‚ä¾èµ–äº DOM èŠ‚ç‚¹çš„åˆå§‹åŒ–åº”è¯¥æ”¾åœ¨è¿™é‡Œã€‚å¦‚éœ€é€šè¿‡ç½‘ç»œè¯·æ±‚è·å–æ•°æ®ï¼Œæ­¤å¤„æ˜¯å®ä¾‹åŒ–è¯·æ±‚çš„å¥½åœ°æ–¹ã€‚</p>
<p>è¿™ä¸ªåœ°æ–¹æ˜¯æ¯”è¾ƒåˆé€‚æ·»åŠ è®¢é˜…ã€‚å¦‚æœæ·»åŠ äº†è®¢é˜…ï¼Œè¯·ä¸è¦å¿˜è®°åœ¨ <code>componentWillUnmount()</code> é‡Œå–æ¶ˆè®¢é˜…ã€‚</p>
<blockquote>
<p>ä½ å¯ä»¥åœ¨ <code>componentDidMount()</code> é‡Œç›´æ¥è°ƒç”¨ <code>setState()</code>ã€‚å®ƒå°†ä¼šè§¦å‘é¢å¤–æ¸²æŸ“ï¼Œä½†æ­¤æ¸²æŸ“ä¼šå‘ç”Ÿåœ¨æµè§ˆå™¨æ›´æ–°å±å¹•ä¹‹å‰ã€‚å¦‚æ­¤ä¿è¯äº†å³ä½¿åœ¨ render() ä¸¤æ¬¡è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°ä¸­é—´çŠ¶æ€ã€‚è¯·è°¨æ…ä½¿ç”¨è¯¥æ¨¡å¼ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚é€šå¸¸ï¼Œä½ åº”è¯¥åœ¨ <code>constructor()</code> ä¸­åˆå§‹åŒ– stateã€‚å¦‚æœä½ çš„æ¸²æŸ“ä¾èµ–äº DOM èŠ‚ç‚¹çš„å¤§å°æˆ–ä½ç½®ï¼Œæ¯”å¦‚å®ç° modals æˆ– tooltips ç­‰æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ­¤æ–¹å¼å¤„ç†ã€‚</p>
</blockquote>
<h3>ä¸‰ã€Updatingï¼ˆæ›´æ–°ï¼‰</h3>
<h5>3.1 shouldComponentUpdateï¼ˆä¸å¸¸ç”¨ï¼‰</h5>
<pre><code class="language-js">shouldComponentUpdate(nextProps, nextState)
</code></pre>
<p>æ ¹æ® <code>shouldComponentUpdate()</code> çš„è¿”å›å€¼ï¼Œåˆ¤æ–­ React ç»„ä»¶çš„è¾“å‡ºæ˜¯å¦å—å½“å‰ <code>state</code> æˆ– <code>props</code> æ›´æ”¹çš„å½±å“ã€‚é»˜è®¤è¡Œä¸ºæ˜¯ <code>state</code> æ¯æ¬¡å‘ç”Ÿå˜åŒ–ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥éµå¾ªé»˜è®¤è¡Œä¸ºã€‚</p>
<blockquote>
<p>å½“ <code>props</code> æˆ– <code>state</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>shouldComponentUpdate()</code> ä¼šåœ¨æ¸²æŸ“æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ã€‚è¿”å›å€¼é»˜è®¤ä¸º <code>true</code>ã€‚é¦–æ¬¡æ¸²æŸ“æˆ–ä½¿ç”¨ <code>forceUpdate()</code> æ—¶ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>
</blockquote>
<p>æ­¤æ–¹æ³•ä»…ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ–¹å¼è€Œå­˜åœ¨ã€‚ä¸è¦ä¼å›¾ä¾é æ­¤æ–¹æ³•æ¥â€œé˜»æ­¢â€æ¸²æŸ“ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šäº§ç”Ÿ bugã€‚ä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨å†…ç½®çš„ <a href="https://zh-hans.reactjs.org/docs/react-api.html#reactpurecomponent">PureComponent</a> ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ç¼–å†™ <code>shouldComponentUpdate()</code>ã€‚PureComponent ä¼šå¯¹ <code>props</code> å’Œ <code>state</code> è¿›è¡Œæµ…å±‚æ¯”è¾ƒï¼Œå¹¶å‡å°‘äº†è·³è¿‡å¿…è¦æ›´æ–°çš„å¯èƒ½æ€§ã€‚</p>
<p>å¦‚æœä½ ä¸€å®šè¦æ‰‹å†™ç¼–å†™æ­¤å‡½æ•°ï¼Œå¯ä»¥å°† <code>this.props</code> ä¸ <code>nextProps</code> ä»¥åŠ <code>this.state</code> ä¸ <code>nextState</code> è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å› <code>false</code> ä»¥å‘ŠçŸ¥ React å¯ä»¥è·³è¿‡æ›´æ–°ã€‚è¯·æ³¨æ„ï¼Œè¿”å› <code>false</code> å¹¶ä¸ä¼šé˜»æ­¢å­ç»„ä»¶åœ¨ <code>state</code> æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚</p>
<p>ä¸å»ºè®®åœ¨ <code>shouldComponentUpdate()</code> ä¸­è¿›è¡Œæ·±å±‚æ¯”è¾ƒæˆ–ä½¿ç”¨ <code>JSON.stringify()</code>ã€‚è¿™æ ·éå¸¸å½±å“æ•ˆç‡ï¼Œä¸”ä¼šæŸå®³æ€§èƒ½ã€‚</p>
<p>ç›®å‰ï¼Œå¦‚æœ <code>shouldComponentUpdate()</code> è¿”å› <code>false</code>ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ <code>UNSAFE_componentWillUpdate()</code>ã€<code>render()</code>ã€<code>componentDidUpdate()</code>ã€‚åç»­ç‰ˆæœ¬ï¼ŒReact å¯èƒ½ä¼šå°† <code>shouldComponentUpdate</code> è§†ä¸ºæç¤ºè€Œä¸æ˜¯ä¸¥æ ¼çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å½“è¿”å› <code>false</code> æ—¶ï¼Œä»å¯èƒ½å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</p>
<h5>3.2 UNSAFE_componentWillUpdateï¼ˆä¸å¸¸ç”¨ï¼‰</h5>
<pre><code class="language-js">UNSAFE_componentWillUpdate(nextProps, nextState)
</code></pre>
<blockquote>
<p>æ­¤ç”Ÿå‘½å‘¨æœŸä¹‹å‰åä¸º <code>componentWillUpdate</code>ã€‚è¯¥åç§°å°†ç»§ç»­ä½¿ç”¨è‡³ React 17ã€‚</p>
</blockquote>
<p>å½“ç»„ä»¶æ”¶åˆ°æ–°çš„ <code>props</code> æˆ– <code>state</code> æ—¶ï¼Œä¼šåœ¨æ¸²æŸ“ä¹‹å‰è°ƒç”¨ <code>UNSAFE_componentWillUpdate() </code>ã€‚ä½¿ç”¨æ­¤ä½œä¸ºæ›´æ–°å‘ç”Ÿä¹‹å‰æ‰§è¡Œå‡†å¤‡æ›´æ–°çš„å‡ ä¹ã€‚åˆå§‹æ¸²æŸ“ä¸ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚</p>
<p>æ³¨æ„ï¼Œä½ ä¸èƒ½æ­¤æ–¹æ³•ä¸­è°ƒç”¨ <code>setState()</code>ï¼›åœ¨ <code>UNSAFE_componentWillUpdate()</code> è¿”å›ä¹‹å‰ï¼Œä½ ä¸åº”è¯¥æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ï¼Œdispatch Redux çš„ actionï¼‰è§¦å‘å¯¹ React ç»„ä»¶çš„æ›´æ–°ã€‚</p>
<p>é€šå¸¸ï¼Œæ­¤æ–¹æ³•å¯ä»¥æ›¿æ¢ä¸º <code>componentDidUpdate()</code>ã€‚å¦‚æœä½ åœ¨æ­¤æ–¹æ³•ä¸­è¯»å– DOM ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†ä¿å­˜æ»šåŠ¨è¿ç« ï¼‰ï¼Œåˆ™å¯ä»¥å°†æ­¤é€»è¾‘ç§»è‡³ <code>getSnapShotBeforeUpdate()</code> ä¸­ã€‚</p>
<blockquote>
<p>å¦‚æœ <code>shouldComponentUpdate()</code> è¿”å› <code>false</code>ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ <code>UNSAFE_componentWillUpdate()</code>ã€‚</p>
</blockquote>
<h5>3.3 componentDidUpdate</h5>
<pre><code class="language-js">componentDidUpdate(prevProps, prevState, snapshot)
</code></pre>
<p><code>componentDidUpdate()</code> ä¼šåœ¨æ›´æ–°åè¢«ç«‹å³è°ƒç”¨ï¼Œä½†é¦–æ¬¡æ¸²æŸ“ä¸ä¼šæ‰§è¡Œæ­¤æ–¹æ³•ã€‚</p>
<p>å½“ç»„ä»¶æ›´æ–°åï¼Œå¯ä»¥åœ¨æ­¤å¤„å¯¹ DOM è¿›è¡Œæ“ä½œã€‚å¦‚æœä½ å¯¹æ›´æ–°å‰åçš„ <code>props</code> è¿›è¡Œäº†æ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨æ­¤å¤„è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚ï¼ˆä¾‹å¦‚ï¼Œå½“ <code>props</code> ä¸ºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚ï¼‰</p>
<pre><code class="language-jsx">componentDidUpdate(prevProps) {
  // å…¸å‹ç”¨æ³•ï¼ˆä¸è¦å¿˜è®°æ¯”è¾ƒ propsï¼‰
  // è‹¥ç›´æ¥ setState() ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚
  if (this.props.userID !== prevProps.userID) {
    this.fetchData(this.props.userID)
  }
}
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨ <code>componentDidUpdate()</code> ä¸­ç›´æ¥è°ƒç”¨ <code>setState()</code>ï¼Œä½†è¯·æ³¨æ„å®ƒå¿…é¡»è¢«åŒ…è£¹åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥é‡Œï¼Œæ­£å¦‚ä¸Šè¿°çš„ä¾‹å­é‚£æ ·è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚å®ƒè¿˜ä¼šå¯¼è‡´é¢å¤–çš„é‡æ–°æ¸²æŸ“ï¼Œè™½ç„¶ç”¨æˆ·ä¸å¯è§ï¼Œä½†ä¼šå½±å“ç»„ä»¶æ€§èƒ½ã€‚ä¸è¦å°† <code>props</code> â€œé•œåƒâ€ç»™ stateï¼Œè¯·è€ƒè™‘ç›´æ¥ä½¿ç”¨ <code>props</code>ã€‚</p>
<p>å¦‚æœç»„ä»¶å®ç°äº† <code>getSnapshotBeforeUpdate()</code> ç”Ÿå‘½å‘¨æœŸï¼ˆä¸å¸¸ç”¨ï¼‰ï¼Œåˆ™å®ƒçš„è¿”å›å€¼å°†ä½œä¸º <code>componentDidUpdate()</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•° <code>snapshot</code> ä¼ é€’ã€‚å¦åˆ™æ­¤å‚æ•°å°†ä¸º <code>undefined</code>ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>shouldComponentUpdate()</code> è¿”å›å€¼ä¸º <code>false</code>ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ <code>componentDidUpdate()</code>ã€‚</p>
</blockquote>
<h3>å››ã€Unmountingï¼ˆå¸è½½ï¼‰</h3>
<h5>4.1 componentWillUnmount</h5>
<p><code>componentWillUnmount()</code> ä¼šåœ¨ç»„ä»¶å¸è½½åŠé”€æ¯ä¹‹å‰ç›´æ¥è°ƒç”¨ã€‚åœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚æ¸…é™¤ timerï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚æˆ–æ¸…é™¤ <code>componentDidMount()</code> ä¸­åˆ›å»ºçš„è®¢é˜…ç­‰ã€‚</p>
<p><code>componentWillUnmount()</code> ä¸­ä¸åº”è°ƒç”¨ <code>setState()</code>ï¼Œå› ä¸ºè¯¥ç»„ä»¶å°†æ°¸è¿œä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚ç»„ä»¶å®ä¾‹å¸è½½åï¼Œå°†æ°¸è¿œä¸ä¼šå†æŒ‚è½½å®ƒã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¸¸è¯´çš„ç»„ä»¶é”€æ¯ï¼Œåªæ˜¯ç»„ä»¶ä»é¡µé¢ä¸­åˆ é™¤è€Œå·²ã€‚è€Œå¹¶ä¸æ„å‘³ç€å®ƒçœŸæ­£è¢«é”€æ¯ï¼Œè¢« GC å›æ”¶ã€‚æˆ‘ä»¬æ‰€å†™çš„ JSX å½¢å¼çš„ç»„ä»¶ï¼Œéƒ½ä¼šè¢« Babel è½¬åŒ–æˆ <code>React.createElement()</code> å½¢å¼çš„JS å¯¹è±¡ï¼ˆæ²¡é”™ï¼ŒReact ç»„ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼‰ã€‚å› æ­¤åªæœ‰å®ƒä¸å†è¢«å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶æ‰ä¼šå›æ”¶æ‰ï¼Œè¿™æ‰ç®—çœŸæ­£é”€æ¯ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦åš <code>componentWillUnmount</code> æ¸…é™¤å‰¯ä½œç”¨çš„åŸå› ã€‚</p>
</blockquote>
<h3>äº”ã€å…¶ä»–</h3>
<h5>5.1 defaultProps</h5>
<p><code>defaultProps</code> å¯ä»¥ä¸º Class ç»„ä»¶æ·»åŠ é»˜è®¤ <code>props</code>ã€‚è¿™ä¸€èˆ¬ç”¨äº <code>props</code> æœªèµ‹å€¼ï¼Œä½†åˆä¸èƒ½ä¸º <code>null</code> çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-jsx">class CustomButton extends Component {
  // ...
}

CustomButton.defaultProps = {
  type: 'primary'
}
</code></pre>
<p>åˆ©ç”¨ ES6 çš„ class é™æ€è¯­æ³•</p>
<pre><code class="language-jsx">class CustomButton extends Component {
  static defaultProps = {
    type: 'primary'
  }
  // ...
}
</code></pre>
<h5>5.2 ä¸€äº›é—®é¢˜</h5>
<p>React 16 ä¹‹åé‡‡ç”¨äº† Fiber æ¶æ„ï¼Œåªæœ‰ <code>componentDidMount</code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯ç¡®å®šè¢«æ‰§è¡Œä¸€æ¬¡çš„ï¼Œç±»ä¼¼ <code>ComponentWillMount</code> çš„ç”Ÿå‘½å‘¨æœŸé’©å­éƒ½æœ‰å¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œæ‰€ä»¥ä¸åŠ ä»¥åœ¨è¿™äº›ç”Ÿå‘½å‘¨æœŸä¸­åšæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œæ¯”å¦‚è¯·æ±‚æ•°æ®ä¹‹ç±»ã€‚</p>
<h5>3.3 componentDidCatch()</h5>
<p>æœªå®Œå¾…ç»­...</p>
<h3>äº”ã€é€æ­¥è¿ç§»è·¯å¾„</h3>
<p><a href="https://react.docschina.org/blog/2016/02/19/new-versioning-scheme.html">React éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶</a>ï¼Œå› æ­¤è¿™ç§å˜åŒ–å°†æ˜¯é€æ­¥çš„ã€‚æˆ‘ä»¬ç›®å‰çš„è®¡åˆ’æ˜¯ï¼š</p>
<ul>
<li><strong>16.3</strong>ï¼šä¸ºä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸå¼•å…¥åˆ«åï¼Œ<code>UNSAFE_componentWillMount</code>ã€<code>UNSAFE_componentWillReceiveProps</code>Â å’ŒÂ <code>UNSAFE_componentWillUpdate</code>ã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚ï¼‰</li>
<li><strong>æœªæ¥ 16.x ç‰ˆæœ¬</strong>ï¼šä¸ºÂ <code>componentWillMount</code>ã€<code>componentWillReceiveProps</code>Â å’ŒÂ <code>componentWillUpdate</code>Â å¯ç”¨åºŸå¼ƒå‘Šè­¦ã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å°†åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­å·¥ä½œï¼Œä½†æ˜¯æ—§çš„åç§°åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Šã€‚ï¼‰</li>
<li><strong>17.0</strong>ï¼šåˆ é™¤Â <code>componentWillMount</code>ã€<code>componentWillReceiveProps</code>Â å’ŒÂ <code>componentWillUpdate</code>ã€‚ï¼ˆåœ¨æ­¤ç‰ˆæœ¬ä¹‹åï¼Œåªæœ‰æ–°çš„ <code>UNSAFE_</code> ç”Ÿå‘½å‘¨æœŸåç§°å¯ä»¥ä½¿ç”¨ã€‚ï¼‰</li>
</ul>
<blockquote>
<p>è¿™é‡Œçš„ â€œunsafeâ€ ä¸æ˜¯æŒ‡å®‰å…¨æ€§ï¼Œè€Œæ˜¯è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç åœ¨ React çš„æœªæ¥ç‰ˆæœ¬ä¸­æ›´æœ‰å¯èƒ½å‡ºç° bugï¼Œå°¤å…¶æ˜¯åœ¨å¯ç”¨å¼‚æ­¥æ¸²æŸ“ä¹‹åã€‚</p>
</blockquote>
<h3>å…­ã€ç¤ºä¾‹</h3>
<blockquote>
<p>ç”±äºä½¿ç”¨æ–° APIï¼ˆå¦‚ <code>getDerivedStateFromProps</code>ã€<code>getSnapshotBeforeUpdate</code>ï¼‰æ—¶ï¼ŒReact ä¸ä¼šè°ƒç”¨ç»„ä»¶çš„ â€œunsafeâ€ ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ <code>UNSAFE_componentWillMount</code>ã€<code>UNSAFE_componentWillReceiveProps</code>ã€<code>UNSAFE_componentWillUpdate</code>ï¼‰ï¼Œå› æ­¤æš‚æ—¶å…ˆæ³¨é‡Šæ‰æ–° APIã€‚åŒæ—¶ä½¿ç”¨ï¼Œä¼šå‡ºç°ç±»ä¼¼å¦‚ä¸‹è­¦å‘Šâš ï¸ï¼š</p>
</blockquote>
<pre><code class="language-text">Warning: Unsafe legacy lifecycles will not be called for components using new component APIs.

LifeCycle uses getDerivedStateFromProps() but also contains the following legacy lifecycles:
  UNSAFE_componentWillMount

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-unsafe-component-lifecycles
</code></pre>
<p>ç¤ºä¾‹åŸºäº React 16.12.0 ç‰ˆæœ¬ã€‚</p>
<pre><code class="language-jsx">import React, { Component } from 'react'

export default class LifeCycle extends Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0
    }
    this.setCount = this.setCount.bind(this)
    console.log('---&gt; constructor')
  }

  static getDerivedStateFromProps(prevProps, prevState) {
    console.log('---&gt; getDerivedStateFromProps')
    return null
  }

  // ä¸ä¼šä¸ºä½¿ç”¨æ–°ç»„ä»¶ API çš„ç»„ä»¶è°ƒç”¨ä¸å®‰å…¨çš„é—ç•™ç”Ÿå‘½å‘¨æœŸã€‚
  // Warning: Unsafe legacy lifecycles will not be called for components using new component APIs.
  // LifeCycle uses getDerivedStateFromProps() but also contains the following legacy lifecycles: UNSAFE_componentWillMount
  // UNSAFE_componentWillMount() {
  //   console.log('---&gt; UNSAFE_component')
  // }

  componentDidMount() {
    console.log('---&gt; componentDidMount')
  }

  setCount() {
    this.setState({ count: this.state.count + 1 })
  }

  render() {
    console.log('---&gt; render')

    return (
      &lt;div&gt;
        &lt;div&gt;Count: {this.state.count}&lt;/div&gt;
        &lt;button onClick={this.setCount}&gt;Add&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>
<p>å½“é¦–æ¬¡åŠ è½½åŠ è½½æ—¶ï¼Œåˆ†åˆ«è§¦å‘äº†ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼Œæ‰“å°ç»“æœï¼š</p>
<pre><code class="language-text">---&gt; constructor
---&gt; UNSAFE_componentWillMount
---&gt; render
---&gt; componentDidMount
</code></pre>
<p>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®é€šè¿‡ <code>setState</code> æ›´æ–° <code>count</code> æ—¶ï¼Œä¼šè§¦å‘ä»¥ä¸‹åŠ¨ä½œï¼š</p>
<pre><code>---&gt; shouldComponentUpdate
---&gt; UNSAFE_componentWillUpdate
---&gt; render
---&gt; componentDidUpdate
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<h3>ä¸ƒã€å‚è€ƒ</h3>
<ul>
<li><a href="https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/">React Lifecycle Methods diagram</a></li>
<li><a href="https://juejin.cn/post/6844904021233238024">ä½ çœŸçš„äº†è§£ React ç”Ÿå‘½å‘¨æœŸå—</a></li>
<li><a href="https://zh-hans.reactjs.org/docs/strict-mode.html#detecting-unexpected-side-effects">æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[React æºç ä¹‹ createElement() è§£è¯»]]></title>
            <link>https://github.com/toFrankie/blog/issues/112</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/112</guid>
            <pubDate>Sat, 25 Feb 2023 13:01:01 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-704c65a797b0edaf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-704c65a797b0edaf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©ä¸€èµ·æ¥çœ‹ä¸‹ <code>React.createElement()</code> æ–¹æ³•</p>
<h3>React.createElement</h3>
<blockquote>
<p>ğŸ‘‰ <a href="https://zh-hans.reactjs.org/docs/react-api.html#createelement">ä¸­æ–‡</a> or <a href="https://reactjs.org/docs/react-api.html#createelement">è‹±æ–‡</a>æ–‡æ¡£</p>
</blockquote>
<p>React ä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ JSXï¼Œæ¯ä¸ª JSX å…ƒç´ åªæ˜¯è°ƒç”¨ <code>React.createElement(type, [props], [...children])</code> çš„è¯­æ³•ç³–ã€‚å› æ­¤ï¼Œä½¿ç”¨ JSX å¯ä»¥å®Œæˆçš„ä»»ä½•äº‹æƒ…éƒ½å¯ä»¥é€šè¿‡çº¯ JavaScript å®Œæˆã€‚</p>
<p>è¯­æ³•ï¼š</p>
<pre><code class="language-js">React.createElement(
  type,
  [props],
  [...children]
)
</code></pre>
<ul>
<li>
<p><code>type</code> å¯ä»¥æ˜¯æ ‡ç­¾åå­—ç¬¦ä¸²ï¼ˆå¦‚ div æˆ– span ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ React ç»„ä»¶ç±»å‹ï¼ˆclass ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶ï¼‰ï¼Œæˆ–è€…æ˜¯ React fragment ç±»å‹ã€‚</p>
</li>
<li>
<p><code>props</code> å¯é€‰ï¼Œç»„ä»¶å±æ€§</p>
</li>
<li>
<p><code>children</code> å¯é€‰ï¼Œå­å…ƒç´ ã€‚å«æœ‰å¤šä¸ªå­å…ƒç´ æ—¶ï¼Œæœ€ç»ˆ React Element çš„ <code>props.children</code> ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼šä½¿ç”¨ JSX ç¼–å†™ä»£ç ï¼š</p>
<pre><code class="language-jsx">class Hello extends React.Component {
  render() {
    return &lt;div&gt;Hello {this.props.toWhat}&lt;/div&gt;
  }
}

ReactDOM.render(
  &lt;Hello toWhat=&quot;World&quot; /&gt;,
  document.getElementById('root')
)
</code></pre>
<p>ä¹Ÿå¯ä»¥ç¼–å†™ä¸ä½¿ç”¨ JSX çš„ä»£ç ï¼š</p>
<pre><code class="language-js">class Hello extends React.Component {
  render() {
    return React.createElement(
      'div',
      null,
      `Hello ${this.prorps.toWhat}`
    )
  }
}

ReactDOM.render(
  React.createElement(Hello, { toWhat: 'World' }, null),
  document.getElementById('root')
)
</code></pre>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤š JSX è½¬æ¢ä¸º JavaScript çš„ç¤ºä¾‹ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨<a href="https://babeljs.io/repl/#?presets=react&amp;code_lz=GYVwdgxgLglg9mABACwKYBt1wBQEpEDeAUIogE6pQhlIA8AJjAG4B8AEhlogO5xnr0AhLQD0jVgG4iAXyJA">åœ¨çº¿ Babel ç¼–è¯‘å™¨</a>ã€‚</p>
<h3>çœ‹æºç </h3>
<pre><code class="language-js">function createElement(type, config, children) {
  var propName;

  // Reserved names are extracted
  var props = {};

  // ä¸€äº›ä¿ç•™çš„å±æ€§
  var key = null;
  var ref = null;
  var self = null;
  var source = null;

  // æå– keyã€refã€selfã€sourceã€prop
  if (config != null) {
    // å°†åˆæ³•çš„ ref èµ‹å€¼ç»™ ref å˜é‡
    if (hasValidRef(config)) {
      ref = config.ref;

      {
        warnIfStringRefCannotBeAutoConverted(config);
      }
    }

    // å°†åˆæ³•çš„ key è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¹¶èµ‹å€¼ç»™å˜é‡ key
    if (hasValidKey(config)) {
      key = '' + config.key;
    }

    self = config.__self === undefined ? null : config.__self;
    source = config.__source === undefined ? null : config.__source;

    // Remaining properties are added to a new props object
    // å°† config ä¸­é™¤ keyã€refã€__selfã€__source ä¹‹å¤–çš„ prop æå–å‡ºæ¥ï¼Œå¹¶æ”¾å…¥ props å˜é‡ä¸­
    for (propName in config) {
      if (hasOwnProperty$1.call(config, propName) &amp;&amp; !RESERVED_PROPS.hasOwnProperty(propName)) {
        props[propName] = config[propName];
      }
    }
  }

  // Children can be more than one argument, and those are transferred onto
  // the newly allocated props object.
  // å…¥å‚çš„å‰ä¸¤ä¸ª type å’Œ configï¼Œå‰©ä½™çš„éƒ½æ˜¯ children å‚æ•°ã€‚æ‰€ä»¥å‡ 2
  var childrenLength = arguments.length - 2;

  if (childrenLength === 1) {
    // åªæœ‰ä¸€ä¸ªå­å…ƒç´ æ—¶ï¼Œç›´æ¥æŒ‚åˆ° props.children ä¸‹ï¼ˆéæ•°ç»„å½¢å¼ï¼‰
    props.children = children;
  } else if (childrenLength &gt; 1) {
    // å­å…ƒç´ å¤šäºä¸€ä¸ªæ—¶ï¼Œå°†å®ƒä»¬éƒ½æ”¾å…¥æ•°ç»„ä¸­ï¼Œç„¶åæŒ‚åˆ° props.children ä¸‹ï¼ˆæ•°ç»„å½¢å¼ï¼‰
    var childArray = Array(childrenLength);

    for (var i = 0; i &lt; childrenLength; i++) {
      childArray[i] = arguments[i + 2];
    }

    {
      // å†»ç»“å­å…ƒç´ åˆ—è¡¨
      if (Object.freeze) {
        Object.freeze(childArray);
      }
    }

    props.children = childArray;
  }

  // Resolve default props
  // å–å‡ºç»„ä»¶ç±»ï¼ˆå³ type ä¸ä¸ºå­—ç¬¦ä¸²çš„æƒ…å†µï¼‰ä¸­çš„é™æ€å±æ€§ defaultPropsï¼Œå¹¶ç»™æœªåœ¨ JSX ä¸­è®¾ç½®å€¼çš„å±æ€§è®¾ç½®é»˜è®¤å€¼ã€‚
  if (type &amp;&amp; type.defaultProps) {
    var defaultProps = type.defaultProps;

    for (propName in defaultProps) {
      // æ³¨æ„ä¸‹ï¼Œè‹¥å±æ€§å€¼ä¸º null å¹¶ä¸ä¼šè§¦å‘è®¾ç½®é»˜è®¤å€¼çš„å¤„ç†ï¼Œä»… undefinedã€‚
      if (props[propName] === undefined) {
        props[propName] = defaultProps[propName];
      }
    }
  }

  {
    // ä»¥ä¸‹æ­¥éª¤ä¸»è¦æ˜¯é¿å…ä¸€äº›ä¿ç•™å±æ€§è¢«é”™è¯¯å–åˆ°ï¼Œæä¾›è­¦å‘Š
    if (key || ref) {
      var displayName = typeof type === 'function' ? type.displayName || type.name || 'Unknown' : type;

      if (key) {
        defineKeyPropWarningGetter(props, displayName);
      }

      if (ref) {
        defineRefPropWarningGetter(props, displayName);
      }
    }
  }

  // è°ƒç”¨ ReactElement æ„å»ºå…ƒç´ ï¼Œå¹¶è¿”å›
  // type æ˜¯ç›´æ¥é€ä¼ çš„ï¼Œ
  // keyã€ref ç­‰ç­‰éƒ½æ˜¯ä» config é‡Œé¢è§£æå‡ºæ¥çš„ï¼Œprops æ˜¯é™¤å»ä¸€äº›ä¿ç•™å±æ€§ä¹‹å¤–åœ¨ config ä¸Šè¯»å–çš„å±æ€§
  // children æ˜¯å­å…ƒç´ ï¼Œå¤šä¸ªæ—¶è¿”å›æ•°ç»„
  return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);
}
</code></pre>
<p>æ¥ç€çœ‹ ReactElement æºç ï¼š</p>
<pre><code class="language-js">/**
 * Factory method to create a new React element. This no longer adheres to
 * the class pattern, so do not use new to call it. Also, instanceof check
 * will not work. Instead test $$typeof field against Symbol.for('react.element') to check
 * if something is a React Element.
 *
 * @param {*} type
 * @param {*} props
 * @param {*} key
 * @param {string|object} ref
 * @param {*} owner
 * @param {*} self A *temporary* helper to detect places where `this` is
 * different from the `owner` when React.createElement is called, so that we
 * can warn. We want to get rid of owner and replace string `ref`s with arrow
 * functions, and as long as `this` and owner are the same, there will be no
 * change in behavior.
 * @param {*} source An annotation object (added by a transpiler or otherwise)
 * indicating filename, line number, and/or other information.
 * @internal
 */
var ReactElement = function (type, key, ref, self, source, owner, props) {
  // æˆ‘ä»¬æš‚æ—¶æŠŠä¸‹é¢çš„ä»£ç æŠ˜å ï¼Œå¯ä»¥çœ‹åˆ° ReactElement æ–¹æ³•æœ€åè¿”å›çš„å°±æ˜¯ element å¯¹è±¡
  var element = {
    // This tag allows us to uniquely identify this as a React Element
    // é€šè¿‡è¿™ä¸ªæ ‡ç­¾æ¥è¯†åˆ«reactçš„å…ƒç´ ï¼ˆä¸€ä¸ª Symbolï¼‰
    $$typeof: REACT_ELEMENT_TYPE,

    // Built-in properties that belong on the element
    // å†…ç½®å±æ€§
    type: type,
    key: key,
    ref: ref,
    props: props,

    // Record the component responsible for creating this element.
    // è®°å½•åˆ›å»ºè¯¥ç»„ä»¶çš„ç»„ä»¶
    _owner: owner
  };

  {
    // The validation flag is currently mutative. We put it on
    // an external backing store so that we can freeze the whole object.
    // This can be replaced with a WeakMap once they are implemented in
    // commonly used development environments.
    // è¿™ä¸ªéªŒè¯æ ‡å¿—æ˜¯å¯å˜çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ”¾åœ¨å¤–éƒ¨æ”¯æŒå­˜å‚¨ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿå†»ç»“æ•´ä¸ªå¯¹è±¡ï¼Œ
    element._store = {};

    // To make comparing ReactElements easier for testing purposes, we make
    // the validation flag non-enumerable (where possible, which should
    // include every environment we run tests in), so the test framework
    // ignores it.
    // ä¸ºäº†æ›´åŠ æ–¹ä¾¿åœ°è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªä¸å¯æšä¸¾çš„éªŒè¯æ ‡å¿—ä½ï¼Œä»¥ä¾¿æµ‹è¯•æ¡†æ¶å¿½ç•¥å®ƒ
    // ç»™ _store è®¾ç½® validated å±æ€§ false
    Object.defineProperty(element._store, 'validated', {
      configurable: false,
      enumerable: false,
      writable: true,
      value: false
    });

    // self and source are DEV only properties.
    // self å’Œ source éƒ½æ˜¯å¼€å‘ç¯å¢ƒæ‰å­˜åœ¨çš„
    Object.defineProperty(element, '_self', {
      configurable: false,
      enumerable: false,
      writable: false,
      value: self
    });

    // Two elements created in two different places should be considered
    // equal for testing purposes and therefore we hide it from enumeration.
    // ä¸¤ä¸ªå†ä¸åŒåœ°æ–¹åˆ›å»ºçš„å…ƒç´ ä»æµ‹è¯•çš„è§’åº¦æ¥çœ‹æ˜¯ç›¸ç­‰çš„ï¼Œæˆ‘ä»¬åœ¨åˆ—ä¸¾çš„æ—¶å€™å¿½ç•¥ä»–ä»¬
    Object.defineProperty(element, '_source', {
      configurable: false,
      enumerable: false,
      writable: false,
      value: source
    });

    // å¦‚æœ Object æœ‰ freeze çš„å®ç°ï¼Œæˆ‘ä»¬å†»ç»“å…ƒç´ å’Œå®ƒçš„å±æ€§
    if (Object.freeze) {
      Object.freeze(element.props);
      Object.freeze(element);
    }
  }

  return element;
};
</code></pre>
<p>æ³¨æ„ï¼ŒReact å†…éƒ¨æ˜¯ä½¿ç”¨ <code>$$typeof</code> æ¥åˆ¤æ–­ react å…ƒç´ çš„ç±»å‹çš„ã€‚ä½¿ç”¨ <code>_store</code> æ¥è®°å½•å†…éƒ¨çš„çŠ¶æ€ï¼Œåé¢ä¼šæœ‰ç”¨åˆ°ã€‚ä¸ºäº†æ–¹ä¾¿æµ‹è¯•æ¡†æ¶ï¼Œ<code>_store</code> ä¸­å®šä¹‰äº†ä¸å¯é…ç½®ä¸å¯æšä¸¾çš„ <code>validated</code> å±æ€§ã€‚ç±»ä¼¼çš„ï¼Œæ¡†æ¶å†…éƒ¨å®šä¹‰äº† <code>self</code> å’Œ <code>source</code> çš„å‰¯æœ¬ <code>_self</code> å’Œ <code>_source</code>ï¼Œä»–ä»¬éƒ½æ˜¯ä¸å¯é…ç½®ä¸å¯æšä¸¾ä¸å¯å†™çš„ã€‚</p>
<p>æœ€è¿‘åœ¨é‡æ–°å­¦ä¹  Reactï¼Œä¹Ÿä¼šå»çœ‹ä¸€äº›æºç ä»€ä¹ˆçš„ï¼Œåœ¨ GitHub ä¸Šå»ºäº†ä¸ªä»“åº“ï¼ˆ<a href="https://github.com/toFrankie/react-learn">react-learn</a>ï¼‰å»è®°å½•å­¦ä¹ çš„ä¸œè¥¿ï¼Œç„¶åæŠŠå…¶ä¸­çš„ä¸€äº›æŒ‘é€‰å‡ºæ¥å‘æ–‡äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Warning: This synthetic event is reused for performance reasons.]]></title>
            <link>https://github.com/toFrankie/blog/issues/111</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/111</guid>
            <pubDate>Sat, 25 Feb 2023 13:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d0777f437fe0f376.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d0777f437fe0f376.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¯èƒ½å¤§å®¶åœ¨ react å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°ä»¥ä¸‹æŠ¥é”™ï¼š</p>
<blockquote>
<p>Warning: This synthetic event is reused for performance reasons. If you're seeing this, you're accessing the property <code>target</code> on a released/nullified synthetic event. This is set to null. If you must keep the original synthetic event around, use event.persist(). See <a href="https://fb.me/react-event-pooling">https://fb.me/react-event-pooling</a> for more information.</p>
</blockquote>
<h3>ä¾‹å­</h3>
<pre><code class="language-jsx">// å…¶ä»–æ— å…³ç´§è¦éƒ¨åˆ†çœç•¥äº†
&lt;input onChange={event =&gt; {
  console.log(event.type)  // change
  setTimeout(() =&gt; {
    console.log(event.type)  // nullï¼Œå¹¶ä¼šå‡ºç°ä»¥ä¸Šè­¦å‘Š
  })
}} /&gt;
</code></pre>
<h3>Why</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºå°†ä¼ é€’ <code>SyntheticEvent</code> å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè·¨æµè§ˆå™¨åŸç”Ÿäº‹ä»¶åŒ…è£…å™¨ã€‚å®ƒå…·æœ‰ä¸æµè§ˆå™¨åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ï¼ŒåŒ…æ‹¬ <code>stopPropagation()</code> å’Œ <code>preventDefault()</code>ï¼Œé™¤äº†äº‹ä»¶åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­å®ƒä»¬çš„å·¥ä½œæ–¹å¼éƒ½ç›¸åŒ</p>
<p>æ¯ä¸ª <code>SyntheticEvent</code> å¯¹è±¡éƒ½å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</p>
<pre><code>boolean bubbles
boolean cancelable
DOMEventTarget currentTarget
boolean defaultPrevented
number eventPhase
boolean isTrusted
DOMEvent nativeEvent
void preventDefault()
boolean isDefaultPrevented()
void stopPropagation()
boolean isPropagationStopped()
DOMEventTarget target
number timeStamp
string type
</code></pre>
<p><code>SyntheticEvent</code> å¯¹è±¡æ˜¯é€šè¿‡åˆå¹¶å¾—åˆ°çš„ã€‚å‡ºäºæ€§èƒ½åŸå› çš„è€ƒè™‘ï¼Œ<code>SyntheticEvent</code> å¯¹è±¡å°†è¢«é‡ç”¨å¹¶ä¸”æ‰€æœ‰å±æ€§éƒ½å°†è¢«å–æ¶ˆï¼Œå› æ­¤ï¼Œæ— æ³•ä»¥å¼‚æ­¥æ–¹å¼è®¿é—®è¯¥äº‹ä»¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼‚æ­¥è®¿é—® <code>event.type</code> æ—¶ä¼šå¾—åˆ° <code>null</code> å€¼ï¼Œé‚£ä¹ˆæ€ä¹ˆç ´å‘¢ï¼Ÿ</p>
<blockquote>
<p>å¦‚æœè¦ä»¥å¼‚æ­¥æ–¹å¼è®¿é—®äº‹ä»¶å±æ€§ï¼Œåº”è¯¥å¯¹äº‹ä»¶è°ƒç”¨ <code>event.persist()</code>ï¼Œè¿™å°†ä»æ± ä¸­åˆ é™¤åˆæˆäº‹ä»¶ï¼Œå¹¶å…è®¸ç”¨æˆ·ä»£ç ä¿ç•™å¯¹äº‹ä»¶çš„å¼•ç”¨ã€‚</p>
</blockquote>
<h3>å¼‚æ­¥è°ƒç”¨æ–¹å¼</h3>
<pre><code class="language-jsx">// å…¶ä»–æ— å…³ç´§è¦éƒ¨åˆ†çœç•¥äº†
&lt;input onChange={event =&gt; {
  console.log(event.type)  // change
  event.persist()
  setTimeout(() =&gt; {
    console.log(event.type)  // changeï¼Œèƒ½æ­£å¸¸è®¿é—®äº†
  })
}} /&gt;
</code></pre>
<h3>å‚è€ƒ</h3>
<p>æ›´è¯¦ç»†è¯·æŸ¥çœ‹ <a href="http://react.html.cn/docs/events.html">åˆæˆäº‹ä»¶(SyntheticEvent)</a>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[LeetCode å­—ç¬¦ä¸²ååº]]></title>
            <link>https://github.com/toFrankie/blog/issues/110</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/110</guid>
            <pubDate>Sat, 25 Feb 2023 12:59:03 GMT</pubDate>
            <description><![CDATA[<ol>
<li>æ•´æ•°åè½¬</li>
</ol>
<pre><code class="language-js">/**
 * æ•´æ•°åè½¬
 * @param {Number} num æ‰€æ±‚æ•´æ•°
 * @returns {String} è¿”å›å­—ç¬¦ä¸²ç±»å‹
 */
function intReverse(num) {
    ]]></description>
            <content:encoded><![CDATA[<ol>
<li>æ•´æ•°åè½¬</li>
</ol>
<pre><code class="language-js">/**
 * æ•´æ•°åè½¬
 * @param {Number} num æ‰€æ±‚æ•´æ•°
 * @returns {String} è¿”å›å­—ç¬¦ä¸²ç±»å‹
 */
function intReverse(num) {
    let i = num / 10
    let j = num % 10
    if (i &lt; 1) {
        // å°äº 10 ç›´æ¥è¿”å›
        return num.toString()
    } else {
        let nextNum = Math.floor(i)
        // è¦é‡‡ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦åˆ™å°±æ±‚å’Œäº†
        return `${j}${intReverse(nextNum)}`
    }
}

let num = 123456
console.log(intReverse(num))        // 654321
console.log(typeof intReverse(num)) // string
</code></pre>
<ol start="2">
<li>å­—ç¬¦ä¸²æ•°ç»„åè½¬</li>
</ol>
<blockquote>
<p>è¿™é‡Œä¸è®¨è®º <code>Array.prototype.reverse.call(someArray)</code> æˆ– <code>Array.prototype.reverse.apply(someArray)</code>ã€‚</p>
</blockquote>
<pre><code class="language-js">/**
 * å­—ç¬¦ä¸²æ•°ç»„åè½¬
 * @param {character[]} arr
 * @return {void} Do not return anything, modify arr in-place instead.
 */
function reverseString(arr) {
    let len = arr.length
    if (len &lt;= 1) return
    // æ•°ç»„é•¿åº¦ä¸ºå¥‡æ•°æ—¶ï¼Œä¸­é—´å…ƒç´ æ— éœ€å¤„ç†
    for (let i = 0, j = len - 1; i &lt; len / 2; i++, j--) {
        let temp = arr[i]
        arr[i] = arr[j]
        arr[j] = temp
    }
}

let num = ['h', 'e', 'l', 'l', 'o']
reverseString(num)
console.log(num)    // ['o', 'l', 'l', 'e', 'h']

// while å¾ªç¯å¤„ç†
// function reverseString(arr) {
//     let len = arr.length
//     if (len &lt;= 1) return
//     let i = 0, j = len - 1
//     while (i &lt; j) {
//         let temp = arr[i]
//         arr[i] = arr[j]
//         arr[j] = temp
//         i++
//         j--
//     }
// }
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mercurial ä½¿ç”¨è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/109</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/109</guid>
            <pubDate>Sat, 25 Feb 2023 12:56:02 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702748536703.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p><a href="https://www.mercurial-scm.org]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702748536703.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<p><a href="https://www.mercurial-scm.org/">Mercurial</a> è·Ÿ Git ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå®ƒä½¿ç”¨æ±çš„åŒ–å­¦å…ƒç´ ç¬¦å·ã€ŒHgã€çš„å°å†™å½¢å¼  <code>hg</code> ä½œä¸ºå‘½ä»¤ã€‚</p>
<h2>å®‰è£…</h2>
<p>ä½¿ç”¨ Homebrew è¿›è¡Œå®‰è£…ï¼Œå…¶ä»–æ–¹å¼è¯·çœ‹<a href="https://www.mercurial-scm.org/downloads">è¿™é‡Œ</a>ã€‚</p>
<pre><code class="language-shell">$ brew install mercurial
</code></pre>
<h2>åˆå§‹åŒ–</h2>
<p>åœ¨å…¨å±€é…ç½®æ–‡ä»¶ <code>~/.hgrc</code>ï¼ˆè‹¥æ— åˆ™æ–°å¢ï¼‰ï¼Œé…ç½®æäº¤è€…çš„ç”¨æˆ·åå’Œé‚®ç®±ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-ini">[ui]
username = Frankie &lt;frankie@example.com&gt;
</code></pre>
<blockquote>
<p>Use <code>hg config</code> to configure a user name, email address, editor, and other preferences once per machine.</p>
</blockquote>
<pre><code class="language-shell">$ hg init

# or
$ hg clone &lt;repo-address&gt; [repo-name]
</code></pre>
<p>å¿½ç•¥æ–‡ä»¶ <code>.hgignore</code> æ”¯æŒ <code>regexp</code> å’Œ <code>glob</code> ä¸¤ç§è¯­æ³•ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-ini">syntax: glob

.vscode
.DS_Store

*.swp
*.orig
</code></pre>
<blockquote>
<p>Related Link: <a href="https://www.selenic.com/mercurial/hgignore.5.html">Syntax for Mercurial ignore files</a></p>
</blockquote>
<h2>åˆ†æ”¯æ“ä½œ</h2>
<h3>åˆ›å»ºåˆ†æ”¯</h3>
<pre><code class="language-shell">$ hg branch &lt;branch-name&gt;
</code></pre>
<blockquote>
<p>ä¸€ä¸ªåˆšåˆ›å»ºçš„åˆ†æ”¯ï¼Œè‡³å°‘ commit ä¸€æ¬¡ï¼Œåˆ†æ”¯æ‰ç®—çœŸæ­£è¢«åˆ›å»ºã€‚å¯ä»¥è€ƒè™‘æäº¤ä¸€ä¸ªç©º commitï¼Œæ¯”å¦‚ï¼š<code>hg commit -m &quot;create '&lt;branch-name&gt;' branch&quot;</code>ã€‚</p>
</blockquote>
<h3>æŸ¥çœ‹åˆ†æ”¯</h3>
<pre><code class="language-shell"># æŸ¥çœ‹å½“å‰åˆ†æ”¯
$ hg branch

# æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯
$ hg branches
</code></pre>
<h3>åˆ‡æ¢åˆ†æ”¯</h3>
<pre><code class="language-shell">$ hg checkout &lt;branch-name&gt;
</code></pre>
<p>å‡è®¾æœ‰åˆ†æ”¯ A å’Œåˆ†æ”¯ B åŒæ—¶åœ¨å¼€å‘ï¼Œéœ€è¦æ¥å›åˆ‡æ¢ï¼Œä½†å½“å‰åˆ†æ”¯åŠŸèƒ½æœªå¼€å‘å®Œæˆåˆä¸å¥½ commitï¼Œè¿™ç§åœºæ™¯å¯ä»¥è€ƒè™‘ shelveã€‚</p>
<p>åœ¨ Git ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>git stash</code> å°†æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼ˆå·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼‰ä¿å­˜è‡³å †æ ˆä¸­ï¼Œç”¨äºåç»­æ¢å¤å½“å‰å·¥ä½œç›®å½•ã€‚Mercurial ä¹Ÿæœ‰ç±»ä¼¼çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">$ hg shelve --name &lt;name&gt;
$ hg unshelve &lt;name&gt;
</code></pre>
<p>å…¶ä¸­ <code>--name</code> å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ç®€å†™ä¸º <code>-n</code>ã€‚</p>
<h3>åˆå¹¶åˆ†æ”¯</h3>
<pre><code class="language-shell">$ hg merge &lt;branch-name&gt;
</code></pre>
<blockquote>
<p>åˆå¹¶ååˆ«å¿˜äº† commitã€‚</p>
</blockquote>
<p>å¦‚æœåæ‚”äº†ï¼Œæƒ³å–æ¶ˆæœªæäº¤çš„åˆå¹¶ï¼ˆå˜æ›´ä¸ä¼šä¸¢å¤±ï¼‰</p>
<pre><code class="language-shell">$ hg merge --abort
</code></pre>
<p>è¿˜æœ‰æœ‰ä¸€ç§åœºæ™¯ï¼Œå‡è®¾ä½ åœ¨åˆå¹¶åˆ†æ”¯ï¼Œä½†å¦å¤–ä¸€ä¸ªåŒå­¦åˆ push äº†æ–°çš„å˜æ›´ä¸Šæ¥ï¼Œå½“ä½ åˆå¹¶å®Œæˆï¼Œæ˜¯æ¨ä¸ä¸Šå»ã€‚æœ‰ä¸€ä¸ªå¾ˆå±é™©çš„æ“ä½œï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼š</p>
<pre><code class="language-shell">$ hg update --clean
</code></pre>
<blockquote>
<p>âš ï¸ è¯·æ³¨æ„ <code>--clean</code> ä¼šä¸¢æ‰æ‰€æœ‰ uncommited çš„å˜æ›´ï¼ˆåŒ…æ‹¬ shelve çš„å†…å®¹ï¼‰ã€‚å¦‚æœæ˜¯ untracked files åˆ™ä¸ä¼šè¢«åˆ é™¤ã€‚</p>
</blockquote>
<blockquote>
<p>Related Link: <a href="https://www.mercurial-scm.org/doc/hg.1.html#update">hg update</a></p>
</blockquote>
<h3>å…³é—­åˆ†æ”¯</h3>
<p>ä¸€ä¸ªä»“åº“é€šå¸¸æœ‰ Master å’Œ Develop ä¸¤ä¸ªä¸»å¹²åˆ†æ”¯ï¼Œè¿˜åº”è¯¥æœ‰ Featureã€Releaseã€Hotfix ç­‰è¾…åŠ©åˆ†æ”¯ã€‚å½“è¾…åŠ©åˆ†æ”¯å®Œæˆä½¿å‘½åï¼Œå®ƒä»¬å°†ä¼šè¢«åˆå¹¶è‡³ä¸»å¹²åˆ†æ”¯ï¼Œå†è¿›è¡Œåˆ é™¤ã€‚</p>
<p>åœ¨ Git é‡Œå¯ä»¥é€šè¿‡ <code>git branch -d &lt;branch-name&gt;</code> æˆ– <code>git push origin --delete &lt;branch-name&gt;</code> ç­‰æ–¹å¼åˆ é™¤æœ¬åœ°åˆ†æ”¯æˆ–è¿œç¨‹åˆ†æ”¯ã€‚</p>
<p><strong>ä½† Mercurial é‡Œæ²¡æœ‰åˆ é™¤åˆ†æ”¯çš„æ¦‚å¿µ</strong>ã€‚Mercurial åˆ™ç”¨ã€Œå…³é—­ã€çš„æ¦‚å¿µæ¥è¡¨ç¤ºä¸€ä¸ªåˆ†æ”¯çš„ç»“æŸã€‚å¦‚æœä¸€ä¸ªåˆ†æ”¯è¯¥ç»“æŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥æäº¤ä¸€ä¸ªç©ºçš„ Commit æ¥å…³é—­å®ƒï¼ˆéœ€åŠ ä¸Š <code>--close-branch</code> å‚æ•°ï¼‰ï¼Œæ¯”å¦‚ <code>hg commit -m 'xxx' --close-branch</code>ã€‚å¦‚æœåœ¨å·²å…³é—­çš„åˆ†æ”¯ä¸Šæäº¤æ–°çš„ Commitï¼Œè¯¥åˆ†æ”¯ä¼š Reopenã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå°† <code>feature</code> åˆå¹¶è‡³ <code>default</code>ï¼ŒåŒæ—¶å…³é—­ <code>feature</code> åˆ†æ”¯ï¼š</p>
<pre><code class="language-shell"># 1. åœ¨ feature åˆ†æ”¯æäº¤ä¸€ä¸ªç©º Commit æ¥å…³é—­å½“å‰åˆ†æ”¯
$ hg commit -m 'xxx' --close-branch

# 2. åˆ‡æ¢è‡³ default åˆ†æ”¯
$ hg checkout default

# 3. åˆå¹¶ feature
$ hg merge feature

# 4. æäº¤æœ¬æ¬¡åˆå¹¶
$ hg commit -m 'xxx'

# 5. æ¨åˆ°è¿œç«¯
$ hg push
</code></pre>
<h3>ä»£ç åˆå¹¶å·¥å…·</h3>
<p>ç¯‡å¹…å¯èƒ½æœ‰ç‚¹é•¿ï¼Œå¦èµ·ç« èŠ‚ï¼Œæ”¾åœ¨æ–‡æœ«ã€‚</p>
<h2>ä»£ç æäº¤</h2>
<pre><code class="language-shell"># æ™®é€šæäº¤
$ hg commit -m 'some message...'

# ç©º commit æäº¤
$ hg commit -m 'some message...' --config ui.allowemptycommit=1
</code></pre>
<p>åˆšåˆ›å»ºçš„åˆ†æ”¯ï¼Œæ˜¯å¯ä»¥ç›´æ¥ <code>hg commit -m 'xxx'</code> æäº¤ä¸€ä¸ªç©º Commit çš„ã€‚ä½†åœ¨å·²æœ‰ Commit Log çš„åˆ†æ”¯ä¸Šï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œç›´æ¥æäº¤ç©º Commit ä¼šå¤±è´¥å¹¶æç¤º <code>nothing changed</code>ã€‚é’ˆå¯¹æœ‰éœ€è¦æäº¤ç©º Commit çš„åœºæ™¯ï¼Œå¯ä»¥åœ¨æœ«å°¾åŠ ä¸Š <code>--config ui.allowemptycommit=1</code>ã€‚</p>
<p>æ’¤é”€ä¸Šä¸€ä¸ªæäº¤</p>
<pre><code class="language-shell">$ hg rollback
</code></pre>
<h2>ä»£ç æ¨é€</h2>
<pre><code class="language-shell">$ hg push
</code></pre>
<blockquote>
<p>è‹¥æ¨é€è¿œç¨‹ä»“åº“ä¸­è¿˜æ²¡æœ‰çš„æ–°åˆ†æ”¯ï¼Œéœ€è¦åŠ ä¸Š <code>--new-branch</code> å‚æ•°ã€‚</p>
</blockquote>
<h2>ä»£ç æ‹‰å–ä¸æ›´æ–°</h2>
<pre><code class="language-shell"># æ‹‰å–ä»£ç ï¼ˆç±»ä¼¼ git fetchï¼‰
$ hg pull

# æ‹‰å–ä»£ç åï¼Œæ›´æ–°æœ¬åœ°åˆ†æ”¯
$ hg update
</code></pre>
<p>ä»¥ä¸Šä¸¤æ­¥ç­‰ä»·äº</p>
<pre><code class="language-shell">$ hg pull -u
</code></pre>
<h2>æŸ¥çœ‹æäº¤è®°å½•</h2>
<pre><code class="language-shell">$ hg log

# åˆ†æ”¯å›¾å½¢åŒ– --graph
$ hg log -G

# æŒ‡å®šæ–‡ä»¶
$ hg log /path/to/file

$ å« patch å·®å¼‚ --patch
$ hg log -p 
</code></pre>
<p>æ›´å¤š <code>hg log -h</code> æˆ–è¯·çœ‹<a href="https://swcarpentry.github.io/hg-novice/12-merges/">è¿™é‡Œ</a>ã€‚</p>
<h2>å–æ¶ˆæ–‡ä»¶è·Ÿè¸ª</h2>
<p>é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šå°†ä¸éœ€è¦æäº¤åˆ°è¿œç¨‹ä»“åº“çš„æ–‡ä»¶æˆ–ç›®å½•æ·»åŠ åˆ° <code>.hgignore</code> æ–‡ä»¶ä¸­ã€‚å¯¹äºå·²è·Ÿè¸ªçš„æ–‡ä»¶ï¼ˆtracked fileï¼‰ï¼Œè‹¥è¦å–æ¶ˆæŸä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„è·Ÿè¸ªï¼Œåªæ›´æ–° <code>.hgigonre</code> æ˜¯ä¸è¡Œçš„ï¼Œè¿˜è¦ç”¨åˆ° <code>hg remove</code> æˆ– <code>hg forget</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell"># å–æ¶ˆè·Ÿè¸ªï¼Œå¹¶åˆ é™¤æœ¬åœ°æ–‡ä»¶
$ hg remove &lt;tracked-file&gt;

# å–æ¶ˆè·Ÿè¸ªï¼Œä½†ä¸åˆ é™¤æœ¬åœ°æ–‡ä»¶
$ hg forget &lt;tracked-file&gt;
</code></pre>
<p>åˆ†åˆ«å¯¹åº” Git çš„ <code>git rm</code> å’Œ <code>git rm --cache</code>ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©å³å¯ã€‚æ›´å¤šè¯·çœ‹<a href="https://www.selenic.com/mercurial/hg.1.html#forget">è¿™é‡Œ</a>ã€‚</p>
<h2>å…¶ä»–</h2>
<ul>
<li><code>hg status</code> shows the status of a repository.</li>
<li><code>hg add</code> puts files in the staging area.</li>
<li><code>hg commit</code> saves the staged content as a new commit in the local repository.</li>
<li><code>hg log</code> lists all changes committed to a repository, starting with the most recent.</li>
</ul>
<h2>ä»£ç åˆå¹¶å·¥å…·</h2>
<p>Mercurial æ²¡æœ‰å†…ç½®ä»»ä½•äº¤äº’å¼çš„åˆå¹¶ç¨‹åºï¼Œä½†å¯ä»¥ä¾èµ–å¤–éƒ¨å·¥å…·æ¥å®ç°ã€‚</p>
<blockquote>
<p>Mercurial does not include any interactive merge programs but relies on external tools for that.</p>
</blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåˆå¹¶æ—¶å­˜åœ¨å†²çªï¼Œä¼šè¢«æ ‡è®°ä¸ºå¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‰‹åŠ¨è§£å†³å†²çªã€‚</p>
<p>æ¯”å¦‚ï¼Œå½“å‰æœ‰ <code>default</code> å’Œ <code>develop</code> ä¸¤ä¸ªåˆ†æ”¯ï¼Œç°åœ¨è¦å°† <code>develop</code> åˆå¹¶è‡³ <code>default</code> åˆ†æ”¯é‡Œï¼Œè€Œä¸”ä¸¤ä¸ªåˆ†æ”¯æ˜¯å­˜åœ¨å†²çªçš„ã€‚</p>
<pre><code class="language-shell">$ hg checkout default

$ hg merge develop
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ vimdiff å·¥å…·ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702793890728.png" alt=""></p>
<p>å·¦ä¾§æ˜¯åˆå¹¶ç»“æœã€‚ä¸­é—´æ˜¯è¦åˆå¹¶è¿›æ¥çš„åˆ†æ”¯ã€‚å³ä¾§æ˜¯ä¸¤ä¸ªåˆ†æ”¯çš„å…±åŒç¥–å…ˆèŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>é„™äººå¯¹ vim æ“ä½œä¸ç†Ÿç»ƒï¼Œé¢å¯¹å¤æ‚çš„åˆå¹¶æ—¶ï¼Œç”¨èµ·æ¥å¾ˆä¸é¡ºæ‰‹ï¼Œå”¯æœ‰å¦å¯»ä»–è·¯ã€‚</p>
</blockquote>
<h3>ä½¿ç”¨ VS Code</h3>
<p>å°± Git æ¥è¯´ï¼Œåœ¨ VS Code ä¸Šçš„åˆå¹¶ä½“éªŒè¿˜ä¸é”™ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702795478521.png" alt=""></p>
<p>ç”±äº VS Code å¹¶æ²¡æœ‰å†…ç½®æ”¯æŒ Mercurial ç‰ˆæœ¬ç®¡ç†ï¼Œå› æ­¤è¦å®‰è£… Hg ç›¸å…³æ‰©å±•ã€‚</p>
<ol>
<li>å®‰è£… Hg ç›¸å…³çš„ VS Code æ‰©å±•ï¼ˆæ¯”å¦‚<a href="https://marketplace.visualstudio.com/items?itemName=vivekvijayan.hg">è¿™ä¸ª</a>ï¼‰ï¼Œä»¥ä¾¿åœ¨èµ„æºç®¡ç†å™¨é¢æ¿æŸ¥çœ‹å˜æ›´ç­‰ï¼Œåƒ Git ä¸€æ ·ã€‚</li>
<li>åœ¨ <code>~/.hgrc</code> ä»¥ä¸‹é…ç½®ã€‚</li>
</ol>
<pre><code class="language-ini">[ui]
merge = :merge
</code></pre>
<p>ç°åœ¨æ‰§è¡Œ Merge æ“ä½œæ—¶ï¼Œå°±èƒ½åƒ Git ä¸€æ ·æ“ä½œäº†ï¼Œæ“ä½œå®Œæˆåï¼Œç‚¹å‡»å†²çªæ–‡ä»¶å·¦ä¾§çš„ âœ” è¡¨ç¤º Merge Completeã€‚ä¹Ÿå¯ä»¥ç”¨ <code>hg resolve</code> æ¥ä»£æ›¿ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702796441225.png" alt="image.png"></p>
<h3>ä½¿ç”¨ 3-way merge</h3>
<p>åœ¨ VS Code 1.69 ç‰ˆæœ¬ï¼Œå®ƒå¸¦æ¥äº† <a href="https://code.visualstudio.com/updates/v1_69#_3-way-merge-editor">3-way merge editor</a> æ–¹å¼ã€‚ä½†ä¼¼ä¹äº‰è®®å¾ˆå¤§ï¼Œè‡³äºå¥½ä¸å¥½ç”¨ï¼Œè§ä»è§æ™ºã€‚</p>
<ul>
<li><a href="https://github.com/microsoft/vscode/issues/157361">How can I disable 3-way merge editor? #157361</a></li>
<li><a href="https://github.com/microsoft/vscode/issues/160806">Change default git conflict experience to be the inline editor #160806</a></li>
</ul>
<p>æ’ä»¶è¿˜ç”¨ä¸Šé¢é‚£ä¸ªï¼Œè°ƒæ•´ <code>~/.hgrc</code> é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-ini">[ui]
merge = code

[extensions]
extdiff =

[merge-tools]
code.priority = 100
code.premerge = True
code.args = --wait --merge $other $local $base $output

[extdiff]
cmd.vsd = code
opts.vsd = --wait --diff
</code></pre>
<p>ç°åœ¨æ‰§è¡Œ Merge æ“ä½œï¼Œè§†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702797805211.png" alt=""></p>
<p>ä¸Šå·¦è¡¨ç¤ºè¦åˆå¹¶è¿›æ¥çš„åˆ†æ”¯ã€‚ä¸Šä¸­è¡¨ç¤ºä¸¤ä¸ªåˆ†æ”¯çš„å…±åŒç¥–å…ˆèŠ‚ç‚¹ã€‚å³ä¾§è¡¨ç¤ºå½“å‰åˆ†æ”¯ã€‚ä¸‹æ–¹è¡¨ç¤ºåˆå¹¶ç»“æœã€‚</p>
<p>æ“ä½œå®Œæˆåï¼Œä¿å­˜æ–‡ä»¶ã€‚å…³é—­ Merging Tab å°±è¡¨ç¤º Merge Completedã€‚å¦‚æœæœ‰å¤šä¸ªå†²çªæ–‡ä»¶ï¼Œå…³é—­è¿™ä¸ªä¼šè‡ªåŠ¨æ‰“å¼€ä¸‹ä¸€ä¸ªã€‚</p>
<p>å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚è‡ªå·±çš„å°±è¡Œã€‚</p>
<h2>å¤åˆ¶æäº¤</h2>
<p>åœºæ™¯ï¼šæœ‰ Aã€B ä¸¤ä¸ªåˆ†æ”¯ï¼Œåœ¨ A åˆ†æ”¯æäº¤äº†ä¸€ä¸ª commitï¼Œè¦å°†è¯¥ commit ä¿®æ”¹çš„å†…å®¹â€œå¤åˆ¶â€åˆ° B åˆ†æ”¯ã€‚</p>
<blockquote>
<p>å‡è®¾å½“å‰å¤„äº A åˆ†æ”¯ï¼Œcommit çš„ä¿®è®¢ç‰ˆæœ¬ rev æ˜¯ 123ã€‚</p>
</blockquote>
<p>æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<p>ä¸€æ˜¯ä½¿ç”¨ <code>hg graft</code> å‘½ä»¤ï¼Œå®ƒä¼šåœ¨ B åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°çš„ commitï¼Œå†…å®¹å’Œ commit message è·ŸåŸæäº¤ç›¸åŒï¼Œä½† commit hash ä¸åŒã€‚</p>
<pre><code class="language-shell">$ hg checkout feature-b

$ hg graft -r 123
</code></pre>
<p>äºŒæ˜¯ä½¿ç”¨ <code>hg diff</code> å’Œ <code>hg import</code> å‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥æ‰‹åŠ¨è°ƒæ•´ã€æ£€æŸ¥å†æäº¤ã€‚</p>
<pre><code class="language-shell">$ hg diff -c 123 &gt; patch.diff

$ hg checkout feature-b

$ hg import --no-commit patch.diff
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://www.mercurial-scm.org/">Mercurial SCM</a></li>
<li><a href="https://www.mercurial-scm.org/doc/hg.1.html">Mercurial source code management system</a></li>
<li><a href="https://stackoverflow.com/questions/2237222/how-to-correctly-close-a-feature-branch-in-mercurial">How to correctly close a feature branch in Mercurial?</a></li>
<li><a href="https://stackoverflow.com/questions/2570087/how-to-abandon-an-uncommitted-hg-merge">How to abandon an uncommitted hg merge?</a></li>
<li><a href="https://repo.mercurial-scm.org/hg/help/merge-tools">Mercurial Merge Tools</a></li>
<li><a href="https://wiki.mercurial-scm.org/MergeToolConfiguration">Mercurial Merge Tool Configuration</a></li>
<li><a href="https://www.mercurial-scm.org/doc/hgrc.5.html">Configuration files for Mercurial</a></li>
<li><a href="https://www.oxymoronical.com/blog/2022/09/using-vs-code-for-merges-in-mercurial">Using VS Code for merges in Mercurial</a></li>
<li><a href="https://wiki.mercurial-scm.org/GitConcepts#Command_equivalence_table">Command equivalence table (Git to Hg)</a></li>
<li><a href="https://zh-hginit.readthedocs.io/en/latest/">HgInit</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» Git | è¿›é˜¶]]></title>
            <link>https://github.com/toFrankie/blog/issues/108</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/108</guid>
            <pubDate>Sat, 25 Feb 2023 12:55:41 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-48e5d20b58f74ec4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-48e5d20b58f74ec4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½ å¯¹ Git çš„è®¤çŸ¥ï¼Œåªåœç•™åœ¨ <code>git status</code>ã€<code>git add</code>ã€<code>git commit</code>ã€<code>git push</code>ã€<code>git pull</code> å±‚é¢çš„ç®€å•æ“ä½œå—ï¼Ÿä½ çŸ¥é“ <code>git merge</code> å’Œ <code>git rebase</code> çš„åŒºåˆ«å—ï¼Ÿå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p>
<!--
1. git log å’Œ git reflog çš„åŒºåˆ«
2. git reset ä¸‰ç§æƒ…å†µçš„åŒºåˆ«
3. git rebase å’Œ git merge
4. git stash
5. git grep
6. åˆ†å‰² commit

-->
<h2>ä¸€ã€File Status</h2>
<p>åœ¨ Git çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¸å¤–ä¹ä¸¤ç§çŠ¶æ€ï¼š <strong>tracked</strong>ï¼ˆå·²è·Ÿè¸ªï¼‰å’Œ <strong>untracked</strong>ï¼ˆæœªè·Ÿè¸ªï¼‰ã€‚</p>
<blockquote>
<ul>
<li><strong>tracked</strong>ï¼šè¡¨ç¤ºè¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ï¼Œå®ƒåˆç»†åˆ†ä¸º <strong>unmodified</strong>ï¼ˆæœªä¿®æ”¹ï¼‰ã€<strong>modified</strong>ï¼ˆå·²ä¿®æ”¹ï¼‰ã€<strong>staged</strong>ï¼ˆå·²æš‚å­˜ï¼‰ä¸‰ç§çŠ¶æ€ã€‚</li>
<li><strong>untracked</strong>ï¼šè¡¨ç¤ºé™¤äº† <strong>tracked</strong> ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå®ƒæ—¢æ²¡æœ‰å¿«ç…§è®°å½•ï¼Œä¹Ÿæ²¡æœ‰è¢«æ”¾å…¥ staging areaï¼ˆæš‚å­˜åŒºï¼‰ã€‚</li>
</ul>
</blockquote>
<p>æ–‡ä»¶çš„çŠ¶æ€å˜åŒ–å‘¨æœŸï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-87338efd23c8c023.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>git status</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ï¼ˆå·²è·Ÿè¸ªå’Œæœªè·Ÿè¸ªï¼‰æ–‡ä»¶çŠ¶æ€ã€‚å¦‚æœä½ å¸Œæœ›æŸäº›æ–‡ä»¶å‡ºç°åœ¨ <strong>untracked</strong> åˆ—è¡¨ï¼Œå¯ä»¥å°†å…¶æ·»åŠ è‡³ <code>.gitignore</code> æ–‡ä»¶ä¸­ã€‚åœ¨ GitHub ä¸Šæä¾›äº†é’ˆå¯¹æ•°åç§é¡¹ç›®åŠè¯­è¨€çš„ <code>.gitignore</code> æ¨¡æ¿ï¼Œè¯¦çœ‹<a href="https://github.com/github/gitignore">è¿™é‡Œ</a>ã€‚</p>
<h2>äºŒã€Git Object</h2>
<p>ä»æ ¹æœ¬ä¸Šæ¥è®² Git æ˜¯ä¸€ä¸ªå†…å®¹å¯»å€ï¼ˆcontent-addressableï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Œæ ¸å¿ƒéƒ¨åˆ†æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼å¯¹æ•°æ®åº“ï¼ˆkey-value data storeï¼‰ã€‚å½“ä½ å‘ Git ä»“åº“æ’å…¥ä»»æ„ç±»å‹çš„å†…å®¹æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå”¯ä¸€çš„é”®ï¼ˆSHA-1ï¼‰ï¼Œé€šè¿‡è¯¥é”®å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å†æ¬¡å–å›è¯¥å†…å®¹ã€‚</p>
<p>åœ¨åˆå§‹åŒ– Git ä»“åº“æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª <code>.git</code> ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹åŒ…å«äº†å‡ ä¹æ‰€æœ‰ Git å­˜å‚¨å’Œæ“ä½œçš„ä¸œè¥¿ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³å¤‡ä»½æˆ–è€…å¤åˆ¶ä¸€ä¸ªç‰ˆæœ¬åº“ï¼Œåªéœ€æŠŠè¿™ä¸ªç›®å½•æ‹·è´è‡³å¦ä¸€å¤„å³å¯ã€‚</p>
<pre><code class="language-shell">$ git init temp-repo
Initialized empty Git repository in /Users/frankie/Desktop/Web/Temp/temp-repo/.git/

$ cd temp-repo

$ tree .git -L 1
.git
â”œâ”€â”€ HEAD         # æŒ‡å‘å½“å‰åˆ†æ”¯
â”œâ”€â”€ config       # åŒ…å«é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹
â”œâ”€â”€ description  # ä»…ä¾› GitWeb ç¨‹åºä½¿ç”¨ï¼Œæ— éœ€å…³å¿ƒ
â”œâ”€â”€ hooks        # åŒ…å«å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯çš„é’©å­è„šæœ¬ï¼ˆhook scriptsï¼‰
â”œâ”€â”€ index        # ä¿å­˜æš‚å­˜åŒºä¿¡æ¯ï¼ˆgit init æ—¶æ— æ­¤æ–‡ä»¶ï¼Œå°šå¾…åˆ›å»ºï¼‰
â”œâ”€â”€ info         # åŒ…å«ä¸€ä¸ªå…¨å±€æ€§æ’é™¤ï¼ˆglobal excludeï¼‰æ–‡ä»¶ï¼Œç”¨ä»¥æ”¾ç½®é‚£äº›ä¸å¸Œæœ›è¢«è®°å½•åœ¨ .gitignore æ–‡ä»¶ä¸­çš„å¿½ç•¥æ¨¡å¼ï¼ˆignored patternsï¼‰
â”œâ”€â”€ objects      # å­˜å‚¨æ‰€æœ‰æ•°æ®å†…å®¹
â””â”€â”€ refs         # å­˜å‚¨æŒ‡å‘æ•°æ®ï¼ˆåˆ†æ”¯ã€è¿œç¨‹ä»“åº“å’Œæ ‡ç­¾ç­‰ï¼‰çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆ
</code></pre>
<p>æˆ‘ä»¬éœ€è¦äº†è§£ä¸‹ Git å¯¹è±¡ï¼ˆGit Objectï¼‰ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<blockquote>
<ul>
<li><strong>blob object</strong>ï¼ˆæ•°æ®å¯¹è±¡ï¼‰</li>
<li><strong>tree object</strong>ï¼ˆæ ‘å¯¹è±¡ï¼‰</li>
<li><strong>commit object</strong>ï¼ˆæäº¤å¯¹è±¡ï¼‰</li>
<li><strong>tag object</strong>ï¼ˆæ ‡ç­¾å¯¹è±¡ï¼‰</li>
</ul>
</blockquote>
<h4>2.1 Blob Object</h4>
<p>é€šè¿‡ Git æ“ä½œçš„æ•°æ®éƒ½å­˜æ”¾äº <code>objects</code> ç›®å½•ä¸‹ã€‚åœ¨ä»“åº“åˆå§‹åŒ–æ—¶ï¼Œ<code>objects</code> ç›®å½•åŠå…¶ <code>pack</code> å’Œ <code>info</code> ä¸¤ä¸ªå­ç›®å½•ï¼Œå†…å®¹å‡æ˜¯ç©ºçš„ã€‚</p>
<pre><code class="language-shell">$ find .git/objects
.git/objects
.git/objects/pack
.git/objects/info

$ find .git/objects -type f
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨åº•å±‚å‘½ä»¤ï¼ˆplumbing commandï¼‰ <code>git hash-object</code> æ¥æ¼”ç¤ºä¸€ä¸‹ Git å­˜å…¥å’Œå–å‡ºå†…å®¹ã€‚</p>
<p>ä½¿ç”¨ <code>git hash-object</code> åˆ›å»ºä¸€æ¡æ–°æ•°æ®å¯¹è±¡ï¼Œå¹¶å°†å®ƒæ‰‹åŠ¨å­˜å…¥ä½ çš„ Git æ•°æ®åº“ï¼ˆæŒ‡ <code>.git/objects</code> ç›®å½•ï¼‰ä¸­ï¼š</p>
<pre><code class="language-shell">$ echo 'some text...' | git hash-object -w --stdin
2c3e89d43daa5761b247cbd1ae08e08ed8cd054d
</code></pre>
<p>å…¶ä¸­ <code>-w</code> è¡¨ç¤ºé™¤äº†è¿”å›ã€Œå”¯ä¸€é”®ã€ä¹‹å¤–ï¼Œè¿˜è¦å°†è¯¥å¯¹è±¡å†™å…¥æ•°æ®åº“ä¸­ã€‚<code>--stdin</code> è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹ã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>objects</code> ç›®å½•ä¸‹ï¼Œæ–°å¢äº† <code>2c/3e89d43daa5761b247cbd1ae08e08ed8cd054d</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-shell">$ tree .git/objects
.git/objects
â”œâ”€â”€ 2c
â”‚Â Â  â””â”€â”€ 3e89d43daa5761b247cbd1ae08e08ed8cd054d
â”œâ”€â”€ info
â””â”€â”€ pack

3 directories, 1 file
</code></pre>
<p>å‰é¢ <code>git hash-object</code> æ“ä½œï¼Œè¿”å›äº†ä¸€ä¸ªé•¿åº¦ä¸º <code>40</code> ä¸ªå­—ç¬¦çš„<a href="ttps://www.wikiwand.com/zh/%E6%A0%A1%E9%AA%8C%E5%92%8C">æ ¡éªŒå’Œ</a>ã€‚å®ƒæ˜¯ä¸€ä¸ª <a href="https://www.wikiwand.com/zh/SHA-1">SHA-1</a> å“ˆå¸Œå€¼ï¼Œæ˜¯å°†å¾…å­˜å‚¨çš„æ•°æ®å¤–åŠ ä¸€ä¸ªå¤´éƒ¨ä¿¡æ¯ï¼ˆheaderï¼‰ä¸€èµ·åš SHA-1 æ ¡éªŒè¿ç®—è€Œå¾—çš„æ ¡éªŒå’Œã€‚</p>
<blockquote>
<p>åœ¨ Git ä¸­ï¼Œå®ƒå°†æ ¡éªŒå’Œçš„ã€Œå‰ 2 ä¸ªå­—ç¬¦ã€ä½œä¸ºå­ç›®å½•åç§°ï¼Œã€Œä½™ä¸‹ 38 ä¸ªå­—ç¬¦ã€ç”¨ä½œæ–‡ä»¶åã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå°±æ˜¯ Git å°†å†…å®¹å­˜å‚¨åˆ°å¯¹è±¡æ•°æ®åº“çš„è¿‡ç¨‹ã€‚å¦‚æœæƒ³è¦å–å›æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ <code>git cat-file</code> å‘½ä»¤å–å›ã€‚</p>
<pre><code class="language-shell">$ git cat-file -p 2c3e89d4
some text...
</code></pre>
<p>å…³äº <code>git cat-file</code> æ›´å¤šè¯·çœ‹<a href="https://git-scm.com/docs/git-cat-file">è¿™é‡Œ</a>ã€‚</p>
<pre><code class="language-shell">$ git cat-file &lt;options&gt; &lt;object&gt;
  -t  show object type
  -s  show object size
  -e  exit with zero when there's no error
  -p  pretty-print object's content
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œä½ å¯¹ Git å¦‚ä½•å­˜å…¥/å–å‡ºæ•°æ®åº”è¯¥æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ“ä½œåº”ç”¨äºæ–‡ä»¶çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªè¿°æ–‡ä»¶å¹¶å°†å…¶å†…å®¹å­˜å…¥æ•°æ®åº“ï¼š</p>
<pre><code class="language-shell">$ echo 'Some instructions...' &gt; README.md

$ git hash-object -w README.md
9e486f6a40f2e45a8dd0835e6a0357d6f7f0db64

$ find .git/objects -type f
.git/objects/9e/486f6a40f2e45a8dd0835e6a0357d6f7f0db64
.git/objects/2c/3e89d43daa5761b247cbd1ae08e08ed8cd054d
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å†æ¬¡ä¿®æ”¹ <code>README.md</code> çš„å†…å®¹ï¼Œå¯¹è±¡æ•°æ®åº“ä¸­å°†ä¼šè®°å½•è¯¥æ–‡ä»¶çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬ï¼š</p>
<pre><code class="language-shell">$ echo 'Some instructions...(V2)' &gt; README.md

$ git hash-object -w README.md
e04f0c5c9d740ead52734ed920c580bf0f380ea2

$ git cat-file -p e04f0c5c
Some instructions...(V2)

$ find .git/objects -type f
.git/objects/9e/486f6a40f2e45a8dd0835e6a0357d6f7f0db64
.git/objects/e0/4f0c5c9d740ead52734ed920c580bf0f380ea2
.git/objects/2c/3e89d43daa5761b247cbd1ae08e08ed8cd054d
</code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸‹ã€Œç‰ˆæœ¬å›é€€ã€ï¼Œå–å› <code>README.md</code> çš„ç¬¬ä¸€ç‰ˆæœ¬å†…å®¹ï¼š</p>
<pre><code class="language-shell">$ git cat-file -p 9e486f6a &gt; README.md

$ cat README.md
Some instructions...
</code></pre>
<p>è¯·æ³¨æ„ï¼Œå°½ç®¡ä»¥ä¸Šæ“ä½œè¿›è¡Œäº†â€œç‰ˆæœ¬å›é€€â€ï¼Œä½†æ˜¯ <code>objects/e0/4f0c5c9d740ead52734ed920c580bf0f380ea2</code> æ–‡ä»¶å¹¶æ²¡æœ‰è¢«åˆ é™¤ã€‚</p>
<p>è®°ä½æ–‡ä»¶çš„æ¯ä¸€ä¸ªç‰ˆæœ¬æ‰€å¯¹åº”çš„ SHA-1 å€¼å¹¶ä¸ç°å®ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¸Šè¿°æ“ä½œä»…åœ¨ objects ç›®å½•ä¸‹ä¿å­˜äº†æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œæ–‡ä»¶åå´æ²¡æœ‰è¢«è®°å½•ã€‚é€šä¿—åœ°å°†ï¼Œæˆ‘ä»¬é€šè¿‡ <code>git cat-file -p 9e486f6a</code> åªèƒ½è·å–å¯¹åº”çš„å†…å®¹ä¸º <code>Some instructions...</code>ï¼Œä½† Git ä¸çŸ¥é“å®ƒæ˜¯ <code>README.md</code> æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>ä¸Šè¿°ç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¸º<strong>æ•°æ®å¯¹è±¡ï¼ˆblob objectï¼‰</strong>ã€‚å¯ä»¥é€šè¿‡ <code>git cat-file -t</code> å‘½ä»¤æŸ¥åˆ°ï¼š</p>
<pre><code class="language-shell">$ git cat-file -t 9e486f6a
blob
</code></pre>
<h4>2.2 Tree Object</h4>
<p>æ ‘å¯¹è±¡ï¼ˆtree objectï¼‰ï¼Œå¯ä»¥è§£å†³æ–‡ä»¶åä¿å­˜çš„é—®é¢˜ï¼Œä¹Ÿå…è®¸å°†å¤šä¸ªæ–‡ä»¶ç»„ç»‡åˆ°ä¸€èµ·ã€‚</p>
<p>ä¸€ä¸ªæ ‘å¯¹è±¡åŒ…å«äº†ä¸€æ¡æˆ–å¤šæ¡æ ‘å¯¹è±¡çš„è®°å½•ï¼ˆtree entryï¼‰ï¼Œæ¯æ¡è®°å½•å«æœ‰ä¸€ä¸ªæŒ‡å‘æ•°æ®å¯¹è±¡ï¼ˆblob objectï¼‰æˆ–è€…å­æ ‘å¯¹è±¡çš„ SHA-1 æŒ‡é’ˆï¼Œä»¥åŠç›¸åº”çš„æ¨¡å¼ã€ç±»å‹ã€æ–‡ä»¶åä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬å°†ä¸Šä¸€èŠ‚ç”¨åˆ°çš„æœ¬åœ° <code>temp-repo</code> ä»“åº“æ¸…ç©ºï¼Œå¹¶é‡æ–°åˆå§‹åŒ–ï¼Œå¦å¤–åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ rm -rf .git

$ git init
Initialized empty Git repository in /Users/frankie/Desktop/Web/Temp/temp-repo/.git/

$ echo 'some instructions...(v1)' &gt; README.md
$ echo 'node_modules' &gt; .gitignore
$ mkdir 'src' &amp;&amp; echo 'console.log(&quot;entry point&quot;)' &gt; src/index.js

$ tree . -a
.
â”œâ”€â”€ .git
â”‚   â””â”€â”€ ...
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ src
    â””â”€â”€ index.js
</code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸Šå±‚å‘½ä»¤ï¼ˆporcelain commandï¼‰ï¼Œå°†è¿™äº› <strong>unstracked</strong> çš„æ–‡ä»¶ï¼Œæ·»åŠ è‡³æš‚å­˜åŒºå¹¶æäº¤ã€‚</p>
<pre><code class="language-shell">$ git add .

$ git commit -m 'first commit'
[main (root-commit) 10a28a5] first commit
 3 files changed, 3 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 README.md
 create mode 100644 src/index.js
</code></pre>
<p>å½“å‰å¯¹åº”çš„æœ€æ–°æ ‘å¯¹è±¡æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-shell">$ git cat-file -p main^{tree}
100644 blob 3c3629e647f5ddf82548912e337bea9826b434af    .gitignore
100644 blob 6df930682ee921766a29e6504c27f79790a7bae6    README.md
040000 tree b79960a978f46909a0449add4b2ab35766883e6d    src
</code></pre>
<p>å…¶ä¸­ <code>main^{tree}</code> è¯­æ³•è¡¨ç¤º <code>main</code> åˆ†æ”¯ä¸Šæœ€æ–°çš„æäº¤æ‰€æŒ‡å‘çš„æ ‘å¯¹è±¡ã€‚ è¯·æ³¨æ„ï¼Œ<code>src</code> å­ç›®å½•ï¼ˆæ‰€å¯¹åº”çš„é‚£æ¡æ ‘å¯¹è±¡è®°å½•ï¼‰å¹¶ä¸æ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå…¶æŒ‡å‘çš„æ˜¯å¦ä¸€ä¸ªæ ‘å¯¹è±¡ï¼š</p>
<pre><code class="language-shell">$ git cat-file -p b79960a9
100644 blob 064a5f9cffbc4df304f475a580dd961bdc2f7d38    index.js

$ git cat-file -t b79960a9
tree
</code></pre>
<p>æ­¤æ—¶ï¼ŒGit å†…éƒ¨å­˜å‚¨çš„æ•°æ®æ˜¯ç±»ä¼¼è¿™æ ·çš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-38bef07fe68c3874.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é€šå¸¸ï¼ŒGit æ ¹æ®æŸä¸€æ—¶åˆ»æš‚å­˜åŒºï¼ˆå³ <code>index</code> åŒºåŸŸï¼Œ<code>.git/index</code> æ–‡ä»¶ï¼‰æ‰€è¡¨ç¤ºçš„çŠ¶æ€åˆ›å»ºå¹¶è®°å½•ä¸€ä¸ªå¯¹åº”æ ‘å¯¹è±¡ï¼Œå¦‚æ­¤é‡å¤ä¾¿å¯ä¾æ¬¡è®°å½•ï¼ˆæŸä¸ªæ—¶é—´æ®µå†…ï¼‰ä¸€ç³»åˆ—çš„æ ‘å¯¹è±¡ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆé‡ç½®ä¸€ä¸‹ä»“åº“ï¼Œå› ä¸ºä¸Šé¢åˆ©ç”¨äº†ä¸Šå±‚å‘½ä»¤æš‚å­˜å¹¶æäº¤äº†ï¼Œå…å¾—å¹²æ‰°ã€‚ä¸‹é¢å°†ä½¿ç”¨åº•å±‚å‘½ä»¤æ¼”ç¤ºä¸€ä¸‹ï¼š</p>
<ol>
<li>åˆ©ç”¨ <code>git hash-object</code> æ¥åˆ›å»ºä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œå¹¶è®°å½•åœ¨ Git æ•°æ®åº“ä¸­ï¼š</li>
</ol>
<pre><code class="language-shell">$ echo 'readme v1' | git hash-object -w --stdin
504a7438c95afbd7f5280d756fb405bd85fbf19e
</code></pre>
<ol start="2">
<li>åˆ©ç”¨åº•å±‚å‘½ä»¤ <code>git update-index</code> å°†è¿™ä¸ªæ•°æ®å¯¹è±¡åŠ å…¥æš‚å­˜åŒºï¼Œè¯¥æ–‡ä»¶ä¸º <code>README.md</code>ã€‚</li>
</ol>
<pre><code class="language-shell">$ git update-index --add --cacheinfo 10064 \
&gt; 504a7438c95afbd7f5280d756fb405bd85fbf19e README.md
</code></pre>
<blockquote>
<p>å…³äº <code>git update-index</code> å‘½ä»¤é€‰é¡¹è¯´æ˜ï¼š</p>
<ul>
<li><code>--add</code> æ˜¯å› ä¸ºè¯¥æ–‡ä»¶å¹¶ä¸åœ¨æš‚å­˜åŒºä¸­ï¼Œå› æ­¤éœ€è¦æŒ‡å®šã€‚</li>
<li><code>--cacheinfo</code> æ˜¯å› ä¸ºæ·»åŠ çš„æ–‡ä»¶ä½äº Git æ•°æ®åº“ä¸­ï¼Œè€Œä¸æ˜¯ä½äºå½“å‰ç›®å½•ä¸‹ã€‚</li>
<li>æ–‡ä»¶æ¨¡å¼ï¼š<code>10064</code> ä¸ºæ–‡ä»¶æ¨¡å¼ï¼Œè¡¨ç¤ºä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼›<code>10075</code> è¡¨ç¤ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼›<code>120000</code> è¡¨ç¤ºä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</li>
</ul>
</blockquote>
<ol start="3">
<li>é€šè¿‡ <code>git write-tree</code> å‘½ä»¤å°†æš‚å­˜åŒºå†…å®¹å†™å…¥ä¸€ä¸ªæ ‘å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ <code>git cat-file -t</code> æ¥éªŒè¯ä¸€ä¸‹å®ƒç¡®å®æ˜¯æ ‘å¯¹è±¡ã€‚</li>
</ol>
<pre><code class="language-shell">$ git write-tree
d50d689553de001d8537d94dae3cb2c89788dae1

$ git cat-file -p d50d689553de001d8537d94dae3cb2c89788dae1
100644 blob 504a7438c95afbd7f5280d756fb405bd85fbf19e    README.md

$ git cat-file -t d50d689553de001d8537d94dae3cb2c89788dae1
tree
</code></pre>
<blockquote>
<p>æ‰§è¡Œ <code>git write-tree</code> å‘½ä»¤æ—¶ï¼Œå¦‚æœæŸä¸ªæ ‘å¯¹è±¡æ­¤å‰å¹¶ä¸å­˜åœ¨çš„è¯ï¼Œå®ƒä¼šæ ¹æ®å½“å‰æš‚å­˜åŒºçŠ¶æ€è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‘å¯¹è±¡ã€‚</p>
</blockquote>
<ol start="4">
<li>æ¥ç€ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‘å¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ–°æ–‡ä»¶ <code>docs.md</code> ä»¥åŠ <code>README.md</code> æ–‡ä»¶çš„ç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚</li>
</ol>
<pre><code class="language-shell">$ echo 'docs v1' &gt; docs.md

$ git update-index --add docs.md

$ echo 'readme v2' | git hash-object -w --stdin
8d85786d2dc2fd2cad833d88bce5fca5d28a12fa

$ git update-index --add --cacheinfo 100644 \
&gt; 8d85786d2dc2fd2cad833d88bce5fca5d28a12fa README.md
</code></pre>
<p>åˆ°è¿™æ¥ï¼Œç›®å‰æš‚å­˜åŒºåŒ…å«äº†æ–°æ–‡ä»¶ <code>docs.md</code> å’Œ <code>README.md</code> çš„æ–°ç‰ˆæœ¬ã€‚ç„¶åæˆ‘ä»¬è®°å½•ä¸‹è¿™ä¸ªç›®å½•æ•°ï¼ˆå°†å½“å‰æš‚å­˜åŒºçš„çŠ¶æ€è®°å½•ä¸ºä¸€ä¸ªæ ‘å¯¹è±¡ï¼‰ï¼Œç„¶åè§‚å¯Ÿå®ƒçš„ç»“æ„ï¼š</p>
<pre><code class="language-shell">$ git write-tree
a3f266e268f9d5d337a4c494b234f7482a0b5840

$ git cat-file -p a3f266e268f9d5d337a4c494b234f7482a0b5840
100644 blob 8d85786d2dc2fd2cad833d88bce5fca5d28a12fa    README.md
100644 blob e9074071f146011f8a927c2b7690df6dfe765a90    docs.md
</code></pre>
<p>æˆ‘ä»¬å‘ç°ï¼Œæ–°çš„è®°å½•æ ‘å¯¹è±¡åŒ…å«ä¸¤æ¡æ–‡ä»¶è®°å½•ï¼Œæ–‡ä»¶ <code>README.md</code> çš„ SHA-1 å€¼ï¼ˆ<code>8d8578</code>ï¼‰å¯¹åº”çš„å†…å®¹æ˜¯ <code>readme v2</code>ï¼Œæ–‡ä»¶ <code>docs.md</code> çš„ SHA-1 å€¼ï¼ˆ<code>e90740</code>ï¼‰å¯¹åº”çš„å†…å®¹æ˜¯ <code>docs v1</code>ã€‚</p>
<ol start="5">
<li>å¦‚æœä¸ºäº†å¥½ç©ï¼Œä½ è¿˜å¯ä»¥å°†ç¬¬ä¸€æ ‘å¯¹è±¡ï¼ˆ<code>d50d68</code>ï¼‰åŠ å…¥åˆ°ç¬¬äºŒä¸ªæ ‘å¯¹è±¡ï¼ˆ<code>a3f266</code>ï¼‰ï¼Œä½¿å…¶æˆä¸ºæ–°çš„æ ‘å¯¹è±¡çš„ä¸€ä¸ªå­ç›®å½•ã€‚</li>
</ol>
<pre><code class="language-shell">$ git read-tree --prefix=bak d50d689553de001d8537d94dae3cb2c89788dae1

$ git write-tree
783727c40cc4b1205242d4130b3f713ed525b23d

$ git cat-file -p 783727c40cc4b1205242d4130b3f713ed525b23d
100644 blob 8d85786d2dc2fd2cad833d88bce5fca5d28a12fa    README.md
040000 tree d50d689553de001d8537d94dae3cb2c89788dae1    bak
100644 blob e9074071f146011f8a927c2b7690df6dfe765a90    docs.md
</code></pre>
<blockquote>
<p>é€šè¿‡è°ƒç”¨ <code>git read-tree</code> å‘½ä»¤ï¼Œå¯ä»¥æŠŠæ ‘å¯¹è±¡è¯»å…¥æš‚å­˜åŒºã€‚ä»¥ä¸ŠæŒ‡å®š <code>--prefix</code> é€‰é¡¹ï¼Œå°†ä¸€ä¸ªå·²æœ‰çš„æ ‘å¯¹è±¡ä½œä¸ºå­æ ‘è¯»å…¥æš‚å­˜åŒºã€‚</p>
</blockquote>
<p>æ­¤æ—¶ï¼ŒGit å†…éƒ¨å­˜å‚¨çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼šæ ¹ç›®å½•æœ‰ <code>README.md</code> å’Œ <code>docs.md</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªåä¸º <code>bak</code> çš„å­ç›®å½•ï¼Œå®ƒåŒ…å«äº† <code>README.md</code> æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6cf366d5afbefc07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4>2.3 Commit Object</h4>
<p>åšå®Œä»¥ä¸Šæ“ä½œä¹‹åï¼Œç°åœ¨æœ‰äº†ä¸¤ä¸ªæ ‘å¯¹è±¡ï¼ˆ<code>783727</code>ã€<code>d50d68</code>ï¼‰ï¼Œåˆ†åˆ«ä»£è¡¨æˆ‘ä»¬æƒ³è¦è·Ÿè¸ªçš„ä¸åŒé¡¹ç›®å¿«ç…§ã€‚</p>
<p><strong>ç›®å‰å­˜åœ¨çš„é—®é¢˜æœ‰ï¼šå¦‚æœæƒ³é‡ç”¨è¿™äº›å¿«ç…§ï¼Œä½ å¿…é¡»è¦è®°ä½æ‰€æœ‰ SHA-1 å“ˆå¸Œå€¼ã€‚å†µä¸”ï¼Œä½ ä¹Ÿå®Œå…¨ä¸çŸ¥é“è°ä¿å­˜äº†è¿™äº›å¿«ç…§ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™ä¿å­˜çš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¿å­˜è¿™äº›å¿«ç…§ã€‚</strong></p>
<p>æ¥ä¸‹æ¥ä»‹ç»çš„æäº¤å¯¹è±¡ï¼ˆcommit objectï¼‰å°±æ˜¯ä¸ºäº†ä¿å­˜åŸºæœ¬ä¿¡æ¯çš„ã€‚é€šè¿‡è°ƒç”¨åº•å±‚å‘½ä»¤ <code>git commit-tree</code> å¯ä»¥åˆ›å»ºä¸€ä¸ªæäº¤å¯¹è±¡ã€‚ä¸ºæ­¤ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ ‘å¯¹è±¡çš„ SHA-1 å€¼ï¼Œä»¥åŠè¯¥æäº¤çš„çˆ¶æäº¤å¯¹è±¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p>
<pre><code class="language-shell">$ git commit-tree &lt;tree-object-sha1&gt; -p &lt;parent-commit-object-sha1&gt;
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>d50d68</code> æ ‘å¯¹è±¡æ¥åˆ›å»ºç¬¬ä¸€ä¸ªæäº¤å¯¹è±¡ã€‚ç”±äºæ˜¯é¦–æ¬¡ï¼Œå› æ­¤æ²¡æœ‰çˆ¶æäº¤å¯¹è±¡ã€‚</p>
<pre><code class="language-shell">$ echo 'first commit' | git commit-tree d50d68
242bd136ff24d2880a68f2de9a8a3a66a0338eea

$ git cat-file -p 242bd136ff24d2880a68f2de9a8a3a66a0338eea
tree d50d689553de001d8537d94dae3cb2c89788dae1
author Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800
committer Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800

first commit

$ git cat-file -t 242bd136ff24d2880a68f2de9a8a3a66a0338eea
commit
</code></pre>
<p>ç”±äºåˆ›å»ºæ—¶é—´ã€ä½œè€…æ•°æ®çš„ä¸åŒï¼Œæ€»ä¼šå¾—åˆ°ä¸€ä¸ªå”¯ä¸€çš„ SHA-1 å€¼ã€‚åŒæ ·åœ°ï¼Œå¯ä»¥é€šè¿‡ <code>git cat-file</code> æ¥æŸ¥çœ‹è¿™ä¸ªæ–°çš„æäº¤å¯¹è±¡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹æäº¤å¯¹è±¡éƒ½åŒ…å«äº›ä»€ä¹ˆä¿¡æ¯ï¼š</p>
<pre><code class="language-txt">tree d50d689553de001d8537d94dae3cb2c89788dae1
author Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800
committer Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800

first commit
</code></pre>
<blockquote>
<p>æäº¤å¯¹è±¡çš„æ ¼å¼å¾ˆç®€å•ï¼Œå®ƒå…ˆæŒ‡å®šä¸€ä¸ªé¡¶å±‚çš„æ ‘å¯¹è±¡ï¼Œä»£è¡¨å½“å‰é¡¹ç›®å¿«ç…§ï¼›ç„¶åæ˜¯å¯èƒ½å­˜åœ¨çš„çˆ¶æäº¤ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸å­˜åœ¨ä»»ä½•çˆ¶æäº¤ï¼‰ï¼›ä¹‹åæ˜¯ä½œè€…ã€æäº¤è€…ä¿¡æ¯ï¼Œå®ƒç”± <code>user.name</code> å’Œ <code>user.email</code> é…ç½®æ¥è®¾å®šï¼Œå¤–åŠ ä¸€ä¸ªæ—¶é—´æˆ³ï¼›ç•™ç©ºä¸€è¡Œï¼Œæœ€åæ˜¯æäº¤æ³¨é‡Šã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>783727</code> æ ‘å¯¹è±¡åˆ›å»ºç¬¬äºŒä¸ªæäº¤å¯¹è±¡ï¼Œå…¶çˆ¶æäº¤å¯¹è±¡æ˜¯ <code>242bd1</code>ï¼š</p>
<pre><code class="language-shell">$ echo 'second commit' | git commit-tree 783727 -p 242bd1
086ba597542c232e267d4b9aa4c0d3d4bcf2411a

$ git cat-file -p 086ba5
tree 783727c40cc4b1205242d4130b3f713ed525b23d
parent 242bd136ff24d2880a68f2de9a8a3a66a0338eea
author Frankie &lt;1426203851@qq.com&gt; 1647703338 +0800
committer Frankie &lt;1426203851@qq.com&gt; 1647703338 +0800

second commit
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹æœ€åæäº¤çš„ SHA-1 å€¼æ‰§è¡Œ <code>git log</code> å‘½ä»¤ï¼Œä½ ä¼šå‘ç°ï¼Œä½ å·²ç»æœ‰ä¸€ä¸ªè´§çœŸä»·å®ã€å¯ç”± <code>git log</code> æŸ¥çœ‹çš„ Git æäº¤å†å²äº†ã€‚</p>
<pre><code class="language-shell">$ git log --stat 086ba5
commit 086ba597542c232e267d4b9aa4c0d3d4bcf2411a
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Mar 19 23:22:18 2022 +0800

    second commit

 README.md     | 2 +-
 bak/README.md | 1 +
 docs.md       | 1 +
 3 files changed, 3 insertions(+), 1 deletion(-)

commit 242bd136ff24d2880a68f2de9a8a3a66a0338eea
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Mar 19 23:11:27 2022 +0800

    first commit

 README.md | 1 +
 1 file changed, 1 insertion(+)
</code></pre>
<p>åœ¨ä»¥ä¸Šè¿‡ç¨‹ï¼Œæˆ‘ä»¬æ²¡æœ‰å€ŸåŠ©ä»»ä½•ä¸Šå±‚å‘½ä»¤ï¼Œä»…å‡­å‡ ä¸ªåº•å±‚å‘½ä»¤å°±å®Œæˆäº†ä¸€ä¸ª Git æäº¤å†å²çš„åˆ›å»ºã€‚</p>
<blockquote>
<p><strong>æˆ‘ä»¬ä½¿ç”¨ <code>git add</code> å’Œ <code>git commit</code> ä¸Šå±‚å‘½ä»¤æ—¶ï¼ŒGit æ‰€åšçš„å·¥ä½œå®è´¨å°±æ˜¯ï¼šå°†è¢«æ”¹å†™çš„æ–‡ä»¶ä¿å­˜ä¸ºæ•°æ®å¯¹è±¡ï¼Œæ›´æ–°æš‚å­˜åŒºï¼Œè®°å½•æ ‘å¯¹è±¡ï¼Œæœ€ååˆ›å»ºä¸€ä¸ªæŒ‡æ˜äº†é¡¶å±‚æ ‘å¯¹è±¡å’Œçˆ¶æäº¤å¯¹è±¡çš„æäº¤å¯¹è±¡ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸‰ç§ Git å¯¹è±¡ â€” æ•°æ®å¯¹è±¡ã€æ ‘å¯¹è±¡ã€æäº¤å¯¹è±¡ï¼Œæœ€åˆå‡ä»¥å•ç‹¬æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨ <code>.git/objects</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-shell">$ find .git/objects -type f
.git/objects/50/4a7438c95afbd7f5280d756fb405bd85fbf19e      # readme v1    (blob object)
.git/objects/a3/f266e268f9d5d337a4c494b234f7482a0b5840      # tree 2       (tree object)
.git/objects/08/6ba597542c232e267d4b9aa4c0d3d4bcf2411a      # commit 2     (commit object)
.git/objects/d5/0d689553de001d8537d94dae3cb2c89788dae1      # tree 1       (tree object)
.git/objects/e9/074071f146011f8a927c2b7690df6dfe765a90      # docs v1      (blob object)
.git/objects/24/2bd136ff24d2880a68f2de9a8a3a66a0338eea      # commit 1     (commit object)
.git/objects/8d/85786d2dc2fd2cad833d88bce5fca5d28a12fa      # readme v2    (blob object)
.git/objects/78/3727c40cc4b1205242d4130b3f713ed525b23d      # tree 3       (tree object)
</code></pre>
<blockquote>
<p>ä¸çŸ¥é“æœ‰æ²¡æœ‰åŒå­¦å¥½å¥‡ï¼Œè¿™é‡Œé¢ä¸ºä»€ä¹ˆæœ‰ä¸‰ä¸ªæ ‘å¯¹è±¡ï¼ŸåŸå› æ˜¯å‰é¢æˆ‘ä»¬å°† <code>tree 1</code>ï¼ˆd50d68ï¼‰åŠ å…¥åˆ° <code>tree 2</code>ï¼ˆa3f266ï¼‰ï¼Œå½¢æˆäº†æ–°çš„æ ‘å¯¹è±¡ <code>tree 3</code>ï¼ˆ783727ï¼‰ã€‚</p>
</blockquote>
<p>é€šè¿‡ <code>git cat-file</code> æŸ¥çœ‹ä¸‹å°±æ¸…æ¥šäº†ï¼š</p>
<pre><code class="language-shell">$ git cat-file -p d50d68
100644 blob 504a7438c95afbd7f5280d756fb405bd85fbf19e    README.md

$ git cat-file -p a3f266
100644 blob 8d85786d2dc2fd2cad833d88bce5fca5d28a12fa    README.md
100644 blob e9074071f146011f8a927c2b7690df6dfe765a90    docs.md

$ git cat-file -p 783727
100644 blob 8d85786d2dc2fd2cad833d88bce5fca5d28a12fa    README.md
040000 tree d50d689553de001d8537d94dae3cb2c89788dae1    bak
100644 blob e9074071f146011f8a927c2b7690df6dfe765a90    docs.md
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯¹è±¡å…³ç³»å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b7d3501091a2438f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4>2.4 Tag Object</h4>
<p>æ ‡ç­¾å¯¹è±¡ï¼ˆtag objectï¼‰ éå¸¸ç±»ä¼¼äºä¸€ä¸ªæäº¤å¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ ‡ç­¾åˆ›å»ºè€…ä¿¡æ¯ã€ä¸€ä¸ªæ—¥æœŸã€ä¸€æ®µæ³¨é‡Šä¿¡æ¯ï¼Œä»¥åŠä¸€ä¸ªæŒ‡é’ˆã€‚ ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œæ ‡ç­¾å¯¹è±¡é€šå¸¸æŒ‡å‘ä¸€ä¸ªæäº¤å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ ‘å¯¹è±¡ã€‚ å®ƒåƒæ˜¯ä¸€ä¸ªæ°¸ä¸ç§»åŠ¨çš„åˆ†æ”¯å¼•ç”¨â€”â€”æ°¸è¿œæŒ‡å‘åŒä¸€ä¸ªæäº¤å¯¹è±¡ï¼Œåªä¸è¿‡ç»™è¿™ä¸ªæäº¤å¯¹è±¡åŠ ä¸Šä¸€ä¸ªæ›´å‹å¥½çš„åå­—ç½¢äº†ã€‚</p>
<h4>2.5 å¯¹è±¡å­˜å‚¨</h4>
<p>åœ¨ä»‹ç»æ•°æ®å¯¹è±¡çš„æ—¶å€™ï¼Œæ›¾æåŠï¼Œåœ¨ Git ä¸­çš„Â SHA-1 å“ˆå¸Œå€¼ï¼Œæ˜¯ç”±ã€Œå¾…å­˜å‚¨çš„æ•°æ®ã€å’Œã€Œå¤´éƒ¨ä¿¡æ¯ã€ä¸€èµ·åš SHA-1 æ ¡éªŒè¿ç®—è€Œå¾—çš„æ ¡éªŒå’Œã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨ Git ä¸­å­—ç¬¦ä¸² <code>what is this?</code> è¿”å›çš„ SHA-1 å€¼ä¸ºï¼š<code>3246c91c89bbcada55565188499b8e214198fd48</code>ã€‚</p>
<pre><code class="language-shell">$ echo -n 'what is this?' | git hash-object --stdin
ed8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25
</code></pre>
<blockquote>
<p>è¿™é‡Œä½¿ç”¨äº† <code>echo -n</code> æ˜¯é¿å…åœ¨è¾“å‡ºä¸­æ·»åŠ æ¢è¡Œã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä½¿ç”¨ <a href="https://www.ruby-lang.org/zh_cn/">Ruby</a> è„šæœ¬è¯­è¨€æ¥æ¼”ç¤ºä¸‹ï¼Œå¦‚ä½•ç”Ÿæˆç›¸åŒçš„ SHA-1 å€¼ã€‚è¿™é‡Œé€šè¿‡ <code>irb</code>ï¼ˆInteractive Rubyï¼‰å‘½ä»¤å¯åŠ¨ Ruby çš„äº¤äº’æ¨¡å¼ï¼š</p>
<pre><code class="language-shell">$ irb

&gt;&gt; content = &quot;what is this?&quot;
=&gt; &quot;what is this?&quot;

&gt;&gt; header = &quot;blob #{content.length}\0&quot;
=&gt; &quot;blob 13\u0000&quot;

&gt;&gt; store = header + content
=&gt; &quot;blob 13\u0000what is this?&quot;

&gt;&gt; require &quot;digest/sha1&quot;
=&gt; true

&gt;&gt; sha1 = Digest::SHA1.hexdigest(store)
=&gt; &quot;ed8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25&quot;
</code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>Git ä¼šä»¥è¯†åˆ«å‡ºçš„å¯¹è±¡ç±»å‹ä½œä¸ºå¼€å¤´æ¥æ„é€ ä¸€ä¸ªã€Œå¤´éƒ¨ä¿¡æ¯ã€ï¼Œä»¥ä¸Šç¤ºä¾‹æ˜¯ä¸€ä¸ª <code>&quot;blob&quot;</code> å­—ç¬¦ä¸²ï¼Œæ¥ç€æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œéšåæ˜¯æ•°æ®å†…å®¹çš„å­—èŠ‚æ•°ï¼Œæœ€åä¸€ä¸ªæ˜¯ç©ºå­—èŠ‚ï¼ˆ<code>null byte</code>ï¼‰ã€‚</li>
<li>å°†ã€Œå¤´éƒ¨ä¿¡æ¯ã€å’Œã€ŒåŸå§‹æ•°æ®ã€æ‹¼æ¥èµ·æ¥ï¼Œå¹¶è®¡ç®—å‡ºè¿™æ¡å†…å®¹çš„ SHA-1 æ ¡éªŒå’Œã€‚è®¡ç®— SHA-1 å€¼ï¼Œå…ˆé€šè¿‡å¯¼å…¥ SHA-1 digest åº“ï¼Œç„¶åå¯¹ç›®æ ‡å­—ç¬¦ä¸²è°ƒç”¨ <code>Digest::SHA1.hexdigest()</code>ã€‚</li>
</ol>
</blockquote>
<p>ç”Ÿæˆ SHA-1 å€¼ä¹‹åï¼Œè¿˜æ²¡å®Œå‘¢... Git ä¼šé€šè¿‡ <a href="https://zlib.net/">zlib</a> å‹ç¼©è¿™æ¡æ–°å†…å®¹ï¼Œç„¶åå°†å‹ç¼©åçš„å†…å®¹å­˜å…¥ç‰¹å®šçš„æ–‡ä»¶ä¸­ã€‚</p>
<p>å®ƒå°†ä¼šå­˜åœ¨äº <code>.git/objects</code> ç›®å½•ä¸‹ä¸€çº§ï¼Œå°† SHA-1 å€¼çš„ã€Œå‰ 2 ä½å­—ç¬¦ã€ä½œä¸ºå­ç›®å½•ï¼Œã€Œä½™ä¸‹ 38 ä½ã€ä½œä¸ºè¯¥å­ç›®å½•ä¸‹çš„æ–‡ä»¶åï¼Œæ–‡ä»¶å†…å­˜å‚¨çš„æ˜¯ã€Œå¤´éƒ¨ä¿¡æ¯ã€å’Œã€ŒåŸå§‹æ•°æ®ã€ç» <code>zlib</code> å‹ç¼©åçš„å†…å®¹ã€‚</p>
<p>æ¯”å¦‚ï¼ŒSHA-1 å€¼ä¸º <code>ed8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25</code> çš„è¯ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„æ–‡ä»¶è·¯å¾„ä¸º <code>.git/objects/ed/8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25</code>ã€‚</p>
<pre><code class="language-shell">&gt;&gt; require &quot;zlib&quot;
=&gt; true

&gt;&gt; zlib_content = Zlib::Deflate.deflate(store)
=&gt; &quot;x\x9CK\xCA\xC9OR04f(\xCFH,Q\xC8,V(\xC9\xC8,\xB6\a\x00J\f\x06\xEB&quot;

&gt;&gt; path = &quot;.git/objects/&quot; + sha1[0,2] + &quot;/&quot; + sha1[2,38]
=&gt; &quot;.git/objects/ed/8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25&quot;

&gt;&gt; require &quot;fileutils&quot;
=&gt; true

&gt;&gt; FileUtils.mkdir_p(File.dirname(path))
=&gt; [&quot;.git/objects/ed&quot;]

&gt;&gt; File.open(path, &quot;w&quot;) { |f| f.write zlib_content }
=&gt; 29
</code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ol start="3">
<li>åœ¨ Ruby å¼•å…¥ <code>zlib</code> åº“ï¼Œå¯¹ç›®æ ‡å†…å®¹è°ƒç”¨ <code>Zlib::Deflate.deflate()</code> æ¥è¿›è¡Œå‹ç¼©ã€‚</li>
<li>æ¥ç€ç¡®å®šæ–°å†…å®¹å­˜å‚¨çš„è·¯å¾„ï¼Œç„¶åå†å†™å…¥å†…å®¹ï¼ˆå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šå…ˆåˆ›å»ºï¼‰ã€‚</li>
</ol>
</blockquote>
<p>ç„¶åï¼Œå¯ä»¥é€šè¿‡ <code>git cat-file</code> éªŒè¯ä¸€ä¸‹å†…å®¹æ˜¯å¦ä¸€è‡´å“¦ï¼</p>
<pre><code class="language-shell">$ git cat-file -p ed8f50cbf7a25a1ad0a4ffed9f721b3e6f30bd25
what is this?
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œä½ å°±åˆ›å»ºäº†ä¸€ä¸ªæœ‰æ•ˆçš„ Git æ•°æ®å¯¹è±¡ã€‚</p>
<p>æ‰€æœ‰çš„ Git å¯¹è±¡å‡ä»¥è¿™ç§æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼ŒåŒºåˆ«ä»…åœ¨äºã€Œç±»å‹æ ‡è¯†ã€ï¼Œå¦å¤–ä¸¤ç§å¯¹è±¡çš„ã€Œå¤´éƒ¨ä¿¡æ¯ã€æ˜¯ä»¥ <code>&quot;tree&quot;</code> æˆ– <code>&quot;commit&quot;</code> å¼€å¤´ï¼Œè€Œä¸æ˜¯ <code>&quot;blob&quot;</code>ã€‚</p>
<p>å¦å¤–ï¼Œè™½ç„¶ã€Œæ•°æ®å¯¹è±¡ã€çš„å†…å®¹å‡ ä¹å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä½†ã€Œæ ‘å¯¹è±¡ã€å’Œã€Œæäº¤å¯¹è±¡ã€çš„å†…å®¹å´æœ‰å„è‡ªå›ºå®šçš„æ ¼å¼ã€‚</p>
<h4>2.6 å…¶ä»–</h4>
<p>åˆ°è¿™é‡Œï¼Œä¸åº”è¯¥å†æœ‰æ­¤ç–‘é—®äº†å§ï¼š<strong>git cat-file æ˜¯å¦‚ä½•å°† SHA-1 å¯†æ–‡è¿˜åŸæˆæ˜æ–‡çš„ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ SHA-1ã€MD5 è¿™ç±»åŠ å¯†ç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œåœ¨å¿½ç•¥ <a href="http://shattered.it/">SHA-1 è¢« Google æ”»ç ´çš„äº‹å®</a>å‰æä¸‹ï¼Œå¯ä»¥è®¤ä¸ºåˆ©ç”¨ SHA-1 å€¼æ˜¯ä¸èƒ½è¢«è¿˜åŸå‡ºåŸå§‹æ•°æ®çš„ã€‚</p>
<p>åœ¨ Git ä¸­ï¼Œå®é™…è¢«å­˜å‚¨åœ¨ <code>.git/objects</code> çš„æ‰€æœ‰å†…å®¹ï¼Œå‡æ˜¯ç”±ã€Œå¤´éƒ¨ä¿¡æ¯ã€å’Œã€ŒåŸå§‹æ•°æ®ã€æ‹¼æ¥åç» <code>zlib</code> å‹ç¼©åçš„ç»“æœã€‚å®ƒæ˜¯å¯ä»¥è¢«è¿˜åŸçš„ã€‚è€Œ SHA-1 å“ˆå¸Œå€¼åˆ™ä½œä¸ºå¯¹åº”çš„æ–‡ä»¶è·¯å¾„è€Œå·²ï¼Œç”±äºæ–‡ä»¶è·¯å¾„è§„åˆ™æ˜¯å›ºå®šçš„ï¼ˆå‰ 2 ä½ä½œä¸ºå­ç›®å½•åç§°ï¼Œå 38 ä½ä½œä¸ºæ–‡ä»¶åç§°ï¼‰ï¼Œå› æ­¤å€ŸåŠ© SHA-1 å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å†…å®¹ï¼Œå¯ä»¥ç†è§£ä¸º SHA-1 åœ¨é‡Œé¢èµ·æŒ‡å¼•ä½œç”¨ã€‚</p>
<p>å› æ­¤ï¼Œ<code>git cat-file</code> å¹¶ä¸æ˜¯è¦è¿˜åŸ SHA-1 æ‰€è¡¨ç¤ºçš„åŸå§‹æ•°æ®ï¼Œè€Œæ˜¯æ ¹æ® SHA-1 å“ˆå¸Œå€¼åœ¨æœ¬åœ°æ•°æ®åº“ï¼ˆ<code>.git/objects</code> ç›®å½•ï¼‰æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œç„¶åå†å°†è¿™ä¸ªæ–‡ä»¶è¿˜åŸå‡ºæ¥ã€‚</p>
<h2>ä¸‰ã€Git References</h2>
<p>å¦‚æœä½ å¯¹ä»“åº“æŸä¸€ä¸ªæäº¤ï¼ˆæ¯”å¦‚å‰é¢çš„ <code>086ba5</code>ï¼‰å¼€å§‹å¾€å‰çš„å†å²æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿è¡Œ <code>git log 086ba5</code> å‘½ä»¤æ¥æ˜¾ç¤ºå†å²ï¼š</p>
<pre><code class="language-shell">$ git log 086ba5
commit 086ba597542c232e267d4b9aa4c0d3d4bcf2411a
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Mar 19 23:22:18 2022 +0800

    second commit

commit 242bd136ff24d2880a68f2de9a8a3a66a0338eea
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Mar 19 23:11:27 2022 +0800

    first commit
</code></pre>
<p>ä½†è¿™æ ·çš„è¯ï¼Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼Œå®ƒè¦æ±‚ä½ å¿…é¡»è®°ä½ SHA-1 å“ˆå¸Œå€¼ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚å‡è®¾æœ‰ä¸ªä¸€ä¸ªæ–‡ä»¶æ¥ä¿å­˜ SHA-1 å€¼ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶æœ‰ä¸€ä¸ªç®€å•çš„åå­—ï¼Œç„¶åç”¨è¿™ä¸ªåå­—æŒ‡é’ˆæ¥ä»£æ›¿åŸå§‹çš„ SHA-1 å€¼çš„è¯ï¼Œä¼šæ›´åŠ ç®€å•ã€‚</p>
<p>åœ¨ Git ä¸­ï¼Œè¿™ç§ç®€å•çš„åç§°è¢«ç§°ä¸º**ã€Œå¼•ç”¨ã€ï¼ˆreferencesï¼Œç®€å†™ refsï¼‰**ã€‚ä½ å¯ä»¥åœ¨ <code>.git/refs</code> ç›®å½•ä¸‹æ‰¾åˆ°è¿™ç±»å«æœ‰ SHA-1 å€¼çš„æ–‡ä»¶ã€‚åœ¨å½“å‰ä»“åº“ä¸­ï¼Œè¿™ä¸ªç›®å½•è¿˜æ²¡åŒ…å«ä»»ä½•æ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ find .git/refs
.git/refs
.git/refs/heads
.git/refs/tags

$ find .git/refs -type f
</code></pre>
<p>å¦‚è¦åˆ›å»ºä¸€ä¸ªæ–°å¼•ç”¨ç”¨æ¥å¸®åŠ©è®°å½•æœ€æ–°æäº¤æ‰€åœ¨çš„ä½ç½®ï¼Œä»æŠ€æœ¯ä¸Šï¼Œåªéœ€è¦ç®€å•åœ°åšå¦‚ä¸‹æ“ä½œï¼š</p>
<pre><code class="language-shell">$ echo 086ba597542c232e267d4b9aa4c0d3d4bcf2411a &gt; .git/refs/heads/main
</code></pre>
<p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨åˆšåˆ›å»ºçš„æ–°å¼•ç”¨æ¥ä»£æ›¿ SHA-1 å€¼äº†ã€‚</p>
<pre><code class="language-shell">$ git log main --pretty=oneline
086ba597542c232e267d4b9aa4c0d3d4bcf2411a (HEAD -&gt; main) second commit
242bd136ff24d2880a68f2de9a8a3a66a0338eea first commit
</code></pre>
<p>ä½†æ˜¯ä¸æå€¡ç›´æ¥ç¼–è¾‘å¼•ç”¨æ–‡ä»¶ï¼Œå¦‚æœæƒ³è¦æ›´æ–°æŸä¸ªå¼•ç”¨ï¼ŒGit æä¾›äº†ä¸€ä¸ªæ›´åŠ å®‰å…¨çš„å‘½ä»¤ <code>git update-ref</code> æ¥å®Œæˆæ­¤äº‹ï¼š</p>
<pre><code class="language-shell"># usage: git update-ref &lt;refname&gt; &lt;new-val&gt;
$ git update-ref refs/heads/main 086ba597542c232e267d4b9aa4c0d3d4bcf2411a
</code></pre>
<p>è¿™åŸºæœ¬å°±æ˜¯ Git åˆ†æ”¯çš„æœ¬è´¨ï¼šä¸€ä¸ªæŒ‡å‘æŸä¸€ç³»åˆ—æä»·ä¹‹é¦–çš„æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚è‹¥æƒ³åœ¨ç¬¬ä¸€ä¸ªæäº¤ä¸Šåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p>
<pre><code class="language-shell">$ git update-ref refs/heads/test 242bd136ff24d2880a68f2de9a8a3a66a0338eea

$ git log test --pretty=oneline
242bd136ff24d2880a68f2de9a8a3a66a0338eea (test) first commit
</code></pre>
<p>è¿™ä¸ª <code>test</code> åˆ†æ”¯å°†åªåŒ…å«ä»ç¬¬ä¸€ä¸ªæäº¤å¼€å§‹å¾€å‰è¿½æº¯çš„è®°å½•ï¼ˆä½†æœ¬æ–‡ç›®å‰åªæœ‰åŒ…å«ä¸¤æ¬¡æäº¤ï¼Œå“ˆå“ˆï¼‰ã€‚æ­¤æ—¶æˆ‘ä»¬è¿è¡Œä¸Šå±‚å‘½ä»¤ <code>git branch</code> å‘ç°ï¼Œç›®å‰å·²å­˜åœ¨ <code>main</code> å’Œ <code>test</code> ä¸¤ä¸ªåˆ†æ”¯äº†ã€‚</p>
<pre><code class="language-shell">$ git branch
* main
  test
</code></pre>
<p>å½“è¿è¡Œç±»ä¼¼äº <code>git branch &lt;branch-name&gt;</code> å‘½ä»¤æ—¶ï¼ŒGit å®é™…ä¸Šä¼šè¿è¡Œ <code>git update-ref</code> å‘½ä»¤ï¼Œå–å¾—å½“å‰æ‰€åœ¨åˆ†æ”¯æœ€æ–°æäº¤å¯¹åº”çš„ SHA-1 å€¼ï¼Œå¹¶å°†å…¶åŠ å…¥ä½ æƒ³è¦åˆ›å»ºçš„ä»»ä½•æ–°å¼•ç”¨ä¸­ã€‚</p>
<p>æ­¤æ—¶ï¼Œä» Git æ•°æ®åº“è§’åº¦çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-50d372fcbb8ef7cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ Git æœ‰ä¸‰ç§å¼•ç”¨ç±»å‹ï¼š</p>
<blockquote>
<ul>
<li><strong>head reference</strong>ï¼ˆHEAD å¼•ç”¨ï¼‰</li>
<li><strong>tag reference</strong>ï¼ˆæ ‡ç­¾å¼•ç”¨ï¼‰</li>
<li><strong>remote reference</strong>ï¼ˆè¿œç¨‹å¼•ç”¨ï¼‰</li>
</ul>
</blockquote>
<h4>3.1 HEAD å¼•ç”¨</h4>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“ä½ æ‰§è¡Œ <code>git branch &lt;branch-name&gt;</code> æ—¶ï¼ŒGit å¦‚ä½•çŸ¥é“æœ€æ–°æäº¤çš„ SHA-1 å€¼å‘¢ï¼Ÿ</p>
<blockquote>
<p>ç­”æ¡ˆå°±æ˜¯ <code>HEAD</code> æ–‡ä»¶ï¼ˆå­˜åœ¨äº <code>.git</code> ç›®å½•ä¸‹ï¼‰ã€‚</p>
</blockquote>
<p>HEAD æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªã€Œç¬¦å·å¼•ç”¨ã€ï¼ˆsymbolic referenceï¼‰ï¼ŒæŒ‡å‘ç›®å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚æ‰€è°“çš„ç¬¦å·å¼•ç”¨ï¼Œè¡¨ç¤ºå®ƒæ˜¯å·²æŒ‡å‘å…¶ä»–å¼•ç”¨çš„æŒ‡é’ˆã€‚</p>
<p>åœ¨æŸäº›ç½•è§çš„æƒ…å†µä¸‹ï¼ŒHEAD æ–‡ä»¶å¯èƒ½ä¼šåŒ…å«ä¸€ä¸ª Git Object çš„ SHA-1 å€¼ã€‚å½“ä½  <code>checkout</code> ä¸€ä¸ªæ ‡ç­¾ã€æäº¤æˆ–è¿œç¨‹åˆ†æ”¯ï¼Œä½¿å¾—ä½ çš„ä»“åº“å˜æˆ çš„ <a href="https://git-scm.com/docs/git-checkout#_detached_head">detached HEAD</a> çŠ¶æ€æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ˆå…³äºåˆ†ç¦» HEAD å¦ä¸€ç¯‡<a href="https://www.jianshu.com/p/b494ee197ea8">æ–‡ç« </a>ä¹Ÿä»‹ç»è¿‡ï¼‰ã€‚</p>
<p>å½“ä½ æŸ¥çœ‹ HEAD æ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œé€šå¸¸ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ï¼š</p>
<pre><code class="language-shell">$ cat .git/HEAD
ref: refs/heads/main
</code></pre>
<p>ç„¶åï¼Œå¦‚æœæ‰§è¡Œ <code>git checkout test</code>ï¼ŒGit ä¼šæ›´æ–° HEAD æ–‡ä»¶ï¼š</p>
<pre><code class="language-shell">$ git checkout test
Switched to branch 'test'

$ cat .git/HEAD
ref: refs/heads/test
</code></pre>
<p>å½“æ‰§è¡Œ <code>git commit</code> æ—¶ï¼Œè¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªã€Œæäº¤å¯¹è±¡ã€ï¼Œå¹¶ç”¨ HEAD æ–‡ä»¶ä¸­é‚£ä¸ªå¼•ç”¨æ‰€æŒ‡å‘çš„ SHA-1 å€¼è®¾ç½®å…¶çˆ¶æäº¤å­—æ®µã€‚</p>
<p>åŒæ ·åœ°ï¼ŒGit æä¾›äº†ä¸€ä¸ªæ›´åŠ å®‰å…¨çš„å‘½ä»¤ï¼š<code>git symbolic-ref</code>ã€‚æ—¢å¯ä»¥ç”¨æ¥æŸ¥çœ‹ HEAD å¼•ç”¨å¯¹åº”çš„å€¼ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è®¾ç½® HEAD å¼•ç”¨çš„å€¼ã€‚</p>
<pre><code class="language-shell">$ git symbolic-ref HEAD
refs/heads/main

$ git symbolic-ref HEAD refs/heads/test

$ cat .git/HEAD
ref: refs/heads/test
</code></pre>
<p>ä½†æ˜¯ï¼Œä¸èƒ½æŠŠç¬¦å·å¼•ç”¨è®¾ç½®ä¸ºä¸€ä¸ªä¸ç¬¦åˆå¼•ç”¨è§„èŒƒçš„å€¼ï¼š</p>
<pre><code class="language-shell">$ git symbolic-ref HEAD test
fatal: Refusing to point HEAD outside of refs/
</code></pre>
<h4>3.2 æ ‡ç­¾å¼•ç”¨</h4>
<p>åœ¨ Git ä¸­ï¼Œæ ‡ç­¾çš„ä½œç”¨å°±æ˜¯ç»™æŸä¸ªæäº¤å¯¹è±¡åŠ ä¸Šä¸€ä¸ªæ›´å‹å¥½çš„åå­—ç½¢äº†ï¼Œåˆ†ä¸ºã€Œè½»é‡æ ‡ç­¾ã€ï¼ˆlightweightï¼‰å’Œã€Œé™„æ³¨æ ‡ç­¾ã€ï¼ˆannotatedï¼‰ä¸¤ç§ã€‚</p>
<p>å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ªè½»é‡æ ‡ç­¾ï¼š</p>
<pre><code class="language-shell">$ git update-ref refs/tags/v1.0.0 242bd136ff24d2880a68f2de9a8a3a66a0338eea
</code></pre>
<p>è‹¥è¦åˆ›å»ºä¸€ä¸ªé™„æ³¨æ ‡ç­¾ï¼ŒGit ä¼šåˆ›å»ºä¸€ä¸ªæ ‡ç­¾å¯¹è±¡ï¼Œå¹¶è®°å½•ä¸€ä¸ªå¼•ç”¨æ¥æŒ‡å‘è¯¥æ ‡ç­¾å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥æŒ‡å‘æäº¤å¯¹è±¡ã€‚ä¸‹é¢ä½¿ç”¨ <code>git tag -a</code> å‘½ä»¤æ¥ç”Ÿæˆï¼š</p>
<pre><code class="language-shell">$ git tag -a v2.0.0 086ba597542c232e267d4b9aa4c0d3d4bcf2411a -m 'latest tag'
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬å¯¹æ¯”çœ‹ä¸‹ä¸¤ä¸ª Tag çš„å†…å®¹ï¼š</p>
<pre><code class="language-shell">$ cat .git/refs/tags/v1.0.0
242bd136ff24d2880a68f2de9a8a3a66a0338eea

$ git cat-file -p 242bd136ff24d2880a68f2de9a8a3a66a0338eea
tree d50d689553de001d8537d94dae3cb2c89788dae1
author Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800
committer Frankie &lt;1426203851@qq.com&gt; 1647702687 +0800

first commit

$ git cat-file -t 242bd136ff24d2880a68f2de9a8a3a66a0338eea
commit
</code></pre>
<pre><code class="language-shell">$ cat .git/refs/tags/v2.0.0
980d0eab8a71de526ebd1eece1f6cbe33db0931b

$ git cat-file -p 980d0eab8a71de526ebd1eece1f6cbe33db0931b
object 086ba597542c232e267d4b9aa4c0d3d4bcf2411a
type commit
tag v2.0.0
tagger Frankie &lt;1426203851@qq.com&gt; 1647771598 +0800

latest tag

$ git cat-file -t 980d0eab8a71de526ebd1eece1f6cbe33db0931b
tag
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ ‡ç­¾å¯¹è±¡çš„ <code>object</code> æ¡ç›®æŒ‡å‘äº†æˆ‘ä»¬æ‰“äº†æ ‡ç­¾çš„é‚£ä¸ªæäº¤å¯¹è±¡çš„ SHA-1 å€¼ã€‚ä½†æ˜¯ï¼Œæ ‡ç­¾å¯¹è±¡å¹¶éå¿…é¡»æŒ‡å‘æŸä¸ªæäº¤å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„ Git å¯¹è±¡æ‰“æ ‡ç­¾ã€‚</p>
<h4>3.3 è¿œç¨‹å¼•ç”¨</h4>
<p>æ¥ç€ä»‹ç»ç¬¬ä¸‰ç§å¼•ç”¨ç±»å‹ï¼šè¿œç¨‹å¼•ç”¨ï¼ˆremote referenceï¼‰ã€‚å¦‚æœä½ æ·»åŠ äº†ä¸€ä¸ªè¿œç¨‹ç‰ˆæœ¬åº“å¹¶å¯¹å…¶æ‰§è¡Œè¿‡æ¨é€æ“ä½œï¼ŒGit ä¼šè®°å½•ä¸‹æœ€è¿‘ä¸€æ¬¡æ¨é€æ—¶æ¯ä¸ªåˆ†æ”¯æ‰€å¯¹åº”çš„å€¼ï¼Œå¹¶ä¿å­˜åœ¨ <code>.git/refs/remotes</code> ç›®å½•ä¸‹ã€‚</p>
<p>ä¸‹é¢æ˜¯æœªæ¨é€è¿‡ï¼Œ<code>.git/refs</code> çš„ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="language-shell">$ tree .git/refs
.git/refs
â”œâ”€â”€ heads
â”‚   â”œâ”€â”€ main
â”‚   â””â”€â”€ test
â””â”€â”€ tags
    â”œâ”€â”€ v1.0.0
    â””â”€â”€ v2.0.0

2 directories, 4 files
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°† <code>main</code> åˆ†æ”¯æ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œç„¶åå†è§‚å¯Ÿä¸‹ <code>.git/refs</code> ç›®å½•çš„å˜åŒ–ã€‚</p>
<pre><code class="language-shell">$ git remote add origin git@github.com:toFrankie/simple-git.git

$ git push origin main
Enumerating objects: 7, done.
Counting objects: 100% (7/7), done.
Delta compression using up to 12 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (7/7), 507 bytes | 507.00 KiB/s, done.
Total 7 (delta 0), reused 0 (delta 0), pack-reused 0
To github.com:toFrankie/simple-git.git
 * [new branch]      main -&gt; main

$ tree .git/refs
.git/refs
â”œâ”€â”€ heads
â”‚   â”œâ”€â”€ main
â”‚   â””â”€â”€ test
â”œâ”€â”€ remotes
â”‚   â””â”€â”€ origin
â”‚       â””â”€â”€ main
â””â”€â”€ tags
    â”œâ”€â”€ v1.0.0
    â””â”€â”€ v2.0.0

4 directories, 5 files

$ cat .git/refs/remotes/origin/main
086ba597542c232e267d4b9aa4c0d3d4bcf2411a
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ–°å¢äº† <code>.git/refs/remotes/origin/main</code> æ–‡ä»¶ï¼Œå…¶å†…å®¹ <code>086ba597542c232e267d4b9aa4c0d3d4bcf2411a</code> æ­£æ˜¯æœ€æ–°ä¸€æ¬¡çš„æäº¤å¯¹è±¡çš„ SHA-1 å€¼ã€‚</p>
<blockquote>
<p>è¿œç¨‹å¼•ç”¨ï¼ˆä½äº <code>refs/remotes</code> ç›®å½•ä¸‹çš„å¼•ç”¨ï¼‰å’Œåˆ†æ”¯ï¼ˆä½äº <code>refs/heads</code> ç›®å½•ä¸‹çš„å¼•ç”¨ï¼‰ä¹‹é—´æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œè¿œç¨‹å¼•ç”¨æ˜¯<strong>åªè¯»</strong>çš„ã€‚</p>
</blockquote>
<p>å°½ç®¡ä½ å¯ä»¥é€šè¿‡ <code>git checkout</code> åˆ‡æ¢è‡³æŸä¸ªè¿œç¨‹å¼•ç”¨ï¼Œä½†æ˜¯ Git ä¸ä¼šå°† HEAD å¼•ç”¨æŒ‡å‘è¯¥è¿œç¨‹å¼•ç”¨ã€‚ä½ æ°¸è¿œä¸èƒ½é€šè¿‡ commit å‘½ä»¤æ¥æ›´æ–°è¿œç¨‹å¼•ç”¨ã€‚Git å°†è¿™äº›è¿œç¨‹å¼•ç”¨ä½œä¸ºè®°å½•è¿œç¨‹æœåŠ¡å™¨ä¸Šå„åˆ†æ”¯æœ€åå·²çŸ¥ä½ç½®çŠ¶æ€çš„ä¹¦ç­¾æ¥ç®¡ç†ã€‚</p>
<!--

## ä¸‰ã€git log ä¸ git reflog

åœ¨å‰ä¸€ç¯‡[æ–‡ç« ](https://www.jianshu.com/p/b494ee197ea8)ä¸­æåˆ°è¿‡ï¼šã€Œåˆ†æ”¯ã€æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª commit ID ç»„æˆçš„é›†åˆã€‚

-->
<p>æœªå®Œå¾…ç»­...</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/atlas-comstock/YongHaoWu.github.io/blob/master/_posts/2017-06-18-TheGitYouShouldKnow.md">ä½ ä»¬ä»æœªæŒæ¡é‚£å¤©æ‰€å­¦çš„ git çŸ¥è¯†</a></li>
<li><a href="https://learngitbranching.js.org/">Learn Git Branching</a></li>
<li><a href="https://git-scm.com/book/en/v2/Git-Internals-Git-Objects">Git Internals - Git Objects</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»†è¯» Git | å¼„æ‡‚ originã€HEADã€FETCH_HEAD ç›¸å…³å†…å®¹]]></title>
            <link>https://github.com/toFrankie/blog/issues/107</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/107</guid>
            <pubDate>Sat, 25 Feb 2023 12:47:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-77c771ec5c729dcf.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-77c771ec5c729dcf.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æºè‡ª Freepik"></p>
<p>å¦‚æœå¤§å®¶å¹³å¸¸éƒ½åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„è¯ï¼Œé‚£ä¹ˆä¸€å®šæ¯å¤©éƒ½èƒ½è§åˆ° <code>origin</code>ï¼Œè¯¸å¦‚ï¼š</p>
<pre><code class="language-shell">$ git push origin main
$ git fetch origin main
$ git pull origin main
# ...
</code></pre>
<p>è¿™é‡Œçš„ <code>origin</code>ï¼Œè¿˜æœ‰çœ‹ä¼¼ç›¸åŒçš„ <code>origin/master</code>ã€<code>origin/main</code> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h2>ä¸€ã€è¿œç¨‹åç§°ï¼ˆRemote Nameï¼‰</h2>
<p>åœ¨ Git ä¸­ï¼Œå…¶å®æ— è®ºæ˜¯ <code>origin</code>ï¼Œè¿˜æ˜¯ <code>upstream</code> å¹¶æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œä½†ç”±äºè¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› æ­¤å®ƒä»¬æœ‰äº†çº¦å®šä¿—æˆã€ä¼—æ‰€å‘¨çŸ¥çš„å«ä¹‰ã€‚</p>
<p>å°±å¥½æ¯”å¦‚è¯´ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­å°æ˜ã€å°çº¢æ˜¯å†æ™®é€šä¸è¿‡çš„åå­—ï¼Œä½†ç”±äºåœ¨å°å­¦è¯­æ–‡è¯¾æœ¬çš„å¯¹è¯ä¸­å¸¸è¢«ä½œä¸ºç”·ä¸€å¥³ä¸€ï¼Œç”¨äºè¡¨ç¤ºå¯¹è¯çš„ä¸¤ä¸ªäººè€Œå·²ï¼Œå¹¶æ²¡æœ‰ç‰¹åˆ«çš„æ„ä¹‰åœ¨é‡Œé¢ã€‚è€Œåœ¨æŠ€æœ¯åšæ–‡ä¸­ï¼Œç»å¸¸å¯ä»¥çœ‹åˆ°ä½¿ç”¨ <code>foo</code>ã€<code>bar</code> ä½œä¸ºå˜é‡æ ‡è¯†ç¬¦ä¸¾ä¾‹ï¼Œå®ƒä»¬å°±ç›¸å½“äºè¯­æ–‡è¯¾æœ¬ä¸­çš„å°æ˜ã€å°çº¢ä¸€æ ·ã€‚é‚£ä¹ˆæœ¬æ–‡æ¥ä¸‹æ¥è¦è®¨è®ºçš„ <code>origin</code>ã€<code>upstream</code> ç­‰ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚</p>
<p>å…ˆæ¥ä¸ªé¤å‰èœ...</p>
<p>å¦‚æœæˆ‘è·Ÿä½ è¯´ï¼Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤æ˜¯å®Œå…¨ç­‰æ•ˆçš„ï¼Œä½ æ˜¯ä¸æ˜¯å°±å·®ä¸å¤šçŒœå¾—å‡º <code>origin</code> è¡¨ç¤ºä»€ä¹ˆäº†ï¼Ÿ</p>
<pre><code class="language-shell">$ git push origin main
$ git push git@github.com:toFrankie/repo-demo.git main
</code></pre>
<p>æ˜¯çš„ï¼Œè·Ÿä½ çŒœçš„ä¸€æ ·...</p>
<h4>1.1 Origin</h4>
<p>æˆ‘ä»¬ç”¨ç¤ºä¾‹æ¥è®²...</p>
<p>å…ˆåœ¨æœ¬åœ°éšæ„åˆ›å»ºä¸€ä¸ª Git ä»“åº“ <code>repo-demo</code>ï¼Œç„¶åæ–°å¢ä¸€ä¸ª <code>README.md</code> æ–‡ä»¶ï¼Œæ¥ç€ Commit ä¸€ä¸‹ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a04c9d8f4d6dfad6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»¥ä¸Šéƒ½æ²¡é—®é¢˜ï¼æ¥ç€ï¼Œæˆ‘ä»¬è¯•ç€ Push ä¸€ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bf39059db2a5180d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¯ä»¥çœ‹åˆ° <code>git push</code> å¤±è´¥äº†ï¼ŒåŸå› å¾ˆå®¹æ˜“ç†è§£ï¼šæˆ‘ä»¬åªæ˜¯åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œå¹¶æ²¡æœ‰å°†æœ¬ä»“åº“ä¸è¿œç¨‹ä»“åº“è¿›è¡Œå…³è”ï¼Œå› æ­¤ Git æ— æ³•ç†è§£æ˜¯å°†å…¶æ¨é€è‡³å“ªä¸ªä»£ç æ‰˜ç®¡å¹³å°ï¼Œç„¶åä¹Ÿä¸çŸ¥é“æ˜¯å¹³å°ä¸Šçš„å“ªä¸ªè¿œç¨‹ä»“åº“ï¼Œæ˜¯ GitHub å¹³å°çš„ï¼Œè¿˜æ˜¯ GitLab å¹³å°çš„ï¼Ÿæ˜¯å¹³å°ä¸Šçš„ React ä»“åº“ï¼Œè¿˜æ˜¯ Vue ä»“åº“ï¼Œè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆä»“åº“ï¼ŸGit ç»Ÿç»Ÿéƒ½ä¸çŸ¥é“ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯æ— æ³•æ›¿ä½ åŠäº‹äº†ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠæœ¬åœ°çš„ <code>repo-demo</code> ä»“åº“ä¸è¿œç¨‹ä»“åº“å…³è”ä¸€ä¸‹ï¼ˆè¯·æ³¨æ„ï¼Œä¸€ä¸ªæœ¬åœ°ä»“åº“æ˜¯å¯ä»¥å…³è”å¤šä¸ªè¿œç¨‹ä»“åº“çš„ï¼‰ï¼š</p>
<pre><code class="language-shell">$ git remote add origin &lt;repo_address&gt;
</code></pre>
<p>è¿™é‡Œç”¨åˆ°äº† <code>origin</code>ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡ä¸ºä»€ä¹ˆç”¨ <code>origin</code>ï¼Œç”¨å…¶ä»–ï¼ˆæ¯”å¦‚ <code>foo</code>ï¼‰è¡Œä¸è¡Œçš„é—®é¢˜ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼‰</p>
<p>å…³è”ä¹‹åï¼Œå†è¿›è¡Œ Push å°±èƒ½æˆåŠŸäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-661cba085fc9327c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é‚£ä¹ˆ <code>git remote add</code> å†…éƒ¨åšäº†ä»€ä¹ˆé»˜é»˜æ— é—»çš„å·¥ä½œå‘¢ï¼Œå®ƒå…¶å®æ˜¯å¾€ <code>.git/config</code> ä¸­å†™å…¥äº†ä¸€ä¸ªå« <code>[remote &quot;origin&quot;]</code> é…ç½®ï¼š</p>
<pre><code class="language-ini">[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
	ignorecase = true
	precomposeunicode = true
[remote &quot;origin&quot;]
	url = git@github.com:toFrankie/repo-demo.git
	fetch = +refs/heads/*:refs/remotes/origin/*
</code></pre>
<p>å¦‚æœä½ æœ¬åœ°çš„ä»“åº“æ˜¯é€šè¿‡ <code>git clone</code> ä¸‹æ¥çš„ï¼ŒGit ä¼šé»˜è®¤å°†è¿œç¨‹ä»“åº“å‘½åä¸º <code>origin</code>ï¼Œè‡ªåŠ¨å¸®ä½ å…³è”ä¸Šè¿œç«¯ä»“åº“ï¼ˆå¯åœ¨ <code>.git/config</code> æ–‡ä»¶ä¸­çœ‹åˆ°å·²æœ‰ <code>[remote &quot;origin&quot;]</code> é…ç½®é¡¹äº†ï¼‰ï¼Œå› æ­¤ Commit ä¹‹åå°±èƒ½ç›´æ¥ Push äº†ã€‚</p>
<blockquote>
<p>When a repo is cloned, it has a default remote called <code>origin</code> that points to your fork on GitHub, not the original repo it was forked from.ï¼ˆå¼•è‡ª <a href="https://stackoverflow.com/questions/9257533/what-is-the-difference-between-origin-and-upstream-on-github/9257901#9257901">Github page</a>ï¼‰</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬åœ¨ GitHub æ–°åˆ›å»ºä¸€ä¸ª Repository çš„è¯ï¼Œä¼šçœ‹åˆ°ä»¥ä¸‹æŒ‡å¼•ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a670e076b8e178e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œè¿™é…ç½®è¡¨ç¤ºä»€ä¹ˆæ„æ€ã€‚</p>
<pre><code class="language-ini">[remote &quot;origin&quot;]
	url = git@github.com:toFrankie/repo-demo.git
	fetch = +refs/heads/*:refs/remotes/origin/*
</code></pre>
<p>é€šè¿‡ <code>git remote add</code> å‘½ä»¤ï¼Œæ·»åŠ äº†ä¸€ä¸ªå«åš <code>origin</code> çš„è¿œç¨‹åç§°ï¼ˆRemote Nameï¼‰ï¼Œ</p>
<ul>
<li>å…¶ä¸­ <code>url</code> å‚æ•°ï¼Œè¡¨ç¤ºè¯¥è¿œç¨‹åç§°å¯¹åº”çš„è¿œç¨‹ä»“åº“åœ°å€ã€‚</li>
<li>å…¶ä¸­ <code>fetch</code> å‚æ•°åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä»¥å†’å· <code>:</code> è¿›è¡Œåˆ†å‰²ï¼Œå†’å·å·¦è¾¹è¡¨ç¤ºæœ¬åœ°ä»“åº“æ–‡ä»¶å¤¹ï¼Œå†’å·å³è¾¹è¡¨ç¤ºè¿œç¨‹ä»“åº“åœ¨æœ¬åœ°çš„å‰¯æœ¬æ–‡ä»¶å¤¹ã€‚é‡Œé¢çš„åŠ å· <code>+</code> è¡¨ç¤ºå¾€é‡Œé¢æ·»åŠ æ•°æ®çš„æ„æ€ã€‚</li>
</ul>
<p>å½“ä½¿ç”¨ <code>git fetch origin</code> æ—¶ï¼ŒGit å°†è¿œç¨‹ä»“åº“ä¸‹çš„æ‰€æœ‰åˆ†æ”¯æ‹‰å–åˆ°æœ¬åœ°çš„ <code>refs/remotes/origin/</code> ç›®å½•ä¸‹ï¼Œç„¶å <code>git merge</code> æ—¶ï¼Œå®ƒä¼šæŠŠ <code>refs/remotes/origin/</code> ç›®å½•ä¸‹çš„å¯¹åº”åˆ†æ”¯åˆå¹¶åˆ° <code>refs/heads/</code> ç›®å½•ä¸‹å¯¹åº”åˆ†æ”¯ä¸Šã€‚</p>
<p>é‚£ä¹ˆ <code>origin</code> ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p><strong>è¯·æ³¨æ„ï¼Œ<code>origin</code> åªæ˜¯ä¸€ä¸ªåç§°ï¼ˆåˆ«åï¼‰ï¼Œç”¨äºæŒ‡å‘è¿œç¨‹ä»“åº“ã€‚è¿™ä¸ªåˆ«åæ˜¯å¯ä»¥è‡ªè¡Œä¿®æ”¹çš„ï¼Œæ¯”å¦‚å‘½åä¸º <code>foo</code>ã€<code>bar</code> ç­‰ã€‚ä½¿ç”¨åˆ«åå¥½å¤„æ˜¯ã€Œæ–¹ä¾¿ã€ã€‚</strong></p>
</blockquote>
<p>æ¯”èµ·è®°ä½ä¸€ä¸ªè¿œç¨‹ä»“åº“åœ°å€ï¼Œåˆ«åå®åœ¨æ–¹ä¾¿å¤ªå¤šäº†ã€‚å°† <code>origin</code> ä½œä¸ºè¿œç¨‹ä»“åº“çš„åˆ«åæ˜¯è¾ƒä¸ºæ™®éçš„åšæ³•ï¼Œå†µä¸”æ‰€æœ‰ä»£ç æ‰˜ç®¡å¹³å°é»˜è®¤å°±æ˜¯ <code>origin</code>ã€‚</p>
<p>å›åˆ°æ–‡ç« å¼€å¤´çš„ä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ git push origin main

# ç›¸å½“äºï¼ˆå…¶ä¸­ origin æŒ‡å‘äº† git@github.com:toFrankie/repo-demo.git è¿œç¨‹ä»“åº“ï¼‰
$ git push git@github.com:toFrankie/repo-demo.git main
</code></pre>
<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œè¿™æ ·å°±æ›´èƒ½ä½“ç°åˆ«åçš„ä¼˜åŠ¿äº†ï¼Œç®€æ´å¾ˆå¤šã€‚</p>
<p>æ—¢ç„¶æ˜¯åˆ«åï¼Œè‡ªç„¶æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell"># æ–°å¢è¿œç¨‹åç§°ï¼ˆä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼Œå¯ä»¥å…³è”å¤šä¸ªè¿œç¨‹ä»“åº“ï¼‰
$ git remote add &lt;remote-name&gt; &lt;repo-address&gt;

# åˆ é™¤å·²å­˜åœ¨è¿œç¨‹åç§°ï¼ˆåªä¼šç§»é™¤æœ¬åœ°ä»“åº“ä¸è¿œç¨‹ä»“åº“çš„ç®¡ç†ï¼Œä¸ä¼šåˆ é™¤è¿œç¨‹ä»“åº“çš„ä»£ç å“ˆï¼‰
$ git remote rm &lt;remote-name&gt;

# æ›´æ–°è¿œç¨‹åç§°å…³è”çš„è¿œç¨‹ä»“åº“
$ git remote set-url &lt;remote-name&gt; &lt;repo-address&gt;

# ä¿®æ”¹è¿œç¨‹åç§°ï¼ˆä¹Ÿå¯ä»¥å…ˆåˆ é™¤å†æ·»åŠ ï¼‰
$ git remote rename &lt;old-remote-name&gt; &lt;new-remote-name&gt;
</code></pre>
<p>æ¯”å¦‚ï¼Œåƒè¿™æ ·ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1b1a5be00c2169bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç„¶åï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹è¿œç¨‹åç§°ä¸º <code>foo</code>ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f6175501c7d65988.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬éšæ„ä¿®æ”¹ä¸ªæ–‡ä»¶ Push ä¸€ä¸‹ï¼Œæ˜¯è¿™æ ·çš„ <code>git push foo main</code>ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-13da84b3e0ab33ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åˆ°è¿™é‡Œï¼Œä½ åº”å½»åº•æ˜ç™½ <code>origin</code> æ˜¯ä»€ä¹ˆäº†å§ã€‚</p>
<p>å‰é¢æåˆ°è¿‡ï¼Œä¸€ä¸ªæœ¬åœ°ä»“åº“æ˜¯å¯ä»¥å…³è”å¤šä¸ªè¿œç¨‹ä»“åº“çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ git remote add bar git@github.com:toFrankie/git-test-demo.git
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹ <code>.git/congfig</code> é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼ˆæˆ–è€…é€šè¿‡ <code>git remote -v</code> æŸ¥çœ‹ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7184519ee805dedc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ«å <code>foo</code> å’Œ <code>bar</code> åˆ†åˆ«æŒ‡å‘äº†ä¸¤ä¸ªä¸åŒçš„è¿œç¨‹ä»“åº“ï¼Œç„¶åä½¿ç”¨æ–¹æ³•ä¸ <code>origin</code> æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell"># å°†æœ¬åœ°çš„ main åˆ†æ”¯æ¨é€è‡³ foo å¯¹åº”çš„è¿œç¨‹ä»“åº“ï¼ˆrepo-demoï¼‰
$ git push foo main

# å°†æœ¬åœ°çš„ main åˆ†æ”¯æ¨é€è‡³ bar å¯¹åº”çš„è¿œç¨‹ä»“åº“ï¼ˆgit-test-demoï¼‰
$ git push bar main
</code></pre>
<h4>1.2 upstreamï¼ˆä¸€ä¸ªç‰¹æ®Šçš„ remote nameï¼‰</h4>
<p><code>upstream</code> çš„è¯‘ä¸ºâ€œä¸Šæ¸¸â€ã€‚å½“ä½  <code>git clone</code> ä¸€ä¸ªåˆ«äººçš„ Repository åˆ°æœ¬åœ°ï¼Œç”±äºä½ ä¸æ˜¯è¯¥ä»“åº“çš„æˆå‘˜ï¼Œå› æ­¤ä½ æ˜¯æ— æ³•å‘è¯¥ä»“åº“æ¨é€ä»£ç çš„ã€‚æ­¤æ—¶ï¼Œç›¸è¾ƒäºæœ¬åœ°ä»“åº“ï¼Œåˆ«äººçš„è¿™ä¸ª Repository ç§°ä¸º <code>upstream</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ Fork è¿™ä¸ª Repository åˆ°è‡ªå·± GitHub è´¦å·ä¸‹ï¼Œç„¶åé€šè¿‡ <code>git clone</code> å°†è¿™ä¸ª Fork å‡ºæ¥çš„ä»“åº“å…‹éš†åˆ°æœ¬åœ°ç”µè„‘ä¸Šã€‚ï¼ˆä¸‹æ–‡å°†è¿™ä¸ªåˆ«äººçš„ä»“åº“ç§°ä¸º <code>Upstream-Repo</code>ï¼ŒFork å‡ºæ¥çš„ä»“åº“ç§°ä¸º <code>Origin-Repo</code>ï¼‰</p>
<p>å¤§è‡´å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼ˆ<a href="https://www.bogotobogo.com/DevOps/SCM/Git/GitHub_Fork_Clone_Origin_Upstream.php">æºè‡ª</a>ï¼‰ï¼Œå…¶ä¸­ <code>Upstream-Repo</code> å¯¹åº”å›¾ä¸­çš„ Originalï¼Œ<code>Origin-Repo</code> å¯¹åº”å›¾ä¸­ Forkï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-15a516f02e6b3857.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“æˆ‘ä»¬å°† <code>Origin-Repo</code> å…‹éš†åˆ°æœ¬åœ°ï¼ŒGit ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ª <code>origin</code> çš„åˆ«åæŒ‡å‘ <code>Origin-Repo</code> çš„ä»“åº“åœ°å€ã€‚</p>
<p>å¦‚æœè¦è·Ÿè¸ª <code>Upstream-Repo</code> ä»“åº“çš„å˜æ›´ï¼Œæ‚¨éœ€è¦æ·»åŠ å¦ä¸€ä¸ªåä¸º <code>upstream</code> çš„åˆ«åï¼Œä½¿å…¶æŒ‡å‘ <code>Upstream-Repo</code> ä»“åº“ã€‚</p>
<pre><code class="language-shell"># 1. æ·»åŠ ä¸Šæ¸¸ä»“åº“çš„åˆ«å
$ git remote add upstream &lt;upstream-repo-address&gt;

# 2. è·å–ä¸Šæ¸¸ä»“åº“çš„å˜æ›´
$ git fetch upstream

# 3. æœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥é€šè¿‡ merge æˆ– rebase æ–¹å¼åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­ï¼Œæ¯”å¦‚ï¼š
$ git merge upstream/main
</code></pre>
<p><strong>å°½ç®¡æ·»åŠ äº† <code>upstream</code>ï¼Œè¯¸å¦‚ <code>git push upstream main</code> ç­‰æ–¹å¼è¯•å›¾å‘ <code>Upstream-Repo</code> æäº¤ä»£ç ä»ç„¶æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå› ä¸ºä½ ä¸æ˜¯ <code>Upstream-Repo</code> ä»“åº“çš„æˆå‘˜</strong>ã€‚æƒ³ç»™ <code>Upstream-Repo</code> ä»“åº“è´¡çŒ®ä»£ç çš„è¯ï¼Œåªèƒ½é€šè¿‡ <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">Pull Request</a> çš„æ–¹å¼ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸€èŠ‚æåˆ°çš„ <code>upstream</code> ä¹Ÿæ˜¯ä¸€ä¸ªçº¦å®šä¿—ç§°çš„åˆ«åï¼Œä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚</p>
<h4>1.3 å°ç»“</h4>
<p>é™¤äº† <code>origin</code>ã€<code>upstream</code> ç­‰æœ‰ä¼—æ‰€å‘¨çŸ¥çš„å«ä¹‰çš„è¿œç¨‹åç§°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p>
<p>ç”±äºä¸€ä¸ªæœ¬åœ°ä»“åº“æ˜¯å¯ä»¥å…³è”å¤šä¸ªè¿œç¨‹ä»“åº“çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªã€Œåˆ«åã€åˆ†åˆ«æŒ‡å‘ä¸åŒçš„è¿œç¨‹ä»“åº“ï¼ˆæ¯”å¦‚ä¸€ä¸ª GitHubã€ä¸€ä¸ª GitLabã€ä¸€ä¸ª Giteeï¼‰ï¼Œç„¶åé€šè¿‡åˆ«åçš„æ–¹å¼æ–¹ä¾¿ã€å¿«é€Ÿåœ°æ‹‰å–æŸä¸ªè¿œç¨‹ä»“åº“çš„ä»£ç æˆ–è€…å°†ä»£ç æ¨é€è‡³æŸä¸ªè¿œç¨‹ä»“åº“ã€‚</p>
<pre><code class="language-shell"># æ·»åŠ  github åˆ«å
$ git remote add github git@github.com:toFrankie/repo-demo.git

# æ·»åŠ  gitlab åˆ«å
$ git remote add gitlab git@gitlab.com:toFrankie/repo-demo.git

# æ·»åŠ  gitee åˆ«å
$ git remote add gitee git@gitee.com:toFrankie/repo-demo.git
</code></pre>
<p>å°ç»“ä¸€ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>
<p>å¸¸è§çš„ <code>origin</code>ã€<code>upstream</code> éƒ½åªæ˜¯é€šè¿‡ <code>git remote add</code> å‘½ä»¤åˆ›å»ºçš„<strong>åç§°</strong>ï¼ˆRemote Nameï¼‰ï¼Œç”¨äºæŒ‡å‘æŸä¸ªè¿œç¨‹ä»“åº“ï¼ˆRemote URLï¼‰ã€‚</p>
</li>
<li>
<p>å¸¸ç”¨ <code>origin</code> ä½œä¸ºè¿œç¨‹ä»“åº“çš„åˆ«åï¼Œæ˜¯ä¸€ä¸ªè¾ƒä¸ºä¸»æµçš„åšæ³•ã€‚åŒæ—¶ï¼Œä¹Ÿæ˜¯å„å¤§ä»£ç æ‰˜ç®¡å¹³å°çš„é»˜è®¤åç§°ï¼ˆå³ <code>git clone</code> ä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼Œ Git ä¼šé»˜è®¤å°† <code>origin</code> æŒ‡å‘è¯¥ä»“åº“ï¼‰ã€‚å¦‚æœä½ è§‰å¾—ä¸çˆ½ï¼Œå®Œå…¨å¯ä»¥è‡ªå®šä¹‰ï¼ˆ<code>git remote set-url</code>ï¼‰ä¸ºâ€œé˜¿çŒ«â€ã€â€œé˜¿ç‹—â€ç­‰åç§°ã€‚</p>
</li>
<li>
<p>æŸ¥çœ‹æœ¬åœ°ä»“åº“å…³è”çš„è¿œç¨‹ä»“åº“ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ <code>.git/config</code> æ–‡ä»¶æˆ–é€šè¿‡ <code>git remote -v</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨åˆ«åçš„æœ€å¤§å¥½å¤„æ˜¯ï¼Œæ— éœ€è®°ä½è¿œç¨‹ä»“åº“çš„ URLï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„å¥½å¤„å§ã€‚ä¸ç”¨ä¹Ÿæ˜¯å®Œå…¨ OK çš„ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¿œç¨‹ä»“åº“ URLï¼Œä½†æˆ‘æƒ³ä¸ä¼šæœ‰è¿™ç§æœ‹å‹å§ã€‚</p>
</li>
</ul>
</blockquote>
<p><strong>ï¼ˆå»ºè®®ï¼‰è‹¥æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸è¦ä¸ºäº†ä¸ªæ€§ï¼Œè¯•å›¾æ›´æ”¹ <code>origin</code>ã€<code>upstream</code> ç­‰è¢«å¹¿æ³›ä½¿ç”¨çš„åˆ«åï¼Œå…¶ä¸­æ‰€è¡¨ç¤ºçš„çº¦å®šä¿—æˆçš„ã€ä¼—æ‰€å‘¨çŸ¥çš„å«ä¹‰ã€‚</strong></p>
<h2>äºŒã€è¿œç¨‹åˆ†æ”¯ï¼ˆRemote Branchï¼‰</h2>
<p>å¸¸è¯´çš„ã€Œè¿œç¨‹åˆ†æ”¯ã€æ˜¯è¿œç¨‹ä»“åº“å¯¹åº”åˆ†æ”¯åœ¨æœ¬åœ°çš„ä¸€ä¸ªå‰¯æœ¬ã€‚æ¯”å¦‚å¸¸è§çš„ <code>origin/master</code>ã€<code>origin/main</code>ã€<code>origin/develop</code> ç­‰éƒ½æ˜¯è¿œç¨‹åˆ†æ”¯ï¼Œå¯ä»¥åœ¨ <code>.git/refs/remotes/</code> ç›®å½•ä¸‹çœ‹åˆ°ã€‚</p>
<pre><code class="language-shell"># æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°åˆ†æ”¯
$ git branch

# æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åˆ†æ”¯ï¼ˆ-r æ˜¯ --remotes çš„ç®€å†™ï¼‰
$ git branch -r

# æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ï¼ˆ-a æ˜¯ --all çš„ç®€å†™ï¼‰
$ git branch -a
</code></pre>
<p>å¯ä»¥é€šè¿‡ <code>git branch -r</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰çš„è¿œç¨‹åˆ†æ”¯ï¼š</p>
<pre><code class="language-shell">$ git branch -r
  origin/HEAD -&gt; origin/main
  origin/dev
  origin/main
</code></pre>
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-d4232c62376d3bc3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p>å¦‚æœå¯¹ <code>origin/HEAD</code> ä¸ç†è§£çš„è¯ï¼Œå…ˆä¸ç®¡ä¸‹æ–‡ä¼šä»‹ç»ã€‚</p>
<p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬ä»‹ç»äº†è¿œç¨‹åç§°åªæ˜¯ä¸€ä¸ªä»£å·ã€åˆ«åï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°† Remote Name ç”± <code>origin</code> ä¿®æ”¹ä¸º <code>foo</code>ï¼Œé‚£ä¹ˆè¿œç¨‹åˆ†æ”¯ï¼Œä¼šä¸ä¼šç”± <code>origin/main</code> å˜ä¸º <code>foo/main</code> å‘¢ï¼Ÿ</p>
<p>ä¿®æ”¹å‰ï¼š</p>
<pre><code>$ git remote -v
origin  git@github.com:toFrankie/repo-demo.git (fetch)
origin  git@github.com:toFrankie/repo-demo.git (push)

$ git branch -r
  origin/HEAD -&gt; origin/main
  origin/dev
  origin/main
</code></pre>
<p>ä¿®æ”¹åï¼š</p>
<pre><code>$ git remote rename origin foo

$ git remote -v
foo     git@github.com:toFrankie/repo-demo.git (fetch)
foo     git@github.com:toFrankie/repo-demo.git (push)

$ git branch -r
  foo/HEAD -&gt; foo/main
  foo/dev
  foo/main
</code></pre>
<p>æœç„¶ï¼Œå°†è¿œç¨‹åç§°ä¿®æ”¹ä¹‹åï¼Œè¿œç¨‹åˆ†æ”¯åç§°ä¹Ÿä¼šè·Ÿç€æ”¹å˜çš„ã€‚æˆ‘ä»¬é€šè¿‡ <code>tree</code> å‘½ä»¤çœ‹ä¸‹ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>$ tree .git/refs
.git/refs
â”œâ”€â”€ heads
â”‚   â”œâ”€â”€ dev
â”‚   â””â”€â”€ main
â”œâ”€â”€ remotes
â”‚   â””â”€â”€ foo
â”‚       â”œâ”€â”€ HEAD
â”‚       â”œâ”€â”€ dev
â”‚       â””â”€â”€ main
â””â”€â”€ tags
</code></pre>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œè‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œéƒ½å°†ä»¥ <code>origin</code> ä½œä¸ºè¿œç¨‹åç§°è¿›è¡Œè¯´æ˜æˆ–ä¸¾ä¾‹ã€‚</p>
<p>é€šå¸¸ï¼Œæ‹‰å–æœ€æ–°ä»£ç çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<ol>
<li>
<p>é€šè¿‡ <code>git fetch</code> æ‹‰å–ä»£ç çš„è¿‡ç¨‹ï¼šå…ˆè¯»å– <code>.git/config</code> æ–‡ä»¶é‡Œé¢çš„é…ç½® <code>[remote &lt;remote-name&gt;]</code>ï¼Œå°†é‡Œé¢çš„æ‰€æœ‰ï¼ˆå› ä¸º <code>fetch</code> å¹¶æ²¡æœ‰æŒ‡å®šå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè¿œç¨‹ä»“åº“ï¼‰è¿œç¨‹åç§°å¯¹åº”ä»“åº“çš„åˆ†æ”¯ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¹¶æ”¾åœ¨ <code>.git/refs/remotes/&lt;remote-name&gt;/</code> ç›®å½•ä¸‹ã€‚</p>
<p>æ¯”å¦‚ <code>git fetch origin main</code> ä¼šåˆ›å»ºæˆ–æ›´æ–° <code>.git/refs/remotes/origin/main</code> çš„æ–‡ä»¶ï¼Œæ­¤æ—¶é€šè¿‡ <code>git branch -r</code> å°±èƒ½çœ‹åˆ°ä¸€ä¸ª <code>origin/main</code> çš„åˆ†æ”¯ã€‚ä½†æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯ç”¨ <code>origin/main</code> è€Œä¸æ˜¯ <code>remotes/origin/main</code> å“¦ã€‚</p>
</li>
<li>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€šè¿‡ <code>git diff</code> å‘½ä»¤æ¥å¯¹æ¯”æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„ä¸€äº›ä¿¡æ¯ï¼Œæ‰å†³å®šè¦ä¸è¦åˆå¹¶ã€‚æ¯”å¦‚ï¼Œ<code>git diff main origin/main</code>ã€‚</p>
</li>
<li>
<p>é€šè¿‡ <code>git merge</code> æˆ– <code>git rebase</code> æ¥è¿›è¡Œåˆ†æ”¯åˆå¹¶ã€‚æ¯”å¦‚ <code>git merge origin/main</code>ï¼Œè¡¨ç¤ºå°†è¿œç¨‹åˆ†æ”¯ <code>origin/main</code> åˆå¹¶è‡³æœ¬åœ°åˆ†æ”¯ <code>main</code> ä¸­ã€‚</p>
</li>
</ol>
</blockquote>
<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>git pull</code> å‘½ä»¤ï¼Œå…¶å®åŒ…æ‹¬äº† <code>git fetch</code> å’Œ <code>git merge</code> ä¸¤ä¸ªè¿‡ç¨‹ã€‚<strong>è¯·æ³¨æ„ <code>git fetch</code> å¹¶ä¸ä¼šä¿®æ”¹ã€Œæœ¬åœ°åˆ†æ”¯ã€çš„ä»£ç ã€‚</strong></p>
<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œ<code>refs/remotes/origin/</code> ç›®å½•ä¸‹ï¼Œç›¸åº”çš„åˆ†æ”¯æ–‡ä»¶è®°å½•çš„åªæ˜¯ä¸€ä¸ª <code>Commit-ID</code>ï¼ˆSHA-1ï¼‰ï¼Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ <code>HEAD</code> æ–‡ä»¶ï¼ˆå³ <code>origin/HEAD</code> åˆ†æ”¯ï¼‰è®°å½•çš„æ˜¯ <code>ref: refs/remotes/origin/main</code> çš„ä¸œè¥¿ï¼Œå®ƒå§‹ç»ˆæŒ‡å‘é»˜è®¤è¿œç¨‹åˆ†æ”¯ã€‚</p>
<h2>ä¸‰ã€HEADã€Detached HEADã€origin/HEADã€FETCH_HEADã€ORIG_HEAD åŒºåˆ«</h2>
<p>è¿™ä¸ªå¯¹äºåˆšæ¥è§¦çš„åŒå­¦ï¼Œå¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹æ‡µã€‚</p>
<p>å…¶å® Git ä¸­çš„ã€Œåˆ†æ”¯ã€æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª <code>Commit-ID</code> ç»„æˆçš„é›†åˆã€‚é€šè¿‡ <code>git branch</code> å‘½ä»¤åˆ›å»ºçš„åˆ†æ”¯ï¼Œåªæ˜¯å¯¹æŸä¸ª <code>Commit-ID</code> çš„ã€Œå¼•ç”¨ã€ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>git branch -d</code> åˆ é™¤æŸä¸ªæœ¬åœ°åˆ†æ”¯ï¼Œä¹Ÿåªæ˜¯åˆ é™¤äº†è¿™ä¸ªã€Œå¼•ç”¨ã€è€Œå·²ï¼Œå¹¶ä¸ä¼šåˆ é™¤ä»»ä½•çš„ <code>Commit-ID</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ª <code>Commit-ID</code> æ²¡æœ‰è¢«ä»»ä½•ä¸€ä¸ªåˆ†æ”¯å¼•ç”¨çš„è¯ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åï¼Œå°†ä¼šè¢« Git å›æ”¶æœºåˆ¶åˆ é™¤ã€‚</p>
<p>æœ¬èŠ‚å†…å®¹å°†ä¼šè®²è¿°ä»¥ä¸‹ç›¸å…³å†…å®¹ï¼š</p>
<blockquote>
<ul>
<li><code>HEAD</code> è·Ÿã€Œæœ¬åœ°åˆ†æ”¯ã€ç›¸å…³ã€‚</li>
<li><code>Detached HEAD</code> æ˜¯ä¸€ç§ç‰¹æ®ŠçŠ¶æ€çš„ <code>HEAD</code>ã€‚</li>
<li><code>origin/DEAD</code> è·Ÿã€Œè¿œç¨‹åˆ†æ”¯ã€ç›¸å…³ã€‚</li>
<li><code>FETCH_HEAD</code> è·Ÿ <code>git fetch</code> æ“ä½œç›¸å…³</li>
<li><code>ORIG_HEAD</code> è·Ÿ <code>git merge</code>ã€<code>git reset</code> ç­‰ã€Œå±é™©æ“ä½œã€ç›¸å…³</li>
</ul>
</blockquote>
<h4>3.1 HEAD</h4>
<p>æˆ‘ä»¬åœ¨å“ªèƒ½çœ‹åˆ° <code>HEAD</code> å‘¢ï¼Ÿ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4faf0be9a878e539.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬ä» <code>main</code> åˆ†æ”¯åˆ‡æ¢è‡³ <code>dev</code> åˆ†æ”¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-06008559ae4a62e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¯¹æ¯”å‘ç°ï¼Œ<code>HEAD</code> å‘ç”Ÿæ”¹å˜äº†ã€‚</p>
<p>å‰é¢æåˆ°ï¼Œåˆ†æ”¯åªæ˜¯å¯¹ Commit-ID çš„å¼•ç”¨ã€‚æ¯å½“åœ¨æŸä¸ªåˆ†æ”¯ä¸Šæäº¤ä»£ç ï¼ŒGit éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„ã€å”¯ä¸€çš„ Commit-IDï¼Œæ­¤æ—¶æˆ‘ä»¬çš„åˆ†æ”¯åç§°ä¹Ÿéšä¹‹ç§»å‘æœ€æ–°çš„ä¸€ä¸ª Commit-IDã€‚</p>
<p>å…³äº HEAD å­˜æ”¾äºæœ¬åœ°ä»“åº“çš„ <code>.git/HEAD</code> æ–‡ä»¶é‡Œé¢ï¼Œåˆ©ç”¨ <code>cat</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°å®ƒçš„å†…å®¹ã€‚</p>
<pre><code>$ cat .git/HEAD
ref: refs/heads/dev

$ cat .git/refs/heads/dev
866bc9f1d8f4797c0e46e959cb0c9abdd47d8176
</code></pre>
<p>æ‰€ä»¥è¯´åˆ°åº•ï¼Œæ­¤æ—¶ <code>HEAD</code> åªæ˜¯å¯¹ Commit-ID ä¸º <code>866bc9f1d8f4797c0e46e959cb0c9abdd47d8176</code> çš„å¼•ç”¨ã€‚å¦‚æœåˆ‡å› <code>main</code> åˆ†æ”¯ï¼Œé‚£ä¹ˆ <code>HEAD</code> ç›¸åº”çš„å†…å®¹å°±ä¼šè·Ÿç€æ”¹å˜ã€‚</p>
<p>è€Œ <code>HEAD</code> åˆ™æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ä¸ªå¼•ç”¨ï¼ˆæœ‰äº›æ–‡ç« ç§°ä¸ºã€ŒæŒ‡é’ˆã€ï¼Œä¹Ÿé—®é¢˜ä¸å¤§ï¼‰ã€‚é™¤äº† <code>git commit</code> ä¹‹å¤–ï¼Œ<code>git checkout</code>ã€<code>git reset</code> ç­‰å‘½ä»¤éƒ½ä¼šå½±å“ <code>HEAD</code> çš„æŒ‡å‘ã€‚</p>
<blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼š<strong>HEAD æ˜¯å¯¹å½“å‰ Commit-ID çš„ã€Œå¼•ç”¨ã€ã€‚</strong></p>
<ul>
<li>å½“ä½¿ç”¨ <code>git commit</code> æ—¶ï¼Œ<code>HEAD</code> ä¼šè·Ÿç€ç§»åŠ¨ï¼Œå¹¶æŒ‡å‘æœ€æ–°çš„ Commit-IDã€‚</li>
<li>å½“ä½¿ç”¨ <code>git checkout</code> æ—¶ï¼Œ<code>HEAD</code> ä¼šç§»åŠ¨å¹¶æŒ‡å‘å¯¹åº”åˆ†æ”¯çš„æœ€æ–°ä¸€ä¸ª Commit-IDã€‚</li>
<li>å½“ä½¿ç”¨ <code>git reset</code> æ—¶ï¼Œ<code>HEAD</code> ä¼šç§»åŠ¨è‡³å¯¹åº”åˆ†æ”¯çš„æŸä¸ª Commit-IDã€‚è¯·æ³¨æ„ <code>git reset --hard</code> å¯ä»¥å°† <code>HEAD</code> å’Œ <code>Branch</code> ç§»åŠ¨è‡³ä»»ä½•åœ°æ–¹ã€‚</li>
</ul>
</blockquote>
<p>é¡ºé“æä¸€ä¸‹ï¼Œ<code>git reset</code> çš„æœ¬è´¨å°±æ˜¯ç§»åŠ¨ <code>HEAD</code> æ¥è¾¾åˆ°æ’¤é”€çš„ç›®çš„ã€‚</p>
<p>è§‚å¯Ÿä»¥ä¸‹ç¤ºä¾‹ï¼Œæˆ‘ä½¿ç”¨ <code>git reset --soft</code> å°† <code>HEAD</code> ä» Commit-ID ä¸º <code>42d46a2</code> ç§»è‡³ <code>222a33c</code>ï¼Œå˜åŒ–å¦‚ä¸‹ï¼š</p>
<pre><code>$ git log
commit 42d46a2356cfdde0ad80bfc042b6cb15eae04759 (HEAD -&gt; main, origin/main, origin/HEAD)
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Feb 26 16:44:30 2022 +0800

    docs: update

commit e0c619ca3978a38f6eabe79c3dfc67d4296ccc36
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:55:48 2022 +0800

    docs: update readme.md

commit 222a33cb3185457a5d726325aa7233e43f0b92d3
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:36:51 2022 +0800

    docs: update README.md

commit 62733124c6485bc5d81123dd3eae95d4da22753f
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 15:45:15 2022 +0800

    docs: add README.md

$ git reset --soft 222a33cb3185457a5d726325aa7233e43f0b92d3

$ git log
commit 222a33cb3185457a5d726325aa7233e43f0b92d3 (HEAD -&gt; main)
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:36:51 2022 +0800

    docs: update README.md

commit 62733124c6485bc5d81123dd3eae95d4da22753f
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 15:45:15 2022 +0800

    docs: add README.md
</code></pre>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹ <code>.git/HEAD</code> çš„å†…å®¹ï¼š</p>
<pre><code class="language-shell">$ cat .git/HEAD
ref: refs/heads/main

$ cat .git/refs/heads/main
222a33cb3185457a5d726325aa7233e43f0b92d3
</code></pre>
<blockquote>
<p>å…³äº <code>git reset</code> çš„ä¸‰ä¸ªå‚æ•° <code>--mixed</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>--hard</code>ã€<code>--soft</code> çš„åŒºåˆ«ï¼Œæ¨èçœ‹è¿™ç¯‡<a href="https://www.jianshu.com/p/c2ec5f06cf1a">æ–‡ç« </a>ï¼Œè®²å¾—å¾ˆè¯¦ç»†æ˜“æ‡‚ã€‚</p>
</blockquote>
<h4>3.2 Detached HEAD</h4>
<p><code>detached HEAD</code> å¯ä»¥ç§°ä¸ºã€Œæ¸¸ç¦» HEADã€ï¼Œä¹Ÿæœ‰ç§°ä¸ºã€Œåˆ†ç¦» HEADã€çš„ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ <code>HEAD</code> ä¼šæŒ‡å‘æŸä¸ªåˆ†æ”¯çš„æŸä¸ª Commit-IDã€‚<strong>ä½†æ˜¯ <code>HEAD</code> å¶å°”ä¼šå‘ç”Ÿã€Œæ²¡æœ‰æŒ‡å‘æŸä¸ªæœ¬åœ°åˆ†æ”¯ã€çš„æƒ…å†µï¼Œè¿™ç§çŠ¶æ€çš„ <code>HEAD</code> ç§°ä¸º <code>detached HEAD</code>ã€‚</strong></p>
<p>ä»¥ä¸‹æƒ…å†µï¼Œå°±å¯èƒ½ä¼šå‡ºç° <code>detached HEAD</code>ï¼š</p>
<blockquote>
<ol>
<li>ä½¿ç”¨ <code>git checkout</code> è·³è½¬è‡³æŸä¸ª Commit-IDï¼Œè€Œè¿™ä¸ª Commit-ID åˆšå¥½ç›®å‰æ²¡æœ‰åˆ†æ”¯æŒ‡å‘å®ƒã€‚</li>
<li>Rebase çš„è¿‡ç¨‹å…¶å®ä¹Ÿæ˜¯å¤„äºä¸æ–­çš„ detached HEAD çŠ¶æ€ã€‚</li>
<li>åˆ‡æ¢è‡³æŸä¸ªè¿œç¨‹åˆ†æ”¯çš„æ—¶å€™ã€‚</li>
</ol>
</blockquote>
<p>æˆ‘ä»¬å…ˆå°† Git çš„æç¤ºè¯­è¨€åˆ‡æ¢ä¸ºè‹±æ–‡ï¼Œçœ‹å¾—æ›´åŠ æ¸…æ™°ã€‚</p>
<pre><code class="language-shell">$ git checkout e0c619ca3978a38f6eabe79c3dfc67d4296ccc36
Note: switching to 'e0c619ca3978a38f6eabe79c3dfc67d4296ccc36'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c &lt;new-branch-name&gt;

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at e0c619c docs: update readme.md
</code></pre>
<p>æ­¤æ—¶ <code>HEAD</code> æŒ‡å‘ <code>e0c619c</code>ï¼Œè¿™ä¸ªå°±æ˜¯ <code>detached HEAD</code>ã€‚</p>
<p>è¿˜æœ‰ï¼Œå‰é¢æåˆ°ã€Œæ²¡æœ‰æŒ‡å‘æŸä¸ªæœ¬åœ°åˆ†æ”¯ã€ï¼Œä½†å…¶å®æˆ‘ä»¬ä½¿ç”¨ <code>git branch</code> ä¼šå‘ç°æœ‰ä»¥ä¸‹è¿™æ ·ä¸€ä¸ªåˆ†æ”¯ï¼š</p>
<pre><code class="language-shell">$ git branch
* (HEAD detached at e0c619c)
  dev
  main
</code></pre>
<p>ä½†æ³¨æ„ï¼Œå½“æˆ‘ä»¬åˆ‡æ¢è‡³å…¶ä»–åˆ†æ”¯æ—¶ï¼Œè¿™ä¸ª <code>(HEAD detached at e0c619c)</code> åˆ†æ”¯æ˜¯ä¼šè¢«å¹²æ‰çš„ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸´æ—¶çš„ã€‚å› æ­¤äººå®¶ä¹Ÿæé†’ä½ å¯ä»¥ä½¿ç”¨ <code>git switch -c &lt;new-branch-name&gt;</code> å‘½ä»¤ï¼Œä»¥åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯æ¥æŒ‡å‘è¯¥ Commit-IDã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæƒ³è¦æŸ¥çœ‹æŸä¸ªå†å²ç‰ˆæœ¬çš„æºç ï¼Œå°±å¯ä»¥åˆ©ç”¨æ­¤åŠŸèƒ½æ¥è§£å†³ã€‚</p>
<pre><code class="language-shell"># -t å³ --track
$ git branch &lt;new-branch-name&gt; &lt;commit-id&gt;
# æˆ–è€…
$ git checkout -b &lt;new-branch-name&gt; &lt;commit-id&gt;
</code></pre>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>git checkout origin/main</code> åˆ‡æ¢è‡³ <code>origin/main</code> è¿œç¨‹åˆ†æ”¯æ—¶ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸€ä¸ª <code>detached HEAD</code> çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³åŸºäºæŸä¸ªè¿œç¨‹åˆ†æ”¯ï¼Œæ–°å»ºä¸€ä¸ªåŒåæœ¬åœ°åˆ†æ”¯ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-shell">$ git checkout -t origin/dev
branch 'dev' set up to track 'origin/dev'.
Switched to a new branch 'dev'

# ç›¸å½“äº
$ git checkout -b dev origin/dev
</code></pre>
<p>å¦‚æœè¦ç¦»å¼€ <code>detached HEAD</code> çŠ¶æ€å¾ˆç®€å•ï¼Œåªè¦åˆ‡æ¢è‡³å…¶ä»–åˆ†æ”¯å³å¯ã€‚</p>
<h4>3.3 origin/HEAD</h4>
<p>ä»åå­—å¯ä»¥çœ‹å‡ºï¼Œ<code>origin/HEAD</code> ä¹Ÿæ˜¯ä¸€ä¸ªã€Œè¿œç¨‹åˆ†æ”¯ã€ï¼Œå…¶ä¸­ <code>origin</code> åˆ™å¯¹åº”è¿œç¨‹åç§°ã€‚</p>
<p><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>origin/HEAD</code> æ€»æ˜¯æŒ‡å‘è¿œç¨‹ä»“åº“çš„ã€Œé»˜è®¤åˆ†æ”¯ã€</strong>ã€‚å‡è®¾æˆ‘ä»¬çš„è¿œç¨‹é»˜è®¤åˆ†æ”¯ä¸º <code>main</code>ã€‚é‚£ä¹ˆåœ¨è¿œç¨‹ä»“åº“åœ¨æœ¬åœ°çš„å‰¯æœ¬ï¼Œ<code>origin/HEAD</code> å°±æ˜¯ç›¸å½“äº <code>origin/main</code>ã€‚</p>
<p>Git æä¾›äº†ä»¥ä¸‹å‘½ä»¤è®©æˆ‘ä»¬å»ä¿®æ”¹ <code>origin/HEAD</code> çš„æŒ‡å‘ï¼ˆå¯é€šè¿‡ <code>git remote set-head -h</code> æŸ¥çœ‹ï¼‰ï¼š</p>
<pre><code class="language-shell"># å°† origin/HEAD è®¾ä¸ºè¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ†æ”¯ï¼ˆ-a å³ --autoï¼‰
$ git remote set-head &lt;remote-name&gt; -a

# å°† origin/HEAD è®¾ä¸ºæŸä¸ªè¿œç¨‹åˆ†æ”¯ï¼Œ
# æ¯”å¦‚ git remote set-head origin devï¼Œå°† origin/HEAD æŒ‡å‘è¿œç¨‹çš„ dev åˆ†æ”¯ï¼Œç›¸å½“äº origin/dev
$ git remote set-head &lt;remote-name&gt; &lt;branch-name&gt;

# åˆ é™¤ origin/HEADï¼ˆ-d å³ --deleteï¼‰
$ git remote set-head &lt;remote-name&gt; -d
</code></pre>
<p>ä»¥ä¸Šæ³¨é‡Šéƒ¨åˆ†ï¼Œå‡å®šäº†è¿œç¨‹åç§°ä¸º <code>origin</code>ã€‚</p>
<p>æˆ‘ä»¬ä¿®æ”¹ä¸‹ <code>origin/HEAD</code> ä¸ºè¿œç¨‹ä»“åº“çš„ <code>dev</code> åˆ†æ”¯ï¼Œ<code>origin/HEAD</code> æ–‡ä»¶é‡Œé¢å­˜å‚¨çš„å†…å®¹ï¼ŒåŒæ ·è¡¨ç¤ºçš„ä¹Ÿæ˜¯å¯¹æŸä¸ªè¿œç¨‹åˆ†æ”¯çš„å¼•ç”¨ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<pre><code class="language-shell">$ git remote set-head origin dev
$ cat .git/refs/remotes/origin/HEAD
ref: refs/remotes/origin/dev
</code></pre>
<h4>3.4 ORIG_HEADï¼ˆæ‹“å±•å†…å®¹ï¼‰</h4>
<p>åœ¨ <code>.git</code> ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ª <code>ORIG_HEAD</code> çš„æ–‡ä»¶ï¼Œä½ æœ‰æ²¡æœ‰å¥½å¥‡æ€ªï¼Œå®ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre><code class="language-shell">$ cat .git/ORIG_HEAD
222a33cb3185457a5d726325aa7233e43f0b92d3
</code></pre>
<p>è¿˜è®°å¾—ï¼Œå‰é¢ä½¿ç”¨è¿‡ <code>git reset --soft 222a33cb3185457a5d726325aa7233e43f0b92d3</code> æŒ‡ä»¤æ¥ç§»åŠ¨ <code>HEAD</code> çš„æŒ‡å‘å—ï¼Ÿ</p>
<p>å½“æˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›ã€Œå±é™©æ“ä½œã€æ—¶ï¼Œæ¯”å¦‚ <code>git reset</code>ã€<code>git merge</code>ã€<code>git rebase</code> ç­‰æ“ä½œæ—¶ï¼ŒGit ä¼šå°†å½“å‰ <code>HEAD</code> æŒ‡å‘çš„çš„ Commit-ID åŸå€¼ä¿å­˜è‡³ <code>ORIG_HEAD</code> æ–‡ä»¶å†…ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç±»ä¼¼ <code>git commit</code> ç­‰æ“ä½œå¹¶ä¸ä¼šæ›´æ–° <code>ORIG_HEAD</code> çš„å†…å®¹ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼ŒåŠ å…¥æˆ‘ä»¬æ‰§è¡Œäº†ä¸€äº›ã€Œè¯¯æ“ä½œã€æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ <code>git reset --hard ORIG_HEAD</code> å›é€€è‡³ä¸Šä¸€æ­¥ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¿›è¡Œä¸€æ¬¡ <code>git reset</code> æ“ä½œï¼š</p>
<pre><code class="language-shell">$ git log
commit 42d46a2356cfdde0ad80bfc042b6cb15eae04759 (HEAD -&gt; main, origin/main)
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Feb 26 16:44:30 2022 +0800

    docs: update

commit e0c619ca3978a38f6eabe79c3dfc67d4296ccc36
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:55:48 2022 +0800

    docs: update readme.md

commit 222a33cb3185457a5d726325aa7233e43f0b92d3
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:36:51 2022 +0800

    docs: update README.md

commit 62733124c6485bc5d81123dd3eae95d4da22753f
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 15:45:15 2022 +0800

    docs: add README.md
</code></pre>
<p>åœ¨ <code>reset</code> ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>HEAD</code> æŒ‡å‘çš„ Commit-ID ä¸º <code>42d46a2356cfdde0ad80bfc042b6cb15eae04759</code>ï¼Œæ¥ç€æˆ‘ä»¬æ‰§è¡Œ git reset æŒ‡ä»¤ï¼š</p>
<pre><code class="language-shell">$ git reset --soft e0c619ca3978a38f6eabe79c3dfc67d4296ccc36
$ git log
commit e0c619ca3978a38f6eabe79c3dfc67d4296ccc36 (HEAD -&gt; main)
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:55:48 2022 +0800

    docs: update readme.md

commit 222a33cb3185457a5d726325aa7233e43f0b92d3
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:36:51 2022 +0800

    docs: update README.md

commit 62733124c6485bc5d81123dd3eae95d4da22753f
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 15:45:15 2022 +0800

    docs: add README.md
</code></pre>
<p>åœ¨ <code>git reset</code> å®Œæˆä¹‹åï¼Œ<code>HEAD</code> æŒ‡å‘äº† <code>e0c619ca3978a38f6eabe79c3dfc67d4296ccc36</code>ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œ<code>ORIG_HEAD</code> ä¼šè®°å½•é«˜å±æ“ä½œå‰çš„ Commit-IDã€‚å¦‚æœæ²¡é”™çš„è¯ï¼Œæ­¤æ—¶ <code>ORIG_HEAD</code> è®°å½•çš„åº”è¯¥æ˜¯ <code>42d46a2356cfdde0ad80bfc042b6cb15eae04759</code>ã€‚</p>
<pre><code class="language-shell">$ cat .git/ORIG_HEAD
42d46a2356cfdde0ad80bfc042b6cb15eae04759
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æƒ³åƒåæ‚”è¯äº†ï¼Œå°±å¯ä»¥é€šè¿‡ <code>git reset --hard ORIG_HEAD</code> è¿›è¡Œå›é€€ï¼š</p>
<pre><code class="language-shell">$ git reset --hard ORIG_HEAD
HEAD is now at 42d46a2 docs: update

$ git log
commit 42d46a2356cfdde0ad80bfc042b6cb15eae04759 (HEAD -&gt; main, origin/main)
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sat Feb 26 16:44:30 2022 +0800

    docs: update

commit e0c619ca3978a38f6eabe79c3dfc67d4296ccc36
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:55:48 2022 +0800

    docs: update readme.md

commit 222a33cb3185457a5d726325aa7233e43f0b92d3
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 18:36:51 2022 +0800

    docs: update README.md

commit 62733124c6485bc5d81123dd3eae95d4da22753f
Author: Frankie &lt;1426203851@qq.com&gt;
Date:   Sun Feb 20 15:45:15 2022 +0800

    docs: add README.md
</code></pre>
<p>å½“ç„¶ï¼Œä¸åŒçš„åœºæ™¯ä¸‹ç‰ˆæœ¬å›é€€è¿˜æœ‰å…¶ä»–æ–¹å¼çš„ï¼Œè§†ä¹å®é™…åœºæ™¯ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<h4>3.5 FETCH_HEAD</h4>
<p>å…¶ä¸­ <code>FETCH_HEAD</code> ä¸ <code>git fetch</code> æœ‰å…³ï¼Œä¹Ÿæ˜¯å…³é”®éƒ¨åˆ†ã€‚</p>
<blockquote>
<p><strong><code>FETCH_HEAD</code> æŒ‡çš„æ˜¯æŸä¸ªåˆ†æ”¯åœ¨è¿œç¨‹ä»“åº“ä¸Šæœ€æ–°çš„çŠ¶æ€</strong>ã€‚æ¯ä¸€ä¸ªæ‰§è¡Œè¿‡ <code>git fetch</code> æ“ä½œçš„æœ¬åœ°ä»“åº“éƒ½ä¼šå­˜åœ¨ä¸€ä¸ª <code>FETCH_HEAD</code> åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨ä¿å­˜åœ¨ <code>.git/FETCH_HEAD</code> æ–‡ä»¶ä¸­ã€‚<code>FETCH_HEAD</code> æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¯¹åº”ç€è¿œç¨‹ä»“åº“çš„ä¸€ä¸ªåˆ†æ”¯ã€‚å½“å‰æœ¬åœ°åˆ†æ”¯æŒ‡å‘çš„ <code>FETCH_HEAD</code> å°±æ˜¯è¯¥æ–‡ä»¶ä¸­çš„ã€Œç¬¬ä¸€è¡Œã€å¯¹åº”çš„åˆ†æ”¯ï¼ˆè¿™æ®µè¡¨è¿°æºäº<a href="https://ruby-china.org/topics/4768">æ­¤å¤„</a>ï¼‰ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ <code>git fetch</code> ç”¨ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š</p>
<pre><code class="language-shell"># 1 
$ git fetch

# 2
$ git fetch &lt;remote-name&gt;

# 3
$ git fetch &lt;remote-name&gt; &lt;remote-branch-name&gt;

# 4 
$ git fetch &lt;remote-name&gt; &lt;remote-branch-name&gt;:&lt;local-branch-name&gt;
</code></pre>
<ul>
<li><strong>git fetch</strong></li>
</ul>
<p>æ‹‰å–ã€Œæ‰€æœ‰è¿œç¨‹ä»“åº“ã€æ‰€åŒ…å«çš„åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨æœ¬åœ°åˆ›å»ºæˆ–æ›´æ–°è¿œç¨‹åˆ†æ”¯ã€‚æ‰€æœ‰åˆ†æ”¯æœ€æ–°çš„ Commit-ID éƒ½ä¼šè®°å½•åœ¨ <code>.git/FETCH_HEAD</code> æ–‡ä»¶ä¸­ï¼Œè‹¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œ<code>FETCH_HEAD</code> å†…ä¼šå¤šè¡Œæ•°æ®ã€‚</p>
<ul>
<li><strong>git fetch origin</strong></li>
</ul>
<p>æ‹‰å– <code>origin</code> å¯¹åº”çš„è¿œç¨‹ä»“åº“çš„æ‰€åŒ…å«çš„åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œ<code>FETCH_HEAD</code> è®¾å®šåŒä¸Šã€‚</p>
<ul>
<li><strong>git fetch origin main</strong></li>
</ul>
<p>æ‹‰å– <code>origin</code> å¯¹åº”è¿œç¨‹ä»“åº“çš„ <code>main</code> åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œä¸” <code>FETCH_HEAD</code> åªè®°å½•äº†ä¸€æ¡æ•°æ®ï¼Œé‚£å°±æ˜¯è¿œç¨‹ä»“åº“ main åˆ†æ”¯æœ€æ–°çš„ Commit-IDã€‚</p>
<ul>
<li><strong>git fetch origin main:temp</strong></li>
</ul>
<p>æ‹‰å– <code>origin</code> å¯¹åº”è¿œç¨‹ä»“åº“çš„ <code>main</code> åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œå…¶ä¸­ <code>FETCH_HEAD</code> è®°å½•äº†è¿œç¨‹ä»“åº“ <code>main</code> åˆ†æ”¯æœ€æ–°çš„ Commit-IDï¼Œå¹¶ä¸”åŸºäºè¿œç¨‹ä»“åº“çš„ <code>main</code> åˆ†æ”¯åˆ›å»ºä¸€ä¸ªåä¸º <code>temp</code> çš„æ–°æœ¬åœ°åˆ†æ”¯ï¼ˆä½†ä¸ä¼šåˆ‡æ¢è‡³æ–°åˆ†æ”¯ï¼‰ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œ<code>FETCH_HEAD</code> è®°å½•çš„æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–åˆ°æœ¬åœ°ï¼Œã€Œå¯¹åº”åˆ†æ”¯ã€çš„æœ€æ–°ä¸€ä¸ª Commit-IDã€‚å½“é€šè¿‡ <code>git fetch</code> æ‹‰å–ä»£ç æ—¶ï¼Œ</p>
<ul>
<li>è‹¥æœ‰å…·ä½“æŒ‡å®šäº†æŸä¸ªè¿œç¨‹ä»“åº“çš„æŸä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆ <code>FETCH_HEAD</code> å°±å¯¹åº”æ­¤åˆ†æ”¯ã€‚</li>
<li>è‹¥æ²¡æœ‰å…·ä½“æŒ‡å®šè¿œç¨‹ä»“åº“çš„æŸä¸ªåˆ†æ”¯ï¼Œ
a. <code>FETCH_HEAD</code> æ€»æ˜¯æŒ‡å‘ <code>.git/FETCH_DEAD</code> é¦–è¡Œå¯¹åº”çš„åˆ†æ”¯ã€‚
b. æ–‡ä»¶ <code>.git/FETCH_DEAD</code> å¯èƒ½ä¼šè®°å½•ç€å¤šä¸ªåˆ†æ”¯ï¼Œä¸”è¯¥æ–‡ä»¶é¦–è¡Œå¯¹åº”çš„æ˜¯ <code>git fetch</code> æ—¶æ‰€åœ¨åˆ†æ”¯çš„åŒåè¿œç¨‹åˆ†æ”¯ã€‚</li>
</ul>
</blockquote>
<p>æ¥ç€ï¼Œä¸ <code>FETCH_HEAD</code> ç›¸å…³çš„æ˜¯ <code>git pull</code> æ“ä½œã€‚</p>
<p><code>git pull</code> ç­‰ä»·äº <code>git fetch</code> + <code>git merge FETCH_HEAD</code>  ä¸¤ä¸ªæ­¥éª¤çš„ç»“åˆã€‚</p>
<p>å½“ <code>git pull</code> ä¸æ·»åŠ å…¶ä»–å‚æ•°æ—¶ï¼Œç­‰ä»·äº <code>git pull &lt;remote-name&gt; &lt;å½“å‰åˆ†æ”¯å&gt;</code>ï¼Œå¦‚æœè¿œç¨‹ä»“åº“æ— ä¸ä¹‹å¯¹åº”çš„åŒååˆ†æ”¯ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ git branch -a
* temp
  remotes/origin/HEAD -&gt; origin/dev
  remotes/origin/dev
  remotes/origin/main

$ git pull
There is no tracking information for the current branch.
Please specify which branch you want to merge with.
See git-pull(1) for details.

    git pull &lt;remote&gt; &lt;branch&gt;

If you wish to set tracking information for this branch you can do so with:

    git branch --set-upstream-to=origin/&lt;branch&gt; temp

</code></pre>
<p>å¥½ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°æœ¬åœ°çš„ <code>main</code> åˆ†æ”¯ï¼Œè¿œç¨‹ä»“åº“æœ‰ä¸ä¹‹å¯¹åº”çš„åŒååˆ†æ”¯ã€‚</p>
<pre><code class="language-shell"># ç›¸å½“äº git pull origin main
$ git pull
</code></pre>
<p>æ‹†åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>
<p><code>git fetch origin main</code>
å°†è¿œç¨‹ä»“åº“çš„ <code>main</code> åˆ†æ”¯æœ€æ–° Commit-ID è®°å½•åˆ° <code>.git/FETCH_HEAD</code> ä¸­ï¼Œæ­¤æ—¶ <code>FETCH_HEAD</code> æŒ‡å‘è¯¥ Commit-IDã€‚</p>
</li>
<li>
<p><code>git merge FETCH_HEAD</code>
å°† <code>FETCH_HEAD</code> å¯¹åº”çš„ Commit-ID åˆå¹¶è‡³æœ¬åœ° <code>main</code> åˆ†æ”¯ä¸­ã€‚å¦‚æœåˆå¹¶è¿‡ç¨‹ä¸å­˜åœ¨å†²çªï¼ˆå³åªæ˜¯ Fast-Forwardï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é¡ºåˆ©å®Œæˆ <code>git pull</code> æœ€åä¸€ä¸ªæ­¥éª¤ï¼Œå¦åˆ™çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³å†²çªã€‚</p>
</li>
</ul>
<h2>å››ã€More...</h2>
<p>å…¶å®ä¸Šé¢ä»‹ç»äº†å¾ˆå¤šï¼Œç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œå…¶å®æ— è®ºæ˜¯ã€Œæœ¬åœ°åˆ†æ”¯ã€ï¼Œè¿˜æ˜¯ã€Œè¿œç¨‹åˆ†æ”¯ã€ï¼Œå®ƒä»¬è®°å½•çš„åªæ˜¯ä¸€ä¸ª Commit-ID æˆ–è€…æ˜¯å¯¹æŸä¸ªåˆ†æ”¯çš„å¼•ç”¨ï¼ˆå½¢å¦‚ <code>ref: refs/heads/main</code>ï¼‰ã€‚</p>
<p>æˆ‘ä»¬è§‚å¯Ÿæœ¬åœ°ä»“åº“çš„ <code>.git</code> ç›®å½•å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬çš„æœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯ã€æ ‡ç­¾éƒ½æ˜¯å­˜åœ¨äº <code>.git/refs/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-shell">$ tree .git/refs
.git/refs
â”œâ”€â”€ heads
â”‚   â”œâ”€â”€ dev
â”‚   â””â”€â”€ main
â”œâ”€â”€ remotes
â”‚   â””â”€â”€ origin
â”‚       â”œâ”€â”€ HEAD
â”‚       â”œâ”€â”€ dev
â”‚       â””â”€â”€ main
â””â”€â”€ tags
</code></pre>
<p>å‰é¢ä»‹ç»è¿‡ï¼Œã€Œåˆ†æ”¯ã€æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª <code>Commit-ID</code> ç»„æˆçš„é›†åˆã€‚ä½†æˆ‘ä»¬åˆå¹¶çš„ç¡®æ˜¯å®å®åœ¨åœ¨çš„ä»£ç å•Šï¼Œé‚£ä¹ˆè¿™äº›ä»£ç è¢«å­˜æ”¾åˆ°å“ªå‘¢ï¼Ÿ</p>
<p>å…·ä½“æ•°æ®éƒ½è¢«æ”¾åœ¨ <code>.git/objects/</code> ç›®å½•ä¸‹ã€‚</p>
<p>ç„¶åï¼Œç°åœ¨å›å¤´å†çœ‹ <code>.git/config</code> çš„é…ç½®ï¼Œçœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<pre><code class="language-ini">[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
	ignorecase = true
	precomposeunicode = true
[remote &quot;origin&quot;]
	url = git@github.com:toFrankie/repo-demo.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch &quot;main&quot;]
	remote = origin
	merge = refs/heads/main
[branch &quot;dev&quot;]
	remote = origin
	merge = refs/heads/dev
</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
<!--
* [Git é‡Œé¢çš„ origin åˆ°åº•ä»£è¡¨å•¥æ„æ€? - Willisçš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/27712995/answer/2336292635)
* [# [Git](https://ruby-china.org/topics/node11)Â çœŸæ­£ç†è§£ git fetch, git pull ä»¥åŠ FETCH_HEAD
](https://ruby-china.org/topics/4768)
* [HEADã€master ä¸ branch](https://www.jianshu.com/p/4219b6f62ce3)
-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº error: refname refs/heads/master not found çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/106</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/106</guid>
            <pubDate>Sat, 25 Feb 2023 12:45:27 GMT</pubDate>
            <description><![CDATA[<p>ä» 2020 å¹´ 10 æœˆ 1 æ—¥èµ·ï¼Œåœ¨ GitHub æ–°åˆ›å»ºçš„ä»“åº“ï¼ˆrepositoryï¼‰ä¼šä»¥ <code>main</code> ä½œä¸ºä»“åº“é»˜è®¤åˆ†æ”¯ï¼ˆdefault branchï¼‰ï¼Œä½†å®ƒä¸ä¼šå½±å“å·²æœ‰çš„ä»“åº“ã€‚</p>
<p>å½“ç„¶ï¼ŒGitHub ä»ç„¶æ˜¯æ”¯æŒè‡ªå®šä¹‰è®¾ç½®é»˜è®¤ä»“åº“åç§°çš„ï¼Œå¯åœ¨ <a href="https]]></description>
            <content:encoded><![CDATA[<p>ä» 2020 å¹´ 10 æœˆ 1 æ—¥èµ·ï¼Œåœ¨ GitHub æ–°åˆ›å»ºçš„ä»“åº“ï¼ˆrepositoryï¼‰ä¼šä»¥ <code>main</code> ä½œä¸ºä»“åº“é»˜è®¤åˆ†æ”¯ï¼ˆdefault branchï¼‰ï¼Œä½†å®ƒä¸ä¼šå½±å“å·²æœ‰çš„ä»“åº“ã€‚</p>
<p>å½“ç„¶ï¼ŒGitHub ä»ç„¶æ˜¯æ”¯æŒè‡ªå®šä¹‰è®¾ç½®é»˜è®¤ä»“åº“åç§°çš„ï¼Œå¯åœ¨ <a href="https://github.com/settings/repositories">https://github.com/settings/repositories</a>Â é¡µé¢è¿›è¡Œè®¾ç½®ã€‚</p>
<blockquote>
<p>å…³äºæ›´å¤š GitHub é‡å‘½åç›¸å…³ï¼Œè¯·çœ‹ ğŸ‘‰ <a href="https://github.com/github/renaming">github/renaming</a>ã€‚</p>
</blockquote>
<p>æŠ±æ­‰ï¼ŒåºŸè¯å¤šäº†ï¼Œå›åˆ°æ­£é¢˜ã€‚</p>
<p>ä»Šå¤©åˆ›å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›® <a href="https://github.com/toFrankie/vite-demo">vite-demo</a>ï¼Œç„¶åæƒ³ç€å°±ç”¨ <code>main</code> ä½œä¸ºé»˜è®¤åˆ†æ”¯å§ã€‚</p>
<pre><code class="language-shell">$ git init
$ git branch -M main
</code></pre>
<p>æ‰§è¡Œä»¥ä¸Šé‡å‘½ååˆ†æ”¯çš„å‘½ä»¤åï¼Œå‘ç°æŠ¥é”™äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">error: refname refs/heads/master not found
fatal: Branch rename failed
</code></pre>
<p>åŸå› æ˜¯æœ¬åœ°ä»£ç è¿˜æ²¡æäº¤ï¼ˆcommitï¼‰ï¼Œå› æ­¤æ²¡åŠæ³•è¿›è¡Œæ›´åæ“ä½œã€‚æ­£ç¡®çš„æ­¥éª¤åº”è¯¥æ˜¯å…ˆ <strong>init â†’ add â†’ commit</strong>ï¼Œæ¥ç€æ‰èƒ½è¿›è¡Œæ›´åæ“ä½œã€‚</p>
<p>åœ¨æœ¬åœ°ä¿®æ”¹ Git çš„é»˜è®¤åˆ†æ”¯åç§°ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤è°ƒæ•´ï¼š</p>
<pre><code class="language-shell">$ git config --global init.defaultBranch &lt;default-branch-name&gt;
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Git é…ç½®å¤šä¸ª SSH key]]></title>
            <link>https://github.com/toFrankie/blog/issues/105</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/105</guid>
            <pubDate>Sat, 25 Feb 2023 12:43:55 GMT</pubDate>
            <description><![CDATA[<p>åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‹¥æœ‰å¤šä¸ª Git ä»£ç æ‰˜ç®¡å¹³å°è´¦å·æ˜¯å¾ˆå¸¸è§çš„ã€‚æ¯”å¦‚ GitLab ç”¨äºå·¥ä½œï¼ŒGitHub ç”¨äºä¸ªäººã€‚è¿™æ—¶éœ€è¦é…ç½®å¤šä¸ª SSH keyã€‚</p>
<p>ç”Ÿæˆ SSH keyï¼š</p>
<pre><code class="language-shell"># ç”¨äº GitHub
$ ssh-keygen ]]></description>
            <content:encoded><![CDATA[<p>åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‹¥æœ‰å¤šä¸ª Git ä»£ç æ‰˜ç®¡å¹³å°è´¦å·æ˜¯å¾ˆå¸¸è§çš„ã€‚æ¯”å¦‚ GitLab ç”¨äºå·¥ä½œï¼ŒGitHub ç”¨äºä¸ªäººã€‚è¿™æ—¶éœ€è¦é…ç½®å¤šä¸ª SSH keyã€‚</p>
<p>ç”Ÿæˆ SSH keyï¼š</p>
<pre><code class="language-shell"># ç”¨äº GitHub
$ ssh-keygen -t rsa -C 'example@personal.com' -f ~/.ssh/github_id_rsa

# ç”¨äº Gitee
$ ssh-keygen -t rsa -C 'example@company.com' -f ~/.ssh/gitee_id_rsa
</code></pre>
<p>åœ¨ <code>~/.ssh</code> ç›®å½•ä¸‹çš„ <code>config</code> æ–‡ä»¶ï¼ˆæ²¡æœ‰åˆ™æ–°å»ºï¼‰ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code># github
Host github.com
HostName github.com
PreferredAuthentications publickey
IdentityFile ~/.ssh/github_id_rsa

# gitee
Host gitee.com
HostName gitee.com
PreferredAuthentications publickey
IdentityFile ~/.ssh/gitee_id_rsa
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>Host</code> å’Œ <code>HostName</code> å¡«å†™ Git æœåŠ¡å™¨çš„åŸŸåï¼Œ<code>IdentityFile</code> æŒ‡å®šç§é’¥çš„è·¯å¾„ã€‚</p>
</blockquote>
<p>ç”¨ SSH å‘½ä»¤æµ‹è¯•ã€‚</p>
<pre><code class="language-shell">$ ssh -T git@github.com
$ ssh -T git@gitee.com
</code></pre>
<p>å¦‚æœæˆåŠŸçš„è¯ï¼Œä¼šè¿”å›ä»¥ä¸‹å†…å®¹ã€‚</p>
<pre><code class="language-shell">$ ssh -T git@github.com
Hi toFrankie! You've successfully authenticated, but GitHub does not provide shell access.

$ ssh -T git@gitee.com
Hi è¶Šå‰å›! You've successfully authenticated, but GITEE.COM does not provide shell access.
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://gitee.com/help/articles/4229">Git é…ç½®å¤šä¸ª SSH-Key</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[git push æŠ¥é”™ pre-receive hook declined]]></title>
            <link>https://github.com/toFrankie/blog/issues/104</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/104</guid>
            <pubDate>Sat, 25 Feb 2023 12:43:19 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7643672960accbb9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7643672960accbb9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©æ¨é€ä»£ç åˆ° GitLab è¿œç¨‹ <code>master</code> åˆ†æ”¯ä¸Šï¼Œç„¶åæäº¤å¤±è´¥äº†ï¼Œæç¤ºå¦‚ä¸‹ï¼š</p>
<pre><code> ! [remote rejected] master -&gt; master (pre-receive hook declined)
</code></pre>
<p>ç©¶å…¶åŸå› ï¼Œå°±æ˜¯ç”¨æˆ·æƒé™ä¸è¶³ï¼Œæ— æ³• push ä»£ç åˆ° <code>master</code> åˆ†æ”¯ä¸Šã€‚åªè¦å°†ç”¨æˆ·è§’è‰²è®¾ç½®æˆ Masterã€Owner ç­‰å«æœ‰ <code>master</code> åˆ†æ”¯æ“ä½œçš„æƒé™å³å¯ã€‚</p>
<blockquote>
<p>ä½†åº”æ ¹æ®è‡ªèº«å®é™…æƒ…å†µè€Œå®šï¼Œæ˜¯èµ‹äºˆå¯ä¿®æ”¹ <code>master</code> åˆ†æ”¯æƒé™ï¼Œè¿˜æ˜¯äº¤ç”± Leader ç­‰å«æœ‰ <code>master</code> åˆ†æ”¯å¤„ç†æƒé™çš„å…¶ä»–äººå¤„ç†ï¼Ÿ</p>
</blockquote>
<h3>å…³äº GitLab è®¿é—®æƒé™</h3>
<h5>GitLab è®¿é—®æƒé™ - Visibility Level</h5>
<p>è¿™ä¸ªæ˜¯åœ¨å»ºç«‹é¡¹ç›®æ—¶å°±éœ€è¦é€‰å®šçš„ï¼Œä¸»è¦ç”¨äºå†³å®šå“ªäº›äººå¯ä»¥è®¿é—®æ­¤é¡¹ç›®ï¼ŒåŒ…å« 3 ç§ï¼š</p>
<ul>
<li><strong>Private - ç§æœ‰</strong>ï¼Œåªæœ‰å±äºè¯¥é¡¹ç›®æˆå‘˜æ‰æœ‰çœ‹åˆ°</li>
<li><strong>Internal - å†…éƒ¨</strong>ï¼Œç”¨ GitLab è´¦å·çš„äººéƒ½çœ‹åˆ°</li>
<li><strong>Public - å…¬å¼€</strong>ï¼Œä»»ä½•äººå¯ä»¥çœ‹åˆ°</li>
</ul>
<p>å¼€æºé¡¹ç›®å’Œç»„è®¾ç½®çš„æ˜¯ Internalã€‚</p>
<h5>è¡Œä¸ºæƒé™ï¼š</h5>
<p>åœ¨æ»¡è¶³è¡Œä¸ºæƒé™ä¹‹å‰ï¼Œå¿…é¡»å…·å¤‡è®¿é—®æƒé™ï¼ˆå¦‚æœæ²¡æœ‰è®¿é—®æƒé™ï¼Œé‚£å°±æ— æ‰€è°“è¡Œä¸ºæƒé™äº†ï¼‰ï¼Œè¡Œä¸ºæƒé™æ˜¯æŒ‡å¯¹è¯¥é¡¹ç›®è¿›è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚æäº¤ã€åˆ›å»ºé—®é¢˜ã€åˆ›å»ºæ–°åˆ†æ”¯ã€åˆ é™¤åˆ†æ”¯ã€åˆ›å»ºæ ‡ç­¾ã€åˆ é™¤æ ‡ç­¾ç­‰è§’è‰²</p>
<h5>GitLab å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªè§’è‰²:</h5>
<blockquote>
<p>GitLab å®˜æ–¹æ–‡æ¡£å…³äº <a href="https://docs.gitlab.com/ce/user/permissions.html#project-members-permissions">Permissions</a> æœ‰ä¸€ä¸ªå¾ˆè¯¦ç»†çš„è¯´æ˜ã€‚</p>
</blockquote>
<ul>
<li>
<p><strong>Guest - è®¿å®¢</strong></p>
<p>å¯ä»¥åˆ›å»º issueã€å‘è¡¨è¯„è®ºï¼Œä¸èƒ½è¯»å†™ç‰ˆæœ¬åº“ã€‚</p>
</li>
<li>
<p><strong>ReporterÂ  - æŠ¥å‘Šè€…</strong></p>
<p>å¯ä»¥ç†è§£ä¸ºæµ‹è¯•å‘˜ã€äº§å“ç»ç†ç­‰ï¼Œä¸€èˆ¬è´Ÿè´£æäº¤ issue ç­‰
å¯ä»¥å…‹éš†ä»£ç ï¼Œä¸èƒ½æäº¤ï¼ŒQAã€PM å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™ã€‚</p>
</li>
<li>
<p><strong>Developer - å¼€å‘è€…</strong></p>
<p>å¯ä»¥å…‹éš†ä»£ç ã€å¼€å‘ã€æäº¤ã€pushï¼ŒRD å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™ã€‚</p>
</li>
<li>
<p><strong>Master - ä¸»äºº</strong></p>
<p>å¯ä»¥åˆ›å»ºé¡¹ç›®ã€æ·»åŠ  tagã€ä¿æŠ¤åˆ†æ”¯ã€æ·»åŠ é¡¹ç›®æˆå‘˜ã€ç¼–è¾‘é¡¹ç›®ï¼Œæ ¸å¿ƒ RD è´Ÿè´£äººå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™ã€‚</p>
</li>
<li>
<p><strong>Owner - æ‹¥æœ‰è€…</strong></p>
<p>å¯ä»¥è®¾ç½®é¡¹ç›®è®¿é—®æƒé™ - Visibility Levelã€åˆ é™¤é¡¹ç›®ã€è¿ç§»é¡¹ç›®ã€ç®¡ç†ç»„æˆå‘˜ï¼Œå¼€å‘ç»„ Leader å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™ã€‚</p>
</li>
<li>
<p><strong>Maintainer - ç»´æŠ¤è€…</strong></p>
<p>æƒé™ä¸ Owner å·®ä¸å¤šï¼Œä½†æ— åˆ é™¤é¡¹ç›®ç­‰æƒé™ã€‚</p>
</li>
</ul>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://docs.gitlab.com/ce/user/permissions.html#project-members-permissions">GitLab members permissions</a></li>
<li><a href="https://blog.csdn.net/qq_37674858/article/details/80825077">GitLab å„ç±»å‹è´¦å·çš„æƒé™</a></li>
<li><a href="https://www.jianshu.com/p/cad0b9ecf68c">GitLab æƒé™å’Œè§’è‰²çš„è§£é‡Š</a></li>
<li><a href="https://www.cnblogs.com/suizhikuo/p/9970663.html">GitLab ç”¨æˆ·åœ¨ç»„ä¸­æœ‰äº”ç§æƒé™ï¼šGuestã€Reporterã€Developerã€Masterã€Owner</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Git å¸¸ç”¨å‘½ä»¤ä»‹ç»]]></title>
            <link>https://github.com/toFrankie/blog/issues/103</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/103</guid>
            <pubDate>Sat, 25 Feb 2023 12:40:21 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1701002224993.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½œä¸ºè®°å½•ã€‚</p>
<h2>åŸºæœ¬é…ç½®</h2>
<p>æŒ‡å®šæäº¤è€…ä¿¡æ¯ã€‚</]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/11/1701002224993.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½œä¸ºè®°å½•ã€‚</p>
<h2>åŸºæœ¬é…ç½®</h2>
<p>æŒ‡å®šæäº¤è€…ä¿¡æ¯ã€‚</p>
<pre><code class="language-shell"># å…¨å±€é…ç½®
$ git config --global user.name &lt;your-name&gt;
$ git config --global user.email &lt;your-email&gt;

# æœ¬åœ°é…ç½®
git config user.name &lt;your-name&gt;
git config user.email &lt;your-email&gt;
</code></pre>
<p>æŒ‡å®šä¸å¿½ç•¥å¤§å°å†™ã€‚ä½†ä¸å»ºè®®ä¿®è¿‡æ­¤é…ç½®ã€‚</p>
<pre><code class="language-shell">$ git config --global core.ignorecase false
</code></pre>
<blockquote>
<p>Related Link: <a href="https://git-scm.com/docs/git-config/2.43.0#Documentation/git-config.txt-coreignoreCase">git config core.ignoreCase</a></p>
</blockquote>
<h2>åˆå§‹åŒ–</h2>
<pre><code class="language-shell"># åˆå§‹åŒ–
$ git init

# ä¸è¿œç¨‹ä»“åº“å»ºç«‹è¿æ¥
$ git remote add origin &lt;repo-address&gt;

# ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ï¼ˆä¸€ï¼‰
$ git remote set-url origin &lt;repo-address&gt;

# ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ï¼ˆäºŒï¼‰
$ git remote rm origin
$ git remote add origin &lt;repo-address&gt;

# ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ï¼ˆä¸‰ï¼‰ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶
$ vim .git/config
</code></pre>
<h2>å…‹éš†</h2>
<pre><code class="language-shell">$ git clone &lt;repo-address&gt;

# ä½¿ç”¨ dir-name ä½œä¸ºå…‹éš†ä»“åº“çš„ç›®å½•åç§°
$ git clone &lt;repo-address&gt; &lt;dir-name&gt;
</code></pre>
<p>ä»¥ä¸Šæ–¹å¼ä»…ä¼šå…‹éš†ä»“åº“çš„ã€Œé»˜è®¤åˆ†æ”¯ã€ï¼Œé€šè¿‡ <code>git branch --list</code> èƒ½çœ‹åˆ°æœ¬åœ°åªæœ‰ä¸€ä¸ªåˆ†æ”¯ã€‚</p>
<blockquote>
<p>è‡ª 2020 å¹´ 10 æœˆèµ·ï¼Œåœ¨ GitHub å¹³å°æ–°åˆ›å»ºçš„ä»“åº“ï¼Œå…¶é»˜è®¤åˆ†æ”¯åç§°æ­£å¼è°ƒæ•´ä¸º  <code>main</code>ï¼ˆ<a href="https://github.com/github/renaming">è¯¦è§</a>ï¼‰ã€‚å¯é€šè¿‡å‘½ä»¤è°ƒæ•´é»˜è®¤åˆ†æ”¯ï¼š</p>
</blockquote>
<pre><code class="language-shell">$ git config --global init.defaultBranch main
</code></pre>
<p>å¦‚æœå†é€šè¿‡æ–°å»ºåˆ†æ”¯å†æ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼Œç”šè‡³å¯èƒ½è¿˜éœ€è¦è§£å†³å†²çªï¼Œå¤ªç¹çäº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•å¿«é€Ÿæœ‰æ•ˆçš„ç›´æ¥å…‹éš†è¿œç¨‹æŒ‡å®šåˆ†æ”¯ï¼Ÿ</p>
<pre><code class="language-shell">$ git clone -b &lt;branch-name&gt; &lt;repo-address&gt;

# æŒ‡å®šç›®å½•åç§°
$ git clone -b &lt;branch-name&gt; &lt;repo-address&gt; &lt;local-dirname&gt;
</code></pre>
<p>æ¯”å¦‚ï¼Œè¿œç¨‹æœ‰ <code>master</code> å’Œ <code>develop</code> ä¸¤ä¸ªåˆ†æ”¯ï¼Œé€šè¿‡ <code>git clone -b develop git@github.com:toFrankie/git_dev_demo.git</code> ä¼šå…‹éš† <code>develop</code> åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œè€Œä¸”æœ¬åœ°åªæœ‰ <code>develop</code> ä¸€ä¸ªåˆ†æ”¯ã€‚</p>
<blockquote>
<p>éƒ¨åˆ†å†…å®¹æºè‡ª <a href="https://www.cnblogs.com/weidaijie/p/10893708.html">Git å…‹éš†è¿œç¨‹ä»“åº“çš„æŒ‡å®šåˆ†æ”¯</a>ã€‚</p>
</blockquote>
<h2>åˆ†æ”¯æ“ä½œ</h2>
<h3>æŸ¥çœ‹åˆ†æ”¯</h3>
<pre><code class="language-shell"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯
$ git branch

# åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯
$ git branch -r

# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯
$ git branch -a

# å¦‚æœåˆ†æ”¯å¤ªå¤šï¼Œå¯ä»¥ä½¿ç”¨æ¨¡ç³ŠæŸ¥æ‰¾
$ git branch | grep &lt;branch-name&gt;
</code></pre>
<h3>æ–°å»ºåˆ†æ”¯</h3>
<p>è‹¥åˆ†æ”¯å·²å­˜åœ¨ï¼Œä»¥ä¸‹å‘½ä»¤éƒ½ä¼šå¤±è´¥ã€‚</p>
<pre><code class="language-shell"># æ–°å»ºåˆ†æ”¯ï¼Œä½†ä¸ä¼šåˆ‡æ¢è‡³æ–°åˆ†æ”¯
$ git branch &lt;branch-name&gt;

# æ–°å»ºåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢è‡³è¯¥åˆ†æ”¯ã€‚
$ git checkout -b &lt;branch-name&gt;

# æ ¹æ®å·²æœ‰åˆ†æ”¯åˆ›å»ºæ–°çš„åˆ†æ”¯
$ git checkout -b &lt;branch-name&gt; origin/&lt;è¿œç¨‹åˆ†æ”¯åç§°&gt;
# ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªè¿œç¨‹ develop åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯
# git checkout -b develop origin/develop

# é‡å‘½åæœ¬åœ°åˆ†æ”¯åç§°
$ git branch -m &lt;old-branch-name&gt; &lt;new-branch-name&gt;
</code></pre>
<p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦å–å‡ºæŸä¸ªå†å²ç‰ˆæœ¬ï¼Œå¯ä»¥ç†è§£ä¸ºåŸºäºæŸä¸ª Commit æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå°±èƒ½çœ‹åˆ°å†å²ç‰ˆæœ¬äº†ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell"># åŸºäº &lt;SHA1&gt; æ–°å»ºä¸€ä¸ªæ–°åˆ†æ”¯
$ git checkout -b &lt;branch-name&gt; &lt;SHA1&gt;

# è‹¥ä¸æ‰“ç®—ä¿®æ”¹ï¼Œåªæ˜¯æƒ³ checkout çš„è¯
$ git checkout &lt;SHA1&gt;
</code></pre>
<p>æ¯”å¦‚æœ‰ä»¥ä¸‹ Commit Logï¼Œç°åŸºäº <code>1b90fceff0f3e4f16b1b850019573d3103b69a96</code> çš„å†å²ç‰ˆæœ¬ï¼Œæ–°åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-861aa9b982b8cfed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4aebdcaae8744953.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>åˆå¹¶åˆ†æ”¯</h3>
<pre><code class="language-shell"># åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯
$ git merge &lt;branch-name&gt;

# å·¥ä½œä¸­ï¼Œç‰¹æ€§åˆ†æ”¯åˆå¹¶è‡³ä¸»å¹²åˆ†æ”¯ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹è¿™ä¸ª
$ git merge --no-ff &lt;branch-name&gt;
</code></pre>
<p><code>--no-ff</code>ï¼ˆnot fast forwardï¼‰çš„ä½œç”¨æ˜¯ï¼šè¦æ±‚ <code>git merge</code> å³ä½¿åœ¨ fast forward æ¡ä»¶ä¸‹ä¹Ÿè¦äº§ç”Ÿä¸€ä¸ªæ–°çš„ Merge Commitã€‚é‡‡ç”¨ <code>--no-ff</code> çš„æ–¹å¼è¿›è¡Œåˆ†æ”¯åˆå¹¶ç›®çš„åœ¨äºï¼šå¸Œæœ›ä¿æŒåŸæœ‰ç‰¹æ€§åˆ†æ”¯æ•´ä¸ªæäº¤é“¾çš„å®Œæ•´æ€§ã€‚</p>
<blockquote>
<p>å…³äºåˆ†æ”¯åˆå¹¶ï¼Œæœ‰ä½¿ç”¨ <code>git merge</code> çš„ï¼Œä¹Ÿæœ‰ä½¿ç”¨ <code>git rebase</code> çš„ï¼Œè€Œä¸”ä¸åŒæ´¾åˆ«è¿˜å¾ˆå®¹æ˜“äº‰åµèµ·æ¥ã€‚å°±åƒç¼©è¿›æ˜¯é‡‡ç”¨ Tab å¥½è¿˜æ˜¯ Space å¥½çš„äº‰è®ºä¸€æ ·ï¼Œé‚£ä¹ˆå®é™…ä¸­å¦‚ä½•æƒè¡¡ï¼Œæ ¹æ®å›¢é˜Ÿè€Œå®šå§ã€‚</p>
</blockquote>
<h3>åˆ é™¤åˆ†æ”¯</h3>
<pre><code class="language-shell"># åˆ é™¤æœ¬åœ°æŒ‡å®šåˆ†æ”¯
$ git branch -d &lt;branch-name&gt;

# åˆ é™¤è¿œç¨‹åˆ†æ”¯
git push origin --detele &lt;branch-name&gt;

# åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼ˆæ–¹æ³•äºŒï¼šå‘è¿œç¨‹åˆ†æ”¯æ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯ï¼‰
$ git push origin :&lt;è¿œç¨‹åˆ†æ”¯å&gt;
</code></pre>
<h3>é‡å‘½åè¿œç¨‹åˆ†æ”¯</h3>
<p>è¦é‡å‘½åè¿œç¨‹åˆ†æ”¯åç§°ï¼Œå…¶å®å°±æ˜¯å…ˆåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼Œç„¶åé‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼Œå†é‡æ–°æ¨é€ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯çš„è¿‡ç¨‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå°†è¿œç¨‹åˆ†æ”¯ <code>dev</code> é‡å‘½åä¸º <code>develop</code>ï¼Œå¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<pre><code class="language-shell"># 1. åˆ é™¤è¿œç¨‹åˆ†æ”¯ dev
$ git push origin --delete dev

# 2. é‡å‘½åæœ¬åœ°åˆ†æ”¯ dev ä¸º develop
$ git branch -m dev develop

# 3. æ¨é€æœ¬åœ°åˆ†æ”¯ develop
$ git push origin develop
</code></pre>
<h2>æš‚å­˜ã€æäº¤ã€æ¨é€æ“ä½œ</h2>
<h3>æš‚å­˜æ–‡ä»¶</h3>
<pre><code class="language-shell"># æäº¤æ–°æ–‡ä»¶(new file)ã€è¢«ä¿®æ”¹(modified)æ–‡ä»¶ä»¥åŠè¢«åˆ é™¤(deleted)æ–‡ä»¶ã€‚
$ git add .

# æäº¤æ–°æ–‡ä»¶(new file)ã€è¢«ä¿®æ”¹(modified)æ–‡ä»¶ä»¥åŠè¢«åˆ é™¤(deleted)æ–‡ä»¶ã€‚
$ git add -A

# æäº¤è¢«ä¿®æ”¹(modified)å’Œè¢«åˆ é™¤(deleted)æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬æ–°æ–‡ä»¶(new file)
$ git add -u

# æäº¤æ–°æ–‡ä»¶(new file)å’Œè¢«ä¿®æ”¹(modified)ï¼Œä¸åŒ…æ‹¬è¢«åˆ é™¤(deleted)æ–‡ä»¶
$ git add --ignore-removal .
</code></pre>
<!--
å…³äº `git add` å‘½ä»¤ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ `1.x` ç‰ˆæœ¬ä¸ä¹‹æœ‰äº›ä¸åŒï¼Œæœ€åæœ‰æ ‡æ³¨ã€‚

```shell
# ä»¥ä¸Šä¸º 2.x ç‰ˆæœ¬çš„æ ‡å‡†ã€‚
# ä»¥ä¸‹ä¸º 1.x ç‰ˆæœ¬çš„åŒºåˆ«ä¹‹å¤„ï¼š
# 1.x çš„ `git add .` ä¸åŒ…æ‹¬è¢«åˆ é™¤æ–‡ä»¶(deleted)
# 1.x ä¸å­˜åœ¨ `git add --ignore-removal .` å‘½ä»¤ï¼Œä½†å…¶ä½œç”¨ç­‰åŒäº 1.x ç‰ˆæœ¬ `git add .`
```
-->
<h3>æäº¤æš‚å­˜</h3>
<pre><code class="language-shell"># æäº¤å·²æš‚å­˜æ–‡ä»¶
$ git commit -m 'commit message'

# æäº¤å·²æš‚å­˜æ–‡ä»¶ï¼Œä»¥åŠè·Ÿè¸ªè¿‡ä½†æœªè¢«æ·»åŠ åˆ°æš‚å­˜çš„æ–‡ä»¶
# æ³¨æ„ï¼šgit commit -am å¯ä»¥å†™æˆ git commit -a -mï¼Œä½†ä¸èƒ½å†™æˆ git commit -m -a
$ git commit -am 'commit message'

# ä¿®æ”¹æœ€åä¸€æ¬¡çš„æäº¤è¯´æ˜ï¼ˆä½† commitId ä¼šæ”¹å˜å“¦ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€æ¬¡å…¨æ–°çš„æäº¤ï¼‰
$ git commit --amend
</code></pre>
<blockquote>
<p>æ³¨æ„ä¸€ä¸‹ï¼Œ<code>git commit --amend</code> å‘½ä»¤ï¼Œåªèƒ½ä¿®æ”¹<strong>æœ€æ–°ä¸€æ¬¡</strong>çš„æäº¤è¯´æ˜ ï¼Œæ‰§è¡Œå‘½ä»¤è¿›å…¥ vim æ¨¡å¼ï¼ˆå…·ä½“å¦‚ä½•æ’å…¥ç¼–è¾‘ï¼Œä¿å­˜é€€å‡ºä¸å±•å¼€èµ˜è¿°äº†ï¼Œä½ ä»¬éƒ½ä¼šçš„ï¼‰ã€‚äº¦å¯é€šè¿‡ <code>git commit --amend -m 'Commit Message'</code> ç›´æ¥è¦†ç›–ä¸ç”¨è¿›å…¥ vim ç¼–è¾‘å™¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å‘½ä»¤ä¼šå¯¼è‡´ <code>commitId</code>ï¼ˆå¿«ç…§å”¯ä¸€æ ‡è¯†ï¼‰å‘ç”Ÿæ”¹å˜ã€‚å¯é€šè¿‡ <code>git log</code>ï¼ˆæŸ¥çœ‹å†å²æäº¤è®°å½•ï¼‰å‰åå¯¹æ¯”å‘ç°ã€‚å…¶å®å‘¢ï¼Œä¿®æ”¹è¿‡çš„æäº¤å®é™…ä¸Šæ˜¯å…¨æ–°çš„æäº¤ï¼Œè€Œå…ˆå‰çš„æäº¤å°†ä¸å†ä½äºæ‚¨å½“å‰çš„åˆ†æ”¯ä¸Šã€‚</p>
<p>è¯¥å‘½ä»¤å…¶å®è¿˜æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œè¿˜èƒ½æ›´æ”¹æäº¤æ–‡ä»¶ç­‰ï¼Œæƒ³äº†è§£è¯·çœ‹<a href="https://www.atlassian.com/git/tutorials/rewriting-history">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h3>æ¨é€è‡³è¿œç¨‹åˆ†æ”¯</h3>
<blockquote>
<p>å¦‚æœä½ ä¸ç†Ÿæ‚‰ origin æ‰€è¡¨ç¤ºçš„æ„æ€ï¼Œå¯å…ˆçœ‹ ã€Š<a href="https://github.com/toFrankie/blog/issues/107">å¼„æ‡‚ originã€HEADã€FETCH_HEAD ç›¸å…³å†…å®¹</a>ã€‹ã€‚</p>
</blockquote>
<p>ä¸»è¦ç”¨äºå°†æœ¬åœ°æ›´æ–°æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä½†ä¸åŒç®€åŒ–å½¢å¼ã€å‘½ä»¤å‚æ•°äº§ç”Ÿå»¶ç”³æ•ˆæœã€‚</p>
<pre><code class="language-shell"># ä¸çœç•¥æœ¬åœ°åˆ†æ”¯åå’Œè¿œç¨‹åˆ†æ”¯åæƒ…å†µä¸‹ï¼Œå†’å·ï¼ˆ:ï¼‰å‰åæ˜¯æ²¡æœ‰ç©ºæ ¼çš„
$ git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;
# git push origin master:master
</code></pre>
<p>è¿˜æœ‰å‡ ç§ç®€åŒ–å½¢å¼çš„å†™æ³•ï¼š</p>
<ul>
<li><strong>çœç•¥è¿œç¨‹åˆ†æ”¯</strong>ï¼ˆå¤šåˆ†æ”¯æƒ…å†µä¸‹ï¼Œæœ¬äººå¸¸ç”¨è¿™ç§å½¢å¼ï¼‰</li>
</ul>
<pre><code class="language-shell"># å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä¸»æœºä¸Šçš„åŒååˆ†æ”¯ã€‚å¦‚æœè¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ã€‚
$ git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;
# git push origin master
</code></pre>
<details><summary>å±•å¼€</summary>
<ul>
<li><strong>ï¼ˆæ…ç”¨ï¼‰çœç•¥æœ¬åœ°åˆ†æ”¯</strong>ï¼ˆç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼‰</li>
</ul>
<pre><code class="language-shell"># å°†ä¸€ä¸ªâ€œç©ºçš„æœ¬åœ°åˆ†æ”¯â€æ¨é€è‡³è¿œç¨‹åˆ†æ”¯ï¼Œå³è¡¨ç¤ºåˆ é™¤æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ã€‚
$ git push &lt;è¿œç¨‹ä¸»æœºå&gt; :&lt;è¿œç¨‹åˆ†æ”¯å&gt;
# git push origin :master

# ç­‰åŒäº
$ git push origin --delete &lt;è¿œç¨‹åˆ†æ”¯å&gt;
</code></pre>
<ul>
<li><strong>ï¼ˆä¸æ¨èï¼‰çœç•¥æœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯</strong></li>
</ul>
<pre><code class="language-shell"># å°†å½“å‰åˆ†æ”¯æ¨é€è‡³è¿œç¨‹ä¸»æœºä¸Šçš„å¯¹åº”åˆ†æ”¯
$ git push &lt;è¿œç¨‹ä¸»æœºå&gt;
# git push origin
</code></pre>
<blockquote>
<p>è¿™ç§å½¢å¼è¦æ±‚å½“å‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ä¹‹é—´å­˜åœ¨è¿½è¸ªå…³ç³»ã€‚</p>
<p>æ€ä¹ˆç†è§£ï¼Ÿ</p>
<p><strong>ä¸ªäººä¸æ¨èï¼Œè€Œä¸”å¹³å¸¸ä¹Ÿä¸ç”¨è¿™ç§å½¢å¼çš„è¿›è¡Œæ¨é€çš„</strong>ã€‚å‡å¦‚æœ‰å­˜åœ¨ <code>master</code> å’Œ <code>develop</code> ä¸¤ä¸ªåˆ†æ”¯ï¼Œå½“ä¸è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»çš„æ˜¯ <code>master</code> åˆ†æ”¯ï¼Œé‚£ä¹ˆå¤„äº <code>develop</code> åˆ†æ”¯æ—¶ï¼Œä½¿ç”¨ <code>git push origin</code> å½¢å¼æ¨é€è‡³è¿œç¨‹ä¸»æœºæ—¶å°±ä¼šæç¤ºï¼š<code>The current branch test has no upstream branch.</code>ï¼Œç„¶åå†æ‰§è¡Œ <code>git push --set-upstream origin develop</code> å³å¯ä½¿ç”¨è¿™ç§å½¢å¼çš„æ¨é€ã€‚</p>
</blockquote>
</details>
<ul>
<li><strong>çœç•¥è¿œç¨‹ä¸»æœºã€æœ¬åœ°åˆ†æ”¯ã€è¿œç¨‹åˆ†æ”¯</strong></li>
</ul>
<pre><code class="language-shell"># å°†å½“å‰åˆ†æ”¯æ¨é€è‡³è¿œç¨‹ä¸»æœºå¯¹åº”åˆ†æ”¯
$ git push
</code></pre>
<blockquote>
<p>è¿™ç§å½¢å¼ï¼Œé™¤äº†è¦æ±‚å½“å‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ä¹‹é—´å­˜åœ¨è¿½è¸ªå…³ç³»ä¹‹å¤–ï¼Œè¿˜è¦æ±‚å½“å‰å½“å‰åˆ†æ”¯åªæœ‰ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯ã€‚</p>
</blockquote>
<ul>
<li><strong>çœç•¥è¿œç¨‹åˆ†æ”¯ï¼Œæ·»åŠ å‚æ•° <code>-u</code></strong></li>
</ul>
<pre><code class="language-shell"># å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä¸»æœºä¸Šçš„åŒååˆ†æ”¯ã€‚å¦‚æœè¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ã€‚
$ git push -u &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;
# git push -u origin master
</code></pre>
<blockquote>
<p>è¿™ç§å½¢å¼é€‚ç”¨äºå½“å‰åˆ†æ”¯ä¸å¤šä¸ªä¸»æœºå­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œå¯ä»¥åˆ©ç”¨ <code>-u</code> æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„ä¸»æœºï¼Œè¿™æ ·åé¢å°±å¯ä»¥ä¸åŠ ä»»ä½•å‚æ•°é€‚ç”¨ <code>git push</code> æ¨é€å¯¹åº”çš„åˆ†æ”¯äº†ã€‚</p>
</blockquote>
<p>ä»¥ä¸ŠæŒ‡ä»¤æ‰§è¡Œä¹‹åï¼Œåœ¨ <code>.git/config</code> é…ç½®æ–‡ä»¶ä¸‹ä¼šæœ‰åˆ†æ”¯çš„å¯¹åº”ï¼š</p>
<pre><code class="language-ini">[remote &quot;origin&quot;]
	url = git@github.com:toFrankie/git_dev_demo.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch &quot;master&quot;]
	remote = origin
	merge = refs/heads/master
[branch &quot;develop&quot;]
	remote = origin
	merge = refs/heads/develop
</code></pre>
<h2>æ ‡ç­¾æ“ä½œ</h2>
<pre><code class="language-shell"># åˆ—å‡ºæ‰€æœ‰ tag
$ git tag

# æŸ¥çœ‹ tag ä¿¡æ¯
$ git show &lt;tag-name&gt;

# è½»é‡æ ‡ç­¾
$ git tag &lt;tag-name&gt;

# è½»é‡æ ‡ç­¾ï¼Œç»™å†å² Commit æ‰“æ ‡ç­¾
$ git tag &lt;tag-name&gt; &lt;commit-id&gt;

# é™„æ³¨æ ‡ç­¾
$ git tag -a &lt;tag-name&gt; -m &lt;message&gt;
# ä¾‹å¦‚ï¼Œæ‰“ä¸€ä¸ª v1.0.0 çš„æ ‡ç­¾
# git tag -a v1.0.0 -m 'v1.0.0 release'

# åæœŸæ‰“æ ‡ç­¾
$ git tag -a &lt;tag-name&gt; &lt;version&gt;

# æäº¤æŒ‡å®š tag
$ git push origin &lt;tag-name&gt;

# æäº¤æ‰€æœ‰ tag
$ git push origin --tags

# åˆ é™¤æœ¬åœ° tag
$ git tag -d &lt;tag-name&gt;

# åˆ é™¤è¿œç¨‹ tag
$ git push origin --detele tag &lt;tag-name&gt;

# è¿˜å¯ä»¥å‘è¿œç¨‹æ¨é€ä¸€ä¸ªâ€œç©ºæ ‡ç­¾â€ï¼Œç­‰åŒäºåˆ é™¤è¿œç¨‹æ ‡ç­¾
$ git push origin :refs/tags/&lt;tag-name&gt;

# å°†æœ¬åœ°æ‰€æœ‰ä¸åœ¨è¿œç¨‹ä»“åº“æœåŠ¡å™¨ä¸Šçš„æ ‡ç­¾æ¨é€è‡³æœåŠ¡å™¨
git push origin â€“tags
</code></pre>
<h2>æ‹‰å–æ“ä½œ</h2>
<p>ä¸»è¦æœ‰ <code>git fetch</code> å’Œ <code>git pull</code>ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>git fetch</code>ï¼šå°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰åˆ°æœ¬åœ°ï¼Œç”¨æˆ·åœ¨æ£€æŸ¥äº†ä»¥åå†³å®šæ˜¯å¦åˆå¹¶åˆ°ã€Œæœ¬åœ°åˆ†æ”¯ã€ä¸­ã€‚</li>
<li><code>git pull</code>ï¼šå°†è¿œç¨‹ä¸»æœºçš„æœ€æ–°å†…å®¹æ‹‰ä¸‹æ¥åç›´æ¥åˆå¹¶ï¼Œç›¸å½“äºï¼š<code>git fetch</code> + <code>git merge FETCH_HEAD</code>ã€‚</li>
</ul>
<blockquote>
<p>æ¯”å¦‚ <code>git fetch origin dev</code> è™½è¯´ä¼šå°†è¿œç¨‹çš„æ›´æ–°æ‹‰å–åˆ°æœ¬åœ°ï¼Œå®ƒä¼šæ›´æ–°è‡³æœ¬åœ°çš„ <code>origin/dev</code> çš„åˆ†æ”¯ä¸‹ï¼Œæ¢å¥è¯è¯´ï¼šæ­¤æ—¶ <code>origin/dev</code> ä¸è¿œç¨‹çš„ <code>dev</code> åˆ†æ”¯æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯æœ€æ–°çš„ï¼ˆè¯·æ³¨æ„ï¼Œæœ¬åœ°çš„ <code>origin/dev</code> å’Œ <code>dev</code> æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„åˆ†æ”¯ï¼‰ã€‚</p>
<p><strong>å¦‚æœä½  Fetch å®Œæˆä¹‹åï¼Œä¸è¿›è¡Œ Merge æˆ– Rebase ç­‰åˆå¹¶æ“ä½œï¼Œå®ƒæ˜¯ä¸ä¼šæ›´æ–° <code>dev</code> åˆ†æ”¯å†…å®¹çš„</strong>ã€‚åœ¨åˆå¹¶ä¹‹å‰ï¼Œå¯ä»¥åˆ©ç”¨ <code>git diff dev origin/dev</code> å»å¯¹æ¯”ä¸¤ä¸ªåˆ†æ”¯çš„å†…å®¹ï¼Œæœ€ç»ˆå†³å®šæ˜¯å¦è¦å°†è¿œç¨‹çš„æ›´æ–°åˆå¹¶è‡³æœ¬åœ°çš„ <code>branch-name</code> åˆ†æ”¯ä¸­ã€‚</p>
</blockquote>
<h3>git fetch</h3>
<pre><code class="language-shell"># å°† git remote ä¸­æ‰€æœ‰å…³è”çš„è¿œç¨‹ä»“åº“åŒ…å«çš„æ‰€æœ‰åˆ†æ”¯çš„æ›´æ–°æ‹‰å–åˆ°æœ¬åœ°
$ git fetch

# å°†æŒ‡å®šè¿œç¨‹æ‰€æœ‰åˆ†æ”¯çš„æ›´æ–°æ‹‰å–è‡³æœ¬åœ°
$ git fetch &lt;è¿œç¨‹ä¸»æœºå&gt;

# å°†è¿œç¨‹ç‰¹å®šåˆ†æ”¯çš„æ›´æ–°æ‹‰å–è‡³æœ¬åœ°
$ git fetch &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;åˆ†æ”¯å&gt;
</code></pre>
<p>å½“æ‹‰å–æˆåŠŸåï¼Œä¼šè¿”å›ä¸€ä¸ª <code>FETCH_HEAD</code>ï¼ŒæŒ‡çš„æ˜¯æŸä¸ªåˆ†æ”¯åœ¨æœåŠ¡å™¨ä¸Šçš„æœ€æ–°çŠ¶æ€ã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ä»¥æŸ¥çœ‹åˆšæ‹‰å–å›æ¥çš„æ›´æ–°ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">$ git log -p FETCH_HEAD
</code></pre>
<p>æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d2761edabdc40709.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ä¸€äº›æ–‡ä»¶æ›´æ–°ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ›´æ–°ä½œè€…ã€æ›´æ–°æ—¶é—´ã€æ›´æ–°ä»£ç ç­‰ï¼Œå¹¶é€šè¿‡è¿™äº›ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦äº§ç”Ÿå†²çªã€‚</p>
<p>æ¥ç€ï¼Œå¯ä»¥é€šè¿‡ <code>git merge</code> æ¥å°†è¿™äº›æ‹‰å–ä¸‹æ¥çš„æœ€æ–°å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ï¼š</p>
<pre><code class="language-shell">$ git merge FETCH_HEAD

# æˆ–è€…ä½¿ç”¨ä»¥ä¸‹è¿™ä¸ªï¼Œå…¶ä¸­ &lt;branch-name&gt; è¡¨ç¤ºè¦åˆå¹¶çš„åˆ†æ”¯åç§°ï¼Œä¾‹å¦‚ origin/main
$ git merge origin/&lt;branch-name&gt;
</code></pre>
<h3>git pull</h3>
<pre><code class="language-shell"># æ‹‰å–è¿œç¨‹æŸåˆ†æ”¯çš„æ›´æ–°ï¼Œå¹¶ä¸æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆå¹¶
$ git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;
# git pull origin

# å¦‚æœè¿œç¨‹åˆ†æ”¯ä¸å½“å‰æœ¬åœ°åˆ†æ”¯è¿›è¡Œåˆå¹¶ï¼Œåˆ™å†’å·åŠåé¢éƒ¨åˆ†å¯ä»¥çœç•¥
$ git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;
# git pull origin &lt;branch-name&gt;
</code></pre>
<p>å› æ­¤</p>
<pre><code class="language-shell">$ git pull origin main

# ç›¸å½“äº
$ git fetch origin main
$ git merge FETCH_HEAD
</code></pre>
<h3>å°‘ç”¨ Pullï¼Œå¤šç”¨ Fetch å’Œ Mergeï¼ˆå»ºè®®ï¼‰</h3>
<p>å°†æ‹‰å–å’Œåˆå¹¶ç‹¬ç«‹å¼€æ¥æ˜¯ä¸€ä¸ªè¾ƒå¥½çš„æ–¹æ³•ï¼Œå³å°‘ç”¨ Pullï¼Œå¤šç”¨ Fetch å’Œ Mergeã€‚</p>
<blockquote>
<p><code>git pull</code> çš„é—®é¢˜æ˜¯å®ƒæŠŠè¿‡ç¨‹çš„ç»†èŠ‚éƒ½éšè—äº†èµ·æ¥ï¼Œä»¥è‡³äºä½ ä¸ç”¨å»äº†è§£ Git ä¸­å„ç§ç±»å‹åˆ†æ”¯çš„åŒºåˆ«å’Œä½¿ç”¨æ–¹æ³•ã€‚å½“ç„¶ï¼Œå¤šæ•°æ—¶å€™è¿™æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†ä¸€æ—¦ä»£ç æœ‰é—®é¢˜ï¼Œä½ å¾ˆéš¾æ‰¾åˆ°å‡ºé”™çš„åœ°æ–¹ã€‚</p>
<p>å°†æ‹‰å–ï¼ˆFetchï¼‰å’Œåˆå¹¶ï¼ˆMergeï¼‰æ”¾åˆ°ä¸€ä¸ªå‘½ä»¤é‡Œçš„å¦å¤–ä¸€ä¸ªå¼Šç«¯æ˜¯ï¼Œä½ çš„æœ¬åœ°å·¥ä½œç›®å½•åœ¨æœªç»ç¡®è®¤çš„æƒ…å†µä¸‹å°±ä¼šè¢«è¿œç¨‹åˆ†æ”¯æ›´æ–°ã€‚å½“ç„¶ï¼Œé™¤éä½ å…³é—­æ‰€æœ‰çš„å®‰å…¨é€‰é¡¹ï¼Œå¦åˆ™ <code>git pull</code> åœ¨ä½ æœ¬åœ°å·¥ä½œç›®å½•è¿˜ä¸è‡³äºé€ æˆä¸å¯æŒ½å›çš„æŸå¤±ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å®æ„¿åšçš„æ…¢ä¸€äº›ï¼Œä¹Ÿä¸æ„¿æ„è¿”å·¥é‡æ¥ã€‚</p>
</blockquote>
<p>å°¤å…¶åœ¨å¤šäººåä½œçš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„åˆå¹¶æ“ä½œï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-shell"># 1. æ‹‰å–
$ git fetch origin main

# 2. æ¯”è¾ƒ
$ git diff main origin/main

# 3. åˆå¹¶
$ git merge origin/main
</code></pre>
<p>æœ‰äº›å›¢é˜Ÿçš„åˆå¹¶æ“ä½œè¦æ±‚ä½¿ç”¨ <code>git rebase</code>ï¼Œè€Œä¸æ˜¯ <code>git merge</code>ã€‚å½“ç„¶äº†ä¹Ÿæœ‰ <code>git pull --rebase</code> å¯ä½¿ç”¨å•¦ã€‚</p>
<p>Related Link:</p>
<ul>
<li><a href="https://longair.net/blog/2009/04/16/git-fetch-and-merge/">GIT: FETCH AND MERGE, DONâ€™T PULL</a></li>
<li><a href="https://blog.csdn.net/weixin_41975655/article/details/82887273">è¯¦è§£ git pull å’Œ git fetch çš„åŒºåˆ«</a></li>
</ul>
<h2>æ–‡ä»¶æ“ä½œ</h2>
<p>æˆ‘ä»¬çŸ¥é“ <code>.gitignore</code> ä»…å¯¹æœªè·Ÿè¸ªè¿‡çš„æ–‡ä»¶æ‰èµ·ä½œç”¨ã€‚å¯¹äºå·²å­˜åœ¨äºç‰ˆæœ¬ç®¡ç†åº“ä¸­çš„æ–‡ä»¶/ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>git rm</code> å‘½ä»¤æ¥å–æ¶ˆå¯¹æ–‡ä»¶/ç›®å½•çš„è·Ÿè¸ªã€‚</p>
<pre><code class="language-shell"># ä¸åˆ é™¤æœ¬åœ°æ–‡ä»¶
$ git rm -r --cached &lt;file-or-dir&gt;

# åˆ é™¤æœ¬åœ°æ–‡ä»¶
$ git rm -r -f &lt;file-or-dir&gt;
</code></pre>
<h2>æ–‡ä»¶å¤§å°å†™é‡å‘½å</h2>
<p>é€šè¿‡ <code>git config core.ignorecase false</code> å¯ä»¥è®© git åŒºåˆ†å¤§å°å†™ã€‚</p>
<p>ä½†å¦‚æœæ–‡ä»¶å·²ç»æ¨é€åˆ°è¿œç«¯ï¼Œä»¥ä¸Šè®¾ç½®å¯èƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<p>å¯ä»¥ç”¨ <code>git mv</code> å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ git mv App.tsx app.tsx
</code></pre>
<blockquote>
<p>å¦‚æœå‡ºç°ç±»ä¼¼ <code>fatal: bad source, source=App.tsx, destination=app.tsx</code> é”™è¯¯ï¼Œå¯ä»¥åŠ ä¸Š <code>-f</code> å‚æ•°ã€‚</p>
</blockquote>
<!--

<hr>
é‡è¦
[git fetch & pullè¯¦è§£](https://www.cnblogs.com/runnerjack/p/9342362.html)

<hr>
git reflog --date=local | grep GJ-62730 å½“å‰çš„gitåˆ†æ”¯æ˜¯åŸºäºå“ªä¸ªåˆ†æ”¯åˆ›å»ºçš„

[git å½“å‰çš„gitåˆ†æ”¯æ˜¯åŸºäºå“ªä¸ªåˆ†æ”¯åˆ›å»ºçš„](https://blog.csdn.net/m0_38068812/article/details/96302752?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-96302752.nonecase&utm_term=git%20%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%88%86%E6%94%AF%E6%98%AF%E5%9F%BA%E4%BA%8E&spm=1000.2123.3001.4430)

<hr>

git logå’Œgit reflogå¯æŸ¥çœ‹commitIdï¼ŒcommitIdæ˜¯å¿«ç…§çš„å”¯ä¸€æ ‡è¯†ï¼ŒäºŒè€…åŒºåˆ«?

<hr>
[å¯¹ Git åˆ†æ”¯ master å’Œ origin/master çš„ä¸€äº›è®¤è¯†](https://blog.csdn.net/weixin_34075268/article/details/85869357)

<hr>

åˆå¹¶çœ‹è¿™ç¯‡ï¼š[Gitæ“ä½œè¯¦è§£](https://www.cnblogs.com/bestzhang/p/6903338.html)

åœ¨git ä»“åº“ä¿®æ”¹ branches åç§°ä¹‹å

```
git branch -m master main
git fetch origin
git branch -u origin/main main
git remote set-head origin -a
```

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Git åˆ†æ”¯ç®¡ç†è‰ºæœ¯]]></title>
            <link>https://github.com/toFrankie/blog/issues/102</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/102</guid>
            <pubDate>Sat, 25 Feb 2023 12:39:37 GMT</pubDate>
            <description><![CDATA[<p>ä¸€ä¸ªä¸­å¿ƒç‰ˆæœ¬åº“ï¼ˆæˆ‘ä»¬å«å®ƒ originï¼‰è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªåˆ†æ”¯ï¼Œå³<strong>ä¸»åˆ†æ”¯</strong>ï¼ˆmasterï¼‰å’Œ<strong>å¼€å‘åˆ†æ”¯</strong>ï¼ˆdevelopï¼‰</p>
<p>åœ¨ä¸€ä¸ªå›¢é˜Ÿå¼€å‘åä½œä¸­ï¼Œå»ºè®®è¦æœ‰<strong>è¾…åŠ©åˆ†æ”¯</strong>çš„æ¦‚å¿µã€‚</p>
<p>è¾…åŠ©åˆ†æ”¯çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯<]]></description>
            <content:encoded><![CDATA[<p>ä¸€ä¸ªä¸­å¿ƒç‰ˆæœ¬åº“ï¼ˆæˆ‘ä»¬å«å®ƒ originï¼‰è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªåˆ†æ”¯ï¼Œå³<strong>ä¸»åˆ†æ”¯</strong>ï¼ˆmasterï¼‰å’Œ<strong>å¼€å‘åˆ†æ”¯</strong>ï¼ˆdevelopï¼‰</p>
<p>åœ¨ä¸€ä¸ªå›¢é˜Ÿå¼€å‘åä½œä¸­ï¼Œå»ºè®®è¦æœ‰<strong>è¾…åŠ©åˆ†æ”¯</strong>çš„æ¦‚å¿µã€‚</p>
<p>è¾…åŠ©åˆ†æ”¯çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯<strong>ç”Ÿå‘½å‘¨æœŸååˆ†æœ‰é™ï¼Œå®Œæˆä½¿å‘½åå³å¯è¢«æ¸…é™¤</strong>ã€‚</p>
<p>è¾…åŠ©åˆ†æ”¯å¤§ä½“åŒ…æ‹¬å¦‚ä¸‹å‡ ç±»ï¼š<strong>ç®¡ç†åŠŸèƒ½å¼€å‘çš„åˆ†æ”¯</strong>ã€<strong>å¸®åŠ©æ„å»ºå¯å‘å¸ƒä»£ç çš„åˆ†æ”¯</strong>ã€<strong>å¯ä»¥ä¾¿æ·çš„ä¿®å¤å‘å¸ƒç‰ˆæœ¬å…³é”® BUG çš„åˆ†æ”¯</strong>ç­‰ç­‰ã€‚</p>
<blockquote>
<p>è®¾ç½®ä¸‰ç±»è¾…åŠ©åˆ†æ”¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <strong>Feature branches</strong>ã€<strong>Release branches</strong>ã€<strong>Hotfix branches</strong>ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œå½¢æˆäº†å¦‚ä¸‹è¿™å¼ æœ€é‡è¦çš„ç»„ç»‡ç»„ï¼ŒåŒ…å«äº†ä¸¤ä¸ªç²—ä½“å­—åˆ†æ”¯ï¼ˆmaster/developï¼‰å’Œä¸‰ä¸ªç»†ä½“å­—åˆ†æ”¯ï¼ˆfeature/release/hotfixesï¼‰ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9a3961565c3e2018.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æºè‡ªï¼š<a href="https://www.open-open.com/lib/view/open1330339022000.html">Git åˆ†æ”¯ç®¡ç†æ˜¯ä¸€é—¨è‰ºæœ¯</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Git Commit è§„èŒƒ]]></title>
            <link>https://github.com/toFrankie/blog/issues/101</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/101</guid>
            <pubDate>Sat, 25 Feb 2023 12:37:41 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹å‰é¢<a href="https://www.jianshu.com/p/5ab7b4b48964">ç³»åˆ—æ–‡ç« </a>çš„è¡¥å……ä¸å®Œå–„ã€‚å‰é¢çš„ä»‹ç»ï¼Œåˆ©ç”¨äº† husky ä¸ lint-staged ä½¿å¾—åœ¨æäº¤ä¹‹å‰åšä¸€äº› ESLint å’Œ Prettier çš„æ“ä½œï¼Œä»Šå¤©æ¥è¡¥å……å®Œ Commit Message æäº¤]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹å‰é¢<a href="https://www.jianshu.com/p/5ab7b4b48964">ç³»åˆ—æ–‡ç« </a>çš„è¡¥å……ä¸å®Œå–„ã€‚å‰é¢çš„ä»‹ç»ï¼Œåˆ©ç”¨äº† husky ä¸ lint-staged ä½¿å¾—åœ¨æäº¤ä¹‹å‰åšä¸€äº› ESLint å’Œ Prettier çš„æ“ä½œï¼Œä»Šå¤©æ¥è¡¥å……å®Œ Commit Message æäº¤è¯´æ˜è§„èŒƒã€‚</p>
<p>Git æ˜¯ç›®å‰æœ€å…ˆè¿›çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ŒGit æ¯æ¬¡æäº¤ä»£ç æ—¶ï¼Œéƒ½éœ€è¦å†™ Commit Messageï¼ˆæäº¤è¯´æ˜ï¼‰ï¼Œå¦åˆ™ä¸å…è®¸æäº¤ã€‚</p>
<pre><code class="language-shell"># å•è¡Œï¼ˆäº¦å¯å¤šè¡Œè¾“å…¥ï¼Œè¾“å…¥ä¸€ä¸ªåŒå¼•å·ï¼ŒæŒ‰ Enter é”®å³å¯ï¼Œæœ€åè¡¥å…¨ä¸€ä¸ªåŒå¼•å·ï¼‰
$ git commit -m &quot;xxx&quot;

# å¤šè¡Œè¾“å…¥ï¼Œè¾“å…¥å‘½ä»¤è¿›å…¥ç¼–è¾‘æ¨¡å¼
$ git commit
</code></pre>
<p>åœ¨å›¢é˜Ÿå¤šäººåä½œä¸­ï¼Œä¸€ä»½æ¸…æ™°ç®€æ˜çš„ Commit Message å¾ˆé‡è¦ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬æ¸…æ¥šäº†è§£æœ¬æ¬¡ä»£ç æäº¤çš„ç›®çš„ä»¥åŠè§£å†³äº†å…·ä½“ä»€ä¹ˆé—®é¢˜ã€‚ä¹Ÿå¯èƒ½è®©åç»­ Code Reviewã€ä¿¡æ¯æŸ¥æ‰¾ã€ç‰ˆæœ¬å›é€€éƒ½æ›´åŠ é«˜æ•ˆå¯é ã€‚</p>
<p>ç›®å‰ï¼Œç¤¾åŒºæœ‰å¤šç§ Commit Message çš„<a href="https://github.com/ajoslin/conventional-changelog/blob/master/conventions">å†™æ³•è§„èŒƒ</a>ã€‚æœ¬æ–‡ä»‹ç» <a href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0">Angular è§„èŒƒ</a>ï¼Œè¿™æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„å†™æ³•ï¼Œæ¯”è¾ƒåˆç†å’Œç³»ç»ŸåŒ–ï¼Œå¹¶ä¸”æœ‰é…å¥—çš„å·¥å…·ã€‚</p>
<h3>Commit Message è§„èŒƒ</h3>
<p>æ¯æ¬¡æäº¤ï¼ŒHeader æ˜¯å¿…éœ€çš„ï¼Œè€Œ Body å’Œ Footer å¯ä»¥çœç•¥ã€‚</p>
<p>ä¸ç®¡å“ªä¸€éƒ¨åˆ†ï¼Œä»»ä½•ä¸€è¡Œéƒ½ä¸å¾—è¶…è¿‡ 72 ä¸ªå­—ç¬¦ï¼ˆæˆ– 100 ä¸ªå­—ç¬¦ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é¿å…è‡ªåŠ¨æ¢è¡Œå½±å“ç¾è§‚ã€‚</p>
<pre><code class="language-xml">&lt;Header&gt;
&lt;ç©ºè¡Œ&gt;
&lt;Body&gt;
&lt;ç©ºè¡Œ&gt;
&lt;Footer&gt;
</code></pre>
<h5>Header éƒ¨åˆ†</h5>
<p>å®ƒåŒ…æ‹¬ <code>type</code>ã€<code>scope</code>ã€<code>subject</code> ä¸‰éƒ¨åˆ†ï¼Œå…¶ä¸­ <code>type</code>ã€<code>subject</code> æ˜¯å¿…é¡»çš„ï¼Œè€Œ <code>scope</code> æ˜¯å¯é€‰çš„ã€‚</p>
<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
</code></pre>
<ol>
<li><strong>type</strong> ç”¨äºè¯´æ˜ commit çš„ç±»å‹ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ ‡è¯†ï¼š</li>
</ol>
<blockquote>
<ul>
<li>
<p><code>feat</code> æ–°åŠŸèƒ½
A new feature</p>
</li>
<li>
<p><code>fix</code> ä¿®å¤ bug
A bug fix</p>
</li>
<li>
<p><code>docs</code> ä»…åŒ…å«æ–‡æ¡£çš„ä¿®æ”¹
Documentation only changes</p>
</li>
<li>
<p><code>style</code>  æ ¼å¼åŒ–å˜åŠ¨ï¼Œä¸å½±å“ä»£ç é€»è¾‘ã€‚æ¯”å¦‚åˆ é™¤å¤šä½™çš„ç©ºç™½ï¼Œåˆ é™¤åˆ†å·ç­‰
Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)</p>
</li>
<li>
<p><code>refactor</code> é‡æ„ï¼Œæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹ bug çš„ä»£ç å˜åŠ¨
A code change that neither fixes a bug nor adds a feature</p>
</li>
<li>
<p><code>perf</code> æ€§èƒ½ä¼˜åŒ–
A code change that improves performance</p>
</li>
<li>
<p><code>test</code> å¢åŠ æµ‹è¯•
Adding missing tests or correcting existing tests</p>
</li>
<li>
<p><code>build</code> æ„å»ºå·¥å…·æˆ–å¤–éƒ¨ä¾èµ–åŒ…çš„ä¿®æ”¹ï¼Œæ¯”å¦‚æ›´æ–°ä¾èµ–åŒ…çš„ç‰ˆæœ¬ç­‰
Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)</p>
</li>
<li>
<p><code>ci</code> æŒç»­é›†æˆçš„é…ç½®æ–‡ä»¶æˆ–è„šæœ¬çš„ä¿®æ”¹
Changes to our CI configuration files and scripts (example scopes: Travis, Circle, BrowserStack, SauceLabs)</p>
</li>
<li>
<p><code>chore</code> æ‚é¡¹ï¼Œå…¶ä»–ä¸ä¿®æ”¹æºä»£ç ä¸æµ‹è¯•ä»£ç çš„ä¿®æ”¹
Other changes that don't modify src or test files</p>
</li>
<li>
<p><code>revert</code> æ’¤é”€æŸæ¬¡æäº¤
Reverts a previous commit</p>
</li>
</ul>
</blockquote>
<p>å¦‚æœ <code>type</code> ä¸º <code>feat</code> å’Œ <code>fix</code>ï¼Œåˆ™è¯¥ commit å°†è‚¯å®šä¼šå‡ºç°åœ¨ Change Log ä¸­ã€‚å…¶ä»–æƒ…å†µï¼ˆ<code>docs</code>ã€<code>chore</code>ã€<code>style</code>ã€<code>refactor</code>ã€<code>test</code>ï¼‰ç”±ä½ å†³å®šï¼Œè¦ä¸è¦æ”¾å…¥ Change Log ä¸­ï¼Œå»ºè®®æ˜¯ä¸è¦ã€‚</p>
<ol start="2">
<li>
<p><strong>scope</strong> ç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚æ•°æ®å±‚ã€æ§åˆ¶å±‚ã€è§†å›¾å±‚ç­‰ã€‚æ ¹æ®é¡¹ç›®æœ¬èº«æƒ…å†µå¤„ç†ï¼Œå¦‚: views, components, utils, test...</p>
</li>
<li>
<p><strong>subject</strong> æ˜¯ commit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦ã€‚</p>
</li>
</ol>
<blockquote>
<ul>
<li>ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªäººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚ changeï¼Œè€Œä¸æ˜¯ changed æˆ–è€… changes</li>
<li>ç¬¬ä¸€å­—æ¯å°å†™</li>
<li>ç»“å°¾ä¸åŠ å¥å·ï¼ˆ<code>.</code>ï¼‰</li>
</ul>
</blockquote>
<h5>Body éƒ¨åˆ†</h5>
<p>Body éƒ¨åˆ†æ˜¯å¯¹æœ¬æ¬¡ commit çš„è¯¦ç»†æè¿°ï¼Œå¯ä»¥åˆ†æˆå¤šè¡Œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèŒƒä¾‹ï¼š</p>
<pre><code>More detailed explanatory text, if necessary.  Wrap it to 
about 72 characters or so. 

Further paragraphs come after blank lines.

- Bullet points are okay, too
- Use a hanging indent
</code></pre>
<p>æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨ change è€Œä¸æ˜¯ changed æˆ–è€… changesã€‚</li>
<li>åº”è¯¥è¯´æ˜ä»£ç å˜åŠ¨çš„åŠ¨æœºï¼Œä»¥åŠä¸ä¹‹å‰è¡Œä¸ºçš„å¯¹æ¯”ã€‚</li>
</ul>
<h5>Footer éƒ¨åˆ†</h5>
<p>Footer éƒ¨åˆ†åªç”¨äºä¸¤ç§æƒ…å†µã€‚</p>
<ol>
<li><strong>ä¸å…¼å®¹çš„å˜åŠ¨</strong></li>
</ol>
<p>å¦‚æœå½“å‰ä»£ç ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹ï¼Œåˆ™ Footer éƒ¨åˆ†ä»¥ <code>BREAKING CHANGE</code> å¼€å¤´ï¼Œåé¢æ˜¯å¯¹å˜åŠ¨çš„æè¿°ä»¥åŠå˜åŠ¨ç†ç”±å’Œè¿ç§»æ–¹æ³•ã€‚</p>
<pre><code>BREAKING CHANGE: isolate scope bindings definition has changed.

    To migrate the code follow the example below:

    Before:

    scope: {
      myAttr: 'attribute',
    }

    After:

    scope: {
      myAttr: '@',
    }

    The removed `inject` wasn't generaly useful for directives so there should be no code using it.
</code></pre>
<ol start="2">
<li><strong>å…³é—­ Issue</strong></li>
</ol>
<p>å¦‚æœå½“å‰ commit é’ˆå¯¹æŸä¸ª issueï¼Œé‚£ä¹ˆæ—§å¯ä»¥åœ¨ Footer éƒ¨åˆ†å…³é—­è¿™ä¸ª issueã€‚</p>
<pre><code># å…³é—­å•ä¸ª
Closes #123

# å…³é—­å¤šä¸ª
Closes #123, #234, #345
</code></pre>
<h5>Revert</h5>
<p>è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœå½“å‰ commit ç”¨äºæ’¤é”€ä»¥å‰çš„ commitï¼Œåˆ™å¿…é¡»ä»¥ <code>revert:</code> å¼€å¤´ï¼Œåé¢è·Ÿç€è¢«æ’¤é”€ Commit çš„ Headerã€‚</p>
<p>Body éƒ¨åˆ†æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œå¿…é¡»å†™æˆ <code>This reverts commit &lt;hash&gt;.</code>ï¼Œå…¶ä¸­çš„ hash æ˜¯è¢«æ’¤é”€ commit çš„ SHA æ ‡è¯†ç¬¦ã€‚</p>
<pre><code>revert: feat(pencil): add 'graphiteWidth' option

This reverts commit 667ecc1654a317a13331b17617d973392f415f02.
</code></pre>
<p>å¦‚æœå½“å‰ commit ä¸è¢«æ’¤é”€çš„ commit åœ¨åŒä¸€ä¸ªå‘å¸ƒï¼ˆreleaseï¼‰é‡Œé¢ï¼Œé‚£ä¹ˆå®ƒéƒ½ä¸ä¼šå‡ºç°åœ¨ Change Log é‡Œé¢ã€‚å¦‚æœä¸¤è€…åœ¨ä¸åŒçš„å‘å¸ƒï¼Œé‚£ä¹ˆå½“å‰ commitï¼Œä¼šå‡ºç°åœ¨ Change Log çš„ <code>Reverts</code> å°æ ‡é¢˜ä¸‹é¢ã€‚</p>
<h3>Commitizen</h3>
<p>Commitizen æ˜¯ä¸€ä¸ªæ’°å†™ç¬¦åˆä¸Šé¢ Commit Message æ ‡å‡†çš„ä¸€æ¬¾å·¥å…·ã€‚</p>
<p>å¯ä»¥å…¨å±€å®‰è£…æˆ–è€…é¡¹ç›®æœ¬åœ°å®‰è£…ï¼Œæˆ‘é‡‡ç”¨åè€…ï¼Œä½†éƒ½ä¼šä»‹ç»ä¸€ä¸‹ã€‚</p>
<p><strong>å…¨å±€å®‰è£…</strong></p>
<pre><code class="language-shell"># å…¨å±€å®‰è£…æ–¹æ³•

# ä¸‹è½½
$ yarn global add commitizen cz-conventional-changelog

# åˆ›å»º .czrc æ–‡ä»¶
$ vi ~/.czrc

# å†™å…¥å¦‚ä¸‹å†…å®¹å¹¶ä¿å­˜
{ &quot;path&quot;: &quot;cz-conventional-changelog&quot; }

# å®Œäº†ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ git cz æ¥ä»£æ›¿ git commit äº†ã€‚
</code></pre>
<p><strong>é¡¹ç›®å±€éƒ¨å®‰è£…</strong></p>
<pre><code class="language-shell">$ yarn add --dev commitizen cz-conventional-changelog
</code></pre>
<p>æ¥ç€å¾€ <code>package.json</code> æ·»åŠ é…ç½®ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;commit&quot;: &quot;git-cz&quot;,
    &quot;changelog&quot;: &quot;conventional-changelog -p angular -i CHANGELOG.md -s -r 0 &amp;&amp; git add CHANGELOG.md&quot;
  },
  &quot;config&quot;: {
    &quot;commitizen&quot;: {
      &quot;path&quot;: &quot;./node_modules/cz-conventional-changelog&quot;
    }
  }
}
</code></pre>
<blockquote>
<p>commitizen ä¸ cz-conventional-changelog çš„å…³ç³»ï¼Ÿ</p>
<p>commitizen æ ¹æ®ä¸åŒçš„ Adapter é…ç½® Commit Messageã€‚æ¯”å¦‚ï¼Œè¦ä½¿ç”¨ Angular çš„ Commit Message æ ¼å¼ï¼Œå¯ä»¥å®‰è£… cz-conventional-changelogã€‚è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ <a href="https://github.com/commitizen/cz-cli">Adapter...</a></p>
</blockquote>
<h3>å®è·µ</h3>
<p>å…¶ä¸­ scopeã€breaking changesã€issue ç­‰éå¿…éœ€é¡¹å¯å›è½¦è·³è¿‡ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-c7768af8e2f0ea19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>ç”Ÿæˆ Change Log</h3>
<p>å¦‚æœä½ çš„æ‰€æœ‰ Commit éƒ½ç¬¦åˆ Angular æ ¼å¼ï¼Œé‚£ä¹ˆå‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œ Change Log å°±å¯ä»¥ç”¨è„šæœ¬è‡ªåŠ¨ç”Ÿæˆã€‚</p>
<p>ç”Ÿæˆçš„æ–‡æ¡£åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>
<blockquote>
<ul>
<li>New features</li>
<li>Bug fixes</li>
<li>Breaking changes.</li>
</ul>
</blockquote>
<p><a href="https://github.com/ajoslin/conventional-changelog">conventional-changelog</a>Â å°±æ˜¯ç”Ÿæˆ Change Log çš„å·¥å…·ï¼Œæ­¤å‰å·²å®‰è£…å¹¶é…ç½®</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;changelog&quot;: &quot;conventional-changelog -p angular -i CHANGELOG.md -s -r 0 &amp;&amp; git add CHANGELOG.md&quot;
  }
}
</code></pre>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ <code>CHANGELOG</code> æ–‡ä»¶ï¼Œå…¶ä¸­ <code>feat</code> å’Œ <code>fix</code> ç±»å‹çš„å˜åŠ¨ä¼šç”Ÿæˆåœ¨é‡Œé¢ã€‚</p>
<pre><code class="language-shell">$ yarn run changelog
</code></pre>
<p>æ¯ä¸ªéƒ¨åˆ†éƒ½ä¼šç½—åˆ—ç›¸å…³çš„ commit ï¼Œå¹¶ä¸”æœ‰æŒ‡å‘è¿™äº› commit çš„é“¾æ¥ã€‚å½“ç„¶ï¼Œç”Ÿæˆçš„æ–‡æ¡£å…è®¸æ‰‹åŠ¨ä¿®æ”¹ï¼Œæ‰€ä»¥å‘å¸ƒå‰ï¼Œä½ è¿˜å¯ä»¥æ·»åŠ å…¶ä»–å†…å®¹ã€‚</p>
<p>æ–‡ç« çš„ç¤ºä¾‹ Demo åœ¨è¿™é‡Œ  <a href="https://github.com/toFrankie/wechat_applet_demo.git">GitHub: wechat_applet_demo</a>ï¼Œæ¬¢è¿ Star ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html">Commit message å’Œ Change log ç¼–å†™æŒ‡å—ï¼ˆé˜®ä¸€å³°è€å¸ˆï¼‰</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/132348944">ä½¿ç”¨ commitizen è§„èŒƒ Git æäº¤è¯´æ˜</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æœ¬åœ°é¡¹ç›®å…³è”è¿œç¨‹ Git ä»“åº“]]></title>
            <link>https://github.com/toFrankie/blog/issues/100</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/100</guid>
            <pubDate>Sat, 25 Feb 2023 12:36:34 GMT</pubDate>
            <description><![CDATA[<h3>æ­¥éª¤</h3>
<ol>
<li>æœ¬åœ°é¡¹ç›®åˆå§‹åŒ– git</li>
</ol>
<pre><code class="language-shell">$ git init
</code></pre>
<ol start="2">
<li>å…³è”è¿œç¨‹ä»“åº“</li>
</ol>
<pre><code class="la]]></description>
            <content:encoded><![CDATA[<h3>æ­¥éª¤</h3>
<ol>
<li>æœ¬åœ°é¡¹ç›®åˆå§‹åŒ– git</li>
</ol>
<pre><code class="language-shell">$ git init
</code></pre>
<ol start="2">
<li>å…³è”è¿œç¨‹ä»“åº“</li>
</ol>
<pre><code class="language-shell">$ git remote add origin &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;  
# ä¾‹å¦‚
# git remote add origin  git@github.com:toFrankie/node-upload-demo.git
</code></pre>
<ol start="3">
<li>æäº¤æš‚å­˜</li>
</ol>
<pre><code class="language-shell">$ git add .   # å°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å…¨éƒ¨æ·»åŠ è‡³æš‚å­˜åŒº
</code></pre>
<ol start="4">
<li>æäº¤åˆ°åˆ†æ”¯</li>
</ol>
<pre><code class="language-shell">$ git commit -m 'å¤‡æ³¨'
</code></pre>
<ol start="5">
<li>æ¨é€</li>
</ol>
<pre><code class="language-shell">$ git push -u origin master
</code></pre>
<ol start="6">
<li>ç§»é™¤ git</li>
</ol>
<pre><code class="language-shell">$ rm -rf .git
</code></pre>
<h3>å¸¸è§é—®é¢˜</h3>
<ol>
<li>å¦‚ä½•é…ç½®é‚®ç®±å’Œç”¨æˆ·å</li>
</ol>
<pre><code class="language-shell">$ git config --global user.name &quot;xxx&quot;       
$ git config --global user.email &quot;xxx&quot;

# ä»¥ä¸Šæ˜¯è®¾ç½®å…¨å±€ç”¨æˆ·ï¼Œå¦‚æœæ˜¯å•ä¸€é¡¹ç›®åˆ™ï¼š
$ git config user.name &quot;xxx&quot;       
$ git config user.email &quot;xxx&quot;
</code></pre>
<ol start="2">
<li>åœ¨ç¬¬ 5 æ­¥ä¹‹å‰éƒ½å¾ˆé¡ºåˆ©ï¼Œç„¶ååˆ°æœ€åæ¨é€çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ¨é€å¤±è´¥ï¼Œå¹¶æç¤ºï¼š<strong>Git: Permission to ***.git denied to deploy key</strong>ã€‚åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯ä½ æ²¡æœ‰æƒé™æ¨é€åˆ°è¯¥ä»“åº“ã€‚
åœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ª Deploy Keysï¼Œç„¶åå°†ç”Ÿæˆçš„å…¬é’¥æ‹·è´åˆ°ã€ä½ çš„ä»“åº“ã€‘-ã€Settingsã€‘-ã€Deploy Keysã€‘-ã€Add deploy keyã€‘æ–°å»ºä¸€ä¸ªå³å¯ã€‚</li>
</ol>
<pre><code class="language-shell"># ä»¥ä¸‹æ­¥éª¤æ¶‰åŠçš„è·¯å¾„ã€Deploy Keys åç§°ä»¥åŠå¯†ç ï¼ŒæŒ‰ç…§è‡ªå·±å–œå¥½è€Œå®šï¼Œä¸”è®°ä½å¯†ç 

# ç”Ÿæˆ Deploy Keys
$ ssh-keygen -f ~/.ssh/deploy_key_nodeUploadDemo

# æ·»åŠ åˆ°è®¤è¯åˆ—è¡¨
$ ssh-add ~/.ssh/deploy_key_nodeUploadDemo

# æŸ¥çœ‹è®¤è¯åˆ—è¡¨ï¼Œçœ‹æ˜¯å¦æˆåŠŸæ·»åŠ 
$ ssh-add -l

# æ‹·è´ deploy public key
$ cat ~/.ssh/deploy_key_nodeUploadDemo.pub | pbcopy
</code></pre>
<ol start="3">
<li>ä¸Šè¿°ç¬¬äºŒç‚¹çš„æ–¹å¼ï¼Œæ·»åŠ å®Œå…¬é’¥åï¼Œåªèƒ½å¯¹å½“å‰ä»“åº“æœ‰æ•ˆï¼Œæ–°å»ºå…¶ä»–ä»“åº“ï¼Œè¿˜è¦é‡å¤ä¸Šè¿°çš„æ“ä½œå’Œæ­¥éª¤ã€‚è‹¥è¦å¯¹æ‰€æœ‰çš„é¡¹ç›®éƒ½æœ‰æ•ˆçš„è¯ï¼Œåº”è¯¥åœ¨ã€GitHubå¤´åƒã€‘-ã€Settingsã€‘-ã€SSH and GPG keysã€‘-ã€New SSH keyã€‘æŠŠå…¬é’¥ï¼ˆid_rsa.pubï¼‰æ‹·è´åˆ°ä¸Šé¢å»ã€‚</li>
</ol>
<pre><code class="language-shell"># ç”Ÿæˆå…¬é’¥å’Œç§é’¥
$ ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;

# å‘½ä»¤è§£è¯»ï¼š
# https://blog.csdn.net/weixin_33775582/article/details/93798019

# éªŒè¯ä¸githubè¿æ¥æ˜¯å¦æˆåŠŸ
$ ssh -T git@github.com

# æŸ¥çœ‹å…·ä½“ä¿¡æ¯
$ ssh -T -v git@github.com
</code></pre>
<ol start="4">
<li>æŸ¥çœ‹é…ç½®</li>
</ol>
<pre><code class="language-shell"># å½“å‰é¡¹ç›®
$ git config --list
#  å…¨å±€
$ git config --global --list
</code></pre>
<ol start="5">
<li>å…¶ä»–é—®é¢˜</li>
</ol>
<blockquote>
<p>Hi toFrankie! You've successfully authenticated, but GitHub does not provide shell access.</p>
</blockquote>
<pre><code class="language-shell">$ ssh-add ~/.ssh/id_rsa
</code></pre>
<h3>Git å…¶ä»–</h3>
<ol>
<li><a href="https://blog.csdn.net/liuxiao723846/article/details/83113317">Git config ä»‹ç»</a>ï¼›</li>
<li><a href="https://www.jianshu.com/p/f3020c04d966">å¯¹ Git ç”¨æˆ·åä¸ Github è´¦æˆ·å…³ç³»çš„ç†è§£</a>ï¼›</li>
<li><a href="https://blog.csdn.net/wang975380547/article/details/78116070">å…³äº ssh -T git@github.com è¿æ¥ GitHub å¤±è´¥ï¼Œä»¥åŠ Permission denied (publickey) é—®é¢˜</a>ï¼›</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Git æ“ä½œä¸è§£å†³æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/99</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/99</guid>
            <pubDate>Sat, 25 Feb 2023 12:34:52 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-04-20ï¼Œæœ¬ç¯‡ä¸ºä¸ªäººç¬”è®°ï¼Œè®°å½•ç”¨ã€‚</p>
<ol>
<li>æ¸…é™¤ gitï¼Œå³åˆ é™¤æœ¬åœ° <code>.git</code> æ–‡ä»¶ã€‚å‘½ä»¤ï¼š<code>rm -rf .git</code>ã€‚</li>
<li><a href="https://blog.csdn.net/m0_37034294]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-04-20ï¼Œæœ¬ç¯‡ä¸ºä¸ªäººç¬”è®°ï¼Œè®°å½•ç”¨ã€‚</p>
<ol>
<li>æ¸…é™¤ gitï¼Œå³åˆ é™¤æœ¬åœ° <code>.git</code> æ–‡ä»¶ã€‚å‘½ä»¤ï¼š<code>rm -rf .git</code>ã€‚</li>
<li><a href="https://blog.csdn.net/m0_37034294/article/details/80199512">Git è¿œç¨‹æ¨é€The authenticity of host 'github.com (52.74.223.119)'é—®é¢˜</a>ï¼Œè§£å†³ï¼šThe authenticity of host '<a href="http://github.com">github.com</a> (52.74.223.119)' can't be established. é—®é¢˜</li>
<li><a href="https://blog.csdn.net/m0_37034294/article/details/79986198">ç”Ÿæˆsshçš„æ–¹æ³•å’Œé…ç½®</a></li>
<li><a href="https://www.jianshu.com/p/8d0fae451745">ç”Ÿæˆ Deploy Keys</a>ï¼Œè§„åˆ™ä¸ ssh key ä¸€æ ·</li>
</ol>
<blockquote>
<ol>
<li><code>ssh-keygen -f ~/.ssh/deploy_key_repo1</code>ï¼ˆç”Ÿæˆä¿å­˜ï¼‰</li>
<li><code>ssh-add ~/.ssh/deploy_key_repo1</code>ï¼ˆæ·»åŠ è·¯å¾„åˆ°è®¤è¯åˆ—è¡¨ï¼‰</li>
<li><code>ssh-add -l</code>ï¼ˆæŸ¥çœ‹è®¤è¯åˆ—è¡¨ï¼Œçœ‹æ˜¯å¦æˆåŠŸæ·»åŠ ï¼‰</li>
<li><code>cat ~/.ssh/deploy_key_repo1.pub | pbcopy</code>ï¼ˆå¤åˆ¶ deploy public keyï¼‰</li>
</ol>
</blockquote>
<ol start="5">
<li><a href="mailto:git@github.com">git@github.com</a>: Permission denied (publickey).</li>
<li>Git: The key you are authenticating with has been marked as read only. <a href="https://blog.csdn.net/qq_35815383/article/details/53898932">è¿™é‡Œ</a></li>
</ol>
<h3>å…¶ä»–</h3>
<ol>
<li>é…ç½®é‚®ç®±å’Œç”¨æˆ·å</li>
</ol>
<pre><code class="language-shell">$ git config --global user.name &quot;xxx&quot;       
$ git config --global user.email &quot;xxx&quot;

# ä»¥ä¸Šæ˜¯è®¾ç½®å…¨å±€ç”¨æˆ·ï¼Œå¦‚æœæ˜¯å•ä¸€é¡¹ç›®åˆ™ï¼š
$ git config user.name &quot;xxx&quot;       
$ git config user.email &quot;xxx&quot;
</code></pre>
<ol start="2">
<li>æäº¤åˆ°æš‚å­˜ï¼ˆå…¨éƒ¨ï¼‰</li>
</ol>
<pre><code class="language-shell">$ git add -A -- .
</code></pre>
<ol start="3">
<li>æŸ¥çœ‹å½“å‰ç”¨æˆ·ä¿¡æ¯ä»¥åŠå…¶ä»–çš„ä¸€äº›ä¿¡æ¯</li>
</ol>
<pre><code class="language-shell">$ git config --list
</code></pre>
<ol start="4">
<li>å°†æš‚å­˜æäº¤åˆ° git åº“</li>
</ol>
<pre><code class="language-shell">$ git commit -m &quot;æ·»åŠ ä½ çš„æ³¨é‡Š,ä¸€èˆ¬æ˜¯ä¸€äº›æ›´æ”¹ä¿¡æ¯&quot;
</code></pre>
<ol start="5">
<li>å°†æœ¬åœ°çš„åº“é“¾æ¥åˆ°è¿œç¨‹</li>
</ol>
<pre><code class="language-shell">$ git remote add origin https://github.com/toFrankie/HelloNode.git
</code></pre>
<ol start="6">
<li>push</li>
</ol>
<pre><code class="language-shell">$ git pull origin master
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æˆ–è®¸èƒ½å¸®ä½ è§£å¼€ node-sass çš„æ‰€æœ‰ç–‘é—®ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/98</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/98</guid>
            <pubDate>Sat, 25 Feb 2023 12:33:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fb3c7e1fb18995e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fb3c7e1fb18995e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>é‚£ä¸ªæ˜¯ä¸æ˜¯ <code>node-sass</code> çš„å®‰è£…å°±å¯èƒ½éš¾å€’ä¸€æ‰¹å‰ç«¯åŒå­¦ã€‚çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ–è®¸èƒ½è§£å¼€ä¸€äº›ç–‘æƒ‘ã€‚</p>
<h2>å†™åœ¨å‰é¢</h2>
<ul>
<li>
<p>æ–°é¡¹ç›®é€‰æ‹© Dart Sassï¼ˆå³ <a href="https://www.npmjs.com/package/sass"><code>sass</code></a>ï¼‰ï¼ŒNode Sass ä¸å†æä¾› CSS æ–°ç‰¹æ€§çš„æ”¯æŒã€‚</p>
</li>
<li>
<p>å°½ç®¡ Node Sass çš„æ€§èƒ½ç›®å‰æœ€ä½³ï¼Œä½†å®ƒè¢«å¼ƒç”¨å·²æˆäº‹å®ã€‚è€Œä¸”è·Ÿ Dart Sass çš„æ€§èƒ½å·®å¼‚ï¼Œä¸€èˆ¬è§„æ¨¡çš„é¡¹ç›®ç›¸ä¿¡ 99% éƒ½æ— æ€§èƒ½å·®å¼‚æ„ŸçŸ¥ã€‚</p>
</li>
<li>
<p>å¤§å®¶éƒ½çŸ¥é“æ”¹ä¸ºå›½å†…é•œåƒæºï¼Œå¯ä»¥åŠ å¿« npm åŒ…çš„ä¸‹è½½ã€‚ä½† <code>node-sass</code> åŒ…è¾ƒä¸ºç‰¹æ®Šï¼Œåœ¨å®‰è£…æ—¶è¿˜è¦ä» GitHub ä¸­ä¸‹è½½å¯¹åº”å¹³å°çš„ <code>binding.node</code> æ–‡ä»¶ï¼Œå› æ­¤è¿˜è¦å°† Sass Binary Site æŒ‡å®šä¸ºå›½å†…é•œåƒæºä½¿å…¶ä¹Ÿåœ¨å›½å†…é•œåƒæºä¸­ä¸‹è½½ï¼Œæ‰èƒ½å½»åº•è§£å†³ç½‘ç»œä¸ç¨³å®šå¯¼è‡´å®‰è£…å¤±è´¥çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p><code>node-sass</code> åŸºäº LibSass æ„å»ºï¼Œåè€…ä½¿ç”¨ C++ å¼€å‘ã€‚å› æ­¤éœ€è¦ç”¨åˆ° <code>node-gyp</code>ï¼Œåœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Node.js ä¸­ä¼šè‡ªå¸¦ <code>node-gyp</code>ï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ— éœ€é¢å¤–å®‰è£…ã€‚</p>
</li>
<li>
<p><code>node-gyp</code> æ˜¯ GYP çš„ Node å®ç°ï¼Œæ˜¯ç”¨æ¥ç¼–è¯‘ C++ æ¨¡å—çš„è·¨å¹³å°å·¥å…·ã€‚è€Œ GYP æ˜¯åŸºäº Python å¼€å‘ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… Pythonã€‚</p>
</li>
<li>
<p><code>node-gyp</code> é™¤äº†éœ€è¦å®‰è£… Python ä¹‹å¤–ï¼Œåœ¨ä¸åŒå¹³å°è¿˜è¦å®‰è£…å…¶ä»–ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ macOS çš„ Xcodeã€Windows çš„ VC++ ç¼–è¯‘å™¨ç­‰ã€‚</p>
</li>
<li>
<p>åœ¨ Node ä¸­è°ƒç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„æ¨¡å—ï¼Œéœ€è¦ç”¨ <code>node-gyp</code> ç”Ÿæˆå¹³å°ç›¸å…³çš„é¡¹ç›®æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨ gccã€vsbuildã€xcode ç­‰ç¼–è¯‘å¹³å°æ¥è¿›è¡Œç¼–è¯‘ã€‚</p>
</li>
<li>
<p>åœ¨ <code>node-gyp</code> æ„å»ºé¡¹ç›®æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æŒ‡å®š Python è·¯å¾„ï¼Œåœ¨æœªé…ç½®çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä»ç¯å¢ƒå˜é‡ <code>PATH</code> æŸ¥æ‰¾åä¸º <code>python2</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™ã€‚é€šå¸¸åšæ³•æ˜¯ç”¨ <code>npm config set python /path/to/your/python</code> å»æŒ‡å®šï¼Œç‰¹åˆ«æ˜¯æœ¬æœºæœ‰å¤šä¸ª Python ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p>é•œåƒæºé—®é¢˜åªèƒ½è§£å†³ä¸‹è½½æ…¢çš„é—®é¢˜ï¼Œå¦‚æœ <code>node-sass</code> è¿˜å®‰è£…å¤±è´¥ï¼ŒåŸå› æ— éå°±å‡ ä¸ªï¼š</p>
<ul>
<li>ä¸€æ˜¯ï¼Œæœªå®‰è£…å¹³å°ç›¸å…³çš„ç¼–è¯‘å™¨ã€‚æ¯”å¦‚ macOS çš„ Xcode ç­‰ã€‚</li>
<li>äºŒæ˜¯ï¼Œå½“å‰ <code>node-sass</code> ä¸ Node ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œè¿™ä¸ªç‰ˆæœ¬å¯¹åº”å…³ç³»å¯ä»¥åœ¨ <code>node-sass</code> å®˜ç½‘ä¸­æŸ¥çœ‹ï¼›</li>
<li>ä¸‰æ˜¯ï¼Œå½“å‰ <code>node-sass</code> æ‰€ä¾èµ–çš„ <code>node-gyp</code> ä¸æ”¯æŒä½ æœ¬æœºå®‰è£…çš„ Python ç‰ˆæœ¬ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µé™ä½/å‡çº§ Python è§£å†³ã€‚</li>
</ul>
</li>
</ul>
<h2>å‰è¨€</h2>
<p>è‡ªè¯ç”Ÿä»¥æ¥ï¼ŒCSS åœ¨è¯­æ³•ä¸Šéƒ½è¾ƒä¸ºç®€å•ã€‚éšç€ Web çš„é£é€Ÿå‘å±•ï¼ŒWeb é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼ŒåŸç”Ÿ CSS åœ¨åº”å¯¹å¤æ‚é¡¹ç›®çš„æ—¶å€™ä¼¼ä¹åŠ›ä¸ä»å¿ƒã€‚åæ¥ç¤¾åŒºä¸Šå‡ºç°äº†å¾ˆå¤š CSS é¢„å¤„ç†å™¨ï¼ˆCSS preprocessorï¼‰ï¼Œæ¯”å¦‚ Sassã€Lessã€Stylusã€PostCSS ç­‰ã€‚å®ƒä»¬æä¾›äº†åŸç”Ÿ CSS ä¸å…·å¤‡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ä»£ç æ··åˆã€åµŒå¥—é€‰æ‹©å™¨ã€ç»§æ‰¿é€‰æ‹©å™¨ç­‰ï¼Œä½¿å¾— CSS æ›´å®¹æ˜“ç»´æŠ¤ã€‚CSS é¢„å¤„ç†å™¨å¯ä»¥ç†è§£ä¸ºä¸€é—¨æ–°çš„è¯­è¨€ï¼Œéƒ½æœ‰ç€ç‰¹å®šçš„è¯­æ³•ï¼Œç„¶åé€šè¿‡å¯¹åº”çš„ç¼–è¯‘å™¨ç”Ÿæˆæµè§ˆå™¨å¯è¯†åˆ«çš„åŸç”Ÿ CSSã€‚</p>
<h3>Sass ä¸å…¶ä»–é¢„å¤„ç†å™¨çš„åŒºåˆ«</h3>
<p>æ­¤å¤„ä¸è®¨è®ºè¯­æ³•ä¸Šçš„å·®å¼‚ã€‚Less å’Œ Stylus çš„ç¼–è¯‘å™¨éƒ½æ˜¯ä½¿ç”¨ JavaScript ç¼–å†™çš„ã€‚è€Œ Sass åˆ™ç»å†äº† Ruby Sassã€Node Sassã€Dart Sass ä¸‰ä»£ç¼–è¯‘å™¨ï¼Œä¸”éƒ½ä¸æ˜¯åŸºäº JavaScript ç¼–å†™çš„ã€‚</p>
<h3>Sass ç¼–è¯‘å™¨</h3>
<ul>
<li><a href="https://sass-lang.com/ruby-sass">Ruby Sass</a>ï¼šåŸºäº Ruby è¯­è¨€ç¼–å†™ï¼Œæ€§èƒ½æœ€å·®ï¼Œäº 2019 å¹´åœæ­¢ç»´æŠ¤ã€‚</li>
<li><a href="">Node Sass</a>ï¼šåŸºäº LibSass æ„å»ºå¹¶ä¸ Node.js è¿›è¡Œé›†æˆï¼Œè€Œ LibSass æ˜¯ç”¨ C++ ç¼–å†™çš„ã€‚äº 2020 å¹´å®£å¸ƒä¸å†æä¾›æ–°ç‰¹æ€§çš„æ”¯æŒã€‚</li>
<li><a href="https://sass-lang.com/dart-sass">Dart Sass</a>ï¼šåŸºäº Dart è¯­è¨€ç¼–å†™ï¼ŒDart æ˜¯ Flutter çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå¯ä»¥ç¼–è¯‘ä¸º JavaScriptã€‚</li>
</ul>
<p>Node Sass æ€§èƒ½æœ€ä½³ï¼ŒDart Sass æ¬¡ä¹‹ï¼ŒRuby Sass æœ€æ‹‰ã€‚å°½ç®¡ Node Sass çš„æ€§èƒ½æœ€ä½³ï¼Œä½†ç”±äº <a href="https://sass-lang.com/libsass">LibSass</a> è·Ÿä¸ä¸Š CSS åŠ Sass å¿«é€Ÿå‘å±•çš„æ­¥ä¼ï¼Œæ‰€ä»¥ Sass å›¢é˜Ÿå†³å®šæ”¾å¼ƒå®ƒï¼Œå…¨é¢æ‹¥æŠ± Dart Sassã€‚</p>
<ul>
<li><a href="https://sass-lang.com/blog/libsass-is-deprecated">LibSass is Deprecated</a></li>
<li><a href="https://sass-lang.com/blog/ruby-sass-is-deprecated">Ruby Sass is Deprecated</a></li>
</ul>
<h3>Node Sass ä¸ Dart Sass å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3>
<p>æ–°é¡¹ç›®ä¼˜å…ˆè€ƒè™‘ Dart Sassï¼Œè¿™ä¹Ÿæ˜¯ Sass å›¢é˜Ÿæ‰€æ¨èçš„ã€‚</p>
<blockquote>
<p><strong>Warning:</strong>Â <a href="https://sass-lang.com/blog/libsass-is-deprecated">LibSass and Node Sass are deprecated</a>. While they will continue to receive maintenance releases indefinitely, there are no plans to add additional features or compatibility with any new CSS or Sass features. Projects that still use it should move ontoÂ <a href="https://sass-lang.com/dart-sass">Dart Sass</a>.</p>
</blockquote>
<p>ç”±äº Node Sass ä¸å†æ”¯æŒæ–°ç‰¹æ€§ï¼Œæœªæ¥é€æ­¥è¢«æ·˜æ±°æ˜¯å¾ˆè‡ªç„¶çš„äº‹ã€‚</p>
<p>Dart Sass æä¾›äº†çº¯ JavaScript çš„ npm åŒ… <a href="https://www.npmjs.com/package/sass"><code>sass</code></a>ï¼ˆä»¥å‰å«åš <a href="https://www.npmjs.com/package/dart-sass"><code>dart-sass</code></a>ï¼‰ï¼Œå®ƒçš„å®‰è£…å¯æ¯” <a href="https://www.npmjs.com/package/node-sass"><code>node-sass</code></a> çœå¿ƒå¤šäº† ğŸ˜ªã€‚ä» Node Sass è¿ç§»åˆ° Dart Sass ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦æŠŠ <code>package.json</code> ä¸­çš„ <code>node-sass</code> ä¾èµ–æ”¹ä¸º <code>sass</code> å³å¯ï¼Œä¸¤è€…æä¾›çš„ JavaScript API æ˜¯ç›¸åŒçš„ã€‚</p>
<h2>node-sass</h2>
<h3>node-gyp</h3>
<p>ç”±äº <code>node-sass</code> æ„å»ºåœ¨ LibSass ä¹‹ä¸Šï¼ŒLibSass åˆ™æ˜¯ç”¨ C++ å®ç°çš„ï¼Œå› æ­¤ä½¿ç”¨ <code>node-sass</code> çš„è¯ï¼Œ<code>node-gyp</code> æ˜¯å¿…éœ€çš„ã€‚<code>node-gyp</code> æ˜¯ <a href="https://gyp.gsrc.io/index.md">GYP</a> åœ¨ Node ä¸­çš„å®ç°ï¼Œç”¨æ¥ç¼–è¯‘åŸç”Ÿ C++ æ¨¡å—çš„ã€‚å…¶ä¸­ <code>node-gyp</code> åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Node.js æ˜¯è‡ªå¸¦çš„ã€‚</p>
<h3>node-gyp æ­£å¸¸è¿è¡Œçš„å‰æ</h3>
<p>ä½¿ç”¨ <code>node-gyp</code>ä¹‹å‰ï¼Œè¦å®‰è£…å¯¹åº”å¹³å°çš„ç›¸å…³å·¥å…·æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚æ›´å¤šå®‰è£…ä»‹ç»è¯·çœ‹ï¼š<a href="https://github.com/nodejs/node-gyp#installation">node-gyp Installation</a>ã€‚</p>
<p>Linux/Unix å¹³å°ï¼š</p>
<blockquote>
<ul>
<li>Python 3.x</li>
<li>make</li>
<li>A proper C/C++ compiler toolchain, likeÂ <a href="https://gcc.gnu.org/">GCC</a></li>
</ul>
</blockquote>
<p>macOS å¹³å°ï¼š</p>
<blockquote>
<ul>
<li>Python 3.x</li>
<li>XCode Command Line Tools</li>
</ul>
</blockquote>
<p>Windows å¹³å°ï¼š</p>
<blockquote>
<ul>
<li>Python</li>
<li>VC++ ç¼–è¯‘å™¨</li>
</ul>
</blockquote>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œè¿™é‡Œä¸å…¨é‡å®‰è£… XCodeï¼Œåªè¦å®‰è£… XCode Command Line Tools å³å¯ã€‚</p>
<pre><code class="language-shell"># å®‰è£… XCode Command Line Tools
$ xcode-select --install

# å®‰è£… Python 3
$ brew install python
</code></pre>
<p>ä»¥ Windows ä¸ºä¾‹ï¼Œå…ˆ Microsoft Store ä¸‹è½½å®‰è£… Pythonï¼Œæ¥ç€ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ cmd æˆ– PowerShell æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å®‰è£… VC++ ç¼–è¯‘å™¨ï¼ˆæ›´å¤šè¯·çœ‹ <a href="https://github.com/Microsoft/nodejs-guidelines/blob/master/windows-environment.md#environment-setup-and-configuration">Environment setup and configuration</a>ï¼‰ã€‚</p>
<pre><code class="language-shell">$ npm install --global --production windows-build-tools
</code></pre>
<h3>æŒ‡å®š Python ç‰ˆæœ¬</h3>
<p>å¦‚æœä½ å®‰è£…äº†å¤šä¸ª Python ç‰ˆæœ¬ï¼Œå¯åœ¨ npm æˆ– yarn çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚ä»¥ macOS ä¸ºä¾‹ï¼š</p>
<pre><code class="language-shell"># è·å– Python è·¯å¾„
$ which python3
/usr/local/bin/python3

# é…ç½® npm æˆ– yarn çš„ python è·¯å¾„
$ npm config set python /usr/local/bin/python3
$ yarn config set python /usr/local/bin/python3
</code></pre>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä½ç‰ˆæœ¬ <code>node-gyp</code> å¯èƒ½ä»…æ”¯æŒ Python 2.xã€‚</p>
</blockquote>
<h3>node-sass å®‰è£…æ…¢æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h3>
<p>é¦–å…ˆæ˜¯é•œåƒæºçš„é—®é¢˜ï¼Œå®ƒä¸å•æ˜¯ <code>node-sass</code> åŒ…æ‰è¿™æ ·ï¼Œæ‰€æœ‰åŒ…éƒ½ä¸€æ ·ã€‚ç”±äº npm é»˜è®¤é•œåƒæº <code>https://registry.npmjs.org/</code> åœ¨å¢ƒå¤–ï¼Œè®¿é—®çš„æ—¶å€™æ…¢æˆ–è€…ä¸ç¨³å®šæ˜¯æ­£å¸¸çš„ã€‚è¿™ä¸ªå¯ä»¥æŒ‚æ¢¯å­æˆ–è€…ä¿®æ”¹ä¸ºå›½å†…é•œåƒæºè§£å†³ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¿®æ”¹ä¸ºæ·˜å®é•œåƒæºï¼š</p>
<pre><code class="language-shell">$ npm config set registry https://registry.npmmirror.com/
$ yarn config set reigstry https://registry.npmmirror.com/
</code></pre>
<blockquote>
<p>å¦‚æœæ˜¯ç®¡ç†é•œåƒæºï¼Œä¸ªäººæ¨èä½¿ç”¨ <a href="https://www.jianshu.com/p/5ec39caa01cd">nrm</a> æˆ– <a href="https://www.jianshu.com/p/2a4b345f35a8">yrm</a>ã€‚</p>
</blockquote>
<h3>ä¸ºä»€ä¹ˆä¿®æ”¹ä¸ºå›½å†…é•œåƒæºè¿˜æ…¢ï¼Œç”šè‡³å¤±è´¥ï¼Ÿ</h3>
<p>åœ¨ <code>node-sass</code> çš„ <code>package.json</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;install&quot;: &quot;node scripts/install.js&quot;,
    &quot;postinstall&quot;: &quot;node scripts/build.js&quot;
  }
}
</code></pre>
<p>æ‰€ä»¥åœ¨å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œä¼šå…ˆåæ‰§è¡Œ <code>install</code>ã€<code>postinstall</code> å¯¹åº”å‘½ä»¤ï¼Œå®ƒä»¬æ‰€åšçš„äº‹æƒ…å¤§è‡´æ˜¯ï¼š</p>
<ol>
<li>ä¸‹è½½å¯¹åº”å¹³å°çš„ <code>binding.node</code> æ–‡ä»¶ï¼›</li>
<li>ä¸‹è½½å®Œæˆï¼Œæ‰§è¡Œ <a href="https://github.com/nodejs/node-gyp#commands"><code>node-gyp rebuild</code></a> å‘½ä»¤è¿›è¡Œæ„å»ºã€‚</li>
</ol>
<p>åœ¨ <code>script/index.js</code> ä¼šæ‰§è¡Œä¸€ä¸ª <code>checkAndDownloadBinary()</code> æ–¹æ³•ï¼Œä»¥æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜ã€‚è‹¥æ— ï¼Œç»§ç»­æ‰§è¡Œä¸€ä¸ª <code>download()</code> æ–¹æ³•åœ¨æŒ‡å®š URL ä¸­ä¸‹è½½ <code>binding.node</code> æ–‡ä»¶ï¼Œè€Œ URL åˆ™é€šè¿‡ <code>getBinaryUrl()</code> æ–¹æ³•è·å–ï¼š</p>
<pre><code class="language-js">function getBinaryUrl() {
  var site = getArgument('--sass-binary-site') ||
             process.env.SASS_BINARY_SITE  ||
             process.env.npm_config_sass_binary_site ||
             (pkg.nodeSassConfig &amp;&amp; pkg.nodeSassConfig.binarySite) ||
             'https://github.com/sass/node-sass/releases/download';

  return [site, 'v' + pkg.version, getBinaryName()].join('/');
}
</code></pre>
<p>ä»ä»£ç å¯çŸ¥ï¼Œå…ˆåé¡ºåºæ˜¯ï¼š</p>
<ul>
<li>å‘½ä»¤è¡Œå‚æ•° <code>--sass-binary-site</code></li>
<li>ç¯å¢ƒå˜é‡ <code>SASS_BINARY_SITE</code></li>
<li><code>.npmrc</code> é…ç½® <code>sass_binary_site</code></li>
<li><code>package.json</code> ä¸­çš„ <code>nodeSass.binarySite</code> å­—æ®µ</li>
<li>è‹¥ä»¥ä¸Šéƒ½æ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä» Github ä¸­ä¸‹è½½ï¼Œæ¯”å¦‚ï¼š<code>https://github.com/sass/node-sass/releases/download/v8.0.0/darwin-x64-83_binding.node</code>ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œä»…ä»…æŒ‡å®šå›½å†…é•œåƒæºè¿˜ä¸å¤Ÿï¼Œè¿˜è¦æŒ‡å®š Sass Binary Siteï¼Œæ–¹å¼æœ‰ä»¥ä¸Šå››ç§ã€‚</p>
<h3>æŒ‡å®š Sass Binary Site</h3>
<p>é¦–å…ˆï¼Œä»ä¸Šé¢çš„ <code>getBinaryUrl()</code> æ–¹æ³•å¯çŸ¥ï¼Œå¯ä»¥æœ‰å¤šç§æ–¹å¼å»æŒ‡å®šï¼Œä½†ä¸ªäººæ¨èåœ¨ <code>.npmrc</code> æˆ– <code>.yarnrc</code> ä¸­æŒ‡å®šï¼š</p>
<pre><code class="language-shell">$ npm config set sass_binary_site https://npmmirror.com/mirrors/node-sass
$ yarn config set sass_binary_site https://npmmirror.com/mirrors/node-sass
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œå…¶ <code>binding.node</code> æ–‡ä»¶å°±ä¼šä» <code>https://npmmirror.com/mirrors/node-sass/v8.0.0/darwin-x64-83_binding.node</code> ä¸‹è½½ï¼Œå°±ä¸ä¼šé¾Ÿé€Ÿé‚£ä¹ˆæ…¢äº†ã€‚</p>
<p>è¿˜å¯ä»¥è¿™æ ·ï¼š</p>
<blockquote>
<ul>
<li>å¦‚æœæ˜¯ä½¿ç”¨å‘½ä»¤è¡Œï¼Œå¯ä»¥åœ¨ <code>--sass-binary-site</code> å‚æ•°æŒ‡å®šï¼Œæ¯”å¦‚ï¼š<code>npm install node-sass --sass-binary-site=https://npmmirror.com/mirrors/node-sass</code>ã€‚</li>
<li>å¯ä»¥è®¾ç½® <code>SASS_BINARY_SITE</code> ç¯å¢ƒå˜é‡ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š
<ul>
<li>å…¨å±€ç¯å¢ƒå˜é‡ï¼ˆæŒä¹…åŒ–ï¼‰ï¼Œæ¯”å¦‚ <code>echo 'export SASS_BINARY_SITE=https://npmmirror.com/mirrors/node-sass' &gt;&gt; ~/.zshrc</code>ã€‚</li>
<li>ä¸´æ—¶ç¯å¢ƒå˜é‡ï¼Œæ¯æ¬¡å®‰è£…çš„æ—¶å€™æŒ‡å®šã€‚æ¯”å¦‚ <code>SASS_BINARY_SITE=https://npmmirror.com/mirrors/node-sass npm install</code>ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<p>æ€»çš„æ¥è®²ï¼Œåœ¨ <code>.npmrc</code> æˆ– <code>.yarnrc</code> ä¸­æŒ‡å®šä¸ªäººè®¤ä¸ºæ˜¯æœ€åˆé€‚çš„ã€‚</p>
<h2>é—®é¢˜æ’æŸ¥</h2>
<p>å®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œå®‰è£… <code>node-sass</code> è¿˜æ˜¯ä¸æˆåŠŸï¼Ÿ</p>
<h3>æ£€æŸ¥ Node ç‰ˆæœ¬</h3>
<p>å…ˆæ£€æŸ¥å½“å‰ <code>node-sass</code> ç‰ˆæœ¬æ‰€æ”¯æŒçš„ Node ç‰ˆæœ¬ï¼Œç„¶ååœ¨å®‰è£…å¯¹åº”çš„ Node ç‰ˆæœ¬é‡è¯•ã€‚è¯¦è§ <a href="https://github.com/sass/node-sass#node-version-support-policy">Node version support policy</a>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-419b999883435558.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åƒæˆ‘é¡¹ç›®ä¸­ <code>node-sass</code> ç‰ˆæœ¬å·ä¸º <code>4.13.0</code>ï¼Œä½¿ç”¨ Node 16 å°±ä¸è¡Œï¼Œå› æ­¤æˆ‘é™åˆ°äº† Node 12ã€‚</p>
<pre><code class="language-shell">$ fnm install 12
$ fnm use 12
</code></pre>
<blockquote>
<p>Node å¤šç‰ˆæœ¬ç®¡ç†çš„è¯ï¼Œä¸ªäººæ¨èä½¿ç”¨ <a href="https://www.jianshu.com/p/0843d55e044e"><code>fnm</code></a>ã€‚</p>
</blockquote>
<p>é™¤äº† Node ç‰ˆæœ¬è¿‡é«˜ä¹‹å¤–ï¼Œè¯¥ç‰ˆæœ¬ä»…æ”¯æŒ Python 2ã€‚è€Œç³»ç»Ÿå†…ç½®çš„ Python 2.x åœ¨ macOS 12.3 ä¹‹åè¢«ç§»é™¤äº†ï¼Œè€Œä¸”ç›®å‰ Homebrew ä¸å†æ”¯æŒå®‰è£… Python 2ã€‚ç„¶åå‚è€ƒè¿™ç¯‡<a href="https://www.wyr.me/post/658">æ–‡ç« </a>ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå®‰è£… Python 2 çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ brew install pyenv
$ pyenv install 2.7.18
$ echo 'export PATH=&quot;$(pyenv root)/shims:${PATH}&quot;' &gt;&gt; ~/.zshrc
$ source ~/.zshrc
$ pyenv global 2.7.18
</code></pre>
<p>å®‰è£…å®Œä¹‹åï¼Œå†å°†å®ƒçš„è·¯å¾„è®¾ç½®åˆ° <code>.npmrc</code> é‡Œé¢ã€‚</p>
<pre><code class="language-shell">$ python --version
Python 2.7.18

$ which python
/Users/frankie/.pyenv/shims/python

$ npm config set python /Users/frankie/.pyenv/shims/python
$ yarn config set python /Users/frankie/.pyenv/shims/python
</code></pre>
<h3>è¿˜ä¸è¡Œï¼Ÿ</h3>
<p>é‚£æˆ‘æƒ³ï¼Œé—®é¢˜å¤šåŠæ˜¯å‡ºç°åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;postinstall&quot;: &quot;node scripts/build.js&quot;
  }
}
</code></pre>
<p>å®ƒæ— éå°±æ˜¯é€šè¿‡ Node æä¾› <code>child_process.spawn</code> å»æ‰§è¡Œ Shell å‘½ä»¤ã€‚</p>
<pre><code class="language-js">function build(options) {
  var args = [require.resolve(path.join('node-gyp', 'bin', 'node-gyp.js')), 'rebuild', '--verbose'].concat(
    ['libsass_ext', 'libsass_cflags', 'libsass_ldflags', 'libsass_library'].map(function(subject) {
      return ['--', subject, '=', process.env[subject.toUpperCase()] || ''].join('');
    })).concat(options.args);

  console.log('Building:', [process.execPath].concat(args).join(' '));

  var proc = spawn(process.execPath, args, {
    stdio: [0, 1, 2]
  });

  proc.on('exit', function(errorCode) {
    if (!errorCode) {
      afterBuild(options);
      return;
    }

    if (errorCode === 127 ) {
      console.error('node-gyp not found!');
    } else {
      console.error('Build failed with error code:', errorCode);
    }

    process.exit(1);
  });
}
</code></pre>
<p>æ‰§è¡Œçš„å‘½ä»¤è¡Œç±»ä¼¼ <code>node_modules/node-gyp/bin/node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=</code>ã€‚ä¹Ÿå°±æ˜¯ <code>node-gyp rebuild</code> å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>Command</strong></th>
<th style="text-align:left"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>help</code></td>
<td style="text-align:left">Shows the help dialog</td>
</tr>
<tr>
<td style="text-align:left"><code>build</code></td>
<td style="text-align:left">Invokes <code>make</code>/<code>msbuild.exe</code> and builds the native addon</td>
</tr>
<tr>
<td style="text-align:left"><code>clean</code></td>
<td style="text-align:left">Removes the <code>build</code> directory if it exists</td>
</tr>
<tr>
<td style="text-align:left"><code>configure</code></td>
<td style="text-align:left">Generates project build files for the current platform</td>
</tr>
<tr>
<td style="text-align:left"><code>rebuild</code></td>
<td style="text-align:left">Runs <code>clean</code>, <code>configure</code> and <code>build</code> all in a row</td>
</tr>
<tr>
<td style="text-align:left"><code>install</code></td>
<td style="text-align:left">Installs Node.js header files for the given version</td>
</tr>
<tr>
<td style="text-align:left"><code>list</code></td>
<td style="text-align:left">Lists the currently installed Node.js header versions</td>
</tr>
<tr>
<td style="text-align:left"><code>remove</code></td>
<td style="text-align:left">Removes the Node.js header files for the given version</td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥ <code>node-gyp rebuild</code> å°±æ˜¯å…ˆåæ‰§è¡Œ <code>node-gyp clean</code>ã€<code>node-gyp configure</code>ã€<code>node-gyp build</code> ä¸‰æ¡å‘½ä»¤è€Œå·²ã€‚ç»å¤§å¤šæ•°é—®é¢˜ï¼Œå¯èƒ½ä¼šå‡ºç°åœ¨ <code>node-gyp configure</code> ä¸Šï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆå¯¹åº”å¹³å°çš„é¡¹ç›®æ„å»ºæ–‡ä»¶ã€‚</p>
<h3>ç¤ºä¾‹åˆ†æä¸€</h3>
<pre><code>yarn install v1.22.19
[1/5] ğŸ”  Validating package.json...
[2/5] ğŸ”  Resolving packages...
[3/5] ğŸšš  Fetching packages...
[4/5] ğŸ”—  Linking dependencies...
warning &quot; &gt; styled-jsx@3.2.3&quot; has incorrect peer dependency &quot;react@15.x.x || 16.x.x&quot;.
warning &quot;zent &gt; react-beautiful-dnd &gt; react-motion@0.5.2&quot; has incorrect peer dependency &quot;react@^0.14.9 || ^15.3.0 || ^16.0.0&quot;.
warning &quot;zent &gt; react-beautiful-dnd &gt; react-redux@5.1.1&quot; has incorrect peer dependency &quot;react@^0.14.0 || ^15.0.0-0 || ^16.0.0-0&quot;.
[5/5] ğŸ”¨  Building fresh packages...
[-/3] â  waiting...
[2/3] â  fsevents
error /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass: Command failed.
Exit code: 1
Command: node scripts/build.js
Arguments: 
Directory: /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass
Output:
Building: /usr/local/bin/node /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=
gyp info it worked if it ends with ok
gyp verb cli [
gyp verb cli   '/usr/local/bin/node',
gyp verb cli   '/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js',
gyp verb cli   'rebuild',
gyp verb cli   '--verbose',
gyp verb cli   '--libsass_ext=',
gyp verb cli   '--libsass_cflags=',
gyp verb cli   '--libsass_ldflags=',
gyp verb cli   '--libsass_library='
gyp verb cli ]
gyp info using node-gyp@3.8.0
gyp info using node@16.15.0 | darwin | arm64
gyp verb command rebuild []
gyp verb command clean []
gyp verb clean removing &quot;build&quot; directory
gyp verb command configure []
gyp verb check python checking for Python executable &quot;python2&quot; in the PATH
gyp verb `which` failed Error: not found: python2
gyp verb `which` failed     at getNotFoundError (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:13:12)
gyp verb `which` failed     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:19)
gyp verb `which` failed     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21)
gyp verb `which` failed  python2 Error: not found: python2
gyp verb `which` failed     at getNotFoundError (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:13:12)
gyp verb `which` failed     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:19)
gyp verb `which` failed     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21) {
gyp verb `which` failed   code: 'ENOENT'
gyp verb `which` failed }
gyp verb check python checking for Python executable &quot;python&quot; in the PATH
gyp verb `which` failed Error: not found: python
gyp verb `which` failed     at getNotFoundError (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:13:12)
gyp verb `which` failed     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:19)
gyp verb `which` failed     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21)
gyp verb `which` failed  python Error: not found: python
gyp verb `which` failed     at getNotFoundError (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:13:12)
gyp verb `which` failed     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:19)
gyp verb `which` failed     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21) {
gyp verb `which` failed   code: 'ENOENT'
gyp verb `which` failed }
gyp ERR! configure error 
gyp ERR! stack Error: Can't find Python executable &quot;python&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/lib/configure.js:484:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/lib/configure.js:406:16)
gyp ERR! stack     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:16)
gyp ERR! stack     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp ERR! stack     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp ERR! stack     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp ERR! stack     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp ERR! stack     at FSReqCallback.oncomplete (node:fs:198:21)
gyp ERR! System Darwin 22.3.0
gyp ERR! command &quot;/usr/local/bin/node&quot; &quot;/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js&quot; &quot;rebuild&quot; &quot;--verbose&quot; &quot;--libsass_ext=&quot; &quot;--libsass_cflags=&quot; &quot;--libsass_ldflags=&quot; &quot;--libsass_library=&quot;
gyp ERR! cwd /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass
gyp ERR! node -v v16.15.0
gyp ERR! node-gyp -v v3.8.0
gyp ERR! not ok 

...
</code></pre>
<p>ç„¶åå¯ä»¥å¿«é€Ÿé”å®šåˆ°è¿™å‡ è¡Œï¼š</p>
<pre><code>Building: /usr/local/bin/node /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=
gyp info it worked if it ends with ok
gyp verb cli [
gyp verb cli   '/usr/local/bin/node',
gyp verb cli   '/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js',
gyp verb cli   'rebuild',
gyp verb cli   '--verbose',
gyp verb cli   '--libsass_ext=',
gyp verb cli   '--libsass_cflags=',
gyp verb cli   '--libsass_ldflags=',
gyp verb cli   '--libsass_library='
gyp verb cli ]
gyp info using node-gyp@3.8.0
gyp info using node@16.15.0 | darwin | arm64
gyp verb command rebuild []
gyp verb command clean []
gyp verb clean removing &quot;build&quot; directory
gyp verb command configure []
gyp verb check python checking for Python executable &quot;python2&quot; in the PATH
gyp verb `which` failed Error: not found: python2
gyp verb `which` failed     at getNotFoundError (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:13:12)
gyp verb `which` failed     at F (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:68:19)
gyp verb `which` failed     at E (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:80:29)
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/which/which.js:89:16
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/index.js:42:5
gyp verb `which` failed     at /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/isexe/mode.js:8:5
gyp verb `which` failed     at FSReqCallback.oncomplete (node:fs:198:21)
</code></pre>
<p>çœ‹æ ·å­å‡ºç°åœ¨ <code>node-gyp configure</code> è¿‡ç¨‹ä¸Šï¼Œç„¶åè¿½æº¯åˆ° <code>node-gyp/lib/configure.js</code> ä¸­çš„ <code>findPython()</code> æ–¹æ³•ä¸Šï¼Œå…¶è·¯å¾„å–å†³äºï¼š</p>
<pre><code class="language-js">var python = gyp.opts.python || process.env.PYTHON || 'python2'
</code></pre>
<p>å…¶ä¸­ <code>gyp.opts</code> å¯ä»¥æ˜¯ Command Options æˆ–è€…æ˜¯ <code>.npmrc</code> ä¸­çš„å¯¹åº”é…ç½®ã€‚ç”±äºæ‰§è¡Œ <code>node-gyp rebuild</code> æ—¶æ²¡æœ‰ä¼ é€’ <code>--python</code> å‚æ•°ï¼Œ<code>.npmrc</code> ä¸­æ²¡æœ‰è®¾ç½® <code>python</code> é…ç½®ï¼Œå› æ­¤é»˜è®¤ä½¿ç”¨ <code>python2</code>ã€‚ä½†ç”±äºæˆ‘æœ¬æœºçš„ç¯å¢ƒå˜é‡ <code>PATH</code> çš„è·¯å¾„ä¸­å¹¶æ²¡æœ‰åä¸º <code>python2</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤æŠ¥é”™äº†ã€‚</p>
<p>è§£å†³æ–¹æ³•æ€è·¯å¾ˆç®€å•ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯è¾ƒæ–°ç‰ˆæœ¬çš„ <code>node-sass</code>ï¼Œå®ƒå¯¹åº”çš„ <code>node-gyp</code> ç‰ˆæœ¬ä¹Ÿè¾ƒæ–°ï¼Œæ­¤æ—¶åº”é¦–é€‰å®‰è£… Python 3ã€‚</li>
<li>å¦‚æœå½“å‰ <code>node-sass</code> ç‰ˆæœ¬ä»…æ”¯æŒ Python 2.xï¼Œé‚£ä¹ˆå®‰è£…è¯¥ç‰ˆæœ¬å°±è¡Œã€‚</li>
</ul>
<p>å®‰è£…å®Œä¹‹åï¼Œè®¾ç½® npm æˆ– yarn é…ç½®ï¼Œé‚£ä¹ˆå®ƒèƒ½ä» <code>var python = gyp.opts.python</code> ä¸­è·å– Python çš„è·¯å¾„äº†ã€‚ä»¥ macOS ä¸ºä¾‹ï¼š</p>
<pre><code class="language-shell"># è‹¥æ˜¯ Python 2ï¼Œåˆ™æ˜¯ which python
$ which python3
/usr/local/bin/python3

$ npm config set python /usr/local/bin/python3
$ yarn config set python /usr/local/bin/python3
</code></pre>
<h3>ç¤ºä¾‹åˆ†æäºŒ</h3>
<pre><code>yarn install v1.22.19
[1/5] ğŸ”  Validating package.json...
[2/5] ğŸ”  Resolving packages...
[3/5] ğŸšš  Fetching packages...
[4/5] ğŸ”—  Linking dependencies...
warning &quot; &gt; styled-jsx@3.2.3&quot; has incorrect peer dependency &quot;react@15.x.x || 16.x.x&quot;.
warning &quot;zent &gt; react-beautiful-dnd &gt; react-motion@0.5.2&quot; has incorrect peer dependency &quot;react@^0.14.9 || ^15.3.0 || ^16.0.0&quot;.
warning &quot;zent &gt; react-beautiful-dnd &gt; react-redux@5.1.1&quot; has incorrect peer dependency &quot;react@^0.14.0 || ^15.0.0-0 || ^16.0.0-0&quot;.
[5/5] ğŸ”¨  Building fresh packages...
[-/3] â ‚ waiting...
[2/3] â ‚ fsevents
warning Error running install script for optional dependency: &quot;/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents: Command failed.
Exit code: 1
Command: node install
Arguments: 
Directory: /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
Output:
node-pre-gyp info it worked if it ends with ok
node-pre-gyp info using node-pre-gyp@0.12.0
node-pre-gyp info using node@12.22.12 | darwin | x64
node-pre-gyp WARN Using request for node-pre-gyp https download 
node-pre-gyp info check checked for \&quot;/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v72-darwin-x64/fse.node\&quot; (not found)
node-pre-gyp http GET https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v72-darwin-x64.tar.gz
node-pre-gyp http 403 https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v72-darwin-x64.tar.gz
node-pre-gyp WARN Tried to download(403): https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v72-darwin-x64.tar.gz 
node-pre-gyp WARN Pre-built binaries not found for fsevents@1.2.9 and node@12.22.12 (node-v72 ABI, unknown) (falling back to source compile with node-gyp) 
node-pre-gyp http 403 status code downloading tarball https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v72-darwin-x64.tar.gz 
gyp info it worked if it ends with ok
gyp info using node-gyp@3.8.0
gyp info using node@12.22.12 | darwin | x64
gyp info ok 
gyp info it worked if it ends with ok
gyp info using node-gyp@3.8.0
gyp info using node@12.22.12 | darwin | x64
gyp ERR! configure error 
gyp ERR! stack Error: Command failed: /usr/bin/python3 -c import sys; print \&quot;%s.%s.%s\&quot; % sys.version_info[:3];
gyp ERR! stack   File \&quot;&lt;string&gt;\&quot;, line 1
gyp ERR! stack     import sys; print \&quot;%s.%s.%s\&quot; % sys.version_info[:3];
gyp ERR! stack                       ^
gyp ERR! stack SyntaxError: invalid syntax
gyp ERR! stack 
gyp ERR! stack     at ChildProcess.exithandler (child_process.js:308:12)
gyp ERR! stack     at ChildProcess.emit (events.js:314:20)
gyp ERR! stack     at maybeClose (internal/child_process.js:1022:16)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:287:5)
gyp ERR! System Darwin 22.3.0
gyp ERR! command \&quot;/Users/frankie/Library/Application Support/fnm/node-versions/v12.22.12/installation/bin/node\&quot; \&quot;/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js\&quot; \&quot;configure\&quot; \&quot;--fallback-to-build\&quot; \&quot;--module=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v72-darwin-x64/fse.node\&quot; \&quot;--module_name=fse\&quot; \&quot;--module_path=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v72-darwin-x64\&quot; \&quot;--napi_version=8\&quot; \&quot;--node_abi_napi=napi\&quot; \&quot;--napi_build_version=0\&quot; \&quot;--node_napi_label=node-v72\&quot; \&quot;--python=/usr/bin/python3\&quot;
gyp ERR! cwd /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
gyp ERR! node -v v12.22.12
gyp ERR! node-gyp -v v3.8.0
gyp ERR! not ok 
node-pre-gyp ERR! build error 
node-pre-gyp ERR! stack Error: Failed to execute '/Users/frankie/Library/Application Support/fnm/node-versions/v12.22.12/installation/bin/node /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --module=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v72-darwin-x64/fse.node --module_name=fse --module_path=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v72-darwin-x64 --napi_version=8 --node_abi_napi=napi --napi_build_version=0 --node_napi_label=node-v72 --python=/usr/bin/python3' (1)
node-pre-gyp ERR! stack     at ChildProcess.&lt;anonymous&gt; (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/node_modules/node-pre-gyp/lib/util/compile.js:83:29)
node-pre-gyp ERR! stack     at ChildProcess.emit (events.js:314:20)
node-pre-gyp ERR! stack     at maybeClose (internal/child_process.js:1022:16)
node-pre-gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:287:5)
node-pre-gyp ERR! System Darwin 22.3.0
node-pre-gyp ERR! command \&quot;/Users/frankie/Library/Application Support/fnm/node-versions/v12.22.12/installation/bin/node\&quot; \&quot;/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/node_modules/node-pre-gyp/bin/node-pre-gyp\&quot; \&quot;install\&quot; \&quot;--fallback-to-build\&quot;
node-pre-gyp ERR! cwd /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
node-pre-gyp ERR! node -v v12.22.12
node-pre-gyp ERR! node-pre-gyp -v v0.12.0
node-pre-gyp ERR! not ok 
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½åˆ°ï¼š</p>
<pre><code>gyp ERR! configure error 
gyp ERR! stack Error: Command failed: /usr/bin/python3 -c import sys; print \&quot;%s.%s.%s\&quot; % sys.version_info[:3];
gyp ERR! stack   File \&quot;&lt;string&gt;\&quot;, line 1
gyp ERR! stack     import sys; print \&quot;%s.%s.%s\&quot; % sys.version_info[:3];
gyp ERR! stack                       ^
gyp ERR! stack SyntaxError: invalid syntax
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨ Python3 æ‰§è¡Œä»£ç æ—¶å€™æç¤ºè¯­æ³•é”™è¯¯ï¼Œå› ä¸º <code>print &quot;xxx&quot;</code> æ˜¯ Python2 çš„è¯­æ³•ï¼Œè€Œ Python3 çš„è¯­æ³•åº”è¯¥æ˜¯ <code>print(&quot;xxx&quot;)</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŒœåˆ°æ˜¯ç›®å‰ <code>node-sass</code> æ‰€ä¾èµ–çš„ <code>node-gyp</code> ç‰ˆæœ¬è¿‡ä½ï¼Œåè€…ç”¨çš„æ˜¯ Python2 è¯­æ³•å®ç°çš„ã€‚</p>
<p>è§£å†³æ€è·¯å¾ˆç®€å•ï¼Œå®‰è£… Python2 å¹¶å°†å…¶è·¯å¾„æ·»åŠ åˆ° npm é…ç½®ä¸­æ¥ï¼Œå…·ä½“æ“ä½œä¸å±•å¼€èµ˜è¿°ï¼Œå‰æ–‡å·²ä»‹ç»è¿‡äº†ã€‚</p>
<h3>ç¤ºä¾‹åˆ†æä¸‰</h3>
<p>å‰é¢å®‰è£…å®Œæˆä¹‹åï¼Œæ‰§è¡Œ <code>yarn start</code> æ„å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œå‡ºç°é—®é¢˜ï¼š</p>
<pre><code>$ yarn start
yarn run v1.22.19
$ webpack-dev-server --env.NODE_ENV=development --hot
â„¹ ï½¢wdsï½£: Project is running at http://0.0.0.0:3001/
â„¹ ï½¢wdsï½£: webpack output is served from /
â„¹ ï½¢wdsï½£: Content not from webpack is served from /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/dist/
Browserslist: caniuse-lite is outdated. Please run next command `yarn upgrade`
[styled-jsx] Loading plugin from path: styled-jsx-plugin-sass
âœ– ï½¢wdmï½£: Hash: baa097cdaf43c729d164
Version: webpack 4.41.2
Time: 455ms
Built at: 2023/02/07 18:21:57
                  Asset       Size  Chunks                                Chunk Names
           ./index.html  812 bytes          [emitted]                     
assets/main.baa097cd.js    923 KiB    main  [emitted] [immutable]  [big]  main
Entrypoint main [big] = assets/main.baa097cd.js
[0] multi (webpack)-dev-server/client?http://0.0.0.0:3001 (webpack)/hot/dev-server.js ./src/index.tsx 52 bytes {main} [built]
[./node_modules/strip-ansi/index.js] 161 bytes {main} [built]
[./node_modules/webpack-dev-server/client/index.js?http://0.0.0.0:3001] (webpack)-dev-server/client?http://0.0.0.0:3001 4.29 KiB {main} [built]
[./node_modules/webpack-dev-server/client/overlay.js] (webpack)-dev-server/client/overlay.js 3.51 KiB {main} [built]
[./node_modules/webpack-dev-server/client/socket.js] (webpack)-dev-server/client/socket.js 1.53 KiB {main} [built]
[./node_modules/webpack-dev-server/client/utils/createSocketUrl.js] (webpack)-dev-server/client/utils/createSocketUrl.js 2.89 KiB {main} [built]
[./node_modules/webpack-dev-server/client/utils/log.js] (webpack)-dev-server/client/utils/log.js 964 bytes {main} [built]
[./node_modules/webpack-dev-server/client/utils/reloadApp.js] (webpack)-dev-server/client/utils/reloadApp.js 1.59 KiB {main} [built]
[./node_modules/webpack-dev-server/client/utils/sendMessage.js] (webpack)-dev-server/client/utils/sendMessage.js 402 bytes {main} [built]
[./node_modules/webpack/hot sync ^\.\/log$] (webpack)/hot sync nonrecursive ^\.\/log$ 170 bytes {main} [built]
[./node_modules/webpack/hot/dev-server.js] (webpack)/hot/dev-server.js 1.59 KiB {main} [built]
[./node_modules/webpack/hot/emitter.js] (webpack)/hot/emitter.js 75 bytes {main} [built]
[./node_modules/webpack/hot/log-apply-result.js] (webpack)/hot/log-apply-result.js 1.27 KiB {main} [built]
[./node_modules/webpack/hot/log.js] (webpack)/hot/log.js 1.34 KiB {main} [built]
[./src/index.tsx] 1.21 KiB {main} [built] [failed] [1 error]
    + 20 hidden modules

ERROR in ./src/index.tsx
Module build failed (from ./node_modules/babel-loader/lib/index.js):
Error: /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/src/index.tsx: Node Sass does not yet support your current environment: OS X Unsupported architecture (arm64) with Unsupported runtime (93)
For more information on which environments are supported please see:
https://github.com/sass/node-sass/releases/tag/v4.13.0
    at module.exports (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass/lib/binding.js:13:13)
    at Object.&lt;anonymous&gt; (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass/lib/index.js:14:35)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)
    at Module.load (node:internal/modules/cjs/loader:981:32)
    at Function.Module._load (node:internal/modules/cjs/loader:822:12)
    at Module.require (node:internal/modules/cjs/loader:1005:19)
    at require (node:internal/modules/cjs/helpers:102:18)
    at Object.&lt;anonymous&gt; (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/styled-jsx-plugin-sass/index.js:1:14)
    at Module._compile (node:internal/modules/cjs/loader:1105:14)
Child html-webpack-plugin for &quot;index.html&quot;:
     1 asset
    Entrypoint undefined = ./index.html
    [./node_modules/html-webpack-plugin/lib/loader.js!./src/index.html] 980 bytes {0} [built]
    [./node_modules/lodash/lodash.js] 528 KiB {0} [built]
    [./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes {0} [built]
    [./node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes {0} [built]
â„¹ ï½¢wdmï½£: Failed to compile.
</code></pre>
<blockquote>
<p>Node Sass does not yet support your current environment: OS X Unsupported architecture (arm64) with Unsupported runtime (93)</p>
</blockquote>
<p>å¯ä»¥è¿½æŸ¥åˆ° <code>node-sass/lib/extensions.js</code> çš„ <code>isSupportedEnvironment()</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-js">function isSupportedEnvironment(platform, arch, abi) {
  return (
    false !== getHumanPlatform(platform) &amp;&amp;
    false !== getHumanArchitecture(arch) &amp;&amp;
    false !== getHumanNodeVersion(abi)
  );
}
</code></pre>
<p>å¯¹åº” <code>getHumanArchitecture()</code> æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function getHumanArchitecture(arch) {
  switch (arch || process.arch) {
    case 'ia32': return '32-bit';
    case 'x86': return '32-bit';
    case 'x64': return '64-bit';
    default: return false;
  }
}
</code></pre>
<p>å¹¶ä¸æ”¯æŒ <code>arm64</code> æ¶æ„ï¼Œå› æ­¤æŠ¥é”™äº†ã€‚ç›¸å…³ Issueï¼š<a href="https://github.com/sass/node-sass/issues/3033">Apple ARM Support #3033</a>ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯é™ä½ Node ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code>$ fnm use 12
</code></pre>
<p>ç„¶åä¸ºä»€ä¹ˆ Node 12 æ²¡é—®é¢˜å‘¢ï¼Ÿç¿»æŸ¥æºç  <code>node-sass/lib/binding.js</code> å‘ç°ï¼š</p>
<pre><code class="language-js">/**
 * Require binding
 */
module.exports = function (ext) {
  if (!ext.hasBinary(ext.getBinaryPath())) {
    if (!ext.isSupportedEnvironment()) {
      throw new Error(errors.unsupportedEnvironment());
    } else {
      throw new Error(errors.missingBinary());
    }
  }

  return require(ext.getBinaryPath());
};
</code></pre>
<p>é¦–å…ˆ <code>ext.hasBinary(ext.getBinaryPath())</code> ä¼šæŒ‡å®šç›®å½•æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ <code>binding.node</code> æ–‡ä»¶ï¼ŒæŒ‡å®šè·¯å¾„ç±»ä¼¼ï¼š <code>/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-sass/vendor/darwin-x64-72/binding.node</code>ã€‚è¿™ä¸ªè·¯å¾„å¯ä»¥é€šè¿‡ <code>SASS_BINARY_PATH</code>ã€<code>SASS_BINARY_DIR</code>ã€ <code>SASS_BINARY_NAME</code> æ¥æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå…¶é»˜è®¤å€¼ç”± <code>platform-arch-versions.modules</code> ç»„æˆï¼ˆå¦‚ <code>darwin-x64-72</code>ï¼‰ï¼Œå‰é¢ä¸¤ä¸ªå¥½ç†è§£ï¼Œåé¢é‚£ä¸ªåº”è¯¥æ˜¯ç”± <a href="https://github.com/sass/node-sass#node-version-support-policy">Node Module</a> å¯¹åº”ç»„æˆã€‚</p>
<p>åœ¨ä½¿ç”¨ Node 12 çš„æ—¶å€™ï¼Œæœ¬åœ°å¯ä»¥æ‰¾åˆ° <code>node_modules/node-sass/vendor/darwin-x64-72/binding.node</code> æ–‡ä»¶ï¼Œå› æ­¤è·³è¿‡äº† <code>isSupportedEnvironment()</code> çš„æ£€æŸ¥ï¼Œæ‰€ä»¥é™ä½ Node ç‰ˆæœ¬ä¹Ÿæ˜¯è§£å†³æ–¹æ³•ä¹‹ä¸€ã€‚å½“ä½¿ç”¨ Node 16 çš„æ—¶å€™ï¼Œæœ¬åœ°æ²¡æœ‰ <code>node_modules/node-sass/vendor/darwin-arm64-93/binding.node</code> æ–‡ä»¶ï¼Œå› æ­¤è·‘å»æ ¡éªŒå¹³å°ã€æ¶æ„å»äº†ï¼Œä½†ç”±äºæœ¬æœºæ˜¯ ARM æ¶æ„çš„ Macï¼Œè€Œå‰é¢ä»£ç æ‰€ç¤ºæ˜¯ä¸æ”¯æŒ arm64 æ¶æ„çš„ï¼Œå› æ­¤å°±æŠ¥é”™äº†ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯ï¼Œå‰å¾€ GitHub ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ <code>binding.node</code> æ–‡ä»¶è‡³æœ¬åœ°ï¼Œç„¶åé€šè¿‡  <code>SASS_BINARY_PATH</code>ã€<code>SASS_BINARY_DIR</code>ã€ <code>SASS_BINARY_NAME</code> æ¥æŒ‡å®šè¯¥è·¯å¾„ï¼ˆå…·ä½“é…ç½®æ–¹æ³•è¯·çœ‹ï¼š<a href="https://github.com/sass/node-sass#binary-configuration-parameters">Binary configuration parameters</a>ï¼‰ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5bf3d319da8cf854.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å°½ç®¡è‡³ä»Š Node Sass è¿˜æœªæ”¯æŒ ARM æ¶æ„ï¼Œä½† ARM Mac åœ¨ä½¿ç”¨ Node 12 æ—¶ï¼Œå¯¹åº”çš„ <code>darwin-x64-72/binding.node</code> æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› æ­¤æˆ‘çŒœä¸‹è½½ <code>darwin-x64-xx_binding.node</code> ä¹Ÿæ˜¯ OK çš„ï¼Œæ²¡äº²æµ‹ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œå°è¯•ã€‚</p>
<h3>ç¤ºä¾‹åˆ†æå››</h3>
<pre><code class="language-shell">$ yarn install                                                                                                                                                                                                                          [9:51:54]
yarn install v1.22.19
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
warning &quot; &gt; slick-carousel@1.8.1&quot; has unmet peer dependency &quot;jquery@&gt;=1.8.0&quot;.
warning &quot;react-dev-utils &gt; fork-ts-checker-webpack-plugin@6.5.0&quot; has unmet peer dependency &quot;typescript@&gt;= 2.7&quot;.
[4/4] ğŸ”¨  Building fresh packages...
[6/6] â  node-sass
[-/6] â  waiting...
[-/6] â  waiting...
[-/6] â  waiting...
error /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass: Command failed.
Exit code: 1
Command: node scripts/build.js
Arguments: 
Directory: /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass
Output:
Building: /Users/frankie/.nvm/versions/node/v18.16.0/bin/node /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/bin/node-gyp.js rebuild --verbose --libsass_ext= --libsass_cflags= --libsass_ldflags= --libsass_library=
gyp info it worked if it ends with ok
gyp verb cli [
gyp verb cli   '/Users/frankie/.nvm/versions/node/v18.16.0/bin/node',
gyp verb cli   '/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/bin/node-gyp.js',
gyp verb cli   'rebuild',
gyp verb cli   '--verbose',
gyp verb cli   '--libsass_ext=',
gyp verb cli   '--libsass_cflags=',
gyp verb cli   '--libsass_ldflags=',
gyp verb cli   '--libsass_library='
gyp verb cli ]
gyp info using node-gyp@8.4.1
gyp info using node@18.16.0 | darwin | arm64
gyp verb command rebuild []
gyp verb command clean []
gyp verb clean removing &quot;build&quot; directory
gyp verb command configure []
gyp verb find Python checking Python explicitly set from command line or npm configuration
gyp verb find Python - &quot;--python=&quot; or &quot;npm config get python&quot; is &quot;/Users/frankie/.pyenv/shims/python&quot;
gyp verb find Python - executing &quot;/Users/frankie/.pyenv/shims/python&quot; to get executable path
gyp verb find Python - executable path is &quot;/Users/frankie/.pyenv/versions/2.7.18/bin/python&quot;
gyp verb find Python - executing &quot;/Users/frankie/.pyenv/versions/2.7.18/bin/python&quot; to get version
gyp verb find Python - version is &quot;2.7.18&quot;
gyp verb find Python - version is 2.7.18 - should be &gt;=3.6.0
gyp verb find Python - THIS VERSION OF PYTHON IS NOT SUPPORTED
gyp verb find Python Python is not set from environment variable PYTHON
gyp verb find Python checking if &quot;python3&quot; can be used
gyp verb find Python - executing &quot;python3&quot; to get executable path
gyp verb find Python - executable path is &quot;/opt/homebrew/opt/python@3.12/bin/python3.12&quot;
gyp verb find Python - executing &quot;/opt/homebrew/opt/python@3.12/bin/python3.12&quot; to get version
gyp verb find Python - version is &quot;3.12.3&quot;
gyp info find Python using Python version 3.12.3 found at &quot;/opt/homebrew/opt/python@3.12/bin/python3.12&quot;
gyp verb get node dir no --target version specified, falling back to host node version: 18.16.0
gyp verb command install [ '18.16.0' ]
gyp verb install input version string &quot;18.16.0&quot;
gyp verb install installing version: 18.16.0
gyp verb install --ensure was passed, so won't reinstall if already installed
gyp verb install version is already installed, need to check &quot;installVersion&quot;
gyp verb got &quot;installVersion&quot; 11
gyp verb needs &quot;installVersion&quot; 9
gyp verb install version is good
gyp verb get node dir target node version installed: 18.16.0
gyp verb build dir attempting to create &quot;build&quot; dir: /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass/build
gyp verb build dir &quot;build&quot; dir needed to be created? Yes
gyp verb build/config.gypi creating config file
gyp verb build/config.gypi writing out config file: /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass/build/config.gypi
gyp verb config.gypi checking for gypi file: /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass/config.gypi
gyp verb common.gypi checking for gypi file: /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass/common.gypi
gyp verb gyp gyp format was not specified; forcing &quot;make&quot;
gyp info spawn /opt/homebrew/opt/python@3.12/bin/python3.12
gyp info spawn args [
gyp info spawn args   '/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/Library/Caches/node-gyp/18.16.0/include/node/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/Users/frankie/Library/Caches/node-gyp/18.16.0',
gyp info spawn args   '-Dnode_gyp_dir=/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp',
gyp info spawn args   '-Dnode_lib_file=/Users/frankie/Library/Caches/node-gyp/18.16.0/&lt;(target_arch)/node.lib',
gyp info spawn args   '-Dmodule_root_dir=/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass',
gyp info spawn args   '-Dnode_engine=v8',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.'
gyp info spawn args ]
Traceback (most recent call last):
  File &quot;/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/gyp/gyp_main.py&quot;, line 42, in &lt;module&gt;
    import gyp  # noqa: E402
    ^^^^^^^^^^
  File &quot;/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/gyp/pylib/gyp/__init__.py&quot;, line 9, in &lt;module&gt;
    import gyp.input
  File &quot;/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/gyp/pylib/gyp/input.py&quot;, line 19, in &lt;module&gt;
    from distutils.version import StrictVersion
ModuleNotFoundError: No module named 'distutils'
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/lib/configure.js:259:16)
gyp ERR! stack     at ChildProcess.emit (node:events:513:28)
gyp ERR! stack     at ChildProcess._handle.onexit (node:internal/child_process:291:12)
gyp ERR! System Darwin 23.5.0
gyp ERR! command &quot;/Users/frankie/.nvm/versions/node/v18.16.0/bin/node&quot; &quot;/Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-gyp/bin/node-gyp.js&quot; &quot;rebuild&quot; &quot;--verbose&quot; &quot;--libsass_ext=&quot; &quot;--libsass_cflags=&quot; &quot;--libsass_ldflags=&quot; &quot;--libsass_library=&quot;
gyp ERR! cwd /Users/frankie/Web/ifanr/puydufou/pc/node_modules/node-sass
gyp ERR! node -v v18.16.0
</code></pre>
<p>æŠ¥é”™åŸå› æ˜¯æ‰¾ä¸åˆ° <code>distutils</code> æ¨¡å—ï¼š</p>
<pre><code class="language-shell">ModuleNotFoundError: No module named 'distutils'
</code></pre>
<p>ä»ä»¥ä¸‹å¯çŸ¥ï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/whatsnew/3.10.html#distutils-deprecated">Whatâ€™s New In Python 3.10</a></li>
<li><a href="https://docs.python.org/3.12/whatsnew/3.12.html#distutils">Whatâ€™s New In Python 3.12</a></li>
</ul>
<p><code>distutils</code> åœ¨ Python 3.10 è¢«åºŸå¼ƒï¼Œäº Python 3.12 æ­£å¼ç§»é™¤ã€‚</p>
<p>æˆ‘è¿™é‡Œåˆšå¥½æ˜¯ 3.12 ç‰ˆæœ¬ï¼Œä¸€æ˜¯é€šè¿‡ pyenv åˆ‡æ¢æ›´ä½ç‰ˆæœ¬ Pythonï¼ŒäºŒæ˜¯å®‰è£… <code>python-setuptools</code> æ¥è§£å†³ã€‚</p>
<pre><code class="language-shell">$ brew install python-setuptools
</code></pre>
<p>Related Link:</p>
<ul>
<li><a href="https://github.com/nodejs/node-gyp/issues/2869">distutils is removed in Python 3.12 #2869</a></li>
<li><a href="https://stackoverflow.com/a/76691103/14569218">no module named distutils....but distutils installed?</a></li>
</ul>
<!--

## 2025.06.24

```shell
â†’ â—â— ifanr-wxlayout-editor $ yarn install                                                                                                                                                   [10:12:32]
yarn install v1.22.15
[1/5] ğŸ”  Validating package.json...
[2/5] ğŸ”  Resolving packages...
[3/5] ğŸšš  Fetching packages...
[4/5] ğŸ”—  Linking dependencies...
warning "zent > react-beautiful-dnd > react-motion@0.5.2" has incorrect peer dependency "react@^0.14.9 || ^15.3.0 || ^16.0.0".
warning "zent > react-beautiful-dnd > react-redux@5.1.1" has incorrect peer dependency "react@^0.14.0 || ^15.0.0-0 || ^16.0.0-0".
[5/5] ğŸ”¨  Building fresh packages...
[-/3] â   waiting...
[2/3] â   fsevents
warning Error running install script for optional dependency: "/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents: Command failed.
Exit code: 1
Command: node install
Arguments: 
Directory: /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
Output:
node-pre-gyp info it worked if it ends with ok
node-pre-gyp info using node-pre-gyp@0.12.0
node-pre-gyp info using node@10.24.1 | darwin | x64
node-pre-gyp WARN Using request for node-pre-gyp https download 
node-pre-gyp info check checked for \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64/fse.node\" (not found)
node-pre-gyp http GET https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v64-darwin-x64.tar.gz
node-pre-gyp http 404 https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v64-darwin-x64.tar.gz
node-pre-gyp WARN Tried to download(404): https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v64-darwin-x64.tar.gz 
node-pre-gyp WARN Pre-built binaries not found for fsevents@1.2.9 and node@10.24.1 (node-v64 ABI, unknown) (falling back to source compile with node-gyp) 
node-pre-gyp http 404 status code downloading tarball https://fsevents-binaries.s3-us-west-2.amazonaws.com/v1.2.9/fse-v1.2.9-node-v64-darwin-x64.tar.gz 
gyp info it worked if it ends with ok
gyp info using node-gyp@3.8.0
gyp info using node@10.24.1 | darwin | x64
gyp info ok 
gyp info it worked if it ends with ok
gyp info using node-gyp@3.8.0
gyp info using node@10.24.1 | darwin | x64
gyp http GET https://nodejs.org/download/release/v10.24.1/node-v10.24.1-headers.tar.gz
gyp http 200 https://nodejs.org/download/release/v10.24.1/node-v10.24.1-headers.tar.gz
gyp http GET https://nodejs.org/download/release/v10.24.1/SHASUMS256.txt
gyp http 200 https://nodejs.org/download/release/v10.24.1/SHASUMS256.txt
gyp info spawn /Users/frankie/.pyenv/shims/python
gyp info spawn args [ '/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/Users/frankie/.node-gyp/10.24.1/include/node/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/Users/frankie/.node-gyp/10.24.1',
gyp info spawn args   '-Dnode_gyp_dir=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp',
gyp info spawn args   '-Dnode_lib_file=/Users/frankie/.node-gyp/10.24.1/<(target_arch)/node.lib',
gyp info spawn args   '-Dmodule_root_dir=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents',
gyp info spawn args   '-Dnode_engine=v8',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
ERROR:root:code for hash md5 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type md5
ERROR:root:code for hash sha1 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type sha1
ERROR:root:code for hash sha224 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type sha224
ERROR:root:code for hash sha256 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type sha256
ERROR:root:code for hash sha384 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type sha384
ERROR:root:code for hash sha512 was not found.
Traceback (most recent call last):
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 147, in <module>
    globals()[__func_name] = __get_hash(__func_name)
  File \"/Users/frankie/.pyenv/versions/2.7.18/lib/python2.7/hashlib.py\", line 97, in __get_builtin_constructor
    raise ValueError('unsupported hash type ' + name)
ValueError: unsupported hash type sha512
Traceback (most recent call last):
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/gyp_main.py\", line 16, in <module>
    sys.exit(gyp.script_main())
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 545, in script_main
    return main(sys.argv[1:])
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 538, in main
    return gyp_main(args)
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 514, in gyp_main
    options.duplicate_basename_check)
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 98, in Load
    generator.CalculateVariables(default_variables, params)
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/generator/make.py\", line 79, in CalculateVariables
    import gyp.generator.xcode as xcode_generator
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/generator/xcode.py\", line 7, in <module>
    import gyp.xcodeproj_file
  File \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/gyp/pylib/gyp/xcodeproj_file.py\", line 152, in <module>
    _new_sha1 = hashlib.sha1
AttributeError: 'module' object has no attribute 'sha1'
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/lib/configure.js:345:16)
gyp ERR! stack     at ChildProcess.emit (events.js:198:13)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:248:12)
gyp ERR! System Darwin 24.5.0
gyp ERR! command \"/Users/frankie/.nvm/versions/node/v10.24.1/bin/node\" \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js\" \"configure\" \"--fallback-to-build\" \"--module=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64/fse.node\" \"--module_name=fse\" \"--module_path=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64\" \"--napi_version=7\" \"--node_abi_napi=napi\" \"--napi_build_version=0\" \"--node_napi_label=node-v64\" \"--python=/Users/frankie/.pyenv/shims/python\"
gyp ERR! cwd /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
gyp ERR! node -v v10.24.1
gyp ERR! node-gyp -v v3.8.0
gyp ERR! not ok 
node-pre-gyp ERR! build error 
node-pre-gyp ERR! stack Error: Failed to execute '/Users/frankie/.nvm/versions/node/v10.24.1/bin/node /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --module=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64/fse.node --module_name=fse --module_path=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64 --napi_version=7 --node_abi_napi=napi --napi_build_version=0 --node_napi_label=node-v64 --python=/Users/frankie/.pyenv/shims/python' (1)
node-pre-gyp ERR! stack     at ChildProcess.<anonymous> (/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/node_modules/node-pre-gyp/lib/util/compile.js:83:29)
node-pre-gyp ERR! stack     at ChildProcess.emit (events.js:198:13)
node-pre-gyp ERR! stack     at maybeClose (internal/child_process.js:982:16)
node-pre-gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:259:5)
node-pre-gyp ERR! System Darwin 24.5.0
node-pre-gyp ERR! command \"/Users/frankie/.nvm/versions/node/v10.24.1/bin/node\" \"/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/node_modules/node-pre-gyp/bin/node-pre-gyp\" \"install\" \"--fallback-to-build\"
node-pre-gyp ERR! cwd /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents
node-pre-gyp ERR! node -v v10.24.1
node-pre-gyp ERR! node-pre-gyp -v v0.12.0
node-pre-gyp ERR! not ok 
Failed to execute '/Users/frankie/.nvm/versions/node/v10.24.1/bin/node /Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --module=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_modules/fsevents/lib/binding/Release/node-v64-darwin-x64/fse.node --module_name=fse --module_path=/Users/frankie/Web/ifanr/ifanr-wxlayout-editor/node_m
âœ¨  Done in 19.45s.
```

## Other

https://www.cnblogs.com/yyh1/p/15954139.html
ä¸‹è¾¹æˆ‘ä»¬æ¥ä¸“é—¨è¯´ä¸€ä¸‹ sassã€dart-sass å’Œ node-sassï¼š

* sass æ˜¯ç”± tsè°ƒç”¨ dart-sasså®ç°çš„å·¥å…·ç±»ï¼Œæ¥ç¼–è¯‘ sassï¼ˆä»¥å‰æ˜¯ç”±å•çº¯çš„ tså®ç°çš„ï¼‰
* dart-sass æ˜¯ç”± dart å®ç°çš„,é€šè¿‡ dart vm è¿è¡Œ dart æ˜¯ç¼–è¯‘ sassï¼ˆåœ¨ npm å¯ä»¥çœ‹åˆ°è¯¥åŒ…å·²ä¸è¢«å¼€æ”¾ä¸‹è½½äº†ï¼‰
* node-sass æ˜¯ç”± node è°ƒç”¨ åº•å±‚ c++ å®ç°çš„ libsass æ¥ç¼–è¯‘ sass


https://cloud.tencent.com/developer/article/1843877
https://github.com/sass/node-sass/releases/tag/v4.13.0
node-sass@4.13.0 ç‰ˆæœ¬çœŸçš„ä¸æ”¯æŒ node@14

https://www.npmjs.com/package/dart-sass
This package has been renamed to 'sass'.

https://juejin.cn/post/7052193042752602148
ç»§å¾€å¼€æ¥çš„ sass ä¸‰ä»£ç¼–è¯‘å™¨ï¼šruby sassã€node-sassã€dart-sass


https://www.zhihu.com/question/36291768/answer/318429630
è¦ç†è§£node-gypé¦–å…ˆè¦çŸ¥é“ä»€ä¹ˆæ˜¯gyp([https://gyp.gsrc.io/index.md](https://link.zhihu.com/?target=https%3A//gyp.gsrc.io/index.md))ã€‚gypå…¶å®æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆé¡¹ç›®æ–‡ä»¶çš„å·¥å…·ï¼Œä¸€å¼€å§‹æ˜¯è®¾è®¡ç»™chromiumé¡¹ç›®ä½¿ç”¨çš„ï¼Œåæ¥å¤§å®¶å‘ç°æ¯”è¾ƒå¥½ç”¨å°±ç”¨åˆ°äº†å…¶ä»–åœ°æ–¹ã€‚ç”Ÿæˆé¡¹ç›®æ–‡ä»¶åå°±å¯ä»¥è°ƒç”¨GCC, vsbuild, xcodeç­‰ç¼–è¯‘å¹³å°æ¥ç¼–è¯‘ã€‚è‡³äºä¸ºä»€ä¹ˆè¦æœ‰node-gypï¼Œæ˜¯ç”±äºnodeç¨‹åºä¸­éœ€è¦è°ƒç”¨ä¸€äº›å…¶ä»–è¯­è¨€ç¼–å†™çš„å·¥å…·ç”šè‡³æ˜¯dllï¼Œéœ€è¦å…ˆç¼–è¯‘ä¸€ä¸‹ï¼Œå¦åˆ™å°±ä¼šæœ‰è·¨å¹³å°çš„é—®é¢˜ï¼Œä¾‹å¦‚åœ¨windowsä¸Šè¿è¡Œçš„è½¯ä»¶copyåˆ°macä¸Šå°±ä¸èƒ½ç”¨äº†ï¼Œä½†æ˜¯å¦‚æœæºç æ”¯æŒï¼Œç¼–è¯‘ä¸€ä¸‹ï¼Œåœ¨macä¸Šè¿˜æ˜¯å¯ä»¥ç”¨çš„ã€‚


-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[unable to verify the first certificate åŸå› åŠè§£å†³æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/97</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/97</guid>
            <pubDate>Sat, 25 Feb 2023 12:31:12 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1fb9aded8aa21880.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1fb9aded8aa21880.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h3>èƒŒæ™¯</h3>
<p>æ­¤å‰ï¼Œåœ¨é¡¹ç›®ä¸­å®‰è£…ä¾èµ–æ—¶ï¼Œé‡åˆ°äº†å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<pre><code class="language-shell">yarn install v1.22.19
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
error An unexpected error occurred: &quot;https://r2.cnpmjs.org/form-data/-/form-data-3.0.1.tgz: unable to verify the first certificate&quot;.
info If you think this is a bug, please open a bug report with the information provided in &quot;/Users/frankie/Web/ifanr/yuegonghui/activity-collection/yarn-error.log&quot;.
info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.
</code></pre>
<p><code>yarn-error.log</code> å¦‚ä¸‹</p>
<pre><code>Arguments: 
  /Users/frankie/Library/Application Support/fnm/node-versions/v16.15.0/installation/bin/node /usr/local/bin/yarn

PATH: 
  /Users/frankie/Library/Caches/fnm_multishells/57063_1669556334889/bin:/Users/frankie/.yarn/bin:/usr/local/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/frankie/Library/Caches/fnm_multishells/57063_1669556334889/bin:/Users/frankie/.yarn/bin:/usr/local/sbin:/opt/homebrew/bin:/opt/homebrew/bin

Yarn version: 
  1.22.19

Node version: 
  16.15.0

Platform: 
  darwin arm64

Trace: 
  Error: unable to verify the first certificate
      at TLSSocket.onConnectSecure (node:_tls_wrap:1532:34)
      at TLSSocket.emit (node:events:527:28)
      at TLSSocket._finishInit (node:_tls_wrap:946:8)
      at TLSWrap.ssl.onhandshakedone (node:_tls_wrap:727:12)

npm manifest:
  ...

yarn manifest: 
  No manifest

Lockfile:
  ...
</code></pre>
<p>æŠ¥é”™ä¿¡æ¯ä¸ºï¼š<code>unable to verify the first certificate</code>ï¼Œä¸è¯ä¹¦æœ‰å…³ã€‚ç”±äº <code>yarn install</code> æˆ– <code>npm install</code> èµ°çš„æ˜¯ HTTPS åè®®ï¼Œå®ƒçš„å®‰å…¨é€šè¿‡æ•°å­—è¯ä¹¦æ¥ä¿éšœã€‚æ•°å­—è¯ä¹¦ç”±ä¸“é—¨æœºæ„é¢å‘ï¼Œé€šå¸¸æ˜¯ä»˜è´¹çš„ã€‚è‡ªç­¾è¯ä¹¦ï¼Œå°±æ˜¯è‡ªå·±æ‰®æ¼”æ•°å­—è¯ä¹¦æœºæ„ç»™è‡ªå·±é¢å‘çš„è¯ä¹¦ã€‚</p>
<blockquote>
<p>ç”±äºè‡ª 2014 å¹´ 2 æœˆ 27 æ—¥èµ·ï¼Œnpm ä¸å†æ”¯æŒã€Œè‡ªç­¾è¯ä¹¦ Self-Signed Certificateã€ã€‚ğŸ‘‰ <a href="https://blog.npmjs.org/post/78085451721/npms-self-signed-certificate-is-no-more">npm Blog</a></p>
</blockquote>
<p>åŠ ä¸Šï¼Œä¹Ÿå°±æ˜¯ <code>https://r2.cnpmjs.org/form-data/-/form-data-3.0.1.tgz</code> æ‰€åœ¨åŸŸåçš„è¯ä¹¦æ˜¯ä¸è¢«ä¿¡ä»»çš„ã€‚è¿™ç‚¹é€šè¿‡ Firefox æµè§ˆå™¨å°±èƒ½å‘ç°ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677328363725.png" alt=""></p>
<p>å…¶ä¸­ npm ä¸è¯ä¹¦ç›¸å…³çš„é…ç½®æœ‰ä¸¤é¡¹</p>
<ul>
<li><a href="https://docs.npmjs.com/cli/v9/using-npm/config#ca">ca</a> - ç”¨äºæŒ‡å®šä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate Authorityï¼‰ã€‚é»˜è®¤ä¸º <code>null</code>ï¼Œè¡¨ç¤ºä»…å…è®¸ã€Œå·²çŸ¥ä¸”å¯ä¿¡çš„ã€è¯ä¹¦é¢å‘æœºæ„æ‰€é¢å‘çš„è¯ä¹¦ã€‚</li>
<li><a href="https://docs.npmjs.com/cli/v9/using-npm/config#strict-ssl">strict-ssl</a> - é€šè¿‡ https å‘æ³¨å†Œè¡¨å‘å‡ºè¯·æ±‚æ—¶æ˜¯å¦è¿›è¡Œ SSL å¯†é’¥éªŒè¯ï¼Œè‹¥æ ¡éªŒå¤±è´¥ï¼Œnpm å°†æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨å¹¶æŠ¥é”™ã€‚é»˜è®¤ä¸º <code>true</code>ã€‚</li>
</ul>
<h3>è§£å†³æ–¹æ³•</h3>
<h4>æ–¹æ³•ä¸€</h4>
<p>åœ¨ç¡®å®šã€Œå®‰å…¨ã€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸´æ—¶å…³é—­ <code>strict-ssl</code> é€‰é¡¹ï¼š</p>
<pre><code class="language-shell">$ yarn config set strict-ssl false
$ npm config set strict-ssl false
</code></pre>
<blockquote>
<p>å½“ <code>strict-ssl</code> è®¾ç½®ä¸º <code>false</code> æ—¶ï¼Œnpm å°†ä¸ä¼šå¯¹æœåŠ¡å™¨çš„ SSL è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¸”å³ä½¿è¯ä¹¦æ˜¯ç”±ä¸å¯ä¿¡çš„è®¤è¯æœºæ„é¢å‘çš„ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› ä¸ºä½ çš„ç½‘ç»œæµé‡å¯èƒ½è¢«åŠ«æŒæˆ–ç¯¡æ”¹ï¼Œè€Œä½ å¹¶ä¸ä¼šæ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚å› æ­¤ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ <code>strict-ssl</code> è®¾ç½®ä¸º <code>false</code>ã€‚</p>
<p>å¦‚æœä½ ç¡®å®éœ€è¦ä½¿ç”¨ <code>strict-ssl</code> è®¾ç½®ä¸º <code>false</code>ï¼Œä¾‹å¦‚ä½ æ‰€è¿æ¥çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯è‡ªç­¾åçš„ SSL è¯ä¹¦ï¼Œåº”è¯¥åªåœ¨çŸ­æ—¶é—´å†…ä½¿ç”¨ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåå°½å¿«å°† <code>strict-ssl</code> è®¾ç½®å› <code>true</code>ã€‚</p>
</blockquote>
<!--

strict-ssl é€‰é¡¹æ˜¯ npm ä¸­ç”¨äºæ§åˆ¶ SSL è¯ä¹¦æ ¡éªŒçš„é€‰é¡¹ã€‚å½“ strict-ssl è®¾ç½®ä¸º true æ—¶ï¼Œnpm ä¼šå¯¹è¿æ¥çš„æœåŠ¡å™¨çš„ SSL è¯ä¹¦è¿›è¡Œä¸¥æ ¼çš„æ ¡éªŒï¼Œå¹¶è¦æ±‚å®ƒæ˜¯ç”±å¯ä¿¡çš„è®¤è¯æœºæ„é¢å‘çš„ã€‚å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œnpm å°†æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä¼šæŠ¥é”™ã€‚

å½“ strict-ssl è®¾ç½®ä¸º false æ—¶ï¼Œnpm å°†ä¸ä¼šå¯¹æœåŠ¡å™¨çš„ SSL è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¸”å³ä½¿è¯ä¹¦æ˜¯ç”±ä¸å¯ä¿¡çš„è®¤è¯æœºæ„é¢å‘çš„ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› ä¸ºä½ çš„ç½‘ç»œæµé‡å¯èƒ½è¢«åŠ«æŒæˆ–ç¯¡æ”¹ï¼Œè€Œä½ å¹¶ä¸ä¼šæ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚å› æ­¤ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ strict-ssl è®¾ç½®ä¸º falseã€‚

å¦‚æœä½ ç¡®å®éœ€è¦ä½¿ç”¨ strict-ssl è®¾ç½®ä¸º falseï¼Œä¾‹å¦‚ä½ æ‰€è¿æ¥çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯è‡ªç­¾åçš„ SSL è¯ä¹¦ï¼Œåº”è¯¥åªåœ¨çŸ­æ—¶é—´å†…ä½¿ç”¨ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåå°½å¿«å°† strict-ssl è®¾ç½®å› trueã€‚

-->
<h4>æ–¹æ³•äºŒï¼ˆæ¨èï¼‰</h4>
<p>æ‰¾å‡ºæ‰€æœ‰ç›¸å…³çš„ npm åŒ…ï¼Œå¹¶é€‰æ‹©å¯ä¿¡çš„é•œåƒæºåé‡è£…ã€‚</p>
<p>å¦‚æœä½ å¤„äºå…·æœ‰æ‹¦æˆª HTTPS ä»£ç†çš„ç¯å¢ƒä¸­ï¼Œå®ƒå¯èƒ½ä¼šç ´å npmï¼Œä¸è¿ç»´äººå‘˜è”ç³»è§£å†³ã€‚</p>
<p>The end.</p>
<!--

* [yarn æŠ¥é”™unable to verify the first certificate](https://blog.csdn.net/lzj2504476514/article/details/119295583)
* [è§£å†³Error: unable to verify the first certificateæŠ¥é”™](https://blog.csdn.net/qq_39403545/article/details/87968957)
* [npm's Self-Signed Certificate is No More](https://blog.npmjs.org/post/78085451721/npms-self-signed-certificate-is-no-more)
* [some people with older versions of npm are getting SELF_SIGNED_CERT_IN_CHAIN errors. but the fix is easy!](https://twitter.com/npmjs/status/439279809307242496)
* [npm install å‡ºé”™ï¼Œå·²ç»æ‰¾åˆ°åŸå› äº†ï¼Œä½†ä¸å¤ªç†è§£ã€‚ã€‚](https://cnodejs.org/topic/536ee57b96bee36f0605895c)
* [node package manager install error with Express](https://stackoverflow.com/a/16534065/14569218)

-->
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å†è§ nvmï¼Œæ”¹ç”¨ fnm äº†]]></title>
            <link>https://github.com/toFrankie/blog/issues/96</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/96</guid>
            <pubDate>Sat, 25 Feb 2023 12:30:01 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2ca3cf66e3e7e498.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2ca3cf66e3e7e498.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç¤¾åŒºä¸Šç”¨äºç®¡ç† Node ç‰ˆæœ¬çš„å·¥å…·å¾ˆå¤šï¼Œè¾ƒä¸ºæµè¡Œçš„æœ‰ï¼š</p>
<blockquote>
<ul>
<li>éè·¨å¹³å°ï¼š<a href="https://github.com/nvm-sh/nvm">nvm</a>ã€<a href="https://github.com/tj/n">n</a></li>
<li>è·¨å¹³å°ï¼š<a href="https://github.com/jasongin/nvs">nvs</a>ã€<a href="https://github.com/Schniz/fnm">fnm</a></li>
</ul>
</blockquote>
<p><strong>ä¸ªäººå¼ƒç”¨ nvm ä¸æ˜¯å› ä¸ºå®ƒä¸è·¨å¹³å°ï¼Œè€Œæ˜¯å¯åŠ¨ Shell è¿›ç¨‹å¤ªè€—æ—¶äº†...</strong> åŠ ä¹‹å®ƒæœ¬èº«é—®é¢˜æŒºå¤šçš„ï¼Œè¯¦è§ï¼š<a href="https://github.com/nvm-sh/nvm#important-notes">Important Notes</a>ã€‚</p>
<p>å¯¹æˆ‘æœ€ç›´æ¥çš„å½±å“æ˜¯ï¼šæ­¤å‰é‚£ä¸ª 8G è¿å­˜çš„ MacBook Pro æ‰“å¼€ VS Code çš„æ—¶å€™ï¼Œæ€»ä¼šå› ä¸º Shell è§£æå¤ªä¹…å¯¼è‡´ VS Code ç»ˆæ­¢è§£æï¼Œæœ€ç»ˆé€ æˆäº†æŸäº› Pluginsï¼ˆæ¯”å¦‚ Mercurial ç›¸å…³æ’ä»¶ï¼‰æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚æ­¤å‰åæ§½è¿‡äº†ï¼Œå¯ç§»æ­¥æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/47">è§£å†³ Unable to resolve your shell environment in a reasonable time</a>ã€‚</p>
<h2>fnm å®‰è£…ä¸ä½¿ç”¨</h2>
<p><a href="https://github.com/Schniz/fnm">fnm</a>ï¼ˆFast Node Managerï¼‰åŸºäº Rust å¼€å‘ï¼Œæ˜¯ä¸æ˜¯è¿˜æ²¡ç”¨å°±æ„Ÿè§‰åˆ°å®ƒçš„å¿«äº†ï¼Œå“ˆå“ˆ~
åŒæ—¶ï¼Œå®ƒæ˜¯è·¨å¹³å°çš„ï¼Œæ”¯æŒ macOSã€Linuxã€Windowsã€‚</p>
<blockquote>
<p>ğŸš€ Fast and simple Node.js version manager, built in Rust.</p>
</blockquote>
<p><strong>1. å®‰è£… fnmï¼ˆä»¥ macOS ä¸ºä¾‹ï¼‰</strong></p>
<pre><code class="language-shell">$ brew install fnm
</code></pre>
<p><strong>2. é…ç½® fnm æ‰€éœ€çš„ç¯å¢ƒå˜é‡åˆ° bash æˆ– zsh é…ç½®æ–‡ä»¶ä¸­ï¼Œä»¥ zsh ä¸ºä¾‹ï¼š</strong></p>
<pre><code class="language-shell">$ fnm env --use-on-cd &gt;&gt; ~/.zshrc
</code></pre>
<p>äº¦å¯æ‰§è¡Œ <code>fnm env --use-on-cd</code>ï¼Œå°†è¾“å‡ºå†…å®¹æ‰‹åŠ¨æ·»åŠ è‡³ <code>.bash_profile</code> æˆ– <code>.zshrc</code> é‡Œã€‚</p>
<p><strong>3. ç”¨ fnm å®‰è£… Node</strong></p>
<pre><code class="language-shell"># å®‰è£… LTS ç‰ˆæœ¬
$ fnm install --lts

# å®‰è£…æŒ‡å®šå¤§ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆæœ¬
$ fnm install 18

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
$ fnm install 18.21.1
</code></pre>
<p>ç›¸ååœ°ï¼Œå¯é€šè¿‡ <code>fnm uninstall &lt;version&gt;</code> æˆ– <code>fnm uninstall &lt;alias-name&gt;</code> æ¥åˆ é™¤æŒ‡å®šç‰ˆæœ¬ï¼Œåè€…ä¼šåŒæ—¶ç§»é™¤åˆ«åã€‚</p>
<p><strong>4. é€šè¿‡ fnm æ¥æŒ‡å®š Node ç‰ˆæœ¬</strong></p>
<pre><code class="language-shell"># ä½¿ç”¨ç³»ç»Ÿç‰ˆæœ¬
$ fnm use system

# ä½¿ç”¨ fnm æ‰€å®‰è£…ï¼Œä¸”ç‰ˆæœ¬å·ä¸º 18.21.1 çš„ Node ç¨‹åº
$ fnm use 18.21.1

# ä½¿ç”¨ fnm æ‰€å®‰è£…ï¼Œä¸”ä¸»ç‰ˆæœ¬å·ä¸º 18 çš„æœ€æ–°ç‰ˆæœ¬çš„ Node ç¨‹åº
$ fnm use 18
</code></pre>
<p>åªè¦ç”¨ <code>fnm use &lt;version&gt;</code> æŒ‡å®šåï¼Œæ¯æ¬¡å¯åŠ¨ Shell å°†ä¼šé»˜è®¤ä½¿ç”¨å¯¹åº”çš„ Node ç‰ˆæœ¬ã€‚</p>
<p><strong>5. è®¾ç½®åˆ«å</strong></p>
<pre><code class="language-shell"># å½¢å¼å¦‚ï¼šfnm alias &lt;æŒ‡å®šç‰ˆæœ¬å·&gt; &lt;åˆ«å&gt;
$ fnm alias 18.21.1 v18

# è®¾ç½®åˆ«ååï¼Œå¯ä»¥ç®€åŒ–æŒ‡ä»¤ä¸ºï¼š
$ fnm use v18
</code></pre>
<p><strong>å…¶å®ä»¥ä¸Šç¤ºä¾‹çš„åˆ«åæ„ä¹‰ä¸å¤§ï¼Œä»…ç”¨äºä¸¾ä¾‹è€Œå·²</strong>ã€‚åŸå› æ˜¯ï¼šåœ¨ã€Œä¸è®¾ç½®åˆ«åã€çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>fnm use 18</code>ï¼Œä¹Ÿèƒ½åˆ‡æ¢è‡³ <code>18.21.1</code>ã€‚ä½¿ç”¨ <code>fnm use &lt;major&gt;</code> ä¼šåˆ‡æ¢è‡³å¯¹åº”ä¸»ç‰ˆæœ¬å·å¯¹åº”çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬å®‰è£…äº† <code>18.20.0</code> å’Œ <code>18.21.1</code> ä¸¤ä¸ªä¸»ç‰ˆæœ¬å·ç›¸åŒçš„ Node ç¨‹åºï¼Œä½¿ç”¨ <code>fnm use 18</code> åªä¼šåˆ‡æ¢è‡³ <code>18.21.1</code>ï¼ˆå³æœ€æ–°çš„ç‰ˆæœ¬ï¼‰ï¼Œå°½ç®¡é€šè¿‡ <code>fnm alias 18.20.0 18</code> å°† <code>18.20.0</code> çš„åˆ«åè®¾ä¸º <code>18</code>ï¼Œè¿™æ ·è®¾ç½®åˆ«åæ˜¯æ— æ„ä¹‰çš„ã€‚
æ­¤æ—¶å¯èƒ½éœ€è¦ç”¨ <code>fnm use 18.20</code> æˆ– <code>fnm use 18.20.0</code> æ¥åˆ‡æ¢æŒ‡å®šç‰ˆæœ¬äº†ï¼Œæˆ–è€…å…¶ä»–éçº¯æ•°å­—çš„åˆ«åäº†ã€‚</p>
</blockquote>
<p>è¾ƒæœ‰æ„ä¹‰çš„ç‰¹æ®Šåˆ«å <code>system</code> å’Œ <code>default</code>ï¼š</p>
<ul>
<li>å‰è€…æ˜¯ä»¥ <code>.pkg</code> ç­‰å½¢å¼ï¼ˆæ¯”å¦‚å®˜ç½‘ä¸‹è½½çš„å®‰è£…åŒ…ï¼‰æ‰€å®‰è£…çš„ Node åº”ç”¨ç¨‹åºï¼Œç§°ä¸ºç³»ç»Ÿç‰ˆæœ¬ã€‚</li>
<li>åè€…æ˜¯ç”¨äºæŒ‡å®š <code>fnm</code> çš„ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬ï¼Œä½œä¸ºä¸ <code>18</code> æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å…¶è¯­ä¹‰è¡¨ç¤ºé»˜è®¤ç½¢äº†ã€‚</li>
</ul>
<pre><code class="language-shell"># æŒ‡å®šé»˜è®¤ç‰ˆæœ¬
$ fnm default 18.21.1

# ç›¸å½“äº
$ fnm alias 18.21.1 default
</code></pre>
<p>ç›¸ååœ°ï¼Œå¯é€šè¿‡ <code>fnm unalias &lt;alias-name&gt;</code> æ¥å–æ¶ˆåˆ«åã€‚</p>
<p><strong>6. é¡¹ç›®ä¸­æŒ‡å®šç‰¹å®šç‰ˆæœ¬</strong></p>
<p>å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ  <code>.node-version</code> æˆ– <code>.nvmrc</code> æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®šç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ echo '18' &gt; .node-version
</code></pre>
<p>å‰ææ˜¯ï¼Œé…ç½® fnm ç¯å¢ƒç”¨çš„æ˜¯ <code>fnm env --use-on-cd</code> å‘½ä»¤ï¼Œè€Œä¸æ˜¯ <code>fnm env</code>ã€‚åè€…æ²¡æœ‰æ·»åŠ  Hookï¼Œå› æ­¤ä¸ä¼šæ˜¯æ£€æŸ¥å¯¹åº”é…ç½®æ–‡ä»¶ã€‚æœ‰å…´è¶£çš„å¯ä»¥å¯¹æ¯”ä¸¤æ¡å‘½ä»¤çš„å·®åˆ«å°±æ˜ç™½äº†ã€‚</p>
<p>ç”±äºå›¢é˜Ÿæˆå‘˜æ‰€å®‰è£…çš„ Nodeï¼Œå…¶æ¬¡ç‰ˆæœ¬æˆ–è¡¥ä¸ç‰ˆæœ¬å·å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤ï¼Œå¤šæ•°æƒ…å†µä¸‹æŒ‡å®šä¸»ç‰ˆæœ¬å·å³å¯ï¼Œæ— éœ€æŒ‡å®šåˆ° <code>18.21.1</code> ç­‰æ›´å…·ä½“çš„ç‰ˆæœ¬å·ï¼ˆç‰¹æ®Šåœºæ™¯é™¤å¤–ï¼‰ã€‚</p>
<p><strong>7. å¸è½½ fnm</strong></p>
<p>è‹¥æ˜¯é€šè¿‡ <code>brew</code> å®‰è£…çš„ <code>fnm</code>ï¼Œåˆ™ï¼š</p>
<pre><code class="language-shell">$ brew uninstall fnm
</code></pre>
<p>æ¥ç€ï¼Œå†ç§»é™¤ <code>~/.fnm</code> ç›®å½•ã€‚</p>
<pre><code class="language-shell">$ rm -rf ~/.fnm
</code></pre>
<p>æœ€åï¼Œç§»é™¤ <code>bash</code> æˆ– <code>zsh</code> çš„é…ç½®æ–‡ä»¶ä¸­ä¸ <code>fnm</code> ç›¸å…³çš„é…ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">export PATH=&quot;/Users/frankie/Library/Caches/fnm_multishells/49559_1670052262156/bin&quot;:$PATH
export FNM_VERSION_FILE_STRATEGY=&quot;local&quot;
export FNM_DIR=&quot;/Users/frankie/Library/Application Support/fnm&quot;
export FNM_NODE_DIST_MIRROR=&quot;https://nodejs.org/dist&quot;
export FNM_MULTISHELL_PATH=&quot;/Users/frankie/Library/Caches/fnm_multishells/49559_1670052262156&quot;
export FNM_ARCH=&quot;x64&quot;
export FNM_LOGLEVEL=&quot;info&quot;
autoload -U add-zsh-hook
_fnm_autoload_hook() {
  if [[ -f .node-version || -f .nvmrc ]]; then
    fnm use --silent-if-unchanged
  fi
}

add-zsh-hook chpwd _fnm_autoload_hook &amp;&amp;
  _fnm_autoload_hook

rehash
</code></pre>
<h2>ç§»é™¤ nvm</h2>
<p>åœ¨ç§»é™¤ä¹‹å‰ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ä½¿ç”¨ <code>nvm</code> æ‰€å®‰è£…çš„å…¨å±€åŒ…ï¼Œç„¶ååˆ‡æ¢åˆ° <code>fnm</code> å®‰è£…ä¸€ä¸‹ï¼ˆæœ‰éœ€è¦çš„è¯ï¼‰ï¼š</p>
<pre><code class="language-shell">$ nvm use 16
Now using node v16.14.0 (npm v8.3.1)

$ npm list -g
/Users/frankie/.nvm/versions/node/v16.14.0/lib
â”œâ”€â”€ corepack@0.10.0
â”œâ”€â”€ npm@8.3.1
â”œâ”€â”€ pnpm@7.5.0
â”œâ”€â”€ simple-shell@
â””â”€â”€ zx@7.0.7
</code></pre>
<p>ç§»é™¤ <code>nvm</code> çš„å®‰è£…ç›®å½•ï¼Œé€šå¸¸æ˜¯ <code>~/.nvm</code>ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p>
<pre><code class="language-shell">$ rm -rf &quot;$NVM_DIR&quot;
</code></pre>
<p>ç§»é™¤ <code>bash</code> æˆ– <code>zsh</code> çš„é…ç½®æ–‡ä»¶ä¸­ä¸ <code>nvm</code> ç›¸å…³çš„é…ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">export NVM_DIR=&quot;$HOME/.nvm&quot;
[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot; --no-use          # This loads nvm
[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot; # This loads nvm bash_completion
</code></pre>
<p>å…¶ä»–ç³»ç»Ÿå¯çœ‹ <a href="https://github.com/nvm-sh/nvm#uninstalling--removal">Uninstalling / Removal</a>ã€‚</p>
<h2>å…¶ä»–</h2>
<p>ç›¸å…³å†…å®¹æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/587008009">ç”¨é”ˆåŒ–çš„ fnm ç®¡ç† Node.js ç‰ˆæœ¬</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/63403762">ä½¿ç”¨ nvs ç®¡ç†æœ¬åœ° Node.js ç‰ˆæœ¬</a></li>
<li><a href="https://ukn.me/cong-nvm-qian-yi-dao-nvs.html">ä» nvm è¿ç§»åˆ° nvs</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[path.resolve ä¸ path.join çš„åŒºåˆ«è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/95</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/95</guid>
            <pubDate>Sat, 25 Feb 2023 12:29:03 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e77cbd1953783a2a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e77cbd1953783a2a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>ç›¸ä¿¡å¤§å®¶ä¸€å®šç”¨è¿‡ <code>path.resolve()</code> æˆ– <code>path.join()</code>ï¼Œç‰¹åˆ«æ˜¯ Webpackã€Rollupã€Vite ç­‰æ„å»ºå·¥å…·ï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚</p>
<pre><code class="language-js">path.resolve(__dirname, 'src/index.js')
</code></pre>
<p>åƒè¿™ä¸ªä¾‹å­ï¼Œç”¨ <code>path.join(__dirname, 'src/index.js')</code> æ‰€å¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚
é‚£ä¹ˆå®ƒä¿©ç©¶ç«Ÿæœ‰ä½•ä¸åŒï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æ‰èƒ½ä½“ç°å‡ºåŒºåˆ«å‘¢ï¼Ÿ</p>
<h2><a href="https://nodejs.org/api/path.html#pathresolvepaths">path.resolve</a></h2>
<p>è¯¥å‡½æ•°æ¥å—ã€Œé›¶æˆ–å¤šä¸ªã€å­—ç¬¦ä¸²ç±»å‹çš„è·¯å¾„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª normalized çš„ã€Œç»å¯¹è·¯å¾„ã€ã€‚</p>
<pre><code class="language-js">path.resolve(path1, path2, ..., pathN)
</code></pre>
<p>æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>å…¶ä¸­ zero-length çš„å‚æ•°ä¼šè¢«å¿½ç•¥ï¼Œæ¯”å¦‚ <code>''</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰å’Œ <code>'.'</code>ï¼ˆè¡¨ç¤ºå½“å‰ç›®å½•ï¼‰ã€‚</li>
<li>ä»¥ <code>/</code> å¼€å¤´çš„å‚æ•°ä¼šè¢«å½“ä½œæ–‡ä»¶ç³»ç»Ÿæ ¹è·¯å¾„ï¼Œä¸ä»¥ <code>../</code> æˆ– <code>./</code> å¼€å¤´çš„å‚æ•°ä¼šè¢«å½“ä½œæ˜¯ç›®å½•ã€‚</li>
<li>è‹¥å‚æ•°ä¸ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œåˆ™ä¼šæŠ›å‡º TypeErrorã€‚</li>
<li>è‹¥ä¸ä¼ é€’ä»»ä½•å‚æ•°æ—¶ï¼Œè¿”å› Node è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ã€‚å› æ­¤ <code>path.resolve() === process.cwd()</code> ç»“æœä¸º <code>true</code>ã€‚</li>
<li>ç»“æœè¿”å›ä¹‹å‰å…¶å†…éƒ¨ä¹Ÿä¼šåšç±»ä¼¼ <code>path.normalize()</code> çš„è·¯å¾„è§„èŒƒåŒ–å¤„ç†ã€‚</li>
</ul>
</blockquote>
<p>çœ‹ä¾‹å­ï¼š</p>
<pre><code class="language-js">path.resolve('/a', 'b', 'c') // return: &quot;/a/b/c&quot;
path.resolve('/a', '/b', 'c') // return: &quot;/b/c&quot;
path.resolve('/a', '/b', '/c') // return: &quot;/c&quot;
</code></pre>
<p>å…¶å®åœ¨<a href="https://nodejs.org/api/path.html#pathresolvepaths">å®˜ç½‘</a>å°±æè¿°å¾—å¾ˆæ¸…æ™°äº†ã€‚æ— éå°±æ˜¯ï¼Œã€Œ<strong>ä»å³åˆ°å·¦</strong>ã€ä¸€ä¸ªä¸€ä¸ªå‚æ•°å¼€å§‹è§£æï¼Œæ¯è§£æä¸€ä¸ªå°±å°†å…¶åŠ åˆ°åŸæ¥è·¯å¾„çš„ã€Œå‰é¢ã€ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨å¹³å°å¯¹åº”çš„è·¯å¾„åˆ†éš”ç¬¦è¿æ¥ã€‚è‹¥èƒ½æ‹¼æ¥æˆä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå°±åœæ­¢è§£æå¹¶ç«‹å³è¿”å›ã€‚å¦‚æœå°†æ‰€æœ‰å‚æ•°éƒ½è§£æå®Œï¼Œä»ç„¶æ— æ³•æ‹¼å‡‘å¾—å‡ºä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå°±å°†è¿™äº›å‚æ•°çš„ç»“æœæ‹¼åˆ°å½“å‰å·¥ä½œç›®å½•ä¸­ï¼Œä»¥å¾—å‡ºç»å¯¹è·¯å¾„ã€‚</p>
<p>å› æ­¤ï¼Œä¸Šè¿°ç¤ºä¾‹å†…éƒ¨è§£æè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">&quot;c&quot; -&gt; &quot;b/c&quot; -&gt; &quot;/a/b/c&quot;
&quot;c&quot; -&gt; &quot;/b/c&quot;
&quot;/c&quot;
</code></pre>
<p>å‡è®¾æœ‰ <code>path.resolve('a', 'b')</code>ï¼Œå°±æ˜¯ <code>&quot;b&quot; -&gt; &quot;a/b&quot; -&gt; &quot;process.cwd()/a/b&quot;</code> çš„è¿‡ç¨‹ï¼Œç›¸å½“äº <code>path.resolve(process.cwd(), 'a', 'b')</code>ã€‚å…¶ä¸­ <code>proccess.cwd()</code> å°±æ˜¯å½“å‰å·¥ä½œç›®å½•ã€‚</p>
<p><strong>ä¸ªäººè®¤ä¸ºï¼Œæ›´å¥½çš„ç†è§£å€’æ˜¯ã€Œä»å·¦å¾€å³ã€çœ‹ï¼Œå°† <code>path.resolve()</code> æ–¹æ³•çœ‹ä½œ Shell çš„ <code>cd</code> æ“ä½œï¼Œåªæ˜¯å‰è€…ä¸ç®¡æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ­¤ç›®å½•æˆ–æ–‡ä»¶</strong>ã€‚å¦‚ä¼ªä»£ç ï¼š</p>
<pre><code class="language-js">path.resolve('/a', '/b', 'c')

// ç›¸å½“äº
$ cd /a; cd /b; cd c
</code></pre>
<blockquote>
<p>æˆ–è®¸ <code>path.resolve()</code> ç§°ä¸º <code>path.cd()</code> æ›´è®©äººè±ç„¶å¼€æœ—å§ã€‚</p>
</blockquote>
<h2><a href="https://nodejs.org/api/path.html#pathjoinpaths">path.join</a></h2>
<p>è¯¥å‡½æ•°æ¥å—ã€Œé›¶æˆ–å¤šä¸ªã€å­—ç¬¦ä¸²ç±»å‹çš„è·¯å¾„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ‰€æœ‰å‚æ•°æ‹¼æ¥èµ·æ¥çš„ï¼ˆç›¸å¯¹/ç»å¯¹ï¼‰è·¯å¾„ã€‚</p>
<pre><code class="language-js">path.join(path1, path2, ..., pathN)
</code></pre>
<p>æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>å…¶ä¸­ zero-length çš„å‚æ•°ä¼šè¢«å¿½ç•¥ï¼Œæ¯”å¦‚ <code>''</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰å’Œ <code>'.'</code>ï¼ˆè¡¨ç¤ºå½“å‰ç›®å½•ï¼‰ã€‚</li>
<li>ä»¥ <code>../</code> å¼€å¤´çš„å‚æ•°è®¤ä¸ºæ˜¯ä¸Šä¸€çº§ç›®å½•ã€‚</li>
<li>ç¬¬ä¸€ä¸ªå‚æ•°è‹¥ä»¥ <code>/</code> ä¼šè¢«è®¤ä¸ºæ˜¯æ ¹ç›®å½•ï¼Œå…¶ä»–ä»¥ <code>/</code> å¼€å¤´çš„å‚æ•°ä½œç”¨ä¸ <code>./</code> ç›¸åŒã€‚</li>
<li>è‹¥å‚æ•°ä¸ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œåˆ™ä¼šæŠ›å‡º TypeErrorã€‚</li>
<li>è‹¥ä¸ä¼ é€’ä»»ä½•å‚æ•°æ—¶ï¼Œè¿”å› <code>.</code>ï¼ˆå½“å‰ç›®å½•ï¼‰ã€‚</li>
<li>ç»“æœè¿”å›ä¹‹å‰å…¶å†…éƒ¨ä¹Ÿä¼šåšç±»ä¼¼ <code>path.normalize()</code> çš„è·¯å¾„è§„èŒƒåŒ–å¤„ç†ã€‚</li>
</ul>
</blockquote>
<p>çœ‹ä¾‹å­ï¼š</p>
<pre><code class="language-js">path.join('a', 'b', 'c') // return: &quot;a/b/c&quot;
path.join('/a', 'b', 'c') // return: &quot;/a/b/c&quot;
path.join('/a', '/b', 'c') // return: &quot;/a/b/c&quot;
path.join('/a', '/b', '/c') // return: &quot;/a/b/c&quot;
</code></pre>
<p>å…¶å®ä¸ç”¨çœ‹é‚£ä¹ˆå¤šï¼Œæ¢ä¸ªè§’åº¦å»ç†è§£æˆ–è®¸æ›´æ¸…æ™°ï¼Œä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<blockquote>
<ol>
<li>ç”¨ç›¸åŠ è¿ç®—ç¬¦ <code>+</code> å°†æ‰€æœ‰å‚æ•°è¿æ¥èµ·æ¥ï¼ˆå‚æ•°ä¹‹é—´ç”¨ <code>/</code> è¿æ¥ï¼‰ã€‚</li>
<li>ä½¿ç”¨ <code>path.normalize()</code> å¯¹ç›¸åŠ åçš„å­—ç¬¦ä¸²è·¯å¾„ä½œè§„èŒƒåŒ–å¤„ç†ã€‚</li>
</ol>
</blockquote>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼Œ<a href="https://nodejs.org/api/path.html#pathnormalizepath"><code>path.normalize()</code></a> åˆæ˜¯å¹²å˜›çš„å•Šã€‚å¾ˆç®€å•ï¼šæŠŠ <code>./</code>ã€<code>../</code> ç¿»è¯‘æˆå¯¹åº”è·¯å¾„ï¼›æŠŠå¤šä½™æ— ç”¨çš„è·¯å¾„è¿æ¥ç¬¦å¹²æ‰ï¼ˆå¦‚ <code>a//b</code> =&gt; <code>a/b</code>ï¼‰ï¼›å°†è·¯å¾„è¿æ¥ç¬¦è½¬æ¢ä¸ºç‰¹å®šå¹³å°çš„è¿æ¥ç¬¦ï¼ˆæ¯”å¦‚ Unix çš„ <code>/</code>ï¼ŒWindows çš„ <code>\</code>ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œå¯ä»¥æŠŠ <code>path.join('/a', '/b', 'c')</code> ç†è§£æˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">let args = ['/a', '/b', 'c']
let str = args.join('/') // &quot;/a//b/c&quot;
str = path.normalize(str) // &quot;/a/b/c&quot;
</code></pre>
<h2>åŒºåˆ«</h2>
<p>ä»¥å‡ ä¸ªç¤ºä¾‹åšæ€»ç»“ï¼š</p>
<p><strong>æ— å‚æ•°æ—¶</strong></p>
<pre><code class="language-js">path.resolve() // è¿”å›å½“å‰å·¥ä½œç›®å½•ï¼Œç›¸å½“äº `process.cwd()`ï¼Œæ˜¯ç»å¯¹è·¯å¾„ã€‚
path.join() // è¿”å› `.`ï¼ˆå½“å‰ç›®å½•ï¼‰ï¼Œæ˜¯ç›¸å¯¹è·¯å¾„ã€‚
</code></pre>
<p>ğŸ‘† è¯·æ³¨æ„ã€Œå½“å‰å·¥ä½œç›®å½•ã€å’Œã€Œå½“å‰ç›®å½•ã€çš„åŒºåˆ«ã€‚</p>
<p><strong>æœ‰å¤šä¸ªå‚æ•°ï¼Œä¸”ä¸­é—´å‚æ•°ä»¥ <code>/</code> å¼€å¤´</strong></p>
<pre><code class="language-js">path.resolve('/a', '/b', 'c') // è¿”å› `/b/c`ï¼Œç»å¯¹è·¯å¾„ã€‚
path.join('/a', '/b', 'c') // è¿”å› `/a/b/c`ï¼Œç»å¯¹è·¯å¾„ã€‚
</code></pre>
<pre><code class="language-js">path.resolve('a', '/b', 'c') // è¿”å› `/b/c`ï¼Œç»å¯¹è·¯å¾„ã€‚
path.join('a', '/b', 'c') // è¿”å› `a/b/c`ï¼Œç›¸å¯¹è·¯å¾„ã€‚
</code></pre>
<p>ç›¸ä¿¡å¤§å®¶éƒ½æ‡‚äº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ¢³ç† nodeã€npmã€yarn ç›¸å…³è·¯å¾„]]></title>
            <link>https://github.com/toFrankie/blog/issues/94</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/94</guid>
            <pubDate>Sat, 25 Feb 2023 12:27:18 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-336bbbdc70f9903a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-336bbbdc70f9903a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¦‚æœä½ å¯¹ npmã€yarn å…¨å±€å®‰è£…è·¯å¾„å­˜ç–‘ï¼Œå¾ˆæ··ä¹±åˆ†ä¸æ¸…ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« åº”è¯¥èƒ½å¸®åˆ°ä½ ã€‚æœ¬æ–‡ä»¥ macOS ä¸ºä¾‹ï¼Œä¸åŒæ“ä½œç³»ç»Ÿå¯èƒ½ç•¥æœ‰å·®å¼‚ã€‚</p>
<blockquote>
<p>è‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œä¸‹æ–‡å®‰è£…ä¾èµ–å‡æŒ‡ã€Œå…¨å±€å®‰è£…ã€ã€‚</p>
</blockquote>
<h2>ä¸€ã€Node è·¯å¾„</h2>
<p>å…¶å®åœ¨å®‰è£…å®Œ <a href="https://nodejs.org/en/download/">Node</a> ä¹‹åï¼Œä¾¿æœ‰ç±»ä¼¼æç¤ºï¼š</p>
<blockquote>
<p>This package has installed:</p>
<ul>
<li>Node.js v16.15.1 to <code>/usr/local/bin/node</code></li>
<li>npm v8.11.0 to <code>/usr/local/bin/npm</code></li>
</ul>
<p>Make sure that <code>/usr/local/bin</code> is in your <code>$PATH</code>.</p>
</blockquote>
<p>å¯ä»¥å¾—çŸ¥ Node å’Œ NPM çš„é»˜è®¤å®‰è£…è·¯å¾„æ˜¯ <code>/usr/local/bin</code>ã€‚å¦‚æœ <code>/usr/local/bin</code> è·¯å¾„å¹¶ä¸å­˜åœ¨äºç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­ï¼Œéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­å†™å…¥ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ echo 'export PATH=$PATH:/usr/local/bin' &gt;&gt; ~/.zshrc
$ source ~/.zshrc
</code></pre>
<p>å…·ä½“é…ç½®æ–‡ä»¶æ˜¯ <code>~/.bash_profile</code> è¿˜æ˜¯ <code>~/.zshrc</code>ï¼Œå–å†³äºä½ å½“å‰ä½¿ç”¨å“ªä¸€ç§ Shell è§£æå™¨ã€‚</p>
<p>ä½¿ç”¨ <code>which</code> å‘½ä»¤å¯æŸ¥çœ‹ã€Œå¯æ‰§è¡Œæ–‡ä»¶ã€çš„è·¯å¾„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ which node npm
/usr/local/bin/node
/usr/local/bin/npm
</code></pre>
<p>å…¶ä¸­ <code>/usr/local/bin</code> ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶å¤šæ˜¯è½¯é“¾æ¥ï¼Œå¹¶éæ–‡ä»¶çœŸæ­£æ‰€åœ¨è·¯å¾„ã€‚</p>
<p>è¯´æ˜ä¸€ä¸‹ï¼Œæœ¬æ–‡å°†ä»¥è¿™ç§æ–¹å¼å®‰è£…çš„ Node ç§°ä¸ºç³»ç»Ÿç‰ˆæœ¬çš„ Nodeï¼Œç”¨äºåŒºåˆ«ä½¿ç”¨ nvm å®‰è£…çš„ Nodeã€‚</p>
<h2>äºŒã€npm è·¯å¾„</h2>
<p>ä» npm Docs å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹ã€Œå…¨å±€å®‰è£…ã€å¦‚ä½•å­˜æ”¾æ–‡ä»¶éƒ½æœ‰æ¯”è¾ƒæ¸…æ™°çš„æè¿°ï¼ˆ<a href="https://docs.npmjs.com/cli/v8/commands/npm-install#global">è¯¦çœ‹</a>ï¼‰ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š</p>
<blockquote>
<ul>
<li>ä¾èµ–åŒ…å°†ä¼šä¸‹è½½è‡³ <code>{prefix}/lib/node_modules</code> ç›®å½•ä¸‹ã€‚</li>
<li>ä¾èµ–åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«è½¯é“¾æ¥è‡³ <code>{prefix}/bin</code> ç›®å½•ã€‚</li>
</ul>
</blockquote>
<p>å…¶ä¸­ <code>prefix</code> æ˜¯ npm çš„ä¸€ä¸ªé…ç½®é¡¹ï¼ˆ<a href="https://docs.npmjs.com/cli/v8/configuring-npm/folders#prefix-configuration">è¯¦è§</a>ï¼‰ï¼Œå®ƒçš„é»˜è®¤å€¼ä¸ Node çš„å®‰è£…ä½ç½®æœ‰å…³ã€‚åœ¨ Unix/Linux/Mac æ“ä½œç³»ç»Ÿä¸­ï¼Œé€šå¸¸æ˜¯ <code>/usr/local</code>ã€‚åœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šé€šå¸¸æ˜¯ <code>%AppData%\npm</code>ã€‚å…¶ä¸­ã€Œå¯æ‰§è¡Œæ–‡ä»¶ã€æ˜¯æŒ‡ <code>package.json</code> ä¸­ <code>bin</code> å­—æ®µçš„é…ç½®é¡¹ã€‚</p>
<p>ä½¿ç”¨ <code>npm config</code> å‘½ä»¤å¯å¯¹ <code>prefix</code> é…ç½®è¿›è¡Œæ“ä½œï¼š</p>
<pre><code class="language-shell"># æŸ¥çœ‹
$ npm config get prefix
/usr/local

# è®¾ç½®/æ›´æ–°
$ npm config set prefix &lt;value&gt;

# ç§»é™¤
$ npm config delete prefix
</code></pre>
<p>ä¹Ÿå¯åœ¨é…ç½®æ–‡ä»¶ <code>~/.npmrc</code> ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼ˆ<a href="https://docs.npmjs.com/cli/v8/configuring-npm/npmrc#files">è¯¦è§</a> ï¼‰ã€‚</p>
<blockquote>
<p>è‹¥ä½ åœ¨ä½¿ç”¨ nvm æ¥ç®¡ç† Node ç‰ˆæœ¬ï¼Œä¸å»ºè®®ä¸»åŠ¨é…ç½® <code>prefix</code>ã€‚å¦‚æœå®ƒå­˜åœ¨çš„è¯åº”å°†å…¶ç§»é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ— æ³•ã€Œåˆç†åœ°ã€å®‰è£…ä¾èµ–åŒ…åˆ°ç›¸åº”ç›®å½•ï¼Œå…·ä½“åŸå› ä¸‹æ–‡ä¼šä»‹ç»ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œ</p>
<blockquote>
<ul>
<li>ä¾èµ–åŒ…å­˜æ”¾äº <code>/usr/local/lib/node_modules</code> ç›®å½•ã€‚</li>
<li>ä¾èµ–åŒ…å¯æ‰§è¡Œæ–‡ä»¶å°†è¢«è½¯é“¾æ¥è‡³ <code>/usr/local/bin</code> ç›®å½•ã€‚</li>
</ul>
</blockquote>
<p>å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<pre><code class="language-shell">$ npm root -g
/usr/local/lib/node_modules

$ npm bin -g
/usr/local/bin
</code></pre>
<p>å¯é€šè¿‡ <code>npm ls</code> å‘½ä»¤æŸ¥çœ‹å…¨å±€å®‰è£…çš„ä¾èµ–åŒ…ï¼Œä¸ªäººæ›´å–œæ¬¢ä½¿ç”¨å…¶åˆ«å <code>npm list</code>ï¼ŒåŸå› æ˜¯å®ƒè·Ÿ <code>yarn list</code> ä¸€è‡´ã€‚</p>
<pre><code class="language-shell">$ npm list -g
/usr/local/lib
â”œâ”€â”€ corepack@0.10.0
â”œâ”€â”€ jest@28.1.1
â”œâ”€â”€ npm@8.3.1
â””â”€â”€ yarn@1.22.10
</code></pre>
<p>å…¶æ‰“å°ç»“æœä¸ºæ ‘çŠ¶å½¢å¼ï¼Œå¯é…åˆ <code>--depth=n</code> å‚æ•°ä½¿ç”¨ä»¥æŸ¥çœ‹åŒ…çš„ä¾èµ–ä¿¡æ¯ï¼Œå…¶ä¸­ <code>n</code> è¡¨ç¤ºæ ‘çŠ¶æ·±åº¦ã€‚ä¸Šé¢çš„ <code>npm list -g</code> ç›¸å½“äº <code>npm list -g --depth=0</code>ã€‚</p>
<blockquote>
<p>æ›´å¤šè¯·çœ‹ <a href="https://docs.npmjs.com/cli/v8/commands/npm-ls">npm Docs</a>ã€‚</p>
</blockquote>
<h2>ä¸‰ã€yarn ç›¸å…³è·¯å¾„</h2>
<blockquote>
<p>æœ¬æ–‡æ¶‰åŠçš„ yarn å‡æŒ‡ v1 ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p>æ’ä¸ªè¯ï¼Œåœ¨ v2 ç‰ˆæœ¬æœ‰ç€è¾ƒå¤§çš„å·®å¼‚ï¼Œæ¯”å¦‚åœ¨ v2 ç‰ˆæœ¬å°† <code>yarn global</code> ç§»é™¤ï¼Œå…¶æ›¿ä»£è€…æ˜¯ <code>yarn dlx</code>ï¼Œæ›´å¤š<a href="https://yarnpkg.com/getting-started/migration/#use-yarn-dlx-instead-of-yarn-global">è¯·çœ‹</a>ï¼Œè¿™é‡Œä¸å±•å¼€èµ˜è¿°äº†ã€‚</p>
<p>yarn å…¨å±€å®‰è£…è·¯å¾„ä¸ npm ä¸åŒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼š</p>
<blockquote>
<ul>
<li>ä¾èµ–åŒ…å­˜æ”¾äº <code>~/.config/yarn/global/node_modules</code> ç›®å½•ã€‚</li>
<li>ä¾èµ–åŒ…å¯æ‰§è¡Œæ–‡ä»¶å°†è¢«è½¯é“¾æ¥è‡³ <code>/usr/local/bin</code> ç›®å½•ï¼Œ</li>
</ul>
</blockquote>
<p>å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<pre><code class="language-shell">$ yarn global dir
/Users/frankie/.config/yarn/global

$ yarn global bin
/usr/local/bin
</code></pre>
<p>è‹¥è¦ä¿®æ”¹ä»¥ä¸Šé…ç½®ï¼Œå¯é€šè¿‡ <code>yarn config</code> å‘½ä»¤å¤„ç†ï¼š</p>
<pre><code class="language-shell"># ä¿®æ”¹ä¾èµ–åŒ…å®‰è£…è·¯å¾„
$ yarn config set global-folder &lt;value&gt;

# ä¿®æ”¹ä¾èµ–åŒ…å¯æ‰§è¡Œæ–‡ä»¶è½¯é“¾æ¥è·¯å¾„
$ yarn config set prefix &lt;value&gt;
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿®æ”¹å…¨å±€å®‰è£…è·¯å¾„çš„é…ç½® <code>key</code> æ˜¯ <code>global-folder</code>ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„ <code>key</code> ä¸º <code>prefix</code>ã€‚åˆ«è·Ÿ npm æ··æ·†äº†ã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ <code>~/.yarnrc</code> ç›´æ¥ä¿®æ”¹ï¼š</p>
<pre><code class="language-.yarnrc"># THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1


registry &quot;https://registry.npmmirror.com/&quot;
lastUpdateCheck 1656144727204
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä¸­ npm é…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ ini-formatted æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯ <code>key=value</code> å½¢å¼ï¼Œè€Œ yarn åˆ™æ˜¯ <code>key &quot;value&quot;</code> å½¢å¼ã€‚</p>
<h2>å››ã€ä½¿ç”¨ nvm</h2>
<p>æˆ‘ä»¬çŸ¥é“ npmï¼ˆNode Package Managerï¼‰æ˜¯ Node åŒ…ç®¡ç†å·¥å…·ï¼Œè€Œ nvmï¼ˆNode Version Managerï¼‰åˆ™æ˜¯ Node ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚å®ƒå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿå®‰è£…ã€ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ Nodeã€‚</p>
<p>å‡è®¾æœ‰å¤šä¸ªé¡¹ç›®ä½¿ç”¨äº†ä¸åŒç‰ˆæœ¬çš„ Nodeï¼Œæˆ–è€…éœ€è¦åœ¨ä¸åŒç‰ˆæœ¬çš„ Node ä¸‹æµ‹è¯•æˆ‘ä»¬å¼€å‘çš„ npm åŒ…ï¼Œé‚£ä¹ˆä½¿ç”¨ nvm å°†ä¼šå¾ˆé«˜æ•ˆã€‚å…¶å®‰è£…ä¸å±•å¼€ç»†è¯´ï¼Œè¯·çœ‹<a href="https://github.com/nvm-sh/nvm">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>ç¬¬ä¸€èŠ‚å·²ç»ä»‹ç»äº†ï¼Œä½¿ç”¨ã€Œä¼ ç»Ÿã€çš„æ–¹æ³•å®‰è£…å…¶è·¯å¾„å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>Node è¢«å®‰è£…åˆ° <code>/usr/local/bin/node</code>ï¼›</li>
<li>npm è¢«å®‰è£…åˆ° <code>/usr/local/bin/npm</code>ï¼›</li>
<li>npm å…¨å±€ä¾èµ–åŒ…é»˜è®¤å­˜æ”¾äº <code>/usr/local/lib/node_modules</code> ç›®å½•ã€‚</li>
</ul>
</blockquote>
<p>ä½†å¦‚æœä½¿ç”¨ nvm æ¥ç®¡ç† Nodeï¼Œè¿™äº›éƒ½å°†ä¼šå‘ç”Ÿå˜åŒ–ã€‚å½“ä½¿ç”¨å®˜æ–¹æŒ‡å¼•æ¥å®‰è£… nvmï¼Œç›¸å…³å†…å®¹å°†ä¼šé»˜è®¤å­˜æ”¾è‡³ <code>~/.nvm</code> ç›®å½•ã€‚</p>
<p>å½“ä½¿ç”¨ <code>nvm install</code> æ¥å®‰è£… Nodeï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ nvm install 16.14.0
</code></pre>
<p>å®ƒå°†ä¼šå­˜æ”¾äº <code>~/.nvm/versions/node/v16.14.0</code> ç›®å½•ä¸‹ã€‚</p>
<p>åˆ‡æ¢ system Node ä¸ nvm Nodeï¼Œåªè¦é€šè¿‡ä»¥ä¸‹æ–¹å¼å³å¯ï¼š</p>
<pre><code class="language-shell"># ä½¿ç”¨ç³»ç»Ÿç‰ˆæœ¬
$ nvm use system

# ä½¿ç”¨ nvm çš„ Node ç‰ˆæœ¬ï¼Œè¿˜æœ‰æ›´å¤šå†™æ³•ï¼Œè¯·çœ‹ï¼šhttps://github.com/nvm-sh/nvm#usage
$ nvm use 16.14.0
</code></pre>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ <code>prefix</code> çš„å˜åŒ–å°±çŸ¥é“å…¶å®‰è£…è·¯å¾„äº†ï¼š</p>
<pre><code class="language-shell">$ nvm use system
Now using system version of node: v16.14.0 (npm v7.24.2)

$ npm config get prefix
/usr/local

$ npm bin -g
/usr/local/bin

$ which node
/usr/local/bin/node
</code></pre>
<pre><code class="language-shell">$ nvm use 16.14.0
Now using node v16.14.0 (npm v8.3.1)

$ npm config get prefix
/Users/frankie/.nvm/versions/node/v16.14.0

$ npm bin -g
/Users/frankie/.nvm/versions/node/v16.14.0/bin

$ which node
/Users/frankie/.nvm/versions/node/v16.14.0/bin/node
</code></pre>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ nvm ç®¡ç†çš„æƒ…å†µä¸‹ï¼š</p>
<blockquote>
<ul>
<li>å…¨å±€ä¾èµ–åŒ…å°†ä¼šå®‰è£…è‡³ <code>~/.nvm/versions/node/vX.X.X/lib/node_modules</code> ç›®å½•ã€‚</li>
<li>ä¾èµ–åŒ…å¯æ‰§è¡Œæ–‡ä»¶å°†è¢«è½¯é“¾æ¥è‡³ <code>~/.nvm/versions/node/vX.X.X/bin</code> ç›®å½•ã€‚</li>
</ul>
</blockquote>
<p>å‰é¢æåˆ°è¿‡ï¼Œ<code>prefix</code> çš„é»˜è®¤ä½ç½®ä¸ Node çš„å®‰è£…è·¯å¾„æœ‰å…³ã€‚æ¯”å¦‚ï¼Œåœ¨ Unix/Linux/Mac æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>prefix</code> é€šå¸¸æ˜¯ Node å®‰è£…è·¯å¾„çš„ä¸Šä¸€çº§ï¼Œä¹Ÿå°±æ˜¯ <code>~/.nvm/versions/node/vX.X.X</code> ç›®å½•ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬åœ¨åˆ‡æ¢ Node ç‰ˆæœ¬ä¸­ï¼Œå®ƒæ€»èƒ½æ­£ç¡®åœ°å®‰è£…åˆ° <code>/usr/local/lib/node_modules</code> æˆ– <code>~/.nvm/versions/node/vX.X.X/lib/node_modules/</code> ç›®å½•ã€‚</p>
<blockquote>
<p>æ›´å¤šè¯·çœ‹ <a href="https://docs.npmjs.com/cli/v8/configuring-npm/folders#prefix-configuration">npm Docs</a>ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨ <code>~/.npmrc</code> ä¸­é…ç½®äº† <code>prefix</code>ï¼Œæ— è®ºä½ å¦‚ä½•åˆ‡æ¢ Node ç‰ˆæœ¬ï¼Œå®ƒæ€»æ˜¯è¢«å®‰è£…è‡³æ‰€é…ç½®çš„è·¯å¾„ä¸‹ã€‚</p>
<pre><code class="language-shell">$ npm config set prefix &quot;~/.npm-packages&quot;

$ npm i -g jest

$ tree ~/.npm-packages -L 3 
/Users/frankie/.npm-packages
â”œâ”€â”€ bin
â”‚Â Â  â””â”€â”€ jest -&gt; ../lib/node_modules/jest/bin/jest.js
â””â”€â”€ lib
    â””â”€â”€ node_modules
        â””â”€â”€ jest
</code></pre>
<p>è¿™æ ·å°±è¿èƒŒäº†ç”¨ nvm çš„åˆå¿ƒï¼Œè‡ªå®šä¹‰ <code>prefix</code> é…ç½®ä¸ nvm ä¸å…¼å®¹ã€‚nvm åœ¨å…¶å®˜æ–¹æ–‡æ¡£ä¸­ç”¨æŒ‡å‡ºï¼ˆ<a href="https://github.com/nvm-sh/nvm#important-notes">è¯¦è§</a>ï¼‰ï¼š</p>
<blockquote>
<p>If you have an <code>~/.npmrc</code> file, make sure it does not contain any <code>prefix</code> settings (which is not compatible with <code>nvm</code>)</p>
</blockquote>
<p>å¦‚æœä½ æ­¤åˆ»ç”¨ç€ nvmï¼ŒåŒæ—¶æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®ç«‹åˆ»å»æ£€æŸ¥å¹¶å°†å…¶ç§»é™¤ã€‚</p>
<h2>äº”ã€æ€»ç»“</h2>
<p>ç›®å‰ï¼Œæˆ‘åŒæ—¶ä½¿ç”¨ç€ nvmã€npmã€yarnï¼ˆv1ï¼‰ä¸‰ä¸ªå·¥å…·ï¼Œé‚£ä¹ˆå¹³å¸¸æ˜¯è¿™æ ·ç®¡ç†å®ƒä»¬çš„ï¼š</p>
<blockquote>
<ul>
<li>ä¸€æ¦‚ä¸ä¸»åŠ¨ä¿®æ”¹ npmã€yarn é»˜è®¤å®‰è£…è·¯å¾„ï¼Œé‡‡ç”¨é»˜è®¤å³å¯ï¼›</li>
<li>npm é…ç½®ä¸­ä¸€æ¦‚ä¸è®¾ç½® <code>prefix</code>ï¼Œä»¥é¿å… npm å…¨å±€ä¾èµ–åŒ…è¢«å®‰è£…è‡³ã€Œä¸æ­£ç¡®ã€çš„è·¯å¾„ä¸‹ï¼›</li>
<li>ä¸ Node ç‰ˆæœ¬æœ‰å…³çš„å…¨å±€ä¾èµ–åŒ…ï¼Œç»Ÿä¸€ç”¨ npm è¿›è¡Œå®‰è£…ï¼Œæ¯”å¦‚ Taro CLI ç­‰ï¼›</li>
<li>ä¸ Node ç‰ˆæœ¬æ— å…³çš„å…¨å±€ä¾èµ–åŒ…ï¼Œç»Ÿä¸€ç”¨ yarn è¿›è¡Œå®‰è£…ã€‚</li>
</ul>
</blockquote>
<p>åŸºäºè¿™ç§åŸåˆ™ä¸‹ï¼Œå…¨å±€å®‰è£…çš„ä¾èµ–åŒ…å°†æœ‰è¿™äº›è·¯å¾„ï¼š</p>
<blockquote>
<ul>
<li><code>/usr/local/lib/node_modules</code></li>
<li><code>~/.config/yarn/global/node_modules</code></li>
<li><code>~/.nvm/versions/node/vX.X.X/lib/node_modules</code></li>
</ul>
</blockquote>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå¯æŸ¥çœ‹å…¨å±€ä¾èµ–åŒ…æ‰€åœ¨è·¯å¾„ï¼š</p>
<blockquote>
<ul>
<li><code>npm root -g</code></li>
<li><code>yarn global dir</code></li>
</ul>
</blockquote>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå¯æŸ¥çœ‹å·²å®‰è£…çš„å…¨å±€ä¾èµ–åŒ…ï¼š</p>
<blockquote>
<ul>
<li><code>npm list -g</code></li>
<li><code>yarn global list</code></li>
</ul>
</blockquote>
<p>åˆ°æ­¤ï¼Œæœ¬æ–‡ç»“æŸã€‚ä»¥ä¸Šå¸Œæœ›å¯ä»¥å¸®ä½ å˜æ¸…ä¸ªä¸­æ··æ·†ä¹‹å¤„ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Node.js å®ç°æµè§ˆå™¨æ‰“å¼€é“¾æ¥]]></title>
            <link>https://github.com/toFrankie/blog/issues/93</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/93</guid>
            <pubDate>Sat, 25 Feb 2023 12:26:45 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a8ed813468860f41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a8ed813468860f41.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ Node.js ä¸­å®ç°åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŒ‡å®š URLã€‚</p>
<p>åˆ©ç”¨ Node.js æä¾›çš„ <code>child_process.exec()</code> æ–¹æ³•å³å¯ï¼Œä½†æ˜¯ä¸åŒæ“ä½œç³»ç»Ÿä¸‹ï¼ŒæŒ‡ä»¤æœ‰æ‰€ä¸åŒï¼š</p>
<pre><code class="language-js">const { exec } = require('child_process')
const uri = 'https://www.google.com'

// Windows
exec('start https://www.google.com')

// Mac
exec('open https://www.google.com')

// Otherwise: https://portland.freedesktop.org/doc/xdg-open.html
exec('xdg-open https://www.google.com')
</code></pre>
<p>ç¤¾åŒºä¸Šæœ‰ä¸€äº› NPM åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ <a href="https://github.com/pwnall/node-open">open</a>ã€<a href="https://github.com/sindresorhus/open">opn</a> ç­‰ã€‚</p>
<p>ä»¥ <a href="https://github.com/pwnall/node-open">open</a> ä¸ºä¾‹ï¼š</p>
<pre><code class="language-js">const open = require('open')

open('http://www.google.com', 'firefox')
</code></pre>
<p>åˆæ˜¯ä¸€ç¯‡æ— è¥å…»çš„æ–‡ç« ï¼Œå“ˆå“ˆ...</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Node.js å¤åˆ¶è‡³å‰ªè´´æ¿]]></title>
            <link>https://github.com/toFrankie/blog/issues/92</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/92</guid>
            <pubDate>Sat, 25 Feb 2023 12:26:10 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-380a1401399f14ff.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-380a1401399f14ff.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ‹·è´æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ä¸ªèƒ½åŠ›ï¼Œåœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹ï¼ŒæŒ‡ä»¤é›†æ˜¯ä¸åŒçš„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const { exec } = require('child_process')

// Windows
exec('clip').stdin.end('some text')

// Mac
exec('pbcopy').stdin.end('some text')

// Linux
exec('xclip').stdin.end('some text')
</code></pre>
<p>åœ¨ç¤¾åŒºä¸Šï¼Œä¹Ÿæœ‰æä¾›äº†å„å¹³å°é€šç”¨çš„ NPM åŒ…ï¼Œæ¯”å¦‚ï¼š<a href="https://github.com/xavi-/node-copy-paste">copy-paste</a>ï¼Œä½¿ç”¨ä¹Ÿéå¸¸åœ°ç®€å•ã€‚</p>
<pre><code class="language-shell">$ npm i copy-paste
</code></pre>
<pre><code class="language-js">const ncp = require('copy-paste')

ncp.copy('some text', function () {
  // complete...
})
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>copy()</code> æ–¹æ³•æ˜¯å¼‚æ­¥çš„ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸€ä¸ªæ¯” nrm æ›´å¥½ç”¨çš„é•œåƒæºç®¡ç†å·¥å…·]]></title>
            <link>https://github.com/toFrankie/blog/issues/91</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/91</guid>
            <pubDate>Sat, 25 Feb 2023 12:24:38 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a59a4f58c6fb5412.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a59a4f58c6fb5412.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æ­¤å‰ä»‹ç»è¿‡ä¸€ä¸ª NPM é•œåƒæºç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢ NPM æºï¼Œé‚£å°±æ˜¯ <a href="https://github.com/Pana/nrm">nrm</a>ã€‚</p>
<blockquote>
<p>è¯¦è§æ–‡ç« ï¼š<a href="https://github.com/toFrankie/blog/issues/89">nrm ä½¿ç”¨è¯¦è§£</a>ã€‚</p>
</blockquote>
<p>æœ€åŸå§‹è®¾ç½® NPM æˆ– YARN æºçš„å‘½ä»¤å¯¹åº”å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># use npm
$ npm config set registry &lt;registry-url&gt;

# use yarn
$ yarn config set registry &lt;registry-url&gt;
</code></pre>
<p>è€Œä½¿ç”¨ <code>nrm</code> å¯ä»¥å¿«é€Ÿåœ°åˆ‡æ¢æºï¼š</p>
<pre><code class="language-shell"># nrm use taobao
$ nrm use &lt;registry&gt;
</code></pre>
<blockquote>
<p>ä½†æ˜¯è¿™ä¸ªæœ‰ç‚¹ä¸çˆ½ï¼Œå°±æ˜¯è¯´å®ƒåªä¼šåˆ‡æ¢ <code>npm</code> å‘½ä»¤çš„é•œåƒæºï¼Œ<code>nrm</code> æ— æ³•ä¿®æ”¹ <code>yarn</code> çš„ã€‚</p>
</blockquote>
<p>æœ€è¿‘å‘ç°äº†ä¸€ä¸ª <a href="https://github.com/i5ting/yrm">yrm</a>ï¼ˆYARN registry managerï¼‰å·¥å…·ï¼Œå¯ä»¥åŒæ­¥ä¿®æ”¹ <code>npm</code> å’Œ <code>yarn</code> é•œåƒæºï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ <code>nrm</code> çš„ä¸€ä¸ª Fork åˆ†æ”¯ã€‚</p>
<pre><code class="language-shell"># install
$ npm i yrm -g

# switch registry
$ yrm use &lt;registry&gt;

# ...
</code></pre>
<p>ä½¿ç”¨æ–¹æ³•ä¸ <code>nrm</code> ä¸€è‡´ï¼Œå°±ä¸å¤šè¯´äº†ã€‚å¦‚æœå¯¹ <code>nrm</code> ä¸äº†è§£çš„è¯ï¼Œå¯ä»¥å…ˆçœ‹çœ‹å‰é¢é‚£ç¯‡<a href="https://github.com/toFrankie/blog/issues/89">æ–‡ç« </a>ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ <code>-h</code> æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ yrm -h

Usage: yrm [options] [command]

Options:
  -V, --version                output the version number
  -h, --help                   output usage information

Commands:
  ls                           List all the registries
  current                      Show current registry name
  use &lt;registry&gt;               Change registry to registry
  add &lt;registry&gt; &lt;url&gt; [home]  Add one custom registry
  del &lt;registry&gt;               Delete one custom registry
  home &lt;registry&gt; [browser]    Open the homepage of registry with optional browser
  test [registry]              Show response time for specific or all registries
  help                         Print this help
</code></pre>
<blockquote>
<p>å½“ä½ ä½¿ç”¨å…¶ä»–éé¢„è®¾æ³¨å†Œè¡¨æ—¶ï¼Œä¸èƒ½ä½¿ç”¨ <code>publish</code> å‘½ä»¤ã€‚é€šå¸¸æˆ‘å‘å¸ƒ NPM åŒ…éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ <code>npm public</code> å‘½ä»¤ã€‚</p>
</blockquote>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ yrm use taobao

   YARN Registry has been set to: https://registry.npm.taobao.org/

   NPM Registry has been set to: https://registry.npm.taobao.org/
</code></pre>
<blockquote>
<p><strong>ã€Œé‡è¦é€šçŸ¥ã€</strong> åŸæ·˜å® npm åŸŸåå³å°†åœæ­¢è§£æï¼Œè¯·åˆ‡æ¢è‡³æ–°åŸŸåÂ <a href="http://www.npmmirror.com/">npmmirror.com</a>ï¼Œ<code>http://npm.taobao.org</code>å’ŒÂ <code>http://registry.npm.taobao.org</code>Â å°†åœ¨Â <strong>2022.06.30</strong>Â å·æ­£å¼ä¸‹çº¿å’Œåœæ­¢ DNS è§£æã€‚</p>
</blockquote>
<p>ç”±äº <a href="https://www.npmjs.com/package/yrm">yrm</a> åŒ…æœ€æ–°ä¸€æ¬¡æ›´æ–°è¿˜æ˜¯äº”å¹´å‰ï¼Œå› æ­¤æ·˜å®é•œåƒçš„åŸŸåè¿˜æ˜¯æ—§åŸŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ›´æ–°ï¼š</p>
<pre><code class="language-shell">$ yrm add taobao https://registry.npmmirror.com/
</code></pre>
<h2>Refenerces</h2>
<ul>
<li><a href="https://github.com/Pana/nrm">nrm</a></li>
<li><a href="https://github.com/i5ting/yrm">yrm</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/89">nrm ä½¿ç”¨è¯¦è§£</a></li>
<li><a href="https://www.yunyoujun.cn/posts/nnrm-new-nrm">ä¸€ä¸ªæç®€çš„ npm/yarn registry åˆ‡æ¢ç®¡ç†å™¨</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»ºç§æœ‰ NPM æœåŠ¡å™¨]]></title>
            <link>https://github.com/toFrankie/blog/issues/90</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/90</guid>
            <pubDate>Sat, 25 Feb 2023 12:21:23 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/10/1696416482980.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å…¶å®ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨ <code>npm</code> æˆ– <code>y]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/10/1696416482980.png" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å…¶å®ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨ <code>npm</code> æˆ– <code>yarn</code> åœ¨ <a href="https://www.npmjs.com/">https://www.npmjs.com</a> å¹³å°ä¸‹è½½ä¸€äº›ç¬¬ä¸‰æ–¹çš„åŒ…ï¼Œå®ƒä»¬éƒ½å±äºå¼€æºçš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥å…è´¹ä¸‹è½½å¹¶ä½¿ç”¨ã€‚</p>
<p>å‡è®¾å…¬å¸æˆ–è€…å›¢é˜Ÿé‡Œé¢ï¼Œæƒ³æŠŠä¸€äº›å¯å¤ç”¨çš„æ¨¡å—æŠ½ç¦»å¹¶å½¢æˆ NPM åŒ…ï¼Œå› æ¶‰åŠå…¬å¸ä¸šåŠ¡æˆ–å…¶ä»–åŸå› ï¼Œä¸èƒ½å‘å¸ƒåˆ° NPM å¹³å°ä¸Šã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨å…¬å¸å†…éƒ¨å»ºç«‹ä¸€ä¸ªç±»ä¼¼ <a href="https://www.npmjs.com/">https://www.npmjs.com</a> çš„ç§æœ‰çš„ NPM å¹³å°ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»é›¶åˆ°ä¸€æ­å»ºä¸ªäººçš„ NPM ç§æœ‰æœåŠ¡å™¨ã€‚</p>
<h2>ä¸€ã€é€‰æ‹©</h2>
<p>é€‰æ‹© <a href="https://github.com/verdaccio/verdaccio">Verdaccio</a> ä½œä¸ºæˆ‘ä»¬ç§æœ‰ NPM ä»“åº“çš„å¹³å°ï¼Œä¸»è¦åŸå› æ˜¯å…è´¹ã€é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
<blockquote>
<p>å¦‚æœæ˜¯å…¬å¸å±‚é¢ï¼Œå¯èƒ½è¦æ·±å…¥å¯é ã€ç¨³å®šæ€§ç­‰å› ç´ ã€‚</p>
</blockquote>
<h2>äºŒã€NPM å¹³å°æ­å»º</h2>
<p>å®‰è£…ã€å¯åŠ¨éƒ½éå¸¸ç®€å•~</p>
<pre><code class="language-shell"># install
$ npm i -g verdaccio

# run
$ verdaccio
</code></pre>
<p>Verdaccio è·‘èµ·æ¥ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ä»“åº“åœ°å€å°±æ˜¯ï¼š<code>http://localhost:4873/</code>ã€‚</p>
<p>è¿™æ˜¯åŸºäºé»˜è®¤é…ç½®ï¼Œæš‚æ—¶ä¸ä½œä¿®æ”¹ï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>~/.config/verdaccio/config.yaml</code>ã€‚</p>
<pre><code class="language-shell">$ verdaccio

 warn --- config file  - /Users/frankie/.config/verdaccio/config.yaml
 warn --- Plugin successfully loaded: verdaccio-htpasswd
 warn --- Plugin successfully loaded: verdaccio-audit
 warn --- http address - http://localhost:4873/ - verdaccio/5.1.1
 http --- 127.0.0.1 requested 'GET /'
 http --- 304, user: null(127.0.0.1), req: 'GET /', bytes: 0/0
 http --- 127.0.0.1 requested 'GET /-/verdaccio/packages'
 http --- 304, user: null(127.0.0.1), req: 'GET /-/verdaccio/packages', bytes: 0/0
</code></pre>
<p>ç›®å‰æ²¡æœ‰å‘åŒ…ä¸Šæ¥ï¼Œå°±é•¿è¿™æ ·...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-df0fd715ec40e714.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬ä¿®æ”¹ä»¥ä¸‹ <code>npm</code> æˆ– <code>yarn</code> çš„é•œåƒæº <code>http://localhost:4873/</code>ã€‚</p>
<pre><code class="language-shell"># æ·»åŠ ç§æœ‰æºï¼ˆæˆ‘ä½¿ç”¨äº† nrm æ¥ç®¡ç† npm æºï¼‰
$ nrm add local http://localhost:4873/

# åˆ‡æ¢æº
$ nrm use local

# or
# npm set registry http://localhost:4873/

# æ³¨å†Œç”¨æˆ·ï¼Œå¯¹åº”ä½  NPM è´¦å·å¯†ç ï¼ˆè‹¥æ²¡æœ‰ï¼Œç”¨é‚®ç®±æ³¨å†Œä¸€ä¸ªå³å¯ï¼‰
$ npm adduser

# æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯æ³¨å†Œç”¨æˆ·
$ npm who am i
</code></pre>
<blockquote>
<p>å…³äº nrm å®‰è£…ä½¿ç”¨ï¼Œçœ‹<a href="https://github.com/toFrankie/blog/issues/89">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h2>ä¸‰ã€å‘åŒ…</h2>
<h3>3.1 åˆ›å»º NPM é¡¹ç›®</h3>
<p>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ NPM åŒ…é¡¹ç›®ï¼Œç›®å½•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">privative-npm
    â”œâ”€â”€ .gitignore                // ç›¸åº”ç›®å½•ï¼Œå‘å¸ƒæ—¶ä¼šå¿½ç•¥ä¸Šä¼ 
    â”œâ”€â”€ .npmignore                // åŒç†ï¼Œä¼šå¿½ç•¥ä¸Šä¼ 
    â”œâ”€â”€ index.js                  // ä½œä¸ºå…¥å£
    â”œâ”€â”€ package.json              // åŒ…æè¿°æ–‡ä»¶
    â””â”€â”€ README.md                 // é¡¹ç›®è¯´æ˜
</code></pre>
<p>ä¸€ä¸ª NPM åŒ…ï¼Œå…¶ä¸­ <code>name</code> å’Œ <code>version</code> æ˜¯å¿…éœ€çš„ï¼Œå…¶ä»–éƒ½å¯ä»¥çœç•¥ï¼Œè€Œä¸” name ä¸èƒ½ä¸å¹³å°ä¸Šå·²æœ‰åŒ…é‡åã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;name&quot;: &quot;privative-npm&quot;, // å¿…éœ€ï¼Œä¸èƒ½æœ‰å¤§å†™å­—æ¯ã€ç©ºæ ¼ã€ä¸‹åˆ’çº¿
  &quot;version&quot;: &quot;1.0.0&quot;, // å¿…éœ€ï¼Œè¯·ä¸¥æ ¼éµå¾ªè¯­ä¹‰åŒ–
  &quot;description&quot;: &quot;Test only, not published to NPM.&quot;,
  &quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;type&quot;: &quot;module&quot;,
  &quot;main&quot;: &quot;./index.js&quot;
}
</code></pre>
<p>ç”±äºæ¼”ç¤ºè€Œå·²ï¼Œæˆ‘ä»¬å°±åªå¯¼å‡ºä¸€ä¸ªæ–¹æ³•å§ã€‚æ³¨æ„ï¼Œè‹¥åœ¨ node ä¸‹è¿è¡Œæ­¤åŒ…ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† ESMï¼Œå› æ­¤éœ€è¦åœ¨ <code>package.json</code> è®¾ç½® <code>&quot;type&quot;: &quot;module&quot;</code>ã€‚</p>
<pre><code class="language-js">// index.js
export default function log(str) {
  console.log(str)
}
</code></pre>
<h3>3.2 å‘å¸ƒ NPM åŒ…</h3>
<p>åœ¨å‘åŒ…ä¹‹å‰ï¼Œä½ éœ€è¦å» <a href="https://www.npmjs.com/">NPM å¹³å°å®˜ç½‘</a>æ³¨å†Œä¸€ä¸ªè´¦å·ã€‚å¾ˆç®€å•çœç•¥...</p>
<p>å®Œäº†ä¹‹åï¼Œç™»å½•ä½ çš„ NPM è´¦å·ï¼š</p>
<pre><code class="language-shell"># add
$ npm set registry http://localhost:4873/

# switch registry
$ npm config set registry http://localhost:4873/

# login npm account
$ npm adduser

# ç™»å½•è¿‡ç”¨ loginï¼Œç¬¬ä¸€æ¬¡åˆ™ç”¨ adduserï¼Œå®ƒåŒ…æ‹¬äº†ç™»å½•æ“ä½œã€‚
$ npm login
</code></pre>
<p>ç™»å½•æˆåŠŸï¼Œé•¿è¿™æ ·ï¼š</p>
<pre><code class="language-shell">$ npm login

Username: xxx
Password: 
Email: (this IS public) 1426203851@qq.com
Logged in as xxx on http://localhost:4873/.
</code></pre>
<p>åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ <code>npm publish</code> å³å¯ã€‚æˆ–å¯åœ¨ <code>package.json</code> è„šæœ¬å‘½ä»¤ä¸­å®šä¹‰ã€‚</p>
<pre><code class="language-shell">$ npm publish

npm notice 
npm notice ğŸ“¦  privative-npm@1.0.0
npm notice === Tarball Contents === 
npm notice 54B  index.js    
npm notice 212B package.json
npm notice 36B  README.md   
npm notice === Tarball Details === 
npm notice name:          privative-npm                           
npm notice version:       1.0.0                                   
npm notice package size:  416 B                                   
npm notice unpacked size: 302 B                                   
npm notice shasum:        887836aa4a154902faf31b13e60b8adcdd07b924
npm notice integrity:     sha512-fyzitNqmif188[...]hFY+zmcIW6qTg==
npm notice total files:   3                                       
npm notice 
+ privative-npm@1.0.0
</code></pre>
<p>çœ‹åˆ°å·²ç»ä¸Šä¼ æˆåŠŸäº†ï¼Œåˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ°ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-736331358755a9f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>3.3 æ›´æ–°åŒ…</h3>
<p>å¦‚æœæˆ‘ä»¬è¦æ›´æ–°åŒ…ï¼Œå…¶ä¸­ç‰ˆæœ¬å· <code>version</code> ä¸€å®šè¦ä¿®æ”¹ï¼Œå¦åˆ™ä¼šæ›´æ–°å¤±è´¥ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ npm publish

...
npm ERR! code EPUBLISHCONFLICT
npm ERR! publish fail Cannot publish over existing version.
npm ERR! publish fail Update the 'version' field in package.json and try again.
npm ERR! publish fail 
npm ERR! publish fail To automatically increment version numbers, see:
npm ERR! publish fail     npm help version

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/frankie/.npm/_logs/2021-07-14T06_16_31_553Z-debug.log
</code></pre>
<p>è¿™é‡Œæˆ‘å°±åªæ”¹ä¸ªç‰ˆæœ¬å·å§ï¼Œæ›´æ–°åŒ…çš„å‘½ä»¤ä»ç„¶æ˜¯ <code>npm publish</code>ï¼Œä¸Šä¼ æˆåŠŸåï¼Œåˆ·æ–°é¡µé¢å¯ä»¥çœ‹åˆ°æ–°ç‰ˆæœ¬äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-365702dc44ae1ae0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p><strong>å‡è®¾ä½ å¼€å‘äº†ä¸€ä¸ª NPM åŒ…ï¼Œè¦å‘å¸ƒåˆ° NPM å¼€æºä¾›å…¶ä»–å¼€å‘è€…ä½¿ç”¨ï¼Œåº”è¯¥éµå¾ª<a href="https://github.com/toFrankie/blog/issues/83">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a>åŸåˆ™è¿›è¡Œæ›´æ–°</strong>ã€‚å¦‚æœåƒæœ¬æ–‡åœ¨æœ¬åœ°æˆ–ä¸ªäººæœåŠ¡å™¨æ­å»ºç€ç©ï¼Œå°±çˆ±å’‹å’‹åœ°ï¼</p>
</blockquote>
<h3>3.4 æ’¤é”€åŒ…</h3>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ NPM å¹³å°æ’¤é”€åŒ…ï¼Œæ˜¯æœ‰éå¸¸ä¸¥æ ¼é™åˆ¶çš„ï¼Œä¸æ˜¯éšæ„å°±èƒ½æ’¤é”€å·²å‘å¸ƒåˆ°å¹³å°çš„åŒ…çš„ï¼Œè¯¦æƒ…å¯çœ‹ï¼š<a href="https://www.npmjs.com/policies/unpublish">NPM Unpublish Policy</a>ã€‚</p>
</blockquote>
<pre><code class="language-shell"># æ’¤é”€åŒ…çš„æŸä¸ªç‰ˆæœ¬
$ npm unpublish [&lt;@scope&gt;/]&lt;pkg&gt;@&lt;version&gt;

# æ’¤é”€åŒ…
$ npm unpublish [&lt;@scope&gt;/]&lt;pkg&gt;
</code></pre>
<p>å¦‚æœä½ çš„ç›®çš„æ˜¯é¼“åŠ±ç”¨æˆ·å‡çº§ï¼Œæˆ–è€…æ‚¨ä¸æƒ³å†ç»´æŠ¤è½¯ä»¶åŒ…ï¼Œè¯·è€ƒè™‘æ”¹ç”¨ <code>deprecate</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ npm deprecate &lt;pkg&gt;[@&lt;version&gt;] &lt;message&gt;
</code></pre>
<p>æˆ‘ä»¬åœ¨å®‰è£…ä¸€äº›ä¾èµ–åŒ…çš„æ—¶å€™ï¼Œä¸æ˜¯ç»å¸¸çœ‹å¾—åˆ°ç±»ä¼¼çš„ä¸œè¥¿å—ï¼Œå°±æ˜¯ <code>deprecate</code> æçš„é¬¼~</p>
<pre><code class="language-shell">npm WARN deprecated core-js@1.2.7: core-js@&lt;3.3 is no longer maintained and not recommended for usage due to the number of issues.
</code></pre>
<h2>å››ã€ä½¿ç”¨åŒ…</h2>
<p>æˆ‘ä»¬å°† NPM å‘å¸ƒåˆ°ç§æœ‰æˆ–å…¬å¼€çš„ NPM å¹³å°åï¼Œéƒ½å¯ä»¥é€šè¿‡ <code>npm</code>ã€<code>yarn</code> ç­‰åŒ…ç®¡ç†å·¥å…·å»å®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p>
<p>ç”±äºæˆ‘ä»¬ä¸Šé¢ç¤ºä¾‹ï¼Œæ˜¯å°† <code>privative-npm</code> åŒ…å‘å¸ƒåˆ°æˆ‘ä»¬ç§æœ‰çš„ NPM æœåŠ¡å™¨ä¸‹ï¼Œå› æ­¤éœ€è¦å°† npm é•œåƒæºåˆ‡æ¢è‡³ <code>http://localhost:4873/</code> å³å¯ï¼š</p>
<pre><code class="language-shell"># use npm
$ npm config set registry http://localhost:4873/

# use yarn
$ yarn config set registry http://localhost:4873/
</code></pre>
<p>éšä¾¿åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶å®‰è£… <code>privative-npm</code> ä¾èµ–åŒ…ï¼Œåœ¨ node ç¯å¢ƒè¿è¡Œä¸€ä¸‹ <code>index.js</code> å¯ä»¥çœ‹åˆ°æ‰“å°å‡º <code>OK!</code>ï¼Œé‚£è¯´æ˜æˆåŠŸäº†ï¼</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-08c94d5a4db76b97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>äº”ã€å…¶ä»–</h2>
<p>å‡è®¾æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>http://localhost:4873/</code> é•œåƒæºï¼Œå»å®‰è£… <code>react</code>ã€<code>vue</code> ç­‰åŒ…ï¼Œå®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹æ­£å¸¸ä½¿ç”¨ NPM å®‰è£…ã€å…±äº«ã€å‘åŒ…çš„æµç¨‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a1f56efef3addbe8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æºè‡ªâ€œåä¸‰æœˆâ€"></p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>npm</code> æˆ– <code>yarn</code> å»å®‰è£…ä¸€ä¸ªæ¨¡å—ï¼ˆåŒ…ï¼‰æ—¶ï¼Œå…ˆæ£€æŸ¥ <code>node_modules</code> ç›®å½•æ˜¯å¦å·²ç»ç¼“å­˜äº†è¯¥æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰ä¾¿ä¼šå‘ NPM å¹³å°æŸ¥è¯¢ã€‚</p>
<p>NPM æä¾›äº†ä¸€ä¸ªæ¨¡å—ä¿¡æ¯æŸ¥è¯¢æœåŠ¡ï¼Œé€šè¿‡è®¿é—®ï¼š</p>
<pre><code>registry.npmjs.org/packaename/version
</code></pre>
<p>å°±å¯ä»¥æŸ¥åˆ°æŸä¸ªå‘å¸ƒåœ¨ NPM å¹³å°ä¸Šæ¨¡å—çš„å…·ä½“ä¿¡æ¯ï¼Œä»¥åŠä¸‹è½½åœ°å€ã€‚ç„¶åä¸‹è½½å¹¶è§£å‹åˆ°æœ¬åœ°å®Œæˆå®‰è£…ã€‚</p>
<p><strong>å¦‚æœæˆ‘ä»¬å¯ç”¨äº†ç§æœ‰ NPM æœåŠ¡å™¨ï¼Œæµç¨‹åˆæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿ</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-705906644e16e575.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æºè‡ªâ€œåä¸‰æœˆâ€"></p>
<p>å½“æˆ‘ä»¬å¯åŠ¨ Verdaccio æ—¶ï¼Œå¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶æ˜¯åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹çš„ï¼š<code>~/.config/verdaccio/config.yaml</code>ã€‚</p>
<pre><code class="language-yaml">#
# é…ç½®æ–‡ä»¶ï¼ˆè¿™é‡Œæˆ‘åˆ é™¤äº†ä¸€äº›é»˜è®¤æ³¨è§£ï¼‰
# æ›´å¤šè¯·çœ‹: https://github.com/verdaccio/verdaccio/blob/master/packages/config/src/conf/default.yaml
#

# ä¸Šä¼ çš„æ‰€æœ‰åŒ…å­˜æ”¾ç›®å½•
storage: ./storage
# æ’ä»¶ç›®å½•
plugins: ./plugins

# web æœåŠ¡ï¼Œå³æˆ‘ä»¬å¯ä»¥é€šè¿‡ web æŸ¥çœ‹æˆ‘ä»¬ä¸Šä¼ çš„åŒ…ã€‚
web:
  title: Verdaccio
  # ä¸€äº›å…³äº web é¡µé¢çš„é…ç½®é¡¹ï¼Œæˆ‘åˆ æ‰äº†

# éªŒè¯ä¿¡æ¯
auth:
  htpasswd:
    # ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ç›®å½•
    file: ./htpasswd

# å…¬æœ‰ä»“åº“é…ç½®
uplinks:
  npmjs:
    # é»˜è®¤
    # url: https://registry.npmjs.org/
    # æˆ‘ä»¬å¯ä»¥æ”¹æˆæ·˜å®é•œåƒæº
    url: https://registry.npm.taobao.org/

packages:
  '@*/*':
    # scoped packages
    access: $all
    publish: $authenticated
    unpublish: $authenticated
    # ä»£ç†ã€‚å½“æˆ‘ä»¬å®‰è£…ä¸€äº›ç§æœ‰æœåŠ¡å™¨ä¸Šæ²¡æœ‰çš„åŒ…æ—¶ï¼Œå®ƒå°±ä¼šå¾€è¿™é‡Œæ‰¾ï¼Œå³ä¸Šé¢çš„ uplinks é…ç½®
    proxy: npmjs

  '**':
    # ä¸‰ç§è§’è‰²ï¼šæ‰€æœ‰äººã€åŒ¿åç”¨æˆ·ã€è®¤è¯ï¼ˆç™»å½•ï¼‰ç”¨æˆ·
    # &quot;$all&quot;, &quot;$anonymous&quot;, &quot;$authenticated&quot;

    # å¯è®¿é—®åŒ…è§’è‰²
    access: $all

    # å¯å‘åŒ…ã€æ’¤åŒ…è§’è‰²
    publish: $authenticated
    unpublish: $authenticated

    # if package is not available locally, proxy requests to 'npmjs' registry
    proxy: npmjs

# æœåŠ¡è¿æ¥æ´»è·ƒæ—¶é—´
server:
  keepAliveTimeout: 60

middlewares:
  audit:
    enabled: true
</code></pre>
<h2>å…­ã€å‚è€ƒ</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/368784910">å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹</a></li>
<li><a href="http://auan.cn/internet/2010.html">å¦‚ä½•æ­å»ºä¸€ä¸ªç§æœ‰ npm æœåŠ¡å™¨</a></li>
<li><a href="https://www.cnblogs.com/scoluo/p/7453485.html">å†™ç»™å‰ç«¯å·¥ç¨‹å¸ˆçœ‹çš„è¿ç»´å’Œæ¶æ„</a></li>
<li><a href="https://juejin.cn/post/6844904037377114119">ä½ çœŸçš„æ‡‚ npm publish ï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[nrm ä½¿ç”¨è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/89</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/89</guid>
            <pubDate>Sat, 25 Feb 2023 12:20:16 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4bf31641acfac032.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4bf31641acfac032.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!WARNING]
åŸæ·˜å® npm åŸŸåå³å°†åœæ­¢è§£æï¼Œè¯·åˆ‡æ¢è‡³æ–°åŸŸåÂ <code>npmmirror.com</code>ã€‚<code>http://npm.taobao.org</code>å’ŒÂ <code>http://registry.npm.taobao.org</code>Â å°†åœ¨Â 2022 å¹´ 6 æœˆ 30Â æ—¥æ­£å¼ä¸‹çº¿å’Œåœæ­¢ DNS è§£æã€‚</p>
</blockquote>
<h2>å‰è¨€</h2>
<p>npm é»˜è®¤é•œåƒæºæ˜¯ <code>https://registry.npmjs.org/</code>ï¼Œåœ¨å›½å†…è®¿é—®å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
<p>åæ¥ï¼Œæ·˜å®åšäº†ä¸€ä¸ªé•œåƒç½‘ç«™ï¼ˆ<a href="https://www.npmmirror.com/">npmmirror</a>ï¼‰ä»¥ä¾¿å›½å†…å¼€å‘è€…ä½¿ç”¨ã€‚</p>
<blockquote>
<p><a href="https://www.zhihu.com/question/59164204/answer/2251376189">æ·˜å®ä¸ºä»€ä¹ˆè¦æä¾› npm é•œåƒï¼Ÿ</a></p>
</blockquote>
<p>ä½¿ç”¨ <a href="https://docs.npmjs.com/cli/v11/commands/npm-config"><code>npm config</code></a> å‘½ä»¤å¯ä»¥è®¾ç½®é•œåƒæºï¼š</p>
<pre><code class="language-shell">$ npm config set registry https://registry.npmmirror.com/
</code></pre>
<p>ä½†æœ‰ç‚¹é•¿ï¼Œç‰¹åˆ«æ˜¯æºåœ°å€ï¼Œä¸å¥½è®°ã€‚</p>
<h2>nrm</h2>
<p><a href="https://github.com/Pana/nrm">nrm</a>ï¼ˆNPM registry managerï¼‰æ˜¯ npm çš„é•œåƒæºç®¡ç†å·¥å…·ä¹‹ä¸€ã€‚</p>
<h3>å…¨å±€å®‰è£…</h3>
<pre><code class="language-shell">$ npm i nrm -g
</code></pre>
<h3>æŸ¥çœ‹æ‰€æœ‰æº</h3>
<pre><code class="language-shell">$ nrm ls

* npm -------- https://registry.npmjs.org/
  yarn ------- https://registry.yarnpkg.com/
  cnpm ------- http://r.cnpmjs.org/
  taobao ----- https://www.npmmirror.com/
  nj --------- https://registry.nodejitsu.com/
  npmMirror -- https://skimdb.npmjs.com/registry/
  edunpm ----- http://registry.enpmjs.org/
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>*</code> å·è¡¨ç¤ºå½“å‰ä½¿ç”¨çš„æºã€‚</p>
</blockquote>
<blockquote>
<p>ä¹Ÿå¯ä½¿ç”¨ <code>nrm current</code> å‘½ä»¤æŸ¥çœ‹å½“å‰æºã€‚</p>
</blockquote>
<h3>åˆ‡æ¢æº</h3>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>nrm use taobao</code> ç®€ç›´ä¸è¦å¤ªæ–¹ä¾¿äº†ã€‚</p>
<pre><code class="language-shell">$ nrm use &lt;registry&gt;
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>&lt;registry&gt;</code> å°±æ˜¯ <code>nrm ls</code> æ‰€åˆ—å‡ºæ¥çš„åç§°ã€‚</p>
</blockquote>
<blockquote>
<p>åˆ‡æ¢æºä¹‹åï¼Œä»ä½¿ç”¨ <code>npm i &lt;package&gt;</code> çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚</p>
</blockquote>
<h3>æ·»åŠ æº</h3>
<p>é€‚ç”¨äºä¼ä¸šå†…éƒ¨å®šåˆ¶çš„ç§æœ‰æºï¼Œ<code>&lt;registry&gt;</code> è¡¨ç¤ºæºåç§°ï¼Œ<code>&lt;url&gt;</code> è¡¨ç¤ºæºåœ°å€ã€‚</p>
<pre><code class="language-shell">$ nrm add &lt;registry&gt; &lt;url&gt;
</code></pre>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æœ¬åœ°ä½¿ç”¨ <a href="https://github.com/toFrankie/blog/issues/90">Verdaccio</a> æ­å»ºä¸€ä¸ªç§æœ‰åˆ†å‘å¹³å°ï¼Œå¯ç”¨ <code>nrm add local http://localhost:4873/</code> æ¥æŒ‡å®šæºã€‚</p>
</blockquote>
<h3>åˆ é™¤æº</h3>
<pre><code class="language-shell">$ nrm del &lt;registry&gt;
</code></pre>
<h3>æµ‹è¯•æº</h3>
<pre><code class="language-shell">$ nrm test &lt;registry&gt;
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://github.com/Pana/nrm">NPM registry manager</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/91">ä¸€ä¸ªå¯åŒæ—¶åˆ‡æ¢ npm å’Œ yarn é•œåƒæºçš„å·¥å…·</a></li>
<li><a href="https://www.yunyoujun.cn/posts/nnrm-new-nrm">ä¸€ä¸ªæç®€çš„ npm/yarn registry åˆ‡æ¢ç®¡ç†å™¨</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/430580607">æ·˜å® NPM é•œåƒç«™å–Šä½ åˆ‡æ¢æ–°åŸŸåå•¦</a></li>
<li><a href="https://www.yuque.com/egg/cnpm">cnpm &amp; registry.npmmirror.com</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[npm å¸¸ç”¨å‘½ä»¤]]></title>
            <link>https://github.com/toFrankie/blog/issues/88</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/88</guid>
            <pubDate>Sat, 25 Feb 2023 12:19:23 GMT</pubDate>
            <description><![CDATA[<ol>
<li>å‡çº§å•ä¸ªåŒ…</li>
</ol>
<pre><code class="language-shell">$ npm update &lt;package&gt;
</code></pre>
<ol start="2">
<li>æ£€æŸ¥åŒ…æ›´æ–°</li>
</ol>
<pre><code class="lan]]></description>
            <content:encoded><![CDATA[<ol>
<li>å‡çº§å•ä¸ªåŒ…</li>
</ol>
<pre><code class="language-shell">$ npm update &lt;package&gt;
</code></pre>
<ol start="2">
<li>æ£€æŸ¥åŒ…æ›´æ–°</li>
</ol>
<pre><code class="language-shell">$ npm outdated        # æ£€æŸ¥å½“å‰é¡¹ç›®åŒ…
$ npm outdated -g     # æ£€æŸ¥å…¨å±€åŒ…
</code></pre>
<ol start="3">
<li>æŸ¥çœ‹åŒ…ç‰ˆæœ¬</li>
</ol>
<pre><code class="language-shell">$ npm view &lt;package&gt; versions   # æŸ¥çœ‹å…¨éƒ¨ç‰ˆæœ¬
$ npm view &lt;package&gt; version    # æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬
$ npm info &lt;package&gt;            # æŸ¥çœ‹åŒ…ä¿¡æ¯
</code></pre>
<ol start="4">
<li>æ›´æ–°æŒ‡å®šç‰ˆæœ¬</li>
</ol>
<pre><code class="language-shell">$ npm install &lt;package&gt;@&lt;version&gt;  # -g è¡¨ç¤ºå…¨å±€åŒ…

# npm install react-router@4.0.0
</code></pre>
<ol start="5">
<li>å¸è½½åŒ…</li>
</ol>
<pre><code class="language-shell">$ npm uninstall &lt;package&gt;               # åˆ é™¤åŒ…ï¼Œä½†ä¸åˆ é™¤åŒ…åœ¨ package.json ä¸­çš„ä¾èµ–å…³ç³»
$ npm uninstall &lt;package&gt; --save        # åˆ é™¤åŒ…ï¼ŒåŒæ—¶åˆ é™¤åŒ…åœ¨ package.json ä¸­ dependencies ä¸‹çš„ä¾èµ–å…³ç³»
$ npm uninstall &lt;package&gt; --save-dev    # åˆ é™¤åŒ…ï¼ŒåŒæ—¶åˆ é™¤åŒ…åœ¨ package.json ä¸­ devDependencies ä¸‹çš„ä¾èµ–å…³ç³»
</code></pre>
<ol start="6">
<li>æŸ¥çœ‹å…¨å±€å®‰è£…çš„ npm åŒ…</li>
</ol>
<pre><code class="language-shell">$ npm list -g

# yarn
$ yarn global list
</code></pre>
<ol start="7">
<li>å…¶ä»–</li>
</ol>
<pre><code class="language-shell">$ npm view &lt;package&gt; engines    # æŸ¥çœ‹å½“å‰åŒ…ä¾èµ–çš„ Node æœ€ä½ç‰ˆæœ¬
$ npm search &lt;package&gt;          # æœç´¢åŒ…
$ npm root                      # æŸ¥çœ‹å½“å‰åŒ…çš„å®‰è£…è·¯å¾„
$ npm root -g                   # æŸ¥çœ‹å…¨å±€åŒ…çš„å®‰è£…è·¯å¾„
$ npm repo &lt;package&gt;            # æ‰“å¼€åŒ…çš„ä»“åº“åœ°å€
$ npm docs &lt;package&gt;            # æ‰“å¼€åŒ…çš„æ–‡æ¡£
$ npm config get registry       # è·å–å½“å‰é•œåƒæº
$ npm config set &lt;registry url&gt; # è·å–å½“å‰é•œåƒæº
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[yarn ä½¿ç”¨ä»¥åŠ npm çš„è¿ç§»]]></title>
            <link>https://github.com/toFrankie/blog/issues/87</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/87</guid>
            <pubDate>Sat, 25 Feb 2023 12:18:36 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c8385f5589455dd8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c8385f5589455dd8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>yarn å®‰è£…ä¸ä½¿ç”¨</h2>
<p>å¸¸ç”¨å‘½ä»¤å°±ä»¥ä¸‹å‡ ä¸ªï¼Œç†Ÿæ‚‰ npm çš„ä½ ä»¬ï¼Œä¸€çœ‹å°±æ‡‚äº†ã€‚</p>
<pre><code class="language-shell"># åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®
$ yarn init

# æ·»åŠ ä¾èµ–åŒ…
$ yarn add [package]
$ yarn add [package]@[version]
$ yarn add [package]@[tag]

# å°†ä¾èµ–é¡¹æ·»åŠ åˆ°ä¸åŒçš„ä¾èµ–é¡¹ç±»åˆ«ä¸­ï¼Œ
# åˆ†åˆ«æ·»åŠ åˆ° devDependenciesã€peerDependenciesã€optionalDependencies ç±»åˆ«ä¸­
$ yarn add [package] --dev
$ yarn add [package] --peer
$ yarn add [package] --optional

# å‡çº§ä¾èµ–åŒ…
$ yarn upgrade [package]
$ yarn upgrade [package]@[version]
$ yarn upgrade [package]@[tag]

# ç§»é™¤ä¾èµ–åŒ…
$ yarn remove [package]

# å®‰è£…é¡¹ç›®ä¾èµ–ï¼ˆä¸¤è€…éƒ½è¡Œï¼‰
$ yarn
$ yarn install

# æ›´æ–° yarn æœ¬ä½“
$ yarn set version latest
$ yarn set version from source

# æŸ¥çœ‹å…¨å±€å®‰è£…çš„åŒ…
$ yarn global list --depth=0

# å…³äºç¼“å­˜åŒ…
$ yarn cache list          # æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨
$ yarn cache clean         # æ¸…é™¤ç¼“å­˜
$ npm cache clean --force  # npm æ–¹å¼æ¸…é™¤ç¼“å­˜
</code></pre>
<h2>npm è¿ç§»åˆ° yarn</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä» npm è¿ç§»è¿‡æ¥ï¼Œåªè¦æ‰§è¡Œ <code>yarn</code> æˆ–è€… <code>yarn install</code> å‘½ä»¤å³å¯ï¼Œå®‰è£…ä¾èµ–åŒ…ä»¥åŠç”Ÿæˆ <code>yarn.lock</code> æ–‡ä»¶ã€‚</p>
<p><strong>CLI å‘½ä»¤æ¯”è¾ƒ</strong></p>
<table>
<thead>
<tr>
<th>npm (v5)</th>
<th>yarn</th>
</tr>
</thead>
<tbody>
<tr>
<td>npm install</td>
<td>yarn add</td>
</tr>
<tr>
<td>(N/A)</td>
<td>yarn add --flat</td>
</tr>
<tr>
<td>(N/A)</td>
<td>yarn add --har</td>
</tr>
<tr>
<td>(N/A)</td>
<td>yarn add --har</td>
</tr>
<tr>
<td>npm install --no-package-lock</td>
<td>yarn add --no-lockfile</td>
</tr>
<tr>
<td>(N/A)</td>
<td>yarn add --pure-lockfile</td>
</tr>
<tr>
<td>npm install [package] --save</td>
<td>yarn add [package]</td>
</tr>
<tr>
<td>npm install [package] --save-dev</td>
<td>yarn add [package] --dev</td>
</tr>
<tr>
<td>(N/A)</td>
<td>yarn add --peer</td>
</tr>
<tr>
<td>npm install [package] --save-optional</td>
<td>yarn add --optional</td>
</tr>
<tr>
<td>npm install [package] --save-exact</td>
<td>yarn add --exact</td>
</tr>
<tr>
<td>npm install [package] --global</td>
<td>yarn global add [package]</td>
</tr>
<tr>
<td>npm update --global</td>
<td>yarn global upgrade</td>
</tr>
<tr>
<td>npm rebuild</td>
<td>yarn add --force</td>
</tr>
<tr>
<td>npm uninstall [package]</td>
<td>yarn remove [package]</td>
</tr>
<tr>
<td>npm cache clean</td>
<td>yarn cache clean [package]</td>
</tr>
<tr>
<td>rm -rf node_modules &amp;&amp; npm install</td>
<td>yarn upgrade</td>
</tr>
<tr>
<td>npm version major</td>
<td>yarn version --mojor</td>
</tr>
<tr>
<td>npm version minor</td>
<td>yarn version --minor</td>
</tr>
<tr>
<td>npm version patch</td>
<td>yarn version --patch</td>
</tr>
</tbody>
</table>
<h2>å‚è€ƒ</h2>
<p>å…³äºæ›´å¤š yarn ä½¿ç”¨æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹å®˜ç½‘ã€‚</p>
<ul>
<li><a href="https://yarn.bootcss.com/docs/">yarn 1.x å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.yarnpkg.com.cn/">yarn 2.x å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ checkPermissions Missing write access to]]></title>
            <link>https://github.com/toFrankie/blog/issues/86</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/86</guid>
            <pubDate>Sat, 25 Feb 2023 12:16:54 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ä½¿ç”¨ <code>npm install</code> å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å› ä¸ºæ²¡æœ‰å†™è®¿é—®æƒé™ï¼Œå¯¼è‡´å®‰è£…å¤±è´¥çš„æƒ…å†µã€‚</p>
<blockquote>
<p>npm WARN checkPermissions Missing write access to /Users/frankie/Documents/P]]></description>
            <content:encoded><![CDATA[<p>åœ¨ä½¿ç”¨ <code>npm install</code> å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å› ä¸ºæ²¡æœ‰å†™è®¿é—®æƒé™ï¼Œå¯¼è‡´å®‰è£…å¤±è´¥çš„æƒ…å†µã€‚</p>
<blockquote>
<p>npm WARN checkPermissions Missing write access to /Users/frankie/Documents/Project-React/demo/node_modules/decode-uri-component</p>
</blockquote>
<h3>è§£å†³æ–¹å‘</h3>
<ol>
<li>ï¼ˆåŸºæœ¬æ²¡ç”¨ï¼‰ç¬¬ä¸€ä¸ªååº”ï¼Œä½¿ç”¨ <code>sudo npm install</code>ï¼Œç„¶è€Œè¿™ç§æ–¹å¼å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸èƒ½è§£å†³ã€‚</li>
<li>ï¼ˆä¸æ¨èï¼‰ä½¿ç”¨ <code>cnpm install</code>ï¼Œè¿™ç§æ–¹å¼åŸºæœ¬èƒ½è§£å†³ï¼Œä½†ä¸æ¨èã€‚</li>
</ol>
<blockquote>
<p>æˆ‘ç°åœ¨åŸºæœ¬ä¸ç”¨ <code>cnpm</code> äº†ï¼Œå¯ä»¥é€šè¿‡ <code>npm config set registry https://registry.npm.taobao.org</code> å°† <code>npm</code> å‘½ä»¤ä¸‹è½½æºåœ°å€æ”¹æˆæ·˜å®é•œåƒã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ cnpmï¼Œä»¥åŠå¦‚ä½•è®¾ç½® npm æ·˜å®æºåœ°å€ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/82">æ–‡ç« </a>ã€‚</p>
</blockquote>
<ol start="3">
<li>ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰åˆ é™¤ <code>node_modules</code> æ–‡ä»¶å¤¹ï¼Œç„¶åé‡æ–°æ‰§è¡Œ <code>npm install</code>ã€‚</li>
<li>ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰ä¿®æ”¹ <code>node_modules</code> æ–‡ä»¶å¤¹ï¼ˆæˆ–è€…é¡¹ç›®ç›®å½•ï¼‰è¯»å†™æƒé™ä¸º <code>777</code></li>
</ol>
<pre><code class="language-shell"># è®¾ç½®æ–‡ä»¶å¤¹æƒé™ä¸º 777
$ sudo chmod -R 777 your_folder
</code></pre>
<h3>é¢˜å¤–è¯</h3>
<blockquote>
<p>å…³äº Linuxã€Mac ç³»ç»Ÿçš„ 644ã€755ã€777 æƒé™ï¼Œå¯ä»¥çœ‹è¿™ç¯‡<a href="https://www.cnblogs.com/pxuan/p/12913999.html">æ–‡ç« </a>ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[npm WARN: No repository field.]]></title>
            <link>https://github.com/toFrankie/blog/issues/85</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/85</guid>
            <pubDate>Sat, 25 Feb 2023 12:15:58 GMT</pubDate>
            <description><![CDATA[<p>åœ¨ä½¿ç”¨ npm å®‰è£…åŒ…æ—¶ï¼Œé‡åˆ° npm Warn name@x.x.x No repository field.</p>
<p>æ„æ€æ˜¯ä½ çš„ <code>package.json</code> ç¼ºå°‘ <code>repository</code> ä»“åº“å­—æ®µã€‚å¯é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³ WARNINGã€‚</p>
<p>ä¸€]]></description>
            <content:encoded><![CDATA[<p>åœ¨ä½¿ç”¨ npm å®‰è£…åŒ…æ—¶ï¼Œé‡åˆ° npm Warn name@x.x.x No repository field.</p>
<p>æ„æ€æ˜¯ä½ çš„ <code>package.json</code> ç¼ºå°‘ <code>repository</code> ä»“åº“å­—æ®µã€‚å¯é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³ WARNINGã€‚</p>
<p>ä¸€ã€ä½ çš„é¡¹ç›®æœ‰ä»“åº“åœ°å€æ—¶ï¼š</p>
<pre><code class="language-json5">// package.json
{
  &quot;repository&quot;: {
    &quot;type&quot;: &quot;git&quot;,
    &quot;url&quot;: &quot;http://github.com/yourname/repositoryname.git&quot;
  }
}
</code></pre>
<p>äºŒã€ä½œä¸ºæµ‹è¯•ã€ç»ƒä¹ é¡¹ç›®æ²¡æœ‰ä»“åº“åœ°å€æ—¶ï¼Œå°†é¡¹ç›®å£°æ˜ä¸ºç§æœ‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰æç¤ºäº†ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;private&quot;: true
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[package-lock.json ç”¨å¤„æ˜¯ï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/84</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/84</guid>
            <pubDate>Sat, 25 Feb 2023 12:14:31 GMT</pubDate>
            <description><![CDATA[<h2>è¯­ä¹‰åŒ–ç‰ˆæœ¬</h2>
<p>æ ¼å¼éµå¾ª <code>X.Y.Z</code>ï¼Œå³ã€Œä¸»è¦ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.è¡¥ä¸ç‰ˆæœ¬å·ã€ï¼Œä¸”éƒ½ä¸å«å‰å¯¼é›¶ï¼ˆ<a href="https://github.com/toFrankie/blog/issues/83">è¯¦è§</a>ï¼‰ã€‚</p>
<ul>
<li><code>X</code>]]></description>
            <content:encoded><![CDATA[<h2>è¯­ä¹‰åŒ–ç‰ˆæœ¬</h2>
<p>æ ¼å¼éµå¾ª <code>X.Y.Z</code>ï¼Œå³ã€Œä¸»è¦ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.è¡¥ä¸ç‰ˆæœ¬å·ã€ï¼Œä¸”éƒ½ä¸å«å‰å¯¼é›¶ï¼ˆ<a href="https://github.com/toFrankie/blog/issues/83">è¯¦è§</a>ï¼‰ã€‚</p>
<ul>
<li><code>X</code> ä¸»è¦ç‰ˆæœ¬æ›´æ–°è¡¨ç¤ºä¸€ä¸ªç ´åå…¼å®¹æ€§çš„å¤§å˜åŒ–ã€‚</li>
<li><code>Y</code> æ¬¡è¦ç‰ˆæœ¬æ›´æ–°è¡¨ç¤ºä¸ä¼šç ´åä»»ä½•å†…å®¹çš„æ–°åŠŸèƒ½ã€‚</li>
<li><code>Z</code> è¡¥ä¸ç‰ˆæœ¬æ›´æ–°è¡¨ç¤ºä¸ä¼šç ´åä»»ä½•å†…å®¹çš„é”™è¯¯ä¿®å¤ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œä»¥ä¸Šåªæ˜¯çº¦å®šï¼Œä¸æ˜¯ä¸€å®šã€‚</p>
</blockquote>
<h2>npm ç‰ˆæœ¬è¯´æ˜</h2>
<p>æ¯”å¦‚ï¼Œä½¿ç”¨ <code>npm install eslint --save-dev</code> å®‰è£… ESLintã€‚</p>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;eslint&quot;: &quot;^6.7.1&quot;
  }
}
</code></pre>
<p>å…³äº <code>6.7.1</code> ã€<code>~6.7.1</code> ã€<code>^6.7.1</code> çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>6.7.1</code> è¡¨ç¤ºåªä¼šå®‰è£… <code>6.7.1</code> çš„ç‰ˆæœ¬ã€‚</li>
<li><code>~6.7.1</code> è¡¨ç¤ºå®‰è£… <code>[6.7.1, 6.8.0)</code> ä¹‹é—´ï¼ˆå½“å‰ï¼‰æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸æ”¹å˜ä¸»è¦ç‰ˆæœ¬å’Œæ¬¡è¦ç‰ˆæœ¬ã€‚</li>
<li><code>^6.7.1</code>ï¼šè¡¨ç¤ºå®‰è£… <code>[6.7.1, 7.0.0)</code> ä¹‹é—´ï¼ˆå½“å‰ï¼‰æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸æ”¹å˜ä¸»è¦ç‰ˆæœ¬ã€‚</li>
</ul>
<h2>package-lock.json çš„å¿…è¦æ€§</h2>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>npm install</code> å‘½ä»¤æ—¶ï¼Œå®é™…å®‰è£…çš„ç‰ˆæœ¬ä¸ <code>package.json</code> ä¸­ç‰ˆæœ¬æœ‰å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œå¯èƒ½æ˜¯ <code>6.8.x</code>ã€<code>6.9.x</code>ï¼Œå› ä¸º npm çš„é»˜è®¤æ–¹å¼æ˜¯ <code>^</code>ã€‚</p>
<p>è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šæ¯æ¬¡å®‰è£…çš„ npm åŒ…ç‰ˆæœ¬å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼ŒåŒæ—¶ä¼šå¸¦æ¥ä¸€äº›é£é™©ã€‚</p>
<blockquote>
<p>å‡è®¾ <code>6.7.1</code> ç‰ˆæœ¬æ˜¯æ²¡é—®é¢˜çš„ï¼Œç„¶åæœ€æ–°çš„ <code>6.8.0</code> ç‰ˆæœ¬æœ‰ bugã€‚æ­¤æ—¶ä¸€ä½æ–°åŒäº‹æŠŠé¡¹ç›®æ‹‰å–ä¸‹æ¥ä¹‹åï¼Œä½¿ç”¨ <code>npm install</code> å®‰è£…ä¾èµ–ï¼Œå…¶æœ¬åœ°æ˜¯ <code>6.8.0</code> ç‰ˆæœ¬ï¼Œè¿™æ—¶å€™é¡¹ç›®åœ¨æ–°åŒäº‹ç”µè„‘å°±å¯èƒ½è·‘ä¸èµ·æ¥äº†ã€‚è¿™ç§æƒ…å†µæ”¾åˆ°ç”Ÿäº§ä¸Šå°±ä¼šäº§ç”Ÿå¾ˆå¤§çš„é£é™©ã€‚</p>
</blockquote>
<p>å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p><code>package-lock.json</code> å‡ºåœºäº†ã€‚</p>
<p><code>npm install</code> çš„è¾“å…¥æ˜¯ <code>package.json</code>ï¼Œå®ƒçš„è¾“å‡ºæ˜¯ä¸€æ£µ <code>node_modules</code> æ ‘ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œ<code>npm install</code> åº”è¯¥åƒçº¯å‡½æ•°ä¸€æ ·å·¥ä½œï¼Œå¯¹äºåŒä¸€ä¸ª <code>package.json</code> æ€»æ˜¯ç”Ÿæˆå®Œå…¨ç›¸åŒçš„ <code>node_modules</code> æ ‘ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¡®å®å¦‚æ­¤ã€‚ä½†åœ¨å…¶ä»–å¾ˆå¤šæƒ…å†µä¸­ï¼Œ<code>npm</code> æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚æœ‰ä»¥ä¸‹åŸå› ï¼š</p>
<ul>
<li>ä¸åŒç‰ˆæœ¬çš„ <code>npm</code> çš„å®‰è£…ç®—æ³•ä¸åŒã€‚</li>
<li>æŸäº›ä¾èµ–é¡¹è‡ªä¸Šæ¬¡å®‰è£…ä»¥æ¥ï¼Œå¯èƒ½å·²å‘å¸ƒäº†æ–°ç‰ˆæœ¬ï¼Œå› æ­¤å°†æ ¹æ® <code>package.json</code> ä¸­çš„ <code>semver-range version</code> æ›´æ–°ä¾èµ–ã€‚</li>
<li>æŸä¸ªä¾èµ–é¡¹çš„ä¾èµ–é¡¹å¯èƒ½å·²å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå³ä½¿ä½ ä½¿ç”¨äº†å›ºå®šä¾èµ–é¡¹è¯´æ˜ç¬¦ï¼ˆæ¯”å¦‚ <code>1.2.3</code> è€Œä¸æ˜¯ <code>^1.2.3</code> ï¼‰ï¼Œå®ƒä¹Ÿä¼šæ›´æ–°ï¼Œå› ä¸ºä½ æ— æ³•å›ºå®šå­ä¾èµ–é¡¹çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;eslint&quot;: &quot;^6.7.1&quot;
  }
}
</code></pre>
<p>è€Œä¾èµ–é¡¹ç‰ˆæœ¬æ›´æ–°å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šåŒäº‹ A æ–°å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œç”Ÿæˆäº†ä¸Šé¢è¿™ä»½ <code>package.json</code> æ–‡ä»¶ï¼Œä½†åŒäº‹ A å®‰è£…ä¾èµ–çš„æ—¶é—´æ¯”è¾ƒæ—©ï¼Œæ­¤æ—¶ <code>packageA</code> çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ <code>6.7.1</code>ï¼Œè¯¥ç‰ˆæœ¬ä¸ä»£ç å…¼å®¹ï¼Œæ²¡æœ‰å‡ºç° bugã€‚åæ¥åŒäº‹ B å…‹éš†äº†åŒäº‹ A çš„é¡¹ç›®ï¼Œåœ¨å®‰è£…ä¾èµ–æ—¶ <code>packageA</code> çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ <code>6.8.0</code>ï¼Œé‚£ä¹ˆæ ¹æ®è¯­ä¹‰åŒ– <code>npm</code> ä¼šå»å®‰è£… <code>6.8.0</code> çš„ç‰ˆæœ¬ï¼Œä½† <code>6.8.0</code> ç‰ˆæœ¬çš„ API å¯èƒ½å‘ç”Ÿäº†æ”¹åŠ¨ï¼Œå¯¼è‡´ä»£ç å‡ºç° bugã€‚</p>
<p>è¿™å°±æ˜¯ <code>package.json</code> ä¼šå¸¦æ¥çš„é—®é¢˜ï¼ŒåŒä¸€ä»½ <code>package.json</code> åœ¨ä¸åŒçš„æ—¶é—´å’Œç¯å¢ƒä¸‹å®‰è£…ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚</p>
<p>ç†è®ºä¸Šè¿™ä¸ªé—®é¢˜æ˜¯ä¸åº”è¯¥å‡ºç°çš„ï¼Œå› ä¸º <code>npm</code> ä½œä¸ºå¼€æºä¸–ç•Œçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿéµå¾ªä¸€ä¸ªå‘å¸ƒåŸåˆ™ï¼šç›¸åŒå¤§ç‰ˆæœ¬å·ä¸‹çš„æ–°ç‰ˆæœ¬åº”è¯¥å…¼å®¹æ—§ç‰ˆæœ¬ã€‚å³ <code>6.7.1</code> å‡çº§åˆ° <code>6.8.0</code> æ—¶åŒä¸€ API ä¸åº”è¯¥å‘ç”Ÿå˜åŒ–ã€‚å¯ä¸€æ—¦å¼€å‘è€…å¹¶æ²¡æœ‰ä¸¥æ ¼éµå®ˆè¯­ä¹‰åŒ–çš„åŸåˆ™å»æ›´æ–°åŒ…ï¼Œå°±ä¼šå¯¼è‡´ä½¿ç”¨è€…çš„ã€‚</p>
<p>ä¸ºäº†åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ç”Ÿæˆç›¸åŒçš„ <code>node_modules</code>ï¼Œ<code>npm</code> ä½¿ç”¨ <code>package-lock.json</code>ã€‚æ— è®ºä½•æ—¶è¿è¡Œ <code>npm install</code>ï¼Œ<code>npm</code> éƒ½ä¼šç”Ÿæˆæˆ–æ›´æ–° <code>package-lock.json</code>ã€‚</p>
<h2>ä¸åŒ npm ç‰ˆæœ¬ä¸‹ npm install çš„åŒºåˆ«</h2>
<ul>
<li>
<p><code>npm 5.0.x</code> ç‰ˆæœ¬ï¼šä¸ç®¡ <code>package.json</code> ä¸­ä¾èµ–æ˜¯å¦æœ‰æ›´æ–°ï¼Œ<code>npm install</code> éƒ½ä¼šæ ¹æ® <code>package-lock.json</code> ä¸‹è½½ã€‚é’ˆå¯¹è¿™ç§å®‰è£…ç­–ç•¥ï¼Œæœ‰äººæå‡ºäº† <a href="https://github.com/npm/npm/issues/16866">issue #16866</a>Â ï¼Œç„¶åå°±æ¼”å˜æˆäº† <code>5.1.0</code> ç‰ˆæœ¬åçš„è§„åˆ™ã€‚</p>
</li>
<li>
<p><code>5.1.0</code> ç‰ˆæœ¬åï¼šå½“ <code>package.json</code> ä¸­çš„ä¾èµ–é¡¹æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼Œ<code>npm install</code> ä¼šæ— è§† <code>package-lock.json</code> å»ä¸‹è½½æ–°ç‰ˆæœ¬çš„ä¾èµ–é¡¹å¹¶ä¸”æ›´æ–° <code>package-lock.json</code>ã€‚é’ˆå¯¹è¿™ç§å®‰è£…ç­–ç•¥ï¼Œåˆæœ‰äººæå‡ºäº† <a href="https://github.com/npm/npm/issues/17979">issue #17979</a>ï¼Œå‚è€ƒ npm è´¡çŒ®è€… iarna çš„è¯„è®ºï¼Œå¾—å‡º <code>5.4.2</code> ç‰ˆæœ¬åçš„è§„åˆ™ã€‚</p>
</li>
</ul>
<ul>
<li><code>5.4.2</code> ç‰ˆæœ¬åï¼š
<ul>
<li>
<p>å¦‚æœåªæœ‰ä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼Œè¿è¡Œ <code>npm install</code> ä¼šæ ¹æ®å®ƒç”Ÿæˆä¸€ä¸ª <code>package-lock.json</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç›¸å½“äºæœ¬æ¬¡ <code>install</code> çš„ä¸€ä¸ªå¿«ç…§ï¼Œå®ƒä¸ä»…è®°å½•äº† <code>package.json</code> æŒ‡æ˜çš„ç›´æ¥ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä¹Ÿè®°å½•äº†é—´æ¥ä¾èµ–çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p>å¦‚æœ <code>package.json</code> çš„ semver-range version å’Œ <code>package-lock.json</code> ä¸­ç‰ˆæœ¬å…¼å®¹ï¼ˆ<code>package-lock.json</code>ç‰ˆæœ¬åœ¨<code>package.json</code>æŒ‡å®šçš„ç‰ˆæœ¬èŒƒå›´å†…ï¼‰ï¼Œå³ä½¿æ­¤æ—¶ <code>package.json</code> ä¸­æœ‰æ–°çš„ç‰ˆæœ¬ï¼Œæ‰§è¡Œ <code>npm install</code> ä¹Ÿè¿˜æ˜¯ä¼šæ ¹æ® <code>package-lock.json</code> ä¸‹è½½ï¼ˆå®è·µåœºæ™¯ä¸€ï¼‰ã€‚</p>
</li>
<li>
<p>å¦‚æœæ‰‹åŠ¨ä¿®æ”¹äº† <code>package.json</code> çš„ <code>version ranges</code>ï¼Œä¸”å’Œ <code>package-lock.json</code> ä¸­ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>npm i</code> æ—¶ <code>package-lock.json</code> å°†ä¼šæ›´æ–°åˆ°å…¼å®¹ <code>package.json</code> çš„ç‰ˆæœ¬ï¼ˆå®è·µåœºæ™¯äºŒï¼‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š<code>npm install</code> è¯»å– <code>package.json</code> åˆ›å»ºä¾èµ–é¡¹åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨ <code>package-lock.json</code> æ¥é€šçŸ¥è¦å®‰è£…è¿™äº›ä¾èµ–é¡¹çš„å“ªä¸ªç‰ˆæœ¬ã€‚å¦‚æœæŸä¸ªä¾èµ–é¡¹åœ¨ <code>package.json</code> ä¸­ï¼Œä½†æ˜¯ä¸åœ¨ <code>package-lock.json</code> ä¸­ï¼Œè¿è¡Œ <code>npm install</code> ä¼šå°†è¿™ä¸ªä¾èµ–é¡¹çš„ç¡®å®šç‰ˆæœ¬æ›´æ–°åˆ° <code>package-lock.json</code> ä¸­ï¼Œä¸ä¼šæ›´æ–°å…¶å®ƒä¾èµ–é¡¹çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p><strong>åœºæ™¯ä¸€</strong></p>
<p><code>package.json</code></p>
<pre><code class="language-json">{
  &quot;dependencies&quot;: {
    &quot;eslint&quot;: &quot;^6.7.1&quot;
  }
}
</code></pre>
<p><code>package-lock.json</code></p>
<pre><code>{
  &quot;eslint&quot;: {
    &quot;version&quot;: &quot;6.8.0&quot;,
    &quot;resolved&quot;: &quot;https://registry.npm.taobao.org/eslint/download/eslint-6.8.0.tgz?cache=0&amp;sync_timestamp=1595098436203&amp;other_urls=https%3A%2F%2Fregistry.npm.taobao.org%2Feslint%2Fdownload%2Feslint-6.8.0.tgz&quot;,
    &quot;integrity&quot;: &quot;sha1-YiYtZylzn5J1cjgkMC+yJ8jJP/s=&quot;
  }
}
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ <code>package-lock.json</code> æŒ‡å®šçš„ <code>6.8.0</code> åœ¨ <code>^6.7.1</code> æŒ‡å®šçš„èŒƒå›´å†…ï¼Œ<code>npm install</code> ä¼šå®‰è£… <code>6.8.0</code> ç‰ˆæœ¬ï¼Œä¸”ä¸ä¼šæ›´æ–° <code>package.json</code> å’Œ <code>package-lock.json</code> è®°å½•ã€‚</p>
<p><strong>åœºæ™¯äºŒ</strong></p>
<p><code>package.json</code></p>
<pre><code class="language-json">{
  &quot;dependencies&quot;: {
    &quot;eslint&quot;: &quot;^6.8.0&quot;
  }
}
</code></pre>
<p><code>package-lock.json</code></p>
<pre><code>{
  &quot;eslint&quot;: {
    &quot;version&quot;: &quot;6.7.1&quot;,
    &quot;resolved&quot;: &quot;https://registry.npm.taobao.org/eslint/download/eslint-6.7.1.tgz?cache=0&amp;sync_timestamp=1595098436203&amp;other_urls=https%3A%2F%2Fregistry.npm.taobao.org%2Feslint%2Fdownload%2Feslint-6.7.1.tgz&quot;,
    &quot;integrity&quot;: &quot;sha1-JpzMzsPvYKsyNYpE0UesIJFUuRk=&quot;
  }
}
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ <code>package-lock.json</code> æŒ‡å®šçš„ <code>6.7.1</code> ä¸åœ¨ <code>^6.8.0</code> æŒ‡å®šçš„èŒƒå›´å†…ï¼Œ<code>npm install</code> ä¼šæŒ‰ç…§ <code>^6.8.0</code> çš„è§„åˆ™å»å®‰è£…æœ€æ–°çš„ <code>6.8.0</code> ç‰ˆæœ¬ï¼Œå¹¶ä¸”å°† <code>package-lock.json</code> çš„ç‰ˆæœ¬æ›´æ–°ä¸º <code>6.8.0</code>ã€‚</p>
<h2>npm ci</h2>
<h3>ä»‹ç»</h3>
<ul>
<li>ciï¼šContinuous Integrationã€‚</li>
<li>npm ç‰ˆæœ¬è‡³å°‘æ˜¯ <code>v5.7.1</code>ã€‚</li>
<li>æ­¤å‘½ä»¤ä¸ <code>npm install</code> ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ—¨åœ¨ç”¨äºè‡ªåŠ¨åŒ–ç¯å¢ƒï¼Œä¾‹å¦‚é›†æˆæµ‹è¯•ç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒã€æˆ–è€…æ‚¨å¸Œæœ›ç¡®ä¿å¹²å‡€å®‰è£…ä¾èµ–é¡¹çš„ä»»ä½•æƒ…å†µã€‚é€šè¿‡è·³è¿‡æŸäº›é¢å‘ç”¨æˆ·çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„ <code>npm install</code> å¿«å¾—å¤šã€‚å®ƒä¹Ÿæ¯”å¸¸è§„å®‰è£…æ›´ä¸¥æ ¼ï¼Œå®ƒå¯ä»¥æ•è·ç”±äºæœ¬åœ°ç¯å¢ƒçš„å¢é‡å®‰è£…å¼•èµ·çš„é”™è¯¯æˆ–ä¸ä¸€è‡´ã€‚</li>
<li><code>npm ci</code> æ˜¯æ ¹æ® <code>package-lock.json</code> å»å®‰è£…ç¡®å®šçš„ä¾èµ–ï¼Œ<code>package.json</code> åªæ˜¯ç”¨æ¥éªŒè¯æ˜¯ä¸æ˜¯æœ‰ä¸åŒ¹é…çš„ç‰ˆæœ¬ï¼Œå‡è®¾ <code>package-lock.json</code> ä¸­å­˜åœ¨ä¸€ä¸ªç¡®å®šç‰ˆæœ¬çš„ä¾èµ– Aï¼Œå¦‚æœ <code>package.json</code> ä¸­ä¸å­˜åœ¨ä¾èµ– A æˆ–è€…ä¾èµ– A ç‰ˆæœ¬å’Œ <code>package-lock.json</code> ä¸­ä¸å…¼å®¹ï¼Œ<code>npm ci</code> å°±ä¼šæŠ¥é”™ã€‚</li>
</ul>
<h3>npm ci å’Œ npm install å·®å¼‚</h3>
<ul>
<li>é¡¹ç›®å¿…é¡»å­˜åœ¨ <code>package-lock.json</code> æˆ– <code>npm-shrinkwrap.json</code>ã€‚</li>
<li>å¦‚æœ <code>package-lock.json</code> ä¸­çš„ä¾èµ–å’Œ <code>package.json</code> ä¸­ä¸åŒ¹é…ï¼Œ<code>npm ci</code> ä¼šé€€å‡ºå¹¶ä¸”æŠ¥é”™ï¼Œè€Œä¸æ˜¯å»æ›´æ–° <code>package-lock.json</code>ã€‚</li>
<li><code>npm ci</code> åªèƒ½å®‰è£…æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–ï¼Œæ— æ³•å®‰è£…å•ä¸ªä¾èµ–ã€‚</li>
<li>å¦‚æœ <code>node_modules</code> å·²ç»å­˜åœ¨ï¼Œå®ƒå°†åœ¨ <code>npm ci</code> å¼€å§‹å®‰è£…ä¹‹å‰è‡ªåŠ¨åˆ é™¤ã€‚
<code>npm ci</code> æ°¸è¿œä¸ä¼šæ”¹å˜ <code>package.json</code> å’Œ <code>package-lock.json</code>ã€‚</li>
</ul>
<h3>npm å’Œ cnpm çš„å·®å¼‚</h3>
<ul>
<li><code>cnpm i</code> ä¸å— <code>package-lock.json</code> å½±å“ï¼Œåªä¼šæ ¹æ® <code>package.json</code> è¿›è¡Œä¸‹è½½ã€‚</li>
<li><code>cnpm i xxx@xxx</code> ä¸ä¼šè·Ÿæ–°åˆ° <code>package-lock.json</code> ä¸­å»ã€‚</li>
<li><code>npm i xxx@xxx</code> ä¼šè·Ÿæ–°åˆ° <code>package-lock.json</code> ä¸­å»ã€‚</li>
</ul>
<h2>å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/cangqinglang/p/8336754.html">package-lock.json çš„ä½œç”¨</a></li>
<li><a href="https://blog.csdn.net/qq_24504591/article/details/100134272">npmã€cnpm ä¸ package-lock.json çš„æ“ä½œ</a></li>
<li><a href="https://blog.csdn.net/weixin_43820866/article/details/105232066">npm çš„ package.json å’Œ package-lock.json æ›´æ–°ç­–ç•¥</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è¯­ä¹‰åŒ–ç‰ˆæœ¬ SemVer]]></title>
            <link>https://github.com/toFrankie/blog/issues/83</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/83</guid>
            <pubDate>Sat, 25 Feb 2023 12:13:15 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1747391069076.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ç”±äºç‰ˆæœ¬æ§åˆ¶åªæ˜¯ä¸€ç§çº¦å®šï¼Œæ¯ä¸ªå…·ä½“é¡¹]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/5/1747391069076.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>[!NOTE]
ç”±äºç‰ˆæœ¬æ§åˆ¶åªæ˜¯ä¸€ç§çº¦å®šï¼Œæ¯ä¸ªå…·ä½“é¡¹ç›®çš„è§£è¯»å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› æ­¤ä½ <strong>ä¸åº”</strong>ç›²ç›®ä¿¡ä»»å®ƒã€‚</p>
</blockquote>
<h2>ç®€ä»‹</h2>
<p>SemVer åä¸ºè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå…¨ç§° Semantic Versioningã€‚</p>
<p>SemVer æ ¼å¼å¦‚ä¸‹ï¼Œå‡æ˜¯ï¼ˆä¸å«å‰å¯¼é›¶çš„ï¼‰éè´Ÿæ•´æ•°ã€‚ä¾‹å¦‚ <code>1.2.5</code>ã€<code>2.0.0</code> ç­‰ã€‚</p>
<pre><code>MAJOR.MINOR.PATCH
</code></pre>
<ul>
<li><code>MAJOR</code> ä¸»ç‰ˆæœ¬å·</li>
<li><code>MINOR</code> æ¬¡ç‰ˆæœ¬å·</li>
<li><code>PATCH</code> è¡¥ä¸ç‰ˆæœ¬</li>
</ul>
<p>æ›´æ–°çº¦å®šï¼š</p>
<ul>
<li>ä¸»ç‰ˆæœ¬å·æ›´æ–°ï¼šè¡¨ç¤ºä¸€ä¸ªç ´åå…¼å®¹æ€§çš„å¤§å˜åŒ–ã€‚</li>
<li>æ¬¡ç‰ˆæœ¬å·æ›´æ–°ï¼šè¡¨ç¤ºä¸ä¼šç ´åä»»ä½•å†…å®¹çš„æ–°åŠŸèƒ½ã€‚</li>
<li>è¡¥ä¸ç‰ˆæœ¬å·æ›´æ–°ï¼šè¡¨ç¤ºä¸ä¼šç ´åä»»ä½•å†…å®¹çš„é”™è¯¯ä¿®å¤ã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘åä¸å…¼å®¹çš„ API å˜æ›´åº”å¢åŠ ä¸»è¦ç‰ˆæœ¬ï¼›å‘åå…¼å®¹çš„ API æ·»åŠ æˆ–æ›´æ”¹å¢åŠ æ¬¡è¦ç‰ˆæœ¬ï¼›é”™è¯¯ä¿®å¤ä¸å½±å“ API åº”å¢åŠ è¡¥ä¸ç‰ˆæœ¬ã€‚</p>
<h2>npm ç‰ˆæœ¬èŒƒå›´</h2>
<p>npm é»˜è®¤çš„ç‰ˆæœ¬èŒƒå›´å‰ç¼€æ˜¯ <code>^</code>ã€‚</p>
<p>åœ¨å¿½ç•¥ lock æ–‡ä»¶ä½œç”¨çš„å‰æä¸‹ï¼Œæ‰§è¡Œ npm install æ—¶å®é™…å®‰è£…çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<p><strong>1.x åŠä»¥ä¸Šç‰ˆæœ¬</strong></p>
<ul>
<li><code>1.2.5</code>ï¼šå°†ä¼šå®‰è£… <code>1.2.5</code> çš„ç‰ˆæœ¬ã€‚</li>
<li><code>~1.2.5</code>ï¼šå°†ä¼šå®‰è£… <code>[1.2.5, 1.3.0)</code> ä¹‹é—´æœ€æ–°çš„ç‰ˆæœ¬ã€‚</li>
<li><code>^1.2.5</code>ï¼šå°†ä¼šå®‰è£… <code>[1.2.5, 2.0.0)</code> ä¹‹é—´æœ€æ–°çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<p><strong>0.x ç‰ˆæœ¬</strong></p>
<p>å¯¹äº 0.x çš„ç‰ˆæœ¬ï¼Œnpm å°†å…¶è§†ä¸ºä¸ç¨³å®šçš„ç‰ˆæœ¬ï¼Œå®‰è£…ç­–ç•¥ä¼šæ›´ä¿å®ˆã€‚</p>
<ul>
<li><code>^0.2.5</code>ï¼šå°†ä¼šå®‰è£… <code>[0.2.5, 0.3.0)</code> ä¹‹é—´æœ€æ–°çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<p>é™¤äº†å¸¸è§çš„ <code>^</code>ã€<code>~</code> ä¹‹å¤–ï¼Œnpm è¿˜æ”¯æŒ <code>&gt;</code>ã€<code>&gt;=</code> ç­‰<a href="https://docs.npmjs.com/cli/v11/configuring-npm/package-json#dependencies">æ›´å¤š</a>ç‰ˆæœ¬èŒƒå›´ã€‚</p>
<h2>æ‰©å±•é˜…è¯»</h2>
<ul>
<li><a href="https://antfu.me/posts/epoch-semver">Epoch Semantic Versioning</a></li>
<li><a href="https://github.com/ChronVer/chronver">Chronologic Versioning</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://semver.org/">Semantic Versioning Spec</a></li>
<li><a href="https://github.com/npm/node-semver">The semantic versioner for npm</a></li>
<li><a href="https://semver.npmjs.com/">npm SemVer Calculator</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ cnpmï¼Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/82</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/82</guid>
            <pubDate>Sat, 25 Feb 2023 12:12:18 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a6465ca0ee7a6ac1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a6465ca0ee7a6ac1.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨å‰ç«¯é¡¹ç›®æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œ<code>npm</code>ã€<code>yarn</code> åº”è¯¥æ˜¯å½“å‰ä½¿ç”¨å¾—æœ€é¢‘ç¹çš„åŒ…ç®¡ç†å·¥å…·äº†ï¼Œä»–ä»¬å¸®åŠ©æˆ‘ä»¬è§£å†³äº†å¤æ‚çš„ä¾èµ–å…³ç³»ã€‚åœ¨ä½¿ç”¨ <code>npm</code> ä¸‹è½½åŒ…æ—¶ï¼Œç”±äºæ˜¯ä»å›½å¤–çš„ NPM æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œå¯¼è‡´æœ‰æ—¶å®‰è£…ç¬¬ä¸‰æ–¹åŒ…åˆ°æœ¬åœ°æ—¶å¾ˆæ…¢ï¼Œå¾ˆè›‹ç–¼å§ã€‚</p>
<p>äºæ˜¯å°±æœ‰äº† <code>cnpm</code>ï¼Œè¿™æ˜¯æ·˜å®å›¢é˜Ÿåšçš„<a href="https://www.npmmirror.com">æ·˜å® NPM é•œåƒ</a>ã€‚ä½ å¯ä»¥æ”¾å¿ƒåœ°ç”¨ <code>cnpm</code> æ¥ä»£æ›¿ <code>npm</code>ï¼Œå› ä¸ºå®ƒåŒæ­¥é¢‘ç‡ä¸º 10 åˆ†é’Ÿä¸€æ¬¡ï¼Œä»¥ä¿è¯å°½é‡ä¸å®˜æ–¹æœåŠ¡åŒæ­¥ã€‚</p>
<p>å¦‚æœéœ€è¦é©¬ä¸Šæ›´æ–°ï¼Œ<code>cnpm</code> æä¾›äº†ä¸€ä¸ªç‰¹æœ‰å‘½ä»¤ <code>cnpm sync &lt;pkg-name&gt;</code> æ¥åŒæ­¥æŸä¸ªæ¨¡å—ã€‚</p>
<blockquote>
<p>[!IMPORTANT]
åŸæ·˜å® npm åŸŸåå³å°†åœæ­¢è§£æï¼Œè¯·åˆ‡æ¢è‡³æ–°åŸŸåÂ <a href="http://www.npmmirror.com/">npmmirror.com</a>ï¼Œ<code>http://npm.taobao.org</code>å’ŒÂ <code>http://registry.npm.taobao.org</code>Â å°†åœ¨Â 2022.06.30Â å·æ­£å¼ä¸‹çº¿å’Œåœæ­¢ DNS è§£æã€‚</p>
</blockquote>
<p>ç›¸å…³åŸŸååˆ‡æ¢å‚è€ƒå¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">http://npm.taobao.org =&gt; https://npmmirror.com
http://registry.npm.taobao.org =&gt; https://registry.npmmirror.com
</code></pre>
<h4>ä¸€ã€ä½¿ç”¨ cnpmï¼ˆä¸æ¨èï¼‰</h4>
<p>ä½¿ç”¨ <code>cnpm</code> å‘½ä»¤æ›¿ä»£ <code>npm</code>ï¼Œå®‰è£…éå¸¸åœ°ç®€å•ã€‚</p>
<blockquote>
<p>å®ƒæ”¯æŒ npm é™¤äº† <code>npm publish</code> ä¹‹å¤–çš„æ‰€æœ‰å‘½ä»¤ã€‚</p>
</blockquote>
<ol>
<li>å®‰è£…</li>
</ol>
<pre><code class="language-shell">$ npm i -g cnpm --registry=https://registry.npmmirror.com/
</code></pre>
<ol start="2">
<li>æµ‹è¯•æ˜¯å¦æˆåŠŸå®‰è£…</li>
</ol>
<pre><code class="language-shell">$ cnpm -v
</code></pre>
<ol start="3">
<li>å®‰è£…æ¨¡å—</li>
</ol>
<pre><code class="language-shell">$ cnpm install [name]
</code></pre>
<h4>äºŒã€æ›¿æ¢ npm é•œåƒæº</h4>
<p>å°½ç®¡æˆ‘ä»¬å®‰è£…å¹¶ä½¿ç”¨ <code>cnpm</code>ï¼Œä½†æ˜¯æœ‰ä¸€äº›å‘½ä»¤ï¼ˆå¦‚ <code>create-react-app</code> ç­‰ï¼‰å®ƒä»¬å†…éƒ¨è¿˜æ˜¯ä½¿ç”¨äº† <code>npm</code> å‘½ä»¤ï¼Œä»æ˜¯è®¿é—®å›½å¤–çš„é•œåƒæºï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šæ…¢ã€‚</p>
<p>é¦–å…ˆï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ–è®¾ç½® <code>npm</code> çš„æºåœ°å€ï¼š</p>
<pre><code class="language-shell"># æŸ¥çœ‹ registry
$ npm config get registry

# è®¾ç½® registry
$ npm config set registry &lt;registry-url&gt;
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬å°†å…¶ä¿®æ”¹ä¸ºæ·˜å®é•œåƒæºï¼š</p>
<pre><code class="language-shell">$ npm config set registry https://registry.npmmirror.com/
</code></pre>
<p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ <code>~/.npmrc</code> ä¸­æ·»åŠ ä¸€è¡Œé…ç½®å¹¶ä¿å­˜ï¼š</p>
<pre><code class="language-text">registry=https://registry.npm.taobao.org/
</code></pre>
<h4>ä¸‰ã€å®‰è£…ä¾èµ–åŒ…æ—¶ï¼Œç›´æ¥æŒ‡å®šé•œåƒæº</h4>
<p>è¿™ç§æ–¹å¼å¤ªéº»çƒ¦äº†ï¼Œæ¯æ¬¡éƒ½è¦åŠ ä¸Šé•œåƒæºåœ°å€ã€‚</p>
<pre><code class="language-shell">$ npm i &lt;package&gt; --registry=https://registry.npmmirror.com
</code></pre>
<h4>å››ã€ä¸ºä»€ä¹ˆä¸æ¨è cnpm å‘¢ï¼Ÿ</h4>
<p>é¦–å…ˆï¼Œä½¿ç”¨ <code>npm</code> ä½œä¸ºå‰ç«¯é¡¹ç›®åŒ…ç®¡ç†å·¥å…·çš„è¯ï¼Œä½¿ç”¨ <code>npm</code> å’Œ <code>cnpm</code> æ¥å®‰è£…åŒ…æ—¶æœ‰åŒºåˆ«çš„ã€‚é€šå¸¸æˆ‘ä»¬å‰ç«¯é¡¹ç›®ä¸­éƒ½ä¼šæœ‰ <code>package-lock.json</code> æ–‡ä»¶ï¼ˆå…¶ä½œç”¨å¯çœ‹<a href="https://www.cnblogs.com/cangqinglang/p/8336754.html">æ–‡ç« </a>ï¼‰ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤å¯¹å…¶æœ‰ä¸€å®šçš„å½±å“ï¼š</p>
<blockquote>
<ul>
<li><code>cnpm i</code>ä¸å— <code>package-lock.json</code> å½±å“ï¼Œåªä¼šæ ¹æ® <code>package.json</code> è¿›è¡Œä¸‹è½½å®‰è£…ã€‚</li>
<li><code>cnpm i xxx@xxx</code>ä¸ä¼šè·Ÿæ–°åˆ° <code>package-lock.json</code> ä¸­å»ã€‚</li>
<li><code>npm i xxx@xxx</code> ä¼šè·Ÿæ–°åˆ° <code>package-lock.json</code> ä¸­å»ã€‚</li>
</ul>
<p>åœ¨å¤šäººå…±åŒåä½œç»´æŠ¤çš„é¡¹ç›®ä¸­ï¼Œ<code>package-lock.json</code> æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæ˜¯ä¸ºäº†ç¡®ä¿ä¸åŒå¼€å‘è€…å®‰è£…çš„åŒ…åŠå…¶ä¾èµ–ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é™ä½ä¸åŒç‰ˆæœ¬ npm åŒ…ç»™é¡¹ç›®ç¨³å®šæ€§å¸¦æ¥çš„å½±å“ã€‚å°¤å…¶æ˜¯ä¸€äº›ä¸éµå¾ª<a href="https://github.com/toFrankie/blog/issues/83">è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶</a>çš„ç¬¬ä¸‰æ–¹ npm åŒ…ï¼Œå°±å¾ˆå®¹æ˜“è¢«å‘åˆ°ã€‚</p>
</blockquote>
<h4>äº”ã€ç”¨æ›´å¥½çš„æ–¹å¼å—ï¼Ÿ</h4>
<p>é€šå¸¸ï¼Œä¸ªäººåœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¾—æ›´å¤šçš„æ˜¯ <a href="https://yarnpkg.com/">yarn</a>ã€‚ç®¡ç†é•œåƒæºæ¨èä½¿ç”¨ <code>nrm</code> æˆ– <code>yrm</code>ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢é•œåƒæºã€‚å‰è€…ä»…ä¼šä¿®æ”¹ <code>npm</code> é•œåƒæºï¼Œåè€…ä¼šåŒæ—¶ä¿®æ”¹ <code>npm</code> å’Œ <code>yarn</code> é•œåƒæºã€‚</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/89">nrm ä½¿ç”¨è¯¦è§£</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/91">ä¸€ä¸ªæ¯” nrm æ›´å¥½ç”¨çš„é•œåƒæºç®¡ç†å·¥å…·</a></li>
</ul>
<p>å¦å¤–ï¼Œä½ æœ‰å°è¯•è¿‡ <a href="https://pnpm.io/">pnpm</a> å’Œ <a href="https://github.com/nodejs/corepack">corepack</a> å—ï¼Ÿ</p>
<p>å…³äºä¸€äº›å…¨å±€ä¾èµ–åŒ…ï¼Œä¸ªäººä½¿ç”¨ä¹ æƒ¯æ˜¯ï¼šä¸ Node ç‰ˆæœ¬æœ‰å…³çš„ä½¿ç”¨ <code>npm</code> å®‰è£…ï¼ˆæ¯”å¦‚ Taro CLI ç­‰ï¼‰å¹¶é…åˆ <code>nvm</code> å·¥å…·è¿›è¡Œç®¡ç†ï¼Œå…¶ä»–çš„ä¸€èˆ¬ä½¿ç”¨ <code>yarn</code> è¿›è¡Œå®‰è£…ã€‚</p>
<p>ç®¡ç† Node ç‰ˆæœ¬æ¨èä½¿ç”¨ <a href="https://github.com/nvm-sh/nvm">nvm</a> å·¥å…·ï¼Œä½†è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨äº† <code>nvm</code> å»ºè®®ç§»é™¤ <code>~/.npmrc</code> ä¸­çš„ <code>prefix</code> é…ç½®é¡¹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦åˆ™å…¨å±€åŒ…å¯èƒ½ä¼šå®‰è£…åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œè€Œä¸ä¼šéšç€ Node çš„åˆ‡æ¢è€Œå˜åŒ–ï¼ˆåŸå› çœ‹<a href="https://github.com/nvm-sh/nvm#important-notes">è¿™é‡Œ</a>ï¼‰ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac è§£å†³ gyp: No Xcode or CLT version detected! æŠ¥é”™]]></title>
            <link>https://github.com/toFrankie/blog/issues/81</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/81</guid>
            <pubDate>Sat, 25 Feb 2023 12:11:14 GMT</pubDate>
            <description><![CDATA[<p>æˆ‘çš„ç³»ç»Ÿç‰ˆæœ¬æ˜¯ <strong>macOS Catalina 10.15.5</strong>ã€‚</p>
<p>æœ€è¿‘åœ¨æ‰§è¡Œå‘½ä»¤ <code>cnpm install</code> æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<pre><code class="language-shell">No receipt for 'co]]></description>
            <content:encoded><![CDATA[<p>æˆ‘çš„ç³»ç»Ÿç‰ˆæœ¬æ˜¯ <strong>macOS Catalina 10.15.5</strong>ã€‚</p>
<p>æœ€è¿‘åœ¨æ‰§è¡Œå‘½ä»¤ <code>cnpm install</code> æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<pre><code class="language-shell">No receipt for 'com.apple.pkg.CLTools_Executables' found at '/'.

No receipt for 'com.apple.pkg.DeveloperToolsCLILeo' found at '/'.

No receipt for 'com.apple.pkg.DeveloperToolsCLI' found at '/'.

gyp: No Xcode or CLT version detected!

gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/local/lib/node_modules/cnpm/node_modules/_node-gyp@3.8.0@node-gyp/lib/configure.js:345:16)
gyp ERR! stack     at ChildProcess.emit (events.js:210:5)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:272:12)
gyp ERR! System Darwin 19.5.0
gyp ERR! command &quot;/usr/local/bin/node&quot; &quot;/usr/local/lib/node_modules/cnpm/node_modules/_npminstall@3.27.0@npminstall/node-gyp-bin/node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd /Users/frankie/Desktop/Webå‰ç«¯/å®Œæ•´Demo/Reacté¡¹ç›®/ReactDemo/node_modules/_fsevents@1.2.13@fsevents
gyp ERR! node -v v12.13.1
gyp ERR! node-gyp -v v3.8.0
gyp ERR! not ok 
</code></pre>
<p>ç„¶åç½‘ä¸ŠæœæŸ¥äº†ä¸€ç•ªï¼Œåº”è¯¥æ˜¯ XCode çš„é—®é¢˜ã€‚è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š</p>
<p><strong>1. åˆ é™¤å·²ç»å®‰è£…çš„ CommandLineToolsã€‚</strong></p>
<pre><code class="language-shell">$ sudo rm -rf $(xcode-select -p)
</code></pre>
<p><strong>2. é‡æ–°å®‰è£…ï¼Œç„¶ååŒæ„æ¡æ¬¾é€‰æ‹©</strong>ï¼ˆæˆ‘ä¸ªäººæ²¡å°è¯•ï¼Œå› ä¸º XCode æœ‰ 8.1Gï¼Œä¸æƒ³å®‰è£…ï¼‰</p>
<pre><code class="language-shell">$ sudo xcode-select --install
</code></pre>
<p>æˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹å¼ï¼Œåˆ é™¤å®Œå†æ‰§è¡Œ <code>cnpm install</code>ï¼Œå¦‚ä¸‹ã€‚å¾ˆå¥½ï¼Œä¸€ä¸ª ERROR å’Œ WARNING éƒ½æ²¡æœ‰ã€‚</p>
<pre><code class="language-shell">$ cnpm install
âœ” Installed 54 packages
âœ” Linked 0 latest versions
âœ” Run 0 scripts
âœ” All packages installed (used 114ms(network 102ms), speed 0B/s, json 0(0B), tarball 0B)
</code></pre>
<p>æˆ‘çŒœæµ‹åŸå› å¯èƒ½æ˜¯ï¼Œæœ€è¿‘ä» 10.14 å‡çº§åˆ° 10.15ï¼Œç„¶åå› ä¸ºéƒ¨åˆ†ç¬¬ä¸‰æ–¹æ’ä»¶éœ€è¦å®‰è£…è¿‡ CommandLineToolsï¼Œæ²¡æœ‰æ‰“å¼€è¿‡è¯¥å·¥å…·åŒæ„æ¡æ¬¾ï¼Œç„¶åå‡ºç°è¿™ç§é—®é¢˜çš„å§ã€‚ï¼ˆçº¯ä¸ªäººçŒœæµ‹ï¼ŒçœŸæ­£åŸå› æœªè¯å®ï¼‰</p>
<h3>References</h3>
<ul>
<li><a href="https://segmentfault.com/a/1190000021394623">Mac è§£å†³ gyp: No Xcode or CLT version detected! æŠ¥é”™</a></li>
<li><a href="https://allanphilipbarku.medium.com/gyp-no-xcode-or-clt-version-detected-macos-big-sur-anansewaa-com-7fe936ee1623">gyp: No Xcode or CLT version detected macOS Big Sur</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Cannot find module 'webpack-cli/bin/config-yargs']]></title>
            <link>https://github.com/toFrankie/blog/issues/80</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/80</guid>
            <pubDate>Sat, 25 Feb 2023 12:09:43 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2da08faab8ab4245.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2da08faab8ab4245.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä»Šå¤©åˆ›å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›®</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;webpack-dev-server&quot;,
    &quot;build&quot;: &quot;webpack --progress --colors&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^5.42.0&quot;,
    &quot;webpack-cli&quot;: &quot;^4.7.2&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;
  }
}
</code></pre>
<p>ç„¶è€Œå¯åŠ¨é¡¹ç›®æ—¶ï¼Œå´æŠ¥é”™äº†ï¼š</p>
<blockquote>
<p>Error: Cannot find module 'webpack-cli/bin/config-yargs'</p>
</blockquote>
<pre><code>frankie@iMac react-ts % ğŸ¶ yarn start                                                                                                                                                           [14:04:47]
yarn run v1.22.10
$ webpack-dev-server
internal/modules/cjs/loader.js:883
  throw err;
  ^

Error: Cannot find module 'webpack-cli/bin/config-yargs'
Require stack:
- /Users/frankie/Desktop/Web/React/react-ts/node_modules/webpack-dev-server/bin/webpack-dev-server.js
    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:880:15)
    at Function.Module._load (internal/modules/cjs/loader.js:725:27)
    at Module.require (internal/modules/cjs/loader.js:952:19)
    at require (internal/modules/cjs/helpers.js:88:18)
    at Object.&lt;anonymous&gt; (/Users/frankie/Desktop/Web/React/react-ts/node_modules/webpack-dev-server/bin/webpack-dev-server.js:65:1)
    at Module._compile (internal/modules/cjs/loader.js:1063:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)
    at Module.load (internal/modules/cjs/loader.js:928:32)
    at Function.Module._load (internal/modules/cjs/loader.js:769:14)
    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    '/Users/frankie/Desktop/Web/React/react-ts/node_modules/webpack-dev-server/bin/webpack-dev-server.js'
  ]
}
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
</code></pre>
<p>ç„¶åæœæŸ¥äº†ä¸€ç•ªï¼Œæœ‰éƒ¨åˆ†äººæ˜¯åˆ é™¤äº† <code>node_modules</code>ï¼Œé‡æ–° install å¯ä»¥è·‘èµ·æ¥ï¼Œä½†è¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<p>è§£å†³æ–¹æ³•åº”è¯¥æ˜¯ï¼š</p>
<blockquote>
<p>Install the lastest webpack-cli and use <code>webpack serve</code> to run webpack dev server instead <code>webpack-dev-server</code>. <a href="https://github.com/webpack/webpack-dev-server/issues/3304">#3304</a></p>
</blockquote>
<p>å°±æ˜¯è¯´ï¼Œå®‰è£…æœ€æ–°çš„ <code>webpack-cli</code> å¹¶ä½¿ç”¨ <code>webpack serve</code> æ¥è¿è¡Œ webpack dev server è€Œä¸æ˜¯ <code>webpack-dev-server</code>ã€‚</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;webpack serve&quot;,
    &quot;build&quot;: &quot;webpack --progress&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^5.42.0&quot;,
    &quot;webpack-cli&quot;: &quot;^4.7.2&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.11.2&quot;
  }
}
</code></pre>
<p>æ”¹å®Œå°±èƒ½æ„‰å¿«åœ°ç©è€äº†...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[No module factory available for dependency type: ModuleHotAcceptDependency]]></title>
            <link>https://github.com/toFrankie/blog/issues/78</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/78</guid>
            <pubDate>Sat, 25 Feb 2023 12:09:19 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©åœ¨ä¼˜åŒ– Webpack é…ç½®æ—¶ï¼Œä½¿ç”¨åˆ° <code>speed-measure-webpack-plugin</code> æ¥æµ‹ç®— Webpack å„é¡¹æ‰“åŒ…é€Ÿåº¦ã€‚</p>
<pre><code class="language-js">const SpeedMeasurePlugin = require('sp]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©åœ¨ä¼˜åŒ– Webpack é…ç½®æ—¶ï¼Œä½¿ç”¨åˆ° <code>speed-measure-webpack-plugin</code> æ¥æµ‹ç®— Webpack å„é¡¹æ‰“åŒ…é€Ÿåº¦ã€‚</p>
<pre><code class="language-js">const SpeedMeasurePlugin = require('speed-measure-webpack-plugin')
const smp = new SpeedMeasurePlugin()

const webpackConfig = {
  // ...
}

module.exports = smp.wrap(webpackConfig)
</code></pre>
<p>åœ¨åˆæ¬¡å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œå¯ä»¥æˆåŠŸç¼–è¯‘ã€‚å¯å°±åœ¨çƒ­æ›´æ–°çš„æ—¶å€™ï¼Œå°±æŠ¥äº†ä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="language-text">â„¹ ï½¢wdmï½£: Compiling...
âœ– ï½¢wdmï½£: Error: No module factory available for dependency type: ModuleHotAcceptDependency
    at addDependency (/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/webpack/lib/Compilation.js:800:12)
    at iterationOfArrayCallback (/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/webpack/lib/Compilation.js:208:3)
    at addDependenciesBlock (/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/webpack/lib/Compilation.js:816:5)
    at Compilation.processModuleDependencies (/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/webpack/lib/Compilation.js:827:4)
    at afterBuild (/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/webpack/lib/Compilation.js:954:15)
    at processTicksAndRejections (internal/process/task_queues.js:75:11)
/Users/frankie/Desktop/Web/company-git/pro234/react-demo/node_modules/neo-async/async.js:16
    throw new Error('Callback was already called.');
    ^
</code></pre>
<blockquote>
<p>ä¼¼ä¹æ˜¯ä½¿ç”¨äº† <code>speed-measure-webpack-plugin</code> å¯¼è‡´çš„ï¼Œç§»é™¤å³å¯ã€‚</p>
</blockquote>
<p>ä½†å¦‚æœåŒæ—¶è¯¥æ’ä»¶å¦‚ä½•è§£å†³æŠ¥é”™ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œè‹¥åç»­æœ‰è§£å†³æ–¹æ¡ˆä¼šå›æ¥æ›´æ–°çš„ã€‚</p>
<p>ç›¸å…³ issuesï¼š</p>
<ul>
<li><a href="https://github.com/stephencookdev/speed-measure-webpack-plugin/issues/117">I've got this on latest release when trying to rebuild #117</a></li>
<li><a href="https://github.com/webpack/webpack/issues/10897">No module factory available for dependency type: ModuleHotAcceptDependency #10897</a></li>
<li><a href="https://juejin.cn/post/6844904093463347208#heading-16">å¸¦ä½ æ·±åº¦è§£é” Webpack ç³»åˆ—ï¼ˆä¼˜åŒ–ç¯‡ï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•åœ¨æœ¬åœ°è¿è¡Œ webpack æ‰“åŒ…åçš„æ–‡ä»¶]]></title>
            <link>https://github.com/toFrankie/blog/issues/77</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/77</guid>
            <pubDate>Sat, 25 Feb 2023 12:08:36 GMT</pubDate>
            <description><![CDATA[<p>å¦‚æœæƒ³ç€æœ¬åœ°æ‰“å¼€ webpack æ‰“åŒ…åçš„é¡¹ç›®ï¼Œå¯ä»¥åˆ©ç”¨ express æ­å»ºæœ¬åœ°æœåŠ¡å™¨ã€‚</p>
<ol>
<li>å®‰è£… express-generator</li>
</ol>
<pre><code class="language-shell">$ npm i express-generator -g
</c]]></description>
            <content:encoded><![CDATA[<p>å¦‚æœæƒ³ç€æœ¬åœ°æ‰“å¼€ webpack æ‰“åŒ…åçš„é¡¹ç›®ï¼Œå¯ä»¥åˆ©ç”¨ express æ­å»ºæœ¬åœ°æœåŠ¡å™¨ã€‚</p>
<ol>
<li>å®‰è£… express-generator</li>
</ol>
<pre><code class="language-shell">$ npm i express-generator -g
</code></pre>
<ol start="2">
<li>åˆ›å»º express é¡¹ç›®</li>
</ol>
<pre><code class="language-shell">$ express my-express-project
</code></pre>
<ol start="3">
<li>
<p>å°†æ‰“åŒ…ï¼ˆä¸€èˆ¬æ˜¯ <code>dist</code> æˆ– <code>build</code>ï¼‰åçš„<strong>æ‰€æœ‰æ–‡ä»¶</strong>å¤åˆ¶åˆ° <code>public</code> æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
</li>
<li>
<p>å¯åŠ¨é¡¹ç›®</p>
</li>
</ol>
<pre><code class="language-shell">$ cd my-express-project
$ npm i
$ npm run start
</code></pre>
<ol start="4">
<li>åœ¨æµè§ˆå™¨æ‰“å¼€ï¼Œé»˜è®¤æ˜¯ï¼š</li>
</ol>
<blockquote>
<p><a href="http://localhost:3000">http://localhost:3000</a></p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[webpack æœ¯è¯­ä¹‹ moduleã€chunk å’Œ bundle]]></title>
            <link>https://github.com/toFrankie/blog/issues/76</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/76</guid>
            <pubDate>Sat, 25 Feb 2023 12:08:12 GMT</pubDate>
            <description><![CDATA[<h3>æ¦‚å¿µæœ¯è¯­</h3>
<ul>
<li>
<p><a href="https://v4.webpack.docschina.org/concepts/modules"><strong>Module</strong></a>ï¼šæä¾›æ¯”å®Œæ•´ç¨‹åºæ¥è§¦é¢ï¼ˆsurface areaï¼‰æ›´å°çš„ç¦»æ•£åŠŸèƒ½å—ã€‚ç²¾å¿ƒç¼–å†™çš„æ¨¡å—æä¾›äº†å¯é ]]></description>
            <content:encoded><![CDATA[<h3>æ¦‚å¿µæœ¯è¯­</h3>
<ul>
<li>
<p><a href="https://v4.webpack.docschina.org/concepts/modules"><strong>Module</strong></a>ï¼šæä¾›æ¯”å®Œæ•´ç¨‹åºæ¥è§¦é¢ï¼ˆsurface areaï¼‰æ›´å°çš„ç¦»æ•£åŠŸèƒ½å—ã€‚ç²¾å¿ƒç¼–å†™çš„æ¨¡å—æä¾›äº†å¯é çš„æŠ½è±¡å’Œå°è£…ç•Œé™ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸­æ¯ä¸ªæ¨¡å—éƒ½å…·æœ‰æ¡ç†æ¸…æ¥šçš„è®¾è®¡å’Œæ˜ç¡®çš„ç›®çš„ã€‚</p>
</li>
<li>
<p><a href=""><strong>Chunk</strong></a>ï¼šè¿™æ˜¯ webpack ç‰¹å®šçš„æœ¯è¯­è¢«ç”¨åœ¨å†…éƒ¨æ¥ç®¡ç† building è¿‡ç¨‹ã€‚bundle ç”± chunk ç»„æˆï¼Œå…¶ä¸­æœ‰å‡ ç§ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå…¥å£ chunkï¼ˆentry chunkï¼‰å’Œå­ chunkï¼ˆchild chunkï¼‰ï¼‰ã€‚é€šå¸¸ chunk ä¼šç›´æ¥å¯¹åº”æ‰€è¾“å‡ºçš„ bundleï¼Œä½†æ˜¯æœ‰ä¸€äº›é…ç½®å¹¶ä¸ä¼šäº§ç”Ÿä¸€å¯¹ä¸€çš„å…³ç³»ã€‚</p>
</li>
<li>
<p><a href="https://v4.webpack.docschina.org/guides/getting-started/#creating-a-bundle"><strong>Bundle</strong></a>ï¼šç”±å¤šä¸ªä¸åŒçš„æ¨¡å—ç”Ÿæˆï¼Œbundles åŒ…å«äº†æ—©å·²ç»è¿‡åŠ è½½å’Œç¼–è¯‘çš„æœ€ç»ˆæºæ–‡ä»¶ç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<p>è¿™äº›å®˜è¯ï¼Œçœ‹ç€ä¼šäº‘é‡Œé›¾é‡Œå—ï¼Ÿ</p>
<h3>é€šä¿—è§£é‡Š</h3>
<p>ä¸Šæ¥å…ˆä»ä¸€å¼ å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5b3e4374a890a6d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾ç‰‡æºè‡ªâ€œå¤è›‹å®éªŒå®¤â€æŸæ–‡ç« "></p>
<ul>
<li>
<p><strong>Module</strong>ï¼šå¯¹äº webpack æ¥è¯´ï¼Œé¡¹ç›®æºç ä¸­æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬ JSã€CSSã€Imageã€Font ç­‰ç­‰ï¼‰éƒ½å±äº module æ¨¡å—ã€‚å¯ä»¥é…ç½®æŒ‡å®šçš„ Loader å»å¤„ç†è¿™äº›æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>Chunk</strong>ï¼šå½“ä½¿ç”¨ webpack å°†æˆ‘ä»¬ç¼–å†™çš„æºä»£ç è¿›è¡Œæ‰“åŒ…æ—¶ï¼Œwebpack ä¼šæ ¹æ®æ–‡ä»¶å¼•ç”¨å…³ç³»ç”Ÿæˆ chunk æ–‡ä»¶ï¼Œwebpack ä¼šå¯¹è¿™äº› chunk æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œã€‚</p>
</li>
<li>
<p><strong>Bundle</strong>ï¼šwebpack å¤„ç†å®Œ chunk æ–‡ä»¶ä¹‹åï¼Œæœ€ç»ˆä¼šè¾“å‡º bundle æ–‡ä»¶ï¼Œè¿™ä¸ª bundle æ–‡ä»¶åŒ…å«äº†ç»è¿‡åŠ è½½å’Œç¼–è¯‘çš„æœ€ç»ˆäº§ç‰©ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç®€å•æ€»ç»“ï¼š<code>module</code>ã€<code>chunk</code> å’Œ <code>bundle</code> å…¶å®å°±æ˜¯åŒä¸€ä»½ä»£ç åœ¨ä¸åŒè½¬æ¢åœºæ™¯å–çš„ä¸‰ä¸ªåç§°ã€‚æˆ‘ä»¬ç¼–å†™çš„æ˜¯ <code>module</code>ï¼Œwebpack å¤„ç†æ—¶æ˜¯ <code>chunk</code>ï¼Œæœ€ç»ˆç”Ÿæˆä¾›æµè§ˆå™¨å…è®¸çš„æ˜¯ <code>bundle</code>ã€‚</p>
</blockquote>
<h3>å‚è€ƒ</h3>
<ul>
<li>
<p><a href="https://v4.webpack.docschina.org/glossary/">Webpack æ¦‚å¿µæœ¯è¯­</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/6844903889393680392">Webpack ç†è§£ Chunk</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/6844904007362674701">webpack ä¸­é‚£äº›æœ€æ˜“æ··æ·†çš„ 5 ä¸ªçŸ¥è¯†ç‚¹</a></p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç»™ webpack-dev-server æäº†ä¸ª bug]]></title>
            <link>https://github.com/toFrankie/blog/issues/75</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/75</guid>
            <pubDate>Sat, 25 Feb 2023 12:05:16 GMT</pubDate>
            <description><![CDATA[<p>èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘åœ¨å…¨é¢æ•´ç† webpack çš„é…ç½®é¡¹ï¼Œä¸ºäº†åŠ æ·±ç†è§£å’Œå°è±¡ï¼Œä¼šä¸€ä¸ªä¸€ä¸ªåœ°é€‰é¡¹å»éªŒè¯ã€‚ä»Šå¤©çœ‹åˆ° <a href="https://v4.webpack.docschina.org/configuration/resolve/">resolve</a> æ¨¡å—ï¼Œç„¶åå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº† <a hre]]></description>
            <content:encoded><![CDATA[<p>èƒŒæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ€è¿‘åœ¨å…¨é¢æ•´ç† webpack çš„é…ç½®é¡¹ï¼Œä¸ºäº†åŠ æ·±ç†è§£å’Œå°è±¡ï¼Œä¼šä¸€ä¸ªä¸€ä¸ªåœ°é€‰é¡¹å»éªŒè¯ã€‚ä»Šå¤©çœ‹åˆ° <a href="https://v4.webpack.docschina.org/configuration/resolve/">resolve</a> æ¨¡å—ï¼Œç„¶åå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº† <a href="https://github.com/webpack/webpack-dev-server/issues/2801">Modify webpack's resolve.mainFiles, resulting in an error when using webpack-dev-server #2801</a>ã€‚</p>
<blockquote>
<p>æœ€ç»ˆå¼€å‘äººå‘˜è¡¨ç¤ºè¿™ç¡®å®æ˜¯ bugï¼Œå°†åœ¨æœªæ¥å‘å¸ƒçš„ v4 ç‰ˆæœ¬ä¿®å¤ã€‚</p>
</blockquote>
<p>å…³äºæ ISSUEï¼Œç”±äºéœ€è¦å¤–å›½å‹äººçœ‹å¾—æ‡‚ï¼ŒåŠ ä¸Šæˆ‘è¹©è„šçš„è‹±æ–‡ï¼Œåªèƒ½å…¨ç¨‹åœ¨è°·æ­Œç¿»è¯‘ï¼Œå°´å°¬å“ˆå“ˆ ğŸ¤£</p>
<hr>
<!--
  Please note that this template is not optional.
  Please fill out _ALL_ fields, or your issue may be closed as "invalid."
  Please do not delete this template.
  Please ask questions on StackOverflow or Gitter (https://gitter.im/webpack/webpack).
  General questions, how-to questions, and support requests will be closed.
-->
<ul>
<li>Operating System: macOS 10.15.7</li>
<li>Node Version: 12.12.0</li>
<li>NPM Version: 6.13.3</li>
<li>webpack Version: 4.41.2</li>
<li>webpack-dev-server Version: 3.9.0</li>
<li>Browser: It has nothing to do with the browser (Chrome)</li>
</ul>
<!--
  Please place an x, no spaces, in all [ ] that apply
  Please note that we are NOT accepting FEATURE requests at this time.
-->
<ul>
<li>[x] This is a <strong>bug</strong></li>
<li>[ ] This is a <strong>modification</strong> request</li>
</ul>
<h3>Code</h3>
<!--
  If you have a large amount of code to share which demonstrates the problem
  you're experiencing, or your webpack config is very large, please provide a link
  to your repository rather than pasting code. We'd also encourage you to use a
  Github Gist link instead of pasting code. Otherwise, please paste relevant
  short snippets below.

  For bugs, please do consider providing a link to a stripped-down, bare-bones
  repo that can reproduce the problem you're experiencing. Many times, bugs
  aren't actual bugs, but rather specific issues with loaders, plugins, or
  an environment/OS. Problems with complicated or large applications will almost
  always require this to be triaged.
-->
<pre><code class="language-js">// webpack.config.js
module.exports = {
  // ...
  resolve: {
    mainFiles: ['fortest'] // Any name, as long as it is not 'index'
  }
}
</code></pre>
<pre><code class="language-js">// index.jsï¼ˆentryï¼‰
// The directory of components/button contains the fortest.js file
import Button from './components/button'
</code></pre>
<h3>Expected Behavior</h3>
<p>The <code>resolve.mainFiles</code> to be used while resolving directories.</p>
<p>When I import the button component as above, there should be no errors.</p>
<h3>Actual Behavior</h3>
<p>But the actual behavior is not the expected result, and the build fails with the following prompt:</p>
<pre><code class="language-shell">ERROR in (webpack)-dev-server/client?http://localhost:8080
Module not found: Error: Can't resolve 'strip-ansi' in '/Users/frankie/Desktop/Web/Demo/Temp/temp_webpack/node_modules/webpack-dev-server/client'
 @ (webpack)-dev-server/client?http://localhost:8080 6:16-37
 @ multi (webpack)-dev-server/client?http://localhost:8080 (webpack)/hot/dev-server.js ./src/index.js
</code></pre>
<h3>Guess</h3>
<p>According to the error message, I found...</p>
<pre><code class="language-js">// node_modules/webpack-dev-server/client/index.js
// ...
var stripAnsi = require('strip-ansi');
// ...
</code></pre>
<pre><code class="language-js">// node_modules/strip-ansi/index.js
// ...
var ansiRegex = require('ansi-regex')();
// ...
</code></pre>
<p>I found the package.json of the two dependency packages <code>strip-ansi</code> and <code>ansi-regex</code> does not contain the <code>main</code> attribute, so it should look for <code>index.js</code> according to the default configuration of webpack. But now because I modified the <code>resolve.mainFiles</code> configuration to <code>fortest</code>, it should be <code>fortest.js</code> when parsing, but there is no <code>fortest.js</code> file for the two dependent packages. So an error was reported.</p>
<p>To verify my guess, I tried to modify it to:</p>
<pre><code class="language-js">// node_modules/webpack-dev-server/client/index.js
var stripAnsi = require('strip-ansi/index');

// node_modules/strip-ansi/index.js
var ansiRegex = require('ansi-regex/index')();
</code></pre>
<p>After the modification, this can be parsed normally without an error.
The button component can also be imported as expected</p>
<h3>For Bugs; How can we reproduce the behavior?</h3>
<p>A very simple configuration</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  entry: './src/index.js'
  devServer: {
    contentBase: './dist',
    hot: true,
    open: true
  },
  resolve: {
    mainFiles: ['fortest'],
  },
  // Other irrelevant configuration...
}
</code></pre>
<pre><code class="language-json5">// package.json
{
  &quot;name&quot;: &quot;temp_webpack&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;temp demo&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server --config webpack.config.js --colors&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;clean-webpack-plugin&quot;: &quot;3.0.0&quot;,
    &quot;css-loader&quot;: &quot;3.2.0&quot;,
    &quot;file-loader&quot;: &quot;5.0.2&quot;,
    &quot;html-webpack-plugin&quot;: &quot;3.2.0&quot;,
    &quot;style-loader&quot;: &quot;1.0.0&quot;,
    &quot;webpack&quot;: &quot;4.41.2&quot;,
    &quot;webpack-cli&quot;: &quot;3.3.10&quot;,
    &quot;webpack-dev-server&quot;: &quot;3.9.0&quot;
  }
}
</code></pre>
<p>webpack allows us to modify the <code>resolve.mainFiles</code> configuration to specify the file name to be used when resolving the directory. But when I modify it, webpack-dev-server can't work normally.</p>
<p>Is this caused by my configuration error? Or is it a bug?</p>
<p>Thanks,</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-81c5da1ccdfda96a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[webpack ä¸­æå®¹æ˜“æ··æ·†çš„ pathã€publicPathã€contentBase é…ç½®]]></title>
            <link>https://github.com/toFrankie/blog/issues/74</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/74</guid>
            <pubDate>Sat, 25 Feb 2023 12:03:51 GMT</pubDate>
            <description><![CDATA[<p>æœ€è¿‘åœ¨å†™ä¸€ä¸ª Webpack + React çš„ Demoï¼Œå…³äºæ¶‰åŠè·¯å¾„å‚æ•°é…ç½®å¾ˆå®¹æ˜“æ··æ·†ï¼Œæ‰€ä»¥å†™è¿™ç¯‡æ–‡ç« æ•´ç†ä¸€ä¸‹ã€‚</p>
<p>*ä»¥ä¸‹å…³äº webpack-dev-server ä¼šç®€å†™æˆ dev-server æˆ–è€… devServerã€‚</p>
<blockquote>
<p>æ€»ç»“ï¼š</p>
<ul>
<li]]></description>
            <content:encoded><![CDATA[<p>æœ€è¿‘åœ¨å†™ä¸€ä¸ª Webpack + React çš„ Demoï¼Œå…³äºæ¶‰åŠè·¯å¾„å‚æ•°é…ç½®å¾ˆå®¹æ˜“æ··æ·†ï¼Œæ‰€ä»¥å†™è¿™ç¯‡æ–‡ç« æ•´ç†ä¸€ä¸‹ã€‚</p>
<p>*ä»¥ä¸‹å…³äº webpack-dev-server ä¼šç®€å†™æˆ dev-server æˆ–è€… devServerã€‚</p>
<blockquote>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><code>output.path</code> è¡¨ç¤º output ç›®å½•å¯¹åº”çš„ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</li>
<li><code>output.publicPath</code> è¡¨ç¤ºæ‰“åŒ…ç”Ÿæˆçš„ index.html æ–‡ä»¶é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€ã€‚</li>
<li><code>devServer.publicPath</code> è¡¨ç¤ºæ‰“åŒ…ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œè‹¥ <code>devServer.publicPath</code> æ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä¼šå– <code>output.publicPath</code> çš„å€¼ã€‚</li>
<li><code>devServer.contentBase</code> è¡¨ç¤ºæœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ã€‚ä¸€èˆ¬åªæœ‰åœ¨æä¾›é™æ€æ–‡ä»¶æ—¶æ‰éœ€è¦ã€‚</li>
</ul>
</blockquote>
<h3>åŸºæœ¬é…ç½®</h3>
<p>å†™ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæ²¡æœ‰è¿‡å¤šçš„ä¸œè¥¿ï¼Œè¶³ä»¥è¯´æ˜æœ¬æ–‡çš„å‡ ä¸ªé…ç½®é¡¹å³å¯ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>my-project
  src
    index.css // ä»…è®¾ç½®äº†ä¸€ä¸ªèƒŒæ™¯å›¾ç‰‡
    index.html // ç®€å•çš„ä¸€ä¸ª HTML ä½œä¸ºæ¨¡æ¿è€Œå·²ï¼Œéšæ„å†™ä¸ª div æ ‡ç­¾å•¥çš„å°± OK äº†
    index.js // ä»…å¼•ç”¨äº† index.css
  package.json
  webpack.config.js
</code></pre>
<p>é¡¹ç›®é‡Œé¢ index.jsã€index.cssã€index.html é‡Œé¢å…¶å®æ²¡ä»€ä¹ˆå†…å®¹çš„ï¼Œå°±å¦‚ä¸Šé¢å¤‡æ³¨ä¸€æ ·è€Œå·²ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack&quot;,
    &quot;dev&quot;: &quot;webpack-dev-server&quot;
  }
}
</code></pre>
<pre><code class="language-js">// webpack.config.js
const path = require('path')
const webpack = require('webpack')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  devServer: {
    open: true
  },
  plugins: [
    new HtmlWebpackPlugin({
      title: 'webpack demo',
      template: './src/index.html',
      filename: 'index.html',
      inject: true,
      hash: false
    }),
    new CleanWebpackPlugin(),
    new MiniCssExtractPlugin({
      filename: 'style.css'
    })
  ],
  module: {
    rules: [
      {
        test: /\.css$/,
        exclude: /node_modules/,
        use: [MiniCssExtractPlugin.loader, 'css-loader']
      },
      {
        test: /\.(png|jpg|gif)$/,
        loader: 'file-loader',
        options: {
          name: '[name].[ext]'
        }
      }
    ]
  }
}
</code></pre>
<h3>1. output.path</h3>
<ul>
<li>é»˜è®¤å€¼ï¼š<code>path.join(process.cwd(), 'dist')</code></li>
</ul>
<p>æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>ç»å¯¹è·¯å¾„</strong>ï¼Œé»˜è®¤æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>dist</code> è·¯å¾„ã€‚é¡¹ç›®ä¸­ç»å¸¸ä¼šçœ‹åˆ°å¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-js">output: {
  path: path.resolve(__dirname, 'dist')
}
</code></pre>
<p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯è¿è¡Œ <code>yarn run build</code> å‘½ä»¤ï¼Œwebpack å°†é¡¹ç›®æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶ï¼ˆå¦‚ index.htmlã€bundle.jsã€å›¾ç‰‡ç­‰ï¼‰è¾“å‡ºåˆ°è¯¥ç›®å½•ã€‚è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚</p>
<h3>2. output.publicPath</h3>
<ul>
<li>é»˜è®¤å€¼ï¼š<code>''</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</li>
</ul>
<p><code>output.publicPath</code> å¸¸ç”¨äºåœ¨ç”Ÿäº§ç¯å¢ƒã€‚å®ƒä¼šä¸ºæ‰€æœ‰çš„èµ„æºæŒ‡å®šä¸€ä¸ªåŸºç¡€è·¯å¾„ï¼Œå®ƒè¢«ç§°ä¸ºå…¬å…±è·¯å¾„ã€‚</p>
<p><strong>å¦‚ä½•ç†è§£ï¼Ÿ</strong></p>
<blockquote>
<p>è¿™é‡Œæ‰€è¯´çš„æ‰€æœ‰èµ„æºçš„åŸºç¡€è·¯å¾„æ˜¯æŒ‡é¡¹ç›®ä¸­å¼•ç”¨ CSSã€JSã€Image ç­‰èµ„æºæ—¶å€™çš„ä¸€ä¸ªåŸºç¡€è·¯å¾„ã€‚è¿™ä¸ªåŸºç¡€è·¯å¾„è¦é…åˆå…·ä½“èµ„æºä¸­æŒ‡å®šçš„è·¯å¾„ä½¿ç”¨ï¼Œæ‰€ä»¥æ‰“åŒ…åçš„èµ„æºçš„è®¿é—®å¯ä»¥ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š</p>
<p><strong>é™æ€èµ„æºæœ€ç»ˆè®¿é—®è·¯å¾„ = output.publicPath + èµ„æº loader æˆ–æ’ä»¶ç­‰é…ç½®è·¯å¾„</strong></p>
<p>è¿™ä¸ªæœ€ç»ˆé™æ€èµ„æºè®¿é—®è·¯å¾„åœ¨ä½¿ç”¨ html-webpack-plugin æ‰“åŒ…åå¾—åˆ°çš„ html ä¸­å¯ä»¥çœ‹åˆ°ã€‚å¦‚æœ <code>output.publicPath</code> è®¾ç½®æˆç›¸å¯¹è·¯å¾„åï¼Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸åº”åœ°æ‰“åŒ…åçš„ html çš„ã€‚</p>
<p>å‡è®¾ <code>output.publicPath</code> è®¾ç½®æˆäº† <code>'./dist/'</code>ï¼Œé‚£ä¹ˆæ‰“åŒ…åçš„ JS å¼•ç”¨è·¯å¾„ä¸º <code>./dist/main.js</code>ã€‚è¿™é‡Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç›¸å¯¹è·¯å¾„åœ¨æœ¬åœ°èƒ½æ­£å¸¸è®¿é—®åˆ°ã€‚ä½†æ˜¯å¦‚æœæŠŠé™æ€èµ„æºæ‰˜ç®¡åˆ° CDN ä¸Šï¼Œè®¿é—®è·¯å¾„æ˜¾ç„¶ä¸èƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„ã€‚å¦‚æœè®¾ç½®æˆ <code>'/dist/'</code>ï¼Œåˆ™æ‰“åŒ…åçš„è®¿é—®è·¯å¾„æ˜¯ <code>localhost:8080/dist/main.js</code>ï¼Œæ­¤æ—¶æœ¬åœ°æ— æ³•è®¿é—®ã€‚ä¸€èˆ¬è§£å†³æ–¹æ³•å°±æ˜¯åˆ©ç”¨ <code>webpack.DefinePlugin</code> æ¥å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼ˆ<code>process.env.NODE_ENV</code>ï¼‰åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒæ¥è®¾å®šä¸åŒçš„å€¼ï¼Œæˆ–è€…æ˜¯é‡‡ç”¨ä¸¤ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ‰“åŒ…ã€‚</p>
<p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>output.publicPath</code> åº”è¯¥ä»¥ <code>'/'</code> ç»“å°¾ï¼Œè€Œå…¶ä»– loader æˆ–æ’ä»¶çš„é…ç½®ä¸è¦ä»¥ <code>'/'</code> å¼€å¤´ã€‚</strong></p>
</blockquote>
<p>æ¡ˆä¾‹ï¼š</p>
<pre><code class="language-js">output.publicPath = '/dist/'


// æ¡ˆä¾‹ä¸€ï¼ˆimage file-loaderï¼‰
options: {
  name: 'img/[name].[ext]'
}
// æœ€ç»ˆè·¯å¾„ï¼šoutput.publicPath + 'img/[name].[ext]' = '/dist/img/[name].[ext]'


// æ¡ˆä¾‹äºŒï¼ˆjs output.filenameï¼‰
output: {
  filename: '[name].js'
}
// æœ€ç»ˆè·¯å¾„ï¼šoutput.publicPath + '[name].js' = '/dist/[name].js'


// æ¡ˆä¾‹ä¸‰ï¼ˆextract-text-webpack-plugin cssï¼‰
new ExtractTextPlugin({
  filename: 'style.[chunkhash].css'
})
// æœ€ç»ˆè·¯å¾„ï¼šoutput.publicPath + 'style.[chunkhash].css' = '/dist/style.[chunkhash].css'
</code></pre>
<p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ <code>output.publicPath</code> é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path')
module.exports = {
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: '/outputDir/'
  }
}
</code></pre>
<p>è¿è¡Œ <code>yarn run dev</code> å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">â„¹ ï½¢wdsï½£: Project is running at http://localhost:8080/
â„¹ ï½¢wdsï½£: webpack output is served from /outputDir/
</code></pre>
<p>ç„¶åï¼Œè®¿é—® <code>http://localhost:8080/</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-809d5c666e8938ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è®¿é—® <code>http://localhost:8080/outputDir/</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c78a1756a8b8b553.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>æ ¹æ®ä¸Šé¢ä¸¤å¼ å›¾å¯ä»¥çœ‹å‡ºï¼Œè®¾ç½® <code>output.publicPath</code> åï¼Œå¦‚æœ <code>devServer.publicPath</code> æ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆä½¿ç”¨ webpack-dev-server è¿›è¡Œæ‰“åŒ…æ—¶ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ä»¥åŠ index.html æ–‡ä»¶é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€éƒ½æ˜¯ <code>output.publicPath</code> é‡Œé¢è®¾ç½®çš„å€¼ã€‚</p>
</blockquote>
<h3>3. devServer.publicPath</h3>
<ul>
<li>é»˜è®¤å€¼ï¼š<code>'/'</code></li>
</ul>
<blockquote>
<p>æ’å¥è¯ï¼Œæ–œæ  <code>/</code> çš„å«ä¹‰è¡¨ç¤º URL çš„æ ¹è·¯å¾„ï¼Œä¾‹å¦‚ <code>http://localhost:8080/dist/main.js</code> ä¸­çš„ <code>http://localhost:8080/</code>ã€‚</p>
</blockquote>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å€Ÿç”¨ webpack-dev-server å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿä¼šé…ç½®ä¸€ä¸ª <code>devServer.publicPath</code>ï¼Œè¿™é‡Œçš„ <code>devServer.publicPath</code> è·¯å¾„ä¸‹çš„æ‰“åŒ…æ–‡ä»¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®ã€‚è€Œé™æ€èµ„æºä»ç„¶ä½¿ç”¨ <code>output.publicPath</code>ã€‚</p>
<p>webpack-dev-server æ‰“åŒ…çš„å†…å®¹æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™äº›æ‰“åŒ…åçš„èµ„æºå¯¹å¤–çš„æ ¹ç›®å½•å°±æ˜¯ <code>devServer.publicPath</code>ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®çš„æ˜¯æ‰“åŒ…åèµ„æºå­˜æ”¾çš„ä½ç½®ã€‚</p>
<pre><code>å‡è®¾ devServer.publicPath = '/dist/'
é‚£ä¹ˆï¼Œå¯åŠ¨ webpack-dev-server å index.html è·¯å¾„ä¸º publicPath + index.html
é‚£ä¹ˆï¼Œå¯åŠ¨ webpack-dev-server å main.js è·¯å¾„ä¸º publicPath + main.js
</code></pre>
<p>ä»¥ä¸Šè¿™äº›ï¼Œé€šè¿‡è®¿é—® <code>http://localhost:8080/webpack-dev-server</code> å¯ä»¥çœ‹åˆ°å¯åŠ¨åçš„èµ„æºè®¿é—®è·¯å¾„ã€‚ç‚¹å‡»é‡Œé¢çš„é™æ€èµ„æºæ–‡ä»¶å¯ä»¥çœ‹åˆ°è·¯å¾„ä¸º <code>http://localhost:8080${publicPath}index.html</code>ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ <code>devServer.publicPath</code> çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: '/outputDir/'
  },
  devServer: {
    publicPath: '/assets/'
    open: true
  }
}
</code></pre>
<p>æ‰§è¡Œ <code>yarn run dev</code> å‘½ä»¤ ï¼Œå‘½ä»¤è¡Œæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼ˆæˆ‘ä»¬çœ‹åˆ°è·Ÿæ­¤å‰ä¸ä¸€æ ·äº†ï¼‰ï¼š</p>
<pre><code class="language-shell">â„¹ ï½¢wdsï½£: Project is running at http://localhost:8080/
â„¹ ï½¢wdsï½£: webpack output is served from /assets/
</code></pre>
<p>ç„¶åï¼Œè®¿é—® <code>http://localhost:8080/</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0d3d19f531d330f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è®¿é—® <code>http://localhost:8080/assets/</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a94a1f15367b7bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å‘ç° JS å’Œ CSS æ–‡ä»¶çš„å¼•ç”¨è·¯å¾„è¿˜æ˜¯æ²¡å˜ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°é¡µé¢çš„èƒŒæ™¯å›¾ç‰‡æ²¡æœ‰äº†ï¼Œå› ä¸ºå®ƒæŠ¥é”™äº†ï¼ŒCSS å’Œ JS éƒ½æ‰¾ä¸åˆ°ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-851bcbbcae4a12e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>devServer.publicPath</code> è¡¨ç¤ºæ‰“åŒ…ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚å¹¶ä¸”å®ƒçš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ã€‚è€Œ <code>output.publicPath</code> è¡¨ç¤º index.html æ–‡ä»¶é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€ã€‚</p>
</blockquote>
<h3>4. devServer.contentBase</h3>
<ul>
<li>é»˜è®¤å€¼ï¼š<code>process.cwd()</code>ï¼ˆå³å½“å‰å·¥ä½œç›®å½•ï¼‰</li>
</ul>
<p>åªæœ‰åœ¨ä½ æƒ³è¦æä¾›é™æ€æ–‡ä»¶æ—¶æ‰éœ€è¦ã€‚</p>
<p>æ¥ç€ï¼Œæ·»åŠ  <code>devServer.contentBase</code> é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: '/outputDir/'
  },
  devServer: {
    contentBase: './aaa',
    publicPath: '/assets/',
    open: true
  }
}
</code></pre>
<p>æ‰§è¡Œ <code>yarn run dev</code> å‘½ä»¤ï¼Œå‘½ä»¤è¡Œæ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">â„¹ ï½¢wdsï½£: Project is running at http://localhost:8080/
â„¹ ï½¢wdsï½£: webpack output is served from /assets/
â„¹ ï½¢wdsï½£: Content not from webpack is served from ./aaa
</code></pre>
<p>å¯ä»¥å‘ç°æœ‰ä¸€æ¡æ˜¯ï¼š<code>Content not from webpack is served from ./aaa</code>ï¼Œå¯ä»¥çœ‹å‡º <code>devServer.contentBase</code> æŒ‡çš„æ˜¯ï¼Œ<strong>ä¸ç”± webpack æ‰“åŒ…ç”Ÿæˆçš„é™æ€æ–‡ä»¶</strong>ã€‚</p>
<p>è®¿é—® <code>http://localhost:8080/</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fd3ecdffe691a74d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å› ä¸º <code>http://localhost:8080/</code> ä¸‹å¹¶æ²¡æœ‰ <code>aaa</code> ç›®å½•ï¼Œæ‰€ä»¥æ ¹æœ¬æ‰¾ä¸åˆ°ã€‚è€Œå‰é¢æ²¡æœ‰è®¾ç½® <code>devServer.contentBase</code> çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ <code>contentBase</code> çš„é»˜è®¤å€¼ï¼ˆå½“å‰æ‰§è¡Œçš„ç›®å½•ï¼Œå³é¡¹ç›®æ ¹ç›®å½•ï¼‰ã€‚åœ¨è®¿é—® <code>http://localhost:8080/</code> æ—¶ï¼Œç”±äºåœ¨æ ¹ç›®å½•ä¸‹æ²¡æœ‰æ‰¾åˆ° <code>index.html</code> æ–‡ä»¶ï¼Œå› æ­¤ä¼šæ˜¾ç¤ºæ ¹ç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶ã€‚</p>
<p>è®¿é—® <code>http://localhost:8080/assets/</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7246add61e4dfc35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å¯è§ï¼Œ<code>devServer.contentBase</code> ä¸æ‰“åŒ…ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®å’Œ index.html é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€æ˜¯æ²¡æœ‰å½±å“çš„ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å†ä¿®æ”¹ä¸€ä¸‹ <code>devServer.contentBase</code> çš„é…ç½®ï¼Œå°†å…¶è®¾ç½®ä¸º <code>src</code> ç›®å½•ï¼Œè€Œè¯¥ç›®å½•ä¸‹æ˜¯æœ‰æˆ‘ä»¬ç¼–å†™çš„ index.html æ¨¡æ¿æ–‡ä»¶çš„ã€‚</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: '/outputDir/'
  },
  devServer: {
    contentBase: './src',
    publicPath: '/assets/',
    open: true
  }
}
</code></pre>
<p>è®¿é—® <code>http://localhost:8080/</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-461ecb361dc7ffee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œè®¿é—®çš„æ˜¯æˆ‘ä»¬æœ¬åœ°ç¼–å†™çš„ index.html æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªä¸æ˜¯ webpack æ‰“åŒ…ç”Ÿæˆçš„ index.html æ–‡ä»¶ã€‚</p>
<h3>5. html-webpack-plugin</h3>
<p>è¿™ä¸ªæ’ä»¶ç”¨äºå°† CSS å’Œ JS æ·»åŠ åˆ° HTML æ¨¡æ¿ä¸­ï¼Œå…¶ä¸­ template å’Œ filename ä¼šå—åˆ°è·¯å¾„çš„å½±å“ã€‚</p>
<h5>template</h5>
<p>ä½œç”¨æ˜¯ç”¨äºå®šä¹‰æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<pre><code class="language-js">// æºç 
this.options.template = this.getFullTemplatePath(this.options.template, compiler.context)
</code></pre>
<p>å› æ­¤ï¼Œ<code>template</code> åªæœ‰å®šä¹‰åœ¨ webpack çš„ <code>context</code> æ‰ä¼šè¢«è¯†åˆ«ï¼Œwebpack çš„ <code>context</code> é»˜è®¤å€¼ä¸º <code>process.cwd()</code>ï¼Œå³è¿è¡Œ node å‘½ä»¤æ—¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚</p>
<h5>filename</h5>
<p>ä½œç”¨æ˜¯è¾“å‡ºçš„ HTML æ–‡ä»¶åï¼Œé»˜è®¤ä¸º <code>index.html</code>ï¼Œå¯ä»¥ç›´æ¥é…ç½®å¸¦æœ‰å­ç›®å½•ã€‚</p>
<pre><code class="language-js">// æºç 
this.options.filename = path.relative(compiler.options.output.path, filename)
</code></pre>
<p><strong>æ‰€ä»¥ filename çš„è·¯å¾„æ˜¯ç›¸å½“äº <code>output.path</code> çš„ï¼Œè€Œåœ¨ webpack-dev-server ä¸­ï¼Œåˆ™æ˜¯ç›¸å½“äº <code>devServer.publicPath</code> çš„ã€‚</strong></p>
<p>å¦‚æœ <code>devServer.publicPath</code> å’Œ <code>output.publicPath</code> ä¸ä¸€è‡´ï¼Œåœ¨ä½¿ç”¨ html-webpack-plugin å¯èƒ½ä¼šå¯¼è‡´å¼•ç”¨é™æ€èµ„æºå¤±è´¥ï¼Œå› ä¸ºåœ¨ devServer ä¸­ä»ç„¶ä»¥ <code>output.publicPath</code> å¼•ç”¨é™æ€èµ„æºçš„ï¼Œå½“è·Ÿ webpack-dev-server çš„æä¾›çš„èµ„æºè®¿é—®è·¯å¾„ä¸ä¸€è‡´ï¼Œä»è€Œæ— æ³•æ­£å¸¸è®¿é—®ã€‚</p>
<blockquote>
<p>æœ‰ä¸€ç§æƒ…å†µé™¤å¤–ï¼Œå°±æ˜¯ <code>output.publicPath</code> æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ—¶å€™å¯ä»¥è®¿é—®æœ¬åœ°èµ„æºã€‚</p>
</blockquote>
<p><strong>æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½è¦ä¿è¯ <code>devServer.publicPath</code> ä¸ <code>output.publicPath</code> ä¿æŒä¸€è‡´ã€‚</strong></p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://juejin.im/post/6844903686632636423">webpack ä¸­çš„ pathã€publicPath å’Œ contentBase</a></li>
<li><a href="https://juejin.im/post/6844903601060446221">Webpack ä¸­ publicPath è¯¦è§£</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[__webpack_hmr 404 (Not Found)]]></title>
            <link>https://github.com/toFrankie/blog/issues/73</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/73</guid>
            <pubDate>Sat, 25 Feb 2023 12:01:52 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©åœ¨è°ƒè¯• <code>webpack-dev-server</code> å’Œ <code>webpack-dev-middleware</code> çš„æ—¶å€™ï¼Œçªç„¶å‘ç°äº†æ§åˆ¶å°å‡ºç°äº†ä¸€ä¸ªé”™è¯¯æç¤ºï¼š</p>
<pre><code>GET http://localhost:8080/__webpack_hmr 404]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©åœ¨è°ƒè¯• <code>webpack-dev-server</code> å’Œ <code>webpack-dev-middleware</code> çš„æ—¶å€™ï¼Œçªç„¶å‘ç°äº†æ§åˆ¶å°å‡ºç°äº†ä¸€ä¸ªé”™è¯¯æç¤ºï¼š</p>
<pre><code>GET http://localhost:8080/__webpack_hmr 404 (Not Found)
</code></pre>
<p>ç„¶åå†çœ‹äº† <code>webpack.config.js</code> é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="language-js">module.exports = {
  // ...
  entry: [
    'webpack-hot-middleware/client',
    './src/index.js'
  ],
  devServer: {
    hot: true,
    open: true,
    inline: false
  },
}
</code></pre>
<p>å‘ç°å…¥å£æ–‡ä»¶æœ‰ä¸€ä¸ª <code>webpack-hot-middleware/client</code>ï¼Œç»è¿‡ä¸€ç•ªæœç´¢ï¼Œåœ¨ Stack Overflow æœ‰ä¸€ä¸ªç±»ä¼¼çš„æé—® <a href="https://stackoverflow.com/questions/41342144/webpack-hmr-webpack-hmr-404-not-found"># Webpack hmr: __webpack_hmr 404 not found</a>ã€‚</p>
<blockquote>
<p>å¤§æ¦‚åŸå› æ˜¯ï¼Œ<code>webpack-hot-middleware/client</code> æ˜¯ <code>webpack-hot-middleware</code> çš„è¦æ±‚ï¼Œå¯ç”¨äºé™¤ <code>webpack-dev-server</code> ä¹‹å¤–çš„ä»»ä½•æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ express æˆ–ç±»ä¼¼æœåŠ¡å™¨ï¼‰ï¼Œæ‰€ä»¥æŠŠå®ƒä»å…¥å£æ–‡ä»¶åˆ å»å°±å¥½äº†ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Webpack å¼€å‘ç¯å¢ƒé€‰æ‹©]]></title>
            <link>https://github.com/toFrankie/blog/issues/72</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/72</guid>
            <pubDate>Sat, 25 Feb 2023 12:01:05 GMT</pubDate>
            <description><![CDATA[<p>ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ä¸€ä¸ªå¯ç›‘å¬æ–‡ä»¶çš„ä¿®æ”¹ã€å¯é‡æ–°ç¼–è¯‘ã€å¹¶ä¸”å¯ä»¥è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œè¿™æ ·å¯èƒ½è¿˜ä¸æ»¡è¶³ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼Œé¿å…é¡µé¢çŠ¶æ€ä¸¢å¤±ã€‚</p>
<h3>é€‰æ‹©ä¸€ä¸ªå·¥å…·</h3>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ¯æ¬¡ä¿®æ”¹å®Œä»£ç éƒ½éœ€è¦æ‰‹åŠ¨å»ç¼–è¯‘çš„è¯ï¼Œé‚£æ˜¾ç„¶æ•ˆç‡æä½ã€‚éƒ½ 2020 å¹´äº†ï¼Œä¸æé«˜æ•ˆç‡å“ªæœ‰æ—¶é—´æ‘¸é±¼åˆ’æ°´]]></description>
            <content:encoded><![CDATA[<p>ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ä¸€ä¸ªå¯ç›‘å¬æ–‡ä»¶çš„ä¿®æ”¹ã€å¯é‡æ–°ç¼–è¯‘ã€å¹¶ä¸”å¯ä»¥è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œè¿™æ ·å¯èƒ½è¿˜ä¸æ»¡è¶³ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼Œé¿å…é¡µé¢çŠ¶æ€ä¸¢å¤±ã€‚</p>
<h3>é€‰æ‹©ä¸€ä¸ªå·¥å…·</h3>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ¯æ¬¡ä¿®æ”¹å®Œä»£ç éƒ½éœ€è¦æ‰‹åŠ¨å»ç¼–è¯‘çš„è¯ï¼Œé‚£æ˜¾ç„¶æ•ˆç‡æä½ã€‚éƒ½ 2020 å¹´äº†ï¼Œä¸æé«˜æ•ˆç‡å“ªæœ‰æ—¶é—´æ‘¸é±¼åˆ’æ°´ã€‚</p>
<p>webpack æä¾›äº†å‡ ç§<a href="https://v4.webpack.docschina.org/guides/development/#%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7">å¯é€‰æ–¹å¼</a>ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ä¿®æ”¹ä»£ç åè‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼š</p>
<ul>
<li><strong>webpack watch mode</strong></li>
<li><strong>webpack-dev-server</strong></li>
<li><strong>webpack-dev-middleware</strong></li>
</ul>
<p>webpack å¯ä»¥åœ¨ <code>watch mode</code>ï¼ˆè§‚å¯Ÿæ¨¡å¼ï¼‰ä¸‹ä½¿ç”¨ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œwebpack å°†ç›‘è§†æ‚¨çš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ›´æ”¹æ—¶é‡æ–°ç¼–è¯‘ã€‚</p>
<p><code>webpack-dev-server</code> æä¾›äº†ä¸€ä¸ªæ˜“äºéƒ¨ç½²çš„å¼€å‘æœåŠ¡å™¨ï¼Œå…·æœ‰å¿«é€Ÿçš„å®æ—¶é‡è½½ï¼ˆlive reloadingï¼‰åŠŸèƒ½ã€‚</p>
<p>å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨å¹¶ä¸”éœ€è¦å®Œå…¨çš„çµæ´»æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <code>webpack-dev-middleware</code> ä½œä¸ºä¸­é—´ä»¶ã€‚</p>
<p><code>webapck-dev-server</code> å’Œ <code>webpack-dev-middleware</code> ä½¿ç”¨å†…å­˜ç¼–è¯‘ï¼Œè¿™æ„å‘³ç€ <code>bundle</code> ä¸ä¼šè¢«ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚è¿™ä½¿å¾—ç¼–è¯‘ååˆ†è¿…é€Ÿï¼Œå¹¶å¯¼è‡´ä½ çš„æ–‡ä»¶ç³»ç»Ÿæ›´å°‘éº»çƒ¦ã€‚</p>
<blockquote>
<p>æˆ‘çš„é€‰æ‹©æ˜¯ <code>webpack-dev-server</code>ã€‚</p>
</blockquote>
<h3>ä½¿ç”¨ watch mode</h3>
<p>*<a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a>Â å’ŒÂ <a href="https://github.com/webpack/webpack-dev-middleware">webpack-dev-middleware</a>Â é‡Œ Watch æ¨¡å¼é»˜è®¤å¼€å¯ã€‚</p>
<p>æ­¤å‰ï¼Œæˆ‘ä¸€ç›´æ²¡æœ‰ get åˆ°è¿™è´§æœ‰ä»€ä¹ˆç”¨ï¼Œæ²¡å¤ªæ‡‚ã€‚é¦–å…ˆï¼Œå¼€å¯ Watch æ¨¡å¼çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚</p>
<p>é€šè¿‡ CLI å‚æ•°ä¼ é€’ï¼š</p>
<pre><code class="language-json5">// package.json
{
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;webpack --watch&quot;
  }
}
</code></pre>
<p>æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  // ...
  watch: true,
  watchOptions: {
    // å®šåˆ¶ Watch æ¨¡å¼é€‰é¡¹
    poll: 1000, // æ£€æŸ¥ä¸€æ¬¡å˜åŠ¨çš„æ—¶é—´é—´éš”ï¼ˆmsï¼‰
    aggregateTimeout: 500, // é‡æ–°æ„å»ºå‰å¢åŠ å»¶è¿Ÿï¼Œè¿™æ®µæ—¶é—´å†…å…è®¸å…¶ä»–ä»»ä½•æ›´æ”¹éƒ½èšåˆåˆ°ä¸€æ¬¡é‡æ–°æ„å»ºé‡Œé¢ï¼ˆmsï¼‰
    ignored: /node_modules/, // è¿™ä¸ªé€‰é¡¹å¯ä»¥æ’é™¤ä¸€äº›å·¨å¤§çš„æ–‡ä»¶å¤¹ï¼Œé¿å…å ç”¨å¤§é‡çš„ CPU æˆ–è€…å†…å­˜ã€‚å¤šä¸ªå¯ä»¥æ˜¯æ•°ç»„
  }
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¿è¡Œè„šæœ¬å‘½ä»¤ <code>yarn run watch</code>ï¼Œç„¶åå°±ä¼šçœ‹åˆ° webpack æ˜¯å¦‚ä½•ç¼–è¯‘ä»£ç çš„ã€‚åŒæ—¶ä½ ä¼šå‘ç°å¹¶æ²¡æœ‰é€€å‡ºå‘½ä»¤è¡Œï¼Œè¿™æ˜¯å› ä¸ºæ­¤ script å½“å‰è¿˜åœ¨ watch ä½ æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬éšæ„æ›´æ”¹ä¸€è¡Œä»£ç ï¼Œç„¶åä¿å­˜ï¼Œæ¥ç€æˆ‘ä»¬åº”è¯¥å¯ä»¥åœ¨ç»ˆç«¯ï¼ˆTerminalï¼‰çª—å£å¯ä»¥çœ‹åˆ° webpack è‡ªåŠ¨åœ°é‡æ–°ç¼–è¯‘ä¿®æ”¹åçš„æ¨¡å—ï¼</p>
<blockquote>
<p>å®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œä¸ºäº†çœ‹åˆ°ä¿®æ”¹åçš„å®é™…æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦åˆ·æ–°æµè§ˆå™¨ã€‚æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¯¹å§ã€‚è¿˜æœ‰ï¼Œå®ƒè·Ÿ <code>webpack-dev-server</code> å’Œ <code>webpack-dev-middleware</code> ä¸åŒçš„æ˜¯ï¼Œå‰è€…æ¯æ¬¡æ›´æ”¹éƒ½ä¼šé‡æ–°æ‰“åŒ…åˆ°æœ¬åœ°ï¼Œè€Œåè€…æ˜¯å°† bundle æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·å‰è€…é€Ÿåº¦ä¼šæ…¢å¾ˆå¤šã€‚</p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰èƒ½å¤Ÿè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ <code>webpack-dev-server</code> å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
</blockquote>
<h3>ä½¿ç”¨ webpack-dev-server</h3>
<p>å®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„ web serverï¼Œå¹¶ä¸”å…·æœ‰ live reloading ï¼ˆå®æ—¶é‡æ–°åŠ è½½ï¼‰åŠŸèƒ½ã€‚</p>
<blockquote>
<p>webpack-dev-server åœ¨ç¼–è¯‘ä¹‹åä¸ä¼šå†™å…¥åˆ°ä»»ä½•è¾“å‡ºæ–‡ä»¶ã€‚è€Œæ˜¯å°† bundle æ–‡ä»¶ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œç„¶åå°†å®ƒä»¬ serve åˆ° server ä¸­ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯æŒ‚è½½åœ¨ server æ ¹è·¯å¾„ä¸Šçš„çœŸå®æ–‡ä»¶ä¸€æ ·ã€‚å¦‚æœä½ çš„é¡µé¢å¸Œæœ›åœ¨å…¶ä»–ä¸åŒè·¯å¾„ä¸­æ‰¾åˆ° bundle æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>devServer</code> é…ç½®ä¸­çš„Â <a href="https://v4.webpack.docschina.org/configuration/dev-server/#devserver-publicpath-"><code>publicPath</code></a>Â é€‰é¡¹è¿›è¡Œä¿®æ”¹ã€‚</p>
</blockquote>
<p><code>webpack-dev-server</code> å®é™…ä¸Šç›¸å½“äºå¯ç”¨äº†ä¸€ä¸ª <code>express</code> çš„ HTTP æœåŠ¡å™¨ + è°ƒç”¨ <code>webpack-dev-middleware</code>ã€‚å®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥ä¼ºæœèµ„æºæ–‡ä»¶ã€‚è¿™ä¸ª HTTP æœåŠ¡å™¨å’Œ Client ä½¿ç”¨äº† Websocket é€šè®¯åè®®ï¼ŒåŸå§‹æ–‡ä»¶ä½œå‡ºæ”¹åŠ¨åï¼Œ<code>webpack-dev-server</code> ä¼šç”¨ webpack å®æ—¶çš„ç¼–è¯‘ï¼Œå†ç”¨ <code>webpack-dev-middleware</code> å°† webpack ç¼–è¯‘åæ–‡ä»¶ä¼šè¾“å‡ºåˆ°å†…å­˜ä¸­ã€‚é€‚åˆçº¯å‰ç«¯é¡¹ç›®ï¼Œå¾ˆéš¾ç¼–å†™åç«¯æœåŠ¡ï¼Œè¿›è¡Œæ•´åˆã€‚</p>
<h3>ä½¿ç”¨ webpack-dev-middleware</h3>
<p><code>webpack-dev-middleware</code> æ˜¯ä¸€ä¸ªå°è£…å™¨ï¼ˆwrapperï¼‰ï¼Œå®ƒå¯ä»¥æŠŠ webpack å¤„ç†è¿‡çš„æ–‡ä»¶å‘é€åˆ°ä¸€ä¸ª serverã€‚</p>
<p><code>webpack-dev-middleware</code> è¾“å‡ºçš„æ–‡ä»¶å­˜åœ¨äºå†…å­˜ä¸­ã€‚ä½ å®šä¹‰äº† <code>webpack.config.js</code>ï¼Œwebpack å°±èƒ½æ®æ­¤æ¢³ç†å‡º <code>entry</code> å’Œ <code>output</code> æ¨¡å—çš„å…³ç³»è„‰ç»œï¼Œè€Œ <code>webpack-dev-middleware</code> å°±åœ¨æ­¤åŸºç¡€ä¸Šå½¢æˆä¸€ä¸ªæ–‡ä»¶æ˜ å°„ç³»ç»Ÿï¼Œæ¯å½“åº”ç”¨ç¨‹åºè¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒåŒ¹é…åˆ°äº†å°±æŠŠå†…å­˜ä¸­ç¼“å­˜çš„å¯¹åº”ç»“æœä»¥æ–‡ä»¶çš„æ ¼å¼è¿”å›ç»™ä½ ï¼Œåä¹‹åˆ™è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<p>å› ä¸ºæ˜¯å†…å­˜å‹æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥é‡å»ºé€Ÿåº¦éå¸¸å¿«ï¼Œå¾ˆé€‚åˆäºå¼€å‘é˜¶æ®µç”¨ä½œé™æ€èµ„æºæœåŠ¡å™¨ï¼›å› ä¸º webpack å¯ä»¥æŠŠä»»ä½•ä¸€ç§èµ„æºéƒ½å½“ä½œæ˜¯æ¨¡å—æ¥å¤„ç†ï¼Œå› æ­¤èƒ½å‘å®¢æˆ·ç«¯åé¦ˆå„ç§æ ¼å¼çš„èµ„æºï¼Œæ‰€ä»¥å¯ä»¥æ›¿ä»£ HTTP æœåŠ¡å™¨ã€‚äº‹å®ä¸Šï¼Œå¤§å¤šæ•° webpack ç”¨æˆ·ç”¨è¿‡çš„ <code>webpack-dev-server</code> å°±æ˜¯ä¸€ä¸ª <code>express</code>ï¼‹<code>webpack-dev-middleware</code> çš„å®ç°ã€‚äºŒè€…çš„åŒºåˆ«ä»…åœ¨äº <code>webpack-dev-server</code> æ˜¯å°è£…å¥½çš„ï¼Œé™¤äº† <code>webpack.config.js</code> å’Œå‘½ä»¤è¡Œå‚æ•°ä¹‹å¤–ï¼Œå¾ˆéš¾å»åšå®šåˆ¶å‹å¼€å‘ã€‚è€Œ <code>webpack-dev-middleware</code> æ˜¯ä¸­é—´ä»¶ï¼Œå¯ä»¥ç¼–å†™è‡ªå·±çš„åç«¯æœåŠ¡ç„¶åæŠŠå®ƒæ•´åˆè¿›æ¥ï¼Œç›¸å¯¹è€Œè¨€æ¯”è¾ƒçµæ´»è‡ªç”±ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://www.cnblogs.com/wangpenghui522/p/6826182.html">webpack-dev-server å’Œ webpack-dev-middleware çš„åŒºåˆ«</a></li>
<li><a href="https://segmentfault.com/a/1190000005614604">æ‰‹æŠŠæ‰‹æ·±å…¥ç†è§£ webpack dev middleware åŸç†èˆ‡ç›¸é—œ plugins</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Webpack å¦‚ä½•è§£ææ¨¡å—è·¯å¾„]]></title>
            <link>https://github.com/toFrankie/blog/issues/71</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/71</guid>
            <pubDate>Sat, 25 Feb 2023 11:59:28 GMT</pubDate>
            <description><![CDATA[<p>ä½ ä¸€å®šè§è¿‡è¿™äº›å¯¼å…¥æ–¹å¼ï¼Œæ— è®ºæ˜¯ ESM è¿˜æ˜¯ CommonJS æ¨¡å—ï¼Œæˆ–æ˜¯å…¶ä»–æ¨¡å—è§„èŒƒã€‚</p>
<pre><code class="language-js">import react from 'react'
import button from './components/button'
const path]]></description>
            <content:encoded><![CDATA[<p>ä½ ä¸€å®šè§è¿‡è¿™äº›å¯¼å…¥æ–¹å¼ï¼Œæ— è®ºæ˜¯ ESM è¿˜æ˜¯ CommonJS æ¨¡å—ï¼Œæˆ–æ˜¯å…¶ä»–æ¨¡å—è§„èŒƒã€‚</p>
<pre><code class="language-js">import react from 'react'
import button from './components/button'
const path = require('path')
</code></pre>
<p>é‚£ä¹ˆ webpack æ˜¯å¦‚ä½•å»è§£ææŸ¥æ‰¾å®ƒä»¬çš„å‘¢ï¼Ÿ</p>
<h3>æ¨¡å—è§£æ</h3>
<p>resolver æ˜¯ä¸€ä¸ªåº“ï¼ˆlibraryï¼‰ï¼Œç”¨äºå¸®åŠ©æ‰¾åˆ°æ¨¡å—çš„ç»å¯¹è·¯å¾„ã€‚ä¸€ä¸ªæ¨¡å—å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªæ¨¡å—çš„ä¾èµ–æ¨¡å—ï¼Œç„¶åè¢«åè€…å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-js">import foo from 'path/to/module'
</code></pre>
<p>æ‰€ä¾èµ–çš„æ¨¡å—å¯ä»¥æ˜¯æ¥è‡ªåº”ç”¨ç¨‹åºæˆ–è€…ç¬¬ä¸‰æ–¹åº“ï¼ˆlibraryï¼‰ã€‚resolver å¸®åŠ© webpack æ‰¾åˆ° bundle ä¸­éœ€è¦å¼•å…¥çš„æ¨¡å—ä»£ç ï¼Œè¿™äº›ä»£ç åœ¨æ¯ä¸ª import/require è¯­å¥ä¸­ã€‚</p>
<p>webpack ä½¿ç”¨ <a href="https://github.com/webpack/enhanced-resolve/">enhanced-resolve</a> æ¥è§£ææ–‡ä»¶è·¯å¾„ã€‚</p>
<h3>è§£æè§„åˆ™</h3>
<p>ä½¿ç”¨ enhanced-resolve è§£ææ¨¡å—ï¼Œæ”¯æŒä¸‰ç§å½¢å¼ï¼š<strong>ç»å¯¹è·¯å¾„</strong>ã€<strong>ç›¸å¯¹è·¯å¾„</strong>ã€<strong>æ¨¡å—è·¯å¾„</strong>ã€‚</p>
<h5>1. ç»å¯¹è·¯å¾„</h5>
<p>ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<p>ç”±äºå·²ç»å–å¾—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå› æ­¤ä¸éœ€è¦è¿›ä¸€æ­¥å†åšè§£æäº†ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé™¤äº†è®¾ç½®åˆ«å <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-alias">resolve.alias</a> æ—¶é‡‡ç”¨ç»å¯¹è·¯å¾„çš„æ–¹å¼ï¼Œå…¶ä»–çš„æˆ‘å‡ ä¹æ²¡è§è¿‡ä½¿ç”¨ç»å¯¹è·¯å¾„çš„ã€‚ï¼ˆä¹Ÿå¯èƒ½æˆ‘è¯»çš„é¡¹ç›®å¤ªå°‘äº†ï¼‰</p>
<pre><code class="language-js">import button from '/Users/frankie/component/button'
</code></pre>
<h5>2. ç›¸å¯¹è·¯å¾„</h5>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ import/require çš„èµ„æºæ–‡ä»¶ï¼ˆresource fileï¼‰æ‰€åœ¨çš„ç›®å½•è¢«è®¤ä¸ºæ˜¯<strong>ä¸Šä¸‹æ–‡ç›®å½•</strong>ï¼ˆcontext directoryï¼‰ã€‚åœ¨ import/require ä¸­ç»™å®šçš„ç›¸å¯¹è·¯å¾„ï¼Œä¼šæ·»åŠ æ­¤ä¸Šä¸‹æ–‡è·¯å¾„ï¼ˆcontext pathï¼‰ï¼Œä»¥äº§ç”Ÿæ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼ˆabsolute pathï¼‰ã€‚</p>
<pre><code class="language-js">import button from './component/button'
</code></pre>
<h5>3. æ¨¡å—è·¯å¾„</h5>
<p>ä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œåº”è¯¥æ²¡æœ‰å¤ªå¤šç†è§£éš¾åº¦ï¼Œè€Œæ¨¡å—åæ‰æ˜¯æˆ‘ä»¬è¦é‡ç‚¹ç†è§£çš„ã€‚</p>
<p>ç›´æ¥å¼•å…¥æ¨¡å—åï¼Œé¦–å…ˆæŸ¥æ‰¾å½“å‰æ–‡ä»¶ç›®å½•ï¼Œè‹¥æŸ¥æ‰¾ä¸åˆ°ï¼Œä¼šç»§ç»­å¾€çˆ¶çº§ç›®å½•ä¸€ä¸ªä¸€ä¸ªåœ°æŸ¥æ‰¾ï¼Œç›´è‡³åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <a href="#">node_modules</a> ç›®å½•ï¼ˆé»˜è®¤ï¼‰ã€‚è‹¥å†æŸ¥æ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<pre><code class="language-js">import 'react'
import 'module/lib/file'
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>é»˜è®¤çš„ <code>node_modules</code> å¯ä»¥é€šè¿‡ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-modules">resolve.modules</a> è¿›è¡Œæ›´æ”¹ã€‚</li>
<li>æŸ¥æ‰¾ä¸­ä¼šæ ¹æ® <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-extensions">resolve.extensions</a> è‡ªåŠ¨è¡¥å…¨æ‰©å±•åï¼Œé»˜è®¤æ˜¯ <code>['.wasm', '.mjs', '.js', '.json']</code>ã€‚</li>
<li>æŸ¥æ‰¾ä¸­ä¼šæ ¹æ® <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-alias">resolve.alias</a> æ›¿æ¢æ‰åˆ«åã€‚</li>
</ul>
</blockquote>
<p>æ¨¡å—å°†åœ¨ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-modules">resolve.modules</a> ä¸­æŒ‡å®šçš„ç›®å½•å†…æœç´¢ã€‚å¯ä»¥é€šè¿‡ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-alias">resolve.alias</a> é…ç½®åˆ›å»ºä¸€ä¸ªåˆ«åæ¥æ›¿æ¢åˆå§‹æ¨¡å—è·¯å¾„ã€‚</p>
<p>ä¸€æ—¦ä¸Šè¿°è§„åˆ™è§£æè·¯å¾„ä¹‹åï¼Œè§£æå™¨ï¼ˆresolverï¼‰å°†æ£€æŸ¥è·¯å¾„æ˜¯å¦æŒ‡å‘<strong>æ–‡ä»¶</strong>æˆ–<strong>ç›®å½•</strong>ã€‚</p>
<ul>
<li>
<p><strong>æŒ‡å‘æ–‡ä»¶</strong></p>
<ol>
<li>å¦‚æœè·¯å¾„å…·æœ‰æ–‡ä»¶æ‰©å±•åï¼Œåˆ™è¢«ç›´æ¥æ‰“åŒ…ã€‚</li>
<li>å¦åˆ™ï¼Œå°†ä½¿ç”¨ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-extensions">resolve.extensions</a> é€‰é¡¹ä½œä¸ºæ–‡ä»¶æ‰©å±•åæ¥è§£æã€‚</li>
</ol>
</li>
<li>
<p><strong>æŒ‡å‘ç›®å½•</strong></p>
<p>æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰¾åˆ°å…·æœ‰æ­£ç¡®æ‰©å±•åçš„æ–‡ä»¶ï¼š</p>
<ol>
<li>å¦‚æœæ–‡ä»¶å¤¹ä¸­åŒ…å« package.json æ–‡ä»¶ï¼Œåˆ™æŒ‰é¡ºåºæŸ¥æ‰¾ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-mainfields">resolve.mainFields</a> é…ç½®é€‰é¡¹ä¸­æŒ‡å®šçš„å­—æ®µï¼Œå¹¶ä¸” package.json ä¸­çš„ç¬¬ä¸€ä¸ªè¿™æ ·çš„å­—æ®µç¡®å®šæ–‡ä»¶è·¯å¾„ã€‚</li>
<li>å¦‚æœ package.json æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€… package.json æ–‡ä»¶ä¸­ main å­—æ®µæ²¡æœ‰è¿”å›ä¸€ä¸ªæœ‰æ•ˆè·¯å¾„ï¼Œåˆ™æŒ‰é¡ºåºæŸ¥æ‰¾ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-mainfields">resolve.mainFields</a> é…ç½®é€‰é¡¹ä¸­æŒ‡å®šçš„æ–‡ä»¶åï¼Œçœ‹æ˜¯å¦èƒ½åœ¨ import/require ç›®å½•ä¸‹åŒ¹é…åˆ°ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶åã€‚</li>
<li>æ–‡ä»¶æ‰©å±•åé€šè¿‡ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-extensions">resolve.extensions</a> é€‰é¡¹é‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•è¿›è¡Œè§£æã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<p>è‹¥ä½¿ç”¨ webpack-dev-server 3.x ç‰ˆæœ¬ï¼Œå»ºè®®ä¸è¦éšæ„ä¿®æ”¹ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-mainfields">resolve.mainFields</a> é…ç½®é¡¹ï¼Œå®ƒä¼šæŠ¥é”™ã€‚å·²ç¡®è®¤æ˜¯ webpack-dev-server çš„ bugï¼Œå°†åœ¨ä¸ä¹…è¦å‘å¸ƒçš„ 4.x ç‰ˆæœ¬ä¿®å¤ã€‚<a href="https://www.jianshu.com/p/c8c51c6fcbf0">è¯¦è¯· #2801</a></p>
</blockquote>
<h3>è§£æä¸ç¼“å­˜</h3>
<p>Loader è§£æéµå¾ªä¸æ–‡ä»¶è§£æå™¨æŒ‡å®šçš„è§„åˆ™ç›¸åŒçš„è§„åˆ™ã€‚<a href="">resolveLoader</a> é…ç½®é€‰é¡¹å¯ä»¥ç”¨æ¥ä¸º Loader æä¾›ç‹¬ç«‹çš„è§£æè§„åˆ™ã€‚</p>
<p>æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿè®¿é—®éƒ½è¢«ç¼“å­˜ï¼Œä»¥ä¾¿æ›´å¿«è§¦å‘å¯¹åŒä¸€æ–‡ä»¶çš„å¤šä¸ªå¹¶è¡Œæˆ–è€…ä¸²è¡Œè¯·æ±‚ã€‚åœ¨è§‚å¯Ÿæ¨¡å¼ä¸‹ï¼Œåªæœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ä¼šä»ç¼“å­˜ä¸­æ‘˜å‡ºã€‚å¦‚æœå…³é—­è§‚å¯Ÿæ¨¡å¼ï¼Œåœ¨æ¯æ¬¡ç¼–è¯‘å‰æ¸…ç†ç¼“å­˜ã€‚</p>
<h3>Resolve é…ç½®</h3>
<p>è¯¥é€‰é¡¹ç”¨äºé…ç½®æ¨¡å—å¦‚ä½•è§£æã€‚ä¾‹å¦‚ï¼Œå½“åœ¨ ES6 ä¸­è°ƒç”¨ <code>import 'lodash'</code>ï¼Œ<code>resolve</code> é€‰é¡¹èƒ½å¤Ÿå¯¹ webpack æŸ¥æ‰¾ <code>lodash</code> çš„æ–¹å¼å»åšä¿®æ”¹ã€‚</p>
<h5>1. <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-alias">resolve.alias</a></h5>
<p>åˆ›å»º import æˆ– require çš„åˆ«åï¼Œæ¥ç¡®ä¿æ¨¡å—å¼•å…¥å˜å¾—æ›´ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€äº›ä½äº src/ æ–‡ä»¶å¤¹ä¸‹çš„å¸¸ç”¨æ¨¡å—ï¼š</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path')

module.exports = {
  //...
  resolve: {
    alias: {
      // å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…æ˜¯ç›¸å¯¹è·¯å¾„ã€‚
      // æ®æˆ‘ä¸å®Œå…¨è§‚å¯Ÿï¼Œç»“åˆ path æ¨¡å—å’Œ __dirname æ‹¼æ¥æˆâ€œç»å¯¹è·¯å¾„â€çš„æ–¹æ¡ˆæ›´å¤šã€‚
      // ä»¥ä¸‹ä¸ºæ¨¡ç³ŠåŒ¹é…
      Utilities: path.resolve(__dirname, 'src/utilities/'),
      Templates: path.resolve(__dirname, 'src/templates/')
    }
  }
}
</code></pre>
<p>ç°åœ¨ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨åˆ«åäº†ï¼š</p>
<pre><code class="language-js">import Utility from '../../utilities/utility'

// åˆ«å
import Utility from 'Utilities/utility'
</code></pre>
<p>ä¹Ÿå¯ä»¥åœ¨ç»™å®šçš„å¯¹è±¡çš„é”®åçš„æœ«å°¾æ·»åŠ  <code>$</code>ï¼Œä»¥è¡¨ç¤ºç²¾å‡†åŒ¹é…ã€‚è¿™é‡Œä¸å±•å¼€èµ˜è¿°ï¼Œè¯¦ç»†è¯·çœ‹<a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-alias">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œé‡‡ç”¨åˆ«åå¼•å…¥æ¨¡å—æ—¶ï¼Œ<strong>å…ˆæ›¿æ¢åè§£æ</strong>ã€‚å…ˆå°†æ¨¡å—è·¯å¾„ä¸­åŒ¹é… <code>alias</code> ä¸­çš„ <code>key</code> æ›¿æ¢æˆå¯¹åº”çš„ <code>value</code>ï¼Œå†åšæŸ¥æ‰¾ã€‚</p>
</blockquote>
<h5>2. <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-extensions">resolve.extensions</a></h5>
<p>è‡ªåŠ¨è§£æç¡®å®šçš„æ‰©å±•ã€‚</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  //...
  resolve: {
    // ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œä¼šè¦†ç›–é»˜è®¤æ•°ç»„ï¼Œé»˜è®¤å€¼ï¼š['.wasm', '.mjs', '.js', '.json']ã€‚
    // æ³¨æ„ä¸è¦å°‘äº†ç¬¦å·ï¼ˆ.ï¼‰ï¼Œæœ‰äº›äººé…ç½®ä¸æˆåŠŸï¼Œå°±æ˜¯å› ä¸ºå°‘äº†å®ƒã€‚
    // ä»å·¦åˆ°å³ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰å…ˆååŒ¹é…æ‰©å±•åï¼Œé€‰é¡¹ä¸­æ²¡æœ‰çš„åç¼€ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è¡¥å…¨çš„ã€‚
    extensions: ['.js', '.json']
  }
}
</code></pre>
<h5>3. <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-modules">resolve.modules</a></h5>
<p>å‘Šè¯‰ webpack è§£ææ¨¡å—æ—¶åº”è¯¥æœç´¢çš„ç›®å½•ã€‚å¯ä»¥æ˜¯<strong>ç»å¯¹è·¯å¾„</strong>æˆ–è€…<strong>ç›¸å¯¹è·¯å¾„</strong>ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ä¸€ç‚¹å·®å¼‚ã€‚</p>
<p>é€šè¿‡æŸ¥çœ‹å½“å‰ç›®å½•ä»¥åŠç¥–å…ˆè·¯å¾„ï¼ˆå³ <code>./node_modules</code>ï¼Œ<code>../node_modules</code> ç­‰ç­‰ï¼‰ï¼Œç›¸å¯¹è·¯å¾„å°†ç±»ä¼¼äº Node æŸ¥æ‰¾ <code>node_modules</code> çš„æ–¹å¼è¿›è¡ŒæŸ¥æ‰¾ã€‚</p>
<p>å½“ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå°†åªåœ¨ç»™å®šç›®å½•ä¸­æœç´¢ã€‚</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path')

module.exports = {
  //...
  resolve: {
    // é»˜è®¤å€¼
    modules: ['node_modules']
    // æ·»åŠ ä¸€ä¸ªç›®å½•åˆ°æ¨¡å—æœç´¢ç›®å½•ï¼Œæ­¤ç›®å½•ä¼˜å…ˆäº node_modules æœç´¢ã€‚
    modules: [path.resolve(__dirname, 'src'), 'node_modules']
  }
}
</code></pre>
<blockquote>
<p>ä¸€èˆ¬åœ°ï¼Œä¸è¦å»æ›´æ”¹è¯¥é€‰é¡¹ã€‚</p>
</blockquote>
<h5>4. <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-mainfields">resolve.mainFields</a></h5>
<p>å½“ä» npm åŒ…ä¸­å¯¼å…¥æ¨¡å—æ—¶ï¼ˆä¾‹å¦‚ï¼Œ<code>import * as D3 from 'd3'</code>ï¼‰ï¼Œæ­¤é€‰é¡¹å°†å†³å®šåœ¨Â <code>package.json</code>Â ä¸­ä½¿ç”¨å“ªä¸ªå­—æ®µå¯¼å…¥æ¨¡å—ã€‚æ ¹æ® webpack é…ç½®ä¸­æŒ‡å®šçš„Â <a href="https://v4.webpack.docschina.org/concepts/targets">target</a>Â ä¸åŒï¼Œé»˜è®¤å€¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  //...
  resolve: {
    // ä¸å»ºè®®ä¿®æ”¹

    // target ä¸º webworkerã€web æˆ–æ²¡æœ‰æŒ‡å®šæ—¶ï¼Œé»˜è®¤å€¼ä¸ºï¼š
    mainFields: ['browser', 'module', 'main'],

    // é™¤å»ä¸Šè¿°å‡ ä¸ª targetï¼Œå¯¹äºå…¶ä»–ä»»æ„ targetï¼ˆåŒ…æ‹¬ nodeï¼‰ï¼Œé»˜è®¤å€¼ä¸ºï¼š
    mainFields: ['browser', 'module', 'main']
  }
}
</code></pre>
<blockquote>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„ <code>package.json</code> éƒ½ä¸ä¼šå£°æ˜ <code>browser</code> æˆ– <code>module</code> å­—æ®µï¼Œæ‰€ä»¥ä¾¿æ˜¯ä½¿ç”¨ <code>main</code> äº†ã€‚ï¼ˆè¯¥é€‰é¡¹åŒæ ·ä¸å»ºè®®æ›´æ”¹ï¼‰</p>
</blockquote>
<h5>5. <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-mainfiles">resolve.mainFiles</a></h5>
<p>è§£æç›®å½•æ—¶è¦ä½¿ç”¨çš„æ–‡ä»¶åã€‚</p>
<p>å½“ç›®å½•ä¸­æ²¡æœ‰ <code>package.json</code> æ—¶ï¼Œç»“åˆ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve-extensions">resolve.extensions</a> æ¥æŒ‡æ˜ä½¿ç”¨è¯¥ç›®å½•ä¸­å“ªä¸ªæ–‡ä»¶ã€‚</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  //...
  resolve: {
    // é»˜è®¤å€¼
    // å¯æ·»åŠ å¤šä¸ªï¼Œä½†ä¸å»ºè®®ä¿®æ”¹ã€‚
    mainFiles: ['index']
  }
}
</code></pre>
<blockquote>
<p>**å°½å¯èƒ½åœ°ï¼Œä¸è¦å»ä¿®æ”¹è¯¥é€‰é¡¹ã€‚**å› ä¸ºå®ƒåŒæ ·ä¼šå½±å“ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…è§£æï¼Œå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†ç¬¬ä¸‰æ–¹åŒ…è§£æé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨éªŒè¯è¯¥é…ç½®æ—¶ï¼Œå°±å‘ç° webpack-dev-server v3 çš„ä¸€ä¸ª <a href="https://www.jianshu.com/p/c8c51c6fcbf0">bug</a>ï¼Œå¼€å‘è€…è¡¨ç¤ºå°†åœ¨ v4 ç‰ˆæœ¬ä¸­ä¿®å¤ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸å»ºè®®éšæ„ä¿®æ”¹çš„é…ç½®åŒ…æ‹¬ <a href="">modules</a>ã€<a href="">mainFields</a>ã€<a href="">mainFiles</a>ã€‚</p>
</blockquote>
<h5>6. æ›´å¤š</h5>
<p>å®ƒè¿˜æœ‰å…¶ä»–ä¸€äº›é…ç½®é¡¹ï¼Œä½†æ¯”è¾ƒå°‘ç”¨ï¼Œæ‰€ä»¥ä¸å±•å¼€èµ˜è¿°ã€‚æ›´å¤šè¯·çœ‹<a href="https://v4.webpack.docschina.org/configuration/resolve/#resolve">è¿™é‡Œ</a>ã€‚</p>
<h3>ResolveLoader é…ç½®</h3>
<p>ä» webpack 2 å¼€å§‹ï¼Œåœ¨é…ç½® loader æ—¶**<a href="https://v4.webpack.docschina.org/migrate/3/#automatic-loader-module-name-extension-removed">å¼ºçƒˆå»ºè®®</a>ä½¿ç”¨å…¨å**ã€‚ä¾‹å¦‚Â <code>example-loader</code>ï¼Œä»¥å°½å¯èƒ½åœ°æ¸…æ™°ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœä½ ç¡®å®æƒ³çœç•¥Â <code>-loader</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åªä½¿ç”¨Â <code>example</code>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <a href="https://v4.webpack.docschina.org/configuration/resolve/#resolveloader-moduleextensions">resolveLoader.moduleExtensions</a> æ­¤é€‰é¡¹æ¥å®ç°ï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  //...
  resolve: {
    // ...
  }
  resolveLoader: {
    moduleExtensions: ['-loader']
  }
}
</code></pre>
<blockquote>
<p>æˆ‘ä½¿ç”¨ webpack 4 åœ¨ä¸é…ç½®è¯¥é€‰é¡¹æ—¶ï¼Œå‡å¦‚å°† <code>css-loader</code> çœç•¥ä¸º <code>css</code>ï¼Œä¼šæŠ¥é”™æç¤ºæ‰¾ä¸åˆ° loaderã€‚ä¸ºä»€ä¹ˆæˆ‘ä¼šå•ç‹¬æ‹¿å‡ºæ¥ä»‹ç»ä¸€ä¸‹ï¼Œå› ä¸ºç½‘ä¸Šå¾ˆå¤šæ–‡ç« è¡¨ç¤ºåœ¨é…ç½® <a href="https://v4.webpack.docschina.org/configuration/module/#rule-rules">module.rules</a> æ—¶å¯ä»¥çœç•¥ <code>-loader</code>ï¼Œä½†æˆ‘æ˜¯çœç•¥äº†å°±ä¸è¡Œã€‚æ‰€ä»¥è¿™é‡Œè¡¥å……ä¸€ä¸‹åŸå› ã€‚</p>
</blockquote>
<h3>å°æŠ€å·§</h3>
<p>å…³äº webpack é»˜è®¤é…ç½®å¯ä»¥ä» <code>node_modules/webpack/lib/WebpackOptionsDefaulter.js</code> æŸ¥çœ‹ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://v4.webpack.docschina.org/configuration/resolve/">webpack resolve</a></li>
<li><a href="https://juejin.im/post/6844903607439982599">æ·±å…¥ç†è§£ webpack å¦‚ä½•è§£æä»£ç è·¯å¾„</a></li>
<li><a href="https://www.cnblogs.com/xiaohuochai/p/7002765.html">webpack æ¨¡å—è§£æ</a></li>
<li><a href="https://www.jianshu.com/p/68cd9f5d2094">resolve å±æ€§çš„é…ç½®</a></li>
<li><a href="https://blog.csdn.net/qq_34178990/article/details/81256368">node.js æ¨¡å—æ–‡ä»¶æŸ¥æ‰¾</a></li>
<li><a href="https://v4.webpack.docschina.org/concepts/module-resolution/">æ¨¡å—è§£æï¼ˆmodule resolutionï¼‰</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Webpack å­¦ä¹ å¿ƒå¾—]]></title>
            <link>https://github.com/toFrankie/blog/issues/69</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/69</guid>
            <pubDate>Sat, 25 Feb 2023 11:58:08 GMT</pubDate>
            <description><![CDATA[<ol>
<li>æ³¨æ„ï¼Œå‘½ä»¤è¡Œæ¥å£(Command Line Interface)å‚æ•°çš„ä¼˜å…ˆçº§ï¼Œé«˜äºé…ç½®æ–‡ä»¶å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°† --mode=&quot;production&quot; ä¼ å…¥ webpack CLIï¼Œè€Œé…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ developmentï¼Œæœ€ç»ˆä¼šä½¿ç”¨ productionã€‚</li>
</ol>
]]></description>
            <content:encoded><![CDATA[<ol>
<li>æ³¨æ„ï¼Œå‘½ä»¤è¡Œæ¥å£(Command Line Interface)å‚æ•°çš„ä¼˜å…ˆçº§ï¼Œé«˜äºé…ç½®æ–‡ä»¶å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°† --mode=&quot;production&quot; ä¼ å…¥ webpack CLIï¼Œè€Œé…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ developmentï¼Œæœ€ç»ˆä¼šä½¿ç”¨ productionã€‚</li>
</ol>
<blockquote>
<p>Webpack CLI æŒ‡å—: <a href="https://webpack.docschina.org/api/cli">https://webpack.docschina.org/api/cli</a></p>
</blockquote>
<ol start="2">
<li>æ¨¡å—çƒ­ï¼ˆHot Module Replacementï¼‰æ›¿æ¢é€‰æ‹©</li>
</ol>
<p>åœ¨æ¯æ¬¡ç¼–è¯‘ä»£ç æ—¶ï¼Œæ‰‹åŠ¨è¿è¡Œ npm run build ä¼šæ˜¾å¾—å¾ˆéº»çƒ¦ã€‚webpack æä¾›å‡ ç§å¯é€‰æ–¹å¼ï¼Œå¸®åŠ©ä½ åœ¨ä»£ç å‘ç”Ÿå˜åŒ–åè‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼š</p>
<ul>
<li>webpack watch mode(webpack è§‚å¯Ÿæ¨¡å¼ï¼Œä¸å»ºè®®)</li>
<li>webpack-dev-server</li>
<li>webpack-dev-middleware</li>
</ul>
<p><a href="https://webpack.docschina.org/guides/development/#%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7">é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå¼€å‘å·¥å…·</a></p>
<p>webpack-dev-server é…å¥—è®¾ç½®</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  devServer: {
    hot: true
  }
}
</code></pre>
<blockquote>
<p>å¦‚æœä½ åœ¨æŠ€æœ¯é€‰å‹ä¸­ä½¿ç”¨äº†Â <code>webpack-dev-middleware</code>Â è€Œæ²¡æœ‰ä½¿ç”¨Â <code>webpack-dev-server</code>ï¼Œè¯·ä½¿ç”¨Â <a href="https://github.com/webpack-contrib/webpack-hot-middleware"><code>webpack-hot-middleware</code></a>Â packageï¼Œä»¥åœ¨ä½ çš„è‡ªå®šä¹‰ server æˆ–åº”ç”¨ç¨‹åºä¸Šå¯ç”¨ HMRã€‚
webpack-dev-server åœ¨å†…éƒ¨ä½¿ç”¨äº† webpack-dev-middleware</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåäº”ï¼‰2020-12-23]]></title>
            <link>https://github.com/toFrankie/blog/issues/68</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/68</guid>
            <pubDate>Sat, 25 Feb 2023 11:54:04 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/67">æ–‡ç« </a>ä»‹ç»äº† webpack çš„ <code>entry</code>ã€<code>output</code>ã€<code>module</code>ã€<code>resolve</code>ã€]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/67">æ–‡ç« </a>ä»‹ç»äº† webpack çš„ <code>entry</code>ã€<code>output</code>ã€<code>module</code>ã€<code>resolve</code>ã€<code>mode</code>ã€<code>devtool</code>ã€<code>plugins</code>ã€<code>webpack-dev-server</code> é…ç½®ã€‚</p>
<p>ä½†ç”±äºç¯‡å¹…è¿‡é•¿ï¼Œæ¥ç€<a href="https://www.jianshu.com/p/84f3127ae4a9">ä¸Šä¸€ç¯‡</a>ç»§ç»­å†™...</p>
<h3>9. ä¼˜åŒ–ï¼ˆoptimizationï¼‰</h3>
<p>ä» webpack 4 å¼€å§‹ï¼Œç§»é™¤äº† <a href="https://segmentfault.com/a/1190000012828879"><code>CommonsChunkPlugin</code></a>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ <a href="https://v4.webpack.docschina.org/configuration/optimization/"><code>optimization.splitChunks</code></a>ã€‚webpack 4 ä¼šæ ¹æ®ä½ é€‰æ‹©çš„Â <a href="https://v4.webpack.docschina.org/concepts/mode/"><code>mode</code></a>Â æ¥æ‰§è¡Œä¸åŒçš„ä¼˜åŒ–ï¼Œä¸è¿‡æ‰€æœ‰çš„ä¼˜åŒ–è¿˜æ˜¯å¯ä»¥æ‰‹åŠ¨é…ç½®å’Œé‡å†™ã€‚</p>
<blockquote>
<p>TheÂ <code>CommonsChunkPlugin</code>Â was removed. Instead theÂ <a href="https://v4.webpack.docschina.org/configuration/optimization/#optimization-splitchunks"><code>optimization.splitChunks</code></a>Â options can be used.</p>
</blockquote>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåå››ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/67</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/67</guid>
            <pubDate>Sat, 25 Feb 2023 11:53:08 GMT</pubDate>
            <description><![CDATA[<p>å‰é¢çš„æ–‡ç« ä»‹ç»äº† Webpackã€HMRã€Reactã€Reduxã€ESLintã€Prettier ç­‰å†…å®¹ã€‚</p>
<p>ä½†å…¶å® <a href="https://v4.webpack.docschina.org/concepts/">Webpack 4</a> éƒ¨åˆ†å†…å®¹æ˜¯æ²¡æœ‰æ¯”è¾ƒè¯¦ç»†çš„è®²è¿°çš„ï¼Œé‚£è¿™ç¯‡æ–‡ç« å°±æ¥ä»‹ç»]]></description>
            <content:encoded><![CDATA[<p>å‰é¢çš„æ–‡ç« ä»‹ç»äº† Webpackã€HMRã€Reactã€Reduxã€ESLintã€Prettier ç­‰å†…å®¹ã€‚</p>
<p>ä½†å…¶å® <a href="https://v4.webpack.docschina.org/concepts/">Webpack 4</a> éƒ¨åˆ†å†…å®¹æ˜¯æ²¡æœ‰æ¯”è¾ƒè¯¦ç»†çš„è®²è¿°çš„ï¼Œé‚£è¿™ç¯‡æ–‡ç« å°±æ¥ä»‹ç»å®ƒå§ã€‚</p>
<p>ç¼–å†™æœ¬æ–‡çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯ <code>webpack 5.1.3</code>ã€‚è€Œæœ¬æ–‡è¦ä»‹ç»çš„æ—¶å€™ <code>webpack 4.x</code> ç›¸å…³æ¥å£ã€‚</p>
<blockquote>
<p>æä¾›ä¸¤ä¸ªé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://v4.webpack.docschina.org/concepts/">webpack 4.x ä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://webpack.docschina.org/concepts/">webpack æœ€æ–°ç‰ˆä¸­æ–‡æ–‡æ¡£</a></li>
</ul>
<p>è¯·æ³¨æ„æœ¬æ–‡æ‰€æŒ‡ Webpack ä¸­æ–‡æ–‡æ¡£ç”±<a href="https://docschina.org/">å°è®°ä¸­æ–‡</a>ç¿»è¯‘ã€‚</p>
</blockquote>
<h3>ä¸€ã€å‰è¨€</h3>
<p>åœ¨æ­¤å‰çš„ç³»åˆ—æ–‡ç« ï¼Œå¤šå¤šå°‘å°‘éƒ½æ¶‰åŠåˆ° webpack çš„ç›¸å…³é…ç½®ï¼Œä¸»è¦æœ‰è¿™å‡ é¡¹ã€‚</p>
<p>ä»Šå¤©å°±æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°½å¯èƒ½åœ°éƒ½è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>webpack æ”¯æŒæ‰€æœ‰ç¬¦åˆÂ <a href="https://kangax.github.io/compat-table/es5/">ES5 æ ‡å‡†</a>Â çš„æµè§ˆå™¨ï¼ˆä¸æ”¯æŒ IE8 åŠä»¥ä¸‹ç‰ˆæœ¬ï¼‰ã€‚webpack çš„Â <code>import()</code>Â å’ŒÂ <code>require.ensure()</code>Â éœ€è¦Â <code>Promise</code>ã€‚å¦‚æœä½ æƒ³è¦æ”¯æŒæ—§ç‰ˆæœ¬æµè§ˆå™¨ï¼Œåœ¨ä½¿ç”¨è¿™äº›è¡¨è¾¾å¼ä¹‹å‰ï¼Œè¿˜éœ€è¦<a href="https://v4.webpack.docschina.org/guides/shimming/">æå‰åŠ è½½ polyfill</a>ã€‚</p>
</blockquote>
<pre><code class="language-js">{
  mode, // æ¨¡å¼
  entry, // å…¥å£
  deServer, // å¼€å‘
  optimization, // ä¼˜åŒ–
  plugins, // æ’ä»¶
  resolve, // è§£æ
  module  // æ¨¡å—
}
</code></pre>
<p>å³ä½¿æœ‰äº›å†…å®¹å‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œè¿˜æ˜¯å†å•°å—¦ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h5>å®‰è£…ä¾èµ–åŒ…</h5>
<p>ä¸æ¨èå…¨å±€å®‰è£… webpackã€‚è¿™ä¼šå°†ä½ é¡¹ç›®ä¸­çš„ webpack é”å®šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸åŒçš„ webpack ç‰ˆæœ¬çš„é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ã€‚</p>
<pre><code>$ yarn add --dev webpack@4.41.2
$ yarn add --dev webpack-cli@3.3.10
</code></pre>
<h5>webpack é…ç½®æ–‡ä»¶</h5>
<p>webpack å¼€ç®±å³ç”¨ï¼Œå¯ä»¥æ— éœ€ä½¿ç”¨ä»»ä½•é…ç½®æ–‡ä»¶ã€‚ç„¶è€Œï¼Œé»˜è®¤æƒ…å†µä¸‹ webpack ä¼šå‡å®šé¡¹ç›®çš„å…¥å£èµ·ç‚¹ä¸º <code>src/index</code>ï¼Œç„¶åä¼šåœ¨ <code>dist/main.js</code> è¾“å‡ºç»“æœï¼Œå¹¶ä¸”åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯å‹ç¼©å’Œä¼˜åŒ–ã€‚</p>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬çš„é¡¹ç›®è¿˜éœ€è¦ç»§ç»­æ‰©å±•æ­¤èƒ½åŠ›ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>webpack.config.js</code> æ–‡ä»¶ï¼Œwebpack ä¼šè‡ªåŠ¨ä½¿ç”¨å®ƒã€‚</p>
<p>Webpack é…ç½®æ–‡ä»¶æ˜¯æ ‡å‡†çš„ Node.js CommonJS æ¨¡å—ï¼ˆæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ ESM æ ‡å‡†å¯¼å‡ºï¼‰ï¼Œå¯ä»¥å¯¼å‡ºä¸º objectã€<a href="https://v4.webpack.docschina.org/configuration/configuration-types/#exporting-a-function">function</a>Â æˆ–Â <a href="https://v4.webpack.docschina.org/configuration/configuration-types/#exporting-a-promise">Promise</a>ï¼Œæœ¬é¡¹ç›®å°†ä½¿ç”¨å¯¼å‡º object çš„å½¢å¼ã€‚è™½ç„¶å¯è¡Œï¼Œä½†ä¸å»ºè®®é€šè¿‡ CLI å½¢å¼æŒ‡å®šè¿‡å¤šå‚æ•°ï¼Œä¼šå¯¼è‡´ç¼–å†™å¾ˆé•¿çš„è„šæœ¬å‘½ä»¤ï¼Œæ¨èä½¿ç”¨é…ç½®æ–‡ä»¶çš„å½¢å¼ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåˆ™å¯é€šè¿‡ Webpack CLI å‘½ä»¤ <code>--config</code> æ¥æŒ‡å®šã€‚</p>
</blockquote>
<pre><code class="language-json5">// package.json
// å‡å®šé¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ dev.config.js å’Œ prod.config.jsï¼Œåˆ†åˆ«å¯¹åº”å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼çš„ä¸¤ç§ä¸åŒé…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ --config æ¥æŒ‡å®šäº†ã€‚
{
  &quot;script&quot;: {
    &quot;webpack:dev&quot;: &quot;webpack --config dev.config.js --mode development&quot;,
    &quot;webpack:build&quot;: &quot;webpack --config prod.config.js&quot;
  }
}
</code></pre>
<p>*é™„ä¸Šä¸€ä¸ª <a href="https://v4.webpack.docschina.org/configuration/#%E9%80%89%E9%A1%B9">Webpack é…ç½®æ–‡ä»¶é€‰é¡¹</a>è¯¦è§£ã€‚
*é™„ä¸Šä¸€ä¸ªå‰ç«¯æ„å»ºé…ç½®ç”Ÿæˆå™¨ <a href="https://createapp.dev/">Create App</a>ã€‚</p>
<h5>å¸¸ç”¨ Webpack CLI æ¥å£å‚æ•°</h5>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://v4.webpack.docschina.org/api/cli">å‘½ä»¤è¡Œæ¥å£</a>å‚æ•°çš„ä¼˜å…ˆçº§æ˜¯é«˜äºé…ç½®æ–‡ä»¶å‚æ•°çš„ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--config</code></td>
<td>é…ç½®æ–‡ä»¶çš„è·¯å¾„</td>
<td>webpack.config.js æˆ–è€… webpackfile.js</td>
</tr>
<tr>
<td><code>--mode</code></td>
<td>ç”¨åˆ°çš„æ¨¡å¼ï¼Œdevelopment æˆ– production</td>
<td></td>
</tr>
<tr>
<td><code>--hot</code></td>
<td>å¼€å¯<a href="https://v4.webpack.docschina.org/concepts/hot-module-replacement">æ¨¡å—çƒ­æ›¿æ¢</a></td>
<td></td>
</tr>
<tr>
<td><code>--progress</code></td>
<td>æ‰“å°å‡ºç¼–è¯‘è¿›åº¦çš„ç™¾åˆ†æ¯”å€¼</td>
<td>false</td>
</tr>
<tr>
<td><code>--debug</code></td>
<td>å°† loader è®¾ç½®ä¸º debug æ¨¡å¼</td>
<td>false</td>
</tr>
<tr>
<td><code>--color</code>, <code>--colors</code></td>
<td>å¼ºåˆ¶åœ¨æ§åˆ¶å°å¼€å¯é¢œè‰²</td>
<td></td>
</tr>
<tr>
<td><code>--watch</code>, <code>-w</code></td>
<td>è§‚å¯Ÿæ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–</td>
<td></td>
</tr>
<tr>
<td><code>--env</code></td>
<td>é…ç½®æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šå°†æ­¤ç¯å¢ƒå˜é‡ä¼ ç»™è¯¥å‡½æ•°</td>
<td></td>
</tr>
</tbody>
</table>
<h3>äºŒã€Webpack API</h3>
<h5>1. å…¥å£ï¼ˆentryï¼‰</h5>
<p>é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œä»è¿™ä¸ªå…¥å£æ–‡ä»¶å¼€å§‹ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨æ‰§è¡Œã€‚å¦‚æœä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ•°ç»„çš„æ¯ä¸€é¡¹éƒ½ä¼šæ‰§è¡Œã€‚</p>
<p>ä¸é…ç½®å…¥å£æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼ŒWebpack ä¼šé»˜è®¤å– <code>src/index.js</code> ä½œä¸ºå¯åŠ¨æ–‡ä»¶ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™æ‰“åŒ…å¤±è´¥å¹¶æŠ¥é”™ï¼š</p>
<blockquote>
<p>ERROR in Entry module not found: Error: Can't resolve './src' in 'xxx'</p>
</blockquote>
<pre><code class="language-js">// ä»…ä¸¾ä¾‹è¯´æ˜ï¼Œå®é™…æƒ…å†µå–å…¶ä¸€ï¼Œä¸‹åŒ
module.exports = {
  // æ”¯æŒ string | array | object | function å½¢å¼ï¼Œå¸¸ç”¨çš„æ˜¯æ•°ç»„å’Œå¯¹è±¡çš„å½¢å¼
  // å­—ç¬¦ä¸²å½¢å¼ï¼Œchunk è¢«å‘½åä¸º 'main'
  entry: 'string',

  // å­—ç¬¦ä¸²æ•°ç»„å½¢å¼ï¼Œchunk è¢«å‘½åä¸º 'main'
  entry: ['string'],

  // å¯¹è±¡å½¢å¼ï¼Œæ¯ä¸ª key ä½œä¸º chunk åç§°
  entry: {
    main: 'string or array',
    vendor: 'string or array'
  },

  // åŠ¨æ€å…¥å£ï¼ˆdynamic entryï¼‰å¯ä½¿ç”¨å‡½æ•°å½¢å¼ï¼Œæ¯”å¦‚ä»æœåŠ¡å™¨è·å–ç­‰ï¼Œæˆ‘æš‚æ—¶æœªç”¨è¿‡
  entry: () =&gt; {
    // è¿˜å¯ä»¥è¿”å› Promiseã€‚
    return 'string | [string]'
  }
}
</code></pre>
<h5>2. è¾“å‡ºï¼ˆoutputï¼‰</h5>
<p>å®ƒåŒ…æ‹¬äº†ä¸€ç»„é€‰é¡¹ï¼ŒæŒ‡ç¤º Webpack å¦‚ä½•å»è¾“å‡ºï¼Œä»¥åŠåœ¨å“ªé‡Œè¾“å‡ºä½ çš„ bundleã€asset å’Œå…¶ä»–ä½ æ‰€æ‰“åŒ…æˆ–è€…ä½¿ç”¨ Webpack è½½å…¥çš„ä»»ä½•å†…å®¹ã€‚</p>
<blockquote>
<p>æ³¨æ„æ•´ä¸ªé…ç½®ä¸­æˆ‘ä»¬ä½¿ç”¨ Node å†…ç½®çš„Â <a href="https://nodejs.org/api/path.html">path æ¨¡å—</a>ï¼Œå¹¶åœ¨å®ƒå‰é¢åŠ ä¸ŠÂ <a href="https://nodejs.org/docs/latest/api/globals.html#globals_dirname">__dirname</a> è¿™ä¸ªå…¨å±€å˜é‡ã€‚å¯ä»¥é˜²æ­¢ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´çš„æ–‡ä»¶è·¯å¾„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç›¸å¯¹è·¯å¾„æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚æˆ‘ä»¬åœ¨å¾ˆå¤šåœ°æ–¹å°†ä¼šä½¿ç”¨åˆ°å®ƒã€‚</p>
<p><code>__dirname</code> æŒ‡å½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•
<code>__filename</code> è¡¨ç¤ºæ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒæ˜¯<strong>ä¸¤ä¸ªä¸‹åˆ’çº¿</strong>ï¼Œä¸¤è€…å‡è¿”å›ä¸€ä¸ª<strong>ç»å¯¹è·¯å¾„</strong>ã€‚</p>
</blockquote>
<p>å®ƒçš„<a href="https://v4.webpack.docschina.org/configuration/output/">é€‰é¡¹</a>å¾ˆå¤šï¼Œä¸»è¦ä»‹ç»å¸¸ç”¨çš„å‡ ä¸ªï¼š</p>
<ul>
<li><strong>path</strong></li>
</ul>
<p>æ‰€æœ‰è¾“å‡ºæ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>ç»å¯¹è·¯å¾„</strong>ï¼Œé»˜è®¤æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>dist</code> è·¯å¾„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‰“åŒ…åçš„ JS æ–‡ä»¶ã€<code>url-loader</code> è§£æçš„å›¾ç‰‡ï¼Œ<code>html-webpack-plugin</code> ç”Ÿæˆçš„ HTML æ–‡ä»¶ç­‰éƒ½ä¼šå­˜æ”¾åˆ°è¯¥è·¯å¾„ä¸‹ï¼ˆæˆ–ç›¸å¯¹äºè¯¥è·¯å¾„çš„å­ç›®å½•ï¼‰</p>
<blockquote>
<p>è‹¥éç»å¯¹è·¯å¾„ï¼Œå®ƒå°†ä¼šæ„å»ºå¤±è´¥å¹¶æŠ¥é”™ï¼šconfiguration.output.path: The provided value &quot;xxx&quot; is not an absolute path!</p>
</blockquote>
<ul>
<li><strong>publicPath</strong></li>
</ul>
<p>publicPath å¹¶ä¸ä¼šå¯¹ç”Ÿæˆæ–‡ä»¶çš„è·¯å¾„é€ æˆå½±å“ï¼Œä¸»è¦æ˜¯å¯¹ä½ çš„é¡µé¢é‡Œé¢å¼•å…¥çš„èµ„æºçš„è·¯å¾„åšå¯¹åº”çš„è¡¥å…¨ï¼Œå¸¸è§çš„å°±æ˜¯ CSS æ–‡ä»¶é‡Œé¢å¼•å…¥çš„å›¾ç‰‡ã€‚</p>
<p>å…¶ä¸­æŸäº› loaderï¼ˆä¾‹å¦‚ <code>file-loader</code>ï¼‰ çš„ <code>publicPath</code> é€‰é¡¹ä¼šè¦†ç›–æ‰ <code>output.publicPath</code> çš„ã€‚</p>
<blockquote>
<p>å…³äº <code>path</code> å’Œ <code>publicPath</code> å¾ˆå¤šäººå®¹æ˜“æ··æ·†ï¼Œå®˜æ–¹çš„æè¿°æˆ‘çœ‹èµ·æ¥æ˜¯æ¨¡ç³Šçš„ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘é€šä¿—åœ°æè¿°ä¸€ä¸‹ã€‚</p>
<p>é€šä¿—åœ°è®²ï¼Œ<code>path</code> å°±æ˜¯æ‰“åŒ…æ–‡ä»¶å­˜æ”¾åœ¨ç¡¬ç›˜ä¸Šçš„è·¯å¾„ï¼Œå®ƒä¸ä¼šå› ä¸º <code>publicPath</code> çš„è®¾ç½®è€Œæ”¹å˜ã€‚</p>
<p>è€Œ <code>publicPath</code> ä¼šå½±å“é¡¹ç›®ä¸­å¼•ç”¨çš„èµ„æºè·¯å¾„å¹¶é‡å†™ã€‚å®ƒåªä¼šä¿®æ”¹é¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼Œè€Œå®Œæ•´çš„ç»å¯¹è·¯å¾„å°†ä¸å—å½±å“ï¼ˆä¾‹å¦‚ <a href="">https://cdn.example.com/assets/</a> è¿™ç§å½¢å¼ä¸ä¼šè¢«ä¿®æ”¹ï¼‰ã€‚æœ€å¸¸è§çš„å°±æ˜¯å›¾ç‰‡èµ„æºã€æ‰“åŒ…äº§å‡ºçš„ JavaScript æ–‡ä»¶åœ¨ HTML ä¸­çš„å¼•ç”¨è·¯å¾„ç­‰ã€‚è¿™äº›æ–‡ä»¶çš„è·¯å¾„ç›®å½•å°†è¢« publicPath æ›¿æ¢é‡å†™ï¼ˆé™¤äº†æ–‡ä»¶åä¸å˜ï¼Œå…¶ä»–è¢«æ›¿æ¢ï¼‰ã€‚å¸¸è¢«ç”¨æ¥æŒ‡å®šä¸Šçº¿åçš„ cdn åŸŸåã€‚</p>
</blockquote>
<ul>
<li><strong>filename</strong></li>
</ul>
<p>æ­¤é€‰é¡¹å†³å®šäº†æ¯ä¸ªï¼ˆå…¥å£ chunk æ–‡ä»¶ï¼‰è¾“å‡º bundle çš„åç§°ã€‚è¿™äº› bundle å°†å†™å…¥åˆ°Â <a href="https://v4.webpack.docschina.org/configuration/output/#output-path"><code>output.path</code></a>Â é€‰é¡¹æŒ‡å®šçš„ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œæ­¤é€‰é¡¹ä¸ä¼šå½±å“é‚£äº›ã€ŒæŒ‰éœ€åŠ è½½ chunkã€çš„è¾“å‡ºæ–‡ä»¶ã€‚å¯¹äºè¿™äº›æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨Â <a href="https://v4.webpack.docschina.org/configuration/output/#output-chunkfilename"><code>output.chunkFilename</code></a>Â é€‰é¡¹æ¥æ§åˆ¶è¾“å‡ºã€‚é€šè¿‡ loader åˆ›å»ºçš„æ–‡ä»¶ä¹Ÿä¸å—å½±å“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»å°è¯• loader ç‰¹å®šçš„å¯ç”¨é€‰é¡¹ã€‚</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ›¿æ¢æ¨¡æ¿å­—ç¬¦ä¸²ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡æ¿</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[hash]</code></td>
<td>æ¨¡å—æ ‡è¯†ç¬¦ï¼ˆmodule identifierï¼‰çš„ <code>hash</code></td>
</tr>
<tr>
<td><code>[chunkhash]</code></td>
<td><code>chunk</code> å†…å®¹çš„ <code>hash</code></td>
</tr>
<tr>
<td><code>[name]</code></td>
<td>æ¨¡å—åç§°ï¼ˆå³å…¥å£æ–‡ä»¶åç§°ï¼‰ï¼Œé»˜è®¤ä¸º <code>main</code></td>
</tr>
<tr>
<td><code>[id]</code></td>
<td>æ¨¡å—æ ‡è¯†ç¬¦ï¼ˆmodule identifierï¼‰</td>
</tr>
<tr>
<td><code>[query]</code></td>
<td>æ¨¡å—çš„ <code>query</code>ï¼Œä¾‹å¦‚æ–‡ä»¶å <code>?</code> åé¢çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>[function]</code></td>
<td>The function, which can return filename [string]</td>
</tr>
</tbody>
</table>
<p>*<code>[hash]</code> å’Œ <code>[chunkhash]</code> çš„é•¿åº¦å¯ä»¥ä½¿ç”¨ <code>[hash:16]</code>ï¼ˆé»˜è®¤ä¸º 20ï¼‰æ¥æŒ‡å®šã€‚
*å¦‚æœå°†è¿™ä¸ªé€‰é¡¹è®¾ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å°†è¿”å›ä¸€ä¸ªåŒ…å«ä¸Šé¢è¡¨æ ¼ä¸­æ›¿æ¢ä¿¡æ¯çš„å¯¹è±¡ã€‚
*æ³¨æ„æ­¤é€‰é¡¹è¢«ç§°ä¸ºæ–‡ä»¶åï¼Œä½†æ˜¯ä½ è¿˜æ˜¯å¯ä»¥ä½¿ç”¨åƒ <code>js/[name]/bundle.js</code> è¿™æ ·çš„æ–‡ä»¶å¤¹ç»“æ„ã€‚</p>
<blockquote>
<p>å…³äº Webpack çš„ <code>hash</code>ã€<code>chunkhash</code>ã€<code>contenthash</code> çš„åŒºåˆ«ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://juejin.im/post/5a4502be6fb9a0450d1162ed">æ–‡ç« </a>ã€‚</p>
</blockquote>
<ul>
<li><strong>chunkFilename</strong></li>
</ul>
<p>æ­¤é€‰é¡¹å†³å®šäº†éå…¥å£ï¼ˆnon-entryï¼‰chunk æ–‡ä»¶çš„åç§°ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™äº›æ–‡ä»¶åéœ€è¦åœ¨ runtime æ ¹æ® chunk å‘é€çš„è¯·æ±‚å»ç”Ÿæˆã€‚å› æ­¤ï¼Œéœ€è¦åœ¨ webpack runtime è¾“å‡º bundle å€¼æ—¶ï¼Œå°† chunk id çš„å€¼å¯¹åº”æ˜ å°„åˆ°å ä½ç¬¦(å¦‚Â <code>[name]</code>Â å’ŒÂ <code>[chunkhash]</code>)ã€‚è¿™ä¼šå¢åŠ æ–‡ä»¶å¤§å°ï¼Œå¹¶ä¸”åœ¨ä»»ä½• chunk çš„å ä½ç¬¦å€¼ä¿®æ”¹åï¼Œéƒ½ä¼šä½¿ bundle å¤±æ•ˆã€‚</p>
<p>é»˜è®¤ä½¿ç”¨Â <code>[id].js</code>Â æˆ–ä»Â <a href="https://v4.webpack.docschina.org/configuration/output/#output-filename"><code>output.filename</code></a>Â ä¸­æ¨æ–­å‡ºçš„å€¼ï¼ˆ<code>[name]</code>Â ä¼šè¢«é¢„å…ˆæ›¿æ¢ä¸ºÂ <code>[id]</code>Â æˆ–Â <code>[id].</code>ï¼‰ï¼Œæ‰€ä»¥å®ƒçš„å¯è¯»æ€§å¾ˆå·®ã€‚</p>
<p>é»˜è®¤ <code>[id]</code> å’Œ <code>[name]</code> æ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p><code>chunkFileName</code> ä¸èƒ½çµæ´»è‡ªå®šä¹‰ï¼Œè¿™è°èƒ½å¿ï¼Œäºæ˜¯ä¾¿æœ‰äº†<code>webpackChunkName</code>ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://juejin.im/post/5d847527f265da03ee6a9227">æ–‡ç« </a>ã€‚</p>
</blockquote>
<pre><code class="language-js">const path = require('path')

module.exports = {
  output: {
    // æŒ‡å®šæ‰“åŒ…è¾“å‡ºè·¯å¾„ä¸º distï¼Œ
    // å®ƒå¿…é¡»ç»å¯¹è·¯å¾„ï¼Œä¸ºäº†é¿å…ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´æ–‡ä»¶è·¯å¾„é—®é¢˜ï¼Œè¿™é‡Œå€ŸåŠ© Node.js å†…ç½®çš„ path æ¨¡å—ä»¥åŠ __dirname å…¨å±€å˜é‡
    // __dirname æ˜¯ä¸¤ä¸ªä¸‹åˆ’çº¿
    path: path.resolve(__dirname, 'dist'),



    // å®ƒé€šå¸¸æ˜¯ä»¥ '/' ç»“æŸï¼Œé¿å…å‡ºç°è®¿é—®ä¸åˆ°ç”Ÿæˆä¹‹åçš„é™æ€èµ„æºçš„é—®é¢˜
    // å®é™…åœºæ™¯ï¼Œæ ¹æ®é¡¹ç›®æœ¬èº«è®¾ç½®
    publicPath: '',
    // publicPath: 'https://cdn.example.com/assets/', // CDNï¼ˆæ€»æ˜¯ HTTPS åè®®ï¼‰
    // publicPath: '//cdn.example.com/assets/', // CDNï¼ˆåè®®ç›¸åŒï¼‰
    // publicPath: '/assets/', // ç›¸å¯¹äºæœåŠ¡(server-relative)
    // publicPath: 'assets/', // ç›¸å¯¹äº HTML é¡µé¢
    // publicPath: '../assets/', // ç›¸å¯¹äº HTML é¡µé¢
    // publicPath: '', // ç›¸å¯¹äº HTML é¡µé¢ï¼ˆç›®å½•ç›¸åŒï¼‰ï¼Œé»˜è®¤



    // å…¥å£æ–‡ä»¶è¾“å‡º bundle çš„åç§°
    filename: 'bundle.js', // é™æ€åç§°
    // filename: '[name].bundle.js', // ä½¿ç”¨å…¥å£åç§°
    // filename: 'js/[name].bundle.js', // æ”¯æŒæ–‡ä»¶å¤¹ç»“æ„
    // filename: '[id].bundle.js', // ä½¿ç”¨å†…éƒ¨ chunk id
    // filename: '[name].[hash].bundle.js', // ä½¿ç”¨æ¯æ¬¡æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå”¯ä¸€çš„ hash ç”Ÿæˆ
    // filename: '[chunkhash].bundle.js', // ä½¿ç”¨åŸºäºæ¯ä¸ª chunk å†…å®¹çš„ hash
    // filename: '[contenthash].bundle.css', // Using hashes generated for extracted content
    // filename: (chunkData) =&gt; { // Using function to return the filename
    //   // å¦‚æœå°†è¿™ä¸ªé€‰é¡¹è®¾ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å°†è¿”å›ä¸€ä¸ªåŒ…å«ä¸Šé¢è¡¨æ ¼ä¸­æ›¿æ¢ä¿¡æ¯çš„å¯¹è±¡ã€‚
    //   return chunkData.chunk.name === 'main' ? '[name].js' : '[name]/[name].js'
    // },



    // éå…¥å£æ–‡ä»¶ï¼Œä½†å‚ä¸æ„å»ºçš„ bundle
    chunkFilename: '[chunkhash].bundle.js' // å¯å–çš„å€¼ä¸ filename ä¸€è‡´
  }
}
</code></pre>
<blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼š
<code>filename</code> æŒ‡åˆ—åœ¨ <code>entry</code> ä¸­ï¼Œæ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶çš„åç§°ã€‚
<code>chunkFilename</code> æŒ‡æœªåˆ—åœ¨ <code>entry</code> ä¸­ï¼Œå´åˆéœ€è¦è¢«æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶çš„åç§°ã€‚</p>
</blockquote>
<h5>3. æ¨¡å—ï¼ˆmoduleï¼‰</h5>
<p>è¿™äº›é€‰é¡¹å†³å®šäº†å¦‚ä½•å¤„ç†é¡¹ç›®ä¸­çš„<a href="https://v4.webpack.docschina.org/concepts/modules">ä¸åŒç±»å‹çš„æ¨¡å—</a>ã€‚</p>
<ul>
<li><strong>noParse</strong></li>
</ul>
<p>å®ƒçš„ä½œç”¨æ˜¯é˜²æ­¢ webpack è§£æé‚£äº›ä»»æ„ä¸ç»™å®šæ­£åˆ™è¡¨è¾¾å¼é¡¹åŒ¹é…çš„æ–‡ä»¶ã€‚å› ä¸ºå®ƒä»¬è¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥ä¸ä¼šè¢« Babel ç­‰åšè¯­æ³•è½¬æ¢ä»¥å…¼å®¹ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œæ•…å®ƒä»¬<strong>ä¸åº”è¯¥å«æœ‰ importã€requireã€define çš„è°ƒç”¨</strong>ã€‚</p>
<pre><code class="language-js">module.exports = {
  module: {
    // æ”¯æŒ RegExpã€[RegExp]ã€function(resource)ã€stringã€[string] çš„å½¢å¼
    noParse: /jquery|loadsh/
    // noParse: content =&gt; /jquery|lodash/.test(content)
  }
}
</code></pre>
<ul>
<li><strong>rules</strong>ï¼ˆé‡è¦ï¼‰</li>
</ul>
<p>åˆ›å»ºæ¨¡å—æ—¶ï¼ŒåŒ¹é…è¯·æ±‚çš„<a href="https://v4.webpack.docschina.org/configuration/module/#rule">è§„åˆ™</a>æ•°ç»„ã€‚è¿™äº›è§„åˆ™èƒ½å¤Ÿä¿®æ”¹æ¨¡å—çš„åˆ›å»ºæ–¹å¼ã€‚è¿™äº›è§„åˆ™èƒ½å¤Ÿå¯¹æ¨¡å—(module)åº”ç”¨ loaderï¼Œæˆ–è€…ä¿®æ”¹è§£æå™¨(parser)ã€‚</p>
<p><code>module.rules</code> æ˜¯æ•°ç»„å½¢å¼ï¼Œæ”¯æŒä¸€ä¸ªæˆ–å¤šä¸ªè§„åˆ™ï¼Œè€Œæ¯ä¸ªè§„åˆ™ï¼ˆ<code>Rule</code>ï¼‰å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>æ¡ä»¶</strong>ï¼ˆconditionï¼‰ã€<strong>ç»“æœ</strong>ï¼ˆresultï¼‰ã€<strong>åµŒå¥—è§„åˆ™</strong>ï¼ˆnested ruleï¼‰ã€‚</p>
<blockquote>
<ul>
<li>
<p>Rule æ¡ä»¶</p>
<p>æ¡ä»¶æœ‰ä¸¤ç§è¾“å…¥å€¼ï¼š
ã€€1. <em>resource</em>ï¼šè¯·æ±‚æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚ï¼ˆå®ƒå·²ç»æ ¹æ®Â <a href="https://v4.webpack.docschina.org/configuration/resolve">resolveÂ è§„åˆ™</a>è§£æï¼‰
ã€€2. <em>issuer</em>ï¼šè¢«è¯·æ±‚èµ„æºçš„æ¨¡å—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå®ƒæ˜¯å¯¼å…¥æ—¶çš„è·¯å¾„ã€‚</p>
<p>å¦‚æœçœ‹èµ·æ¥æœ‰ç‚¹æ‡µï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢ä¸¾ä¾‹è¯´æ˜ã€‚</p>
<p>åœ¨è§„åˆ™ä¸­ï¼Œ<em>resource</em> ç”±å±è§„åˆ™å±æ€§ <code>test</code>ã€<code>include</code>ã€<code>exclude</code>ã€<code>resource</code> å¯¹å…¶è¿›è¡ŒåŒ¹é…ã€‚è€Œ <em>issuer</em> åˆ™ç”±è§„åˆ™å±æ€§ <code>issuer</code> å¯¹å…¶è¿›è¡ŒåŒ¹é…ã€‚</p>
</li>
</ul>
</blockquote>
<pre><code class="language-js">// å‡å¦‚æˆ‘ä»¬åœ¨å…¥å£æ–‡ä»¶ index.js å¯¼å…¥ app.css
import './styles/app.css?inline'

// webpack åŒ¹é…
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        exclude: /node_modules/,
        use: info =&gt; {
          // info æ˜¯æ­£åœ¨åŠ è½½æ¨¡å—çš„ä¸€äº›å‚æ•°
          // åŒ…æ‹¬ resourceã€issuerã€realResourceã€compiler
          console.log(info)
          return ['style-loader', 'css-loader']
        }
      }
    ]
  }
}

// info æ‰“å°ç»“æœå¦‚ä¸‹ï¼š
{
  resource: '/Users/frankie/Desktop/Web/Temp/temp_webpack/src/styles/app.css',
  realResource: '/Users/frankie/Desktop/Web/Temp/temp_webpack/src/styles/app.css',
  resourceQuery: '?inline',
  issuer: '/Users/frankie/Desktop/Web/Temp/temp_webpack/src/index.js',
  compiler: undefined
}
</code></pre>
<p>ç»“åˆæ¦‚å¿µå’Œä¾‹å­ï¼Œå…¶å®å·²ç»å¾ˆæ¸…æ¥šäº†ã€‚<code>app.css</code> æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶ï¼Œè€Œ <code>index.js</code> åˆ™æ˜¯å¯¼å…¥ç›®æ ‡æ–‡ä»¶çš„ä½ç½®ã€‚å› æ­¤ï¼Œ<em>resource</em> å°±æ˜¯ç›®æ ‡æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œè€Œ <em>issuer</em> åˆ™æ˜¯ <code>index.js</code> çš„ç»å¯¹è·¯å¾„ã€‚</p>
<blockquote>
<ul>
<li>
<p>Rule ç»“æœ
è§„åˆ™ç»“æœåªæœ‰åœ¨è§„åˆ™æ¡ä»¶åŒ¹é…æ—¶ä½¿ç”¨ã€‚
è§„åˆ™æœ‰ä¸¤ç§è¾“å…¥å€¼ï¼š
ã€€1. åº”ç”¨çš„ loaderï¼šåº”ç”¨åœ¨ <em>resource</em> ä¸Šçš„ loader æ•°ç»„ã€‚
ã€€2. Parser é€‰é¡¹ï¼šç”¨äºä¸ºæ¨¡å—åˆ›å»ºæŒ¤ä¸‹å»çš„é€‰é¡¹å¯¹è±¡ã€‚</p>
<p>è¿™äº›è§„åˆ™å±æ€§<code>loader</code>ã€<code>options</code>ã€<code>use</code> ä¼šå½±å“ loaderã€‚ï¼ˆ<code>query</code>ã€<code>loaders</code> ä¹Ÿä¼šå½±å“ï¼Œä½†å®ƒä»¬ä¹Ÿè¢«åºŸå¼ƒï¼‰
<code>enforce</code> å±æ€§ä¼šå½±å“ loader ç§ç±»ã€‚
<code>parser</code> å±æ€§ä¼šå½±å“ parser é€‰é¡¹ã€‚</p>
</li>
<li>
<p>åµŒå¥—çš„ Rule</p>
<p>å¯ä»¥ä½¿ç”¨å±æ€§Â <a href="https://v4.webpack.docschina.org/configuration/module/#rule-rules"><code>rules</code></a>Â å’ŒÂ <a href="https://v4.webpack.docschina.org/configuration/module/#rule-oneof"><code>oneOf</code></a>Â æŒ‡å®šåµŒå¥—è§„åˆ™ã€‚
è¿™äº›è§„åˆ™ç”¨äºåœ¨è§„åˆ™æ¡ä»¶ï¼ˆrule conditionï¼‰åŒ¹é…æ—¶è¿›è¡Œå–å€¼ã€‚</p>
</li>
</ul>
</blockquote>
<p>ä¸çŸ¥é“ä½ ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°ä¸Šé¢è¿™äº›æ¦‚ç‡æè¿°ï¼Œä¼šä¸ä¼šæœ‰ç‚¹å‘æ‡µï¼Œåæ­£æˆ‘å¼€å§‹çœ‹çš„æ—¶å€™æ˜¯ä¼šçš„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä»‹ç»è§„åˆ™ï¼ˆRuleï¼‰çš„å±æ€§ï¼Œå…ˆçœ‹ä¸‹æœ‰å“ªäº›ï¼š</p>
<pre><code class="language-js">module.exports = {
  module: {
    rules: [
      // Rule
      {
        resource: {
          test,
          include,
          exclude
        },
        use: [
          {
            loader, 
            options
          }
        ],
        loaders, // æ­¤é€‰é¡¹å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ Rule.use
        query, // æ­¤é€‰é¡¹å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ Rule.use.options
        issuer,
        enforce,
        oneOf, 
        parser,
        resourceQuery,
        rules,
        type,
        sideEffects
      },
      {
        // å¯èƒ½ä½ ä»¬çœ‹åˆ°æ›´å¤šæ˜¯é•¿è¿™æ ·çš„ï¼Œä½†å…¶å®å®ƒä»¬åªæ˜¯ç®€å†™ç½¢äº†ã€‚
        // åé¢æ·»åŠ é…ç½®ï¼Œæˆ‘å¯èƒ½ä½¿ç”¨ç®€å†™å¤šä¸€äº›ã€‚
        test, // Rule.resource.test çš„ç®€å†™
        include, // Rule.resource.include çš„ç®€å†™
        exclude, // Rule.resource.exclude çš„ç®€å†™
        loader, // Rule.use: [ { loader } ] çš„ç®€å†™
        options // Rule.use: [ { options } ] çš„ç®€å†™
      }
    ]
  }
}
</code></pre>
<h5>(1) <a href="https://v4.webpack.docschina.org/configuration/module/#rule-test">Rule.test</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-include">Rule.include</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-exclude">Rule.exclude</a></h5>
<p>å®ƒä»¬åˆ†åˆ«æ˜¯ <code>Rule.resource: { test, inclued, exclued }</code> çš„ç¼©å†™ã€‚å®é™…ä¸­ï¼Œå¾ˆå¤šå¼€å‘çš„æœ‹å‹éƒ½è¯´é‡‡ç”¨ç¼©å†™çš„å†™æ³•ã€‚</p>
<p><a href="https://v4.webpack.docschina.org/configuration/module/#%E6%9D%A1%E4%BB%B6">æ¡ä»¶</a>å¯ä»¥æ˜¯è¿™äº›ä¹‹ä¸€ï¼š</p>
<blockquote>
<ul>
<li><strong>å­—ç¬¦ä¸²</strong>ï¼šåŒ¹é…è¾“å…¥å¿…é¡»ä»¥æä¾›çš„å­—ç¬¦ä¸²å¼€å§‹ã€‚æ˜¯çš„ã€‚ç›®å½•ç»å¯¹è·¯å¾„æˆ–æ–‡ä»¶ç»å¯¹è·¯å¾„ã€‚</li>
<li><strong>æ­£åˆ™è¡¨è¾¾å¼</strong>ï¼štest è¾“å…¥å€¼ã€‚</li>
<li><strong>å‡½æ•°</strong>ï¼šè°ƒç”¨è¾“å…¥çš„å‡½æ•°ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªçœŸå€¼ï¼ˆtruthy valueï¼‰ä»¥åŒ¹é…ã€‚</li>
<li><strong>æ¡ä»¶æ•°ç»„</strong>ï¼šè‡³å°‘ä¸€ä¸ªåŒ¹é…æ¡ä»¶ã€‚</li>
<li><strong>å¯¹è±¡</strong>ï¼šåŒ¹é…æ‰€æœ‰å±æ€§ã€‚æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªå®šä¹‰è¡Œä¸ºã€‚</li>
</ul>
</blockquote>
<p><code>test</code>ï¼šåŒ¹é…ç‰¹å®šæ¡ä»¶ã€‚ä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„æ•°ç»„ï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶çš„ã€‚
<code>include</code>ï¼šåŒ¹é…ç‰¹å®šæ¡ä»¶ã€‚ä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„ï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶çš„ã€‚
<code>exclude</code>ï¼šæ’é™¤ç‰¹å®šæ¡ä»¶ã€‚ä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼Œä½†è¿™ä¸æ˜¯
å¼ºåˆ¶çš„ã€‚</p>
<blockquote>
<p>åŒ¹é…æ¡ä»¶æ¯ä¸ªé€‰é¡¹éƒ½æ¥æ”¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–å­—ç¬¦ä¸²ã€‚<code>test</code> å’Œ <code>include</code> å…·æœ‰ç›¸åŒçš„ä½œç”¨ï¼Œéƒ½æ˜¯å¿…é¡»åŒ¹é…é€‰é¡¹ã€‚<code>exclude</code> æ˜¯å¿…ä¸åŒ¹é…é€‰é¡¹ï¼ˆä¼˜å…ˆäº <code>test</code> å’Œ <code>include</code>ï¼‰</p>
<p>æœ€ä½³å®è·µï¼š</p>
<ul>
<li>åªåœ¨ <code>test</code> å’Œ <code>æ–‡ä»¶ååŒ¹é…</code> ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>
<li>åœ¨ <code>include</code> å’Œ <code>exclude</code> ä¸­ä½¿ç”¨ç»å¯¹è·¯å¾„æ•°ç»„ã€‚</li>
<li>å°½é‡é¿å… <code>exclude</code>ï¼Œæ›´å€¾å‘äºä½¿ç”¨ <code>include</code>ã€‚</li>
</ul>
</blockquote>
<p>(2) <a href="https://v4.webpack.docschina.org/configuration/module/#rule-use">Rule.use</a></p>
<p>æ”¯æŒÂ <a href="https://v4.webpack.docschina.org/configuration/module/#useentry">UseEntries</a> å’Œ <a href="https://v4.webpack.docschina.org/configuration/module/#rule-use">function(info)</a> ä¸¤ç§æ–¹å¼ã€‚</p>
<p>å…¶ä¸­ UseEntry æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¦æ±‚å¿…é¡»æœ‰ä¸€ä¸ª loader å±æ€§æ˜¯å­—ç¬¦ä¸²ã€‚
ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª options å±æ€§ä¸ºå­—ç¬¦ä¸²æˆ–å¯¹è±¡ï¼Œå…¶å€¼å¯ä»¥ä¼ é€’åˆ° loader ä¸­ï¼Œå°†å…¶ç†è§£ä¸º loader é€‰é¡¹ã€‚
ç”±äºå…¼å®¹æ€§åŸå› ï¼Œä¹Ÿæœ‰å¯èƒ½æœ‰ query å±æ€§ï¼Œå®ƒæ˜¯ options å±æ€§çš„åˆ«åã€‚è¯·ä½¿ç”¨ options å±æ€§æ›¿ä»£ã€‚</p>
<p>ä¼ é€’å­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š<code>use: [ 'style-loader' ]</code>ï¼‰æ˜¯ loader å±æ€§çš„ç®€å†™æ–¹å¼ï¼ˆå¦‚ï¼š<code>use: [  { loader: 'style-loader' } ]</code>ï¼‰</p>
<blockquote>
<p>å®ƒè¿˜å¯ä»¥ä¼ é€’å¤šä¸ª loaderï¼Œä½†è¦æ³¨æ„ loader çš„åŠ è½½é¡ºåºæ˜¯<strong>ä»å³å¾€å·¦ï¼ˆä»ä¸‹å¾€ä¸Šï¼‰</strong>ã€‚</p>
</blockquote>
<p>Rule.use ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶æè¿°æ­£åœ¨åŠ è½½çš„æ¨¡å—çš„ object å‚æ•°ï¼Œå¹¶ä¸”å¿…é¡»è¿”å› UseEntry é¡¹çš„æ•°ç»„ã€‚
è¯¥å‡½æ•° <code>function(info)</code> çš„å‚æ•° <code>info</code> åŒ…å«ä»¥ä¸‹å‡ ä¸ªå­—æ®µ <code>{ compiler, issuer, realResource, resource }</code>ã€‚
é‚£è¿™å‡ ä¸ªå­—æ®µç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶å®ä¸Šé¢è®²è¿° Rule æ¡ä»¶çš„æ—¶å€™ï¼Œå°±æœ‰æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥å¾€ä¸Šç¿»ç¿»ï¼Œæˆ–è€…çœ‹ä¸‹å®˜ç½‘çš„<a href="https://v4.webpack.docschina.org/configuration/module/#rule-use">ä»‹ç»</a>ã€‚
å…³äºæ­¤æˆ‘ä¸å±•å¼€èµ˜è¿°ï¼Œå› ä¸ºä¹Ÿä¸çŸ¥é“è¦åˆ©ç”¨å®ƒè§£å†³ä»€ä¹ˆå®é™…çš„åœºæ™¯é—®é¢˜ï¼Œæ‰€ä»¥å…¶å®æ²¡ç”¨è¿‡ã€‚é‚£è¯´æ˜æˆ‘ç›®å‰æ˜¯ä¸éœ€è¦å®ƒçš„ï¼Œä½¿ç”¨ UseEntry å³å¯æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚
æˆ‘åœ¨å†™ <a href="https://www.jianshu.com/p/13ea372cdd45">Redux ç¯‡</a>çš„æ—¶å€™ï¼Œå¼•ç”¨è¿‡ä¸€å¥è¯ï¼Œç”¨ç€è¿™é‡Œä¹Ÿæ˜¯åŒç†çš„ã€‚</p>
<pre><code>å¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦ Reduxï¼Œé‚£å°±æ˜¯ä¸éœ€è¦å®ƒã€‚
</code></pre>
<pre><code class="language-js">module.exports = {
  module: {
    rules: [
      {
        // ...
        // å•ä¸ª loaderï¼Œå¯ä»¥ä½¿ç”¨ç®€å†™å½¢å¼
        loader: 'file-loader',
        options: {
          name: '[name].[ext]'
        }
      },
      {
        // ...
        // å¤šä¸ª loaderï¼Œä¸å« options ç®€å†™å½¢å¼
        use: ['style-loader', 'css-loader'],
      },
      {
        // ...
        // å¤šä¸ª loaderï¼Œä¸”å« options ç®€å†™å½¢å¼
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              importLoaders: 1
            }
          },
          {
            loader: 'less-loader',
            options: {
              noIeCompat: true
            }
          }
        ]
      }
    ]
  }
}
</code></pre>
<p>(3) <a href="https://v4.webpack.docschina.org/configuration/module/#rule-enforce">Rule.enforce</a></p>
<p>è¯¥å±æ€§æŒ‡å®š loader ç§ç±»ï¼Œå…¶å€¼å¯ä»¥æ˜¯ <code>pre</code> æˆ–è€… <code>post</code>ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œæ²¡æœ‰å€¼è¡¨ç¤ºæ™®é€š loaderã€‚</p>
<p>æ‰€æœ‰ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿›å…¥çš„ loaderï¼Œéƒ½æœ‰ä¸¤ä¸ªé˜¶æ®µï¼š
ã€€1. <strong>Pitching</strong>Â é˜¶æ®µï¼šloader ä¸Šçš„ pitch æ–¹æ³•ï¼ŒæŒ‰ç…§Â <code>åç½®(post)</code>ã€<code>è¡Œå†…(inline)</code>ã€<code>æ™®é€š(normal)</code>ã€<code>å‰ç½®(pre)</code>Â çš„é¡ºåºè°ƒç”¨ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹Â <a href="https://v4.webpack.docschina.org/api/loaders/#pitching-loader">pitching loader</a>ã€‚
ã€€2. <strong>Normal</strong> é˜¶æ®µï¼šloader ä¸Šçš„å¸¸è§„æ–¹æ³•ï¼ŒæŒ‰ç…§Â <code>å‰ç½®(pre)</code>ã€<code>æ™®é€š(normal)</code>ã€<code>è¡Œå†…(inline)</code>ã€<code>åç½®(post)</code>Â çš„é¡ºåºè°ƒç”¨ã€‚æ¨¡å—æºç çš„è½¬æ¢ï¼Œå‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µã€‚</p>
<p>æ‰€æœ‰æ™®é€š loader å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚ä¸­åŠ ä¸Š <code>!</code> å‰ç¼€æ¥å¿½ç•¥ï¼ˆè¦†ç›–ï¼‰ã€‚
æ‰€æœ‰æ™®é€šå’Œå‰ç½® loader å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚ä¸­åŠ ä¸Š <code>-!</code> å‰ç¼€æ¥å¿½ç•¥ï¼ˆè¦†ç›–ï¼‰ã€‚
æ‰€æœ‰æ™®é€šï¼Œåç½®å’Œå‰ç½® loader å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚ä¸­åŠ ä¸Š <code>!!</code> å‰ç¼€æ¥å¿½ç•¥ï¼ˆè¦†ç›–ï¼‰ã€‚</p>
<blockquote>
<p>ä¸åº”è¯¥ä½¿ç”¨ <code>è¡Œå†… loader</code> å’Œ <code>!</code> å‰ç¼€ï¼Œå› ä¸ºå®ƒä»¬æ˜¯éæ ‡å‡†çš„ã€‚</p>
<p>PSï¼šæˆ‘æ²¡ä½¿ç”¨è¿‡è¡Œå†… loader çš„æ–¹å¼ï¼Œä¹Ÿä¸å¤ªäº†è§£å®ƒè¿™æ ·åšçš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚è®¾ç½®æˆå‰ç½® loader å€’æ˜¯ç”¨è¿‡ï¼Œå‰é¢<a href="https://www.jianshu.com/p/67a9d9f669b9">æ–‡ç« </a>è®²è§£ <code>eslint-loader</code> ä¸ <code>babel-loader</code> é¡ºåºå…ˆåé—®é¢˜ç”¨è¿‡ã€‚</p>
</blockquote>
<pre><code class="language-js">module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: path.resolve(__dirname, 'node_modules'),
        loader: 'babel-loader'
      },
      // ç”±äº eslint-loader è¦äº babel-loader ä¹‹å‰æ‰§è¡Œï¼Œä¸” loader æ‰§è¡Œé¡ºåºæ˜¯ä»ä¸‹å¾€ä¸Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ eslint-loader è¦å†™åœ¨ä¸‹é¢
      // ä½†å‡ºäºå®‰å…¨è°¨æ…è€ƒè™‘ï¼Œæ·»åŠ  enforce: 'pre' å±æ€§ï¼Œä½¿å…¶æ— è®ºå†™åœ¨ babel-loader å‰åéƒ½èƒ½ä¼˜å…ˆæ‰§è¡Œã€‚
      {
        test: /\.js$/,
        enforce: 'pre',
        exclude: path.resolve(__dirname, 'node_modules'),
        loader: 'eslint-loader',
        options: {
          fix: true
          cache: true
        }
      }
    ]
  }
}
</code></pre>
<p>(4) å…¶ä»–å±æ€§</p>
<ul>
<li>è¯·æ³¨æ„ <a href="https://v4.webpack.docschina.org/configuration/module/#rule-loaders">Rule.loaders</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-options-rule-query">Rule.query</a> å±æ€§å·²åºŸå¼ƒï¼Œè¯·åˆ†åˆ«ä½¿ç”¨ <a href="https://v4.webpack.docschina.org/configuration/module/#rule-use">Rule.use</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-options-rule-query">Rule.options</a> æ›¿ä»£ã€‚</li>
<li>ä»¥ä¸‹å±æ€§ä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ï¼Œè¿™é‡Œä¸å±•å¼€ç»†è¯´ï¼Œå¯ç‚¹å‡»è¿›ä¸€æ­¥äº†è§£ã€‚ <a href="https://v4.webpack.docschina.org/configuration/module/#rule-issuer">Rule.issuer</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-oneof">Rule.oneOf</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-parser">Rule.parser</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-resourcequery">Rule.resourceQuery</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-type">Rule.type</a>ã€<a href="https://v4.webpack.docschina.org/configuration/module/#rule-sideeffects">Rule.sideEffects</a>ã€‚</li>
</ul>
<h5>4. è§£æï¼ˆresolveï¼‰</h5>
<p>è¯¥é€‰é¡¹ç”¨äºé…ç½®æ¨¡å—å¦‚ä½•è§£æã€‚ä¾‹å¦‚ï¼Œå½“åœ¨ ES6 ä¸­è°ƒç”¨ <code>import 'lodash'</code>ï¼Œ<code>resolve</code> é€‰é¡¹èƒ½å¤Ÿå¯¹ webpack æŸ¥æ‰¾ <code>lodash</code> çš„æ–¹å¼å»åšä¿®æ”¹ã€‚</p>
<p>è¿™ä¸€å—å†…å®¹å·²åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†ï¼Œè¯·ç§»æ­¥è‡³æ–‡ç«  <a href="https://www.jianshu.com/p/c7c75d91bcbd">Webpack å¦‚ä½•è§£ææ¨¡å—è·¯å¾„</a>ã€‚</p>
<h5>5. æ¨¡å¼ï¼ˆmodeï¼‰</h5>
<p>æä¾› <code>mode</code> é…ç½®é€‰é¡¹ï¼Œå‘ŠçŸ¥ webpack ä½¿ç”¨å“åº”ç¯å¢ƒçš„å†…ç½®ä¼˜åŒ–ã€‚å¯é€‰å€¼æœ‰ï¼š<code>none</code>ã€<code>development</code> æˆ– <code>production</code>ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œ<code>mode</code> é»˜è®¤è®¾ç½®ä¸º <code>production</code>ã€‚å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾å®šï¼š</p>
<pre><code class="language-js">// webpack.config.js
module.exports = {
  mode: 'production'
}
</code></pre>
<p>æˆ–è€…ä» CLI ä¼ é€’å‚æ•°ï¼š</p>
<pre><code class="language-json5">// package.json
{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --mode production&quot;
  }
}
</code></pre>
<blockquote>
<ul>
<li>
<p><strong>development</strong>
å®ƒä¼šå°† <code>DefinePlugin</code> ä¸­çš„ <code>process.env.NODE_ENV</code> çš„å€¼è®¾ç½®ä¸º <code>development</code>ã€‚å¯ç”¨ <code>NamedChunksPlugin</code> å’Œ <code>NamedModulesPlugin</code>ã€‚</p>
</li>
<li>
<p><strong>production</strong>
å®ƒä¼šå°† <code>DefinePlugin</code> ä¸­çš„ <code>process.env.NODE_ENV</code> çš„å€¼è®¾ç½®ä¸º <code>production</code>ã€‚å¯ç”¨ <code>FlagDependencyUsagePlugin</code>ã€<code>FlagIncludedChunksPlugin</code>ã€<code>ModuleConcatenationPlugin</code>ã€<code>NoEmitOnErrorsPlugin</code>ã€<code>OccurrenceOrderPlugin</code>ã€<code>SideEffectsFlagPlugin</code>ã€<code>TerserPlugin</code>ã€‚</p>
</li>
<li>
<p><strong>none</strong>
å®ƒä¼šé€€å‡ºä»»ä½•é»˜è®¤ä¼˜åŒ–é€‰é¡¹ã€‚</p>
</li>
</ul>
<p>æ³¨æ„ï¼Œè®¾ç½®äº† <code>NODE_ENV</code> å¹¶ä¸ä¼šè‡ªåŠ¨åœ°è®¾ç½® <code>mode</code>ã€‚</p>
</blockquote>
<h5>6. devtool</h5>
<p>æ­¤é€‰é¡¹æ§åˆ¶æ˜¯å¦ç”Ÿæˆï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆ Source Mapã€‚ä¸åŒçš„å€¼ä¼šæ˜æ˜¾å½±å“åˆ°æ„å»ºï¼ˆbuildï¼‰å’Œé‡æ–°æ„å»ºï¼ˆrebuildï¼‰çš„é€Ÿåº¦ã€‚</p>
<blockquote>
<p>å»ºè®®ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨ <code>eval-cheap-module-source-map</code>ï¼Œè€Œç”Ÿäº§ç¯å¢ƒå¤šæ•°åªéœ€è¦çŸ¥é“æŠ¥é”™çš„æ¨¡å—å’Œè¡Œå·å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯ <code>nosources-source-map</code>ã€‚</p>
</blockquote>
<p>ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>SourceMapDevToolPlugin</code>/<code>EvalSourceMapDevToolPlugin</code> æ¥æ›¿ä»£ä½¿ç”¨ <code>devtool</code> é€‰é¡¹ï¼Œå› ä¸ºå®ƒæœ‰æ›´å¤šçš„é€‰é¡¹ã€‚åˆ‡å‹¿åŒæ—¶ä½¿ç”¨ <code>devtool</code> é€‰é¡¹å’Œ <code>SourceMapDevToolPlugin</code>/<code>EvalSourceMapDevToolPlugin</code> æ’ä»¶ã€‚<code>devtool</code> é€‰é¡¹åœ¨å†…éƒ¨æ·»åŠ è¿‡è¿™äº›æ’ä»¶ï¼Œæ‰€ä»¥ä½ æœ€ç»ˆå°†åº”ç”¨ä¸¤æ¬¡æ’ä»¶ã€‚</p>
<ul>
<li>Devtool å¯é€‰å€¼æœ‰å¾ˆå¤šï¼Œçœ‹è¿™é‡Œï¼š<a href="https://v4.webpack.docschina.org/configuration/devtool/#devtool">Webpack Devtool</a>ã€‚</li>
<li>äº†è§£ Source Map è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.im/post/6844904201311485966">ä¸€æ–‡å½»åº•ææ‡‚ Webpack Devtool</a>ã€‚</li>
</ul>
<h5>7. æ’ä»¶ï¼ˆpluginsï¼‰</h5>
<p>è¯¥é€‰é¡¹ç”¨äºå·²å„ç§æ–¹å¼è‡ªå®šä¹‰ webpack æ„å»ºè¿‡ç¨‹ã€‚webpack é™„å¸¦äº†å„ç§å†…ç½®çš„æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>webpack.[plugin-name]</code> è®¿é—®è¿™äº›æ’ä»¶ã€‚</p>
<p>å¯ä»¥æŸ¥çœ‹<a href="https://v4.webpack.docschina.org/plugins">æ’ä»¶é¡µé¢</a>è·å–æ’ä»¶åˆ—è¡¨å’Œå¯¹åº”çš„æ–‡æ¡£ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œç¤¾åŒºä¸­è¿˜æœ‰å¾ˆå¤šæ’ä»¶ã€‚</p>
<p>æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä½¿ç”¨å®ƒçš„æ—¶å€™éœ€è¦ç”¨ <code>new</code> å®ä¾‹åŒ–ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ­¤å‰ç³»åˆ—æ–‡ç« ä½¿ç”¨è¿‡çš„æ’ä»¶ï¼Œåç»­æ–‡ç« è¿˜å°†ä¼šç”¨åˆ°å…¶ä»–æ’ä»¶ï¼Œæ¯”å¦‚ <code>copy-webpack-plugin</code>ã€<code>happypack</code> ç­‰ï¼Œç”¨åˆ°å†ä»‹ç»ã€‚</p>
<pre><code class="language-js">// webpack.config.js

const webpack = require('webpack')
// å¯¼å…¥é webpack è‡ªå¸¦é»˜è®¤æ’ä»¶
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  // ...
  plugins: [
    // åˆ›å»º HTML æ–‡ä»¶
    new HtmlWebpackPlugin({
      title: 'webpack demo',
      template: './src/index.html',
      filename: 'index.html',
      inject: 'body',
      hash: true,
      favicon: './src/favicon.ico'
    }),

    // æ–°ç‰ˆæ— éœ€å†æŒ‡å®šåˆ é™¤ç›®å½•ï¼Œé»˜è®¤åˆ é™¤ output çš„ç›®å½•
    new CleanWebpackPlugin(),

    // é€šè¿‡å®ƒå¯ç”¨ HMR ä¹‹åï¼Œå®ƒçš„æ¥å£å°†è¢«æš´éœ²åœ¨ module.hot å±æ€§ä¸‹é¢
    new webpack.HotModuleReplacementPlugin(),

    // å…è®¸åœ¨ç¼–è¯‘æ—¶(compile time)é…ç½®çš„å…¨å±€å¸¸é‡
    new webpack.DefinePlugin({
      // æ³¨æ„ï¼Œå› ä¸ºè¿™ä¸ªæ’ä»¶ç›´æ¥æ‰§è¡Œæ–‡æœ¬æ›¿æ¢ï¼Œç»™å®šçš„å€¼å¿…é¡»åŒ…å«å­—ç¬¦ä¸²æœ¬èº«å†…çš„å®é™…å¼•å·ã€‚é€šå¸¸ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œä½¿ç”¨ '&quot;production&quot;', æˆ–è€…ä½¿ç”¨ JSON.stringify('production')ã€‚
      'process.env.NODE_ENV': JSON.stringify('development')
    })
  ]
}
</code></pre>
<h5>8. å¼€å‘ç¯å¢ƒ</h5>
<p>å…³äº <code>watch mode</code>ã€<code>webpack-dev-server</code>ã€<code>webpack-dev-middleware</code> çš„é€‰æ‹©ï¼Œå†™åœ¨è¿™ç¯‡ <a href="https://www.jianshu.com/p/24a7ed51c2d9">Webpack å¼€å‘ç¯å¢ƒé€‰æ‹©</a>æ–‡ç« äº†ã€‚</p>
<blockquote>
<p>æ–‡ç« ä¸­æåˆ°äº† webpack-dev-server ç”Ÿæˆçš„åŒ…å¹¶æ²¡æœ‰å­˜å‚¨åœ¨ä½ çš„ç¡¬ç›˜ä¸­ï¼Œè€Œæ˜¯æ”¾åˆ°äº†å†…å­˜é‡Œã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥ä»‹ç»çš„æ˜¯ <a href="https://v4.webpack.docschina.org/configuration/dev-server/">webpack-dev-server</a> é€‰é¡¹ã€‚</p>
<p>*è‹¥æƒ³é€šè¿‡ Node.js API æ¥ä½¿ç”¨å®ƒï¼Œ<a href="https://github.com/webpack/webpack-dev-server/tree/master/examples/api/simple">æ­¤å¤„</a>æœ‰ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚</p>
<p>webpack-dev-server æ”¯æŒä¸¤ç§æ¨¡å¼æ¥åˆ·æ–°é¡µé¢ï¼š</p>
<blockquote>
<ul>
<li><strong>iframe</strong>ï¼šé¡µé¢æ”¾åœ¨  <code>&lt;iframe&gt;</code> æ ‡ç­¾ä¸­ï¼Œå½“æ–‡ä»¶å‘ç”Ÿæ›´æ”¹ä¼šé‡æ–°åˆ·æ–°é¡µé¢ï¼Œè®¾ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
</blockquote>
<pre><code class="language-js">module.exports = {
  devServer: {
    inline: false, // å¯ç”¨ iframe æ¨¡å¼
    open: true // åœ¨ server å¯åŠ¨åæ‰“å¼€æµè§ˆå™¨
  }
}
</code></pre>
<p>æˆ–è€…é€šè¿‡ CLI æ–¹å¼ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server --inline=false&quot;
  }
}
</code></pre>
<p>å¯åŠ¨ä¹‹åï¼Œæ‰“å¼€çš„ URL æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>http://Â«hostÂ»:Â«portÂ»/webpack-dev-server/Â«pathÂ»

# æ¯”å¦‚
http://localhost:8080/webpack-dev-server/
</code></pre>
<p>*æˆ‘çœ‹è¿‡çš„é¡¹ç›®å¥½åƒè¿˜æ²¡æœ‰äººç”¨è¿™ç§æ–¹å¼çš„ï¼Œæˆ‘ä¹Ÿæ²¡ç”¨è¿‡ï¼Œä¸å±•å¼€è¯´äº†ã€‚ï¼ˆPSï¼šæˆ‘å°è¯•è¿‡è¿™ç§æ–¹å¼å¥½åƒåªèƒ½ Live Reloadï¼Œä¸èƒ½ HMRã€‚æˆ‘ä¸çŸ¥é“æ˜¯æˆ‘é…ç½®é—®é¢˜ï¼Œè¿˜æ˜¯å…¶ä»–åŸå› ï¼Ÿåé¢æœ‰æ—¶é—´å†ç ”ç©¶ä¸€ä¸‹ï¼Œç ”ç©¶æ˜ç™½äº†å†å›æ¥æ›´æ–°è¿™å—å†…å®¹ï¼‰</p>
<blockquote>
<ul>
<li><strong>inline</strong>ï¼šé»˜è®¤æ˜¯ <code>inline mode</code>ã€‚
é…ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼Œçœ‹è¿™ç¯‡åˆ«äººè¸©å‘çš„<a href="https://www.jianshu.com/p/bcad129a1c69">æ–‡ç« </a>ã€‚æˆ‘æ€•æˆ‘è¯´è¶Šå¤šè¶Šä¹±ï¼Œè®°ä½å®ƒæ˜¯é»˜è®¤çš„æ¨¡å¼å°±å¥½äº†ã€‚</li>
</ul>
</blockquote>
<p>æ³¨æ„æ¥ç€ï¼Œå¾€ä¸‹çš„å†…å®¹å°†åŸºäº inline æ¨¡å¼ä»‹ç»ã€‚</p>
<ul>
<li><strong><a href="https://v4.webpack.docschina.org/configuration/dev-server/#devserver-contentbase">devServer.contentBase</a></strong></li>
</ul>
<p>å‘Šè¯‰æœåŠ¡å™¨ä»å“ªä¸ªç›®å½•ä¸­æä¾›å†…å®¹ã€‚åªæœ‰åœ¨ä½ éœ€è¦æä¾›é™æ€æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼Œæ•°æ®ç­‰ä¸€äº›ä¸å— webpack æ§åˆ¶çš„èµ„æºæ–‡ä»¶ï¼‰æ—¶æ‰éœ€è¦ã€‚<code>devServer.publicPath</code> å°†ç”¨äºç¡®å®šåº”è¯¥ä»å“ªé‡Œæä¾› bundleï¼Œå¹¶ä¸”æ­¤é€‰é¡¹ä¼˜å…ˆã€‚</p>
<blockquote>
<p>æ¨èä½¿ç”¨ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</p>
</blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨å½“å‰å·¥ä½œç›®å½•ä½œä¸ºæä¾›å†…å®¹çš„ç›®å½•ï¼Œå°†å…¶è®¾ç½®ä¸º <code>false</code> ä»¥ç¦ç”¨ <code>contentBase</code>ã€‚</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path')

module.exports = {
  devServer: {
    // å•ä¸ªç›®å½•
    contentBase: path.join(__dirname, 'public'),
    // å¤šä¸ªç›®å½•
    contentBase: [
      path.join(__dirname, 'public'),
      path.join(__dirname, 'assets')
    ]
  }
}
</code></pre>
<p>*CLI ç”¨æ³•ä¸ä»‹ç»äº†ï¼Œä¸‹åŒã€‚</p>
<ul>
<li><strong><a href="https://v4.webpack.docschina.org/configuration/dev-server/#devserver-publicpath-">devServer.publicPath</a></strong></li>
</ul>
<p>æ­¤è·¯å¾„ä¸‹çš„æ‰“åŒ…æ–‡ä»¶å¯åœ¨æµè§ˆå™¨ä¸­è®¿é—®ã€‚<code>devServer.publicPath</code> é»˜è®¤å€¼æ˜¯ <code>/</code>ã€‚</p>
<p>å‡è®¾æœåŠ¡å™¨è¿è¡Œåœ¨ <code>http://localhost:8080</code> å¹¶ä¸” <code>output.filename</code> è¢«è®¾ç½®ä¸º <code>bundle.js</code>ã€‚<code>devServer.publicPath</code> é»˜è®¤å€¼æ˜¯ <code>/</code>ï¼Œæ‰€ä»¥ä½ çš„åŒ…ï¼ˆbundleï¼‰å¯ä»¥é€šè¿‡ <code>http://localhost:8080/bundle.js</code> è®¿é—®ã€‚</p>
<pre><code class="language-js">module.exports = {
  //...
  devServer: {
    publicPath: '/assets/'
  }
}
</code></pre>
<p>ä¿®æ”¹é…ç½®ï¼Œå°† bundle æ”¾ç½®æŒ‡å®šçš„ç›®å½•ä¸‹ã€‚ç°åœ¨é€šè¿‡ <code>http://localhost:8080/assets/bundle.js</code> è®¿é—®åˆ° bundleã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://segmentfault.com/a/1190000023261512">webpackè¿›é˜¶â€”â€”ç†è®ºç¯‡</a></li>
<li><a href="https://juejin.im/post/6844904201311485966">ä¸€æ–‡å½»åº•ææ‡‚ webpack devtool</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåä¸‰ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/66</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/66</guid>
            <pubDate>Sat, 25 Feb 2023 11:48:33 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a7bead1b512eca5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åŸå…ˆæ‰“ç®—]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a7bead1b512eca5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åŸå…ˆæ‰“ç®—å°† ESLintã€Prettier æ”¾åˆ°æœ€åä¸€ä¸ªç¯èŠ‚ä»‹ç»çš„ï¼Œä½†ç”±äºä¸æƒ³å†å†™ç¤ºä¾‹æ¡ˆä¾‹çš„æ—¶å€™ï¼Œè¿˜è¦æ‰‹åŠ¨æ ¼å¼åŒ–ï¼ŒçœŸçš„ä¼šé€¼æ­»å¼ºè¿«ç—‡çš„äººå‘ï¼</p>
<p>å¥½å§ï¼Œæˆ‘æœ‰å¼ºè¿«ç—‡ã€‚ã€‚ã€‚</p>
<blockquote>
<p>å…³äº ESLintã€Prettier çš„å†…å®¹è¿˜æ˜¯æŒºå¤šçš„ï¼Œæ‰€ä»¥æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ã€‚</p>
</blockquote>
<h3>ä¸€ã€ç®€ä»‹</h3>
<h5>ESLint</h5>
<p>ESLint æœ€åˆæ˜¯ç”± <a href="http://nczonline.net/">Nicholas C. Zakas</a>Â äº 2013 å¹´ 6 æœˆåˆ›å»ºçš„å¼€æºé¡¹ç›®ã€‚ESLint å‡­å€Ÿæ’ä»¶åŒ–ã€é…ç½®åŒ–ã€å¯æ»¡è¶³ä¸åŒçš„æŠ€æœ¯æ ˆçš„ä¸ªæ€§éœ€æ±‚æ‰“è´¥äº† JSHint æˆä¸ºæœ€å—æ¬¢è¿çš„ JavaScript ä»£ç æ£€æµ‹å·¥å…·ã€‚ ğŸ‘‰ <a href="http://eslint.cn/">ä¸­æ–‡å®˜ç½‘</a></p>
<blockquote>
<p>ä» JSLint åˆ° ESLintï¼Œç»å†äº†ä»€ä¹ˆï¼Œä»–ä»¬å„æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Œçœ‹è¿™ç¯‡æ–‡ç«  ğŸ‘‰ <a href="https://zhuanlan.zhihu.com/p/34656263">JS Linter è¿›åŒ–å²</a>ã€‚</p>
</blockquote>
<p>æ°æ°æ­£æ˜¯å› ä¸º ESLint æ¨å´‡é…ç½®åŒ–ï¼Œå¾€å¾€éœ€è¦é…ç½®å¾ˆå¤šç¹æ‚çš„ rules è§„åˆ™ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½è¦è¿™ç§åšçš„è¯ï¼Œæ˜¾ç„¶ä¼šè€—è´¹å¾ˆå¤šç²¾åŠ›ã€‚äºæ˜¯å°±æœ‰äººç«™äº†å‡ºæ¥ï¼Œå¹¶åœ¨ GitHub ä¸Šå¼€æºäº†ä»–ä»¬çš„ä»£ç è§„èŒƒåº“ï¼Œæ¯”è¾ƒæµè¡Œçš„æœ‰ airbnbã€standardã€prettier ç­‰ã€‚</p>
<p><strong>ä½†åœ¨è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯å›½å†…è…¾è®¯ AlloyTeam å›¢é˜Ÿå‡ºå“çš„Â <a href="https://github.com/AlloyTeam/eslint-config-alloy/blob/master/README.zh-CN.md">eslint-config-alloy</a>Â å¼€æºè§„èŒƒåº“ã€‚</strong></p>
<p>å…¶å®ä»–ä»¬å›¢é˜Ÿæœ€å¼€å§‹ä½¿ç”¨ Airbnb è§„åˆ™ï¼Œä½†æ˜¯ç”±äºå®ƒè¿‡äºä¸¥æ ¼ï¼Œéƒ¨åˆ†è§„åˆ™è¿˜æ˜¯éœ€è¦ä¸ªæ€§åŒ–ï¼Œå¯¼è‡´åæ¥è¶Šæ”¹è¶Šå¤šï¼Œæœ€åå†³å®šé‡æ–°ç»´æŠ¤ä¸€å¥—ã€‚ç»è¿‡ä¸¤å¹´å¤šçš„æ‰“ç£¨ï¼Œç°åœ¨ eslint-config-alloy å·²ç»éå¸¸æˆç†Ÿäº†ã€‚</p>
<p>æˆ‘é€‰æ‹©å®ƒçš„å‡ ç‚¹åŸå› ï¼š</p>
<ul>
<li>é€‚ç”¨äº React/Vue/Typescript é¡¹ç›®</li>
<li>æ ·å¼ç›¸å…³è§„åˆ™ç”± Prettier ç®¡ç†</li>
<li>æœ‰<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FAlloyTeam%2Feslint-config-alloy%2Fblob%2Fmaster%2FREADME.zh-CN.md">ä¸­æ–‡æ–‡æ¡£</a>å’Œç½‘ç«™<a href="https://links.jianshu.com/go?to=https%3A%2F%2Falloyteam.github.io%2Feslint-config-alloy%2F%3Flanguage%3Dzh-CN%26rule%3Dbase">ç¤ºä¾‹</a>ï¼ˆé„™äººè¹©è„šçš„å¤–è¯­æ°´å¹³ï¼Œè¿™ç‚¹æå¸å¼•æˆ‘ï¼Œå“ˆå“ˆï¼‰</li>
<li>æ›´æ–°å¿«ï¼ŒåŠæ—¶è·Ÿè¿›æœ€æ–°è§„åˆ™å’ŒåºŸå¼ƒè§„åˆ™ï¼Œä¸”æ‹¥æœ‰å®˜æ–¹ç»´æŠ¤çš„ Vueã€Typescriptã€React + Typescript è§„åˆ™</li>
</ul>
<h5>Prettier</h5>
<blockquote>
<p>An opinionated code formatter.</p>
</blockquote>
<p><a href="https://prettier.io/">Prettier</a> æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œç›¸æ¯”äº ESLint ä¸­çš„ä»£ç æ ¼å¼è§„åˆ™ï¼Œå®ƒæä¾›äº†æ›´å°‘çš„é€‰é¡¹ï¼Œä½†æ˜¯å´æ›´åŠ ä¸“ä¸šï¼Œä¸”ä¸å¤§å¤šæ•°ç¼–è¾‘å™¨é›†æˆã€‚</p>
<p>å®ƒè¦è§£å†³çš„å°±æ˜¯ç±»ä¼¼äºä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼ï¼Œè¿˜æ˜¯å››ä¸ªç©ºæ ¼çš„äº‰è®ºã€‚åœ¨å›¢é˜Ÿå¼€å‘ä¸­è¾¾æˆç»Ÿä¸€ã€‚</p>
<p>æ”¯æŒä»¥ä¸‹è¯­è¨€ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-4a5e6cefa28ca6dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>äºŒã€ESLint</h3>
<p>æ¥ä¸‹æ¥ä»‹ç»æœ¬é¡¹ç›®æ˜¯å¦‚ä½•é…ç½®å®ƒä»¬çš„ã€‚</p>
<blockquote>
<p>æ­¤å‰æˆ‘å†™äº†ä¸€ç¯‡å…³äºå°ç¨‹åºé¡¹ç›®é…ç½® ESLintã€Prettierã€Git æäº¤è§„èŒƒçš„æ–‡ç« ï¼Œå…¶å®æ˜¯å¤§åŒå°å¼‚ï¼Œå¯ä»¥å»çœ‹ä¸‹ ğŸ‘‰ <a href="https://www.jianshu.com/p/5ab7b4b48964">ç‚¹è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<h5>1. ESLint çš„å®‰è£…</h5>
<blockquote>
<p>å¿…è¦æ¡ä»¶ï¼š</p>
<ul>
<li>Node.js 6.14+</li>
<li>npm 3+ï¼ˆor yarnï¼‰
*ä¸ªäººå»ºè®® npm ç‰ˆæœ¬å¤§äº 5.2 ä»¥ä¸Šï¼Œå¯ä½¿ç”¨ npx å‘½ä»¤ã€‚</li>
</ul>
</blockquote>
<pre><code class="language-shell"># å…¨å±€å®‰è£…ï¼ˆå»ºè®®æœ¬åœ°é¡¹ç›®å®‰è£…ï¼‰
$ yarn global add eslint
# åˆ›å»º .eslintrc é…ç½®æ–‡ä»¶
$ eslint --init
# æ£€æµ‹æŸä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼ˆæ”¯æŒ glob åŒ¹é…æ¨¡å¼ï¼Œå¦‚ eslint lib/** ï¼‰
$ eslint file1.js file2.js


# åä¸½çš„åˆ†å‰²çº¿ ****************************************************


# æœ¬åœ°é¡¹ç›®å®‰è£…ï¼ˆæ¨èï¼‰
$ yarn add --dev eslint@6.7.1
# ä»¥ä¸‹åŒæ—¶å®‰è£…äº†ä¸€äº› ESLint æ’ä»¶æˆ–è€…ä¸ Prettier ç›¸å…³çš„ä¾èµ–åŒ…
$ yarn add --dev babel-eslint@10.0.3
$ yarn add --dev eslint-config-alloy@3.7.1
$ yarn add --dev eslint-plugin-react@7.18.3
$ yarn add --dev prettier@2.0.5
$ yarn add --dev prettier-eslint-cli@5.0.0
#
# åˆ›å»º .eslintrc é…ç½®æ–‡ä»¶
#ï¼ˆä¸æ”¯æŒ npx å°±ä½¿ç”¨ ./node_modules/.bin/eslint --init ï¼Œä¸‹åŒï¼‰
$ npx eslint --init
# or
$ yarn eslint --init
#
# æ£€æµ‹æ–‡ä»¶
$ npx eslint file1.js file2.js
# or
$ yarn eslint file1.js file2.js
</code></pre>
<p>æˆ‘å°±ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ ä¸€ä¸ª ESLint çš„é…ç½®æ–‡ä»¶ <code>.eslintrc.js</code>ï¼Œä¸ç”¨å‘½ä»¤è¡Œç”Ÿæˆäº†ã€‚</p>
<pre><code class="language-js">// .eslintrc.js
module.exports = {
  extends: [
    'alloy'
  ],
  env: {
    // ä½ çš„ç¯å¢ƒå˜é‡ï¼ˆåŒ…å«å¤šä¸ªé¢„å®šä¹‰çš„å…¨å±€å˜é‡ï¼‰
    //
    // browser: true,
    // node: true,
    // mocha: true,
    // jest: true,
    // jquery: true
  },
  globals: {
    // ä½ çš„å…¨å±€å˜é‡ï¼ˆè®¾ç½®ä¸º false è¡¨ç¤ºå®ƒä¸å…è®¸è¢«é‡æ–°èµ‹å€¼ï¼‰
    //
    // myGlobal: false
  },
  rules: {
    // è‡ªå®šä¹‰ä½ çš„è§„åˆ™
  }
}
</code></pre>
<blockquote>
<p>è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ JavaScript æ³¨é‡Šå§é…ç½®ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°ä¸€ä¸ªä»£ç æºæ–‡ä»¶ä¸­ã€‚å¯ä»¥çœ‹ä¸‹è¿™ç¯‡<a href="https://www.jianshu.com/p/aedddf8bd875">æ–‡ç« </a>ã€‚</p>
</blockquote>
<h5>2. ä»‹ç» ESLint çš„å‡ ä¸ªé…ç½®é¡¹</h5>
<ul>
<li><strong>è§£æå™¨ï¼ˆParserï¼‰</strong></li>
</ul>
<p>ESLint é»˜è®¤ä½¿ç”¨ <a href="https://github.com/eslint/espree">Espree</a> ä½œä¸ºå…¶è§£æå™¨ï¼Œä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä¸€ä¸ªä¸åŒçš„è§£æå™¨ã€‚(éœ€å•ç‹¬å®‰è£…è§£æå™¨åŒ…)</p>
<pre><code class="language-js">{
  parser: 'babel-eslint'
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨ä½¿ç”¨è‡ªå®šä¹‰è§£æå™¨æ—¶ï¼Œä¸ºäº†è®© ESLint åœ¨å¤„ç†é ES5 ç‰¹æ€§æ—¶æ­£å¸¸å·¥ä½œï¼Œé…ç½®å±æ€§ <code>parserOptions</code> ä»ç„¶æ˜¯å¿…é¡»çš„ã€‚è§£æå™¨ä¼šè¢«ä¼ å…¥ <code>parserOptions</code>ï¼Œä½†æ˜¯ä¸ä¸€å®šä¼šä½¿ç”¨å®ƒä»¬æ¥å†³å®šåŠŸèƒ½ç‰¹æ€§çš„å¼€å…³ã€‚</p>
</blockquote>
<ul>
<li><strong>è§£æå™¨é€‰é¡¹ï¼ˆParser Optionsï¼‰</strong></li>
</ul>
<p>ESLint å…è®¸ä½ æŒ‡å®šä½ æƒ³è¦æ”¯æŒçš„ JavaScript è¯­è¨€é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒESLint æ”¯æŒ ES5 è¯­æ³•ã€‚ä½ å¯ä»¥è¦†ç›–è¯¥è®¾ç½®ï¼Œä»¥å¯ç”¨å¯¹ ECMAScript å…¶å®ƒç‰ˆæœ¬å’Œ JSX çš„æ”¯æŒã€‚</p>
<pre><code class="language-js">{
  parserOptions: {
    ecmaVersion: 10, // æŒ‡å®š ECMAScript ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º3ï¼Œ5ã€‚åŒæ ·æ”¯æŒä½¿ç”¨å¹´ä»½å‘½åçš„ç‰ˆæœ¬å·æŒ‡å®šä¸º 2015ï¼ˆåŒ 6ï¼‰ï¼Œ2016ï¼ˆåŒ 7ï¼‰ï¼Œæˆ– 2017ï¼ˆåŒ 8ï¼‰æˆ– 2018ï¼ˆåŒ 9ï¼‰æˆ– 2019 (same as 10)
    sourceType: 'module', // è®¾ç½®ä¸º &quot;script&quot; (é»˜è®¤) æˆ– &quot;module&quot;
    ecmaFeatures: { // è¡¨ç¤ºä½ æƒ³ä½¿ç”¨çš„é¢å¤–çš„è¯­è¨€ç‰¹æ€§
      jsx: true // å¯ç”¨ JSX
      // è¿˜æœ‰ globalReturnã€impliedStrictã€experimentalObjectRestSpread ç­‰é€‰é¡¹
    }
  }
}
</code></pre>
<blockquote>
<p>è®¾ç½®è§£æå™¨é€‰é¡¹èƒ½å¸®åŠ© ESLint ç¡®å®šä»€ä¹ˆæ˜¯è§£æé”™è¯¯ï¼Œæ‰€æœ‰è¯­è¨€é€‰é¡¹é»˜è®¤éƒ½æ˜¯ <code>false</code>ã€‚</p>
</blockquote>
<ul>
<li><strong>å¤„ç†å™¨ï¼ˆProcessorï¼‰</strong></li>
</ul>
<p>è¿™ä¸ªä¸ªäººå¹³å¸¸å‡ ä¹ä¸ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸å±•å¼€ç»†è¯´ï¼Œè¯·çœ‹<a href="http://eslint.cn/docs/user-guide/configuring#specifying-processor">å®˜æ–¹ä»‹ç»</a>ã€‚</p>
<ul>
<li><strong>ç¯å¢ƒï¼ˆEnvironmentsï¼‰</strong></li>
</ul>
<p>ä¸€ä¸ªç¯å¢ƒå®šä¹‰äº†ä¸€ç»„é¢„å®šä¹‰çš„å…¨å±€å˜é‡ã€‚è¿™äº›ç¯å¢ƒå¹¶ä¸æ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªã€‚</p>
<blockquote>
<ul>
<li><code>browser</code>Â - æµè§ˆå™¨ç¯å¢ƒä¸­çš„å…¨å±€å˜é‡ã€‚</li>
<li><code>node</code>Â - Node.js å…¨å±€å˜é‡å’Œ Node.js ä½œç”¨åŸŸã€‚</li>
<li><code>commonjs</code>Â - CommonJS å…¨å±€å˜é‡å’Œ CommonJS ä½œç”¨åŸŸ (ç”¨äº Browserify/Webpack æ‰“åŒ…çš„åªåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç )ã€‚</li>
<li><code>es6</code>Â - å¯ç”¨é™¤äº† modules ä»¥å¤–çš„æ‰€æœ‰ ES6 ç‰¹æ€§ï¼ˆè¯¥é€‰é¡¹ä¼šè‡ªåŠ¨è®¾ç½®Â <code>ecmaVersion</code>Â è§£æå™¨é€‰é¡¹ä¸º 6ï¼‰ã€‚</li>
<li><code>worker</code>Â - Web Workers å…¨å±€å˜é‡ã€‚</li>
<li><code>jquery</code>Â - jQuery å…¨å±€å˜é‡ã€‚</li>
<li><a href="http://eslint.cn/docs/user-guide/configuring#specifying-environments">æ›´å¤š...</a></li>
</ul>
</blockquote>
<pre><code class="language-js">{
  plugins: ['example']
  env: {
    browser: true,
    node: true,
    es6: true,
    'example/custom': true // ä½¿ç”¨æ’ä»¶ï¼ˆä¸å¸¦å‰ç¼€ï¼‰ example ä¸­çš„ custom ç¯å¢ƒ
  }
}
</code></pre>
<ul>
<li><strong>å…¨å±€å˜é‡ï¼ˆGlobalsï¼‰</strong></li>
</ul>
<p>å½“è®¿é—®å½“å‰æºæ–‡ä»¶å†…æœªå®šä¹‰çš„å˜é‡æ˜¯ï¼Œ<a href="http://eslint.cn/docs/rules/no-undef">no-undef</a>Â è§„åˆ™å°†å‘å‡ºè­¦å‘Šã€‚å‰é¢æåˆ°ç¯å¢ƒæ—¶ï¼Œè®¾ç½®æŸä¸ªç¯å¢ƒæ—¶ä¼šå®šä¹‰ä¸€ç»„å¯¹åº”çš„å…¨å±€å˜é‡ã€‚</p>
<pre><code class="language-js">{
  globals: {
    // ä½ çš„å…¨å±€å˜é‡ï¼ˆè®¾ç½®ä¸º false è¡¨ç¤ºå®ƒä¸å…è®¸è¢«é‡æ–°èµ‹å€¼ï¼‰
    // myGlobal: false
  }
}
</code></pre>
<blockquote>
<p>ç”±äºå†å²åŸå› ï¼Œå¸ƒå°”å€¼ <code>false</code> å’Œå­—ç¬¦ä¸²å€¼ <code>&quot;readable&quot;</code> ç­‰ä»·äº <code>&quot;readonly&quot;</code>ã€‚ç±»ä¼¼åœ°ï¼Œå¸ƒå°”å€¼ <code>true</code> å’Œå­—ç¬¦ä¸²å€¼ <code>&quot;writeable&quot;</code> ç­‰ä»·äº <code>&quot;writable&quot;</code>ã€‚ä½†æ˜¯ï¼Œä¸å»ºè®®ä½¿ç”¨æ—§å€¼ã€‚</p>
<p>ä½¿ç”¨å­—ç¬¦ä¸² <code>&quot;off&quot;</code> ç¦ç”¨å…¨å±€å˜é‡ã€‚å‡å¦‚å½“å‰ç¯å¢ƒä¸æ”¯æŒä½¿ç”¨ <code>Promise</code> å¯ä»¥é€šè¿‡ <code>&quot;Promise&quot;: &quot;off&quot;</code> å…¨å±€ç¦ç”¨ã€‚</p>
</blockquote>
<ul>
<li><strong>æ’ä»¶ï¼ˆPluginsï¼‰</strong></li>
</ul>
<p>ESLint æ”¯æŒä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚åœ¨ä½¿ç”¨æ’ä»¶ä¹‹å‰ï¼Œä½ å¿…é¡»ä½¿ç”¨ npm å®‰è£…å®ƒã€‚æ’ä»¶åç§°å¯ä»¥çœç•¥ <code>eslint-plugin-</code> å‰ç¼€ã€‚</p>
<pre><code class="language-js">{
  plugins: [
    // ç›¸å½“äº 'eslint-plugin-prettier'
    'prettier'
  ]
}
</code></pre>
<ul>
<li><strong>è§„åˆ™ï¼ˆRulesï¼‰</strong></li>
</ul>
<p>ESLint é™„å¸¦æœ‰å¤§é‡çš„è§„åˆ™ã€‚ä½ å¯ä»¥ä½¿ç”¨æ³¨é‡Šæˆ–é…ç½®æ–‡ä»¶ä¿®æ”¹ä½ é¡¹ç›®ä¸­è¦ä½¿ç”¨çš„è§„åˆ™ã€‚è¦æ”¹å˜ä¸€ä¸ªè§„åˆ™è®¾ç½®ï¼Œä½ å¿…é¡»å°†è§„åˆ™ ID è®¾ç½®ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š</p>
<blockquote>
<ul>
<li><code>&quot;off&quot;</code> æˆ– <code>0</code> - å…³é—­è§„åˆ™</li>
<li><code>&quot;warn&quot;</code> æˆ– <code>1</code> - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨è­¦å‘Šçº§åˆ«çš„é”™è¯¯ï¼š<code>warn</code> (ä¸ä¼šå¯¼è‡´ç¨‹åºé€€å‡º)</li>
<li><code>&quot;error&quot;</code> æˆ– <code>2</code> - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨é”™è¯¯çº§åˆ«çš„é”™è¯¯ï¼š<code>error</code> (å½“è¢«è§¦å‘çš„æ—¶å€™ï¼Œç¨‹åºä¼šé€€å‡º)</li>
</ul>
</blockquote>
<pre><code class="language-js">{
  plugins: ['plugin1']
  rules: {
    'no-alert': 2,
    'no-eval': 2,
    'plugin1/rule1': 2,
    indent: ['error', 2, { SwitchCase: 1 }]
  }
}
</code></pre>
<p>è‹¥è¦ç¦ç”¨ä¸€ç»„æ–‡ä»¶çš„é…ç½®æ–‡ä»¶ä¸­çš„è§„åˆ™ï¼Œè¯·ä½¿ç”¨ <code>overrides</code> å’Œ <code>files</code> é…åˆä½¿ç”¨ã€‚</p>
<pre><code class="language-js">{
  rules: {...},
  overrides: [
    {
      files: ['*-test.js', '*.spec.js'],
      rules: {
        'no-unused-expressions': 0
      }
    }
  ]
}
</code></pre>
<blockquote>
<p>åœ¨ä½ çš„æ–‡ä»¶ä¸­ä½¿ç”¨<strong>è¡Œæ³¨é‡Š</strong>æˆ–è€…<strong>å—æ³¨é‡Š</strong>çš„æ–¹å¼æ¥ç¦æ­¢ï¼ˆæŸäº›ï¼‰è§„åˆ™å‡ºç°è­¦å‘Šï¼Œå¯ä»¥çœ‹è¿™ç¯‡<a href="https://www.jianshu.com/p/a45033bc4b8a">æ–‡ç« </a>ï¼Œé‡Œé¢æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>
</blockquote>
<ul>
<li><strong>æ‰©å±•ï¼ˆExtendsï¼‰</strong></li>
</ul>
<p>å®ƒçš„å±æ€§å€¼å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>æŒ‡å®šé…ç½®çš„å­—ç¬¦ä¸²ï¼ˆé…ç½®æ–‡ä»¶è·¯å¾„ã€å¯å…±äº«é…ç½®çš„åç§°ã€<code>eslint:recommended</code> æˆ–è€… <code>eslint:all</code> ï¼‰</li>
<li>å­—ç¬¦ä¸²æ•°ç»„ï¼šæ¯ä¸ªé…ç½®ç»§æ‰¿å®ƒå‰é¢çš„é…ç½®</li>
</ul>
<blockquote>
<p><code>eslint:recommended</code></p>
<p>ESLint æ‰€æœ‰çš„è§„åˆ™é»˜è®¤éƒ½æ˜¯ç¦ç”¨çš„ã€‚åœ¨<a href="http://eslint.cn/docs/user-guide/configuring#extending-configuration-files">é…ç½®æ–‡ä»¶</a>ä¸­ï¼Œä½¿ç”¨Â <code>&quot;extends&quot;: &quot;eslint:recommended&quot;</code>Â æ¥å¯ç”¨æ¨èçš„è§„åˆ™ï¼ŒæŠ¥å‘Šä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œåœ¨<a href="http://eslint.cn/docs/rules/">è§„åˆ™é¡µé¢</a>ä¸­è¿™äº›æ¨èçš„è§„åˆ™éƒ½å¸¦æœ‰ä¸€ä¸ª âœ… ï¼ˆå¯¹å‹¾ï¼‰æ ‡è®°ã€‚</p>
<p>å®ƒåªèƒ½åœ¨ ESLint ä¸»è¦ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ã€‚æ¢å¥è¯è¯´ï¼Œå‡å¦‚ ESLint <code>6.7.1</code> ç‰ˆæœ¬çš„è§„åˆ™ <code>ruleA</code> åœ¨ <code>6.8.0</code> ä¸ä¼šæ›´æ–°ï¼Œåªæœ‰åœ¨ ESLint <code>7.x</code> æˆ–æ›´é«˜æ‰å¯èƒ½ä¼šæ›´æ–°ã€‚æ‰€ä»¥åœ¨æ›´æ–° ESLint ä¸»ç‰ˆæœ¬ä¹‹åï¼Œåœ¨ä½¿ç”¨ <code>--fix</code> é€‰é¡¹ç»§ç»­ä¿®å¤ä¹‹å‰ï¼Œåº”è¯¥å…ˆæ£€æŸ¥ä¸€ä¸‹æŠ¥å‘Šçš„é—®é¢˜ï¼Œè¿™æ ·ä½ å°±çŸ¥é“å“ªäº›è§„åˆ™æœ‰è°ƒæ•´äº†ã€‚</p>
</blockquote>
<blockquote>
<p><code>eslint:all</code><strong>ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</strong></p>
<p>å®ƒå¯ç”¨å½“å‰å®‰è£…çš„ ESLint ä¸­æ‰€æœ‰çš„æ ¸å¿ƒè§„åˆ™ï¼Œå®ƒå¯ä»¥åœ¨ ESLint çš„ä»»ä½•ç‰ˆæœ¬è¿›è¡Œæ›´æ”¹ï¼Œä½¿ç”¨æœ‰é£é™©ã€‚</p>
</blockquote>
<blockquote>
<p><a href="http://eslint.cn/docs/developer-guide/shareable-configs">å¯å…±äº«çš„é…ç½®</a></p>
<p>å®ƒæ˜¯ä¸€ä¸ª npm åŒ…ï¼Œè¾“å‡ºä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚å±æ€§å€¼å¯çœç•¥åŒ…å <code>eslint-config-</code>ï¼Œæ¯”å¦‚ <code>&quot;extends&quot;: &quot;alloy&quot;</code>ã€‚</p>
</blockquote>
<blockquote>
<p><a href="http://eslint.cn/docs/developer-guide/working-with-plugins">æ’ä»¶</a></p>
<p>å®ƒæ˜¯ä¸€ä¸ª npm åŒ…ï¼Œé™¤äº†é€šå¸¸çš„è¾“å‡ºè§„åˆ™ä¹‹å¤–ï¼Œä¸€äº›æ’ä»¶è¿˜å¯ä»¥è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå‘½åçš„Â <a href="http://eslint.cn/docs/developer-guide/working-with-plugins#configs-in-plugins">é…ç½®</a>ã€‚</p>
<ul>
<li><code>plugins</code> å±æ€§å€¼å¯ä»¥çœç•¥åŒ…åçš„å‰ç¼€ <code>eslint-plugin-</code>.</li>
<li><code>extends</code> å±æ€§å€¼ç”±ä»¥ä¸‹ç»„æˆ</li>
</ul>
<ol>
<li><code>plugin:</code></li>
<li><code>åŒ…å</code>ï¼ˆæ˜¯çœç•¥äº† <code>eslint-plugin-</code> å‰ç¼€ï¼Œæ¯”å¦‚ <code>react</code>ï¼‰</li>
<li><code>/</code></li>
<li><code>é…ç½®åç§°</code>ï¼ˆæ¯”å¦‚ <code>recommended</code>ï¼‰</li>
</ol>
<p>ä¾‹å¦‚ï¼Œ<code>&quot;plugin:react/recommended&quot;</code></p>
</blockquote>
<pre><code class="language-js">{
  plugins: ['react'],
  extends: [
    'eslint:recommended',
    'plugin:react/recommended'
  ]
}
</code></pre>
<blockquote>
<p>é…ç½®æ–‡ä»¶è·¯å¾„</p>
<p><code>extends</code> å±æ€§å€¼å¯ä»¥æ˜¯åŸºæœ¬é…ç½®æ–‡ä»¶çš„<strong>ç»å¯¹/ç›¸å¯¹</strong>è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„ç›¸å¯¹äºå½“å‰é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
</blockquote>
<pre><code class="language-js">{
  extends: [
    './node_modules/coding-standard/eslintDefaults.js',
    './node_modules/coding-standard/.eslintrc-es6',
    './node_modules/coding-standard/.eslintrc-jsx'
  ]
}
</code></pre>
<ul>
<li><strong>è¦†ç›–ï¼ˆOverridesï¼‰</strong></li>
</ul>
<p>æ¯”å¦‚ï¼Œå¦‚æœåŒä¸€ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶éœ€è¦æœ‰ä¸åŒçš„é…ç½®ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åœ¨é…ç½®ä¸­ä½¿ç”¨ <code>overrides</code> é”®ï¼Œå®ƒåªé€‚ç”¨äºåŒ¹é…ç‰¹å®šçš„ <code>glob</code> æ¨¡å¼çš„æ–‡ä»¶ã€‚</p>
<p>å‡ ç‚¹è¦æ³¨æ„çš„ï¼š</p>
<ul>
<li>åªèƒ½åœ¨ <code>.eslintrc.*</code> æˆ–è€… <code>package.json</code> ä¸­é…ç½®ã€‚</li>
<li>é‡‡ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li>Glob æ¨¡å¼è¦†ç›–è¦æ¯”å…¶ä»–å¸¸è§„é…ç½®å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚åŒä¸€é…ç½®æ–‡ä»¶ä¸­å¤šä¸ªè¦†ç›–æŒ‰ç…§é¡ºåºè¢«åº”ç”¨ï¼Œå³æœ€åä¸€ä¸ªè¦†ç›–ä¼šæœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚</li>
</ul>
<pre><code class="language-js">{
  rules: {
    quotes: ['error', 'double']
  },
  overrides: [
    {
      files: ['bin/*.js', 'lib/*.js'],
      excludedFiles: '*.test.js',
      rules: {
        quotes: ['error', 'single']
      }
    }
  ]
}
</code></pre>
<h5>3. ESLint é…ç½®æ–‡ä»¶æ ¼å¼</h5>
<p>ESLint æ”¯æŒå‡ ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼š</p>
<blockquote>
<ul>
<li><strong>JavaScript</strong> - ä½¿ç”¨ <code>.eslintrc.js</code> ç„¶åè¾“å‡ºä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚</li>
<li><strong>YAML</strong> - ä½¿ç”¨ <code>.eslintrc.yaml</code> æˆ– <code>.eslintrc.yml</code> å»å®šä¹‰é…ç½®çš„ç»“æ„ã€‚</li>
<li><strong>JSON</strong> - ä½¿ç”¨ <code>.eslintrc.json</code> å»å®šä¹‰é…ç½®çš„ç»“æ„ï¼ŒESLint çš„ JSON æ–‡ä»¶å…è®¸ JavaScript é£æ ¼çš„æ³¨é‡Šã€‚</li>
<li><strong>(å¼ƒç”¨)</strong> - ä½¿ç”¨ <code>.eslintrc</code>ï¼Œå¯ä»¥ä½¿ JSON ä¹Ÿå¯ä»¥æ˜¯ YAMLã€‚</li>
<li><strong>package.json</strong> - åœ¨ <code>package.json</code> é‡Œåˆ›å»ºä¸€ä¸ª <code>eslintConfig</code> å±æ€§ï¼Œåœ¨é‚£é‡Œå®šä¹‰ä½ çš„é…ç½®ã€‚</li>
</ul>
</blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ<strong>åŒä¸€ä¸ªç›®å½•ä¸‹</strong>æœ‰<strong>å¤šä¸ª</strong>é…ç½®æ–‡ä»¶ï¼ŒESLint <strong>åªä¼šä½¿ç”¨ä¸€ä¸ª</strong>ã€‚</p>
<blockquote>
<p>ä¼˜å…ˆçº§ä»é«˜åˆ°ä½</p>
<ol>
<li><code>.eslintrc.js</code></li>
<li><code>.eslintrc.yaml</code></li>
<li><code>.eslintrc.yml</code></li>
<li><code>.eslintrc.json</code></li>
<li><code>.eslintrc</code></li>
<li><code>package.json</code></li>
</ol>
</blockquote>
<h5>4. ESLint çš„å±‚å é…ç½®</h5>
<p>*ä¸‹é¢ä»‹ç»çš„é…ç½®æ–‡ä»¶é‡‡ç”¨ JavaScript æ ¼å¼ï¼Œå³ <code>.eslintrc.js</code>ã€‚</p>
<p>å‡å¦‚å¦‚ä¸‹åœºæ™¯ï¼Œé¡¹ç›®æ ¹ç›®å½•æœ‰ä¸€ä¸ª <code>.eslintrc.js</code> é…ç½®æ–‡ä»¶ï¼Œ<code>test/</code> ç›®å½•ä¹Ÿæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
<pre><code>your-project
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ lib
â”‚ â””â”€â”€ source.js
â””â”€â”¬ tests
  â”œâ”€â”€ .eslintrc
  â””â”€â”€ test.js
</code></pre>
<p>è¿™ç§æƒ…å†µ ESLint å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>
<blockquote>
<p>å±‚å é…ç½®ä½¿ç”¨ç¦»æ£€æµ‹æ–‡ä»¶æœ€è¿‘çš„ <code>.eslintrc.js</code> æ–‡ä»¶ä½œä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œç„¶åæ‰æ˜¯çˆ¶ç›®å½•é‡Œçš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>å½“ ESLint éå† <code>lib/</code> ç›®å½•æ—¶ï¼Œä½¿ç”¨æ ¹ç›®å½•é‡Œçš„  <code>.eslintrc.js</code> ä½œä¸ºå®ƒçš„é…ç½®æ–‡ä»¶ã€‚å½“éå†åˆ° <code>tests/</code> ç›®å½•æ—¶ï¼Œé™¤äº†ä¼šä½¿ç”¨æ ¹ç›®å½•  <code>your-project/.eslintrc.js</code> ä¹‹å¤–ï¼Œè¿˜ä¼šç”¨åˆ°  <code>your-project/tests/.eslintrc.js</code> ï¼Œæ‰€ä»¥  <code>your-project/tests/test.js</code> æ˜¯åŸºäºå®ƒçš„ç›®å½•å±‚æ¬¡ç»“æ„ä¸­çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„ç»„åˆï¼Œå¹¶ä¸”ç¦»çš„æœ€è¿‘çš„ä¸€ä¸ªä¼˜å…ˆã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æœ‰é¡¹ç›®çº§ ESLint è®¾ç½®ï¼Œä¹Ÿæœ‰è¦†ç›–ç‰¹å®šç›®å½•çš„ ESLint è®¾ç½®ã€‚</p>
</blockquote>
<p>å®Œæ•´çš„é…ç½®å±‚æ¬¡ç»“æ„ï¼Œä»æœ€é«˜ä¼˜å…ˆçº§åˆ°æœ€ä½çš„ä¼˜å…ˆçº§ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>è¡Œå†…é…ç½®
<ol>
<li><code>/* eslint-disable */</code> å’Œ <code>/* eslint-enable */</code></li>
<li><code>/* global */</code></li>
<li><code>/* eslint */</code></li>
<li><code>/* eslint-env */</code></li>
</ol>
</li>
<li>å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæˆ–è€… CLIEngine ç­‰ä»·ç‰©ï¼‰
<ol>
<li><code>--global</code></li>
<li><code>--rule</code></li>
<li><code>--env</code></li>
<li><code>-c</code>ã€<code>--config</code></li>
</ol>
</li>
<li>é¡¹ç›®çº§é…ç½®ï¼š
<ol>
<li>ä¸æ£€æµ‹çš„æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹çš„ <code>.eslintrc.*</code> æˆ–è€… <code>package.json</code> æ–‡ä»¶ã€‚</li>
<li>ç»§ç»­åœ¨çˆ¶çº§ç›®å½•å¯»æ‰¾ <code>.eslintrc.*</code> æˆ– <code>package.json</code> æ–‡ä»¶ï¼Œç›´åˆ°æ ¹ç›®å½•ï¼ˆåŒ…å«ï¼‰æˆ–ç›´åˆ°å‘ç°ä¸€ä¸ªæœ‰ <code>&quot;root&quot;: true</code> çš„é…ç½®ã€‚</li>
</ol>
</li>
<li>å¦‚æœä¸æ˜¯ï¼ˆ1ï¼‰åˆ°ï¼ˆ3ï¼‰ä¸­çš„ä»»ä½•ä¸€ç§æƒ…å†µï¼Œåˆ™é€€å›åˆ° <code>~/.eslintrc</code>ï¼ˆç”¨æˆ·ç›®å½•ä¸‹ï¼‰ ä¸­è‡ªå®šä¹‰çš„é»˜è®¤é…ç½®ã€‚</li>
</ol>
</blockquote>
<p>éå¸¸æœ‰å¿…è¦çš„æ˜¯ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è®¾ç½®ä¸€ä¸ª <code>&quot;root&quot;: true</code>ï¼Œè¡¨ç¤º ESLint ä¸€æ—¦å‘ç°é…ç½®æ–‡ä»¶ä¸­æœ‰è¯¥å±æ€§æ—¶ï¼Œå®ƒå°±ä¼šåœæ­¢åœ¨çˆ¶çº§ç›®å½•ä¸­å¯»æ‰¾ã€‚</p>
<pre><code class="language-js">{
  root: true
}
</code></pre>
<h5>5. æ£€æµ‹æ‰©å±•å</h5>
<p>ç›®å‰åªèƒ½é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹ <code>--ext</code> æŒ‡å®šï¼Œå‘Šè¯‰ ESLint å“ªä¸ªæ–‡ä»¶æ‰©å±•åè¦æ£€æµ‹ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;scripts&quot;: {
    &quot;eslint&quot;: &quot;eslint . --ext .js&quot;
  }
}
</code></pre>
<h5>6. å¿½ç•¥ç‰¹å®šçš„æ–‡ä»¶å’Œç›®å½•</h5>
<p>é€šè¿‡é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>.eslintignore</code> æ–‡ä»¶å‘Šè¯‰ ESLint å»å¿½ç•¥ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•ã€‚å®ƒä¾ç…§Â <code>.gitignore</code>Â <a href="https://git-scm.com/docs/gitignore">è§„èŒƒ</a>ã€‚</p>
<p>å¦‚æœç›¸æ¯”äºå½“å‰ç›®å½•ä¸‹ <code>.eslintignore</code> æ–‡ä»¶ï¼Œä½ æ›´æƒ³ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ <code>--ingnore-path</code> é€‰é¡¹æŒ‡å®šå®ƒã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>.jshintignore</code> æ–‡ä»¶ï¼Œå®ƒæœ‰ç›¸åŒçš„æ ¼å¼ã€‚</p>
<pre><code class="language-shell">$ npx eslint --ignore-path .jshintignore file.js
</code></pre>
<p>å¦‚æœæ²¡æœ‰å‘ç° <code>.eslintignore</code> æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰æŒ‡å®šæ›¿ä»£æ–‡ä»¶ï¼ŒESLint å°†åœ¨ <code>package.json</code> æ–‡ä»¶ä¸­æŸ¥æ‰¾ <code>eslintIgnore</code> é”®ï¼Œæ¥æ£€æŸ¥è¦å¿½ç•¥çš„æ–‡ä»¶ã€‚</p>
<blockquote>
<p>é‡è¦ï¼š</p>
<ol>
<li>æ³¨æ„ä»£ç åº“çš„ <code>node_modules</code> ç›®å½•ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ª <code>packages</code> ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè¢«å¿½ç•¥ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ° <code>.eslintignore</code>ã€‚</li>
<li>æŒ‡å®š <code>--ignore-path</code> æ„å‘³ç€ä»»ä½•ç°æœ‰çš„ <code>.eslintignore</code> æ–‡ä»¶å°†ä¸è¢«ä½¿ç”¨ã€‚</li>
</ol>
</blockquote>
<p>é™„ä¸Šæˆ‘çš„ <code>.eslintrc.js</code> é…ç½®æ–‡ä»¶</p>
<pre><code class="language-js">module.exports = {
  root: true,
  parser: 'babel-eslint',
  extends: [
    'alloy',
    'alloy/react' // eslint-config-alloy å¯ç”¨ eslint-plugin-react
  ],
  parserOptions: {
    ecmaVersion: 2019,
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true // å¯ç”¨ JSX
    }
  },
  settings: {
    react: {
      version: 'detect' // è‡ªåŠ¨é€‰æ‹©ä½ å·²å®‰è£…çš„ç‰ˆæœ¬
    }
  },
  // æ’ä»¶åç§°å¯ä»¥çœç•¥ eslint-plugin- å‰ç¼€ã€‚
  plugins: [],
  // ç¯å¢ƒå˜é‡ï¼ˆåŒ…å«å¤šä¸ªé¢„å®šä¹‰çš„å…¨å±€å˜é‡ï¼‰
  env: {
    browser: true,
    es6: true,
    node: true,
    commonjs: true
  },
  // å…¨å±€å˜é‡ï¼ˆè®¾ç½®ä¸º false è¡¨ç¤ºå®ƒä¸å…è®¸è¢«é‡æ–°èµ‹å€¼ï¼‰
  globals: {},
  // è‡ªå®šä¹‰è§„åˆ™
  rules: {
    'react/prop-types': [0],
    'default-case-last': 0,
    'no-unused-vars': 0,
    'no-var': 0,
    'no-irregular-whitespace': 0,
    'use-isnan': 2,
    'no-alert': 2,
    'no-eval': 2,
    'spaced-comment': 2,
    'react/self-closing-comp': 0,
    indent: ['error', 2, { SwitchCase: 1 }]
  }
}

</code></pre>
<h3>ä¸‰ã€Prettier</h3>
<p>ç»ˆäºè®²å®Œ ESLint äº†ï¼Œå†…å®¹æŒºå¤šçš„ï¼Œå·®ç‚¹åäº†...æ¥ç€ä»‹ç» Prettierã€‚</p>
<ol>
<li>é¦–å…ˆå®‰è£… Prettier</li>
</ol>
<pre><code class="language-shell">$ yarn add --dev prettier@2.0.5
$ yarn add --dev prettier-eslint-cli@5.0.0
</code></pre>
<ol start="2">
<li>æ ¼å¼åŒ–æ–‡ä»¶</li>
</ol>
<pre><code class="language-shell">$ yarn prettier --write [dir or file]

# æ ¼å¼åŒ–å…¨éƒ¨æ–‡ä»¶
# yarn prettier --write .
# æ ¼å¼åŒ–ç¡®åˆ‡çš„ç›®å½•ï¼Œå¦‚ app
# yarn prettier --write app/
# æ ¼å¼åŒ–ç¡®åˆ‡çš„æ–‡ä»¶ï¼Œå¦‚ index.js
# yarn prettier --write app/index.js
# æ”¯æŒ Glob æ¨¡å¼åŒ¹é…æ–‡ä»¶ï¼Œå¦‚æ ¼å¼åŒ– app ç›®å½•ä¸‹çš„æ‰€æœ‰ JS æ‰©å±•æ–‡ä»¶
# yarn prettier --write &quot;app/**/*.js&quot;
</code></pre>
<ol start="3">
<li>æ£€æŸ¥æ–‡ä»¶</li>
</ol>
<pre><code class="language-shell"># åŒ¹é…æ–¹å¼åŒä¸Š
$ yarn prettier --check [dir or file]
</code></pre>
<blockquote>
<p><code>--check</code> è·Ÿ <code>--write</code> ä¸åŒçš„æ˜¯ï¼Œå‰è€…ä»…æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²è¢«æ ¼å¼åŒ–ï¼Œåè€…æ˜¯æ ¼å¼åŒ–å¹¶è¦†ç›–ã€‚</p>
</blockquote>
<ol start="4">
<li>æ·»åŠ  Prettier é…ç½®æ–‡ä»¶ <code>.prettierrc.js</code>ï¼Œä»¥åŠç›¸å…³è§„åˆ™ã€‚
ä¸‹é¢æ˜¯ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„é…ç½®ï¼Œè‹¥æƒ³çŸ¥é“æ›´å¤šå¯é€‰é…ç½®ï¼Œè¯·ç§»æ­¥<a href="https://prettier.io/docs/en/options.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
</ol>
<pre><code class="language-js">// .prettierrc.js
module.exports = {
  // ä¸ ESLint æ•´åˆ
  // eslintIntegration: false,
  // ä¸€è¡Œæœ€å¤š 160 å­—ç¬¦
  printWidth: 160,
  // ä½¿ç”¨ 2 ä¸ªç©ºæ ¼ç¼©è¿›
  tabWidth: 2,
  // ä¸ä½¿ç”¨ç¼©è¿›ç¬¦ï¼Œè€Œä½¿ç”¨ç©ºæ ¼
  useTabs: false,
  // è¡Œå°¾ä¸éœ€è¦æœ‰åˆ†å·
  semi: false,
  // ä½¿ç”¨å•å¼•å·ï¼ˆJSX å¼•å·ä¼šå¿½ç•¥æ­¤é€‰é¡¹ï¼‰
  singleQuote: true,
  // JSX ä¸ä½¿ç”¨å•å¼•å·ï¼Œè€Œä½¿ç”¨åŒå¼•å·
  jsxSingleQuote: false,
  // å¯¹è±¡çš„ key ä»…åœ¨å¿…è¦æ—¶ç”¨å¼•å·
  quoteProps: 'as-needed',
  // æœ«å°¾ä¸éœ€è¦é€—å·
  trailingComma: 'none',
  // å¤§æ‹¬å·å†…çš„é¦–å°¾éœ€è¦ç©ºæ ¼
  bracketSpacing: true,
  // JSX æ ‡ç­¾çš„åå°–æ‹¬å·éœ€è¦æ¢è¡Œ
  jsxBracketSameLine: false,
  // ç®­å¤´å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¸éœ€è¦æ‹¬å·
  arrowParens: 'avoid',
  // æ¯ä¸ªæ–‡ä»¶æ ¼å¼åŒ–çš„èŒƒå›´æ˜¯æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
  rangeStart: 0,
  rangeEnd: Infinity,
  // ä¸éœ€è¦å†™æ–‡ä»¶å¼€å¤´çš„ @prettier
  requirePragma: false,
  // ä¸éœ€è¦è‡ªåŠ¨åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥ @prettier
  insertPragma: false,
  // ä½¿ç”¨é»˜è®¤çš„æŠ˜è¡Œæ ‡å‡†
  proseWrap: 'preserve',
  // æ ¹æ®æ˜¾ç¤ºæ ·å¼å†³å®š HTML è¦ä¸è¦æŠ˜è¡Œ
  htmlWhitespaceSensitivity: 'css',
  // æ¢è¡Œç¬¦ä½¿ç”¨ lf
  endOfLine: 'lf'
}
</code></pre>
<ol start="5">
<li>å…³äº <code>overrides</code> é€‰é¡¹</li>
</ol>
<p>ä¸Šé¢çš„å¯é€‰é¡¹ï¼Œé™¤äº†é€šè¿‡é…ç½®æ–‡ä»¶çš„å½¢å¼æŒ‡å®šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ CLI å½¢å¼æ¥æŒ‡å®šï¼Œä½†æ¨èå‰è€…ã€‚è€Œ <code>overrides</code> é€‰é¡¹åªèƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚</p>
<blockquote>
<p><code>overrides</code> çš„ä½œç”¨æ˜¯å¯¹æŸäº›æ–‡ä»¶æ‰©å±•åï¼Œæ–‡ä»¶å¤¹å’Œç‰¹å®šæ–‡ä»¶è¿›è¡Œä¸åŒçš„<a href="https://prettier.io/docs/en/configuration.html">é…ç½®</a>ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒPrettier çš„<a href="https://prettier.io/docs/en/options.html#parser">é»˜è®¤è§£æå™¨</a>æ˜¯ä¸æ”¯æŒè§£æå°ç¨‹åºä¸­æ‰©å±•åä¸º <code>.wxss</code>ã€<code>.acss</code> çš„æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ <code>overrides</code> æ¥æŒ‡å®šè§£æå™¨ï¼Œç„¶åå°±èƒ½å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–äº†ã€‚</p>
</blockquote>
<pre><code class="language-js">{
  overrides: [
    {
      files: ['*.wxss', '*.acss'],
      options: {
        parser: 'css'
      }
    },
    // ç±»ä¼¼åœ°ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œäº¦å¯å°† JavaScript æ–‡ä»¶ä½¿ç”¨ flow æ¥ä»£æ›¿é»˜è®¤çš„ babel è§£æå™¨ã€‚
    // {
    //   files: '*.js',
    //   options: {
    //     parser: 'flow'
    //   }
    // }
  ]
}
</code></pre>
<ol start="6">
<li>å…±äº«é…ç½®</li>
</ol>
<p>Prettier æä¾›äº†ä¸€ä¸ªå…±äº«é…ç½®ï¼ˆ<a href="https://prettier.io/docs/en/configuration.html#sharing-configurations">Sharing configurations</a>ï¼‰çš„é€‰é¡¹ã€‚</p>
<p>å®ƒé€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿ</p>
<blockquote>
<p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä»½ Prettier é…ç½®ï¼ŒåŒæ—¶é€‚ç”¨äºæˆ‘ä»¬å…¬å¸å¤šä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯èƒ½éœ€è¦ç”¨åˆ°å®ƒï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ä¸€å¥—é…ç½®æ–‡ä»¶å°±å¥½äº†ã€‚ç±»ä¼¼äº NPM åŒ…ä¸€æ ·ï¼Œä½†è¿™é‡Œä¸èµ˜è¿°ï¼Œæœ‰éœ€è¦çš„çœ‹ä¸‹<a href="https://prettier.io/docs/en/configuration.html#sharing-configurations">å®˜æ–¹æ–‡æ¡£ä»‹ç»</a>ï¼Œåç»­æˆ‘ä¼šè€ƒè™‘å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ä»‹ç»ï¼Œåˆ°æ—¶ä¼šå›æ¥æ›´æ–°æ–‡ç« çš„ã€‚</p>
</blockquote>
<ol start="7">
<li>å¿½ç•¥æ–‡ä»¶ <code>.prettierignore</code></li>
</ol>
<p>å®ƒåŒæ ·ä¾ç…§ <code>.gitignore</code> çš„è¯­æ³•ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ ¹æ®é¡¹ç›®è‡ªè¡Œå¢åˆ æ”¹ã€‚</p>
<pre><code class="language-.gitignore"># .prettierignore æ–‡ä»¶é…ç½®
/node_modules
/dist
/src/fonts/

## OS
.DS_Store
.idea
.editorconfig
package-lock.json
.npmrc

# Ignored suffix
*.log
*.md
*.svg
*.png
*ignore


## Built-files
.cache
dist
</code></pre>
<h3>å››ã€ESLint + Prettier</h3>
<h5>1. æœ‰å¿…è¦äº†è§£çš„ä¸¤ä¸ªä¾èµ–</h5>
<p>ESLint è§£å†³çš„æ˜¯<strong>ä»£ç è´¨é‡é—®é¢˜</strong>ï¼Œè€Œ Prettier è§£å†³çš„æ˜¯<strong>ä»£ç é£æ ¼é—®é¢˜</strong>ã€‚æŒ‰é“ç† ESLint + Prettier ç»“åˆå°±èƒ½è§£å†³å‰é¢ä¸¤ä¸ªé—®é¢˜ï¼Œä½†å®é™…ä¸Šä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šæœ‰å†²çªï¼ŒåŸå› æ˜¯ ESLint ä¹Ÿæœ‰å‚ä¸ä»£ç æ ¼å¼é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªä¾èµ–åŒ…æ¥å¤„ç†å†²çªï¼š</p>
<ul>
<li><a href="https://github.com/prettier/eslint-config-prettier">eslint-config-prettier</a></li>
</ul>
<blockquote>
<p>å…³é—­æ‰€æœ‰ä¸ Prettier å†²çªçš„ ESLint è§„åˆ™ã€‚ï¼ˆè¢«å…³é—­çš„è§„åˆ™æ˜¯ä¸ä»£ç é£æ ¼ç›¸å…³çš„ï¼‰</p>
</blockquote>
<pre><code class="language-js">{
  extends: ['prettier'] // eslint-config-prettier ä¸€å®šè¦æ˜¯æœ€åä¸€ä¸ªï¼Œæ‰èƒ½ç¡®ä¿è¦†ç›–å…¶ä»–é…ç½®
}
</code></pre>
<ul>
<li><a href="https://github.com/prettier/eslint-plugin-prettier">eslint-plugin-prettier</a>Â ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰</li>
</ul>
<blockquote>
<p>å°† Prettier ä½œä¸º ESLint è§„åˆ™è¿è¡Œï¼Œå¹¶å°†å·®å¼‚æŠ¥å‘Šä¸ºå•ä¸ª ESLint é—®é¢˜ã€‚</p>
</blockquote>
<p>ä½¿ç”¨äº† <code>eslint-config-prettier</code> å…³é—­æ‰ä¸ Prettier å†²çªçš„è§„åˆ™ï¼Œè¿™æ—¶æ ¼å¼é—®é¢˜å·²å…¨é¢äº¤ç»™ Prettier å¤„ç†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ <code>eslint-plugin-prettier</code> å‘¢ï¼Ÿ</p>
<p>åŸå› æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æœŸæœ›æŠ¥é”™çš„æ¥æºä¾æ—§æ˜¯ ESLintã€‚è¿™ä¸ªæ’ä»¶æŠŠ Prettier æ ¼å¼é…ç½®ä»¥ ESLint rules è§„åˆ™çš„æ–¹å¼å†™å…¥ï¼Œè¿™æ ·æ‰€æœ‰çš„æŠ¥é”™éƒ½æ¥è‡ªäº ESLint äº†ã€‚</p>
<pre><code class="language-js">{
  plugins: ['prettier'],
  rules: {
    'prettier/prettier': 'error'
  }
}
</code></pre>
<p>ä¸Šé¢ä¸¤è€…é…ç½®çš„ç»“åˆå°±ç›¸å½“äºï¼ˆ<a href="https://github.com/prettier/eslint-plugin-prettier#recommended-configuration">å®˜æ–¹æ¨è</a>ï¼‰ï¼š</p>
<pre><code class="language-js">{
  extends: ['plugin:prettier/recommended']
}
</code></pre>
<p><strong>å…¶å®æœ¬é¡¹ç›®çš„é…ç½®å¹¶ä¸ä½¿ç”¨ä»¥ä¸Šä¸¤ä¸ªä¾èµ–ï¼Œä½†æˆ‘è®¤ä¸ºï¼Œéå¸¸æœ‰å¿…è¦æ¸…æ¥šäº†è§£ä¸¤ä¸ªæ’ä»¶çš„ä½œç”¨ã€‚</strong></p>
<p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘æ˜¯æ€ä¹ˆå¤„ç† ESLint å’Œ Prettier ä¸¤è€…çš„å†²çªå‘¢ï¼Ÿ</p>
<h5>2. è§£å†³æ–¹æ¡ˆ</h5>
<p>åŸå› å…¶å®è·Ÿæˆ‘é€‰ç”¨çš„ <code>eslint-config-alloy</code> æœ‰å…³ã€‚<code>eslint-config-alloy</code> ä» v3 å¼€å§‹ï¼Œå·²ç»ä¸åŒ…å«æ‰€æœ‰æ ·å¼ç›¸å…³çš„è§„åˆ™äº†ï¼Œæ•…ä¸éœ€è¦å¼•å…¥ <code>eslint-config-prettier</code>ã€‚</p>
<blockquote>
<p>è™½ç„¶å®˜æ–¹ä»‹ç»è¯´ï¼Œä¸åŒ…å«ä»»ä½•çš„æ ·å¼ç›¸å…³çš„è§„åˆ™ï¼Œä½†æ˜¯æˆ‘å‘ç°åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒESLint ä¸ Prettier ä»ç„¶å­˜åœ¨ä¸€äº›å†²çªï¼Œæ¯”å¦‚ä¸‰å…ƒè¿ç®—çš„ç¼©è¿›é—®é¢˜ã€‚</p>
<p>è¿™æ˜¯æˆ‘æŠ›å‡ºçš„ä¸€ä¸ªç–‘æƒ‘ï¼Œä¸çŸ¥é“æ˜¯æˆ‘ç†è§£é”™äº†ï¼Œè¿˜æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿåç»­æ‰“ç®—æä¸ª <a href="https://github.com/AlloyTeam/eslint-config-alloy/issues">issues</a> é—®ä¸‹å¤§ä½¬ã€‚</p>
</blockquote>
<p>æˆ‘çš„ NPM è„šæœ¬æ˜¯è¿™æ ·è®¾è®¡çš„ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;eslint&quot;: &quot;eslint . --ext .js&quot;,
    &quot;eslint:fix&quot;: &quot;eslint --fix . --ext .js&quot;,
    &quot;prettier:fix&quot;: &quot;prettier --config .prettierrc.js --write './**/*.{js,css,less,scss,json}'&quot;,
    &quot;format:all&quot;: &quot;npm-run-all -s prettier:fix eslint:fix&quot;
  }
}
</code></pre>
<p>çœ‹åˆ°ä¸Šé¢è¿™ä¸ªï¼Œä½ ä»¬å¤§è‡´ä¹Ÿæ¸…æ¥šæ€è·¯äº†ã€‚æ—¢ç„¶ ESLint ä¸ Prettier ä»å­˜åœ¨å†²çªï¼Œé‚£ä¹ˆä¸¤è€…å­˜åœ¨å†²çªæ—¶ï¼Œæˆ‘å°±ä»¥ ESLint çš„ä¼˜å…ˆçº§æœ€é«˜å°±å¥½äº†ã€‚åˆ©ç”¨ <a href="https://www.npmjs.com/package/npm-run-all">npm-run-all</a> æŒ‰é¡ºåºåˆ†åˆ«æ‰§è¡Œ <code>prettier:fix</code>ã€<code>eslint:fix</code> å‘½ä»¤ï¼Œè¿™æ ·åªè¦æ‰§è¡Œ <code>yarn run format:all</code> ä¸€æ¡å‘½ä»¤å°±æŠŠä»£ç è´¨é‡æ£€æŸ¥ä¸ä»£ç é£æ ¼éƒ½æ£€æŸ¥å¤„ç†ä¸€éï¼ˆåŒ…å«äº†ä¸€äº›è‡ªåŠ¨ä¿®å¤çš„ï¼‰ã€‚</p>
<h3>äº”ã€EditorConfig</h3>
<p><a href="https://editorconfig.org/">EditorConfig</a> æœ‰åŠ©äºç»´æŠ¤è·¨å¤šä¸ªç¼–è¾‘å™¨å’Œ IDE ä»äº‹åŒä¸€é¡¹ç›®çš„å¤šä¸ªå¼€å‘äººå‘˜çš„ä¸€è‡´ç¼–ç é£æ ¼ã€‚ EditorConfig é¡¹ç›®åŒ…å«ä¸€ä¸ªç”¨äºå®šä¹‰ç¼–ç æ ·å¼çš„æ–‡ä»¶æ ¼å¼å’Œä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨æ’ä»¶é›†åˆï¼Œè¿™äº›æ–‡æœ¬ç¼–è¾‘å™¨æ’ä»¶ä½¿ç¼–è¾‘å™¨å¯ä»¥è¯»å–æ–‡ä»¶æ ¼å¼å¹¶éµå¾ªå®šä¹‰çš„æ ·å¼ã€‚ EditorConfig æ–‡ä»¶æ˜“äºé˜…è¯»ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¾ˆå¥½åœ°ååŒå·¥ä½œã€‚</p>
<blockquote>
<p>å®ƒä¸»è¦æ˜¯ç”¨äºè§„èŒƒç¼©è¿›é£æ ¼ï¼Œç¼©è¿›å¤§å°ï¼ŒTab é•¿åº¦ä»¥åŠå­—ç¬¦é›†ç­‰ï¼Œè§£å†³ä¸åŒ IDE çš„ç¼–ç èŒƒè®¾ç½®ã€‚EditorConfig æ’ä»¶ä¼šå»æŸ¥æ‰¾å½“å‰ç¼–è¾‘æ–‡ä»¶çš„æ‰€åœ¨æ–‡ä»¶å¤¹æˆ–å…¶ä¸Šçº§æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰ <code>.editorconfig</code> æ–‡ä»¶ã€‚å¦‚æœæœ‰åˆ™ç¼–è¾‘å™¨çš„è¡Œä¸ºä¼šä¸ <code>.editorconfig</code> æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€è‡´ï¼Œå¹¶ä¸”å…¶ä¼˜å…ˆçº§é«˜äºç¼–è¾‘å™¨è‡ªèº«çš„è®¾ç½®ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ VS Code è¿›è¡Œå¼€å‘çš„è¯ï¼Œæœç´¢å®‰è£… <a href="https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig">EditorConfig for VS Code</a> æ’ä»¶ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ ä¸€ä»½ <code>.editorconfig</code> é…ç½®æ–‡ä»¶ã€‚</p>
<pre><code class="language-ini"># .editorconfig

# æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘å™¨ä¼šç”±å½“å‰ç›®å½•å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ° `roor = true` çš„æ–‡ä»¶ï¼Œåˆ™ä¸å†æŸ¥æ‰¾
root = true

# åŒ¹é…æ‰€æœ‰çš„æ–‡ä»¶
[*]
# ç¼©è¿›é£æ ¼ï¼šspace
indent_style = space
# ç¼©è¿›å¤§å° 2
indent_size = 2
# æ¢è¡Œç¬¦ lf
end_of_line = lf
# å­—ç¬¦é›† utf-8
charset = utf-8
# ä¸ä¿ç•™è¡Œæœ«çš„ç©ºæ ¼
trim_trailing_whitespace = true
# æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€ä¸ªç©ºè¡Œ
insert_final_newline = true
# è¿ç®—ç¬¦ä¸¤ééƒ½æœ‰ç©ºæ ¼
spaces_around_operators = true

# å¯¹æ‰€æœ‰çš„ js æ–‡ä»¶ç”Ÿæ•ˆ
[*.js]
# å­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·
quote_type = single
trim_trailing_whitespace = true

[.*rc]
indent_size = 2
indent_style = space

[*.json]
indent_size = 2
indent_style = space

[*.md]
indent_style = space
trim_trailing_whitespace = false
</code></pre>
<h3>å…­ã€å…³äº eslint-loader å’Œ babel-eslint</h3>
<h5>1. eslint-loader</h5>
<p>æˆ‘ä»¬å¸Œæœ›åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½èƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œ ESLint çš„æ£€æŸ¥ã€‚è¿™æ ·ï¼Œå€˜è‹¥ç¼–å†™ä»£ç æ—¶å‡ºç°äº†è¯­æ³•é”™è¯¯ç­‰é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¿…é€Ÿå®šä½é—®é¢˜å¹¶è§£å†³ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ© <a href="https://github.com/webpack-contrib/eslint-loader">eslint-loader</a> æ¥å¸®æˆ‘ä»¬å®Œæˆè¿™ä¸ªéœ€æ±‚ã€‚</p>
<pre><code class="language-shell">$ yarn add --dev babel-loader@4.0.2
</code></pre>
<pre><code class="language-js">// webpack.config.js
{
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: 'babel-loader'
      },
      {
        test: /\.js$/,
        enforce: 'pre', // ç¡®ä¿è¦æ¯” babel-loader æ‰§è¡Œï¼Œå› ä¸º eslint-loader è¦æ£€æµ‹çš„æ˜¯ babel ä¹‹å‰çš„ä»£ç 
        exclude: /node_modules/,
        loader: 'eslint-loader',
        options: {
          fix: true, // å¯ç”¨ ESLint autofix è‡ªåŠ¨ä¿®å¤ï¼Œæ³¨æ„æ­¤é€‰é¡¹å°†æ›´æ”¹æºæ–‡ä»¶ã€‚
          cache: true
        }
      }
    ]
  }
}
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>eslint-loader</code> æ£€æŸ¥çš„æ˜¯æˆ‘ä»¬ç¼–å†™çš„æºç ï¼Œè€Œä¸æ˜¯ç»è¿‡ Babel è½¬è¯‘åçš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç¡®ä¿åœ¨è¢« Babel è½¬è¯‘ä¹‹å‰ä½¿ç”¨å®ƒã€‚</p>
<p>ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>ä¸¥æ ¼æŒ‰ç…§ä¸Šé¢ ğŸ‘† é…ç½®æ–‡ä»¶ä¸­ rules çš„é¡ºåºï¼Œ<code>eslint-loader</code> ä¸€å®šè¦æ”¾åœ¨ <code>babel-loader</code> åé¢ï¼Œå› ä¸º Loader çš„åŠ è½½é¡ºåºæ˜¯**â€œä»ä¸‹å¾€ä¸Šï¼ˆä»å³å¾€å·¦ï¼‰â€**ã€‚</li>
<li>å°† <code>eslint-loader</code> çš„ <a href="https://webpack.docschina.org/configuration/module/#ruleenforce">Rule.enforce</a> å±æ€§è®¾ç½®ä¸º <code>pre</code>ï¼Œä»¥å‰ç½®å¤„ç†ã€‚è¿™æ ·é…ç½®ç¼–å†™é¡ºåºå¯åœ¨ <code>babel-loader</code> æˆ–å‰æˆ–åäº†ã€‚ï¼ˆä¸ºäº†å®‰å…¨èµ·è§ï¼Œæ¨èè¿™ç§å†™æ³•ï¼‰</li>
</ol>
<p>æ¸©é¦¨æç¤ºï¼šå®˜æ–¹æŒ‡å‡º <a href="https://github.com/webpack-contrib/eslint-loader">eslint-loader</a> å·²å¼ƒç”¨ï¼Œè¢« <a href="https://github.com/webpack-contrib/eslint-webpack-plugin">eslint-webpack-plugin</a> å–ä»£ï¼Œåè€…è§£å†³äº†å‰è€…çš„ä¸€äº›å·²çŸ¥é—®é¢˜ã€‚ï¼ˆè‹¥ä½¿ç”¨æœ€æ–°ç‰ˆï¼Œå»ºè®®ç”¨åè€…ï¼‰</p>
</blockquote>
<h5>2. babel-eslint</h5>
<p>ä¸Šé¢è®²è¿° ESLint çš„æ—¶å€™ï¼Œæˆ‘ä½¿ç”¨çš„è§£æå™¨æ˜¯ <code>babel-eslint</code>ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ <code>Espree</code>ã€‚</p>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä½œä¸º ESLint çš„è§£æå™¨å‘¢ï¼Ÿ</p>
<blockquote>
<p>åŸå› æ˜¯è¿™æ ·çš„ï¼ŒESLint çš„é»˜è®¤è§£æå™¨å’Œæ ¸å¿ƒè§„åˆ™ä»…æ”¯æŒæœ€æ–°çš„ ECMAScript æ ‡å‡†ï¼Œä¸æ”¯æŒ Babel æä¾›çš„å®éªŒæ€§ï¼ˆä¾‹å¦‚æ–°åŠŸèƒ½ï¼‰å’Œéæ ‡å‡†ï¼ˆä¾‹å¦‚ Flow æˆ– TypeScript ç±»å‹ï¼‰è¯­æ³•ã€‚ <code>babel-eslint</code> æ˜¯å…è®¸ ESLint åœ¨ Babel è½¬æ¢åçš„æºä»£ç ä¸Šè¿è¡Œçš„è§£æå™¨ã€‚ æ³¨æ„ï¼šä»…åœ¨ä½¿ç”¨ Babel è½¬æ¢ä»£ç æ—¶æ‰éœ€è¦ä½¿ç”¨ <code>babel-eslint</code>ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œè¯·ä¸ºæ‚¨é€‰æ‹©çš„ ECMAScript é£æ ¼ä½¿ç”¨ç›¸å…³çš„è§£æå™¨ï¼ˆè¯·æ³¨æ„ï¼Œé»˜è®¤è§£æå™¨æ”¯æŒæ‰€æœ‰éå®éªŒè¯­æ³•ä»¥åŠ JSXï¼‰ã€‚ï¼ˆ<a href="https://github.com/babel/babel-eslint">eslint-babel å®˜æ–¹åŸè¯</a> ï¼‰</p>
<p>è€Œæœ¬é¡¹ç›®å°±æ˜¯ä½¿ç”¨äº† Babel å°†ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ° <code>babel-eslint</code>ã€‚</p>
<p>æ¸©é¦¨æç¤ºï¼š<a href="https://github.com/babel/babel-eslint">babel-eslint</a> å·²ç§»å…¥ <a href="https://github.com/babel/babel/tree/main/eslint/babel-eslint-parser">Babel monorepo</a>ï¼Œè‹¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬å¯ç›´æ¥å®‰è£… <a href="https://github.com/babel/babel/tree/main/eslint/babel-eslint-parser">@babel/eslint-parser</a> ä¾èµ–åŒ…ã€‚</p>
</blockquote>
<h3>ä¸ƒã€è‡³æ­¤</h3>
<p>å…³äº ESLint + Prettier çš„å†…å®¹åŸºæœ¬å°±ä»‹ç»å®Œäº†ï¼Œç¯‡å¹…æœ‰ç‚¹é•¿ã€‚</p>
<p>ä½†å…¶å®è¿™é‡Œåº”è¯¥è¦ç»“åˆ Git Hooks æ¥åšä¸€äº›ä»£ç æäº¤è§„èŒƒä¸æ£€æŸ¥çš„äº‹æƒ…ï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿æˆ‘ä»¬æäº¤çš„ä»£ç éƒ½æ˜¯ç»è¿‡ä»£ç è´¨é‡æ£€æŸ¥ä¸æ ¼å¼åŒ–çš„ã€‚</p>
<p>å› ä¸ºäººæ€»ä¼šæœ‰åœ¨æäº¤ä»£ç å‰å¿˜è®°è¿›è¡Œ Code Formatting çš„æ—¶å€™ï¼Œäººéåœ£è´¤ï¼Œå­°èƒ½æ— è¿‡ï¼Œè¡¨ç¤ºç†è§£ã€‚å‡å¦‚æˆ‘ä»¬è®¾äº†ä¸€ä¸ªâ€œå…³å¡â€ï¼Œåœ¨æ¯æ¬¡ <code>git commit</code> ä¹‹å‰éƒ½å¿…é¡»è‡ªåŠ¨å¯¹æš‚å­˜æ–‡ä»¶è¿›è¡Œæ£€æµ‹ï¼Œåªè¦æ£€æµ‹ä¸é€šè¿‡å°±ä¸å…è®¸æäº¤ä»£ç ï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆåœ°é˜²æ­¢è¿™ç§ç°è±¡äº†ã€‚</p>
<p>ä»¥ä¸Šè¿™ä¸ªåšæ³•ï¼Œå…¶å®åœ¨å¦ä¸€ç³»åˆ—æ–‡ç« ä»‹ç»è¿‡ï¼ˆ<a href="https://www.jianshu.com/p/5ab7b4b48964">ç‚¹å‡»æŸ¥çœ‹</a>ï¼‰ã€‚å½“ç„¶æœ¬é¡¹ç›®åç»­å¯¹è¿™å—å†…å®¹ä¹Ÿè¿˜ä¼šä»‹ç»çš„ï¼Œä½†ä¼šæ”¾åä¸€ç‚¹ï¼Œè¿™é‡Œç¯‡å¹…ä¹Ÿè¿‡é•¿äº†ï¼Œä¸å®œå†è¿°ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåäºŒï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/65</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/65</guid>
            <pubDate>Sat, 25 Feb 2023 11:47:01 GMT</pubDate>
            <description><![CDATA[<p>æ­¤å‰è®²è§£ react-routerã€reduxã€react-reduxã€redux-saga æ‰€æ¶‰åŠçš„å†…å®¹è¾ƒå¤šï¼Œç¯‡å¹…ä¹Ÿè¾ƒé•¿ã€‚ç»ˆäºå¯ä»¥ä»‹ç» HMR æ¨¡å—çƒ­æ›´æ–°ã€‚</p>
<p>å…¶å®æ­¤å‰å·²ç»ä»‹ç»è¿‡äº†ï¼Œä½†ä»Šå¤©å°±ç»“åˆ React æ­å»ºæ›´å‹å¥½çš„çƒ­æ›´æ–°æ•ˆæœã€‚</p>
<h3>ä¸€ã€HMR å®ç°</h3>
<p>æ­¤å‰æ˜¯æ€ä¹ˆåšçš„å‘¢]]></description>
            <content:encoded><![CDATA[<p>æ­¤å‰è®²è§£ react-routerã€reduxã€react-reduxã€redux-saga æ‰€æ¶‰åŠçš„å†…å®¹è¾ƒå¤šï¼Œç¯‡å¹…ä¹Ÿè¾ƒé•¿ã€‚ç»ˆäºå¯ä»¥ä»‹ç» HMR æ¨¡å—çƒ­æ›´æ–°ã€‚</p>
<p>å…¶å®æ­¤å‰å·²ç»ä»‹ç»è¿‡äº†ï¼Œä½†ä»Šå¤©å°±ç»“åˆ React æ­å»ºæ›´å‹å¥½çš„çƒ­æ›´æ–°æ•ˆæœã€‚</p>
<h3>ä¸€ã€HMR å®ç°</h3>
<p>æ­¤å‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>å½“ç„¶è¿™ç§æ–¹å¼æ˜¯æ²¡æœ‰é’ˆå¯¹ä½¿ç”¨ React åšä¼˜åŒ–å¤„ç†çš„ã€‚</p>
</blockquote>
<pre><code class="language-js">// webpack.config.js
modules.exports = {
  mode: 'develop',
  devServer: {
    // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å®Œå…¨å¯ç”¨ HMRï¼Œéœ€è¦ webpack.HotModuleReplacementPlugin
    hot: true
  },
  optimization: {
    // å‘ŠçŸ¥ webpack ä½¿ç”¨å¯è¯»å–æ¨¡å—æ ‡è¯†ç¬¦ï¼Œæ¥å¸®åŠ©æ›´å¥½åœ°è°ƒè¯•ã€‚å¼€å‘æ¨¡å¼é»˜è®¤å¼€å¯ã€‚ç®€å•æ¥è¯´ï¼Œå¼€å¯æ—¶ä½ çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„æ¨¡å—åç§°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°å­— idã€‚
    namedModules: true
  },
  plugins: [
    // é€šè¿‡å®ƒå¯ç”¨ HMRï¼Œé‚£ä¹ˆå®ƒçš„æ¥å£å°†è¢«æš´éœ²åœ¨ module.hot å±æ€§ä¸‹é¢ã€‚
    new webpack.HotModuleReplacementPlugin()
  ],
  module: {
    rules: [
      {
        // æ ·å¼çƒ­æ›´æ–°ï¼Œå€ŸåŠ©äº style-loaderï¼Œå…¶å®å¹•åä½¿ç”¨äº† module.hot.accept
        test: /\.css/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}
</code></pre>
<p>æˆ‘ä»¬è¿˜éœ€åœ¨å…¥å£æ–‡ä»¶æ·»åŠ  <code>module.hot.accpet()</code> æ–¹æ³•ã€‚</p>
<pre><code class="language-jsx">// index.js
import React from 'react'
import { render } from 'react-dom'
import '../styles/style.css'
import Root from './Root'

// æœ€ç®€å•çš„ React ç¤ºä¾‹
const rootElem = document.getElementById('app')
render(&lt;Root /&gt;, rootElem)

// é€šå¸¸ï¼Œå…ˆæ£€æŸ¥ HotModuleReplacementPlugin æš´éœ²çš„æ¥å£æ˜¯å¦å¯è®¿é—®ï¼Œç„¶åå†å¼€å§‹ä½¿ç”¨å®ƒã€‚
if (module.hot) {
  // accept æ–¹æ³•æ¥å—ç»™å®šçš„ä¾èµ–æ¨¡å—çš„æ›´æ–°ï¼Œå¹¶è§¦å‘ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¯¹è¿™äº›æ›´æ–°åšå‡ºå“åº”ã€‚
  module.hot.accept('./Root', () =&gt; {
    import('./Root.js').then(module =&gt; {
      const NextRoot = module.default
      render(&lt;NextRoot/&gt;, rootElem)
    })
  })
}
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
åŸå…ˆçš„ <s><code>new webpack.NameModulesPlugin()</code></s> åœ¨ webpack 4 ä¸­å·²åºŸå¼ƒï¼Œå–ä»£å®ƒçš„æ˜¯ <code>optimization.nameModules</code>ã€‚å¼€å‘æ¨¡å¼ä¸‹é»˜è®¤å¼€å¯ï¼Œç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œé»˜è®¤å…³é—­ã€‚å…³äºå¼€å¯ä¸ç¦ç”¨ï¼Œæœ€ç›´è§‚çš„åŒºåˆ«å¦‚ä¸‹å›¾ã€‚</p>
</blockquote>
<p>å°è¯•éšä¾¿ä¿®æ”¹ä¸€ä¸‹ Home ç»„ä»¶ï¼Œçœ‹åˆ°æ§åˆ¶å°çš„è¾“å‡ºï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œä¸¤è€…åŒºåˆ«ä¸åŒã€‚å¼€å¯æ—¶ï¼Œèƒ½çœ‹åˆ°å…·ä½“æ¶‰åŠæ›´æ–°çš„æ¨¡å—æœ‰å“ªäº›ï¼Œè€Œå…³é—­çŠ¶æ€åˆ™æ˜¯åªèƒ½çœ‹åˆ°ä¸€ä¸ªæ•°å­— idã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-4e4b45bc3f9290e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…³é—­çŠ¶æ€"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9b5a63d1cf3759cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¼€å¯çŠ¶æ€"></p>
<h3>äºŒã€HMR æ­é… React çš„ä¸è¶³</h3>
<p>ä¸Šé¢çš„æ–¹å¼ï¼Œå¦‚æœæ­é… React ä½¿ç”¨çš„è¯ï¼Œå…¶å®è¿˜ä¸å¤Ÿå‹å¥½ã€‚</p>
<blockquote>
<p>ç”¨ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­è¯´æ˜é—®é¢˜</p>
</blockquote>
<pre><code class="language-jsx">// ä¸€ä¸ªéå¸¸ç®€å•çš„æœ‰çŠ¶æ€ç»„ä»¶
import React, { Component } from 'react'

class HMRDemo extends Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0
    }
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h3&gt;HMR Demo Component!&lt;/h3&gt;
        &lt;h5&gt;è®¡æ•°å™¨ï¼š{this.state.count}&lt;/h5&gt;
        &lt;button onClick={() =&gt; { this.setState({ count: ++this.state.count }) }}&gt;add&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

export default HMRDemo
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œç„¶åç»„ä»¶çŠ¶æ€ <code>count</code> è‡ªç„¶å˜æˆäº† <code>1</code>ï¼Œè¿™ä¸ªæ²¡é—®é¢˜ã€‚æ¥ç€ï¼Œæˆ‘ä»¬éšæ„å¢åŠ ä¸€ä¸ªæ ‡ç­¾å…ƒç´ ï¼Œç„¶åé¡µé¢è‡ªç„¶ä¼šçƒ­æ›´æ–°ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>count</code> åˆå˜æˆäº† <code>0</code>ï¼Œç»„ä»¶çŠ¶æ€ä¸¢å¤±äº†ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-9dee05e9af81faa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬äº«å—ç€ HMR ç»™æˆ‘ä»¬å¼€å‘å¸¦æ¥çš„ä¾¿åˆ©ï¼Œä½†åŒæ—¶æˆ‘ä»¬åˆä¸æƒ³ä¸¢å¤± Component State ç»„ä»¶çŠ¶æ€ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<a href="https://github.com/gaearon/react-hot-loader">React Hot Loader</a> å‡ºç°äº†ã€‚</p>
<h3>ä¸‰ã€React Hot Loader</h3>
<p>å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹æŒ‡å—çš„ä¸€æ®µ<a href="https://github.com/gaearon/react-hot-loader">åŸè¯</a>ï¼š</p>
<blockquote>
<p><strong>React-Hot-Loader is expected to be replaced byÂ React Fast Refresh</strong>. Please remove React-Hot-Loader if Fast Refresh is currently supported on your environment.</p>
</blockquote>
<p>å¤§æ¦‚çš„æ„æ€æ˜¯ï¼Œreact-hot-loader å°†ä¼šè¢« <a href="https://github.com/facebook/react/issues/16604">React Fast Refresh</a> å–ä»£ã€‚å¦‚æœæ‚¨å½“å‰çš„ç¯å¢ƒæ”¯æŒçš„è¯ï¼Œè¯·ç§»é™¤ react-hot-loaderã€‚</p>
<p>*è‡³äº React Fast Refresh æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿè¿™é‡Œä¸å±•å¼€è¿°è¯´ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å…¶ä»–äººå†™çš„ä¸€ç¯‡<a href="https://segmentfault.com/a/1190000023534941">æ–‡ç« </a>ã€‚</p>
<p><strong>ç»§ç»­ä»‹ç» react-hot-loaderï¼Œè¿˜éœ€è¦åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®ã€‚</strong></p>
<ol>
<li>å®‰è£…ä¾èµ–åŒ…</li>
</ol>
<pre><code class="language-shell">$ yarn add --dev react-hot-loader@4.12.19
# ä¸‹é¢æ­¥éª¤ç”¨åˆ°
$ yarn add --dev @hot-loader@react-dom@16.12.0
</code></pre>
<blockquote>
<p><code>@hot-loader/react-dom</code> æ˜¯åœ¨ <code>react-dom</code> ç›¸åŒç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸€äº›æ”¯æŒçƒ­æ›´æ–°çš„è¡¥ä¸ã€‚æ‰€ä»¥éœ€è¦å®‰è£…ä¸ <code>react-dom</code> ä¸€è‡´çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
<ol start="2">
<li>æ·»åŠ  <code>react-hot-loader/babel</code> åˆ° <code>.babelrc</code> é…ç½®ä¸­ã€‚</li>
</ol>
<pre><code class="language-json5">// .babelrc
{
  &quot;plugins&quot;: [
    &quot;react-hot-loader/babel&quot;
  ]
}
</code></pre>
<ol start="3">
<li>å°†æ ¹ç»„ä»¶æ ‡è®°ä¸ºçƒ­å¯¼å‡ºï¼ˆ<strong>hot-exported</strong>ï¼‰</li>
</ol>
<pre><code class="language-jsx">import React from 'react'
import { Provider } from 'react-redux'
import { hot } from 'react-hot-loader/root'
import App from './pages/App'
import store from './store'

const Root = () =&gt; {
  return (
    &lt;Provider store={store}&gt;
      &lt;App /&gt;
    &lt;/Provider&gt;
  )
}

export default hot(Root)

// æ¸©é¦¨æç¤º
// å…³äºæ–° API ğŸ‘‰ hot æ˜¯ä½äº '/root' ä¸‹é¢çš„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ‰“åŒ…å·¥å…·éƒ½æ”¯æŒè¯¥æ–° APIã€‚æ¯”å¦‚ parcel å°±ä¸æ”¯æŒã€‚
// æ­¤æ—¶ react-hot-loader å°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¹¶è¦æ±‚ä½ ä½¿ç”¨æ—§çš„ APIï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
// 
// import { hot } from 'react-hot-loader'
// export default hot(module)(App)
</code></pre>
<ol start="4">
<li>ç¡®ä¿åœ¨  <code>react</code> å’Œ <code>react-dom</code> ä¹‹å‰å¯¼å…¥ <code>react-hot-loader</code>ï¼Œä¸¤ç§æ–¹å¼å¯é€‰æ‹©ï¼š</li>
</ol>
<ul>
<li>åœ¨å…¥å£æ–‡ä»¶å¯¼å…¥ <code>import react-hot-loader</code>ï¼ˆè¦åœ¨ React ä¹‹å‰ï¼‰</li>
<li>åœ¨ webpack é…ç½®æ–‡ä»¶çš„ <code>entry</code> é…ç½® <code>react-hot-loader/patch</code>ã€‚</li>
</ul>
<pre><code class="language-js">// webpack.config.js
{
  entry: [
    'react-hot-loader/patch',
    './src/js/index.js'
  ]
}
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<code>react-hot-loader/patch</code> ä¸€å®šè¦å†™åœ¨ <code>entry</code> çš„æœ€å‰é¢ã€‚å¦‚æœæœ‰ <code>babel-polyfill</code> å°±å†™åœ¨ <code>babel-polyfill</code> çš„åé¢ã€‚</p>
</blockquote>
<ol start="5">
<li>ä½¿ç”¨ React Hooks éœ€è¦ç”¨åˆ° <code>@hot-loader/react-dom</code>ã€‚åŒæ—¶ï¼Œå°±ä»¥ä¸Šé…ç½®é‡æ–°å¯åŠ¨ï¼Œæ­¤æ—¶æ§åˆ¶å°ä¼šæ‰“å°ä¸€ä¸ª WARNINGï¼Œå¦‚ä¸‹ï¼š</li>
</ol>
<blockquote>
<p>React-Hot-Loader: react-ğŸ”¥-dom patch is not detected. React 16.6+ features may not work. (<a href="https://github.com/gaearon/react-hot-loader/issues/1227">Issue #1227</a>ï¼‰</p>
</blockquote>
<p>è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œå¦ä¸€ç§å¯ä»¥çœ‹ä¸‹ <a href="https://github.com/gaearon/react-hot-loader/issues/1227">ISSUE #1227</a>ã€‚</p>
<pre><code class="language-js">// webpack.config.js
{
  resolve: {
    alias: {
      'react-dom': '@hot-loader/react-dom'
    }
  }
}
</code></pre>
<p>æµ‹è¯•ä¸€ä¸‹ï¼Œåˆ†åˆ«ä¸¤æ¬¡ç‚¹å‡» add åï¼Œå†æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ ï¼Œå‘ç° Component State æ˜¯åœ¨æˆ‘ä»¬é¢„æœŸä¹‹å†…çš„ï¼Œå¹¶æ²¡æœ‰åƒä¹‹å‰ä¸€æ ·å› ä¸ºçƒ­æ›´æ–°è€Œä¸¢å¤±çŠ¶æ€ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a054411625690610.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h3>å››ã€è‡³æ­¤</h3>
<p>å…³äº <strong>Hot Module Replacement</strong> æ¨¡å—çƒ­æ›¿æ¢ï¼ˆçƒ­æ›´æ–°ï¼‰åŸºæœ¬å°±ä»‹ç»å®Œäº†ã€‚</p>
<p>å‰é¢æˆ‘ä»¬æåˆ°ä¸€ä¸ª <a href="https://github.com/facebook/react/issues/16604">React Fast Refresh</a> æ¦‚å¿µï¼Œå®ƒç”±å®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šæ€§ä¸æ€§èƒ½æœ‰ä¿éšœï¼Œå¯¹ React Hooks æœ‰æ›´å®Œå–„çš„æ”¯æŒã€‚å®˜æ–¹å®ç°æ˜¯ <code>react-refresh</code>ã€‚</p>
<p>åé¢æœ‰æ—¶é—´çš„è¯ï¼Œåº”è¯¥ä¼šå†™ä¸€ç¯‡å…³äºå®ƒçš„æ–‡ç« ã€‚ä½†æ˜¯ï¼Œå®ƒæœ€ä½æ”¯æŒç‰ˆæœ¬æ˜¯ <code>react-dom@16.9+</code>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåä¸€ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/64</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/64</guid>
            <pubDate>Sat, 25 Feb 2023 11:44:40 GMT</pubDate>
            <description><![CDATA[<p>ä¹‹å‰æ–‡ç« æè¿‡ï¼ŒRedux æ˜¯ <a href="http://www.ruanyifeng.com/blog/2016/01/flux.html">Flux</a> æ¶æ„ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆçš„äº§ç‰©ã€‚</p>
<h3>ä¸€ã€Redux Flow</h3>
<p>Redux çš„æ•°æ®æµå¤§è‡´å¦‚ä¸‹ï¼š</p>
<blockquot]]></description>
            <content:encoded><![CDATA[<p>ä¹‹å‰æ–‡ç« æè¿‡ï¼ŒRedux æ˜¯ <a href="http://www.ruanyifeng.com/blog/2016/01/flux.html">Flux</a> æ¶æ„ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆçš„äº§ç‰©ã€‚</p>
<h3>ä¸€ã€Redux Flow</h3>
<p>Redux çš„æ•°æ®æµå¤§è‡´å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>UI Component</strong> â†’ <strong>Action</strong> â†’ <strong>Reducer</strong> â†’ <strong>State</strong> â†’ <strong>UI Component</strong></p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-06d050792f2be43c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Redux Flow"></p>
<p>ç”¨æˆ·è®¿é—®é¡µé¢ï¼Œç„¶åé€šè¿‡ <code>View</code> å‘å‡º <code>Action</code>ï¼ˆä¸€ä¸ªåŸå§‹çš„ JavaScript å¯¹è±¡ï¼‰ï¼Œç”± <code>Dispatcher</code> è¿›è¡Œæ´¾å‘ï¼Œ<code>Reducer</code>ï¼ˆä¸€ä¸ªçº¯å‡½æ•°ï¼‰æ¥æ”¶åˆ°åè¿›è¡Œå¤„ç†å¹¶è¿”å›çŠ¶æ€ <code>State</code>ï¼ˆå­˜å‚¨ <code>State</code> çš„å®¹å™¨å«åš <code>Store</code>ï¼‰ï¼Œç„¶åé€šçŸ¥ <code>View</code> æ›´æ–°é¡µé¢ã€‚</p>
<p>å¯¹äº<strong>åŒæ­¥ä¸”æ²¡æœ‰å‰¯ä½œç”¨</strong>çš„æ“ä½œï¼Œä¸Šè¿°æ•°æ®æµå¯ä»¥èµ·åˆ°ç®¡ç†æ•°æ®ï¼Œä»è€Œæ§åˆ¶è§†å›¾æ›´æ–°çš„ç›®çš„ã€‚</p>
<p><strong>é‚£ä¹ˆé‡åˆ°å«æœ‰å‰¯ä½œç”¨çš„æ“ä½œæ—¶ï¼ˆæ¯”å¦‚ Ajax å¼‚æ­¥è¯·æ±‚ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨ä¸­é—´ä»¶ã€‚</p>
<h3>äºŒã€ä¸­é—´ä»¶çš„æ¦‚å¿µ</h3>
<p>å¯¹äºä¸­é—´ä»¶æˆ–è€…å¼‚æ­¥æ“ä½œçš„æ€æƒ³ï¼Œæˆ‘ä¸å±•å¼€èµ˜è¿°ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆçš„è¿™ç¯‡<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html">ä¸­é—´ä»¶ä¸å¼‚æ­¥æ“ä½œ</a>çš„æ–‡ç« ã€‚æˆ‘å¯¹æ–‡ä¸­å†…å®¹æœ‰å¤šå°‘ç–‘æƒ‘ï¼Œä½†åˆä¸çŸ¥é“æ€ä¹ˆè¯´ï¼Œå¯èƒ½æ˜¯æˆ‘é€ è¯£ä¸å¤Ÿæ·±ã€‚</p>
<blockquote>
<p>æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼Œç±»ä¼¼ redux-thunkã€redux-promiseã€redux-saga ç­‰ä¸­é—´ä»¶æ˜¯å¸®åŠ©æˆ‘ä»¬åœ¨å¼‚æ­¥æ“ä½œç»“æŸåï¼Œä½¿å¾— Reducer è‡ªåŠ¨æ‰§è¡Œã€‚</p>
</blockquote>
<p>å…¶å®ä¸­é—´ä»¶çš„å®ç°æ˜¯å¯¹ <code>store.dispatch()</code> çš„æ”¹é€ ï¼Œåœ¨å‘å‡º <code>Action</code> å’Œæ‰§è¡Œ <code>Reducer</code> ä¹‹é—´ï¼Œæ·»åŠ äº†å…¶ä»–åŠŸèƒ½ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-jsx">let next = store.dispatch
store.dispatch = function dispatchAndLog(action) {
  console.log('dispatching', action)
  next(action)
  console.log('next state', store.getState())
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ï¼Œå¯¹ <code>store.dispatch()</code> è¿›è¡Œäº†é‡å®šä¹‰ï¼Œåœ¨å‘é€ <code>Action</code> å‰åæ·»åŠ äº†æ‰“å°åŠŸèƒ½ï¼Œè¿™å°±æ˜¯ä¸­é—´ä»¶çš„é›å½¢ã€‚</p>
<p>åŠ å…¥ä¸­é—´ä»¶åï¼ŒRedux çš„æ•°æ®æµå¤§è‡´å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b1758887e1637b9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Redux Flow With Middleware"></p>
<p>åœ¨å«å‰¯ä½œç”¨çš„ <code>Action</code> ä¸åŸå§‹ <code>Action</code> ä¹‹é—´å¢åŠ äº†ä¸­é—´ä»¶çš„å¤„ç†ã€‚å…¶ä¸­ä¸­é—´ä»¶çš„ä½œç”¨è½¬æ¢å¼‚æ­¥æ“ä½œï¼Œç”ŸæˆåŸå§‹çš„ <code>Action</code> å¯¹è±¡ï¼Œåé¢çš„æµç¨‹ä¸å˜ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œå…¶å®æˆ‘ä»¬å·²ç»ä½¿ç”¨åˆ°äº†ä¸­é—´ä»¶ï¼Œé‚£å°±æ˜¯ <code>redux-logger</code>ã€‚</p>
<h3>ä¸‰ã€redux-thunk</h3>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ redux-thunk çš„<a href="https://github.com/reduxjs/redux-thunk/blob/master/src/index.js">æºç </a>ã€‚</p>
<pre><code class="language-jsx">// redux-thunk æºç 
function createThunkMiddleware(extraArgument) {
  return ({ dispatch, getState }) =&gt; (next) =&gt; (action) =&gt; {
    if (typeof action === 'function') {
      return action(dispatch, getState, extraArgument);
    }

    return next(action);
  };
}

const thunk = createThunkMiddleware();
thunk.withExtraArgument = createThunkMiddleware;

export default thunk;
</code></pre>
<p>å¯¹å§ï¼Œçœ‹èµ·æ¥å¹¶ä¸éš¾ã€‚å½“ <code>action</code> ä¸ºå‡½æ•°æ—¶ï¼Œå°±è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªæ¡ˆä¾‹å§ã€‚</p>
<ol>
<li>å®‰è£… <code>redux-thunk</code>ã€‚</li>
</ol>
<pre><code class="language-shell">$ yarn add redux-thunk@2.3.0
</code></pre>
<ol start="2">
<li>è°ƒæ•´ <code>store/index.js</code>ï¼Œå¼•å…¥ <code>redux-thunk</code> ä¸­é—´ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬æš‚æ—¶æŠŠæ­¤å‰ <code>redux-saga</code> çš„é…ç½®æ³¨é‡Šæ‰ï¼Œå¹¶æ”¹æˆ <code>redux-thunk</code> é…ç½®ã€‚</li>
</ol>
<pre><code class="language-jsx">// src/js/store/index.js
import { createStore, applyMiddleware, compose } from 'redux'
import thunkMiddleware from 'redux-thunk'
import logger from 'redux-logger'
import reducers from '../reducers'

const initialState = { count: 0, status: 'offline' }
const composeEnhancers = (typeof window !== 'undefined' &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose
const store = createStore(reducers, initialState, composeEnhancers(applyMiddleware(thunkMiddleware, logger)))

export default store
</code></pre>
<ol start="3">
<li>æ–°å»ºä¸€ä¸ª <code>userHelper.js</code> æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ç”¨ <code>fetch</code> æˆ–è€… <code>XHR</code> æ¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>setTimeout</code> æ–¹æ³•æ¥å®ç°ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ç”¨æˆ·æ•°æ®çš„åœºæ™¯ã€‚</li>
</ol>
<pre><code class="language-jsx">// src/js/utils/userHelper.js
class UserHelper {
  // å»¶è¿Ÿå‡½æ•°
  delay(time) {
    return new Promise(resolve =&gt; setTimeout(resolve, time))
  }

  // è·å–æ•°æ®
  fetchData(status) {
    return new Promise((resolve, reject) =&gt; {
      const response = { status: 'success', response: { name: 'Frankie', age: 20 } }
      const error = { status: 'error', error: 'oops' }
      status ? resolve(response) : reject(error)
    })
  }

  // è¯·æ±‚ç”¨æˆ·æ•°æ®ï¼ˆå¼‚æ­¥åœºæ™¯ï¼‰
  async getUser(data) {
    try {
      const res = await this.fetchData(data)
      await this.delay(2000)
      return res
    } catch (e) {
      await this.delay(1000)
      throw e
    }
  }
}

export default new UserHelper()
</code></pre>
<ol start="4">
<li>æ–°å»ºä¸€ä¸ª <code>userActions.js</code>ï¼Œè¿™æ˜¯ <code>redux-thunk</code> çš„å…³é”®ã€‚</li>
</ol>
<pre><code class="language-jsx">// src/js/action/userActions.js
import userHelper from '../utils/userHelper'

export const getUser = (data, callback) =&gt; {
  return (dispatch, getState) =&gt; {
    dispatch({ type: 'FETCH_REQUEST', status: 'requesting' })
    userHelper.getUser(data).then(res =&gt; {
      dispatch({ type: 'FETCH_SUCCESS', ...res })
      callback &amp;&amp; callback(res)
    }).catch(err =&gt; {
      dispatch({ type: 'FETCH_FAILURE', ...err })
    })
  }
}
</code></pre>
<ol start="5">
<li>ä¿®æ”¹ <code>About</code> ç»„ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼ ç»™ <code>store.dispatch()</code> çš„ä¸æ˜¯ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼ˆ<code>plain object</code>ï¼‰ï¼Œè€Œæ˜¯ <code>getUser</code> å‡½æ•°ã€‚è¿™å°±æ˜¯ <code>redux-thunk</code> çš„ç‰¹ç‚¹ï¼Œå®ƒå¯è®© <code>store.dispatch()</code> æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°å«åš <code>Action Creator</code>ã€‚</li>
</ol>
<pre><code class="language-jsx">// src/js/pages/about/index.js
import React, { Component } from 'react'
import { connect } from 'react-redux'
import { getUser } from '../../actions/userActions'

class About extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h3&gt;About Componentï¼&lt;/h3&gt;
        &lt;h5&gt;Get User: {this.props.user.status || ''}&lt;/h5&gt;
        {/* æˆ‘ä»¬å‘ç°è¿™é‡Œå¹¶ä¸æ˜¯ä¼ äº†ä¸€ä¸ªæ ‡å‡†çš„ Action å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•° */}
        &lt;button onClick={() =&gt; { this.props.dispatch(getUser(false)) }}&gt;Get User Fail&lt;/button&gt;
        &lt;button onClick={() =&gt; { this.props.dispatch(getUser(true)) }}&gt;Get User Success&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

const mapStateToProps = state =&gt; {
  return { user: state.user }
}

export default connect(mapStateToProps)(About)
</code></pre>
<p>æˆ‘ä»¬ç‚¹å‡» <strong>Get User Success</strong> æŒ‰é’®ï¼Œå³å¯çœ‹åˆ°å¦‚ä¸‹æ•ˆæœã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-d555bf0f8508c189.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h5>redux-thunk çš„ç¼ºç‚¹</h5>
<p>æ ¹æ®æºç æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒä»…ä»…å¸®æˆ‘ä»¬æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸åœ¨ä¹å‡½æ•°ä¸»ä½“å†…éƒ¨æ˜¯ä»€ä¹ˆã€‚å®é™…æƒ…å†µä¸‹ï¼Œå®ƒè¿™ä¸ªå‡½æ•°å¯èƒ½è¦å¤æ‚å¾—å¾ˆå¤šã€‚å†è€…ï¼Œå¦‚æœæ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½éœ€è¦å¦‚æ­¤å®šä¹‰ä¸€ä¸ª <code>Action Creator</code>ï¼Œæ˜¾ç„¶å®ƒæ˜¯ä¸æ˜“ç»´æŠ¤çš„ã€‚</p>
<ul>
<li><code>Action</code> çš„å½¢å¼ä¸ç»Ÿä¸€</li>
<li>å¼‚æ­¥æ“ä½œå¤ªåˆ†æ•£ï¼Œåˆ†æ•£åœ¨å„ä¸ª <code>Action</code> å½“ä¸­</li>
</ul>
<p>æ‰€ä»¥æœ¬é¡¹ç›®å°†ä¸ä¼šä½¿ç”¨å®ƒï¼Œåªæ˜¯å› ä¸º <code>redux-thunk</code> åœ¨ä¹‹å‰åšé¡¹ç›®çš„æ—¶å€™ç”¨è¿‡ï¼Œå°±æ‹¿å‡ºæ¥è®²ä¸€ä¸‹ã€‚</p>
<h3>å››ã€redux-saga</h3>
<blockquote>
<p>å…³äºæ¥ä¸‹æ¥ redux-saga éƒ¨åˆ†çš„å†…å®¹ï¼Œæˆ‘è®¤ä¸ºæˆ‘å¯èƒ½è®²è§£å¾—ä¸å¤ªå¥½ï¼Œå»ºè®®çœ‹æ–‡ç« æœ€åçš„é“¾æ¥ã€‚</p>
</blockquote>
<p><code>redux-saga</code> æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¼‚æ­¥æ“ä½œçš„ä¸­é—´ä»¶ã€‚å®ƒé€šè¿‡åˆ›å»º Saga å°†æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œé€»è¾‘æ”¶é›†åœ¨ä¸€ä¸ªåœ°æ–¹é›†ä¸­å¤„ç†ï¼ŒSaga è´Ÿè´£åè°ƒé‚£äº›å¤æ‚æˆ–å¼‚æ­¥çš„æ“ä½œï¼ŒReducer è¿˜æ˜¯è´Ÿè´£å¤„ç† Action å’Œ State çš„æ›´æ–°ã€‚</p>
<p>Saga æ˜¯é€šè¿‡ <code>Generator</code> å‡½æ•°åˆ›å»ºçš„ï¼Œå¦‚æœè¿˜ä¸å¤ªç†Ÿæ‚‰ <code>Generator</code> å‡½æ•°ï¼Œè¯·çœ‹é˜®ä¸€å³°è€å¸ˆçš„ ES6 å…¥é—¨æ•™ç¨‹ä¸­å¯¹ <a href="https://es6.ruanyifeng.com/#docs/generator">Generator å‡½æ•°</a>çš„ä»‹ç»ã€‚</p>
<p>Saga ä¸åŒäº Thunkï¼ŒThunk æ˜¯åœ¨ Action è¢«åˆ›å»ºæ—¶è°ƒç”¨ï¼Œè€Œ Saga åªä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼ˆä½†åˆå§‹å¯åŠ¨çš„ Saga å¯èƒ½ä¼šåŠ¨æ€è°ƒç”¨å…¶ä»– Sagaï¼‰ï¼ŒSaga å¯ä»¥è¢«çœ‹ä½œæ˜¯åœ¨åå°è¿è¡Œçš„è¿›ç¨‹ï¼ŒSaga ç›‘å¬å‘èµ·çš„ Actionï¼Œç„¶åå†³å®šåŸºäºè¿™ä¸ª Action æ¥åšä»€ä¹ˆï¼šæ˜¯å‘èµ·ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ï¼ˆå¦‚ fetch è¯·æ±‚ï¼‰ï¼Œè¿˜æ˜¯å‘èµ·å…¶ä»–çš„ Actionï¼Œç”šè‡³æ˜¯è°ƒç”¨å…¶ä»–çš„ Sagaã€‚</p>
<p>åœ¨ <code>redux-saga</code> çš„ä¸–ç•Œé‡Œï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½é€šè¿‡ <code>yield Effects</code>  æ¥å®Œæˆï¼ˆ<code>Effect</code> å¯ä»¥çœ‹ä½œæ˜¯ <code>redux-saga</code> çš„ä»»åŠ¡å•å…ƒï¼‰ã€‚<code>Effects</code> æ˜¯ç®€å•çš„ JavaScript å¯¹è±¡ï¼ŒåŒ…å«äº†è¦è¢« Saga middleware æ‰§è¡Œçš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼Œæˆ‘ä»¬ Redux Action å…¶å®æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰§è¡Œä¿¡æ¯ï¼ˆ<code>{ type, ... }</code>ï¼‰çš„åŸå§‹çš„ JavaScript å¯¹è±¡ ï¼‰ï¼Œ<code>redux-saga</code> ä¸ºå„é¡¹ä»»åŠ¡æä¾›äº†å„ç§ <code>Effect</code> åˆ›å»ºå™¨ï¼Œæ¯”å¦‚è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå‘èµ·ä¸€ä¸ª Action åˆ° Storeï¼Œå¯åŠ¨ä¸€ä¸ªåå°ä»»åŠ¡æˆ–è€…ç­‰å¾…ä¸€ä¸ªæ»¡è¶³æŸäº›æ¡ä»¶çš„æœªæ¥çš„ Actionã€‚</p>
<h5>redux-saga æ ¸å¿ƒ API</h5>
<h5>1. Saga è¾…åŠ©å‡½æ•°</h5>
<p>redux-saga æä¾›äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œç”¨æ¥åœ¨ä¸€äº›ç‰¹å®šçš„ Action è¢«å‘èµ·åˆ° Store æ—¶æ´¾ç”Ÿä»»åŠ¡ï¼Œä¸‹é¢å…ˆè®²è§£ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ï¼š<code>takeEvery</code> å’Œ <code>takeLatest</code>ã€‚</p>
<ul>
<li>takeEvery
ä¾‹å¦‚ï¼šæ¯æ¬¡ç‚¹å‡» Fetch æŒ‰é’®æ˜¯ï¼Œæˆ‘ä»¬å‘èµ·ä¸€ä¸ª <code>FETCH_REQUESTED</code> çš„ Actionã€‚æˆ‘ä»¬æƒ³é€šè¿‡å¯åŠ¨ä¸€ä¸ªä»»åŠ¡ä»æœåŠ¡å™¨è·å–ä¸€äº›æ•°æ®æ¥å¤„ç†è¿™ä¸ª Actionã€‚</li>
</ul>
<pre><code class="language-jsx">// src/
import { call, put, takeEvery } from 'redux-saga/effects'
import userHelper from '../utils/userHelper'

// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡
function* fetchData(action) {
  try {
    // call([context, fnName], ...args)
    const data = yield call([userHelper, userHelper.getUser], action.flag)
    yield put({ type: 'FETCH_SUCCESS', ...data })
  } catch (e) {
    yield put({ type: 'FETCH_FAILURE', ...e })
  }
}

// æ¯æ¬¡ FETCH_REQUESTED Action è¢«å‘èµ·æ—¶å¯åŠ¨ä¸Šé¢çš„ä»»åŠ¡
export function* watchFetchData(a) {
  yield takeEvery('FETCH_REQUEST', fetchData)

  // ç­‰åŒäº
  // while (true) {
  //   const action = yield take('FETCH_REQUEST')
  //   yield fork(fetchData, action)
  // }
}
</code></pre>
<ul>
<li>takeLatest
åœ¨ä¸Šé¢çš„ä¾‹å­ï¼ŒtakeEvery å…è®¸å¤šä¸ª fetchData å®ä¾‹åŒæ—¶å¯åŠ¨ï¼Œåœ¨æŸä¸ªç‰¹å®šçš„æ—¶åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨æ–°çš„ fetchData ä»»åŠ¡ï¼Œå°½ç®¡æ­¤å‰è¿˜æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª fetchData å°šæœªç»“æŸã€‚<br>
å¦‚æœåªæƒ³å¾—åˆ°æœ€æ–°çš„é‚£ä¸ªè¯·æ±‚çš„å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ takeLatest è¾…åŠ©å‡½æ•°<br>
å’Œ takeEvery ä¸åŒçš„æ˜¯ï¼Œåœ¨ä»»ä½•æ—¶åˆ» takeLatest åªå…è®¸ä¸€ä¸ª fetchData ä»»åŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªä»»åŠ¡æ—¶æœ€åè¢«å¯åŠ¨çš„é‚£ä¸ªã€‚å¦‚æœæ­¤å‰å·²ç»æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆæ­¤å‰è¿™ä¸ªä»»åŠ¡ä¼šè‡ªåŠ¨è¢«å–æ¶ˆã€‚</li>
</ul>
<pre><code class="language-jsx">import { takeLatest } from 'redux-saga/effects'

export function* watchFetchData(a) {
  yield takeLatest('FETCH_REQUEST', fetchData)
}
</code></pre>
<h5>2. Effect åˆ›å»ºå™¨</h5>
<p>Saga æ˜¯ç”±ä¸€ä¸ªä¸ªçš„ effect ç»„æˆçš„ï¼Œé‚£ä¹ˆ effect æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>redux-saga å®˜ç½‘çš„è§£é‡Šï¼šä¸€ä¸ª effect å°±æ˜¯ä¸€ä¸ª Plain Object JavaScript å¯¹è±¡ï¼ŒåŒ…å«ä¸€äº›å°†è¢« saga middleware æ‰§è¡Œçš„æŒ‡ä»¤ã€‚redux-saga æä¾›äº†å¾ˆå¤š effect åˆ›å»ºå™¨ï¼Œå¦‚ <code>call</code>ã€<code>put</code>ã€<code>take</code> ç­‰ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ <code>call</code>ï¼š</p>
<pre><code class="language-jsx">import { call } from 'redux-saga/effects'

function* fetchData() {
  yield call(fetch)
}
</code></pre>
<p><code>call(userHelper.getUser)</code> ç”Ÿæˆçš„å°±æ˜¯ä¸€ä¸ª effectï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">{
  isEffect: true,
  type: 'CALL',
  fn: fetch
}
</code></pre>
<p>å¸¸ç”¨çš„ effect æœ‰ï¼š</p>
<ul>
<li>
<p><a href="https://redux-saga-in-chinese.js.org/docs/api/#takepattern">take(pattern)</a></p>
</li>
<li>
<p><a href="https://redux-saga-in-chinese.js.org/docs/api/#putaction">put(action)</a></p>
</li>
<li>
<p><a href="https://redux-saga-in-chinese.js.org/docs/api/#callfn-args">call(fn, ...args)</a></p>
</li>
<li>
<p><a href="https://redux-saga-in-chinese.js.org/docs/api/#forkfn-args">fork(fn, ...args)</a></p>
</li>
<li>
<p><a href="https://redux-saga-in-chinese.js.org/docs/api/#selectselector-args">select(selector, ...args)</a></p>
</li>
</ul>
<h3>3. å¸¸ç”¨ Effect æ–¹æ³•</h3>
<h5>ï¼ˆ1ï¼‰take</h5>
<blockquote>
<p><strong>take</strong> è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ç›‘å¬æœªæ¥çš„ Actionï¼Œå®ƒåˆ›å»ºä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œå‘Šè¯‰ Middleware ç­‰å¾…ä¸€ä¸ªç‰¹å®šçš„ Actionï¼ŒGenerator å‡½æ•°ä¼šæš‚åœï¼Œç›´åˆ°ä¸€ä¸ªä¸ pattern åŒ¹é…çš„ action è¢«å‘èµ·ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œtake æ˜¯ä¸€ä¸ªé˜»å¡çš„ effectã€‚</p>
</blockquote>
<pre><code class="language-jsx">export function* watchFetchData(a) {
  while (true) {
    // ç›‘å¬ä¸€ä¸ª type ä¸º 'FETCH_REQUEST' çš„ Action çš„æ‰§è¡Œï¼Œç›´åˆ°è¿™ä¸ª Actionè¢«è§¦å‘ï¼Œ
    // æ‰ä¼šæ‰§è¡Œä¸‹é¢çš„ yield fork(fetchData) è¯­å¥ã€‚
    yield take('FETCH_REQUEST')
    yield fork(fetchData)
  }
}
</code></pre>
<h5>ï¼ˆ2ï¼‰put</h5>
<blockquote>
<p>å®ƒæ˜¯ç”¨æ¥å‘é€ Action çš„ effectï¼Œä½ å¯ä»¥ç®€å•åœ°ç†è§£æˆ redux æ¡†æ¶ä¸­çš„ dispatch å‡½æ•°ã€‚å½“ put ä¸€ä¸ª Action åï¼Œreducer å°±ä¼šè®¡ç®—æ–°çš„ state å¹¶è¿”å›ã€‚put ä¹Ÿæ˜¯é˜»å¡çš„ effectã€‚</p>
</blockquote>
<p>ç»“åˆ take å’Œ put æ–¹æ³•ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-jsx">// *********************** è¾…åŠ©ç†è§£ ***********************

// åœ¨ redux ä¸­ï¼Œæˆ‘ä»¬å‘èµ·è¿™æ ·ä¸€ä¸ª Action
const fetchAction = { type: 'FETCH_REQUEST' }
store.dispatch(fetchAction)

// ä½¿ç”¨ Saga å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ
// éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»¥ä¸‹ Saga æ–¹æ³•å®ç°ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´å¯æ‰§è¡Œçš„é€»è¾‘ï¼Œä»…ç”¨ä»¥ä¸¾ä¾‹è¯´æ˜ï¼Œè¾…åŠ©ç†è§£è€Œå·²ã€‚
//
// 1. é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬å¯åŠ¨ Saga æ—¶ï¼Œä½¿ç”¨ take æ¥ç›‘å¬ type ä¸º 'FETCH_REQUEST' çš„ Action
const fetchAction = yield take('FETCH_REQUEST')
// 2. ä» UI å‘ Saga ä¸­é—´ä»¶ä¼ é€’ä¸€ä¸ª Action
this.props.dispatch({ type: 'FETCH_REQUEST' })
// 3. æ­¤æ—¶æˆ‘ä»¬çš„ Saga ç›‘å¬åˆ° 'FETCH_REQUEST'ï¼Œæ¥ç€å¼€å§‹æ‰§è¡Œ take('FETCH_REQUEST') åé¢çš„é€»è¾‘
yield put(fetchAction)
// 4. put æ–¹æ³•ï¼Œå¯ä»¥å‘å‡º Actionï¼Œä¸”å‘å‡ºçš„ Action ä¼šè¢« Reducer ç›‘å¬åˆ°ã€‚ä»è€Œè¿”å›ä¸€ä¸ªæ–°çŠ¶æ€
</code></pre>
<h5>ï¼ˆ3ï¼‰call/apply</h5>
<pre><code class="language-jsx">call(fn, ...args)

// æ”¯æŒä¼ é€’ this ä¸Šä¸‹æ–‡ç»™ fnã€‚åœ¨è°ƒç”¨å¯¹è±¡æ–¹æ³•æ—¶å¾ˆæœ‰ç”¨ã€‚
call([context, fn], ...args)

// æ”¯æŒç”¨å­—ç¬¦ä¸²ä¼ é€’ fnã€‚åœ¨è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•æ—¶å¾ˆæœ‰ç”¨ã€‚
// ä¾‹å¦‚ yield call([localStorage, 'getItem'], 'redux-saga')ã€‚
call([context, fnName], ...args)

// call([context, fn], ...args) çš„å¦ä¸€ç§å†™æ³•
apply(context, fn, [args])
</code></pre>
<blockquote>
<p>è¯­æ³•ä¸ JS ä¸­çš„ call/apply ç›¸ä¼¼ã€‚</p>
<p>å¯ä»¥æŠŠå®ƒç®€å•çš„ç†è§£ä¸ºè°ƒç”¨å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œå®ƒå‘½ä»¤ middleware ä»¥å‚æ•° <code>args</code> æ¥è°ƒç”¨ <code>fn</code> å‡½æ•°ã€‚</p>
<p>æ³¨æ„ï¼š <code>fn</code> æ—¢å¯ä»¥æ˜¯ä¸€ä¸ª <strong>Generator å‡½æ•°</strong>, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å› Promise æˆ–ä»»æ„å…¶å®ƒå€¼çš„<strong>æ™®é€šå‡½æ•°</strong>ã€‚</p>
<p>è¿˜æœ‰ï¼Œcall æ˜¯é˜»å¡çš„ effectã€‚</p>
</blockquote>
<h5>ï¼ˆ4ï¼‰fork</h5>
<pre><code class="language-jsx">fork(fn, ...args)
</code></pre>
<blockquote>
<p>fork ç±»ä¼¼äº callï¼Œå¯ä»¥ç”¨æ¥è°ƒç”¨æ™®é€šå‡½æ•°å’Œ Generator å‡½æ•°ã€‚ä¸è¿‡ï¼Œfork çš„è°ƒç”¨æ˜¯éé˜»å¡çš„ï¼ŒGenerator ä¸ä¼šåœ¨ç­‰å¾… <code>fn</code> è¿”å›ç»“æœçš„æ—¶å€™è¢« middleware æš‚åœï¼›æ°æ°ç›¸ååœ°ï¼Œå®ƒåœ¨ <code>fn</code> è¢«è°ƒç”¨æ—¶ä¾¿ä¼šç«‹å³æ¢å¤æ‰§è¡Œã€‚</p>
</blockquote>
<h5>ï¼ˆ5ï¼‰select</h5>
<pre><code class="language-jsx">select(selector, ...args)

// å¦‚æœ select çš„å‚æ•°ä¸ºç©ºä¼šå–å¾—å®Œæ•´çš„ stateï¼ˆä¸è°ƒç”¨ getState() çš„ç»“æœç›¸åŒï¼‰
// yield select()

// è¿”å› state çš„ä¸€éƒ¨åˆ†æ•°æ®å¯ä»¥è¿™æ ·è·å–
// yield select(state =&gt; state.user)
</code></pre>
<blockquote>
<p>select å‡½æ•°æ˜¯ç”¨æ¥æŒ‡ç¤º middleware è°ƒç”¨æä¾›çš„é€‰æ‹©å™¨è·å– Store ä¸Šçš„ state æ•°æ®ã€‚ä½ ä¹Ÿå¯ä»¥ç®€å•çš„æŠŠå®ƒç†è§£ä¸º redux æ¡†æ¶ä¸­è·å– store ä¸Šçš„ state æ•°æ®ä¸€æ ·çš„åŠŸèƒ½ï¼ˆ<code>store.getState()</code>ï¼‰</p>
</blockquote>
<h5>4. Middleware API</h5>
<ul>
<li>
<p>createSagaMiddleware()
åˆ›å»ºä¸€ä¸ª Redux middlewareï¼Œå¹¶å°† Sagas è¿æ¥åˆ° Redux Storeã€‚</p>
</li>
<li>
<p>middleware.run(saga, ...args)
åŠ¨æ€åœ°è¿è¡Œ <code>saga</code>ï¼Œåªèƒ½ç”¨äºåœ¨ <code>applyMiddleware</code> é˜¶æ®µä¹‹åæ‰§è¡Œ Sagaã€‚<br>
<code>sagas</code> ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½å¿…é¡»è¿”å›ä¸€ä¸ª Generator å¯¹è±¡ï¼Œmiddleware ä¼šè¿­ä»£è¿™ä¸ª Generator å¹¶æ‰§è¡Œæ‰€æœ‰ yield åçš„ Effectã€‚ï¼ˆEffect å¯ä»¥çœ‹ä½œæ˜¯ redux-saga çš„ä»»åŠ¡å•å…ƒï¼‰</p>
</li>
</ul>
<h3>äº”ã€Saga æ¡ˆä¾‹å®ç°</h3>
<p>ä¸‹é¢å†™ä¸€ä¸ªå¤„ç† Fetch è¯·æ±‚çš„å¼‚æ­¥å¤„ç†åœºæ™¯ã€‚</p>
<p>é¦–å…ˆï¼Œå®ç° Saga å¤„ç†åœºæ™¯ï¼š</p>
<pre><code class="language-jsx">import { call, fork, put, select, take, delay, race, takeEvery, takeLatest } from 'redux-saga/effects'

// fetch è¯·æ±‚
function fetch() {
  return new Promise((resolve, reject) =&gt; {
    window
      .fetch('http://192.168.1.124:7701/config')
      .then(response =&gt; response.json())
      .then(res =&gt; {
        // è¯·æ±‚æˆåŠŸï¼Œè¿”å›ä¸€ä¸ª JSON æ•°æ®ï¼š{&quot;name&quot;:&quot;Frankie&quot;,&quot;age&quot;:20}
        resolve(res)
      })
      .catch(err =&gt; {
        reject(err)
      })
  })
}

// saga å¤„ç†å¼‚æ­¥åœºæ™¯
function* fetchData() {
  try {
    // race ä¸ Promise.race ç±»ä¼¼ï¼Œè¿™é‡Œåšä¸€ä¸ªè¶…æ—¶å¤„ç†
    const { result, timeout } = yield race({
      result: call(fetch),
      timeout: delay(30000)
    })
    if (timeout) throw new Error('è¯·æ±‚è¶…æ—¶ï¼')
    yield put({ type: 'FETCH_SUCCESS', ...result })
  } catch (e) {
    console.warn(e)
    yield put({ type: 'FETCH_FAILURE', status: 'error', error: 'oops' })
  }
}

export function* watchFetchData() {
  // æ¯æ¬¡ Saga ç›‘å¬åˆ° 'FETCH_REQUEST' ç±»å‹çš„ Actionï¼Œéƒ½ä¼šè§¦å‘ fetchData å‡½æ•°
  yield takeEvery('FETCH_REQUEST', fetchData)
}
</code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ UI ä¸­æ´¾å‘ä¸€ä¸ª <code>FETCH_REQUEST </code> çš„ Actionï¼Œç„¶å Saga ç›‘å¬åˆ°ä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ <code>fetchData</code> çš„é€»è¾‘äº†ã€‚</p>
<pre><code class="language-html">&lt;div&gt;
  &lt;h3&gt;About Componentï¼&lt;/h3&gt;
  &lt;h5&gt;Get User: {this.props.user.name || ''}&lt;/h5&gt;
  &lt;button onClick={() =&gt; { this.props.dispatch({ type: 'FETCH_REQUEST', status: 'requesting' }) }}&gt;Fetch Data&lt;/button&gt;
&lt;/div&gt;
</code></pre>
<p>çœ‹ç»“æœï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-0ee0f987918d5f89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h3>è‡³æ­¤</h3>
<p>Redux + Middleware åŸºæœ¬çš„å·²ç»ä»‹ç»å®Œäº†ï¼Œä½†æˆ‘ä¸è®¤ä¸ºæˆ‘è®²å¥½äº†ã€‚å»ºè®®å¤§å®¶çœ‹çœ‹ä»¥ä¸‹å‡ ç¯‡æ–‡ç« æ¥åŠ æ·±ç†è§£ã€‚</p>
<p>è¿˜æœ‰ Redux æ­é…ä¸­é—´ä»¶çš„æˆ‘è®¤ä¸ºè¦å­¦ä¹ çš„ API å¾ˆå¤šï¼Œæœ‰ç‚¹è´¹åŠ²ã€‚æœ‰ç©ºçœ‹ä¸‹å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šğŸ‘‰ <a href="https://cn.mobx.js.org/">MobX</a></p>
<p>æ¥ä¸‹æ¥ç»ˆäºå¯ä»¥ä»‹ç» react-hot-loader çƒ­æ›´æ–°äº†ï¼Œå…³äº react-routerã€reduxã€react-reduxã€redux-saga ç­‰å†…å®¹èŠ±äº†å¥½å¤šç¯‡å¹…ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://redux-saga-in-chinese.js.org/">redux-saga ä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://github.com/forthealllight/blog/issues/14">å½»å½»åº•åº•æ•™ä¼šä½ ä½¿ç”¨ Redux-saga</a></li>
<li><a href="https://www.cnblogs.com/guangqiang/p/9602085.html">redux-saga æ¡†æ¶ä½¿ç”¨è¯¦è§£åŠ Demo æ•™ç¨‹</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆåï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/63</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/63</guid>
            <pubDate>Sat, 25 Feb 2023 11:43:15 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç» Reducer çš„æ‹†åˆ†ã€‚</p>
<p>Reducer å‡½æ•°è´Ÿè´£ç”Ÿæˆ Stateã€‚ä½†ç”±äºæ•´ä¸ª Web åº”ç”¨åªæœ‰ä¸€ä¸ª State å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ª State å¿…ç„¶ååˆ†åºå¤§ï¼Œå¯¼è‡´ Reducer å‡½æ•°ä¹Ÿååˆ†åºå¤§ã€‚</p>
<blockquote>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç»™è‡ªå·±åŠ ä¸ªéœ€æ±‚]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡å°†ä»‹ç» Reducer çš„æ‹†åˆ†ã€‚</p>
<p>Reducer å‡½æ•°è´Ÿè´£ç”Ÿæˆ Stateã€‚ä½†ç”±äºæ•´ä¸ª Web åº”ç”¨åªæœ‰ä¸€ä¸ª State å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ª State å¿…ç„¶ååˆ†åºå¤§ï¼Œå¯¼è‡´ Reducer å‡½æ•°ä¹Ÿååˆ†åºå¤§ã€‚</p>
<blockquote>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç»™è‡ªå·±åŠ ä¸ªéœ€æ±‚ï¼Œæ¥è®²è¿° Reducer çš„æ‹†åˆ†ã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œåœ¨åŸæœ‰ state åªå­˜å‚¨ count è®¡æ•°çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ª status æ¥å­˜å‚¨ç™»å½•çŠ¶æ€ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fd6dc9fa21e1d723.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åªè¦åœ¨åŸæœ‰åŸºç¡€ä¸Šåšç®€å•ä¿®æ”¹ï¼Œå³å¯æ»¡è¶³éœ€æ±‚ï¼Œä½†æˆ‘ä»¬çš„ç›®çš„ä¸åœ¨æ­¤ã€‚</p>
<ol>
<li>åœ¨ <code>reducer</code> å‡½æ•°ä¸Šå¢åŠ å¯¹ <code>LOGIN_IN</code>ã€<code>LOGIN_OUT</code> çš„å¤„ç†ï¼š</li>
</ol>
<pre><code class="language-jsx">// reducers/index.js
const reducer = (prevState, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      return { ...prevState, count: prevState.count + payload }
    case 'SUB':
      return { ...prevState, count: prevState.count - payload }
    case 'LOGIN_IN':
      return { ...prevState, status: 'online' }
    case 'LOGIN_OUT':
      return { ...prevState, status: 'offline' }
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›æ—§çš„ state
      return prevState
  }
}

export default reducer
</code></pre>
<ol start="2">
<li>åœ¨ <code>Home</code> ç»„ä»¶ä¸Šï¼Œå¢åŠ ä¸€ä¸ª <code>dispatch</code> åˆ†å‘ <code>Action</code>çš„åŠ¨ä½œã€‚</li>
</ol>
<pre><code class="language-jsx">import React, { Component } from 'react'
import { connect } from 'react-redux';
import store from '../../store'

class Home extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  handle(type, val) {
    this.props.simpleDispatch(type, val)
    // è·å– State å¿«ç…§
    console.log(`å½“å‰æ“ä½œæ˜¯ ${type}ï¼Œcount ä¸ºï¼š${store.getState().count}`)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h3&gt;Home Component!&lt;/h3&gt;
        {/* å°† state å±•ç¤ºåˆ°é¡µé¢ä¸Š */}
        &lt;h5&gt;countï¼š{this.props.count}&lt;/h5&gt;
        &lt;button onClick={this.handle.bind(this, 'ADD', 1)}&gt;åŠ ä¸€&lt;/button&gt;
        &lt;button onClick={this.handle.bind(this, 'SUB', 1)}&gt;å‡ä¸€&lt;/button&gt;
        &lt;h5&gt;statusï¼š{this.props.status}&lt;/h5&gt;
        &lt;button onClick={() =&gt; {this.props.toggleStatus('LOGIN_IN')}}&gt;Login in&lt;/button&gt;
        &lt;button onClick={() =&gt; {this.props.toggleStatus('LOGIN_OUT')}}&gt;Login out&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

const mapStateToProps = (state, ownProps) =&gt; {
  return {
    count: state.count,
    status: state.status
  }
}

const mapDispatchToProps = (dispatch, ownProps) =&gt; {
  return {
    simpleDispatch: (type, payload) =&gt; {
      dispatch({ type, payload })
    },
    toggleStatus: type =&gt; {
      dispatch({ type })
    }
  }
}

export default connect(mapStateToProps, mapDispatchToProps)(Home)
</code></pre>
<p>å¦‚æœå¯¹æ­¤å‰çš„æ–‡ç« ä»‹ç»çš„å†…å®¹å·²ç»æŒæ¡äº†çš„è¯ï¼Œè¿™äº›å·²ç»æ˜¯è½»è€Œæ˜“ä¸¾çš„äº†ã€‚</p>
<p><strong>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œä¸Šé¢çš„ reducer å‡½æ•°å¤¹æ‚ç€å¯¹ countã€status çš„å¤„ç†ï¼Œä¸¤ç§æˆªç„¶ä¸åŒçš„ Action å¹¶ä¸ä¼šå¹²æ‰°åŒæ–¹çš„ State ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰å…³è”ã€‚å¦‚æœæŒ‰ç…§ä¸Šè¿°å°†å…¶å†™åœ¨ä¸€èµ·ï¼Œè‹¥åç»­å¢åŠ æ›´å¤šçš„å­˜å‚¨çŠ¶æ€æ—¶ï¼Œå®ƒçœ‹èµ·æ¥å°±æ›´åŠ çš„ç´Šä¹±ï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿå°†è¶Šæ¥è¶Šé«˜ã€‚</strong></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è¿›è¡Œæ‹†åˆ†ã€‚</p>
<h3>é‚£ä¹ˆå¦‚ä½•æ‹†åˆ†å‘¢ï¼Ÿ</h3>
<p>æˆ‘ä»¬è¯•å›¾å°†ä¸Šè¿°çš„ <code>reducer</code> å‡½æ•°æ‹†åˆ†æˆä¸¤ä¸ª <code>countReducer</code>ã€<code>statusReducer</code>ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œè¿™æ ·ä¸€æ‹†ï¼ŒReducer å°±æ˜“è¯»å¾ˆå¤šäº†ï¼Œä¸¤è€…èŒèƒ½ä¹Ÿå¾ˆæ¸…æ™°ã€‚</p>
<pre><code class="language-jsx">// count reducer
const countReducer = (prevState, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      return { ...prevState, count: prevState.count + payload }
    case 'SUB':
      return { ...prevState, count: prevState.count - payload }
    default:
      return prevState
  }
}

// status reducer
const statusReducer = (prevState, action) =&gt; {
  const { type } = action
  switch (type) {
    case 'LOGIN_IN':
      return { ...prevState, status: 'online' }
    case 'LOGIN_OUT':
      return { ...prevState, status: 'offline' }
    default:
      return prevState
  }
}
</code></pre>
<blockquote>
<p>ç„¶åæˆ‘ä»¬ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•å°†å…¶åˆæˆä¸€ä¸ªæ ‡å‡†çš„ Reducer å‡½æ•°ï¼Ÿ</p>
</blockquote>
<h3>combineReducers(reducers) ç›¸å…³æ¦‚å¿µ</h3>
<p>Redux æä¾›äº†ä¸€ä¸ª <code>combineReducers</code> æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼ŒæŠŠä¸€ä¸ªç”±å¤šä¸ªä¸åŒ <code>reducer</code> å‡½æ•°ä½œä¸º <code>value</code> å€¼çš„å¯¹è±¡ï¼Œåˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„ <code>reducer</code> å‡½æ•°ï¼Œç„¶åå°±å¯ä»¥å¯¹è¿™ä¸ª <code>reducer</code> è°ƒç”¨ <code>createStore</code> æ–¹æ³•ã€‚</p>
<p>åˆå¹¶åçš„ <code>reducer</code> å¯ä»¥è°ƒç”¨å„ä¸ªå­ <code>reducer</code> å‡½æ•°ï¼Œå¹¶æŠŠå®ƒä»¬è¿”å›çš„ç»“æœåˆå¹¶æˆä¸€ä¸ª <code>state</code> å¯¹è±¡ã€‚ç”± <code>combineReducers()</code> è¿”å›çš„ <code>state</code> å¯¹è±¡ï¼Œä¼šå°†ä¼ å…¥çš„æ¯ä¸ª <code>reducer</code> è¿”å›çš„ <code>state</code> æŒ‰å…¶ä¼ é€’ç»™ <code>combineReducers()</code> æ—¶å¯¹åº”çš„ <code>key</code> è¿›è¡Œå‘½åã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-jsx">const rootReducer = combineReducers({
  keyA: aReducer,
  keyB: bReducer
})

// é‚£ä¹ˆè¿”å›çš„ state å¯¹è±¡å°±æ˜¯ï¼š{ keyA: ..., keyB: ... }
</code></pre>
<p>*è¿˜æœ‰å‡ ä¹æ‰€æœ‰å…³äº <code>combineReducers</code> çš„æ•™ç¨‹éƒ½æœ‰æåˆ°çš„ä¸€ç‚¹ï¼šä½¿ç”¨ ES6 å¯¹è±¡å±æ€§ç®€å†™çš„æ–¹å¼ä½¿å¾—å…¶çœ‹èµ·æ¥æ›´ç®€æ´ã€‚è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå¤ªç®€å•äº†ï¼Œç›¸ä¿¡ä½ ä»¬æ—©å°±æŒæ¡äº†ã€‚</p>
<blockquote>
<p>å®ƒçš„è¿”å›å€¼çœ‹<a href="http://cn.redux.js.org/docs/api/combineReducers.html">è¿™é‡Œ</a>ï¼ˆä¸ºäº†é¿å…è¢«è¿™äº›æ¦‚å¿µç»•æ™•ï¼Œä¸ªäººå»ºè®®ä¸çœ‹ï¼‰ã€‚æˆ‘ä»¬åªè¦çŸ¥é“ <code>combineReducers()</code> çš„è¿”å›å€¼å¯ç›´æ¥ä½œä¸º <code>createStore()</code> ç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<h3>éœ€è¦æ³¨æ„çš„æ˜¯</h3>
<p>æœ¬å‡½æ•°è®¾è®¡çš„æ—¶å€™æœ‰ç‚¹åä¸»è§‚ï¼Œå°±æ˜¯ä¸ºäº†é¿å…æ–°æ‰‹çŠ¯ä¸€äº›å¸¸è§é”™è¯¯ã€‚ä¹Ÿå› æ­¤ä½œè€…æ•…æ„è®¾å®šä¸€äº›è§„åˆ™ã€‚ï¼ˆä½†å¦‚æœä½ è‡ªå·±æ‰‹åŠ¨ç¼–å†™ rootRedcuer æ—¶å¹¶ä¸éœ€è¦éµå®ˆè¿™äº›è§„åˆ™ã€‚ï¼‰</p>
<p>æ¯ä¸ªä¼ å…¥ <code>combineReducers</code> çš„ <code>reducer</code> éƒ½éœ€æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š</p>
<blockquote>
<ul>
<li>
<p>æ‰€æœ‰æœªåŒ¹é…åˆ°çš„ <code>action</code>ï¼Œå¿…é¡»æŠŠå®ƒæ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯é‚£ä¸ª <code>state</code> åŸå°ä¸åŠ¨è¿”å›ã€‚</p>
</li>
<li>
<p>æ°¸è¿œä¸èƒ½è¿”å› <code>undefined</code>ã€‚å½“è¿‡æ—© <code>return</code> æ—¶éå¸¸å®¹æ˜“çŠ¯è¿™ä¸ªé”™è¯¯ï¼Œä¸ºäº†é¿å…é”™è¯¯æ‰©æ•£ï¼Œé‡åˆ°è¿™ç§æƒ…å†µæ—¶ <code>combineReducers</code> ä¼šæŠ›å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>å¦‚æœä¼ å…¥çš„ <code>state</code> å°±æ˜¯ <code>undefined</code>ï¼Œä¸€å®šè¦è¿”å›å¯¹åº” <code>reducer</code> çš„åˆå§‹ <code>state</code>ã€‚æ ¹æ®ä¸Šä¸€æ¡è§„åˆ™ï¼Œåˆå§‹ <code>state</code> ç¦æ­¢ä½¿ç”¨ <code>undefined</code>ã€‚ä½¿ç”¨ ES6 çš„é»˜è®¤å‚æ•°å€¼è¯­æ³•æ¥è®¾ç½®åˆå§‹ <code>state</code> å¾ˆå®¹æ˜“ï¼Œä½†ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸º<code> undefined</code>ã€‚</p>
</li>
</ul>
</blockquote>
<p>è™½ç„¶ <code>combineReducers</code> è‡ªåŠ¨å¸®ä½ æ£€æŸ¥ <code>reducer</code> æ˜¯å¦ç¬¦åˆä»¥ä¸Šè§„åˆ™ï¼Œä½†ä½ ä¹Ÿåº”è¯¥ç‰¢è®°ï¼Œå¹¶å°½é‡éµå®ˆã€‚å³ä½¿ä½ é€šè¿‡ <code>Redux.createStore(combineReducers(...), initialState)</code> æŒ‡å®šåˆå§‹ <code>state</code>ï¼Œ<code>combineReducers</code> ä¹Ÿä¼šå°è¯•é€šè¿‡ä¼ é€’ <code>undefined</code> çš„ <code>state</code> æ¥æ£€æµ‹ä½ çš„ <code>reducer</code> æ˜¯å¦ç¬¦åˆè§„åˆ™ã€‚å› æ­¤ï¼Œå³ä½¿ä½ åœ¨ä»£ç ä¸­ä¸æ‰“ç®—å®é™…æ¥æ”¶å€¼ä¸º <code>undefined</code> çš„ <code>state</code>ï¼Œä¹Ÿå¿…é¡»ä¿è¯ä½ çš„ <code>reducer</code> åœ¨æ¥æ”¶åˆ° <code>undefined</code> æ—¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p>
<h3>äº†è§£ç›¸å…³è§„åˆ™ä¹‹å</h3>
<p>å¯¹æˆ‘ä»¬çš„é¡¹ç›®åšç›¸åº”çš„è°ƒæ•´ï¼Œä»¥åˆ†æ‹† Reducerã€‚</p>
<ol>
<li>é¦–å…ˆå°† <code>countReducer</code>ã€<code>statusReducer</code> åˆ†åˆ«åˆ†ç¦»åˆ° <code>/reducers/countReducer.js</code>ã€<code>/reducers/statusReducer.js</code> ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚</li>
</ol>
<pre><code class="language-jsx">// reducers/countReducer.js
const countReducer = (prevState = {}, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      return prevState + payload
    case 'SUB':
      return prevState - payload
    default:
      return prevState
  }
}

export default countReducer
</code></pre>
<pre><code class="language-jsx">// reducers/statusReducer.js
const statusReducer = (prevState = {}, action) =&gt; {
  const { type } = action
  switch (type) {
    case 'LOGIN_IN':
      return 'online'
    case 'LOGIN_OUT':
      return 'offline'
    default:
      return prevState
  }
}

export default statusReducer
</code></pre>
<ol start="2">
<li>å¼•å…¥ <code>combineReducers</code></li>
</ol>
<pre><code class="language-jsx">// reducers/index.js
import { combineReducers } from 'redux'
import countReducer from './countReducer'
import statusReducer from './statusReducer'

const rootReducer = combineReducers({
  count: countReducer,
  status: statusReducer
})

export default rootReducer
</code></pre>
<p>è‡³æ­¤æˆ‘ä»¬çš„ Reducer å°±æ‹†åˆ†æˆåŠŸäº†ï¼Œæ•ˆæœå›¾å°±ä¸è´´äº†ï¼Œä¸æ‹†åˆ†ä¹‹å‰æ— å¼‚ã€‚</p>
<p>å½“ç„¶äº†ï¼Œä»¥ä¸Šæ•™ç¨‹åªæ˜¯ä¸ºäº†å¼•å…¥è€Œå¼•å…¥ã€‚å¦‚æœå·²ç»æŒæ¡äº†ï¼Œé‚£ä¹ˆå®é™…é¡¹ç›®ä¸­é‡åˆ°å†å¤æ‚çš„ <code>store</code> çŠ¶æ€å­˜å‚¨æˆ‘ä»¬éƒ½ä¸ç”¨æ€•äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¹ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/62</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/62</guid>
            <pubDate>Sat, 25 Feb 2023 11:41:51 GMT</pubDate>
            <description><![CDATA[<p>è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•è§‚å¯Ÿ store çš„å˜åŒ–ï¼Œä¸Šæ–‡æˆ‘è¯´äº†å¯ä»¥é€šè¿‡ redux-logger æˆ–è€… Redux DevTools æ¥è§£å†³è¿™ä¸ªæˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<h3>ä¸€ã€Redux-Logger</h3>
<p>å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”Ÿæˆæ—¥å¿—çš„ä¸­é—´ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ° Action æ“ä½œï¼ŒåŒ…æ‹¬ actionã€pr]]></description>
            <content:encoded><![CDATA[<p>è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•è§‚å¯Ÿ store çš„å˜åŒ–ï¼Œä¸Šæ–‡æˆ‘è¯´äº†å¯ä»¥é€šè¿‡ redux-logger æˆ–è€… Redux DevTools æ¥è§£å†³è¿™ä¸ªæˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<h3>ä¸€ã€Redux-Logger</h3>
<p>å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”Ÿæˆæ—¥å¿—çš„ä¸­é—´ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ° Action æ“ä½œï¼ŒåŒ…æ‹¬ actionã€prev stateã€next state çŠ¶æ€ã€‚</p>
<p>æ¥å…¥ redux-logger çš„æ–¹æ³•éå¸¸çš„ç®€å•ã€‚</p>
<ol>
<li>å®‰è£… redux-logger</li>
</ol>
<pre><code class="language-shell">$ yarn add redux-logger@3.0.6
</code></pre>
<ol start="2">
<li>åœ¨ <code>createStore</code> æ–¹æ³•ä¼ å…¥</li>
</ol>
<p>æ­¤å‰<a href="https://www.jianshu.com/p/13ea372cdd45">æ–‡ç« </a>æˆ‘ä»¬ä»‹ç»äº† <code>redux</code> çš„ <code>createStore</code> æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š<code>createStore(reducer, [preloadedState], enhancer)</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ°ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>æˆ‘ä»¬å°† <code>redux-logger</code> æ”¾åœ¨ <code>redux</code> æä¾›çš„ <code>applyMiddleware</code> ä¸­ï¼Œå†ä¼ å…¥ <code>createStore</code> å°±èƒ½å®Œæˆ <code>store.dispatch()</code> åŠŸèƒ½çš„å¢å¼ºã€‚</p>
<pre><code class="language-jsx">// store/index.js
// æ³¨æ„ï¼šä¸ºäº†ç¼©å‡æ–‡ç« ç¯‡å¹…ï¼Œè¿™é‡Œçœç•¥äº†éƒ¨åˆ†ä»£ç ã€‚
import { createStore, applyMiddleware } from 'redux'
import logger from 'redux-logger'

// some statements...

// å¦‚æœè¿™é‡Œä¸ä¼  preloadedState å‚æ•°ï¼Œé‚£ä¹ˆ applyMiddleware å°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°äº†
const store = createStore(reducer, initialState, applyMiddleware(logger))

export default store
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸­é—´ä»¶çš„æ¬¡åºæ˜¯æœ‰è¦æ±‚çš„ï¼Œä½¿ç”¨ä¹‹å‰ï¼Œè¯·æŸ¥ä¸€ä¸‹ç›¸å…³æ–‡æ¡£ã€‚æ¯”å¦‚ redux-logger å°±ä¸€å®šè¦æ”¾åœ¨æœ€åï¼Œå¦åˆ™è¾“å‡ºç»“æœä¼šä¸æ­£ç¡®ã€‚</p>
</blockquote>
<ol start="3">
<li>å®Œæˆäº†ï¼Œçœ‹æ•ˆæœï¼š</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-47ced48f46f1bd9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h3>äºŒã€Redux DevTools</h3>
<p>æˆ‘æ›´åå‘äºä½¿ç”¨æ’ä»¶ï¼Œä¸€ä¸ªæ˜¯æˆ‘æœ¬èº«å¼ºè¿«ç—‡ä½¿ç„¶ï¼ŒäºŒæ˜¯é¡¹ç›®å¯èƒ½ä¼šéœ€è¦æ‰“å°å…¶ä»–ä¿¡æ¯ï¼Œå¦‚æœæ¯æ¬¡ Redux å¤„ç† Action éƒ½æ‰“å°çš„è¯ï¼Œå‡å¦‚é¢‘ç¹æ“ä½œçš„è¯ï¼Œæˆ‘å¯èƒ½æ²¡åŠæ³•å¾ˆå¿«æ‰¾åˆ°æˆ‘æƒ³è¦çš„ä¿¡æ¯ï¼Œçœ‹åˆ°æ»¡å±çš„ log æˆ‘ä¼šç–¯æ‰ï¼Œå“ˆå“ˆã€‚</p>
<p>*æ’ä»¶å®‰è£…ï¼Œè‡ªè¡Œè§£å†³ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<blockquote>
<p>åœ¨è¿™é‡Œæˆ‘ä¼šè¿™æ ·å¤„ç†ï¼Œåœ¨å«æœ‰ Redux DevTools æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨ redux-loggerã€‚è‹¥ä¸å«æ’ä»¶ï¼ˆå¦‚ Safari æµè§ˆå™¨ï¼‰ï¼Œæˆ‘å°±ä¼šå¯ç”¨ redux-loggerã€‚</p>
</blockquote>
<p><strong>Redux DevTools ä½¿ç”¨æ–‡æ¡£ï¼Œåœ¨<a href="https://github.com/zalmoxisus/redux-devtools-extension#usage">è¿™é‡Œ</a>ã€‚ä½¿ç”¨æ–¹æ³•å…¶å®å¾ˆå¤šç§ï¼Œè¯¦æƒ…ç‚¹å‡»äº†è§£ã€‚</strong></p>
<p>æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬é¡¹ç›®é™¤äº† <code>redux-logger</code>ï¼Œæš‚æ—¶æœªä½¿ç”¨åˆ°å…¶ä»–ä¸­é—´ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦åšä»¥ä¸‹è°ƒæ•´å°±èƒ½ä½¿ç”¨äº†ã€‚</p>
<pre><code class="language-jsx">// store/index.js
// çœç•¥çš„ä»£ç æ— éœ€æ”¹åŠ¨ï¼Œæˆ‘ä»¬åªéœ€åŠ ä¸€ä¸ªåˆ¤æ–­å³å¯ã€‚

// åˆ¤æ–­æ˜¯å¦å«æœ‰ Redux DevTools æ’ä»¶
const enhancers = window.__REDUX_DEVTOOLS_EXTENSION__ ? __REDUX_DEVTOOLS_EXTENSION__() : applyMiddleware(logger)

const store = createStore(reducer, initialState, enhancers)
</code></pre>
<p>æˆ‘ä»¬å°† Chrome DevTool çš„ Tab åˆ‡æ¢è‡³ Redux æ ï¼Œå³å¯çœ‹åˆ°æ•ˆæœå¦‚ä¸‹ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-66c23393281b164a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å«æœ‰æ’ä»¶çš„ Chrome æµè§ˆå™¨"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3514a431b085fa72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸å«æ’ä»¶çš„ Safari æµè§ˆå™¨"></p>
<h3>ä¸‰ã€ä½ ä»¥ä¸ºå®Œäº†å—ï¼Ÿ</h3>
<p>ä¸ä¸ä¸ï¼ŒRedux DevTools çš„ä½¿ç”¨ä¸ä»…å¦‚æ­¤ï¼Œä¸Šé¢åªæ˜¯æœ€åŸºç¡€çš„ç©æ³•ï¼Œæ›´å¤šè¯·çœ‹<a href="https://github.com/zalmoxisus/redux-devtools-extension#usage">æ–‡æ¡£</a>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»‹ç»ä¸€ç§ Advanced Store Setup è¿›ä»·é…ç½®ã€‚</p>
<p>è¿™é‡Œæˆ‘ç‡å…ˆå¼•å…¥ <code>redux-saga</code> ä¸­é—´ä»¶ï¼Œå®ƒæ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„ï¼Œæœ¬æ–‡åªæ˜¯ä¸ºäº†ç»“åˆ Redux DevTools çš„ä½¿ç”¨è€Œæå‰å¼•å…¥ï¼Œå¯¹å®ƒæš‚ä¸åšè¯¦è§£ï¼Œåç»­æ–‡ç« ä¼šæœ‰ã€‚</p>
<pre><code class="language-shell">$ yarn add redux-saga@1.1.3
</code></pre>
<p>å› ä¸ºç°åœ¨é¡¹ç›®å¼•å…¥çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬å¯¹é¡¹ç›®ç»“æ„ä½œä¸€äº›ç®€å•è°ƒæ•´ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¼šæ›´æ¸…æ™°ã€‚</p>
<ol>
<li>æˆ‘ä»¬å…ˆæŠŠåŸå…ˆåœ¨ <code>/scr/js/store/index.js</code> çš„ reducer å¤„ç†å‡½æ•°åˆ†ç¦»åˆ° <code>/scr/js/reducers/index.js</code> æ–‡ä»¶ä¸‹ï¼Œå…¶ä¸­å¤„ç†é€»è¾‘ä¸å˜ã€‚</li>
</ol>
<pre><code class="language-jsx">// reducers/index.js
const reducer = (prevState, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      // ä¸€å®šè¦ä¸èƒ½ä¿®æ”¹ stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‰¯æœ¬
      // å€˜è‹¥ state æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸€å®šè¦å€ŸåŠ© Object.assignã€å¯¹è±¡å±•å¼€è¿ç®—ç¬¦(...)ã€å…¶ä»–åº“çš„æ‹·è´æ–¹æ³•æˆ–è€…è‡ªå·±å®ç°æ·±æ‹·è´æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°å‰¯æœ¬
      return { ...prevState, count: prevState.count + payload }
    case 'SUB':
      return { ...prevState, count: prevState.count - payload }
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›æ—§çš„ state
      return prevState
  }
}

export default reducer
</code></pre>
<ol start="2">
<li>åˆ›å»º <code>redux-saga</code> æœ€ç®€å•çš„ä¾‹å­ã€‚æˆ‘ä»¬åœ¨ <code>src/js</code> ç›®å½•ä¸‹æ–°å»º <code>sagas/index.js</code> æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="language-jsx">// sagas/index.js
import { all, fork } from 'redux-saga/effects'

function* helloSaga() {
    console.log('Hello Saga!')
}

function* rootSaga() {
    yield all([fork(helloSaga)])
}

export default rootSaga
</code></pre>
<ol start="3">
<li>å¯åŠ¨ saga</li>
</ol>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨ <code>redux</code> çš„å¦ä¸€ä¸ªé«˜é˜¶å‡½æ•° <code>compose</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„åˆå‡½æ•°ï¼Œä¸ Redux æœ¬èº«æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚å®ƒè¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠ <code>var a = fn1(fn2(fn3(fn4(x))))</code> è¿™ç§åµŒå¥—çš„è°ƒç”¨æ–¹å¼æ”¹æˆ <code>var a = compose(fn1, fn2, fn3, fn4)(x)</code> çš„æ–¹å¼è°ƒç”¨ã€‚å®ƒé‡Œé¢ä½¿ç”¨äº†æ•°ç»„çš„ <code>Array.prototype.reduce</code> æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œä¸å±•å¼€è®²è¿°äº†ï¼Œæœ‰å…´è¶£çš„è‡ªè¡Œæœç´¢æˆ–è€…æŸ¥çœ‹ redux æºç ï¼Œæ–‡ç« ç»“å°¾è€ƒè™‘è´´ä¸€ä¸ª <code>compose</code> çš„æºç ã€‚</p>
<p>å›åˆ°æ­£é¢˜ï¼š</p>
<pre><code class="language-jsx">// store/index.js
import { createStore, applyMiddleware, compose } from 'redux'
import createSagaMiddleware from 'redux-saga'
import logger from 'redux-logger'
import rootSaga from '../sagas'
import reducers from '../reducers'

// åˆå§‹å€¼
const initialState = { count: 0 }

// åˆ›å»º saga middleware
const sagaMiddleware = createSagaMiddleware()

// å½“ä½¿ç”¨ middleware æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ä½œåˆ¤æ–­äº†
const composeEnhancers = (typeof window !== 'undefined' &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose

// åˆ¤æ–­æ˜¯å¦å«æœ‰ Redux DevTools æ’ä»¶
const middlewares = typeof window !== 'undefined' &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__ ? applyMiddleware(sagaMiddleware) : applyMiddleware(sagaMiddleware, logger)

// åˆ›å»º Storeï¼ˆä¹Ÿå¯ä»¥ä¸ä¼ å…¥ initialState å‚æ•°ï¼Œè€Œå°† reducer ä¸­çš„ state è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼‰
const store = createStore(reducers, initialState, composeEnhancers(middlewares))

// å¯åŠ¨ saga
sagaMiddleware.run(rootSaga)

// ç›‘å¬ state å˜åŒ–
// const unsubscribe = store.subscribe(() =&gt; {
//   console.log('ç›‘å¬ state å˜åŒ–', store.getState())
// })

// è§£é™¤ç›‘å¬
// unsubscribe()

export default store
</code></pre>
<p>å¤§åŠŸå‘Šæˆï¼Œå¦‚å›¾ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-1b9955ea65be2655.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œ<code>redux-saga</code> å¹¶æ²¡æœ‰è§£å†³ä»€ä¹ˆå®é™…é—®é¢˜ï¼Œæœ¬æ–‡åªæ˜¯å•çº¯çš„ä¸ºäº†å¼•å…¥è€Œå¼•å…¥çš„ï¼Œåç»­å°†ä¼šè®²è§£ã€‚</p>
<h3>é¢˜å¤–è¯</h3>
<p>è´´ä¸Š Redux çš„ <code>compose</code> æ–¹æ³•çš„<a href="https://github.com/reduxjs/redux/blob/4.x/src/compose.js">æºç </a>ï¼Œå¾ˆç²¾é«“ï¼Œå“ˆå“ˆï¼</p>
<pre><code class="language-jsx">export default function compose(...funcs) {
  if (funcs.length === 0) {
    return arg =&gt; arg
  }

  if (funcs.length === 1) {
    return funcs[0]
  }

  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆå…«ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/61</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/61</guid>
            <pubDate>Sat, 25 Feb 2023 11:39:36 GMT</pubDate>
            <description><![CDATA[<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œ Redux çš„ä½œè€…å°è£…äº†ä¸€ä¸ª React ä¸“ç”¨çš„ <a href="https://github.com/reactjs/react-redux">React-Redux</a> åº“ã€‚</p>
<p>æœ¬ç¯‡å†…å®¹ä¸»è¦å‚è€ƒè‡ªé˜®ä¸€å³°è€å¸ˆçš„<a href="http://www.ruanyifeng.com]]></description>
            <content:encoded><![CDATA[<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œ Redux çš„ä½œè€…å°è£…äº†ä¸€ä¸ª React ä¸“ç”¨çš„ <a href="https://github.com/reactjs/react-redux">React-Redux</a> åº“ã€‚</p>
<p>æœ¬ç¯‡å†…å®¹ä¸»è¦å‚è€ƒè‡ªé˜®ä¸€å³°è€å¸ˆçš„<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html">æ–‡ç« </a>ã€‚</p>
<h3>React-Redux</h3>
<p>å®ƒå°†ç»„ä»¶åˆ†æˆä¸¤ç±»ï¼šUI ç»„ä»¶ï¼ˆpresentational componentï¼‰å’Œå®¹å™¨ç»„ä»¶ï¼ˆcontainer componentï¼‰ã€‚</p>
<h5>1. UI ç»„ä»¶</h5>
<pre><code class="language-jsx">const Title = &lt;h3&gt;Title&lt;/h3&gt;
</code></pre>
<p>ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š</p>
<blockquote>
<ul>
<li>åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>æ²¡æœ‰çŠ¶æ€ã€‚ï¼ˆå³æ²¡æœ‰ this.state è¿™ä¸ªå˜é‡ï¼‰</li>
<li>æ‰€æœ‰æ•°æ®ç”±å‚èµ›ï¼ˆthis.propsï¼‰æä¾›ã€‚</li>
<li>ä¸ä½¿ç”¨ä»»ä½• Redux çš„ APIã€‚</li>
</ul>
</blockquote>
<h5>2. å®¹å™¨ç»„ä»¶</h5>
<p>ä¸ UI ç»„ä»¶ç›¸åï¼Œå®ƒçš„ç‰¹å¾ä¸»è¦æœ‰ï¼š</p>
<blockquote>
<ul>
<li>è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°ã€‚</li>
<li>å¸¦æœ‰å†…éƒ¨çŠ¶æ€ã€‚</li>
<li>ä½¿ç”¨ Redux çš„ APIã€‚</li>
</ul>
</blockquote>
<h5>3. æˆ‘ä»¬å¸¸è§çš„æ˜¯å®¹å™¨ç»„ä»¶ + UI ç»„ä»¶</h5>
<p>è®°ä½å°±å¥½äº†ï¼šUI ç»„ä»¶è´Ÿè´£ UI çš„å‘ˆç°ï¼Œå®¹å™¨ç»„ä»¶è´Ÿè´£ç®¡ç†æ•°æ®å’Œé€»è¾‘ã€‚</p>
<p>å½“åŒæ—¶å­˜åœ¨ UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨å®¹å™¨ç»„ä»¶åŒ…è£¹ UI ç»„ä»¶çš„ç­–ç•¥ï¼Œå‰è€…è´Ÿè´£ä¸å¤–éƒ¨é€šä¿¡ï¼Œå°†æ•°æ®ä¼ é€’ç»™åè€…ï¼Œç”±åè€…æ¸²æŸ“å‡ºè§†å›¾ã€‚</p>
<p>React-Redux è§„å®šï¼Œæ‰€æœ‰çš„ UI ç»„ä»¶éƒ½ç”±ç”¨æˆ·æä¾›ï¼Œå®¹å™¨ç»„ä»¶åˆ™æ˜¯ç”± React-Redux è‡ªåŠ¨ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è´Ÿè´£è§†è§‰å±‚ï¼ŒçŠ¶æ€ç®¡ç†åˆ™æ˜¯å…¨éƒ¨äº¤ç»™å®ƒã€‚</p>
<h3>React-Redux API</h3>
<h5>1. connect()</h5>
<p>React-Redux æä¾›çš„ <code>connect()</code> æ–¹æ³•ï¼Œç”¨äºä» UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚ä»å­—é¢ç†è§£çš„è¯ï¼Œå°±æ˜¯å°†ä¸¤ç§ç»„ä»¶è¿èµ·æ¥ã€‚</p>
<pre><code class="language-jsx">import { connect } from 'react-redux'
const VisibleTodoList = connect()(TodoList)

// TodoList æ˜¯ UI ç»„ä»¶
// VisibleTodoList æ˜¯ç”± React-Redux é€šè¿‡ `connect` æ–¹æ³•ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶
</code></pre>
<p>ä¸Šè¿°æ¡ˆä¾‹ï¼Œå¹¶æ²¡æœ‰å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</p>
<p>ä¸ºäº†å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ç»™å‡ºä¸¤æ–¹é¢çš„ä¿¡æ¯</p>
<blockquote>
<p>(1) è¾“å…¥é€»è¾‘ï¼š å¤–éƒ¨çš„æ•°æ®ï¼ˆå³ <code>state</code> å¯¹è±¡ï¼‰å¦‚ä½•è½¬æ¢ä¸º UI ç»„ä»¶çš„å‚æ•°ã€‚
(2) è¾“å‡ºé€»è¾‘ï¼š ç”¨æˆ·å‘å‡ºçš„åŠ¨ä½œå¦‚ä½•å˜ä¸º <code>Action</code> å¯¹è±¡ï¼Œä» UI ç»„ä»¶ä¼ å‡ºå»ã€‚</p>
</blockquote>
<p><code>connect()</code> å®Œæ•´ API å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import { connect } from 'react-redux'
const VisibleTodoList = connect(mapStateToProps, mapDispatchToProps)(TodoList)

// connect æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šmapStateToProps å’Œ mapDispatchToPropsã€‚
// å‰è€…è´Ÿè´£è¾“å…¥é€»è¾‘ï¼Œå³å°† state æ˜ å°„åˆ° UI ç»„ä»¶çš„å‚æ•°ï¼ˆpropsï¼‰ã€‚
// åè€…è´Ÿè´£è¾“å‡ºé€»è¾‘ï¼Œå³å°†ç”¨æˆ·å¯¹ UI ç»„ä»¶çš„æ“ä½œæ˜ å°„æˆ Actionã€‚
</code></pre>
<h5>2. mapStateToProps</h5>
<p>å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½œç”¨æ˜¯å»ºç«‹ä¸€ä¸ªä»ï¼ˆå¤–éƒ¨çš„ï¼‰ <code>state</code> å¯¹è±¡åˆ°ï¼ˆUI ç»„ä»¶çš„ï¼‰ <code>props</code> å¯¹è±¡çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>ä½œä¸ºå‡½æ•°ï¼Œ<code>mapStateToProps</code> æ‰§è¡Œååº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢çš„æ¯ä¸€ä¸ªé”®å€¼å¯¹å°±æ˜¯ä¸€ä¸ªæ˜ å°„ã€‚</p>
<pre><code class="language-jsx">const mapStateToProps = (state, ownProps) =&gt; {
  return {
    // ...
  }
}

// mapStateToProps æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯¹è±¡
// state å°±æ˜¯æˆ‘ä»¬ store çš„å…¨å±€çŠ¶æ€
// ownProps æ˜¯å®¹å™¨ç»„ä»¶çš„ props å¯¹è±¡ã€‚ä½¿ç”¨å®ƒä¹‹åï¼Œå¦‚æœå®¹å™¨ç»„ä»¶çš„å‚æ•°å‘é€å˜åŒ–ï¼Œä¹Ÿä¼šå¼•å‘ UI ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
</code></pre>
<p><code>mapStateToProps</code> ä¼šè®¢é˜… <code>Store</code>ï¼Œæ¯å½“ <code>state</code> æ›´æ–°æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œé‡æ–°è®¡ç®— UI ç»„ä»¶çš„å‚æ•°ï¼Œä»è€Œè§¦å‘ UI ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>
<p><code>connect</code> æ–¹æ³•å¯ä»¥çœç•¥ <code>mapStateToProps</code> å‚æ•°ï¼Œè¿™æ ·çš„è¯ï¼ŒUI ç»„ä»¶å°±ä¸ä¼šè®¢é˜… <code>Store</code>ï¼Œå³ <code>Store</code> çš„æ›´æ–°ä¸ä¼šå¼•å‘ UI ç»„ä»¶çš„æ›´æ–°ã€‚</p>
<h5>3. mapDispatchToProps</h5>
<p>å®ƒæ˜¯ <code>connect</code> æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºå»ºç«‹ UI ç»„ä»¶çš„å‚æ•°åˆ° <code>store.dispatch</code> æ–¹æ³•çš„æ˜ å°„ã€‚å³å°† <code>Action</code> ç»‘å®šåˆ° UI ç»„ä»¶çš„ <code>props</code> å¯¹è±¡ä¸Šã€‚</p>
<p>ï¼ˆ1ï¼‰<code>mapDispatchToProps</code> æ˜¯å‡½æ•°æ—¶ï¼Œä¼šå¾—åˆ° <code>dispatch</code> å’Œ <code>ownProps</code> ä¸¤ä¸ªå‚æ•°ã€‚
ï¼ˆ2ï¼‰<code>mapDispatchToProps</code> æ˜¯å¯¹è±¡æ—¶ï¼Œå®ƒæ¯ä¸ªé”®åå¯¹åº” UI ç»„ä»¶çš„åŒåå‚æ•°ï¼Œé”®å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè¢«å½“åš <code>Action Creator</code>ï¼Œè¿”å›çš„ <code>Action</code> ä¼šç”± <code>Redux</code> å­—æ®µå‘å‡ºã€‚</p>
<pre><code class="language-jsx">// å‡½æ•°
const mapDispatchToProps = (
  dispatch,
  ownProps
) =&gt; {
  return {
    onClick: () =&gt; {
      dispatch({
        type: 'SET_VISIBILITY_FILTER',
        filter: ownProps.filter
      })
    }
  }
}

// å¯¹è±¡
const mapDispatchToProps = {
  onClick: (filter) =&gt; {
    type: 'SET_VISIBILITY_FILTER',
    filter: filter
  }
}
</code></pre>
<h3><Provider> ç»„ä»¶</h3>
<p><code>connect()</code> æ–¹æ³•ç”Ÿæˆå®¹å™¨ç»„ä»¶ä»¥åï¼Œéœ€è¦è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ° <code>state</code> å¯¹è±¡ï¼Œæ‰èƒ½ç”Ÿæˆ UI ç»„ä»¶çš„å‚æ•°ã€‚</p>
<p>ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°† <code>state</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å®¹å™¨ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšæ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯å®¹å™¨ç»„ä»¶å¯èƒ½åœ¨å¾ˆæ·±çš„å±‚çº§ï¼Œä¸€çº§ä¸€çº§å°† <code>state</code> ä¼ ä¸‹å»å°±å¾ˆéº»çƒ¦ã€‚</p>
<p>React-Redux æä¾›äº† <code>Provider</code> ç»„ä»¶ï¼Œå¯ä»¥è®©å®¹å™¨ç»„ä»¶æ‹¿åˆ° <code>state</code>ã€‚</p>
<pre><code class="language-jsx">import { Provider } from 'react-redux'
import { createStore } from 'redux'
import todoApp from './reducers'
import App from './components/App'

let store = createStore(todoApp)

render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById('root')
)
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>Provider</code> åœ¨æ ¹ç»„ä»¶å¤–é¢åŒ…äº†ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥ï¼Œ<code>App</code> çš„æ‰€æœ‰å­ç»„ä»¶å°±é»˜è®¤éƒ½å¯ä»¥æ‹¿åˆ° <code>state</code> äº†ã€‚</p>
<p>å®ƒçš„åŸç†æ˜¯ React ç»„ä»¶çš„ <a href="https://facebook.github.io/react/docs/context.html">context</a> å±æ€§ï¼Œè¯·çœ‹æºç ï¼š</p>
<pre><code class="language-jsx">class Provider extends Component {
  getChildContext() {
    return {
      store: this.props.store
    }
  }
  render() {
    return this.props.children
  }
}

Provider.childContextTypes = {
  store: React.PropTypes.object
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>store</code> æ”¾åœ¨äº†ä¸Šä¸‹æ–‡å¯¹è±¡ <code>context</code> ä¸Šé¢ã€‚ç„¶åï¼Œå­ç»„ä»¶å°±å¯ä»¥ä» <code>context</code> æ‹¿åˆ°  <code>store</code>ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">class VisibleTodoList extends Component {
  componentDidMount() {
    const { store } = this.context
    this.unsubscribe = store.subscribe(() =&gt;
      this.forceUpdate()
    )
  }

  render() {
    const props = this.props
    const { store } = this.context
    const state = store.getState()
    // ...
  }
}

VisibleTodoList.contextTypes = {
  store: React.PropTypes.object
}
</code></pre>
<p>React-Redux è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶çš„ä»£ç ï¼Œå°±ç±»ä¼¼ä¸Šé¢è¿™æ ·ï¼Œä»è€Œæ‹¿åˆ° <code>store</code>ã€‚</p>
<h3>React-Redux ç®€å•æ¡ˆä¾‹</h3>
<p>é¦–å…ˆï¼Œä¸Šè¿°çš„ä»£ç ä¸æœ¬é¡¹ç›®æ²¡æœ‰å…³è”ï¼Œå…¶å®åªæ˜¯ä¸ºäº†è®²è§£ React-Redux ç›¸å…³ API çš„ä½¿ç”¨ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°†ç»“åˆæˆ‘ä»¬é¡¹ç›®æ¥å®ç°ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ã€‚</p>
<h5>1. å®‰è£… react-redux</h5>
<pre><code class="language-shell">$ yarn add react-redux@7.1.3
</code></pre>
<h5>2. ä½¿ç”¨ Provider åŒ…è£¹æˆ‘ä»¬çš„æ ¹ç»„ä»¶ App</h5>
<pre><code class="language-jsx">// pages/Root.js
import React from 'react'
import { Provider } from 'react-redux'
import App from './pages/App'
import store from './store'

const Root = () =&gt; {
  return (
    &lt;Provider store={store}&gt;
      &lt;App /&gt;
    &lt;/Provider&gt;
  )
}

export default Root
</code></pre>
<h5>3. è°ƒæ•´æˆ‘ä»¬çš„ store ä»¥åŠ reducer</h5>
<p>å®é™…æƒ…å†µä¸‹ï¼Œ<code>store</code> åº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºå®ƒå­˜å‚¨çš„æ•°æ®å¯èƒ½ä¼šå¾ˆå¤šå¾ˆå¤æ‚ã€‚æ­¤å‰ä¸ºäº†ç”¨æœ€ç®€å•æ¡ˆä¾‹æ¥è®²è§£ storeï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒè®¾ç½®ä¸ºä¸€ä¸ª <code>Number</code> ç±»å‹çš„å€¼ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ï¼Œåˆå§‹å€¼è®¾ç½®ä¸º <code>{ count: 0 }</code>ï¼Œå¹¶ä¿®æ”¹ <code>reducer</code> å¤„ç†å‡½æ•°ã€‚</p>
<pre><code class="language-jsx">// store/index.js
import { createStore } from 'redux'

// Reducer å¤„ç†å‡½æ•°
const reducer = (prevState, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      // ä¸€å®šè¦ä¸èƒ½ä¿®æ”¹ stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‰¯æœ¬
      // å€˜è‹¥ state æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸€å®šè¦å€ŸåŠ© Object.assignã€å¯¹è±¡å±•å¼€è¿ç®—ç¬¦(...)ã€å…¶ä»–åº“çš„æ‹·è´æ–¹æ³•æˆ–è€…è‡ªå·±å®ç°æ·±æ‹·è´æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°å‰¯æœ¬
      return { ...prevState, count: prevState.count + payload }
    case 'SUB':
      return { ...prevState, count: prevState.count - payload }
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›æ—§çš„ state
      return prevState
  }
}

// åˆå§‹åŒ–å€¼
const initialState = { count: 0 }

// åˆ›å»º Storeï¼ˆä¹Ÿå¯ä»¥ä¸ä¼ å…¥ initialState å‚æ•°ï¼Œè€Œå°† reducer ä¸­çš„ state è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼‰
const store = createStore(reducer, initialState)

// ç›‘å¬ state å˜åŒ–
// const unsubscribe = store.subscribe(() =&gt; {
//   console.log('ç›‘å¬ state å˜åŒ–', store.getState())
// })

// è§£é™¤ç›‘å¬
// unsubscribe()

export default store
</code></pre>
<h5>4. æˆ‘ä»¬åœ¨ Home ç»„ä»¶å¼•å…¥ connect æ–¹æ³•</h5>
<pre><code class="language-jsx">// pages/home/index.js
import React, { Component } from 'react'
import { connect } from 'react-redux';
import store from '../../store'

class Home extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  handle(type, val) {
    this.props.simpleDispatch(type, val)
    // è·å– State å¿«ç…§
    console.log(`å½“å‰æ“ä½œæ˜¯ ${type}ï¼Œcount ä¸ºï¼š${store.getState().count}`)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h3&gt;Home Component!&lt;/h3&gt;
        {/* å°† state å±•ç¤ºåˆ°é¡µé¢ä¸Š */}
        &lt;h5&gt;countï¼š{this.props.count}&lt;/h5&gt;
        &lt;button onClick={this.handle.bind(this, 'ADD', 1)}&gt;åŠ ä¸€&lt;/button&gt;
        &lt;button onClick={this.handle.bind(this, 'SUB', 1)}&gt;å‡ä¸€&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

// å°† count æ˜ å°„åˆ° Home ç»„ä»¶çš„ props å±æ€§ä¸Šï¼Œé€šè¿‡ this.props.count å³å¯è®¿é—®åˆ°å®ƒã€‚
const mapStateToProps = (state, ownProps) =&gt; {
  return { count: state.count }
}

// åŒç†ï¼Œå®ƒå°† simpleDispatch æ˜ å°„åˆ°ç»„ä»¶çš„ props å±æ€§ä¸Šï¼Œé€šè¿‡ this.props.simpleDispatch è®¿é—®å¹¶ç”± Redux å‘å‡ºä¸€ä¸ª Actionã€‚
const mapDispatchToProps = (dispatch, ownProps) =&gt; {
  return {
    simpleDispatch: (type, payload) =&gt; {
      dispatch({ type, payload })
    }
  }
}

// è‹¥å¿½ç•¥ mapStateToProps å‚æ•°ï¼Œstore çš„æ›´æ–°å°†ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
// è‹¥å¿½ç•¥ mapDispatchToProps å‚æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œstore.dispatch ä¼šæ³¨å…¥ç»„ä»¶ props ä¸­ã€‚
// è‹¥æŒ‡å®šäº†ï¼Œä½ å°±ä¸èƒ½é€šè¿‡ this.props.dispatch æ¥å‘å‡º Action äº†ã€‚
export default connect(mapStateToProps, mapDispatchToProps)(Home)
</code></pre>
<h5>5. æ•ˆæœ</h5>
<p>æˆ‘ä»¬çœ‹åˆ°äº† <code>store</code> çš„å˜åŒ–ï¼Œå°†ä¼šåæ˜ åˆ°é¡µé¢ä¸Šã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-339485faff8348e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h3>è‡³æ­¤</h3>
<p>æˆ‘ä»¬çš„ Redux æœ€ç®€å•çš„ç¯å¢ƒå·²ç»æ­å»ºå¥½äº†ï¼Œä½ å­¦ä¼šäº†å—ï¼Ÿä½†æ˜¯ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œè¿™å¯èƒ½è¿œè¿œä¸å¤Ÿ...</p>
<p>è¿™é‡ŒæŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¤§å‹åº”ç”¨çš„ Reducer ä¸ä¼šé‚£ä¹ˆç®€å•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‹†åˆ†å‘¢ï¼Ÿ</li>
<li>å¦‚ä½•è®© Reducer åœ¨å¼‚æ­¥æ“ä½œç»“æŸä¹‹åï¼Œè‡ªåŠ¨æ‰§è¡Œå‘¢ï¼Ÿ</li>
<li>å¦‚ä½•åˆ©ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“æˆ–è€…æ’ä»¶æ¥è§‚å¯Ÿ store çš„å˜åŒ–ï¼Ÿ</li>
</ul>
<ol>
<li>
<p>æ‹†åˆ† Reducer æˆ‘ä»¬ä½¿ç”¨ Redux æä¾›çš„ <code>combineReducers</code> æ¥å¤„ç†ã€‚</p>
</li>
<li>
<p>è§£å†³å¼‚æ­¥æ“ä½œè‡ªåŠ¨æ‰§è¡Œ Reducer çš„ä¸­é—´ä»¶å¸¸ç”¨çš„ç”¨ <code>redux-thunk</code>ã€<code>redux-promise</code>ã€<code>redux-saga</code> ç­‰ã€‚æˆ‘ä»¬é¡¹ç›®å°†ä¼šé‡‡ç”¨ <code>redux-sage</code>ï¼Œåç»­æ–‡ç« ä¼šè®²è§£ã€‚</p>
</li>
<li>
<p>è§‚å¯Ÿ store å¯ä»¥åˆ©ç”¨ <code>redux-logger</code> ä¸­é—´ä»¶æˆ–è€… Redux DevTools æµè§ˆå™¨æ’ä»¶ï¼ˆGoogle Chrome æµè§ˆå™¨çš„è¯éœ€è¦ç§‘å­¦ä¸Šç½‘ä¸‹è½½ï¼‰ã€‚</p>
</li>
</ol>
<p>ç”±äºæœ¬æ–‡ç¯‡å¹…ä»¥åŠå¾ˆé•¿äº†ï¼Œå°±ä¸‹ä¸€ç¯‡æ¥ä»‹ç»å§ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¸ƒï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/60</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/60</guid>
            <pubDate>Sat, 25 Feb 2023 11:38:17 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº† react-routerï¼Œä»Šå¤©ä»‹ç» reduxã€‚</p>
<h3>ä»€ä¹ˆæ˜¯ Reduxï¼Ÿ</h3>
<p>ç°å¦‚ä»Šï¼Œæˆ‘ä»¬çš„é¡¹ç›®éƒ½æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„æ¨¡å—ç»„æˆçš„ï¼Œç»„ä»¶åŒ–çš„æ€æƒ³æ›´é€‚åˆå¤§ä¸”å¤æ‚çš„é¡¹ç›®ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼ŒReact å¹¶ä¸é€‚åˆå†™å¤§å‹åº”ç”¨ï¼Œå› ä¸ºå®ƒå½“æ—¶è¿˜æ²¡æœ‰å¾ˆå¥½åœ°è§£å†³<strong>ç»„ä»¶ä¹‹é—´çš„é€šä¿¡<]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»äº† react-routerï¼Œä»Šå¤©ä»‹ç» reduxã€‚</p>
<h3>ä»€ä¹ˆæ˜¯ Reduxï¼Ÿ</h3>
<p>ç°å¦‚ä»Šï¼Œæˆ‘ä»¬çš„é¡¹ç›®éƒ½æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„æ¨¡å—ç»„æˆçš„ï¼Œç»„ä»¶åŒ–çš„æ€æƒ³æ›´é€‚åˆå¤§ä¸”å¤æ‚çš„é¡¹ç›®ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼ŒReact å¹¶ä¸é€‚åˆå†™å¤§å‹åº”ç”¨ï¼Œå› ä¸ºå®ƒå½“æ—¶è¿˜æ²¡æœ‰å¾ˆå¥½åœ°è§£å†³<strong>ç»„ä»¶ä¹‹é—´çš„é€šä¿¡</strong>é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2014 å¹´ Facebook æå‡ºäº† <a href="http://www.ruanyifeng.com/blog/2016/01/flux.html">Flux</a> æ¶æ„çš„æ¦‚å¿µï¼Œå¼•å‘äº†å¾ˆå¤šçš„å®ç°ã€‚2015 å¹´ï¼Œ<a href="https://github.com/reduxjs/redux">Redux</a> å‡ºç°ï¼Œå°† Flux ä¸å‡½æ•°å¼ç¼–ç¨‹ç»“åˆåœ¨ä¸€èµ·ï¼Œå¾ˆçŸ­æ—¶é—´å†…å°±æˆä¸ºäº†æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶ã€‚</p>
<h3>ä»€ä¹ˆæ—¶å€™éœ€è¦ Reduxï¼Ÿ</h3>
<p>æœ‰äººè¯´è¿‡ï¼ŒæŒºæœ‰é“ç†çš„å“ˆã€‚</p>
<pre><code>å¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦ Reduxï¼Œé‚£å°±æ˜¯ä¸éœ€è¦å®ƒã€‚
</code></pre>
<p>åœ¨ä»¥ä¸‹åœºæ™¯ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å®ƒï¼š</p>
<ul>
<li>ç»„ä»¶é—´éœ€è¦å…±äº«çŠ¶æ€</li>
<li>çŠ¶æ€éœ€è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½æ‹¿åˆ°</li>
<li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€</li>
<li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å…¨å±€çŠ¶æ€</li>
</ul>
<p>*ä»¥ä¸Šå†…å®¹å¼•è‡ªé˜®ä¸€å³°è€å¸ˆçš„<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html">åšå®¢</a>ï¼Œæœ¬æ•™ç¨‹æ˜¯ä¸ºäº†æ¥å…¥è€Œæ¥å…¥ï¼Œå“ˆå“ˆã€‚</p>
<h3>Redux è®¾è®¡æ€æƒ³</h3>
<ul>
<li><strong>Web åº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼ŒView ä¸ State æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</strong></li>
<li><strong>æ‰€æœ‰çš„çŠ¶æ€ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚</strong></li>
</ul>
<h3>åŸºæœ¬æ¦‚å¿µå’Œ API</h3>
<p>å…ˆäº†è§£ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µå§</p>
<ul>
<li>
<p><strong>Store</strong>ï¼šä¿å­˜æ•°æ®çš„å®¹å™¨ã€‚ç”± <code>Redux</code> æä¾›çš„ <code>createStore</code> å‡½æ•°æ¥ç”Ÿæˆå”¯ä¸€çš„ <code>Store</code> å¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>State</strong>ï¼š<code>Store</code> å¯¹è±¡åŒ…å«çš„æ•°æ®ã€‚å½“å‰çš„çŠ¶æ€ï¼Œå¯é€šè¿‡ <code>store.getState()</code> è·å–ã€‚Redux è§„å®šä¸€ä¸ª <code>State</code> å¯¹åº”ä¸€ä¸ª <code>View</code>ã€‚</p>
</li>
<li>
<p><strong>Action</strong>ï¼š<code>View</code> å‘å‡ºçš„åŠ¨ä½œï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»é¼ æ ‡ç­‰è¡Œä¸ºï¼‰é€šçŸ¥ <code>State</code> è¦å‘ç”Ÿæ”¹å˜ã€‚<code>Action</code> æ˜¯æ”¹å˜ <code>State</code> çš„å”¯ä¸€åŠæ³•ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ <code>type</code> å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè¡¨ç¤º <code>Action</code> çš„åç§°ï¼Œå…¶ä»–å±æ€§å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œå…¶ç¤¾åŒºæœ‰ä¸€ä¸ª<a href="https://github.com/redux-utilities/flux-standard-action">è§„èŒƒ</a>å¯ä»¥å‚è€ƒã€‚å¦‚ <code>const action = { type: 'SOMETHING_TODO', payload: 'SOME DATA' }</code>ã€‚</p>
</li>
<li>
<p><strong>Action Creator</strong>ï¼šç”Ÿæˆ <code>Action</code> çš„å‡½æ•°ã€‚å½“æœ‰è‹¥å¹² <code>Action</code> æ—¶ï¼Œå…¨éƒ¨æ‰‹å†™å¯èƒ½ç•¥æ˜¾éº»çƒ¦ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ <code>Action</code>ï¼Œè¿™ç§å‡½æ•°å«åš <code>Action Creator</code>ã€‚</p>
</li>
<li>
<p><strong>store.dispatch()</strong>ï¼šæ˜¯ <code>View</code> å‘å‡º <code>Action</code> çš„å”¯ä¸€æ–¹å¼ã€‚</p>
</li>
<li>
<p><strong>Reducer</strong>ï¼šå½“ <code>Store</code> æ”¶åˆ° <code>Action</code> ä¹‹åï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ <code>State</code>ï¼Œè¿™æ · <code>View</code> æ‰ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ç§ <code>State</code>çš„è®¡ç®—è¿‡ç¨‹å«åš <code>Reducer</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚</p>
</li>
<li>
<p><strong>Pure Function</strong>ï¼šå³çº¯å‡½æ•°ï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡ºï¼Œä¸”æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨</p>
</li>
<li>
<p><strong>store.subscribe()</strong>ï¼šç›‘å¬ <code>State</code> çš„å˜åŒ–ï¼Œä¸€æ—¦ <code>State</code> å‘ç”Ÿå˜åŒ–ï¼Œå°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œè¯¥è¿”å›å‡½æ•°å°±è§£é™¤ç›‘å¬ã€‚</p>
</li>
</ul>
<h3>å®ç°æœ€ç®€å•çš„ Store æ¡ˆä¾‹</h3>
<p>å…ˆå®‰è£… <code>redux</code> ä¾èµ–ã€‚</p>
<pre><code class="language-shell">$ yarn add redux@4.0.4
</code></pre>
<p>åœ¨ <code>src/js/store</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>index.js</code> æ–‡ä»¶ã€‚</p>
<pre><code class="language-jsx">// store/index.js
import { createStore } from 'redux'

// Reducer å¤„ç†å‡½æ•°
const reducer = (prevState, action) =&gt; {
  const { type, payload } = action
  switch (type) {
    case 'ADD':
      // ä¸€å®šè¦ä¸èƒ½ä¿®æ”¹ stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‰¯æœ¬
      // å€˜è‹¥ state æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸€å®šè¦å€ŸåŠ© Object.assignã€å¯¹è±¡å±•å¼€è¿ç®—ç¬¦(...)ã€å…¶ä»–åº“çš„æ‹·è´æ–¹æ³•æˆ–è€…è‡ªå·±å®ç°æ·±æ‹·è´æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ–°å‰¯æœ¬
      return prevState + payload
    case 'SUB':
      return prevState - payload
    default:
      // default æˆ–è€…æœªçŸ¥ action æ—¶ï¼Œè¿”å›æ—§çš„ state
      return prevState
  }
}

// åˆå§‹å€¼
const initialState = 0

// åˆ›å»º Storeï¼ˆä¹Ÿå¯ä»¥ä¸ä¼ å…¥ initialState å‚æ•°ï¼Œè€Œå°† reducer ä¸­çš„ state è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼‰
const store = createStore(reducer, initialState)

// ç›‘å¬ state å˜åŒ–
// const unsubscribe = store.subscribe(() =&gt; {
//   console.log('ç›‘å¬ state å˜åŒ–', store.getState())
// })

// è§£é™¤ç›‘å¬
// unsubscribe()

export default store
</code></pre>
<p>æˆ‘ä»¬åœ¨ Home ç»„ä»¶å¼•å…¥ Storeï¼Œå¹¶ä¿®æ”¹æˆï¼š</p>
<pre><code class="language-jsx">// pages/home/index.js
import React, { Component } from 'react'
import store from '../../store'

class Home extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  // Action Creator å‡½æ•°
  actionCreator(type, payload) {
    return { type, payload }
  }

  handle(type, val) {
    // åˆ›å»º Action
    const action = this.actionCreator(type, val)
    // æ´¾å‘ Action
    store.dispatch(action)
    // è·å– State å¿«ç…§
    console.log(`å½“å‰æ“ä½œæ˜¯ ${type}ï¼ŒState ä¸ºï¼š${store.getState()}`)
  }

  render() {
    return (
      &lt;div&gt;
        &lt;h3&gt;Home Component!&lt;/h3&gt;
        &lt;button onClick={this.handle.bind(this, 'ADD', 1)}&gt;åŠ ä¸€&lt;/button&gt;
        &lt;button onClick={this.handle.bind(this, 'SUB', 1)}&gt;å‡ä¸€&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

export default Home
</code></pre>
<p>ä¸Šé¢æ¡ˆä¾‹ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªå¾ˆç®€å•çš„åŠ å‡æ“ä½œã€‚</p>
<p>é€šè¿‡ <code>redux</code> æä¾›çš„ <code>createStore</code> å‡½æ•°åˆ›å»ºäº†å”¯ä¸€çš„ä¸€ä¸ª <code>store</code> å¯¹è±¡ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•° <code>createStore(reducer, [preloadedState], enhancer)</code> ï¼Œå…¶ä¸­ç¬¬ä¸€ç¬¬äºŒä¸ªåˆ†åˆ«æ˜¯ <code>reducer</code> å‡½æ•°å’Œåˆå§‹å€¼ï¼Œç¬¬ä¸‰ä¸ªä¸€èˆ¬æ˜¯ä½¿ç”¨ä¸­é—´ä»¶æ—¶ç”¨åˆ°ï¼Œæˆ‘ä»¬åé¢ä¼šç”¨åˆ°ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€æ¢è®¨ã€‚ï¼ˆç‚¹<a href="https://redux.js.org/api/createstore">è¿™é‡Œ</a>äº†è§£æ›´å¤šï¼‰</p>
<p><code>Reducer</code> å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•° <code>reducer(state, action)</code>ï¼Œåˆ†åˆ«æ˜¯ <strong>previousStateï¼ˆæ—§çŠ¶æ€ï¼‰</strong> å’Œ <strong>Action</strong>ã€‚åœ¨é¦–æ¬¡æ‰§è¡Œ <code>state</code> ä¸º <code>undefined</code>ï¼Œå¯ä»¥ä¸ºå®ƒè®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œæˆ–è€…åœ¨ <code>createStore</code> ä¸­ä¼ å…¥ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array.prototype.reduce()</a>ã€‚</p>
<p>å€ŸåŠ©æˆ‘ä»¬åœ¨ <code>Home</code> ç»„ä»¶ä¸‹å¼•å…¥ <code>store</code>ï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªæŒ‰é’®ï¼Œå¯¹ <code>store</code> çš„ <code>state</code> åšåŠ å‡æ“ä½œã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-f0a44fb96c31ed6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<h3>è‡³æ­¤</h3>
<p>æˆ‘ä»¬æœ€ç®€å• redux æ¡ˆä¾‹å®ç°äº†ï¼Œä½†æ˜¯è¿™ä¸ªè·ç¦»æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜ä¸å¤Ÿå“¦ã€‚</p>
<p>åœ¨æ­¤æŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¦‚ä½•æ¥å…¥æˆ‘ä»¬çš„ Component äº†ï¼Œå½“ state å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿å…¶è‡ªåŠ¨æ›´æ–° Viewï¼Ÿ</li>
<li>ç»„ä»¶å¦‚ä½•å…±äº« Storeï¼Ÿ</li>
<li>å¦‚ä½•æŸ¥çœ‹ State çš„å˜åŒ–ï¼Ÿ</li>
</ul>
<p>ä¸‹æ–‡ç»§ç»­ï¼Œæœªå®Œå¾…ç»­â€¦</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆå…­ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/59</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/59</guid>
            <pubDate>Sat, 25 Feb 2023 11:35:05 GMT</pubDate>
            <description><![CDATA[<p>åœ¨è®²è§£ <strong>react-hot-loader</strong> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠ react å¤§è‡´çš„æ¡†æ¶æ­å»ºå¥½ã€‚åŒ…æ‹¬ <strong>react-router</strong>ã€<strong>redux</strong>ã€<strong>react-redux</strong>ã€<strong>red]]></description>
            <content:encoded><![CDATA[<p>åœ¨è®²è§£ <strong>react-hot-loader</strong> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠ react å¤§è‡´çš„æ¡†æ¶æ­å»ºå¥½ã€‚åŒ…æ‹¬ <strong>react-router</strong>ã€<strong>redux</strong>ã€<strong>react-redux</strong>ã€<strong>redux-saga</strong> ç­‰ã€‚</p>
<p>æœ¬ç¯‡ä¸»è¦ä»‹ç» <strong><a href="https://react-router.docschina.org/">react-router-v4</a></strong> æ­å»ºã€‚</p>
<h3>é¡¹ç›®ç»“æ„è°ƒæ•´</h3>
<p>å¦‚å›¾ï¼Œç›®å‰æ‰€æœ‰æ–°å¢ç›®å½•å¹¶æ²¡æœ‰å†…å®¹ï¼Œä»…è°ƒæ•´äº†å…¥å£æ–‡ä»¶ <code>index.js</code> è·¯å¾„ï¼Œä»¥åŠåˆ é™¤äº†ç”¨å¤„ä¸å¤§çš„ <code>main.js</code>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d2f595a6c3d836df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>*è°ƒæ•´åï¼Œè¯·ä¿®æ”¹ <code>webpack.config.js</code> çš„å…¥å£æ–‡ä»¶ï¼ˆ<code>entry</code>ï¼‰è·¯å¾„ï¼Œä»¥åŠä¿®æ”¹ CSS çš„å¯¼å…¥è·¯å¾„ç­‰ï¼Œå¦åˆ™ä¼šç¼–è¯‘å¤±è´¥ã€‚</p>
<h3>react-router æ­å»º</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ˜¯å•é¡µ Web åº”ç”¨ï¼ˆsimple-page web applicationï¼Œ<code>SPA</code>ï¼‰ï¼Œå®ƒè·Ÿæˆ‘ä»¬ä¼ ç»Ÿçš„ä¸€ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ª HTML ä¸å¤ªä¸€æ ·ã€‚</p>
<p>å•é¡µåº”ç”¨çš„è·¯ç”±è·³è½¬ï¼š</p>
<ul>
<li>æµè§ˆå™¨çš„ url å‘ç”Ÿæ”¹å˜ï¼Œä½†å…¶å®å¹¶æ²¡æœ‰å‘é€è¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚</li>
<li>æ ¹æ®æˆ‘ä»¬é…ç½®çš„è·¯ç”±ä¿¡æ¯ï¼Œæ¯æ¬¡åˆ‡æ¢è·¯ç”±ï¼Œä¼šæ ¹æ®é…ç½®æ¥åŠ è½½ä¸åŒçš„ç»„ä»¶ï¼ŒåŒæ—¶ url åœ°å€ä¹Ÿä¼šå‘é€å˜åŒ–ã€‚</li>
<li>ä¸»è¦æœ‰ <code>HashRouter</code> å’Œ <code>BrowserRouter</code> ä¸¤ç§æ¨¡å¼ã€‚</li>
<li>åŸç†å…¶å®å°±æ˜¯ä½¿ç”¨ HTML5 history API æ¥ä½¿ä½ çš„å†…å®¹éšç€ url åŠ¨æ€æ”¹å˜ã€‚</li>
</ul>
<p>ä¸»è¦è·¯çº¿æ˜¯ï¼š</p>
<blockquote>
<p><strong>index.html</strong> â†’ <strong>index.js</strong> â†’ <strong>App.js</strong> â†’ <strong>router é…ç½®</strong> â†’ <strong>åŠ è½½æ‰€åŒ¹é…çš„ç»„ä»¶ xxxComponent.js</strong></p>
</blockquote>
<p>æˆ‘ä»¬çš„æ¨¡æ¿ HTML é‡Œé¢æœ‰ä¸ª <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code> æ ‡ç­¾ä½œä¸ºå®¹å™¨ï¼Œæ¥ç€æˆ‘ä»¬åœ¨å…¥å£æ–‡ä»¶ <code>index.js</code> é€šè¿‡ <code>react-dom</code> çš„ <code>render</code> å‡½æ•°å°†æˆ‘ä»¬çš„ <code>App.js</code> ç»„ä»¶æ’å…¥åˆ°å…¶ä¸­ã€‚è€Œ <code>App.js</code> å°±æ˜¯æˆ‘ä»¬è·¯ç”±çš„æ ¹ç»„ä»¶ï¼Œç„¶åæˆ‘ä»¬çš„è·¯ç”±ï¼Œåˆæ ¹æ®é…ç½®åŠ è½½å¯¹åº”çš„ <code>xxxComponent.js</code> å­ç»„ä»¶ã€‚</p>
<h5>1. å®‰è£… react-router-dom</h5>
<p><code>react-router-dom</code> åŸºäº <code>react-router</code>ï¼ŒåŠ å…¥äº†åœ¨æµè§ˆå™¨è¿è¡Œç¯å¢ƒä¸‹çš„ä¸€äº›åŠŸèƒ½ã€‚æˆ‘ä»¬æ— éœ€å†å®‰è£… <code>react-router</code> äº†ï¼Œå› ä¸ºåœ¨ <code>yarn add react-router-dom</code> æ—¶ï¼Œå®ƒå°±ä¼šå¸®æˆ‘ä»¬å®‰è£…äº†ã€‚</p>
<pre><code class="language-shell">$ yarn add react-router-dom@5.2.0
</code></pre>
<h5>2. åˆ›å»º Appã€Homeã€Aboutã€404 ç»„ä»¶</h5>
<p>App ç»„ä»¶</p>
<pre><code class="language-jsx">// App.js
import React, { Component } from 'react'
import { BrowserRouter, HashRouter as Router, Route, Switch, Link } from 'react-router-dom'
import { Home, About, NotFound } from './index'

class App extends Component {
  render() {
    return (
      &lt;Router&gt;
        &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; exact component={Home} /&gt;
          &lt;Route path=&quot;/about&quot; exact component={About} /&gt;
          &lt;Route component={NotFound} /&gt;
        &lt;/Switch&gt;
      &lt;/Router&gt;
    )
  }
}

export default App
</code></pre>
<p>Home ç»„ä»¶</p>
<pre><code class="language-jsx">// pages/home/index.js
import React, { Component } from 'react'

class Home extends Component {
    constructor(props) {
        super(props)
        this.state = {}
    }

    render() {
        return &lt;div&gt;Home Componentï¼&lt;/div&gt;
    }
}

export default Home
</code></pre>
<p>About ç»„ä»¶</p>
<pre><code class="language-jsx">// pages/about/index.js
import React, { Component } from 'react'

class About extends Component {
    constructor(props) {
        super(props)
        this.state = {}
    }

    render() {
        return &lt;div&gt;About Componentï¼&lt;/div&gt;
    }
}

export default About
</code></pre>
<p>404 ç»„ä»¶</p>
<pre><code class="language-jsx">// pages/404.js
import React, { Component } from 'react'
import { Link } from 'react-router-dom'

class NotFound extends Component {
  constructor(props) {
    super(props)
    this.state = {}
  }

  render() {
    return &lt;div&gt;Page not found! &lt;br /&gt; &lt;Link to=&quot;/&quot;&gt;Go back&lt;/Link&gt;&lt;/div&gt;
  }
}

export default NotFound
</code></pre>
<pre><code class="language-js">// pages/index.js
export { default as Home } from './home'
export { default as About } from './about'
export { default as NotFound } from './404'
</code></pre>
<h5>3. ä¿®æ”¹ src/index.jsï¼Œä»¥åŠæ–°å¢ src/Root.js</h5>
<pre><code class="language-jsx">// Root.js
import React from 'react'
import App from './pages/App'

const Root = () =&gt; {
  return &lt;App /&gt;
}

export default Root
</code></pre>
<pre><code class="language-jsx">// index.js
import React from 'react'
import { render } from 'react-dom'
import '../styles/style.css'
import Root from './Root'

// æœ€ç®€å•çš„ React ç¤ºä¾‹
const rootElem = document.getElementById('app')
render(&lt;Root /&gt;, rootElem)
</code></pre>
<p>è¿™é‡Œè®¾è®¡å¤šä¸€å±‚ <code>Root</code> æ˜¯ä¸ºäº†åé¢å¼•å…¥ Redux æŠ½ç¦»ä»£ç ï¼Œçœ‹èµ·æ¥æ›´åŠ ç®€æ´ä¸€äº›ã€‚</p>
<p>æœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-c2b2c498e068df33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>è‡³æ­¤ï¼Œæ•ˆæœå‡ºæ¥äº†</h3>
<p>å¥½äº†ï¼Œæˆ‘ä»¬çš„ react-router åŸºæœ¬æ­å»ºå¥½äº†ã€‚</p>
<p>åˆ‡æ¢è·¯ç”±ï¼Œ<a href="http://localhost:8080/#/about">http://localhost:8080/#/about</a> å°±èƒ½çœ‹åˆ°é¡µé¢åŠ è½½äº† <code>About Component!</code>ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-ef5461a7255c0428.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<hr>
<h3>å…³äº react-router ç›¸å…³çš„è¡¥å……è¯´æ˜</h3>
<ol>
<li>react-router ç›¸å…³ API å¯¼å…¥é—®é¢˜ï¼š</li>
</ol>
<pre><code class="language-jsx">// 1ï¸âƒ£ å†™æ³•ä¸€ï¼ˆæ¨èï¼‰
import { Swtich, Route, Router, HashHistory, Link } from 'react-router-dom'

// 2ï¸âƒ£ å†™æ³•äºŒï¼ŒäºŒè€…æ˜¯ç­‰ä»·çš„
import { Switch, Route, Router } from 'react-router'
import { HashHistory, Link } from 'react-router-dom'

// ************************************************************************
// Why?
// æˆ‘ä»¬ä»æºç é‡Œé¢å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¿™ä¸€æ®µä»£ç ï¼ˆæˆªå–ï¼‰ï¼Œ
// æ¯”å¦‚ Switchï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯å¼•ç”¨äº† react-router çš„ Switch.
// æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨â€œå†™æ³•ä¸€â€å³å¯
Object.defineProperty(exports, 'Switch', {
  enumerable: true,
  get: function () {
    return reactRouter.Switch;
  }
});
exports.BrowserRouter = BrowserRouter;
exports.HashRouter = HashRouter;
exports.Link = Link;
exports.NavLink = NavLink;
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆäº”ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/58</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/58</guid>
            <pubDate>Sat, 25 Feb 2023 11:32:06 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»å®Œ HMR çƒ­æ›´æ–°ä¹‹åï¼Œæ¥ç€æˆ‘ä»¬ä¼šè®²è§£ React é¡¹ç›®æ­å»ºã€‚</p>
<h3>é¢˜å¤–è¯</h3>
<p>é¦–å…ˆå®˜æ–¹æä¾›äº†ä¸€ä¸ª <a href="https://github.com/facebook/create-react-app">create-react-app</a> è„šæ‰‹æ¶å·¥å…·æ¥åˆ›å»º React]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»å®Œ HMR çƒ­æ›´æ–°ä¹‹åï¼Œæ¥ç€æˆ‘ä»¬ä¼šè®²è§£ React é¡¹ç›®æ­å»ºã€‚</p>
<h3>é¢˜å¤–è¯</h3>
<p>é¦–å…ˆå®˜æ–¹æä¾›äº†ä¸€ä¸ª <a href="https://github.com/facebook/create-react-app">create-react-app</a> è„šæ‰‹æ¶å·¥å…·æ¥åˆ›å»º React é¡¹ç›®ã€‚</p>
<p>*æœ¬é¡¹ç›®ä¸é‡‡ç”¨è¯¥è„šæ‰‹æ¶è¿›è¡Œæ­å»ºã€‚
*ä¸‹é¢ä½¿ç”¨ npm ä¸¾ä¾‹ï¼Œä¸ yarn å¤§åŒå°å¼‚ã€‚
*ä»…ç®€è¿°ï¼Œä¸æ„Ÿå…´è¶£å¯è·³è¿‡è¯¥å†…å®¹ã€‚</p>
<pre><code class="language-shell"># å®‰è£… create-react-app
$ npm install -g create-react-app

# åˆ›å»ºé¡¹ç›®
$ create-react-app your_project

# æ‰“å¼€é¡¹ç›®
$ cd your_project

# è¿è¡Œé¡¹ç›®
$ npm run start

# é¡¹ç›®æ‰“åŒ…
$ npm run build

# è‡ªå®šä¹‰é…ç½®ï¼Œæ³¨æ„æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ˜¯ä¸å¯é€†çš„
$ npm run eject
</code></pre>
<blockquote>
<p>æˆ‘ä»¬é€šè¿‡ <code>create-react-app</code> åˆ›å»ºçš„é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°å®ƒåªæœ‰ <code>react</code>ã€<code>react-dom</code>ã€<code>react-scripts</code> ç­‰å°‘æ•°ä¾èµ–ã€‚å…¶å®ï¼Œå®ƒå°† <code>webpack</code>ã€<code>Babel</code>ã€<code>ESLint</code> ç­‰ä¾èµ–åŒ…é€šè¿‡ <code>creat-react-app</code> å°è£…åˆ°äº† <code>react-scripts</code> å½“ä¸­ï¼ŒåŒ…æ‹¬åŸºæœ¬å¯åŠ¨å‘½ä»¤éƒ½æ˜¯é€šè¿‡è°ƒç”¨ <code>react-scripts</code> è¿™ä¸ªä¾èµ–ä¸‹é¢çš„å‘½ä»¤æ¥å®Œæˆçš„ã€‚</p>
<p>é™¤äº† <code>start</code>ã€<code>build</code>ã€<code>test</code> å‘½ä»¤ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ª <code>&quot;eject&quot;: &quot;react-scripts eject&quot;</code> å‘½ä»¤ã€‚å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å®ƒä¼šå°†åŸæœ¬ <code>creat-react-app</code> å¯¹ <code>webpack</code>ã€<code>Babel</code>ã€<code>ESLint</code> ç­‰ç›¸å…³é…ç½®çš„å°è£…â€œå¼¹å‡ºâ€ã€‚å‡å¦‚æˆ‘ä»¬è¦å°†<code>creat-react-app</code> é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œç°æœ‰ç›®å½•ä¸‹æ˜¯æ²¡æœ‰åœ°æ–¹ä¿®æ”¹çš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>npm run eject</code> å‘½ä»¤å°†åŸæœ¬è¢«å°è£…åˆ°è„šæ‰‹æ¶å½“ä¸­çš„å‘½ä»¤å¼¹å°„å‡ºæ¥ï¼Œç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹çœ‹åˆ°å¾ˆå¤šé…ç½®æ–‡ä»¶ã€‚<strong>æ³¨æ„ï¼Œè¯¥å‘½ä»¤æ˜¯å•å‘æ“ä½œï¼Œä¸å¯é€†ã€‚</strong>ï¼ˆåœ¨ <code>README.md</code> ä¸­å¯¹æ­¤å‘½ä»¤æœ‰ç®€è¿°ã€‚ï¼‰</p>
</blockquote>
<h3>ä½¿ç”¨ Babel</h3>
<p><a href="https://www.babeljs.cn/docs/">Babel</a> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯ Babel èƒ½ä¸ºä½ åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>è¯­æ³•è½¬æ¢</li>
<li>é€šè¿‡ Polyfill æ–¹å¼åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ·»åŠ ç¼ºå¤±çš„ç‰¹æ€§ (é€šè¿‡Â <a href="https://www.babeljs.cn/docs/babel-polyfill">@babel/polyfill</a>Â æ¨¡å—ï¼Œbabel 7.4 å¼€å§‹åºŸå¼ƒ <code>@babel/polyfill</code>)</li>
<li>æºç è½¬æ¢ (codemods)</li>
<li>æ›´å¤šï¼ (æŸ¥çœ‹è¿™äº›Â <a href="https://www.babeljs.cn/videos.html">è§†é¢‘</a>Â è·å¾—å¯å‘)</li>
</ul>
</blockquote>
<h5>babel é…ç½®</h5>
<ol>
<li>å®‰è£…ä¾èµ–</li>
</ol>
<pre><code class="language-shell">$ yarn add --dev babel-loader@8.0.6 @babel-core/core@7.7.4
</code></pre>
<ol start="2">
<li>æ·»åŠ  <code>module.rules</code> é…ç½®</li>
</ol>
<pre><code class="language-js">// webpack.config.js
{
  test: /\.js$/,
  exclude: /node_modules/,
  use: 'babel-loader'
}
</code></pre>
<ol start="3">
<li>åˆ›å»º <code>.babelrc</code> é…ç½®æ–‡ä»¶
æˆ‘ä»¬å·²ç»é…ç½®äº† Babelï¼Œä½†å®é™…ä¸Šå¹¶æœªåšä»»ä½•äº‹æƒ…ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>.babelrc</code> é…ç½®æ–‡ä»¶ï¼ˆJSONï¼‰ï¼Œå¹¶å¯ç”¨ä¸€äº›é¢„è®¾å’Œæ’ä»¶ã€‚</li>
</ol>
<ul>
<li><strong>@babel/preset-env</strong>ï¼šè§£æ ES6 è¯­æ³•ï¼Œå®ƒåªåšè¯­æ³•è½¬æ¢ï¼Œå¦‚ <code>const</code>ã€<code>let</code>ã€‚å®ƒå¹¶ä¸å¤„ç† <code>includes</code>ã€<code>Promise</code> ç­‰ apiã€‚</li>
<li><strong>@babel/preset-react</strong>ï¼šè§£æ JSX è¯­æ³•ã€‚</li>
<li><strong>@babel/plugin-transform-runtime</strong>ï¼šè§£å†³å…¨å±€å˜é‡æ±¡æŸ“ï¼Œä»¥åŠé‡å¤å£°æ˜ helper å‡½æ•°çš„é—®é¢˜ã€‚</li>
</ul>
<pre><code>$ yarn add --dev @babel/preset-env@7.7.4
$ yarn add --dev @babel/preset-react@7.7.4
$ yarn add --dev @babel/plugin-transform-runtime@7.7.4
$ yarn add --dev core-js@3.6.0
</code></pre>
<pre><code class="language-json5">// .babelrc
{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      {
        &quot;modules&quot;: false, // å°† ESM è½¬åŒ–ä¸ºå…¶ä»–æ¨¡å—è§„èŒƒï¼Œé»˜è®¤å€¼ falseã€‚
        &quot;useBuiltIns&quot;: &quot;usage&quot;, // æŒ‰éœ€åŠ è½½
        &quot;corejs&quot;: 3, // Babel å»ºè®®ä½¿ç”¨ useBuiltIns é€‰é¡¹æ—¶æ˜¾å¼è®¾ç½® core-js ç‰ˆæœ¬
        &quot;debug&quot;: false // æ‰“å°æ’ä»¶ä½¿ç”¨æƒ…å†µ
      }
    ],
    &quot;@babel/preset-react&quot; // è§£æ JSX è¯­æ³•
  ],
  &quot;plugins&quot;: [&quot;@babel/plugin-transform-runtime&quot;]
}
</code></pre>
<p>*å…³äº <code>.babelrc</code> ç›¸å…³é¢„è®¾ä¸æ’ä»¶è¯¦è§£ï¼Œåœ¨åç»­ä¼šä¸“é—¨å‡ºä¸€ç¯‡æ–‡ç« æ•´ç†ä»‹ç»ï¼›
*é¡ºåºé—®é¢˜ï¼š1 Plugins åœ¨ Presets å‰è¿è¡Œï¼›2 Plugins æŒ‰ç…§å£°æ˜æ¬¡åºé¡ºåºæ‰§è¡Œï¼›3 Presets æŒ‰ç…§å£°æ˜æ¬¡åºé€†åºæ‰§è¡Œã€‚</p>
<h3>React</h3>
<ol>
<li>é¦–å…ˆå®‰è£… <code>react</code>ã€<code>react-dom</code> ä¾èµ–åŒ…ã€‚</li>
</ol>
<pre><code>$ yarn add react@16.12.0 react-dom@16.12.0
</code></pre>
<blockquote>
<p>æ’ä¸ªè¯é¢˜ï¼š<strong>ä¸ºä»€ä¹ˆ react å’Œ react-dom è¦åˆ†æˆä¸¤ä¸ªåŒ…ï¼Ÿ</strong></p>
<p>å¯¹äºå…·æœ‰è·¨å¹³å°èƒ½åŠ›çš„ React ä½“ç³»æ¥è¯´ï¼Œåˆ†åŒ…å¯ä»¥å°†æŠ½è±¡é€»è¾‘ä¸å¹³å°å®ç°åˆ†å¼€ã€‚</p>
<ul>
<li>react åŒ…å³æ˜¯æŠ½è±¡é€»è¾‘ï¼Œå®ƒåŒ…å«äº† React çš„ä¸»å¹²é€»è¾‘ã€‚ä¾‹å¦‚ç»„ä»¶å®ç°ã€æ›´æ–°è°ƒåº¦ç­‰ã€‚</li>
<li>react-dom é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ç§é’ˆå¯¹ dom çš„å¹³å°å®ç°ï¼Œä¸»è¦ç”¨äºåœ¨ web ç«¯è¿›è¡Œæ¸²æŸ“ã€‚è€Œå£°ååœ¨å¤–çš„ React Native åˆ™æ˜¯åŸç”Ÿåº”ç”¨å®ç°ï¼Œå¯ä»¥é€šè¿‡ React Native å†…éƒ¨çš„ç›¸åº”æœºåˆ¶ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡æ¥è°ƒç”¨åŸç”Ÿæ§ä»¶è¿›è¡Œæ¸²æŸ“ã€‚</li>
</ul>
<p>*ä»¥ä¸Šç®€è¿°æ¥è‡ªçŸ¥ä¹ <a href="https://www.zhihu.com/question/336664883/answer/764067842">Shockw4ver</a> å›ç­”ã€‚</p>
</blockquote>
<ol start="2">
<li>å¼•å…¥ react</li>
</ol>
<pre><code class="language-jsx">// index.js
import React from 'react'
import { render } from 'react-dom'
import './main.js'
import './style.css'

// æœ€ç®€å•çš„ React ç¤ºä¾‹
const rootElem = document.getElementById('app')
render(&lt;div&gt;Hello React!&lt;/div&gt;, rootElem)

if(module.hot) {
  module.hot.accept('./main.js', () =&gt; {
    console.log('Accept updateï¼')
  })
}
</code></pre>
<pre><code class="language-html">&lt;!-- index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;
    &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>è‡³æ­¤ï¼Œæœ€ç®€å•çš„ React ç¤ºä¾‹å·²ç»æˆåŠŸäº†ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-5ef2d2254d092904.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šå…ˆä»‹ç»æ¥å…¥ <code>react-hot-loader</code> å®ç° react çš„å±€éƒ¨åˆ·æ–°é—®é¢˜ã€‚</p>
<h3>æœ€åé™„ä¸Š</h3>
<pre><code class="language-json5">// package.json
{
  &quot;name&quot;: &quot;webpack4_demo&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®&quot;,
  &quot;main&quot;: &quot;src/index.js&quot;,
  &quot;repository&quot;: &quot;git@github.com:toFrankie/webpack4_demo.git&quot;,
  &quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server --config webpack.config.js --colors&quot;,
    &quot;build&quot;: &quot;webpack --config webpack.config.js --progress --colors --mode=production&quot;
  },
  &quot;dependencies&quot;: {
    &quot;react&quot;: &quot;16.12.0&quot;,
    &quot;react-dom&quot;: &quot;16.12.0&quot;,
    &quot;webpack&quot;: &quot;4.41.2&quot;,
    &quot;webpack-cli&quot;: &quot;3.3.10&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@babel/core&quot;: &quot;7.7.4&quot;,
    &quot;@babel/plugin-transform-runtime&quot;: &quot;7.7.4&quot;,
    &quot;@babel/preset-env&quot;: &quot;7.7.4&quot;,
    &quot;@babel/preset-react&quot;: &quot;7.7.4&quot;,
    &quot;babel-loader&quot;: &quot;8.0.6&quot;,
    &quot;clean-webpack-plugin&quot;: &quot;3.0.0&quot;,
    &quot;core-js&quot;: &quot;3.6.0&quot;,
    &quot;css-loader&quot;: &quot;3.2.0&quot;,
    &quot;html-webpack-plugin&quot;: &quot;3.2.0&quot;,
    &quot;style-loader&quot;: &quot;1.0.0&quot;,
    &quot;webpack-dev-server&quot;: &quot;3.9.0&quot;
  }
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆå››ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/57</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/57</guid>
            <pubDate>Sat, 25 Feb 2023 11:31:06 GMT</pubDate>
            <description><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•æ‰“åŒ…æˆ HTML æ–‡ä»¶ï¼Œæ¥ç€æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•æ­å»ºå¼€å‘ç¯å¢ƒä¹‹<strong>çƒ­æ›´æ–°</strong>ã€‚</p>
<h3>ä½¿ç”¨ source-map</h3>
<p>å¦‚æœæŒ‰ç…§é»˜è®¤çš„ production æ¨¡å¼æ‰“åŒ…ä»£ç æ˜¯ï¼Œå¯èƒ½ä¼šå¾ˆéš¾è¿½è¸ªé”™è¯¯å’Œè­¦å‘Šåœ¨æºä»£ç ä¸­çš„åŸå§‹ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸‰ä¸ªæºæ–‡ä»¶ï¼ˆ<code]]></description>
            <content:encoded><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•æ‰“åŒ…æˆ HTML æ–‡ä»¶ï¼Œæ¥ç€æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•æ­å»ºå¼€å‘ç¯å¢ƒä¹‹<strong>çƒ­æ›´æ–°</strong>ã€‚</p>
<h3>ä½¿ç”¨ source-map</h3>
<p>å¦‚æœæŒ‰ç…§é»˜è®¤çš„ production æ¨¡å¼æ‰“åŒ…ä»£ç æ˜¯ï¼Œå¯èƒ½ä¼šå¾ˆéš¾è¿½è¸ªé”™è¯¯å’Œè­¦å‘Šåœ¨æºä»£ç ä¸­çš„åŸå§‹ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸‰ä¸ªæºæ–‡ä»¶ï¼ˆ<code>a.js</code>, <code>b.js</code> å’Œ <code>c.js</code>ï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ª <code>bundleï¼ˆbundle.jsï¼‰</code>ä¸­ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªæºæ–‡ä»¶åŒ…å«ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆå †æ ˆè·Ÿè¸ªå°±ä¼šç›´æ¥æŒ‡å‘åˆ° <code>bundle.js</code>ã€‚ä½ å¯èƒ½éœ€è¦å‡†ç¡®åœ°çŸ¥é“é”™è¯¯æ¥è‡ªäºå“ªä¸ªæºæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ç§æç¤ºè¿™é€šå¸¸ä¸ä¼šæä¾›å¤ªå¤šå¸®åŠ©ã€‚</p>
<p>ä¸ºäº†æ›´å®¹æ˜“åœ°è¿½è¸ª error å’Œ warningï¼ŒJavaScript æä¾›äº†Â <a href="http://blog.teamtreehouse.com/introduction-source-maps">source maps</a>Â åŠŸèƒ½ï¼Œå¯ä»¥å°†ç¼–è¯‘åçš„ä»£ç æ˜ å°„å›åŸå§‹æºä»£ç ã€‚å¦‚æœä¸€ä¸ªé”™è¯¯æ¥è‡ªäºÂ <code>b.js</code>ï¼Œsource map å°±ä¼šæ˜ç¡®çš„å‘Šè¯‰ä½ ã€‚</p>
<p>source map æœ‰è®¸å¤š<a href="https://webpack.docschina.org/configuration/devtool">å¯ç”¨é€‰é¡¹</a>ï¼Œè¯·åŠ¡å¿…ä»”ç»†é˜…è¯»å®ƒä»¬ï¼Œä»¥ä¾¿å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ã€‚</p>
<p>å¯¹äºæœ¬æŒ‡å—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Â <code>eval-source-map</code>Â é€‰é¡¹ï¼Œè¿™æœ‰åŠ©äºè§£é‡Šè¯´æ˜ç¤ºä¾‹æ„å›¾ï¼ˆæ­¤é…ç½®ä»…ç”¨äºç¤ºä¾‹ï¼Œä¸è¦ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰ï¼š</p>
<h3>é€‰æ‹©ä¸€ä¸ªå·¥å…·</h3>
<p>åœ¨æ¯æ¬¡ç¼–è¯‘ä»£ç æ—¶ï¼Œæ‰‹åŠ¨è¿è¡Œ <code>yarn run build</code> ä¼šæ˜¾å¾—ç‰¹åˆ«éº»çƒ¦ã€‚</p>
<p>webpack æä¾›äº†å‡ ç§å¯é€‰æ–¹å¼ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ä»£ç å‘ç”Ÿå˜åŒ–åè‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼š</p>
<ul>
<li><strong>webpack watch mode</strong>ï¼ˆwebpack è§‚å¯Ÿæ¨¡å¼ï¼‰</li>
<li><strong>webpack-dev-server</strong></li>
<li><strong>webpack-dev-middleware</strong></li>
</ul>
<p>webpack å¯ä»¥åœ¨ <code>watch mode</code>ï¼ˆè§‚å¯Ÿæ¨¡å¼ï¼‰ä¸‹ä½¿ç”¨ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œwebpack å°†ç›‘è§†æ‚¨çš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ›´æ”¹æ—¶é‡æ–°ç¼–è¯‘ã€‚
<code>webpack-dev-server</code> æä¾›äº†ä¸€ä¸ªæ˜“äºéƒ¨ç½²çš„å¼€å‘æœåŠ¡å™¨ï¼Œå…·æœ‰å¿«é€Ÿçš„å®æ—¶é‡è½½ï¼ˆlive reloadingï¼‰åŠŸèƒ½ã€‚
å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨å¹¶ä¸”éœ€è¦å®Œå…¨çš„çµæ´»æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <code>webpack-dev-middleware</code> ä½œä¸ºä¸­é—´ä»¶ã€‚</p>
<p><code>webapck-dev-server</code> å’Œ <code>webpack-dev-middleware</code> ä½¿ç”¨å†…å­˜ç¼–è¯‘ï¼Œè¿™æ„å‘³ç€ <code>bundle</code> ä¸ä¼šè¢«ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚è¿™ä½¿å¾—ç¼–è¯‘ååˆ†è¿…é€Ÿï¼Œå¹¶å¯¼è‡´ä½ çš„æ–‡ä»¶ç³»ç»Ÿæ›´å°‘éº»çƒ¦ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½ ä¼šæƒ³è¦ä½¿ç”¨ <code>webpack-dev-server</code>ï¼Œå› ä¸ºè¿™æ˜¯æœ€ç®€å•çš„å¼€å§‹çš„æ–¹å¼ï¼Œå¹¶ä¸”æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚æœ¬é¡¹ç›®ä¸­ä¹Ÿå°†ä¼šä½¿ç”¨åˆ°å®ƒã€‚</p>
<h3>ç®€å•é…ç½® webpack-dev-server</h3>
<pre><code class="language-shell"># å®‰è£…
$ yarn add webpack-dev-server@3.9.0 --dev

</code></pre>
<pre><code class="language-js">// ä¿®æ”¹ webpack.config.js é…ç½®
devServer: {
  contentBase: './dist',
  open: true
}
</code></pre>
<pre><code class="language-json5">// åœ¨ package.json æ·»åŠ  npm script
&quot;scripts&quot;: {
	&quot;dev&quot;: &quot;webpack-dev-server --config webpack.config.js --colors&quot;
}
</code></pre>
<p>ä»¥ä¸Šé…ç½®å‘ŠçŸ¥ <code>webpack-dev-server</code>ï¼Œå°† <code>dist</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ <code>serve</code> åˆ° <code>localhost:8080</code> ä¸‹ã€‚ï¼ˆè¯‘æ³¨ï¼š<code>serve</code>ï¼Œå°†èµ„æºä½œä¸º <code>server</code> çš„å¯è®¿é—®æ–‡ä»¶ï¼‰ã€‚</p>
<p>ç°åœ¨ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>yarn run dev</code>ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æµè§ˆå™¨è‡ªåŠ¨åŠ è½½é¡µé¢ã€‚å¦‚æœä½ æ›´æ”¹ä»»ä½•æºæ–‡ä»¶å¹¶ä¿å­˜å®ƒä»¬ï¼Œweb server å°†åœ¨ç¼–è¯‘ä»£ç åè‡ªåŠ¨é‡æ–°åŠ è½½ã€‚</p>
<p>ä½†æ˜¯åŒæ—¶å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œæ¯æ¬¡æ›´æ”¹æ–‡ä»¶é¡µé¢ä¼šé‡æ–°åŠ è½½ï¼Œä½†æ˜¯è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯<strong>æ¨¡å—çƒ­æ›¿æ¢</strong>ï¼ˆ<code>hot module replacement</code>ï¼‰ã€‚</p>
<h3>HMR æ¨¡å—çƒ­æ›¿æ¢é…ç½®</h3>
<p>*<strong>é¦–å…ˆå®ƒä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä»…åº”ç”¨äºå¼€å‘ç¯å¢ƒã€‚</strong></p>
<p>æ¨¡å—çƒ­æ›¿æ¢åŠŸèƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤<a href="https://webpack.docschina.org/concepts/modules/">æ¨¡å—</a>ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚ä¸»è¦æ˜¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æ˜¾è‘—åŠ å¿«å¼€å‘é€Ÿåº¦ï¼š</p>
<ul>
<li>ä¿ç•™åœ¨å®Œå…¨é‡æ–°åŠ è½½é¡µé¢æœŸé—´ä¸¢å¤±çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚</li>
<li>åªæ›´æ–°å˜æ›´å†…å®¹ï¼Œä»¥èŠ‚çœå®è´µçš„å¼€å‘æ—¶é—´ã€‚</li>
<li>åœ¨æºä»£ç ä¸­ CSS/JS äº§ç”Ÿä¿®æ”¹æ—¶ï¼Œä¼šç«‹åˆ»åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæ›´æ–°ï¼Œè¿™å‡ ä¹ç›¸å½“äºåœ¨æµè§ˆå™¨ devtools ç›´æ¥æ›´æ”¹æ ·å¼ã€‚</li>
</ul>
<pre><code class="language-js">// webpack.config.js
const config = {
  // ... å…¶ä»–å·²æœ‰é…ç½®ä¸å˜
  devServer: {
    contentBase: './dist',
    hot: true,
    open: true
  },
  plugins: [
    // åœ¨ webpack 4 ä¸­å…¶å®å·²è¢«å¼ƒç”¨ï¼Œå–ä»£å®ƒçš„æ˜¯ optimization.namedModules åç»­çš„æ–‡ç« ä¼šè®²è§£åˆ°
    // new webpack.NamedModulesPlugin(),
    new webpack.HotModuleReplacementPlugin()
  ]
}
</code></pre>
<p>æˆ‘ä»¬åœ¨å…¥å£æ–‡ä»¶ <code>index.js</code> å¼•å…¥ <code>main.js</code>ã€‚</p>
<pre><code class="language-js">// main.js
console.log('This is main.js')
</code></pre>
<p>æˆ‘ä»¬æ¥ä¿®æ”¹ <code>index.js</code>æ–‡ä»¶ï¼Œä»¥ä¾¿å½“ <code>main.js</code> å†…éƒ¨å‘ç”Ÿå˜æ›´æ—¶å¯ä»¥å‘Šè¯‰ webpack æ¥å—æ›´æ–°çš„æ¨¡å—ã€‚</p>
<pre><code class="language-js">// index.js
import './main.js'

console.log('Hello Webpack!')

if(module.hot) {
    module.hot.accept('./main.js', () =&gt; {
        console.log('Accept updateï¼')
    })
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè‹¥ä¿®æ”¹äº† webpack é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°æ‰§è¡Œ <code>yarn run dev</code> ä½¿å…¶ç”Ÿæ•ˆã€‚</p>
</blockquote>
<p>å½“æˆ‘ä»¬ä¿®æ”¹ <code>main.js</code> æŒ‰ä¸‹ä¿å­˜ä¹‹åï¼Œä¼šçœ‹åˆ°æµè§ˆå™¨æ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">[WDS] App updated. Recompiling...
[WDS] App hot update...
[HMR] Checking for updates on the server...
This is main.js.
We modified the main.js file.
Accept updateï¼
[HMR] Updated modules:
[HMR]  - ./src/main.js
[HMR] App is up to date.
</code></pre>
<h3>HMR åŠ è½½æ ·å¼</h3>
<p>å€ŸåŠ©äº <code>style-loader</code>ï¼Œä½¿ç”¨æ¨¡å—çƒ­æ›¿æ¢æ¥åŠ è½½ CSS å®é™…ä¸Šæå…¶ç®€å•ã€‚æ­¤ loader åœ¨å¹•åä½¿ç”¨äº† <code>module.hot.accept</code>ï¼Œåœ¨ CSS ä¾èµ–æ¨¡å—æ›´æ–°ä¹‹åï¼Œä¼šå°†å…¶ patch(ä¿®è¡¥) åˆ° <code>&lt;style&gt;</code> æ ‡ç­¾ä¸­ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¯´è¿‡ webpack åªèƒ½è¯»å– JavaScript å’Œ JSON æ–‡ä»¶ï¼Œå…¶ä»–ç±»å‹çš„æ–‡ä»¶éœ€è¦å€ŸåŠ©å¯¹åº”çš„ loader æ¥å¤„ç†ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸¤ä¸ª loader ã€‚</p>
<pre><code class="language-shell">$ yarn add --dev css-loader@3.2.0 style-loader@1.0.0
</code></pre>
<p>æ›´æ–° webpack é…ç½®æ–‡ä»¶</p>
<pre><code class="language-js">// webpack.config.js
const config = {  
  module: {
    rules: [
      {
        test: /\.css/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}

module.exports = config
</code></pre>
<p>æˆ‘ä»¬åœ¨ <code>src</code> ç›®å½•ä¸‹æ–°å¢ <code>style.css</code> æ–‡ä»¶ï¼Œå¹¶åœ¨ <code>index.js</code> ä¸­å¼•å…¥ã€‚</p>
<pre><code class="language-css">/* style.css */
body {
    font-size: 30px;
}
</code></pre>
<pre><code class="language-js">// index.js
import './main.js'
import './style.css'

console.log('Hello Webpack!')

if(module.hot) {
    module.hot.accept('./main.js', () =&gt; {
        console.log('Accept updateï¼')
    })
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬è¯•ç€ä¿®æ”¹ <code>style.css</code> çš„æ ·å¼ï¼Œå°±èƒ½çœ‹åˆ°é¡µé¢å­—ä½“å¤§å°éšä¹‹æ›´æ”¹ï¼Œè€Œæ— éœ€å®Œå…¨åˆ·æ–°ã€‚</p>
<h3>è‡³æ­¤</h3>
<p>æˆ‘ä»¬æœ€ç®€å•çš„ HMR å·²ç»é…ç½®å¥½äº†ï¼Œæ¥ç€æˆ‘ä»¬å°†ä¼šä»‹ç»æ¥å…¥ React ã€‚</p>
<h3>æœ€åé™„ä¸Š</h3>
<pre><code class="language-js">// webpack.config.js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const webpack = require('webpack')

const config = {
  mode: 'development',
  devtool: 'eval-source-map',
  entry: {
    index: path.resolve(__dirname, './src/index.js')
  },
  devServer: {
    contentBase: './dist',
    hot: true,
    open: true
  },
  plugins: [
    new HtmlWebpackPlugin({
      title: 'å¼€å‘ç¯å¢ƒ', // æ¨¡æ¿è¦ä½¿ç”¨ &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt; é…ç½®æ‰ç”Ÿæ•ˆ
      template: './src/index.html', // æ¨¡æ¿è·¯å¾„
      filename: 'index.html', // è¾“å‡º HTML æ–‡ä»¶åç§°
      inject: 'body', // æ’å…¥çš„ script æ ‡ç­¾ä½äº body åº•éƒ¨ï¼Œtrue åŒç†
      hash: true, // åŠ ä¸Š hash å€¼
      favicon: './src/favicon.ico'
    }),
    // æ–°ç‰ˆæ— éœ€å†æŒ‡å®šåˆ é™¤ç›®å½•ï¼Œé»˜è®¤åˆ é™¤ output ç›®å½•
    new CleanWebpackPlugin(),
    // çƒ­æ›´æ–°
    new webpack.NamedModulesPlugin(),
    new webpack.HotModuleReplacementPlugin()
  ],
  module: {
    rules: [
      {
        test: /\.css/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}

module.exports = config
</code></pre>
<pre><code class="language-js">// index.js
import './main.js'
import './style.css'

console.log('Hello Webpack!')

if(module.hot) {
    module.hot.accept('./main.js', () =&gt; {
        console.log('Accept updateï¼')
    })
}
</code></pre>
<pre><code>// å½“å‰é¡¹ç›®ç›®å½•
webpack4_demo
  | - /assets
  | - /config
  | - /dist
    | - some outputh file
  | - /src
    | - favicon.ico
    | - index.html
    | - index.js
    | - main.js
    | - styles.css
  | - .gitignore
  | - package.json
  | - README.md
  | - webpack.config.js
  | - yarn.lock
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¸‰ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/56</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/56</guid>
            <pubDate>Sat, 25 Feb 2023 11:28:53 GMT</pubDate>
            <description><![CDATA[<p>æ¥ç€ç»§ç»­ä»‹ç» webpack é…ç½®</p>
<p>ä» webpack 4.0 å¼€å§‹ï¼Œwebpack å¯ä»¥é›¶é…ç½®å³å¯è¿›è¡Œæ‰“åŒ…ï¼Œé—¨æ§›è¿›ä¸€æ­¥é™ä½ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå¦‚æœç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæ‰§è¡Œ <code>yarn run build</code> å‘½ä»¤ï¼Œä¼šæœ‰ä¸€æ¡ <code>WRANI]]></description>
            <content:encoded><![CDATA[<p>æ¥ç€ç»§ç»­ä»‹ç» webpack é…ç½®</p>
<p>ä» webpack 4.0 å¼€å§‹ï¼Œwebpack å¯ä»¥é›¶é…ç½®å³å¯è¿›è¡Œæ‰“åŒ…ï¼Œé—¨æ§›è¿›ä¸€æ­¥é™ä½ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå¦‚æœç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæ‰§è¡Œ <code>yarn run build</code> å‘½ä»¤ï¼Œä¼šæœ‰ä¸€æ¡ <code>WRANING</code> ä¿¡æ¯ã€‚</p>
<blockquote>
<p>WARNING in configuration
The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
You can also set it to 'none' to disable any default behavior. Learn more: <a href="https://webpack.js.org/configuration/mode/">https://webpack.js.org/configuration/mode/</a></p>
</blockquote>
<p>å¤§æ¦‚æ„æ€ï¼Œ<code>mode</code> é€‰é¡¹æ²¡æœ‰é…ç½®ï¼Œ<code>webpack</code> ä¼šæŠŠ <code>production</code> æœ€ä¸ºé»˜è®¤é…ç½®ã€‚</p>
<p>æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ <code>package.json</code>ï¼Œç»™å®ƒæŒ‡å®šäº† <code>mode</code> é€‰é¡¹ï¼Œ<code>WARNING</code> å°±æ²¡æœ‰äº†ã€‚</p>
<pre><code class="language-json5">// package.json
{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack --progress --colors --mode=production&quot;
  }
}
</code></pre>
<p>é‚£ä¹ˆè¿™ <code>mode</code> æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé™¤äº†è¿™ä¸ªï¼Œè¿˜æœ‰ä»€ä¹ˆé…ç½®é€‰é¡¹å‘¢ï¼Ÿ</p>
<h3>ä¸€ã€å…ˆäº†è§£ webpack ä¸€äº›æ ¸å¿ƒé…ç½®</h3>
<p>è¿™é‡Œæˆ‘ä¸å†è®²è¿°ï¼Œé‡Œé¢æœ‰é“¾æ¥ï¼Œå¯ä»¥ç‚¹å‡»å»äº†è§£ã€‚åç»­æ–‡ç« ï¼Œå¯¹è¿™äº›é…ç½®ä¹Ÿä¼šæœ‰æ›´è¯¦ç»†çš„ä»‹ç»ã€‚</p>
<ul>
<li><strong><a href="https://webpack.docschina.org/concepts/#entry">å…¥å£ï¼ˆentryï¼‰</a></strong></li>
<li><strong><a href="https://webpack.docschina.org/concepts/#output">è¾“å‡ºï¼ˆoutputï¼‰</a></strong></li>
<li><strong><a href="https://webpack.docschina.org/concepts/#loaders">åŠ è½½å™¨ï¼ˆloaderï¼‰</a></strong></li>
<li><strong><a href="https://webpack.docschina.org/concepts/#plugins">æ’ä»¶ï¼ˆpluginï¼‰</a></strong></li>
<li><strong><a href="https://webpack.docschina.org/concepts/#mode">æ¨¡å¼ï¼ˆmodeï¼‰</a></strong></li>
</ul>
<h3>äºŒã€å¼€å§‹å†™é¡µé¢äº†</h3>
<p>æœ€æœ€æœ€ç®€å•çš„ webpack æ‰“åŒ…å·²ç»å­¦ä¼šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›è¡Œå¼€å‘å‘¢ï¼Ÿ</p>
<p>æŒ‰ç…§æˆ‘ä»¬ä¼ ç»Ÿå†™å‰ç«¯çš„æ–¹å¼ï¼Œå®ƒåº”è¯¥è¦æœ‰ä¸€ä¸ª <code>HTML</code> æ–‡ä»¶ï¼Œç„¶åå°† JSã€CSSã€å›¾ç‰‡ç­‰ç­‰å¼•å…¥åˆ°å…¶ä¸­ï¼Œè¿™å°±æ„æˆäº†æˆ‘ä»¬çš„å‰ç«¯é¡µé¢ã€‚</p>
<p>ä½†å…¶å®ï¼Œ<code>webpack</code> åªèƒ½è¯»å– <code>JavaScript</code> å’Œ <code>JSON</code> æ–‡ä»¶ï¼Œè¿™æ˜¯å¼€ç®±å¯ç”¨çš„è‡ªå¸¦èƒ½åŠ›ã€‚é‚£ä¹ˆé‡åˆ° CSSã€Imageã€HTML æ–‡ä»¶ webpack å¦‚ä½•å¤„ç†å‘¢ï¼Ÿé‚£ä¹ˆå®ƒå°±éœ€è¦ <code>loader</code> åŠ è½½å™¨å»å¤„ç†å®ƒä»¬ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ª <code>html-webpack-plugin</code> æ¥ç”Ÿæˆæˆ‘ä»¬çš„ HTML æ–‡ä»¶ã€‚</p>
<pre><code class="language-shell"># å®‰è£… html-webpack-plugin
$ yarn add --dev html-webpack-plugin@3.2.0
</code></pre>
<p>æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ ä¸€ä¸ª <code>webpack.config.js</code> çš„æ–‡ä»¶ã€‚</p>
<pre><code class="language-js">// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin()
  ]
}

module.exports = config
</code></pre>
<p>ç„¶åæˆ‘ä»¬é‡æ–°æ‰“åŒ…ï¼Œçœ‹ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-shell">$ yarn run build
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d78a920da2e34834.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å®ƒç»™æˆ‘ä»¬ç”Ÿæˆäº† <code>index.html</code> æ–‡ä»¶ï¼Œå¹¶å°†æˆ‘ä»¬æ‰“åŒ…åçš„ <code>main.js</code> å¼•å…¥å…¶ä¸­äº†ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ index.html æ–‡ä»¶å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº† <code>Hello Webpack!</code>ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ€æœ€æœ€ç®€å•çš„éœ€æ±‚å·²ç»å®Œæˆäº†ã€‚ä½¿ç”¨ webpack æ‰“åŒ…äº†ä¸€ä¸ªå‰ç«¯é¡µé¢ã€‚</p>
<h3>ä¸‰ã€ä¼˜åŒ–æˆ‘ä»¬è¾“å‡ºçš„ HTML æ–‡ä»¶</h3>
<p>å…¶å®å•Šï¼Œ<code>html-webpack-plugin</code> ä¹Ÿå¯ä»¥æ ¹æ®æä¾›çš„æ¨¡æ¿HTMLæ¥ç”Ÿæˆçš„ç¬¦å·æˆ‘ä»¬è¦æ±‚çš„æ ·å­ã€‚</p>
<blockquote>
<p>ç»™è‡ªå·±æä¸ªéœ€æ±‚ï¼Œåœ¨ index.html è¦æœ‰ä¸€ä¸ªç«‹å³å‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼ŒImmediately Invoked Function Expressionï¼‰å»æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚ï¼ˆå…·ä½“ä»€ä¹ˆä¸é‡è¦ï¼‰</p>
</blockquote>
<p>å†å€ŸåŠ©ä¸Šè¿°çš„æ–¹æ³•æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<ol>
<li>åœ¨ <code>/src</code> ä¸‹æ–°å»ºä¸€ä¸ª <code>index.html</code> æ–‡ä»¶</li>
</ol>
<pre><code class="language-html">&lt;!-- index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;UTF-8&quot; /&gt;
		&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot; /&gt;
		&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;
		&lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;
	&lt;/head&gt;
	&lt;script&gt;
		!(function() {
			console.log('ç»™è‡ªå·±åŠ éœ€æ±‚ï¼Œä»€ä¹ˆäººå•Šï¼æ€•ä¸æ˜¯è„‘å­æœ‰æ¯›ç—…å§')
		})()
	&lt;/script&gt;
	&lt;body&gt;
		&lt;div id=&quot;app&quot;&gt;This is app.&lt;/div&gt;
	&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ol start="2">
<li>ä¿®æ”¹ <code>webpack.config.js</code> é…ç½®ã€‚</li>
</ol>
<pre><code class="language-js">const HtmlWebpackPlugin = require('html-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin({
      title: 'Hi', // æ¨¡æ¿è¦ä½¿ç”¨ &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt; é…ç½®æ‰ç”Ÿæ•ˆ
      template: './src/index.html', // æ¨¡æ¿è·¯å¾„
      filename: 'index.html', // è¾“å‡º HTML æ–‡ä»¶åç§°
      inject: 'body', // æ’å…¥çš„ script æ ‡ç­¾ä½äº body åº•éƒ¨ï¼Œtrue åŒç†
      hash: true, // åŠ ä¸Š hash å€¼
      favicon: './src/favicon.ico'
    })
  ]
}

module.exports = config
</code></pre>
<p>ç®€å•ä»‹ç»ä¸€ä¸‹ <code>html-webpack-plugin</code> çš„é…ç½®ï¼š</p>
<ul>
<li><strong>title</strong>ï¼šç”Ÿæˆ HTML æ–‡ä»¶çš„æ ‡é¢˜ï¼Œéœ€é…åˆ <code>&lt;%= htmlWebpackPlugin.options.title %&gt;</code> ä½¿ç”¨ã€‚</li>
<li><strong>template</strong>ï¼šæ¨¡æ¿æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„ï¼Œå®ƒå¯ä»¥æ˜¯ htmlã€jadeã€ejsã€hbs ç­‰ã€‚ä½†æ˜¯éœ€è¦å®‰è£…å¯¹åº”çš„ loaderï¼Œå¦åˆ™ webpack å°†ä¸èƒ½è§£æã€‚</li>
<li><strong>filename</strong>ï¼šè¾“å‡º HTML æ–‡ä»¶åç§°ã€‚</li>
<li><strong>inject</strong>ï¼šæ³¨å…¥é€‰é¡¹ï¼Œå¯é€‰å€¼ï¼š<code>true</code>ã€<code>body</code>ã€<code>head</code>ã€<code>false</code>ã€‚
1ï¼‰trueï¼šé»˜è®¤å€¼ï¼Œscript æ ‡ç­¾ä½äº HTML æ–‡ä»¶çš„ body åº•éƒ¨ï¼›
2ï¼‰bodyï¼šåŒ trueï¼›
3ï¼‰headï¼šscript æ ‡ç­¾ä½äº head æ ‡ç­¾å†…ï¼›
4ï¼‰falseï¼šä¸æ’å…¥ç”Ÿæˆçš„ js æ–‡ä»¶ï¼Œåªæ˜¯å•çº¯çš„ç”Ÿæˆä¸€ä¸ª HTML æ–‡ä»¶ã€‚</li>
<li><strong>favicon</strong>ï¼šç½‘ç«™çš„ favicon å›¾æ ‡ã€‚</li>
<li><strong>hash</strong>ï¼šé»˜è®¤å€¼ falseã€‚ç»™ç”Ÿæˆçš„ js æ–‡ä»¶ä¸€ä¸ªç‹¬ç‰¹çš„ hash å€¼ï¼Œè¯¥ hash å€¼æ˜¯æœ¬æ¬¡ webpack ç¼–è¯‘çš„ hash å€¼ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚</li>
<li><strong>minifyã€cacheã€chunks...</strong>ï¼šè¿™äº›é€‰æ‹©å°±ä¸ä»‹ç»äº†ï¼Œæœ‰å…´è¶£è‡ªè¡Œæœç´¢æŸ¥æ‰¾ã€‚</li>
</ul>
<ol start="3">
<li>æ‰“åŒ…ç»“æœï¼š
<img src="https://upload-images.jianshu.io/upload_images/5128488-ab0708942a9b7850.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></li>
</ol>
<h3>å››ã€é™¤æ­¤ä¹‹å¤–</h3>
<p>åˆ©ç”¨ <code>clean-webpack-plugin</code> æ¥æ¸…é™¤ output è¾“å‡ºæ–‡ä»¶ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ</p>
<p>å‡å¦‚æˆ‘ä»¬è¾“å‡º HTML çš„ <code>filename</code> æ˜¯å˜åŒ–çš„ï¼Œé‚£ä¹ˆæ¯æ‰“åŒ…ä¸€æ¬¡è¾“å‡ºçš„ <code>dist</code> ç›®å½•ï¼Œå°±ä¼šä¸æ–­åœ°ç§¯ç´¯å„ç§æ—§ç‰ˆæœ¬çš„è¾“å‡ºæ–‡ä»¶ï¼Œæ˜¾ç„¶è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ï¼ˆå¯è‡ªè¡Œä½“éªŒä¸€ä¸‹ï¼‰</p>
<p>é…ç½® <code>clean-webpack-plugin</code> ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ yarn add --dev clean-webpack-plugin@3.0.0
</code></pre>
<pre><code class="language-js">// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

const config = {
  plugins: [
    new HtmlWebpackPlugin({
      title: 'Hi', // æ¨¡æ¿è¦ä½¿ç”¨ &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt; é…ç½®æ‰ç”Ÿæ•ˆ
      template: './src/index.html', // æ¨¡æ¿è·¯å¾„
      filename: 'index.html', // è¾“å‡º HTML æ–‡ä»¶åç§°
      inject: 'body', // æ’å…¥çš„ script æ ‡ç­¾ä½äº body åº•éƒ¨ï¼Œtrue åŒç†
      hash: true, // åŠ ä¸Š hash å€¼
      favicon: './src/favicon.ico'
    }),
    // æ–°ç‰ˆæ— éœ€å†æŒ‡å®šåˆ é™¤ç›®å½•ï¼Œé»˜è®¤åˆ é™¤ output ç›®å½•
    new CleanWebpackPlugin()
  ]
}

module.exports = config
</code></pre>
<p>æœ€åé™„ä¸Šï¼š</p>
<pre><code class="language-json5">// package.json
{
	&quot;name&quot;: &quot;webpack4_demo&quot;,
	&quot;version&quot;: &quot;1.0.0&quot;,
	&quot;description&quot;: &quot;ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®&quot;,
	&quot;main&quot;: &quot;src/index.js&quot;,
	&quot;repository&quot;: &quot;git@github.com:toFrankie/webpack4_demo.git&quot;,
	&quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
	&quot;license&quot;: &quot;MIT&quot;,
	&quot;private&quot;: true,
	&quot;scripts&quot;: {
		&quot;build&quot;: &quot;webpack --progress --colors --mode=production&quot;
	},
	&quot;dependencies&quot;: {
		&quot;webpack&quot;: &quot;4.41.2&quot;,
		&quot;webpack-cli&quot;: &quot;3.3.10&quot;
	},
	&quot;devDependencies&quot;: {
		&quot;clean-webpack-plugin&quot;: &quot;3.0.0&quot;,
		&quot;html-webpack-plugin&quot;: &quot;3.2.0&quot;
	}
}
</code></pre>
<p>æœªå®Œå¾…ç»­ï¼Œä¸‹ä¸€ç¯‡ç»§ç»­å•Š~</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆäºŒï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/55</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/55</guid>
            <pubDate>Sat, 25 Feb 2023 11:25:16 GMT</pubDate>
            <description><![CDATA[<h3>ä¸€ã€æœ¬é¡¹ç›®ä½¿ç”¨ yarn è¿›è¡ŒåŒ…ç®¡ç†</h3>
<p>åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆ <code>package.json</code>ã€‚</p>
<pre><code class="language-shell">$ yarn init
</code></pre>
<p><img src="https://upload-i]]></description>
            <content:encoded><![CDATA[<h3>ä¸€ã€æœ¬é¡¹ç›®ä½¿ç”¨ yarn è¿›è¡ŒåŒ…ç®¡ç†</h3>
<p>åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆ <code>package.json</code>ã€‚</p>
<pre><code class="language-shell">$ yarn init
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a6004cd248abaf3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<pre><code class="language-json5">// package.json
{
  &quot;name&quot;: &quot;webpack4_demo&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;repository&quot;: &quot;git@github.com:toFrankie/webpack4_demo.git&quot;,
  &quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;private&quot;: true
}
</code></pre>
<blockquote>
<p>å…³äº <a href="https://yarn.bootcss.com/docs/">yarn</a> å¸¸ç”¨å‘½ä»¤ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« <a href="https://www.jianshu.com/p/31d49dc24f9d">ã€yarn ä½¿ç”¨ä»¥åŠ npm çš„è¿ç§»ã€‘</a>ã€‚</p>
</blockquote>
<h3>äºŒã€ä¿®æ”¹é¡¹ç›®ç›®å½•</h3>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-96dbe27ec8b4ee72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li><strong>assets</strong>ï¼šå­˜æ”¾ä¸€äº›é™æ€æ–‡ä»¶</li>
<li><strong>config</strong>ï¼šå­˜æ”¾ä¸€äº›é…ç½®é…ç½®æ–‡ä»¶</li>
<li><strong>src</strong>ï¼šé¡¹ç›®èµ„æºï¼Œå¹¶æ·»åŠ  <code>index.js</code> ä½œä¸ºé¡¹ç›®å…¥å£æ–‡ä»¶</li>
</ul>
<h3>äºŒã€ä½¿ç”¨ webpack ä½œä¸ºæ‰“åŒ…å·¥å…·</h3>
<p>*æœ¬é¡¹ç›®ä½¿ç”¨ webpack 4.x ç‰ˆæœ¬ã€‚</p>
<h5>1. å®‰è£…ä¾èµ–åŒ…</h5>
<p>æ³¨æ„ï¼Œéœ€è¦åŒæ—¶å®‰è£… <code>webpack-cli</code>ã€‚å› ä¸ºä» webpack 4.x èµ·ï¼Œå°†åŸå…ˆå­˜åœ¨äºä¸€ä¸ªä¾èµ–åŒ…çš„æ‹†åˆ†æˆ <code>webpack</code> å’Œ <code>webpack-cli</code> ä¸¤ä¸ªä¾èµ–åŒ…ã€‚</p>
<blockquote>
<p>In webpack 3, webpack itself and the CLI for it used to be in the same package, but in version 4, they've separated the two to manage each of them better.</p>
</blockquote>
<pre><code class="language-shell">$ yarn add webpack@4.41.2
$ yarn add webpack-cli@3.3.10
</code></pre>
<p>å‘½ä»¤æ‰§è¡Œï¼Œä¾èµ–åŒ…ä¼šè¢«æ”¾ç½®åœ¨ <code>node_modules</code> ç›®å½•ï¼ŒåŒæ—¶ç”Ÿæˆ <code>yarn.lock</code> é”æ–‡ä»¶ï¼ˆç±»ä¼¼ npm v5 çš„ <code>package-lock.json</code>ï¼‰ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œ<code>package.json</code> ä¼šå‘ç”Ÿå˜åŒ–ã€‚å®ƒè®°å½•äº†æˆ‘ä»¬æ‰€å®‰è£…çš„åŒ…ä»¥åŠå¯¹åº”åŒ…çš„ç‰ˆæœ¬å·ã€‚</p>
<pre><code class="language-json5">{
  &quot;dependencies&quot;: {
    &quot;webpack&quot;: &quot;4.41.2&quot;,
    &quot;webpack-cli&quot;: &quot;3.3.10&quot;
  }
}
</code></pre>
<h5>2. webpack é…ç½®</h5>
<p>ä» <code>v4.0.0</code> å¼€å§‹ï¼Œ<strong>webpack å¯ä»¥ä¸ç”¨å†å¼•å…¥ä¸€ä¸ªé…ç½®æ–‡ä»¶</strong>æ¥æ‰“åŒ…é¡¹ç›®ï¼Œç„¶è€Œï¼Œå®ƒä»ç„¶æœ‰ç€<a href="https://webpack.docschina.org/configuration">é«˜åº¦å¯é…ç½®æ€§</a>ï¼Œå¯ä»¥å¾ˆå¥½æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ç‰ˆæœ¬ï¼Œéœ€è¦ç±»ä¼¼ <code>webpack.config.js</code> é…ç½®æ–‡ä»¶æ‰èƒ½æ‰“åŒ…ã€‚</p>
<p>å®ƒçš„é»˜è®¤å…¥å£æ–‡ä»¶æ˜¯ <code>src/index.js</code>ã€‚</p>
<h5>3. webpack æ‰“åŒ…</h5>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>package.json</code> æ·»åŠ  <code>scripts</code> å­—æ®µæ¥é…ç½® NPM è„šæœ¬ã€‚</p>
<pre><code class="language-json5">&quot;scripts&quot;: {
  &quot;build&quot;: &quot;webpack --progress --colors&quot;
}
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤ <code>yarn run build</code>ï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¼š <code>webpack</code> ä¼šå¸®æˆ‘åšäº›ä»€ä¹ˆå·¥ä½œ?
<img src="https://upload-images.jianshu.io/upload_images/5128488-c04b7b48a550fcbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
å®ƒç»™æˆ‘ä»¬ç”Ÿæˆäº† <code>main.js</code> æ–‡ä»¶ï¼Œäº <code>/dist</code> ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>ç»“åˆä¸Šå›¾ï¼Œè¯´æ˜äº†ä»€ä¹ˆï¼š</p>
<ul>
<li>webpack çš„é»˜è®¤å…¥å£æ–‡ä»¶ï¼ˆentry pointï¼‰æ˜¯ <code>./src/index.js</code>ã€‚</li>
<li>webpack çš„é»˜è®¤è¾“å‡ºç›®å½•ï¼ˆoutputï¼‰æ˜¯ <code>./dist</code>ã€‚å®ƒçš„é»˜è®¤æ‰“åŒ… <code>filename</code> æ˜¯ <code>main.js</code>ã€‚</li>
</ul>
</blockquote>
<h5>4. webpack æ‰“åŒ…ï¼ˆé¢˜å¤–è¯ï¼‰</h5>
<p>æˆ‘ä»¬åœ¨ <code>/src</code> ç›®å½•ä¸‹ï¼Œæ–°å»º <code>main.js</code>ã€‚</p>
<pre><code class="language-js">// main.js
console.log('This is main.js!')
</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ <code>npx webpack ./src/main.js -o ./build/bundle.js</code> æ¥æ‰“åŒ…å¹¶è¾“å‡ºã€‚
ä½†æˆ‘ä»¬é¡¹ç›®ä¸€èˆ¬ä¸ä¼šè¿™æ ·ä½¿ç”¨ï¼Œä¸å†èµ˜è¿°äº†ã€‚</p>
<h3>å››ã€è‡³æ­¤</h3>
<p>webpack æœ€ç®€å•çš„é…ç½®ä»¥åŠæ‰“åŒ…å·²ç»å­¦ä¼šäº†ï¼Œæ¥ç€ä¼šä»‹ç» webpack é…ç½®ä»¥åŠ react æ­é…ã€‚</p>
<hr>
<p>æœ€åé™„ä¸Šï¼š</p>
<pre><code class="language-json5">// package.json
{
	&quot;name&quot;: &quot;webpack4_demo&quot;,
	&quot;version&quot;: &quot;1.0.0&quot;,
	&quot;description&quot;: &quot;ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®&quot;,
	&quot;main&quot;: &quot;src/index.js&quot;,
	&quot;repository&quot;: &quot;git@github.com:toFrankie/webpack4_demo.git&quot;,
	&quot;author&quot;: &quot;Frankie &lt;1426203851@qq.com&gt;&quot;,
	&quot;license&quot;: &quot;MIT&quot;,
	&quot;private&quot;: true,
	&quot;scripts&quot;: {
		&quot;build&quot;: &quot;webpack --progress --colors&quot;
	},
	&quot;dependencies&quot;: {
		&quot;webpack&quot;: &quot;4.41.2&quot;,
		&quot;webpack-cli&quot;: &quot;3.3.10&quot;
	}
}
</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä»é›¶åˆ°ä¸€æ­å»º react é¡¹ç›®ç³»åˆ—ä¹‹ï¼ˆä¸€ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/54</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/54</guid>
            <pubDate>Sat, 25 Feb 2023 11:24:31 GMT</pubDate>
            <description><![CDATA[<p>è¯¦ç»†ä»‹ç»ä»é›¶åˆ°ä¸€æ­å»ºåŸºäº webpack çš„ react é¡¹ç›®ç³»åˆ—æ–‡ç« ã€‚åŸºäº <code>Webpack 4.x</code>ã€<code>React 16.x</code>ã€<code>redux</code>ã€<code>redux-saga</code>ã€<code>ESLint</code>ã€<code>]]></description>
            <content:encoded><![CDATA[<p>è¯¦ç»†ä»‹ç»ä»é›¶åˆ°ä¸€æ­å»ºåŸºäº webpack çš„ react é¡¹ç›®ç³»åˆ—æ–‡ç« ã€‚åŸºäº <code>Webpack 4.x</code>ã€<code>React 16.x</code>ã€<code>redux</code>ã€<code>redux-saga</code>ã€<code>ESLint</code>ã€<code>Prettier</code>ã€<code>Ant-Design</code> ç­‰ã€‚</p>
<blockquote>
<p>***Github é¡¹ç›® webpack4_demo <a href="https://github.com/toFrankie/webpack4_demo.git">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ã€‚**æœ¬ç³»åˆ—æ–‡ç« ç›®å‰æš‚æœªå†™å®Œï¼ŒåŠ é€Ÿ ing...</p>
</blockquote>
<blockquote>
<p>æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p>æœ¬é¡¹ç›®æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¼šå°½å¯èƒ½åœ°è¯¦å†™ã€‚è¯¥ç³»åˆ—æ–‡ç« æœ‰äº›ä¸œè¥¿å¯èƒ½æ¯”è¾ƒåŸºç¡€ï¼Œå¤§ä½¬å¯ç»•è·¯æˆ–è€…è·³è¿‡ã€‚</p>
<p>æœ¬ç³»åˆ—æ–‡ç« çš„åˆè¡·äº¦æ˜¯å¦‚æ­¤ï¼Œå°½å¯èƒ½è®©æ¯ä¸ªå‰ç«¯å¼€å‘äººå‘˜éƒ½èƒ½çœ‹æ‡‚ï¼Œå³ä½¿æ˜¯åˆšå…¥å‘æˆ–è€…å‰ç«¯åŸºç¡€è¾ƒå¼±çš„æœ‹å‹ã€‚ï¼ˆæ¯”å¦‚æœ¬äºº ğŸ‘» ï¼‰</p>
<p>ä¸€äº›æˆ‘è®¤ä¸ºæ¯”è¾ƒå®¹æ˜“å¿½ç•¥ï¼Œæˆ–è€…éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œæˆ‘ä¹Ÿä¼šç‰¹æ„æ ‡æ³¨ã€‚</p>
<p>æœ¬äººæ–‡ç¬”ä»¥åŠæ¶‰çŒçš„çŸ¥è¯†é¢æœ‰é™ï¼Œæ–‡ç« ä¸­å¯èƒ½æœ‰è¯ä¸è¾¾æ„ä¹‹å¤„ï¼Œæˆ–æœ‰åå·®é”™è¯¯ä¹‹å¤„ã€‚çƒ¦è¯·è®¤çœŸé˜…è¯»ï¼Œè‹¥æœ‰ä¸è¶³ï¼Œéå¸¸æ¬¢è¿æŒ‡æ­£ã€‚</p>
</blockquote>
<p>é‚£å°±ä»æœ€ç®€å•çš„å¼€å§‹å§ã€‚</p>
<h3>ä¸€ã€å…‹éš†é¡¹ç›®</h3>
<pre><code class="language-shell">$ git clone https://github.com/toFrankie/webpack4_demo.git
$ cd webpack4_demo
</code></pre>
<h3>äºŒã€åˆ›å»º .gitignore</h3>
<pre><code class="language-shell"># åˆ›å»º .gitigonre
$ touch .gitigonre
</code></pre>
<p>å¹¶æ·»åŠ å¿…è¦é…ç½®ï¼Œæ ¹æ®éœ€æ±‚è‡ªè¡Œæ·»åŠ ã€‚</p>
<pre><code class="language-.gitignore"># See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# production
/build
/dist

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*
</code></pre>
<h3>ä¸‰ã€æ¨é€è‡³è¿œç¨‹ä»“åº“</h3>
<pre><code class="language-shell"># æäº¤æš‚å­˜
$ git add .gitignore

# å°†æœ¬åœ°æš‚å­˜çš„ä¿®æ”¹æäº¤åˆ°ç‰ˆæœ¬åº“
$ git commit -m &quot;initial .gitignore&quot;

# æ¨é€è‡³è¿œç¨‹ä»“åº“
$ git push -u origin master
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e391521dee193767.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ğŸ‰"></p>
<p>è¿™ä¸ªå¼€ç¯‡å¾ˆæ²¡æœ‰è¥å…»ï¼Œå“ˆå“ˆã€‚</p>
<p>ç»§ç»­å¾€ä¸‹çœ‹å§...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TS ä¹‹å¯¹è±¡çš„ç±»å‹ â€” æ¥å£]]></title>
            <link>https://github.com/toFrankie/blog/issues/53</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/53</guid>
            <pubDate>Sat, 25 Feb 2023 11:18:21 GMT</pubDate>
            <description><![CDATA[<p><a href="https://www.jianshu.com/p/18c5afdb5a6c">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº†è”åˆç±»å‹ï¼Œä»Šå„¿æ¥ç€ä»‹ç»<a href="">å¯¹è±¡ç±»å‹</a>ã€‚</p>
<p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥å£ï¼ˆ<code>Interface</code>ï¼‰æ¥å®šä¹‰å¯¹è±¡çš„ç±»å‹ã€‚</p>
]]></description>
            <content:encoded><![CDATA[<p><a href="https://www.jianshu.com/p/18c5afdb5a6c">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº†è”åˆç±»å‹ï¼Œä»Šå„¿æ¥ç€ä»‹ç»<a href="">å¯¹è±¡ç±»å‹</a>ã€‚</p>
<p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥å£ï¼ˆ<code>Interface</code>ï¼‰æ¥å®šä¹‰å¯¹è±¡çš„ç±»å‹ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯æ¥å£</h3>
<p>åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œæ¥å£ï¼ˆ<code>Interface</code>ï¼‰æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ï¼Œè€Œå…·ä½“å¦‚ä½•è¡ŒåŠ¨éœ€è¦ç”±ç±»ï¼ˆ<code>classes</code>ï¼‰å»å®ç°ï¼ˆ<code>implement</code>ï¼‰ã€‚</p>
<p>TypeScript ä¸­çš„æ¥å£æ˜¯ä¸€ä¸ªéå¸¸çµæ´»çš„æ¦‚å¿µï¼Œå¤„ç†å¯ç”¨äºå¯¹ç±»çš„ä¸€éƒ¨åˆ†è¿›è¡ŒæŠ½è±¡ä»¥å¤–ï¼Œä¹Ÿå¸¸ç”¨äºã€Œå¯¹è±¡çš„å½¢çŠ¶ï¼ˆShapeï¼‰ã€è¿›è¡Œæè¿°ã€‚</p>
<h3>ç®€å•çš„ä¾‹å­</h3>
<pre><code class="language-ts">// æ¥å£ä¸€èˆ¬é¦–å­—æ¯å¤§å†™
interface Person {
    name: string,
    age: number
}

let frankie: Person = {
    name: 'Frankie',
    age: 22
}
</code></pre>
<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¥å£ <code>Person</code>ï¼Œæ¥ç€å®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>frankie</code>ï¼Œå®ƒçš„ç±»å‹æ˜¯ <code>Person</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±çº¦æŸäº† <code>frankie</code> çš„å½¢çŠ¶å¿…é¡»æ˜¯å’Œæ¥å£ <code>Person</code> ä¸€è‡´ã€‚</p>
<p>å®šä¹‰çš„å˜é‡æ¯”æ¥å£<strong>å°‘äº†</strong>æˆ–è€…<strong>å¤šäº†</strong>ä¸€äº›å±æ€§æ˜¯ä¸å…è®¸çš„ï¼š</p>
<pre><code class="language-ts">interface Person {
    name: string,
    age: number
}

let frankie: Person = {
    name: 'Frankie'
}
// ï¼ˆ1ï¼‰å°‘äº† age å±æ€§
// Property 'age' is missing in type '{ name: string; }' but required in type 'Person'.


// ï¼ˆ2ï¼‰å¤šäº† height å±æ€§
let mandy: Person = {
    name: 'Mandy',
    age: 22,
    height: 180
}
// Type '{ name: string; age: number; height: number; }' is not assignable to type 'Person'.
// Object literal may only specify known properties, and 'height' does not exist in type 'Person'.
</code></pre>
<p>å¯è§ï¼Œèµ‹å€¼çš„æ—¶å€™ï¼Œå˜é‡çš„å½¢çŠ¶å¿…é¡»å’Œæ¥å£ä¿æŒä¸€è‡´ã€‚</p>
<h3>å¯é€‰å±æ€§</h3>
<p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ä¸è¦å®Œå…¨åŒ¹é…ä¸€ä¸ªå½¢çŠ¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å¯é€‰å±æ€§ï¼š</p>
<pre><code class="language-ts">interface Person {
    name: string,
    age?: number
}

let frankie: Person = {
    name: 'Frankie'
}

let mandy: Person = {
    name: 'Mandy',
    age: 22
}
</code></pre>
<p>å¯é€‰å±æ€§çš„å«ä¹‰æ˜¯è¯¥å±æ€§å¯ä»¥ä¸å­˜åœ¨ï¼Œä½†è¿™æ—¶ä»ç„¶ä¸å…è®¸æ·»åŠ æœªå®šä¹‰çš„å±æ€§ã€‚</p>
<h3>ä»»æ„å±æ€§</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªæ¥å£å…è®¸æœ‰ä»»æ„çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<pre><code class="language-ts">interface Person {
    name: string,
    age?: number,
    [propName: string]: any
}

let frankie: Person = {
    name: 'Frankie',
    sex: 'male',
    height: 180,
}
</code></pre>
<p>ä½¿ç”¨äº† <code>[propName: string]</code> å®šä¹‰äº†ä»»æ„å±æ€§å– <code>string</code> ç±»å‹çš„å€¼ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸€æ—¦å®šä¹‰äº†ä»»æ„å±æ€§ï¼Œé‚£ä¹ˆç¡®å®šå±æ€§å’Œå¯é€‰å±æ€§çš„ç±»å‹éƒ½å¿…é¡»æ˜¯å®ƒçš„ç±»å‹çš„å­é›†ã€‚</strong></p>
<pre><code class="language-ts">interface Person {
    name: string,
    age?: number,
    [propName: string]: string
}

let frankie: Person = {
    name: 'Frankie',
    age: 20,
    height: '180',
}

// Property 'age' of type 'number' is not assignable to string index type 'string'.
// Type '{ name: string; age: number; height: string; }' is not assignable to type 'Perso
n'.
// Property 'age' is incompatible with index signature.
// Type 'number' is not assignable to type 'string'.  
</code></pre>
<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œä»»æ„å±æ€§çš„å€¼å…è®¸æ˜¯ <code>string</code>ï¼Œä½†æ˜¯å¯é€‰å±æ€§ <code>age</code> ä»¥åŠä»»æ„å±æ€§ <code>height</code> çš„å€¼å´æ˜¯ <code>number</code>ï¼Œ<code>number</code> ä¸æ˜¯ <code>string</code> çš„å­å±æ€§ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚</p>
<hr>
æœªå®Œå¾…ç»­...]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TS ä¹‹è”åˆç±»å‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/52</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/52</guid>
            <pubDate>Sat, 25 Feb 2023 11:17:54 GMT</pubDate>
            <description><![CDATA[<p><a href="https://www.jianshu.com/p/e83726c4fe8c">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº†ç±»å‹æ¨è®ºï¼Œä»Šå„¿æ¥ç€ä»‹ç»<a href="">è”åˆç±»å‹</a>ã€‚</p>
<p>è”åˆç±»å‹ï¼ˆ<code>Union Types</code>ï¼‰è¡¨ç¤ºå–å€¼å¯ä»¥ä¸ºå¤šç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</p>
<p>è”åˆç±»å‹ä½¿]]></description>
            <content:encoded><![CDATA[<p><a href="https://www.jianshu.com/p/e83726c4fe8c">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº†ç±»å‹æ¨è®ºï¼Œä»Šå„¿æ¥ç€ä»‹ç»<a href="">è”åˆç±»å‹</a>ã€‚</p>
<p>è”åˆç±»å‹ï¼ˆ<code>Union Types</code>ï¼‰è¡¨ç¤ºå–å€¼å¯ä»¥ä¸ºå¤šç§ç±»å‹ä¸­çš„ä¸€ç§ã€‚</p>
<p>è”åˆç±»å‹ä½¿ç”¨ <code>|</code> åˆ†éš”æ¯ä¸ªç±»å‹ã€‚</p>
<h3>ç®€å•ä¾‹å­</h3>
<pre><code class="language-ts">// è”åˆç±»å‹
let myFavoriteNumber: string | number;
myFavoriteNumber = 'seven';
myFavoriteNumber = 7;
</code></pre>
<p>è¿™é‡Œçš„ <code>let myFavoriteNumber: string | number</code> çš„å«ä¹‰æ˜¯ï¼Œå…è®¸ <code>myFavoriteNumber</code> çš„ç±»å‹å¯ä»¥æ˜¯ <code>string</code> æˆ–è€… <code>number</code> ï¼Œä½†ä¸èƒ½æ˜¯å…¶ä»–ç±»å‹ã€‚</p>
<pre><code class="language-ts">let myFavoriteNumber: string | number;
myFavoriteNumber = true;

// Type 'boolean' is not assignable to type 'string | number'.
</code></pre>
<h3>è®¿é—®è”åˆç±»å‹çš„å±æ€§æˆ–æ–¹æ³•</h3>
<p>å½“ TypeScript ä¸ç¡®å®šä¸€ä¸ªè”åˆç±»å‹çš„å˜é‡åˆ°åº•æ˜¯å“ªä¸ªç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬<strong>åªèƒ½è®¿é—®æ­¤è”åˆç±»å‹çš„æ‰€æœ‰ç±»å‹å…±æœ‰çš„å±æ€§æˆ–æ–¹æ³•</strong>ã€‚</p>
<pre><code class="language-ts">function getLength(something: string | number): number {
    return something.length;
}

// Property 'length' does not exist on type 'string | number'.
// Property 'length' does not exist on type 'number'.
</code></pre>
<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>length</code> ä¸æ˜¯ <code>string</code> å’Œ <code>number</code> çš„å…±æœ‰å±æ€§ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚è®¿é—® <code>string</code> å’Œ <code>number</code> çš„å…±æœ‰å±æ€§æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<pre><code class="language-ts">function getString(something: string | number): string {
    return something.toString();
}
</code></pre>
<p>è”åˆç±»å‹çš„å˜é‡å†è¢«èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ¨è®ºçš„è§„åˆ™æ¨æ–­å‡ºä¸€ä¸ªç±»å‹ï¼š</p>
<pre><code class="language-ts">let myFavoriteNumber: string | number;
myFavoriteNumber = 'seven';             // è¢«æ¨æ–­æˆ string
console.log(myFavoriteNumber.length);   // 5
myFavoriteNumber = 7;                   // è¢«æ¨æ–­æˆ number
console.log(myFavoriteNumber.length);   // ç¼–è¯‘æ—¶æŠ¥é”™

// Property 'length' does not exist on type 'number'.
</code></pre>
<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œç¬¬äºŒè¡Œçš„ <code>myFavoriteNumber</code> è¢«æ¨æ–­æˆäº† <code>string</code>ï¼Œè®¿é—®å®ƒçš„ <code>length</code> å±æ€§ä¸ä¼šæŠ¥é”™ã€‚è€Œç¬¬å››è¡Œçš„ <code>myFavoriteNumber</code> è¢«æ¨æ–­æˆäº† <code>number</code>ï¼Œè®¿é—®å®ƒçš„ <code>length</code> å±æ€§æ—¶è‡ªç„¶å°±ä¼šæŠ¥é”™äº†ã€‚</p>
<p><a href="https://www.jianshu.com/p/2e38aaefceee">ä¸‹ä¸€ç¯‡</a>ä»‹ç»å¯¹è±¡ç±»å‹ã€‚</p>
<p><strong>The end.</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TS ä¹‹ç±»å‹æ¨è®º]]></title>
            <link>https://github.com/toFrankie/blog/issues/51</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/51</guid>
            <pubDate>Sat, 25 Feb 2023 11:17:33 GMT</pubDate>
            <description><![CDATA[<p><a href="https://www.jianshu.com/p/862c992bb9da">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº† TypeScript çš„ä»»æ„å€¼ã€‚ä»Šå„¿æ¥ç€ä»‹ç»<a href="">ç±»å‹æ¨è®º</a>ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ˜ç¡®çš„æŒ‡å®šç±»å‹ï¼Œé‚£ä¹ˆ TypeScript ä¼šä¾ç…§ç±»å‹æ¨è®ºï¼ˆTypeInference]]></description>
            <content:encoded><![CDATA[<p><a href="https://www.jianshu.com/p/862c992bb9da">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº† TypeScript çš„ä»»æ„å€¼ã€‚ä»Šå„¿æ¥ç€ä»‹ç»<a href="">ç±»å‹æ¨è®º</a>ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æ˜ç¡®çš„æŒ‡å®šç±»å‹ï¼Œé‚£ä¹ˆ TypeScript ä¼šä¾ç…§ç±»å‹æ¨è®ºï¼ˆTypeInferenceï¼‰çš„è§„åˆ™æ¨æ–­å‡ºä¸€ä¸ªç±»å‹ã€‚</p>
<h3>ä»€ä¹ˆæ˜¯ç±»å‹æ¨è®ºå‘¢ï¼Ÿ</h3>
<p>ä»¥ä¸‹ä»£ç è™½ç„¶æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œä½†æ˜¯ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™ï¼š</p>
<pre><code class="language-ts">let myFavoriteNumber = 'seven';
myFavoriteNumber = 7;

// Type 'number' is not assignable to type 'string'.
</code></pre>
<p>äº‹å®ä¸Šï¼Œå®ƒç­‰ä»·äºï¼š</p>
<pre><code class="language-ts">let myFavoriteNumber: string = 'seven';
myFavoriteNumber = 7;

// Type 'number' is not assignable to type 'string'.
</code></pre>
<p><strong>TypeScript ä¼šåœ¨æ²¡æœ‰æ˜ç¡®çš„æŒ‡å‡ºç±»å‹çš„æ—¶å€™æ¨æµ‹å‡ºä¸€ä¸ªç±»å‹ï¼Œè¿™å°±æ˜¯ç±»å‹æ¨è®ºã€‚</strong></p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœå®šä¹‰çš„æ—¶å€™æ²¡æœ‰èµ‹å€¼ï¼Œä¸ç®¡ä¹‹åæœ‰æ²¡æœ‰èµ‹å€¼ï¼Œéƒ½ä¼šè¢«æ¨æ–­æˆ <code>any</code> ç±»å‹è€Œå®Œå…¨ä¸è¢«ç±»å‹æ£€æŸ¥ã€‚</p>
</blockquote>
<pre><code class="language-ts">let myFavoriteNumber;
myFavoriteNumber = 'seven';
myFavoriteNumber = 7;
</code></pre>
<p><a href="https://www.jianshu.com/p/18c5afdb5a6c">ä¸‹ä¸€ç¯‡</a>ä»‹ç»è”åˆç±»å‹ã€‚</p>
<p><strong>The end.</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TS ä¹‹ä»»æ„å€¼]]></title>
            <link>https://github.com/toFrankie/blog/issues/50</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/50</guid>
            <pubDate>Sat, 25 Feb 2023 11:17:16 GMT</pubDate>
            <description><![CDATA[<p><a href="https://www.jianshu.com/p/96de642c8109">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº† TypeScript çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œæœ¬æ–‡ä»‹ç»ä¸€ä¸‹ä»»æ„å€¼ã€‚</p>
<p>ä»»æ„å€¼ï¼ˆ<code>Any</code>ï¼‰ç”¨æ¥è¡¨ç¤ºå…è®¸èµ‹å€¼ä¸ºä»»æ„ç±»å‹ã€‚</p>
<h3>ä¸€ã€ä»€ä¹ˆæ˜¯ä»»æ„å€¼ç±»å‹ï¼Ÿ</h3>]]></description>
            <content:encoded><![CDATA[<p><a href="https://www.jianshu.com/p/96de642c8109">ä¸Šä¸€ç¯‡</a>ä»‹ç»äº† TypeScript çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œæœ¬æ–‡ä»‹ç»ä¸€ä¸‹ä»»æ„å€¼ã€‚</p>
<p>ä»»æ„å€¼ï¼ˆ<code>Any</code>ï¼‰ç”¨æ¥è¡¨ç¤ºå…è®¸èµ‹å€¼ä¸ºä»»æ„ç±»å‹ã€‚</p>
<h3>ä¸€ã€ä»€ä¹ˆæ˜¯ä»»æ„å€¼ç±»å‹ï¼Ÿ</h3>
<p>å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šç±»å‹ï¼Œåœ¨èµ‹å€¼è¿‡ç¨‹ä¸­æ”¹å˜ç±»å‹æ˜¯ä¸è¢«å…è®¸çš„ï¼š</p>
<pre><code class="language-ts">let myFavoriteNumber: string = 'seven';
myFavoriteNumber = 7;

// Type '7' is not assignable to type 'string'.
</code></pre>
<p>ä½†å¦‚æœæ˜¯ <code>any</code> ç±»å‹ï¼Œåˆ™è¢«å…è®¸èµ‹å€¼ä¸ºä»»æ„ç±»å‹ã€‚</p>
<pre><code class="language-ts">let myFavoriteNumber: any = 'seven';
myFavoriteNumber = 7;
</code></pre>
<h3>äºŒã€ä»»æ„å€¼çš„å±æ€§å’Œæ–¹æ³•</h3>
<p>åœ¨ä»»æ„å€¼ä¸Šè®¿é—®ä»»ä½•å±æ€§ã€ä»»ä½•æ–¹æ³•éƒ½æ˜¯å…è®¸çš„ï¼š</p>
<pre><code class="language-ts">let anything: any = 'Hello';
console.log(anyThing.myName);
console.log(anyThing.myName.firstName);

let anything2: any = 'Frankie';
anything2.setName('Mandy');
anything2.setName('Mandy').sayHello();
anything2.myName.setFirstName('Ada');
</code></pre>
<p>å¯ä»¥è®¤ä¸ºï¼Œ<strong>å£°æ˜ä¸€ä¸ªå˜é‡ä¸ºä»»æ„å€¼ä¹‹åï¼Œå¯¹å®ƒçš„ä»»ä½•æ“ä½œï¼Œè¿”å›çš„å†…å®¹éƒ½æ˜¯ä»»æ„å€¼ã€‚</strong></p>
<h3>ä¸‰ã€æœªå£°æ˜ç±»å‹çš„å˜é‡</h3>
<p>å˜é‡å¦‚æœåœ¨å£°æ˜çš„æ—¶å€™ï¼ŒæœªæŒ‡å®šå…¶ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è¯†åˆ«ä¸ºä»»æ„å€¼ç±»å‹ï¼š</p>
<pre><code class="language-ts">let something;
something = 'seven';
something = 7;
something.setName('Frankie');

// è¿™é‡Œå…ˆè¯´ä¸‹åé¢è¦ä»‹ç»çš„â€œç±»å‹æ¨è®ºâ€
// let something ä¼šè¢«æ¨æ–­æˆ any ç±»å‹ï¼›
// let something = 7 ä¼šè¢«æ¨æ–­æˆ number ç±»å‹
</code></pre>
<p>ç­‰ä»·äºï¼š</p>
<pre><code class="language-ts">let something: any;
something = 'seven';
something = 7;

something.setName('Frankie');
</code></pre>
<p><a href="https://www.jianshu.com/p/862c992bb9da">ä¸‹ä¸€ç¯‡</a>ä»‹ç» TypeScript ä¹‹ç±»å‹æ¨è®ºã€‚</p>
<p><strong>The end.</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TS ä¹‹åŸå§‹æ•°æ®ç±»å‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/49</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/49</guid>
            <pubDate>Sat, 25 Feb 2023 11:16:55 GMT</pubDate>
            <description><![CDATA[<p>JavaScript çš„ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š<strong>åŸå§‹æ•°æ®ç±»å‹</strong>ï¼ˆPrimitive data typesï¼‰å’Œ<strong>å¯¹è±¡ç±»å‹</strong>ï¼ˆObject data typesï¼‰ã€‚</p>
<p>åŸå§‹æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š<code>Boolean</code>ã€<code>Number<]]></description>
            <content:encoded><![CDATA[<p>JavaScript çš„ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š<strong>åŸå§‹æ•°æ®ç±»å‹</strong>ï¼ˆPrimitive data typesï¼‰å’Œ<strong>å¯¹è±¡ç±»å‹</strong>ï¼ˆObject data typesï¼‰ã€‚</p>
<p>åŸå§‹æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š<code>Boolean</code>ã€<code>Number</code>ã€<code>String</code>ã€<code>Null</code>ã€<code>Undefined</code>ã€<code>Symbolï¼ˆES6 æ–°å¢ï¼‰</code>ã€‚</p>
<p>æœ¬èŠ‚ä¸»è¦ä»‹ç»<strong>å‰äº”ç§åŸå§‹æ•°æ®ç±»å‹</strong>åœ¨ TypeScript ä¸­çš„åº”ç”¨ã€‚</p>
<h3>å¸ƒå°”å€¼</h3>
<p>å¸ƒå°”å€¼æ˜¯æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œåœ¨ TypeScript ä¸­ï¼Œä½¿ç”¨ <code>boolean</code> å®šä¹‰å¸ƒå°”å€¼ç±»å‹ã€‚</p>
<pre><code class="language-ts">let isDone: boolen = true;

// ç›´æ¥è°ƒç”¨ Booleanï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª boolean ç±»å‹
let createByBoolean: boolean = Boolean(true);
</code></pre>
<p>æ³¨æ„ï¼Œä½¿ç”¨æ„é€ å‡½æ•° <code>Boolean</code> åˆ›é€ çš„å¯¹è±¡ä¸æ˜¯å¸ƒå°”å€¼ï¼š</p>
<pre><code class="language-ts">let createByNewBoolean: boolean = new Boolean(true);

// ä¸èƒ½å°†ç±»å‹â€œBooleanâ€åˆ†é…ç»™ç±»å‹â€œbooleanâ€ã€‚
//  â€œbooleanâ€æ˜¯åŸºå…ƒï¼Œä½†â€œBooleanâ€æ˜¯åŒ…è£…å™¨å¯¹è±¡ã€‚å¦‚å¯èƒ½é¦–é€‰ä½¿ç”¨â€œbooleanâ€ã€‚
</code></pre>
<p>äº‹å®ä¸Šï¼Œ<code>new Boolean()</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Boolean</code> å¯¹è±¡ï¼š</p>
<pre><code class="language-ts">let createByNewBoolean: Boolean = new Boolean(true);
</code></pre>
<p>åœ¨ TypeScript ä¸­ï¼Œ<code>boolean</code> æ˜¯ JavaScript ä¸­çš„åŸºæœ¬ç±»å‹ï¼Œè€Œ <code>Boolean</code> æ˜¯ JavaScript ä¸­çš„æ„é€ å‡½æ•°ï¼Œå…¶ä»–åŸºæœ¬ç±»å‹ä¸€æ ·ï¼ˆé™¤äº† <code>null</code> å’Œ <code>undefined</code>ï¼‰ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h3>æ•°å€¼</h3>
<p>ä½¿ç”¨ <code>number</code> å®šä¹‰æ•°å€¼ç±»å‹ï¼š</p>
<pre><code class="language-ts">let decLiteral: number = 6;
let hexLiteral: number = 0xf00d;
let binaryLiteral: number = 0b1010;     // ES6 ä¸­äºŒè¿›åˆ¶è¡¨ç¤ºæ³•
let octalLiteral: number = 0o744;       // ES6 ä¸­å…«è¿›åˆ¶è¡¨ç¤ºæ³•
let notANumber: number = NaN;
let infinityNumber: number = Infinity;
</code></pre>
<p>ç¼–è¯‘ç»“æœï¼š</p>
<pre><code class="language-ts">var decLiteral = 6;
var hexLiteral = 0xf00d;
var binaryLiteral = 10; // ES6 ä¸­äºŒè¿›åˆ¶è¡¨ç¤ºæ³•
var octalLiteral = 484; // ES6 ä¸­å…«è¿›åˆ¶è¡¨ç¤ºæ³•
var notANumber = NaN;
var infinityNumber = Infinity;
</code></pre>
<p>å…¶ä¸­ <code>0b1010</code> å’Œ <code>0o744</code> æ˜¯ <a href="http://es6.ruanyifeng.com/#docs/number#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%92%8C%E5%85%AB%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA%E6%B3%95">ES6 ä¸­çš„äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶è¡¨ç¤ºæ³•</a>ï¼Œå®ƒä»¬ä¼šè¢«ç¼–è¯‘ä¸ºåè¿›åˆ¶æ•°å­—ã€‚</p>
<h3>å­—ç¬¦ä¸²</h3>
<p>ä½¿ç”¨ <code>string</code> å®šä¹‰å­—ç¬¦ä¸²ç±»å‹ï¼š</p>
<pre><code class="language-ts">let myName: string = 'Frankie';
let myAge: number = 20;
let sentence: string = `Hello, I'm ${myName}`;
</code></pre>
<p>ç¼–è¯‘ç»“æœï¼š</p>
<pre><code class="language-ts">var myName = 'Frankie';
var myAge = 20;
var sentence = &quot;Hello, I'm &quot; + myName;
</code></pre>
<h3>ç©ºå€¼</h3>
<p>JavaScript æ²¡æœ‰ç©ºå€¼ï¼ˆ<code>Void</code>ï¼‰çš„æ¦‚å¿µï¼Œåœ¨ TypeScript ä¸­ï¼Œå¯ä»¥ç”¨ <code>void</code> è¡¨ç¤ºæ²¡æœ‰ä»»ä½•è¿”å›å€¼çš„å‡½æ•°ã€‚</p>
<pre><code class="language-ts">function showName(): void {
    console.log(`I'm Frankie.`);
}
</code></pre>
<p>å£°æ˜ä¸€ä¸ª <code>void</code> ç±»å‹çš„å˜é‡æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºä½ åªèƒ½å°†å®ƒèµ‹å€¼ä¸º <code>undefined</code> å’Œ <code>null</code>ã€‚(ä»»æ„å€¼ç±»å‹ä¹Ÿæ˜¯å¯ä»¥çš„)</p>
<pre><code class="language-ts">let unusable1: void = undefined;
let unusable2: void = null;
</code></pre>
<h3>Null å’Œ Undefined</h3>
<p>åœ¨ TypeScript ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>null</code> å’Œ <code>undefined</code> æ¥å®šä¹‰è¿™ä¸¤ä¸ªåŸå§‹æ•°æ®ç±»å‹ï¼š</p>
<pre><code class="language-ts">let u: undefined = undefined;
let n: null = null;
</code></pre>
<p>ä¸ <code>void</code> çš„åŒºåˆ«æ˜¯ï¼Œ<code>undefined</code> å’Œ <code>null</code> æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>undefined</code>ã€<code>null</code> ç±»å‹çš„å˜é‡ï¼Œå¯ä»¥èµ‹å€¼ç»™ <code>string</code>ã€<code>number</code> ç­‰ç±»å‹çš„å˜é‡ï¼š</p>
<pre><code class="language-ts">// ä½†æ˜¯è¦æ³¨æ„ï¼Œä»¥ä¸‹è¿™ä¸ªåœ¨ --strictNullChecks  ä¸¥æ ¼ç©ºæ£€æŸ¥æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ã€‚
let num1: number = undefined;
let u: undefined;
let num2: number = u;
</code></pre>
<p>è€Œ <code>void</code> ç±»å‹çš„å˜é‡ä¸èƒ½èµ‹å€¼ç»™ <code>number</code> ç±»å‹çš„å˜é‡ï¼š</p>
<pre><code class="language-ts">let u: void;
let num: number = u;

// ç¼–è¯‘å‡ºé”™
// Type 'void' is not assignable to type 'number'.
</code></pre>
<p><a href="https://www.jianshu.com/p/862c992bb9da">ä¸‹ä¸€ç¯‡</a>ä»‹ç»ä»»æ„å€¼ã€‚</p>
<p><strong>The end.</strong></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[TypeScript åˆæ¢]]></title>
            <link>https://github.com/toFrankie/blog/issues/48</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/48</guid>
            <pubDate>Sat, 25 Feb 2023 11:15:59 GMT</pubDate>
            <description><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-02-06ã€‚</p>
<p>TypeScript (<a href="https://www.tslang.cn/">ä¸­æ–‡å®˜ç½‘</a>)æ˜¯å…·æœ‰ç±»å‹ç³»ç»Ÿï¼Œä¸”æ˜¯ JavaScript çš„è¶…é›†ã€‚ å®ƒå¯ä»¥ç¼–è¯‘æˆæ™®é€šçš„ JavaScript ä»£ç ã€‚ TypeScript æ”¯æŒä»»æ„æµè§ˆå™¨ï¼Œä»»æ„ç¯å¢ƒï¼Œä»»æ„]]></description>
            <content:encoded><![CDATA[<p>æœ¬æ–‡æ›´æ–°äº 2020-02-06ã€‚</p>
<p>TypeScript (<a href="https://www.tslang.cn/">ä¸­æ–‡å®˜ç½‘</a>)æ˜¯å…·æœ‰ç±»å‹ç³»ç»Ÿï¼Œä¸”æ˜¯ JavaScript çš„è¶…é›†ã€‚ å®ƒå¯ä»¥ç¼–è¯‘æˆæ™®é€šçš„ JavaScript ä»£ç ã€‚ TypeScript æ”¯æŒä»»æ„æµè§ˆå™¨ï¼Œä»»æ„ç¯å¢ƒï¼Œä»»æ„ç³»ç»Ÿå¹¶ä¸”æ˜¯å¼€æºçš„ã€‚</p>
<ol>
<li>å®‰è£… TypeScript è½¬æ¢å·¥å…·</li>
</ol>
<pre><code class="language-shell">$ npm i -g typescript
</code></pre>
<ol start="2">
<li>ç¼–å†™ç¬¬ä¸€ä¸ª TS ç¨‹åº <code>Hello.ts</code></li>
</ol>
<pre><code class="language-ts">// hello.ts
console.log('Hello TypeScript!')
</code></pre>
<ol start="3">
<li>
<p>ä½¿ç”¨ <code>tsc</code> å‘½ä»¤è½¬åŒ–ä¸º JavaScript æ–‡ä»¶ï¼š<code>$ tsc ./Hello.ts</code> å³å¯ç”Ÿæˆ <code>Hello.js</code> æ–‡ä»¶äº†ã€‚</p>
</li>
<li>
<p>That's all, Thanks!</p>
</li>
</ol>
<h4>TypeScript ä¸ JavaScript çš„é€‰æ‹©ï¼š</h4>
<p>å¦‚ä½•æ›´å¥½çš„åˆ©ç”¨ JS çš„åŠ¨æ€æ€§å’Œ TS çš„é™æ€ç‰¹è´¨ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆé¡¹ç›®çš„å®é™…æƒ…å†µæ¥è¿›è¡Œç»¼åˆåˆ¤æ–­ã€‚ä¸€äº›å»ºè®®ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ä¸­å°å‹é¡¹ç›®ï¼Œä¸”ç”Ÿå‘½å‘¨æœŸä¸æ˜¯å¾ˆé•¿ï¼Œé‚£å°±ç›´æ¥ç”¨ JS å§ï¼Œä¸è¦è¢« TS æŸç¼šä½äº†æ‰‹è„šã€‚</li>
<li>å¦‚æœæ˜¯å¤§å‹åº”ç”¨ï¼Œä¸”ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿ï¼Œé‚£å»ºè®®è¯•è¯• TSã€‚</li>
<li>å¦‚æœæ˜¯æ¡†æ¶ã€åº“ä¹‹ç±»çš„å…¬å…±æ¨¡å—ï¼Œé‚£æ›´å»ºè®®ç”¨ TS äº†ã€‚</li>
</ul>
<p>è‡³äºåˆ°åº•ç”¨ä¸ç”¨ TSï¼Œè¿˜æ˜¯è¦çœ‹å®é™…é¡¹ç›®è§„æ¨¡ã€é¡¹ç›®ç”Ÿå‘½å‘¨æœŸã€å›¢é˜Ÿè§„æ¨¡ã€å›¢é˜Ÿæˆå‘˜æƒ…å†µç­‰å®é™…æƒ…å†µç»¼åˆè€ƒè™‘ã€‚æ‰€ä»¥ TypeScript èƒ½ä¸èƒ½æˆä¸ºäº†ä½ çš„ â€œåˆšéœ€â€ å°±çœ‹ä½ è‡ªå·±çš„æƒ…å†µäº†ã€‚ï¼ˆæ‘˜è‡ªçŸ¥ä¹æŸè´´ï¼‰</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ Unable to resolve your shell environment in a reasonable time.]]></title>
            <link>https://github.com/toFrankie/blog/issues/47</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/47</guid>
            <pubDate>Sat, 25 Feb 2023 11:14:57 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2676514a8c6e77f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2676514a8c6e77f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€èƒŒæ™¯</h2>
<p>ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èµ·ï¼Œæˆ‘é‚£æœå½¹äº† 5 å¹´å¤šçš„ MacBook Proï¼Œæ¯æ¬¡é‡å¯åç«‹åˆ»å”¤é†’ VS Code çš„æ—¶å€™ï¼Œæ€»ä¼šå¼¹å‡ºæç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-052f196aa930d4f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>Unable to resolve your shell environment in a reasonable time. Please review your shell configuration.
æ— æ³•åœ¨åˆç†çš„æ—¶é—´å†…è§£æ shell ç¯å¢ƒã€‚è¯·æ£€æŸ¥ shell é…ç½®ã€‚</p>
</blockquote>
<p>æ‰“å¼€ VS Code çš„æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>å‘½ä»¤è¡Œå¯åŠ¨ <code>code path/to/file</code></li>
<li>ç‚¹å‡»åº”ç”¨å›¾æ ‡</li>
</ul>
<p>ä¸Šè¿°é—®é¢˜ï¼Œä»…åœ¨éå‘½ä»¤è¡Œå¯åŠ¨æ‰ä¼šå‡ºç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°±æ˜¯è§£å†³é—®é¢˜çš„æ–¹å¼ä¹‹ä¸€ã€‚ä½†æˆ‘æƒ³ï¼Œæ›´å¤šäººæ˜¯é€šè¿‡ç‚¹å‡» LaunchPad æˆ– Dock æ åº”ç”¨å›¾æ ‡å¯åŠ¨çš„ã€‚</p>
<h2>äºŒã€åŸå› </h2>
<p>å¤ç°æ­¥éª¤ï¼šåªè¦åœ¨ Shell é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ <code>sleep 30</code>ï¼ˆç¡çœ  30sï¼Œå®é™…ä¸Šè¶…è¿‡ 10s å³å¯ï¼‰ï¼Œç„¶åé‡å¯ VS Code å°±èƒ½çœ‹åˆ°è¯¥æç¤ºã€‚</p>
<p>ä» <a href="https://code.visualstudio.com/docs/supporting/faq#_resolving-shell-environment-fails">Resolving shell environment fails</a> å¯çŸ¥ï¼š</p>
<blockquote>
<p>é€šè¿‡éå‘½ä»¤è¡Œæ–¹å¼å¯ç”¨ VS Code æ—¶ï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªå°è¿›ç¨‹æ¥è¿è¡Œ Shell ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ <code>.bashrc</code> æˆ– <code>.zshrc</code> é…ç½®æ–‡ä»¶ã€‚<strong>å¦‚æœ 10s åï¼ŒShell ç¯å¢ƒä»æœªè§£æå®Œæˆæˆ–è€…ç”±äºå…¶ä»–åŸå› å¯¼è‡´è§£æå¤±è´¥ï¼Œé‚£ä¹ˆ VS Code å°†ä¼šç»ˆæ­¢è§£æï¼Œç„¶åå°±ä¼šæç¤ºï¼šUnable to resolve your shell environment in a reasonable time. Please review your shell configuration.</strong></p>
</blockquote>
<p>ç”±äºä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨ VS Codeï¼Œå®ƒä¼šç»§æ‰¿ Shell ç¯å¢ƒå˜é‡ï¼Œå› æ­¤ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ï¼ˆ<a href="https://github.com/microsoft/vscode-js-debug/issues/717#issuecomment-680190832">#717</a>ï¼‰ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆ VS Code åœ¨å¯åŠ¨æ—¶è¦è§£æ Shell ï¼Ÿä»å…¶æè¿°ä¸Šçœ‹ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºåƒ taskã€debug targetsã€plugins ç­‰åŠŸèƒ½éœ€è¦è¯»å– Shell ç¯å¢ƒå˜é‡ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œåªè¦ç¡®ä¿ Shell é…ç½®ä¸å‡ºé”™ï¼Œä¸”è§£ææ—¶é—´åœ¨ 10s ä¹‹å†…ï¼Œå°±èƒ½è§£å†³é—®é¢˜äº†ã€‚</p>
</blockquote>
<p>å®˜æ–¹ç»™å‡ºçš„æ’æŸ¥æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>The process outlined below may help you identify which parts of your shell initialization are taking the most time:</p>
<ul>
<li>Open your shell's startup file (for example, in VS Code by typingÂ <code>~/.bashrc</code>Â orÂ <code>~/.zshrc</code>Â in Quick Open (âŒ˜P)).</li>
<li>Selectively comment out potentially long running operations (such asÂ <code>nvm</code>Â if you find that).</li>
<li>Save and fully restart VS Code.</li>
<li>Continue commenting out operations until the error disappears.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: WhileÂ <code>nvm</code>Â is a powerful and useful Node.js package manager, it can cause slow shell startup times, if being run during shell initialization. You might consider package manager alternatives such asÂ <a href="https://asdf-vm.com/">asdf</a>Â or search on the internet forÂ <code>nvm</code>Â performance suggestions.</p>
</blockquote>
<p>æŠŠ Shell é…ç½®æ–‡ä»¶ä¸­ä¸€äº›è€—æ—¶æ“ä½œç»™æ³¨é‡Šæ‰ä»¥å‡å°è§£ææ—¶é—´ã€‚è¿™é‡Œ nvm è¢«ç‚¹åäº†ï¼Œæ²¡é”™ï¼Œæˆ‘ç¡®å®æœ‰ç”¨åˆ°å®ƒã€‚</p>
<h2>ä¸‰ã€zsh å¯åŠ¨è€—æ—¶æµ‹è¯•</h2>
<p>æœ¬èŠ‚ä»¥ zsh ä¸ºä¾‹ã€‚</p>
<p>é¦–å…ˆï¼Œè¿™é‡Œåˆ©ç”¨è‡ªå¸¦çš„ <code>time</code> å‘½ä»¤æ¥è¡¡é‡å‘½ä»¤æ‰§è¡Œç”¨æ—¶ï¼ˆåŒ…æ‹¬ zshï¼‰ã€‚</p>
<pre><code class="language-shell">$ /usr/bin/time /bin/zsh -i -c exit

        0.62 real         0.33 user         0.32 sys
</code></pre>
<p><code>time</code> å‘½ä»¤ç»“æœè¾“å‡ºç”± <code>real_time</code>ã€<code>user_time</code> å’Œ <code>sys_time</code> ç»„æˆï¼š</p>
<ul>
<li><code>real_time</code>ï¼šè¡¨ç¤ºä»ç¨‹åºå¼€å§‹åˆ°ç¨‹åºæ‰§è¡Œç»“æŸæ—¶æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ CPU çš„ç”¨æ—¶å’Œæ‰€æœ‰å»¶è¿Ÿç¨‹åºæ‰§è¡Œçš„å› ç´ çš„æ€»å’Œã€‚å…¶ä¸­ CPU ç”¨æ—¶è¢«åˆ’åˆ†ä¸º user å’Œ sys ä¸¤éƒ¨åˆ†ã€‚</li>
<li><code>user_time</code>ï¼šè¡¨ç¤ºç¨‹åºæœ¬èº«ä»¥åŠå®ƒæ‰€è°ƒç”¨çš„åº“ä¸­çš„å­è¿›ç¨‹ä½¿ç”¨çš„æ—¶é—´ã€‚</li>
<li><code>sys_time</code>ï¼šè¡¨ç¤ºç”±ç¨‹åºç›´æ¥æˆ–é—´æ¥è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œçš„æ—¶é—´ã€‚</li>
</ul>
<p>ä½†æ³¨æ„ä¸‰è€…å¹¶æ²¡æœ‰ä¸¥æ ¼çš„å…³ç³»ã€‚é€šå¸¸å•æ ¸ CPU æ˜¯ <code>real_time &gt; user_time + sys_time</code>ï¼Œè€Œå¤šæ ¸ CPU åˆ™æ˜¯ <code>real_time &lt; user_time + sys_time</code>ï¼Œæ›´å¤š<a href="http://blog.he96.com/2011/01/linux-timewhat-do-real-user-and-sys.html">è¯·çœ‹</a>ã€‚</p>
<p>ä»¥ä¸Š zsh å¯åŠ¨æ—¶é—´ä»… 0.62sï¼Œä¸ºäº†æ•°æ®æ›´å‡†ç¡®ï¼Œä½¿ç”¨ for å¾ªç¯è¿ç»­å¯åŠ¨ 5 æ¬¡ï¼š</p>
<pre><code class="language-shell">$ for i in $(seq 1 5); do /usr/bin/time /bin/zsh -i -c exit; done

        0.66 real         0.34 user         0.35 sys
        0.64 real         0.34 user         0.34 sys
        0.66 real         0.34 user         0.36 sys
        0.66 real         0.34 user         0.36 sys
        0.65 real         0.34 user         0.35 sys
</code></pre>
<p>å¦‚æœä¸åŠ è½½ <code>~/.zshrc</code>ï¼ˆä½¿ç”¨ <code>--no-rcs</code> å‚æ•°ï¼‰çœ‹çœ‹æœ‰å¤šå¿«ï¼ˆä»¥ä¸‹æ˜¾ç¤ºä¸º 0 æ˜¯å› ä¸ºå¤ªå¿«äº†ï¼‰ï¼š</p>
<pre><code class="language-shell">$ for i in $(seq 1 5); do /usr/bin/time /bin/zsh --no-rcs -i -c exit; done
        0.00 real         0.00 user         0.00 sys
        0.00 real         0.00 user         0.00 sys
        0.00 real         0.00 user         0.00 sys
        0.00 real         0.00 user         0.00 sys
        0.00 real         0.00 user         0.00 sys
</code></pre>
<p>å¦å¤–ï¼Œzsh æä¾›äº†ä¸“é—¨çš„ profiling æ¨¡å—ç”¨äºè¡¡é‡ zsh å„ä¸ªå‡½æ•°çš„æ‰§è¡Œç”¨æ—¶ã€‚åœ¨ <code>~/.zshrc</code> é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œä»¥åŠ è½½ <code>zprof</code> æ¨¡å—ã€‚</p>
<pre><code class="language-shell"># ~/.zshrc
zmodload zsh/zprof
</code></pre>
<p>æ¥ç€ä½¿ç”¨ <code>zprof</code> å‘½ä»¤è·å–å„å‡½æ•°ç”¨æ—¶æ•°æ®ï¼š</p>
<pre><code class="language-shell">$ zprof
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    2         446.71   223.36   48.18%    190.57    95.28   20.55%  compinit
 2)    2         297.80   148.90   32.12%    170.88    85.44   18.43%  nvm
 3)    1         155.83   155.83   16.81%    155.83   155.83   16.81%  compdump
 4)    1         403.10   403.10   43.48%    105.29   105.29   11.36%  nvm_auto
 5)    1         112.56   112.56   12.14%    103.25   103.25   11.14%  nvm_ensure_version_installed
 6)  771          67.70     0.09    7.30%     67.70     0.09    7.30%  compdef
 7)    4          32.85     8.21    3.54%     32.85     8.21    3.54%  compaudit
 8)    1          30.02    30.02    3.24%     30.02    30.02    3.24%  is_update_available
 9)    2          42.88    21.44    4.63%     12.86     6.43    1.39%  (anon)
10)    1          14.29    14.29    1.54%     10.26    10.26    1.11%  nvm_die_on_prefix
11)    1           9.31     9.31    1.00%      9.31     9.31    1.00%  nvm_is_version_installed
12)  192           7.64     0.04    0.82%      7.45     0.04    0.80%  _zsh_autosuggest_bind_widget
13)    2           6.04     3.02    0.65%      6.04     3.02    0.65%  update_terminalapp_cwd
14)    1           5.87     5.87    0.63%      5.87     5.87    0.63%  nvm_supports_source_options
15)    1          13.21    13.21    1.43%      5.57     5.57    0.60%  _zsh_autosuggest_bind_widgets
16)    1           4.52     4.52    0.49%      4.52     4.52    0.49%  load_device_zsh_configuration
17)    1           3.83     3.83    0.41%      3.83     3.83    0.41%  nvm_grep
18)    3           1.17     0.39    0.13%      1.17     0.39    0.13%  up-line-or-beginning-search
19)    1           0.84     0.84    0.09%      0.84     0.84    0.09%  colors
20)    5           1.75     0.35    0.19%      0.53     0.11    0.06%  _zsh_autosuggest_invoke_original_widget
21)    4           2.11     0.53    0.23%      0.29     0.07    0.03%  _zsh_autosuggest_widget_clear
22)    4           0.24     0.06    0.03%      0.24     0.06    0.03%  add-zsh-hook
23)    1           0.23     0.23    0.02%      0.23     0.23    0.02%  update_terminal_cwd
24)    4           4.03     1.01    0.43%      0.20     0.05    0.02%  nvm_npmrc_bad_news_bears
25)    2           0.20     0.10    0.02%      0.20     0.10    0.02%  is-at-least
26)   15           0.19     0.01    0.02%      0.19     0.01    0.02%  _zsh_autosuggest_incr_bind_count
27)    3           1.98     0.66    0.21%      0.11     0.04    0.01%  _zsh_autosuggest_bound_2_up-line-or-beginning-search
28)    5           0.10     0.02    0.01%      0.10     0.02    0.01%  _zsh_autosuggest_highlight_reset
29)    5           0.09     0.02    0.01%      0.09     0.02    0.01%  _zsh_autosuggest_highlight_apply
30)    4           1.68     0.42    0.18%      0.08     0.02    0.01%  _zsh_autosuggest_clear
31)    1           0.31     0.31    0.03%      0.07     0.07    0.01%  _zsh_autosuggest_widget_accept
32)    1           0.06     0.06    0.01%      0.06     0.06    0.01%  nvm_has
33)    1          13.27    13.27    1.43%      0.06     0.06    0.01%  _zsh_autosuggest_start
34)    2           0.06     0.03    0.01%      0.06     0.03    0.01%  bashcompinit
35)    1         409.03   409.03   44.12%      0.06     0.06    0.01%  nvm_process_parameters
36)    1           0.12     0.12    0.01%      0.06     0.06    0.01%  complete
37)    3           0.05     0.02    0.01%      0.05     0.02    0.01%  is_theme
38)    1           0.20     0.20    0.02%      0.05     0.05    0.00%  _zsh_autosuggest_accept
39)    1           0.35     0.35    0.04%      0.04     0.04    0.00%  _zsh_autosuggest_bound_1_forward-char
40)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  _zsh_autosuggest_orig_forward-char
41)    1           0.27     0.27    0.03%      0.03     0.03    0.00%  _zsh_autosuggest_bound_1_accept-line
42)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  is_plugin
43)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  omz_termsupport_precmd
44)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  zle-line-finish
45)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  _zsh_autosuggest_orig_accept-line
46)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  detect-clipboard
47)    2           0.02     0.01    0.00%      0.02     0.01    0.00%  env_default
48)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  omz_termsupport_preexec
49)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  zle-line-init
50)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  nvm_is_zsh

-----------------------------------------------------------------------------------
...
</code></pre>
<p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡º <code>nvm</code> ç”¨æ—¶å æ¯”è¿˜æ˜¯å¾ˆå¤§çš„ã€‚æ­¤å‰æˆ‘åœ¨ Oh My Zsh çš„ <code>plugins</code> åŠ è½½äº†ä¸€é nvm æ’ä»¶ï¼ŒåŠ ä¸ŠåŸæœ‰çš„ nvm åŠ è½½é…ç½®ï¼Œå¯åŠ¨è€—æ—¶æ¥åˆ° 1.6s å·¦å³ï¼Œå°±å¾ˆç¦»è°±ï¼Œæ˜¯æˆ‘ç”¨é”™äº†ã€‚</p>
<h2>å››ã€è§£å†³ nvm è€—æ—¶é—®é¢˜</h2>
<p>å½“ç„¶ï¼Œå½±å“ zsh å¯åŠ¨ç”¨æ—¶çš„ä¸ä»…ä»…æœ‰ nvmï¼Œå…·ä½“å› äººè€Œå¼‚ã€‚</p>
<p>æˆ‘è¿™é‡Œé™¤äº† Oh My Zsh çš„ä¸€äº›ä¸œè¥¿ï¼ˆæœ‰ç©ºå†æ”¶æ‹¾å®ƒï¼‰ä¹‹å¤–ï¼Œå°±å± nvm è€—æ—¶æœ€å¤§äº†ã€‚</p>
<h4>æ–¹æ¡ˆä¸€ï¼ˆä¸æ¨èï¼‰</h4>
<p>ç”¨ Google æœç´¢ <code>Unable to resolve your shell environment in a reasonable time.</code> åº”è¯¥å¾ˆå®¹æ˜“æ‰¾åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è§£å†³æ–¹æ³•ï¼š</p>
<p>åœ¨ <code>.zshrc</code> ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-shell">function load-nvm {
  export NVM_DIR=&quot;$HOME/.nvm&quot;
  [ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;                   # This loads nvm
  [ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot; # This loads nvm bash_completion
}

# nvm
if [[ &quot;x${TERM_PROGRAM}&quot; = &quot;xvscode&quot; ]]; then
  echo 'in vscode, nvm not work; use `load-nvm`'
else
  load-nvm
fi
</code></pre>
<p>æ€è·¯å¾ˆç®€å•ï¼Œåˆ©ç”¨ç¯å¢ƒå˜é‡ <code>TERM_PROGRAM</code> åˆ¤æ–­è°ƒç”¨ Shell çš„åº”ç”¨ç¨‹åºï¼Œå¦‚æœæ˜¯ VS Code çš„è¯ï¼Œå°±ä¸åŠ è½½ nvmï¼Œä»¥å‡å°‘è§£æ Shell çš„æ—¶é—´ï¼Œä»è€Œè§£å†³æ–‡ç« å¼€å¤´çš„é—®é¢˜ã€‚</p>
<p>ä½†ä»ä½¿ç”¨ä½“éªŒä¸Šçœ‹ï¼Œæœ‰ç‚¹å‚»ï¼Œæœ‰ç‚¹éº»çƒ¦... å½“ä½ ä½¿ç”¨ VS Code å†…ç½®ç»ˆç«¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<pre><code class="language-shell"># åŠ è½½ .zshrc çš„è¾“å‡ºå†…å®¹
in vscode, nvm not work; use `load-nvm`

# æ‰§è¡Œ nvm å‘½ä»¤å‡ºé”™ï¼Œå› ä¸ºå¯åŠ¨å½“å‰ Shell æ—¶ä¸ºåŠ è½½ nvmï¼Œè‡ªç„¶å°±æ‰¾ä¸åˆ°äº†
$ nvm current
zsh: correct 'nvm' to 'nm' [nyae]? n
zsh: command not found: nvm

# æ‰‹åŠ¨åŠ è½½ nvmï¼ˆå‰é¢å£°æ˜çš„ä¸€ä¸ªåŠ è½½å‡½æ•°ï¼‰
$ load-nvm

# å†æ¬¡æ‰§è¡Œ nvm å‘½ä»¤
$ nvm current
v16.14.0
</code></pre>
<p>å¯¹äºä¸€ä¸ªé•¿æ—¶é—´ä½¿ç”¨ VS Code çš„ç”¨æˆ·æ¥è¯´ï¼Œè¿™æ˜¯ä¸èƒ½å®¹å¿çš„ï¼Œå³ä½¿ä½¿ç”¨ nvm çš„æ¬¡æ•°ä¹Ÿæ˜¯å¯¥å¯¥æ— å‡ ã€‚</p>
<h4>æ–¹æ¡ˆäºŒ</h4>
<p>åœ¨ nvm æ–‡æ¡£ä¸­ï¼Œå¯ä»¥å‘ç°ï¼š</p>
<blockquote>
<p>You can addÂ <code>--no-use</code>Â to the end of the above script (...<code>nvm.sh --no-use</code>) to postpone usingÂ <code>nvm</code>Â until you manuallyÂ <a href="https://github.com/nvm-sh/nvm#usage"><code>use</code></a>Â it.ï¼ˆ<a href="https://github.com/nvm-sh/nvm#additional-notes">è¯¦è§</a>ï¼‰</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯æ·»åŠ  <code>--no-use</code> å‚æ•°ï¼Œä»¥æ¨è¿Ÿä½¿ç”¨ <code>nvm</code>ã€‚å½“ä½ åœ¨ä½¿ç”¨æ—¶æ‰ä¼šåŠ è½½ã€‚ä¿®æ”¹ nvm ç›¸å…³é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># NVM
export NVM_DIR=&quot;$HOME/.nvm&quot;
[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot; --no-use          # This loads nvm
[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot; # This loads nvm bash_completion
</code></pre>
<p>ç„¶åå¯¹æ¯”ä¸‹ï¼Œ<code>--no-use</code> æ·»åŠ å‰å zsh çš„å¯åŠ¨ç”¨æ—¶ï¼š</p>
<pre><code class="language-shell">$ for i in $(seq 1 5); do /usr/bin/time /bin/zsh -i -c exit; done

        0.23 real         0.16 user         0.07 sys
        0.23 real         0.16 user         0.07 sys
        0.23 real         0.16 user         0.07 sys
        0.23 real         0.16 user         0.07 sys
        0.23 real         0.16 user         0.07 sys
</code></pre>
<p>ä»ä¹‹å‰çš„ 0.6s å¤šé™ä½åˆ° 0.2s å¤šã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒä¸ä¼šåƒæ–¹æ¡ˆä¸€é‚£æ ·ï¼Œè¿˜è¦æ‰‹åŠ¨æ‰§è¡ŒåŠ è½½ nvm çš„å‘½ä»¤ã€‚</p>
<h4>æ–¹æ¡ˆä¸‰</h4>
<p>å¬è¯´ nvm ç›¸æ¯”å…¶ä»– Node ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆï¼Œè¦æ…¢å¾ˆå¤šã€‚å¯é€‰çš„è§£å†³æ–¹æ¡ˆæœ‰ï¼š</p>
<ul>
<li><a href="https://github.com/tj/n">n</a>ï¼šä¸ nvm ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª npm åŒ…ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–äº nodeã€‚è€Œ nvm æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºã€‚</li>
<li><a href="https://github.com/Schniz/fnm">fnm</a>ï¼šä½¿ç”¨ rust å†™çš„ï¼Œæ˜¯ä¸æ˜¯è¿˜æ²¡ç”¨å°±æ„Ÿè§‰åˆ°å¿«äº†ï¼Œå“ˆå“ˆã€‚</li>
<li><a href="https://github.com/jasongin/nvs">nvs</a>ï¼šè¿™ä¸ªæ²¡äº†è§£è¿‡...</li>
<li><a href="http://nodejs.cn/download/package-manager">æ›´å¤šè¯·çœ‹...</a></li>
</ul>
<p>å…³äº <a href="https://fed.taobao.org/blog/taofed/do71ct/nvm-or-n/">ç®¡ç† node ç‰ˆæœ¬ï¼Œé€‰æ‹© nvm è¿˜æ˜¯ nï¼Ÿ</a></p>
<h2>äº”ã€å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="https://code.visualstudio.com/docs/supporting/faq#_resolving-shell-environment-fails">Resolving shell environment fails</a></li>
<li><a href="https://github.com/microsoft/vscode/issues/113869">Unable to resolve your shell environment notification after VS Code restored during MacOS restart</a></li>
<li><a href="https://stevenvanbael.com/profiling-zsh-startup">Profiling zsh startup time</a></li>
<li><a href="https://stackoverflow.com/questions/66162058/vscode-complains-that-resolving-my-environment-takes-too-long">VSCode complains that resolving my environment takes too long</a></li>
<li><a href="https://github.com/nvm-sh/nvm/issues/2724">nvm very slow to start</a></li>
<li><a href="https://blog.skk.moe/post/make-oh-my-zsh-fly/">æˆ‘å°±æ„Ÿè§‰åˆ°å¿« â€”â€” zsh å’Œ oh my zsh å†·å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[VS Code é…ç½®è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/46</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/46</guid>
            <pubDate>Sat, 25 Feb 2023 11:14:25 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-17fc06c03b4ff836.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-17fc06c03b4ff836.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä½œä¸ºä¸€ä¸ª JSerï¼Œå¯ç”¨äºå‰ç«¯å¼€å‘çš„å·¥å…·å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œåƒ <a href="https://atom.io/">Atom</a>ã€<a href="https://www.jetbrains.com/webstorm/">WebStorm</a>ã€<a href="https://www.dcloud.io/hbuilderx.html">HBuilder</a>ã€<a href="http://www.sublimetext.com/3">Sublime Text 3</a> ç­‰ç­‰ç­‰......å¯ç‹¬çˆ± <a href="https://code.visualstudio.com/">VS Code</a>ã€‚è®²çœŸçš„ï¼Œé™¤äº†åˆšå¼€å§‹æ¥è§¦å‰ç«¯æ—¶ç”¨è¿‡ Sublime Text æ¥å†™ä»£ç ï¼Œåé¢å‘ç° VS Code ä¹‹åï¼Œå°±æ²¡æ¢è¿‡ç¼–è¾‘å™¨äº†...</p>
<p>Anywayï¼Œå“ªä¸ªèˆ’æœç”¨å“ªä¸ªï¼Œä¸€æ¬ç –å·¥å…·è€Œå·²ï¼Œå“ˆå“ˆã€‚</p>
<blockquote>
<p>ä½†æ˜¯ï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚</p>
</blockquote>
<p>ä¸ºæ­¤ï¼Œæœ¬æ–‡ä¼šè®°å½•ä¸€äº› VS Code å¸¸ç”¨ä¸”å»ºè®®çš„é…ç½®ï¼Œå¹¶<strong>åŠæ—¶</strong>ã€<strong>æŒç»­åœ°</strong>æ›´æ–°ä»¥é€‚åº”æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿä¼šç§»é™¤ä¸€äº›åºŸå¼ƒçš„é…ç½®é¡¹ã€‚å®ƒæ›´æ–°å¾—å®åœ¨å¤ªé¢‘ç¹äº†...</p>
<h2>é…ç½®</h2>
<pre><code class="language-json5">{
  // å·¥ä½œåŒºç›¸å…³
  &quot;workbench.iconTheme&quot;: &quot;material-icon-theme&quot;, // æ–‡ä»¶å›¾æ ‡ä¸»é¢˜ï¼šMaterial Icon Theme

  // ç¼–è¾‘å™¨ç›¸å…³
  &quot;editor.trimAutoWhitespace&quot;: false, // åˆ é™¤è‡ªåŠ¨æ’å…¥çš„å°¾éšç©ºç™½ç¬¦å·
  &quot;editor.codeActionsOnSave&quot;: {
    // åœ¨ä¿å­˜æ—¶è¿è¡Œçš„ä»£ç æ“ä½œç±»å‹
    &quot;source.fixAll.eslint&quot;: true
  },
  &quot;editor.formatOnSave&quot;: true, // åœ¨ä¿å­˜æ—¶æ ¼å¼åŒ–æ–‡ä»¶
  &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;, // å®šä¹‰é»˜è®¤æ ¼å¼åŒ–ç¨‹åºï¼Œè¿™é‡ŒæŒ‡å®šäº† Prettierã€‚
  &quot;editor.minimap.enabled&quot;: false, // æ˜¯å¦æ˜¾ç¤ºç¼©ç•¥å›¾
  &quot;editor.bracketPairColorization.enabled&quot;: true, // å¯ç”¨æ‹¬å·å¯¹ç€è‰²ï¼Œè‡ª version 1.60 èµ·å¼€å§‹æ”¯æŒã€‚
  &quot;editor.suggest.preview&quot;: true, // æ§åˆ¶æ˜¯å¦åœ¨ç¼–è¾‘å™¨ä¸­é¢„è§ˆå»ºè®®ç»“æœ

  // æ–‡ä»¶ç›¸å…³
  &quot;files.trimTrailingWhitespace&quot;: true, // ä¿å­˜æ–‡ä»¶æ—¶åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç©ºç™½æ ¼
  &quot;files.associations&quot;: {
    // é…ç½®è¯­è¨€çš„æ–‡ä»¶å…³è”
    &quot;*.wxss&quot;: &quot;css&quot;,
    &quot;*.acss&quot;: &quot;css&quot;,
    &quot;*.wxs&quot;: &quot;javascript&quot;,
    &quot;*.sjs&quot;: &quot;javascript&quot;,
    &quot;*.axml&quot;: &quot;html&quot;,
    &quot;*.wxml&quot;: &quot;html&quot;,
    &quot;*.swan&quot;: &quot;html&quot;,
    &quot;*.vue&quot;: &quot;vue&quot;
  },
  &quot;files.exclude&quot;: {
    // æ–‡ä»¶èµ„æºç®¡ç†å™¨æ ¹æ®æ­¤è®¾ç½®å†³å®šè¦æ˜¾ç¤ºæˆ–éšè—çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
    &quot;**/.git&quot;: true,
    &quot;**/.svn&quot;: true,
    &quot;**/.hg&quot;: true,
    &quot;**/CVS&quot;: true,
    &quot;**/.DS_Store&quot;: true
  },

  // æœç´¢ç›¸å…³
  // åœ¨ä½¿ç”¨æœç´¢åŠŸèƒ½æ—¶ï¼Œé»˜è®¤å°†è¿™äº›æ–‡ä»¶å¤¹/æ–‡ä»¶æ’é™¤åœ¨å¤–ã€‚
  // è®¾ç½®ä¹‹åå¯åœ¨æœç´¢æ¡†ä¸‹åˆ‡æ¢â€œé½¿è½®+å‡å·â€çš„å›¾æ ‡æ¥æ˜¯å¦æ‰§è¡Œæ­¤é€‰é¡¹
  &quot;search.exclude&quot;: {
    &quot;**/node_modules&quot;: true,
    &quot;**/bower_components&quot;: true
  },

  // ESLint ç›¸å…³
  &quot;eslint.workingDirectories&quot;: [{ &quot;mode&quot;: &quot;auto&quot; }], // æŒ‡ç¤º ESLint æ ¹æ® package.jsonã€.eslintignore å’Œ .eslintrc* æ–‡ä»¶çš„ä½ç½®æ¨æ–­å·¥ä½œç›®å½•ã€‚
  &quot;eslint.options&quot;: {
    // æ›´å¤šè¯¦è§ https://eslint.cn/docs/developer-guide/nodejs-api#cliengine
    &quot;extensions&quot;: [&quot;.js&quot;, &quot;.ts&quot;, &quot;jsx&quot;, &quot;.tsx&quot;] // è¦æ£€æŸ¥çš„æ–‡ä»¶æ‰©å±•åçš„æ•°ç»„
  },
  &quot;eslint.validate&quot;: [&quot;javascript&quot;, &quot;javascriptreact&quot;, &quot;vue&quot;, &quot;typescript&quot;, &quot;typescriptreact&quot;] // æŒ‡å®š ESLint å¯è¯†åˆ«çš„è¯­è¨€æ•°ç»„ï¼Œæœªå®‰è£… ESLint æ’ä»¶æ—¶å°†æ˜¾ç¤ºé”™è¯¯ã€‚

  // Prettier ç›¸å…³ï¼Œéœ€é…åˆ editor.formatOnSave ä½¿ç”¨
  // å½“æ²¡æœ‰æ˜¾å¼æŒ‡å®šé…ç½®æ–‡ä»¶æ—¶ï¼Œæ’ä»¶ä¸­çš„é…ç½®é¡¹å°†ä½œä¸ºåå¤‡ã€‚
  // ç›¸ååœ°ï¼Œå¦‚æœå­˜åœ¨ä»»ä½•æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œå°†ä¸ä¼šä½¿ç”¨ VS Code æ’ä»¶çš„é…ç½®ã€‚
  // æ›´å¤šï¼šhttps://github.com/toFrankie/lint-config-custom/blob/main/docs/usage-prettier.md
  &quot;prettier.printWidth&quot;: 120,
  &quot;prettier.semi&quot;: false,
  &quot;prettier.arrowParens&quot;: &quot;avoid&quot;,
  &quot;prettier.singleQuote&quot;: true,
  &quot;prettier.trailingComma&quot;: &quot;none&quot;,
}
</code></pre>
<h2>å…¶ä»–</h2>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/44">æ¨èä¸¤æ¬¾ä¸é”™çš„ VS Code çš„ä¸»é¢˜</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/327">ä½¿ç”¨ VS Code + Github æ­å»ºä¸ªäººåšå®¢</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/43">å¸¸ç”¨ VS Code æ‰©å±•æ¨è</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://www.zhihu.com/column/vs-code">ç©è½¬ VS Code ä¸“æ </a></li>
<li><a href="https://zhuanlan.zhihu.com/p/113222681">å²ä¸Šæœ€å…¨ vscode é…ç½®ä½¿ç”¨æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/qq_41139830/article/details/85221330">è¶…å®ç”¨ VS Code æ’ä»¶æ¨è</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å®‰åˆ©ä¸€ä¸ªé€šè¿‡å‘½ä»¤è¡Œä½¿ç”¨ VS Code æ‰“å¼€é¡¹ç›®çš„æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/45</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/45</guid>
            <pubDate>Sat, 25 Feb 2023 11:14:01 GMT</pubDate>
            <description><![CDATA[<p>ä¸€æ¬¡æ— æ„ä¸­çš„å‘ç°ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½ç”¨ã€‚</p>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨ VS Code æ‰“å¼€é¡¹ç›® <code>your_project</code>ã€‚</p>
<pre><code>$ code ~/your_project
</code></pre>
<h3>å®‰è£…</h3>
<p>æ–¹æ³•éå¸¸ç®€å•ï¼Œæ‰“å¼€ VS Code]]></description>
            <content:encoded><![CDATA[<p>ä¸€æ¬¡æ— æ„ä¸­çš„å‘ç°ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½ç”¨ã€‚</p>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨ VS Code æ‰“å¼€é¡¹ç›® <code>your_project</code>ã€‚</p>
<pre><code>$ code ~/your_project
</code></pre>
<h3>å®‰è£…</h3>
<p>æ–¹æ³•éå¸¸ç®€å•ï¼Œæ‰“å¼€ VS Codeï¼Œç„¶åæ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œå¿«æ·é”®æ˜¯ <code>CMD + shift + P</code>ï¼ˆWin ä¸‹ä¸º <code>Ctrl + shift + P</code>ï¼‰ï¼Œæ¥ç€è¾“å…¥ <code>&gt; code</code> å³å¯çœ‹åˆ°ï¼Œç„¶åç‚¹å‡»ä¸€ä¸‹å³å¯å®‰è£…ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3468c4b665522e25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>å¸è½½</h3>
<p>ä¸ä¸Šè¿°å·®ä¸å¤šï¼Œå‘½ä»¤é¢æ¿è¾“å…¥ <code>&gt; uninstall code</code>ï¼Œé€‰æ‹©å¯¹åº”é¡¹ç‚¹å‡»ç¡®è®¤å³å¯å¸è½½ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ¨èä¸¤æ¬¾ VS Code çš„å›¾æ ‡ä¸»é¢˜æ’ä»¶]]></title>
            <link>https://github.com/toFrankie/blog/issues/44</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/44</guid>
            <pubDate>Sat, 25 Feb 2023 11:13:35 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©æ¨èä¸¤ä¸ªå¹³æ—¶æ¯”è¾ƒå¸¸ç”¨ï¼Œè€Œä¸”æ„Ÿè§‰è¿˜ä¸é”™çš„å›¾æ ‡ã€‚åœ¨ VS Code æ’ä»¶ä¸­æœç´¢å¯¹åº”åç§°å³å¯ã€‚</p>
<h3>ä¸€ã€Material Icon Theme</h3>
<p>è¿™æ¬¾ä¸»é¢˜å«åš <a href="https://marketplace.visualstudio.com/items?itemName=PKie]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©æ¨èä¸¤ä¸ªå¹³æ—¶æ¯”è¾ƒå¸¸ç”¨ï¼Œè€Œä¸”æ„Ÿè§‰è¿˜ä¸é”™çš„å›¾æ ‡ã€‚åœ¨ VS Code æ’ä»¶ä¸­æœç´¢å¯¹åº”åç§°å³å¯ã€‚</p>
<h3>ä¸€ã€Material Icon Theme</h3>
<p>è¿™æ¬¾ä¸»é¢˜å«åš <a href="https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme">Material Icon Theme</a>ï¼Œå®ƒé‡‡ç”¨äº† Google Material Design é£æ ¼ï¼Œæ–‡ä»¶å›¾æ ‡ä»¥åŠæ–‡ä»¶å¤¹å›¾æ ‡è¦†ç›–éå¸¸çš„å…¨é¢ã€‚</p>
<p>è€Œä¸”åœ¨æš—é»‘æ¨¡å¼ä¸‹ä½¿ç”¨æ•ˆæœæ›´ä½³ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a4d09710104a1334.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå›¾"></p>
<p>å„ç§å›¾æ ‡ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-566a81f0b7265bc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡ä»¶å›¾æ ‡">
<img src="https://upload-images.jianshu.io/upload_images/5128488-e265d1251fdfad7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡ä»¶å¤¹å›¾æ ‡"></p>
<h3>äºŒã€vscode-icons-mac</h3>
<p><a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-icons-mac">vscode-icons-mac</a> çš„æ–‡ä»¶å›¾æ ‡ä¸ Â <a href="https://github.com/vscode-icons/vscode-icons">vscode-icons/vscode-icons</a> ä¸€è‡´ï¼Œåªæ˜¯æ–‡ä»¶å¤¹å›¾æ ‡æ”¹æˆäº† Mac é£æ ¼ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e8ee41a3f58366f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ•ˆæœå›¾"></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¸¸ç”¨ VS Code æ‰©å±•æ¨è]]></title>
            <link>https://github.com/toFrankie/blog/issues/43</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/43</guid>
            <pubDate>Sat, 25 Feb 2023 11:12:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711887781606.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>åœ¨æ­¤è®°å½•æ—¥å¸¸ä¸­ VS Code ç”¨å¾—è¾ƒå¤šçš„æ’ä»¶ï¼Œä¼š]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711887781606.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å†™åœ¨å‰é¢</h2>
<p>åœ¨æ­¤è®°å½•æ—¥å¸¸ä¸­ VS Code ç”¨å¾—è¾ƒå¤šçš„æ’ä»¶ï¼Œä¼šåå‘ Web å‰ç«¯å¤šä¸€äº›ã€‚</p>
<h2>ä¸»é¢˜ç±»</h2>
<p>ä½œä¸ºé¢œå€¼å…šï¼Œç¬¬ä¸€ååº”æ˜¯æ›´æ¢é»˜è®¤ä¸»é¢˜ã€‚ä¸‹é¢è¿™é…è‰²ä¸€è§é’Ÿæƒ…ï¼Œæ·±å¾—æˆ‘å¿ƒã€‚</p>
<blockquote>
<p><a href="https://github.com/antfu/vscode-theme-vitesse">https://github.com/antfu/vscode-theme-vitesse</a></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/3/1711863918221.png" alt=""></p>
<p>ç›®å‰åœ¨ä½¿ç”¨çš„æ’ä»¶ï¼š</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=antfu.theme-vitesse">Vitesse Theme</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=antfu.icons-carbon">Carbon Product Icons</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme">Material Icon Theme</a></li>
</ul>
<p>æˆ‘çš„é…ç½® ğŸ‘‡</p>
<pre><code class="language-json">{
  &quot;workbench.iconTheme&quot;: &quot;material-icon-theme&quot;,
  &quot;workbench.colorTheme&quot;: &quot;Vitesse Black&quot;,
  &quot;workbench.productIconTheme&quot;: &quot;icons-carbon&quot;,
  &quot;autoDetectColorScheme&quot;: false,
  &quot;workbench.preferredDarkColorTheme&quot;: &quot;Vitesse Black&quot;,
  &quot;workbench.preferredLightColorTheme&quot;: &quot;Vitesse Light&quot;
}
</code></pre>
<h2>ç¼–è¾‘ç±»</h2>
<h3>HTML/JSX</h3>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-close-tag">Auto Close Tag</a> - è‡ªåŠ¨æ·»åŠ é…å¯¹çš„ç»“æŸæ ‡ç­¾</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag">Auto Rename Tag</a> - è‡ªåŠ¨é‡å‘½åé…å¯¹æ ‡ç­¾</li>
</ul>
<blockquote>
<p>æ”¯æŒ JSX/TSX ç­‰æ‰©å±•è¯­æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>å…³äºè‡ªåŠ¨é‡å‘½åæ ‡ç­¾ï¼Œå…¶å®æœ‰å†…ç½® <a href="https://code.visualstudio.com/docs/languages/html#_auto-update-tags"><code>editor.linkedEditing</code></a>ï¼ˆé»˜è®¤å…³é—­ï¼‰ã€‚å¼€å¯åï¼Œä¸å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœï¼Œä½¿ç”¨ 1.87 ç‰ˆæœ¬äº²æµ‹ï¼Œå·²æ”¯æŒ HTMLã€Vue Templateã€JSX/TSXã€‚ä½†åƒ Vue å¯èƒ½è¦å®‰è£… <a href="https://marketplace.visualstudio.com/items?itemName=Vue.volar">Vue - Official</a> æ’ä»¶æ‰å¯ä»¥æ­£å¸¸è¯†åˆ«ã€‚</p>
</blockquote>
<h3>JS/TS</h3>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=jmsv.JavaScriptSnippetsStandard">JavaScript (ES6) code snippets in StandardJS style</a> - å…¶å®šä¹‰äº† ES6 å¸¸ç”¨çš„ Snippetï¼Œé€šè¿‡é”®å…¥ keyword è§¦å‘ã€‚</li>
</ul>
<blockquote>
<p>ä¸ªäººç”¨å¾—è¾ƒå¤šçš„æ˜¯ <code>imp</code>ã€<code>imd</code>ã€<code>clg</code>ï¼Œå¯¹åº”ä¸º <code>import fs from fs</code>ã€<code>import { rename } from 'fs'</code>ã€<code>console.log()</code>ã€‚å…¶å® VS Code æ˜¯æœ‰å†…ç½® Import Statementï¼Œä½†ä½“éªŒä¸Šæ„Ÿè§‰ä¸å¦‚è¯¥æ’ä»¶ã€‚</p>
</blockquote>
<h3>é‡å‘½å</h3>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=wmaurer.change-case">change-case</a> - æ›´æ”¹å‘½åè§„åˆ™ï¼Œæä¾›äº†éå¸¸ä¸°å¯Œçš„è§„åˆ™ï¼Œæ¯”å¦‚ <code>fooBar</code> â†’ <code>FOO_BAR</code> ç­‰ã€‚</li>
</ul>
<h3>æ™ºèƒ½æç¤ºç±»</h3>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a> - è·¯å¾„æ™ºèƒ½æç¤ºï¼Œé”®å…¥ <code>.</code>ã€<code>..</code> æˆ– <code>/</code> å³å¯è‡ªåŠ¨è§¦å‘è·¯å¾„æç¤ºã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=clinyong.vscode-css-modules">CSS Modules</a> - å¦‚æœä½ åœ¨ä½¿ç”¨ CSS Module çš„è¯ï¼Œå®ƒå¯ä»¥æä¾›æç¤ºï¼Œä¸”å¯ä»¥å¿«é€Ÿè·³è½¬è‡³å®šä¹‰å¤„ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=pranaygp.vscode-css-peek">CSS Peek</a> - è·Ÿä¸Šé¢æ’ä»¶ç±»ä¼¼ï¼Œå‡è®¾åœ¨ HTML ä¸­å¼•å…¥äº†å¤–éƒ¨ CSSï¼Œç‚¹å‡» <code>id</code> æˆ– <code>class</code> å¤„å¯ä»¥å¿«é€Ÿè·³è½¬è‡³å®šä¹‰å¤„ã€‚</li>
</ul>
<blockquote>
<p>å¿«é€Ÿè·³è½¬ï¼Œéœ€ âŒ˜ + Click æˆ– Ctrl + Click ç»„åˆã€‚ä¹Ÿå¯ä½¿ç”¨ âŒ˜ + âŒ¥ + Click åœ¨ä¾§æ æ‰“å¼€ã€‚</p>
</blockquote>
<blockquote>
<p>å¿«é€Ÿè·³è½¬ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† <a href="https://code.visualstudio.com/docs/editor/editingevolved#_go-to-definition">Go to Definition</a>ï¼ˆè½¬åˆ°å®šä¹‰ï¼‰çš„èƒ½åŠ›ã€‚</p>
</blockquote>
<h2>æ£€æŸ¥ä¸æ ¼å¼åŒ–ç±»</h2>
<p>è¿™ä¸ªå°±ä¸å¤šè¯´äº†ã€‚</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">ESLint</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier - Code formatter</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=stylelint.vscode-stylelint">Stylelint</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=mrmlnc.vscode-csscomb">CSScomb</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=timonwong.shellcheck">ShellCheck</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker">Code Spell Checker</a></li>
</ul>
<blockquote>
<p>å®ƒä»¬éƒ½è¦æ±‚æœ¬åœ°/å…¨å±€æœ‰æŒ‰ç…§ç›¸åº”ä¾èµ–ã€‚</p>
</blockquote>
<blockquote>
<p>åƒ ESLint å¦‚æœæ²¡æœ‰å®‰è£…ä¾èµ–ï¼ŒVS Code ä¼šæœ‰å®‰è£…çš„æç¤ºã€‚</p>
</blockquote>
<blockquote>
<p>åƒ Stylelint å¦‚æœæ‰¾ä¸åˆ°ä¾èµ–ï¼Œåˆ™ä¸åšä»»ä½•æ ¼å¼åŒ–å¤„ç†ã€‚</p>
</blockquote>
<blockquote>
<p>åƒ Prettier å¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°ä»»æ„æœ¬åœ°é…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>.prettierrc</code>ï¼‰ï¼Œåˆ™ä½¿ç”¨æ’ä»¶æœ¬èº«çš„é»˜è®¤é…ç½®ï¼Œå¯æ‰‹åŠ¨é…ç½®ã€‚</p>
</blockquote>
<blockquote>
<p>å…¶ä¸­ CSScomb æ˜¯ä¸€ä¸ªç›¸å¯¹å°ä¼—çš„æ’ä»¶å§ï¼Œç›®å‰å·²ä¸å†ç»´æŠ¤ï¼Œæˆ‘ä¸»è¦ç”¨æ¥å¯¹ CSS å±æ€§è¿›è¡Œæ’åºï¼ˆä¿å­˜æ—¶ï¼‰ã€‚æ„Ÿå…´è¶£å¯çœ‹è¿™ç¯‡<a href="https://github.com/toFrankie/blog/issues/315">æ–‡ç« </a>ã€‚</p>
</blockquote>
<p>æˆ‘çš„é…ç½® ğŸ‘‡</p>
<pre><code class="language-json">{
  &quot;editor.formatOnSave&quot;: true,
  &quot;editor.codeActionsOnSave&quot;: {
    &quot;source.fixAll.eslint&quot;: &quot;explicit&quot;,
    &quot;source.fixAll.prettier&quot;: &quot;explicit&quot;,
    &quot;source.fixAll.stylelint&quot;: &quot;explicit&quot;
  },
  &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;,
  
  &quot;prettier.printWidth&quot;: 100,
  &quot;prettier.semi&quot;: false,
  &quot;prettier.arrowParens&quot;: &quot;avoid&quot;,
  &quot;prettier.singleQuote&quot;: true,
  
  &quot;eslint.options&quot;: {
    &quot;extensions&quot;: [&quot;.js&quot;, &quot;.ts&quot;, &quot;jsx&quot;, &quot;.tsx&quot;],
    &quot;fix&quot;: true
  },
  &quot;eslint.workingDirectories&quot;: [
    {
      &quot;mode&quot;: &quot;auto&quot;
    }
  ],
  
  
  &quot;csscomb.formatOnSave&quot;: true,
  &quot;csscomb.syntaxAssociations&quot;: {
    &quot;*.wxss&quot;: &quot;css&quot;,
    &quot;*.acss&quot;: &quot;css&quot;
  },
  &quot;csscomb.ignoreFilesOnSave&quot;: [&quot;node_modules/**&quot;],
  &quot;csscomb.preset&quot;: &quot;~/Library/Mobile Documents/com~apple~CloudDocs/Terminal/csscomb/preset-custom.json&quot;,
}
</code></pre>
<h2>æç¤ºç±»</h2>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost">Import Cost</a> - æ˜¾ç¤ºå¯¼å…¥åŒ…çš„å¤§å°ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=kisstkondoros.vscode-gutter-preview">Image preview</a> - å›¾ç‰‡é¢„è§ˆï¼Œå¯æ”¯æŒæœ¬åœ°/ç½‘ç»œé“¾æ¥å›¾ç‰‡ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-todo-highlight">TODO Highlight</a> - é«˜äº® <code>TODO:</code>ã€<code>FIXME:</code> ç­‰æ³¨é‡Šï¼Œä»¥ä¾¿æ›´æ˜æ˜¾åœ°æé†’è¿˜æœ‰å°šæœªå®Œæˆçš„äº‹æƒ…ã€‚</li>
</ul>
<blockquote>
<p>å…¶ä¸­ Image preview æœ‰æ—¶ä¸èƒ½æ­£ç¡®è§£æåˆ°ä¸€äº›ä¸ä»¥ <code>.png</code> ç­‰å¸¸è§æ‰©å±•åç»“å°¾çš„å›¾ç‰‡é“¾æ¥ï¼Œå¯ä»¥é…ç½® <code>gutterpreview.urlDetectionPatterns</code> é€‰é¡¹å¤„ç†ã€‚æ¯”å¦‚å¾®ä¿¡å…¬ä¼—å·çš„å›¾ç‰‡èµ„æºé“¾æ¥ã€‚</p>
</blockquote>
<p>æˆ‘çš„é…ç½® ğŸ‘‡</p>
<pre><code class="language-json">{
  &quot;importCost.mediumPackageDarkColor&quot;: &quot;#7cc36e4d&quot;,
  &quot;importCost.smallPackageDarkColor&quot;: &quot;#7cc36e4d&quot;,
  &quot;importCost.mediumPackageLightColor&quot;: &quot;#7cc36e4d&quot;,
  &quot;importCost.smallPackageLightColor&quot;: &quot;#7cc36e4d&quot;,
  &quot;importCost.largePackageLightColor&quot;: &quot;#d44e404d&quot;,
  &quot;importCost.largePackageDarkColor&quot;: &quot;#d44e404d&quot;,
  
  &quot;gutterpreview.urlDetectionPatterns&quot;: [&quot;/^http(s)*://mmbiz.qpic.cn/i&quot;],
  
  &quot;todohighlight.isEnable&quot;: true,
  &quot;todohighlight.isCaseSensitive&quot;: true,
  &quot;todohighlight.keywords&quot;: [
    {
      &quot;text&quot;: &quot;TIPS:&quot;,
      &quot;color&quot;: &quot;#fff&quot;,
      &quot;backgroundColor&quot;: &quot;#64aaf0&quot;,
      &quot;isWholeLine&quot;: false
    }
  ]
}
</code></pre>
<blockquote>
<p>ç”±äº Import Cost é»˜è®¤é¢œè‰²æœ‰ç‚¹å–§å®¾å¤ºä¸»çš„æ„æ€ï¼Œäºæ˜¯åœ¨åŸæ¥é¢œè‰²åŸºç¡€ä¸Šè°ƒæ•´åˆ° 30% çš„ä¸é€æ˜åº¦ã€‚</p>
</blockquote>
<h2>å…¶ä»–</h2>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">Live Server</a> - å¯ä»¥å®æ—¶ Reload çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Frankie.github-blogger">Github Blogger</a> - éå¸¸ä¾¿æ·çš„ Github Issue åšå®¢ç¼–è¾‘å·¥å…·ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner">Code Runner</a> - ç”¨äºè¿è¡Œä»£ç ç‰‡æ®µã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced">Markdown Preview Enhanced</a> - Markdown è¯­å½•å¢å¼ºæ‰©å±•ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=aminer.codegeex">CodeGeeX: AI Code AutoComplete, Chat, Auto Comment</a> - â€œå…è´¹ç‰ˆ Github Copilotâ€ï¼Ÿå¦‚æœæ²¡æœ‰ä»˜è´¹ä½¿ç”¨ Github Copilotï¼Œå®ƒæˆ–è®¸æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=techer.open-in-browser">open in browser</a> - åœ¨æµè§ˆå™¨æ‰“å¼€ã€‚</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=jeff-hykin.polacode-2019">Polacode-2022</a> ç”Ÿæˆæ¼‚äº®çš„ä»£ç æˆªå›¾ã€‚</li>
</ul>
<blockquote>
<p>æœ‰æ—¶éœ€è¦å†™ä¸ªä¸´æ—¶ HTML ç¤ºä¾‹æ¥è°ƒè¯•/éªŒè¯æŸäº›åŠŸèƒ½ï¼Œè¯¸å¦‚æ­¤ç±»çš„ï¼ŒLive Server æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œå¾ˆä¾¿æ·ã€‚</p>
</blockquote>
<h2>References</h2>
<ul>
<li><a href="https://www.roboleary.net/vscode/2023/05/08/auto-rename-tags-react-vue-svelte.html">VS Code - Auto rename HTML tags in React, Vue, and others</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[AlmaLinux äº‘æœåŠ¡å™¨å›¾å½¢åŒ–ç•Œé¢ã€Chrome æµè§ˆå™¨çš„å®‰è£…]]></title>
            <link>https://github.com/toFrankie/blog/issues/42</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/42</guid>
            <pubDate>Sat, 25 Feb 2023 11:11:26 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ab4bb3046d7fe8c9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ab4bb3046d7fe8c9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è®°å½•ä¸€ä¸‹~</p>
<h3>ä¸€ã€é€šè¿‡ SSH å®¢æˆ·ç«¯ç™»å½•äº‘æœåŠ¡å™¨</h3>
<p>ä½¿ç”¨ <code>ssh</code> å‘½ä»¤è¿›è¡Œç™»å½•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ ssh user@hostname
</code></pre>
<blockquote>
<ul>
<li><code>user</code> æ˜¯ç”¨æˆ·å</li>
<li><code>hostname</code> æ˜¯ä¸»æœºåï¼Œå¯ä»¥æ˜¯åŸŸåæˆ– IP åœ°å€ï¼ˆé€šå¸¸æ˜¯å…¬ç½‘ IP åœ°å€ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>ç”¨æˆ·åä¸ä¸»æœºåä¹‹é—´ä½¿ç”¨ <code>@</code> éš”å¼€ã€‚
å‡è®¾äº‘æœåŠ¡å™¨çš„ç”¨æˆ·åæ˜¯ <code>root</code>ï¼Œäº‘æœåŠ¡å™¨å…¬ç½‘ IP åœ°å€ä¸ºï¼š<code>130.227.10.82</code>ï¼ˆå¦‚æœ‰é›·åŒï¼Œçº¯å±å·§åˆï¼‰ï¼Œå‘½ä»¤åˆ™æ˜¯ï¼š</p>
<pre><code class="language-shell">$ ssh root@130.227.10.82
</code></pre>
<p>é€šè¿‡ ssh ç™»å½•è¿æ¥äº‘æœåŠ¡å™¨ï¼Œå…ˆä¼šæœ‰ä¸€ä¸ªéªŒè¯è¿‡ç¨‹ï¼Œä»¥éªŒè¯è¿œç¨‹æœåŠ¡å™¨æ˜¯å¦ä¸ºé™Œç”Ÿåœ°å€ã€‚</p>
<p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥äº‘æœåŠ¡å™¨ï¼Œä¼šæœ‰å¦‚ä¸‹ç±»ä¼¼çš„è¾“å‡ºï¼Œè¡¨ç¤ºä¸è®¤è¯†è¯¥æœºå™¨ï¼Œæé†’æ˜¯å¦ç¡®è®¤è¿æ¥ã€‚</p>
<pre><code class="language-shell">The authenticity of host '130.227.10.82 (130.227.10.82)' can't be established.
ED25519 key fingerprint is SHA256:Vybt22mVXuNuB5unE++yowF7lgA/9/2bLSiO3qmYWBY.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? 
</code></pre>
<p>è‹¥è¦ç»§ç»­ï¼Œé”®å…¥ <code>yes</code> å³å¯ã€‚</p>
<p>æ¥ç€ï¼ŒæŒ‰è¦æ±‚è¾“å…¥æ‰€ç™»å½• <code>user</code> çš„å¯†ç ï¼ˆéæ˜æ–‡å½¢å¼çš„ï¼‰ï¼Œå°±èƒ½æˆåŠŸç™»å½•ä¸Šäº‘æœåŠ¡å™¨äº†ã€‚ğŸ‘‡</p>
<pre><code class="language-shell">root@130.227.10.82's password:
	
	Welcome to Huawei Cloud Service

Last login: Sun Oct 30 11:50:46 2022 from 112.94.175.201
</code></pre>
<h3>äºŒã€å®‰è£…å›¾å½¢åŒ–ç•Œé¢</h3>
<blockquote>
<p>åç»­æ“ä½œï¼Œå‡ä»¥ AlmaLinux æ“ä½œç³»ç»Ÿä¸ºä¾‹ã€‚</p>
</blockquote>
<p>é€šè¿‡ SSH ç™»å½•äº‘æœåŠ¡å™¨ä¹‹å...</p>
<h4>1. ç¡®ä¿ç³»ç»Ÿæ˜¯æœ€æ–°çš„ã€‚</h4>
<pre><code class="language-shell">$ sudo dnf update
$ sudo dnf install epel-release
</code></pre>
<p>ä»¥ä¸Šä¸ºä¸¤æ¡å‘½ä»¤ï¼Œè¯·åœ¨å‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼ˆä¼šæœ‰ç±»ä¼¼ <code>Complete!</code> çš„æç¤ºï¼Œåç»­å‘½ä»¤åŒç†ï¼‰åï¼Œæ‰æ¥ç€æ‰§è¡Œç¬¬äºŒæ¡ã€‚</p>
<p>å®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šæœ‰ç±»ä¼¼ <code>Is this ok [y/N]</code> çš„è¯¢é—®å¼äº¤äº’ï¼ŒæŒ‰æç¤ºé”®å…¥ <code>y</code> ä»¥ç»§ç»­ï¼ˆåç»­æ“ä½œåŒç†ï¼‰ã€‚</p>
<h4>2. å®‰è£… Gnome GUI å›¾å½¢åŒ–ç•Œé¢</h4>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">$ sudo dnf groupinstall &quot;Server with GUI&quot;
</code></pre>
<p>è€å¿ƒç­‰å¾…å®‰è£…å®Œæˆå³å¯...</p>
<h4>3. é»˜è®¤ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢å¯åŠ¨ç³»ç»Ÿã€‚</h4>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">$ sudo systemctl set-default graphical
</code></pre>
<h4>4. é‡å¯äº‘æœåŠ¡å™¨</h4>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥é‡å¯äº‘æœåŠ¡å™¨ã€‚</p>
<pre><code class="language-shell">$ reboot
</code></pre>
<p>æ³¨æ„ï¼Œæ‰§è¡Œ <code>reboot</code> ä¼šè‡ªåŠ¨æ–­å¼€ä¸äº‘æœåŠ¡å™¨çš„è¿æ¥ï¼Œè¯·ç¨ç­‰ä¸€ä¼šå¾…äº‘æœåŠ¡å™¨é‡æ–°å¯åŠ¨æˆåŠŸåï¼Œæ–¹å¯å†æ¬¡è¿æ¥äº‘æœåŠ¡å™¨ï¼Œå¦åˆ™é€šè¿‡ <code>ssh</code> è®¿é—®ä¼šæç¤º <code>Operation timed out</code> è¶…æ—¶ã€‚</p>
<blockquote>
<p><strong>è¯·æ³¨æ„ï¼Œå³ä½¿å®Œæˆä»¥ä¸Šæ“ä½œï¼Œé€šè¿‡ SSH å®¢æˆ·ç«¯æ¥è®¿é—®äº‘æœåŠ¡å™¨æ˜¯æ— æ³•çœ‹åˆ°å›¾å½¢åŒ–ç•Œé¢çš„ã€‚
è¯·åœ¨äº‘æœåŠ¡å™¨å‚å•†çš„ Web æ§åˆ¶å°å»è®¿é—®ä¸äº‘æœåŠ¡å™¨ã€‚</strong></p>
</blockquote>
<h3>ä¸‰ã€å®‰è£… Chrome æµè§ˆå™¨</h3>
<h4>1. ä¸‹è½½ Chrome æµè§ˆå™¨ RPM åŒ…ï¼š</h4>
<pre><code class="language-shell">$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
</code></pre>
<h4>2. ä½¿ç”¨ dnf å‘½ä»¤å®‰è£… Chrome æµè§ˆå™¨</h4>
<pre><code class="language-shell">$ sudo dnf install google-chrome-stable_current_x86_64.rpm
</code></pre>
<h4>3. éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h4>
<p>æ‰§è¡Œå‘½ä»¤ <code>google-chrome --version</code> åï¼Œå¦‚æ­£å¸¸æ‰“å°å‡ºç‰ˆæœ¬å·è¡¨ç¤ºå®‰è£…æˆåŠŸäº†ã€‚</p>
<pre><code class="language-shell">$ google-chrome --version
Google Chrome 107.0.5304.87 
</code></pre>
<h4>4. è§£å†³ root ç”¨æˆ·æ— æ³•å¯åŠ¨ Chrome æµè§ˆå™¨çš„é—®é¢˜</h4>
<p>å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>root</code> ç”¨æˆ·ç™»å½•äº†äº‘æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šæ— æ³•æ­£å¸¸å¯åŠ¨ Chrome æµè§ˆå™¨ã€‚å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼šğŸ‘‡</p>
<pre><code class="language-shell">Running as root without --no-sandbox is not supported. SeeÂ https://crbug.com/638180.
</code></pre>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>ä¸€æ˜¯ï¼Œé€šè¿‡å‘½ä»¤å¯åŠ¨ Chrome æµè§ˆå™¨ã€‚ğŸ‘‡</p>
<pre><code class="language-shell">$ /usr/bin/google-chrome-stable --no-sandbox
</code></pre>
<p>äºŒæ˜¯ï¼Œæ‰¾åˆ° Chrome çš„å¿«æ·æ–¹å¼ï¼Œå³é”®åœ¨å…¶ Command ä¸­æœ«å°¾æ·»åŠ  <code>--no-sandbox</code> å³å¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d13f8539eed86aed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ³¨æ„ï¼Œä¸Šå›¾ä¸º Ubuntu æ“ä½œç³»ç»Ÿï¼ŒAlmaLinux æ“ä½œç³»ç»Ÿåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<h3>å››ã€ä¿®æ”¹æœåŠ¡å™¨ SSH ç™»å½•è¶…æ—¶æ—¶é—´</h3>
<p>ç”±äºã€Œä¸æ´»åŠ¨ã€è€Œå¯¼è‡´çš„ SSH è¶…æ—¶æ˜¯ç›¸å½“æ¼äººçš„ï¼Œé€šå¸¸è¿«ä½¿ä½ é‡æ–°å¯åŠ¨è¿æ¥å¹¶é‡æ–°å¼€å§‹ï¼Œå› æ­¤æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹è¶…æ—¶æ—¶é—´ã€‚</p>
<p>ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤æ¥è®¾ç½® <code>ClientAliveInterval</code> å’Œ <code>ClientAliveCountMax</code>ï¼š</p>
<pre><code class="language-shell">$ echo ClientAliveInterval 30 &gt;&gt; /etc/ssh/sshd_config
$ echo ClientAliveCountMax 120 &gt;&gt; /etc/ssh/sshd_config
</code></pre>
<p>è¯¥è®¾ç½®è¡¨ç¤ºï¼š</p>
<blockquote>
<ul>
<li><code>ClientAliveInterval</code>ï¼šæ¯éš” 30s å‘é€å¿ƒè·³æ•°æ®</li>
<li><code>ClientAliveCountMax</code>ï¼š å…è®¸è¶…æ—¶120æ¬¡æ•°ï¼Œè¶…è¿‡åæ–­å¼€é“¾æ¥</li>
</ul>
</blockquote>
<p>å› æ­¤ï¼Œæ•´ä¸ª SSH ä¼šè¯å°†ä¼šåœ¨ 1 å°æ—¶ï¼ˆ1200s Ã— 30 = 3600sï¼‰å†…ä¿æŒæ´»åŠ¨çŠ¶æ€è€Œä¸ä¼šä¸¢å¤±ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è®¾ç½® <code>ClientAliveInterval 3600</code> æ¥è·å¾—ç›¸åŒçš„ç»“æœã€‚</p>
<p>é‡å¯ sshd æœåŠ¡ä½¿è®¾ç½®ç”Ÿæ•ˆã€‚</p>
<pre><code class="language-shell">$ sudo systemctl reload sshd
</code></pre>
<h3>äº”ã€å‚è€ƒæ–‡ç« </h3>
<ul>
<li><a href="https://www.yundongfang.com/Yun47900.html">å¦‚ä½•åœ¨ AlmaLinux 8 ä¸Šå®‰è£… Gnome</a></li>
<li><a href="https://www.xtuos.com/4224.html">å¦‚ä½•åœ¨ AlmaLinux 8 ä¸Šå®‰è£…è°·æ­Œæµè§ˆå™¨</a></li>
<li><a href="https://www.cnblogs.com/hbsygfz/p/8409517.html">è§£å†³ ubuntu ç³»ç»Ÿ root ç”¨æˆ·ä¸‹ Chrome æ— æ³•å¯åŠ¨é—®é¢˜</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Shell ä¹‹å˜é‡ï¼ˆä¸‰ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/41</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/41</guid>
            <pubDate>Sat, 25 Feb 2023 11:11:05 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0fb73ef0be42820d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0fb73ef0be42820d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>ä¸Šä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/40">Shell ä¹‹å˜é‡</a></p>
</blockquote>
<h2>ä¸€ã€å‰è¨€</h2>
<p>Shell è„šæœ¬è¯­è¨€æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ã€‚å®é™…ä¸Šï¼Œå®ƒå¹¶æ²¡æœ‰æ•°æ®ç±»å‹çš„æ¦‚å¿µï¼Œæ— è®ºä½ è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•°å­—ï¼Œéƒ½æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²ç±»å‹æ¥å­˜å‚¨çš„ã€‚</p>
<blockquote>
<p>è‡³äºæ˜¯ä»€ä¹ˆç±»å‹ï¼ŒShell ä¼šæ ¹æ®ä¸Šä¸‹æ–‡å»ç¡®å®šå…·ä½“ç±»å‹ã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ sum=1+2
$ echo $sum
1+2
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼ŒShell è®¤ä¸º <code>1+2</code> æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç®—æœ¯è¿ç®—ä¹‹åå°†ç»“æœå†èµ‹å€¼ç»™å˜é‡ <code>sum</code>ã€‚</p>
<p>å¦‚æœä½ è¦è¿›è¡Œç®—æœ¯è¿ç®—ï¼Œå¯ä»¥ç”¨ <code>let</code> å‘½ä»¤æˆ– <code>expr</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ let sum=1+2
$ echo $sum
3
</code></pre>
<p>ğŸ‘† æ ¹æ® <code>let</code> å‘½ä»¤ï¼ŒShell ç¡®å®šäº†ä½ æƒ³è¦çš„æ˜¯ç®—æœ¯è¿ç®—ï¼Œå› æ­¤å°±èƒ½å¾—åˆ° <code>3</code>ã€‚</p>
<p><strong>å¦‚æœéè¦åˆ’åˆ†çš„è¯ï¼Œå¯ä»¥æœ‰ï¼šã€Œå­—ç¬¦ä¸²ã€ã€ã€Œå¸ƒå°”å€¼ã€ã€ã€Œæ•´æ•°ã€å’Œã€Œæ•°ç»„ã€ã€‚</strong></p>
<h2>äºŒã€å­—ç¬¦ä¸²</h2>
<p>åœ¨ Shell ä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯å­—ç¬¦ä¸²ç±»å‹äº†ã€‚æ³¨æ„å‡ ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>å½“å­—ç¬¦ä¸²ä¸åŒ…å«ã€Œç©ºç™½ç¬¦ã€ï¼Œå¼•å·æ˜¯å¯é€‰çš„ã€‚è‹¥åŸæ„å°±æ˜¯è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œéæ•´æ•°æˆ–æ•°ç»„æ—¶ï¼Œå»ºè®®ä½¿ç”¨å¼•å·ã€‚</li>
<li>ç”±å•å¼•å·åŒ…è£¹çš„å­—ç¬¦ï¼Œéƒ½ä¼šåŸæ ·è¾“å‡ºã€‚ä¸”å•å¼•å·åŒ…è£¹çš„å†…å®¹ä¸å…è®¸å†å‡ºç°å•å¼•å·ï¼Œè½¬ä¹‰ä¹Ÿä¸è¡Œã€‚</li>
<li>ç”±åŒå¼•å·åŒ…è£¹çš„å­—ç¬¦ï¼Œä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼ˆä¸»è¦æœ‰ <code>$</code>ã€<code>`</code>ã€<code>\</code>ï¼‰ä¼šè¿›è¡Œæ‰©å±•æˆ–è½¬ä¹‰ã€‚</li>
<li>è‹¥è¦åœ¨åŒå¼•å·å†…è¾“å‡º <code>$</code>ã€<code>`</code>ã€<code>\</code>ã€<code>&quot;</code> å­—ç¬¦ï¼Œä½¿ç”¨åæ–œæ  <code>\</code> è¿›è¡Œè½¬ä¹‰å³å¯ã€‚</li>
</ul>
</blockquote>
<p>å…³äºå¼•å·çš„ç”¨æ³•ï¼Œæ¨èçœ‹ä¸‹ ğŸ‘‰ <a href="https://google.github.io/styleguide/shellguide.html#s5.7-quoting">Google Shell Style Guide - quoting</a>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell"># âœ…
str=Frankie
str='Frankie' # æ¨è
str=&quot;Frankie&quot;
str=&quot;Frankie's&quot; # æ¨è
str=&quot;Frankie's MacBook Pro&quot; # æ¨è
str='Frankie&quot;s MacBook Pro' # æ¨è
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹è¯­æ³•ä¸Šæ˜¯å…è®¸çš„ï¼ŒğŸ‘‡ ä»¥ä¸‹åˆ™æ˜¯é”™è¯¯ç¤ºä¾‹ã€‚</p>
<pre><code class="language-shell"># âŒ
str='Frankie's MacBook Pro'
</code></pre>
<h4>2.1 è·å–å­—ç¬¦ä¸²é•¿åº¦</h4>
<p>è¯­æ³•ä¸º <code>${#å˜é‡å}</code>ï¼Œä¸” <code>{}</code> æ˜¯å¿…é¡»çš„ã€‚</p>
<pre><code class="language-shell">$ str='Frankie'
$ echo ${#str} 
7
</code></pre>
<h4>2.2 æˆªå–å­ä¸²</h4>
<p>è¯­æ³•ä¸º <code>${å˜é‡å:èµ·å§‹ä½ç½®:æˆªå–é•¿åº¦}</code>ï¼Œæ³¨æ„èµ·å§‹ä½ç½®ä» <code>0</code> å¼€å§‹è®¡ç®—ã€‚</p>
<blockquote>
<ul>
<li>è‹¥çœç•¥æˆªå–é•¿åº¦ï¼Œè¡¨ç¤ºæˆªå–ä»èµ·å§‹ä½ç½®å¼€å§‹åˆ°ç»“å°¾çš„å­ä¸²ã€‚</li>
<li>èµ·å§‹ä½ç½®å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œä½†è´Ÿæ•°å‰é¢å¿…é¡»è¦è¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä»¥å…ä¸è®¾ç½®å˜é‡é»˜è®¤å€¼ <code>${foo:-hello}</code> çš„è¯­æ³•æ··æ·†ã€‚</li>
<li>æˆªå–é•¿åº¦å¯ä»¥æ˜¯è´Ÿå€¼ï¼Œè¡¨ç¤ºè¦æ’é™¤ä»å­—ç¬¦æœ«å°¾å¼€å§‹çš„ N ä¸ªå­—ç¬¦ã€‚</li>
</ul>
</blockquote>
<p>ä»¥ä¸Šæ“ä½œï¼Œä¸ä¼šæ”¹å˜åŸå­—ç¬¦ä¸²ï¼Œç±»ä¼¼ JavaScript çš„ <code>Array.prototype.substr()</code> æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚ <code>${str:6:5}</code>ï¼Œåœ¨å˜é‡ <code>str</code> ä¸­æˆªå–ç¬¬ <code>6</code> ä½ï¼ˆåŒ…å«ï¼‰å¼€å§‹ï¼Œé•¿åº¦ä¸º <code>5</code> çš„å­ä¸²ã€‚</p>
<pre><code>$ str='Hello Shell!'
$ echo ${str:6:5}
Shell
</code></pre>
<p>ğŸ‘† ä»¥ä¸Š <code>${str:6:5}</code> å¯ä»¥æ›¿æ¢ä¸º <code>${str: -6:-1}</code>ï¼Œè¡¨ç¤ºæˆªå–å˜é‡ <code>str</code> ä¸­å€’æ•°ç¬¬ <code>6</code> ä½ï¼ˆåŒ…å«ï¼‰å¼€å§‹ï¼Œåˆ°å€’æ•°ç¬¬ <code>1</code>  ä¸ªä¹‹å‰çš„å­ä¸²ã€‚</p>
<h4>2.3 å­—ç¬¦ä¸²æœç´¢ä¸æ›¿æ¢</h4>
<p>Shell æä¾›äº†å¤šç§æœç´¢ã€æ›¿æ¢çš„æ–¹æ³•ã€‚</p>
<p>å…·ä½“çœ‹è¿™ä¸€ç¯‡ï¼š<a href="https://wangdoc.com/bash/string.html#%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2">Bash å­—ç¬¦ä¸²æ“ä½œ</a>ã€‚è¯·æ³¨æ„ï¼Œæ›¿æ¢æ–¹æ³•åªæœ‰è´ªå©ªåŒ¹é…æ¨¡å¼ã€‚</p>
<h4>2.4 å¤§å°å†™è½¬æ¢</h4>
<p>åˆ©ç”¨ <code>tr</code>ï¼ˆtransformï¼‰å‘½ä»¤ï¼Œå¯å®ç°å¤§å°å†™è½¬æ¢ã€‚</p>
<pre><code class="language-shell">$ str='Frankie'
$ echo $str | tr 'a-z' 'A-Z'
FRANKIE
$ echo $str | tr 'A-Z' 'a-z'
frankie
</code></pre>
<h2>ä¸‰ã€å¸ƒå°”å€¼</h2>
<p>å®šä¹‰å¸ƒå°”å€¼è·Ÿå­—ç¬¦ä¸²ä¸€æ · ğŸ‘‡</p>
<pre><code class="language-bash">truth=true
falsy=false
</code></pre>
<p>æ³¨æ„æ¡ä»¶åˆ¤æ–­å³å¯ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-bash">bool=false
if $bool; then
  echo 'Done'
fi
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œåªæœ‰å˜é‡ <code>bool</code> çš„å€¼ä¸º <code>false</code>ï¼Œæ‰ä¼šè¿›å…¥ <code>then</code> è¯­å¥è¾“å‡º <code>Done</code>ã€‚å°±ç®—æ˜¯ <code>bool</code> æœªå®šä¹‰ã€æˆ–å˜é‡è¢«åˆ é™¤äº†ã€æˆ–è€… <code>bool</code> çš„å€¼ä¸ºç©ºå­—ç¬¦ï¼Œéƒ½ä¸ä¼šè¿›å…¥ <code>then</code> è¯­å¥ã€‚</p>
<p>å› æ­¤ï¼Œå¸ƒå°”å€¼æ­£ç¡®çš„åˆ¤æ–­æ–¹å¼ï¼Œåº”ä½¿ç”¨ <code>test</code> å‘½ä»¤ï¼Œæˆ–ä½¿ç”¨ <code>test</code> çš„ç®€å†™è¯­æ³• <code>[ ]</code> æˆ– <code>[[ ]]</code>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-bash">bool=false

if [ $bool = true ]; then
  echo 'Done'
fi

if [ $bool = false ]; then
  echo 'Error'
fi
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šåˆ¤æ–­æ–¹å¼ï¼Œåªæœ‰å½“å˜é‡ <code>bool</code> çš„å€¼ä¸º <code>true</code> æˆ– <code>false</code> æ—¶ï¼Œæ‰ä¼šå‘½ä¸­æ¡ä»¶ã€‚</p>
<h2>å››ã€æ•´æ•°</h2>
<h4>4.1 ç®—æœ¯è¿ç®—</h4>
<p>åœ¨ Shell æœ‰ä¸¤ç§è¯­æ³•å¯ä»¥è¿›è¡Œç®—æœ¯è¿ç®—ã€‚</p>
<blockquote>
<ul>
<li><code>(( ... ))</code>ã€‚</li>
<li><code>$[ ... ]</code> - æ­¤ä¸ºæ—§è¯­æ³•ã€‚</li>
</ul>
</blockquote>
<p>å…¶ä¸­ <code>(( ... ))</code> å†…éƒ¨çš„ç©ºç™½ç¬¦ä¼šè¢«å¿½ç•¥ï¼Œå› æ­¤ <code>((1+1))</code> å’Œ <code>(( 1 + 1 ))</code> æ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p><code>(( ... ))</code> è¯­æ³•ä¸è¿”å›å€¼ï¼Œåªè¦è¿ç®—ç»“æœä¸ä¸º <code>0</code>ï¼Œåˆ™è¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œå¦åˆ™è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</p>
</blockquote>
<p><strong>è‹¥è¦è·å–è¿ç®—ç»“æœï¼Œéœ€åœ¨å‰é¢åŠ ä¸Š <code>$</code>ï¼Œå³ <code>$(( ... ))</code>ï¼Œä½¿å…¶å˜æˆç®—æœ¯è¡¨è¾¾å¼ï¼Œè¿”å›è¿ç®—ç»“æœã€‚</strong></p>
<pre><code class="language-shell">$ echo $((1 + 1))
2
</code></pre>
<p><code>(( ... ))</code> æ”¯æŒè¿™äº›è¿ç®—æ“ä½œï¼šåŠ å‡ä¹˜é™¤ã€å–ä½™ï¼ˆ<code>%</code>ï¼‰ã€æŒ‡æ•°ï¼ˆ<code>**</code>ï¼‰ã€è‡ªå¢ï¼ˆ<code>++</code>ï¼‰ã€è‡ªå‡ï¼ˆ<code>--</code>ï¼‰ã€‚</p>
<p><strong>æ³¨æ„ç‚¹ï¼š</strong></p>
<blockquote>
<ol>
<li><code>(( ... ))</code> å†…éƒ¨å¯ä½¿ç”¨åœ†æ‹¬å· <code>()</code> æ¥æ”¹å˜è¿ç®—é¡ºåºï¼Œäº¦å¯åµŒå¥—ã€‚</li>
<li><code>(( ... ))</code> å†…éƒ¨çš„å˜é‡æ— éœ€æ·»åŠ  <code>$</code>ï¼Œå› æ­¤é‡Œé¢çš„å­—ç¬¦ä¸²ä¼šè¢«è®¤ä¸ºæ˜¯å˜é‡ã€‚</li>
<li><code>(( ... ))</code> å†…éƒ¨ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å˜é‡ï¼Œä¸ä¼šæŠ¥é”™ã€‚åœ¨ Shell ä¸­è®¿é—®ä¸å­˜åœ¨çš„å˜é‡ä¼šè¿”å›ç©ºå€¼ï¼Œæ­¤æ—¶ <code>(( ... ))</code> ä¼šå°†ç©ºå€¼å½“ä½œ <code>0</code> å¤„ç†ã€‚</li>
<li>é™¤æ³•è¿ç®—çš„ç»“æœæ€»æ˜¯ã€Œæ•´æ•°ã€ã€‚æ¯”å¦‚ <code>$((5 / 2))</code> ç»“æœä¸º <code>2</code>ï¼Œè€Œä¸æ˜¯ <code>2.5</code>ã€‚</li>
<li><strong><code>(( ... ))</code> å’Œ <code>$[ ... ]</code> è¯­æ³•ï¼Œéƒ½åªèƒ½åšã€Œæ•´æ•°ã€çš„è¿ç®—ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</strong></li>
<li><code>(( ... ))</code> å¯ä»¥æ‰§è¡Œèµ‹å€¼è¿ç®—ï¼Œæ¯”å¦‚ <code>$((a = 1))</code> ä¼šå°†å˜é‡ <code>a</code> èµ‹å€¼ä¸º <code>1</code>ã€‚</li>
</ol>
</blockquote>
<h4>4.2 expr å‘½ä»¤</h4>
<p><code>expr</code> æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—å·¥å…·ã€‚æ”¯æŒï¼š</p>
<ul>
<li>åŠ æ³•è¿ç®—ï¼š<code>+</code></li>
<li>å‡æ³•è¿ç®—ï¼š<code>-</code></li>
<li>ä¹˜æ³•è¿ç®—ï¼š<code>\*</code></li>
<li>é™¤æ³•è¿ç®—ï¼š<code>/</code></li>
<li>å–æ¨¡è¿ç®—ï¼š<code>%</code></li>
</ul>
<p>æ³¨æ„ï¼Œè¿™é‡Œä¹˜æ³•è¿ç®— <code>\*</code> è¦åŠ  <code>\</code> è½¬ä¹‰ï¼Œå¦åˆ™ Shell è§£æç‰¹æ®Šç¬¦å·ã€‚è¿˜æœ‰ï¼Œéæ•´æ•°å‚ä¸è¿ç®—ä¼šæŠ¥é”™å“¦ï¼</p>
<pre><code class="language-shell">$ sum=$(expr 1 + 2)
$ echo $sum
3
</code></pre>
<h4>4.3 let å‘½ä»¤</h4>
<p><code>let</code> å‘½ä»¤ç”¨äºå°†ç®—æœ¯è¿ç®—çš„ç»“æœï¼Œèµ‹äºˆä¸€ä¸ªå˜é‡ã€‚</p>
<pre><code class="language-shell">$ let sum=1+2
$ echo $sum
3
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œä½¿å¾—å˜é‡ <code>sum</code> ç­‰äº <code>1+2</code> çš„è¿ç®—ç»“æœã€‚æ³¨æ„ï¼Œ<code>sum=1+2</code> é‡Œé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</p>
<h4>4.4 å°æ•°è¿ç®—</h4>
<p>ä»¥ä¸Š <code>(( ... ))</code> å’Œ <code>expr</code> å‘½ä»¤å‡ä¸æ”¯æŒå°æ•°è¿ç®—ï¼Œå¦‚æœæƒ³è¿›è¡Œå°æ•°è¿ç®—ï¼Œå¯ä»¥å€ŸåŠ© <code>bc</code> è®¡ç®—å™¨æˆ–è€… <code>awk</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ echo 'scale=4; 10/3' | bc
3.3333
</code></pre>
<p>ğŸ‘† å…¶ä¸­ <code>scale=4</code> è¡¨ç¤ºä¿ç•™å››ä½å°æ•°ã€‚</p>
<h4>4.5 é€»è¾‘è¿ç®—</h4>
<p><code>(( ... ))</code> ä¹Ÿæä¾›äº†é€»è¾‘è¿ç®—ï¼š</p>
<ul>
<li><code>&lt;</code> å°äº</li>
<li><code>&gt;</code> å¤§äº</li>
<li><code>&lt;=</code> å°äºæˆ–ç›¸ç­‰</li>
<li><code>&gt;=</code> å¤§äºæˆ–ç›¸ç­‰</li>
<li><code>==</code> ç›¸ç­‰</li>
<li><code>!=</code> ä¸ç›¸ç­‰</li>
<li><code>&amp;&amp;</code> é€»è¾‘ä¸</li>
<li><code>||</code> é€»è¾‘æˆ–</li>
<li><code>!</code> é€»è¾‘å¦</li>
<li><code>expr1 ? expr2 : expr3</code> ä¸‰å…ƒæ¡ä»¶è¿ç®—ç¬¦ã€‚è‹¥è¡¨è¾¾å¼ <code>expr1</code>  çš„è®¡ç®—ç»“æœä¸ºéé›¶å€¼ï¼ˆç®—æœ¯çœŸï¼‰ï¼Œåˆ™æ‰§è¡Œè¡¨è¾¾å¼
<code>expr2</code> ï¼Œå¦åˆ™æ‰§è¡Œè¡¨è¾¾å¼ <code>expr3</code>ã€‚</li>
</ul>
<blockquote>
<p>å½“é€»è¾‘è¡¨è¾¾å¼ä¸ºçœŸï¼Œè¿”å› <code>1</code>ï¼Œå¦åˆ™è¿”å› <code>0</code>ã€‚</p>
</blockquote>
<h2>äº”ã€æ•°ç»„</h2>
<p>åœ¨ Shell ä¸­ï¼Œå¯ä»¥ç”¨æ•°ç»„æ¥å­˜æ”¾å¤šä¸ªå€¼ï¼Œæ•°ç»„å…ƒç´ ä¹‹é—´é€šè¿‡ã€Œç©ºæ ¼ã€éš”å¼€ã€‚åªæ”¯æŒä¸€ç»´æ•°ç»„ï¼Œä¸æ”¯æŒå¤šç»´æ•°ç»„ã€‚</p>
<blockquote>
<p>åœ¨è¯»å–æ•°ç»„æˆå‘˜ã€éå†æ•°ç»„ç­‰æ–¹é¢ï¼Œbashã€zsh ä¹‹é—´ä¼šæœ‰ä¸€å®šçš„åŒºåˆ«ã€‚</p>
</blockquote>
<h4>5.1 æ•°ç»„èµ·å§‹ç´¢å¼•</h4>
<p>ç°ä»£é«˜çº§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå®ƒä»¬çš„æ•°ç»„èµ·å§‹ç´¢å¼•å¤šæ•°éƒ½æ˜¯ <code>0</code>ã€‚
<strong>ä½†åœ¨ Shell ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¸åŒçš„ Shell è§£æå™¨å…¶æ•°ç»„èµ·å§‹ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰å¯èƒ½æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚ bash çš„èµ·å§‹ç´¢å¼• <code>0</code>ï¼Œzsh çš„èµ·å§‹ç´¢å¼•æ˜¯ <code>1</code>ã€‚</strong></p>
<p>ğŸ‘‡ æ‘˜è‡ª  <a href="https://unix.stackexchange.com/a/252405">StackExchange</a>ï¼š</p>
<blockquote>
<p>Virtually all shell arrays (<code>Bourne</code>, <code>csh</code>, <code>tcsh</code>, <code>fish</code>, <code>rc</code>, <code>es</code>, <code>yash</code>) start at <code>1</code>. <code>ksh</code> is the only exception that I know (<code>bash</code> just copied <code>ksh</code>).</p>
</blockquote>
<p>è¿™æ ·çœ‹ï¼Œèµ·å§‹ç´¢å¼•ä¸º <code>1</code> çš„ Shell è§£æå™¨å å¤šæ•°ã€‚å¯¹äºä¹ æƒ¯äº†ä» <code>0</code> å¼€å§‹çš„æˆ‘æ¥è¯´ï¼Œè¿™ä¸€ç‚¹æ˜¯æœ‰çš„éš¾ä»¥æ¥å—çš„ã€‚å…³äºæ•°ç»„èµ·å§‹ç´¢å¼•ï¼Œæœ‰å…´è¶£çš„å¯çœ‹ï¼š<a href="https://exple.tive.org/blarg/2013/10/22/citation-needed/">CITATION NEEDED</a>ã€‚</p>
<pre><code class="language-bash">arr[0]=a
arr[1]=b
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œä½¿ç”¨ bash å»è§£ææ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†ç”¨ zsh è§£ææ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼š<code>assignment to invalid subscript range</code>ã€‚å› ä¸º zsh çš„èµ·å§‹ç´¢å¼•æ˜¯ <code>1</code> å¼€å§‹çš„ï¼Œæ‰€ä»¥ç´¢å¼• <code>0</code> æ˜¯ä¸€ä¸ªä¸åˆæ³•çš„ä¸‹æ ‡ã€‚</p>
<h4>5.2 åˆ›å»ºæ•°ç»„</h4>
<p>å¯ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥åˆ›å»ºæ•°ç»„ï¼š</p>
<pre><code class="language-bash"># åˆ›å»ºç©ºæ•°ç»„
arr=()

# åˆ›å»ºæ•°ç»„ï¼ŒæŒ‰é¡ºåºèµ‹å€¼
arr=(val1 val2 ... valN)

# åˆ›å»ºæ•°ç»„ï¼Œé€é¡¹æ·»åŠ 
arr[0]=val1
arr[1]=val2
arr[2]=val3

# åˆ›å»ºæ•°ç»„ï¼Œä¸æŒ‰é¡ºåºèµ‹å€¼
arr=([2]=val3 [0]=val1 [1]=val2)

# åˆ›å»ºç¨€ç–æ•°ç»„
arr=(val1 [2]=val3 val4)
</code></pre>
<p>æ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>æ²¡æœ‰èµ‹å€¼çš„æ•°ç»„å…ƒç´ å…¶é»˜è®¤å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>ä»¥ä¸Š <code>[2]=val3</code> å½¢å¼ä¸å…è®¸æœ‰ç©ºæ ¼ã€‚</li>
<li>å…ƒç´ ä¹‹é—´ä½¿ç”¨ç©ºæ ¼éš”å¼€ã€‚</li>
</ul>
<p>å‰é¢æåˆ°ï¼Œä¸åŒç±»å‹çš„ Shell çš„èµ·å§‹ç´¢å¼•å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤ä»¥ä¸Šé‡‡ç”¨ <code>[0]</code>ã€<code>[1]</code>ã€<code>[2]</code> ç­‰æ–¹å¼è®¾ç½®æŒ‡å®šé¡¹çš„å€¼ï¼Œå…¶è¡¨ç¤ºçš„ç¬¬å‡ é¡¹å…ƒç´ å¯èƒ½æ˜¯ä¸ç›¸åŒçš„ã€‚</p>
<p>è¿˜å¯ä»¥è¿™æ · ğŸ‘‡</p>
<pre><code class="language-shell"># å¯ä½¿ç”¨é€šé…ç¬¦ï¼Œå°†å½“å‰ç›®å½•çš„æ‰€æœ‰ MP3 æ–‡ä»¶ï¼Œæ”¾å…¥ä¸€ä¸ªæ•°ç»„
$ mp3s=(*.mp3)

# ç”¨ declare å£°æ˜ä¸€ä¸ªå…³è”æ•°ç»„ï¼Œå…¶ç´¢å¼•é™¤äº†æ”¯æŒæ•´æ•°ï¼Œä¹Ÿæ”¯æŒå­—ç¬¦ä¸²ã€‚
$ declare -a ARRAYNAME
</code></pre>
<h4>5.3 è¯»å–æ•°ç»„é•¿åº¦</h4>
<p>å‰é¢ä»‹ç»è¿‡ï¼Œè¯»å–å­—ç¬¦ä¸²é•¿åº¦çš„è¯­æ³•ä¸º <code>${#å˜é‡å}</code>ï¼Œæ•°ç»„ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚
ä½†è¦å€ŸåŠ©æ•°ç»„çš„ç‰¹æ®Šç´¢å¼• <code>@</code> å’Œ <code>*</code>ï¼Œå°†æ•°ç»„æ‰©å±•æˆåˆ—è¡¨ï¼Œç„¶åå†æ¬¡ä½¿ç”¨ <code>#</code> è·å–æ•°ç»„çš„é•¿åº¦ã€‚è¯­æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<pre><code class="language-bash">${#array[*]}
${#array[@]}
</code></pre>
<pre><code class="language-bash">arr1=(a b c)
arr2=('aa 00' 'bb 11' 'cc 22')

echo ${#arr1[*]}
echo ${#arr1[@]}

echo ${#arr2[*]}
echo ${#arr2[@]}
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç»“æœå‡è¾“å‡º <code>3</code>ã€‚</p>
<p>å¦‚æœæ˜¯è¯»å–æ•°ç»„æŸé¡¹çš„é•¿åº¦ï¼Œåˆ™ä½¿ç”¨ <code>${#æ•°ç»„å˜é‡å[ä¸‹æ ‡]}</code> çš„å½¢å¼ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-bash">arr[10]=foo
echo ${#arr[10]}
</code></pre>
<p>ğŸ‘†ä»¥ä¸Šè¾“å‡º <code>3</code>ï¼Œå®ƒè¯»å–çš„æ˜¯ç´¢å¼•ä¸º <code>10</code> çš„å…ƒç´ çš„å€¼çš„é•¿åº¦ã€‚</p>
<h4>5.4 è¯»å–æ•°ç»„å•ä¸ªæˆå‘˜</h4>
<p>å…¶è¯­æ³•ä¸º <code>${æ•°ç»„å˜é‡[ä¸‹æ ‡]}</code>ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ arr=(a b c)
$ echo ${arr[1]}
</code></pre>
<p>ğŸ‘† åŸºäºèµ·å§‹ç´¢å¼•çš„é—®é¢˜ï¼Œ<code>${arr[1]}</code> è¾“å‡ºå€¼å¯èƒ½æ˜¯ <code>a</code>ï¼Œä¹Ÿå¯èƒ½æ˜¯ <code>b</code>ã€‚
æ³¨æ„ï¼Œé‡Œé¢çš„ <code>{}</code> ä¸èƒ½çœç•¥ï¼Œå¦åˆ™ <code>$arr[1]</code> åœ¨ bash é‡Œè¾“å‡ºä½ <code>a[1]</code>ï¼Œç›¸å½“äº <code>$arr</code> çš„å€¼ä¸å­—ç¬¦ä¸² <code>[1]</code> è¿æ¥ï¼Œå› æ­¤ç»“æœæ˜¯ <code>a[1]</code>ã€‚</p>
<p>æ³¨æ„ä»¥ä¸‹è¯­æ³•ï¼š</p>
<pre><code class="language-shell">$ arr=(a b c)
$ echo $arr
</code></pre>
<p>ğŸ‘† åœ¨ zsh ä¸­ï¼Œå¯ä»¥è¾“å‡ºæ•°ç»„æ‰€æœ‰é¡¹ï¼Œå³ <code>a b c</code>ï¼Œåœ¨ bash åˆ™æ˜¯è¾“å‡ºæ•°ç»„ç¬¬ä¸€é¡¹ï¼Œå³ <code>a</code>ã€‚</p>
<p>è‹¥æƒ³åœ¨å„ç§ Shell ç¯å¢ƒä¸‹ç»Ÿä¸€ï¼Œæœ€åˆç†çš„åšæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨ç±»ä¼¼æˆªå–å­—ç¬¦ä¸²å­ä¸²çš„è¯­æ³•ï¼š</p>
<pre><code class="language-shell">${array[@]:offset:length}
</code></pre>
<p>å…¶ä¸­ <code>array[@]</code> è¡¨ç¤ºæ‰€æœ‰å…ƒç´ ï¼Œ<code>offset</code> è¡¨ç¤ºåç§»é‡ï¼ˆæ€»æ˜¯ä» <code>0</code> å¼€å§‹ï¼‰ï¼Œ<code>length</code> è¡¨ç¤ºæˆªå–é•¿åº¦ã€‚è¿™ç§è¯­æ³•åœ¨ä¸åŒ Shell ç¯å¢ƒä¸‹æ€»èƒ½è·å¾—ä¸€è‡´è¡Œä¸ºã€‚å› æ­¤ <code>${arr[@]:0:1}</code> æ€»èƒ½æ­£ç¡®åœ°å–åˆ°æ•°ç»„çš„ç¬¬ä¸€é¡¹ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œéœ€è¦å…¼å®¹ bash å’Œ zsh æ—¶ï¼Œåº”ä½¿ç”¨ <code>${array[@]:offset:length}</code> è¯­æ³•è€Œä¸æ˜¯ <code>${array[subscript]}</code> è¯­æ³•ã€‚</p>
</blockquote>
<h4>5.5 è¯»å–æ•°ç»„æ‰€æœ‰æˆå‘˜</h4>
<p>åˆ©ç”¨æ•°ç»„çš„ç‰¹æ®Šç´¢å¼• <code>@</code> å’Œ <code>*</code>ï¼Œå®ƒä»¬è¿”å›æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ã€‚</p>
<pre><code class="language-shell">$ arr=(a b c)
$ echo ${arr[@]}
$ echo ${arr[*]}
</code></pre>
<p>ğŸ‘† ä»¥ä¸Š <code>${arr[@]}</code> å’Œ <code>${arr[*]}</code> éƒ½è¾“å‡ºæ•°ç»„æ‰€æœ‰æˆå‘˜ <code>a b c</code>ã€‚å› æ­¤ï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªç‰¹æ®Šç´¢å¼•ï¼Œå¯é…åˆ <code>for</code> å¾ªç¯æ¥éå†æ•°ç»„ã€‚</p>
<pre><code class="language-bash">for item in &quot;${arr[@]}&quot;; do
  echo $item
done
</code></pre>
<h4>5.6 <code>${arr[@]}</code> å’Œ <code>${arr[*]}</code> ç»†èŠ‚åŒºåˆ«</h4>
<p>å…¶å·®å¼‚ï¼Œä¸»è¦ä½“ç°åœ¨ <code>for</code> å¾ªç¯ä¸Šã€‚</p>
<p><strong>ç¤ºä¾‹ä¸€ï¼š</strong></p>
<pre><code class="language-bash">arr=('aa 00' 'bb 11' 'cc 22')

echo 'use @, with double quote:'
for item in &quot;${arr[@]}&quot;; do
  echo &quot;--&gt; item: $item&quot;
done

echo 'use @, without double quote:'
for item in ${arr[@]}; do
  echo &quot;--&gt; item: $item&quot;
done
</code></pre>
<p>ğŸ‘† éƒ½æ˜¯ä½¿ç”¨äº† <code>@</code>ï¼ŒåŒºåˆ«åœ¨äº <code>${arr[@]}</code> å¤–å±‚æ˜¯å¦ä½¿ç”¨äº†ã€ŒåŒå¼•å·ã€ã€‚bash è¾“å‡ºå¦‚ä¸‹ï¼šğŸ‘‡</p>
<pre><code class="language-shell">use @, with double quote:
--&gt; item: aa 00
--&gt; item: bb 11
--&gt; item: cc 22

use @, without double quote:
--&gt; item: aa
--&gt; item: 00
--&gt; item: bb
--&gt; item: 11
--&gt; item: cc
--&gt; item: 22
</code></pre>
<p>è¿™é‡Œç”¨é«˜çº§è¯­è¨€æ¥ç±»æ¯”ï¼šé¦–å…ˆï¼ŒåŸæ•°ç»„æ˜¯ <code>['aa 00', 'bb 11', 'cc 22']</code>ã€‚å¦‚æœå¸¦åŒå¼•å· <code>&quot;${arr[@]}&quot;</code>ï¼Œéå†çš„æ˜¯åŸæ•°ç»„ã€‚å¦‚æœä¸å¸¦åŒå¼•å·  <code>${arr[@]}</code>ï¼Œç›¸å½“äºå†…éƒ¨éšå¼åœ°åšäº†ä¸€æ¬¡ã€Œæ‰å¹³åŒ–ã€æ“ä½œï¼Œä½¿å…¶å˜æˆ <code>['aa', '00', 'bb', '11', 'cc', '22']</code> å½¢å¼ï¼Œæœ€ç»ˆéå†çš„æ˜¯æ‰å¹³åŒ–åçš„äº§ç‰©ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œåœ¨éå†æ•°ç»„æ—¶ï¼Œè‹¥ä½¿ç”¨ <code>@</code> ç´¢å¼•ï¼Œåº”è¯¥è¦ä½¿ç”¨åŒå¼•å·ï¼Œä»¥ä¿æŒåŸæœ‰æ•°ç»„çš„ç»“æ„ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹äºŒï¼š</strong></p>
<pre><code class="language-bash">arr=('aa 00' 'bb 11' 'cc 22')

echo 'use *, with double quote:'
for item in &quot;${arr[*]}&quot;; do
  echo &quot;--&gt; item: $item&quot;
done

echo 'use *, without double quote:'
for item in ${arr[*]}; do
  echo &quot;--&gt; item: $item&quot;
done
</code></pre>
<p>ğŸ‘† éƒ½æ˜¯ä½¿ç”¨äº† <code>*</code>ï¼ŒåŒºåˆ«åœ¨äº <code>${arr[*]}</code> å¤–å±‚æ˜¯å¦ä½¿ç”¨äº†ã€ŒåŒå¼•å·ã€ã€‚bash è¾“å‡ºå¦‚ä¸‹ï¼šğŸ‘‡</p>
<pre><code class="language-shell">use *, with double quote:
--&gt; item: aa 00 bb 11 cc 22

use *, without double quote:
--&gt; item: aa
--&gt; item: 00
--&gt; item: bb
--&gt; item: 11
--&gt; item: cc
--&gt; item: 22
</code></pre>
<p>ä»ç»“æœä¸Šçœ‹ï¼Œ <code>&quot;${arr[*]}&quot;</code> æŠŠæ•°ç»„æ‰€æœ‰é¡¹å½“æˆäº†ä¸€ä¸ªæ•´ä½“ï¼Œéå†æ—¶åªæœ‰ä¸€é¡¹ã€‚è€Œä¸å¸¦åŒå¼•å·æ—¶ï¼Œ <code>${arr[*]}</code> ä¸  <code>${arr[@]}</code> è¡Œä¸ºä¸€è‡´ï¼Œéƒ½æŠŠåŸæ•°ç»„æ‰å¹³åŒ–äº†ã€‚</p>
<p>å¯¹äºç±»ä¼¼ <code>arr=(a b c)</code> çš„æ•°ç»„ï¼ˆå³æ•°ç»„æ¯ä¸€é¡¹ä¸åŒ…å«ç©ºç™½ç¬¦ï¼‰ï¼Œ å¾ªç¯ä¸­ <code>&quot;${arr[@]}&quot;</code>ã€ <code>${arr[@]}</code>ã€<code>${arr[*]}</code> è¡Œä¸ºéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè€Œ  <code>&quot;${arr[*]}&quot;</code> åŒæ ·æ˜¯æŠŠåŸæ•°ç»„æ‰€æœ‰é¡¹å½“åšä¸€ä¸ªæ•´ä½“äº†ã€‚</p>
<p>æä¸€ä¸‹ï¼Œä¸Šè¿°ç¤ºä¾‹è¾“å‡ºç»“æœå‡åœ¨ bash ä¸‹æ‰§è¡Œã€‚ä½†åœ¨ zsh ç¯å¢ƒä¸‹ï¼Œè¿™ä¸‰ç§ <code>&quot;${arr[@]}&quot;</code>ã€ <code>${arr[@]}</code>ã€<code>${arr[*]}</code> å½¢å¼ï¼Œéƒ½èƒ½ã€Œæ­£ç¡®ã€éå†åŸæ•°ç»„ï¼Œä¸ä¼šæ‰å¹³åŒ–ã€‚</p>
<blockquote>
<p><strong>åŸºäºä»¥ä¸Šç»†å¾®å·®å¼‚ï¼Œéå†æ•°ç»„çš„æœ€ä½³å®è·µæ˜¯ï¼šåº”ä½¿ç”¨  <code>@</code>ï¼Œä¸”è¦å¸¦ä¸Šã€ŒåŒå¼•å·ã€ã€‚</strong></p>
</blockquote>
<h4>5.7 æˆªå–æ•°ç»„</h4>
<p>å…¶å®å‰é¢å·²ç»æåˆ°è¿‡äº†ï¼Œå…¶è¯­æ³•å°±æ˜¯ï¼š<code>${array[@]:offset:length}</code>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-bash">$ fruits=(apple banana lemon pear plum orange watermelon)
$ echo &quot;${fruits[@]:3:2}&quot;
pear plum
</code></pre>
<p>å…¶ä¸­ <code>offset</code> ä¸ºåç§»é‡ï¼ˆæ€»æ˜¯ä» <code>0</code> å¼€å§‹ï¼‰ï¼Œ<code>length</code>  è¡¨ç¤ºæˆªå–é•¿åº¦ã€‚å®ƒä¸ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œç±»ä¼¼äº JavaScript çš„ <code>Array.prototype.slice()</code> æ–¹æ³•ã€‚<code>${array[@]:offset:1}</code> ä¹Ÿæ˜¯è·å–æ•°ç»„ä¸­æŸé¡¹æœ€å…¼å®¹çš„å†™æ³•ã€‚</p>
<p>è‹¥ <code>length</code> çœç•¥ï¼Œæˆªå–ä» <code>offset</code> å¼€å§‹åˆ°ç»“å°¾çš„æ•°ç»„é¡¹ã€‚å…¶ä¸­ <code>offset</code> å’Œ <code>length</code> ä¹Ÿæ”¯æŒè´Ÿå€¼ï¼Œç±»ä¼¼å­—ç¬¦ä¸²æˆªå–ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚</p>
<h4>5.8 è¿½åŠ æ•°ç»„æˆå‘˜</h4>
<p>æ•°ç»„æœ«å°¾è¿½åŠ æˆå‘˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>+=</code> èµ‹å€¼æ“ä½œç¬¦ï¼Œä¼šè‡ªåŠ¨æŠŠå€¼æœ€ä½³åˆ°æ•°å­—æœ«å°¾ã€‚</p>
<pre><code class="language-shell">$ arr1=(a b c)
$ arr1+=(d e)
$ echo &quot;${arr1[@]}&quot;
a b c d e
</code></pre>
<p>æ³¨æ„ <code>+=</code> å‰åä¸èƒ½æœ‰ç©ºæ ¼ï¼Œè‹¥è¿½åŠ å¤šé¡¹å…ƒç´ ï¼Œåˆ™ä½¿ç”¨ç©ºæ ¼éš”å¼€ã€‚
å¦‚æœçŸ¥é“äº†æ•°ç»„ä¸‹æ ‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>arr[index]=xxx</code> å½¢å¼æ·»åŠ ã€‚ä½†æ³¨æ„è‹¥ <code>index</code> ä½ç½®å·²æœ‰å…ƒç´ ï¼Œåˆ™ä¼šäº§ç”Ÿè¦†ç›–æ•ˆæœã€‚</p>
<h4>5.9 åˆ é™¤æ•°ç»„æˆå‘˜</h4>
<p>æ¸…ç©ºæ•°ç»„ï¼Œåº”ä½¿ç”¨ <code>unset</code> è¯­æ³•ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-bash">$ arr=(a b c)
$ unset arr
$ echo &quot;${arr[@]}&quot;

</code></pre>
<p>å¯¹äº <code>arr=''</code> è¿™ç§å½¢å¼ï¼Œåœ¨ zsh ä¸Šå¯ä»¥èµ·åˆ°æ¸…ç©ºæ•°ç»„çš„ä½œç”¨ï¼Œè€Œ bash ä¸Šæ˜¯å¯¹æ•°ç»„ç¬¬ä¸€é¡¹èµ‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²è€Œå·²ã€‚</p>
<p>å¦‚æ˜¯åˆ é™¤æŸé¡¹ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-bash">$ arr=(a b c)
$ unset arr[1]
echo &quot;${arr[@]}&quot;

</code></pre>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Shell ä¹‹å˜é‡ï¼ˆäºŒï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/40</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/40</guid>
            <pubDate>Sat, 25 Feb 2023 11:10:42 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-375126b5cc8639a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-375126b5cc8639a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>ä¸Šä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/39">Shell ä¹‹åˆè¯†</a>
ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/41">Shell ä¹‹æ•°æ®ç±»å‹</a></p>
</blockquote>
<p>åœ¨ Shell ä¸­ï¼Œå˜é‡åˆ†ä¸ºã€Œç¯å¢ƒå˜é‡ã€å’Œã€Œè‡ªå®šä¹‰å˜é‡ã€ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›ç‰¹æ®Šå˜é‡ï¼ˆå¦‚ <code>$@</code>ã€<code>$0</code>ã€<code>$$</code> ç­‰ï¼‰ã€‚ï¼ˆæ°¸ä¹…æ€§ï¼‰ç¯å¢ƒå˜é‡åœ¨è¿›å…¥ Shell æ—¶å·²ç»å®šä¹‰å¥½äº†ï¼Œ å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h2>ä¸€ã€è¯»å–å˜é‡</h2>
<p>å½“ä¸€ä¸ªå˜é‡å£°æ˜ä¹‹åï¼Œåœ¨å…¶ä½œç”¨åŸŸè®¿é—®å†…ï¼Œä¾¿å¯è¢«è®¿é—®ã€‚å˜é‡è¯»å–æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<blockquote>
<ul>
<li><code>$å˜é‡å</code></li>
<li><code>${å˜é‡å}</code></li>
</ul>
</blockquote>
<p>å…¶ä¸­ <code>$foo</code> å’Œ <code>${foo}</code> ä¸¤ç§å†™æ³•æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚å‰è€…å¯ä»¥ç†è§£ä¸ºåè€…çš„ç®€å†™å½¢å¼ã€‚</p>
<pre><code class="language-shell">$ echo $USER
frankie

$ echo ${USER}
frankie
</code></pre>
<p>å¯¹äº <code>${å˜é‡å}</code> å¯ç”¨äºå˜é‡ä¸å…¶ä»–å­—ç¬¦è¿ç”¨çš„æƒ…å†µã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ a='foo'
# ä»¥ä¸‹è¯»å–çš„åä¸ºã€Œa_fileã€çš„å˜é‡ï¼Œç”±äºä¸å­˜åœ¨ï¼Œå› æ­¤è¾“å‡ºç©ºå­—ç¬¦ã€‚
$ echo $a_file

$ echo ${a}_file
foo_file
</code></pre>
<p>åœ¨å…¶ä»–é«˜çº§è¯­è¨€ä¸­ï¼Œå¦‚æœå¼•ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å˜é‡ï¼Œå¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚æ¯”å¦‚åœ¨ JavaScript ä¸­ä¼šæŠ›å‡º Reference Errorã€‚<strong>ä½†æ˜¯ï¼Œåœ¨ Shell ä¸­ï¼Œå¦‚æœå¼•ç”¨çš„å˜é‡ä¸å­˜åœ¨ï¼Œå®ƒä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è¾“å‡ºã€Œç©ºå­—ç¬¦ã€ã€‚</strong></p>
<pre><code class="language-shell">$ echo $unknow_var

</code></pre>
<h2>äºŒã€ç¯å¢ƒå˜é‡</h2>
<p>å¤§å¤šæ•°ç¯å¢ƒå˜é‡ï¼Œéƒ½æ˜¯ã€Œåªè¯»ã€çš„ï¼Œå¯è§†ä¸ºã€Œå¸¸é‡ã€ã€‚å¸¸è§ç¯å¢ƒå˜é‡æœ‰ï¼š</p>
<ul>
<li><code>USER</code> - å½“å‰ç™»å½•ç”¨æˆ·</li>
<li><code>HOME</code> - å½“å‰ç”¨æˆ·ç›®å½•</li>
<li><code>PATH</code> - ç³»ç»ŸæŸ¥æ‰¾æŒ‡ä»¤æ—¶çš„æ£€ç´¢ç›®å½•</li>
<li><code>PWD</code> - å½“å‰å·¥ä½œç›®å½•</li>
<li><code>OLDPWD</code> - ä¸Šä¸€ä¸ªå·¥ä½œç›®å½•</li>
<li><code>SHELL</code> - å½“å‰ç³»ç»Ÿé»˜è®¤ Shell</li>
<li>è¿˜æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾äº†...</li>
</ul>
<p>å…¨å±€å˜é‡çš„è¯»å–åŒä¸Šã€‚</p>
<p>åŒæ—¶ï¼ŒShell å†…ç½®çš„ <code>env</code> å’Œ <code>printenv</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å…¨å±€å˜é‡ã€‚ä½†æ˜¯ï¼ŒæŸ¥çœ‹å•ä¸ªå…¨å±€å˜é‡çš„å€¼ï¼Œ<code>echo</code> å’Œ <code>printenv</code> ä¸Šç¨æœ‰ä¸åŒï¼š</p>
<pre><code class="language-shell">$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

$ printenv PATH
/usr/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
</code></pre>
<p>ğŸ‘† å…¶ä¸­ <code>printenv</code> å‘½ä»¤åçš„å˜é‡åï¼Œæ˜¯ä¸ç”¨æ·»åŠ  <code>$</code> å‰ç¼€çš„ã€‚</p>
<blockquote>
<p>å‚è€ƒä¸»æµçš„ Shell ç¼–ç¨‹é£æ ¼æŒ‡å—ï¼š<strong>å¸¸é‡å’Œä»»ä½•å¯¼å‡ºåˆ°ç¯å¢ƒçš„ï¼ˆè‡ªå®šä¹‰ï¼‰å˜é‡ï¼Œå…¶å˜é‡ååº”ã€Œå¤§å†™ã€è¡¨ç¤ºï¼Œç”¨ä¸‹åˆ’çº¿ã€Œ<code>_</code>ã€åˆ†éš”ï¼Œä¸”å£°æ˜åœ¨æ–‡ä»¶é¡¶éƒ¨ã€‚</strong></p>
</blockquote>
<p>å†…ç½®çš„ç¯å¢ƒå˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ¨èçœ‹ <a href="https://google.github.io/styleguide/shellguide.html#s7-naming-conventions">Google Shell Style Guide</a>ã€‚</p>
<h2>ä¸‰ã€è‡ªå®šä¹‰å˜é‡</h2>
<p>è‡ªå®šä¹‰å˜é‡ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨å½“å‰ Shell ä¸­å®šä¹‰çš„å˜é‡ã€‚
ä½¿ç”¨ <code>set</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ Shell çš„å˜é‡ï¼ˆåŒ…æ‹¬ç¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰å˜é‡ï¼‰ï¼Œä»¥åŠæ‰€æœ‰ Shell å†…ç½®å‡½æ•°ã€‚</p>
<p>å˜é‡å®šä¹‰å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">name=value
</code></pre>
<p>ğŸ‘† ç­‰å·å·¦è¾¹ä¸ºå˜é‡åï¼Œç­‰å·å³è¾¹ä¸ºå˜é‡å€¼ã€‚<strong>æ³¨æ„ï¼Œç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</strong></p>
<p>å¯¹äºå˜é‡åå‘½åé™åˆ¶ï¼Œå¤§è‡´ä¸Šä¸å…¶ä»–é«˜çº§è¯­è¨€ç±»ä¼¼ã€‚ä»¥ä¸‹ä»…åˆ—ä¸¾ä¸»æµç¼–ç¨‹é£æ ¼ä¸­æ¨èçš„ç”¨æ³•ï¼š</p>
<blockquote>
<ul>
<li>åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œä¸”é¦–å­—æ¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚</li>
<li>ä¸èƒ½ä¸å†…ç½®å˜é‡é‡åã€‚</li>
<li>ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä¸”åº”ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚</li>
<li>å…¨å±€å˜é‡åº”å¤§å†™è¡¨ç¤ºï¼Œå…¶ä½™çš„åº”å°å†™è¡¨ç¤ºã€‚</li>
</ul>
</blockquote>
<p>å¯¹äºå˜é‡å€¼ï¼Œæ­¤å¤„åªè¯´æ˜ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<blockquote>
<ul>
<li>è‹¥å˜é‡å€¼ä¸åŒ…å«ã€Œç©ºæ ¼ã€ï¼Œå¼•å·æ˜¯å¯ä»¥çœç•¥çš„ï¼Œä½†ä¸æ¨èã€‚</li>
<li>å˜é‡å€¼åº”æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ç”¨ã€Œå•å¼•å·ã€æˆ–ã€ŒåŒå¼•å·ã€åŒ…è£¹ã€‚å°½ç®¡æ˜¯å¯é€‰çš„ï¼Œä½†æ¨èç”¨å¼•å·ã€‚</li>
<li>å¯¹äºã€Œå•å¼•å·ã€ï¼šç”¨äºä¿ç•™å­—ç¬¦çš„å­—é¢å«ä¹‰ï¼Œå•å¼•å·å†…çš„å„ç§ç‰¹æ®Šå­—ç¬¦ï¼Œéƒ½ä¼šå˜ä¸ºæ™®é€šå­—ç¬¦ï¼ŒåŸæ ·è¾“å‡ºã€‚</li>
<li>å¯¹äºã€ŒåŒå¼•å·ã€ï¼šæ¯”å•å¼•å·å®½æ¾ï¼Œå¤§éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦åœ¨åŒå¼•å·é‡Œé¢ï¼Œéƒ½ä¼šå¤±å»ç‰¹æ®Šå«ä¹‰ï¼Œå˜æˆæ™®é€šå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œä¸‰ä¸ªç‰¹æ®Šå­—ç¬¦é™¤å¤–ï¼šç¾å…ƒç¬¦å·ï¼ˆ<code>$</code>ï¼‰ã€åå¼•å·ï¼ˆ<code>`</code>ï¼‰å’Œåæ–œæ ï¼ˆ<code>\</code>ï¼‰ã€‚è¿™ä¸‰ä¸ªå­—ç¬¦åœ¨åŒå¼•å·ä¹‹ä¸­ï¼Œä¾ç„¶æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œä¼šè¢« Bash è‡ªåŠ¨æ‰©å±•ã€‚</li>
</ul>
</blockquote>
<p>å…¶ä»–æ³¨æ„ç‚¹ï¼Œä¸‹æ–‡ä»‹ç»ã€Œæ•°æ®ç±»å‹ã€æ—¶å†ä½œè¯¦ç»†ä»‹ç»ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ echo '$USER'
$USER

$ echo &quot;$USER&quot;
frankie
</code></pre>
<h2>å››ã€å˜é‡ä½œç”¨åŸŸ</h2>
<p>è·Ÿå…¶ä»–é«˜çº§è¯­è¨€ä¸­ä¸€æ ·ï¼ŒShell çš„å˜é‡ä¹Ÿæ˜¯æœ‰ä½œç”¨åŸŸï¼ˆScopeï¼‰çš„ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç§ï¼š</p>
<blockquote>
<ul>
<li>å±€éƒ¨å˜é‡ï¼šå…¶ä½œç”¨åŸŸä¸ºå‡½æ•°ä½“å†…éƒ¨ã€‚</li>
<li>å…¨å±€å˜é‡ï¼šå…¶ä½œç”¨åŸŸä¸ºå½“å‰ Shell è¿›ç¨‹ã€‚</li>
<li>ç¯å¢ƒå˜é‡ï¼šå…¶ä½œç”¨åŸŸä¸ºå½“å‰ Shell è¿›ç¨‹åŠå…¶å­è¿›ç¨‹ã€‚</li>
</ul>
</blockquote>
<p>å±€éƒ¨å˜é‡ä½¿ç”¨ <code>local</code> å‘½ä»¤è¿›è¡Œå£°æ˜ï¼Œæ¯”å¦‚ <code>local foo=&quot;bar&quot;</code>ã€‚</p>
<pre><code class="language-bash">function fn() {
  local foo=&quot;bar&quot;
}
fn
echo $foo # è¾“å‡ºç©ºå­—ç¬¦
</code></pre>
<p>ğŸ‘† <code>echo $foo</code> è¾“å‡ºç©ºå­—ç¬¦ï¼Œç”±äºå˜é‡ <code>foo</code> ä¸ºå±€éƒ¨å˜é‡ï¼Œåªèƒ½åœ¨å‡½æ•° <code>fn</code> å†…ä½¿ç”¨ï¼Œå› æ­¤å‡½æ•°å¤–éƒ¨æ— æ³•æ‰¾åˆ°å˜é‡è€Œè¾“å‡ºç©ºå­—ç¬¦ã€‚</p>
<pre><code class="language-bash">function fn() {
  foo=&quot;bar&quot;
}
fn
echo $foo # è¾“å‡º bar
</code></pre>
<p>ğŸ‘† ç”±äºåœ¨ Shell ä¸­å®šä¹‰çš„å˜é‡é»˜è®¤ä¸ºå…¨å±€å˜é‡ï¼Œå› æ­¤ <code>echo $foo</code> è¾“å‡º <code>bar</code>ã€‚</p>
<pre><code class="language-shell">$ foo=&quot;bar&quot;
$ echo $foo # bar
$ echo $$ # 16531 å½“å‰è¿›ç¨‹ ID

$ bash # åˆ›å»ºå¹¶è¿›å…¥å­è¿›ç¨‹
$ echo $$ # 16846 å­è¿›ç¨‹ ID
$ echo $foo # è¾“å‡ºç©ºå­—ç¬¦
$ foo=&quot;baz&quot; # åœ¨å­è¿›ç¨‹è®¾ç½®å˜é‡
$ echo $foo # è¾“å‡º baz
$ exit # é€€å‡ºå­è¿›ç¨‹ï¼Œç„¶åè¿”å›çˆ¶è¿›ç¨‹ä¸­

$ echo $$ # 16531 å½“å‰è¿›ç¨‹ ID
$ echo $foo # bar
</code></pre>
<p>ğŸ‘† ç”±äºå…¨å±€å˜é‡ä»…åœ¨å½“å‰è¿›ç¨‹ä¸­æœ‰æ•ˆï¼Œå› æ­¤è¿›å…¥å­è¿›ç¨‹åï¼Œæ‰¾ä¸åˆ°å˜é‡ <code>foo</code>ï¼Œå› æ­¤å­è¿›ç¨‹ä¸­è¾“å‡ºç©ºå­—ç¬¦ã€‚åŒæ—¶åœ¨å­è¿›ç¨‹ä¸­è®¾ç½®çš„å…¨å±€å˜é‡ï¼Œä¸ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹ï¼Œå› æ­¤é€€å‡ºå­è¿›ç¨‹è¿”å›åˆ°çˆ¶è¿›ç¨‹åï¼Œçˆ¶è¿›ç¨‹çš„ <code>foo</code> å˜é‡å¹¶æœªå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>ç¯å¢ƒå˜é‡ï¼Œæ ¹æ®æŒä¹…æ€§å¯ä»¥åˆ’åˆ†ä¸ºï¼šã€Œæ°¸ä¹…æ€§ç¯å¢ƒå˜é‡ã€å’Œã€Œä¸´æ—¶æ€§ç¯å¢ƒå˜é‡ã€ã€‚</p>
<blockquote>
<ul>
<li>æ°¸ä¹…æ€§ç¯å¢ƒå˜é‡ï¼šå³åœ¨ Shell é…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>~/.zshrc</code>ã€<code>~/.bash_profile</code> ç­‰ï¼‰ä¸­çš„å£°æ˜çš„å˜é‡ï¼ŒåŒ…æ‹¬å†…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œè¿›å…¥ä»»æ„ä¸€ä¸ª Shell è¿›ç¨‹éƒ½å¯è¢«å¼•ç”¨ã€‚å› ä¸ºæ¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ä¹‹å‰ Shell éƒ½ä¼šå»æ‰§è¡Œç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚</li>
<li>ä¸´æ—¶æ€§ç¯å¢ƒå˜é‡ï¼šåœ¨å…¨å±€å˜é‡çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨ <code>export</code> å‘½ä»¤å¯¼å‡ºï¼Œä½¿å¾—å½“å‰è¿›ç¨‹åŠå…¶å­å­™è¿›ç¨‹éƒ½å¯å¼•ç”¨ã€‚ä½†æ˜¯ï¼Œå…¶ä»– Shell è¿›ç¨‹ï¼ˆåŒ…æ‹¬å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼‰æ˜¯ä¸å¯å¼•ç”¨çš„ã€‚å½“é€€å‡ºè¿›ç¨‹ï¼Œä¾¿ä¼šè¢«é”€æ¯ã€‚</li>
</ul>
</blockquote>
<p>ä¸´æ—¶æ€§ç¯å¢ƒå˜é‡ï¼Œåªä¼šå‘ä¸‹ä¼ é€’ï¼Œè€Œä¸èƒ½å‘ä¸Šä¼ é€’ï¼Œå³ã€Œä¼ å­ä¸ä¼ çˆ¶ã€ã€‚</p>
<p>ä½¿ç”¨ <code>export</code> å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥å‘ Shell å­è¿›ç¨‹è¾“å‡ºå˜é‡ã€‚</p>
<pre><code class="language-shell">FOO=&quot;bar&quot;
export FOO
</code></pre>
<h2>äº”ã€å˜é‡é»˜è®¤å€¼</h2>
<p>å‰é¢æåˆ°ï¼Œåœ¨ Shell ä¸­ï¼Œå¦‚æœè¯»å–äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å˜é‡ï¼Œå®ƒæ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œè€Œæ˜¯ä¼šè¾“å‡ºç©ºå­—ç¬¦ã€‚åœ¨ Shell ä¸­ï¼Œæä¾›äº†å››ç§ç‰¹æ®Šè¯­æ³•ï¼Œä¸å˜é‡çš„é»˜è®¤å€¼æœ‰å…³ï¼Œå¯ä»¥ä¿è¯è¯»å–åˆ°çš„ç»“æœä¸ä¸ºç©ºã€‚</p>
<p>å½¢å¼ä¸ºï¼š<code>${å˜é‡å + : + æ“ä½œç¬¦ + å€¼}</code>ï¼Œæ³¨æ„å®é™…ä½¿ç”¨æ˜¯æ²¡æœ‰ç©ºæ ¼çš„ã€‚æ¯”å¦‚ï¼Œ<code>${foo:-hello}</code> è¡¨ç¤ºå½“å˜é‡ <code>foo</code> å­˜åœ¨æ—¶è¿”å›å®ƒçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™è¿”å› <code>hello</code>ã€‚å…¶ä¸­ <code>varname</code> ä¸ºå˜é‡åï¼Œ<code>:</code> æ˜¯å›ºå®šçš„ï¼Œ<code>-</code> ä¸ºæ“ä½œç¬¦ï¼ˆè¿˜æœ‰ <code>=</code>ã€<code>+</code>ã€<code>?</code>ï¼‰ï¼Œ<code>hello</code> ä¸ºå€¼ã€‚</p>
<p>æœ‰ä»¥ä¸‹å››ç§æƒ…å†µï¼š</p>
<pre><code class="language-shell">$ foo=${bar:-hello} # ç›¸å½“äº JS ä¸­çš„ foo = bar || 'hello'

$ foo=${bar:=hello} # ç›¸å½“äº JS ä¸­çš„ foo = bar || (bar = 'hello')

$ foo=${bar:+hello} # ç›¸å½“äº JS ä¸­çš„ foo = !bar ? 'hello' : ''

$ foo=${bar:?hello} # ç›¸å½“äº JS ä¸­çš„ foo = bar || (throw 'hello')
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šå››ç§å½¢å¼ï¼Œç›¸åŒçš„æ˜¯ï¼šå½“å˜é‡ <code>bar</code> å­˜åœ¨ä¸”ä¸ä¸ºç©ºæ—¶ï¼Œå³ä¾§è¾“å‡ºç»“æœä¸ºå˜é‡ <code>bar</code> çš„å€¼ï¼Œå› æ­¤å˜é‡ <code>foo</code> çš„å€¼ç­‰äºå˜é‡ <code>bar</code> çš„å€¼ã€‚</p>
<p>åŒºåˆ«åœ¨äºï¼š</p>
<blockquote>
<ul>
<li><code>${bar:-hello}</code> - è¡¨ç¤ºå½“å˜é‡ <code>bar</code> å­˜åœ¨ä¸”ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›å˜é‡ <code>bar</code> çš„å€¼ï¼Œå¦åˆ™è¿”å› <code>hello</code>ã€‚ç›®çš„æ˜¯ä¸ºäº†è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚</li>
<li><code>${bar:=hello}</code> - è¡¨ç¤ºå½“å˜é‡ <code>bar</code> å­˜åœ¨ä¸”ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›å˜é‡ <code>bar</code> çš„å€¼ï¼Œå¦åˆ™å°†å˜é‡ <code>bar</code> çš„å€¼è®¾ä¸º <code>hello</code> å¹¶è¿”å› <code>hello</code>ã€‚ç›®çš„æ˜¯å˜é‡çš„é»˜è®¤å€¼ã€‚</li>
<li><code>${bar:+hello}</code> - è¡¨ç¤ºå½“å˜é‡ <code>bar</code> å­˜åœ¨ä¸”ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å› <code>hello</code>ï¼Œå¦åˆ™è¿”å›ç©ºå€¼ã€‚ç›®çš„æ˜¯ä¸ºäº†åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ã€‚</li>
<li><code>${bar:?hello}</code> - è¡¨ç¤ºå½“å˜é‡ <code>bar</code> å­˜åœ¨ä¸”ä¸ä¸ºç©ºæ—¶ï¼Œè¿”å›å˜é‡ <code>bar</code> çš„å€¼ï¼Œå¦åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ <code>bar: hello</code>ï¼Œå¹¶ä¸­æ–­è„šæœ¬æ‰§è¡Œã€‚ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å˜é‡æœªå®šä¹‰ã€‚</li>
</ul>
</blockquote>
<h2>å…­ã€ç‰¹æ®Šå˜é‡</h2>
<p>Shell æä¾›äº†ä¸€äº›ç‰¹æ®Šå˜é‡ï¼Œç”¨æˆ·ä¸èƒ½å¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œå³åªè¯»ã€‚</p>
<blockquote>
<ul>
<li><code>$?</code> - è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºç ã€‚è‹¥ä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿”å› 0ï¼Œå› æ­¤ï¼Œè‹¥è¿”å›å€¼ä¸ä¸º 0 ï¼Œåˆ™è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</li>
<li><code>$$</code> - è¡¨ç¤ºå½“å‰ Shell è¿›ç¨‹ IDã€‚</li>
<li><code>$_</code> - è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚</li>
<li><code>$!</code> - è¡¨ç¤ºæœ€åä¸€ä¸ªåå°æ‰§è¡Œçš„å¼‚æ­¥å‘½ä»¤çš„è¿›ç¨‹ IDã€‚</li>
<li><code>$-</code> - è¡¨ç¤ºå½“å‰ Shell çš„å¯åŠ¨å‚æ•°ã€‚</li>
<li><code>$#</code> - è¡¨ç¤ºè„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°æ•°é‡ã€‚</li>
<li><code>$@</code> - è¡¨ç¤ºè„šæœ¬æˆ–å‡½æ•°çš„å…¨éƒ¨å‚æ•°ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼éš”å¼€ã€‚</li>
<li><code>$*</code> - è¡¨ç¤ºå‡½æ•°çš„å…¨éƒ¨å‚æ•°ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨å˜é‡ <code>$IFS</code> å€¼çš„ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ†å‰²ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ï¼Œå¯è‡ªå®šä¹‰ã€‚</li>
<li><code>$0</code> - è¡¨ç¤ºå½“å‰ Shell çš„åç§°ï¼ˆåœ¨å‘½ä»¤ç›´æ¥æ‰§è¡Œæ—¶ï¼‰æˆ–è„šæœ¬åï¼ˆåœ¨è„šæœ¬ä¸­æ‰§è¡Œæ—¶ï¼‰ã€‚</li>
<li><code>$1</code> ~ <code>$9</code> - è¡¨ç¤ºè„šæœ¬æˆ–å‡½æ•°ç¬¬ä¸€ä¸ªåˆ°ç¬¬ä¹ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ç”¨ <code>${0}</code> è¡¨ç¤ºã€‚è¶…è¿‡ç¬¬ 9 ä¸ªï¼Œåˆ™ç”¨ <code>${10}</code> å½¢å¼è·å–ã€‚</li>
</ul>
</blockquote>
<h2>ä¸ƒã€å…¶ä»–</h2>
<p><code>unset</code> å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ é™¤ä¸€ä¸ªå˜é‡ï¼ŒåŸºäº Shell è¯»å–ä¸å­˜åœ¨çš„å˜é‡ä¼šå¾—åˆ°ç©ºå­—ç¬¦çš„ç‰¹æ€§ï¼Œå®ƒç›¸å½“äºç»™å˜é‡è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<p><code>declare</code> å‘½ä»¤å¯ä»¥å£°æ˜ä¸€äº›ç‰¹æ®Šç±»å‹çš„å˜é‡ã€‚è‹¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨ <code>declare</code> å£°æ˜çš„å˜é‡ï¼Œä»…å‡½æ•°å†…æœ‰æ•ˆï¼Œç›¸å½“äº <code>local</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">declare OPTION variable=value

# ä¸»è¦ OPTION å‚æ•°å¦‚ä¸‹ï¼š
# -a: å£°æ˜æ•°ç»„å˜é‡
# -i: å£°æ˜æ•´æ•°å˜é‡
# -r: å£°æ˜åªè¯»å˜é‡
# ...
</code></pre>
<p><code>readonly</code> å‘½ä»¤ç­‰åŒäº <code>declare -r</code>ï¼Œç”¨æ¥å£°æ˜åªè¯»å˜é‡ï¼Œä¸èƒ½æ”¹å˜å˜é‡å€¼ï¼Œä¹Ÿä¸èƒ½ <code>unset</code> å˜é‡ã€‚</p>
<p><code>let</code> å‘½ä»¤å£°æ˜å˜é‡æ—¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œç®—æœ¯è¡¨è¾¾å¼ã€‚</p>
<pre><code class="language-shell">$ let sum=1+2
$ echo sum
3
</code></pre>
<p>å¦‚æœåŒ…å«ç©ºæ ¼ï¼Œåˆ™éœ€è¦ã€Œå¼•å·ã€ï¼Œæ¯”å¦‚ <code>let &quot;sum = 1 + 2&quot;</code>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Shell ä¹‹åˆè¯†ï¼ˆä¸€ï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/39</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/39</guid>
            <pubDate>Sat, 25 Feb 2023 11:10:24 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-90f3383bebd0ef04.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-90f3383bebd0ef04.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="https://github.com/toFrankie/blog/issues/40">Shell ä¹‹å˜é‡</a></p>
</blockquote>
<h2>ä¸€ã€ç®€è¿°</h2>
<p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒShell è‹±æ–‡åŸæ„æ˜¯ã€Œå¤–å£³ã€ï¼Œç”¨æ¥åŒºåˆ«äº Kernelï¼Œå³ã€Œå†…æ ¸ã€ã€‚</p>
<p>å®ƒæ˜¯ç”¨æˆ·ä¸å†…æ ¸ä¹‹é—´çš„ä¸€åº§æ¡¥æ¢ï¼Œç®€åŒ–æ“ä½œçš„åŒæ—¶ï¼Œåˆèƒ½ä¿è¯å†…æ ¸çš„å®‰å…¨ã€‚ä»è¿™ä¸ªå±‚é¢çœ‹ï¼ŒShell æ˜¯ä¸€ä¸ªã€Œåº”ç”¨ç¨‹åºã€ï¼Œä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€ç³»ç»Ÿçº§åˆ«çš„è¶…çº§åº”ç”¨ã€‚Shell æä¾›äº†å¾ˆå¤šæ–¹ä¾¿ã€å®ç”¨çš„å·¥å…·æ¥é™ä½ç”¨æˆ·æ“ä½œæˆæœ¬ï¼Œä¾‹å¦‚ <code>cp</code>ã€<code>touch</code>ã€<code>mkdir</code> ç­‰å†…ç½®å‘½ä»¤ã€‚</p>
<p>å†å²ä¸Šï¼Œå‡ºç°äº†å¾ˆå¤šç§ Shell åº”ç”¨ï¼Œå…¶å®ç°ã€åŠŸèƒ½ä»¥åŠä½¿ç”¨æ–¹å¼å¤§éƒ¨åˆ†ç›¸åŒï¼Œä½†åˆç¨æœ‰åŒºåˆ«ã€‚æ¯”å¦‚ Boush Shellï¼ˆshï¼‰ã€Bourne Again shellï¼ˆbashï¼‰ã€Z Shellï¼ˆzshï¼‰ç­‰ã€‚ä»è¿™ä¸ªå±‚é¢æ¥çœ‹ï¼ŒShell æ˜¯ä¸€ä¸ªã€Œè§£æå™¨ã€ã€‚å½“ç”¨æˆ·åœ¨å‘½ä»¤è¡Œç¯å¢ƒè¾“å…¥æ“ä½œæŒ‡ä»¤åï¼Œç”± Shell è§£æå™¨è¿›è¡Œè§£æï¼Œç„¶åå†ä¼ é€’ç»™æ“ä½œç³»ç»Ÿï¼Œæ¥ç€è½¬æ¢ä¸ºå†…æ ¸å¯è¯†åˆ«çš„æŒ‡ä»¤æ“ä½œï¼Œè¿›è€Œæ§åˆ¶ç¡¬ä»¶ï¼Œä»¥åˆ°è¾¾ç”¨æˆ·æ“ä½œè®¡ç®—æœºçš„ç›®çš„ã€‚ä¸»æµæ“ä½œç³»ç»Ÿä¸­ï¼Œå†…ç½®äº†å¾ˆå¤šç§ Shell è§£æå™¨ï¼Œæœ€å¸¸è§çš„æœ‰ bashã€zsh ç­‰ã€‚</p>
<p>æä¾›äº† Shell çš„å‘½ä»¤è¡Œç¯å¢ƒçš„åº”ç”¨ï¼Œè¢«ç§°ä¸ºã€Œç»ˆç«¯ã€ï¼Œå³ Terminalã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼ŒShell åŒæ—¶åˆæ˜¯ä¸€ç§ã€Œç¼–ç¨‹è¯­è¨€ã€ã€‚ä½œä¸ºå‘½ä»¤è¯­è¨€ï¼Œå®ƒäº¤äº’å¼è§£é‡Šå’Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæˆ–è€…è‡ªåŠ¨åœ°è§£æå’Œæ‰§è¡Œé¢„å…ˆè®¾å®šå¥½çš„ä¸€è¿ä¸²çš„å‘½ä»¤ã€‚ä½œä¸ºç¨‹åºè®¾è®¡è¯­è¨€ï¼Œå®ƒå®šä¹‰äº†å„ç§å˜é‡å’Œå‚æ•°ï¼Œå¹¶æä¾›äº†è®¸å¤šåœ¨é«˜çº§è¯­è¨€ä¸­æ‰å…·æœ‰çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬å¾ªç¯å’Œåˆ†æ”¯ç­‰ã€‚</p>
<p>æ‰€ä»¥ï¼ŒShell æ—¢æ˜¯ä¸€ä¸ªè¶…çº§åº”ç”¨ï¼Œä¹Ÿæ˜¯ä¸€ç§ç”¨æˆ·è¾“å…¥çš„è§£æå™¨ï¼Œåˆèƒ½ä½œä¸ºä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚æœ¬æ–‡å°† Shell è§†ä¸ºä¸€é—¨ç¼–ç¨‹è¯­è¨€å»ä»‹ç»ã€‚</p>
<h2>äºŒã€ç®€å•ä½¿ç”¨</h2>
<p>Shell å‘½ä»¤æ‰§è¡Œå¾ˆç®€å•ï¼Œåªè¦æœ‰ä¸€ä¸ªç»ˆç«¯å·¥å…·å³å¯ï¼Œè€Œä¸”ä¸»æµæ“ä½œç³»ç»Ÿéƒ½ä¼šå†…ç½®ã€‚ä¾‹å¦‚ Windows çš„ CMDã€PowerShellï¼ŒUnix-like çš„ Terminal ç­‰ã€‚ç®€å•åœ°åƒ JavaScript ä¸€æ ·ï¼Œåªè¦æœ‰ä¸€ä¸ªæµè§ˆå™¨å°±èƒ½è¿è¡Œä½ æ‰€ç¼–å†™çš„ä»£ç ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-shell">$ echo 'Hello Shell'
Hello Shell

$ echo $TERM_PROGRAM
Apple_Terminal
</code></pre>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼æ²¡é”™ï¼Œä½ å·²ç»å…¥é—¨äº†ï¼Œå“ˆå“ˆï¼</p>
<p>æ³¨æ„ï¼Œä»¥ä¸Š <code>$</code> åªæ˜¯ä¸€ä¸ªã€Œå‘½ä»¤è¡Œæç¤ºç¬¦ã€ï¼Œä¸€ç§è¡Œæ–‡ä¹ æƒ¯ï¼Œè¡¨ç¤ºå…¶åçš„æ˜¯ä¸€ä¸ª Shell å‘½ä»¤ï¼Œå¸¸ç”¨ç¾å…ƒç¬¦å· <code>$</code> è¡¨ç¤ºã€‚åœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸­ï¼Œä¸éœ€è¦è¾“å…¥å®ƒã€‚</p>
<p>ç”±äºæˆ‘æ˜¯å†™å‰ç«¯çš„ï¼Œè¿™é‡Œç”¨ JavaScript ç±»æ¯”ä¸€ä¸‹ã€‚ä»¥ä¸Šç¤ºä¾‹ï¼Œ<code>echo</code> æ˜¯ Shell å†…ç½®å‡½æ•°ï¼Œå°†ç”¨æˆ·è¾“å…¥è½¬æ¢ä¸ºæ ‡å‡†è¾“å‡ºï¼ˆSTDOUTï¼‰ï¼Œç±»ä¼¼äº JavaScript ä¸­çš„ <code>console.log()</code> å‡½æ•°ã€‚è€Œ <code>TERM_PROGRAM</code> åˆ™æ˜¯ Shell å†…ç½®çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œç±»ä¼¼äº JavaScript çš„ <code>window</code>ã€<code>Object</code> ç­‰å†…ç½®å˜é‡ï¼ˆå¯¹è±¡ï¼‰ï¼Œåªä¸è¿‡åœ¨ Shell ä¸­å¼•ç”¨å˜é‡ï¼Œéœ€è¦åœ¨å˜é‡åä¹‹å‰åŠ ä¸Š <code>$</code>ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<h4>2.1 å‘½ä»¤æ ¼å¼</h4>
<p>å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ command [ arg1 arg2 ... [ argN ] ]
</code></pre>
<p>å…¶ä¸­ <code>command</code> æ˜¯å…·ä½“çš„ä¸€ä¸ªå‘½ä»¤æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>arg1 arg2 ... argN</code> æ˜¯ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°ï¼Œå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚åœ¨ Shell é‡Œï¼Œå‘½ä»¤ä¸å‚æ•°ã€å‚æ•°ä¸å‚æ•°ä¹‹é—´ç”¨ä¸€ä¸ªã€Œç©ºæ ¼ã€ï¼ˆæˆ– Tab é”®ï¼‰åŒºåˆ†ã€‚å¤šä½™ç©ºæ ¼ä¼šè¢«å¿½ç•¥ï¼Œä½œç”¨ç›¸å½“äºä¸€ä¸ªç©ºæ ¼ã€‚</p>
<pre><code class="language-shell">$ ls -l
</code></pre>
<p>ä»¥ä¸Šç¤ºä¾‹ï¼Œ<code>ls</code> æ˜¯å‘½ä»¤ï¼Œ<code>-l</code> æ˜¯å‚æ•°ï¼Œæ˜¯å¯é€‰çš„ã€‚å‚æ•°é€šå¸¸åˆ†ä¸ºå‘½ä»¤é…ç½®é¡¹å’Œç”¨æˆ·è¾“å…¥ä¸¤ç§ï¼š</p>
<ul>
<li>é…ç½®é¡¹å‚æ•°ï¼šä¸€èˆ¬ä»¥è¿å­—ç¬¦ <code>-</code> æˆ– <code>--</code> å¼€å¤´ï¼Œé€šå¸¸æœ‰é•¿ã€çŸ­ä¸¤ç§å½¢å¼ï¼Œæ¯”å¦‚ <code>list</code> å‘½ä»¤ä¸­çš„ <code>-l</code> å’Œ <code>--list</code>ï¼ŒäºŒè€…ä½œç”¨å®Œå…¨ä¸€è‡´ã€‚çŸ­å½¢å¼ä¾¿äºè¾“å…¥ï¼Œé•¿å½¢å¼ä¾¿äºç†è§£ï¼Œä»…æ­¤è€Œå·²ã€‚</li>
<li>ç”¨æˆ·è¾“å…¥å‚æ•°ï¼šé™¤é…ç½®é¡¹ä¹‹å¤–çš„å‚æ•°ï¼Œæ¯”å¦‚ <code>git push origin main</code> ä¸­çš„ <code>origin</code>ã€<code>main</code> å‚æ•°ï¼Œè¿™ç±»å‚æ•°å¾€å¾€æ˜¯æ¯ä¸ªç”¨æˆ·ä¼ å‚å·®å¼‚å¤§ï¼Œå› æ­¤æ— æ³•åšæˆé…ç½®é¡¹ã€‚</li>
</ul>
<h4>2.2 å¤šè¡Œå‘½ä»¤è¡¨ç¤º</h4>
<p>åœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸­ï¼Œå•ä¸ªå‘½ä»¤é€šå¸¸æ˜¯ä¸€è¡Œè¡¨ç¤ºï¼Œå½“å‘½ä»¤è¾“å…¥å®Œæˆåï¼ŒæŒ‰ä¸‹ã€ŒEnterã€é”®ï¼Œéšå³æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶è¾“å‡ºç»“æœã€‚</p>
<p>å¤ªç¦»è°±äº†ï¼ŒShell ç«Ÿç„¶ä¸ç»™æˆ‘æ¢è¡Œè¾“å…¥çš„æœºä¼šï¼Œå“¼ï¼</p>
<p>å…¶å®ä¸æ˜¯çš„ï¼ŒShell æ˜¯æœ‰æä¾›è¿™ç§è¾“å…¥çš„ã€‚å‡è®¾å‘½ä»¤å¾ˆé•¿ï¼Œæˆ–è€…å‡ºäºé˜…è¯»æ€§çš„è€ƒè™‘ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å°†å‘½ä»¤å†™æˆå¤šè¡Œçš„ã€‚å¯ä»¥åœ¨å½“å‰è¡Œæœ«å°¾é”®å…¥åæ–œæ  <code>\</code>ï¼Œå†æŒ‰ä¸‹ã€ŒEnterã€é”®å³å¯æ¢è¡Œè¾“å…¥äº†ï¼š</p>
<pre><code class="language-shell"># ç›¸å½“äº echo foo bar
$ echo foo \
bar

# ç›¸å½“äº echo foobar
$ echo foo\
bar
</code></pre>
<p>è¯·æ³¨æ„ï¼Œåæ–œæ åçš„å›è½¦å¹¶ä¸ä¼šå ç”¨å½¢æˆä¸€ä¸ªã€Œç©ºæ ¼ã€æ•ˆæœï¼Œå› æ­¤å®é™…ä¸­éœ€æ³¨æ„å‚æ•°é—®é¢˜ã€‚</p>
<h4>2.3 å‘½ä»¤ç»“æŸç¬¦ä¸ç»„åˆç¬¦</h4>
<p>é€šå¸¸ï¼Œä¸€è¡Œè¾“å…¥å¤šæ˜¯å•æ¡å‘½ä»¤ã€‚è‹¥è¦ä¸€è¡Œä¸­æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p><strong>å‘½ä»¤ç»“æŸç¬¦ã€Œåˆ†å·ã€ï¼š</strong></p>
<pre><code class="language-shell">$ command1; command2
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œå…ˆæ‰§è¡Œ <code>command1</code> å‘½ä»¤ï¼Œå¾…å…¶æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰æ¥ç€æ‰§è¡Œ <code>command2</code> å‘½ä»¤ã€‚<strong>è€Œä¸”ï¼Œæ— è®ºç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œç¬¬äºŒä¸ªå‘½ä»¤æ€»ä¼šæ‰§è¡Œã€‚</strong></p>
<p><strong>å‘½ä»¤ç»„åˆç¬¦ <code>&amp;&amp;</code> å’Œ <code>||</code>ï¼š</strong></p>
<pre><code class="language-shell">$ command1 &amp;&amp; command2

$ command1 || command2
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œå…¶å®è·Ÿå…¶ä»–é«˜çº§è¯­è¨€ç±»ä¼¼ï¼Œæ‰€ä»¥çœ‹åˆ°å°±èƒ½çŒœå‡ºä¸ªå¤§æ¦‚ã€‚</p>
<ul>
<li><code>&amp;&amp;</code> è¡¨ç¤ºåªæœ‰ <code>command1</code> æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œ <code>command2</code>ã€‚</li>
<li><code>||</code> è¡¨ç¤ºå¦‚æœ <code>command1</code> æ‰§è¡Œå¤±è´¥ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œ <code>command2</code>ã€‚</li>
</ul>
<p><strong>ç®¡é“ç¬¦ <code>|</code>ï¼š</strong></p>
<pre><code class="language-shell">$ command1 | command2

# ç›¸å½“äº
$ command1 &gt; tempfile
$ command2 &lt; tempfile
$ rm tempfile
</code></pre>
<p>ğŸ‘† ä»¥ä¸Šç¤ºä¾‹ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼Œä½œä¸ºç¬¬äºŒä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚è¿™ç§æ–¹å¼å¯¹å‘½ä»¤çš„ç®€åŒ–éå¸¸æœ‰ç”¨ã€‚</p>
<blockquote>
<p>ä»¥ä¸Šæåˆ°çš„å‡ ç§å‘½ä»¤ç»„åˆæ–¹å¼ï¼Œå‘½ä»¤éƒ½æ˜¯ã€Œç»§å‘ã€æ‰§è¡Œçš„ï¼Œå¹¶ä¸æ˜¯ã€Œå¹¶è¡Œã€æ‰§è¡Œçš„ã€‚</p>
</blockquote>
<h2>ä¸‰ã€å¸¸ç”¨å¿«æ·é”®</h2>
<p>åœ¨ç»ˆç«¯å·¥å…·ä¸­ï¼Œæä¾›äº†å¾ˆå¤šå¿«æ·é”®ï¼Œå¯ä»¥ç®€åŒ–æ“ä½œã€‚å¸¸ç”¨çš„æœ‰ï¼š</p>
<ul>
<li><code>Ctrl + L</code>ï¼šæ¸…é™¤å±å¹•å¹¶å°†å½“å‰è¡Œç§»åˆ°é¡µé¢é¡¶éƒ¨ï¼Œä½œç”¨åŒ <code>clear</code> å‘½ä»¤ã€‚</li>
<li><code>Ctrl + C</code>ï¼šä¸­æ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ï¼Œæœ‰äº›æƒ…å†µä¸‹éœ€è¦æŒ‰ä¸‹å¤šæ¬¡ã€‚</li>
<li><code>Ctrl + A</code>ï¼šå°†å…‰æ ‡ç§»è‡³è¡Œé¦–ã€‚</li>
<li><code>Ctrl + E</code>ï¼šå°†å…‰æ ‡ç§»è‡³è¡Œå°¾ã€‚</li>
<li>æ–¹å‘é”®ä¸Šï¼šå‘åæµè§ˆå‘½ä»¤æ‰§è¡Œå†å²è®°å½•ã€‚</li>
<li>æ–¹å‘é”®ä¸‹ï¼šå‘å‰æµè§ˆå‘½ä»¤æ‰§è¡Œå†å²è®°å½•ã€‚</li>
</ul>
<p>æ³¨æ„ï¼Œä¸åŒæ“ä½œç³»ç»Ÿä¸‹ï¼Œéƒ¨åˆ†å¿«æ·é”®ç»„åˆæ–¹å¼ä¼šæœ‰æ‰€å·®å¼‚ã€‚ä¸»è¦å·®å¼‚ä½“ç°åœ¨ Windows ä¸‹çš„ <code>Ctrl</code> ä¸ macOS ä¸‹çš„ <code>Ctrl</code>ã€<code>âŒ˜</code> é”®å§ã€‚</p>
<p>è®ºå¿«æ·é”®çš„è¯ï¼Œä¸å¾—ä¸æçš„æ˜¯ <code>Tab</code> é”®ï¼Œå¯è‡ªåŠ¨è¡¥å…¨å‘½ä»¤ã€‚å¦‚æœå†ç»“åˆç±»ä¼¼ zsh ç­‰å¼ºå¤§çš„ Shell è§£æå™¨ï¼Œé‚£ä¹ˆ <code>Tab</code> é”®èƒ½ç©å‡ºå„ç§èŠ±æ ·ï¼Œæˆå€åœ°æé«˜è¾“å…¥æ•ˆç‡ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Linux æ–‡ä»¶æè¿°ç¬¦]]></title>
            <link>https://github.com/toFrankie/blog/issues/38</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/38</guid>
            <pubDate>Sat, 25 Feb 2023 11:09:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1cfd48a91b1e3025.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1cfd48a91b1e3025.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œå°†ä¸€åˆ‡çœ‹ä½œæ˜¯ã€Œæ–‡ä»¶ã€ã€‚</p>
<p>æ¯”å¦‚ï¼Œæ™®é€šæ–‡ä»¶ã€ç›®å½•æ–‡ä»¶ã€é“¾æ¥æ–‡ä»¶ã€å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼ˆå¦‚é”®ç›˜ã€é¼ æ ‡ã€æ‰“å°æœºç­‰ï¼‰ã€å—è®¾å¤‡æ–‡ä»¶ï¼ˆå¦‚ç¡¬ç›˜ã€å…‰é©±ç­‰ï¼‰ã€å¥—æ¥å­—ç­‰ç­‰ã€‚</p>
<p>å†…æ ¸åˆ™æ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®æ–‡ä»¶ã€‚</p>
<h2>äºŒã€æ–‡ä»¶æè¿°ç¬¦</h2>
<h4>2.1 åŸºæœ¬è®¤è¯†</h4>
<p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼Œfdï¼‰åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªã€Œéè´Ÿæ•´æ•°ã€ã€‚æ¯æ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå†…æ ¸éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦å°†æœ€ç»ˆå¯¹åº”ä¸Šè¢«æ‰“å¼€æˆ–è¢«åˆ›å»ºçš„é‚£ä¸ªæ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ ¹æ® POSIX æ ‡å‡†è¦æ±‚ï¼Œæ¯æ¬¡æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å½“å‰è¿›ç¨‹ä¸­æœ€å°å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å·ç ã€‚</p>
</blockquote>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸º 0ã€1ã€2 çš„ï¼Œæœ‰ç€ç‰¹å®šçš„å«ä¹‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–‡ä»¶æè¿°ç¬¦</th>
<th>ç”¨é€”</th>
<th>POSIX åç§°</th>
<th>stdio æµ</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>æ ‡å‡†è¾“å…¥</td>
<td>STDIN_FILENO</td>
<td>stdin</td>
</tr>
<tr>
<td>1</td>
<td>æ ‡å‡†è¾“å‡º</td>
<td>STDOUT_FILENO</td>
<td>stdout</td>
</tr>
<tr>
<td>2</td>
<td>æ ‡å‡†é”™è¯¯</td>
<td>STDERR_FILENO</td>
<td>stderr</td>
</tr>
</tbody>
</table>
<p>å› æ­¤ï¼Œæ­¤æ—¶å†æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶æè¿°ç¬¦å°†ä¼šè¿”å› 3ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p>
<h4>2.2 æ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶</h4>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¿›ç¨‹å¯åŠ¨æ—¶éœ€è¦å ç”¨å†…å­˜çš„ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†å†…å­˜åˆ†é…ç»™äº†æ–‡ä»¶æè¿°ç¬¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŒœåˆ°æ¯ä¸ªè¿›ç¨‹å¯æ‰“å¼€æ–‡ä»¶æ•°æ˜¯æœ‰é™åˆ¶çš„ã€‚ä½ æ˜¯å¦é‡åˆ°è¿‡ã€ŒToo many open filesã€çš„æƒ…å†µï¼Œå¾ˆå¤§å¯èƒ½å°±æ˜¯å› ä¸ºæ‰“å¼€æ–‡ä»¶æ•°è¶…è¿‡äº†è¿›ç¨‹æœ€å¤§å¯æ‰“å¼€æ•°æ‰€å¯¼è‡´çš„ã€‚</p>
<p>æ¯ä¸ªæ“ä½œç³»ç»Ÿæœ€å¤šå¯æ‰“å¼€æ–‡ä»¶æ•°æ˜¯ä¸åŒçš„ï¼Œæ­¤å¤„ä¸å±•å¼€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£è‡ªè¡Œäº†è§£ã€‚</p>
<p><strong>ulimit</strong></p>
<p><code>ulimit</code> ä¸»è¦æ˜¯ç”¨æ¥é™åˆ¶ã€Œè¿›ç¨‹ã€å¯¹èµ„æºçš„ä½¿ç”¨æƒ…å†µçš„ï¼Œæ”¯æŒå„ç§ç±»å‹çš„é™åˆ¶ã€‚</p>
<pre><code class="language-shell"># æŸ¥çœ‹è¿›ç¨‹å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°
$ ulimit -n
256

# è®¾ç½®è¿›ç¨‹å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°
$ ulimit -n &lt;num&gt;
</code></pre>
<p>è¯·æ³¨æ„ï¼Œä½¿ç”¨ <code>ulimit -n</code> è®¾ç½®ä»…åœ¨å½“å‰è¿›ç¨‹ç”Ÿæ•ˆï¼Œå› æ­¤å®ƒå±äºè¿›ç¨‹çº§åˆ«çš„æ§åˆ¶ã€‚</p>
<p>...</p>
<!--

ä»¥ macOS ä¸ºä¾‹ï¼š

> * `ulimit` ä»…ä½œç”¨äºå½“å‰è¿›ç¨‹ï¼Œæ‰€ä»¥ `ulimit -n` ä¸ºä¸´æ—¶è®¾ç½®ã€‚è€Œä¸”è¿™ä¸ªå€¼ä¸èƒ½è¶…è¿‡ `kern.maxfilesperproc` è®¾ç½®çš„æ•°å€¼ã€‚
> * `launchctl` ä¸º macOS ç‰¹æœ‰é…ç½®ï¼Œå¯å†™å…¥åˆ° `/etc/launchd.conf` ä¸­ã€‚ä¿®æ”¹è¯¥é…ç½®ä¼šåŒæ—¶å½±å“ `sysctl` çš„ `kern.maxfilesperproc` å‚æ•°ã€‚
> *  `sysctl` ä¸ºç³»ç»Ÿæ§åˆ¶ï¼Œå¯å†™å…¥åˆ° `/etc/sysctl.conf`ã€‚

```shell
$ ulimit -n
256

$ launchctl limit maxfiles
	maxfiles    256            unlimited

$ sysctl -a | grep files
kern.maxfiles: 245760
kern.maxfilesperproc: 122880
```
-->
<h4>2.3 è¿›ç¨‹çº§åˆ«çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</h4>
<p>å½“ä¸€ä¸ª Linux è¿›ç¨‹å¯åŠ¨åï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ§åˆ¶å—ï¼ˆProcess Control Blockï¼ŒPCBï¼‰ï¼Œé‡Œé¢ç»´æŠ¤ç€ä¸€ä¸ªã€Œæ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ŒFile descriptor tableã€ï¼Œç”¨äºè®°å½•å½“å‰è¿›ç¨‹æ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³å½“å‰è¿›ç¨‹æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ã€‚</p>
<p>å› æ­¤ï¼Œæ–‡ä»¶æè¿°ç¬¦è¡¨æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªã€‚</p>
<p>æ–‡ä»¶æè¿°ç¬¦è¡¨çš„æ¯ä¸ªæ¡ç›®åŒ…å«ä¸¤ä¸ªåŸŸï¼š</p>
<ul>
<li>æ§åˆ¶æ ‡å¿—ï¼ˆfd flagsï¼‰</li>
<li>æ–‡ä»¶æŒ‡é’ˆï¼ˆfile pointerï¼‰ï¼šæŒ‡å‘æ‰“å¼€æ–‡ä»¶è¡¨å¯¹åº”æ¡ç çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-02d520db2c423414.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å®é™…ä¸Šï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦è¡¨çš„ç´¢å¼•ã€‚</p>
<h4>2.4 ç³»ç»Ÿçº§åˆ«çš„æ‰“å¼€æ–‡ä»¶è¡¨</h4>
<p>ç³»ç»Ÿå†…æ ¸å¯¹æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ˆOpen file description tableï¼‰ï¼Œä¹Ÿç§°ä¸ºæ‰“å¼€æ–‡ä»¶è¡¨ï¼ˆOpen file tableï¼‰ã€‚è¯¥è¡¨çš„æ¯ä¸ªæ¡ç›®ç§°ä¸ºæ–‡ä»¶å¥æŸ„ï¼ˆFile handleï¼‰ï¼Œå®ƒå­˜å‚¨äº†ä¸ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶ç›¸å…³çš„å…¨éƒ¨ä¿¡æ¯ã€‚</p>
<ul>
<li>å½“å‰æ–‡ä»¶åç§»é‡ï¼ˆfile offseï¼‰</li>
<li>æ‰“å¼€æ–‡ä»¶æ—¶çš„æ ‡è¯†ï¼ˆstatus flagsï¼‰</li>
<li>æ–‡ä»¶è®¿é—®æ¨¡å¼</li>
<li>ä¸ä¿¡å·é©±åŠ¨ç›¸å…³çš„è®¾ç½®</li>
<li>å½“å‰æ–‡ä»¶ inode æŒ‡é’ˆ</li>
<li>æ–‡ä»¶ç±»å‹å’Œè®¿é—®æƒé™</li>
<li>æŒ‡å‘è¯¥æ–‡ä»¶æ‰€æŒæœ‰çš„é”åˆ—è¡¨æŒ‡é’ˆ</li>
<li>è¿˜æœ‰æ–‡ä»¶çš„å„ç§å±æ€§...</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e2311e1602d532cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4>2.5 ç³»ç»Ÿçº§åˆ«çš„ i-node è¡¨</h4>
<p>ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿåªæœ‰ä¸€ä¸ª i-node è¡¨ã€‚æƒ³è¦çœŸæ­£è¯»å†™æ–‡ä»¶ï¼Œè¿˜è¦é€šè¿‡æ‰“å¼€æ–‡ä»¶æ ‡çš„ i-node æŒ‡é’ˆè¿›å…¥ i-node è¡¨ã€‚</p>
<p>i-node è¡¨çš„æ¯ä¸ªæ¡ç›®åŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>æ–‡ä»¶ç±»å‹ï¼Œä¾‹å¦‚æ™®é€šæ–‡ä»¶ã€å¥—æ¥å­—æˆ– FIFO ç­‰ã€‚</li>
<li>æ–‡ä»¶å¤§å°</li>
<li>æ–‡ä»¶é”</li>
<li>æ–‡ä»¶æ—¶é—´æˆ³ï¼Œæ¯”å¦‚ mtimeã€atimeã€ctimeã€‚</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-81277256e368c083.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4>2.6 ä¸‰ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»</h4>
<p>æ–‡ä»¶æè¿°è¡¨åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½ä¼šæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼Œè€Œæ‰“å¼€æ–‡ä»¶è¡¨å’Œ i-node è¡¨ï¼Œå®ƒä»¬åœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªã€‚</p>
<p>ä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9168fff610143208.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<!-- ğŸ‘† from https://www.gushiciku.cn/pl/gDX7/zh-tw -->
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-ff417795936fbd0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
ğŸ‘† from http://c.biancheng.net/view/3066.html
-->
<p>å…³ç³»å›¾æºè‡ªã€ŠThe Linux Programming Interfaceã€‹ä¸€ä¹¦ã€‚å›¾ç¤ºè¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>
<p>åœ¨è¿›ç¨‹ A ä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦ <code>1</code> å’Œ <code>20</code> éƒ½æŒ‡å‘äº†æ‰“å¼€æ–‡ä»¶è¡¨ä¸­çš„ç´¢å¼•ä¸º <code>23</code> çš„å¥æŸ„ï¼Œè¿™å¯èƒ½æ˜¯è°ƒç”¨äº† <code>dup()</code>ã€<code>dup2()</code>ã€<code>dcntl()</code>ã€æˆ–è€…å¯¹åŒä¸€ä¸ªæ–‡ä»¶å¤šæ¬¡è°ƒç”¨äº† <code>open()</code> å‡½æ•°å½¢æˆçš„ã€‚</p>
</li>
<li>
<p>è¿›ç¨‹ A çš„æ–‡ä»¶æè¿°ç¬¦ <code>2</code> å’Œè¿›ç¨‹ B çš„æ–‡ä»¶æè¿°ç¬¦ <code>2</code> éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªæ‰“å¼€æ–‡ä»¶è¡¨å¥æŸ„ï¼Œå¯èƒ½æ˜¯å› ä¸ºè°ƒç”¨ <code>fork()</code> åå‡ºç°çš„ï¼Œå­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œä¹Ÿå°±æ˜¯å­è¿›ç¨‹ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶ã€‚æˆ–è€…æ˜¯æŸè¿›ç¨‹é€šè¿‡ Unix åŸŸå¥—æ¥å­—å°†ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æˆ–è€…ä¸é€šè¿‡è¿›ç¨‹ç‹¬è‡ªè°ƒç”¨ <code>open()</code> å‡½æ•°æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶æ˜¯æ­£å¥½åˆ†é…åˆ°ä¸å…¶ä»–è¿›ç¨‹æ‰“å¼€è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸€æ ·ã€‚</p>
</li>
<li>
<p>è¿›ç¨‹ A çš„æ–‡ä»¶æè¿°ç¬¦ <code>0</code> å’Œè¿›ç¨‹ B çš„æ–‡ä»¶æè¿°ç¬¦ <code>3</code> åˆ†åˆ«æŒ‡å‘äº†ä¸åŒçš„æ‰“å¼€æ–‡ä»¶å¥æŸ„ï¼Œä½†è¿™äº›å¥æŸ„å‡æŒ‡å‘ i-node è¡¨ç›¸åŒçš„æ¡ç›®ï¼ˆå³åŒä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæ¯ä¸ªè¿›ç¨‹å„è‡ªå¯¹åŒä¸€ä¸ªæ–‡ä»¶å‘èµ·äº† <code>open()</code> è°ƒç”¨ã€‚åŒä¸€ä¸ªè¿›ç¨‹ä¸¤æ¬¡æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼æƒ…å†µã€‚</p>
</li>
</ul>
</blockquote>
<p>ä»å›¾ä¸­å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–‡ä»¶æè¿°ç¬¦ç†è§£ä¸ºè¿›ç¨‹ä¸­æ–‡ä»¶æè¿°ç¬¦è¡¨çš„ã€Œç´¢å¼•ã€ï¼Œæˆ–è€…æŠŠæ–‡ä»¶æè¿°ç¬¦è¡¨çœ‹ä½œä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚</p>
<p>å½“è¿›è¡Œ I/O æ“ä½œæ—¶ï¼Œä¼šä¼ å…¥ fd ä½œä¸ºå‚æ•°ï¼Œå…ˆä»å½“å‰è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦è¡¨æŸ¥æ‰¾è¯¥ fd å¯¹åº”çš„æ¡ç›®ï¼Œå¾—åˆ°æ–‡ä»¶æŒ‡é’ˆã€‚æ ¹æ®æ–‡ä»¶æŒ‡é’ˆï¼Œåœ¨æ‰“å¼€æ–‡ä»¶è¡¨å–å‡ºå¯¹åº”çš„é‚£ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼Œå¾—åˆ° inode æŒ‡é’ˆã€‚æ ¹æ® inode æŒ‡é’ˆï¼Œåœ¨ i-node è¡¨ä¸­æ‰¾åˆ°å¯¹åº”æ¡ç›®ï¼Œä»è€Œå®šä½åˆ°æ–‡ä»¶çœŸæ­£çš„ä½ç½®ï¼Œç„¶åè¿›è¡Œ I/O æ“ä½œã€‚</p>
<h4>2.7 å°ç»“</h4>
<p>åŸºäºå‰é¢çš„ä»‹ç»ï¼Œå¯çŸ¥ï¼š</p>
<ul>
<li>åŒä¸€è¿›ç¨‹çš„ä¸åŒæ–‡ä»¶æè¿°ç¬¦å¯ä»¥æŒ‡å‘åŒä¸€æ–‡ä»¶ã€‚</li>
<li>ä¸åŒè¿›ç¨‹å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li>ä¸åŒè¿›ç¨‹çš„åŒä¸€æ–‡ä»¶æè¿°ç¬¦å¯ä»¥æŒ‡å‘ä¸åŒçš„æ–‡ä»¶ï¼ˆæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ <code>0</code>ã€<code>1</code>ã€<code>2</code> åˆ†åˆ«å¯¹åº”æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯ï¼‰ã€‚</li>
<li>ä¸åŒè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿå¯ä»¥æŒ‡å‘åŒä¸€æ–‡ä»¶ã€‚</li>
</ul>
<p>æœªå®Œå¾…ç»­...</p>
<!--

## å‚è€ƒæ–‡ç« 

* [Linux æ–‡ä»¶æè¿°ç¬¦åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ](http://c.biancheng.net/view/3066.html)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Linux æ–‡ä»¶çš„ mtimeã€atimeã€ctime ä¸‰ç§æ—¶é—´]]></title>
            <link>https://github.com/toFrankie/blog/issues/37</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/37</guid>
            <pubDate>Sat, 25 Feb 2023 11:09:33 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-76918957e28ec8f6.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-76918957e28ec8f6.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://www.jianshu.com/p/bc97f9a32769">Linux é“¾æ¥æ–‡ä»¶è¯¦è§£</a>ä¸­æåˆ°äº† inode ä¿¡æ¯ã€‚åœ¨ inode çš„ä¸­åŒ…å«ä¸‰ç§æ–‡ä»¶æ—¶é—´æˆ³ï¼š<code>mtime</code>ã€<code>atime</code>ã€<code>ctime</code>ã€‚</p>
<p><strong>å«ä¹‰</strong></p>
<table>
<thead>
<tr>
<th>ç®€å†™</th>
<th>å…¨ç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>mtime</td>
<td>Modify Time</td>
<td>ä¿®æ”¹æ—¶é—´ï¼Œè¡¨ç¤ºæ–‡ä»¶å†…å®¹æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ã€‚</td>
</tr>
<tr>
<td>atime</td>
<td>Access Time</td>
<td>è®¿é—®æ—¶é—´ï¼Œè¡¨ç¤ºæ–‡ä»¶æœ€åä¸€æ¬¡è®¿é—®ï¼ˆè¯»å–æˆ–æ‰§è¡Œï¼‰çš„æ—¶é—´ã€‚</td>
</tr>
<tr>
<td>ctime</td>
<td>Change Time</td>
<td>æ”¹å˜æ—¶é—´ï¼Œè¡¨ç¤ºæ–‡ä»¶æœ€åä¸€æ¬¡æ”¹å˜ï¼ˆåŒ…æ‹¬å±æ€§ã€æƒé™ã€é“¾æ¥ä¸ªæ•°ç­‰ï¼‰çš„æ—¶é—´ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>è·å–æ–‡ä»¶æ—¶é—´</strong></p>
<p>å¯ä»¥é€‰æ‹©é€šè¿‡ <code>stat</code> æˆ– <code>ls</code> å‘½ä»¤è·å–æ–‡ä»¶æ—¶é—´ã€‚</p>
<pre><code class="language-shell">$ stat -x README.md
  File: &quot;README.md&quot;
  Size: 21           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/ frankie)  Gid: (   20/   staff)
Device: 1,5   Inode: 59499107    Links: 1
Access: Sun Jul 10 19:57:53 2022
Modify: Sun Jul 10 19:57:51 2022
Change: Sun Jul 10 19:57:51 2022
 Birth: Sun Jul 10 19:57:26 2022
</code></pre>
<p>ä½¿ç”¨ <code>ls</code> å‘½ä»¤çš„è¯ï¼Œæœ‰å‡ ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>-l</code> åˆ—ä¸¾ä¿¡æ¯æ—¶é—´ä¸€æ é»˜è®¤ä¸ºè¡¨ç¤ºæ–‡ä»¶çš„ <code>mtime</code>ã€‚</li>
<li><code>-lu</code> åˆ—ä¸¾ä¿¡æ¯æ—¶é—´ä¸€æ è¡¨ç¤ºæ–‡ä»¶ <code>atime</code>ï¼Œå…¶ä¸­ <code>-u</code> å¯ç”¨ <code>--time=atime</code> é•¿æ ¼å¼ä»£æ›¿ã€‚</li>
<li><code>-lc</code> åˆ—ä¸¾ä¿¡æ¯æ—¶é—´ä¸€æ è¡¨ç¤ºæ–‡ä»¶ <code>ctime</code>ï¼Œå…¶ä¸­ <code>-c</code> å¯ç”¨ <code>--time=ctime</code> é•¿æ ¼å¼ä»£æ›¿ã€‚</li>
</ul>
<p>æ›´å¤šå¯çœ‹<a href="https://wangchujiang.com/linux-command/c/ls.html">è¿™é‡Œ</a>ã€‚</p>
<pre><code class="language-shell">$ ls -l
total 56
-rw-r--r--  1 frankie  staff   21  7 10 19:57 README.md
-rw-r--r--  1 frankie  staff   13  7 10 20:29 a-symlink-absolute.txt
-rw-r--r--  1 frankie  staff   13  7 10 20:29 a-symlink-relative.txt
-rw-r--r--  1 frankie  staff   13  7 10 20:29 a-symlink.txt
-rw-r--r--@ 1 frankie  staff   13  7 10 20:00 a.txt
-rw-r--r--  1 frankie  staff  960  7 10 20:29 a.txtçš„æ›¿èº«
-rw-r--r--  1 frankie  staff   92  7 10 19:57 package.json
drwxr-xr-x  2 frankie  staff   64  7 10 19:57 src
</code></pre>
<p><strong>ç›¸å…³å‘½ä»¤æ“ä½œå¯¹æ–‡ä»¶æ—¶é—´çš„å½±å“</strong></p>
<p>å…¶ä¸­ âŒ è¡¨ç¤ºå¯¹åº”æ—¶é—´ä¸å‘ç”Ÿæ”¹å˜ï¼Œâœ… åˆ™è¡¨ç¤ºå¯¹åº”æ—¶é—´å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>mtime</th>
<th>atime</th>
<th>ctime</th>
</tr>
</thead>
<tbody>
<tr>
<td>cat</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>cp</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>mv</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>chmod</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>chown</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>touch</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>&gt;ã€&gt;&gt;</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>vimã€viï¼ˆä¸ä¿®æ”¹æ—¶ï¼‰</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>vimã€viï¼ˆä¿®æ”¹æ—¶ï¼‰</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
</tbody>
</table>
<p><strong>å…³äº <code>cat</code>ã€<code>cp</code> ç­‰å‘½ä»¤ä¸ä¼šæ›´æ”¹ <code>atime</code> çš„åŸå› </strong></p>
<p>ä»å‘½ä»¤è¯­ä¹‰çœ‹ï¼Œæ— è®ºæ˜¯è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿˜æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Œè‚¯å®šæ˜¯è®¿é—®æºæ–‡ä»¶çš„ï¼Œè¿™æ ·æŒ‰ç†æ¥è®²å°±åº”è¯¥æ›´æ–°æ–‡ä»¶çš„ <code>atime</code>ã€‚åœ¨ Linux kernel 2.6 ä»¥å‰ç¡®å®å¦‚æ­¤ï¼Œä½†åæ¥å‘ç° OS æ›´æ–° <code>atime</code> çš„å¼€é”€å¾ˆå¤§ï¼Œä¼šé€ æˆé¢‘ç¹çš„å†™æ“ä½œã€‚</p>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œè™½ç„¶å¯ä»¥å®Œå…¨ç¦æ­¢ atime çš„ä¿®æ”¹ï¼ˆè¯¦çœ‹ <code>mount</code> å‘½ä»¤çš„ <code>noatime</code> å’Œ <code>nodiratime</code> é€‰é¡¹ï¼‰ï¼Œä½†è¿™ä¼šç ´å POSIX å…¼å®¹æ€§ã€‚æ¯”å¦‚æŸäº›å¤‡ä»½è½¯ä»¶éœ€è¦é€šè¿‡å¯¹æ¯” <code>atime</code>ã€<code>mtime</code>ã€<code>ctime</code> çš„æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œå¤‡ä»½ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒLinux kernel 2.6.20 å¼€å§‹ä¸º <code>mount</code> å¼•å…¥äº† <code>relatime</code> é€‰é¡¹ï¼Œå¹¶ä» 2.6.30 å¼€å§‹é»˜è®¤å¼€å¯æ­¤é€‰é¡¹ã€‚</p>
<p>å½“å¼€å¯ <code>relatime</code> é€‰é¡¹åï¼Œåªæœ‰å½“ <code>atime &lt; mtime</code> æˆ– <code>atime &lt; ctime</code> æ—¶ï¼Œæ‰ä¼šå»æ›´æ–° <code>atime</code>ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ—¢èƒ½å¤§å¹…åº¦å‡å°‘ <code>atime</code> å¼•èµ·çš„å†™æ“ä½œï¼Œä¹Ÿä¿è¯äº†å¤‡ä»½è½¯ä»¶ä¸å—åˆ°å½±å“ã€‚</p>
<p>æ­¤è®¾è®¡éå¸¸ç²¾å¦™ï¼Œè¿™ä¹Ÿæˆäº†å¾ˆå¤šç³»ç»Ÿçš„é»˜è®¤è®¾ç½®ã€‚</p>
<p><a href="http://blog.lujun9972.win/blog/2018/10/10/%E4%B8%BA%E4%BB%80%E4%B9%88cat%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E4%B8%8D%E4%BC%9A%E4%BF%AE%E6%94%B9atime/index.html">æ›´å¤šè¯·çœ‹</a>ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Linux é“¾æ¥æ–‡ä»¶è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/36</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/36</guid>
            <pubDate>Sat, 25 Feb 2023 11:09:00 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-741a694e8874d53d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-741a694e8874d53d.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œåœ¨ Finder ä¸­å³é”®å¯ä»¥çœ‹åˆ°ã€Œå¤åˆ¶ã€ã€ã€Œæ‹·è´ã€ã€ã€Œåˆ¶ä½œæ›¿èº«ã€ç­‰æ“ä½œã€‚å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå¦å¤–ï¼Œè¿˜æœ‰æœ¬æ–‡é‡ç‚¹è®¨è®ºçš„ã€Œè½¯é“¾æ¥ã€ã€ã€Œç¡¬é“¾æ¥ã€åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>ä»æ“ä½œç»“æœçœ‹ï¼Œå®ƒä»¬éƒ½ç”Ÿæˆäº†ä¸€ä¸ªã€Œå‰¯æœ¬ã€ï¼Œä½†æœ‰ç€æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚</p>
</blockquote>
<p><strong>å¤åˆ¶ä¸æ‹·è´</strong></p>
<p>å®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶çš„å‰¯æœ¬ï¼Œè€Œä¸”å‰¯æœ¬ä¸åŸå§‹æ–‡ä»¶æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹å…¶ä¸€ä¸ä¼šå¯¹å¦ä¸€ä¸ªé€ æˆä»»ä½•å½±å“ã€‚äºŒè€…åŒºåˆ«åœ¨äºï¼Œå¤åˆ¶æ“ä½œä¼šç«‹åˆ»åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œæ‹·è´æ“ä½œåˆ™ä¼šå°†å‰¯æœ¬æ”¾è‡³å‰ªè´´æ¿ï¼Œç­‰å¾…è¢«ç²˜è´´ã€‚</p>
<p><strong>è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥</strong></p>
<p>æ“ä½œç³»ç»Ÿå†…ç½®çš„æ–‡ä»¶ç®¡ç†å™¨æœªç›´æ¥æä¾›ç›¸å…³åŠŸèƒ½ï¼Œé€šå¸¸åªèƒ½é€šè¿‡å‘½ä»¤è¡Œæ“ä½œã€‚ä»æ“ä½œç»“æœçœ‹ï¼Œå®ƒä»¬éƒ½äº§ç”Ÿäº†ä¸€ä¸ªâ€œå‰¯æœ¬â€ï¼ˆæ‰“ä¸ªå¼•å·ï¼‰ï¼Œä½†è¿™ä¸ªå‰¯æœ¬ä¸åŸå§‹æ–‡ä»¶æ˜¯æœ‰å…³è”çš„ã€‚</p>
<p><strong>æ›¿èº«ï¼ˆAliasï¼‰</strong></p>
<p>å®ƒæ˜¯ macOS æ“ä½œç³»ç»Ÿç‹¬æœ‰çš„ä¸€ä¸ªæ¦‚å¿µã€‚å®ƒæ˜¯ç»“åˆäº†è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„ä¼˜ç¼ºç‚¹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¯ä»¥æå‰è§‚å¯Ÿä¸€ä¸‹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å“ªäº›ç‰¹ç‚¹ã€‚</p>
<pre><code class="language-shell">$ ls -il
total 40
59499107 -rw-r--r--  1 frankie  staff   21  7 10 19:57 README.md
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a-hardlink.txt
59499638 lrwxr-xr-x  1 frankie  staff   49  7 10 20:09 a-symlink-absolute.txt -&gt; /Users/frankie/Desktop/Web/Temp/simple-link/a.txt
59499576 lrwxr-xr-x  1 frankie  staff    5  7 10 20:08 a-symlink-relative.txt -&gt; a.txt
59499486 lrwxr-xr-x  1 frankie  staff    5  7 10 20:04 a-symlink.txt -&gt; a.txt
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a.txt
59499900 -rw-r--r--@ 1 frankie  staff  960  7 10 20:12 a.txtçš„æ›¿èº«
59499003 -rw-r--r--  1 frankie  staff   92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff   64  7 10 19:57 src
</code></pre>
<h2>äºŒã€åŸºç¡€æ¦‚å¿µ</h2>
<h3>é“¾æ¥</h3>
<p>é€šå¸¸ï¼Œäººç±»æ‰€è¯´çš„é“¾æ¥å¤šæŒ‡ URLï¼Œè¡¨ç¤ºäº’è”ç½‘ä¸Šçš„ç½‘é¡µã€å›¾åƒã€éŸ³é¢‘ã€æ–‡ä»¶ç­‰èµ„æºã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ¬æ–‡æ‰€æä¹‹ã€Œé“¾æ¥ã€æ˜¯ POSIX æ ‡å‡†ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ˜¯ä¸€ç§æ–‡ä»¶å…±äº«çš„æ–¹å¼ã€‚è¿™ç§æ–‡ä»¶ç§°ä¸ºã€Œé“¾æ¥æ–‡ä»¶ã€ï¼Œç›®å‰ä¸»æµæ“ä½œç³»ç»Ÿéƒ½æ”¯æŒé“¾æ¥æ–‡ä»¶ã€‚</p>
<p><strong>é“¾æ¥æ–‡ä»¶å¯åˆ†ä¸ºã€Œç¬¦å·é“¾æ¥ <a href="https://www.wikiwand.com/en/Symbolic_link">symbolic link</a>ã€å’Œã€Œç¡¬é“¾æ¥ <a href="https://www.wikiwand.com/en/Hard_link">hard link</a>ã€ä¸¤ç§</strong>ã€‚å…¶ä¸­ç¬¦å·é“¾æ¥åˆç§°ä¸ºã€Œè½¯é“¾æ¥ <a href="https://www.wikiwand.com/en/Symbolic_link">soft link, symlink</a>ã€ã€‚</p>
<blockquote>
<p>ä»ä¸­æ–‡è§’åº¦å‡ºå‘ï¼Œä¸ºäº†å¯¹æ¯”æ›´é²œæ˜ï¼Œä¸‹æ–‡å°†ç§°ä¸ºã€Œè½¯é“¾æ¥ã€å’Œã€Œç¡¬é“¾æ¥ã€ã€‚</p>
</blockquote>
<h3>æ–‡ä»¶ä¸ç›®å½•</h3>
<p>äººç±»åœ¨ç®¡ç†æ–‡ä»¶æ—¶ï¼Œé€šå¸¸ä¼šåˆ’åˆ†ä¸ºã€Œæ–‡ä»¶ã€å’Œã€Œç›®å½•ã€ä¸¤ç§ï¼Œåè€…æ˜¯æ‰¿è½½å‰è€…çš„ä¸€ç§å®¹å™¨ï¼Œè¿™ç§åˆ’åˆ†æ–¹å¼å¯¹äººç±»æ˜¯å‹å¥½çš„ï¼Œå¯ä¾¿äºå½’çº³æ•´ç†ã€‚ä½†åœ¨æ“ä½œç³»ç»Ÿçœ‹æ¥ï¼Œç›®å½•ï¼ˆdirectoryï¼‰æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼Œä¸‹ç§°ä¸ºç›®å½•æ–‡ä»¶ã€‚</p>
<blockquote>
<p>ä¸‹æ–‡è‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æåˆ°çš„ã€Œæ–‡ä»¶ã€å‡ä»æ“ä½œç³»ç»Ÿè§’åº¦å‡ºå‘ï¼Œå› æ­¤å®ƒå¯èƒ½åŒ…å«äº†æ–‡ä»¶å’Œç›®å½•ã€‚</p>
</blockquote>
<h3>æ–‡ä»¶å­˜å‚¨</h3>
<p>æˆ‘ä»¬çš„æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨ã€Œç¡¬ç›˜ã€ä¸Šçš„ï¼Œç¡¬ç›˜ä¸Šçš„æœ€å°å­˜å‚¨å•ä½æ˜¯ã€Œæ‰‡åŒº Sectorã€ã€‚æ“ä½œç³»ç»Ÿè¯»å†™ç¡¬ç›˜æ—¶ï¼Œæœ€å°çš„å­˜å–å•ä½æ˜¯ã€Œå— Blockã€ã€‚ä¸€ä¸ªæ‰‡åŒºå­˜å‚¨ 512 ä¸ªå­—èŠ‚ï¼ˆ0.5KBï¼‰ï¼Œè€Œä¸€ä¸ªå—å¤§å°æœ€å¸¸è§ä¸º 4KBï¼Œå³è¿ç»­çš„å…«ä¸ªæ‰‡åŒºç»„æˆäº†ä¸€ä¸ªå—ã€‚</p>
<blockquote>
<p>ä¸€ä¸ªæ–‡ä»¶åˆ†ä¸ºæ•°æ®éƒ¨åˆ†å’Œå…ƒä¿¡æ¯ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­æ–‡ä»¶æ•°æ®éƒ½å­˜å‚¨åœ¨ã€ŒBlockã€ä¸­ï¼Œæ–‡ä»¶å…ƒä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåä¸ºã€Œinodeã€çš„åŒºåŸŸã€‚</p>
</blockquote>
<p>æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„ inodeï¼Œå®ƒåŒ…å«äº†æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚åˆ›å»ºè€…ã€åˆ›å»ºæ—¥æœŸã€å¤§å°ç­‰ä¿¡æ¯ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡ä»¶åç§°å¹¶ä¸åŒ…å«åœ¨ inode ä¿¡æ¯ä¸­ï¼ˆä¸‹æ–‡ä¼šä»‹ç»ï¼‰ï¼Œè€Œä¸” inode ä¹Ÿä¼šå ç”¨ç¡¬ç›˜ç©ºé—´</strong>ã€‚</p>
<h3>æ–‡ä»¶åŒºåˆ†</h3>
<p>é€šå¸¸æ¥è¯´ï¼Œäººç±»æ˜¯é€šè¿‡ã€Œæ–‡ä»¶åç§°ã€æ¥åŒºåˆ†ä¸åŒæ–‡ä»¶çš„ï¼Œæ›´ä¸¥è°¨ä¸€ç‚¹åº”è¯¥æ˜¯ã€Œæ–‡ä»¶è·¯å¾„ã€ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ“ä½œç³»ç»Ÿæ˜¯é€šè¿‡ä¸€ä¸ªç§°ä¸ºã€Œinode å·ç ã€ï¼ˆä¸€ä¸ª inode å¯¹åº”ä¸€ä¸ª inode å·ç ï¼‰çš„ä¸œè¥¿æ¥åŒºåˆ†ä¸åŒæ–‡ä»¶çš„ã€‚æ“ä½œç³»ç»Ÿå…è®¸ä¸åŒçš„æ–‡ä»¶åç§°å¯ä»¥å…·æœ‰åŒä¸€ä¸ª inode å·ç ã€‚inode å·ç ç›¸åŒçš„æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œéƒ½æŒ‡å‘äº†ç¡¬ç›˜ä¸­å­˜å‚¨çš„åŒä¸€ä»½æ•°æ®ï¼ˆè‡ªç„¶ä¹Ÿå°±åªå ç”¨äº†ä¸€ä»½ç¡¬ç›˜ç©ºé—´ï¼‰ã€‚è¿™æ‰æ˜¯æœ¬è´¨æ„ä¹‰ä¸Šçš„åŒä¸€æ–‡ä»¶ã€‚</p>
<p>ä»¥ç¥–å›½çš„å…¬æ°‘èº«ä»½è¯ç³»ç»Ÿæ¥æ¯”å–»ï¼Œèº«ä»½è¯å·ç å¯¹åº” inode å·ç ï¼Œå§“åå¯¹åº”ä¸ºæ–‡ä»¶åç§°ã€‚åœ¨å…¨å›½èŒƒå›´å†…ï¼Œèº«ä»½è¯å·ç æ˜¯å”¯ä¸€çš„ï¼Œå§“ååˆ™ä¸æ˜¯ï¼Œå› æ­¤è‹¥è¦ç¡®å®šå…·ä½“çš„æŸä¸ªäººï¼Œåªèƒ½é€šè¿‡èº«ä»½è¯å»æŸ¥æ‰¾ã€‚å§“åå’Œæ–‡ä»¶åç§°ä¸€æ ·å…è®¸é‡åï¼Œå½“ç„¶åœ¨æ“ä½œç³»ç»Ÿä¸­åŒä¸€è·¯å¾„ä¸‹æ–‡ä»¶ä¸å…è®¸é‡åã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œè¿™é‡Œé¢å…¶å®æ˜¯æœ‰ç•Œå®šèŒƒå›´çš„ï¼Œèº«ä»½è¯ç³»ç»Ÿä¸­çš„è¯ä»¶å·ç åªèƒ½ç¡®ä¿åœ¨å›½å†…æ˜¯å”¯ä¸€çš„ã€‚å‡è®¾æŸä¸ªå›½å®¶ä¹Ÿæœ‰ä¸€å¥—ç±»ä¼¼çš„èº«ä»½è¯ç³»ç»Ÿï¼Œæˆ‘å›½çš„å°æ˜ä¸ä»–å›½çš„å°èŠ±è¯ä»¶å·ç æ˜¯æœ‰å¯èƒ½é‡å¤çš„ï¼Œé‚£ä¹ˆåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…ï¼Œå°±æ— æ³•é€šè¿‡è¿™ä¸ªè¯ä»¶å·ç æŒ‡å‘å…·ä½“çš„æŸä¸ªäººã€‚åœ¨æ“ä½œç³»ç»Ÿä¸ŠåŒæ ·å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼ŒåŸå› æ˜¯å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒæŒ‚è½½ã€Œå¤šä¸ªã€æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œ inode å·ç åˆ™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œåˆ†é…ã€‚å°½ç®¡åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ inode å·ç ä¸ä¼šé‡å¤ï¼Œä½†æ˜¯å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿä¹‹é—´æ˜¯ä¼šå‡ºç°ç›¸åŒçš„ inode å·ç çš„ã€‚å¯ä»¥å°†æ“ä½œç³»ç»Ÿæ¯”å–»ä¸ºå…¨ä¸–ç•Œï¼Œæ–‡ä»¶ç³»ç»Ÿæ¯”å–»æˆå›½å®¶ï¼Œé“ç†æ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p>ä¸‹æ–‡è‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æŒ‡ inode å·ç å‡æŒ‡åŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…ã€‚</p>
</blockquote>
<h3>æ–‡ä»¶ä¿¡æ¯</h3>
<p>é€šè¿‡ <code>ls</code>ï¼ˆè‹±æ–‡ list çš„ç¼©å†™ï¼‰å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶æ¸…å•ã€‚æœ¬æ–‡ç”¨åˆ°å‚æ•°æœ‰ï¼š</p>
<ul>
<li><code>-a</code> è¡¨ç¤ºåˆ—ä¸¾å…¨éƒ¨æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ã€‚</li>
<li><code>-l</code> è¡¨ç¤ºåˆ—ä¸¾æ–‡ä»¶ç»†èŠ‚ï¼ŒåŒ…æ‹¬æ–‡ä»¶å±æ€§ã€æƒé™ã€æ‰€æœ‰è€…ã€æ‰€åœ¨ç¾¤ç»„ã€å¤§å°ã€ç›¸å…³æ—¥æœŸã€æ–‡ä»¶åç§°ã€é“¾æ¥æŒ‡å‘ç­‰ã€‚</li>
<li><code>-i</code> è¡¨ç¤ºåˆ—ä¸¾æ–‡ä»¶çš„ inode å·ç ã€‚</li>
</ul>
<pre><code class="language-shell"># åˆ—ä¸¾æ‰€æœ‰æ–‡ä»¶åç§°
$ ls
README.md               a-symlink-relative.txt  a.txtçš„æ›¿èº«
a-hardlink.txt          a-symlink.txt           package.json
a-symlink-absolute.txt  a.txt                   src

# åˆ—ä¸¾æ‰€æœ‰æ–‡ä»¶åç§°å’Œ inode å·ç 
$ ls -i
59499107 README.md              59499576 a-symlink-relative.txt 59499900 a.txtçš„æ›¿èº«
59499302 a-hardlink.txt         59499486 a-symlink.txt          59499003 package.json
59499638 a-symlink-absolute.txt 59499302 a.txt                  59499138 src

# åˆ—ä¸¾æ‰€æœ‰æ–‡ä»¶åç§°ã€inode å·ç ä»¥åŠå…¶ä»–ç»†èŠ‚
$ ls -il
total 40
59499107 -rw-r--r--  1 frankie  staff   21  7 10 19:57 README.md
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a-hardlink.txt
59499638 lrwxr-xr-x  1 frankie  staff   49  7 10 20:09 a-symlink-absolute.txt -&gt; /Users/frankie/Desktop/Web/Temp/simple-link/a.txt
59499576 lrwxr-xr-x  1 frankie  staff    5  7 10 20:08 a-symlink-relative.txt -&gt; a.txt
59499486 lrwxr-xr-x  1 frankie  staff    5  7 10 20:04 a-symlink.txt -&gt; a.txt
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a.txt
59499900 -rw-r--r--@ 1 frankie  staff  960  7 10 20:12 a.txtçš„æ›¿èº«
59499003 -rw-r--r--  1 frankie  staff   92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff   64  7 10 19:57 sr
</code></pre>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œå‘½ä»¤è¡Œä¸­æ–‡ä»¶ç»†èŠ‚æ‰€è¡¨ç¤ºå¦‚ä¸‹ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-bd4fd33054d216f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸åŒæ“ä½œç³»ç»Ÿæˆ–ä¸åŒç»ˆç«¯å·¥å…·æ‰€å±•ç¤ºå†…å®¹æˆ–æœ‰ä¸åŒã€‚</p>
<h2>ä¸‰ã€inode</h2>
<blockquote>
<p>æœ¬æ–‡ä¸€äº›å†…å®¹æ‘˜è‡ªé˜®ä¸€å³°è€å¸ˆæ–‡ç« ï¼š<a href="https://www.ruanyifeng.com/blog/2011/12/inode.html">ç†è§£ inode</a>ã€‚</p>
</blockquote>
<p>å¾€ä¸‹ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ inode æ˜¯ä»€ä¹ˆï¼Œå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ</p>
<p>inode æ˜¯ <a href="https://www.wikiwand.com/en/Inode">index node</a> çš„ç®€å†™ï¼Œè¯‘ä¸ºç´¢å¼•èŠ‚ç‚¹ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„ inodeï¼Œå®ƒåŒ…å«äº†ä»¥ä¸‹è¿™äº›æ–‡ä»¶å…ƒä¿¡æ¯ï¼š</p>
<blockquote>
<ul>
<li>æ–‡ä»¶å­—èŠ‚æ•°</li>
<li>æ–‡ä»¶æ‰€æœ‰è€…çš„ User ID</li>
<li>æ–‡ä»¶æ‰€åœ¨ç¾¤ç»„çš„ User ID</li>
<li>æ–‡ä»¶çš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™</li>
<li>æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œå…±æœ‰ä¸‰ä¸ªï¼šctime æŒ‡ inode ä¸Šä¸€æ¬¡æ›´æ”¹æ—¶é—´ï¼Œmtime æŒ‡æ–‡ä»¶å†…å®¹ä¸Šä¸€æ¬¡æ›´æ”¹æ—¶é—´ï¼Œatime æŒ‡æ–‡ä»¶ä¸Šä¸€æ¬¡è¢«è®¿é—®æ—¶é—´ã€‚</li>
<li>é“¾æ¥ä¸ªæ•°ï¼Œå³æœ‰å¤šå°‘ä¸ªæ–‡ä»¶åç§°æŒ‡å‘è¿™ä¸ª inode</li>
<li>æ–‡ä»¶æ•°æ® Block çš„æ–‡ä»¶</li>
</ul>
</blockquote>
<p>æ˜¯çš„ï¼Œinode ä¿¡æ¯é‡Œæ²¡æœ‰å­˜å‚¨æ–‡ä»¶åç§°ã€‚å¯ä»¥å…ˆæ€è€ƒä¸‹ï¼šå®ƒä¼šè¢«å­˜æ”¾åˆ°å“ªé‡Œå‘¢ï¼Ÿ</p>
<h3>inode ä¿¡æ¯</h3>
<p>ä½¿ç”¨ <code>stat</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„ inode ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">$ stat -x README.md

  File: &quot;README.md&quot;
  Size: 21           FileType: Regular File
  Mode: (0644/-rw-r--r--)         Uid: (  501/ frankie)  Gid: (   20/   staff)
Device: 1,5   Inode: 59499107    Links: 1
Access: Sun Jul 10 19:57:53 2022
Modify: Sun Jul 10 19:57:51 2022
Change: Sun Jul 10 19:57:51 2022
 Birth: Sun Jul 10 19:57:26 2022
</code></pre>
<h3>inode å¤§å°</h3>
<p>inode æœ¬èº«ä¹Ÿä¼šå ç”¨ç¡¬ç›˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿä¼šå°†ç¡¬ç›˜åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šä¸€ä¸ªæ˜¯ã€Œæ•°æ®åŒºã€ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶æ•°æ®ï¼›ä¸€ä¸ªæ˜¯ã€Œinode åŒºã€ï¼Œç”¨äºå­˜æ”¾ inode æ‰€åŒ…å«çš„ä¿¡æ¯ã€‚</p>
<p>æ¯ä¸ª inode å¤§å°ä¸€èˆ¬æ˜¯ 128 å­—èŠ‚æˆ– 256 å­—èŠ‚ã€‚é€šå¸¸æ˜¯æ¯ 1KB æˆ–æ¯ 2KB å°±è®¾ç½®ä¸€ä¸ª inodeã€‚ç”±äºåœ¨ç¡¬ç›˜æ ¼å¼åŒ–æ—¶ï¼Œinode æ€»æ•°é‡å°±å·²ç»ç»™å®šã€‚è€Œä¸”æ¯ä¸ªæ–‡ä»¶å¿…é¡»è¦æœ‰ä¸€ä¸ª inodeï¼Œå› æ­¤æœ‰å¯èƒ½å‘ç”Ÿ inode å·²ç»ç”¨å®Œï¼Œä½†ç¡¬ç›˜æœªå­˜æ»¡çš„æƒ…å†µï¼Œæ­¤æ—¶æ— æ³•å†ä»ç¡¬ç›˜ä¸Šåˆ›å»ºæ–°æ–‡ä»¶ã€‚</p>
<h3>inode å·ç </h3>
<p>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ inodeï¼Œè€Œæ¯ä¸ª inode ä¼šå¯¹åº”ä¸€ä¸ªå·ç ï¼Œç§°ä¸ºã€Œinode å·ç ã€ã€‚<strong>åœ¨ Unix/Linux æ“ä½œç³»ç»Ÿä¸­æ˜¯é€šè¿‡ inode å·ç æ¥è¯†åˆ«ä¸åŒæ–‡ä»¶çš„ã€‚æ–‡ä»¶åç§°åªæ˜¯ inode å·ç çš„ä¸€ä¸ªã€Œåˆ«ç§°ã€ï¼Œä½†è¿™ä¸ªåˆ«ç§°å¯¹äººç±»æ˜¯å‹å¥½çš„ã€æ˜“äºè®°å¿†ä¸åŒºåˆ†çš„ã€‚</strong></p>
<p>è¿˜æ˜¯ç”¨æˆ‘å›½çš„å…¬æ°‘èº«ä»½è¯ç³»ç»Ÿæ¥æ¯”å–»ï¼Œèº«ä»½è¯å·ç å¯¹åº” inode å·ç ï¼Œè€Œå§“ååˆ™å¯¹åº”æ–‡ä»¶åç§°ã€‚å¹³å¸¸é—®å€™æœ‹å‹æ€»ä¸èƒ½è¯´ã€Œé‚£ä¸ª 4413*****3425ï¼ˆä¹±å†™çš„ï¼‰åƒé¥­äº†æ²¡ã€ï¼Œæ˜¾ç„¶ã€Œå°æ˜ä½ åƒé¥­äº†æ²¡ã€æ›´åˆé€‚ã€‚</p>
<h3>ç›®å½•æ–‡ä»¶</h3>
<p>ç›®å½•æ–‡ä»¶çš„ç»“æ„éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹ï¼ˆdirentï¼‰çš„åˆ—è¡¨ã€‚</p>
<blockquote>
<p>æ¯ä¸ªç›®å½•é¡¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ‰€åŒ…å«æ–‡ä»¶çš„æ–‡ä»¶åç§°ï¼Œä»¥åŠè¯¥æ–‡ä»¶åç§°å¯¹åº”çš„ inode å·ç ã€‚</p>
</blockquote>
<p>å‰é¢æåˆ°ï¼Œæ–‡ä»¶åç§°æ²¡æœ‰å­˜åˆ° inode ä¿¡æ¯ä¸­ï¼Œæ–‡ä»¶åç§°è¢«å­˜åœ¨è‡³ç›®å½•é¡¹ä¸­ã€‚</p>
<p>é€šè¿‡ <code>ls -i</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„ inode å·ç ï¼š</p>
<pre><code class="language-shell"># åˆ—å‡ºç›®å½•æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶åç§°
$ ls
README.md       package.json    src

# åˆ—å‡ºç›®å½•æ–‡ä»¶ä¸­æ‰€æœ‰æ–‡ä»¶åç§°å’Œ inode å·ç 
$ ls -i
59499107 README.md      59499003 package.json   59499138 src

# åˆ—å‡ºç›®å½•æ–‡ä»¶ä¸­æ‰€æœ‰æ–‡ä»¶åç§°ã€inode å·ç ä»¥åŠå…¶ä»–è¯¦ç»†ä¿¡æ¯
$ ls -il
total 16
59499107 -rw-r--r--  1 frankie  staff  21  7 10 19:57 README.md
59499003 -rw-r--r--  1 frankie  staff  92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff  64  7 10 19:57 src
</code></pre>
<p>å¹³å¸¸è®¿é—®ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š</p>
<blockquote>
<ol>
<li>åœ¨å½“å‰ç›®å½•æ–‡ä»¶ä¸­ï¼Œæ ¹æ®æ–‡ä»¶åç§°æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ inode å·ç ï¼›</li>
<li>é€šè¿‡ inode å·ç ï¼Œè·å–åˆ° inode ä¿¡æ¯ï¼›</li>
<li>æ ¹æ® inode ä¿¡æ¯ï¼Œæ‰¾åˆ°æ–‡ä»¶æ•°æ®å­˜å‚¨çš„ Blockï¼Œç„¶åè¯»å‡ºæ•°æ®ã€‚</li>
</ol>
</blockquote>
<p>å½“æ“ä½œç³»ç»Ÿå¾—çŸ¥ inode å·ç ä¹‹åï¼Œåç»­å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å·ç å¯¹æ–‡ä»¶æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>
<h2>å››ã€è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥</h2>
<h3>åˆ›å»ºé“¾æ¥</h3>
<p>ä½¿ç”¨ <code>ln</code>ï¼ˆè‹±æ–‡ link çš„ç¼©å†™ï¼‰å‘½ä»¤å¯ä»¥ä¸ºæ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ã€ç¡¬é“¾æ¥ã€‚å‘½ä»¤è¾ƒä¸ºç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># åˆ›å»ºç¡¬é“¾æ¥
$ ln &lt;source-file&gt; &lt;target-file&gt;

# åˆ›å»ºè½¯é“¾æ¥
$ ln -s &lt;source-file&gt; &lt;target-file&gt;
</code></pre>
<blockquote>
<p>åˆ›å»ºè½¯é“¾æ¥æ—¶ï¼ŒåŸå§‹æ–‡ä»¶è·¯å¾„ï¼ˆå³ <code>&lt;source-file&gt;</code>ï¼‰å»ºè®®ä½¿ç”¨ã€Œç»å¯¹è·¯å¾„ã€ï¼Œä»¥é¿å…ç§»åŠ¨è½¯é“¾æ¥åæ— æ³•æ­£å¸¸è®¿é—®ç›®æ ‡æ–‡ä»¶ã€‚</p>
</blockquote>
<h3>ç¡¬é“¾æ¥</h3>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ–‡ä»¶åç§°ä¸ inode å·ç æ˜¯ã€Œä¸€ä¸€å¯¹åº”ã€çš„å…³ç³»ï¼Œå³ä¸€ä¸ª inode å¯¹åº”ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚<strong>ä½†æ˜¯ï¼Œä¸»æµæ“ä½œç³»ç»Ÿéƒ½å…è®¸å¤šä¸ªæ–‡ä»¶åç§°æŒ‡å‘åŒä¸€ä¸ª inode å·ç </strong>ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œé€šè¿‡ä¸åŒçš„æ–‡ä»¶åç§°å¯ä»¥è®¿é—®åˆ°åŒæ ·çš„æ–‡ä»¶å†…å®¹ï¼Œå¯¹æ–‡ä»¶å†…å®¹çš„ä¿®æ”¹è‡ªç„¶ä¼šå½±å“æ‰€æœ‰å¯¹åº”çš„æ–‡ä»¶åç§°ã€‚ä½†æ˜¯ï¼Œåˆ é™¤å…¶ä¸­ä¸€ä¸ªï¼Œä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªçš„è®¿é—®ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºã€Œç¡¬é“¾æ¥ã€ã€‚</p>
<pre><code class="language-shell">$ touch a.txt &amp;&amp; echo 'some text...' &gt;&gt; a.txt

$ ln a.txt a-hardlink.txt

$ ls -il
total 32
59499107 -rw-r--r--  1 frankie  staff  21  7 10 19:57 README.md
59499302 -rw-r--r--  2 frankie  staff  13  7 10 20:00 a-hardlink.txt
59499302 -rw-r--r--  2 frankie  staff  13  7 10 20:00 a.txt
59499003 -rw-r--r--  1 frankie  staff  92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff  64  7 10 19:57 src
</code></pre>
<p>å¯ä»¥çœ‹åˆ° <code>a.txt</code> ä¸ <code>a-hardlink.txt</code> çš„ inode å·ç æ˜¯ç›¸åŒçš„ï¼Œéƒ½æŒ‡å‘ <code>59499302</code> è¿™ä¸ª inode å·ç ã€‚å…¶ä¸­æœ‰ä¸€é¡¹è¡¨ç¤ºã€Œé“¾æ¥ä¸ªæ•°ã€ï¼Œè®°å½•æŒ‡å‘è¯¥ inode çš„æ–‡ä»¶åç§°æ€»æ•°ã€‚ç›®å‰æŒ‡å‘ <code>59499302</code> å·ç çš„æ–‡ä»¶æœ‰ <code>a.txt</code> å’Œ <code>a-hardlink.txt</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå› æ­¤å…¶é“¾æ¥ä¸ªæ•°ä¸º <code>2</code>ã€‚</p>
<pre><code class="language-shell">$ rm a-hardlink.txt

$ ls -il
total 24
59499107 -rw-r--r--  1 frankie  staff  21  7 10 19:57 README.md
59499302 -rw-r--r--  1 frankie  staff  13  7 10 20:00 a.txt
59499003 -rw-r--r--  1 frankie  staff  92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff  64  7 10 19:57 src
</code></pre>
<p>å½“æˆ‘ä»¬åˆ é™¤å…¶ä¸€æ—¶ï¼Œ<code>a.txt</code> å¯¹åº”é“¾æ¥æ•°å°†ä¼šã€Œå‡ä¸€ã€ã€‚å½“é“¾æ¥ä¸ªæ•°å‡åˆ°é›¶æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰æ–‡ä»¶åç§°æŒ‡å‘è¿™ä¸ª inode äº†ï¼Œæ“ä½œç³»ç»Ÿå°†ä¼šå›æ”¶è¿™ä¸ª inode å·ç ï¼Œä»¥åŠå…¶å¯¹åº”çš„ block åŒºåŸŸã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»ºç›®å½•æ—¶ä¼šé»˜è®¤ç”Ÿæˆä¸¤ä¸ªç›®å½•é¡¹ï¼š<code>.</code> å’Œ <code>..</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰ç›®å½•çš„ç¡¬é“¾æ¥ã€çˆ¶ç›®å½•çš„ç¡¬é“¾æ¥ï¼Œå®ƒä»¬çš„ inode å·ç ä¹Ÿæ˜¯å¯¹åº”çš„ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºç›®å½•åå…¶é“¾æ¥ä¸ªæ•°ä¸º <code>2</code>ï¼šä¸€ä¸ªæ˜¯æ‰€åˆ›å»ºç›®å½•åï¼Œä¸€ä¸ªæ˜¯å½“å‰ç›®å½•ä¸‹çš„ <code>.</code> ç›®å½•ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œç¡¬é“¾æ¥æœ¬è´¨ä¸Šåªæ˜¯æ–°å¢ä¸€ä¸ªæ–‡ä»¶åç§°åˆ°æŸä¸ª inode å·ç è€Œå·²ã€‚</p>
</blockquote>
<h3>è½¯é“¾æ¥</h3>
<p>é€šè¿‡å‰é¢å‘ç°ï¼Œç¡¬é“¾æ¥ä¸åŸå§‹æ–‡ä»¶çš„ inode å·ç æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯è½¯é“¾æ¥çš„ inode å·ç ä¸åŸå§‹æ–‡ä»¶æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å‡è®¾æœ‰æ–‡ä»¶ A å’Œ Bï¼Œå®ƒä»¬çš„ inode å·ç ä¸åŒï¼Œä½†æ˜¯ B æ–‡ä»¶çš„å†…å®¹æ˜¯ A æ–‡ä»¶çš„è·¯å¾„ã€‚å½“è¯»å– B æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°†ä¼šè‡ªåŠ¨å¯¼å‘ A æ–‡ä»¶ï¼Œè¯»å–çš„éƒ½æ˜¯ A æ–‡ä»¶çš„å†…å®¹ã€‚æ­¤æ—¶ï¼ŒB æ–‡ä»¶è¢«ç§°ä¸º A æ–‡ä»¶çš„ã€Œè½¯é“¾æ¥ã€ã€‚</p>
<pre><code class="language-shell">$ ln -s a.txt a-symlink.txt

$ ls -il
total 32
59499107 -rw-r--r--  1 frankie  staff  21  7 10 19:57 README.md
59499302 -rw-r--r--  2 frankie  staff  13  7 10 20:00 a-hardlink.txt
59499486 lrwxr-xr-x  1 frankie  staff   5  7 10 20:04 a-symlink.txt -&gt; a.txt
59499302 -rw-r--r--  2 frankie  staff  13  7 10 20:00 a.txt
59499003 -rw-r--r--  1 frankie  staff  92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff  64  7 10 19:57 src
</code></pre>
<p>å¯ä»¥å‘ç°ï¼Œ<code>a.txt</code> ä¸ <code>a-symlink.txt</code> çš„ inode å·ç æ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œåˆ›å»ºè½¯é“¾æ¥ä¸ä¼šä½¿å¾—åŸå§‹æ–‡ä»¶çš„é“¾æ¥ä¸ªæ•°å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>é€šè¿‡åˆ›å»ºè½¯é“¾æ¥è€Œç”Ÿæˆçš„æ–°æ–‡ä»¶ï¼Œå…¶æœ¬èº«æ‹¥æœ‰ä¸€ä¸ªæ–°çš„ inodeã€‚ä¸åŸå§‹æ–‡ä»¶ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„æ–‡ä»¶å†…å®¹æ˜¯åŸå§‹æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ã€‚ä»¥ <code>a-symlink.txt</code> ä¸ºä¾‹ï¼Œå…¶æ–‡ä»¶å¤§å°ä¸º 5 ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯æ–‡ä»¶å†…å®¹ <code>a.txt</code> çš„å­—èŠ‚æ•°ï¼ˆä¸€ä¸ªè‹±æ–‡å­—ç¬¦å ä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚</p>
<p>ç”±äº <code>a-symlink.txt</code> æ–‡ä»¶æ˜¯ä¾èµ–äº <code>a.txt</code> æ–‡ä»¶çš„ï¼Œæ„å‘³ç€åˆ é™¤åŸå§‹æ–‡ä»¶ <code>a.txt</code> åï¼Œå†æ¬¡è®¿é—® <code>a-symlink.txt</code> æ–‡ä»¶å°±ä¼šæŠ¥é”™ï¼šNo such file or directoryã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œè½¯é“¾æ¥æœ¬è´¨ä¸Šåªæ˜¯è®°å½•äº†æŸä¸ªæ–‡ä»¶è·¯å¾„ã€‚</p>
</blockquote>
<h3>æ³¨æ„ç‚¹</h3>
<ol>
<li>åˆ›å»ºè½¯é“¾æ¥å»ºè®®ä½¿ç”¨ã€Œç»å¯¹è·¯å¾„ã€ï¼Œä»¥é¿å…æ‰€ç”Ÿæˆçš„è½¯é“¾æ¥åœ¨ç§»åŠ¨è‡³å…¶ä»–ç›®å½•ä¹‹åï¼Œæ— æ³•è®¿é—®åˆ°åŸå§‹æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="language-shell">$ ln -s a.txt a-symlink-relative.txt

$ ln -s ~/Desktop/Web/Temp/simple-link/a.txt a-symlink-absolute.txt
</code></pre>
<p>äºŒè€…åŒºåˆ«åœ¨äºï¼ŒåŸå§‹æ–‡ä»¶çš„è·¯å¾„ä¸€ä¸ªæ˜¯ç›¸å½“è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯ç»å¯¹è·¯å¾„ã€‚æ¥ç€ï¼Œå°†è¿™ä¸¤ä¸ªè½¯é“¾æ¥ç§»è‡³å…¶ä»–æ¡Œé¢ç›®å½•ï¼Œç„¶ååœ¨æ¡Œé¢ç›®å½•ä¸‹è®¿é—®è½¯é“¾æ¥ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre><code class="language-shell">$ mv a-symlink-relative.txt ~/Desktop

$ mv a-symlink-absolute.txt ~/Desktop

$ cat ~/Desktop/a-symlink-relative.txt
cat: a-symlink-relative.txt: No such file or directory

$ cat ~/Desktop/a-symlink-absolute.txt
some text...

$ ls -l
total 32
-rw-r--r--  1 frankie  staff  21  7 10 19:57 README.md
-rw-r--r--  2 frankie  staff  13  7 10 20:00 a-hardlink.txt
lrwxr-xr-x  1 frankie  staff  49  7 10 20:09 a-symlink-absolute.txt -&gt; /Users/frankie/Desktop/Web/Temp/simple-link/a.txt
lrwxr-xr-x  1 frankie  staff   5  7 10 20:08 a-symlink-relative.txt -&gt; a.txt
lrwxr-xr-x  1 frankie  staff   5  7 10 20:04 a-symlink.txt -&gt; a.txt
-rw-r--r--  2 frankie  staff  13  7 10 20:00 a.txt
-rw-r--r--  1 frankie  staff  92  7 10 19:57 package.json
drwxr-xr-x  2 frankie  staff  64  7 10 19:57 src
</code></pre>
<p><code>a-symlink-relative.txt</code> åœ¨ç§»åŠ¨åˆ°å…¶ä»–ç›®å½•åï¼Œå°±ä¸èƒ½æ­£å¸¸è®¿é—®åŸå§‹æ–‡ä»¶äº†ï¼Œè€Œ <code>a-symlink-absolute.txt</code> åˆ™ä¸å—å½±å“ã€‚æ¢å¥è¯è¯´ï¼Œè½¯é“¾æ¥é‡Œè®°å½•çš„åŸå§‹æ–‡ä»¶è·¯å¾„å¯ä»¥æ˜¯ç›¸å½“è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼Œå–å†³äºåˆ›å»ºæ—¶ä½¿ç”¨äº†å“ªç§è·¯å¾„ï¼ˆå³ä¸Šé¢ç®­å¤´åé¢çš„è·¯å¾„ï¼‰ã€‚å…¶ä¸­ <code>cat ~/Desktop/a-symlink-relative.txt</code> ç›¸å½“äº <code>cat ~/Desktop/a.txt</code>ï¼Œè‡ªç„¶å°±æ‰¾ä¸åˆ°äº†ã€‚</p>
<p>æ³¨æ„ï¼Œä¿®æ”¹åŸå§‹æ–‡ä»¶åç§°ã€ç§»åŠ¨æˆ–åˆ é™¤åŸå§‹æ–‡ä»¶ï¼Œå°±æ— æ³•é€šè¿‡å®ƒçš„è½¯é“¾æ¥è®¿é—®åˆ°æ–‡ä»¶äº†ã€‚</p>
<ol start="2">
<li>
<p>ç”±äºç¡¬é“¾æ¥å’ŒåŸå§‹æ–‡ä»¶çš„å½¢å¼æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿæ˜¯æ— æ³•åŒºåˆ†ç¡¬é“¾æ¥è¿˜æ˜¯åŸå§‹æ–‡ä»¶çš„ã€‚åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­äºŒè€…çœ‹ç€æ˜¯ä¸€æ ·çš„ã€‚è½¯é“¾æ¥åˆ™åœ¨æ–‡ä»¶å›¾æ ‡ä¸Šæœ‰ä¸€ä¸ªç®­å¤´çš„å›¾æ¡ˆã€‚</p>
</li>
<li>
<p>ç¡¬é“¾æ¥æ— æ³•è·¨æ–‡ä»¶ç³»ç»Ÿã€‚</p>
</li>
</ol>
<p>å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œä¸èƒ½è·¨æ–‡ä»¶ç³»ç»Ÿçš„åŸå› æ˜¯ï¼Œä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„ inode å·ç æ˜¯ä¼šå‡ºç°é‡å¤ç°è±¡çš„ã€‚</p>
<ol start="4">
<li>ç¡¬é“¾æ¥ä¸èƒ½é“¾æ¥ç›®å½•æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="language-shell">$ ln src src-harklink
ln: src: Is a directory
</code></pre>
<p>æ‹’ç»åˆ›å»ºç›®å½•ç¡¬é“¾æ¥æ˜¯ <code>ln</code> å‘½ä»¤æœ¬èº«ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿã€‚å› ä¸ºå¯¹ç›®å½•åˆ›å»ºç¡¬é“¾æ¥ï¼Œå¯èƒ½ä¼šæ‰“ç ´æ–‡ä»¶ç³»ç»Ÿçš„æœ‰å‘æ— ç¯å›¾ç»“æ„ã€‚</p>
<blockquote>
<p>æ›´å¤šè¯·çœ‹æ–‡ç« ï¼š<a href="https://blog.csdn.net/longerzone/article/details/23870297">å¤šè§’åº¦åˆ†æä¸ºä»€ä¹ˆ Linux çš„ç¡¬è¿æ¥ä¸èƒ½æŒ‡å‘ç›®å½•</a></p>
</blockquote>
<ol start="5">
<li>
<p>ç§»åŠ¨ã€ä¿®æ”¹æ–‡ä»¶åç§°ï¼Œä¸ä¼šå½±å“ inode å·ç ã€‚</p>
</li>
<li>
<p>ä¸€äº›æ–‡ä»¶åç§°åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡ä»¶ï¼Œæ— æ³•æ­£å¸¸åˆ é™¤ã€‚å¯ä»¥é€šè¿‡ç›´æ¥åˆ é™¤ inode çš„æ–¹å¼å»åˆ é™¤æ–‡ä»¶ã€‚</p>
</li>
</ol>
<h2>äº”ã€æ›¿èº«</h2>
<p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œå¯ä»¥çŸ¥é“è½¯é“¾æ¥ã€ç¡¬é“¾æ¥éƒ½æœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p>
<ul>
<li>ç§»åŠ¨ã€é‡å‘½åæˆ–åˆ é™¤åŸå§‹æ–‡ä»¶åï¼Œå°±æ— æ³•é€šè¿‡è½¯é“¾æ¥è®¿é—®åˆ°åŸå§‹æ–‡ä»¶äº†ã€‚</li>
<li>ç¡¬é“¾æ¥æ— æ³•é“¾æ¥ç›®å½•ï¼Œä¸èƒ½è·¨æ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œèƒ½ä¸èƒ½ç»“åˆä¸¤è€…çš„ä¼˜ç‚¹ï¼Œäº§ç”Ÿä¸€ç§æ–°çš„æ–¹æ¡ˆæ¥é¿å…ä¸¤è€…çš„ç¼ºç‚¹å‘¢ï¼Ÿ</p>
<p>åœ¨ macOS ä¸Šæœ‰ä¸€ç§ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼šã€Œæ›¿èº« Aliasã€ã€‚æ›¿èº«æ–‡ä»¶è®°å½•äº†åŸå§‹æ–‡ä»¶çš„è·¯å¾„å’Œ inode å·ç ï¼Œå½“è®¿é—®æ›¿èº«æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿåˆ†ææ›¿èº«æ–‡ä»¶ï¼Œæ‰¾åˆ°åŸå§‹æ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­åŸå§‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™è®¿é—®å®ƒï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±å¯»æ‰¾æœ‰ç›¸åŒ inode å·ç çš„æ–‡ä»¶ï¼Œç„¶åè®¿é—®è¯¥æ–‡ä»¶ã€‚</p>
<pre><code class="language-shell">$ osascript -e 'tell application &quot;Finder&quot; to make alias file to POSIX file &quot;/Users/frankie/Desktop/Web/Temp/simple-link/a.txt&quot; at POSIX file &quot;/Users/frankie/Desktop/Web/Temp/simple-link/&quot;'
alias file a.txtçš„æ›¿èº« of folder simple-link of folder Temp of folder Web of folder Desktop of folder frankie of folder Users of startup disk

$ ls -il
total 40
59499107 -rw-r--r--  1 frankie  staff   21  7 10 19:57 README.md
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a-hardlink.txt
59499638 lrwxr-xr-x  1 frankie  staff   49  7 10 20:09 a-symlink-absolute.txt -&gt; /Users/frankie/Desktop/Web/Temp/simple-link/a.txt
59499576 lrwxr-xr-x  1 frankie  staff    5  7 10 20:08 a-symlink-relative.txt -&gt; a.txt
59499486 lrwxr-xr-x  1 frankie  staff    5  7 10 20:04 a-symlink.txt -&gt; a.txt
59499302 -rw-r--r--  2 frankie  staff   13  7 10 20:00 a.txt
59499900 -rw-r--r--@ 1 frankie  staff  960  7 10 20:12 a.txtçš„æ›¿èº«
59499003 -rw-r--r--  1 frankie  staff   92  7 10 19:57 package.json
59499138 drwxr-xr-x  2 frankie  staff   64  7 10 19:57 src

$ cat a.txtçš„æ›¿èº«
bookmark88ï¿½ï¿½$nï¿½|=ï¿½Aï¿½lUsersfrankieDesktopWebTemp
                                               simple-linka.txt 0@LX ï¿½~
                                                                      ï¿½ï¿½Iï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½={lï¿½ï¿½  file:///
                                                                                                Macintosh Hï¿½ hAï¿½ï¿½ï¿½$C7FF9732-E725-402E-8FC2-AF9D4F2482C5ï¿½ï¿½ï¿½/3dnibtxt????ï¿½ï¿½ï¿½ï¿½|D@4TlUlVd $ ï¿½ ï¿½ ï¿½ ï¿½ ï¿½  0 dï¿½xï¿½ ï¿½ï¿½ï¿½dï¿½ï¿½l&quot;ï¿½0%
</code></pre>
<p>åˆ›å»ºæ›¿èº«å…¶ inode å·ç ä¸åŸå§‹æ–‡ä»¶çš„ä¸ç›¸åŒã€‚é€šè¿‡ <code>cat</code> å‘½ä»¤æŸ¥çœ‹å†…å®¹æ—¶ï¼Œä¸ä¼šé‡å®šå‘åˆ°åŸå§‹æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥çœ‹åˆ°å…¶å†…å®¹ã€‚åœ¨ Finder ä¸Šå¯ä»¥çœ‹åˆ°å®ƒè·Ÿè½¯é“¾æ¥ä¸€æ ·ï¼Œæ–‡ä»¶å›¾æ ‡ä¸Šéƒ½æœ‰ä¸€ä¸ªç®­å¤´å›¾æ¡ˆã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4c1b25169ae8164b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>å…­ã€åº”ç”¨åœºæ™¯</h2>
<p>æ€»ç»“ä¸€ä¸‹è½¯é“¾æ¥ã€ç¡¬é“¾æ¥çš„ç‰¹ç‚¹ï¼š</p>
<p><strong>å…±åŒç‚¹</strong></p>
<blockquote>
<ul>
<li>åˆ›å»ºè½¯é“¾æ¥æˆ–ç¡¬é“¾æ¥ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–‡ä»¶å‰¯æœ¬ã€‚</li>
<li>åˆ é™¤ç¡¬é“¾æ¥æˆ–è½¯é“¾æ¥ï¼Œéƒ½ä¸ä¼šå¯¹åŸå§‹æ–‡ä»¶äº§ç”Ÿå½±å“ã€‚</li>
<li>å¯¹ç¡¬é“¾æ¥æˆ–è½¯é“¾æ¥çš„æ–‡ä»¶å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œå®è´¨ä¸Šéƒ½æ˜¯åœ¨æ“ä½œåŸå§‹æ–‡ä»¶çš„å†…å®¹ã€‚å› æ­¤ä¿®æ”¹ä»»æ„ä¸€ä¸ªï¼Œå…¶ä»–éƒ½ä¼šåŒæ­¥å—å½±å“ã€‚</li>
</ul>
</blockquote>
<p><strong>ä¸åŒç‚¹</strong></p>
<blockquote>
<ul>
<li>ç¡¬é“¾æ¥æ— æ³•é“¾æ¥ç›®å½•ï¼Œè½¯é“¾æ¥æ˜¯å¯ä»¥çš„ã€‚</li>
<li>ç¡¬é“¾æ¥æ— æ³•è·¨æ–‡ä»¶ç³»ç»Ÿï¼Œè½¯é“¾æ¥æ˜¯å¯ä»¥çš„ã€‚</li>
<li>åˆ é™¤æˆ–ç§»åŠ¨åŸå§‹æ–‡ä»¶ï¼Œå¯¹ç¡¬é“¾æ¥ä¸ä¼šäº§ç”Ÿå½±å“ï¼Œä½†é€šè¿‡è½¯é“¾æ¥å†ä¹Ÿæ— æ³•è®¿é—®åˆ°åŸå§‹æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>é‡å‘½ååŸå§‹æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šåªæ˜¯ä¿®æ”¹äº†æ–‡ä»¶è·¯å¾„ï¼Œå¯¹ inode æ— å½±å“ï¼Œè‡ªç„¶å°±ä¸ä¼šå½±å“åˆ°ç¡¬é“¾æ¥ï¼Œä½†è½¯é“¾æ¥å°±æ— æ³•è®¿é—®åˆ°åŸå§‹æ–‡ä»¶äº†ã€‚</li>
<li>åˆ›å»ºç¡¬é“¾æ¥ä¸å ç”¨ç¡¬ç›˜ç©ºé—´ï¼Œè€Œåˆ›å»ºè½¯é“¾æ¥ä¼šå ç”¨ä¸€ç‚¹ç‚¹çš„ç¡¬ç›˜ç©ºé—´ï¼ˆéœ€å­˜å‚¨ inode ä¿¡æ¯å’Œæ–‡ä»¶å†…å®¹ï¼‰ã€‚</li>
<li>ä»è§†è§‰è§’åº¦æ¥çœ‹ï¼Œè½¯é“¾æ¥çš„æ–‡ä»¶å›¾æ ‡æœ‰ä¸€ä¸ªç®­å¤´å›¾æ¡ˆï¼ˆä¸åŒæ“ä½œç³»ç»Ÿå¯èƒ½ç•¥æœ‰å·®åˆ«ï¼‰ï¼Œè€Œç¡¬é“¾æ¥è·Ÿæ™®é€šæ–‡ä»¶ä¸€æ ·ï¼Œå¦‚æœä¸é€šè¿‡æ–‡ä»¶åç§°æ— æ³•åŒºåˆ†æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç¡¬é“¾æ¥æ–‡ä»¶ã€‚</li>
</ul>
</blockquote>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<p>åœ¨å‰ç«¯é¢†åŸŸä¹Ÿå¹¿æ³›ä½¿ç”¨äº†è½¯é“¾æ¥ã€ç¡¬é“¾æ¥ï¼Œæ¯”å¦‚ npm CLIã€npm linkã€pnpm ç­‰å·¥å…·ã€‚</p>
<p>ä»¥ pnpm ä¸ºä¾‹ï¼Œé€šè¿‡ <code>pnpm install</code> å‘½ä»¤å®‰è£…çš„ä¾èµ–åŒ…éƒ½å°†å­˜å‚¨åœ¨ <code>~/Library/pnpm/store</code> ç›®å½•ä¸‹ ï¼ˆ7.x ç‰ˆæœ¬ä¹‹å‰å…¨å±€ç›®å½•æ˜¯ <code>~/.pnpm_store</code>ï¼Œè¯¦è§ <a href="https://github.com/pnpm/pnpm/issues/2574">#2574</a>ï¼‰ ã€‚å‡è®¾é¡¹ç›®ä¸­å®‰è£…äº† jest ä¾èµ–åŒ…ï¼Œä¼šäº§ç”Ÿè¿™æ ·ä¸¤ä¸ªç›®å½•ï¼š</p>
<pre><code class="language-text">./node_modules/jest
./node_modules/.pnpm/jest@28.1.2/node_modules/jest
</code></pre>
<p>ç¬¬ä¸€ä¸ªç›®å½•æ˜¯ç¬¬äºŒä¸ªç›®å½•çš„è½¯é“¾æ¥ï¼ŒNode æŸ¥æ‰¾ <code>jest</code> ä¾èµ–ä¼šæ‰¾åˆ° <code>./node_modules/jest</code>ï¼Œç”±äºå®ƒæ˜¯è½¯é“¾æ¥ï¼Œç³»ç»Ÿæ ¹æ®å…¶æ–‡ä»¶å†…å®¹çš„è·¯å¾„æ‰¾åˆ°äº† <code>./node_modules/.pnpm/jest@28.1.2/node_modules/jest</code> ç›®å½•ï¼Œè¯¥ç›®å½•é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å…¨å±€ä¾èµ–ç›®å½•ä¸‹ç›¸å…³æ–‡ä»¶çš„ç¡¬é“¾æ¥ã€‚pnpm åˆ©ç”¨è½¯é“¾æ¥æ„å»ºå‡ºæ›´å¹²å‡€çš„ <code>node_modules</code> ç›®å½•ï¼Œä¸å†åƒ npm/yarn é‚£æ ·çš„æ‰å¹³åŒ–ç»“æ„ï¼Œä¹Ÿè§£å†³äº†ã€Œå¹½çµä¾èµ–ã€çš„é—®é¢˜ã€‚è€Œä¸” <code>node_modules/.pnpm</code> ä¸‹ä½¿ç”¨äº†ç¡¬é“¾æ¥å¯ä»¥èŠ‚çœå¤§é‡çš„ç¡¬ç›˜ç©ºé—´ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå¾ˆå¤š...</p>
<p>æ¯”å¦‚ Windows çš„å¿«æ·æ–¹å¼ã€Finder çš„ä¾§è¾¹æ ç­‰ã€‚å¯¹äºä¸€äº›è·¯å¾„å±‚çº§ç‰¹åˆ«æ·±çš„æ–‡ä»¶ï¼Œå¿«æ·æ–¹å¼æ˜¯ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„æ–¹æ³•ã€‚è¿˜æœ‰ï¼Œä½ å¥³æœ‹å‹åœ¨æ¡Œé¢åˆ æ‰çš„åªæ˜¯è½¯é“¾æ¥è€Œå·²ï¼Œå¯¹åŸå§‹æ–‡ä»¶æ¯«æ— å½±å“...</p>
<p>æ¯”å¦‚ç…§ç‰‡åˆ†ç±»ã€‚å‡è®¾æˆ‘ä»¬çš„ç¡¬ç›˜é‡Œå­˜å‚¨äº† 10GB çš„ç…§ç‰‡ï¼Œå¦‚æœæƒ³è¦æŒ‰æ‹æ‘„æ—¶é—´ã€æ‹æ‘„åœ°ç‚¹ã€å›¾ç‰‡ç±»å‹ç­‰æ–¹å¼åˆ†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¡¬é“¾æ¥çš„ç‰¹ç‚¹ï¼Œåœ¨å…¶ä»–ç›®å½•åˆ›å»ºå›¾ç‰‡æ–‡ä»¶çš„ç¡¬é“¾æ¥è¿›è¡Œåˆ†ç±»ï¼Œæœ€é‡è¦çš„æ˜¯å®ƒä»¬åªä¼šå ç”¨ä¸€ä»½ç¡¬ç›˜ç©ºé—´ã€‚</p>
<p>æ¯”å¦‚æ–‡ä»¶å…±äº«ã€‚å‡è®¾å¤šäººå¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œç»´æŠ¤çš„æ—¶å€™ï¼Œæ¯ä¸ªäººå¯ä»¥åœ¨ç§äººç›®å½•ä¸‹åˆ›å»ºè¯¥æ–‡ä»¶çš„ç¡¬é“¾æ¥ï¼Œå®ƒçš„æ‰€æœ‰ä¿®æ”¹éƒ½ä¼šåŒæ­¥åˆ°åŸå§‹æ–‡ä»¶ä¸­ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå³ä½¿æŸäººä¸æ…è¯¯åˆ äº†æ–‡ä»¶ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ–‡ä»¶ã€‚</p>
<p>æ¯”å¦‚æ–‡ä»¶å¤‡ä»½ã€‚æœ€åŸå§‹çš„æ–¹å¼åº”è¯¥æ˜¯ä¿®æ”¹å®Œç›®æ ‡æ–‡ä»¶åï¼Œç„¶åæ‹·è´ä¸€ä»½è‡³å­˜æ¡£ç›®å½•ã€‚è¿™ç§æ–¹å¼é™¤äº†éº»çƒ¦ï¼Œè¿˜ä¼šå ç”¨ä¸¤ä»½åŒç­‰å¤§å°çš„ç¡¬ç›˜ç©ºé—´ã€‚åˆ©ç”¨ç¡¬é“¾æ¥çš„ç‰¹ç‚¹å°±å¯ä»¥è½»æ¾è§£å†³ï¼Œè¾¾åˆ°ä»…å ç”¨ä¸€ä»½ç¡¬ç›˜ç©ºé—´ï¼ŒåŒæ­¥ä¿®æ”¹çš„æ•ˆæœã€‚</p>
<h2>ä¸ƒã€å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="https://www.ruanyifeng.com/blog/2011/12/inode.html">ç†è§£ inode</a></li>
<li><a href="https://www.cnblogs.com/bellkosmos/p/detail_of_linux_file_system.html">Linux æ–‡ä»¶ç³»ç»Ÿè¯¦è§£</a></li>
<li><a href="https://blog.csdn.net/woodpeck/article/details/78761219">ã€Œå¤åˆ¶ã€æ‹·è´ã€æ›¿èº«ã€è½¯è¿æ¥ã€ç¡¬è¿æ¥ã€åŒºåˆ«è¯¦è§£</a></li>
<li><a href="https://apple.stackexchange.com/questions/2991/whats-the-difference-between-alias-and-link">What's the difference between alias and link?</a></li>
<li><a href="https://forums.macrumors.com/threads/symbolic-link-vs-alias.972404/post-10599979">Symbolic Link vs Alias</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Linux æ–‡ä»¶æƒé™è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/35</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/35</guid>
            <pubDate>Sat, 25 Feb 2023 11:08:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c27a89926d8748ca.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c27a89926d8748ca.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œåº”å…ˆäº†è§£æ–‡ä»¶æƒé™æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›æƒé™ï¼Ÿ</p>
<pre><code class="language-shell">$ tree .
.
â”œâ”€â”€ README.md
â”œâ”€â”€ package.json
â””â”€â”€ src

1 directory, 2 files
</code></pre>
<p>ä»¥ä¸Šæœ‰ä¸€ä¸ªç›®å½•å’Œä¸¤ä¸ªæ–‡ä»¶ã€‚ç„¶åé€šè¿‡ <code>ls -l</code> å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„å…·ä½“å±æ€§ï¼š</p>
<pre><code class="language-shell">$ ls -l
total 8
-rw-r--r--  1 frankie  staff   0  7  3 00:18 README.md
-rw-r--r--  1 frankie  staff  90  7  2 22:42 package.json
drwxr-xr-x  2 frankie  staff  64  7  2 22:42 src
</code></pre>
<p>ä»¥ <code>package.json</code> æ–‡ä»¶ä¸ºä¾‹ï¼Œ</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e5be7e4f6c26e8db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å…¶ä¸­ <code>-rw-r--r--</code> é¦–ä¸ªå­—ç¬¦ <code>-</code> è¡¨ç¤ºã€Œæ–‡ä»¶ç±»å‹ã€ï¼Œåé¢çš„ä¹ä½å­—ç¬¦ <code>rw-r--r--</code> è¡¨ç¤ºã€Œæ–‡ä»¶æƒé™ã€ã€‚</p>
</blockquote>
<p>ã€Œæ–‡ä»¶ç±»å‹ã€ç”¨äºè¡¨æ˜å®ƒæ˜¯æ–‡ä»¶ã€é“¾æ¥æ–‡ä»¶æˆ–è€…ç›®å½•ç­‰ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<blockquote>
<ul>
<li>è‹¥ä¸º <code>d</code> åˆ™æ˜¯ç›®å½•ï¼›</li>
<li>è‹¥ä¸º <code>-</code> åˆ™æ˜¯æ–‡ä»¶ï¼›</li>
<li>è‹¥ä¸º <code>l</code> åˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡ä»¶ï¼ˆlink fileï¼‰ï¼›</li>
<li>è‹¥ä¸º <code>b</code> åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„å¯ä¾›å‚¨å­˜çš„æ¥å£è®¾å¤‡ï¼ˆå¯éšæœºå­˜å–è£…ç½®ï¼‰ï¼›</li>
<li>è‹¥ä¸º <code>c</code> åˆ™è¡¨ç¤ºä¸ºè£…ç½®æ–‡ä»¶é‡Œé¢çš„ä¸²è¡Œç«¯å£è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ï¼ˆä¸€æ¬¡æ€§è¯»å–è£…ç½®ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>ã€Œæ–‡ä»¶æƒé™ã€åˆ†ä¸ºä¸‰ç§èº«ä»½ï¼Œåˆ†åˆ«ä¸ºæ–‡ä»¶æ‰€æœ‰è€…æƒé™ï¼ˆownerï¼‰ã€æ–‡ä»¶æ‰€åœ¨ç¾¤ç»„æƒé™ï¼ˆgroupï¼‰ã€å…¶ä»–ç”¨æˆ·æƒé™ï¼ˆothersï¼‰ã€‚æ¯ä¸€ç§èº«ä»½éƒ½æœ‰å„è‡ªçš„è¯»å†™æ‰§è¡Œæƒé™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–‡ä»¶åªèƒ½å½’å±äºä¸€ä¸ªç”¨æˆ·å’Œç¾¤ç»„ï¼Œå¦‚æœå…¶ä»–ç”¨æˆ·æƒ³æ‹¥æœ‰æ­¤æ–‡ä»¶çš„æƒé™ï¼Œå¯ä»¥å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°å…·æœ‰æƒé™çš„ç¾¤ç»„ï¼Œä¸€ä¸ªç”¨æˆ·å¯åŒæ—¶å½’å±äºå¤šä¸ªç¾¤ç»„ã€‚</p>
<p>æ¯ç§èº«ä»½åŒ…æ‹¬è¯»å†™å’Œæ‰§è¡Œæƒé™ï¼Œå…¶ä¸­ <code>r</code> è¡¨ç¤ºè¯»æƒé™ï¼ˆreadï¼‰ï¼Œ<code>w</code> è¡¨ç¤ºå†™æƒé™ï¼ˆwriteï¼‰ï¼Œ<code>x</code> è¡¨ç¤ºæ‰§è¡Œæƒé™ï¼ˆexecuteï¼‰ï¼Œ<code>-</code> è¡¨ç¤ºæ— å¯¹åº”æƒé™ã€‚é™¤äº†ç”¨ <code>rwx-</code> å½¢å¼ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶æ•°æ¨¡å¼æ¥è¡¨ç¤ºï¼Œå¯¹åº”å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å…«è¿›åˆ¶å€¼</th>
<th>æ–‡ä»¶æƒé™</th>
<th>æƒé™è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>---</td>
<td>æ— ä»»ä½•æƒé™</td>
</tr>
<tr>
<td>1</td>
<td>--x</td>
<td>ä»…æ‰§è¡Œæƒé™</td>
</tr>
<tr>
<td>2</td>
<td>-w-</td>
<td>ä»…å†™æƒé™</td>
</tr>
<tr>
<td>3</td>
<td>-wx</td>
<td>æœ‰å†™å’Œæ‰§è¡Œæƒé™</td>
</tr>
<tr>
<td>4</td>
<td>r--</td>
<td>åªè¯»æƒé™</td>
</tr>
<tr>
<td>5</td>
<td>r-x</td>
<td>è¯»å’Œæ‰§è¡Œæƒé™</td>
</tr>
<tr>
<td>6</td>
<td>rw-</td>
<td>è¯»å†™æƒé™</td>
</tr>
<tr>
<td>7</td>
<td>rwx</td>
<td>è¯»å†™å’Œæ‰§è¡Œæƒé™</td>
</tr>
</tbody>
</table>
<p>æ¯ç§èº«ä»½çš„æƒé™æ•°å­—ä¸º <code>rwx</code> çš„ç´¯åŠ å¾—å‡ºæ¥çš„ã€‚æ¯”å¦‚ï¼Œå‰é¢ <code>package.json</code> çš„æƒé™ä¸º <code>-rw-r--r--</code>ï¼Œè¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…æƒé™ä¸º <code>rw-</code>ï¼ˆ4+2+0ï¼‰ï¼Œæ–‡ä»¶æ‰€åœ¨ç¾¤ç»„æƒé™ä¸º <code>r--</code>ï¼ˆ4+0+0ï¼‰ï¼Œå…¶ä»–ç”¨æˆ·æƒé™ä¸º <code>r--</code>ï¼ˆ4+0+0ï¼‰ï¼Œå› æ­¤è¯¥æ–‡ä»¶çš„æƒé™æ•°å­—ä¸º <code>0o644</code>ã€‚</p>
<p>æˆ‘ä»¬å¸¸ç”¨ <code>chmod</code> å‘½ä»¤æ¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ chmod 755 ./src/bin/test.js
</code></pre>
<p>ä»¥ä¸Šçš„ <code>755</code> å°±æ˜¯è¡¨ç¤ºæƒé™æ•°å­—ï¼Œè¯¥æ–‡ä»¶çš„æƒé™å°†è¢«æ”¹å†™ä¸º <code>rwxrw-rw-</code>ï¼Œå³æ‰€æœ‰è€…å¯è¯»å†™å¯æ‰§è¡Œï¼Œæ‰€åœ¨ç¾¤ç»„å¯è¯»ï¼Œå…¶ä»–ç”¨æˆ·å¯è¯»ã€‚</p>
<p>é™¤äº†æ•°å­—æ–¹å¼ï¼Œè¿˜å¯ä»¥é€šè¿‡å­—ç¬¦æ–¹å¼ä¿®æ”¹æ–‡ä»¶æƒé™ã€‚å½¢å¼å¦‚ï¼š</p>
<pre><code class="language-shell">$ chmod who+operator+permissions &lt;file&gt;
</code></pre>
<p>å…¶ä¸­ <code>who</code> è¡¨ç¤ºè¦æ›´æ”¹æƒé™çš„ç”¨æˆ·ï¼Œ<code>operator</code> è¡¨ç¤ºè¦æ‰§è¡Œçš„æ“ä½œï¼Œ<code>permissions</code> è¡¨ç¤ºè¦æ›´æ”¹çš„æƒé™ã€‚</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>u</td>
<td>who</td>
<td>æ–‡ä»¶æ‰€æœ‰è€…</td>
</tr>
<tr>
<td>g</td>
<td>who</td>
<td>æ–‡ä»¶æ‰€åœ¨ç¾¤ç»„</td>
</tr>
<tr>
<td>o</td>
<td>who</td>
<td>å…¶ä»–ç”¨æˆ·</td>
</tr>
<tr>
<td>a</td>
<td>who</td>
<td>æ‰€æœ‰ç”¨æˆ·</td>
</tr>
<tr>
<td>ğŸ‘»</td>
<td></td>
<td></td>
</tr>
<tr>
<td>=</td>
<td>operator</td>
<td>èµ‹å€¼</td>
</tr>
<tr>
<td>+</td>
<td>operator</td>
<td>æ·»åŠ </td>
</tr>
<tr>
<td>-</td>
<td>operator</td>
<td>åˆ é™¤</td>
</tr>
<tr>
<td>ğŸ‘»</td>
<td></td>
<td></td>
</tr>
<tr>
<td>r</td>
<td>permissions</td>
<td>è¯»æƒé™</td>
</tr>
<tr>
<td>w</td>
<td>permissions</td>
<td>å†™æƒé™</td>
</tr>
<tr>
<td>x</td>
<td>permissions</td>
<td>æ‰§è¡Œæƒé™</td>
</tr>
</tbody>
</table>
<p>å› æ­¤ï¼Œ</p>
<pre><code class="language-shell">$ chmod 755 ./src/bin/test.js

# ç›¸å½“äº
$ chmod u=rwx,g=rw,o=rw ./src/bin/test.js

# ä¹Ÿå¯å¯¹æ¯ç§ç”¨æˆ·åˆ†åˆ«è®¾ç½®
$ chmod u=rwx ./src/bin/test.js
$ chmod g=rw ./src/bin/test.js
$ chmod o=rw ./src/bin/test.js
</code></pre>
<p>é™¤äº†å¸¸è§çš„ r/w/x æƒé™ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šæƒé™ï¼šSUIDã€SGID å’Œ SBITï¼Œè¿™é‡Œä¸åšå±•å¼€ï¼Œæœ‰å…´è¶£è‡ªè¡ŒæŸ¥é˜…ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Shell è„šæœ¬å­¦ä¹ ]]></title>
            <link>https://github.com/toFrankie/blog/issues/34</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/34</guid>
            <pubDate>Sat, 25 Feb 2023 11:07:53 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b91bea2d2e2954b0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b91bea2d2e2954b0.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h4>å‰è¨€</h4>
<p>è™½ç„¶ä¸€ç›´éƒ½åœ¨ç”¨ï¼Œä½†æœ‰äº›å‘½ä»¤ä»æ˜¯åŠçŸ¥åŠæ‡‚çš„ï¼Œæ‰€ä»¥å°±å¥½å¥½å­¦ä¸€ä¸‹å§ã€‚</p>
<p>ä¸€äº›è¾…åŠ©å·¥å…·ï¼š</p>
<blockquote>
<ul>
<li><a href="https://github.com/koalaman/shellcheck">shellcheck</a> - Shell è„šæœ¬é™æ€æ£€æŸ¥å·¥å…·ï¼Œä¸»æµç¼–è¾‘å™¨éƒ½æœ‰æ’ä»¶ã€‚ç±»ä¼¼ ESLint çš„å·¥å…·ã€‚</li>
<li><a href="https://github.com/google/zx">zx</a> - Google å‡ºå“ï¼Œç”¨ JavaScript å†™ Shell è„šæœ¬ã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ªé˜®ä¸€å³°è€å¸ˆçš„ <a href="https://wangdoc.com/bash/index.html">Bash è„šæœ¬æ•™ç¨‹</a>ã€‚</p>
</blockquote>
<h4>ä¸€ã€Shell å‘½ä»¤æ ¼å¼</h4>
<pre><code class="language-shell">$ command [ arg1 ... [ argN ] ]
</code></pre>
<p>å…¶ä¸­ <code>command</code> æ˜¯ä¸€ä¸ªå…·ä½“çš„å‘½ä»¤æˆ–è€…ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>arg1... argN</code> æ˜¯ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°ï¼Œæ˜¯å¯é€‰çš„ã€‚</p>
<p>å‘½ä»¤ä¸å‚æ•°ï¼Œå‚æ•°ä¸å‚æ•°ä¹‹é—´é€šè¿‡ã€Œä¸€ä¸ªç©ºæ ¼ã€éš”å¼€ã€‚è‹¥æœ‰ã€Œå¤šä¸ªç©ºæ ¼ã€ï¼Œå¤šä½™ç©ºæ ¼ä¼šè¢«è‡ªåŠ¨å¿½ç•¥ï¼Œä½œç”¨ç›¸å½“äºä¸€ä¸ªç©ºæ ¼ã€‚</p>
<pre><code class="language-shell">$ ls -l
</code></pre>
<p>å…¶ä¸­ <code>ls</code> æ˜¯å‘½ä»¤ï¼Œ<code>-l</code> æ˜¯å‚æ•°ã€‚æœ‰äº›å‚æ•°æ˜¯å‘½ä»¤çš„é…ç½®é¡¹ï¼Œå®ƒä»¬ä¸€èˆ¬ä»¥ä¸€ä¸ªã€ŒçŸ­æ¨ªçº¿ã€å¼€å¤´ï¼Œæ¯”å¦‚ä¸Šé¢çš„ <code>-l</code>ã€‚é€šå¸¸é…ç½®é¡¹å‚æ•°æœ‰çŸ­å½¢å¼å’Œé•¿å½¢å¼ä¸¤ç§å½¢å¼ï¼Œæ¯”å¦‚ <code>-l</code> æ˜¯çŸ­å½¢å¼ï¼Œ<code>--list</code> æ˜¯é•¿å½¢å¼ã€‚ä¸¤ç§å†™æ³•ä½œç”¨å®Œå…¨ç›¸åŒï¼ŒçŸ­å½¢å¼ä¾¿äºè¾“å…¥ï¼Œé•¿å½¢å¼å¯è¯»æ€§ã€è¯­ä¹‰æ›´å¥½ã€‚</p>
<p>é€šå¸¸å‘½ä»¤éƒ½æ˜¯ä¸€è¡Œçš„ï¼Œå¯æœ‰äº›å‘½ä»¤è¾ƒé•¿ï¼Œå†™æˆå¤šè¡Œæœ‰åˆ©äºé˜…è¯»å’Œç¼–è¾‘ï¼Œåªè¦åœ¨æ¯è¡Œç»“å°¾å¤„åŠ ä¸Šåæ–œæ  <code>\</code> å¯ä»¥ï¼ŒShell ä¼šå°†ä¸‹ä¸€è¡Œè·Ÿå½“å‰è¡Œä¸€èµ·è§£æã€‚</p>
<pre><code class="language-shell">$ echo Hello World

# ç­‰åŒäº
$ echo Hello \
World
</code></pre>
<h4>äºŒã€å‘½ä»¤çš„ç»„åˆä¸ç»§å‘</h4>
<p>å‘½ä»¤ç»„åˆç¬¦ <code>&amp;&amp;</code>ï¼Œå‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ‰ä¼šæ¥ç€æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ command1 &amp;&amp; command2
</code></pre>
<p>å‘½ä»¤ç»„åˆç¬¦ <code>||</code>ï¼Œå‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œæ‰ä¼šæ¥ç€æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ command1 || command2
</code></pre>
<p>å‘½ä»¤ç»“æŸç¬¦ <code>;</code>ï¼ˆåˆ†å·ï¼‰ï¼Œå‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œç»“æŸåï¼ˆæ— è®ºæˆåŠŸä¸å¦ï¼‰ï¼Œæ¥ç€æ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤ã€‚å‘½ä»¤ç»“æŸç¬¦å¯ä½¿å¾—ä¸€è¡Œä¸­æ”¾ç½®å¤šä¸ªå‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ clear; ls
</code></pre>
<p>ç®¡é“ç¬¦ <code>|</code>ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºç¬¬äºŒä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚</p>
<pre><code class="language-shell">$ command1 | command2

# ç›¸å½“äº
$ command1 &gt; tempfile
$ command2 &lt; tempfile
$ rm tempfile
</code></pre>
<h4>ä¸‰ã€å¼•å·</h4>
<blockquote>
<ul>
<li><strong>å•å¼•å·</strong>ï¼šå•å¼•å·ç”¨äºä¿ç•™å­—ç¬¦çš„å­—é¢å«ä¹‰ï¼Œå„ç§ç‰¹æ®Šå­—ç¬¦åœ¨å•å¼•å·é‡Œé¢ï¼Œéƒ½ä¼šå˜ä¸ºæ™®é€šå­—ç¬¦ã€‚</li>
<li><strong>åŒå¼•å·</strong>ï¼šæ¯”å•å¼•å·å®½æ¾ï¼Œå¤§éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦åœ¨åŒå¼•å·é‡Œé¢ï¼Œéƒ½ä¼šå¤±å»ç‰¹æ®Šå«ä¹‰ï¼Œå˜æˆæ™®é€šå­—ç¬¦ã€‚ä½†æ˜¯ï¼Œä¸‰ä¸ªç‰¹æ®Šå­—ç¬¦é™¤å¤–ï¼šç¾å…ƒç¬¦å·ï¼ˆ<code>$</code>ï¼‰ã€åå¼•å·ï¼ˆ<code>`</code>ï¼‰å’Œåæ–œæ ï¼ˆ<code>\</code>ï¼‰ã€‚è¿™ä¸‰ä¸ªå­—ç¬¦åœ¨åŒå¼•å·ä¹‹ä¸­ï¼Œä¾ç„¶æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œä¼šè¢« Bash è‡ªåŠ¨æ‰©å±•ã€‚</li>
</ul>
</blockquote>
<pre><code class="language-shell">$ echo '$USER'
$USER

$ echo &quot;$USER&quot;
frankie
</code></pre>
<p>æ¢è¡Œç¬¦åœ¨åŒå¼•å·ä¹‹ä¸­ï¼Œä¼šå¤±å»ç‰¹æ®Šå«ä¹‰ï¼ŒBash ä¸å†å°†å…¶è§£é‡Šä¸ºå‘½ä»¤çš„ç»“æŸï¼Œåªæ˜¯ä½œä¸ºæ™®é€šçš„æ¢è¡Œç¬¦ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨åŒå¼•å·ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥å¤šè¡Œæ–‡æœ¬ã€‚</p>
<pre><code class="language-shell">$ echo &quot;hello
world&quot;

hello
world
</code></pre>
<p><code>echo</code> å‘éŸ³ [ËˆekÅ]ï¼ˆæ‰å‘ç°åŸæ¥ä¸€ç›´è¯»é”™äº†ï¼Œæƒ­æ„§ï¼‰ã€‚å…¶å‚æ•° <code>-e</code> ä¼šè§£æå¼•å·ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚æ¢è¡Œç¬¦ <code>\n</code>ï¼‰ã€‚è‹¥åœ¨ CLI ä¸­ç›´æ¥è¾“å…¥ <code>echo</code> å‘½ä»¤ <code>\n</code> ä¹Ÿä¼šè§£æä¸ºæ¢è¡Œç¬¦ï¼Œè€Œä¸æ˜¯æ™®é€šçš„ <code>\n</code> å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-shell">$ echo -e &quot;Hello\nShell&quot;
Hello
Shell
</code></pre>
<h4>å››ã€å­å‘½ä»¤æ‰©å±•</h4>
<p><code>$(...)</code> å¯ä»¥æ‰©å±•æˆå¦ä¸€ä¸ªå‘½ä»¤çš„è¿è¡Œç»“æœï¼Œè¯¥å‘½ä»¤çš„æ‰€æœ‰è¾“å‡ºéƒ½ä¼šä½œä¸ºè¿”å›å€¼ã€‚è¿˜æœ‰å¦ä¸€ç§è¾ƒè€çš„è¯­æ³•ï¼Œå­å‘½ä»¤æ”¾åœ¨åå¼•å·ä¹‹ä¸­ï¼Œä¹Ÿå¯ä»¥æ‰©å±•æˆå‘½ä»¤çš„è¿è¡Œç»“æœã€‚</p>
<pre><code class="language-shell">$ echo $(date) 
2022å¹´ 6æœˆ27æ—¥ æ˜ŸæœŸä¸€ 00æ—¶31åˆ†14ç§’ CST

$ echo `date`
2022å¹´ 6æœˆ27æ—¥ æ˜ŸæœŸä¸€ 00æ—¶32åˆ†01ç§’ CST
</code></pre>
<h4>äº”ã€è¯»å–å˜é‡</h4>
<ul>
<li>åœ¨å˜é‡åå‰åŠ ä¸Š <code>$</code>ï¼Œæ¯”å¦‚ <code>$SHELL</code>ã€‚</li>
<li>è¯»å–å˜é‡æ—¶ï¼Œå˜é‡åå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å· <code>{}</code> åŒ…å›´ï¼Œæ¯”å¦‚ <code>$SHELL</code> å¯ä»¥å†™æˆ <code>${SHELL}</code>ã€‚</li>
<li>å¦‚æœå˜é‡çš„å€¼æœ¬èº«ä¹Ÿæ˜¯å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>${!varname}</code> è¯­æ³•ï¼Œè¯»å–æœ€ç»ˆçš„å€¼ã€‚ï¼ˆå¥½åƒä¸å¤ªå¯¹ï¼Œå¾…è¿›ä¸€æ­¥éªŒè¯ï¼‰</li>
</ul>
<h4>å…­ã€ç®—æœ¯è¿ç®—</h4>
<ul>
<li>é™¤æ³•è¿ç®—ç¬¦çš„è¿”å›ç»“æœæ€»æ˜¯ä¸ºã€Œæ•´æ•°ã€ï¼Œæ¯”å¦‚ <code>$(( 5 / 2 ))</code> çš„ç»“æœä¸º <code>2</code>ï¼Œè€Œä¸æ˜¯ <code>2.5</code>ã€‚</li>
<li><code>$(( ... ))</code> çš„åœ†æ‹¬å·ä¹‹ä¸­ï¼Œä¸éœ€è¦åœ¨å˜é‡åä¹‹å‰åŠ ä¸Š <code>$</code>ï¼Œä¸è¿‡åŠ ä¸Šä¹Ÿä¸æŠ¥é”™ã€‚</li>
<li>å¦‚æœ <code>$((...))</code> é‡Œé¢ä½¿ç”¨ä¸å­˜åœ¨çš„å˜é‡ï¼Œä¹Ÿä¼šå½“ä½œ <code>0</code> å¤„ç†ã€‚</li>
<li><code>$[...]</code> æ˜¯ä»¥å‰çš„è¯­æ³•ï¼Œä¹Ÿå¯ä»¥åšæ•´æ•°è¿ç®—ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</li>
</ul>
<p>å°æ•°è¿ç®—ï¼Œéœ€å€ŸåŠ© <code>bc</code> å‘½ä»¤ï¼Œå…¶ä¸­ <code>scale</code> è¡¨ç¤ºå°æ•°ä½ï¼Œ<code>ibase</code> å’Œ <code>obase</code> è¿›è¡Œå…¶ä»–è¿›åˆ¶æ•°è¿ç®—ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ var1=3
$ var2=6  
$ result=$(echo &quot;scale=2; $var1 / $var2&quot; | bc) 
$ echo $result 
.50
</code></pre>
<h4>ä¸ƒã€ç›®å½•å †æ ˆ</h4>
<p><code>cd -</code> å‘½ä»¤å¯ä»¥è¿”å›å‰ä¸€æ¬¡çš„ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè®°å½•ä¸Šä¸€æ¬¡æ‰€åœ¨çš„ç›®å½•ã€‚</p>
<pre><code class="language-shell">$ cd ~/Desktop/
$ cd -
~
</code></pre>
<h4>å…«ã€è„šæœ¬</h4>
<p><strong>8.1 Shebang è¡Œ</strong></p>
<p>è„šæœ¬çš„ç¬¬ä¸€è¡Œé€šå¸¸æ˜¯æŒ‡å®šè§£é‡Šå™¨ï¼Œå³è¿™ä¸ªè„šæœ¬å¿…é¡»é€šè¿‡ä»€ä¹ˆè§£é‡Šå™¨æ‰§è¡Œã€‚è¿™ä¸€è¡Œä»¥ <code>#!</code> å­—ç¬¦å¼€å¤´ï¼Œè¿™ä¸ªå­—ç¬¦ç§°ä¸º Shebangï¼Œæ‰€ä»¥è¿™ä¸€è¡Œå°±å«åš Shebang è¡Œã€‚</p>
<p><code>#!</code> åé¢å°±æ˜¯è„šæœ¬è§£é‡Šå™¨çš„ä½ç½®ï¼ŒBash è„šæœ¬çš„è§£é‡Šå™¨ä¸€èˆ¬æ˜¯ <code>/bin/sh</code> æˆ– <code>/bin/bash</code>ã€‚</p>
<pre><code class="language-shell">#!/bin/sh

# æˆ–è€…
#!/bin/bash
</code></pre>
<p><code>#!</code> ä¸è„šæœ¬è§£é‡Šå™¨ä¹‹é—´æœ‰æ²¡æœ‰ç©ºæ ¼ï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<p>å¦‚æœ Bash è§£é‡Šå™¨ä¸æ”¾åœ¨ç›®å½• <code>/bin</code>ï¼Œè„šæœ¬å°±æ— æ³•æ‰§è¡Œäº†ã€‚ä¸ºäº†ä¿é™©ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚</p>
<pre><code class="language-shell">#!/usr/bin/env bash
</code></pre>
<p>ä¸Šé¢å‘½ä»¤ä½¿ç”¨ <code>env</code> å‘½ä»¤ï¼ˆè¿™ä¸ªå‘½ä»¤æ€»æ˜¯åœ¨ <code>/usr/bin</code> ç›®å½•ï¼‰ï¼Œè¿”å› Bash å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ã€‚<code>env</code> å‘½ä»¤çš„è¯¦ç»†ä»‹ç»ï¼Œè¯·çœ‹åæ–‡ã€‚</p>
<blockquote>
<p>Shebang è¡Œä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å»ºè®®åŠ ä¸Šè¿™è¡Œã€‚å¦‚æœç¼ºå°‘è¯¥è¡Œï¼Œå°±éœ€è¦æ‰‹åŠ¨å°†è„šæœ¬ä¼ ç»™è§£é‡Šå™¨ã€‚</p>
</blockquote>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œè„šæœ¬æ˜¯ <code>script.sh</code>ï¼Œæœ‰ Shebang è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æ‰§è¡Œã€‚</p>
<pre><code class="language-shell">$ ./script.sh
</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œ<code>script.sh</code> æ˜¯è„šæœ¬æ–‡ä»¶åã€‚è„šæœ¬é€šå¸¸ä½¿ç”¨ <code>.sh</code> åç¼€åï¼Œä¸è¿‡è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ Shebang è¡Œï¼Œå°±åªèƒ½æ‰‹åŠ¨å°†è„šæœ¬ä¼ ç»™è§£é‡Šå™¨æ¥æ‰§è¡Œã€‚</p>
<pre><code class="language-shell">$ /bin/sh ./script.sh

# æˆ–è€…
$ bash ./script.sh
</code></pre>
<p><strong>8.2 æ‰§è¡Œæƒé™å’Œè·¯å¾„</strong></p>
<p>å‰é¢è¯´è¿‡ï¼Œåªè¦æŒ‡å®šäº† Shebang è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚è¿™æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯è„šæœ¬éœ€è¦æœ‰æ‰§è¡Œæƒé™ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œèµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ã€‚</p>
<p>ç»™æ‰€æœ‰ç”¨æˆ·æ‰§è¡Œæƒé™</p>
<pre><code class="language-shell">$ chmod +x script.sh
</code></pre>
<p>ç»™æ‰€æœ‰ç”¨æˆ·è¯»æƒé™å’Œæ‰§è¡Œæƒé™</p>
<pre><code class="language-shell">$ chmod +rx script.sh

# æˆ–è€…
$ chmod 755 script.sh
</code></pre>
<p>åªç»™è„šæœ¬æ‹¥æœ‰è€…è¯»æƒé™å’Œæ‰§è¡Œæƒé™</p>
<pre><code class="language-shell">$ chmod u+rx script.sh
</code></pre>
<p>è„šæœ¬çš„æƒé™é€šå¸¸è®¾ä¸º <code>755</code>ï¼ˆæ‹¥æœ‰è€…æœ‰æ‰€æœ‰æƒé™ï¼Œå…¶ä»–äººæœ‰è¯»å’Œæ‰§è¡Œæƒé™ï¼‰æˆ–è€… <code>700</code>ï¼ˆåªæœ‰æ‹¥æœ‰è€…å¯ä»¥æ‰§è¡Œï¼‰ã€‚</p>
<p>é™¤äº†æ‰§è¡Œæƒé™ï¼Œè„šæœ¬è°ƒç”¨æ—¶ï¼Œä¸€èˆ¬éœ€è¦æŒ‡å®šè„šæœ¬çš„è·¯å¾„ï¼ˆæ¯”å¦‚ <code>path/script.sh</code>ï¼‰ã€‚å¦‚æœå°†è„šæœ¬æ”¾åœ¨ç¯å¢ƒå˜é‡ <code>$PATH</code> æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œå°±ä¸éœ€è¦æŒ‡å®šè·¯å¾„äº†ã€‚å› ä¸º Bash ä¼šè‡ªåŠ¨åˆ°è¿™äº›ç›®å½•ä¸­ï¼Œå¯»æ‰¾æ˜¯å¦å­˜åœ¨åŒåçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>å»ºè®®åœ¨ä¸»ç›®å½•æ–°å»ºä¸€ä¸ª <code>~/bin</code> å­ç›®å½•ï¼Œä¸“é—¨å­˜æ”¾å¯æ‰§è¡Œè„šæœ¬ï¼Œç„¶åæŠŠ <code>~/bin</code> åŠ å…¥ <code>$PATH</code>ã€‚</p>
<pre><code class="language-shell">export PATH=$PATH:~/bin
</code></pre>
<p>ä¸Šé¢å‘½ä»¤æ”¹å˜ç¯å¢ƒå˜é‡ <code>$PATH</code>ï¼Œå°† <code>~/bin</code> æ·»åŠ åˆ° <code>$PATH</code> çš„æœ«å°¾ã€‚å¯ä»¥å°†è¿™ä¸€è¡ŒåŠ åˆ° <code>~/.zshrc</code> æ–‡ä»¶é‡Œé¢ï¼Œç„¶åé‡æ–°åŠ è½½ä¸€æ¬¡ <code>.zshrc</code>ï¼Œè¿™ä¸ªé…ç½®å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p>
<pre><code>$ source ~/.zshrc
</code></pre>
<p>ä»¥åä¸ç®¡åœ¨ä»€ä¹ˆç›®å½•ï¼Œç›´æ¥è¾“å…¥è„šæœ¬æ–‡ä»¶åï¼Œè„šæœ¬å°±ä¼šæ‰§è¡Œã€‚</p>
<pre><code class="language-shell">$ script.sh
</code></pre>
<p>ä¸Šé¢å‘½ä»¤æ²¡æœ‰æŒ‡å®šè„šæœ¬è·¯å¾„ï¼Œå› ä¸º <code>script.sh</code> åœ¨ <code>$PATH</code> æŒ‡å®šçš„ç›®å½•ä¸­ã€‚</p>
<blockquote>
<p>ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œå–å†³äºä½ å½“å‰æ‰€ç”¨çš„ Shellã€‚æ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯ zshï¼Œé…ç½®æ–‡ä»¶ä¸º <code>~/.zshrc</code>ï¼Œå¦‚æœä½ æ˜¯ bashï¼Œå¯èƒ½æ˜¯ <code>~/.bash_profile</code>ã€<code>~/.bashrc</code> ç­‰ã€‚</p>
</blockquote>
<h2>ä¹ã€æ¡ä»¶åˆ¤æ–­</h2>
<p><code>if</code> å…³é”®å­—åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥æ˜¯ <code>test</code> å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å‘½ä»¤ã€‚å‘½ä»¤çš„è¿”å›å€¼ä¸º <code>0</code> è¡¨ç¤ºåˆ¤æ–­æˆç«‹ï¼Œå¦åˆ™è¡¨ç¤ºä¸æˆç«‹ã€‚</p>
<pre><code class="language-shell">if commands; then
  commands
[elif commands; then
  commands...]
[else
  commands]
fi
</code></pre>
<p>åˆ¤æ–­æ¡ä»¶ <code>commands</code> å¯ä»¥æ˜¯ä¸€æ¡å‘½ä»¤ï¼Œè¿™æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆè¿”å›å€¼ä¸º <code>0</code>ï¼‰ï¼Œå°±æ„å‘³ç€åˆ¤æ–­æ¡ä»¶æˆç«‹ã€‚</p>
<p>ä½†æ›´å¤šåœ°æ˜¯ä½¿ç”¨ <code>test</code> å‘½ä»¤ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># å†™æ³•ä¸€
test expression

# å†™æ³•äºŒ
[ expression ]

# å†™æ³•ä¸‰
[[ expression ]]
</code></pre>
<p>ä»¥ä¸Šä¸‰ç§å½¢å¼æ˜¯ç­‰ä»·çš„ï¼Œç¬¬ä¸‰ç§å½¢å¼æ”¯æŒæ­£åˆ™åˆ¤æ–­ï¼Œå‰ä¸¤ç§ä¸æ”¯æŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåä¸¤ç§å†™æ³•ä¸­ <code>[</code> å’Œ <code>]</code> ä¸å†…éƒ¨å‘½ä»¤ä¹‹é—´å¿…é¡»è¦æœ‰ã€Œç©ºæ ¼ã€ã€‚å› ä¸º <code>[</code> æ˜¯ <code>test</code> å‘½ä»¤çš„ç®€å†™å½¢å¼ï¼Œå› æ­¤å®ƒåé¢å¿…é¡»è¦æœ‰ç©ºæ ¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ <code>if</code> è¯­å¥åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š</p>
<pre><code class="language-shell"># å†™æ³•ä¸€
if test -e /tmp/foo.txt ; then
  echo &quot;Found foo.txt&quot;
fi

# å†™æ³•äºŒ
if [ -e /tmp/foo.txt ] ; then
  echo &quot;Found foo.txt&quot;
fi

# å†™æ³•ä¸‰
if [[ -e /tmp/foo.txt ]] ; then
  echo &quot;Found foo.txt&quot;
fi
</code></pre>
<h3>9.1 æ–‡ä»¶åˆ¤æ–­</h3>
<p>ä»¥ä¸‹è¡¨è¾¾å¼ç”¨æ¥åˆ¤æ–­æ–‡ä»¶çŠ¶æ€ï¼š</p>
<ul>
<li><code>[ -a file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -b file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå—ï¼ˆè®¾å¤‡ï¼‰æ–‡ä»¶ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -c file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼ˆè®¾å¤‡ï¼‰æ–‡ä»¶ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -d file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ç›®å½•ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -e file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -f file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -g file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”è®¾ç½®äº†ç»„ IDï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -G file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å±äºæœ‰æ•ˆçš„ç»„ IDï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -h file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -k file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”è®¾ç½®äº†å®ƒçš„ sticky bitï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -L file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -N file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”è‡ªä¸Šæ¬¡è¯»å–åå·²è¢«ä¿®æ”¹ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -O file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å±äºæœ‰æ•ˆçš„ç”¨æˆ· IDï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -p file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå‘½åç®¡é“ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -r file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å¯è¯»ï¼ˆå½“å‰ç”¨æˆ·æœ‰å¯è¯»æƒé™ï¼‰ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -s file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å…¶é•¿åº¦å¤§äºé›¶ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -S file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªç½‘ç»œ socketï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -t fd ]</code>ï¼šå¦‚æœ <code>fd</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶ä¸”é‡å®šå‘åˆ°ç»ˆç«¯ï¼Œåˆ™ä¸º <code>true</code>ã€‚ è¿™å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦é‡å®šå‘äº†æ ‡å‡†è¾“å…¥ï¼è¾“å‡ºï¼é”™è¯¯ã€‚</li>
<li><code>[ -u file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”è®¾ç½®äº† setuid ä½ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -w file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å¯å†™ï¼ˆå½“å‰ç”¨æˆ·æ‹¥æœ‰å¯å†™æƒé™ï¼‰ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ -x file ]</code>ï¼šå¦‚æœ <code>file</code> å­˜åœ¨ï¼Œå¹¶ä¸”å¯æ‰§è¡Œï¼ˆå½“å‰ç”¨æˆ·æ‹¥æœ‰å¯æ‰§è¡Œ/æœç´¢æƒé™ï¼‰ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ file1 -nt file2 ]</code>ï¼šå¦‚æœ <code>file1</code> æ¯” <code>file2</code> çš„æ›´æ–°æ—¶é—´æœ€è¿‘ï¼Œæˆ–è€… <code>file2</code> å­˜åœ¨è€Œ <code>file1</code> ä¸å­˜åœ¨ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ file1 -ot file2 ]</code>ï¼šå¦‚æœ <code>file1</code> æ¯” <code>file2</code> çš„æ›´æ–°æ—¶é—´æ›´æ—§ï¼Œæˆ–è€… <code>file2</code> å­˜åœ¨è€Œ <code>file1</code> ä¸å­˜åœ¨ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
<li><code>[ file1 -ef file2 ]</code>ï¼šå¦‚æœ <code>file1</code> å’Œ <code>file2</code> å¼•ç”¨ç›¸åŒçš„è®¾å¤‡å’Œ inode ç¼–å·ï¼Œåˆ™ä¸º <code>true</code>ã€‚</li>
</ul>
<pre><code class="language-shell">if [ -f &quot;$FILE&quot; ]; then
  echo &quot;$FILE is a regular file.&quot;
fi
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>$FILE</code> è¦æ”¾åœ¨åŒå¼•å·ä¹‹ä¸­ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å˜é‡ <code>$FILE</code> ä¸ºç©ºï¼Œä»è€Œå‡ºé”™ã€‚å› ä¸º <code>$FILE</code> å¦‚æœä¸ºç©ºï¼Œè¿™æ—¶ <code>[ -e $FILE ]</code> å°±å˜æˆ <code>[ -e ]</code>ï¼Œè¿™ä¼šè¢«åˆ¤æ–­ä¸ºçœŸã€‚è€Œ <code>$FILE</code> æ”¾åœ¨åŒå¼•å·ä¹‹ä¸­ï¼Œ<code>[ -e &quot;$FILE&quot; ]</code> å°±å˜æˆ <code>[ -e &quot;&quot; ]</code>ï¼Œè¿™ä¼šè¢«åˆ¤æ–­ä¸ºå‡ã€‚</p>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¦‚ä½•è®© Shell è„šæœ¬å…¨å±€æ‰§è¡Œ]]></title>
            <link>https://github.com/toFrankie/blog/issues/33</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/33</guid>
            <pubDate>Sat, 25 Feb 2023 11:07:24 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8122b70f926b9e8a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8122b70f926b9e8a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç¢°å·§å‰é¢ä¸€ç¯‡<a href="https://github.com/toFrankie/blog/issues/32">æ–‡ç« </a>ä¸­æµ…æµ…ä»‹ç»äº†ä¸€ä¸‹ Shellã€‚ç„¶åæœ€è¿‘åˆšå¥½è¦å†™ä¸€ä¸ª Shell è„šæœ¬å»æ‰¹é‡å»å¤„ç†ä¸€ä¸‹æ–‡ä»¶ï¼Œå› æ­¤å†™ä¸‹æ¥è®°å½•ä¸€ä¸‹ï¼Œå°½ç®¡æ€è·¯å¾ˆç®€å•ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ <code>~/Desktop</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ª Shell è„šæœ¬ <code>myscript.sh</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">#!/bin/bash
echo &quot;ğŸ‰ğŸ‰ğŸ‰ The first shell script...&quot;
</code></pre>
<p>ä½¿ç”¨ <code>source</code> å‘½ä»¤ä¾¿å¯æ‰§è¡Œæ­¤è„šæœ¬ï¼š</p>
<pre><code class="language-shell">$ source ~/Desktop/myscript.sh
ğŸ‰ğŸ‰ğŸ‰ The first shell script...
</code></pre>
<p>ç„¶åæˆ‘åœ¨æƒ³èƒ½å¦å°† <code>source</code> æŒ‡ä»¤ä¹Ÿçœç•¥æ‰å‘¢ï¼Œç›´æ¥ <code>myscript.sh</code> è¿™æ ·ï¼š</p>
<pre><code class="language-shell">$ cd ~/Desktop
$ myscript.sh
zsh: command not found: myscript.sh
</code></pre>
<p>ç„¶å Shell è§£æå™¨å°† <code>myscript.sh</code> è¯†åˆ«æˆäº†ä¸€ä¸ªã€ŒæŒ‡ä»¤ã€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚ç”±äº Shell è„šæœ¬çš„æ‰©å±•åæ˜¯å¯é€‰çš„ï¼Œå› æ­¤å°è¯•å°† <code>.sh</code> æ‰©å±•åå»æ‰è¯•è¯•ï¼š</p>
<pre><code class="language-shell">$ myscript
zsh: permission denied: myscript
</code></pre>
<p>è·Ÿå‰é¢æœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼Œå®ƒæç¤ºæ²¡æœ‰æƒé™ã€‚å“¦ï¼ŒåŸæ¥ä¸€ä¸ª Shell è„šæœ¬åªæœ‰å…·å¤‡äº†ã€Œå¯æ‰§è¡Œæƒé™ã€æ–¹å¯è¢«æ‰§è¡Œã€‚é‚£å¥½åŠï¼Œæˆ‘ä»¬å°†å…¶æƒé™æ”¹ä¸€æ”¹ï¼š</p>
<pre><code class="language-shell">$ chmod u+x myscript
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>chmod</code> å‘½ä»¤ç”¨äºæ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ï¼Œ<code>u</code> è¡¨ç¤ºæ‰€æœ‰è€…ç”¨æˆ·ï¼Œ<code>x</code> è¡¨ç¤ºæ‰§è¡Œæƒé™ï¼Œ<code>+</code> è¡¨ç¤ºå¢åŠ æƒé™ã€‚</p>
</blockquote>
<p>å…¶å®é€šè¿‡ Finder å¯ä»¥è§‚å¯Ÿåˆ°å…¶å›¾æ ‡å˜äº†æ ·ï¼ˆä¸åŒç³»ç»Ÿå¯èƒ½ä¸ä¸€æ ·ï¼‰ï¼Œè¯¥å›¾æ ‡è¡¨ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/12/1702183807549.png" alt=""></p>
<p>äºæ˜¯æˆ‘ä»¬å…´é«˜é‡‡çƒˆåœ°æ‰§è¡Œäº†ï¼š</p>
<pre><code class="language-shell">$ myscript
zsh: command not found: myscript
</code></pre>
<p>å¯ç°å®å´ç‹ ç‹ åœ°æ‰“äº†ä¸€å·´æŒï¼Œå’‹å›äº‹ï¼ï¼ï¼åŸæ¥æ˜¯è¦å°†ã€Œå¯æ‰§è¡Œæ–‡ä»¶ã€æ‰€åœ¨ç›®å½•é…ç½®åˆ° <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­ï¼Œå› ä¸ºåœ¨ç»ˆç«¯å·¥å…·ä¸­è¾“å…¥æŒ‡ä»¤çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šä»ç¯å¢ƒå˜é‡ <code>PATH</code> æ‰€åŒ…å«çš„è·¯å¾„ä¸­ã€Œé€ä¸€æŸ¥æ‰¾ã€ç›¸åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæœ€åéƒ½æ‰¾ä¸åˆ°çš„è¯ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯å¹¶æç¤ºæ‰¾ä¸åˆ°æŒ‡ä»¤ã€‚</p>
<p>æ‰€ä»¥æœ‰å‡ ç§è§£å†³æ–¹æ³•ï¼š</p>
<blockquote>
<ul>
<li>ä¸€æ˜¯ï¼Œå°†å…¶æ‹·è´è‡³ç¯å¢ƒå˜é‡ <code>PATH</code> çš„æŸä¸ªç›®å½•ï¼ˆå¦‚ <code>/usr/bin</code> ç­‰ï¼‰é‡Œé¢ï¼Œ<code>cp ~/Desktop/myscript /bin/myscript</code>ï¼ˆä¸ªäººä¸å–œæ¬¢è¿™æ ·å¤„ç†ï¼‰ã€‚</li>
<li>äºŒæ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥åˆ°ç¯å¢ƒå˜é‡ <code>PATH</code> ç›®å½•ä¸­ï¼Œæ¯”å¦‚ <code>ln -s ~/Desktop/myscript /bin/myscript</code>ï¼ˆä¸ªäººä¸å–œæ¬¢è¿™æ ·å¤„ç†ï¼‰ã€‚</li>
<li>ä¸‰æ˜¯ï¼Œåœ¨ Shell é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­å³å¯ã€‚å°±ç”¨å®ƒå§ï¼Œæ¯•ç«Ÿè¿™ä¸ªåªæ˜¯æµ‹è¯•è„šæœ¬ï¼Œå†™å®Œæ–‡ç« æ˜¯è¦åˆ æ‰çš„ã€‚</li>
</ul>
</blockquote>
<p>åœ¨ Shell é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ <code>~/Desktop</code> è·¯å¾„å³å¯ï¼š</p>
<pre><code class="language-shell">export PATH=$PATH:$HOME/Desktop
</code></pre>
<p>å…·ä½“æ˜¯å“ªä¸ªé…ç½®å°†å–å†³äºä½ ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§ Shellï¼Œæˆ‘è¿™é‡Œæ˜¯ zshï¼Œå› æ­¤ç”¨æˆ·çº§åˆ«çš„é…ç½®æ–‡ä»¶æ˜¯ <code>~/.zshrc</code> æ–‡ä»¶ï¼Œæ·»åŠ å®Œä¹‹åï¼Œè®°å¾— <code>source ~/.zshrc</code> åˆ·æ–°å˜é‡ä½¿å…¶ç”Ÿæ•ˆã€‚</p>
<p>è‡³æ­¤ï¼Œä½ å°±å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ <code>myscript</code> æŒ‡ä»¤äº†ã€‚</p>
<pre><code>$ cd ~
$ myscript
ğŸ‰ğŸ‰ğŸ‰ The first shell script...
</code></pre>
<p>è¿™æ ·æ‰§è¡Œè„šæœ¬ä¹Ÿä¸ç”¨è¾“å…¥é‚£ä¸€ä¸²é•¿é•¿çš„åœ°å€ï¼Œèˆ’æœå¤šäº†ã€‚</p>
<p>One more thing...</p>
<p>å‰é¢æˆ‘ä»¬ä¸ºäº†ä¸è®© <code>myscript.sh</code> è¢«è¯†åˆ«ä¸ºä¸€ä¸ªæŒ‡ä»¤ï¼Œå› æ­¤æŠŠæ‰©å±•ååˆ æ‰äº†ã€‚ä½†å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›å»æ‰æ‰©å±•åï¼Œå¯ä»¥æ€æ ·åšå‘¢ï¼Ÿæ¯•ç«Ÿæˆ‘ä»¬åœ¨ä¿®æ”¹è„šæœ¬çš„æ—¶å€™ï¼Œç¼–è¾‘å™¨æ ¹æ®æ‰©å±•åä¼šæœ‰è¯­æ³•é«˜äº®ã€è¯­æ³•æç¤ºç­‰å¥½å¤„ã€‚å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹ Shell é…ç½®å³å¯ï¼š</p>
<pre><code class="language-shell">export PATH=$PATH:$HOME/Desktop
alias myscript=&quot;myscript.sh&quot;
</code></pre>
<p>æ²¡é”™ï¼Œé…ç½®å¤šä¸€ä¸ªåˆ«åå³å¯ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æµ…è°ˆ Shell]]></title>
            <link>https://github.com/toFrankie/blog/issues/32</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/32</guid>
            <pubDate>Sat, 25 Feb 2023 11:04:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a48e4a05995a6039.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a48e4a05995a6039.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>é€šå¸¸ï¼Œç”¨æˆ·æ§åˆ¶è®¡ç®—æœºçš„æ–¹å¼æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼ˆGUIï¼ŒGraphical User Interfaceï¼‰å’Œå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼ŒCommand Line Interfaceï¼‰ä¸¤ç§ã€‚ç„¶è€Œï¼ŒçœŸæ­£èƒ½å¤Ÿæ§åˆ¶è®¡ç®—æœºç¡¬ä»¶ï¼ˆå¦‚ CPUã€å†…å­˜ã€æ˜¾ç¤ºå™¨ç­‰ï¼‰çš„åªæœ‰æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆKernelï¼‰ã€‚å› æ­¤ï¼Œå›¾å½¢åŒ–ç•Œé¢å’Œå‘½ä»¤è¡Œåªæ˜¯æ¶è®¾åœ¨ç”¨æˆ·å’Œå†…æ ¸ä¹‹é—´çš„ä¸€ç§æ¡¥æ¢ã€‚</p>
<p>ç”±äºå®‰å…¨ã€å¤æ‚ã€ç¹çç­‰åŸå› ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥æ¥è§¦å†…æ ¸ï¼ˆä¹Ÿæ²¡å¿…è¦ï¼‰ï¼Œå› æ­¤éœ€è¦å¼€å‘ä¸€ä¸ªç¨‹åºã€‚ç”¨æˆ·ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¨‹åºï¼Œç¨‹åºçš„ä½œç”¨å°±æ˜¯æ¥æ”¶ç”¨æˆ·çš„æ“ä½œï¼ˆè¾“å…¥ï¼‰ï¼Œè¿›è¡Œç®€å•å¤„ç†ï¼Œç„¶åä¼ é€’ç»™å†…æ ¸ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é—´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿäº†ã€‚Shell å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªç¨‹åºã€‚åœ¨ç”¨æˆ·å’Œå†…æ ¸ä¹‹é—´å¢åŠ ä¸€å±‚ã€Œä»£ç†ã€ï¼Œæ—¢èƒ½ç®€åŒ–æ“ä½œï¼Œåˆèƒ½ä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p>
<blockquote>
<p>å› æ­¤ï¼ŒShell å¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå†…å®¹éƒ¨åˆ†æ‘˜è‡ª <a href="http://c.biancheng.net/view/706.html">Shell æ˜¯ä»€ä¹ˆ</a>ã€‚</p>
<h2>äºŒã€Shell çš„å«ä¹‰</h2>
<p>Shell çš„è‹±æ–‡åŸæ„æ˜¯ã€Œå¤–å£³ã€ï¼Œä¸ä¹‹ç›¸å¯¹çš„æ˜¯å†…æ ¸ï¼ˆKernelï¼‰ã€‚ä½†å…·ä½“æ¥è¯´ï¼ŒShell è¿™ä¸ªè¯æœ‰å¤šç§å«ä¹‰ã€‚</p>
<ol>
<li>
<p>Shell æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæä¾›ä¸€ä¸ªä¸ç”¨æˆ·å¯¹è¯çš„ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤æç¤ºç¬¦ï¼ˆé€šå¸¸æ˜¯ <code>$</code> æˆ– <code>#</code>ï¼‰ï¼Œè®©ç”¨æˆ·è¾“å…¥å‘½ä»¤ã€‚è¿™ç§ç¯å¢ƒè¢«ç§°ä¸ºå‘½ä»¤è¡Œç¯å¢ƒï¼ˆCLIï¼‰ã€‚Shell æ¥æ”¶åˆ°ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œå°†å‘½ä»¤ä¼ é€’ç»™æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</p>
</li>
<li>
<p>Shell æ˜¯ä¸€ä¸ªå‘½ä»¤è§£æå™¨ï¼Œè§£æç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œå®ƒæ”¯æŒå˜é‡ã€æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯æ“ä½œç­‰è¯­æ³•ï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥ç”¨ Shell å†™å‡ºå„ç§å°ç¨‹åºï¼Œåˆè¢«ç§°ä¸ºè„šæœ¬ï¼ˆScriptï¼‰ã€‚è¿™äº›è„šæœ¬é€šè¿‡ Shell è§£æå™¨è§£ææ‰§è¡Œï¼Œæ³¨æ„ä¸æ˜¯ç¼–è¯‘ã€‚</p>
</li>
<li>
<p>Shell æ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œæä¾›äº†å„ç§å°å·¥å…·ï¼Œä¾›ç”¨æˆ·æ–¹ä¾¿åœ°ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸Šæ‘˜è‡ª <a href="https://wangdoc.com/bash/intro.html">Bash ç®€ä»‹</a>ã€‚</p>
<h2>ä¸‰ã€Shell çš„ç§ç±»</h2>
<p>Shell åˆå¾ˆå¤šç§ï¼Œåªè¦èƒ½ç»™ç”¨æˆ·æä¾›å‘½ä»¤è¡Œç¯å¢ƒçš„ç¨‹åºï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ Shellã€‚åœ¨å†å²ä¸Šï¼Œä¸»è¦ Shell æœ‰è¿™äº›ï¼š</p>
<ul>
<li>Bourne Shellï¼ˆshï¼‰</li>
<li>Bourne Again shellï¼ˆbashï¼‰</li>
<li>C Shellï¼ˆcshï¼‰</li>
<li>TENEX C Shellï¼ˆtcshï¼‰</li>
<li>Korn shellï¼ˆkshï¼‰</li>
<li>Z Shellï¼ˆzshï¼‰</li>
<li>Friendly Interactive Shellï¼ˆfishï¼‰</li>
</ul>
<p>æ›´è¯¦ç»†å¯çœ‹<a href="https://wangdoc.com/bash/intro.html">ç½‘é“</a>å’Œ <a href="https://www.wikiwand.com/en/Shell_(computing)">Wikiwand</a>ã€‚ç›®å‰æœ€å¸¸ç”¨çš„ Shell æ˜¯ bashã€‚</p>
<h2>å››ã€Shell è§£æå™¨</h2>
<p>å„æ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå†…ç½®å¤šç§ Shell è§£æå™¨ï¼Œä¸”æœ‰ä¸€ä¸ªé»˜è®¤çš„ Shellã€‚æ¯”å¦‚ Linux æ“ä½œç³»ç»Ÿæ˜¯ bashï¼ŒWindows æ“ä½œç³»ç»Ÿæ˜¯ PowerShellï¼ŒMac æ“ä½œç³»ç»Ÿæ˜¯ bash æˆ– zshã€‚</p>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œä¸åŒç‰ˆæœ¬ä¸‹å…¶å†…ç½®é»˜è®¤ Shell å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>OS X 10.2 åŠä»¥ä¸‹ç‰ˆæœ¬é»˜è®¤ Shell ä¸º cshã€‚</li>
<li>OS X 10.3 ~ macOS 10.14 ç‰ˆæœ¬é»˜è®¤ Shell ä¸º bashã€‚</li>
<li>è‡ª macOS 10.15 èµ·é»˜è®¤ Shell ä¸º zshã€‚</li>
</ul>
</blockquote>
<p>å…³äºå¦‚ä½•ä» bash åˆ‡æ¢è‡³ zshï¼Œæˆ–è€…åœ¨ä¸ä¿®æ”¹é»˜è®¤ Shell çš„æƒ…å†µä¸‹ä½¿ç”¨å…¶ä»– Shellï¼Œå¯å‚è€ƒï¼š<a href="https://support.apple.com/zh-cn/HT208050">åœ¨ Mac ä¸Šå°† zsh ç”¨ä½œé»˜è®¤ Shell</a>ã€‚</p>
<p>ä¸€äº›å‘½ä»¤ï¼š</p>
<ol>
<li>æŸ¥çœ‹å½“å‰æ“ä½œç³»ç»Ÿé»˜è®¤ Shell</li>
</ol>
<pre><code class="language-shell">$ echo $SHELL
/bin/zsh
</code></pre>
<ol start="2">
<li>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ Shellï¼ˆä¸ä¸€å®šæ˜¯é»˜è®¤ Shellï¼‰</li>
</ol>
<pre><code class="language-shell">$ ps
  PID TTY           TIME CMD
13766 ttys000    0:00.25 /bin/zsh -l
14879 ttys000    0:04.45 node /usr/local/Cellar/yarn/1.22.19/libexec/bin/yarn.j
14880 ttys000    0:10.75 gulp start --project qualcomm-202206    
14886 ttys000    0:00.06 open -W http://localhost:3000
15495 ttys001    0:00.37 /bin/zsh -l
16701 ttys002    0:00.63 -zsh
18509 ttys003    0:00.26 -zsh
</code></pre>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<a href="https://www.linuxcool.com/ps">ps</a> å‘½ä»¤ï¼ˆæ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€ï¼‰ç»“æœçš„ã€Œå€’æ•°ç¬¬äºŒè¡Œã€æ˜¯å½“å‰æ­£åœ¨ä½¿ç”¨çš„ Shellã€‚</p>
<ol start="3">
<li>æŸ¥çœ‹å½“å‰æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰çš„ Shell</li>
</ol>
<pre><code class="language-shell">$ cat /etc/shells
# List of acceptable shells for chpass(1).
# Ftpd will not allow users to connect who are not using
# one of these shells.

/bin/bash
/bin/csh
/bin/dash
/bin/ksh
/bin/sh
/bin/tcsh
/bin/zsh
</code></pre>
<ol start="4">
<li>è¿›å…¥æˆ–é€€å‡º Shell</li>
</ol>
<p>å½“å‰æˆ‘çš„é»˜è®¤ Shell æ˜¯ zshï¼Œå¦‚æœè¦è¿›å…¥ bash ç¯å¢ƒï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œç„¶åå†é€€å‡ºã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-shell">$ bash

The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
bash-3.2$ echo $NVM_DIR
/Users/frankie/.nvm
bash-3.2$ exit
exit
</code></pre>
<p>å…¶ä¸­ <code>bash</code> å‘½ä»¤è¡¨ç¤ºè¿›å…¥ bash Shell ç¯å¢ƒï¼Œ<code>echo $NVM_DIR</code> è¡¨ç¤ºè¾“å‡º <code>$NVM_DIR</code> ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‰§è¡Œ <code>exit</code> å‘½ä»¤é€€å‡º bash Shell ç¯å¢ƒã€‚</p>
<h2>äº”ã€Shell è„šæœ¬</h2>
<p>è„šæœ¬ï¼ˆScriptï¼‰æ˜¯æŒ‡åŒ…å«ä¸€ç³»åˆ—å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ã€‚åˆ©ç”¨ Shell è§£æå™¨ä¾¿å¯æ‰§è¡Œçš„è„šæœ¬ï¼Œè¢«ç§°ä¸º Shell è„šæœ¬ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæœ€ç®€å•çš„ Shell è„šæœ¬ <code>hello.sh</code>ï¼š</p>
<pre><code class="language-shell">#!/bin/bash

echo &quot;Hello Shell&quot;
</code></pre>
<blockquote>
<ul>
<li>è„šæœ¬é¦–è¡Œ <code>#!</code> æ˜¯ä¸€ä¸ªçº¦å®šæ ‡è®°ï¼ˆç§°ä¸º <a href="https://www.wikiwand.com/en/Shebang_(Unix)">Shebang</a> è¡Œï¼‰ï¼Œç”¨äºæŒ‡å®šæ‰§è¡Œè¯¥è„šæœ¬çš„ Shell è§£æå™¨ï¼Œé€šå¸¸æ˜¯ <code>/bin/bash</code> æˆ– <code>/bin/sh</code>ã€‚</li>
<li><code>#!</code> ä¸è§£æå™¨ä¹‹é—´çš„ã€Œç©ºæ ¼ã€å¯æœ‰å¯æ— ã€‚</li>
<li>æ–‡ä»¶é¡¶éƒ¨çš„ Shebang è¡Œæ˜¯éå¿…éœ€çš„ã€‚è‹¥æ— ï¼Œåˆ™è¦åœ¨æ‰§è¡Œè„šæœ¬æ—¶æ‰‹åŠ¨æŒ‡å®šï¼Œæ¯”å¦‚ <code>/bin/sh ./hello.sh</code> æˆ– <code>bash ./hello.sh</code>ã€‚</li>
<li>è‹¥æ‰‹åŠ¨æŒ‡å®šè§£æå™¨ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨æ‰€æŒ‡å®šçš„è§£æå™¨å»æ‰§è¡Œè¯¥è„šæœ¬ï¼Œè€Œè„šæœ¬å†…æŒ‡å®šçš„è§£æå™¨ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>Shell è„šæœ¬æ–‡ä»¶çš„æ‰©å±•åæ˜¯éå¿…éœ€çš„ï¼Œç”šè‡³å¯ä»¥å‘½åä¸ºå¥‡å¥‡æ€ªæ€ªçš„æ‰©å±•åï¼Œä¸å½±å“è„šæœ¬çš„æ‰§è¡Œã€‚ä½†æ˜¯...æŒ‰ç…§ä¹ æƒ¯é€šå¸¸ä¼šå‘½åä¸º <code>.sh</code>ã€‚</li>
</ul>
</blockquote>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ Shell è§£æå™¨å¹¶æ²¡æœ‰æ”¾åœ¨ <code>/bin</code>ï¼Œè¿™æ ·è„šæœ¬å«æ— æ³•æ‰§è¡Œäº†ã€‚ä¸ºäº†ç¡®ä¿ç¨³å®šæ€§ï¼Œå¯ä»¥å†™æˆè¿™æ ·ï¼š</p>
<pre><code class="language-shell">#!/usr/bin/env bash
</code></pre>
<p>åŸå› æ˜¯ <code>env</code> å‘½ä»¤ä¸€å®šæ˜¯åœ¨ <code>/bin/bin</code> ç›®å½•ä¸‹ï¼Œå®ƒè¿”å›å¯¹åº” Shell è§£æå™¨çš„ä½ç½®ã€‚</p>
<p>å¦‚æœå¼€å‘è¿‡ä¸€äº› Node ç›¸å…³å·¥å…·ï¼ˆæ¯”å¦‚ <a href="https://github.com/vuejs/vue-cli/blob/ef08a08c41b028a2484f262414a8c91d151febc7/packages/@vue/cli/bin/vue.js">vue-cli</a>ï¼‰ï¼Œä½ ä¸€å®šçœ‹åˆ°è¿‡è¿™æ ·çš„ Shebang è¡Œï¼Œç”¨äºæŒ‡å®šè§£æå™¨ä¸º Nodeã€‚</p>
<pre><code class="language-shell">#!/usr/bin/env node
</code></pre>
<p>ä¹Ÿå¯ä»¥è§‚å¯Ÿä¸€ä¸‹é¡¹ç›®çš„ <code>node_modules/.bin</code> ç›®å½•ä¸‹çš„æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒä»¬å‡ ä¹éƒ½æ˜¯ä»¥ <code>#!/usr/bin/env node</code> å¼€å¤´çš„ï¼Œå…¶ä½œç”¨æ˜¯æ­£ç¡®åœ°æŸ¥æ‰¾å¯¹åº”è§£æå™¨æ‰€åœ¨è·¯å¾„ï¼Œä»¥é¿å…ç”¨æˆ·æ²¡æœ‰å®‰è£…åœ¨é»˜è®¤è·¯å¾„ä¸‹å¯¼è‡´æ— æ³•æ­£å¸¸æ‰§è¡Œè„šæœ¬çš„é—®é¢˜ã€‚å¦‚æœä½ æ˜¯å†™ Python çš„è¯ï¼Œä¸€å®šè§è¿‡ <code>#!/usr/bin/env python</code>...</p>
<p>å¦‚æœå¹³å¸¸æƒ³è¦çœ‹ä¸‹ Node å®‰è£…ç›®å½•çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>which</code> å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ which node
/Users/frankie/.nvm/versions/node/v16.15.0/bin/node
</code></pre>
<h2>å…­ã€NPM è„šæœ¬ä¸ Shell</h2>
<p>åœ¨å‰ç«¯é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ <code>package.json</code> ä¸­å®šä¹‰ä¸€ç³»åˆ—çš„è„šæœ¬å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;jest&quot;
  }
}
</code></pre>
<p>å½“æˆ‘ä»¬åœ¨ç»ˆç«¯è¾“å…¥ <code>npm run test</code> å‘½ä»¤æ—¶ï¼Œå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æµ‹è¯•è„šæœ¬ã€‚å½“æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ–è€…ç”¨æˆ·æ ¹ç›®å½•ç­‰è·¯å¾„ä¸‹ç›´æ¥æ‰§è¡Œ <code>jest</code> å‘½ä»¤ï¼ŒæŠ›å‡ºé”™è¯¯ï¼š</p>
<pre><code class="language-shell">$ jest
zsh: command not found: jest
</code></pre>
<p>åŸå› æ˜¯æ‰§è¡Œå‘½ä»¤çš„å½“å‰ç›®å½•æˆ– <code>PATH</code>ï¼ˆç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰ç›®å½•éƒ½ä¸å­˜åœ¨ä¸€ä¸ªåä¸º <code>jest</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é‚£ä¹ˆ <code>npm run jest</code> å†…éƒ¨åˆå·å·åšäº†å“ªäº›å·¥ä½œå‘¢ï¼Œä¸ºä»€ä¹ˆå®ƒèƒ½å‡†ç¡®æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ <code>jest</code> æ‰€åœ¨çš„ç›®å½•å‘¢ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>my-app</code> åŒ…ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;my-app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;bin&quot;: {
    &quot;myapp&quot;: &quot;./cli.js&quot;
  }
}
</code></pre>
<p>å…¶ä¸­æœ‰ä¸€ä¸ª <code>bin</code> å­—æ®µï¼ˆ<a href="https://docs.npmjs.com/cli/v8/configuring-npm/package-json#bin">è¯¦è§</a>ï¼‰ï¼Œè¡¨ç¤ºè¯¥åŒ…æœ‰ä¸€ä¸ªåä¸º <code>myapp</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æ‰§è¡Œ <code>npm install my-app</code> æ—¶ï¼Œé™¤äº†å°†åŒ…ä¸‹è½½è‡³ <code>node_modules</code> ç›®å½•ä¸‹ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ª <code>cli.js</code> æ–‡ä»¶çš„è½¯é“¾æ¥ï¼ˆsymlinkï¼‰è‡³ <code>node_modules/.bin</code> ç›®å½•ï¼Œè¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°å°±æ˜¯å¯¹åº”çš„é”®å <code>myapp</code>ã€‚è‹¥ä»¥ <code>&quot;bin&quot;: &quot;./cli.js&quot;</code> å½¢å¼é…ç½®ï¼Œåç§°åˆ™ä¸ºå…¶åŒ…å <code>my-app</code>ã€‚è‹¥å…¨å±€å®‰è£…ï¼Œåˆ™ä¼šè¢«é“¾æ¥è‡³å…¨å±€ç›®å½•ã€‚</p>
<p>ä»¥ <a href="https://jestjs.io/">jest</a> ä¸ºä¾‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ <code>node_modules/.bin/jest</code> å…¶å®æ˜¯ <code>node_modules/jest/bin/jest.js</code> çš„è½¯é“¾æ¥ï¼Œå› æ­¤çœŸæ­£è¢«æ‰§è¡Œçš„æ˜¯åè€…ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-82c19256b73a7602.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœ <code>package.json</code> ä¸­å®šä¹‰çš„å‘½ä»¤æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-json">{
  &quot;test&quot;: &quot;./node_modules/.bin/jest&quot;
}
</code></pre>
<p>æˆ–è¿™æ ·ï¼š</p>
<pre><code class="language-json">{
  &quot;test&quot;: &quot;./node_modules/jest/bin/jest.js&quot;
}
</code></pre>
<p>éƒ½éå¸¸å®¹æ˜“ç†è§£ï¼Œä½†è§‚æ„Ÿæ¥è¯´ï¼Œå®ƒåˆé•¿åˆè‡­ï¼Œè¿˜ä¸‘ã€‚é‚£ä¹ˆ <code>{ &quot;test&quot;: &quot;jest&quot; }</code> åˆæ˜¯å¦‚ä½•æ‰¾åˆ°ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„å‘¢ï¼Ÿ</p>
<p>å…¶å†…åœ¨å¥¥ç§˜åœ¨äº <code>npm run</code> å‘½ä»¤ã€‚å½“æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª Shell å­è¿›ç¨‹ï¼Œç„¶ååœ¨è¿™ä¸ª Shell ä¸­æ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬å‘½ä»¤ã€‚<strong>æ¢å¥è¯è¯´ï¼Œåªè¦æ˜¯ Shell å¯ä»¥è¿è¡Œçš„å‘½ä»¤ï¼Œéƒ½å¯ä»¥å†™åœ¨ NPM è„šæœ¬é‡Œé¢</strong>ã€‚</p>
<p>æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ï¼Œ<strong><code>npm run</code> åˆ›å»ºçš„ Shell è¿›ç¨‹ï¼Œä¼šå°†å½“å‰ç›®å½•çš„ <code>node_modules/.bin</code> å­ç›®å½•åŠ å…¥åˆ° <code>PATH</code> ç¯å¢ƒå˜é‡ï¼Œåœ¨æ‰§è¡Œç»“æŸä¹‹åï¼Œå†å°† <code>PATH</code> ç¯å¢ƒå˜é‡æ¢å¤åŸæ ·ã€‚</strong></p>
<blockquote>
<p>æ¨èä¸‹é˜®ä¸€å³°è€å¸ˆçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">npm scripts ä½¿ç”¨æŒ‡å—</a>ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥éªŒè¯ä¸‹ï¼Œå‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªé¡¹ç›®ï¼Œä¸”æœ‰ä¸€ä¸ª <code>test.sh</code> è„šæœ¬ç”¨äºè¾“å‡º <code>PATH</code> ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;simple-test&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;source ./test.sh&quot;
  }
}
</code></pre>
<pre><code class="language-shell">#!/bin/bash
# test.sh
echo $PATH
</code></pre>
<p>å…¶ä¸­ <code>source</code> å‘½ä»¤è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œä¹Ÿå¯ç”¨å…¶ç®€å†™å½¢å¼ <code>.</code> è¡¨ç¤ºï¼Œå³ <code>. ./test.sh</code>ã€‚æˆ‘ä»¬ä¹Ÿå¸¸ç”¨æ­¤å‘½ä»¤æ¥åˆ·æ–°ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚ <code>source ~/.zshrc</code>ï¼Œæ›´å¤šå¯çœ‹<a href="https://wangdoc.com/bash/script.html#source-%E5%91%BD%E4%BB%A4">æ–‡ç« </a>ã€‚</p>
<p>ä¸‹é¢ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œæ‰§è¡Œå‰åéƒ½è¾“å‡ºä¸€ä¸‹ <code>PATH</code> ç¯å¢ƒå˜é‡çš„å€¼ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4814e1eef5b54c32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨ <code>npm run</code> æ‰§è¡ŒæœŸé—´ï¼Œ<code>PATH</code> ç¯å¢ƒå˜é‡å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆªå›¾æ ‡è®°éƒ¨åˆ†ä¸ºä¸´æ—¶æ–°å¢çš„ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­åŒ…æ‹¬é¡¹ç›®æ‰€åœ¨è·¯å¾„ <code>simple-test/node_modules/.bin</code>ï¼Œæ‰§è¡Œå®Œä¹‹ååˆå˜ä¸ºäº†æœ€åˆçš„æ¨¡æ ·ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆ <code>simple-test</code> é€å±‚å¾€ä¸Šæ·»åŠ  <code>node_modules/.bin</code> ç›®å½•ï¼Œæˆ‘çŒœæ˜¯è·Ÿ Node é€å±‚æŸ¥æ‰¾æ¨¡å—æœ‰å…³ç³»ï¼Œå…·ä½“æ²¡å»ç»†ç©¶ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ <code>bin</code> å­—æ®µå»å£°æ˜ä¸€äº›å‘½ä»¤ï¼š</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;simple-test&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;source ./test.sh&quot;
  },
  &quot;bin&quot;: {
    &quot;hello&quot;: &quot;./hello.sh&quot;
  }
}
</code></pre>
<p>ç„¶åå®‰è£…æ­¤åŒ…åï¼Œå°±å¯ä»¥åœ¨ <code>script</code> ä¸­ä½¿ç”¨ <code>hello</code> å‘½ä»¤äº†ã€‚</p>
<h2>ä¸ƒã€Shell é…ç½®æ–‡ä»¶</h2>
<p>ç”±äºå¾ˆå¤šé«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œæœ‰ç€ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå› æ­¤å¯é€‰æ‹©çš„é…ç½®æ–‡ä»¶æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ JSONã€XMLã€YAML ç­‰ç­‰ã€‚å¯¹äº Shell è€Œè¨€ï¼Œå…¶é…ç½®æ–‡ä»¶å¤šæ˜¯ <code>key=value</code> å½¢å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œç­‰å·ä¸¤è¾¹ä¸åº”æœ‰ã€Œç©ºæ ¼ã€ã€‚</p>
<p>Shell é…ç½®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Shell è„šæœ¬ï¼Œåªæ˜¯æ²¡æœ‰ç”¨ <code>.sh</code> æ‰©å±•åè€Œå·²ã€‚å‰é¢æåˆ°è¿‡ Shell è„šæœ¬æ‰©å±•åæ˜¯éå¿…éœ€çš„ã€‚å½“ Shell è¢«å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œå¯¹åº” Shell çš„é…ç½®æ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œé€šå¸¸æ˜¯é…ç½®å½“å‰ Shell çš„ç¯å¢ƒï¼Œæ¯”å¦‚ <code>alias</code>ã€<code>PATH</code> ç­‰ã€‚</p>
<p>Shell é…ç½®æ–‡ä»¶å¯åˆ†ä¸ºã€Œç³»ç»Ÿçº§åˆ«ã€å’Œã€Œç”¨æˆ·çº§åˆ«ã€ã€‚å½“ Shell å¯åŠ¨æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œç³»ç»Ÿçº§åˆ«çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼Œç„¶åå†æ‰§è¡Œç”¨æˆ·çº§åˆ«çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼Œå› æ­¤ç”¨æˆ·çº§åˆ«çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æ›´é«˜ã€‚å¦å¤–ï¼Œç³»ç»Ÿçº§åˆ«çš„é…ç½®å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œè€Œç”¨æˆ·çº§åˆ«ä»…å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¯ä»¥ç†è§£ä¸ºç»§æ‰¿å…³ç³»ã€‚</p>
<blockquote>
<ul>
<li>ç³»ç»Ÿçº§åˆ«é…ç½®æ–‡ä»¶ä¸€èˆ¬ä½äº <code>/etc</code> ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ <code>/etc/profile</code>ã€<code>/etc/bashrc</code> ç­‰ã€‚</li>
<li>ç”¨æˆ·çº§åˆ«é…ç½®æ–‡ä»¶ä¸€èˆ¬ä½äº <code>~</code>ï¼ˆç”¨æˆ·ç›®å½•ï¼‰ä¸‹ï¼Œæ¯”å¦‚ <code>~/.profile</code>ã€<code>~/.bashrc</code>ã€<code>~/.bash_profile</code>ã€<code>~/.zshrc</code> ç­‰ï¼Œé€šå¸¸æ˜¯éšè—æ€§æ–‡ä»¶ã€‚</li>
</ul>
</blockquote>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œé€šå¸¸ä¿®æ”¹ Shell é…ç½®éƒ½æ˜¯åœ¨ç”¨æˆ·çº§åˆ«çš„é…ç½®æ–‡ä»¶ä¸Šæ“ä½œï¼Œæ¯”å¦‚ <code>~/.bash_profile</code> æˆ– <code>~/.zshrc</code>ï¼Œå–å†³äºä½ åœ¨ä½¿ç”¨å“ªä¸€ç§ Shell è§£æå™¨ã€‚</p>
<p>å¸¸è§ Shell æ˜¯å¦‚ä½•è¯»å–é…ç½®çš„ï¼Œé™„ä¸€å¼ å›¾ï¼Œæºè‡ª <a href="https://blog.flowblok.id.au/2013-02/shell-startup-scripts.html#implementation">Shell startup scripts</a>ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fd7a1063825a93a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å›¾ä¸­æ¶‰åŠäº†å‡ ä¸ªæ¦‚å¿µ interactive å’Œ non-interactiveã€login å’Œ non-loginï¼Œåˆ†åˆ«è¡¨ç¤ºæ˜¯å¦ä¸ºäº¤äº’å¼ Shellã€æ˜¯å¦ä¸ºç™»å½•å¼ Shellã€‚å®ƒä»¬åœ¨è¯»å–é…ç½®æ–‡ä»¶ä¸Šä¼šæœ‰æ‰€åŒºåˆ«ï¼Œæ¯”å¦‚ï¼Œéäº¤äº’å¼å’Œéç™»å½•å¼çš„ zsh ä¸ä¼šè¯»å– <code>~/.zshrc</code> é…ç½®æ–‡ä»¶ã€‚</p>
<p>ä»¥ä¸‹è¯´æ˜ï¼Œæ‘˜è‡ª<a href="https://harttle.land/2016/06/08/shell-config-files.html">æ­¤å¤„</a>ï¼š</p>
<blockquote>
<p><strong>Login Shell</strong>ï¼šæ˜¯æŒ‡è¯¥ Shell è¢«å¯åŠ¨æ—¶ç”¨äºç”¨æˆ·ç™»å½•ã€‚
<strong>Non-login Shell</strong>ï¼šæ˜¯æŒ‡ç”¨æˆ·å·²ç™»å½•ä¸‹å¯åŠ¨çš„é‚£äº› Shellï¼Œè¢«è‡ªåŠ¨æ‰§è¡Œçš„ Shell ä¹Ÿå±äºéç™»å½•å¼ Shellï¼Œå®ƒä»¬çš„æ‰§è¡Œé€šå¸¸ä¸ç”¨æˆ·ç™»å½•æ— å…³ã€‚</p>
</blockquote>
<blockquote>
<p><strong>Interactive Shell</strong>ï¼šæ˜¯æŒ‡å¯ä»¥è®©ç”¨æˆ·é€šè¿‡é”®ç›˜è¿›è¡Œäº¤äº’çš„ Shellã€‚ å¹³å¸¸åœ¨ä½¿ç”¨çš„ CLI éƒ½æ˜¯äº¤äº’å¼ Shellã€‚
<strong>Non-interactive Shell</strong>ï¼šæ˜¯æŒ‡è¢«è‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬ï¼Œ é€šå¸¸ä¸ä¼šè¯·æ±‚ç”¨æˆ·è¾“å…¥ï¼Œè¾“å‡ºä¹Ÿä¸€èˆ¬ä¼šå­˜å‚¨åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p>
</blockquote>
<p>å¦‚æœåœ¨ä½¿ç”¨ zshï¼Œå¯é˜…è¯»ä¸‹è¿™ç¯‡å¤§è€Œå…¨çš„é…ç½®æŒ‡å¼•ï¼š<a href="https://wiki.archlinux.org/title/zsh">zsh wiki</a>ã€‚</p>
<h2>å…«ã€ç¯å¢ƒå˜é‡ä¸ Shell å˜é‡</h2>
<blockquote>
<p>æœ¬å°èŠ‚å†…å®¹å¤§éƒ¨åˆ†æ‘˜è‡ªæ–‡ç« ï¼š<a href="https://segmentfault.com/a/1190000023653544">è®¾ç½®ä¸æŸ¥çœ‹Linuxç³»ç»Ÿä¸­çš„ç¯å¢ƒå˜é‡</a>ã€‚</p>
</blockquote>
<p>åœ¨ Linux/Unix ç³»ç»Ÿä¸­ï¼Œåˆ†ä¸ºã€Œç¯å¢ƒå˜é‡ã€å’Œã€ŒShell å˜é‡ã€ä¸¤ç§å˜é‡ã€‚<strong>å®ƒä»¬éƒ½æ˜¯åŒºåˆ†å¤§å°å†™çš„</strong>ï¼Œå› æ­¤ <code>HOME</code> å’Œ <code>home</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ã€‚</p>
<blockquote>
<ul>
<li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šé€šå¸¸åœ¨ Shell é…ç½®æ–‡ä»¶ä¸­ä»¥ <code>key=value</code> å½¢å¼å®ç°ï¼Œå®ƒåœ¨æ•´ä¸ªç³»ç»ŸèŒƒå›´å†…éƒ½å¯ç”¨ï¼Œå¹¶è¢«æ‰€æœ‰å­è¿›ç¨‹å’Œ Shell ç»§æ‰¿ã€‚é€šå¸¸ä»¥å¤§å†™å½¢å¼å‘½åï¼Œæ¯”å¦‚ <code>PATH</code> ç­‰ã€‚</li>
<li><strong>Shell å˜é‡</strong>ï¼šä¸“é—¨ç”¨äºè®¾ç½®æˆ–å®šä¹‰å®ƒä»¬çš„ Shell ä¸­çš„å˜é‡ï¼Œæ¯ä¸€ç§ Shell è§£æå™¨éƒ½æœ‰ä¸€ç»„å±äºè‡ªå·±çš„å†…éƒ¨ Shell å˜é‡ã€‚åœ¨ç¼–å†™ Shell è„šæœ¬æ—¶å¸¸ç”¨äºè·Ÿè¸ªä¸´æ—¶æ•°æ®ã€‚</li>
</ul>
</blockquote>
<p>ä½¿ç”¨ <code>env</code> æˆ– <code>printenv</code> å‘½ä»¤ï¼ˆä¸å¸¦å…¶ä»–å‚æ•°æ—¶ï¼‰ï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚è‹¥æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>printenv</code> æˆ– <code>echo</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">$ printenv PATH
/Users/frankie/.nvm/versions/node/v16.14.0/bin:/usr/local/sbin:/usr/local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

$ echo $PATH
/Users/frankie/.nvm/versions/node/v16.14.0/bin:/usr/local/sbin:/usr/local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
</code></pre>
<p><code>echo</code> å‘½ä»¤ä¸­çš„å˜é‡åå‰éœ€è¦æ·»åŠ å‰ç¼€ <code>$</code>ï¼Œå¦åˆ™å½“åšè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ä½¿ç”¨ <code>set</code> å‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬ç¯å¢ƒå˜é‡å’Œè‡ªå®šä¹‰å˜é‡ï¼‰ï¼Œä»¥åŠæ‰€æœ‰çš„ Shell å‡½æ•°ã€‚</p>
<h3>8.1 ç¯å¢ƒå˜é‡</h3>
<p>å•ä¸ªå€¼çš„ç¯å¢ƒå˜é‡ï¼Œå½¢å¼çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-shell">KEY=value1
</code></pre>
<p>å¦‚æœå˜é‡çš„å€¼ä¸­å«æœ‰ç©ºæ ¼ï¼Œåˆ™éœ€è¦å°†å€¼æ”¾åœ¨å¼•å·ä¸­ï¼Œæ¯”å¦‚ï¼š<code>KEY=&quot;value with spaces&quot;</code>ã€‚</p>
<p>å¤šä¸ªå€¼çš„ç¯å¢ƒå˜é‡ï¼Œå½¢å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-shell">KEY=value1:value2:value3
</code></pre>
<p>æ¯ä¸ªå€¼ä¹‹é—´ä»¥åˆ†å· <code>:</code> ä½œä¸ºåˆ†éš”ç¬¦ã€‚å¯ä»¥ç†è§£ä¸ºç±»ä¼¼äºé«˜çº§ç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°ç»„ã€‚</p>
<h3>8.2 Shell å˜é‡</h3>
<p>Shell å˜é‡å£°æ˜è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">variable=value
</code></pre>
<p>ç­‰å·å·¦è¾¹ä¸ºã€Œå˜é‡åã€ï¼Œå³è¾¹ä¸ºå˜é‡å€¼ï¼ŒåŒæ ·åœ°ï¼Œè‹¥å˜é‡å€¼å«æœ‰ç©ºæ ¼ï¼Œéœ€è¦å°†å€¼æ”¾åœ¨å¼•å·ä¸­ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Shell ä¸­æ²¡æœ‰æ•°æ®ç±»å‹çš„æ¦‚å¿µï¼Œæ‰€æœ‰å˜é‡å€¼éƒ½æ˜¯å­—ç¬¦ä¸²</strong>ã€‚</p>
<p>Shell å˜é‡é™¤äº†å¯ä»¥åœ¨ Shell è„šæœ¬æ–‡ä»¶ä¸­å£°æ˜ã€ä½¿ç”¨ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥åœ¨ Shell ä¼šè¯ä¸­æ“ä½œçš„ï¼Œä½†æ˜¯è¯¥å˜é‡çš„å£°æ˜å‘¨æœŸä»…åœ¨ä¼šè¯è¢«é”€æ¯ä¹‹å‰ï¼Œè€Œä¸”ä¸èƒ½è¢«å…¶ä»–æ–°çš„ Shell ä¼šè¯ç¯å¢ƒä¸­è¯»å–ã€‚è‹¥ç”¨æµè§ˆå™¨æ¥æ¯”å–»çš„è¯ï¼Œæ¯ä¸ª Shell ä¼šè¯å°±æ˜¯ä¸¤ä¸ªæ ‡ç­¾çš„åº”ç”¨ï¼Œåº”ç”¨ä¹‹é—´çš„å˜é‡æ˜¯ä¸å¯å…±äº«çš„ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ myname=frankie
$ echo $myname
frankie
</code></pre>
<p>ç”±äºç”¨æˆ·åˆ›å»ºçš„ Shell å˜é‡ï¼Œä»…å¯åœ¨å½“å‰ Shell ä¸­ä½¿ç”¨ï¼Œè‹¥è¦ä¼ é€’ç»™å­ Shellï¼Œéœ€è¦ä½¿ç”¨ export å‘½ä»¤ã€‚è¿™æ ·è¾“å‡ºçš„å˜é‡ï¼Œå¯¹äºå­ Shell æ¥è¯´å°±æ˜¯ç¯å¢ƒå˜é‡ã€‚ä½†æ³¨æ„å…¶ä»–éå­ Shellï¼Œæ˜¯ä¸èƒ½è¯»å–åˆ°çš„ã€‚</p>
<pre><code class="language-shell">$ export myname=frankie
$ myage=20
$ bash

The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
bash-3.2$ echo $myname
frankie
bash-3.2$ echo $myage

bash-3.2$ 
</code></pre>
<p>å…¶ä»–å°±ä¸å±•å¼€äº†ï¼Œä¸ç„¶å°±è·‘åäº†ï¼Œæœ‰å…´è¶£å¯çœ‹é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ï¼š<a href="https://wangdoc.com/bash/variable.html#%E5%88%9B%E5%BB%BA%E5%8F%98%E9%87%8F">Bash å˜é‡</a>ã€‚</p>
<h3>8.3 å¸¸è§å˜é‡</h3>
<p>å¸¸è§ç¯å¢ƒå˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>USER</td>
<td>å½“å‰ç™»å½•ç”¨æˆ·ã€‚</td>
</tr>
<tr>
<td>PWD</td>
<td>å½“å‰å·¥ä½œç›®å½•ã€‚</td>
</tr>
<tr>
<td>OLDPWD</td>
<td>ä¸Šä¸€ä¸ªå·¥ä½œç›®å½•ã€‚</td>
</tr>
<tr>
<td>PATH</td>
<td>ç³»ç»ŸæŸ¥æ‰¾æŒ‡ä»¤æ—¶ä¼šæ£€æŸ¥çš„ç›®å½•åˆ—è¡¨ã€‚å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæŒ‡ä»¤æ—¶ï¼Œç³»ç»Ÿå°†ä¼šæŒ‰æ­¤ç›®å½•åˆ—è¡¨çš„é¡ºåºæ£€ç´¢ç›®å½•ï¼Œä»¥å¯»æ‰¾ç›¸åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>LANG</td>
<td>å½“å‰çš„è¯­è¨€å’Œæœ¬åœ°åŒ–è®¾ç½®ï¼ŒåŒ…æ‹¬å­—ç¬¦ç¼–ç ã€‚</td>
</tr>
<tr>
<td>HOME</td>
<td>å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</td>
</tr>
<tr>
<td>SHELL</td>
<td>å½“å‰ç³»ç»Ÿçš„é»˜è®¤ Shellã€‚</td>
</tr>
<tr>
<td>TERM</td>
<td>ç»ˆç«¯ç±»å‹åï¼Œå³ç»ˆç«¯ä»¿çœŸå™¨æ‰€ç”¨çš„åè®®ã€‚</td>
</tr>
</tbody>
</table>
<p>å¸¸è§çš„ Shell å˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>COLUMNS</td>
<td>ç”¨äºè®¾ç½®ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„è¾“å‡ºä¿¡æ¯çš„å®½çš„åˆ—æ•°ã€‚</td>
</tr>
<tr>
<td>HOSTNAME</td>
<td>ä¸»æœºåã€‚</td>
</tr>
<tr>
<td>PS1</td>
<td>å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€‚</td>
</tr>
<tr>
<td>PS2</td>
<td>è¾“å…¥å¤šè¡Œå‘½ä»¤æ—¶ï¼Œå‘½ä»¤æç¤ºç¬¦æ ·å¼ã€‚</td>
</tr>
</tbody>
</table>
<h3>8.4 ç‰¹æ®Šå˜é‡</h3>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$?</code></td>
<td>ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºç ï¼Œç”¨äºåˆ¤æ–­ä¸Šä¸€ä¸ªå‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚è¿”å›å€¼ä¸º <code>0</code> è¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œå¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>å½“å‰ Shell çš„è¿›ç¨‹ IDã€‚</td>
</tr>
<tr>
<td><code>$_</code></td>
<td>ä¸Šä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚</td>
</tr>
<tr>
<td><code>$!</code></td>
<td>æœ€è¿‘ä¸€ä¸ªåå°æ‰§è¡Œçš„å¼‚æ­¥å‘½ä»¤çš„è¿›ç¨‹ IDã€‚</td>
</tr>
<tr>
<td><code>$0</code></td>
<td>åœ¨ CLI ç›´æ¥æ‰§è¡Œæ—¶ï¼Œè¡¨ç¤ºå½“å‰ Shell çš„åç§°ã€‚åœ¨ Shell è„šæœ¬æ‰§è¡Œæ—¶ï¼Œè¡¨ç¤ºå½“å‰è„šæœ¬åç§°ã€‚</td>
</tr>
<tr>
<td><code>$@</code>ã€<code>$#</code></td>
<td><code>$@</code> è¡¨ç¤ºè„šæœ¬çš„å‚æ•°å€¼ï¼›<code>$#</code> è¡¨ç¤ºè„šæœ¬çš„å‚æ•°æ•°é‡ã€‚</td>
</tr>
</tbody>
</table>
<h3>8.5 å˜é‡æŒä¹…åŒ–</h3>
<p>è‹¥ä¸å¸Œæœ›æ¯æ¬¡å¯åŠ¨æ–°çš„ Shell ä¼šè¯æ—¶ï¼Œéƒ½å¿…é¡»é‡æ–°è®¾ç½®é‡è¦çš„å˜é‡ï¼Œåˆ™éœ€è¦å°†å˜é‡å†™å…¥é…ç½®æ–‡ä»¶ä¸­ã€‚ä»¥ macOS ä¸ºä¾‹ï¼Œæœ€å¸¸è§çš„æ˜¯é…ç½®æ–‡ä»¶æ˜¯ <code>~/.bash_profile</code> æˆ– <code>~/.zshrc</code>ï¼Œå…·ä½“å–å†³äºä½ çš„ä½¿ç”¨äº†å“ªä¸€ç§ Shell è§£æå™¨ï¼Œè¯·å‚è€ƒå‰é¢çš„ç¬¬ä¸ƒèŠ‚å†…å®¹ã€‚</p>
<p>æ¯”å¦‚æˆ‘åœ¨ <code>~/.zshrc</code> ä¸­é…ç½® <a href="https://github.com/nvm-sh/nvm/blob/master/README.md">nvm</a> çš„ç›®å½•ï¼Œå¯ä»¥æ·»åŠ è¿™æ ·ä¸€è¡Œé…ç½®ï¼š</p>
<pre><code class="language-shell">export NVM_DIR=&quot;$HOME/.nvm&quot;
</code></pre>
<p>å…¶ä¸­ <code>$HOME</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ˆè¡¨ç¤ºå½“å‰ç”¨æˆ·ä¸»ç›®å½•ï¼‰ï¼Œå‡è®¾æˆ‘çš„ä¸»ç›®å½•æ˜¯ <code>/Users/frankie</code>ï¼Œé‚£ä¹ˆå˜é‡ <code>NVM_DIR</code> çš„å€¼å°±æ˜¯ <code>/Users/frankie/.nvm</code>ã€‚</p>
<p>å¹³å¸¸é…ç½®æœ€å¤šçš„å¯èƒ½æ˜¯ PATH å˜é‡ï¼Œå‡è®¾å®‰è£…äº†ä¸€ä¸ªå·¥å…· Aï¼Œç„¶åéœ€è¦é…ç½®è¯¥å·¥å…·çš„å¯æ‰§è¡Œæ–‡ä»¶ <code>aaa</code> çš„è·¯å¾„ï¼ˆå‡è®¾ä¸º <code>~/.aaa/bin</code>ï¼‰ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-shell">export PATH=$PATH:$HOME/.aaa/bin
</code></pre>
<p>å¦‚æ­¤ <code>/Users/frankie/.aaa/bin</code> å°±ä¼šè¢«æ·»åŠ è‡³ç¯å¢ƒå˜é‡ PATH ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹æ‰§è¡Œ <code>aaa</code> å‘½ä»¤äº†ã€‚</p>
<p>è®°å¾—é…ç½®å®Œï¼Œè¦ä½¿ç”¨ç±»ä¼¼ <code>source ~/.zshrc</code> çš„å‘½ä»¤åˆ·æ–°å˜é‡ï¼Œä½¿å…¶åœ¨å·²å¯åŠ¨çš„ Shell è¿›ç¨‹ä¸­ç”Ÿæ•ˆï¼Œå¦åˆ™åªåœ¨æ–°æ‰“å¼€çš„ Shell è¿›ç¨‹ä¸­ç”Ÿæ•ˆã€‚å› ä¸ºæ¯æ¬¡å¯åŠ¨ä¸€ä¸ªæ–°çš„ Shell è¿›ç¨‹éƒ½ä¼šå…ˆè¯»å–å¯¹åº”çš„ Shell é…ç½®æ–‡ä»¶ï¼Œç„¶åè¿™ä¸ªåˆ·æ–°å‘½ä»¤æœ¬è´¨ä¸Šå°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ª Shell è„šæœ¬è€Œå·²ï¼Œè¿™äº›å†…å®¹åœ¨å‰ä¸€èŠ‚æåˆ°è¿‡äº†ã€‚</p>
<h2>ä¹ã€å¸¸è§ç›®å½•åŒºåˆ†</h2>
<blockquote>
<ul>
<li><code>bin</code> - æ˜¯ binary çš„ç¼©å†™ï¼Œè¡¨ç¤ºå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºå…·ä½“åº”ç”¨ã€‚</li>
<li><code>sbin</code> - æ˜¯ system binary çš„ç¼©å†™ï¼Œè¡¨ç¤ºç³»ç»Ÿçº§åˆ«çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºç³»ç»Ÿç®¡ç†ã€‚</li>
<li><code>etc</code> - æºè‡ªæ‹‰ä¸è¯­ et ceteraï¼Œæ˜¯ã€Œç­‰ç­‰ã€çš„æ„æ€ï¼Œç”¨äºå­˜æ”¾æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ã€‚å…¶å‘½åä¼¼ä¹æ˜¯å†å²é—ç•™é—®é¢˜ï¼Œæœ€åˆç”¨äºå­˜æ”¾ä¸€äº›é›¶é›¶ç¢ç¢çš„æ–‡ä»¶ã€‚å¦ä¸€ç§è¯´æ³•æ˜¯ Editable Text Configurationã€‚</li>
<li><code>usr</code> - æ˜¯ unix system resources çš„ç¼©å†™ï¼Œå®ƒæ˜¯ç³»ç»Ÿä¸­æœ€é‡è¦çš„ç›®å½•ä¹‹ä¸€ï¼Œæ¶µç›–äº†äºŒè¿›åˆ¶æ–‡ä»¶ã€å„ç§æ–‡æ¡£ã€å„ç§å¤´æ–‡ä»¶ã€xã€å„ç§åº“æ–‡ä»¶ä»¥åŠè¯¸å¤šç¨‹åºã€‚å¥½åƒä»¥å‰æ˜¯å­˜æ”¾ user çš„ç›®å½•ï¼Œå› æ­¤ä¹Ÿè®¤ä¸ºæ˜¯ user çš„ç¼©å†™ï¼Œä½†ç°åœ¨ç”¨æˆ·ç›®å½•å¤šæ˜¯ homeã€‚</li>
<li><code>var</code> - æ˜¯ varible çš„ç®€å†™ã€‚ç›®å½•ä¸­ä¿å­˜çš„æ˜¯æœªçŸ¥å¢é•¿å’Œå…¶å†…å®¹é¢‘ç¹å˜åŠ¨çš„æ–‡ä»¶ï¼ˆå› æ­¤åä¸ºå˜åŒ–çš„ï¼‰</li>
<li>æ›´å¤šè¯·çœ‹ <a href="https://learnku.com/server/wikis/36491">Linux ç›®å½•æ¦‚è§ˆ</a>ã€‚</li>
</ul>
</blockquote>
<p><code>/bin</code>ï¼šé€šå¸¸æ˜¯æ™®é€šç”¨æˆ·å’Œè¶…çº§ç”¨æˆ·éƒ½ä¼šç”¨åˆ°çš„å¿…è¦çš„å‘½ä»¤ï¼Œä¾‹å¦‚ <code>ls</code>ã€<code>pwd</code> ç­‰ç­‰ã€‚
<code>/sbin</code>ï¼šé€šå¸¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„å¿…è¦çš„æ¥ç®¡ç†ç³»ç»Ÿçš„å‘½ä»¤ï¼Œä¾‹å¦‚ <code>shutdown</code>ã€<code>ifconfig</code> ç­‰ç­‰ã€‚
<code>/usr/bin</code>ï¼šé€šå¸¸æ˜¯ä¸€äº›éå¿…è¦çš„ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·å’Œè¶…çº§ç”¨æˆ·éƒ½å¯èƒ½ä½¿ç”¨åˆ°çš„å‘½ä»¤ï¼Œä¾‹å¦‚ <code>gcc</code>ã€<code>ldd</code> ç­‰ç­‰ã€‚
<code>/usr/sbin</code>ï¼šé€šå¸¸æ˜¯ä¸€äº›éå¿…è¦çš„ï¼Œç”±ç³»ç»Ÿç®¡ç†å‘˜æ¥ä½¿ç”¨çš„ç®¡ç†ç³»ç»Ÿçš„å‘½ä»¤ï¼Œä¾‹å¦‚ <code>crond</code>ã€<code>httpd</code> ç­‰ç­‰ã€‚
<code>/usr/local/bin</code>ï¼šé€šå¸¸æ˜¯ç”¨æˆ·åæ¥å®‰è£…çš„è½¯ä»¶ï¼Œå¯èƒ½è¢«æ™®é€šç”¨æˆ·æˆ–è¶…çº§ç”¨æˆ·ä½¿ç”¨ã€‚
<code>/usr/local/sbin</code>ï¼šé€šå¸¸æ˜¯ç”¨æˆ·åæ¥å®‰è£…çš„è½¯ä»¶ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥ç®¡ç†ç³»ç»Ÿçš„ï¼Œè¢«ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨ã€‚</p>
<p>ä»ç”¨æˆ·æƒé™è§’åº¦æ¥çœ‹ï¼Œ<code>sbin</code> ä¸‹çš„å‘½ä»¤éƒ½æ˜¯ç”¨æ¥ç®¡ç†ç³»ç»Ÿçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯æ™®é€šç”¨æˆ·æ— æ³•æ‰§è¡Œï¼Œåªæœ‰ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œï¼Œè€Œ <code>bin</code> ä¸‹çš„å‘½ä»¤åˆ™æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œçš„ã€‚</p>
<p>æ³¨ï¼šä»¥ä¸Šæ‰€è¯´çš„å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼Œä¾‹å¦‚ <code>ifconfig</code> åœ¨ <code>/sbin</code> ä¸‹ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·ä¸€èˆ¬å…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚</p>
<h4>å°ç»“</h4>
<ul>
<li>å¦‚æœæ˜¯ç”¨æˆ·å’Œç®¡ç†å‘˜å¿…å¤‡çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±ä¼šæ”¾åœ¨ <code>/bin</code>ï¼›</li>
<li>å¦‚æœæ˜¯ç³»ç»Ÿç®¡ç†å‘˜å¿…å¤‡ï¼Œä½†æ˜¯ä¸€èˆ¬ç”¨æˆ·æ ¹æœ¬ä¸ä¼šç”¨åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°±ä¼šæ”¾åœ¨ <code>/sbin</code>ï¼›</li>
<li>å¦‚æœä¸æ˜¯ç”¨æˆ·å¿…å¤‡çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¤šåŠä¼šæ”¾åœ¨ <code>/usr/bin</code>ï¼›</li>
<li>å¦‚æœä¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜å¿…å¤‡çš„å·¥å…·ï¼Œå¦‚ç½‘ç»œç®¡ç†å‘½ä»¤ï¼Œå¤šåŠä¼šæ”¾åœ¨ <code>/usr/sbin</code>ï¼›</li>
</ul>
<h4>å…¶ä»–ç›®å½•</h4>
<ul>
<li>ä¸»ç›®å½•ï¼š<code>/root</code>ã€<code>/home/username</code></li>
<li>ç”¨æˆ·å¯æ‰§è¡Œæ–‡ä»¶ï¼š<code>/bin</code>ã€<code>/usr/bin</code>ã€<code>/usr/local/bin</code></li>
<li>ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶ï¼š<code>/sbin</code>ã€<code>/usr/sbin</code>ã€<code>/usr/local/sbin</code></li>
<li>å…¶ä»–æŒ‚è½½ç‚¹ï¼š<code>/media</code>ã€<code>/mnt</code></li>
<li>é…ç½®ï¼š<code>/etc</code></li>
<li>ä¸´æ—¶æ–‡ä»¶ï¼š<code>/tmp</code></li>
<li>å†…æ ¸å’Œ Bootloaderï¼š<code>/boot</code></li>
<li>æœåŠ¡å™¨æ•°æ®ï¼š<code>/var</code>ã€<code>/srv</code></li>
<li>ç³»ç»Ÿä¿¡æ¯ï¼š<code>/proc</code>ã€<code>/sys</code></li>
<li>å…±äº«åº“ï¼š<code>/lib</code>ã€<code>/usr/lib</code>ã€<code>/usr/local/lib</code></li>
</ul>
<p>æœªå®Œå¾…ç»­...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[macOS é…ç½®æŒ‡å—]]></title>
            <link>https://github.com/toFrankie/blog/issues/31</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/31</guid>
            <pubDate>Sat, 25 Feb 2023 11:02:06 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1753601186964.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>å®‰è£… Command Line Toolsï¼Œå¾ˆå¤šå‘½]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/7/1753601186964.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å¼€å§‹ä¹‹å‰</h2>
<p>å®‰è£… Command Line Toolsï¼Œå¾ˆå¤šå‘½ä»¤è¡Œå·¥å…·éƒ½ä¾èµ–å®ƒã€‚</p>
<pre><code class="language-shell">$ xcode-select --install
</code></pre>
<p>å®‰è£… Homebrewï¼ˆå‚è€ƒ<a href="https://github.com/toFrankie/blog/issues/9">æ­¤æ–‡</a>ï¼‰ï¼Œé™¤äº†å‘½ä»¤è¡Œå·¥å…·ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®‰è£…å›¾å½¢åŒ–åº”ç”¨ã€‚</p>
<p>å¦‚æœä¸æ¸…æ¥šåŒ…åçš„ï¼Œå¯ä»¥ç”¨ <code>brew search &lt;keyword&gt;</code> è¿›è¡Œæ¨¡ç³Šæœç´¢ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-shell">$ brew search alfred
==&gt; Formulae
fred                                                                   alure

==&gt; Casks
alfred                                                                 alfred@4
</code></pre>
<h2>ç³»ç»Ÿåå¥½è®¾ç½®</h2>
<p>â–¼ ä¸ªäººä¸»è§‚æ„Ÿå—çš„ä¸€äº›è®¾ç½®ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
<h3>è§¦æ§æ¿</h3>
<ul>
<li>å¼€å¯ã€Œè½»ç‚¹æ¥ç‚¹æŒ‰ã€ï¼šè½»è§¦å®ç°é¼ æ ‡å•å‡»æ•ˆæœã€‚</li>
<li>å°†ã€Œåœ¨å…¨å±å¹•æ˜¾å¼çš„åº”ç”¨ç¨‹åºä¹‹é—´è½»æ‰«ã€è°ƒæ•´ä¸ºã€Œå››æŒ‡å·¦å³è½»æ‰«ã€ï¼Œè¿™æ ·è§¦å‘æˆåŠŸç‡æ›´é«˜ï¼Œç›¸æ¯”ä¸‰æŒ‡ä¼šæ›´èˆ’æœäº›ã€‚</li>
</ul>
<h3>ä¸‰æŒ‡æ‹–ç§»åº”ç”¨çª—å£</h3>
<p>å‰å¾€ã€Œç³»ç»Ÿåå¥½è®¾ç½® - è¾…åŠ©åŠŸèƒ½ - æŒ‡é’ˆæ§åˆ¶ï¼ˆæˆ–é¼ æ ‡ä¸è§¦æ§æ¿ï¼‰ - è§¦æ§æ¿é€‰é¡¹ - æ‹–åŠ¨æ ·å¼ã€ï¼Œé€‰æ‹©ã€Œä¸‰æŒ‡æ‹–ç§»ã€ã€‚æ›´å¤šå¯å‚è€ƒ<a href="https://support.apple.com/zh-cn/HT204609">è¿™é‡Œ</a>ã€‚</p>
<p>è¿™æ ·ï¼Œå°†é¼ æ ‡ç§»åŠ¨åº”ç”¨é¡¶éƒ¨ï¼Œä¸‰æŒ‡å°±èƒ½æ‹–åŠ¨åº”ç”¨çª—å£äº†ã€‚</p>
<h3>å…³é—­è‡ªåŠ¨æ›´æ¢æ¡Œé¢é¡ºåº</h3>
<p>å‚è€ƒ<a href="https://github.com/toFrankie/blog/issues/310">è§£å†³ macOS è‡ªåŠ¨æ›´æ¢æ¡Œé¢ä½ç½®çš„é—®é¢˜</a>ã€‚</p>
<h3>ä¿®æ”¹é¼ æ ‡æ–¹å‘</h3>
<p>ä¸¥æ ¼æ¥è¯´ macOS é»˜è®¤çš„ã€Œè‡ªç„¶æ–¹å‘ã€ï¼Œä¸ªäººè®¤ä¸ºæ˜¯ç¬¦åˆè§¦æ§åœºæ™¯çš„ã€‚è¿™ç‚¹ä¸æ‰‹æœºä½“éªŒæ˜¯ä¸€è‡´çš„ï¼Œåº”è¯¥æ²¡æœ‰äººè®¤ä¸ºæ‰‹æœºè§¦æ§å±çš„æ»‘åŠ¨æ–¹å‘æ˜¯åäººç±»çš„å§ã€‚</p>
<p>é‚£ä¹ˆåœ¨ macOS ä¸Šä¸ºä»€ä¹ˆå¤‡å—äº‰è®®å‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œç»å¤§å¤šæ•°äººéƒ½æ˜¯ä» Windows æ“ä½œç³»ç»Ÿå¼€å§‹æ¥è§¦ç”µè„‘çš„ï¼ŒåŠ ä¹‹å¸‚é¢ä¸Šç»å¤§å¤šæ•°çš„é¼ æ ‡ä¹Ÿæ˜¯ã€Œæ»šè½®å¼ã€çš„ï¼Œåœ¨èº«ä½“å·²ç»å½¢æˆæ¡ä»¶åå°„ä¹‹åï¼Œåˆæ¬¡æ¥è§¦åˆ° macOS çš„è‡ªç„¶æ–¹å‘å¼çš„æ“ä½œä¹‹åï¼Œæ˜¯æ˜¾ç„¶ä¼šæŠµè§¦çš„ï¼Œè‡ªç„¶ä¼šè¢«äººè§†ä¸ºåäººç±»ã€‚ä½†æ˜¯ Apple è‡ªå®¶çš„ Magic Mouse ä¸€ç›´éƒ½æ˜¯ã€Œè§¦æ§å¼ã€çš„å•Šï¼Œå®ƒæ²¡æœ‰æ»šè½®ï¼Œå› æ­¤å®ƒçš„æ»‘åŠ¨çš„æ–¹å‘ä¸è§¦æ§æ¿ä¸€è‡´é€»è¾‘ä¸Šæ˜¯æ­£ç¡®çš„ã€‚</p>
<p>è™½ç„¶ä½†æ˜¯...ï¼Œç”±äºå¹³å¸¸ç”¨å¾—æœ€å¤šçš„æ˜¯æ»šè½®é¼ æ ‡ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶å»è°ƒæ•´é¼ æ ‡çš„æ»šåŠ¨æ–¹å‘ã€‚è¿™é‡Œæ¨è <a href="https://pilotmoon.com/scrollreverser/">Scroll Reverser</a>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-387897079a5ed93f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>æ‰“å¼€ä»»ä½•æ¥æº</h3>
<pre><code class="language-shell">$ sudo spctl â€“master-disable
</code></pre>
<p>ä¹Ÿå¯ä»¥è®¾ç½® alias ä»¥ä¾¿äºè®°å¿†ã€‚</p>
<pre><code class="language-shell">$ echo 'alias allow-anywhere=&quot;sudo spctl --master-disable&quot;' &gt;&gt; ~/.zshrc
$ echo 'alias close-anywhere=&quot;sudo spctl --master-enable&quot;' &gt;&gt; ~/.zshrc
</code></pre>
<p>æœ‰ä¸ªå›¾å½¢åŒ–çš„å°å·¥å…·ï¼Œå¯ä»<a href="https://pan.baidu.com/s/1IFPgSbhzVfIiZywllupsOg?pwd=kuwb">è¿™é‡Œ</a>è·å–ã€‚</p>
<h3>è°ƒæ•´ LaunchPad å›¾æ ‡å¤§å°</h3>
<p>ä»¥ MacBook ä¸ºä¾‹ï¼Œé»˜è®¤ä¸€å± 7 Ã— 5 çš„å›¾æ ‡æ•°é‡ï¼Œå¯æŒ‰è°ƒæ•´å¤§å°ã€‚</p>
<pre><code class="language-shell"># è¡Œæ•°é‡
$ defaults write com.apple.dock springboard-columns -int 9

# åˆ—æ•°é‡
$ defaults write com.apple.dock springboard-rows -int 6

# é‡ç½® LaunchPad
$ defaults write com.apple.dock ResetLaunchPad -bool TRUE

# æ€æ‰ Dock æ è¿›ç¨‹
$ killall Dock
</code></pre>
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-bc5ca19ac54fbe6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p>å¦‚éœ€æ¢å¤é»˜è®¤çŠ¶æ€ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ defaults write com.apple.dock springboard-columns -int Default
$ defaults write com.apple.dock springboard-rows -int Default
$ defaults write com.apple.dock ResetLaunchPad -bool TRUE
$ killall Dock
</code></pre>
<h2>ç³»ç»Ÿå¢å¼º</h2>
<h3>QuickLook</h3>
<p>ä½¿ç”¨ã€Œç©ºæ ¼é”®ã€ä»¥å¿«é€Ÿé¢„è§ˆæ˜¯ macOS çš„ä¸€å¤§ç‰¹è‰²ã€‚</p>
<p>å¯æŸäº›æ–‡ä»¶ç±»å‹å¹¶ä¸æ”¯æŒé¢„è§ˆå™¨å†…å®¹ï¼Œå¯é€šè¿‡å®‰è£…æ’ä»¶çš„å½¢å¼æ¥æ‰©å±•ã€‚</p>
<p>è¯¦è§ <a href="https://github.com/toFrankie/blog/issues/11">macOS QuickLook å¸¸ç”¨æ’ä»¶</a>ã€‚</p>
<h3>Finder æ’ä»¶</h3>
<p>æŒ‰ä½ Option é”®ï¼Œæ‹–åŠ¨çª—å£å¤§å°ï¼Œå¯ç”¨äºè°ƒæ•´æ¯æ¬¡æ‰“å¼€ Finder çª—å£çš„é»˜è®¤å°ºå¯¸ã€‚</p>
<p>è™½ç„¶ Finder çš„é¢œå€¼è¶Šæ¥è¶Šå¥½ï¼Œä½†æ¶ä¸ä½åŠŸèƒ½ç®€é™‹ã€‚</p>
<p>æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª TXT çš„çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¦‚æœä¸ç”¨å‘½ä»¤è¡Œçš„è¯ï¼Œä½ èƒ½æƒ³åˆ°å…¶ä»–åŠæ³•å—ï¼Ÿ</p>
<p>æ¨èä¸¤ä¸ª Finder æ’ä»¶ï¼š</p>
<ul>
<li><a href="https://www.trankynam.com/xtrafinder/">XtraFinder</a></li>
<li><a href="https://totalfinder.binaryage.com/">TotalFinder</a></li>
</ul>
<!--

é—®é¢˜è®°å½•ï¼š

- ã€2020.04.20ã€‘[è§£å†³ XtraFinderã€TotalFinder æ— æ³•å®‰è£…çš„é—®é¢˜](https://github.com/toFrankie/blog/issues/13)
- ~~ã€2022.11.11ã€‘ç›®å‰ XtraFinderã€TotalFinder æš‚æœªå®Œå…¨å…¼å®¹æœ€æ–°çš„ macOS Ventura ç³»ç»Ÿã€‚æ¯”å¦‚ TotalFinder å¯¼è‡´å³é”®æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œç›¸å…³é—®é¢˜ [Ventura problems](https://discuss.binaryage.com/t/ventura-problems/8449)ã€‚~~
- ã€2022.11.11ã€‘è‹¥åœ¨ macOS Ventura ä½¿ç”¨ Itsycal é‡åˆ°å´©æºƒé—®é¢˜ï¼Œè¯·çœ‹ [Blog/Ventura](https://www.mowglii.com/2022/11/05/ventura.html)ã€‚
- ã€2023.07.06ã€‘ç›®å‰ [XtraFinder v1.8](https://www.trankynam.com/xtrafinder/) å’Œ [TotalFinder v1.15.1](https://totalfinder.binaryage.com/) å·²æ”¯æŒ macOS Venturaã€‚
- ~~ã€2023.09.27ã€‘ç›®å‰ [XtraFinder v1.8](https://www.trankynam.com/xtrafinder/) ä¸å…¼å®¹ macOS Sonomaï¼Œç‚¹å‡» Finder å›¾æ ‡æ— æ³•æ‰“å¼€åº”ç”¨ã€‚~~
- ã€2024.10.19ã€‘ç›®å‰ [XtraFinder v1.9](https://www.trankynam.com/xtrafinder/) ä¸å…¼å®¹ macOS Sonomaï¼Œç‚¹å‡» Finder å›¾æ ‡ä»ç„¶æ— æ³•æ‰“å¼€åº”ç”¨ã€‚

-->
<h3>Finder éšè—æ€§æ–‡ä»¶æ˜¾éš</h3>
<p>å¿«æ·é”®ï¼š<code>Command + Shift + .</code></p>
<p>ç»ˆç«¯å‘½ä»¤å¦‚ä¸‹ï¼Œä½†ä½“éªŒä¸å¥½ï¼Œä¸ killall çš„è¯ï¼Œä¸ä¼šåˆ·æ–°ã€‚</p>
<pre><code class="language-shell"># æ˜¾ç¤ºã€Œéšè—æ–‡ä»¶ã€
$ defaults write com.apple.Finder AppleShowAllFiles YES; killall Finder;

# ä¸æ˜¾ç¤ºã€Œéšè—æ–‡ä»¶ã€
$ defaults write com.apple.Finder AppleShowAllFiles NO; killall Finder;
</code></pre>
<h3>ç¬¬ä¸‰æ–¹å¢å¼º</h3>
<ul>
<li><a href="https://www.raycast.com/">Raycast</a>ï¼Œä¸€ä¸ªæ¯” Alfred æ›´å¥½ç”¨çš„å¯åŠ¨å™¨ã€‚</li>
<li><s><a href="https://www.alfredapp.com/">Alfred</a>ï¼Œæˆ–è®¸æ˜¯æ¯”å†…ç½® Spotlight æ›´å¥½çš„é€‰æ‹©ï¼Œç”Ÿæ€ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¾¿æ·ã€å¥½ç”¨çš„ Workflowsã€‚</s>ï¼ˆç°æ›´æ¨è Raycastï¼‰</li>
<li><a href="https://www.trankynam.com/xtrafinder/">XtraFinder</a>ï¼ŒFinder å¢å¼ºæ’ä»¶ï¼Œå¯æƒœé¢œå€¼æ²¡è·Ÿä¸Šæœ€æ–°çš„ Finderã€‚</li>
<li><a href="https://totalfinder.binaryage.com/">TotalFinder</a>ï¼ŒFinder å¢å¼ºæ’ä»¶ï¼Œå¯å®ç°ç±»ä¼¼ Chrome çš„å¤šæ ‡ç­¾ã€‚</li>
<li><a href="https://pilotmoon.com/scrollreverser/">Scroll Reverser</a>ï¼Œè¿˜åœ¨ä¸º macOS è§¦æ§æ¿ã€é¼ æ ‡çš„â€œè‡ªç„¶â€æ–¹å‘æŠ“ç‹‚ï¼Ÿè¯•è¯•è¿™ä¸ªå§ã€‚</li>
<li><a href="https://www.mowglii.com/itsycal/">Itsycal for Mac</a>ï¼Œèœå•æ æ—¥å†å¢å¼ºæ’ä»¶ï¼Œé¢œå€¼èƒ½æ‰“ï¼Œè€Œä¸”å¯ä»¥åœ¨èœå•æ æŸ¥çœ‹æ—¥ç¨‹ç­‰äº¤äº’ã€‚</li>
</ul>
<h2>ç»ˆç«¯</h2>
<blockquote>
<p>ä¸ªäººæ²¡æ€ä¹ˆç”¨ç¬¬ä¸‰æ–¹ç»ˆç«¯åº”ç”¨ã€‚</p>
</blockquote>
<p><a href="https://ohmyz.sh/">Oh My Zsh</a></p>
<p>zsh Shell å¢å¼ºï¼Œå…æ‰ç¹ççš„ zsh é…ç½®ï¼Œä½¿å¾—ç»ˆç«¯æ›´åŠ ä¾¿æ·é«˜æ•ˆã€‚</p>
<p>ä¸€ä¸ªå¾ˆä¸é”™çš„æ’ä»¶ <a href="https://github.com/zsh-users/zsh-autosuggestions/blob/master/INSTALL.md">zsh-autosuggestions</a>ï¼Œæä¾›å†å²å‘½ä»¤æç¤ºã€‚</p>
<p>ä¸€ä¸ªè‡ªè¡Œè°ƒé…çš„ Dark Mode ç³»ç»Ÿç»ˆç«¯é…è‰² <a href="https://github.com/toFrankie/terminal-dark-theme">Terminal Dark Theme</a>ï¼Œé¢œå€¼è¿˜å¯ä»¥ï¼Œé…åˆ Oh My Zsh å‘³æ›´ä½³ã€‚</p>
<h2>å¼€å‘</h2>
<blockquote>
<p>åå‰ç«¯å¼€å‘æ–¹å‘ã€‚</p>
</blockquote>
<h3>è®¿é—® GitHub</h3>
<p>æœ€ä¼˜è§£æ˜¯ç§‘å­¦ä¸Šç½‘ã€‚å…¶æ¬¡å‚è€ƒï¼š</p>
<ul>
<li><a href="https://github.com/521xueweihan/GitHub520">GitHub520</a></li>
<li><a href="https://github.com/hawtim/hawtim.github.io/issues/10">å¦‚ä½•è§£å†³ç±»ä¼¼ curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused çš„é—®é¢˜</a></li>
</ul>
<h3>Git</h3>
<p>å®‰è£…</p>
<pre><code>$ brew install git
</code></pre>
<p>SSH Key</p>
<pre><code class="language-shell"># ç”Ÿæˆå…¬é’¥ã€å¯†é’¥
$ ssh-keygen -t rsa -C '&lt;your-email-address&gt;' -f ~/.ssh/id_rsa

# å°†ç§é’¥åŠ å…¥ ssh-agent
$ ssh-add ~/.ssh/id_rsa

# æ‹·è´å…¬é’¥
$ cat ~/.ssh/id_rsa.pub | clipcopy

# å°†å…¬é’¥æ·»åŠ åˆ°å¯¹åº”å¹³å°...
</code></pre>
<p>å…¨å±€é…ç½®</p>
<pre><code class="language-shell">$ git config --global user.name 'your-username'
$ git config --global user.email 'your-email-address'
</code></pre>
<p>Related link</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/105">Git é…ç½®å¤šä¸ª SSH-Key</a></li>
<li><a href="https://wangdoc.com/ssh/key">SSH å¯†é’¥ç™»å½•</a></li>
</ul>
<h3>Node.js</h3>
<p><s>å¯ä»¥åœ¨<a href="https://nodejs.org/en/download/">å®˜ç½‘</a>ä¸‹è½½å®‰è£…ï¼Œæˆ–è€…ä½¿ç”¨ Homebrew å®‰è£…ã€‚</s></p>
<p>å¦‚æœæ˜¯å‰ç«¯å¼€å‘ï¼Œæ¨èç”¨ <a href="https://github.com/nvm-sh/nvm">nvm</a>ã€<a href="https://github.com/toFrankie/blog/issues/96">fnm</a> ç­‰ç®¡ç† Node.js ç‰ˆæœ¬ï¼Œä»¥ä¾¿äºåœ¨é¡¹ç›®ä¹‹é—´åˆ‡æ¢ä¸åŒç‰ˆæœ¬ã€‚</p>
<p>ä»¥ nvm ä¸ºä¾‹ï¼š</p>
<pre><code class="language-shell"># å®‰è£…æŒ‡å®šç‰ˆæœ¬
$ nvm install 22

# å¯åŠ¨ corepackï¼Œå°±å¯ä»¥ç”¨ npmã€yarnã€pnpm äº†
$ corepack enable
</code></pre>
<p>NPM registry ç®¡ç†å·¥å…·</p>
<ul>
<li><a href="https://github.com/toFrankie/blog/issues/89">nrm</a></li>
<li><s><a href="https://github.com/toFrankie/blog/issues/91">yrm</a></s></li>
<li><a href="https://www.yunyoujun.cn/posts/nnrm-new-nrm">nnrm</a></li>
</ul>
<h2>æ—¥å¸¸è½¯ä»¶</h2>
<p>é™¤ä¸Šæ–‡ç³»ç»Ÿå¢å¼ºæåˆ°çš„è½¯ä»¶å¤–ï¼Œè¿˜æœ‰...</p>
<ul>
<li><a href="https://www.google.com/intl/zh-CN/chrome/">Chrome</a>ï¼Œæ—¥å¸¸ä½¿ç”¨æœ€å¤šçš„è½¯ä»¶ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</li>
<li><a href="https://www.mozilla.org/zh-CN/firefox/all/#product-desktop-developer">Firefox</a>ï¼Œå¼€å‘è€…ç‰ˆæœ¬ï¼Œè°ƒè¯• CSS å¾ˆæ£’ã€‚</li>
<li><a href="https://www.microsoft.com/zh-cn/edge">Edge</a>ï¼ŒåŸºäº Chromiumï¼Œä½†é¢œå€¼æ‰“ä¸è¿‡ Chromeã€‚</li>
<li><a href="https://pinyin.sogou.com/mac/">æœç‹—è¾“å…¥æ³•</a>ï¼Œè‡ªå®šä¹‰çŸ­è¯­è®¾ç½®å¾ˆä¸é”™ã€‚</li>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a>ï¼Œå‰ç«¯å¿…å¤‡å§ã€‚</li>
<li><a href="https://www.smartisan.com/apps/#/handshaker">HandShaker</a>ï¼Œè¿æ¥ Android è®¾å¤‡è¿›è¡Œæ–‡ä»¶ç®¡ç†ï¼Œè€ç½—å‡ºå“ï¼Œä½†å¤šå¹´ä¸æ›´æ–°äº†ã€‚</li>
<li><s><a href="https://github.com/yichengchen/clashX">ClashX</a>ï¼Œä½ æ‡‚çš„</s>ï¼ˆä½œè€…å·²åˆ åº“ï¼‰ã€‚</li>
<li><a href="https://apps.apple.com/cn/app/ishot-%E4%BC%98%E7%A7%80%E7%9A%84%E6%88%AA%E5%9B%BE%E8%B4%B4%E5%9B%BE%E5%BD%95%E5%B1%8F%E5%BD%95%E9%9F%B3ocr%E7%BF%BB%E8%AF%91%E5%8F%96%E8%89%B2%E6%A0%87%E6%B3%A8%E5%B7%A5%E5%85%B7/id1485844094?mt=12">iShot</a>ï¼Œå…è´¹çš„æˆªå›¾å·¥å…·ï¼ˆä¸ªäººåå¥½è®¾ç½®é˜´å½±å¤§å° 6ptï¼Œåœ†è§’å¤§å° 10ptï¼‰ã€‚å¯æƒœæ›´å–œæ¬¢çš„<a href="https://apps.apple.com/cn/app/%E6%88%AA%E5%9B%BE-jietu-%E5%BF%AB%E9%80%9F%E6%A0%87%E6%B3%A8-%E4%BE%BF%E6%8D%B7%E5%88%86%E4%BA%AB%E7%9A%84%E6%88%AA%E5%B1%8F%E5%B7%A5%E5%85%B7/id1059334054?mt=12">æˆªå›¾ï¼ˆJietuï¼‰</a>ä¸å†æ›´æ–°äº†ã€‚</li>
<li><a href="https://www.diagrams.net/">Diagram</a>ï¼Œè½¯ä»¶å¼€å‘ä½œå›¾è½¯ä»¶ï¼Œå…è´¹ã€å¼ºå¤§ä¸”å®Œå–„ï¼Œæœ‰ç½‘é¡µç‰ˆã€æ¡Œé¢ç‰ˆã€‚</li>
<li><a href="https://macpaw.com/cleanmymac">CleanMyMac X</a>ï¼ŒMacPaw å‡ºå“ï¼Œæ˜¯ macOS é‡Œè¾ƒä¸ºå—æ¬¢è¿çš„åƒåœ¾æ¸…ç†ã€è½¯ä»¶å¸è½½å·¥å…·ã€‚</li>
</ul>
<!--

é—®é¢˜è®°å½•ï¼š

> - ã€2022.11.13ã€‘[macos trustd securityd CPU è¿‡é«˜é—®é¢˜](https://www.jianshu.com/p/0b05e19245ce)
> - ã€2022.03.22ã€‘[è§£å†³ Sourcetree æŠ¥é”™ Couldn't posix_spawn: error 2 é—®é¢˜](https://github.com/toFrankie/blog/issues/24)
> - ã€2020.09.29ã€‘[Sourcetree è·³è¿‡æ³¨å†Œ](https://github.com/toFrankie/blog/issues/16)

-->
<p>æƒ³åˆ°å†è¡¥å……...</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Intel Mac å‡çº§ Win11 ç³»ç»Ÿ]]></title>
            <link>https://github.com/toFrankie/blog/issues/30</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/30</guid>
            <pubDate>Sat, 25 Feb 2023 11:01:33 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7cb2043f82fb92df.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7cb2043f82fb92df.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>æ­¤å‰å†™è¿‡ä¸€ç¯‡æ–‡ç«  <a href="https://www.jianshu.com/p/3c11b48ef274">Mac å‡çº§ Win11 ç³»ç»Ÿ</a>ï¼Œæåˆ°è¿‡ Intel Mac å¦‚ä½•ä» Win10 å‡çº§åˆ° Win11ï¼Œä½†å‰ææ˜¯è¯¥ Mac çš„å¤„ç†å™¨ã€TPM èŠ¯ç‰‡éœ€åŒæ—¶æ»¡è¶³ Win11 ç³»ç»Ÿçš„ç¡¬ä»¶è¦æ±‚ã€‚</p>
<p>ç„¶åï¼Œæˆ‘æ‰‹ä¸Šçš„ MacBook Pro 2016 æ¬¾ï¼ˆIntelï¼‰ï¼Œé€šè¿‡ <a href="https://aka.ms/GetPCHealthCheckApp">PC Health Check</a> æ£€æµ‹ï¼Œæ˜¯æ— æ³•æ»¡è¶³ Win11 å‡çº§è¦æ±‚çš„ã€‚ğŸ‘‡</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-77b70a14de09e690.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>The processor isn't currently supported for Windows 11.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘è¿™ä¸ªã€Œ2.9 GHz åŒæ ¸ Intel Core i5ã€å¤„ç†å™¨ä¸æ»¡è¶³ Win11 ç³»ç»Ÿçš„ç¡¬ä»¶è¦æ±‚ã€‚æ›´å¤šå¯çœ‹ <a href="https://support.microsoft.com/en-us/windows/windows-11-system-requirements-86c11283-ea52-4782-9efd-7674389a7ba3">Windows 11 System Requirements</a>ã€‚</p>
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<p>å¦‚æœä½ ã€Œäº†è§£å¹¶æ‰¿æ‹…ã€å‡çº§ç³»ç»Ÿå¯èƒ½å¸¦æ¥çš„<a href="https://support.microsoft.com/en-us/windows/installing-windows-11-on-devices-that-don-t-meet-minimum-system-requirements-0b2dc4a2-5933-4ad4-9c09-ef0a331518f1">é£é™©</a>ï¼Œå¯ä»¥åˆ›å»ºç‰¹å®šçš„æ³¨å†Œè¡¨é¡¹å€¼å¹¶ç»•è¿‡å¯¹ TPM 2.0 å’Œ CPU ç³»åˆ—å’Œå‹å·çš„æ£€æŸ¥ã€‚</p>
<h3>1. æ·»åŠ  TPM èŠ¯ç‰‡ã€‚</h3>
<p>å®‰è£… Parallels Desktop 17 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚åœ¨å¯¹åº”è™šæ‹Ÿæœºè®¾ç½®çš„ã€Œç¡¬ä»¶ã€é€‰é¡¹å¡ï¼Œæ·»åŠ ã€ŒTMP èŠ¯ç‰‡ã€ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8ec26ed3ba121f9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœè¯´åœ¨ã€Œ+ã€ä¸­æ²¡æœ‰æ‰¾åˆ°ã€ŒTPM èŠ¯ç‰‡ã€é€‰é¡¹ï¼Œè¡¨ç¤º Windows è™šæ‹ŸæœºåŸºäº Legacy BIOSã€‚TPM èŠ¯ç‰‡ä»…é€‚ç”¨äºUEFI/EFI BIOSã€‚æ­¤æ—¶ï¼Œéœ€è¦æ‰“å¼€è™šæ‹Ÿæœºè¿›è¡Œè®¾ç½®ï¼š</p>
<ol>
<li>åœ¨ä»»åŠ¡æ ä¸­æœç´¢ã€Œmsinfo32ã€ï¼Œå¹¶å›è½¦æ‰“å¼€ã€‚</li>
<li>åœ¨ã€Œç³»ç»Ÿæ‘˜è¦ã€ä¸­ï¼Œæ‰¾åˆ°ã€ŒBIOS æ¨¡å¼ã€æ£€æŸ¥æ˜¯å¦ä¸ºã€ŒUEFIã€ã€‚
<img src="https://upload-images.jianshu.io/upload_images/5128488-01f7dcdcb42d6a6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
</ol>
<h3>2. ä¸‹è½½ ISO é•œåƒ</h3>
<p>å‰å¾€ <a href="https://www.microsoft.com/en-us/software-download/windows11">Microsoft</a> ä¸‹è½½ Win11 é•œåƒæ–‡ä»¶ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3fe6a3b676884b0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>3. å°†é•œåƒæŒ‚è½½åˆ°è™šæ‹Ÿæœº</h3>
<p>ä¸‹è½½ Windows 11 ISO åï¼Œå°† ISO æŒ‚è½½åˆ°è™šæ‹Ÿæœºã€‚åœ¨èœå•æ ã€Œè®¾å¤‡ - CD/DVD 1 - è¿æ¥é•œåƒã€é€‰æ‹©ä¸‹è½½å¥½çš„ ISO é•œåƒæ–‡ä»¶ï¼Œç„¶ååœ¨åŒä¸€ä¸ªåœ°æ–¹ç‚¹ä¸€ä¸‹ã€Œè¿æ¥ã€ã€‚æ‰“å¼€ã€Œæˆ‘çš„ç”µè„‘ã€å°±èƒ½åœ¨ã€Œè®¾å¤‡å’Œé©±åŠ¨å™¨ã€ä¸­æ‰¾åˆ°è¿æ¥å¥½çš„é•œåƒã€‚å…¶ä¸­å‰é¢ CD/DVD 1 æˆ– 2 éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<p>ä¸‹å›¾æ˜¯è¿æ¥åçš„æˆªå›¾ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e6c21441154f5e28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>4. å®‰è£…é•œåƒ</h3>
<p>æ‰“å¼€å¯¹åº”çš„ DVD é©±åŠ¨å™¨ï¼Œå¦‚æ— æ„å¤–ï¼Œå°±ä¼šå‡ºç°å¦‚å›¾æ‰€ç¤ºçš„å®‰è£…ç¨‹åºã€‚ä¸€æ­¥ä¸€æ­¥å¾€ä¸‹è¿›è¡Œå³å¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-39e1d0a7a3788afc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å®‰è£…å¼•å¯¼ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°å‰é¢æåˆ°è¿‡çš„ã€Œé£é™©æé†’ã€ï¼Œé€‰æ‹©ã€ŒAcceptã€å³å¯ã€‚</p>
<blockquote>
<p>This PC doesn't meet the minimum system requirements for running Windows 11 - these requirements help ensure a more reliable and higher quality experience. Installing Windows 11 on this PC is not recommended and may result in compatibility issues. If you proceed with installing Windows 11, your PC will no longer be supported and won't be entitled to receive updates. Damages to your PC due to lack of compatibility aren't covered under the manufacturer warranty.</p>
</blockquote>
<p>ç„¶åå°±æ˜¯æ¼«é•¿çš„å®‰è£…è¿‡ç¨‹...</p>
<p>å®‰è£…å®Œæˆåï¼Œç®€å•ä½“éªŒäº†ä¸€ä¸‹ï¼Œæ²¡å•¥æ¯›ç—…...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1bb1e2af7f12c827.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>References</h2>
<ul>
<li><a href="https://kb.parallels.com/128517?language=cn">Fix &quot;The processor isn't supported&quot; issue when upgrading to Windows 11</a></li>
<li><a href="https://kb.parallels.com/122702?language=cn">Use virtual Trusted Platform Module (TPM) in Parallels Desktop</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å¼„æ¸…æ¥š HostNameã€LocalHostNameã€ComputerName ä¹‹é—´çš„åŒºåˆ«]]></title>
            <link>https://github.com/toFrankie/blog/issues/29</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/29</guid>
            <pubDate>Sat, 25 Feb 2023 11:00:37 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-52ae2ffc24f242ed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-52ae2ffc24f242ed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>ä¸€ã€ç®€ä»‹</h2>
<blockquote>
<ul>
<li><code>ComputerName</code> - ç”µè„‘åç§°ã€‚</li>
<li><code>LocalHostName</code> - æœ¬åœ°ä¸»æœºåã€‚</li>
<li><code>HostName</code> - ä¸»æœºåã€‚</li>
</ul>
</blockquote>
<p>å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<pre><code class="language-shell">$ hostname
host-0-1.can.xxx.network

$ scutil --get HostName
HostName: not set

$ scutil --get LocalHostName
Frankies-MacBook-Pro

$ scutil --get ComputerName
Frankie's MacBook Pro
</code></pre>
<p>åœ¨ macOS ä¸Šå¯åœ¨ã€Œç³»ç»Ÿåå¥½è®¾ç½® - å…±äº«ã€ä¸­æŸ¥çœ‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3ec05df70efe702e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œå…³äº HostName å‘½ä»¤è¡Œè¾“å‡ºä¸ç•Œé¢ä¸Šæ˜¾ç¤ºçš„ä¸ä¸€æ ·ï¼Œå…·ä½“åŸå› ä¸‹é¢ä¼šä»‹ç»ã€‚</p>
<!--
![](https://upload-images.jianshu.io/upload_images/5128488-2d1ecce3052459ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<h2>äºŒã€scutil ä½¿ç”¨</h2>
<p>ä»¥ macOS ä¸ºä¾‹ï¼Œ<code>HostName</code>ã€<code>LocalHostName</code>ã€<code>ComputerName</code> æ˜¯å¯ä»¥åœ¨ç³»ç»Ÿé…ç½®æ–‡ä»¶ <code>/Library/Preferences/SystemConfiguration/preferences.plist</code> çœ‹åˆ°çš„ã€‚å…¶ä¸­ <code>*.plist</code> è¡¨ç¤ºå±æ€§åˆ—è¡¨æ–‡ä»¶ï¼Œé€šå¸¸ç”¨æ¥å­˜å‚¨ç”¨æˆ·è®¾ç½®ã€‚</p>
<p>è¿™é‡Œæˆ‘æˆªå–äº†ä¸€éƒ¨åˆ†é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
	&lt;key&gt;CurrentSet&lt;/key&gt;
	&lt;string&gt;/Sets/1B16C032-311E-4EE7-A79F-7058C7340EE8&lt;/string&gt;
	&lt;key&gt;Model&lt;/key&gt;
	&lt;string&gt;MacBookPro13,2&lt;/string&gt;
	&lt;key&gt;System&lt;/key&gt;
	&lt;dict&gt;
		&lt;key&gt;Network&lt;/key&gt;
		&lt;dict&gt;
			&lt;key&gt;HostNames&lt;/key&gt;
			&lt;dict&gt;
				&lt;key&gt;LocalHostName&lt;/key&gt;
				&lt;string&gt;Frankies-MacBook-Pro&lt;/string&gt;
			&lt;/dict&gt;
		&lt;/dict&gt;
		&lt;key&gt;System&lt;/key&gt;
		&lt;dict&gt;
			&lt;key&gt;ComputerName&lt;/key&gt;
			&lt;string&gt;Frankie's MacBook Pro&lt;/string&gt;
			&lt;key&gt;ComputerNameEncoding&lt;/key&gt;
			&lt;integer&gt;25&lt;/integer&gt;
			&lt;!-- &lt;key&gt;HostName&lt;/key&gt;
			&lt;string&gt;å¦‚æœ‰è®¾ç½®çš„è¯ï¼ŒHostName å°†ä¼šåœ¨æ­¤å±•ç¤º&lt;/string&gt; --&gt;
		&lt;/dict&gt;
	&lt;/dict&gt;
	&lt;key&gt;__VERSION__&lt;/key&gt;
	&lt;integer&gt;20191120&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>å†å›å¤´çœ‹é€šè¿‡ <code>scutil</code> å‘½ä»¤è¾“å‡ºç»“æœå°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå®ƒè¯»å–çš„å°±æ˜¯æ­¤æ–‡ä»¶çš„å†…å®¹ç½¢äº†ã€‚</p>
<pre><code class="language-shell">$ scutil --get HostName
HostName: not set

$ scutil --get LocalHostName
Frankies-MacBook-Pro

$ scutil --get ComputerName
Frankie's MacBook Pro
</code></pre>
<p>å…¶ä¸­ <code>scutil --get HostName</code> è¾“å‡º <code>HostName: not set</code> å°±æ˜¯å› ä¸ºæœªæ›¾è®¾ç½®è¿‡ <code>HostName</code>ã€‚</p>
<h4>scutil çš„ç”¨æ³•</h4>
<p><code>scutil</code> å‘½ä»¤æ˜¯ç®¡ç†ç³»ç»Ÿé…ç½®çš„å·¥å…·ã€‚</p>
<p>æŸ¥çœ‹ã€è®¾ç½®é…ç½®ï¼š</p>
<pre><code class="language-shell">$ scutil --get &lt;pref&gt;
$ scutil --set &lt;pref&gt; &lt;newval&gt;
</code></pre>
<blockquote>
<p>å…¶ä¸­ <code>pref</code>ï¼ˆpreferenceï¼‰ç›®å‰ä»…æ”¯æŒ <code>ComputerName</code>ã€<code>LocalHostName</code>ã€<code>HostName</code>ã€‚</p>
</blockquote>
<p>æŸ¥çœ‹ DNS é…ç½®ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">$ scutil --dns
</code></pre>
<p>æŸ¥çœ‹ä»£ç†ä¿¡æ¯ï¼š</p>
<pre><code class="language-shell">$ scutil --proxy
</code></pre>
<p>æŸ¥çœ‹ç½‘ç»œä¿¡æ¯ï¼ˆIPv4/IPv6ï¼‰ï¼š</p>
<pre><code class="language-shell">$ scutil --nwi
</code></pre>
<p>æ›´è¯¦ç»†ç”¨æ³•å¯é€šè¿‡ <code>man scutil</code> æˆ– <code>scutil -h</code> æŸ¥çœ‹ã€‚</p>
<h2>ä¸‰ã€è¯»å– hostname</h2>
<p>å‰é¢ï¼Œæ‰§è¡Œ <code>hostname</code> å‘½ä»¤è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ hostname
host-0-1.can.xxx.network
</code></pre>
<p>å®ƒçœ‹ä¼¼ä¹èµ·æ¥ä¸ <code>LocalHostName</code>ã€<code>HostName</code> æ— å…³ï¼Ÿ</p>
<p>å…¶å®ä¸ç„¶ï¼Œå®ƒè·Ÿè¯»å–é¡ºåºæœ‰å…³ã€‚ä»¥ macOS ä¸ºä¾‹ï¼Œå…¶è¯»å–é¡ºåºå¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>ä» <code>/etc/hosts</code> æ–‡ä»¶è¯»å–ï¼ˆåœ¨ OS X Yosemite ä¹‹å‰ä¸º <code>/etc/hostconfig</code> æ–‡ä»¶ï¼‰ã€‚</li>
<li>ä»ç³»ç»Ÿé…ç½® <code>/Library/Preferences/SystemConfiguration/preferences.plist</code> è¯»å– <code>System â–¸ System â–¸ HostName</code>ã€‚</li>
<li>æ ¹æ®æœ¬æœº IP åœ°å€çš„åå‘ DNS æŸ¥è¯¢è·å–ã€‚</li>
<li>ä»ç³»ç»Ÿé…ç½® <code>/Library/Preferences/SystemConfiguration/preferences.plist</code> è¯»å– <code>System â–¸ Network â–¸ HostNames â–¸ LocalHostName</code>ã€‚</li>
<li>è‹¥ä»¥ä¸Šéƒ½æ— æ³•è·å–åˆ°ï¼Œåˆ™é»˜è®¤ä¸º <code>localhost</code>ã€‚</li>
</ul>
</blockquote>
<p>ç„¶åæˆ‘è¿™é‡Œçš„è¯ï¼Œæ˜¯åœ¨ç¬¬ä¸‰ä¸ªæ­¥éª¤é‡Œå¾—åˆ°çš„ã€‚æ ¹æ®åå‘ DNS åè®®ï¼Œå¯ä½¿ç”¨ IP åœ°å€æŸ¥è¯¢åˆ°å¯¹åº”çš„ HostNameï¼Œè¿™é‡Œåˆ©ç”¨åˆ° <code>nslookup</code> å‘½ä»¤ã€‚</p>
<p>å‡è®¾æˆ‘çš„æœ¬åœ° IP åœ°å€ä¸º <code>172.16.0.1</code>ï¼ˆä¹±å†™çš„ï¼‰ï¼Œåå‘ DNS æŸ¥è¯¢ç»“æœç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell">$ nslookup 172.16.0.1
Server:		172.24.0.2
Address:	172.24.0.2#53

0.1.16.172.in-addr.arpa	name = host-0-1.can.xxx.network.

</code></pre>
<h2>å››ã€hostname æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>æœªå®Œå¾…ç»­...</p>
<!--

## äº”ã€å‚è€ƒæ–‡ç« 

* [ææ‡‚ macOS ä¸Šçš„ä¸»æœºå/hostname/ComputerName](https://shockerli.net/post/macos-hostname-scutil/)
* [scutil å‘½ä»¤](http://blog.fpliu.com/it/os/macOS/software/scutil)
* [macOS - ComputerNameã€HostNameã€LocalHostNameã€UserNameã€FullUserNameã€NetBiosName](https://blog.csdn.net/lovechris00/article/details/88707690)
* [è®¡ç®—æœºåã€ä¸»æœºåã€ç”¨æˆ·è´¦æˆ·åä¸ NetBIOS åæœ‰ä»€ä¹ˆåŒºåˆ«](https://zhidao.baidu.com/question/103126974.html)
* [HOW TO FIND YOUR COMPUTER NAME](https://drexel.edu/it/help/a-z/computer-names/)
* [æµ…è°ˆä¸»æœºå](https://linux.cn/article-13897-1.html)
* [Linux æ“ä½œç³»ç»Ÿä¸»æœºåï¼ˆhostnameï¼‰ç®€è¯´ï¼ˆv0.1bï¼‰](http://scm.zoomquiet.top/data/20071021195338/index.html)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[macOS ç»ˆç«¯ç¾åŒ–ä¸ zsh å¤šè®¾å¤‡é…ç½®åŒæ­¥å…±äº«]]></title>
            <link>https://github.com/toFrankie/blog/issues/28</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/28</guid>
            <pubDate>Sat, 25 Feb 2023 10:59:23 GMT</pubDate>
            <description><![CDATA[<!--
![](https://upload-images.jianshu.io/upload_images/5128488-296beb21cddd78c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p><img src="https:]]></description>
            <content:encoded><![CDATA[<!--
![](https://upload-images.jianshu.io/upload_images/5128488-296beb21cddd78c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
-->
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1166a1634ff00f8b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>å‰è¨€</h2>
<p>å¯¹ iTerm2 ç­‰ç¬¬ä¸‰æ–¹ç»ˆç«¯å·¥å…·ä¸å¤§æ„Ÿå†’ï¼Œä¸€ç›´åœ¨ç”¨ç³»ç»Ÿå†…ç½®ç»ˆç«¯ã€‚</p>
<p>ä½†ç³»ç»Ÿç»ˆç«¯ç¡®å®ç®€é™‹ï¼Œç»ˆäºæœ‰ç©ºæŠ˜è…¾ä¸€ä¸‹å®ƒäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-59d7cf9e6c859a81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>ä¸ºä»€ä¹ˆé€‰æ‹© zshï¼Ÿ</h2>
<p>åœ¨ Unix-like æ“ä½œç³»ç»Ÿä¸­ä¾›é€‰æ‹©çš„ Shell è§£æå™¨ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ€å¸¸è§çš„æ˜¯ bash å’Œ zshã€‚</p>
<p>ä» macOS 10.15 èµ·ï¼Œç³»ç»Ÿä½¿ç”¨ zsh ä½œä¸ºé»˜è®¤ Shellï¼Œæ›´å¤šè¯·çœ‹ã€Œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fsupport.apple.com%2Fzh-cn%2FHT208050">åœ¨ Mac ä¸Šå°† zsh ç”¨ä½œé»˜è®¤ Shell</a>ã€ã€‚</p>
<p>ç›¸è¾ƒä¹‹ä¸‹ï¼Œzsh ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å®Œå…¨å…¼å®¹ bash</li>
<li>æ›´å¼ºå¤§çš„ Tab è¡¥å…¨</li>
<li>æ›´æ™ºèƒ½çš„ç›®å½•åˆ‡æ¢</li>
<li>å‘½ä»¤é€‰é¡¹è¡¥å…¨</li>
<li>æ–‡ä»¶ã€ç›®å½•å¤§å°å†™è‡ªåŠ¨æ›´æ­£</li>
<li>ä¸°å¯Œçš„ä¸»é¢˜ã€æ’ä»¶ï¼ˆOh My Zshï¼‰</li>
<li>å¯æŸ¥çœ‹å‘½ä»¤è¾“å…¥å†å²è®°å½•</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼ŒTab å¤§æ³•å¥½ã€‚</p>
<h2>Oh My Zsh</h2>
<p>zsh åŠŸèƒ½å¼ºå¤§ï¼Œä½†é…ç½®ç¹çï¼Œè¯¦è§ <a href="https://wiki.archlinux.org/title/Zsh">Archlinux Zsh</a>ã€‚</p>
<p>ç¤¾åŒºä¸Šçš„ <a href="https://github.com/ohmyzsh/ohmyzsh/">Oh My Zsh</a> é¡¹ç›®æå¤§åœ°æ”¹å˜äº†é…ç½®ç¹ççš„ç°è±¡ï¼Œå¹¶ä¸”å¸¦æ¥äº†å¼ºå¤§çš„æ’ä»¶å’Œä¸»é¢˜åŠŸèƒ½ã€‚</p>
<h3>å®‰è£…</h3>
<pre><code class="language-shell">$ sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;
</code></pre>
<p>å®‰è£…åå­˜äº <code>~/.oh-my-zsh</code> ç›®å½•ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒæä¾›çš„ä»»ä½•æ’ä»¶ã€ä¸»é¢˜ç­‰ã€‚</p>
<p>æ­¤å‰çš„ <code>.zshrc</code> é…ç½®æ–‡ä»¶ä¼šè¢«é‡å‘½åä¸º <code>.zshrc.pre-oh-my-zsh</code>ã€‚</p>
<h3>æ’ä»¶</h3>
<p>Oh My Zsh æä¾›äº†éå¸¸ä¸°å¯Œçš„æ’ä»¶ï¼Œè¯¦è§ <a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins">Plugins Wiki</a>ã€‚</p>
<p>å¦‚éœ€æ·»åŠ æ’ä»¶ï¼Œåœ¨ <code>~/.zshrc</code> å¼•å…¥å³å¯ã€‚æ¯”å¦‚ï¼ŒæŒ‰é¡ºåºå¯ç”¨ nvmã€gitã€ruby æ’ä»¶ï¼š</p>
<pre><code class="language-shell">plugins=(nvm git ruby)
</code></pre>
<blockquote>
<p>æ’ä»¶ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œä½†ä¸èƒ½ç”¨é€—å·ï¼Œå¦åˆ™ä¼šè¢«ä¸­æ–­ã€‚</p>
</blockquote>
<h3>ä¸»é¢˜</h3>
<p>Oh My Zsh æä¾›äº†è¶…è¿‡ 150 ç§ä¸»é¢˜ï¼Œé»˜è®¤ä¸»é¢˜æ˜¯ <a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Themes#robbyrussell">robbyrussell</a>ï¼Œæ›´å¤šè¯·çœ‹<a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Themes">è¿™é‡Œ</a>ã€‚</p>
<p>åŒæ ·åœ°ï¼Œå¦‚éœ€é…ç½®ä¸»é¢˜ï¼Œåˆ™æ·»åŠ åˆ° <code>~/.zshrc</code> é‡Œé¢ã€‚</p>
<pre><code class="language-shell">ZSH_THEME=&quot;robbyrussell&quot;
</code></pre>
<p>å®ƒè¿˜æä¾›äº†ä¸€äº›èŠ±é‡Œèƒ¡å“¨çš„åŠŸèƒ½ã€‚</p>
<pre><code class="language-shell"># æ¯æ‰“å¼€ä¸€ä¸ªæ–°çš„ Shell çª—å£ï¼Œéšæœºé€‰æ‹©å†…ç½®çš„ä¸»é¢˜ã€‚
ZSH_THEME=&quot;random&quot;

# æˆ–è€…ä»å¤šä¸ªå€™é€‰ä¸»é¢˜ä¸­éšæœºå±•ç¤ºã€‚
ZSH_THEME_RANDOM_CANDIDATES=(
  &quot;robbyrussell&quot;
  &quot;agnoster&quot;
)

# ç”šè‡³å¯ä»¥æ’é™¤æ‰ä¸å–œæ¬¢çš„ä¸»é¢˜ï¼Œè¿™æ ·å°±ä¸ä¼šåœ¨éšæœºä¸»é¢˜ä¸­å‡ºç°ã€‚
ZSH_THEME_RANDOM_IGNORED=(pygmalion tjkirch_mod)
</code></pre>
<h2>ç³»ç»Ÿç»ˆç«¯ä¸»é¢˜</h2>
<p>ç³»ç»Ÿå†…ç½®çš„ç»ˆç«¯å·¥å…·é»˜è®¤ä¸»é¢˜ã€ŒBasicã€æ˜¯ç™½åº•é»‘å­—çš„ã€‚è™½ç„¶å†…ç½®äº†å¤šç§ä¸»é¢˜ï¼Œä½†éƒ½æŒºä¸‘çš„ã€‚</p>
<p>å…ˆè°ƒæ•´ä¸‹ï¼Œä¿®æ”¹å‘½ä»¤æç¤ºç¬¦ï¼š</p>
<pre><code class="language-shell">PROMPT=&quot;%(?:%{$fg_bold[green]%}â†’ â—:%{$fg_bold[red]%}â†’ â—)%{$fg_bold[white]%}â—&quot;
PROMPT+=&quot; %{$fg_bold[yellow]%}%c %{$reset_color%}$ &quot;
RPROMPT=&quot;[%{$fg[white]%}%*%{$reset_color%}]&quot;
</code></pre>
<p>ç³»ç»Ÿå¤„äºæµ…è‰²æ¨¡å¼æ—¶ï¼Œvim æ¨¡å¼çš„é»˜è®¤èƒŒæ™¯è‰²æ˜¯ç™½åº•ï¼Œå¯ä»¥åœ¨ <code>~/.vimrc</code> ä¸­æ·»åŠ é…ç½®ä½¿èƒŒæ™¯è‰²ç»Ÿä¸€ã€‚</p>
<pre><code class="language-shell">set background=dark &quot;è®¾ç½®èƒŒæ™¯è‰²
</code></pre>
<p>é…ç½®æ–‡ä»¶æ”¾åœ¨ <a href="https://github.com/toFrankie/terminal-dark-theme.git">terminal-dark-theme</a> â­ï¸
<img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/5/1715667003269.png" alt=""></p>
<h2>è®¾å¤‡å…±äº«</h2>
<p>æˆ‘æœ‰å¤šå° Mac è®¾å¤‡ï¼Œè¦åšä¸€äº›åŒæ­¥å…±äº«å¤„ç†ï¼Œçœå»å¤šè®¾å¤‡ä¿®æ”¹çš„éº»çƒ¦ã€‚</p>
<h3>æ€è·¯</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œzsh é…ç½®éƒ½æ˜¯ç”¨æˆ·çº§åˆ«çš„ï¼Œå­˜æ”¾äº <code>~/.zshrc</code>ã€‚</p>
<p>å¯ä»¥è¿™æ ·ï¼š</p>
<ol>
<li>å°†é…ç½®æ–‡ä»¶å­˜æ”¾äº iCloud äº‘ç›˜ï¼Œå¯å¤šè®¾å¤‡åŒæ­¥ã€‚</li>
<li>åœ¨æœ¬åœ°é…ç½®ä¸­å¼•å…¥ iCloud äº‘ç›˜åŒæ­¥çš„é…ç½®æ–‡ä»¶ã€‚</li>
</ol>
<p>åœ¨ iCloud äº‘ç›˜ä¸‹åˆ›å»º <code>Terminal</code> ç›®å½•ï¼š</p>
<pre><code class="language-shell">$ cd ~/Library/Mobile\ Documents/com~apple~CloudDocs
$ mkdir Terminal
</code></pre>
<p>æ¥ç€ï¼Œå°† <code>.zshrc</code> æ‹·è´è‡³äº‘ç›˜ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-shell">$ cp ~/.zshrc ~/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc.sh
</code></pre>
<p>ç„¶åï¼Œä¿®æ”¹æ–‡ä»¶ <code>~/.zshrc</code> ä¸ºï¼š</p>
<pre><code class="language-shell">source $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc.sh
</code></pre>
<blockquote>
<p><code>source</code> å‘½ä»¤ç”¨äºæ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œé€šå¸¸ç”¨äºé‡æ–°åŠ è½½ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
</blockquote>
<p>æœ€åï¼Œæ‰§è¡Œ <code>source ~/.zshrc</code> åˆ·æ–°é…ç½®ã€‚</p>
<h3>é…ç½®æ‹†åˆ†</h3>
<p>æ—¢ç„¶æ˜¯å¤šè®¾å¤‡ï¼Œå„è®¾å¤‡ç¯å¢ƒå¾ˆå¤§å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œé…ç½®è‡ªç„¶ä¸åŒã€‚</p>
<p>æ­¤åœºæ™¯ä¸‹ï¼Œå¤šè®¾å¤‡å¤ç”¨åŒä¸€ä¸ª zsh é…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶ä¸å¦¥ã€‚</p>
<p>å› æ­¤ï¼Œè¦å¯¹ <code>Terminal/zshrc.sh</code> é…ç½®è¿›è¡Œæ‹†åˆ†ï¼š</p>
<pre><code class="language-shell">~/Library/Mobile Documents/com~apple~CloudDocs/Terminal/
â”œâ”€â”€ zshrc.sh            # ç»Ÿä¸€å¼•å…¥ä»¥ä¸‹ç»†åˆ†é…ç½®
â”œâ”€â”€ zshrc-common.sh     # å„è®¾å¤‡å…±åŒé…ç½®ï¼Œæ¯”å¦‚ Oh-My-Zsh ç­‰
â”œâ”€â”€ zshrc-imac.sh       # iMac è®¾å¤‡ç‰¹æœ‰é…ç½®
â””â”€â”€ zshrc-mbp.sh        # MacBook Pro è®¾å¤‡ç‰¹æœ‰é…ç½® 
</code></pre>
<blockquote>
<p>æŒ‰éœ€è°ƒæ•´ã€‚</p>
</blockquote>
<p>æ­¤å¤„æ–‡ä»¶åä¸ä»¥ <code>.</code> å¼€å¤´ï¼ŒåŸå› æ˜¯ä¸æƒ³éšè—æ–‡ä»¶ï¼Œæ¯•ç«Ÿå­˜æ”¾åœ¨ iCloud äº‘ç›˜ç›®å½•ä¸‹ï¼Œæ²¡å¿…è¦éšè—äº†ã€‚Shell è„šæœ¬æ‰©å±•åæ˜¯å¯çœç•¥çš„ï¼Œç”šè‡³å¯è‡ªå®šä¹‰ã€‚ä½¿ç”¨ <code>.sh</code> æ‰©å±•åä¹Ÿæ–¹ä¾¿ç¼–è¾‘å™¨è¯­æ³•é«˜äº®ã€‚</p>
<h3>æŒ‰è®¾å¤‡è¯»å–</h3>
<p>å…ˆåœ¨ <code>zshrc.sh</code> å¼•å…¥ <code>zshrc-common.sh</code> å…±åŒé…ç½®ï¼š</p>
<pre><code class="language-shell"># zshrc.sh

# åŠ è½½å…±åŒé…ç½®
source $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc-common.sh

# åŠ è½½è®¾å¤‡ç‰¹æœ‰é…ç½®
# è€Œä¸”åº”æ”¾åœ¨å…±åŒé…ç½®åé¢åŠ è½½ï¼ŒåŸåˆ™ä¸Šå®ƒä»¬çš„ä¼˜å…ˆçº§åº”è¯¥è¾ƒé«˜çš„ã€‚
# ...
</code></pre>
<p>å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼åŒºåˆ†è®¾å¤‡ï¼š</p>
<pre><code class="language-shell">$ hostname
Frankies-iMac.local

$ scutil --get LocalHostName
Frankies-iMac

$ scutil --get ComputerName
Frankie's iMac
</code></pre>
<p>å¯¹åº”å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-41b6c5449fb94d1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>LocalHostName æ˜¯ ComputerName æ ¼å¼åŒ–ä¹‹åçš„åç§°ï¼Œæ¯”å¦‚ç©ºæ ¼ä¼šæ›¿æ¢ä¸ºè¿å­—ç¬¦ <code>-</code>ï¼Œä¸€äº›ç‰¹æ®Šç¬¦å·ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚</li>
<li>hostname åˆ™æ˜¯åœ¨ LocalHostName åŠ ä¸Š <code>.local</code> çš„åç§°ã€‚ç”±äº hostname è¯»å–é¡ºåºï¼ˆ<a href="https://shockerli.net/post/macos-hostname-scutil/">è¯¦è§</a>ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šå—åˆ°æ‰€è¿æ¥ç½‘ç»œçš„å½±å“ï¼Œå› æ­¤å®ƒå¯èƒ½ä¸æ˜¯å›ºå®šå€¼ã€‚</li>
</ul>
<p>è¿™é‡Œä½¿ç”¨ <code>scutil --get ComputerName</code> å‘½ä»¤ï¼Œå®ƒçš„è¿”å›å€¼å–å†³äºä½ è¾“å…¥çš„ç”µè„‘åç§°ã€‚</p>
<blockquote>
<p>æ³¨æ„ <code>ComputerName</code> ä¸º macOS ç‹¬æœ‰ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œç¼–å†™ä¸€ä¸ª Shell å‡½æ•°ï¼ŒæŒ‰è®¾å¤‡ç”µè„‘åç§°åŠ è½½å¯¹åº”é…ç½®ã€‚</p>
<pre><code class="language-shell"># æ ¹æ®è®¾å¤‡ç”µè„‘åç§°ï¼Œè¯»å–å¯¹åº”é…ç½®
function load_device_zsh_configuration() {
  local computer_name=$(scutil --get ComputerName)
  local icloud_config_dir=&quot;$HOME/Library/Mobile Documents/com~apple~CloudDocs/Terminal&quot;
  if [[ $computer_name =~ 'MacBook' ]]; then
    local config_file=&quot;$icloud_config_dir/zshrc-mbp.sh&quot;
    if [ -f &quot;$config_file&quot; ]; then
      source &quot;$config_file&quot;
    fi
  elif [[ $computer_name =~ 'iMac' ]]; then
    local config_file=&quot;$icloud_config_dir/zshrc-imac.sh&quot;
    if [ -f &quot;$config_file&quot; ]; then
      source &quot;$config_file&quot;
    fi
  fi
}
load_device_zsh_configuration
unset -f load_device_zsh_configuration
</code></pre>
<p>æœ‰å‡ å¤„è¯·æŒ‰éœ€è°ƒæ•´ï¼š</p>
<ol>
<li><code>icloud_config_dir</code> åé¢çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ iCloud äº‘ç›˜ä¸­å­˜æ”¾é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li>ç±»ä¼¼  <code>$computer_name =~ 'MacBook'</code> è¿™è¡Œï¼Œæ„æ€æ˜¯å½“ <code>ComputerName</code> ä¸­åŒ…å« <code>MacBook</code> å­—ç¬¦ä¸²æ—¶ï¼Œæ‰§è¡Œ <code>if</code> è¯­å¥ï¼Œå°†åŠ è½½ <code>zshrc-mbp.sh</code> é…ç½®ã€‚</li>
</ol>
<p>æœ€å <code>zshrc.sh</code> çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># Load zsh common configuration
source $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc-common.sh

# Load device zsh configuration
function load_device_zsh_configuration() {
  local computer_name=$(scutil --get ComputerName)
  local icloud_config_dir=&quot;$HOME/Library/Mobile Documents/com~apple~CloudDocs/Terminal&quot;
  if [[ $computer_name =~ 'MacBook' ]]; then
    local config_file=&quot;$icloud_config_dir/zshrc-mbp.sh&quot;
    if [ -f &quot;$config_file&quot; ]; then
      source &quot;$config_file&quot;
    fi
  elif [[ $computer_name =~ 'iMac' ]]; then
    local config_file=&quot;$icloud_config_dir/zshrc-imac.sh&quot;
    if [ -f &quot;$config_file&quot; ]; then
      source &quot;$config_file&quot;
    fi
  fi
}
load_device_zsh_configuration
unset -f load_device_zsh_configuration
</code></pre>
<h3>ä¸€æ¬¡å¤±è´¥çš„å°è¯•ä¸æ€è€ƒ</h3>
<p>æœ€åˆï¼Œåˆ©ç”¨é“¾æ¥æ–‡ä»¶ç‰¹æ€§çš„æ€è·¯ï¼š</p>
<blockquote>
<p>å°† <code>Terminal/zshrc.sh</code> ä¸ <code>~/.zshrc</code> å»ºç«‹ç¡¬é“¾æ¥å…³ç³»ï¼Œæ­¤æ—¶ä¸¤è€…å°±æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„åŒä¸€æ–‡ä»¶ï¼ˆinode å·ç ç›¸åŒï¼‰ï¼Œä¿®æ”¹å…¶ä¸­ä¸€æ–¹ï¼Œå¦ä¸€æ–¹ä¼šåŒæ­¥ä¿®æ”¹ã€‚è€Œä¸”åˆ é™¤ä»»æ„ä¸€æ–¹ï¼Œå¯¹å¦ä¸€æ–¹ä¸ä¼šäº§ç”Ÿå½±å“ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒiCloud äº‘ç›˜æ–‡ä»¶å˜æ›´ä¼šè‡ªåŠ¨åŒæ­¥ã€‚</p>
<p>æ®è§‚å¯Ÿï¼Œå½“æ–‡ä»¶åŒæ­¥å®Œæˆä¹‹åï¼Œè™½ç„¶æ–‡ä»¶åæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œä½†æ–‡ä»¶çš„ inode ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ ·ä¼šå¯¼è‡´å‰é¢å»ºç«‹çš„ç¡¬é“¾æ¥å…³ç³»ç ´è£‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Terminal/zshrc.sh</code> ä¸ <code>~/.zshrc</code> çš„ inode ä¸å†ç›¸åŒï¼Œä¿®æ”¹ä»»æ„ä¸€æ–¹ï¼Œå¦ä¸€æ–¹éƒ½ä¸ä¼šåŒæ­¥ä¿®æ”¹ã€‚æ‰€ä»¥è¿™ä¸ªæ€è·¯æ˜¯ä¸è¡Œçš„ã€‚</p>
<p>åæ¥ï¼Œæˆ‘åˆèŒç”Ÿäº†å¦ä¸€ç§æ€è·¯ï¼šåˆ©ç”¨è½¯é“¾æ¥æ–‡ä»¶ã€‚è½¯é“¾æ¥æ–‡ä»¶çš„æ–‡ä»¶å†…å®¹å­˜æ”¾çš„æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œå‰é¢ iCloud åŒæ­¥ä¸ä¼šå½±å“æ–‡ä»¶åï¼Œèµ·æ¥ä¼¼ä¹æ˜¯å¯è¡Œçš„ï¼š</p>
<pre><code class="language-shell"># åˆ›å»º Terminal/zshrc.sh çš„è½¯é“¾æ¥è‡³ ~/.zshrc.icloud
$ ln -s ~/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc.sh ~/.zshrc.icloud

# åœ¨ ~/.zshrc å†™å…¥é…ç½®
$ echo 'source ~/.zshrc.icloud' &gt; ~/.zshrc

# åˆ·æ–°é…ç½®
$ souce ~/.zshrc
</code></pre>
<p>ä»¥ä¸Šåœ¨ <code>~/.zshrc</code> åŠ è½½ <code>~/.zshrc.icloud</code> çš„æ—¶å€™ï¼Œç”±äºåè€…æ˜¯ <code>Terminal/zshrc.sh</code> çš„è½¯é“¾æ¥ï¼Œå‘½ä»¤æ‰§è¡Œæ—¶ä¼šæ‰¾åˆ° <code>Terminal/zshrc.sh</code> çš„å†…å®¹è¿›è¡ŒåŠ è½½ã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆçœ‹ç€æ˜¯å¯è¡Œçš„ï¼Œä½†å±å®æœ‰ç‚¹å¤šæ¬¡ä¸€ä¸¾äº†ã€‚ä½•ä¸ç›´æ¥åœ¨ <code>~/.zshrc</code> åŠ è½½ <code>Terminal/zshrc.sh</code> å‘¢ï¼Ÿ</p>
<blockquote>
<p><a href="https://github.com/toFrankie/blog/issues/36">Linux é“¾æ¥æ–‡ä»¶è¯¦è§£</a></p>
</blockquote>
<h3>å…¶ä»–</h3>
<p>åç»­é…ç½®è°ƒæ•´ï¼Œåº”æ ¹æ®å®é™…æƒ…å†µå¯¹ä»¥ä¸‹æ–‡ä»¶ä½œå‡ºä¿®æ”¹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ <code>~/.zshrc</code> æœ¬åœ°é…ç½®ã€‚</p>
<pre><code class="language-shell">~/Library/Mobile Documents/com~apple~CloudDocs/Terminal/
â”œâ”€â”€ zshrc-common.sh
â”œâ”€â”€ zshrc-imac.sh
â””â”€â”€ zshrc-mbp.sh
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œè®¾ç½®äº†ä¸€äº›å˜é‡åˆ«åï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<pre><code class="language-shell"># zshrc-common.sh

# åˆ·æ–°æœ¬åœ°é…ç½®
alias sourcez=&quot;source ~/.zshrc&quot;

# è®¾ç½®åˆ«åï¼Œå¯å¿«é€Ÿæ‰“å¼€å„é…ç½®æ–‡ä»¶
alias openz-common=&quot;open $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc-common.sh&quot;
alias openz-imac=&quot;open $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc-imac.sh&quot;
alias openz-mbp=&quot;open $HOME/Library/Mobile\ Documents/com~apple~CloudDocs/Terminal/zshrc-mbp.sh&quot;

# è®¾ç½®å˜é‡ï¼Œå¯ç›´æ¥é€šè¿‡ `cd $ICLOUD_TERMINAL_DIR` å‘½ä»¤æ‰“å¼€ç›®å½•
export ICLOUD_TERMINAL_DIR=&quot;$HOME/Library/Mobile Documents/com~apple~CloudDocs/Terminal&quot;
</code></pre>
<p>ä¹Ÿå¯ä»¥ç»™æ¯ä¸ªè®¾å¤‡çš„é…ç½®æ–‡ä»¶è®¾ç½®å˜é‡ <code>Configuration_File_Name</code>ï¼Œç„¶ååˆ©ç”¨ç±»ä¼¼ <code>echo 'some configuration' &gt;&gt; $Configuration_File_Name</code> å½¢å¼å¾€é…ç½®æ–‡ä»¶ä¸­è¿½åŠ é…ç½®ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Win11 æ‰“å¼€ IE æµè§ˆå™¨]]></title>
            <link>https://github.com/toFrankie/blog/issues/27</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/27</guid>
            <pubDate>Sat, 25 Feb 2023 10:58:13 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b49fc3c7a59af604.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-b49fc3c7a59af604.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>Microsoft å‘å¸ƒ Windows 11 ä¹‹åï¼Œç³»ç»Ÿä½¿ç”¨åŸºäº Chromium å†…æ ¸çš„ Edge æµè§ˆå™¨æ¥ä»£æ›¿è¢«äººå”¾éª‚å·²ä¹…çš„ IE æµè§ˆå™¨ï¼ŒIE æµè§ˆå™¨å…¥å£ä¹Ÿå·²ç»è¢«å±è”½æ‰äº†ã€‚é€šè¿‡ä»»ä½•å¸¸è§„æ–¹å¼æ‰“å¼€ IE æµè§ˆå™¨éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨ Edge æµè§ˆå™¨æ‰“å¼€ã€‚</p>
<blockquote>
<p>æœ€æ–°æ¶ˆæ¯ï¼ŒIE æµè§ˆå™¨äºåŒ—äº¬æ—¶é—´ 2022 å¹´ 6æœˆ15 æ—¥ 21:00 æ­£å¼é€€å½¹ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-80209fa662e84211.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰ç«¯äººè¡¨ç¤ºé•¿èˆ’ä¸€å£æ°”ï¼Œå°½ç®¡æˆ‘ç›®å‰æ‰€åšè¿‡çš„ Web é¡¹ç›®å¹¶æ²¡æœ‰é‡åˆ°éœ€è¦å…¼å®¹ IE æµè§ˆå™¨çš„ã€‚ç„¶è€Œï¼Œå°½ç®¡ IE æµè§ˆå™¨å·²ç»åœæ­¢æœåŠ¡ï¼Œåªè¦å›½å†…é“¶è¡Œã€æ”¿åºœç­‰æœ‰å…³éƒ¨é—¨çš„ç½‘ç«™ä»… IE æµè§ˆå™¨å¯è®¿é—®ï¼Œè‡³äº Edge æµè§ˆå™¨æä¾›çš„ IE å…¼å®¹æ¨¡å¼ï¼Œä¸ªäººæ²¡è¯•è¿‡ï¼Œå› ä¸ºæˆ‘ä¼¼ä¹æ²¡æœ‰è¿™ä¸ªéœ€è¦...</p>
<p>ä½œä¸ºå‰ç«¯äººï¼Œæœ‰æ—¶å€™éœ€è¦åœ¨ IE8 ç­‰è¿œå¤æµè§ˆå™¨ä¸­è¿è¡ŒæŸäº›ä»£ç ï¼Œæ¥å­¦ä¹ ã€æµ‹è¯•éªŒè¯ API å…¼å®¹æ€§ç­‰ï¼Œå› æ­¤å¯¹æˆ‘æ¥è¯´è¿˜æ˜¯éœ€è¦ IE æµè§ˆå™¨çš„ï¼Œå°½ç®¡åœºæ™¯å¾ˆå°‘å¾ˆå°‘...</p>
<p>å°½ç®¡ IE æµè§ˆå™¨å…¥å£è¢«å±è”½äº†ï¼Œä½†å¾®è½¯ç›®å‰è¿˜æœªå°†å…¶å½»åº•åˆ é™¤ï¼Œå­˜æ”¾åœ¨ <code>C:\Program Files\Internet Explorer\iexplore.exe</code>ã€‚ä½†åŒå‡»æ‰“å¼€ä¼šç›´æ¥è·³è½¬åˆ° Edge æµè§ˆå™¨ä¸­ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-01b51cdef73c5f0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ä¸‹æ¥å°†ä¼šä»‹ç»å¦‚ä½•åœ¨ Win11 ä¸­æ‰“å¼€ IE æµè§ˆå™¨ã€‚</p>
<p><strong>æ–¹å¼ä¸€ï¼ˆåœ¨æœ€åˆçš„é¢„è§ˆç‰ˆä¸­æœ‰æ•ˆï¼Œç›®å‰å·²å¤±æ•ˆï¼‰</strong></p>
<p>å°† <code>C:\Windows\System32\ieframe.dll</code> æ–‡ä»¶è¿›è¡Œæ›¿æ¢å³å¯ã€‚ä½†è¿™ç§æ–¹å¼æ¯æ¬¡æ›´æ–°ç³»ç»Ÿåéœ€é‡æ–°æ›¿æ¢ï¼Œå¤ªéº»çƒ¦äº†...</p>
<p><strong>æ–¹å¼äºŒ</strong></p>
<p>é¦–å…ˆï¼Œåœ¨ Edge æµè§ˆå™¨è®¾ç½®ä¸­å°†ã€Œè®© Internet Explorer åœ¨ Microsoft Edge ä¸­æ‰“å¼€ç½‘ç«™ã€é€‰é¡¹ä¿®æ”¹ä¸ºã€Œä»ä¸ã€ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e966d10243c73758.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶æ¬¡ï¼Œåˆ›å»ºä¸€ä¸ª TXT æ–‡ä»¶ï¼Œå¤åˆ¶ä»¥ä¸‹å‘½ä»¤åˆ°æ–‡ä»¶å†…å¹¶ä¿å­˜ï¼Œæ¥ç€ä¿®æ”¹æ–‡ä»¶æ‰©å±•åä¸º <code>.vbs</code>ï¼Œç„¶ååŒå‡»æ‰“å¼€æ–‡ä»¶ä¾¿å¯æ‰“å¼€ IE æµè§ˆå™¨ã€‚</p>
<pre><code class="language-text">CreateObject(&quot;InternetExplorer.Application&quot;).Visible=true
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7d7b8a1703510946.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>ä¸æ’é™¤å¾®è½¯åœ¨æœªæ¥æŸä¸ªç‰ˆæœ¬ä¸­å°†è¿™ç§æ–¹å¼å°å µï¼Œä½†ä¹Ÿæ˜¯å¿…ç„¶çš„äº‹æƒ…å•¦...</p>
</blockquote>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac ç»ˆç«¯ä½¿ç”¨é¼ æ ‡æ¥ç§»åŠ¨å…‰æ ‡]]></title>
            <link>https://github.com/toFrankie/blog/issues/26</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/26</guid>
            <pubDate>Sat, 25 Feb 2023 10:57:29 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-67624585dce19bea.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-67624585dce19bea.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å‡è®¾åœºæ™¯ï¼šåœ¨ç»ˆç«¯è¾“å…¥äº†ä¸€é•¿ä¸²æŒ‡ä»¤åï¼Œçªç„¶å‘ç°ä¸­é—´æœ‰ä¸ªå‚æ•°å†™é”™äº†éœ€è¦ä¿®æ”¹ï¼Œè¿™æ—¶å€™å¯èƒ½è¦é€šè¿‡ã€Œæ–¹å‘é”®ã€ç§»åŠ¨å…‰æ ‡ï¼Œè¿™æ˜¯éå¸¸å½±å“æ•ˆç‡çš„ã€‚</p>
<p>æˆ‘ç”šè‡³è®°ä¸ä½è¿™äº›å¿«æ·é”®ï¼š</p>
<blockquote>
<ul>
<li>Ctrl + Aï¼šç§»è‡³è¡Œé¦–</li>
<li>Ctrl + Eï¼šç§»è‡³è¡Œæœ«</li>
<li>Option + å·¦æ–¹å‘é”®ï¼šå·¦ç§»ä¸€ä¸ªå•è¯</li>
<li>Option + å³æ–¹å‘é”®ï¼šå³ç§»ä¸€ä¸ªå•è¯</li>
</ul>
</blockquote>
<p>é‚£ä¹ˆå¦‚ä½•åœ¨ Mac ç³»ç»Ÿç»ˆç«¯ä¸­æ„‰å¿«åœ°ä½¿ç”¨é¼ æ ‡ç§»åŠ¨å…³é—­å‘¢ï¼Ÿ</p>
<blockquote>
<ul>
<li>åœ¨è¾“å…¥æŒ‡ä»¤æˆ–è€… vim æ¨¡å¼ä¸‹ï¼ŒæŒ‰ä½ Option é”®ï¼ˆAltï¼‰ï¼Œç‚¹å‡»é¼ æ ‡å°±èƒ½ç§»åŠ¨å…‰æ ‡è‡³å¯¹åº”ä½ç½®ã€‚</li>
<li>å¦å¤–ï¼Œé€šè¿‡åœ¨é…ç½®æ–‡ä»¶ <code>~/.vimrc</code> æ·»åŠ ä¸€é¡¹ <code>set mouse=a</code>ï¼ˆactivating mouse featuresï¼‰é…ç½®ï¼Œvim æ¨¡å¼ä¸‹ä¾¿å¯ç›´æ¥ç”¨é¼ æ ‡æ¥ç§»åŠ¨å…‰æ ‡ä½ç½®ã€‚</li>
</ul>
</blockquote>
<p>ç¬¬ä¸‰æ–¹ç»ˆç«¯å·¥å…·æ˜¯å¦æ”¯æŒï¼Œæ²¡æœ‰äº²æµ‹ã€‚ä¸ªäººä¸å–œæ¬¢ç¬¬ä¸‰æ–¹ç»ˆç«¯å·¥å…·çš„èŠ±é‡Œèƒ¡å“¨ã€‚</p>
<h2>References</h2>
<ul>
<li><a href="https://superuser.com/questions/125102/mac-os-x-terminal-mouse-support">Mac OS X Terminal: mouse support?</a></li>
<li><a href="https://github.com/toFrankie/blog/issues/8">Mac Terminal æ‰“å¼€ URL</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å…³äº iMac å†…å­˜æ‰©å±•è¿™ä»¶äº‹]]></title>
            <link>https://github.com/toFrankie/blog/issues/25</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/25</guid>
            <pubDate>Sat, 25 Feb 2023 10:57:04 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-52e581f2744d82d4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-52e581f2744d82d4.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¿—è¯è¯´ï¼Œã€Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€ã€‚</p>
<p>äºæ˜¯ï¼Œå‰å‡ å¤©ç½‘ä¸Šä¸‹å•ä¹°äº† 2 æ¡ 16G çš„å†…å­˜æ¡ï¼Œè£…å¤‡ä¸€ä¸‹æ‰‹ä¸Šçš„ iMac 2020ã€‚</p>
<p>è´­æœºé…ç½®æ˜¯ 8 + 512G çš„ç»„åˆã€‚å…¶å®å€’ä¸æ˜¯è¯´ 8G å†…å­˜ä¸å¤Ÿç”¨ï¼Œåªæ˜¯å¶å°”æ‰“å¼€è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œç•¥å¡ï¼Œä½“éªŒä¸å¥½ã€‚ä½†å…¶å®æˆ‘æ‰“å¼€è™šæ‹Ÿæœºé¢‘æ¬¡å¾ˆå°‘ï¼Œä½†ç”±äºå¼ºè¿«ç—‡ã€å°é²œæ´¾ç­‰å±æ€§åŠ æŒï¼Œç„¶ååˆè€ƒè™‘åˆ°æŠ•èµ„æˆæœ¬åœ¨å¯æ¥å—èŒƒå›´ï¼Œæ‰€ä»¥è¯ä¸å¤šè¯´å°±ä¸‹å•äº†...</p>
<p>ä¸‹ç­å›æ¥è£…ä¸Šä¹‹åï¼Œçºµäº«ä¸æ»‘...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9a892da9b345864e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å½“åˆè´­ä¹° iMac çš„åŸå› ï¼Œå…¶å®å¾ˆç®€å•ï¼šå°±æ˜¯ä¸æƒ³æ¯å¤©èƒŒç€ MacBook Pro ä¸Šä¸‹ç­ã€‚è™½ç„¶å¾ˆå¤šäººéƒ½è¯´ä¾¿æºï¼Œä½†èƒŒå¤šäº†å°±ä¼šè§‰å¾—é‡ã€‚ä½†æ˜¯ä¸å¸¦çš„è¯ï¼Œå­¦ä¹ åˆä¸æ–¹ä¾¿......</p>
<p>ä¹°äº†ä¹‹åï¼Œä»æ­¤é‡Šæ”¾äº†è‚©è†€ï¼Œä¸ç”¨å¸¦ç”µè„‘ä¸Šä¸‹ç­ï¼Œä½†åˆä¸å½±å“æ¬ç –å­¦ä¹ ï¼Œå¹¸ç¦æ„ŸçœŸçš„å¾ˆå¥½ã€‚</p>
<p>ä»å¤§ä¸‰å¼€å§‹åˆ°ç°åœ¨ï¼Œå·²ç»å‡ ä¹é›†é½äº† Apple å…¨å®¶æ¡¶äº†ï¼ŒiPhone Ã— 3ã€iPad Proã€iMacã€MacBook Proã€AirPods Ã— 2ã€Magic Mouse Ã— 2ã€Magic Keyboardï¼Œå¦å¤–è¿˜æœ‰ 2 ä¸ªæ˜¾ç¤ºå™¨ã€2 ä¸ªæœºæ¢°é”®ç›˜ç­‰ç­‰ï¼Œç¡®å®æœ‰ç‚¹è´¹é’±...</p>
<p>å…¶å®ï¼Œä¸€ç›´ä¸è®¤ä¸ºç”¨è‹¹æœå°±æ€æ ·æ€æ ·ï¼Œé€‚åˆè‡ªå·±ã€å¤Ÿç”¨å®ç”¨ã€ç”¨å¾—èˆ’æœå°±æ˜¯å¥½äº§å“ï¼Œæ— å…³å“ç‰Œã€‚å¯¹äºç½‘ä¸Šå……æ–¥ç€ä¸€äº›ä¸å¥½çš„å£°éŸ³ï¼Œã€Œä¸€ç¬‘è€Œè¿‡ã€å°±å¥½äº†ã€‚ç”Ÿæ´»æœ¬æ¥å°±å¾ˆå¿™ï¼ŒçœŸçš„æ²¡å¿…è¦ç†ä¼šã€‚</p>
<p>æˆ‘ä¹°é‚£ä¹ˆå¤šå®ƒä»¬å®¶çš„äº§å“ï¼ŒåŸå› å˜›ï¼š</p>
<ul>
<li>
<p>æ‘Šç‰Œäº†ï¼Œæˆ‘æ˜¯é¢œå€¼å…šï¼ˆæŒ‡ UI æ–¹é¢ï¼‰ï¼Œç”±äºå¤§å­¦é‚£ä¼šä¸€ç›´åœ¨åšæ‰‹æœºä¸»é¢˜ï¼Œä¹…è€Œä¹…ä¹‹ç§¯ç´¯èµ·æ¥çš„ï¼Œå‹‰å¼ºè¿˜è¡Œçš„å®¡ç¾ï¼ŒåŠ ä¹‹äº§ç”Ÿçš„å¼ºè¿«ç—‡ï¼ŒmacOS å’Œ iOS ç­‰ç³»ç»Ÿç»†èŠ‚æ§ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ã€‚</p>
</li>
<li>
<p>App Store çš„è½¯ä»¶ä½“éªŒï¼Œè¦æ¯” Android å¥½ï¼ˆä¸ªäººæ„Ÿå—ï¼Œä¸ä»£è¡¨ä»»ä½•äººï¼Œå“ˆå“ˆï¼‰ã€‚æœ‰äººè¯´ Android å¯ç©æ€§é«˜å•Šï¼Œè¿™ä¸ªä¸å¦è®¤ã€‚æˆ‘æ›¾ç»ä¹Ÿæ˜¯é‚£ä¸ªæ‹¿ç€ã€Œå°ç±³ 2ã€åˆ·å„ç§ ROM çš„å¹´è½»äººï¼ˆä¿—ç§°åˆ·æœºæ—¶ä»£ï¼‰ã€‚ä½†ç”±äºç°åœ¨å„å®¶ç³»ç»Ÿéƒ½åšå¾—ä¸é”™ï¼Œå·®å¼‚åŒ–å·²ç»ä¸å¤§äº†ï¼Œæ‰€ä»¥ç°åœ¨åˆ·æœºæ—¶ä»£å·²ç»ä¸€å»ä¸å¤è¿”äº†ï¼Œæ²¡å‡ ä¸ªäººå¤©å¤©æ£å¼„è¿™äº›äº†ã€‚éšç€æ…¢æ…¢é•¿å¤§ï¼Œé‚£è‚¡æŠ˜è…¾åŠ²ä¹Ÿæ²¡äº†ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´ä½“éªŒå¥½å‘¢ï¼Ÿæˆ‘æœ¬èº«å°±æ˜¯åšå‰ç«¯å¼€å‘ï¼Œæ·±çŸ¥å…¶å® iOS é€‚é…æ•ˆæœæ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚æ— è®ºå­—ä½“ã€å¯¹é½ç­‰ç­‰æ•ˆæœæ¯”ã€Œç™¾èŠ±é½æ”¾ã€çš„ Android è¦å¥½å¾ˆå¤šã€‚æ›¾ç»æˆ‘ç”¨ Android ä¹Ÿæ˜¯ç»å¸¸æ¢ç€å­—ä½“ç”¨çš„ï¼Œä½†æ–°é²œæ„Ÿæ²¡äº†ä¹‹åï¼Œå¸¦æ¥çš„æ˜¯é•¿æ—¶é—´é˜…è¯»çš„ä¸çˆ½ã€‚</p>
<p>å…¶å®ï¼Œç»å¤§å¤šæ•°äººæ ¹æœ¬ä¸ä¼šæ³¨æ„åˆ°è¿™äº›ï¼Œä½†ç”±äºæˆ‘æœ¬èº«å°±æ˜¯å¾ˆå–œæ¬¢ã€Œè®¾è®¡ã€çš„å¼€å‘è€…ï¼Œåˆæœ‰å¾ˆå¼ºçƒˆçš„å¼ºè¿«ç—‡ï¼Œè¿™äº›ç»†èŠ‚å¸¦æ¥çš„æ˜¯è«å¤§çš„èˆ’é€‚æ„Ÿã€‚æ¯”å¦‚è¯´ Android çš„çŠ¶æ€æ ï¼Œå„ç§é«˜ä½ä¸å¹³çš„å›¾æ ‡ï¼Œè¿˜æœ‰å„ç§åº”ç”¨çš„ç¼©ç•¥å›¾ï¼Œè¿™å½“åˆæ²¡åœ¨ç”¨ iPhone ä¹‹å‰æˆ‘ä¹Ÿæ²¡è§‰å¾—æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†é•¿æ—¶é—´ä½¿ç”¨ä¸‹æ¥ï¼ŒçœŸçš„è¿˜æ˜¯è§‰å¾— iOS çš„ä¼šèˆ’æœå¾ˆå¤šã€‚</p>
</li>
<li>
<p>è¿˜æœ‰å°±æ˜¯ Apple å…¨å®¶æ¡¶å¸¦æ¥çš„å¿«ä¹ï¼ŒiCloud åŒæ­¥ã€æ¥åŠ›ã€éš”ç©ºæŠ•é€ç­‰ç­‰ï¼Œå¤ªæ–¹ä¾¿äº†ï¼Œèµ·ç ç°åœ¨æ˜¯ç¦»ä¸å¼€äº†ã€‚è¿˜æœ‰å°±æ˜¯å·¥ä½œã€å­¦ä¹ æ•ˆç‡ä¸Šçš„æå‡ï¼Œä¸€ä¸ªä¸å¡çš„ç³»ç»ŸçœŸçš„å¤ªé‡è¦äº†ã€‚åŸæœ¬å·¥ä½œå°±å¾ˆç´¯ï¼ŒçœŸçš„ä¸åƒæŠŠæ—¶é—´æµªè´¹åœ¨å¡é¡¿ä¸Šé¢ï¼ˆä¸æ•¢è¯´ Windows å¡é¡¿ï¼Œåº”è¯¥æ˜¯æˆ‘æ²¡ç”¨è¿‡æ¯”è¾ƒè´µçš„ Windows è®¾å¤‡ï¼‰...æŠŠçœä¸‹æ¥çš„æ—¶é—´å»åšæ›´æœ‰æ„ä¹‰çš„äº‹ï¼Œå²‚ä¸å¿«å“‰...</p>
<p>çªç„¶æƒ³èµ·ï¼ŒæŸä¹ã€Œé¢„ç®— 3000 ä¹°äºŒæ‰‹çš„ iPhone 11 è¿˜æ˜¯ Android è¯¥ä»·ä½çš„æ——èˆ°æœºï¼Ÿã€çš„ä¸€ä¸ªæé—®ï¼ˆå¤§è‡´æ˜¯è¿™ä¸ªæ„æ€ï¼‰ã€‚æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œç°åœ¨å¯ä»¥è¯´æ˜¯æ²¡äº†æ‰‹æœºå°±å¯¸æ­¥éš¾è¡Œçš„æ—¶ä»£äº†ï¼Œæœ‰äº›äººæ¯å¤©å¯¹ç€çš„æ‰‹æœºæ—¶é—´å¯èƒ½ç”šè‡³æ¯”å¯¹ä»»ä½•ä¸€ä¸ªäººéƒ½å¤šï¼ˆæ‚²å“€ï¼Ÿï¼‰ï¼Œé‚£ä¹ˆåœ¨ç»æµæ¡ä»¶å…è®¸èŒƒå›´å†…ï¼Œä½•ä¸ä¹°ä¸€ä¸ªã€Œå¥½ç”¨ã€çš„æ‰‹æœºå‘¢ï¼Ÿè‡³äºæ€æ ·å®šä¹‰å¥½ç”¨ï¼Œå°±è§ä»è§æ™ºäº†ã€‚</p>
</li>
<li>
<p>å¯¹äºä¸å–œæ¬¢ç©æ¸¸æˆã€ä¸å¤©å¤©å†™ PPTã€Word æ–‡æ¡£çš„æˆ‘ï¼Œé‚£ä¹ˆ macOS ç®€ç›´å°±æ˜¯ä¸äºŒé€‰æ‹©ã€‚å¦å¤–ï¼Œç°åœ¨çš„å…¬å¸ä½¿ç”¨ Google Docs åä½œçœŸçš„å¾ˆæ–¹ä¾¿ã€‚ç„¶åå—ä¸äº† Windows çš„å­—ä½“æ¸²æŸ“ã€ä¹Ÿä¸æƒ³æŠ˜è…¾ Linux ç³»ç»Ÿï¼ˆåº”è¯¥æ˜¯æˆ‘ä¸ä¼šç©ï¼‰ã€‚</p>
</li>
<li>
<p>æœ‰äººè¯´ï¼ŒmacOS çš„è½¯ä»¶å¾ˆå°‘ï¼Œå¾ˆå¤šä¸“ä¸šæ€§è½¯ä»¶éƒ½æ²¡æœ‰ï¼Œè¿™åº”è¯¥æ˜¯å®¢è§‚å­˜åœ¨çš„é—®é¢˜ï¼Œæ¯•ç«Ÿ macOS çš„å¸‚åœºå æœ‰ç‡å°±æ‘†åœ¨é‚£é‡Œã€‚ä½†æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œä¸»æµè½¯ä»¶ï¼ˆæ¯”å¦‚å¼€å‘ã€è®¾è®¡ã€å‰ªè¾‘ç­‰ä¸“ä¸šæ€§è´¨çš„ï¼‰macOS åº”è¯¥è¯´åšå¾—è¦æ¯” Windows å¥½å¾ˆå¤šï¼ˆæœ€å¼º IDE åˆ«å–·æˆ‘ï¼Œå“ˆå“ˆï¼‰ï¼Œèµ·ç ä½“éªŒä¸Šæ˜¯è¿™æ ·ã€‚å³ä½¿æŸä¸€æ¬¾è½¯ä»¶æ²¡æœ‰ for Mac ç‰ˆï¼Œä½†å¾ˆå¤šéƒ½èƒ½æ‰¾åˆ°ä¸€äº›ä¸é”™çš„æ›¿ä»£è½¯ä»¶çš„ã€‚è¦æ˜¯çœŸçš„ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è£…ä¸ªè™šæ‹Ÿæœºå˜›ã€‚</p>
</li>
<li>
<p>...</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ Sourcetree æŠ¥é”™ Couldn't posix_spawn: error 2 é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/24</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/24</guid>
            <pubDate>Sat, 25 Feb 2023 10:56:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eaba3123ed723d40.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰å‡ å¤©]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-eaba3123ed723d40.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰å‡ å¤©æ›´æ–°åˆ° macOS 12.3 ä¹‹åï¼ŒSourcetree æ— æ³•æ­£å¸¸æ‰“å¼€ Mercurial çš„é¡¹ç›®ï¼ŒçŒœæµ‹æ˜¯è·Ÿ macOS 12.3 ç§»é™¤äº†å†…ç½®çš„ Python2 æœ‰å…³ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-de81c84dcb96a2c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨ ATLASSIAN Community ä¸Šä¹Ÿèƒ½æ‰¾åˆ°ç›¸å…³çš„å¸–å­ï¼Œæ¯”å¦‚è¿™ç¯‡ï¼š<a href="https://community.atlassian.com/t5/Sourcetree-questions/Couldn-t-posix-spawn-error-2/qaq-p/1974979">Couldn't posix_spawn: error 2</a>ï¼Œæˆ‘ä¹Ÿåœ¨ä¸Šé¢ç•™è¨€äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-290eb10b11021502.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶å®ï¼Œæ‰“å¼€ Sourcetree åå¥½è®¾ç½®å¯ä»¥çœ‹åˆ°æŠ¥é”™åŸå› äº†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-47899e70f2a8bbd3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œå‰è€…æ„æ€æ˜¯ã€Œä½¿ç”¨å†…ç½®çš„ Mercurialã€ï¼Œåè€…è¡¨ç¤ºã€Œä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ Mercurialã€ã€‚çŒœæµ‹æ˜¯ Sourcetree å†…ç½®çš„ Mercurial ä¾èµ–äº† macOS ç³»ç»Ÿå†…ç½®çš„ Python2ï¼Œä½†ç”±äºç³»ç»Ÿæ›´æ–°ä¹‹åå·²å½»åº•ç§»é™¤ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ï¼ˆå½“å‰ Sourcetree æœ€æ–°ç‰ˆæœ¬ä¸º 4.1.6ï¼Œä»å­˜åœ¨é—®é¢˜ï¼Œç›®æµ‹åç»­ç‰ˆæœ¬ä¼šè§£å†³æ­¤é—®é¢˜ï¼‰ã€‚</p>
<p><strong>å› æ­¤ï¼Œè§£å†³æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨è‡ªè¡Œå®‰è£…çš„ Mercurial å³å¯ã€‚</strong></p>
<blockquote>
<p>ä» <strong>Use System Mercurial</strong> å¤„é€‰æ‹©è·¯å¾„ï¼š<code>/usr/local/Cellar/mercurial/6.1/lib/python3.10/site-packages/mercurial</code>ï¼ˆæ ¹æ®è‡ªå·±å®‰è£…çš„ Mercurial ç‰ˆæœ¬åŠå¯¹åº”è·¯å¾„å»é€‰æ‹©ï¼‰ã€‚</p>
</blockquote>
<p>å¦‚æœä½ æ˜¯é€šè¿‡ Homebrew å®‰è£… Mercurial çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>brew list mercurial</code> å‘½ä»¤æŸ¥çœ‹å…¶è·¯å¾„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5dcde99e7f3ed2fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>é‡æ–°æ‰“å¼€ï¼Œå°±å¯ä»¥äº†ï¼Œä¸å†æŠ¥é”™ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-66cc072ab0e95f85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>The end.</p>
<hr>
<p>2025.03.19 æ›´æ–°</p>
<p>æ‰“å¼€ä»“åº“é”™è¯¯æç¤ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•è§£å†³ã€‚</p>
<pre><code>'hg status' failed with code 255:'abort: repository requires features unknown to this Mercurial: revlog-compression-zstd (see https://mercurial-scm.org/wiki/MissingRequirement for more information) '
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://jira.atlassian.com/browse/SRCTREE-7964">OSX 12.6 - Mercurial repo 'hg status' failed with code 255</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³å¯åŠ¨ Parallels Desktop ä¹‹å macOS æ²¡å£°éŸ³çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/23</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/23</guid>
            <pubDate>Sat, 25 Feb 2023 10:54:16 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-20d6523b2fe3cf35.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-20d6523b2fe3cf35.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<blockquote>
<p>ä»¥ä¸‹æ“ä½œï¼Œéœ€å…ˆå°†è™šæ‹Ÿæœºå…³æœºã€‚</p>
</blockquote>
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<ol>
<li>åœ¨ Parallels Desktop çš„æ§åˆ¶ä¸­å¿ƒï¼Œè¿›å…¥å¯¹åº”ç³»ç»Ÿé…ç½®é¡µé¢ã€‚</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/10/1696414583463.png" alt=""></p>
<ol start="2">
<li>æ‰“å¼€ã€Œç¡¬ä»¶ â€” CPU ä¸å†…å­˜ â€” é«˜çº§ã€é€‰é¡¹ï¼š</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3eba6e485719853e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol start="3">
<li>å°†è™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¿®æ”¹ä¸ºã€ŒAppleã€ï¼Œå¹¶ä¿å­˜ã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-fb0b759d14b15c31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol start="4">
<li>æ‰“å¼€ç³»ç»Ÿã€Œç»ˆç«¯ Terminalã€è½¯ä»¶ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ol>
<pre><code class="language-shell">$ sudo launchctl stop com.apple.audio.coreaudiod &amp;&amp; sudo launchctl start com.apple.audio.coreaudiod
</code></pre>
<blockquote>
<p>è‹¥ç³»ç»Ÿç‰ˆæœ¬ä½äº macOS Catalina 10.15.3ï¼Œè¯·ä½¿ç”¨ <code>kill coreaudiod</code> å‘½ä»¤ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-c1bc7031860bbc39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>More</h2>
<p>å¦‚æœä»¥ä¸Šæ­¥éª¤å®Œæˆå¹¶ä¿å­˜ä¹‹åï¼Œå‘ç°æ— æ³•æ‰“å¼€è™šæ‹Ÿæœºï¼Œæç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6f077d57c5c647a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>ç›®å‰é—®é¢˜æš‚æ—¶æ— æ³•è§£å†³ï¼Œåªèƒ½å°†å‰é¢çš„ã€Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€æ”¹å›ã€ŒParallelsã€ã€‚</p>
</blockquote>
<p>ç½‘ä¸Šæœ‰äº›æ–‡ç« ç»™å‡ºçš„æ–¹æ¡ˆï¼š</p>
<pre><code class="language-shell"># 1. åˆ—å‡ºæ˜¾ç¤ºè™šæ‹Ÿæœºä¿¡æ¯
$ prltcl list -a
UUID                                    STATUS       IP_ADDR         NAME
{CT_ID}                                  stopped      -               Windows 11

# 2. è®¾ç½®å®¹å™¨å‚æ•°
$ prlctl set &lt;CT_ID&gt; --hypervisor-type parallels
The VM has been successfully configured.
</code></pre>
<p>è¿™ä¸¤ä¸ªæ“ä½œä¹Ÿåªæ˜¯å°†ã€Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€æ”¹å›ã€ŒParallelsã€è€Œå·²ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-01690694294757e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>References</h2>
<ul>
<li><a href="https://www.jianshu.com/p/3c11b48ef274">Mac å‡çº§ Win11 ç³»ç»Ÿ</a></li>
<li><a href="https://www.jianshu.com/p/4a5fbe7d698f">è§£å†³ Parallels Desktop 17 æ— æ³•è¿æ¥ç½‘ç»œé—®é¢˜</a></li>
<li><a href="https://www.parallels.com/cn/blogs/system-extensions-big-sur/">å…³äº macOS Big Surï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸Šçš„ Parallels Desktop ç³»ç»Ÿæ‰©å±•</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ Parallels Desktop 17 æ— æ³•è¿æ¥ç½‘ç»œé—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/22</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/22</guid>
            <pubDate>Sat, 25 Feb 2023 10:53:51 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1d2edc0455d8824c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1d2edc0455d8824c.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¸å°‘å°ä¼™ä¼´åœ¨ macOS Big Sur æˆ– Monterey ä¸­å®‰è£… Parallels Desktop 16/17 ä¹‹åï¼Œéƒ½é‡åˆ°äº†<strong>åˆå§‹åŒ–ç½‘ç»œå¤±è´¥</strong>ï¼Œæ— æ³•è¿æ¥ç½‘ç»œçš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬åªè¦ä¿®æ”¹ä¸¤ä¸ªæ–‡ä»¶çš„é…ç½®å³å¯ï¼š</p>
<blockquote>
<ul>
<li><code>/Library/Preferences/Parallels/dispatcher.desktop.xml</code></li>
<li><code>/Library/Preferences/Parallels/network.desktop.xml</code></li>
</ul>
</blockquote>
<p>å¯ä»¥é€šè¿‡ Finder çš„<strong>å‰å¾€æ–‡ä»¶å¤¹</strong>åŠŸèƒ½ç›´è¾¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-954c4f883451af83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol>
<li>æ‰“å¼€ <code>dispatcher.desktop.xml</code> æ–‡ä»¶ï¼Œæ‰¾åˆ° <code>&lt;Usb&gt;0&lt;/Usb&gt;</code>ï¼Œä¿®æ”¹ä¸º <code>&lt;Usb&gt;1&lt;/Usb&gt;</code> å¹¶ä¿å­˜ã€‚</li>
</ol>
<blockquote>
<p>å¦å¤–ï¼Œæœ‰äº›å°ç™½æœ‹å‹å¯èƒ½æŒ‰æˆªå›¾ä¸­çš„è¡Œå·æ¥æ‰¾ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚å¯é€šè¿‡ âŒ˜ + F é”®ï¼Œç„¶åè¾“å…¥å…³é”®è¯ï¼Œæ¥å¿«é€Ÿå®šä½ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-36e0fcbbeca0ccb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol start="2">
<li>æ‰“å¼€ <code>network.desktop.xml</code> æ–‡ä»¶ï¼Œæ‰¾åˆ° <code>&lt;UseKextless&gt;1&lt;/UseKextless&gt;</code> æˆ– <code>&lt;UseKextless&gt;-1&lt;/UseKextless&gt;</code>ï¼Œä¿®æ”¹ä¸º <code>&lt;UseKextless&gt;0&lt;/UseKextless&gt;</code> å¹¶ä¿å­˜ã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ff8b142a88514abe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¦‚æœæ‰¾ä¸åˆ° <code>&lt;UseKextless&gt;1&lt;/UseKextless&gt;</code> æˆ– <code>&lt;UseKextless&gt;-1&lt;/UseKextless&gt;</code>ï¼Œé‚£ä¹ˆéœ€è¦æ–°å¢ä¸€è¡Œã€‚</p>
<pre><code class="language-xml">&lt;ParallelsNetworkConfig schemaVersion=&quot;1.0&quot; dyn_lists=&quot;VirtualNetworks 1&quot;&gt;
  &lt;!-- åœ¨ç¬¬ä¸€è¡Œæ–°å¢å³å¯ --&gt;
  &lt;UseKextless&gt;0&lt;/UseKextless&gt;
&lt;/ParallelsNetworkConfig&gt;
</code></pre>
<ol start="3">
<li>å®Œå…¨é€€å‡º Parallels Desktopï¼Œé‡æ–°æ‰“å¼€ï¼Œå°±èƒ½æ­£å¸¸è¿æ¥ç½‘ç»œäº†ã€‚</li>
</ol>
<blockquote>
<p>è‹¥æƒ³åœ¨ Parallels Desktop ä¸­ï¼Œä» Windows 10 å‡çº§è‡³ Windows 11ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/3c11b48ef274">Mac å‡çº§ Win11 ç³»ç»Ÿ</a>ã€‚</p>
</blockquote>
<h2>More</h2>
<p>å‡è®¾ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„<strong>æ–‡æœ¬ç¼–è¾‘ APP</strong> æ¥è¿›è¡Œä¿®æ”¹ï¼Œå› è¯»å†™æƒé™é—®é¢˜ï¼Œå¯èƒ½æ— æ³•ç›´æ¥ä¿å­˜ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e9cf27c75d3c12ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ–‡ä»¶æ‹·è´åˆ° Desktop æ¡Œé¢ï¼ˆæˆ–å…¶ä»–å¯æ­£å¸¸è¯»å†™çš„æ–‡ä»¶å¤¹éƒ½å¯ï¼‰ï¼Œå†è¿›è¡Œä¿®æ”¹ä¿å­˜ï¼Œç„¶åé‡æ–°æ‹·è´å›åŸæ¥çš„æ–‡ä»¶å¤¹å³å¯ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac å‡çº§ Win11 ç³»ç»Ÿï¼ˆäº²æµ‹å·²æˆåŠŸï¼‰]]></title>
            <link>https://github.com/toFrankie/blog/issues/21</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/21</guid>
            <pubDate>Sat, 25 Feb 2023 10:50:44 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e6f5d960c7326d5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3e6f5d960c7326d5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ç½‘ä¸Šæ‰¾äº†å¥½å¤šæ•™ç¨‹éƒ½æ˜¯æ²¡ç”¨çš„ï¼Œæˆ–è€…æ˜¯æœ‰å¿çš„......ç»ˆäºè‡ªå·±ä¹Ÿæœ‰äº†ä¸ªæ•™ç¨‹ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ© <strong>Macï¼ˆIntelï¼‰+ Parallels Desktop</strong> çš„ç”¨æˆ·ä» Win10 å‡çº§åˆ° Win11ã€‚</p>
<blockquote>
<p>å£°æ˜ï¼šæœ¬äººæ²¡æœ‰ M1 èŠ¯ç‰‡çš„æœºå™¨ï¼Œæœªå°è¯•æœ¬æ•™ç¨‹æ˜¯å¦é€‚ç”¨ï¼Œä¹Ÿä¸æ¸…æ¥šä¼šå¦å¯¼è‡´æ„å¤–çš„é—®é¢˜ï¼Œåæœè‡ªè´Ÿã€‚ï¼ˆèµ¶ç´§æŠŠé”…ä¸¢æ‰ï¼Œæ€•èƒŒèº«ä¸Šäº†ï¼Œä½†çœŸçš„è¯·æ…é‡ï¼ï¼ï¼ï¼‰</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7c479abe6f0ebc62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç³»ç»Ÿç‰ˆæœ¬ï¼šmacOS 11.5.2ï¼ˆå¦‚å›¾ï¼‰ï¼Œè™šæ‹Ÿæœºï¼šParallels Desktop 17.0.0 (51461)ã€‚</p>
<p>ç”±äºæœ¬äººä¸šä½™çˆ±å¥½æ˜¯è®¾è®¡ï¼Œç®—æ˜¯é¢œç‹—å§ã€‚å°½ç®¡å¯èƒ½ä¸‡å¹´éƒ½ä¸ä¼šæ‰“å¼€åœ¨è™šæ‹Ÿæœºä¸­æ²‰ç¡çš„ Windows ç³»ç»Ÿï¼Œä½†è¿˜æ˜¯éå¸¸åœ°æƒ³æŠŠåŸå…ˆçš„ Windows 10 å‡çº§åˆ° Windows 11ã€‚</p>
<h3>ä¸€ã€å¼€å¯ Windows é¢„è§ˆä½“éªŒè®¡åˆ’</h3>
<p>è‹¥æ— ä½“éªŒè®¡åˆ’çš„è¯ï¼Œå‰å¾€<strong>è®¾ç½® -&gt; éšç§ -&gt; è¯Šæ–­å’Œåé¦ˆ</strong>ï¼Œå‹¾é€‰å¯é€‰è¯Šæ–­æ•°æ®ã€å¼€å¯æ”¹è¿›å¢¨è¿¹ä¹¦å†™å’Œé”®å…¥ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d99d95166a9cc4b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰å¾€<strong>è®¾ç½® -&gt; æ›´æ–°å’Œå®‰å…¨ -&gt; å¼€å¯ Windows é¢„è§ˆä½“éªŒè®¡åˆ’</strong>ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°åŠ å…¥é¢„è§ˆè®¡åˆ’äº†ã€‚å¯èƒ½å¼€å¯åéœ€è¦é‡å¯ã€‚ï¼ˆå¿˜æˆªå›¾äº†ï¼‰</p>
<p>éå¸¸é—æ†¾ï¼Œé‡å¯å®Œä¹‹åï¼Œå¯èƒ½ä»ä¼šå‘Šè¯‰æˆ‘ä»¬æ‚¨çš„æœºå™¨ä¸æ”¯æŒ Windows 11ï¼ŒåŸå› ä¼—æ‰€å‘¨çŸ¥...ï¼ˆä¹Ÿå¿˜æˆªå›¾äº†ï¼‰</p>
<p>è§£å†³æ–¹æ³•ï¼šæŒ‰ä¸‹ <code>Win + R</code> ç»„åˆé”®ï¼ˆå…¶å®åœ¨ Mac é”®ç›˜åº”è¯¥æ˜¯ <code>âŒ˜ + R</code>ï¼‰ï¼Œè¾“å…¥ <code>regedit</code> å›è½¦æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œæ‰¾åˆ°ï¼š<code>HKEY_LOCAL_MACHINE -&gt; SOFTWARE -&gt; Microsoft -&gt; WindowsSelfHost -&gt; UI -&gt; Selection -&gt; UIBranch</code>ï¼ŒåŒå‡»ä¿®æ”¹ä¸º <code>Dev</code> å¹¶ä¿å­˜ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f39e5935f403b04f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç„¶åè¿”å› Windows é¢„è§ˆä½“éªŒè®¡åˆ’ç•Œé¢ï¼Œå¯èƒ½ä»æç¤ºä¸æ”¯æŒ Windows 11 çš„æ›´æ–°...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-2ffb64e155ead292.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä½†æ²¡å…³ç³»ï¼Œå‰å¾€<strong>è®¾ç½® -&gt; æ›´æ–°å’Œå®‰å…¨ -&gt; Windows æ›´æ–°</strong>ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ”¶åˆ°ç±»ä¼¼ <code>Windows 11 Insider Preview 10.0.22000.160 (co_release)</code> çš„æ›´æ–°è¯·æ±‚çš„ã€‚</p>
<h3>äºŒã€æ›´æ–°å‰</h3>
<p>ç”±äºåç»­æ›´æ–°ä¸‹è½½çš„è¿‡ç¨‹ï¼Œå¯èƒ½ä¼šæç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5d79d9d7d8d09066.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åŸå› æ˜¯åœ¨ PD åå¥½è®¾ç½®ä¸­ï¼Œæˆ‘å¯¹è¿™å°è™šæ‹Ÿæœºåˆ†é…äº† 2G çš„å†…å­˜ã€‚ç”±äºä¿®æ”¹å†…å­˜éœ€è¦å¯¹è™šæ‹Ÿæœºå…³æœºæ‰èƒ½ä¿®æ”¹ï¼Œå› æ­¤å»ºè®®æå‰æ”¹ä¸€ä¸‹ã€‚ï¼ˆå‡†å¤‡å‡çº§ä¹‹åå†æ”¹å›æ¥ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ca12862c5f53429d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æŒ‰è¦æ±‚è®¾ç½® 4G å†…å­˜å³å¯ã€‚å¦‚æœå‡çº§è¿‡ç¨‹ä¸­æ‰å‘ç°ä¹Ÿæ²¡é—®é¢˜ï¼Œå…³æ‰è™šæ‹Ÿæœºé‡æ–°è®¾ç½®ä¸‹ï¼Œå†å¼€æœºè¿›è¡Œæ›´æ–°å³å¯ã€‚</p>
<p>è¿˜æœ‰ä¸€æ­¥æ“ä½œï¼Œåœ¨è™šæ‹Ÿæœºçš„é…ç½®ä¸­åŠ ä¸Š<strong>TPMèŠ¯ç‰‡</strong>é€‰é¡¹ï¼Œè¿™æ˜¯åœ¨å…¶ä»–å¸–å­çš„æ•™ç¨‹çœ‹åˆ°çš„ï¼Œå½“åˆæ·»åŠ äº†ä½†ä¹Ÿæ˜¯æ²¡åŠæ³•å‡çº§ Win11 çš„ã€‚ï¼ˆå¯èƒ½è¿™ä¸ªæ­¥éª¤ä¹Ÿä¸é‡è¦å§ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3fe5634ca0836462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>ä¸‰ã€æ›´æ–°è¿‡ç¨‹</h3>
<p>æœ‰ä¸€ä¸ªè¿›åº¦èŠ‚ç‚¹å¯èƒ½ä¼šå¡ä½æˆ–å¼¹çª—æé†’ï¼š<strong>8%</strong>ï¼ŒåŸå› æ˜¯ Mac æ‰€æœ‰æœºå™¨ç†è®ºä¸Šä¸æ”¯æŒæ›´æ–° Win11ã€‚</p>
<blockquote>
<p>æˆ‘åˆ°è¿™ä¸€æ­¥çš„æé†’æ˜¯å‰é¢çš„å†…å­˜ä¸æ»¡è¶³ç³»ç»Ÿè¦æ±‚ã€‚ä¿®æ”¹äº†å†…å­˜åˆ†é…å°±èƒ½ç»§ç»­æ›´æ–°äº†ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4fb4b28d15359594.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä¸è¦æ…Œï¼Œæ­¤æ—¶å‰å¾€ <code>æ–‡ä»¶èµ„æºç®¡ç†å™¨ -&gt; æ­¤ç”µè„‘ -&gt; æœ¬åœ°ç£ç›˜(C:) -&gt; $WINDOWS.~BT -&gt; Sources</code> ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° <code>AppraiserRes.dll</code> æ–‡ä»¶å¹¶åˆ é™¤ã€‚å…¶ä¸­ <code>$WINDOWS.~BT</code> å±äºéšè—æ€§æ–‡ä»¶ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d2ff031e94d87271.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿”å›æ›´æ–°ç•Œé¢ï¼Œç»§ç»­è¿›è¡Œæ›´æ–°...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8a3aaaa6a37d994d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ­¤å¤„çœç•¥ä¸€ä¸‡å­—......ä¸‹è½½å®‰è£…å®Œæˆï¼Œé‡å¯ä¸­...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-f54c626d2c48d5e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5c07b9105d341bb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>å››ã€æ›´æ–°å</h3>
<p>æ›´æ–°æˆåŠŸäº†ï¼Œåœ¨ UI é¢œå€¼ä¸Šç¡®å®æœ‰äº†é•¿è¶³çš„æå‡...ç®€å•ä½“éªŒä¸‹æ¥ï¼Œç•¥æœ‰ç‚¹å°å¡...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-7af1ebf47946ab87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-276d73efa206e2ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æŸä¸ª Moment ä¸å°å¿ƒæ‰“å¼€<strong>ç”µè„‘å¥åº·çŠ¶å†µæ£€æŸ¥</strong>å‘ç°ï¼Œç«Ÿç„¶åˆè¡Œäº†ï¼Œå“ˆå“ˆã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-a610176c4458f5ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘æ€€ç–‘è·Ÿåˆ†é…çš„å†…å­˜æœ‰å…³ï¼Œæˆ‘åé¢æ”¹å› 2G å†…å­˜ï¼Œåˆæç¤ºè¿™å°ç”µè„‘æ— æ³•è¿è¡Œ Windows 11 äº†ã€‚Anywayï¼Œå·²ç»æ›´æ–°æˆåŠŸäº†...</p>
<p>ä½†æˆ‘å‘ç° IE æµè§ˆå™¨ç”¨ä¸äº†äº†ï¼Œç”¨å®ƒåªæ˜¯ä½œä¸ºå‰ç«¯ç‹—ç”¨æ¥è°ƒè¯• JavaScript å…¼å®¹æ€§è€Œå·²...é¡¾æ­¤å¤±å½¼ï¼Ÿ</p>
<blockquote>
<p>éå¸¸æ„Ÿè°¢è´´å§<strong>ç„¡æ®‡</strong>å¤§ä½¬çš„æ•™ç¨‹ï¼š<a href="https://tieba.baidu.com/p/7429413626?pid=140099731393&amp;cid=0#140099731393">MacBookï¼ˆIntelï¼‰æ›´æ–° Windows11 æ•™ç¨‹</a>ã€‚</p>
</blockquote>
<h2>äº”ã€å…¶ä»–</h2>
<p>å¯¹äºåŸºäºè‹¹æœ M ç³»åˆ—çš„ Macï¼Œåˆ™éœ€è¦ä¸‹è½½å¯¹åº”çš„ Windows ARM ç‰ˆ ISO é•œåƒè¿›è¡Œå®‰è£…ã€‚</p>
<ul>
<li><a href="https://kb.parallels.com/en/125375">Install Windows on a Mac with Apple M-series chip</a></li>
<li><a href="https://www.parallels.cn/products/desktop/resources/#requirements">Parallels Desktop for Mac æŠ€æœ¯æ–‡æ¡£å’Œèµ„æº</a></li>
<li><a href="https://kb.parallels.com/cn/125344">ä»åŸºäº Intel çš„è™šæ‹Ÿæœºä¸Šå¤åˆ¶ä¸ªäººæ•°æ®</a></li>
</ul>
<!--

* [Fix "The processor isn't supported" issue when upgrading to Windows 11
](https://kb.parallels.com/128517?language=cn)
* [Use virtual Trusted Platform Module (TPM) in Parallels Desktop](https://kb.parallels.com/122702?language=cn)

-->]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac ç»ˆç«¯æ‰“å¼€ iCloud ç›®å½•]]></title>
            <link>https://github.com/toFrankie/blog/issues/20</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/20</guid>
            <pubDate>Sat, 25 Feb 2023 10:49:23 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-079f4fcf0d074ba7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-079f4fcf0d074ba7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>ä¹ æƒ¯ä¸Šï¼Œä¸æ¸…æ¥šè·¯å¾„åœ¨å“ªçš„è¯ï¼Œåœ¨ Finder ç›¸åº”æ–‡ä»¶æ‹–æ‹½åˆ°ç»ˆç«¯åº”ç”¨ï¼Œä¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚</p>
<p>ç„¶åï¼Œä»Šå¤©æƒ³æ‰“å¼€ iCloud äº‘ç›˜è·¯å¾„æ—¶ï¼Œç›´æ¥æ‹–è¿‡å» <code>cd</code> æ‰“å¼€ï¼Œå´ï¼š</p>
<pre><code class="language-shell">$ cd /Users/frankie/Library/Mobile Documents/comappleCloudDocs/Alfred

cd: no such file or directory: /Users/frankie/Library/Mobile Documents/comappleCloudDocs/Alfred
</code></pre>
<p>ç„¶åä»”ç»†çœ‹äº†ä¸‹ï¼ŒåŸæ¥æ˜¯ <code>Mobile Documents</code> ç›®å½•ä¸­é—´æ˜¯å«ä¸€ä¸ª <code>ç©ºæ ¼</code>ï¼Œå› æ­¤æ‰“å¼€çš„æ—¶å€™éœ€è¦ <code>\</code> è½¬ä¹‰ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<pre><code>$ cd ~/Library/Mobile\ Documents/com\~apple\~CloudDocs
</code></pre>
<p>è¿™æ˜¯ä¸€ç¯‡æ²¡è¥å…»çš„æ–‡ç« ï¼ˆå®Œï¼‰ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[iPhone ä¸ Mac æ¥åŠ›å¤±æ•ˆè§£å†³æ–¹æ³•]]></title>
            <link>https://github.com/toFrankie/blog/issues/19</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/19</guid>
            <pubDate>Sat, 25 Feb 2023 10:48:46 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3ea4be356105eb09.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰æ®µæ—¶é—´]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-3ea4be356105eb09.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å‰æ®µæ—¶é—´è‹¹æœ WWDC2021 å‘å¸ƒ iOS 15 Developer Betaï¼ˆé¢å‘å¼€å‘è€…æµ‹è¯•ç‰ˆæœ¬ï¼‰ï¼Œç”±äºæˆ‘æ˜¯å°é²œæ´¾åˆæƒ³ç€è¿™æ¬¡æ”¹åŠ¨å¥½åƒå¾ˆå°ï¼ŒBug åº”è¯¥ä¸ä¼šå¤ªå¤šï¼Œç„¶åå°±å‡çº§äº†...</p>
<blockquote>
<p>è¿˜æ˜¯å¤ªå¤©çœŸäº†ï¼Œè™½ç„¶ä¸ç®—ä»€ä¹ˆä¸¥é‡çš„ Bugï¼Œä½†ä¸€äº›ç»†èŠ‚æ€§çš„é—®é¢˜ä¼šå½±å“æ­£å¸¸ä½¿ç”¨ï¼Œæœ€ç»ˆé™çº§äº†...</p>
</blockquote>
<p>ç”±äºé™çº§æ—¶ï¼Œé€‰æ‹©ã€Œä¿ç•™æ•°æ®ã€åˆ·å›ºä»¶çš„æ–¹å¼ä¸€ç›´å¤±è´¥ï¼Œäºæ˜¯æ²¡ä¿å­˜æ•°æ®å°±é™çº§äº†ï¼Œå› æ­¤å˜æˆäº†ä¸€å°æ–°æœº...</p>
<p>åæ¥ï¼Œæœ‰ä¸€å¤©å‘ç°æˆ‘çš„ iPhoneï¼ˆiOS 14.7ï¼‰å’Œ Macï¼ˆBig Surï¼‰ ä¸èƒ½æ¥åŠ›äº†ã€‚</p>
<p>ä½†å…¶å®ä¸å…¨æ˜¯ï¼Œç±»ä¼¼é€šç”¨å‰ªè´´æ¿ã€iPhone èœ‚çªç§»åŠ¨ç½‘ç»œé€šè¯ã€çŸ­ä¿¡è½¬å‘ã€éš”ç©ºæŠ•é€ç­‰åŠŸèƒ½è¿˜æ˜¯æ­£å¸¸çš„ï¼Œ</p>
<p>ä½†æ˜¯ Safari ç½‘é¡µæˆ– App æ¥åŠ›åŠŸèƒ½ä¼¼ä¹ä¸æ­£å¸¸äº†ï¼Œå…·ä½“è¡¨ç°æ˜¯ Dock æ æ²¡æœ‰æç¤ºã€‚</p>
<p>æ­£å¸¸æ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d92d233e233b9c6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»¥ä¸‹è§£å†³æ–¹æ³•ä¸ä¸€å®šéƒ½é€‚ç”¨äºæ‰€æœ‰å¤±æ•ˆçš„æƒ…å†µï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p>
<ul>
<li>
<p><strong>ç¡®ä¿ iPhone ä¸ Mac çš„æ¥åŠ›åŠŸèƒ½æ‰“å¼€</strong>ï¼ˆç›¸ä¿¡è¿™ä¸æ˜¯é—®é¢˜ï¼Œåº”è¯¥æ˜¯æ‰“å¼€äº†ä»ç„¶æ— æ•ˆï¼Œä¸ç„¶ä½ ä¹Ÿçœ‹ä¸åˆ°è¿™ç¯‡æ–‡ç« ï¼‰ï¼›</p>
</li>
<li>
<p><strong>é€€å‡º iCloud è´¦å·ï¼Œé‡æ–°ç™»å½•</strong>ï¼ˆæœ€å¥½ä¸¤ä¸ªè®¾å¤‡éƒ½é€€å‡ºé‡æ–°ç™»å½•ï¼Œä¹Ÿå¯ä»¥å…ˆé€€å‡ºå…¶ä¸­ä¸€ä¸ªè®¾å¤‡è¯•è¯•æœ‰æ²¡æ•ˆæœï¼Œæˆ‘çš„å°±æ˜¯é€€å‡ºä¸¤å°è®¾å¤‡æ‰ç”Ÿæ•ˆäº†ï¼‰ï¼›</p>
</li>
<li>
<p><strong>iPhone å’Œ Mac çš„è“ç‰™è¯·åŒ¹é…ä¸Š</strong>ï¼Œè¿™ç‚¹å¥½åƒç½‘ä¸Šå¾ˆå¤šå¸–å­éƒ½æ²¡æåˆ°çš„ï¼ˆè‹¥æ­¤å‰å·²åŒ¹é…è¿‡ï¼Œå¯åŒæ–¹å…ˆå¿½ç•¥è®¾å¤‡é‡æ–°å»ºç«‹è¿æ¥ï¼‰ã€‚åƒæˆ‘é™çº§ä¹‹åï¼ŒåŸå…ˆçš„åŒ¹é…è®°å½•å°±æ²¡æœ‰äº†</p>
</li>
</ul>
<h4>2022.02.27 æ›´æ–°ï¼š</h4>
<p>è‹¥ç±»ä¼¼ Mac æ— æ³•æ¥æ”¶åˆ° iPhone çš„ã€Œéš”ç©ºæŠ•é€ã€ï¼Œè€Œ iPhone å´èƒ½æ¥æ”¶åˆ° Mac çš„ã€Œéš”ç©ºæŠ•é€ã€çš„æƒ…å†µï¼Œè¿™æ—¶å¯ä»¥å°è¯•å°†åŒæ–¹çš„è“ç‰™å…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œå°†å¯¹æ–¹ä»è“ç‰™é…å¯¹åˆ—è¡¨åˆ é™¤ï¼Œç„¶åé‡æ–°é…å¯¹ä¸€ä¸‹ï¼ˆæœ€å¥½é‡å¯ä¸‹è®¾å¤‡ï¼‰ã€‚</p>
<p>å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©~</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Alfred Clipboard History å›è½¦è‡ªåŠ¨ç²˜è´´å¤±æ•ˆ]]></title>
            <link>https://github.com/toFrankie/blog/issues/18</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/18</guid>
            <pubDate>Sat, 25 Feb 2023 10:48:18 GMT</pubDate>
            <description><![CDATA[<p>Alfred æ˜¯ä¸€æ¬¾ç³»ç»Ÿå¢å¼ºçš„åº”ç”¨ï¼Œæ—¥å¸¸ä½¿ç”¨é‡Œå·²ç»å°†å®ƒæ›¿ä»£äº†ç³»ç»Ÿè‡ªå¸¦çš„ Spotlight åŠŸèƒ½ã€‚</p>
<p>å¹³å¸¸ç”¨å¾—æœ€å¤šçš„ä¸æ˜¯ Web Search åŠŸèƒ½ï¼Œè€Œæ˜¯ Clipboard History åŠŸèƒ½ã€‚</p>
<p>æ¯•ç«Ÿæ—¥å¸¸æ¬ç –å°±æ˜¯ âŒ˜ + Cã€âŒ˜ + Vï¼Œå“ˆå“ˆ...</p>
<p><img src="]]></description>
            <content:encoded><![CDATA[<p>Alfred æ˜¯ä¸€æ¬¾ç³»ç»Ÿå¢å¼ºçš„åº”ç”¨ï¼Œæ—¥å¸¸ä½¿ç”¨é‡Œå·²ç»å°†å®ƒæ›¿ä»£äº†ç³»ç»Ÿè‡ªå¸¦çš„ Spotlight åŠŸèƒ½ã€‚</p>
<p>å¹³å¸¸ç”¨å¾—æœ€å¤šçš„ä¸æ˜¯ Web Search åŠŸèƒ½ï¼Œè€Œæ˜¯ Clipboard History åŠŸèƒ½ã€‚</p>
<p>æ¯•ç«Ÿæ—¥å¸¸æ¬ç –å°±æ˜¯ âŒ˜ + Cã€âŒ˜ + Vï¼Œå“ˆå“ˆ...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-0ebf58470d98e8fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç„¶è€Œï¼Œä»Šå¤©å°† Alfred æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ä¹‹åï¼Œå‘ç° Clipboard History åŠŸèƒ½æ— æ³•é€šè¿‡å›è½¦é”®è‡ªåŠ¨ç²˜è´´æ–‡æœ¬äº†ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹æ•™ç¨‹åŸºäº Alfred 4.3.3 ä¸­æ–‡ç‰ˆï¼ŒmacOS 11.3.1ã€‚ä¸åŒçš„ç³»ç»Ÿæˆ–è½¯ä»¶ç‰ˆæœ¬å¯èƒ½ç¨æœ‰å·®å¼‚ã€‚</p>
</blockquote>
<h3>æ’æŸ¥åŸå› </h3>
<ol>
<li>æ‰“å¼€ Alfred åå¥½è®¾ç½®ï¼Œåœ¨ã€ŒFeatures â€” Clipboard History â€” Advancedã€ï¼Œç¡®ä¿å¼€å¯äº†ã€ŒAuto-Paste on returnï¼ˆå›è½¦æ—¶è‡ªåŠ¨ç²˜è´´ï¼‰ã€åŠŸèƒ½ã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-73dbef1429e93494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ol start="2">
<li>æ‰“å¼€ã€Œç³»ç»Ÿåå¥½è®¾ç½® â€” å®‰å…¨æ€§ä¸éšç§ â€” éšç§ã€ï¼Œæ‰¾åˆ°ã€Œè¾…åŠ©åŠŸèƒ½ã€ï¼Œå‚ç…§æˆªå›¾ï¼Œå°† Alfred å‹¾é€‰ä¸Šã€‚</li>
</ol>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-9bca5424f0b849ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<ol>
<li>å¦‚æœæ— æ³•æ“ä½œï¼Œè¯·å…ˆæŠŠå·¦ä¸‹è§’è§£é”ã€‚</li>
<li>å¦‚æœå·²å‹¾é€‰ä¸Šä»ç„¶æ— æ³•å›è½¦ç²˜è´´ï¼Œå…ˆå°† Alfred ç§»é™¤ï¼Œé‡æ–°æ·»åŠ ï¼ˆå³å›¾ä¸­ <code>+</code>ã€<code>-</code> å›¾æ ‡ï¼‰ã€‚</li>
<li>å¦‚æœåˆ—è¡¨é‡Œé¢åŸæœ¬æ²¡æœ‰ Alfred é€‰é¡¹ï¼Œæ‰‹åŠ¨æ·»åŠ å³å¯ã€‚</li>
</ol>
</blockquote>
<p>æˆ‘é€šè¿‡ç§»é™¤é‡æ–°æ·»åŠ çš„æ–¹å¼è§£å†³äº†ï¼Œå¯ä»¥ç»§ç»­æ„‰å¿«åœ°ç©è€äº†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ Charles æŠ“å– HTTPS è¯·æ±‚ unknown çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/17</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/17</guid>
            <pubDate>Sat, 25 Feb 2023 10:46:20 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-83d240152ee56787.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-83d240152ee56787.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>åœ¨ Mac ä¸‹ä½¿ç”¨ Charles å·¥å…·è¿›è¡ŒæŠ“åŒ…ï¼Œç„¶åæŠ“å– HTTPS è¯·æ±‚æ—¶ï¼Œå‡ºç° unknownï¼Œæ— æ³•è§£æçš„æƒ…å†µå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>
<blockquote>
<p>å¦‚æœ App ä½¿ç”¨äº† SSL Pinning æŠ€æœ¯ï¼ŒæŒ‰æœ¬æ–‡æ“ä½œä¹‹åæœ‰å¯èƒ½è¿˜æ˜¯ä¸è¡Œï¼Œå¯çœ‹æ–‡æœ«å¼•ç”¨é“¾æ¥ã€‚</p>
</blockquote>
<!--
é“¾æ¥: https://pan.baidu.com/s/1q_QBQ6ev7KEHp3lOGQaA-w  å¯†ç : 3437

charlesè¿‡æœŸå¤„ç†ï¼š

1.ä»ç½‘ä¸Šæ‰¾ä¸€ä¸ª æ³¨å†Œç  è®°å½•ä¸‹ åç§°å’Œæ³¨å†Œç ä¿¡æ¯

Registered Name: https://zhile.io

License Key: 48891cf209c6d32bf4
-->
<h2>å®‰è£…è¯ä¹¦</h2>
<p>åŒ…æ‹¬ç”µè„‘ç«¯å’Œæ‰‹æœºç«¯ï¼Œè¿™ä¹Ÿæ˜¯æŠ“å– HTTPS è¯·æ±‚çš„å…³é”®æ‰€åœ¨ã€‚</p>
<h3>1. ç”µè„‘ç«¯</h3>
<p>æ‰“å¼€ Charlesï¼Œç„¶ååœ¨èœå•æ é€‰æ‹© <strong>Help â†’ SSL Proxying â†’ Install Charles Root Certificate</strong>ï¼Œå°†è¯ä¹¦å®‰è£…è‡³ç”µè„‘ï¼Œå¹¶æ‰“å¼€<strong>é’¥åŒ™ä¸²è®¿é—®</strong>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ad271ab6e2ea9b27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¯ä¹¦å®‰è£…åï¼Œé»˜è®¤æ˜¯<strong>ä¸è¢«ä¿¡ä»»</strong>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å…¶è®¾ç½®ä¸ºä¿¡ä»»ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-34b1c55c772e3e68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨<strong>é’¥åŒ™ä¸²</strong>ä¸­æ‰¾åˆ°è¯¥è¯ä¹¦ <strong>Charles Proxy CA</strong>ï¼Œå¹¶è®¾ç½®ä¸º<strong>å§‹ç»ˆä¿¡ä»»</strong>ï¼Œç„¶åä¿å­˜ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5bfe4f3e34e478e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™æ ·ç”µè„‘ç«¯è¯ä¹¦å°±å®‰è£…å®Œæˆäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d9e427f58dcbc9c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3>2. æ‰‹æœºç«¯</h3>
<blockquote>
<p>ä¸‹é¢ä»¥ iOS è®¾å¤‡ä¸ºä¾‹ï¼Œè€Œ Android ç«¯å„å®šåˆ¶ç³»ç»Ÿå®‰è£…è¯ä¹¦çš„æ–¹å¼å¯èƒ½ç•¥æœ‰å·®å¼‚ã€‚</p>
</blockquote>
<p>åŒæ ·åœ¨èœå•æ é€‰æ‹© <strong>Help â†’ SSL Proxying â†’ Install Charles Root Certificate on a Mobile Device or Remote Browser</strong>ï¼Œå°†ä¼šæœ‰ä»¥ä¸‹æç¤ºã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-aac2e07fe69b8ec7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œæ‰‹æœºä¸ç”µè„‘éœ€è¿æ¥åœ¨åŒä¸€å±€åŸŸç½‘å†…ã€‚</p>
</blockquote>
<p>åœ¨æ‰‹æœºæ‰“å¼€ï¼š<strong>è®¾ç½® â†’ Wi-Fi â†’ æ‰“å¼€æ‰€è¿ WiFi â†’ è®¾ç½® HTTP ä»£ç† â†’ é€‰æ‹©æ‰‹åŠ¨</strong>ï¼Œæ¥ç€å°† IP åœ°å€ä»¥åŠç«¯å£å¡«å†™è¿›å»ï¼Œç„¶åå­˜å‚¨å³å¯ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1a6fe70a3be5e365.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¾“å…¥è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¸€æ  <code>.</code> ä¹‹é—´å¯èƒ½ä¼šè‡ªåŠ¨æ’å…¥ç©ºæ ¼ï¼Œæ‰‹åŠ¨åˆ é™¤ä¸€ä¸‹ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-33d517d6dca453c6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æ¥ç€æ‰“å¼€ç³»ç»Ÿ <strong>Safari æµè§ˆå™¨</strong>ï¼ˆå…¶ä»–æµè§ˆå™¨å¯èƒ½æ— æ³•å”¤èµ·å®‰è£…è¯ä¹¦çš„å¼¹çª—ï¼‰ï¼Œè¾“å…¥åœ°å€ <code>http://chls.pro/ssl</code> æ‰“å¼€é¡µé¢ï¼Œä¼šè‡ªåŠ¨å”¤èµ·å®‰è£…æè¿°æ–‡ä»¶çš„å¼¹çª—ï¼Œé€‰æ‹©<strong>å…è®¸</strong>ã€‚</p>
<blockquote>
<p>å¦‚æœ <code>http://chls.pro/ssl</code> åŠ è½½å¾ˆä¹…éƒ½æ‰“ä¸å¼€ï¼Œå°è¯• <code>http://charlesproxy.com/getssl</code>ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-400165f07f7bc407.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç´§æ¥ç€ï¼Œå‰å¾€ï¼š<strong>è®¾ç½® â†’ é€šç”¨ â†’ æè¿°æ–‡ä»¶ â†’ é€‰æ‹©å¯¹åº”æè¿°æ–‡ä»¶ â†’ å®‰è£…</strong>ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-8b09818aaf5bf63c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>è¿˜æœ‰æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå¾ˆå¤šäººå°±æ˜¯å¿½ç•¥äº†è¯¥æ­¥éª¤ï¼Œå¯¼è‡´å®‰è£…å®Œè¯ä¹¦åï¼ŒæŠ“å– HTTPS è¯·æ±‚ä»æ˜¯ unknownã€‚</p>
</blockquote>
<p>å‰å¾€ï¼Œ<strong>è®¾ç½® â†’ é€šç”¨ â†’ å…³äºæœ¬æœº â†’ è¯ä¹¦ä¿¡ä»»è®¾ç½®ï¼ˆæ»‘åˆ°å±å¹•æœ€ä¸‹é¢ï¼‰ â†’ å°† Charles è¯ä¹¦å‹¾é€‰ä¸Š</strong>å³å¯ã€‚ï¼ˆPSï¼šæˆ‘æˆªå›¾æœ‰ä¸¤ä¸ªæ˜¯è¯ä¹¦æ˜¯ä¸¤å°ä¸åŒçš„æœºå™¨ï¼‰</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-40df838734211e93.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>Charles é…ç½®</h2>
<p>Charles é»˜è®¤æ˜¯ <code>8888</code>ï¼Œä¸å ç”¨å…¶ä»–æœåŠ¡ç«¯å£æƒ…å†µä¸‹ï¼Œä¸ä¿®æ”¹é—®é¢˜ä¹Ÿä¸å¤§ï¼Œæ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œè°ƒæ•´ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e7d95dd67603355b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é…ç½®æ˜¯ <strong>SSL Proxying Settings</strong>ï¼Œå‹¾é€‰ä¸Š <strong>Enable SSL Proxying</strong>ï¼Œæ·»åŠ  <strong>Include</strong>ã€‚å¦åˆ™å³ä½¿æ·»åŠ äº†è¯ä¹¦ï¼ŒæŠ“å– HTTPS ä¹Ÿæ˜¯ unknownã€‚</p>
<p>è¿™é‡Œæ ¹æ®å®é™…éœ€æ±‚æ¥è®¾ç½® Include æˆ–è€… Excludeï¼Œæˆ‘è¿™é‡Œè®¾ç½®ä¸º <code>*.*</code>ï¼ˆè¡¨ç¤ºæ‰€æœ‰åŸŸåæˆ–è€…ç«¯å£ï¼‰ã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6b36a25ed8279f67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>æ•ˆæœ</h2>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«åœ°ç©è€äº†</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-79e67cfbb76e8b8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2>å…³äº Android æ— æ³•æŠ“åŒ…çš„é—®é¢˜</h2>
<blockquote>
<p>ç”±äºæŒºä¹…æ²¡æœ‰æ€ä¹ˆæŠ˜è…¾è¿‡ Android æ‰‹æœºäº†ï¼Œä¸‹é¢è¿™å—å†…å®¹æºè‡ªç½‘ä¸Šæ•´ç†çš„ï¼Œä¹Ÿæ²¡æœ‰æ—¶é—´å»å®é™…æµ‹è¯•è¿‡ã€‚</p>
</blockquote>
<p>ç”±äº Android æœºå‹ä¼—å¤šï¼Œå„å®šåˆ¶ç³»ç»Ÿå·®åˆ«ä¹Ÿä¸åŒï¼Œå®‰è£…è¯ä¹¦åœ¨ä¸åŒ Android ç‰ˆæœ¬ä¹Ÿæœ‰é™åˆ¶ï¼Œå¯¼è‡´åœ¨ä½¿ç”¨ Charles è¿›è¡ŒæŠ“åŒ…æ—¶è¦æ¯” iOS éš¾å¾ˆå¤šã€‚</p>
<p>Android 7.0 ä¹‹åé»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·æ·»åŠ åˆ°ç³»ç»Ÿçš„ CA è¯ä¹¦ï¼š</p>
<blockquote>
<p>To provide a more consistent and more secure experience across the Android ecosystem, beginning with Android Nougat, compatible devices trust only the standardized system CAs maintained in AOSP. <a href="https://android-developers.googleblog.com/2016/07/changes-to-trusted-certificate.html">Android Developers Blog</a></p>
</blockquote>
<p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯¹åŸºäº SDK24 åŠä»¥ä¸Šçš„ APP æ¥è¯´ï¼Œå³ä½¿ä½ åœ¨æ‰‹æœºä¸Šå®‰è£…äº†æŠ“åŒ…å·¥å…·çš„è¯ä¹¦ä¹Ÿæ— æ³•æŠ“å– HTTPS è¯·æ±‚ã€‚</p>
<p>ä¸‹é¢æä¾›å‡ ä¸ªé“¾æ¥ï¼š</p>
<ul>
<li>å®‰è£… Xposed æ¨¡å—è§£å†³ Android ç«¯è¯ä¹¦çš„é—®é¢˜ï¼Œè¯·çœ‹ <a href="https://github.com/Fuzion24/JustTrustMe">JustTrustMe</a>ï¼ˆæˆ‘å¬è¯´å…¬å¸æµ‹è¯•åŒäº‹ä¹Ÿæ˜¯è¿™æ ·å¤„ç†çš„ï¼‰ã€‚</li>
<li><a href="https://blog.csdn.net/shadowyspirits/article/details/79756274">Android 7.0 ä¹‹åæŠ“åŒ… unknown å’Œè¯ä¹¦æ— æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼ˆæ— éœ€æ”¹ä»£ç ï¼‰</a></li>
<li><a href="https://segmentfault.com/a/1190000011573699">å°ç±³ç³»åˆ—æ‰‹æœºä¸èƒ½å®‰è£… Charles è¯ä¹¦æ€ä¹ˆåŠ</a></li>
</ul>
<h2>References</h2>
<ul>
<li><a href="https://www.cnblogs.com/xuxiaolu/p/6186410.html">Charles æŠ“åŒ…å·¥å…·çš„ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ³•</a></li>
<li><a href="https://www.zhihu.com/question/60618756">å¦‚ä½•å¯¹ä½¿ç”¨äº† ssl pinning çš„APPï¼ˆå¦‚çŸ¥ä¹ï¼‰è¿›è¡ŒæŠ“åŒ…ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/56397466">å½“ä½ å†™çˆ¬è™«æŠ“ä¸åˆ°APPè¯·æ±‚åŒ…çš„æ—¶å€™è¯¥æ€ä¹ˆåŠï¼Ÿ</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Sourcetree for Mac è·³è¿‡æ³¨å†Œ]]></title>
            <link>https://github.com/toFrankie/blog/issues/16</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/16</guid>
            <pubDate>Sat, 25 Feb 2023 10:45:48 GMT</pubDate>
            <description><![CDATA[<ol>
<li>å…³é—­ Sourcetree</li>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</li>
</ol>
<pre><code>$ defaults write com.torusknot.SourceTreeNotMAS completedWelcomeWizardVersion 3
</code></pre>
<ol s]]></description>
            <content:encoded><![CDATA[<ol>
<li>å…³é—­ Sourcetree</li>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</li>
</ol>
<pre><code>$ defaults write com.torusknot.SourceTreeNotMAS completedWelcomeWizardVersion 3
</code></pre>
<ol start="3">
<li>é‡æ–°æ‰“å¼€ Sourcetree å³å¯ã€‚</li>
</ol>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[zsh compinit: insecure directories, run compaudit for list.]]></title>
            <link>https://github.com/toFrankie/blog/issues/15</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/15</guid>
            <pubDate>Sat, 25 Feb 2023 10:27:50 GMT</pubDate>
            <description><![CDATA[<p>ä»Šå¤©ä¿®æ”¹å®Œ <code>.zshrc</code> é…ç½®ä¹‹åï¼Œé€šè¿‡ <code>source ~/.zshrc</code> åˆ·æ–°é…ç½®ï¼Œç„¶åä¸€ç›´å­˜åœ¨ä¸€ä¸ªçƒ¦äººçš„æç¤ºï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-txt">zsh compinit: insecure directories,]]></description>
            <content:encoded><![CDATA[<p>ä»Šå¤©ä¿®æ”¹å®Œ <code>.zshrc</code> é…ç½®ä¹‹åï¼Œé€šè¿‡ <code>source ~/.zshrc</code> åˆ·æ–°é…ç½®ï¼Œç„¶åä¸€ç›´å­˜åœ¨ä¸€ä¸ªçƒ¦äººçš„æç¤ºï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-txt">zsh compinit: insecure directories, run compaudit for list.
Ignore insecure directories and continue [y] or abort compinit [n]?
</code></pre>
<p>æœäº†ä¸€ç•ªï¼Œå¾ˆå¤šäººçš„è§£å†³æ–¹æ³•éƒ½æ²¡ç”¨ï¼Œç›´åˆ°çœ‹åˆ°è¿™ç¯‡<a href="https://my.oschina.net/u/215547/blog/824106">æ–‡ç« </a>ã€‚</p>
<p>æ‰§è¡Œå‘½ä»¤ <code>compaudit</code>ï¼š</p>
<pre><code class="language-shell">$ compaudit

# There are insecure directories:
# /usr/local/share/zsh/site-functions
# /usr/local/share/zsh
</code></pre>
<h2>è§£å†³æ–¹æ³•</h2>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®æ”¹æƒé™</p>
<pre><code class="language-shell">$ cd /usr/local/share/zsh
$ sudo chmod -R 755 site-functions
</code></pre>
<p>å†æ¬¡æ‰§è¡Œ <code>source ~/.zshrc</code>ï¼Œå¦‚æœé—®é¢˜è¿˜æœªè§£å†³ï¼Œè¿™æ—¶ä½ å°±éœ€è¦ä¿®æ”¹ <code>site-functions</code> çš„æ‰€æœ‰è€…ã€‚</p>
<p>OSX 10.9 ä»¥ä¸Šç³»ç»Ÿæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆ<code>user:staff</code> æ˜¯ OSX ç³»ç»Ÿé»˜è®¤æƒé™ï¼‰ï¼š</p>
<pre><code class="language-shell">$ cd /usr/local/share/
$ sudo chmod -R 755 zsh
$ sudo chown -R root:staff zsh
</code></pre>
<p>OSX 10.9 åŠä»¥ä¸‹ç³»ç»Ÿæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">$ cd /usr/local/share/
$ sudo chown -R root:root site-functions
</code></pre>
<p>å†æ¬¡æ‰§è¡Œ <code>source ~/.zshrc</code> å³å¯ï¼</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Homebrew å¡åœ¨ Updating Homebrew...]]></title>
            <link>https://github.com/toFrankie/blog/issues/14</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/14</guid>
            <pubDate>Sat, 25 Feb 2023 10:23:01 GMT</pubDate>
            <description><![CDATA[<blockquote>
<p>æœ¬æ–‡å·²è¿‡æ—¶ï¼Œè¯·çœ‹ <a href="https://github.com/toFrankie/blog/issues/9">Homebrew ä½¿ç”¨è¯¦è§£</a>ã€‚</p>
</blockquote>
<h2>åŸå› </h2>
<p>æ¯æ¬¡å®‰è£…åŒ…å¡åœ¨ Updating Homebrew... çš„]]></description>
            <content:encoded><![CDATA[<blockquote>
<p>æœ¬æ–‡å·²è¿‡æ—¶ï¼Œè¯·çœ‹ <a href="https://github.com/toFrankie/blog/issues/9">Homebrew ä½¿ç”¨è¯¦è§£</a>ã€‚</p>
</blockquote>
<h2>åŸå› </h2>
<p>æ¯æ¬¡å®‰è£…åŒ…å¡åœ¨ Updating Homebrew... çš„é—®é¢˜ï¼ŒåŸå› æ˜¯ Homebrew æ¯æ¬¡å®‰è£…åŒ…çš„æ—¶å€™é»˜è®¤å¼€å¯äº†è‡ªåŠ¨æ›´æ–°çš„è®¾ç½®ã€‚å¯é€šè¿‡é…ç½®å…³é—­æ‰ã€‚</p>
<pre><code class="language-shell"># æ‰“å¼€ .zshrc
$ vim ~/.zshrc

# æœ«å°¾æ·»åŠ ä¸€è¡Œé…ç½®
export HOMEBREW_NO_AUTO_UPDATE=true

# åˆ·æ–°ç¯å¢ƒå˜é‡
$ source ~/.zshrc
</code></pre>
<p>ä¸å«Œéº»çƒ¦å¯ä»¥æ¯æ¬¡éƒ½ç”¨ âŒƒ + C  è·³è¿‡ã€‚</p>
<h2>è§£å†³å®‰è£…ä¾èµ–æ…¢çš„é—®é¢˜</h2>
<p>å…·ä½“æ€è·¯æ˜¯æ›¿æ¢ Homebrew é•œåƒæºã€‚</p>
<ol>
<li>æ›¿æ¢ brew.git</li>
</ol>
<pre><code class="language-shell">$ cd &quot;$(brew --repo)&quot;
$ git remote set-url origin https://mirrors.ustc.edu.cn/brew.git
</code></pre>
<ol start="2">
<li>æ›¿æ¢ homebrew-core.git</li>
</ol>
<pre><code class="language-shell">$ cd &quot;$(brew --repo)/Library/Taps/homebrew/homebrew-core&quot;
$ git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git
</code></pre>
<ol start="3">
<li>é‡ç½® brew.git</li>
</ol>
<pre><code class="language-shell">$ cd &quot;$(brew --repo)&quot;
$ git remote set-url origin https://github.com/Homebrew/brew.git
</code></pre>
<ol start="4">
<li>é‡ç½® homebrew-core.git</li>
</ol>
<pre><code class="language-shell">$ cd &quot;$(brew --repo)/Library/Taps/homebrew/homebrew-core&quot;
$ git remote set-url origin https://github.com/Homebrew/homebrew-core.git
</code></pre>
<p>å¥½å§ï¼Œæ›¿æ¢ä¹‹åï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—æ…¢ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[è§£å†³ XtraFinderã€TotalFinder æ— æ³•å®‰è£…çš„é—®é¢˜]]></title>
            <link>https://github.com/toFrankie/blog/issues/13</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/13</guid>
            <pubDate>Sat, 25 Feb 2023 10:21:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6645cbcfce786693.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6645cbcfce786693.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¾ˆæ—©ä¹‹å‰ï¼ŒmacOS å°±å¼•å…¥äº† SIPï¼ˆSystem Integrity Protectionï¼‰æœºåˆ¶ï¼Œä½¿å¾—ä¸€äº›æœªç»è¿‡ Apple è®¤è¯çš„ç¬¬ä¸‰æ–¹åº”ç”¨æ— æ³•ä½¿ç”¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¦ä½¿ç”¨ XtraFinder è¿™äº›æ’ä»¶ï¼Œå°±åªèƒ½å…³é—­ SIP åŠŸèƒ½äº†ã€‚</p>
<p>å†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å› ä¸º Mac App Store æ— æ³•ä¸‹è½½è½¯ä»¶ï¼Œç„¶åå‚ç…§å®˜æ–¹æŠ€æœ¯äººå‘˜çš„æ–¹æ³•å»è¯•ç€ã€Š<a href="https://support.apple.com/zh-cn/HT204063">é‡ç½® Mac ä¸Šçš„ NVRAM æˆ–è€… PRAM</a>ã€‹ï¼Œå¯¼è‡´äº† SIP æœºåˆ¶è¢«é‡ç½®äº†ï¼Œæ‰€ä»¥åŸæœ¬çš„ XtraFinder å’Œ TotalFinder ä¸¤ä¸ªç³»ç»Ÿå¢å¼ºæ’ä»¶æ‰“ä¸å¼€äº†ã€‚</p>
<h2>æ­¥éª¤</h2>
<ol>
<li>
<p>å…³æœºï¼Œè¿›å…¥æ¢å¤æ¨¡å¼ï¼ˆ<a href="https://support.apple.com/zh-cn/102518?choose-your-type-of-mac=mac-with-apple-silicon">å¦‚ä½•ä»â€œmacOS æ¢å¤â€å¯åŠ¨</a>ï¼‰</p>
<ol>
<li>Intel Macï¼šæŒ‰ä½ âŒ˜ + R ç›´åˆ°å‡ºç° Apple æ ‡å¿—å†æ¾å¼€ã€‚</li>
<li>ARM Macï¼šé•¿æŒ‰ç”µæºé”®ç›´åˆ°å‡ºç°é€‰é¡¹å›¾æ ‡ï¼Œæ¾å¼€ï¼Œé€‰æ‹©é€‰é¡¹è¿›å…¥ã€‚</li>
</ol>
</li>
<li>
<p>èœå•æ é€‰æ‹© Terminal æ‰§è¡Œ <code>csrutil disable</code> ä»¥å…³é—­ SIPã€‚</p>
</li>
<li>
<p>é‡å¯ã€‚</p>
</li>
</ol>
<blockquote>
<p>è‹¥è¦é‡æ–°å¯ç”¨ SIPï¼Œæ‰§è¡Œ <code>csrutil enable</code> é‡å¯å³å¯ã€‚</p>
</blockquote>
<h2>è®°å½•</h2>
<p><s>æœ€æ–°ç‰ˆæœ¬çš„ <a href="https://www.trankynam.com/xtrafinder/">XtraFinder</a> å·²æ”¯æŒ macOS Montereyï¼Œæ¯”è¾ƒé—æ†¾çš„æ˜¯é£æ ¼ä¸æ–°ç‰ˆ Finder ä»ç„¶ä¸æ­ã€‚</s></p>
<p>ç›®å‰ <a href="https://www.trankynam.com/xtrafinder/">XtraFinder v1.8</a> å’Œ <a href="https://totalfinder.binaryage.com/">TotalFinder v1.15.1</a> å·²æ”¯æŒ macOS Venturaã€‚</p>
<p><s>ç›®å‰ <a href="https://www.trankynam.com/xtrafinder/">XtraFinder v1.8</a> ä¸å…¼å®¹ macOS Sonomaï¼Œä¼šå¯¼è‡´æ— æ³•ç›´æ¥é€šè¿‡ç‚¹å‡» Finder å›¾æ ‡æ‰“å¼€åº”ç”¨ã€‚</s></p>
<p>ç›®å‰ <a href="https://www.trankynam.com/xtrafinder/">XtraFinder v1.9</a> å·²æ”¯æŒ macOS Sonomaã€macOS Sequoiaï¼Œä½†ä¼¼ä¹ç‚¹å‡» Finder å›¾æ ‡æ— æ³•æ‰“å¼€çš„é—®é¢˜ä»å­˜åœ¨ã€‚</p>
<h3>References</h3>
<ul>
<li><a href="https://www.trankynam.com/xtrafinder/">XtraFinder</a></li>
<li><a href="https://totalfinder.binaryage.com/">TotalFinder</a></li>
<li><a href="https://totalfinder.binaryage.com/apple-silicon">TotalFinder on Apple Silicon</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac ç³»ç»Ÿéšè—çš„è¶…ç¾æ¡Œé¢å£çº¸]]></title>
            <link>https://github.com/toFrankie/blog/issues/12</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/12</guid>
            <pubDate>Sat, 25 Feb 2023 10:15:39 GMT</pubDate>
            <description><![CDATA[<p>é™¤äº†é»˜è®¤å£çº¸ä¹‹å¤–...</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677320024391.png" alt=""></p>
<blockquote>
<p>å­˜æ”¾äº <code>/Library/]]></description>
            <content:encoded><![CDATA[<p>é™¤äº†é»˜è®¤å£çº¸ä¹‹å¤–...</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677320024391.png" alt=""></p>
<blockquote>
<p>å­˜æ”¾äº <code>/Library/Desktop Pictures</code> ç›®å½•ã€‚</p>
</blockquote>
<p>è¿˜éšè—äº†å¾ˆå¤šæ¡Œé¢å£çº¸ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>National Geographicï¼ˆå›½å®¶åœ°ç†æ‚å¿—ï¼‰</li>
<li>Aerialï¼ˆç©ºä¸­è§†è§’ï¼‰</li>
<li>Cosmosï¼ˆå®‡å®™ï¼‰</li>
<li>Nature Patternsï¼ˆå¤§è‡ªç„¶ï¼‰</li>
</ul>
<blockquote>
<p>é€šè¿‡ âŒ˜ + â‡§ + G å¿«æ·é”®å‰å¾€ <code>/Library/Screen Savers/Default Collections</code> ç›®å½•ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œåœ¨ç³»ç»Ÿåå¥½è®¾ç½®ã€Œæ¡Œé¢ä¸å±å¹•ä¿æŠ¤ç¨‹åºã€æ·»åŠ å¯¹åº”ç›®å½•è·¯å¾„ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2023/2/1677320044300.png" alt=""></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[macOS QuickLook å¸¸ç”¨æ’ä»¶]]></title>
            <link>https://github.com/toFrankie/blog/issues/11</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/11</guid>
            <pubDate>Sat, 25 Feb 2023 10:09:47 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733061712219.jpg" alt=""></p>
<blockquote>
<p>[!WARNING]
éšç€ macOS ç³»ç»Ÿæƒé™è¶Šæ¥è¶Šä¸¥æ ¼ï¼Œå¾ˆå¤šåº“å¹´ä¹…å¤±ä¿®]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733061712219.jpg" alt=""></p>
<blockquote>
<p>[!WARNING]
éšç€ macOS ç³»ç»Ÿæƒé™è¶Šæ¥è¶Šä¸¥æ ¼ï¼Œå¾ˆå¤šåº“å¹´ä¹…å¤±ä¿®ï¼Œéƒ¨åˆ†å·²ä¸å¯ç”¨ã€‚</p>
</blockquote>
<h2>å®‰è£…</h2>
<p>æ‰‹åŠ¨å®‰è£…çš„è¯ï¼Œå°†ä¸‹è½½çš„ <code>.qlgenerator</code> æ–‡ä»¶ç§»åŠ¨è‡³ <code>~/Library/QuickLook</code> ç›®å½•ï¼Œå¯åŠ¨ç»ˆç«¯æ‰§è¡Œ <code>qlmanage -r</code> ä»¥é‡å¯ QuickLookã€‚</p>
<p>æœ‰äº›æ’ä»¶å¯ä»¥é€šè¿‡ <a href="https://github.com/toFrankie/blog/issues/9">Homebrew</a> å®‰è£…ã€‚</p>
<pre><code class="language-bash">$ brew install &lt;package&gt;
</code></pre>
<p>æŸ¥çœ‹å·²å®‰è£…çš„ QuickLook æ’ä»¶ï¼š</p>
<pre><code class="language-shell">$ qlmanage -m
</code></pre>
<blockquote>
<p>[!NOTE]
å¦‚å®‰è£…åæœªç”Ÿæ•ˆï¼Œå¯ä½œå¦‚ä¸‹å°è¯•ï¼š</p>
<ol>
<li>è‹¥é¦–æ¬¡ä½¿ç”¨ï¼Œä¸”ä¸º GUI åº”ç”¨ï¼Œåœ¨å¯åŠ¨å°æ‰“å¼€ä¸€æ¬¡åº”ç”¨ã€‚</li>
<li>ç»ˆç«¯æ‰§è¡Œ <code>qlmanage -r</code> å‘½ä»¤ä»¥é‡æ–°åŠ è½½ QuickLookã€‚</li>
</ol>
</blockquote>
<h2>å¸¸ç”¨æ’ä»¶</h2>
<h3>QLColorCode</h3>
<p>æ”¯æŒé¢„è§ˆè¯­æ³•é«˜äº®ã€‚</p>
<pre><code class="language-shell">$ brew install qlcolorcode --cask
</code></pre>
<h3><s>qlImageSize</s></h3>
<p>æ”¯æŒé¢„è§ˆå›¾ç‰‡ï¼Œæ˜¾ç¤ºå›¾åƒå¤§å°å’Œåˆ†è¾¨ç‡</p>
<pre><code class="language-shell">$ brew install qlimagesize
</code></pre>
<blockquote>
<p>è¯¥é¡¹ç›®å·²åœæ­¢ç»´æŠ¤ï¼Œè¯¦è§ <a href="https://github.com/Nyx0uf/qlImageSize/issues/45#issuecomment-540063003">#45</a>ã€‚</p>
</blockquote>
<blockquote>
<p>macOS Mojave ååˆ†è¾¨ç‡ä¸æ˜¾ç¤ºã€‚</p>
</blockquote>
<blockquote>
<p>macOS Catalina åå½»åº•ä¸å¯ç”¨ã€‚</p>
</blockquote>
<h3>QLMarkdown</h3>
<p>é¢„è§ˆ Markdown æ–‡ä»¶</p>
<pre><code class="language-shell">$ brew install qlmarkdown --cask
</code></pre>
<h3>QuickLookJSON</h3>
<p>é¢„è§ˆæ ¼å¼åŒ–çš„ JSON æ–‡ä»¶</p>
<pre><code class="language-shell">$ brew install quicklook-json --cask
</code></pre>
<h3>QLStephen</h3>
<p>é¢„è§ˆæ— æ‰©å±•åçš„çº¯æ–‡æœ¬æ–‡ä»¶</p>
<pre><code class="language-shell">$ brew install qlstephen --cask
</code></pre>
<h3>BetterZip</h3>
<p>é¢„è§ˆ Zip å‹ç¼©æ–‡ä»¶çš„ä¿¡æ¯å’Œç›®å½•</p>
<pre><code class="language-shell">$ brew install betterzip --cask
</code></pre>
<h3>WebPQuickLook</h3>
<p>é¢„è§ˆ WebP å›¾åƒ</p>
<pre><code>$ brew install webpquicklook --cask
</code></pre>
<h3>Suspicious Package</h3>
<p>é¢„è§ˆ Mac æ ‡å‡†çš„å®‰è£…åŒ…</p>
<pre><code class="language-shell">$ brew install suspicious-package --cask
</code></pre>
<h3>QuickLook Video</h3>
<p>é¢„è§ˆ <code>.mkv</code>ã€<code>.avi</code> ç­‰éåŸç”Ÿæ”¯æŒçš„è§†é¢‘æ ¼å¼</p>
<pre><code class="language-shell">$ brew install qlvideo --cask
</code></pre>
<h3>PeovisionQL</h3>
<p>é¢„è§ˆ iOS çš„ <code>.ipa</code> å®‰è£…åŒ…</p>
<pre><code class="language-shell">$ brew install provisionql --cask
</code></pre>
<h3>QuickLookAPK</h3>
<p>é¢„è§ˆ Android çš„ <code>.apk</code> å®‰è£…åŒ…</p>
<pre><code class="language-shell">$ brew install quicklookapk --cask
</code></pre>
<blockquote>
<p>å·²åœæ­¢ç»´æŠ¤ï¼Œä½†ä»å¯ç”¨ã€‚</p>
</blockquote>
<h3>quicklook-pat</h3>
<p>é¢„è§ˆ PS Pattern ç´ æ</p>
<pre><code class="language-shell">$ brew install quicklook-pat --cask
</code></pre>
<blockquote>
<p>å¹´ä¹…å¤±ä¿®ã€‚</p>
</blockquote>
<h3>QuickLookASE</h3>
<p>é¢„è§ˆç”± PSã€AI ç­‰ç”Ÿæˆçš„ Adobe ASE è‰²æ¿</p>
<pre><code class="language-shell">$ brew install quicklookase --cask
</code></pre>
<blockquote>
<p>å¹´ä¹…å¤±ä¿®ã€‚</p>
</blockquote>
<h2>æ›´å¤š</h2>
<p>æ”¶é›†äº†ä¸€äº›å¸¸ç”¨çš„ QuickLook æ’ä»¶ï¼Œå¯ä»<a href="https://pan.baidu.com/s/1Wyl_OYLCjRvE459d5cqznw">ç™¾åº¦ç½‘ç›˜</a>è·å–ã€‚</p>
<p>ä¸‹è½½åæ”¾ç½®äº <code>~/Library/QuickLook</code> æ–‡ä»¶å¤¹å†…å³å¯ï¼ˆå‰å¾€æ–‡ä»¶å¤¹å¿«æ·é”® âŒ˜ + â‡§ + Gï¼‰ã€‚</p>
<p><s>æ›´å¤šæ’ä»¶å¯ä»¥å‰å¾€ <a href="http://www.quicklookplugins.com/">QuickLookPlugins</a> å¯»æ‰¾ã€‚</s>ï¼ˆå¹´ä¹…å¤±ä¿®ï¼‰</p>
<h2>References</h2>
<ul>
<li><a href="https://github.com/anthonygelibert/QLColorCode">QLColorCode</a></li>
<li><a href="https://github.com/sbarex/QLMarkdown">QLMarkdown</a></li>
<li><a href="http://www.sagtau.com/quicklookjson.html">quick look JSON</a></li>
<li><a href="https://github.com/whomwah/qlstephen">QuicklookStephen</a></li>
<li><a href="https://github.com/emin/WebPQuickLook">WebPQuickLook</a></li>
<li><a href="https://mothersruin.com/software/SuspiciousPackage/get.html">Suspicious Package</a></li>
<li><a href="https://github.com/Marginal/QLVideo">QuickLook Video</a></li>
<li><a href="https://github.com/ealeksandrov/ProvisionQL">ProvisionQL</a></li>
<li><a href="https://github.com/hezi/QuickLookAPK">QuickLookAPK</a></li>
<li><a href="https://github.com/pixelrowdies/quicklook-pat">quicklook-pat</a></li>
<li><a href="https://github.com/rsodre/QuickLookASE">QuickLookASE</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[macOS å¾®ä¿¡å®¢æˆ·ç«¯å¤šå¼€å’Œé˜²æ’¤å›]]></title>
            <link>https://github.com/toFrankie/blog/issues/10</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/10</guid>
            <pubDate>Sat, 25 Feb 2023 10:08:12 GMT</pubDate>
            <description><![CDATA[<p>å¾®ä¿¡ macOS å®¢æˆ·ç«¯å¢å¼º Tweak åŠ¨æ€åº“ï¼Œæ”¯æŒ<strong>å¤šè´¦æˆ·ç™»å½•</strong>ã€<strong>é˜²æ’¤å›</strong>ç­‰ã€‚</p>
<h2>åŠŸèƒ½</h2>
<ul>
<li>é˜»æ­¢æ¶ˆæ¯æ’¤å›
<ul>
<li>æ¶ˆæ¯åˆ—è¡¨é€šçŸ¥</li>
<li>ç³»ç»Ÿé€šçŸ¥</li>
<li>æ­£å¸¸æ’¤å›è‡ªå·±å‘å‡ºçš„æ¶ˆæ¯</]]></description>
            <content:encoded><![CDATA[<p>å¾®ä¿¡ macOS å®¢æˆ·ç«¯å¢å¼º Tweak åŠ¨æ€åº“ï¼Œæ”¯æŒ<strong>å¤šè´¦æˆ·ç™»å½•</strong>ã€<strong>é˜²æ’¤å›</strong>ç­‰ã€‚</p>
<h2>åŠŸèƒ½</h2>
<ul>
<li>é˜»æ­¢æ¶ˆæ¯æ’¤å›
<ul>
<li>æ¶ˆæ¯åˆ—è¡¨é€šçŸ¥</li>
<li>ç³»ç»Ÿé€šçŸ¥</li>
<li>æ­£å¸¸æ’¤å›è‡ªå·±å‘å‡ºçš„æ¶ˆæ¯</li>
</ul>
</li>
<li>å®¢æˆ·ç«¯æ— é™å¤šå¼€
<ul>
<li>å³é”® Dock icon ç™»å½•æ–°çš„å¾®ä¿¡è´¦å·</li>
<li>å‘½ä»¤è¡Œæ‰§è¡Œï¼š<code>open -n /Applications/WeChat.app</code></li>
</ul>
</li>
<li>æ¶ˆæ¯å¤„ç†å¢å¼º
<ul>
<li>æ”¯æŒä»»æ„è¡¨æƒ…å¯¼å‡º</li>
<li>æ”¯æŒäºŒç»´ç è¯†åˆ«</li>
<li>æ”¯æŒå³é”®ç›´æ¥å¤åˆ¶é“¾æ¥</li>
<li>æ”¯æŒç”±ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ç›´æ¥æ‰“å¼€</li>
</ul>
</li>
<li><s>é‡æ–°æ‰“å¼€åº”ç”¨æ— éœ€æ‰‹æœºè®¤è¯</s>ï¼ˆå®˜æ–¹å·²ç»æ”¯æŒï¼‰</li>
<li>UIç•Œé¢è®¾ç½®é¢æ¿</li>
<li>æ”¯æŒ Raycast extension</li>
<li>æ”¯æŒ Alfred workflow</li>
<li>æ”¯æŒ Launchbar action</li>
</ul>
<h2>å®‰è£…</h2>
<p>é¦–æ¬¡ä½¿ç”¨éœ€å®‰è£… WeChatTweak-CLI</p>
<pre><code class="language-shell">$ brew install sunnyyoung/repo/wechattweak-cli
</code></pre>
<pre><code class="language-shell">$ sudo wechattweak-cli install   # å®‰è£…/æ›´æ–°
$ sudo wechattweak-cli uninstall # å¸è½½
</code></pre>
<h2>å¾®ä¿¡å¤šå¼€</h2>
<p>æ–¹å¼æœ‰äºŒï¼Œä¸€æ˜¯ Dock æ å¾®ä¿¡å›¾æ ‡å³é”®ç™»å½•æ–°çš„å¾®ä¿¡è´¦å·ï¼ŒäºŒæ˜¯ç»ˆç«¯æ‰§è¡Œï¼š</p>
<pre><code class="language-shell">$ open -n /Applications/WeChat.app
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://github.com/sunnyyoung/WeChatTweak-macOS">WeChatTweak-macOS</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Homebrew ä½¿ç”¨è¯¦è§£]]></title>
            <link>https://github.com/toFrankie/blog/issues/9</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/9</guid>
            <pubDate>Sat, 25 Feb 2023 10:03:46 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733054107458.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>Homebrew æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><a href="https:]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2024/12/1733054107458.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>Homebrew æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><a href="https://brew.sh/">Homebrew</a> æ˜¯ macOS å’Œ Linux ä¸Šéå¸¸æµè¡Œçš„å¼€æºåŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå‘½ä»¤è¡Œç‰ˆæœ¬çš„åº”ç”¨å•†åº—ã€‚å®ƒæ˜¯ç›¸å¯¹å®‰å…¨çš„ï¼Œå¦‚æœä½ çŸ¥é“è‡ªå·±æ­£åœ¨ä¸‹è½½ä»€ä¹ˆã€‚èµ·ç ç›®å‰ Homebrew ä¸Šä¸å­˜åœ¨æ¶æ„åŒ…ï¼ˆ<a href="https://formulae.brew.sh/">All Formulae</a>ï¼‰ã€‚</p>
<blockquote>
<p>Homebrew complements macOS (or your Linux system).</p>
</blockquote>
<h3>æœ¯è¯­</h3>
<p>è®²çœŸçš„ï¼ŒHomebrew æœ¯è¯­æœ‰ç‚¹ç¾æ¶©éš¾æ‡‚ï¼Œæœ¬èº«æœ‰è‡ªåˆ¶é…¿é…’ä¹‹æ„ï¼Œè¯¸å¦‚ Formulaã€Cask ç­‰ä¹Ÿæ˜¯ä¸é…¿é…’ç›¸å…³çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">æœ¯è¯­</th>
<th style="text-align:left">æ„è¯‘</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Formula</td>
<td style="text-align:left">é…æ–¹</td>
<td style="text-align:left">è¡¨ç¤ºå®‰è£…åŒ…çš„æè¿°æ–‡ä»¶ã€‚å¤æ•°ä¸º formulaeã€‚</td>
</tr>
<tr>
<td style="text-align:left">Cask</td>
<td style="text-align:left">æœ¨æ¡¶</td>
<td style="text-align:left">è£…é…’çš„å™¨å…·ï¼Œè¡¨ç¤ºå…·æœ‰ GUI ç•Œé¢çš„åŸç”Ÿåº”ç”¨ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Keg</td>
<td style="text-align:left">å°æ¡¶</td>
<td style="text-align:left">è¡¨ç¤ºæŸä¸ªåŒ…æŸä¸ªç‰ˆæœ¬çš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚ <code>/usr/local/Cellar/foo/0.1</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Cellar</td>
<td style="text-align:left">åœ°çª–</td>
<td style="text-align:left">å­˜æ”¾é…’çš„åœ°æ–¹ï¼Œè¡¨ç¤ºåŒ…çš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚ <code>/usr/local/Cellar</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Caskroom</td>
<td style="text-align:left">æœ¨æ¡¶é—´</td>
<td style="text-align:left">è¡¨ç¤ºç±»å‹ä¸º Cask çš„åŒ…çš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚ï¼š<code>/usr/local/Caskroom</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left">Tap</td>
<td style="text-align:left">æ°´é¾™å¤´</td>
<td style="text-align:left">è¡¨ç¤ºåŒ…çš„æ¥æºï¼Œä¹Ÿå°±æ˜¯é•œåƒæºã€‚</td>
</tr>
<tr>
<td style="text-align:left">Bottle</td>
<td style="text-align:left">ç“¶å­</td>
<td style="text-align:left">è¡¨ç¤ºé¢„å…ˆç¼–è¯‘å¥½çš„åŒ…ï¼Œä¸‹è½½å¥½ç›´æ¥ä½¿ç”¨ã€‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Related Link: <a href="https://docs.brew.sh/Manpage#terminology">Homebrew Terminology</a>, <a href="https://github.com/Homebrew/brew/issues/10798">Simplifying Homebrew terminology</a>.</p>
</blockquote>
<h3>ç»„æˆ</h3>
<p>Homebrew ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">åç§°</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">brew</td>
<td style="text-align:left">Homebrew æºä»£ç ä»“åº“</td>
</tr>
<tr>
<td style="text-align:left">homebrew-core</td>
<td style="text-align:left">Homebrew Core ä»“åº“</td>
</tr>
<tr>
<td style="text-align:left">homebrew-cask</td>
<td style="text-align:left">Homebrew Cask ä»“åº“ï¼Œæä¾› macOS åº”ç”¨å’Œå¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶çš„å®‰è£…</td>
</tr>
<tr>
<td style="text-align:left">homebrew-bottles</td>
<td style="text-align:left">Homebrew é¢„ç¼–è¯‘äºŒè¿›åˆ¶è½¯ä»¶åŒ…ä¸è½¯ä»¶åŒ…å…ƒæ•°æ®æ–‡ä»¶</td>
</tr>
<tr>
<td style="text-align:left">homebrew-cask-versions</td>
<td style="text-align:left">Homebrew Cask å…¶ä»–ç‰ˆæœ¬ (alternative versions) è½¯ä»¶ä»“åº“ï¼Œæä¾›ä½¿ç”¨äººæ•°å¤šçš„ã€éœ€è¦çš„ç‰ˆæœ¬ä¸åœ¨ Cask ä»“åº“ä¸­çš„åº”ç”¨ã€‚</td>
</tr>
<tr>
<td style="text-align:left">homebrew-services</td>
<td style="text-align:left">ä¸ brew services æœ‰å…³çš„æ–‡ä»¶ï¼Œç”¨äºåœ¨ macOS (launchctl) ä¸ Linux (systemctl) ä¸Šç®¡ç† brew å®‰è£…çš„æœåŠ¡ã€‚</td>
</tr>
</tbody>
</table>
<h2>Homebrew å®‰è£…</h2>
<blockquote>
<p>æœ¬æ–‡ä»¥ macOS ä¸ºä¾‹ã€‚</p>
</blockquote>
<p>å¤åˆ¶ä»¥ä¸‹å‘½ä»¤ï¼Œç²˜è´´åˆ°ã€Œç»ˆç«¯ã€åº”ç”¨å›è½¦æ‰§è¡Œï¼Œç­‰å¾…å®Œæˆå³å¯ã€‚</p>
<pre><code class="language-shell">$ /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;
</code></pre>
<p>å¦‚æœæ²¡æœ‰ ğŸªœ ä¸‹è½½å¾ˆæ…¢çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…çš„å®‰è£…è„šæœ¬ã€‚</p>
<pre><code class="language-shell">$ /bin/bash -c &quot;$(curl -fsSL https://mirrors.ustc.edu.cn/misc/brew-install.sh)&quot;
</code></pre>
<p>å¦‚æœæ­¤å‰æ²¡æœ‰å®‰è£…è¿‡ Xcode Command Line Toolsï¼Œä¸Šè¿°è¿‡ç¨‹ä¼šæç¤ºå®‰è£…ï¼ŒæŒ‰å›è½¦è€å¿ƒç­‰å¾…å®‰è£…å®Œæˆã€‚</p>
<blockquote>
<p>Related link: <a href="https://docs.brew.sh/Installation#macos-requirements">macOS Requirements</a>.</p>
</blockquote>
<pre><code class="language-shell">==&gt; The Xcode Command Line Tools will be installed.

Press RETURN/ENTER to continue or any other key to abort:
</code></pre>
<p>ä¹Ÿå¯å…ˆè‡ªè¡Œå®‰è£… Xcode Command Line Toolsï¼Œå†å®‰è£… Homebrewã€‚</p>
<pre><code class="language-shell">$ xcode-select --install
</code></pre>
<p>å®Œæˆåå¯ä½¿ç”¨ <code>brew -v</code> å‘½ä»¤ï¼Œè‹¥æœ‰è¾“å‡ºç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºå·²å®‰è£…æˆåŠŸï¼Œå¯å¿½ç•¥ä»¥ä¸‹ç¯å¢ƒå˜é‡é…ç½®æ­¥éª¤ã€‚</p>
<pre><code class="language-shell">$ brew -v
Homebrew 4.1.22
Homebrew/homebrew-core (git revision a58688396f3; last commit 2023-12-02)
</code></pre>
<p>å¦‚æœå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼Œåˆ™éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<pre><code class="language-shell">$ brew -v
brewï¼šcommand not found
</code></pre>
<p>æ‰§è¡Œ <code>which $SHELL</code> ç¡®è®¤ä½ çš„ macOS çš„é»˜è®¤ Shell æ˜¯å“ªä¸ªï¼Ÿ</p>
<pre><code class="language-shell">$ which $SHELL
/bin/zsh
</code></pre>
<p>é€šå¸¸æ˜¯ <code>zsh</code> æˆ– <code>bash</code>ï¼Œå¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸º <code>~/.zshrc</code> æˆ– <code>~/.bash_profile</code>ã€‚</p>
<blockquote>
<p>ä» macOS Catalina å¼€å§‹ï¼ŒMac å°†ä½¿ç”¨ <code>zsh</code> ä½œä¸ºé»˜è®¤ç™»å½• Shell å’Œäº¤äº’å¼ Shellï¼Œ<a href="https://support.apple.com/zh-cn/HT208050">è¯¦è§</a>ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸‹æ–‡ä»¥ <code>zsh</code> ä¸ºä¾‹ï¼Œå¦‚æœä½ ä½¿ç”¨å…¶ä»– Shellï¼Œæ¶‰åŠåˆ° <code>.zshrc</code> è¯·è‡ªè¡Œè°ƒæ•´ä¸ºä½ çš„é…ç½®æ–‡ä»¶åç§°ã€‚</p>
</blockquote>
<pre><code class="language-shell"># æ·»åŠ ç¯å¢ƒå˜é‡è‡³ .zshrc
$ echo 'export PATH=&quot;/usr/local/bin:/usr/local/sbin:/opt/homebrew/bin:/opt/homebrew/sbin:$PATH&quot;' &gt;&gt; ~/.zshrc

# åˆ·æ–°ç¯å¢ƒå˜é‡
$ source ~/.zshrc
</code></pre>
<p>å®Œäº†ä¹‹åï¼Œå†æ‰§è¡Œ <code>brew -v</code> åº”è¯¥å°±èƒ½æ­£å¸¸è¾“å‡ºç‰ˆæœ¬å·äº†ã€‚</p>
<h2>Homebrew å‡çº§æŒ‡å—</h2>
<blockquote>
<p>å¦‚æœé¦–æ¬¡å®‰è£…ï¼Œå¯å¿½ç•¥æœ¬èŠ‚å†…å®¹ã€‚</p>
</blockquote>
<p>è‡ª 4.0 èµ·ï¼Œæœ‰ä¸€äº›å˜åŒ–ï¼š</p>
<ul>
<li>
<p>é»˜è®¤ä½¿ç”¨ä» <a href="https://formulae.brew.sh/">Formulae.brew.sh</a> ä¸‹è½½çš„ JSON æ–‡ä»¶è¿›è¡ŒåŒ…çš„å®‰è£…ï¼Œè€Œä¸æ˜¯æœ¬åœ° <code>homebrew/core</code> å’Œ <code>homebrew/cask</code> æºã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>brew untap homebrew/core</code> å’Œ <code>brew untap homebrew/cask</code> æ¥èŠ‚çœä¸€äº›ç©ºé—´ï¼ˆé™¤éä½ æ­£åœ¨å¼€å‘åŒ…ï¼‰ã€‚</p>
</li>
<li>
<p>å¯ä»¥è€ƒè™‘å°† <code>HOMEBREW_NO_INSTALL_FROM_API</code> ç§»é™¤ï¼ˆå¦‚æœè®¾ç½®è¿‡ï¼‰ã€‚</p>
</li>
<li>
<p>å¯ä»¥è€ƒè™‘å°† <code>HOMEBREW_API_DOMAIN</code> è®¾ä¸ºæŒ‡å®šé•œåƒæºï¼ˆå¦‚æœä½¿ç”¨æ–°çš„å®‰è£…æ–¹å¼ï¼‰ã€‚</p>
</li>
<li>
<p>è‡ªåŠ¨è¿è¡Œ <code>brew update</code> çš„é¢‘ç‡ç”± <code>5min</code> æ”¹ä¸º <code>24h</code>ã€‚å¯ä»¥é‡æ–°è€ƒè™‘æ˜¯å¦éœ€è¦è®¾ç½® <code>HOMEBREW_NO_AUTO_UPDATE</code>ã€<code>HOMEBREW_AUTO_UPDATE_SECS</code> äº†ï¼ˆå¦‚æœè®¾ç½®è¿‡ï¼‰ã€‚</p>
</li>
</ul>
<p>å¦‚æœæƒ³å®‰è£…äº† 4.0 åŠæ›´æ–°ç‰ˆæœ¬ï¼Œåˆæƒ³æ²¿ç”¨ä»¥å‰çš„å®‰è£…æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="language-shell">$ echo 'export HOMEBREW_NO_INSTALL_FROM_API=1' &gt;&gt; ~/.zshrc
</code></pre>
<p>å¦‚æœä½ ä½¿ç”¨ 3.3.0 ~ 3.6.0 ä¹‹é—´çš„ç‰ˆæœ¬ï¼Œæƒ³è¦ä½¿ç”¨å…¨æ–°çš„ JSON API æ¥å®‰è£…åŒ…ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="language-shell">$ echo 'export HOMEBREW_INSTALL_FROM_API=1' &gt;&gt; ~/.zshrc
</code></pre>
<blockquote>
<p>è‡ª 4.0 èµ·ä¸ºé»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®ã€‚</p>
</blockquote>
<p>Related Link:</p>
<ul>
<li><a href="https://brew.sh/2023/02/16/homebrew-4.0.0/">Homebrew 4.0.0</a></li>
<li><a href="https://brew.sh/2022/09/07/homebrew-3.6.0/">Homebrew 3.6.0</a></li>
<li><a href="https://brew.sh/2021/10/25/homebrew-3.3.0/">Homebrew 3.3.0</a></li>
</ul>
<h2>Homebrew æºåˆ‡æ¢</h2>
<p>å®‰è£…åï¼Œå¦‚æœä½¿ç”¨ <code>brew install</code>ã€<code>brew upgrade</code>ã€<code>brew update</code> è¾ƒæ…¢ï¼Œå¯ä»¥è€ƒè™‘åˆ‡æ¢ä¸ºå›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">æ¸…åå¤§å­¦é•œåƒæº</a></li>
<li><a href="http://mirrors.ustc.edu.cn/help/brew.git.html">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæº</a></li>
</ul>
<blockquote>
<p>ä»¥ USTC é•œåƒæºä¸ºä¾‹ã€‚</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨ 4.x æœ€æ–°çš„ JSON API å®‰è£…æ–¹å¼ï¼ˆæ¨èï¼‰ï¼Œæ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡é…ç½®ï¼š</p>
<pre><code class="language-shell">$ echo '
export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.ustc.edu.cn/brew.git&quot;
export HOMEBREW_API_DOMAIN=&quot;https://mirrors.ustc.edu.cn/homebrew-bottles/api&quot;
export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.ustc.edu.cn/homebrew-bottles/bottles&quot;
' &gt;&gt; ~/.zshrc
</code></pre>
<p>å¦‚æœä½¿ç”¨ 4.0 ä¹‹å‰ç‰ˆæœ¬ï¼Œæˆ–è€…ä½¿ç”¨ 4.x ä½†åˆæƒ³ç”¨æ­¤å‰çš„å®‰è£…æ–¹å¼ï¼Œæ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡é…ç½®ï¼š</p>
<pre><code class="language-shell">$ echo '
export HOMEBREW_NO_INSTALL_FROM_API=1
export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.ustc.edu.cn/brew.git&quot;
export HOMEBREW_API_DOMAIN=&quot;https://mirrors.ustc.edu.cn/homebrew-bottles/api&quot;
export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.ustc.edu.cn/homebrew-bottles/bottles&quot;
export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.ustc.edu.cn/homebrew-core.git&quot;
export HOMEBREW_CASK_GIT_REMOTE=&quot;https://mirrors.ustc.edu.cn/homebrew-cask.git&quot;
'&gt;&gt; ~/.zshrc
</code></pre>
<blockquote>
<p>è‹¥è¦é‡ç½®ä¸ºå®˜æ–¹é•œåƒæºï¼Œç§»é™¤ä»¥ä¸Šç¯å¢ƒå˜é‡å³å¯ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œå¦‚ä¸å¸Œæœ› Homebrew æ”¶é›†åŒ¿åæ•°æ®ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡å…³é—­ï¼š</p>
<pre><code class="language-shell">$ echo 'export HOMEBREW_NO_ANALYTICS=1' &gt;&gt; ~/.zshrc
</code></pre>
<blockquote>
<p>Related Link: <a href="https://docs.brew.sh/Analytics">Anonymous Analytics</a>.</p>
</blockquote>
<!--

### é‡ç½®é•œåƒæº

å…ˆç§»é™¤ä¸Šè¿°ç¯å¢ƒå˜é‡ï¼Œå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
$ git -C "$(brew --repo)" remote set-url origin https://github.com/Homebrew/brew

$ brew tap --custom-remote homebrew/core https://github.com/Homebrew/homebrew-core

$ brew tap --custom-remote --force-auto-update homebrew/cask https://github.com/Homebrew/homebrew-cask

$ brew tap --custom-remote --force-auto-update homebrew/cask-versions https://github.com/Homebrew/homebrew-cask-versions

$ brew tap --custom-remote --force-auto-update homebrew/services https://github.com/Homebrew/homebrew-services
```

### é‡ç½®é•œåƒæºï¼ˆæ—§ç‰ˆï¼‰

> ä»¥å‰ä½¿ç”¨è¿‡éç¯å¢ƒå˜é‡çš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚

```shell
$ cd "$(brew --repo)"
$ git remote set-url origin https://github.com/Homebrew/brew

$ cd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"
$ git remote set-url origin https://github.com/Homebrew/homebrew-core

$ cd "$(brew --repo)/Library/Taps/homebrew/homebrew-cask"
$ git remote set-url origin https://github.com/Homebrew/homebrew-cask
```

-->
<h2>Homebrew è‡ªåŠ¨æ›´æ–°</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œ <code>brew install</code>ã€<code>brew upgrade</code>ã€<code>brew tap</code> ä¹‹å‰ï¼Œæ¯éš”ç¬¬ä¸€æ®µæ—¶é—´ä¼šè‡ªåŠ¨æ‰§è¡Œ <code>brew update</code> ä»¥è·å–æœ€æ–°çš„ Homebrew ç‰ˆæœ¬ã€‚</p>
<p>åœ¨ 4.0 èµ·è‡ªåŠ¨æ‰§è¡Œé¢‘ç‡ä¸º <code>24h</code>ï¼Œå¦‚æœå¼€å¯äº† <code>HOMEBREW_NO_INSTALL_FROM_API=1</code> é¢‘ç‡ä¸º <code>5min</code>ã€‚å¯é€šè¿‡ä»¥ä¸‹ç¯å¢ƒå˜é‡å®Œå…¨ç¦ç”¨ã€è®¾ç½®æ—¶é—´é—´éš”ã€‚</p>
<pre><code class="language-shell">$ echo '
export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_AUTO_UPDATE_SECS=86400
' &gt;&gt; ~/.zshrc
</code></pre>
<blockquote>
<p>è¿™å°±æ˜¯æ¯æ¬¡å®‰è£…/æ›´æ–°åŒ…æ—¶ï¼Œå…ˆå‡ºç° <code>Downloading https://formulae.brew.sh/api/formula.jws.json</code> çš„åŸå› ã€‚è¿™ä¸ª JSON æ–‡ä»¶æœ‰ 4M å¤šï¼Œå¦‚æœåŠ ä¸Šé»˜è®¤çš„é•œåƒæºï¼Œä¸æ…¢æ‰æ€ªã€‚</p>
</blockquote>
<h2>Homebrew ç›¸å…³è·¯å¾„</h2>
<p>ç›¸å…³å‘½ä»¤</p>
<pre><code class="language-shell"># æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“
$ brew --repo

# æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„
$ brew --prefix

# æ˜¾ç¤º Homebrew Cellar è·¯å¾„
$ brew --cellar

# æ˜¾ç¤º Homebrew Caskroom è·¯å¾„
$ brew --caskroom

# ç¼“å­˜è·¯å¾„
$ brew --cache
</code></pre>
<p>Homebrew é»˜è®¤å®‰è£…è·¯å¾„å¦‚ä¸‹ï¼š</p>
<ul>
<li>macOS ARM: <code>/opt/homebrew</code></li>
<li>macOS Intel: <code>/usr/local</code></li>
</ul>
<blockquote>
<p>Related Link: <a href="https://github.com/Homebrew/brew/issues/9177">Discussion: longterm Homebrew prefix on Apple Silicon Macs</a></p>
</blockquote>
<p>ä»¥ <code>brew install git</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>
<p>Homebrew å°† git ä¸‹è½½è‡³ <code>/usr/local/Cellar/git/&lt;version&gt;/</code> ç›®å½•ä¸‹ï¼Œå…¶äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ <code>/usr/local/Cellar/git/&lt;version&gt;/bin/git</code>ã€‚</p>
</li>
<li>
<p>Homebrew ä¸º <code>/usr/local/Cellar/git/&lt;version&gt;/bin/git</code> åˆ›å»ºäº†ä¸€ä¸ªè½¯é“¾æ–‡ä»¶è‡³ <code>/usr/local/bin</code> é‡Œã€‚</p>
</li>
</ol>
<p>macOS ARM çš„è·¯å¾„å¯¹åº”æ˜¯ï¼š</p>
<ul>
<li><code>/opt/homebrew/Cellar/git/&lt;version&gt;/</code></li>
<li><code>/opt/homebrew/Cellar/git/&lt;version&gt;/bin/git</code></li>
<li><code>/opt/homebrew/bin</code></li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ macOS ARM è¦å°† <code>/opt/homebrew/bin</code> æ·»åŠ åˆ° <code>PATH</code> ç¯å¢ƒå˜é‡çš„åŸå› ã€‚</p>
<p>å½“æ‰§è¡Œ <code>brew uninstall</code> æ—¶ï¼Œä¼šå°† <code>/usr/local/Cellar</code> ä¸‹å¯¹åº”åŒ…ç›®å½•åˆ é™¤ï¼Œå¯¹åº”çš„é“¾æ¥å…³ç³»ä¹Ÿä¼šç§»é™¤ã€‚
å½“æ‰§è¡Œ <code>brew cleanup</code> æ—¶ï¼Œä¼šå°† <code>/usr/local/Cellar</code> æ‰€æœ‰åŒ…é‡Œçš„æ—§ç‰ˆæœ¬ï¼Œåªä¿ç•™æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<h2>Homebrew Cask çš„åŒºåˆ«</h2>
<p>å¯ä»¥ç®€å•åœ°å°† Homebrew çš„åŒ…åˆ†ä¸ºå‘½ä»¤è¡Œå·¥å…·ã€GUI åº”ç”¨ä¸¤ç±»ã€‚</p>
<pre><code class="language-shell">$ brew install &lt;package-name&gt;    # å®‰è£…
$ brew uninstall &lt;package-name&gt;  # å¸è½½
$ brew reinstall &lt;package-name&gt;  # é‡è£…
</code></pre>
<blockquote>
<p>å¦‚å®‰è£…çš„æ˜¯ GUI åº”ç”¨ï¼ŒåŠ ä¸Š <code>--cask</code> å‚æ•°ã€‚æ¯”å¦‚ <code>brew install docker --cask</code>ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚éœ€å¼ºåˆ¶å¸è½½ï¼ŒåŠ ä¸Š <code>--force</code> å‚æ•°ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ <code>brew search</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°ã€ŒFormulaeã€å’Œã€ŒCasksã€ä¸¤ç±»ï¼š</p>
<ul>
<li><strong>Formulae</strong>ï¼šä¸€èˆ¬æ˜¯é‚£äº›å‘½ä»¤è¡Œå·¥å…·ã€å¼€å‘åº“ã€å­—ä½“ã€æ’ä»¶ç­‰ä¸å« GUI ç•Œé¢çš„è½¯ä»¶ã€‚</li>
<li><strong>Casks</strong>ï¼šæ˜¯æŒ‡é‚£äº›å«æœ‰ GUI å›¾å½¢åŒ–ç•Œé¢çš„è½¯ä»¶ï¼Œæ¯”å¦‚ Chromeã€FireFox ç­‰ã€‚</li>
</ul>
<pre><code class="language-shell">$ brew search google

==&gt; Formulae
aws-google-auth                          google-sparsehash
google-authenticator-libpam              google-sql-tool
google-benchmark                         googler
google-go                                googletest
google-java-format

==&gt; Casks
google-ads-editor
google-analytics-opt-out
google-backup-and-sync
...
</code></pre>
<blockquote>
<p>Related Link: <a href="https://github.com/Homebrew/homebrew-cask">Homebrew Cask</a></p>
</blockquote>
<h2>Homebrew å¸¸ç”¨å‘½ä»¤</h2>
<h3>æ£€æŸ¥</h3>
<p>ç”¨äºæ£€æŸ¥ Homebrew å½“å‰é…ç½®æ˜¯å¦åˆç†ï¼Œæˆ–è€…æŸäº›åŒ…å­˜åœ¨çš„é—®é¢˜ç­‰ã€‚</p>
<pre><code class="language-shell">$ brew doctor
</code></pre>
<h3>æœç´¢</h3>
<p>æ”¯æŒæ¨¡ç³Šæœç´¢ã€‚</p>
<pre><code class="language-shell">$ brew search &lt;keyword&gt;
</code></pre>
<h3>æ›´æ–°åŒ…</h3>
<pre><code class="language-shell">$ brew upgrade                  # æ›´æ–°æ‰€æœ‰å·²å®‰è£…çš„åŒ…
$ brew upgrade &lt;package-name&gt;   # æ›´æ–°æŒ‡å®šåŒ…
</code></pre>
<h3>åˆ—å‡ºå·²å®‰è£…çš„åŒ…</h3>
<pre><code class="language-shell">$ brew list                     # æ‰€æœ‰çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬ Formulae  å’Œ Cask
$ brew list --formulae          # æ‰€æœ‰å·²å®‰è£…çš„ Formulae
$ brew list --cask              # æ‰€æœ‰å·²å®‰è£…çš„ Casks
$ brew list &lt;package-name&gt;      # åˆ—ä¸¾æŸä¸ª Formulate æˆ– Cask çš„è¯¦ç»†è·¯å¾„
</code></pre>
<h3>åˆ—å‡ºå¯æ›´æ–°çš„åŒ…</h3>
<pre><code class="language-shell">$ brew outdated
</code></pre>
<h3>é”å®šæŸä¸ªä¸æƒ³æ›´æ–°çš„åŒ…</h3>
<pre><code class="language-shell">$ brew pin &lt;package-name&gt;       # é”å®šæŒ‡å®šåŒ…
$ brew unpin &lt;package-name&gt;     # å–æ¶ˆé”å®šæŒ‡å®šåŒ…
</code></pre>
<h3>æ¸…ç†æ—§åŒ…</h3>
<pre><code class="language-shell">$ brew cleanup                  # æ¸…ç†æ‰€æœ‰æ—§ç‰ˆæœ¬çš„åŒ…
$ brew cleanup &lt;package-name&gt;   # æ¸…ç†æŒ‡å®šçš„æ—§ç‰ˆæœ¬åŒ…
$ brew cleanup -n               # æŸ¥çœ‹å¯æ¸…ç†çš„æ—§ç‰ˆæœ¬åŒ…
</code></pre>
<h3>æŸ¥çœ‹å·²å®‰è£…åŒ…çš„ä¾èµ–</h3>
<pre><code class="language-shell">$ brew deps --installed --tree
</code></pre>
<h3>æŸ¥çœ‹åŒ…çš„ä¿¡æ¯</h3>
<pre><code class="language-shell">$ brew info &lt;package&gt;           # æ˜¾ç¤ºæŸä¸ªåŒ…ä¿¡æ¯
$ brew info                     # æ˜¾ç¤ºå®‰è£…çš„è½¯ä»¶æ•°é‡ã€æ–‡ä»¶æ•°é‡ä»¥åŠå ç”¨ç©ºé—´
</code></pre>
<h2>References</h2>
<ul>
<li><a href="https://brew.sh">Homebrew</a></li>
<li><a href="https://formulae.brew.sh/">Homebrew Formulae</a></li>
<li><a href="http://mirrors.ustc.edu.cn/help/brew.git.html">USTC Homebrew</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac Terminal æ‰“å¼€ URL]]></title>
            <link>https://github.com/toFrankie/blog/issues/8</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/8</guid>
            <pubDate>Sat, 25 Feb 2023 09:57:31 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1b9306ec16079e5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik">]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-1b9306ec16079e5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Freepik"></p>
<p>æœ‰æ—¶å€™éœ€è¦åœ¨ç»ˆç«¯åº”ç”¨ä¸­ç›´æ¥æ‰“å¼€ URLï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®ã€‚</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>å¿«æ·é”®</th>
</tr>
</thead>
<tbody>
<tr>
<td>é€‰æ‹© URL</td>
<td>æŒ‰ä½ Shift-Command é”®å¹¶è¿æŒ‰ URL</td>
</tr>
<tr>
<td>æ‰“å¼€ URL</td>
<td>æŒ‰ä½ Command é”®å¹¶è¿æŒ‰ URL</td>
</tr>
<tr>
<td>é€‰æ‹©å®Œæ•´æ–‡ä»¶è·¯å¾„</td>
<td>æŒ‰ä½ Shift-Command é”®å¹¶è¿æŒ‰è·¯å¾„</td>
</tr>
<tr>
<td>é€‰æ‹©æ•´è¡Œæ–‡æœ¬</td>
<td>ç‚¹æŒ‰è¯¥è¡Œä¸‰ä¸‹</td>
</tr>
</tbody>
</table>
<p>æ›´å¤šè¯·çœ‹ <a href="https://support.apple.com/zh-cn/guide/terminal/trmlshtcts/mac">Mac ä¸Šâ€œç»ˆç«¯â€ä¸­çš„é”®ç›˜å¿«æ·é”®</a>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™ instanceof]]></title>
            <link>https://github.com/toFrankie/blog/issues/5</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/5</guid>
            <pubDate>Sun, 29 May 2022 09:30:21 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750901956299.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¼€å§‹ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€äº›åŸºæœ¬èƒŒæ™¯...</p>
<h2>ä¸€ã€å‰è¨€</h2>
<p]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750901956299.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>å¼€å§‹ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€äº›åŸºæœ¬èƒŒæ™¯...</p>
<h2>ä¸€ã€å‰è¨€</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ ECMAScript æ ‡å‡†ä¸­ï¼Œå½“å‰æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼ˆå…± 8 ç§ï¼‰ï¼š</p>
<blockquote>
<ul>
<li><strong>åŸå§‹ç±»å‹</strong>ï¼ˆPrimitivesï¼‰ï¼š åŒ…å« Undefinedã€Nullã€Booleanã€Stringã€Numberã€Symbolã€BigInt å…± 7 ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚</li>
<li><strong>å¼•ç”¨ç±»å‹</strong>ï¼ˆObjectsï¼‰ï¼šé™¤åŸå§‹ç±»å‹ä¹‹å¤–ï¼Œå…¶ä½™å‡å±äºå¼•ç”¨ç±»å‹ï¼Œå½’ä¸ºä¸€å¤§ç±»ï¼Œæ¯”å¦‚ <code>Object</code>ã€<code>Array</code>ã€<code>Map</code> ç­‰å†…ç½®æ–¹æ³•åŠå…¶å®ä¾‹å¯¹è±¡ã€‚</li>
</ul>
</blockquote>
<p><strong>å…¶ä¸­ï¼ŒåŸå§‹å€¼éƒ½æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œä¸”ä¸å«ä»»ä½•å±æ€§æˆ–æ–¹æ³•</strong>ã€‚å¹³æ—¶çœ‹åˆ°ç±»ä¼¼çš„ <code>'string'.length</code> å†™æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯å‘ç”Ÿäº†éšå¼ç±»å‹è½¬æ¢ï¼Œå…ˆå°† <code>'string'</code> è½¬æ¢ä¸º <code>Object('string')</code>ï¼Œç„¶åè°ƒç”¨ <code>String</code> å®ä¾‹å¯¹è±¡çš„ <code>length</code> å±æ€§ç½¢äº†ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ã€Œå¼•ç”¨ç±»å‹ã€åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<blockquote>
<p><strong>å‡½æ•°å¯¹è±¡</strong>ï¼ˆfunction objectï¼‰ï¼šä¸€ä¸ªå…·æœ‰ <code>[[Call]]</code> å†…éƒ¨æ–¹æ³•ï¼ˆ<a href="https://262.ecma-international.org/#table-additional-essential-internal-methods-of-function-objects">è¯¦è§</a>ï¼‰çš„å¯¹è±¡ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡ <code>()</code> è°ƒç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚å†…ç½®çš„ <code>Object</code>ã€<code>Function</code>ã€<code>Array</code> ç­‰æ–¹æ³•ã€‚
<strong>æ™®é€šå¯¹è±¡</strong>ï¼ˆordinary objectï¼‰ï¼šé™¤å‡½æ•°å¯¹è±¡ï¼Œå…¶ä½™å¼•ç”¨å€¼å‡å¯ç§°ä¸ºæ™®é€šå¯¹è±¡ã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œæåˆ°çš„å¯¹è±¡æ³›æŒ‡å¼•ç”¨ç±»å‹ï¼Œè€Œä¸æ˜¯å•æŒ‡å¹³å¸¸æ‰€å†™çš„ <code>{...}</code> å¯¹è±¡ã€‚è¯·è®°ä½ï¼š</p>
<blockquote>
<p><strong>æ‰€æœ‰ <code>Function</code> çš„å®ä¾‹éƒ½æ˜¯å‡½æ•°å¯¹è±¡ï¼Œè€Œå…¶ä»–çš„éƒ½æ˜¯æ™®é€šå¯¹è±¡</strong>ã€‚</p>
</blockquote>
<p>å‰é¢åˆ’åˆ†å¯¹è±¡ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿åˆ†æ¸…æ¥š <code>prototype</code>ï¼ˆåŸå‹å¯¹è±¡ï¼‰å’Œ <code>__proto__</code> ï¼ˆåŸå‹ï¼‰çš„åŒºåˆ«ï¼š</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡ç±»å‹</th>
<th>prototype</th>
<th>__proto__</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ™®é€šå¯¹è±¡</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>å‡½æ•°å¯¹è±¡</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<p>æ¢å¥è¯è¯´ï¼š</p>
<blockquote>
<p>æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§ï¼Œè€Œåªæœ‰å‡½æ•°å¯¹è±¡æ‰å…·æœ‰ <code>prototype</code> å±æ€§ã€‚</p>
</blockquote>
<p>ä¸ä½œè¿‡å¤šä»‹ç»ï¼Œå¦‚æœå¯¹è¿™ä¿©å…„å¼Ÿä¸å¤ªäº†è§£çš„ï¼Œå¯çœ‹æ–‡ç« <a href="https://www.jianshu.com/p/ddc45fab9e55">æ•°æ®ç±»å‹è¯¦è§£</a>ã€‚</p>
<h2>äºŒã€instanceof</h2>
<p>ä» <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof">MDN</a> å¯çŸ¥ï¼Œå…¶è¯­æ³•éå¸¸ç®€å•ï¼š</p>
<pre><code class="language-js">object instanceof constructor
</code></pre>
<p>ç”¨äºæ£€æµ‹ <code>constructor.prototype</code> æ˜¯å¦å­˜åœ¨äºå‚æ•° <code>object</code> çš„åŸå‹é“¾ä¸Šã€‚</p>
<p>è¦è‡ªå®ç° <code>instanceof</code>ï¼Œå°±è¦äº†è§£è¿™äº›ç‰¹æ€§ï¼š</p>
<blockquote>
<ul>
<li><code>object</code> å¿…é¡»æ˜¯å¼•ç”¨å€¼ï¼Œå¦åˆ™å°†ä¼šè¿”å› <code>false</code>ã€‚</li>
<li><code>constructor</code> å¿…é¡»æ˜¯å‡½æ•°å¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ›å‡º TypeErrorã€‚</li>
</ul>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸åŒä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚ç½‘é¡µä¸­å¤šä¸ª <code>&lt;iframe&gt;</code>ï¼‰ä¹‹é—´æ‹¥æœ‰ä¸åŒçš„å…¨å±€å¯¹è±¡ï¼Œå¯ç†è§£ä¸ºä¸åŒçš„å¼•ç”¨åœ°å€ï¼Œå› æ­¤ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p>
<pre><code class="language-js">const iframe = document.createElement('iframe')
document.body.appendChild(iframe)

const xArray = window.frames[window.frames.length - 1].Array
const xarr = new xArray()
const arr = new Array()

console.log(xarr instanceof Array) // false
console.log(xarr.constructor === Array) // false

console.log(arr instanceof Array) // true
console.log(arr.constructor === Array) // true
</code></pre>
<p>å› æ­¤ï¼Œä½¿ç”¨ <code>instanceof</code> æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„æ˜¯ä¸å‡†ç¡®çš„ï¼Œå¯çœ‹<a href="https://www.jianshu.com/p/1dc2af3b56c3">æ–‡ç« </a>ã€‚</p>
<h2>ä¸‰ã€å®ç°</h2>
<p>è·å–åŸå‹å¯¹è±¡çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-js">// æ„é€ å‡½æ•°è®¿é—® prototype å±æ€§
constructor.prototype

// å®ä¾‹å¯¹è±¡è®¿é—® __proto__ å±æ€§
instance.__proto__
// __proto__ é ECMAScript æ ‡å‡†ï¼Œåªæ˜¯è¢«æ‰€æœ‰æµè§ˆå™¨æ”¯æŒç½¢äº†
// å¯ä½¿ç”¨æ ‡å‡†ä¸­çš„ Object.getPrototypeOf() æ–¹æ³•æ›¿æ¢
</code></pre>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function myInstanceof(inst, ctor) {
  // æ˜¯å¦ä¸ºå‡½æ•°å¯¹è±¡
  const isCallable = val =&gt; typeof val === 'function'

  // æ˜¯å¦ä¸ºå¼•ç”¨å€¼
  const isObject = val =&gt; typeof val === 'function' || (val !== null &amp;&amp; typeof val === 'object')

  // ctor å¿…é¡»æ˜¯å¼•ç”¨å€¼
  if (!isObject(ctor)) throw new TypeError(`Right-hand side of 'instanceof' is not an object`)

  // ctor å¿…é¡»æ˜¯å‡½æ•°å¯¹è±¡
  if (!isCallable(ctor)) throw new TypeError(`Right-hand side of 'instanceof' is not callable`)

  // inst ä¸ºåŸå§‹å€¼ï¼Œåˆ™è¿”å› false
  if (!isObject(inst)) return false

  do {
    const proto = inst.__proto__ // å¯æ¢æˆæ ‡å‡†æ–¹æ³• const proto = Object.getPrototypeOf(inst)
    // åŸå‹é“¾é¡¶ç«¯ï¼ˆproto ä¸º nullï¼‰æˆ–è€… inst é€šè¿‡ Object.create(null) æ„é€ ï¼ˆproto ä¸º undefinedï¼‰
    if (proto == null) return false
    if (proto === ctor.prototype) return true
    inst = proto // å¾€ä¸Šä¸€çº§æŸ¥æ‰¾
  } while (true)
}
</code></pre>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™ Object.create()]]></title>
            <link>https://github.com/toFrankie/blog/issues/4</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/4</guid>
            <pubDate>Sat, 26 Mar 2022 14:53:02 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902038140.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p><code>Object.create(proto, propertiesO]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902038140.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p><code>Object.create(proto, propertiesObject)</code> æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªå¸¦ç€æŒ‡å®šåŸå‹å¯¹è±¡å’Œå±æ€§çš„ã€Œæ–°å¯¹è±¡ã€ã€‚</p>
<p>å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œä¸»è¦æ³¨æ„å‚æ•°çš„è¾¹ç•Œå€¼å³å¯ï¼š</p>
<ul>
<li><strong><code>proto</code></strong> - ä»…æ¥å—åŸå§‹å€¼ <code>null</code> æˆ–ä»»æ„å¼•ç”¨å€¼ï¼Œå¦åˆ™æŠ›å‡º <code>TypeError</code>ã€‚</li>
<li><strong><code>propertiesObject</code></strong> - å¯é€‰å‚æ•°ï¼Œä¸ <code>Object.defineProperties()</code> ç¬¬äºŒå‚æ•°ç›¸åŒã€‚è‹¥ <code>propertiesObject</code> ä¸ä¸º <code>undefined</code> æ—¶ï¼Œè¯¥å‚æ•°ã€Œæœ¬èº«å¯æšä¸¾å±æ€§ã€ï¼ˆä¸åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„æšä¸¾å±æ€§ï¼‰å°†ä¼šä½œä¸ºæ–°åˆ›å»ºå¯¹è±¡å±æ€§å€¼å’Œå¯¹åº”çš„å±æ€§æè¿°ç¬¦ã€‚</li>
</ul>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">Object.prototype.myCreate = function (proto, propertiesObject) {
  // åªå…è®¸ null æˆ–å¼•ç”¨å€¼
  if (typeof proto !== 'object') {
    throw new TypeError('Object prototype may only be an Object or null: ' + proto)
  }

  // ç›´æ¥ä½¿ç”¨å­—é¢é‡ï¼Œæ— éœ€æ„é€ å‡½æ•°
  var _obj = {}
  _obj.__proto__ = proto // ç›¸å½“äº ES6 ä¸­çš„ Object.setPrototypeOf(_obj, proto)

  if (propertiesObject !== undefined) {
    Object.defineProperties(_obj, propertiesObject)
  }

  return _obj
}
</code></pre>
<p>å¦‚æœä½ å¯¹é‡Œé¢ <code>if (propertiesObject !== undefined) {}</code> å­˜ç–‘ï¼Œä¸å¦¨äº²è‡ªè¯•ä¸‹è¿™äº›ç”¨ä¾‹ï¼š</p>
<pre><code class="language-js">Object.create({}, 0)
Object.create({}, '')
Object.create({}, false)
Object.create({}, undefined)
Object.create({}, null) // TypeError
</code></pre>
<p>å¦‚æœ <code>propertiesObject</code> å‚æ•°ä¼ å…¥åŸå§‹å€¼ï¼Œæ‰§è¡Œåˆ° <code>Object.defineProperties()</code> æ—¶ï¼Œä¼šå…ˆç±»å‹è½¬æ¢ä¸ºå¼•ç”¨å€¼ï¼ˆå³ <code>Object(propertiesObject)</code>ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“ <code>undefined</code> å’Œ <code>null</code> æ˜¯æ— æ³•è½¬æ¢ä¸ºå¼•ç”¨ç±»å‹çš„ï¼Œå› æ­¤ä¼šæŠ›å‡º <code>TypeError</code>ã€‚ä½†ç”±äº <code>Object.create()</code> çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å…è®¸æŒ‡å®šä¸º <code>undefined</code> çš„ï¼Œå› æ­¤éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™  callã€applyã€bind]]></title>
            <link>https://github.com/toFrankie/blog/issues/3</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/3</guid>
            <pubDate>Fri, 29 Oct 2021 18:26:29 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902110567.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿™ä¸‰ä¸ªè´§ï¼Œéƒ½æ˜¯ç”¨æ¥ç»‘å®š <code>this</code> çš„ã€‚åŒºåˆ«å¦‚ä¸‹ï¼š<]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902110567.jpeg" alt="é…å›¾æºè‡ª Freepik"></p>
<p>è¿™ä¸‰ä¸ªè´§ï¼Œéƒ½æ˜¯ç”¨æ¥ç»‘å®š <code>this</code> çš„ã€‚åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>call()</code>ã€<code>apply()</code> éƒ½è¿”å›å‡½æ•°æ‰§è¡Œç»“æœï¼ŒåŒºåˆ«åœ¨äºå‚æ•°ä¸ä¸€æ ·ï¼Œå‰è€…æ¥æ”¶å‚æ•°åˆ—è¡¨ï¼Œåè€…æ¥æ”¶ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼ˆä¹Ÿå¯ä»¥æ˜¯ç±»æ•°ç»„ï¼‰ã€‚</li>
<li><code>bind()</code> è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œä½†æ³¨æ„å¯¹ä½¿ç”¨ <code>new</code> å…³é”®å­—è°ƒç”¨æ—¶ï¼Œç»‘å®šæ— æ•ˆã€‚å…¶ä½¿ç”¨æ–¹æ³•ä¸ <code>call()</code> ä¸€è‡´ï¼Œæ¥å—ä¸€ä¸ªå‚æ•°åˆ—è¡¨ã€‚</li>
</ul>
<h2>ä¸€ã€call å®ç°</h2>
<p>å‡è®¾æ²¡æœ‰ <code>Function.prototype.call()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>this</code> é»˜è®¤ç»‘å®šçš„ç‰¹æ€§å¤„ç†å³å¯ã€‚</p>
<pre><code class="language-js">Function.prototype.myCall() {
  // è·å–æ‰§è¡Œå‡½æ•°
  const fn = this

  // è·å–ç»‘å®šå¯¹è±¡ï¼ŒåŠå‚æ•°åˆ—è¡¨
  const [context, ...args] = arguments

  // é¿å…ä¸ç»‘å®šå¯¹è±¡å±æ€§å†²çªï¼Œé‡‡ç”¨ Symbol å€¼ä½œä¸ºå±æ€§é”®ï¼Œå¹¶å°†æ‰§è¡Œå‡½æ•°èµ‹äºˆè¯¥å±æ€§ã€‚
  const key = Symbol()
  context[key] = fn

  // æ‰§è¡Œå‡½æ•°å¹¶è¿”å›ç»“æœ
  const res = context[key](...args)

  // ç§»é™¤ä¸´æ—¶å±æ€§
  delete context[key]

  // è¿”å›ç»“æœ
  return res
}
</code></pre>
<p>è¿˜æ²¡å®Œï¼Œè¯·æ³¨æ„ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>å½“ <code>context</code> ä¸º <code>undefined</code> æˆ– <code>null</code> çš„æƒ…å†µã€‚è‹¥å¤„äºéä¸¥æ ¼æ¨¡å¼ï¼Œ<code>context</code> åº”æŒ‡å‘é¡¶å±‚å¯¹è±¡ <code>globalThis</code>ï¼Œåœ¨æµè§ˆå™¨ä¸º <code>window</code> å¯¹è±¡ã€‚</li>
<li>è‹¥ <code>context</code> ä¸ºå…¶ä»–åŸå§‹å€¼ï¼ˆä¸æ˜¯ <code>undefined</code>ã€<code>null</code>ï¼‰ï¼Œåº”è¯¥è¦å°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„å¼•ç”¨å€¼ã€‚</li>
</ul>
<pre><code class="language-js">Function.prototype.myCall = function () {
  const fn = this
  const [ctx, ...args] = arguments
  const context = ctx == undefined ? window : Object(ctx)

  const key = Symbol()
  context[key] = fn

  const res = context[key](...args)
  delete context[key]

  return res
}
</code></pre>
<p>å†ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">Function.prototype.myCall = function (ctx, ...args) {
  const key = Symbol()
  const context = ctx == undefined ? window : Object(ctx)

  context[key] = this
  const res = context[key](...args)
  delete context[key]

  return res
}
</code></pre>
<h2>äºŒã€apply å®ç°</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>Function.prototype.apply()</code> å’Œ <code>Function.prototype.call()</code> çš„åŒºåˆ«ä»…åœ¨æ¥æ”¶å‚æ•°çš„å½¢å¼ä¸åŒï¼Œå‰è€…æ¥æ”¶ä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>åŸºäºä¸Šé¢çš„å®ç°ï¼Œç®€å•ä¿®æ”¹ä¸‹å‡½æ•°æ‰§è¡Œçš„å‚æ•°å³å¯ã€‚</p>
<pre><code class="language-js">Function.prototype.myApply = function (ctx, ...args) {
  const key = Symbol()
  const context = ctx == undefined ? window : Object(ctx)

  context[key] = this
  const res = context[key](args) // ä¸ call æ–¹æ³•çš„åŒºåˆ«ç‚¹
  delete context[key]

  return res
}
</code></pre>
<h2>ä¸‰ã€bind å®ç°</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>Function.prototype.bind()</code> å‚æ•°å½¢å¼ä¸ <code>Function.prototype.call()</code> ç›¸åŒï¼ŒåŒºåˆ«åœ¨äº <code>bind()</code> è¿”å›ä¸€ä¸ªç»‘å®šäº† <code>this</code> çš„æ–°å‡½æ•°ã€‚</p>
<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«å°±å†™å‡ºä»¥ä¸‹æ–¹æ³•ï¼š</p>
<pre><code class="language-js">Function.prototype.myBind = function (ctx, ...args) {
  const fn = this
  return function (...newArgs) {
    return fn.apply(ctx, [...args, ...newArgs])
  }
}
</code></pre>
<p>ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸å®Œå…¨æ­£ç¡®çš„...</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>bind()</code> æ–¹æ³•è¿”å›çš„æ–°å‡½æ•°ï¼Œè‹¥é€šè¿‡ <code>new</code> å…³é”®å­—è¿›è¡Œè°ƒç”¨ï¼Œé‚£ä¹ˆ <code>this</code> ç»‘å®šåˆ™ä¸ç”Ÿæ•ˆã€‚</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-js">const person = {
  name: 'Frankie'
}

function Foo(name) {
  this.name = name
}

const Bar = Foo.bind(person)
const bar = new Bar('Mandy')

console.log(person.name) // &quot;Frankie&quot;
console.log(bar.name) // &quot;Mandy&quot;
</code></pre>
<p>å‡è®¾ <code>Foo.bind(person)</code> ç”Ÿæ•ˆçš„è¯ï¼Œé‚£ä¹ˆ <code>new Bar('Mandy')</code> ä¸­ <code>this.name</code> åº”è¯¥æ˜¯ <code>person.name = 'Mandy'</code>ï¼Œä¿®æ”¹çš„åº”è¯¥æ˜¯ <code>person</code> å¯¹è±¡çš„ <code>name</code> å±æ€§ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚</p>
<blockquote>
<p>é¡ºé“æ€»ç»“ä¸€ä¸‹ <code>this</code> ç»‘å®šçš„ä¼˜å…ˆçº§ï¼š</p>
<ol>
<li>åªè¦ä½¿ç”¨ <code>new</code> å…³é”®å­—è°ƒç”¨ï¼Œæ— è®ºæ˜¯å¦å«æœ‰ <code>bind</code> ç»‘å®šï¼Œ<code>this</code> æ€»æŒ‡å‘å®ä¾‹åŒ–å¯¹è±¡ã€‚</li>
<li>é€šè¿‡ <code>call</code>ã€<code>apply</code> æˆ–è€… <code>bind</code> æ˜¾å¼ç»‘å®šï¼Œ<code>this</code> æŒ‡å‘è¯¥ç»‘å®šå¯¹è±¡ã€‚è‹¥ç¬¬ä¸€ä¸ªå‚æ•°ç¼ºçœæ—¶ï¼Œåˆ™æ ¹æ®æ˜¯å¦ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œæ¥ç¡®å®š <code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡æˆ–è€… <code>undefined</code>ã€‚</li>
<li>å‡½æ•°é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡è°ƒç”¨ï¼Œ<code>this</code> æŒ‡å‘ï¼ˆæœ€åï¼‰è°ƒç”¨å®ƒçš„å¯¹è±¡ã€‚</li>
<li>å¦‚ä»¥ä¸Šå‡æ²¡æœ‰ï¼Œåˆ™ä¼šé»˜è®¤ç»‘å®šã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>this</code> æŒ‡å‘ <code>undefined</code>ï¼Œå¦åˆ™æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚</li>
</ol>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æ¥å®Œå–„ä¸€ä¸‹ <code>myBind()</code> æ–¹æ³•ï¼š</p>
<pre><code class="language-js">Function.prototype.myBind = function (ctx, ...args) {
  const fn = this
  return function newFn(...newArgs) {
    // è‹¥é€šè¿‡ new å…³é”®å­—è°ƒç”¨ï¼Œæœ‰å‡ ç§æ–¹å¼å¯ä»¥åˆ¤æ–­ï¼š
    // 1. this instanceof newFn
    // 2. this.__proto__.constructor === newFn
    // 3. new.target ä¸ä¸º undefined
    if (new.target) {
      return new newFn(...args, ...newArgs)
    }

    return fn.apply(ctx, [...args, ...newArgs])
  }
}
</code></pre>
<p>å»æ‰æ³¨é‡Šï¼Œå°±é•¿è¿™æ ·ï¼š</p>
<pre><code class="language-js">Function.prototype.myBind = function (ctx, ...args) {
  const fn = this
  return function newFn(...newArgs) {
    if (new.target) {
      return new newFn(...args, ...newArgs)
    }

    return fn.apply(ctx, [...args, ...newArgs])
  }
}
</code></pre>
<p>æ€»çš„æ¥è¯´ï¼Œå…¶å®å¹¶ä¸èƒ½ï¼ŒçœŸæ­£äº†è§£ this åŸç†ï¼Œè¦æ‰‹å†™è¿™å‡ ä¸ªå¸¸è€ƒçš„é¢è¯•é¢˜ï¼Œå…¶å®å¾ˆç®€å•å“ˆã€‚</p>
<blockquote>
<p>æ’ä¸ªè¯ï¼Œæˆ‘è®¤ä¸ºå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œåƒä¸‡ä¸è¦æŠŠä½œç”¨åŸŸï¼ˆé“¾ï¼‰å’Œ <code>this</code> æ··ä¸ºä¸€è°ˆï¼Œå…¶å®å®ƒä»¬å®Œå…¨å°±æ˜¯ä¸¤å›äº‹ã€‚ä½œç”¨åŸŸï¼ˆé“¾ï¼‰ä¸é—­åŒ…ç›¸å…³ï¼Œå®ƒåœ¨å‡½æ•°è¢«å®šä¹‰æ—¶å°±å·²â€œç¡®å®šâ€ï¼Œä¸ä¼šå†å˜äº†ã€‚è€Œ <code>this</code> åˆ™ä¸å‡½æ•°è°ƒç”¨ç›¸å…³ã€‚</p>
</blockquote>
<h2>References</h2>
<p>è¿™é‡Œå°†æ­¤å‰å†™è¿‡å…³äº <code>this</code> çš„æ–‡ç« åˆ—ä¸¾å‡ºæ¥ï¼š</p>
<ul>
<li><a href="https://www.jianshu.com/p/7d13893530de">ç»†è¯» JS ä¹‹ this è¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/93e545ea4eb3">åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ this</a></li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™æ·±æ‹·è´]]></title>
            <link>https://github.com/toFrankie/blog/issues/2</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/2</guid>
            <pubDate>Fri, 29 Oct 2021 06:38:34 GMT</pubDate>
            <description><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d1a19225ff7a1391.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Feepik"><]]></description>
            <content:encoded><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d1a19225ff7a1391.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…å›¾æºè‡ª Feepik"></p>
<h2>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦æ‹·è´ï¼ˆå¤åˆ¶ï¼‰ï¼Ÿ</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œåˆ†ä¸º<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>å’Œ<strong>å¼•ç”¨æ•°æ®ç±»å‹</strong>ã€‚</p>
<pre><code class="language-text">åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitivesï¼ŒåŸå§‹ç±»å‹ï¼‰
  Undefined
  Null
  Boolean
  String
  Number
  Symbol
  BigInt

å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆObjectsï¼Œå¼•ç”¨ç±»å‹ï¼‰
  Objectï¼ˆåŒ…æ‹¬åŸºäº Object æ„é€ å™¨çš„æ´¾ç”Ÿå¯¹è±¡ï¼Œå¦‚ Objectã€Arrayã€Functionã€Dateã€Map ç­‰ç­‰ä¸€ç³»åˆ—çš„å†…ç½®å¯¹è±¡ï¼‰
</code></pre>
<p>è¯·æ³¨æ„ï¼Œæ˜ç¡®å‡ ç‚¹ï¼ï¼ï¼</p>
<blockquote>
<ul>
<li>åŸå§‹ç±»å‹çš„å€¼ç§°ä¸ºâ€œåŸå§‹å€¼â€ï¼Œæ¯”å¦‚ Boolean ç±»å‹çš„åŸå§‹å€¼åªæœ‰ true å’Œ falseã€‚åŒç†ï¼Œå¼•ç”¨ç±»å‹çš„å€¼è¢«ç§°ä¸ºâ€œå¼•ç”¨å€¼â€ã€‚</li>
<li><strong>æ‰€æœ‰åŸå§‹å€¼ï¼ˆPrimitive Valueï¼‰éƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œè€Œä¸”ä¸å«ä»»ä½•çš„å±æ€§å’Œæ–¹æ³•ã€‚</strong></li>
</ul>
</blockquote>
<p>çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">// æƒ…å†µä¸€ï¼šåªæ˜¯å°†ä¸€ä¸ªæ–°å€¼ true èµ‹äºˆå˜é‡ fooï¼Œè€Œä¸æ˜¯ 20 è¢«ä¿®æ”¹äº†ã€‚
let foo = 20
foo = true

// æƒ…å†µäºŒï¼šå˜é‡ foo çš„å€¼ï¼Œå§‹ç»ˆæ²¡æœ‰æ”¹å˜ã€‚
let foo = 'foo'
foo.toUpperCase() // &quot;FOO&quot;
foo // &quot;foo&quot;

// æƒ…å†µä¸‰ï¼šå¯ä»¥è¯´æ˜å°†â€œåŸå§‹å€¼â€ num ä¼ å…¥å‡½æ•° fnï¼Œåªæ˜¯å°† num çš„å€¼æ‹·è´äº†ä¸€ä»½ï¼Œç„¶åèµ‹äºˆå½¢å‚ nã€‚å¹¶æœªå½±å“åˆ°å…¨å±€çš„å˜é‡ numã€‚ï¼ˆæ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯åŸå§‹å€¼ï¼Œè€Œéå¼•ç”¨å€¼ï¼‰
let num = 1
function fn(n) {
  n++
  console.log(n)
}
fn(num) // 2
num // 1

// æƒ…å†µå››ï¼šåªæ˜¯ JS å†…éƒ¨è‡ªåŠ¨éšå¼ç±»å‹è½¬æ¢äº†ï¼Œå½“ä¸€ä¸ªåŸå§‹å€¼è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œ
// ä¼šå°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå†è®¿é—®è¯¥å¼•ç”¨å€¼çš„å±æ€§æˆ–æ–¹æ³•ã€‚ï¼ˆå°±æ˜¯å¸¸è¯´çš„åŒ…è£…ç±»ï¼‰
let foo = 'foo'
foo.length // 3ï¼Œç›¸å½“äº Object(foo).length æˆ– new String(foo).length
foo.toUpperCase() // &quot;FOO&quot;
</code></pre>
<p>ä»¥ä¸Šéƒ½å‘ç”Ÿäº†â€œæ‹·è´â€ï¼Œåªæ˜¯åŸå§‹å€¼çš„æ‹·è´æ˜¯å¦å¤–åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œè€ŒåŸæœ¬çš„å€¼ä¸å‰¯æœ¬æ˜¯å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°çš„ã€‚ä½†å¦‚æœæ˜¯â€œå¼•ç”¨å€¼â€ï¼Œé‚£å°±éº»çƒ¦äº†ã€‚</p>
<pre><code class="language-js">const foo = { name: 'Frankie' }
const bar = foo

bar.name = 'Mandy'
foo.name // &quot;Mandy&quot;ï¼Œä¿®æ”¹å˜é‡ bar çš„æ—¶å€™ï¼Œfoo çš„å€¼ä¹Ÿå‘ç”Ÿæ”¹å˜äº†ã€‚

foo === bar // trueï¼Œç”±å§‹è‡³ç»ˆå˜é‡ foo å’Œ bar éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚
</code></pre>
<p>è¿™å…¶å®ä¹Ÿæ˜¯æ‹·è´ï¼Œåªä¸è¿‡å¼•ç”¨å€¼æ‹·è´çš„æ˜¯â€œåœ°å€â€ï¼ˆä¹Ÿæœ‰äººè¯´æˆâ€œæŒ‡é’ˆâ€ï¼Œä¸é‡è¦ï¼‰ã€‚<strong>å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬è¯´çš„â€œæ‹·è´â€æ˜¯æŒ‡å¼•ç”¨å€¼çš„æ‹·è´ï¼ˆæˆ–ç§°ä¸ºå¤åˆ¶ï¼‰ã€‚</strong></p>
<ul>
<li>
<p><strong>æµ…æ‹·è´</strong></p>
<ul>
<li><code>Array.prototype.slice()</code></li>
<li><code>Array.prototype.concat()</code></li>
<li><code>Object.assign()</code></li>
<li>åˆ©ç”¨ <code>...</code> æ‰©å±•è¿ç®—ç¬¦</li>
<li>è‡ªå®ç°</li>
</ul>
</li>
<li>
<p><strong>æ·±æ‹·è´</strong></p>
<ul>
<li><code>JSON.stringify()</code> å’Œ <code>JSON.parse()</code> ç»“åˆ</li>
<li><code>$.extend()</code>ã€<code>$.clone()</code>ï¼ˆJQuery åº“ï¼‰</li>
<li><code>_.cloneDeep()</code>ï¼ˆLodash åº“ï¼‰</li>
</ul>
</li>
</ul>
<p>åŒºåˆ«ä¸è¯´äº†ï¼Œä½ ä»¬éƒ½çŸ¥é“çš„ã€‚</p>
<h2>äºŒã€å¦‚ä½•é€‰æ‹©æ·±æ‹·è´çš„æ–¹å¼ï¼Ÿ</h2>
<p>ä¼˜å…ˆçº§åº”ç”±ä¸Šè‡³ä¸‹ï¼š</p>
<ul>
<li>
<p><code>JSON.stringify()</code> å’Œ <code>JSON.parse()</code> å¯ä»¥å¤„ç† 99.9% çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¼˜å…ˆé€‰å®ƒä»¬ã€‚</p>
</li>
<li>
<p>å†…ç½®æ–¹æ³•å¤„ç†ä¸äº†çš„æƒ…å†µï¼Œåº”æ ¹æ®å®é™…åœºæ™¯è€Œå®šï¼š</p>
<ul>
<li>è‹¥è¦å®ç°å¾ˆå®Œå–„çš„æ·±æ‹·è´ï¼Œåº”é€‰æ‹© Lodash çš„ _.cloneDeep() æ–¹æ³•ï¼Œæ›´å¯é ã€‚</li>
<li>è‹¥ä¸éœ€è¦ Lodash é‚£ä¹ˆå®Œå–„çš„æ·±æ‹·è´ï¼Œåº”è¯¥è‡ªå·±æ‰‹å†™ä¸€ä¸ªï¼Œæ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ã€‚</li>
</ul>
</li>
<li>
<p>é¢å‘é¢è¯•ä¹‹æ·±æ‹·è´ï¼Œçœ‹æœ¬æ–‡ã€‚</p>
</li>
</ul>
<h4>JSON.stringify() çš„ç¼ºé™·</h4>
<p>åˆ©ç”¨ JavaScript å†…ç½®çš„ JSON å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å®ç°ç®€æ˜“çš„æ·±æ‹·è´ï¼š</p>
<pre><code class="language-js">const obj = {
  // ...
}
JSON.parse(JSON.stringify(obj)) // åºåˆ—åŒ–ä¸ååºåˆ—åŒ–
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ï¼Œå…¶å®èƒ½é€‚ç”¨äº 99.9% ä»¥ä¸Šçš„åº”ç”¨åœºæ™¯ã€‚æ¯•ç«Ÿå¤šæ•°é¡¹ç›®ä¸‹ï¼Œå¾ˆå°‘ä¼šå»æ‹·è´ä¸€ä¸ªå‡½æ•°ä»€ä¹ˆçš„ã€‚</p>
<p>ä½†ä¸å¾—ä¸è¯´ï¼Œè¿™é‡Œé¢æœ‰â€œå‘â€ï¼Œè¿™äº›â€œå‘â€æ˜¯ <code>JSON.stringify()</code> æ–¹æ³•æœ¬èº«å®ç°é€»è¾‘äº§ç”Ÿçš„ï¼š</p>
<blockquote>
<p>JSON.stringify(value[, replacer[, space]])</p>
</blockquote>
<p>è¯¥æ–¹æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²å¯¹åº”çš„åŒ…è£…å¯¹è±¡ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¼šè‡ªåŠ¨è½¬æ¢æˆå…¶åŸå§‹å€¼ã€‚</li>
<li><code>undefined</code>ã€<code>ä»»æ„å‡½æ•°</code>ã€<code>Symbol å€¼</code>ï¼Œåœ¨åºåˆ—åŒ–è¿‡ç¨‹æœ‰ä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚è‹¥å‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­ï¼Œä¼šè¢«å¿½ç•¥ï¼›è‹¥å‡ºç°åœ¨æ•°ç»„ä¸­ï¼Œä¼šè½¬æ¢æˆ <code>null</code>ã€‚</li>
<li><code>ä»»æ„å‡½æ•°</code>ã€<code>undefined</code> è¢«å•ç‹¬è½¬æ¢æ—¶ï¼Œä¼šè¿”å› <code>undefined</code>ã€‚</li>
<li>æ‰€æœ‰<code>ä»¥ Symbol ä¸ºå±æ€§é”®çš„å±æ€§</code>éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥ï¼Œå³ä¾¿åœ¨è¯¥æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•° <code>replacer</code> ä¸­æŒ‡å®šäº†è¯¥å±æ€§ã€‚</li>
<li><code>Date æ—¥æœŸ</code>è°ƒç”¨äº†å…¶å†…ç½®çš„ <code>toJSON()</code> æ–¹æ³•è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå› æ­¤ä¼šè¢«å½“åˆå­—ç¬¦ä¸²å¤„ç†ã€‚</li>
<li><code>NaN</code> å’Œ <code>Infinity</code> çš„æ•°å€¼åŠ <code>null</code> éƒ½ä¼šå½“åš <code>null</code>ã€‚</li>
<li>è¿™äº›å¯¹è±¡ <code>Map</code>ã€<code>Set</code>ã€<code>WeakMap</code>ã€<code>WeakSet</code> ä»…ä¼šåºåˆ—åŒ–å¯æšä¸¾çš„å±æ€§ã€‚</li>
<li>è¢«è½¬æ¢å€¼å¦‚æœå«æœ‰ <code>toJSON()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰ä»€ä¹ˆå€¼å°†è¢«åºåˆ—åŒ–ã€‚</li>
<li>å¯¹åŒ…å« <code>å¾ªç¯å¼•ç”¨</code> çš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
</ul>
<h4>æ·±æ‹·è´çš„è¾¹ç•Œ</h4>
<p>å…¶å®ï¼Œé’ˆå¯¹ä»¥ä¸Šä¸¤ä¸ªå†…ç½®çš„å…¨å±€æ–¹æ³•ï¼Œè¿˜æœ‰è¿™ä¹ˆå¤šæƒ…å†µä¸èƒ½å¤„ç†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ°”äººã€‚å…¶å®ä¸ç„¶ï¼Œæˆ‘çŒœæµ‹ <code>JSON.parse()</code> å’Œ <code>JSON.stringify()</code> åªæ˜¯è®©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°æ“ä½œç¬¦åˆ JSON æ ¼å¼çš„ JavaScript å¯¹è±¡æˆ–ç¬¦åˆ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è‡³äºä¸Šé¢æåˆ°çš„â€œå‘â€ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸ç¬¦åˆä½œä¸ºè·¨å¹³å°æ•°æ®äº¤æ¢çš„æ ¼å¼è¦æ±‚çš„ã€‚åœ¨ JSON ä¸­ï¼Œå®ƒæœ‰ <code>null</code>ï¼Œå¯æ²¡æœ‰ <code>undefined</code>ã€<code>Symbol</code> ç±»å‹ã€å‡½æ•°ç­‰ã€‚</p>
<p>JSON æ˜¯ä¸€ç§æ•°æ®æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§è§„èŒƒã€‚JSON æ˜¯ç”¨äºè·¨å¹³å°æ•°æ®äº¤æµçš„ï¼Œç‹¬ç«‹äºè¯­è¨€å’Œå¹³å°ã€‚è€Œ JavaScript å¯¹è±¡æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå­˜åœ¨äºå†…å­˜ä¸­ã€‚JavaScript å¯¹è±¡æ˜¯æ²¡åŠæ³•ä¼ è¾“çš„ï¼Œåªæœ‰åœ¨è¢«åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åæ‰èƒ½ä¼ è¾“ã€‚</p>
<blockquote>
<p>æ­¤å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»äº† JSON å’Œ JavaScript çš„å…³ç³»ä»¥åŠä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•çš„ä¸€äº›ç»†èŠ‚ã€‚å¯çœ‹ï¼š<a href="https://www.jianshu.com/p/a07e746fd9db">è¯¦è°ˆ JSON ä¸ JavaScript</a>ã€‚</p>
</blockquote>
<p>å¦‚æœè‡ªå·±å®ç°ä¸€ä¸ªæ·±æ‹·è´çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯æœ‰å¾ˆå¤šè¾¹ç•Œé—®é¢˜è¦å¤„ç†çš„ï¼Œè‡³äºè¿™äº›ç§ç§çš„è¾¹ç•Œ Caseï¼Œè¦ä¸è¦å¤„ç†æœ€å¥½ä»å®é™…æƒ…å†µå‡ºå‘ã€‚</p>
<p>å¸¸è§çš„è¾¹ç•Œ Case æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>ä¸»è¦æœ‰å¾ªç¯å¼•ç”¨ã€åŒ…è£…å¯¹è±¡ã€å‡½æ•°ã€åŸå‹é“¾ã€ä¸å¯æšä¸¾å±æ€§ã€Map/WeakMapã€Set/WeakSetã€RegExpã€Symbolã€Dateã€ArrayBufferã€åŸç”Ÿ DOM/BOM å¯¹è±¡ç­‰ã€‚</p>
</blockquote>
<p><strong>å°±ç›®å‰è€Œè¨€ï¼Œç¬¬ä¸‰æ–¹æœ€å®Œå–„çš„æ·±æ‹·è´æ–¹æ³•æ˜¯ <a href="https://www.lodashjs.com/">Lodash</a> åº“çš„ <a href="https://www.lodashjs.com/docs/lodash.cloneDeep"><code>_.cloneDeep()</code></a> æ–¹æ³•äº†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¦‚éœ€å¤„ç† <code>JSON.stringify()</code> æ— æ³•è§£å†³çš„ Caseï¼Œæˆ‘ä¼šæ¨èä½¿ç”¨å®ƒ</strong>ã€‚å¦åˆ™è¯·ä½¿ç”¨å†…ç½® JSON æ–¹æ³•å³å¯ï¼Œæ²¡å¿…è¦å¤æ‚åŒ–ã€‚</p>
<p>ä½†å¦‚æœä¸ºäº†å­¦ä¹ æ·±æ‹·è´ï¼Œé‚£åº”è¯¥è¦æ¯ç§æƒ…å†µéƒ½è¦å»å°è¯•å®ç°ä¸€ä¸‹ï¼Œæˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä½ åœ¨çœ‹è¿™ç¯‡æ–‡ç« çš„åŸæ„ã€‚è¿™æ ·ï¼Œæ— è®ºæ˜¯å®ç°ç‰¹æ®Šè¦æ±‚çš„æ·±æ‹·è´ï¼Œè¿˜æ˜¯é¢è¯•ï¼Œéƒ½å¯ä»¥ä»å®¹åº”å¯¹ã€‚</p>
<p>ä¸‹é¢ä¸€èµ·æ¥å­¦ä¹ å§ï¼Œå¦‚æœ‰ä¸è¶³ï¼Œæ¬¢è¿æŒ‡å‡º ğŸ‘‹ ~</p>
<h3>ä¸‰ã€è‡ªå®ç°æ·±æ‹·è´æ–¹æ³•</h3>
<p>ä¸»è¦è¿ç”¨åˆ°é€’å½’çš„æ€è·¯å»å®ç°ä¸€ä¸ªæ·±æ‹·è´æ–¹æ³•ã€‚</p>
<blockquote>
<p>PSï¼šå®Œæ•´çš„æ·±æ‹·è´æ–¹æ³•ä¼šåœ¨æ–‡ç« æœ€åæ”¾å‡ºã€‚</p>
</blockquote>
<p>å…ˆå†™ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; Object.prototype.toString.call(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    const output = isArray(input) ? [] : {}
    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>ä»¥ä¸Šç®€æ˜“ç‰ˆæœ¬è¿˜å­˜åœ¨å¾ˆå¤šæƒ…å†µè¦ç‰¹æ®Šå¤„ç†ï¼Œæ¥ä¸‹æ¥é’ˆå¯¹ <code>JSON.stringify()</code> çš„ç¼ºé™·ï¼Œä¸€ç‚¹ä¸€ç‚¹å»å®Œå–„å®ƒã€‚</p>
<h5>3.1 é’ˆå¯¹å¸ƒå°”å€¼ã€æ•°å€¼ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡çš„å¤„ç†</h5>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä» ES6 å¼€å§‹å›´ç»•åŸå§‹æ•°æ®ç±»å‹åˆ›å»ºä¸€ä¸ªæ˜¾å¼åŒ…è£…å™¨å¯¹è±¡ä¸å†è¢«æ”¯æŒã€‚ä½†ç”±äºé—ç•™åŸå› ï¼Œç°æœ‰çš„åŸå§‹åŒ…è£…å™¨å¯¹è±¡ï¼ˆå¦‚ <code>new Boolean</code>ã€<code>new Number</code>ã€<code>new String</code>ï¼‰ä»å¯ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ ES6+ æ–°å¢çš„ <code>Symbol</code>ã€<code>BigInt</code> æ•°æ®ç±»å‹æ— æ³•é€šè¿‡ <code>new</code> å…³é”®å­—åˆ›å»ºå®ä¾‹å¯¹è±¡çš„åŸå› ã€‚</p>
</blockquote>
<p>ç”±äº <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in">for...in</a> æ— æ³•éå†<strong>ä¸å¯æšä¸¾</strong>çš„å±æ€§ã€‚ä¾‹å¦‚ï¼ŒåŒ…è£…å¯¹è±¡çš„ <code>[[PrimitiveValue]]</code> å†…éƒ¨å±æ€§ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬ç‰¹æ®Šå¤„ç†ä¸€ä¸‹ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-78fa536df61e8c06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»¥ä¸Šç»“æœï¼Œæ˜¾ç„¶ä¸æ˜¯é¢„æœŸç»“æœã€‚åŒ…è£…å¯¹è±¡çš„ <code>[[PrimitiveValue]]</code> å±æ€§å¯é€šè¿‡ <code>valueOf()</code> æ–¹æ³•è·å–ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // è·å–æ•°æ®ç±»å‹ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const getClass = x =&gt; Object.prototype.toString.call(x)

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      case '[object Boolean]':
        return Object(Boolean.prototype.valueOf.call(obj))
      case '[object Number]':
        return Object(Number.prototype.valueOf.call(obj))
      case '[object String]':
        return Object(String.prototype.valueOf.call(obj))
      case '[object Symbol]':
        return Object(Symbol.prototype.valueOf.call(obj))
      case '[object BigInt]':
        return Object(BigInt.prototype.valueOf.call(obj))
      default:
        return undefined
    }
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // å¤„ç†åŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    // å…¶ä½™éƒ¨åˆ†æ²¡å˜ï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…ï¼Œçœç•¥ä¸€ä¸‡å­—...
  }

  return copy(source)
}
</code></pre>
<p>æˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç¬¦åˆé¢„æœŸç»“æœçš„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-5a779a6b1676347c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5>3.2 é’ˆå¯¹å‡½æ•°çš„å¤„ç†</h5>
<p>ç›´æ¥è¿”å›å°±å¥½äº†ï¼Œä¸€èˆ¬ä¸ç”¨å¤„ç†ã€‚åœ¨å®é™…åº”ç”¨åœºæ™¯éœ€è¦æ‹·è´å‡½æ•°å¤ªå°‘äº†...</p>
<pre><code class="language-js">const copy = input =&gt; {
  if (typeof input === 'function' || !isObject(input)) return input
}
</code></pre>
<h5>3.3 é’ˆå¯¹ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å¤„ç†</h5>
<p>ç”±äºä»¥ä¸Š <code>for...in</code> æ–¹æ³•æ— æ³•éå† <code>Symbol</code> çš„å±æ€§é”®ï¼Œå› æ­¤ï¼š</p>
<pre><code class="language-js">const sym = Symbol('desc')
const obj = {
  [sym]: 'This is symbol value'
}
console.log(deepCopy(obj)) // {}ï¼Œæ‹·è´ç»“æœæ²¡æœ‰ [sym] å±æ€§
</code></pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols()</a>
å®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡è‡ªèº«çš„æ‰€æœ‰ Symbol å±æ€§çš„æ•°ç»„ï¼ŒåŒ…æ‹¬ä¸å¯æšä¸¾çš„å±æ€§ã€‚</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable">Object.prototype.propertyIsEnumerable()</a>
å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŒ‡å®šçš„å±æ€§æ˜¯å¦å¯æšä¸¾ã€‚</p>
</li>
</ul>
<pre><code class="language-js">const copy = input =&gt; {
  // å…¶å®ƒä¸å˜
  for (let key in input) {
    // ...
  }

  // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const symbolArr = Object.getOwnPropertySymbols(input)
  if (symbolArr.length) {
    for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
      if (input.propertyIsEnumerable(symbolArr[i])) {
        const value = input[symbolArr[i]]
        output[symbolArr[i]] = copy(value)
      }
    }
  }

  // ...
}
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬å¯¹ <code>source</code> å¯¹è±¡åšæ‹·è´æ“ä½œï¼š</p>
<pre><code class="language-js">const source = {}
const sym1 = Symbol('1')
const sym2 = Symbol('2')
Object.defineProperties(source, {
  [sym1]: {
    value: 'This is symbol value.',
    enumerable: true
  },
  [sym2]: {
    value: 'This is a non-enumerable property.',
    enumerable: false
  }
})
</code></pre>
<p>æ‰“å°ç»“æœï¼Œä¹Ÿç¬¦åˆé¢„æœŸç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-17ed4f9fd1744951.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5>3.4 é’ˆå¯¹ Date å¯¹è±¡çš„å¤„ç†</h5>
<p>å…¶å®ï¼Œå¤„ç† <code>Date</code> å¯¹è±¡ï¼Œè·Ÿä¸Šé¢æåˆ°çš„åŒ…è£…å¯¹è±¡çš„å¤„ç†æ˜¯å·®ä¸å¤šçš„ã€‚æš‚æ—¶å…ˆæ”¾åˆ° <code>isWrapperObject()</code> å’Œ <code>handleWrapperObject()</code> ä¸­å¤„ç†ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜...

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      // å…¶ä»– case ä¸å˜
      // ...
      case '[object Date]':
        return new Date(obj.valueOf()) // new Date(+obj)
      default:
        return undefined
    }
  }

  // å…¶ä»–ä¸å˜...
}
</code></pre>
<h5>3.5 é’ˆå¯¹ Mapã€Set å¯¹è±¡çš„å¤„ç†</h5>
<p>åŒæ ·çš„ï¼Œæš‚æ—¶å…ˆæ”¾åˆ° <code>isWrapperObject()</code> å’Œ <code>handleWrapperObject()</code> ä¸­å¤„ç†ã€‚</p>
<p>åˆ©ç”¨ Mapã€Set å¯¹è±¡çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols">Iterator</a> ç‰¹æ€§å’Œè‡ªèº«çš„æ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿè§£å†³ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜...

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡ï¼ˆæœ¬æ¬¡æ›´æ–°ï¼‰
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      // å…¶ä»– case ä¸å˜
      // ...
      case '[object Map]': {
        const map = new Map()
        obj.forEach((item, key) =&gt; {
          // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ key ä¸èƒ½æ·±æ‹·è´ï¼Œå¦åˆ™å°±ä¼šå¤±å»å¼•ç”¨äº†
          // å…·ä½“åŸå› å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œä¸éš¾ã€‚æƒ³ä¸æ˜ç™½å†è¯„è®ºåŒºå§
          map.set(key, copy(item))
        })
        return map
      }
      case '[object Set]': {
        const set = new Set()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // å…¶ä»–ä¸å˜...
}
</code></pre>
<p>æ‰“å°ä¸‹ç»“æœï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-e419985b0e2a6f04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5>3.6 é’ˆå¯¹å¾ªç¯å¼•ç”¨çš„é—®é¢˜</h5>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ï¼ˆcircular referenceï¼‰çš„å¯¹è±¡ï¼š</p>
<pre><code class="language-js">const foo = { name: 'Frankie' }
foo.bar = foo
</code></pre>
<p>ä¸Šé¢æåˆ° <code>JSON.stringify()</code> æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°ä¸€ä¸‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-d8445e9dd56ce04c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“å¯¹å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å¤„ç†æ—¶ï¼Œä¼šæŠ›å‡ºç±»å‹é”™è¯¯ï¼š<code>Uncaught TypeError: Converting circular structure to JSON</code>ã€‚</p>
<p>æ¥ç€ï¼Œä½¿ç”¨è‡ªè¡Œå®ç°çš„ <code>deepCopy()</code> æ–¹æ³•ï¼Œçœ‹ä¸‹ç»“æœæ˜¯ä»€ä¹ˆï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-6ef50a132b4f42c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨æ‹·è´å¾ªç¯å¼•ç”¨çš„ <code>foo</code> å¯¹è±¡æ—¶ï¼Œå‘ç”Ÿæ ˆæº¢å‡ºäº†ã€‚</p>
<blockquote>
<p>åœ¨å¦ä¸€ç¯‡<a href="https://www.jianshu.com/p/a07e746fd9db">æ–‡ç« </a>ï¼Œæˆ‘æåˆ°è¿‡ä½¿ç”¨ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fdouglascrockford%2FJSON-js">JSON-js</a> å¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå…·ä½“ç”¨æ³•æ˜¯ï¼Œå…ˆå¼•å…¥å…¶ä¸­çš„ Â <code>cycle.js</code>Â  è„šæœ¬ï¼Œç„¶å Â <code>JSON.stringify(JSON.decycle(foo))</code>Â  å°± OK äº†ã€‚ä½†ç©¶å…¶æ ¹æœ¬ï¼Œå®ƒä½¿ç”¨äº† <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a> å»å¤„ç†ã€‚</p>
</blockquote>
<p>é‚£æˆ‘ä»¬å»å®ç°ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼ˆæœ¬æ¬¡æ–°å¢ï¼‰
  const weakmap = new WeakMap()

  // ä¸­é—´è¿™å—ä¸å˜ï¼Œçœç•¥ä¸€ä¸‡å­—...

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆæœ¬æ¬¡æ–°å¢ï¼Œä»¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : {}

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
    const symbolArr = Object.getOwnPropertySymbols(input)
    if (symbolArr.length) {
      for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
        if (input.propertyIsEnumerable(symbolArr[i])) {
          output[symbolArr[i]] = input[symbolArr[i]]
        }
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>å…ˆçœ‹çœ‹æ‰“å°ç»“æœï¼Œä¸ä¼šåƒä¹‹å‰ä¸€æ ·æº¢å‡ºäº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-abeca5a06a104739.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a> è€Œæ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a> çš„åŸå› ï¼š</p>
<p>é¦–å…ˆï¼ŒMap çš„é”®å±äºå¼ºå¼•ç”¨ï¼Œè€Œ WeakMap çš„é”®åˆ™å±äºå¼±å¼•ç”¨ã€‚ä¸” WeakMap çš„é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼ŒWeakMap çš„å€¼åˆ™æ˜¯ä»»æ„çš„ã€‚</p>
<p>ç”±äºå®ƒä»¬çš„é”®ä¸å€¼çš„å¼•ç”¨å…³ç³»ï¼Œå†³å®šäº† Map ä¸èƒ½ç¡®ä¿å…¶å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¼•ç”¨ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„ Mapï¼Œé‚£ä¹ˆå›¾ä¸­çš„ <code>foo</code> å¯¹è±¡å’Œæˆ‘ä»¬æ·±æ‹·è´å†…éƒ¨çš„ <code>const map = new Map()</code> åˆ›å»ºçš„ <code>map</code> å¯¹è±¡ä¸€ç›´éƒ½æ˜¯å¼ºå¼•ç”¨å…³ç³»ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºç»“æŸä¹‹å‰ï¼Œ<code>foo</code> ä¸ä¼šè¢«å›æ”¶ï¼Œå…¶å ç”¨çš„å†…å­˜ç©ºé—´ä¸€ç›´ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŸç”Ÿçš„ WeakMap æŒæœ‰çš„æ˜¯æ¯ä¸ªé”®å¯¹è±¡çš„â€œå¼±å¼•ç”¨â€ï¼Œè¿™æ„å‘³ç€åœ¨æ²¡æœ‰å…¶ä»–å¼•ç”¨å­˜åœ¨æ—¶åƒåœ¾å›æ”¶èƒ½æ­£ç¡®è¿›è¡Œã€‚åŸç”Ÿ WeakMap çš„ç»“æ„æ˜¯ç‰¹æ®Šä¸”æœ‰æ•ˆçš„ï¼Œå…¶ç”¨äºæ˜ å°„çš„ key åªæœ‰åœ¨å…¶æ²¡æœ‰è¢«å›æ”¶æ—¶æ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚</p>
<blockquote>
<p>å¯çœ‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap#why_weakmap">Why WeakMap?</a></p>
</blockquote>
<p>æˆ‘ä»¬ç†ŸçŸ¥çš„ Lodash åº“çš„æ·±æ‹·è´æ–¹æ³•ï¼Œè‡ªå®ç°äº†ä¸€ä¸ªç±»ä¼¼ WeakMap ç‰¹æ€§çš„æ„é€ å‡½æ•°å»å¤„ç†å¾ªç¯å¼•ç”¨çš„ã€‚ï¼ˆ<a href="https://github.com/lodash/lodash/blob/master/.internal/baseClone.js#L199-L205">è¯¦çœ‹</a>ï¼‰</p>
<p>è¿™é‡Œæä¾›å¦ä¸€ä¸ªæ€è·¯ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸€æ ·ï¼Œçœç•¥ä¸€ä¸‡å­—...

  // åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå°†æ¯æ¬¡æ‹·è´çš„å¯¹è±¡æ”¾è¿›å»
  const copiedArr = []

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // å¾ªç¯éå†ï¼Œè‹¥æœ‰å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œåˆ™ç›´æ¥æ”¾å›ï¼Œä»¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜
    for (let i = 0, len = copiedArr.length; i &lt; len; i++) {
      if (input === copiedArr[i].key) return copiedArr[i].value
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : {}

    // è®°å½•æ¯ä¸€æ¬¡çš„å¯¹è±¡
    copiedArr.push({ key: input, value: output })

    // åé¢çš„æµç¨‹ä¸å˜...
  }

  return copy(source)
}
</code></pre>
<blockquote>
<p>æ­¤å‰å®ç°æœ‰ä¸ª bugï¼Œæ„Ÿè°¢è™¾è™¾ç±³æŒ‡å‡ºï¼Œç°å·²æ›´æ­£ã€‚</p>
</blockquote>
<p>è¯·åœ¨å®ç°æ·±æ‹·è´ä¹‹åæµ‹è¯•ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const foo = { name: 'Frankie' }
foo.bar = foo

const cloneObj = deepCopy(foo) // è‡ªå®ç°æ·±æ‹·è´
const lodashObj = _.cloneDeep(foo) // Lodash æ·±æ‹·è´

// æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜æ˜¯æ­£ç¡®çš„
console.log(lodashObj.bar === lodashObj) // true
console.log(lodashObj.bar === foo) // false
console.log(cloneObj.bar === cloneObj) // true
console.log(cloneObj.bar === foo) // false
</code></pre>
<h5>3.7 é’ˆå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†</h5>
<p>æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„å±æ€§ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/source">RegExp.prototype.source</a>
è¿”å›å½“å‰æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ¨¡å¼æ–‡æœ¬çš„å­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ ES6 æ–°å¢çš„å±æ€§ã€‚</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/flags">RegExp.prototype.flags</a>
è¿”å›å½“å‰æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡æ ‡å¿—ã€‚</li>
</ul>
<pre><code class="language-js">const { source, flags } = /\d/g
console.log(source) // &quot;\\d&quot;
console.log(flags) // &quot;g&quot;
</code></pre>
<p>æœ‰äº†ä»¥ä¸Šä¸¤ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>new RegExp(pattern, flags)</code> æ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼äº†ã€‚</p>
<pre><code>const { source, flags } = /\d/g
const newRegex = new RegExp(source, flags) // /\d/g
</code></pre>
<p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/lastIndex"><code>lastIndex</code></a> å±æ€§ï¼Œè¯¥å±æ€§å¯è¯»å¯å†™ï¼Œå…¶å€¼ä¸ºæ•´å‹ï¼Œç”¨æ¥æŒ‡å®šä¸‹ä¸€æ¬¡åŒ¹é…çš„èµ·å§‹ç´¢å¼•ã€‚åœ¨è®¾ç½®äº† Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/global"><code>global</code></a>Â  æˆ– Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky"><code>sticky</code></a>Â  æ ‡å¿—ä½çš„æƒ…å†µä¸‹ï¼ˆå¦‚ Â <code>/foo/g</code>ã€<code>/foo/y</code>ï¼‰ï¼ŒJavaScriptÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp"><code>RegExp</code></a>Â  å¯¹è±¡æ˜¯<strong>æœ‰çŠ¶æ€</strong>çš„ã€‚ä»–ä»¬ä¼šå°†ä¸Šæ¬¡æˆåŠŸåŒ¹é…åçš„ä½ç½®è®°å½•åœ¨ Â <code>lastIndex</code>Â  å±æ€§ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œä¸Šè¿°æ‹·è´æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æ˜¯æœ‰ç¼ºé™·çš„ã€‚çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-js">const re1 = /foo*/g
const str = 'table football, foosball'
let arr

while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}

// ä»¥ä¸Šè¯­å¥ä¼šè¾“å‡ºï¼Œä»¥ä¸‹ç»“æœï¼š
// &quot;Found foo. Next starts at 9.&quot;
// &quot;Found foo. Next starts at 19.&quot;

// å½“æˆ‘ä»¬ä¿®æ”¹ re1 çš„ lastIndex å±æ€§æ—¶ï¼Œè¾“å‡ºä»¥ä¸‹ç»“æœï¼š
re1.lastIndex = 9
while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}
// &quot;Found foo. Next starts at 19.&quot;

// ä»¥ä¸Šè¿™äº›ç›¸ä¿¡ä½ ä»¬éƒ½éƒ½æ‡‚ã€‚
</code></pre>
<p>æ‰€ä»¥ï¼Œä½ å¯ä»¥å‘ç°ä»¥ä¸‹ç¤ºä¾‹ï¼Œæ‰“å°ç»“æœæ˜¯ä¸ä¸€è‡´çš„ï¼ŒåŸå› å°±æ˜¯ä½¿ç”¨ <code>RegExp</code> æ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œ<code>lastIndex</code> ä¼šé»˜è®¤è®¾ä¸º <code>0</code>ã€‚</p>
<pre><code>const re1 = /foo*/g
const str = 'table football, foosball'
let arr

// ä¿®æ”¹ lastIndex å±æ€§
re1.lastIndex = 9

// åŸºäº re1 æ‹·è´ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼
const re2 = new RegExp(re1.source, re1.flags)

console.log('re1:')
while ((arr = re1.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re1.lastIndex}.`)
}

console.log('re2:')
while ((arr = re2.exec(str)) !== null) {
  console.log(`Found ${arr[0]}. Next starts at ${re2.lastIndex}.`)
}

// re1:
// expected output: &quot;Found foo. Next starts at 19.&quot;
// re2:
// expected output: &quot;Found foo. Next starts at 9.&quot;
// expected output: &quot;Found foo. Next starts at 19.&quot;
</code></pre>
<p>å› æ­¤ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // å…¶ä»–ä¸å˜ï¼Œçœç•¥...

  // å¤„ç†æ­£åˆ™è¡¨è¾¾å¼
  const handleRegExp = regex =&gt; {
    const { source, flags, lastIndex } = regex
    const re = new RegExp(source, flags)
    re.lastIndex = lastIndex
    return re
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // æ­£åˆ™è¡¨è¾¾å¼
    if (getClass(input) === '[object RegExp]') {
      return handleRegExp(input)
    }

    // åé¢ä¸å˜ï¼Œçœç•¥...
  }

  return copy(source)
}
</code></pre>
<p>æ‰“å°ç»“æœä¹Ÿæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-86b589529c2c4222.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>ç”±äº <code>RegExp.prototype.flags</code> æ˜¯ ES6 æ–°å¢å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ ES5 æ˜¯å¦‚ä½•å®ç°çš„ï¼ˆæºè‡ª Lodashï¼‰ï¼š</p>
<pre><code class="language-js">/** Used to match `RegExp` flags from their coerced string values. */
var reFlags = /\w*$/

/**
 * Creates a clone of `regexp`.
 *
 * @private
 * @param {Object} regexp The regexp to clone.
 * @returns {Object} Returns the cloned regexp.
 */
function cloneRegExp(regexp) {
  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp))
  result.lastIndex = regexp.lastIndex
  return result
}
</code></pre>
<p>ä½†è¿˜æ˜¯é‚£å¥è¯ï¼Œéƒ½ 2021 å¹´äº†ï¼Œå…¼å®¹ ES5 çš„é—®é¢˜å°±æ”¾å¿ƒäº¤ç»™ Babel å§ã€‚</p>
<h5>3.8 å¤„ç†åŸå‹</h5>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œåªå®ç°ç±»å‹ä¸º <code>&quot;[object Object]&quot;</code> çš„å¯¹è±¡çš„åŸå‹æ‹·è´ã€‚ä¾‹å¦‚æ•°ç»„ç­‰ä¸å¤„ç†ï¼Œå› ä¸ºè¿™äº›æƒ…å†µå®é™…åœºæ™¯å¤ªå°‘äº†ã€‚</p>
</blockquote>
<p>ä¸»è¦æ˜¯ä¿®æ”¹ä»¥ä¸‹è¿™ä¸€æ­¥éª¤ï¼š</p>
<pre><code class="language-js">const output = isArray(input) ? [] : {}
</code></pre>
<p>ä¸»è¦åˆ©ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/create"><code>Object.create()</code></a> æ¥åˆ›å»º <code>output</code> å¯¹è±¡ï¼Œæ”¹æˆè¿™æ ·ï¼š</p>
<pre><code class="language-js">const initCloneObject = obj =&gt; {
  // å¤„ç†åŸºäº Object.create(null) æˆ– Object.create(Object.prototype.__proto__) çš„å®ä¾‹å¯¹è±¡
  // å…¶ä¸­ Object.prototype.__proto__ å°±æ˜¯ç«™åœ¨åŸå‹é¡¶ç«¯çš„ç”·äºº
  // ä½†æˆ‘ç•™æ„åˆ° Lodash åº“çš„ clone æ–¹æ³•å¯¹ä»¥ä¸Šä¸¤ç§æƒ…å†µæ˜¯ä¸å¤„ç†çš„
  if (obj.constructor === undefined) {
    return Object.create(null)
  }

  // å¤„ç†è‡ªå®šä¹‰æ„é€ å‡½æ•°çš„å®ä¾‹å¯¹è±¡
  if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
    const proto = Object.getPrototypeOf(obj)
    return Object.create(proto)
  }

  return {}
}

const output = isArray(input) ? [] : initCloneObject(input)
</code></pre>
<p>æ¥çœ‹ä¸‹æ‰“å°ç»“æœï¼Œå¯ä»¥çœ‹åˆ° <code>source</code> çš„åŸå‹å¯¹è±¡å·²ç»æ‹·è´è¿‡æ¥äº†ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-4734d18bf71b9eba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å†æ¥çœ‹ä¸‹ <code>Object.create(null)</code> çš„æƒ…å†µï¼Œä¹Ÿæ˜¯é¢„æœŸç»“æœã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-22809d763baeb9e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Lodash çš„ <code>_.cloneDeep(Object.create(null))</code> æ·±æ‹·è´æ–¹æ³•å¹¶æ²¡æœ‰å¤„ç†è¿™ç§æƒ…å†µã€‚å½“ç„¶äº†ï¼Œè¦æ‹·è´è¿™ç§æ•°æ®ç»“æ„åœ¨å®é™…åº”ç”¨åœºæ™¯ï¼ŒçœŸçš„å°‘ä¹‹åˆå°‘...</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5128488-ec6032b7655ee73e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>å…³äº Lodash æ‹·è´æ–¹æ³•ä¸ºä»€ä¹ˆä¸å®ç°è¿™ç§æƒ…å†µï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªç›¸å…³çš„ <a href="https://github.com/lodash/lodash/issues/588">Issue #588</a>ï¼š</p>
<p>A shallow clone won't do that as it's just <code>_.assign({}, object)</code> and a deep clone is loosely based on the structured cloning algorithm and doesn't attempt to clone inheritance or lack thereof.</p>
</blockquote>
<h3>å››ã€ä¼˜åŒ–</h3>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå®Œæ•´ä½†<strong>æœªä¼˜åŒ–</strong>çš„æ·±æ‹·è´æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡
  const weakmap = new WeakMap()

  // è·å–æ•°æ®ç±»å‹
  const getClass = x =&gt; Object.prototype.toString.call(x)

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === '[object Array]'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºåŒ…è£…å¯¹è±¡
  const isWrapperObject = obj =&gt; {
    const theClass = getClass(obj)
    const type = /^\[object (.*)\]$/.exec(theClass)[1]
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set'].includes(type)
  }

  // å¤„ç†åŒ…è£…å¯¹è±¡
  const handleWrapperObject = obj =&gt; {
    const type = getClass(obj)
    switch (type) {
      case '[object Boolean]':
        return Object(Boolean.prototype.valueOf.call(obj))
      case '[object Number]':
        return Object(Number.prototype.valueOf.call(obj))
      case '[object String]':
        return Object(String.prototype.valueOf.call(obj))
      case '[object Symbol]':
        return Object(Symbol.prototype.valueOf.call(obj))
      case '[object BigInt]':
        return Object(BigInt.prototype.valueOf.call(obj))
      case '[object Date]':
        return new Date(obj.valueOf()) // new Date(+obj)
      case '[object Map]': {
        const map = new Map()
        obj.forEach((item, key) =&gt; {
          map.set(key, copy(item))
        })
        return map
      }
      case '[object Set]': {
        const set = new Set()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // å¤„ç†æ­£åˆ™è¡¨è¾¾å¼
  const handleRegExp = regex =&gt; {
    const { source, flags, lastIndex } = regex
    const re = new RegExp(source, flags)
    re.lastIndex = lastIndex
    return re
  }

  const initCloneObject = obj =&gt; {
    if (obj.constructor === undefined) {
      return Object.create(null)
    }

    if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
      const proto = Object.getPrototypeOf(obj)
      return Object.create(proto)
    }

    return {}
  }

  // æ‹·è´ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // æ­£åˆ™è¡¨è¾¾å¼
    if (getClass(input) === '[object RegExp]') {
      return handleRegExp(input)
    }

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isWrapperObject(input)) {
      return handleWrapperObject(input)
    }

    const output = isArray(input) ? [] : initCloneObject(input)

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    for (let key in input) {
      if (input.hasOwnProperty(key)) {
        const value = input[key]
        output[key] = copy(value)
      }
    }

    // å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
    const symbolArr = Object.getOwnPropertySymbols(input)
    if (symbolArr.length) {
      for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
        if (input.propertyIsEnumerable(symbolArr[i])) {
          const value = input[symbolArr[i]]
          output[symbolArr[i]] = copy(value)
        }
      }
    }

    return output
  }

  return copy(source)
}
</code></pre>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¼˜åŒ–å·¥ä½œäº†...</p>
<h5>4.1 ä¼˜åŒ–ä¸€</h5>
<p>æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨åˆ°äº† <code>for...in</code> å’Œ <code>Object.getOwnPropertySymbols()</code> æ–¹æ³•å»éå†å¯¹è±¡çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰ï¼Œè¿˜æ¶‰åŠäº†å¯æšä¸¾å±æ€§å’Œä¸å¯æšä¸¾å±æ€§ã€‚</p>
<ul>
<li><a href=""><strong>for...in</strong></a>ï¼šéå†<strong>è‡ªèº«</strong>å’Œ<strong>ç»§æ‰¿è¿‡æ¥</strong>çš„<strong>å¯æšä¸¾</strong>å±æ€§ï¼ˆä¸åŒ…æ‹¬ Symbol å±æ€§ï¼‰ã€‚</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/keys"><strong>Object.keys</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>æ‰€æœ‰<strong>å¯æšä¸¾</strong>å±æ€§ï¼ˆä¸åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§å’Œ Symbol å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames"><strong>Object.getOwnPropertyNames</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>çš„å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼Œä½†ä¸åŒ…æ‹¬ Symbol å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols"><strong>Object.getOwnPropertySymbols</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>å¯¹è±¡è‡ªèº«</strong>çš„æ‰€æœ‰ Symbol å±æ€§ï¼ˆåŒ…æ‹¬å¯æšä¸¾å’Œä¸å¯æšä¸¾å±æ€§ï¼‰</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys"><strong>Reflect.ownKeys</strong></a>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«<strong>è‡ªèº«æ‰€æœ‰</strong>çš„å±æ€§ï¼ˆåŒ…æ‹¬ Symbol å±æ€§ï¼Œä¸å¯æšä¸¾å±æ€§ä»¥åŠå¯æšä¸¾å±æ€§ï¼‰</li>
</ul>
<blockquote>
<p>ç”±äºæˆ‘ä»¬ä»…æ‹·è´å¯æšä¸¾çš„å­—ç¬¦ä¸²å±æ€§å’Œå¯æšä¸¾çš„ Symbol å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å°† <code>Reflect.ownKeys()</code> å’Œ <code>Object.prototype.propertyIsEnumerable()</code> ç»“åˆä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†ä»¥ä¸‹è¿™éƒ¨åˆ†ï¼š</p>
<pre><code class="language-js">for (let key in input) {
  if (input.hasOwnProperty(key)) {
    const value = input[key]
    output[key] = copy(value)
  }
}

// å¤„ç†ä»¥ Symbol å€¼ä½œä¸ºå±æ€§é”®çš„å±æ€§
const symbolArr = Object.getOwnPropertySymbols(input)
if (symbolArr.length) {
  for (let i = 0, len = symbolArr.length; i &lt; len; i++) {
    if (input.propertyIsEnumerable(symbolArr[i])) {
      const value = input[symbolArr[i]]
      output[symbolArr[i]] = copy(value)
    }
  }
}
</code></pre>
<p>ä¼˜åŒ–æˆï¼š</p>
<pre><code class="language-js">// ä»…éå†å¯¹è±¡è‡ªèº«å¯æšä¸¾çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰
Reflect.ownKeys(input).forEach(key =&gt; {
  if (input.propertyIsEnumerable(key)) {
    output[key] = copy(input[key])
  }
})
</code></pre>
<h5>4.2 ä¼˜åŒ–äºŒ</h5>
<p>ä¼˜åŒ– <code>getClass()</code>ã€<code>isWrapperObject()</code>ã€<code>handleWrapperObject()</code>ã€<code>handleRegExp()</code> åŠå…¶ç›¸å…³çš„ç±»å‹åˆ¤æ–­æ–¹æ³•ã€‚</p>
<p>ç”±äº <code>handleWrapperObject()</code> åŸæ„æ˜¯å¤„ç†åŒ…è£…å¯¹è±¡ï¼Œä½†æ˜¯éšç€åé¢è¦å¤„ç†çš„ç‰¹æ®Šå¯¹è±¡è¶Šæ¥è¶Šå¤šï¼Œä¸ºäº†å‡å°‘æ–‡ç« ç¯‡å¹…ï¼Œæš‚æ—¶éƒ½å†™åœ¨é‡Œé¢äº†ï¼Œç¨å¾®æœ‰ç‚¹ä¹±ã€‚</p>
<p>å› æ­¤ä¸‹é¢æˆ‘ä»¬æ¥æ•´åˆä¸€ä¸‹ï¼Œéƒ¨åˆ†å¤„ç†å‡½æ•°å¯èƒ½ä¼šä¿®æ”¹å‡½æ•°åã€‚</p>
<h3>äº”ã€æœ€ç»ˆ</h3>
<p>å…¶å®ï¼Œä¸Šé¢æåˆ°çš„ä¸€äº›è¾¹ç•Œ Caseã€æˆ–è€…å…¶ä»–ä¸€äº›ç‰¹æ®Šå¯¹è±¡ï¼ˆå¦‚ <code>ArrayBuffer</code> ç­‰ï¼‰ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¤„ç†ï¼Œä½†æˆ‘è®¤ä¸ºè¯¥å®Œç»“äº†ï¼Œå› ä¸ºè¿™äº›åœ¨å®é™…åº”ç”¨åœºæ™¯çœŸçš„å¤ªå°‘äº†ã€‚</p>
<p>ä»£ç å·²ä¸¢åˆ° GitHub ğŸ‘‰ <a href="https://github.com/toFrankie/Some-JavaScript-File">toFrankie/Some-JavaScript-File</a>ã€‚</p>
<p>è¿˜æ˜¯é‚£å¥è¯ï¼š</p>
<blockquote>
<p><strong>å¦‚æœç”Ÿäº§ç¯å¢ƒä½¿ç”¨ <code>JSON.stringify()</code> æ— æ³•è§£å†³ä½ çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨ <a href="https://www.lodashjs.com/">Lodash</a> åº“çš„ <a href="https://www.lodashjs.com/docs/lodash.cloneDeep"><code>_.cloneDeep()</code></a> æ–¹æ³•ï¼Œé‚£ä¸ªæ‰å«é¢é¢ä¿±åˆ°ã€‚åƒä¸‡åˆ«ç”¨æˆ‘è¿™æ–¹æ³•ï¼Œåˆ‡è®°ï¼</strong></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦é¢å‘å­¦ä¹ ã€é¢è¯•ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ï¼Œæˆ–è®¸ä¹Ÿå¯ä»¥å¸®åŠ©ä½ ç†Ÿæ‚‰ä¸€äº›å¯¹è±¡çš„ç‰¹æ€§ã€‚å¦‚æœ‰ä¸è¶³ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œä¸‡åˆ†æ„Ÿè°¢ ğŸ‘‹ ~</p>
<p>ç»ˆäºç»ˆäºç»ˆäº......è¦å†™å®Œäº†ï¼Œåäº†ä¸‰æ–¤è¡€...</p>
<p>æœ€ç»ˆç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">const deepCopy = source =&gt; {
  // åˆ›å»ºä¸€ä¸ª WeakMap å¯¹è±¡ï¼Œè®°å½•å·²æ‹·è´è¿‡çš„å¯¹è±¡
  const weakmap = new WeakMap()

  // è·å–æ•°æ®ç±»å‹ï¼Œè¿”å›å€¼å¦‚ï¼š&quot;Object&quot;ã€&quot;Array&quot;ã€&quot;Symbol&quot; ç­‰
  const getClass = x =&gt; {
    const type = Object.prototype.toString.call(x)
    return /^\[object (.*)\]$/.exec(type)[1]
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„
  const isArray = arr =&gt; getClass(arr) === 'Array'

  // åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹
  const isObject = obj =&gt; obj !== null &amp;&amp; (typeof obj === 'object' || typeof obj === 'function')

  // åˆ¤æ–­æ˜¯å¦ä¸ºâ€œç‰¹æ®Šâ€å¯¹è±¡ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰
  const isSepcialObject = obj =&gt; {
    const type = getClass(obj)
    return ['Boolean', 'Number', 'String', 'Symbol', 'BigInt', 'Date', 'Map', 'Set', 'RegExp'].includes(type)
  }

  // å¤„ç†ç‰¹æ®Šå¯¹è±¡
  const handleSepcialObject = obj =&gt; {
    const type = getClass(obj)
    const Ctor = obj.constructor // å¯¹è±¡çš„æ„é€ å‡½æ•°
    const primitiveValue = obj.valueOf() // è·å–å¯¹è±¡çš„åŸå§‹å€¼

    switch (type) {
      case 'Boolean':
      case 'Number':
      case 'String':
      case 'Symbol':
      case 'BigInt':
        // å¤„ç†åŒ…è£…å¯¹è±¡ Wrapper Object
        return Object(primitiveValue)
      case 'Date':
        return new Ctor(primitiveValue) // new Date(+obj)
      case 'RegExp': {
        const { source, flags, lastIndex } = obj
        const re = new RegExp(source, flags)
        re.lastIndex = lastIndex
        return re
      }
      case 'Map': {
        const map = new Ctor()
        obj.forEach((item, key) =&gt; {
          // æ³¨æ„ï¼Œå³ä½¿ Map å¯¹è±¡çš„ key ä¸ºå¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œä¹Ÿä¸èƒ½ copy(key)ï¼Œå¦åˆ™ä¼šå¤±å»å¼•ç”¨ï¼Œå¯¼è‡´è¯¥å±æ€§æ— æ³•è®¿é—®å¾—åˆ°ã€‚
          map.set(key, copy(item))
        })
        return map
      }
      case 'Set': {
        const set = new Ctor()
        obj.forEach(item =&gt; {
          set.add(copy(item))
        })
        return set
      }
      default:
        return undefined
    }
  }

  // åˆ›å»ºè¾“å‡ºå¯¹è±¡ï¼ˆåŸå‹æ‹·è´å…³é”®å°±åœ¨è¿™ä¸€æ­¥ï¼‰
  const initCloneObject = obj =&gt; {
    if (obj.constructor === undefined) {
      return Object.create(null)
    }

    if (typeof obj.constructor === 'function' &amp;&amp; (obj !== obj.constructor || obj !== Object.prototype)) {
      const proto = Object.getPrototypeOf(obj)
      return Object.create(proto)
    }

    return {}
  }

  // æ‹·è´æ–¹æ³•ï¼ˆé€’å½’æ€è·¯ï¼‰
  const copy = input =&gt; {
    if (typeof input === 'function' || !isObject(input)) return input

    // é’ˆå¯¹å·²æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ï¼ˆè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰
    if (weakmap.has(input)) {
      return weakmap.get(input)
    }

    // å¤„ç†åŒ…è£…å¯¹è±¡
    if (isSepcialObject(input)) {
      return handleSepcialObject(input)
    }

    // åˆ›å»ºè¾“å‡ºå¯¹è±¡
    const output = isArray(input) ? [] : initCloneObject(input)

    // è®°å½•æ¯æ¬¡æ‹·è´çš„å¯¹è±¡
    weakmap.set(input, output)

    // ä»…éå†å¯¹è±¡è‡ªèº«å¯æšä¸¾çš„å±æ€§ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å±æ€§å’Œ Symbol å±æ€§ï¼‰
    Reflect.ownKeys(input).forEach(key =&gt; {
      if (input.propertyIsEnumerable(key)) {
        output[key] = copy(input[key])
      }
    })

    return output
  }

  return copy(source)
}
</code></pre>
<h3>å…­ã€å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/lodash/lodash/blob/2f79053d7bc7c9c9561a30dda202b3dcd2b72b90/cloneDeep.js">GitHub/lodash</a></li>
<li><a href="https://juejin.cn/post/6844903986479251464">åŸç”Ÿ JS çµé­‚ä¹‹é—®(ä¸­)ï¼Œæ£€éªŒè‡ªå·±æ˜¯å¦çœŸçš„ç†Ÿæ‚‰ JavaScriptï¼Ÿ</a></li>
</ul>
<p>The end.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æ‰‹å†™ new å…³é”®å­—]]></title>
            <link>https://github.com/toFrankie/blog/issues/1</link>
            <guid isPermaLink="false">https://github.com/toFrankie/blog/issues/1</guid>
            <pubDate>Thu, 28 Oct 2021 15:42:21 GMT</pubDate>
            <description><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902165449.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>åŸç†</h2>
<p>å…ˆäº†è§£ä¸‹ <code>new</code> å…³é”®å­—éƒ½åš]]></description>
            <content:encoded><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/toFrankie/blog@main/images/2025/6/1750902165449.jpg" alt="é…å›¾æºè‡ª Freepik"></p>
<h2>åŸç†</h2>
<p>å…ˆäº†è§£ä¸‹ <code>new</code> å…³é”®å­—éƒ½åšäº†äº›ä»€ä¹ˆå·¥ä½œï¼š</p>
<blockquote>
<ol>
<li>éšå¼åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ <code>this</code>ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼›</li>
<li>å°†å®ä¾‹å¯¹è±¡åŸå‹ï¼ˆ<code>__proto__</code>ï¼‰æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆ<code>prototype</code>ï¼‰ï¼›</li>
<li>å¼€å§‹æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œä¸€èˆ¬ä¼šä¼´éšç€å®ä¾‹å¯¹è±¡å±æ€§ã€æ–¹æ³•çš„ç»‘å®šï¼›</li>
<li>è¿”å›ç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¸€æ­¥æ‰§è¡Œæ„é€ å‡½æ•°è¿”å›çš„ç»“æœï¼Œè‹¥ä¸ºå¼•ç”¨å€¼ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥å€¼ï¼Œå¦åˆ™è¿”å›å®ä¾‹å¯¹è±¡ã€‚</li>
</ol>
</blockquote>
<h2>æ€è·¯</h2>
<p>çŸ¥é“åŸç†ä¹‹åï¼Œæ‰‹å†™å°±æœ‰æ€è·¯äº†ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼š</p>
<pre><code class="language-js">myNew(ctor, arg1, arg2, ...)
</code></pre>
<ul>
<li>
<p><code>ctor</code> æ¥å—ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</p>
</li>
<li>
<p><code>arg1, arg2, ...</code>ï¼ˆå¯é€‰ï¼‰æŒ‡å®šå‚æ•°åˆ—è¡¨ã€‚</p>
</li>
</ul>
<h2>å®ç°</h2>
<p>ä»£ç å®ç°ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">function myNew() {
  // è·å–æ„é€ å‡½æ•°ã€å‚æ•°åˆ—è¡¨
  const [Ctor, ...args] = arguments

  // åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œå¹¶æŒ‡å®šåŸå‹
  const _this = {}
  _this.__proto__ = Ctor.prototype // æˆ–ä½¿ç”¨æ ‡å‡†æ–¹æ³• Object.setPrototypeOf(_this, Ctor.prototype)

  // æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå¹¶æ³¨æ„ this æŒ‡å‘
  const res = Ctor.apply(_this, args)

  // è¿”å›ç»“æœ
  return res instanceof Object ? res : _this
}
</code></pre>
<h2>ä¼˜åŒ–</h2>
<p>æ—¢ç„¶æˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº† ES6 çš„è¯­æ³•ï¼Œæˆ‘ä»¬ä¸å¦¨å°†åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ­¥éª¤æ”¹ç”¨ <code>Object.create()</code> æ¥å¤„ç†ï¼Œå†ç®€åŒ–ä¸€ä¸‹ï¼š</p>
<pre><code class="language-js">function myNew(Ctor, ...args) {
  const _this = Object.create(Ctor.prototype)
  const res = Ctor.apply(_this, args)
  return res instanceof Object ? res : _this
}
</code></pre>
<h2>Usage</h2>
<pre><code class="language-js">function Foo(name, age) {
  this.name = name
  this.age = age
}

const foo = myNew(Foo, 'Frankie', 20) // FooÂ { name: 'Frankie', age: 20 }
</code></pre>
]]></content:encoded>
        </item>
    </channel>
</rss>